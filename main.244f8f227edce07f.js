(self.webpackChunkojp_demo_app=self.webpackChunkojp_demo_app||[]).push([[179],{8455:(on,hn,We)=>{"use strict";function ye(n){return"function"==typeof n}function ke(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const Ie=ke(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function p(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class ie{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(ye(i))try{i()}catch(s){t=s instanceof Ie?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{Ue(s)}catch(u){t=null!=t?t:[],u instanceof Ie?t=[...t,...u.errors]:t.push(u)}}if(t)throw new Ie(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Ue(t);else{if(t instanceof ie){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&p(e,t)}remove(t){const{_finalizers:e}=this;e&&p(e,t),t instanceof ie&&t._removeParent(this)}}ie.EMPTY=(()=>{const n=new ie;return n.closed=!0,n})();const Qe=ie.EMPTY;function re(n){return n instanceof ie||n&&"closed"in n&&ye(n.remove)&&ye(n.add)&&ye(n.unsubscribe)}function Ue(n){ye(n)?n():n.unsubscribe()}const Ye={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},bt={setTimeout(n,t,...e){const{delegate:i}=bt;return null!=i&&i.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=bt;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function Ct(n){bt.setTimeout(()=>{const{onUnhandledError:t}=Ye;if(!t)throw n;t(n)})}function $e(){}const Ge=vn("C",void 0,void 0);function vn(n,t,e){return{kind:n,value:t,error:e}}let Cn=null;function st(n){if(Ye.useDeprecatedSynchronousErrorHandling){const t=!Cn;if(t&&(Cn={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=Cn;if(Cn=null,e)throw i}}else n()}class Te extends ie{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,re(t)&&t.add(this)):this.destination=gt}static create(t,e,i){return new ut(t,e,i)}next(t){this.isStopped?lt(function Jt(n){return vn("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?lt(function wt(n){return vn("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?lt(Ge,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const xe=Function.prototype.bind;function Ae(n,t){return xe.call(n,t)}class ce{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){se(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){se(i)}else se(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){se(e)}}}class ut extends Te{constructor(t,e,i){let r;if(super(),ye(t)||!t)r={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=i?i:void 0};else{let s;this&&Ye.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&Ae(t.next,s),error:t.error&&Ae(t.error,s),complete:t.complete&&Ae(t.complete,s)}):r=t}this.destination=new ce(r)}}function se(n){Ye.useDeprecatedSynchronousErrorHandling?function ln(n){Ye.useDeprecatedSynchronousErrorHandling&&Cn&&(Cn.errorThrown=!0,Cn.error=n)}(n):Ct(n)}function lt(n,t){const{onStoppedNotification:e}=Ye;e&&bt.setTimeout(()=>e(n,t))}const gt={closed:!0,next:$e,error:function be(n){throw n},complete:$e},He="function"==typeof Symbol&&Symbol.observable||"@@observable";function vt(n){return n}function oi(n){return 0===n.length?vt:1===n.length?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}let Lt=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){const s=function Fi(n){return n&&n instanceof Te||function qi(n){return n&&ye(n.next)&&ye(n.error)&&ye(n.complete)}(n)&&re(n)}(e)?e:new ut(e,i,r);return st(()=>{const{operator:u,source:m}=this;s.add(u?u.call(s,m):m?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=cn(i))((r,s)=>{const u=new ut({next:m=>{try{e(m)}catch(y){s(y),u.unsubscribe()}},error:s,complete:r});this.subscribe(u)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[He](){return this}pipe(...e){return oi(e)(this)}toPromise(e){return new(e=cn(e))((i,r)=>{let s;this.subscribe(u=>s=u,u=>r(u),()=>i(s))})}}return n.create=t=>new n(t),n})();function cn(n){var t;return null!==(t=null!=n?n:Ye.Promise)&&void 0!==t?t:Promise}const xi=ke(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Kt=(()=>{class n extends Lt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new To(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new xi}next(e){st(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){st(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){st(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:s}=this;return i||r?Qe:(this.currentObservers=null,s.push(e),new ie(()=>{this.currentObservers=null,p(s,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:s}=this;i?e.error(r):s&&e.complete()}asObservable(){const e=new Lt;return e.source=this,e}}return n.create=(t,e)=>new To(t,e),n})();class To extends Kt{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:Qe}}function vo(n){return ye(null==n?void 0:n.lift)}function ki(n){return t=>{if(vo(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ii(n,t,e,i,r){return new ge(n,t,e,i,r)}class ge extends Te{constructor(t,e,i,r,s,u){super(t),this.onFinalize=s,this.shouldUnsubscribe=u,this._next=e?function(m){try{e(m)}catch(y){t.error(y)}}:super._next,this._error=r?function(m){try{r(m)}catch(y){t.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(m){t.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function W(n,t){return ki((e,i)=>{let r=0;e.subscribe(Ii(i,s=>{i.next(n.call(t,s,r++))}))})}function Ke(n,t,e,i){return new(e||(e=Promise))(function(s,u){function m(I){try{C(i.next(I))}catch(A){u(A)}}function y(I){try{C(i.throw(I))}catch(A){u(A)}}function C(I){I.done?s(I.value):function r(s){return s instanceof e?s:new e(function(u){u(s)})}(I.value).then(m,y)}C((i=i.apply(n,t||[])).next())})}function ms(n){return this instanceof ms?(this.v=n,this):new ms(n)}function Ea(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(n,t||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),m("next"),m("throw"),m("return",function u(j){return function(K){return Promise.resolve(K).then(j,A)}}),r[Symbol.asyncIterator]=function(){return this},r;function m(j,K){i[j]&&(r[j]=function(pe){return new Promise(function(Se,Xe){s.push([j,pe,Se,Xe])>1||y(j,pe)})},K&&(r[j]=K(r[j])))}function y(j,K){try{!function C(j){j.value instanceof ms?Promise.resolve(j.value.v).then(I,A):B(s[0][2],j)}(i[j](K))}catch(pe){B(s[0][3],pe)}}function I(j){y("next",j)}function A(j){y("throw",j)}function B(j,K){j(K),s.shift(),s.length&&y(s[0][0],s[0][1])}}function Kl(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function Di(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=n[s]&&function(u){return new Promise(function(m,y){!function r(s,u,m,y){Promise.resolve(y).then(function(C){s({value:C,done:m})},u)}(m,y,(u=n[s](u)).done,u.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const ze=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function ct(n){return ye(null==n?void 0:n.then)}function Zt(n){return ye(n[He])}function rn(n){return Symbol.asyncIterator&&ye(null==n?void 0:n[Symbol.asyncIterator])}function Gt(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const mi=function ii(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function ni(n){return ye(null==n?void 0:n[mi])}function gi(n){return Ea(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:r}=yield ms(e.read());if(r)return yield ms(void 0);yield yield ms(i)}}finally{e.releaseLock()}})}function Mi(n){return ye(null==n?void 0:n.getReader)}function Bi(n){if(n instanceof Lt)return n;if(null!=n){if(Zt(n))return function po(n){return new Lt(t=>{const e=n[He]();if(ye(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(ze(n))return function ns(n){return new Lt(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(ct(n))return function xo(n){return new Lt(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Ct)})}(n);if(rn(n))return Eo(n);if(ni(n))return function nl(n){return new Lt(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(Mi(n))return function gs(n){return Eo(gi(n))}(n)}throw Gt(n)}function Eo(n){return new Lt(t=>{(function _u(n,t){var e,i,r,s;return Ke(this,void 0,void 0,function*(){try{for(e=Kl(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(u){r={error:u}}finally{try{i&&!i.done&&(s=e.return)&&(yield s.call(e))}finally{if(r)throw r.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function Tl(n,t,e,i=0,r=!1){const s=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function Wn(n,t,e=1/0){return ye(t)?Wn((i,r)=>W((s,u)=>t(i,s,r,u))(Bi(n(i,r))),e):("number"==typeof t&&(e=t),ki((i,r)=>function $m(n,t,e,i,r,s,u,m){const y=[];let C=0,I=0,A=!1;const B=()=>{A&&!y.length&&!C&&t.complete()},j=pe=>C<i?K(pe):y.push(pe),K=pe=>{s&&t.next(pe),C++;let Se=!1;Bi(e(pe,I++)).subscribe(Ii(t,Xe=>{null==r||r(Xe),s?j(Xe):t.next(Xe)},()=>{Se=!0},void 0,()=>{if(Se)try{for(C--;y.length&&C<i;){const Xe=y.shift();u?Tl(t,u,()=>K(Xe)):K(Xe)}B()}catch(Xe){t.error(Xe)}}))};return n.subscribe(Ii(t,j,()=>{A=!0,B()})),()=>{null==m||m()}}(i,r,n,e)))}function Ql(n=1/0){return Wn(vt,n)}const bs=new Lt(n=>n.complete());function Da(n){return n&&ye(n.schedule)}function Ia(n){return n[n.length-1]}function Bh(n){return ye(Ia(n))?n.pop():void 0}function Oc(n){return Da(Ia(n))?n.pop():void 0}function il(n,t=0){return ki((e,i)=>{e.subscribe(Ii(i,r=>Tl(i,n,()=>i.next(r),t),()=>Tl(i,n,()=>i.complete(),t),r=>Tl(i,n,()=>i.error(r),t)))})}function yu(n,t=0){return ki((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function ef(n,t){if(!n)throw new Error("Iterable cannot be null");return new Lt(e=>{Tl(e,t,()=>{const i=n[Symbol.asyncIterator]();Tl(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function ro(n,t){return t?function tf(n,t){if(null!=n){if(Zt(n))return function _t(n,t){return Bi(n).pipe(yu(t),il(t))}(n,t);if(ze(n))return function fo(n,t){return new Lt(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(ct(n))return function El(n,t){return Bi(n).pipe(yu(t),il(t))}(n,t);if(rn(n))return ef(n,t);if(ni(n))return function Oo(n,t){return new Lt(e=>{let i;return Tl(e,t,()=>{i=n[mi](),Tl(e,t,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(u){return void e.error(u)}s?e.complete():e.next(r)},0,!0)}),()=>ye(null==i?void 0:i.return)&&i.return()})}(n,t);if(Mi(n))return function rl(n,t){return ef(gi(n),t)}(n,t)}throw Gt(n)}(n,t):Bi(n)}function Er(...n){const t=Oc(n),e=function Fc(n,t){return"number"==typeof Ia(n)?n.pop():t}(n,1/0),i=n;return i.length?1===i.length?Bi(i[0]):Ql(e)(ro(i,t)):bs}function un(n={}){const{connector:t=(()=>new Kt),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let u,m,y,C=0,I=!1,A=!1;const B=()=>{null==m||m.unsubscribe(),m=void 0},j=()=>{B(),u=y=void 0,I=A=!1},K=()=>{const pe=u;j(),null==pe||pe.unsubscribe()};return ki((pe,Se)=>{C++,!A&&!I&&B();const Xe=y=null!=y?y:t();Se.add(()=>{C--,0===C&&!A&&!I&&(m=Ti(K,r))}),Xe.subscribe(Se),!u&&C>0&&(u=new ut({next:At=>Xe.next(At),error:At=>{A=!0,B(),m=Ti(j,e,At),Xe.error(At)},complete:()=>{I=!0,B(),m=Ti(j,i),Xe.complete()}}),Bi(pe).subscribe(u))})(s)}}function Ti(n,t,...e){if(!0===t)return void n();if(!1===t)return;const i=new ut({next:()=>{i.unsubscribe(),n()}});return t(...e).subscribe(i)}function Tn(n){for(let t in n)if(n[t]===Tn)return t;throw Error("Could not find renamed property on target object.")}function _s(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function ji(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(ji).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function bi(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const qs=Tn({__forward_ref__:Tn});function zi(n){return n.__forward_ref__=zi,n.toString=function(){return ji(this())},n}function qn(n){return Rs(n)?n():n}function Rs(n){return"function"==typeof n&&n.hasOwnProperty(qs)&&n.__forward_ref__===zi}class zt extends Error{constructor(t,e){super(function da(n,t){return`NG0${Math.abs(n)}${t?": "+t.trim():""}`}(t,e)),this.code=t}}function ri(n){return"string"==typeof n?n:null==n?"":String(n)}function Jl(n,t){throw new zt(-201,!1)}function Do(n,t){null==n&&function di(n,t,e,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${e} ${i} ${t} <=Actual]`))}(t,n,null,"!=")}function Qt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Sn(n){return{providers:n.providers||[],imports:n.imports||[]}}function vu(n){return ka(n,tc)||ka(n,Cd)}function ka(n,t){return n.hasOwnProperty(t)?n[t]:null}function ol(n){return n&&(n.hasOwnProperty(Ra)||n.hasOwnProperty(wu))?n[Ra]:null}const tc=Tn({\u0275prov:Tn}),Ra=Tn({\u0275inj:Tn}),Cd=Tn({ngInjectableDef:Tn}),wu=Tn({ngInjectorDef:Tn});var $n=(()=>(($n=$n||{})[$n.Default=0]="Default",$n[$n.Host=1]="Host",$n[$n.Self=2]="Self",$n[$n.SkipSelf=4]="SkipSelf",$n[$n.Optional=8]="Optional",$n))();let zh;function Ls(n){const t=zh;return zh=n,t}function jh(n,t,e){const i=vu(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&$n.Optional?null:void 0!==t?t:void Jl(ji(n))}function Ai(n){return{toString:n}.toString()}var Pa=(()=>((Pa=Pa||{})[Pa.OnPush=0]="OnPush",Pa[Pa.Default=1]="Default",Pa))(),Ws=(()=>{return(n=Ws||(Ws={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",Ws;var n})();const Lr=(()=>"undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof global&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self)(),Dl={},Gi=[],ha=Tn({\u0275cmp:Tn}),Il=Tn({\u0275dir:Tn}),Su=Tn({\u0275pipe:Tn}),af=Tn({\u0275mod:Tn}),Xs=Tn({\u0275fac:Tn}),Bc=Tn({__NG_ELEMENT_ID__:Tn});let lf=0;function mn(n){return Ai(()=>{const e=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Pa.OnPush,directiveDefs:null,pipeDefs:null,standalone:e,dependencies:e&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||Gi,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||Ws.Emulated,id:"c"+lf++,styles:n.styles||Gi,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.dependencies,u=n.features;return r.inputs=$h(n.inputs,i),r.outputs=$h(n.outputs),u&&u.forEach(m=>m(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(Hh).filter(Vi):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(vs).filter(Vi):null,r})}function Hh(n){return mr(n)||ys(n)}function Vi(n){return null!==n}function wn(n){return Ai(()=>({type:n.type,bootstrap:n.bootstrap||Gi,declarations:n.declarations||Gi,imports:n.imports||Gi,exports:n.exports||Gi,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function $h(n,t){if(null==n)return Dl;const e={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),e[r]=i,t&&(t[r]=s)}return e}const Bt=mn;function wo(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function mr(n){return n[ha]||null}function ys(n){return n[Il]||null}function vs(n){return n[Su]||null}function xs(n,t){const e=n[af]||null;if(!e&&!0===t)throw new Error(`Type ${ji(n)} does not have '\u0275mod' property.`);return e}function Os(n){return Array.isArray(n)&&"object"==typeof n[1]}function La(n){return Array.isArray(n)&&!0===n[1]}function cf(n){return 0!=(8&n.flags)}function Gh(n){return 2==(2&n.flags)}function Rd(n){return 1==(1&n.flags)}function Fs(n){return null!==n.template}function Du(n){return 0!=(256&n[2])}function pa(n,t){return n.hasOwnProperty(Xs)?n[Xs]:null}class mf{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function hr(){return Mu}function Mu(n){return n.type.prototype.ngOnChanges&&(n.setInput=Yh),Zh}function Zh(){const n=fa(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===Dl)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function Yh(n,t,e,i){const r=fa(n)||function eg(n,t){return n[pn]=t}(n,{previous:Dl,current:null}),s=r.current||(r.current={}),u=r.previous,m=this.declaredInputs[e],y=u[m];s[m]=new mf(y&&y.currentValue,t,u===Dl),n[i]=t}hr.ngInherit=!0;const pn="__ngSimpleChanges__";function fa(n){return n[pn]||null}function Kr(n){for(;Array.isArray(n);)n=n[0];return n}function Jh(n,t){return Kr(t[n])}function Ns(n,t){return Kr(t[n.index])}function zd(n,t){return n.data[t]}function rc(n,t){return n[t]}function Ss(n,t){const e=t[n];return Os(e)?e:e[0]}function oc(n){return 64==(64&n[2])}function cl(n,t){return null==t?null:n[t]}function gf(n){n[18]=0}function jd(n,t){n[5]+=t;let e=n,i=n[3];for(;null!==i&&(1===t&&1===e[5]||-1===t&&0===e[5]);)i[5]+=t,e=i,i=i[3]}const pi={lFrame:c(null),bindingsEnabled:!0};function tp(){return pi.bindingsEnabled}function Pt(){return pi.lFrame.lView}function ir(){return pi.lFrame.tView}function si(n){return pi.lFrame.contextLView=n,n[8]}function fi(n){return pi.lFrame.contextLView=null,n}function Io(){let n=Zs();for(;null!==n&&64===n.type;)n=n.parent;return n}function Zs(){return pi.lFrame.currentTNode}function ul(n,t){const e=pi.lFrame;e.currentTNode=n,e.isParent=t}function Ys(){return pi.lFrame.isParent}function ma(){pi.lFrame.isParent=!1}function $o(){const n=pi.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function Bs(){return pi.lFrame.bindingIndex}function sn(){return pi.lFrame.bindingIndex++}function Na(n){const t=pi.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function _f(n,t){const e=pi.lFrame;e.bindingIndex=e.bindingRootIndex=n,rp(t)}function rp(n){pi.lFrame.currentDirectiveIndex=n}function yf(n){const t=pi.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}function ag(){return pi.lFrame.currentQueryIndex}function Ud(n){pi.lFrame.currentQueryIndex=n}function vf(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function op(n,t,e){if(e&$n.SkipSelf){let r=t,s=n;for(;!(r=r.parent,null!==r||e&$n.Host||(r=vf(s),null===r||(s=s[15],10&r.type))););if(null===r)return!1;t=r,n=s}const i=pi.lFrame=g();return i.currentTNode=t,i.lView=n,!0}function ac(n){const t=g(),e=n[1];pi.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function g(){const n=pi.lFrame,t=null===n?null:n.child;return null===t?c(n):t}function c(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function h(){const n=pi.lFrame;return pi.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const _=h;function x(){const n=h();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function M(){return pi.lFrame.selectedIndex}function R(n){pi.lFrame.selectedIndex=n}function O(){const n=pi.lFrame;return zd(n.tView,n.selectedIndex)}function F(){pi.lFrame.currentNamespace="svg"}function J(){!function ne(){pi.lFrame.currentNamespace=null}()}function ue(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const s=n.data[e].type.prototype,{ngAfterContentInit:u,ngAfterContentChecked:m,ngAfterViewInit:y,ngAfterViewChecked:C,ngOnDestroy:I}=s;u&&(n.contentHooks||(n.contentHooks=[])).push(-e,u),m&&((n.contentHooks||(n.contentHooks=[])).push(e,m),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,m)),y&&(n.viewHooks||(n.viewHooks=[])).push(-e,y),C&&((n.viewHooks||(n.viewHooks=[])).push(e,C),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,C)),null!=I&&(n.destroyHooks||(n.destroyHooks=[])).push(e,I)}}function $(n,t,e){_e(n,t,3,e)}function te(n,t,e,i){(3&n[2])===e&&_e(n,t,e,i)}function me(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function _e(n,t,e,i){const s=null!=i?i:-1,u=t.length-1;let m=0;for(let y=void 0!==i?65535&n[18]:0;y<u;y++)if("number"==typeof t[y+1]){if(m=t[y],null!=i&&m>=i)break}else t[y]<0&&(n[18]+=65536),(m<s||-1==s)&&(Be(n,e,t,y),n[18]=(4294901760&n[18])+y+2),y++}function Be(n,t,e,i){const r=e[i]<0,s=e[i+1],m=n[r?-e[i]:e[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{s.call(m)}finally{}}}else try{s.call(m)}finally{}}class Ne{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function it(n,t,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const s=e[i++],u=e[i++],m=e[i++];n.setAttribute(t,u,m,s)}else{const s=r,u=e[++i];Ut(s)?n.setProperty(t,s,u):n.setAttribute(t,s,u),i++}}return i}function xt(n){return 3===n||4===n||6===n}function Ut(n){return 64===n.charCodeAt(0)}function Rt(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?e=r:0===e||$t(n,e,r,null,-1===e||2===e?t[++i]:null)}}return n}function $t(n,t,e,i,r){let s=0,u=n.length;if(-1===t)u=-1;else for(;s<n.length;){const m=n[s++];if("number"==typeof m){if(m===t){u=-1;break}if(m>t){u=s-1;break}}}for(;s<n.length;){const m=n[s];if("number"==typeof m)break;if(m===e){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==u&&(n.splice(u,0,t),s=u+1),n.splice(s++,0,e),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function Mn(n){return-1!==n}function jn(n){return 32767&n}function Rn(n,t){let e=function _n(n){return n>>16}(n),i=t;for(;e>0;)i=i[15],e--;return i}let _i=!0;function ai(n){const t=_i;return _i=n,t}let vr=0;const Pi={};function ao(n,t){const e=ga(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,zs(i.data,n),zs(t,null),zs(i.blueprint,null));const r=Ir(n,t),s=n.injectorIndex;if(Mn(r)){const u=jn(r),m=Rn(r,t),y=m[1].data;for(let C=0;C<8;C++)t[s+C]=m[u+C]|y[u+C]}return t[s+8]=r,s}function zs(n,t){n.push(0,0,0,0,0,0,0,0,t)}function ga(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Ir(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;null!==r;){if(i=e0(r),null===i)return-1;if(e++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return-1}function ar(n,t,e){!function ss(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Bc)&&(i=e[Bc]),null==i&&(i=e[Bc]=vr++);const r=255&i;t.data[n+(r>>5)]|=1<<r}(n,t,e)}function lo(n,t,e){if(e&$n.Optional||void 0!==n)return n;Jl()}function as(n,t,e,i){if(e&$n.Optional&&void 0===i&&(i=null),0==(e&($n.Self|$n.Host))){const r=n[9],s=Ls(void 0);try{return r?r.get(t,i,e&$n.Optional):jh(t,i,e&$n.Optional)}finally{Ls(s)}}return lo(i,0,e)}function Rr(n,t,e,i=$n.Default,r){if(null!==n){if(1024&t[2]){const u=function Jv(n,t,e,i,r){let s=n,u=t;for(;null!==s&&null!==u&&1024&u[2]&&!(256&u[2]);){const m=Cs(s,u,e,i|$n.Self,Pi);if(m!==Pi)return m;let y=s.parent;if(!y){const C=u[21];if(C){const I=C.get(e,Pi,i);if(I!==Pi)return I}y=e0(u),u=u[15]}s=y}return r}(n,t,e,i,Pi);if(u!==Pi)return u}const s=Cs(n,t,e,i,Pi);if(s!==Pi)return s}return as(t,e,i,r)}function Cs(n,t,e,i,r){const s=function Pl(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(Bc)?n[Bc]:void 0;return"number"==typeof t?t>=0?255&t:Hd:t}(e);if("function"==typeof s){if(!op(t,n,i))return i&$n.Host?lo(r,0,i):as(t,e,i,r);try{const u=s(i);if(null!=u||i&$n.Optional)return u;Jl()}finally{_()}}else if("number"==typeof s){let u=null,m=ga(n,t),y=-1,C=i&$n.Host?t[16][6]:null;for((-1===m||i&$n.SkipSelf)&&(y=-1===m?Ir(n,t):t[m+8],-1!==y&&lc(i,!1)?(u=t[1],m=jn(y),t=Rn(y,t)):m=-1);-1!==m;){const I=t[1];if(Ll(s,m,I.data)){const A=sp(m,t,e,u,i,C);if(A!==Pi)return A}y=t[m+8],-1!==y&&lc(i,t[1].data[m+8]===C)&&Ll(s,m,t)?(u=I,m=jn(y),t=Rn(y,t)):m=-1}}return r}function sp(n,t,e,i,r,s){const u=t[1],m=u.data[n+8],I=dl(m,u,e,null==i?Gh(m)&&_i:i!=u&&0!=(3&m.type),r&$n.Host&&s===m);return null!==I?Rl(t,u,I,m):Pi}function dl(n,t,e,i,r){const s=n.providerIndexes,u=t.data,m=1048575&s,y=n.directiveStart,I=s>>20,B=r?m+I:n.directiveEnd;for(let j=i?m:m+I;j<B;j++){const K=u[j];if(j<y&&e===K||j>=y&&K.type===e)return j}if(r){const j=u[y];if(j&&Fs(j)&&j.type===e)return y}return null}function Rl(n,t,e,i){let r=n[e];const s=t.data;if(function Ze(n){return n instanceof Ne}(r)){const u=r;u.resolving&&function nf(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new zt(-200,`Circular dependency in DI detected for ${n}${e}`)}(function Yi(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():ri(n)}(s[e]));const m=ai(u.canSeeViewProviders);u.resolving=!0;const y=u.injectImpl?Ls(u.injectImpl):null;op(n,i,$n.Default);try{r=n[e]=u.factory(void 0,s,n,i),t.firstCreatePass&&e>=i.directiveStart&&function oe(n,t,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=t.type.prototype;if(i){const u=Mu(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,u),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,u)}r&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,r),s&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,s),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,s))}(e,s[e],t)}finally{null!==y&&Ls(y),ai(m),u.resolving=!1,_()}}return r}function Ll(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function lc(n,t){return!(n&$n.Self||n&$n.Host&&t)}class Ol{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return Rr(this._tNode,this._lView,t,i,e)}}function Hd(){return new Ol(Io(),Pt())}function Ui(n){return Ai(()=>{const t=n.prototype.constructor,e=t[Xs]||lg(t),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[Xs]||lg(r);if(s&&s!==e)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function lg(n){return Rs(n)?()=>{const t=lg(qn(n));return t&&t()}:pa(n)}function e0(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[6]:null}function qo(n){return function Qi(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const s=e[r];if(xt(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(s===t)return e[r+1];r+=2}}}return null}(Io(),n)}const $d="__parameters__";function Wc(n,t,e){return Ai(()=>{const i=function Fl(n){return function(...e){if(n){const i=n(...e);for(const r in i)this[r]=i[r]}}}(t);function r(...s){if(this instanceof r)return i.apply(this,s),this;const u=new r(...s);return m.annotation=u,m;function m(y,C,I){const A=y.hasOwnProperty($d)?y[$d]:Object.defineProperty(y,$d,{value:[]})[$d];for(;A.length<=I;)A.push(null);return(A[I]=A[I]||[]).push(u),y}}return e&&(r.prototype=Object.create(e.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class It{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Qt({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ba(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)?(t===n&&(t=n.slice(0,e)),ba(i,t)):t!==n&&t.push(i)}return t}function Wo(n,t){n.forEach(e=>Array.isArray(e)?Wo(e,t):t(e))}function o0(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function ug(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function $r(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}function go(n,t,e){let i=pl(n,t);return i>=0?n[1|i]=e:(i=~i,function dg(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(1===r)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;)n[r]=n[r-2],r--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function Cf(n,t){const e=pl(n,t);if(e>=0)return n[1|e]}function pl(n,t){return function Nu(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){const s=i+(r-i>>1),u=n[s<<e];if(t===u)return s<<e;u>t?r=s:i=s+1}return~(r<<e)}(n,t,1)}const za={},Ef="__NG_DI_FLAG__",Df="ngTempTokenPath",Mf=/\n/gm,lp="__source";let Fo;function Ts(n){const t=Fo;return Fo=n,t}function A_(n,t=$n.Default){if(void 0===Fo)throw new zt(-203,!1);return null===Fo?jh(n,void 0,t):Fo.get(n,t&$n.Optional?null:void 0,t)}function je(n,t=$n.Default){return(function Vh(){return zh}()||A_)(qn(n),t)}function Fr(n,t=$n.Default){return"number"!=typeof t&&(t=0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)),je(n,t)}function ja(n){const t=[];for(let e=0;e<n.length;e++){const i=qn(n[e]);if(Array.isArray(i)){if(0===i.length)throw new zt(900,!1);let r,s=$n.Default;for(let u=0;u<i.length;u++){const m=i[u],y=u1(m);"number"==typeof y?-1===y?r=m.token:s|=y:r=m}t.push(je(r,s))}else t.push(je(i))}return t}function Af(n,t){return n[Ef]=t,n.prototype[Ef]=t,n}function u1(n){return n[Ef]}const cp=Af(Wc("Optional"),8),up=Af(Wc("SkipSelf"),4);var Qs=(()=>((Qs=Qs||{})[Qs.Important=1]="Important",Qs[Qs.DashCase=2]="DashCase",Qs))();const dc=new Map;let xr=0;const Sg="__ngContext__";function Mo(n,t){Os(t)?(n[Sg]=t[20],function hc(n){dc.set(n[20],n)}(t)):n[Sg]=t}function Dg(n,t){return undefined(n,t)}function Kd(n){const t=n[3];return La(t)?t[3]:t}function Ig(n){return ju(n[13])}function Mg(n){return ju(n[4])}function ju(n){for(;null!==n&&!La(n);)n=n[4];return n}function dp(n,t,e,i,r){if(null!=i){let s,u=!1;La(i)?s=i:Os(i)&&(u=!0,i=i[0]);const m=Kr(i);0===n&&null!==e?null==r?w0(t,e,m):Qc(t,e,m,r||null,!0):1===n&&null!==e?Qc(t,e,m,r||null,!0):2===n?function Uf(n,t,e){const i=Qd(n,t);i&&function S1(n,t,e,i){n.removeChild(t,e,i)}(n,i,t,e)}(t,m,u):3===n&&t.destroyNode(m),null!=s&&function Og(n,t,e,i,r){const s=e[7];s!==Kr(e)&&dp(t,n,i,s,r);for(let m=10;m<e.length;m++){const y=e[m];pc(y[1],y,n,t,i,s)}}(t,n,s,e,r)}}function Ag(n,t,e){return n.createElement(t,e)}function v0(n,t){const e=n[9],i=e.indexOf(t),r=t[3];512&t[2]&&(t[2]&=-513,jd(r,-1)),e.splice(i,1)}function kg(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const r=i[17];null!==r&&r!==n&&v0(r,i),t>0&&(n[e-1][4]=i[4]);const s=ug(n,10+t);!function y1(n,t){pc(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const u=s[19];null!==u&&u.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function G_(n,t){if(!(128&t[2])){const e=t[11];e.destroyNode&&pc(n,t,e,3,null,null),function x1(n){let t=n[13];if(!t)return Rg(n[1],n);for(;t;){let e=null;if(Os(t))e=t[13];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)Os(t)&&Rg(t[1],t),t=t[3];null===t&&(t=n),Os(t)&&Rg(t[1],t),e=t&&t[4]}t=e}}(t)}}function Rg(n,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function Kc(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const r=t[e[i]];if(!(r instanceof Ne)){const s=e[i+1];if(Array.isArray(s))for(let u=0;u<s.length;u+=2){const m=r[s[u]],y=s[u+1];try{y.call(m)}finally{}}else try{s.call(r)}finally{}}}}(n,t),function W_(n,t){const e=n.cleanup,i=t[7];let r=-1;if(null!==e)for(let s=0;s<e.length-1;s+=2)if("string"==typeof e[s]){const u=e[s+1],m="function"==typeof u?u(t):Kr(t[u]),y=i[r=e[s+2]],C=e[s+3];"boolean"==typeof C?m.removeEventListener(e[s],y,C):C>=0?i[r=C]():i[r=-C].unsubscribe(),s+=2}else{const u=i[r=e[s+1]];e[s].call(u)}if(null!==i){for(let s=r+1;s<i.length;s++)(0,i[s])();t[7]=null}}(n,t),1===t[1].type&&t[11].destroy();const e=t[17];if(null!==e&&La(t[3])){e!==t[3]&&v0(e,t);const i=t[19];null!==i&&i.detachView(n)}!function Bl(n){dc.delete(n[20])}(t)}}function Js(n,t,e){return function x0(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===Ws.None||r===Ws.Emulated)return null}return Ns(i,e)}(n,t.parent,e)}function Qc(n,t,e,i,r){n.insertBefore(t,e,i,r)}function w0(n,t,e){n.appendChild(t,e)}function S0(n,t,e,i,r){null!==i?Qc(n,t,e,i,r):w0(n,t,e)}function Qd(n,t){return n.parentNode(t)}function Hu(n,t,e){return E0(n,t,e)}let $u,J_,E0=function hp(n,t,e){return 40&n.type?Ns(n,e):null};function Pg(n,t,e,i){const r=Js(n,i,t),s=t[11],m=Hu(i.parent||t[6],i,t);if(null!=r)if(Array.isArray(e))for(let y=0;y<e.length;y++)S0(s,r,e[y],m,!1);else S0(s,r,e,m,!1)}function Lg(n,t){if(null!==t){const e=t.type;if(3&e)return Ns(t,n);if(4&e)return Z_(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return Lg(n,i);{const r=n[t.index];return La(r)?Z_(-1,r):Kr(r)}}if(32&e)return Dg(t,n)()||Kr(n[t.index]);{const i=I0(n,t);return null!==i?Array.isArray(i)?i[0]:Lg(Kd(n[16]),i):Lg(n,t.next)}}return null}function I0(n,t){return null!==t?n[16][6].projection[t.projection]:null}function Z_(n,t){const e=10+n+1;if(e<t.length){const i=t[e],r=i[1].firstChild;if(null!==r)return Lg(i,r)}return t[7]}function Y_(n,t,e,i,r,s,u){for(;null!=e;){const m=i[e.index],y=e.type;if(u&&0===t&&(m&&Mo(Kr(m),i),e.flags|=4),64!=(64&e.flags))if(8&y)Y_(n,t,e.child,i,r,s,!1),dp(t,n,r,m,s);else if(32&y){const C=Dg(e,i);let I;for(;I=C();)dp(t,n,r,I,s);dp(t,n,r,m,s)}else 16&y?co(n,t,i,e,r,s):dp(t,n,r,m,s);e=u?e.projectionNext:e.next}}function pc(n,t,e,i,r,s){Y_(e,i,n.firstChild,t,r,s,!1)}function co(n,t,e,i,r,s){const u=e[16],y=u[6].projection[i.projection];if(Array.isArray(y))for(let C=0;C<y.length;C++)dp(t,n,r,y[C],s);else Y_(n,t,y,u[3],r,s,!0)}function Hf(n,t,e){n.setAttribute(t,"style",e)}function pp(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function qu(n){var t;return(null===(t=function Fg(){if(void 0===$u&&($u=null,Lr.trustedTypes))try{$u=Lr.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return $u}())||void 0===t?void 0:t.createHTML(n))||n}class fc{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class T1 extends fc{getTypeName(){return"HTML"}}class E1 extends fc{getTypeName(){return"Style"}}class D1 extends fc{getTypeName(){return"Script"}}class I1 extends fc{getTypeName(){return"URL"}}class M1 extends fc{getTypeName(){return"ResourceURL"}}function Ha(n){return n instanceof fc?n.changingThisBreaksApplicationSecurity:n}function $a(n,t){const e=function A1(n){return n instanceof fc&&n.getTypeName()||null}(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}class L0{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(qu(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class L1{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const i=this.inertDocument.createElement("body");e.appendChild(i)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=qu(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=qu(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const u=e.item(r).name;("xmlns:ns1"===u||0===u.indexOf("ns1:"))&&t.removeAttribute(u)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const F1=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;function gp(n){return(n=String(n)).match(F1)?n:"unsafe:"+n}function ml(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function Gu(...n){const t={};for(const e of n)for(const i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}const O0=ml("area,br,col,hr,img,wbr"),F0=ml("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),bp=ml("rp,rt"),Ug=Gu(O0,Gu(F0,ml("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Gu(bp,ml("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Gu(bp,F0)),ty=ml("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),ny=Gu(ty,ml("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ml("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),N0=ml("script,style,template");class B0{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!Ug.hasOwnProperty(e))return this.sanitizedSomething=!0,!N0.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let r=0;r<i.length;r++){const s=i.item(r),u=s.name,m=u.toLowerCase();if(!ny.hasOwnProperty(m)){this.sanitizedSomething=!0;continue}let y=s.value;ty[m]&&(y=gp(y)),this.buf.push(" ",u,'="',V0(y),'"')}return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();Ug.hasOwnProperty(e)&&!O0.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(V0(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const z0=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,V1=/([^\#-~ |!])/g;function V0(n){return n.replace(/&/g,"&amp;").replace(z0,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(V1,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Gf;function Wf(n,t){let e=null;try{Gf=Gf||function ey(n){const t=new L1(n);return function O1(){try{return!!(new window.DOMParser).parseFromString(qu(""),"text/html")}catch(n){return!1}}()?new L0(t):t}(n);let i=t?String(t):"";e=Gf.getInertBodyElement(i);let r=5,s=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=s,s=e.innerHTML,e=Gf.getInertBodyElement(i)}while(i!==s);return qu((new B0).sanitizeChildren(Hg(e)||e))}finally{if(e){const i=Hg(e)||e;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function Hg(n){return"content"in n&&function js(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var lr=(()=>((lr=lr||{})[lr.NONE=0]="NONE",lr[lr.HTML=1]="HTML",lr[lr.STYLE=2]="STYLE",lr[lr.SCRIPT=3]="SCRIPT",lr[lr.URL=4]="URL",lr[lr.RESOURCE_URL=5]="RESOURCE_URL",lr))();function _a(n){const t=function Zf(){const n=Pt();return n&&n[12]}();return t?t.sanitize(lr.URL,n)||"":$a(n,"URL")?Ha(n):gp(ri(n))}const $g=new It("ENVIRONMENT_INITIALIZER"),oy=new It("INJECTOR",-1),sy=new It("INJECTOR_DEF_TYPES");class j0{get(t,e=za){if(e===za){const i=new Error(`NullInjectorError: No provider for ${ji(t)}!`);throw i.name="NullInjectorError",i}return e}}function G1(...n){return{\u0275providers:U0(0,n)}}function U0(n,...t){const e=[],i=new Set;let r;return Wo(t,s=>{const u=s;ay(u,e,[],i)&&(r||(r=[]),r.push(u))}),void 0!==r&&H0(r,e),e}function H0(n,t){for(let e=0;e<n.length;e++){const{providers:r}=n[e];Wo(r,s=>{t.push(s)})}}function ay(n,t,e,i){if(!(n=qn(n)))return!1;let r=null,s=ol(n);const u=!s&&mr(n);if(s||u){if(u&&!u.standalone)return!1;r=n}else{const y=n.ngModule;if(s=ol(y),!s)return!1;r=y}const m=i.has(r);if(u){if(m)return!1;if(i.add(r),u.dependencies){const y="function"==typeof u.dependencies?u.dependencies():u.dependencies;for(const C of y)ay(C,t,e,i)}}else{if(!s)return!1;{if(null!=s.imports&&!m){let C;i.add(r);try{Wo(s.imports,I=>{ay(I,t,e,i)&&(C||(C=[]),C.push(I))})}finally{}void 0!==C&&H0(C,t)}if(!m){const C=pa(r)||(()=>new r);t.push({provide:r,useFactory:C,deps:Gi},{provide:sy,useValue:r,multi:!0},{provide:$g,useValue:()=>je(r),multi:!0})}const y=s.providers;null==y||m||Wo(y,I=>{t.push(I)})}}return r!==n&&void 0!==n.providers}const X1=Tn({provide:String,useValue:Tn});function Ao(n){return null!==n&&"object"==typeof n&&X1 in n}function mc(n){return"function"==typeof n}const ly=new It("Set Injector scope."),Gg={},Yf={};let cy;function Wg(){return void 0===cy&&(cy=new j0),cy}class Jc{}class uy extends Jc{constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,py(t,u=>this.processProvider(u)),this.records.set(oy,Jd(void 0,this)),r.has("environment")&&this.records.set(Jc,Jd(void 0,this));const s=this.records.get(ly);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(sy.multi,Gi,$n.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const e=Ts(this),i=Ls(void 0);try{return t()}finally{Ts(e),Ls(i)}}get(t,e=za,i=$n.Default){this.assertNotDestroyed();const r=Ts(this),s=Ls(void 0);try{if(!(i&$n.SkipSelf)){let m=this.records.get(t);if(void 0===m){const y=function $0(n){return"function"==typeof n||"object"==typeof n&&n instanceof It}(t)&&vu(t);m=y&&this.injectableDefInScope(y)?Jd(Xg(t),Gg):null,this.records.set(t,m)}if(null!=m)return this.hydrate(t,m)}return(i&$n.Self?Wg():this.parent).get(t,e=i&$n.Optional&&e===za?null:e)}catch(u){if("NullInjectorError"===u.name){if((u[Df]=u[Df]||[]).unshift(ji(t)),r)throw u;return function l0(n,t,e,i){const r=n[Df];throw t[lp]&&r.unshift(t[lp]),n.message=function c0(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=ji(t);if(Array.isArray(t))r=t.map(ji).join(" -> ");else if("object"==typeof t){let s=[];for(let u in t)if(t.hasOwnProperty(u)){let m=t[u];s.push(u+":"+("string"==typeof m?JSON.stringify(m):ji(m)))}r=`{${s.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${n.replace(Mf,"\n  ")}`}("\n"+n.message,r,e,i),n.ngTokenPath=r,n[Df]=null,n}(u,t,"R3InjectorError",this.source)}throw u}finally{Ls(s),Ts(r)}}resolveInjectorInitializers(){const t=Ts(this),e=Ls(void 0);try{const i=this.get($g.multi,Gi,$n.Self);for(const r of i)r()}finally{Ts(t),Ls(e)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(ji(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new zt(205,!1)}processProvider(t){let e=mc(t=qn(t))?t:qn(t&&t.provide);const i=function dy(n){return Ao(n)?Jd(void 0,n.useValue):Jd(hy(n),Gg)}(t);if(mc(t)||!0!==t.multi)this.records.get(e);else{let r=this.records.get(e);r||(r=Jd(void 0,Gg,!0),r.factory=()=>ja(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e){return e.value===Gg&&(e.value=Yf,e.value=e.factory()),"object"==typeof e.value&&e.value&&function vp(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=qn(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function Xg(n){const t=vu(n),e=null!==t?t.factory:pa(n);if(null!==e)return e;if(n instanceof It)throw new zt(204,!1);if(n instanceof Function)return function Mr(n){const t=n.length;if(t>0)throw $r(t,"?"),new zt(204,!1);const e=function sf(n){const t=n&&(n[tc]||n[Cd]);if(t){const e=function Nc(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new zt(204,!1)}function hy(n,t,e){let i;if(mc(n)){const r=qn(n);return pa(r)||Xg(r)}if(Ao(n))i=()=>qn(n.useValue);else if(function qg(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...ja(n.deps||[]));else if(function gl(n){return!(!n||!n.useExisting)}(n))i=()=>je(qn(n.useExisting));else{const r=qn(n&&(n.useClass||n.provide));if(!function eu(n){return!!n.deps}(n))return pa(r)||Xg(r);i=()=>new r(...ja(n.deps))}return i}function Jd(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function Z1(n){return!!n.\u0275providers}function py(n,t){for(const e of n)Array.isArray(e)?py(e,t):Z1(e)?py(e.\u0275providers,t):t(e)}class q0{}class Q1{resolveComponentFactory(t){throw function K1(n){const t=Error(`No component factory found for ${ji(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let eh=(()=>{class n{}return n.NULL=new Q1,n})();function Zg(){return zl(Io(),Pt())}function zl(n,t){return new En(Ns(n,t))}let En=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=Zg,n})();function Yg(n){return n instanceof En?n.nativeElement:n}class Kf{}let gc=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function J1(){const n=Pt(),e=Ss(Io().index,n);return(Os(e)?e:n)[11]}(),n})(),X0=(()=>{class n{}return n.\u0275prov=Qt({token:n,providedIn:"root",factory:()=>null}),n})();class tu{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const ea=new tu("14.3.0"),Qf={};function Qg(n){return n.ngOriginalError}class bl{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&Qg(t);for(;e&&Qg(e);)e=Qg(e);return e||null}}function bc(n){return n instanceof Function?n():n}function gy(n,t,e){let i=n.length;for(;;){const r=n.indexOf(t,e);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=t.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}e=r+1}}const by="ng-template";function oC(n,t,e){let i=0;for(;i<n.length;){let r=n[i++];if(e&&"class"===r){if(r=n[i],-1!==gy(r.toLowerCase(),t,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===t)return!0;return!1}}return!1}function Q0(n){return 4===n.type&&n.value!==by}function J0(n,t,e){return t===(4!==n.type||e?n.value:by)}function ex(n,t,e){let i=4;const r=n.attrs||[],s=function yy(n){for(let t=0;t<n.length;t++)if(xt(n[t]))return t;return n.length}(r);let u=!1;for(let m=0;m<t.length;m++){const y=t[m];if("number"!=typeof y){if(!u)if(4&i){if(i=2|1&i,""!==y&&!J0(n,y,e)||""===y&&1===t.length){if(ta(i))return!1;u=!0}}else{const C=8&i?y:t[++m];if(8&i&&null!==n.attrs){if(!oC(n.attrs,C,e)){if(ta(i))return!1;u=!0}continue}const A=tx(8&i?"class":y,r,Q0(n),e);if(-1===A){if(ta(i))return!1;u=!0;continue}if(""!==C){let B;B=A>s?"":r[A+1].toLowerCase();const j=8&i?B:null;if(j&&-1!==gy(j,C,0)||2&i&&C!==B){if(ta(i))return!1;u=!0}}}}else{if(!u&&!ta(i)&&!ta(y))return!1;if(u&&ta(y))continue;u=!1,i=y|1&i}}return ta(i)||u}function ta(n){return 0==(1&n)}function tx(n,t,e,i){if(null===t)return-1;let r=0;if(i||!e){let s=!1;for(;r<t.length;){const u=t[r];if(u===n)return r;if(3===u||6===u)s=!0;else{if(1===u||2===u){let m=t[++r];for(;"string"==typeof m;)m=t[++r];continue}if(4===u)break;if(0===u){r+=4;continue}}r+=s?1:2}return-1}return function wp(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function _y(n,t,e=!1){for(let i=0;i<t.length;i++)if(ex(n,t[i],e))return!0;return!1}function Sp(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function vy(n,t){return n?":not("+t.trim()+")":t}function eb(n){let t=n[0],e=1,i=2,r="",s=!1;for(;e<n.length;){let u=n[e];if("string"==typeof u)if(2&i){const m=n[++e];r+="["+u+(m.length>0?'="'+m+'"':"")+"]"}else 8&i?r+="."+u:4&i&&(r+=" "+u);else""!==r&&!ta(u)&&(t+=vy(s,r),r=""),i=u,s=s||!ta(i);e++}return""!==r&&(t+=vy(s,r)),t}const yi={};function ae(n){ix(ir(),Pt(),M()+n,!1)}function ix(n,t,e,i){if(!i)if(3==(3&t[2])){const s=n.preOrderCheckHooks;null!==s&&$(t,s,e)}else{const s=n.preOrderHooks;null!==s&&te(t,s,0,e)}R(e)}function ib(n,t=null,e=null,i){const r=sx(n,t,e,i);return r.resolveInjectorInitializers(),r}function sx(n,t=null,e=null,i,r=new Set){const s=[e||Gi,G1(n)];return i=i||("object"==typeof n?void 0:ji(n)),new uy(s,t||Wg(),i||null,r)}let Nr=(()=>{class n{static create(e,i){var r;if(Array.isArray(e))return ib({name:""},i,e,"");{const s=null!==(r=e.name)&&void 0!==r?r:"";return ib({name:s},e.parent,e.providers,s)}}}return n.THROW_IF_NOT_FOUND=za,n.NULL=new j0,n.\u0275prov=Qt({token:n,providedIn:"any",factory:()=>je(oy)}),n.__NG_ELEMENT_ID__=-1,n})();function H(n,t=$n.Default){const e=Pt();return null===e?je(n,t):Rr(Io(),e,qn(n),t)}function nu(){throw new Error("invalid")}function db(n,t){return n<<17|t<<2}function Ga(n){return n>>17&32767}function Sy(n){return 2|n}function jl(n){return(131068&n)>>2}function pb(n,t){return-131069&n|t<<2}function Cy(n){return 1|n}function ky(n,t){const e=n.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const r=e[i],s=e[i+1];if(-1!==s){const u=n.data[s];Ud(r),u.contentQueries(2,t[s],s)}}}function lh(n,t,e,i,r,s,u,m,y,C,I){const A=t.blueprint.slice();return A[0]=r,A[2]=76|i,(null!==I||n&&1024&n[2])&&(A[2]|=1024),gf(A),A[3]=A[15]=n,A[8]=e,A[10]=u||n&&n[10],A[11]=m||n&&n[11],A[12]=y||n&&n[12]||null,A[9]=C||n&&n[9]||null,A[6]=s,A[20]=function j_(){return xr++}(),A[21]=I,A[16]=2==t.type?n[16]:A,A}function ch(n,t,e,i,r){let s=n.data[t];if(null===s)s=function _b(n,t,e,i,r){const s=Zs(),u=Ys(),y=n.data[t]=function Oy(n,t,e,i,r,s){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,u?s:s&&s.parent,e,t,i,r);return null===n.firstChild&&(n.firstChild=y),null!==s&&(u?null==s.child&&null!==y.parent&&(s.child=y):null===s.next&&(s.next=y)),y}(n,t,e,i,r),function T_(){return pi.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=e,s.value=i,s.attrs=r;const u=function Ru(){const n=pi.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();s.injectorIndex=null===u?-1:u.injectorIndex}return ul(s,!0),s}function Ip(n,t,e,i){if(0===e)return-1;const r=t.length;for(let s=0;s<e;s++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function yb(n,t,e){ac(t);try{const i=n.viewQuery;null!==i&&Zn(1,i,e);const r=n.template;null!==r&&Ry(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&ky(n,t),n.staticViewQueries&&Zn(2,n.viewQuery,e);const s=n.components;null!==s&&function rm(n,t){for(let e=0;e<t.length;e++)Ot(n,t[e])}(t,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,x()}}function om(n,t,e,i){const r=t[2];if(128!=(128&r)){ac(t);try{gf(t),function sc(n){return pi.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&Ry(n,t,e,2,i);const u=3==(3&r);if(u){const C=n.preOrderCheckHooks;null!==C&&$(t,C,null)}else{const C=n.preOrderHooks;null!==C&&te(t,C,0,null),me(t,0)}if(function dt(n){for(let t=Ig(n);null!==t;t=Mg(t)){if(!t[2])continue;const e=t[9];for(let i=0;i<e.length;i++){const r=e[i],s=r[3];0==(512&r[2])&&jd(s,1),r[2]|=512}}}(t),function Ht(n){for(let t=Ig(n);null!==t;t=Mg(t))for(let e=10;e<t.length;e++){const i=t[e],r=i[1];oc(i)&&om(r,i,r.template,i[8])}}(t),null!==n.contentQueries&&ky(n,t),u){const C=n.contentCheckHooks;null!==C&&$(t,C)}else{const C=n.contentHooks;null!==C&&te(t,C,1),me(t,1)}!function ah(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)R(~r);else{const s=r,u=e[++i],m=e[++i];_f(u,s),m(2,t[s])}}}finally{R(-1)}}(n,t);const m=n.components;null!==m&&function gx(n,t){for(let e=0;e<t.length;e++)Mt(n,t[e])}(t,m);const y=n.viewQuery;if(null!==y&&Zn(2,y,i),u){const C=n.viewCheckHooks;null!==C&&$(t,C)}else{const C=n.viewHooks;null!==C&&te(t,C,2),me(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,jd(t[3],-1))}finally{x()}}}function Ry(n,t,e,i,r){const s=M(),u=2&i;try{R(-1),u&&t.length>22&&ix(n,t,22,!1),e(i,r)}finally{R(s)}}function bx(n,t,e){if(cf(t)){const r=t.directiveEnd;for(let s=t.directiveStart;s<r;s++){const u=n.data[s];u.contentQueries&&u.contentQueries(1,e[s],s)}}}function sm(n,t,e){!tp()||(function k(n,t,e,i){const r=e.directiveStart,s=e.directiveEnd;n.firstCreatePass||ao(e,t),Mo(i,t);const u=e.initialInputs;for(let m=r;m<s;m++){const y=n.data[m],C=Fs(y);C&&he(t,e,y);const I=Rl(t,n,m,e);Mo(I,t),null!==u&&Pe(0,m-r,I,y,0,u),C&&(Ss(e.index,t)[8]=I)}}(n,t,e,Ns(e,t)),128==(128&e.flags)&&function P(n,t,e){const i=e.directiveStart,r=e.directiveEnd,s=e.index,u=function sg(){return pi.lFrame.currentDirectiveIndex}();try{R(s);for(let m=i;m<r;m++){const y=n.data[m],C=t[m];rp(m),(null!==y.hostBindings||0!==y.hostVars||null!==y.hostAttrs)&&L(y,C)}}finally{R(-1),rp(u)}}(n,t,e))}function vb(n,t,e=Ns){const i=t.localNames;if(null!==i){let r=t.index+1;for(let s=0;s<i.length;s+=2){const u=i[s+1],m=-1===u?e(t,n):n[u];n[r++]=m}}}function Py(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=xb(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function xb(n,t,e,i,r,s,u,m,y,C){const I=22+i,A=I+r,B=function Ly(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:yi);return e}(I,A),j="function"==typeof C?C():C;return B[1]={type:n,blueprint:B,template:e,queries:null,viewQuery:m,declTNode:t,data:B.slice().fill(null,I),bindingStartIndex:I,expandoStartIndex:A,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof u?u():u,firstChild:null,schemas:y,consts:j,incompleteFirstPass:!1}}function Mp(n,t,e,i){const r=Pn(t);null===e?r.push(i):(r.push(e),n.firstCreatePass&&ei(n).push(i,r.length-1))}function Fy(n,t,e){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(t,r):e[i]=[t,r]}return e}function a(n,t){const i=t.directiveEnd,r=n.data,s=t.attrs,u=[];let m=null,y=null;for(let C=t.directiveStart;C<i;C++){const I=r[C],A=I.inputs,B=null===s||Q0(t)?null:at(A,s);u.push(B),m=Fy(A,C,m),y=Fy(I.outputs,C,y)}null!==m&&(m.hasOwnProperty("class")&&(t.flags|=16),m.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=u,t.inputs=m,t.outputs=y}function l(n,t,e,i,r,s,u,m){const y=Ns(t,e);let I,C=t.inputs;!m&&null!=C&&(I=C[i])?(Vn(n,e,I,i,r),Gh(t)&&d(e,t.index)):3&t.type&&(i=function o(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=u?u(r,t.value||"",i):r,s.setProperty(y,i,r))}function d(n,t){const e=Ss(t,n);16&e[2]||(e[2]|=32)}function w(n,t,e,i){let r=!1;if(tp()){const s=function N(n,t,e){const i=n.directiveRegistry;let r=null;if(i)for(let s=0;s<i.length;s++){const u=i[s];_y(e,u.selectors,!1)&&(r||(r=[]),ar(ao(e,t),n,u.type),Fs(u)?(z(n,e),r.unshift(u)):r.push(u))}return r}(n,t,e),u=null===i?null:{"":-1};if(null!==s){r=!0,de(e,n.data.length,s.length);for(let I=0;I<s.length;I++){const A=s[I];A.providersResolver&&A.providersResolver(A)}let m=!1,y=!1,C=Ip(n,t,s.length,null);for(let I=0;I<s.length;I++){const A=s[I];e.mergedAttrs=Rt(e.mergedAttrs,A.hostAttrs),De(n,e,t,C,A),ee(C,A,u),null!==A.contentQueries&&(e.flags|=8),(null!==A.hostBindings||null!==A.hostAttrs||0!==A.hostVars)&&(e.flags|=128);const B=A.type.prototype;!m&&(B.ngOnChanges||B.ngOnInit||B.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),m=!0),!y&&(B.ngOnChanges||B.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),y=!0),C++}a(n,e)}u&&function G(n,t,e){if(t){const i=n.localNames=[];for(let r=0;r<t.length;r+=2){const s=e[t[r+1]];if(null==s)throw new zt(-301,!1);i.push(t[r],s)}}}(e,i,u)}return e.mergedAttrs=Rt(e.mergedAttrs,e.attrs),r}function T(n,t,e,i,r,s){const u=s.hostBindings;if(u){let m=n.hostBindingOpCodes;null===m&&(m=n.hostBindingOpCodes=[]);const y=~t.index;(function E(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(m)!=y&&m.push(y),m.push(i,r,u)}}function L(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function z(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function ee(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;Fs(t)&&(e[""]=n)}}function de(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function De(n,t,e,i,r){n.data[i]=r;const s=r.factory||(r.factory=pa(r.type)),u=new Ne(s,Fs(r),H);n.blueprint[i]=u,e[i]=u,T(n,t,0,i,Ip(n,e,r.hostVars,yi),r)}function he(n,t,e){const i=Ns(t,n),r=Py(e),s=n[10],u=mt(n,lh(n,r,null,e.onPush?32:16,i,t,s,s.createRenderer(i,e),null,null,null));n[t.index]=u}function we(n,t,e,i,r,s){const u=Ns(n,t);!function Re(n,t,e,i,r,s,u){if(null==s)n.removeAttribute(t,r,e);else{const m=null==u?ri(s):u(s,i||"",r);n.setAttribute(t,r,m,e)}}(t[11],u,s,n.value,e,i,r)}function Pe(n,t,e,i,r,s){const u=s[t];if(null!==u){const m=i.setInput;for(let y=0;y<u.length;){const C=u[y++],I=u[y++],A=u[y++];null!==m?i.setInput(e,A,C,I):e[I]=A}}}function at(n,t){let e=null,i=0;for(;i<t.length;){const r=t[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===e&&(e=[]),e.push(r,n[r],t[i+1])),i+=2}else i+=2;else i+=4}return e}function yt(n,t,e,i){return new Array(n,!0,!1,t,null,0,i,e,null,null)}function Mt(n,t){const e=Ss(t,n);if(oc(e)){const i=e[1];48&e[2]?om(i,e,i.template,e[8]):e[5]>0&&Et(e)}}function Et(n){for(let i=Ig(n);null!==i;i=Mg(i))for(let r=10;r<i.length;r++){const s=i[r];if(oc(s))if(512&s[2]){const u=s[1];om(u,s,u.template,s[8])}else s[5]>0&&Et(s)}const e=n[1].components;if(null!==e)for(let i=0;i<e.length;i++){const r=Ss(e[i],n);oc(r)&&r[5]>0&&Et(r)}}function Ot(n,t){const e=Ss(t,n),i=e[1];(function Wt(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(i,e),yb(i,e,e[8])}function mt(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function an(n){for(;n;){n[2]|=32;const t=Kd(n);if(Du(n)&&!t)return n;n=t}return null}function gn(n,t,e,i=!0){const r=t[10];r.begin&&r.begin();try{om(n,t,n.template,e)}catch(u){throw i&&ti(t,u),u}finally{r.end&&r.end()}}function Zn(n,t,e){Ud(0),t(n,e)}function Pn(n){return n[7]||(n[7]=[])}function ei(n){return n.cleanup||(n.cleanup=[])}function Hi(n,t,e){return(null===n||Fs(n))&&(e=function Au(n){for(;Array.isArray(n);){if("object"==typeof n[1])return n;n=n[0]}return null}(e[t.index])),e[11]}function ti(n,t){const e=n[9],i=e?e.get(bl,null):null;i&&i.handleError(t)}function Vn(n,t,e,i,r){for(let s=0;s<e.length;){const u=e[s++],m=e[s++],y=t[u],C=n.data[u];null!==C.setInput?C.setInput(y,r,i,m):y[m]=r}}function Wi(n,t,e){const i=Jh(t,n);!function jf(n,t,e){n.setValue(t,e)}(n[11],i,e)}function Yn(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,s=0;if(null!==t)for(let u=0;u<t.length;u++){const m=t[u];"number"==typeof m?s=m:1==s?r=bi(r,m):2==s&&(i=bi(i,m+": "+t[++u]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function Kn(n,t,e,i,r=!1){for(;null!==e;){const s=t[e.index];if(null!==s&&i.push(Kr(s)),La(s))for(let m=10;m<s.length;m++){const y=s[m],C=y[1].firstChild;null!==C&&Kn(y[1],y,C,i)}const u=e.type;if(8&u)Kn(n,t,e.child,i);else if(32&u){const m=Dg(e,t);let y;for(;y=m();)i.push(y)}else if(16&u){const m=I0(t,e);if(Array.isArray(m))i.push(...m);else{const y=Kd(t[16]);Kn(y[1],y,m,i,!0)}}e=r?e.projectionNext:e.next}return i}class or{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return Kn(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(La(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(kg(t,i),ug(e,i))}this._attachedToViewContainer=!1}G_(this._lView[1],this._lView)}onDestroy(t){Mp(this._lView[1],this._lView,null,t)}markForCheck(){an(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){gn(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new zt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function _0(n,t){pc(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new zt(902,!1);this._appRef=t}}class Ar extends or{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;gn(t[1],t,t[8],!1)}checkNoChanges(){}get context(){return null}}class br extends eh{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=mr(t);return new Gr(e,this.ngModule)}}function _r(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}class Qr{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){const r=this.injector.get(t,Qf,i);return r!==Qf||e===Qf?r:this.parentInjector.get(t,e,i)}}class Gr extends q0{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function nx(n){return n.map(eb).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return _r(this.componentDef.inputs)}get outputs(){return _r(this.componentDef.outputs)}create(t,e,i,r){let s=(r=r||this.ngModule)instanceof Jc?r:null==r?void 0:r.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const u=s?new Qr(t,s):t,m=u.get(Kf,null);if(null===m)throw new zt(407,!1);const y=u.get(X0,null),C=m.createRenderer(null,this.componentDef),I=this.componentDef.selectors[0][0]||"div",A=i?function yx(n,t,e){return n.selectRootElement(t,e===Ws.ShadowDom)}(C,i,this.componentDef.encapsulation):Ag(C,I,function qr(n){const t=n.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(I)),B=this.componentDef.onPush?288:272,j=xb(0,null,null,1,0,null,null,null,null,null),K=lh(null,j,null,B,null,null,m,C,y,u,null);let pe,Se;ac(K);try{const Xe=function Ji(n,t,e,i,r,s){const u=e[1];e[22]=n;const y=ch(u,22,2,"#host",null),C=y.mergedAttrs=t.hostAttrs;null!==C&&(Yn(y,C,!0),null!==n&&(it(r,n,C),null!==y.classes&&pp(r,n,y.classes),null!==y.styles&&Hf(r,n,y.styles)));const I=i.createRenderer(n,t),A=lh(e,Py(t),null,t.onPush?32:16,e[22],y,i,I,s||null,null,null);return u.firstCreatePass&&(ar(ao(y,e),u,t.type),z(u,y),de(y,e.length,1)),mt(e,A),e[22]=A}(A,this.componentDef,K,m,C);if(A)if(i)it(C,A,["ng-version",ea.full]);else{const{attrs:At,classes:pt}=function tb(n){const t=[],e=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&t.push(s,n[++i]):8===r&&e.push(s);else{if(!ta(r))break;r=s}i++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);At&&it(C,A,At),pt&&pt.length>0&&pp(C,A,pt.join(" "))}if(Se=zd(j,22),void 0!==e){const At=Se.projection=[];for(let pt=0;pt<this.ngContentSelectors.length;pt++){const kt=e[pt];At.push(null!=kt?Array.from(kt):null)}}pe=function _o(n,t,e,i){const r=e[1],s=function v(n,t,e){const i=Io();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),De(n,i,t,Ip(n,t,1,null),e),a(n,i));const r=Rl(t,n,i.directiveStart,i);Mo(r,t);const s=Ns(i,t);return s&&Mo(s,t),r}(r,e,t);if(n[8]=e[8]=s,null!==i)for(const m of i)m(s,t);if(t.contentQueries){const m=Io();t.contentQueries(1,s,m.directiveStart)}const u=Io();return!r.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(R(u.index),T(e[1],u,0,u.directiveStart,u.directiveEnd,t),L(t,s)),s}(Xe,this.componentDef,K,[kr]),yb(j,K,null)}finally{x()}return new bo(this.componentType,pe,zl(Se,K),K,Se)}}class bo extends class Y1{}{constructor(t,e,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=e,this.hostView=this.changeDetectorRef=new Ar(r),this.componentType=t}setInput(t,e){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[t])){const s=this._rootLView;Vn(s[1],s,r,t,e),d(s,this._tNode.index)}}get injector(){return new Ol(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function kr(){const n=Io();ue(Pt()[1],n)}function Xt(n){let t=function Es(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let r;if(Fs(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new zt(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);const u=n;u.inputs=Co(n.inputs),u.declaredInputs=Co(n.declaredInputs),u.outputs=Co(n.outputs);const m=r.hostBindings;m&&Hl(n,m);const y=r.viewQuery,C=r.contentQueries;if(y&&Us(n,y),C&&No(n,C),_s(n.inputs,r.inputs),_s(n.declaredInputs,r.declaredInputs),_s(n.outputs,r.outputs),Fs(r)&&r.data.animation){const I=n.data;I.animation=(I.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let u=0;u<s.length;u++){const m=s[u];m&&m.ngInherit&&m(n),m===Xt&&(e=!1)}}t=Object.getPrototypeOf(t)}!function Zo(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=Rt(r.hostAttrs,e=Rt(e,r.hostAttrs))}}(i)}function Co(n){return n===Dl?{}:n===Gi?[]:n}function Us(n,t){const e=n.viewQuery;n.viewQuery=e?(i,r)=>{t(i,r),e(i,r)}:t}function No(n,t){const e=n.contentQueries;n.contentQueries=e?(i,r,s)=>{t(i,r,s),e(i,r,s)}:t}function Hl(n,t){const e=n.hostBindings;n.hostBindings=e?(i,r)=>{t(i,r),e(i,r)}:t}let cm=null;function Ju(){if(!cm){const n=Lr.Symbol;if(n&&n.iterator)cm=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(cm=i)}}}return cm}function kp(n){return!!yl(n)&&(Array.isArray(n)||!(n instanceof Map)&&Ju()in n)}function yl(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Hs(n,t,e){return n[t]=e}function ls(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function ya(n,t,e,i){const r=ls(n,t,e);return ls(n,t+1,i)||r}function fn(n,t,e,i){const r=Pt();return ls(r,sn(),t)&&(ir(),we(O(),r,n,t,e,i)),fn}function Sc(n,t,e,i){return ls(n,sn(),e)?t+ri(e)+i:yi}function xl(n,t,e,i,r,s,u,m,y,C){const A=function vl(n,t,e,i,r,s){const u=ya(n,t,e,i);return ya(n,t+2,r,s)||u}(n,Bs(),e,r,u,y);return Na(4),A?t+ri(e)+i+ri(r)+s+ri(u)+m+ri(y)+C:yi}function ft(n,t,e,i,r,s,u,m){const y=Pt(),C=ir(),I=n+22,A=C.firstCreatePass?function fB(n,t,e,i,r,s,u,m,y){const C=t.consts,I=ch(t,n,4,u||null,cl(C,m));w(t,e,I,cl(C,y)),ue(t,I);const A=I.tViews=xb(2,I,i,r,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,C);return null!==t.queries&&(t.queries.template(t,I),A.queries=t.queries.embeddedTView(I)),I}(I,C,y,t,e,i,r,s,u):C.data[I];ul(A,!1);const B=y[11].createComment("");Pg(C,y,B,A),Mo(B,y),mt(y,y[I]=yt(B,y,B,A)),Rd(A)&&sm(C,y,A),null!=u&&vb(y,A,m)}function va(n){return rc(function np(){return pi.lFrame.contextLView}(),22+n)}function Le(n,t,e){const i=Pt();return ls(i,sn(),t)&&l(ir(),O(),i,n,t,i[11],e,!1),Le}function EC(n,t,e,i,r){const u=r?"class":"style";Vn(n,e,t.inputs[u],u,i)}function X(n,t,e,i){const r=Pt(),s=ir(),u=22+n,m=r[11],y=r[u]=Ag(m,t,function le(){return pi.lFrame.currentNamespace}()),C=s.firstCreatePass?function gB(n,t,e,i,r,s,u){const m=t.consts,C=ch(t,n,2,r,cl(m,s));return w(t,e,C,cl(m,u)),null!==C.attrs&&Yn(C,C.attrs,!1),null!==C.mergedAttrs&&Yn(C,C.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,C),C}(u,s,r,0,t,e,i):s.data[u];ul(C,!0);const I=C.mergedAttrs;null!==I&&it(m,y,I);const A=C.classes;null!==A&&pp(m,y,A);const B=C.styles;return null!==B&&Hf(m,y,B),64!=(64&C.flags)&&Pg(s,r,y,C),0===function ng(){return pi.lFrame.elementDepthCount}()&&Mo(y,r),function C_(){pi.lFrame.elementDepthCount++}(),Rd(C)&&(sm(s,r,C),bx(s,C,r)),null!==i&&vb(r,C),X}function Y(){let n=Io();Ys()?ma():(n=n.parent,ul(n,!1));const t=n;!function ig(){pi.lFrame.elementDepthCount--}();const e=ir();return e.firstCreatePass&&(ue(e,n),cf(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function nt(n){return 0!=(16&n.flags)}(t)&&EC(e,t,Pt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Tt(n){return 0!=(32&n.flags)}(t)&&EC(e,t,Pt(),t.stylesWithoutHost,!1),Y}function en(n,t,e,i){return X(n,t,e,i),Y(),en}function na(n,t,e){const i=Pt(),r=ir(),s=n+22,u=r.firstCreatePass?function bB(n,t,e,i,r){const s=t.consts,u=cl(s,i),m=ch(t,n,8,"ng-container",u);return null!==u&&Yn(m,u,!0),w(t,e,m,cl(s,r)),null!==t.queries&&t.queries.elementStart(t,m),m}(s,r,i,t,e):r.data[s];ul(u,!0);const m=i[s]=i[11].createComment("");return Pg(r,i,m,u),Mo(m,i),Rd(u)&&(sm(r,i,u),bx(r,u,i)),null!=e&&vb(i,u),na}function ia(){let n=Io();const t=ir();return Ys()?ma():(n=n.parent,ul(n,!1)),t.firstCreatePass&&(ue(t,n),cf(n)&&t.queries.elementEnd(n)),ia}function ra(n,t,e){return na(n,t,e),ia(),ra}function zr(){return Pt()}function zy(n){return!!n&&"function"==typeof n.then}function cM(n){return!!n&&"function"==typeof n.subscribe}const DC=cM;function Ft(n,t,e,i){const r=Pt(),s=ir(),u=Io();return uM(s,r,r[11],u,n,t,0,i),Ft}function Vy(n,t){const e=Io(),i=Pt(),r=ir();return uM(r,i,Hi(yf(r.data),e,i),e,n,t),Vy}function uM(n,t,e,i,r,s,u,m){const y=Rd(i),I=n.firstCreatePass&&ei(n),A=t[8],B=Pn(t);let j=!0;if(3&i.type||m){const Se=Ns(i,t),Xe=m?m(Se):Se,At=B.length,pt=m?yn=>m(Kr(yn[i.index])):i.index;let kt=null;if(!m&&y&&(kt=function _B(n,t,e,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const u=r[s];if(u===e&&r[s+1]===i){const m=t[7],y=r[s+2];return m.length>y?m[y]:null}"string"==typeof u&&(s+=2)}return null}(n,t,r,i.index)),null!==kt)(kt.__ngLastListenerFn__||kt).__ngNextListenerFn__=s,kt.__ngLastListenerFn__=s,j=!1;else{s=hM(i,t,A,s,!1);const yn=e.listen(Xe,r,s);B.push(s,yn),I&&I.push(r,pt,At,At+1)}}else s=hM(i,t,A,s,!1);const K=i.outputs;let pe;if(j&&null!==K&&(pe=K[r])){const Se=pe.length;if(Se)for(let Xe=0;Xe<Se;Xe+=2){const kn=t[pe[Xe]][pe[Xe+1]].subscribe(s),Si=B.length;B.push(s,kn),I&&I.push(r,i.index,Si,-(Si+1))}}}function dM(n,t,e,i){try{return!1!==e(i)}catch(r){return ti(n,r),!1}}function hM(n,t,e,i,r){return function s(u){if(u===Function)return i;an(2&n.flags?Ss(n.index,t):t);let y=dM(t,0,i,u),C=s.__ngNextListenerFn__;for(;C;)y=dM(t,0,C,u)&&y,C=C.__ngNextListenerFn__;return r&&!1===y&&(u.preventDefault(),u.returnValue=!1),y}}function St(n=1){return function S(n){return(pi.lFrame.contextLView=function D(n,t){for(;n>0;)t=t[15],n--;return t}(n,pi.lFrame.contextLView))[8]}(n)}function yB(n,t){let e=null;const i=function Vl(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(n);for(let r=0;r<t.length;r++){const s=t[r];if("*"!==s){if(null===i?_y(n,s,!0):Sp(i,s))return r}else e=r}return e}function Ro(n){const t=Pt()[16][6];if(!t.projection){const i=t.projection=$r(n?n.length:1,null),r=i.slice();let s=t.child;for(;null!==s;){const u=n?yB(s,n):0;null!==u&&(r[u]?r[u].projectionNext=s:i[u]=s,r[u]=s),s=s.next}}}function Pr(n,t=0,e){const i=Pt(),r=ir(),s=ch(r,22+n,16,null,e||null);null===s.projection&&(s.projection=t),ma(),64!=(64&s.flags)&&function C1(n,t,e){co(t[11],0,t,e,Js(n,e,t),Hu(e.parent||t[6],e,t))}(r,i,s)}function oa(n,t,e){return IC(n,"",t,"",e),oa}function IC(n,t,e,i,r){const s=Pt(),u=Sc(s,t,e,i);return u!==yi&&l(ir(),O(),s,n,u,s[11],r,!1),IC}function xM(n,t,e,i,r){const s=n[e+1],u=null===t;let m=i?Ga(s):jl(s),y=!1;for(;0!==m&&(!1===y||u);){const I=n[m+1];wB(n[m],t)&&(y=!0,n[m+1]=i?Cy(I):Sy(I)),m=i?Ga(I):jl(I)}y&&(n[e+1]=i?Sy(s):Cy(s))}function wB(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&pl(n,t)>=0}function td(n,t,e){return ou(n,t,e,!1),td}function Li(n,t){return ou(n,t,null,!0),Li}function ou(n,t,e,i){const r=Pt(),s=ir(),u=Na(2);s.firstUpdatePass&&function MM(n,t,e,i){const r=n.data;if(null===r[e+1]){const s=r[M()],u=function IM(n,t){return t>=n.expandoStartIndex}(n,e);(function PM(n,t){return 0!=(n.flags&(t?16:32))})(s,i)&&null===t&&!u&&(t=!1),t=function kB(n,t,e,i){const r=yf(n);let s=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(e=jy(e=MC(null,n,t,e,i),t.attrs,i),s=null);else{const u=t.directiveStylingLast;if(-1===u||n[u]!==r)if(e=MC(r,n,t,e,i),null===s){let y=function RB(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==jl(i))return n[Ga(i)]}(n,t,i);void 0!==y&&Array.isArray(y)&&(y=MC(null,n,t,y[1],i),y=jy(y,t.attrs,i),function PB(n,t,e,i){n[Ga(e?t.classBindings:t.styleBindings)]=i}(n,t,i,y))}else s=function LB(n,t,e){let i;const r=t.directiveEnd;for(let s=1+t.directiveStylingLast;s<r;s++)i=jy(i,n[s].hostAttrs,e);return jy(i,t.attrs,e)}(n,t,i)}return void 0!==s&&(i?t.residualClasses=s:t.residualStyles=s),e}(r,s,t,i),function vB(n,t,e,i,r,s){let u=s?t.classBindings:t.styleBindings,m=Ga(u),y=jl(u);n[i]=e;let I,C=!1;if(Array.isArray(e)){const A=e;I=A[1],(null===I||pl(A,I)>0)&&(C=!0)}else I=e;if(r)if(0!==y){const B=Ga(n[m+1]);n[i+1]=db(B,m),0!==B&&(n[B+1]=pb(n[B+1],i)),n[m+1]=function Zu(n,t){return 131071&n|t<<17}(n[m+1],i)}else n[i+1]=db(m,0),0!==m&&(n[m+1]=pb(n[m+1],i)),m=i;else n[i+1]=db(y,0),0===m?m=i:n[y+1]=pb(n[y+1],i),y=i;C&&(n[i+1]=Sy(n[i+1])),xM(n,I,i,!0),xM(n,I,i,!1),function xB(n,t,e,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof t&&pl(s,t)>=0&&(e[i+1]=Cy(e[i+1]))}(t,I,n,i,s),u=db(m,y),s?t.classBindings=u:t.styleBindings=u}(r,s,t,e,u,i)}}(s,n,u,i),t!==yi&&ls(r,u,t)&&function kM(n,t,e,i,r,s,u,m){if(!(3&t.type))return;const y=n.data,C=y[m+1];xx(function tm(n){return 1==(1&n)}(C)?RM(y,t,e,r,jl(C),u):void 0)||(xx(s)||function hb(n){return 2==(2&n)}(C)&&(s=RM(y,null,e,r,m,u)),function M0(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let s=-1===i.indexOf("-")?void 0:Qs.DashCase;null==r?n.removeStyle(e,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=Qs.Important),n.setStyle(e,i,r,s))}}(i,u,Jh(M(),e),r,s))}(s,s.data[M()],r,r[11],n,r[u+1]=function NB(n,t){return null==n||("string"==typeof t?n+=t:"object"==typeof n&&(n=ji(Ha(n)))),n}(t,e),i,u)}function MC(n,t,e,i,r){let s=null;const u=e.directiveEnd;let m=e.directiveStylingLast;for(-1===m?m=e.directiveStart:m++;m<u&&(s=t[m],i=jy(i,s.hostAttrs,r),s!==n);)m++;return null!==n&&(e.directiveStylingLast=m),i}function jy(n,t,e){const i=e?1:2;let r=-1;if(null!==t)for(let s=0;s<t.length;s++){const u=t[s];"number"==typeof u?r=u:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),go(n,u,!!e||t[++s]))}return void 0===n?null:n}function RM(n,t,e,i,r,s){const u=null===t;let m;for(;r>0;){const y=n[r],C=Array.isArray(y),I=C?y[1]:y,A=null===I;let B=e[r+1];B===yi&&(B=A?Gi:void 0);let j=A?Cf(B,i):I===i?B:void 0;if(C&&!xx(j)&&(j=Cf(y,i)),xx(j)&&(m=j,u))return m;const K=n[r+1];r=u?Ga(K):jl(K)}if(null!==t){let y=s?t.residualClasses:t.residualStyles;null!=y&&(m=Cf(y,i))}return m}function xx(n){return void 0!==n}function Ce(n,t=""){const e=Pt(),i=ir(),r=n+22,s=i.firstCreatePass?ch(i,r,1,t,null):i.data[r],u=e[r]=function Uu(n,t){return n.createText(t)}(e[11],t);Pg(i,e,u,s),ul(s,!1)}function An(n){return wi("",n,""),An}function wi(n,t,e){const i=Pt(),r=Sc(i,n,t,e);return r!==yi&&Wi(i,M(),r),wi}function wx(n,t,e,i,r){const s=Pt(),u=function ed(n,t,e,i,r,s){const m=ya(n,Bs(),e,r);return Na(2),m?t+ri(e)+i+ri(r)+s:yi}(s,n,t,e,i,r);return u!==yi&&Wi(s,M(),u),wx}function AC(n,t,e,i,r,s,u,m,y){const C=Pt(),I=xl(C,n,t,e,i,r,s,u,m,y);return I!==yi&&Wi(C,M(),I),AC}function Cc(n,t,e){const i=Pt();return ls(i,sn(),t)&&l(ir(),O(),i,n,t,i[11],e,!0),Cc}function Uy(n,t,e){const i=Pt();if(ls(i,sn(),t)){const s=ir(),u=O();l(s,u,i,n,t,Hi(yf(s.data),u,i),e,!0)}return Uy}const um=void 0;var r3=["en",[["a","p"],["AM","PM"],um],[["AM","PM"],um,um],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],um,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],um,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",um,"{1} 'at' {0}",um],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function n3(n){const e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let Db={};function Wa(n){const t=function o3(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=YM(t);if(e)return e;const i=t.split("-")[0];if(e=YM(i),e)return e;if("en"===i)return r3;throw new zt(701,!1)}function YM(n){return n in Db||(Db[n]=Lr.ng&&Lr.ng.common&&Lr.ng.common.locales&&Lr.ng.common.locales[n]),Db[n]}var In=(()=>((In=In||{})[In.LocaleId=0]="LocaleId",In[In.DayPeriodsFormat=1]="DayPeriodsFormat",In[In.DayPeriodsStandalone=2]="DayPeriodsStandalone",In[In.DaysFormat=3]="DaysFormat",In[In.DaysStandalone=4]="DaysStandalone",In[In.MonthsFormat=5]="MonthsFormat",In[In.MonthsStandalone=6]="MonthsStandalone",In[In.Eras=7]="Eras",In[In.FirstDayOfWeek=8]="FirstDayOfWeek",In[In.WeekendRange=9]="WeekendRange",In[In.DateFormat=10]="DateFormat",In[In.TimeFormat=11]="TimeFormat",In[In.DateTimeFormat=12]="DateTimeFormat",In[In.NumberSymbols=13]="NumberSymbols",In[In.NumberFormats=14]="NumberFormats",In[In.CurrencyCode=15]="CurrencyCode",In[In.CurrencySymbol=16]="CurrencySymbol",In[In.CurrencyName=17]="CurrencyName",In[In.Currencies=18]="Currencies",In[In.Directionality=19]="Directionality",In[In.PluralCase=20]="PluralCase",In[In.ExtraData=21]="ExtraData",In))();const Ib="en-US";let KM=Ib;function PC(n,t,e,i,r){if(n=qn(n),Array.isArray(n))for(let s=0;s<n.length;s++)PC(n[s],t,e,i,r);else{const s=ir(),u=Pt();let m=mc(n)?n:qn(n.provide),y=hy(n);const C=Io(),I=1048575&C.providerIndexes,A=C.directiveStart,B=C.providerIndexes>>20;if(mc(n)||!n.multi){const j=new Ne(y,r,H),K=OC(m,t,r?I:I+B,A);-1===K?(ar(ao(C,u),s,m),LC(s,n,t.length),t.push(m),C.directiveStart++,C.directiveEnd++,r&&(C.providerIndexes+=1048576),e.push(j),u.push(j)):(e[K]=j,u[K]=j)}else{const j=OC(m,t,I+B,A),K=OC(m,t,I,I+B),pe=j>=0&&e[j],Se=K>=0&&e[K];if(r&&!Se||!r&&!pe){ar(ao(C,u),s,m);const Xe=function nz(n,t,e,i,r){const s=new Ne(n,e,H);return s.multi=[],s.index=t,s.componentProviders=0,wA(s,r,i&&!e),s}(r?tz:ez,e.length,r,i,y);!r&&Se&&(e[K].providerFactory=Xe),LC(s,n,t.length,0),t.push(m),C.directiveStart++,C.directiveEnd++,r&&(C.providerIndexes+=1048576),e.push(Xe),u.push(Xe)}else LC(s,n,j>-1?j:K,wA(e[r?K:j],y,!r&&i));!r&&i&&Se&&e[K].componentProviders++}}}function LC(n,t,e,i){const r=mc(t),s=function yp(n){return!!n.useClass}(t);if(r||s){const y=(s?qn(t.useClass):t).prototype.ngOnDestroy;if(y){const C=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){const I=C.indexOf(e);-1===I?C.push(e,[i,y]):C[I+1].push(i,y)}else C.push(e,y)}}}function wA(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function OC(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function ez(n,t,e,i){return FC(this.multi,[])}function tz(n,t,e,i){const r=this.multi;let s;if(this.providerFactory){const u=this.providerFactory.componentProviders,m=Rl(e,e[1],this.providerFactory.index,i);s=m.slice(0,u),FC(r,s);for(let y=u;y<m.length;y++)s.push(m[y])}else s=[],FC(r,s);return s}function FC(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function Un(n,t=[]){return e=>{e.providersResolver=(i,r)=>function J3(n,t,e){const i=ir();if(i.firstCreatePass){const r=Fs(n);PC(e,i.data,i.blueprint,r,!0),PC(t,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,t)}}class dm{}class SA{}class CA extends dm{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new br(this);const i=xs(t);this._bootstrapComponents=bc(i.bootstrap),this._r3Injector=sx(t,e,[{provide:dm,useValue:this},{provide:eh,useValue:this.componentFactoryResolver}],ji(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class NC extends SA{constructor(t){super(),this.moduleType=t}create(t){return new CA(this.moduleType,t)}}class rz extends dm{constructor(t,e,i){super(),this.componentFactoryResolver=new br(this),this.instance=null;const r=new uy([...t,{provide:dm,useValue:this},{provide:eh,useValue:this.componentFactoryResolver}],e||Wg(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function Dx(n,t,e=null){return new rz(n,t,e).injector}let oz=(()=>{class n{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e.id)){const i=U0(0,e.type),r=i.length>0?Dx([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e.id,r)}return this.cachedInjectors.get(e.id)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=Qt({token:n,providedIn:"environment",factory:()=>new n(je(Jc))}),n})();function TA(n){n.getStandaloneInjector=t=>t.get(oz).getOrCreateStandaloneInjector(n)}function PA(n,t,e,i,r){return function OA(n,t,e,i,r,s,u){const m=t+e;return ya(n,m,r,s)?Hs(n,m+2,u?i.call(u,r,s):i(r,s)):Xy(n,m+2)}(Pt(),$o(),n,t,e,i,r)}function Xy(n,t){const e=n[t];return e===yi?void 0:e}function LA(n,t,e,i,r,s){const u=t+e;return ls(n,u,r)?Hs(n,u+1,s?i.call(s,r):i(r)):Xy(n,u+1)}function Mb(n,t){const e=ir();let i;const r=n+22;e.firstCreatePass?(i=function wz(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(r,i.onDestroy)):i=e.data[r];const s=i.factory||(i.factory=pa(i.type)),u=Ls(H);try{const m=ai(!1),y=s();return ai(m),function mB(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,Pt(),r,y),y}finally{Ls(u)}}function Ab(n,t,e){const i=n+22,r=Pt(),s=rc(r,i);return function Zy(n,t){return n[1].data[t].pure}(r,i)?LA(r,$o(),t,s.transform,e,s):s.transform(e)}function zC(n){return t=>{setTimeout(n,void 0,t)}}const tn=class Dz extends Kt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var r,s,u;let m=t,y=e||(()=>null),C=i;if(t&&"object"==typeof t){const A=t;m=null===(r=A.next)||void 0===r?void 0:r.bind(A),y=null===(s=A.error)||void 0===s?void 0:s.bind(A),C=null===(u=A.complete)||void 0===u?void 0:u.bind(A)}this.__isAsync&&(y=zC(y),m&&(m=zC(m)),C&&(C=zC(C)));const I=super.subscribe({next:m,error:y,complete:C});return t instanceof ie&&t.add(I),I}};function Iz(){return this._results[Ju()]()}class hm{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Ju(),i=hm.prototype;i[e]||(i[e]=Iz)}get changes(){return this._changes||(this._changes=new tn)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const r=ba(t);(this._changesDetected=!function r0(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=t[i];if(e&&(r=e(r),s=e(s)),s!==r)return!1}return!0}(i._results,r,e))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let eo=(()=>{class n{}return n.__NG_ELEMENT_ID__=kz,n})();const Mz=eo,Az=class extends Mz{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t,e){const i=this._declarationTContainer.tViews,r=lh(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,e||null);r[17]=this._declarationLView[this._declarationTContainer.index];const u=this._declarationLView[19];return null!==u&&(r[19]=u.createEmbeddedView(i)),yb(i,r,t),new or(r)}};function kz(){return Ix(Io(),Pt())}function Ix(n,t){return 4&n.type?new Az(t,n,zl(n,t)):null}let zo=(()=>{class n{}return n.__NG_ELEMENT_ID__=Rz,n})();function Rz(){return jA(Io(),Pt())}const Pz=zo,zA=class extends Pz{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return zl(this._hostTNode,this._hostLView)}get injector(){return new Ol(this._hostTNode,this._hostLView)}get parentInjector(){const t=Ir(this._hostTNode,this._hostLView);if(Mn(t)){const e=Rn(t,this._hostLView),i=jn(t);return new Ol(e[1].data[i+8],e)}return new Ol(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=VA(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const u=t.createEmbeddedView(e||{},s);return this.insert(u,r),u}createComponent(t,e,i,r,s){const u=t&&!function Sf(n){return"function"==typeof n}(t);let m;if(u)m=e;else{const A=e||{};m=A.index,i=A.injector,r=A.projectableNodes,s=A.environmentInjector||A.ngModuleRef}const y=u?t:new Gr(mr(t)),C=i||this.parentInjector;if(!s&&null==y.ngModule){const B=(u?C:this.parentInjector).get(Jc,null);B&&(s=B)}const I=y.create(C,r,void 0,s);return this.insert(I.hostView,m),I}insert(t,e){const i=t._lView,r=i[1];if(function Vd(n){return La(n[3])}(i)){const I=this.indexOf(t);if(-1!==I)this.detach(I);else{const A=i[3],B=new zA(A,A[6],A[3]);B.detach(B.indexOf(t))}}const s=this._adjustIndex(e),u=this._lContainer;!function y0(n,t,e,i){const r=10+i,s=e.length;i>0&&(e[r-1][4]=t),i<s-10?(t[4]=e[r],o0(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const u=t[17];null!==u&&e!==u&&function w1(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(u,t);const m=t[19];null!==m&&m.insertView(n),t[2]|=64}(r,i,u,s);const m=Z_(s,u),y=i[11],C=Qd(y,u[7]);return null!==C&&function v1(n,t,e,i,r,s){i[0]=r,i[6]=t,pc(n,i,e,1,r,s)}(r,u[6],y,i,C,m),t.attachToViewContainerRef(),o0(VC(u),s,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=VA(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=kg(this._lContainer,e);i&&(ug(VC(this._lContainer),e),G_(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=kg(this._lContainer,e);return i&&null!=ug(VC(this._lContainer),e)?new or(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function VA(n){return n[8]}function VC(n){return n[8]||(n[8]=[])}function jA(n,t){let e;const i=t[n.index];if(La(i))e=i;else{let r;if(8&n.type)r=Kr(i);else{const s=t[11];r=s.createComment("");const u=Ns(n,t);Qc(s,Qd(s,u),r,function T0(n,t){return n.nextSibling(t)}(s,u),!1)}t[n.index]=e=yt(i,t,r,n),mt(t,e)}return new zA(e,n,t)}class jC{constructor(t){this.queryList=t,this.matches=null}clone(){return new jC(this.queryList)}setDirty(){this.queryList.setDirty()}}class UC{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let s=0;s<i;s++){const u=e.getByIndex(s);r.push(this.queries[u.indexInDeclarationView].clone())}return new UC(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==GA(t,e).matches&&this.queries[e].setDirty()}}class UA{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class HC{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,s=this.getByIndex(i).embeddedTView(t,r);s&&(s.indexInDeclarationView=i,null!==e?e.push(s):e=[s])}return null!==e?new HC(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class $C{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new $C(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(t,e,Fz(e,s)),this.matchTNodeWithReadOption(t,e,dl(e,t,s,!1,!1))}else i===eo?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,dl(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===En||r===zo||r===eo&&4&e.type)this.addMatch(e.index,-2);else{const s=dl(e,t,r,!1,!1);null!==s&&this.addMatch(e.index,s)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function Fz(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function Bz(n,t,e,i){return-1===e?function Nz(n,t){return 11&n.type?zl(n,t):4&n.type?Ix(n,t):null}(t,n):-2===e?function zz(n,t,e){return e===En?zl(t,n):e===eo?Ix(t,n):e===zo?jA(t,n):void 0}(n,t,i):Rl(n,n[1],e,t)}function HA(n,t,e,i){const r=t[19].queries[i];if(null===r.matches){const s=n.data,u=e.matches,m=[];for(let y=0;y<u.length;y+=2){const C=u[y];m.push(C<0?null:Bz(t,s[C],u[y+1],e.metadata.read))}r.matches=m}return r.matches}function qC(n,t,e,i){const r=n.queries.getByIndex(e),s=r.matches;if(null!==s){const u=HA(n,t,r,e);for(let m=0;m<s.length;m+=2){const y=s[m];if(y>0)i.push(u[m/2]);else{const C=s[m+1],I=t[-y];for(let A=10;A<I.length;A++){const B=I[A];B[17]===B[3]&&qC(B[1],B,C,i)}if(null!==I[9]){const A=I[9];for(let B=0;B<A.length;B++){const j=A[B];qC(j[1],j,C,i)}}}}}return i}function Fn(n){const t=Pt(),e=ir(),i=ag();Ud(i+1);const r=GA(e,i);if(n.dirty&&function ep(n){return 4==(4&n[2])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?qC(e,t,i,[]):HA(e,t,r,i);n.reset(s,Yg),n.notifyOnChanges()}return!0}return!1}function cr(n,t,e){const i=ir();i.firstCreatePass&&(qA(i,new UA(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),$A(i,Pt(),t)}function Vr(n,t,e,i){const r=ir();if(r.firstCreatePass){const s=Io();qA(r,new UA(t,e,i),s.index),function jz(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(r,n),2==(2&e)&&(r.staticContentQueries=!0)}$A(r,Pt(),e)}function Nn(){return function Vz(n,t){return n[19].queries[t].queryList}(Pt(),ag())}function $A(n,t,e){const i=new hm(4==(4&e));Mp(n,t,i,i.destroy),null===t[19]&&(t[19]=new UC),t[19].queries.push(new jC(i))}function qA(n,t,e){null===n.queries&&(n.queries=new HC),n.queries.track(new $C(t,e))}function GA(n,t){return n.queries.getByIndex(t)}function hh(n,t){return Ix(n,t)}function Ax(...n){}const kx=new It("Application Initializer");let Rx=(()=>{class n{constructor(e){this.appInits=e,this.resolve=Ax,this.reject=Ax,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(zy(s))e.push(s);else if(DC(s)){const u=new Promise((m,y)=>{s.subscribe({complete:m,error:y})});e.push(u)}}Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(je(kx,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Pb=new It("AppId",{providedIn:"root",factory:function dk(){return`${YC()}${YC()}${YC()}`}});function YC(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const hk=new It("Platform Initializer"),Px=new It("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),pk=new It("appBootstrapListener"),rd=new It("AnimationModuleType");let aV=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const $l=new It("LocaleId",{providedIn:"root",factory:()=>Fr($l,$n.Optional|$n.SkipSelf)||function lV(){return"undefined"!=typeof $localize&&$localize.locale||Ib}()});class uV{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let KC=(()=>{class n{compileModuleSync(e){return new NC(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),s=bc(xs(e).declarations).reduce((u,m)=>{const y=mr(m);return y&&u.push(new Gr(y)),u},[]);return new uV(i,s)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const pV=(()=>Promise.resolve(0))();function QC(n){"undefined"==typeof Zone?pV.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Xn{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new tn(!1),this.onMicrotaskEmpty=new tn(!1),this.onStable=new tn(!1),this.onError=new tn(!1),"undefined"==typeof Zone)throw new zt(908,!1);Zone.assertZonePatched();const r=this;if(r._nesting=0,r._outer=r._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const s=Zone.AsyncStackTaggingZoneSpec;r._inner=r._inner.fork(new s("Angular"))}Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&e,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function fV(){let n=Lr.requestAnimationFrame,t=Lr.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function bV(n){const t=()=>{!function gV(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Lr,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,eT(n),n.isCheckStableRunning=!0,JC(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),eT(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,r,s,u,m)=>{try{return gk(n),e.invokeTask(r,s,u,m)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&t(),bk(n)}},onInvoke:(e,i,r,s,u,m,y)=>{try{return gk(n),e.invoke(r,s,u,m,y)}finally{n.shouldCoalesceRunChangeDetection&&t(),bk(n)}},onHasTask:(e,i,r,s)=>{e.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,eT(n),JC(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(e,i,r,s)=>(e.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Xn.isInAngularZone())throw new zt(909,!1)}static assertNotInAngularZone(){if(Xn.isInAngularZone())throw new zt(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){const s=this._inner,u=s.scheduleEventTask("NgZoneEvent: "+r,t,mV,Ax,Ax);try{return s.runTask(u,e,i)}finally{s.cancelTask(u)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const mV={};function JC(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function eT(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function gk(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function bk(n){n._nesting--,JC(n)}class _V{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new tn,this.onMicrotaskEmpty=new tn,this.onStable=new tn,this.onError=new tn}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}}const _k=new It(""),Lx=new It("");let Ky,tT=(()=>{class n{constructor(e,i,r){this._ngZone=e,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Ky||(function yV(n){Ky=n}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Xn.assertNotInAngularZone(),QC(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())QC(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(u=>u.timeoutId!==s),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:s,updateCb:r})}whenStable(e,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}}return n.\u0275fac=function(e){return new(e||n)(je(Xn),je(nT),je(Lx))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),nT=(()=>{class n{constructor(){this._applications=new Map}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){var r;return null!==(r=null==Ky?void 0:Ky.findTestabilityInTree(this,e,i))&&void 0!==r?r:null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),od=null;const yk=new It("AllowMultipleToken"),iT=new It("PlatformDestroyListeners");class vk{constructor(t,e){this.name=t,this.token=e}}function wk(n,t,e=[]){const i=`Platform: ${t}`,r=new It(i);return(s=[])=>{let u=rT();if(!u||u.injector.get(yk,!1)){const m=[...e,...s,{provide:r,useValue:!0}];n?n(m):function wV(n){if(od&&!od.get(yk,!1))throw new zt(400,!1);od=n;const t=n.get(Ck);(function xk(n){const t=n.get(hk,null);t&&t.forEach(e=>e())})(n)}(function Sk(n=[],t){return Nr.create({name:t,providers:[{provide:ly,useValue:"platform"},{provide:iT,useValue:new Set([()=>od=null])},...n]})}(m,i))}return function CV(n){const t=rT();if(!t)throw new zt(401,!1);return t}()}}function rT(){var n;return null!==(n=null==od?void 0:od.get(Ck))&&void 0!==n?n:null}let Ck=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const r=function Ek(n,t){let e;return e="noop"===n?new _V:("zone.js"===n?void 0:n)||new Xn(t),e}(null==i?void 0:i.ngZone,function Tk(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:Xn,useValue:r}];return r.run(()=>{const u=Nr.create({providers:s,parent:this.injector,name:e.moduleType.name}),m=e.create(u),y=m.injector.get(bl,null);if(!y)throw new zt(402,!1);return r.runOutsideAngular(()=>{const C=r.onError.subscribe({next:I=>{y.handleError(I)}});m.onDestroy(()=>{Ox(this._modules,m),C.unsubscribe()})}),function Dk(n,t,e){try{const i=e();return zy(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(y,r,()=>{const C=m.injector.get(Rx);return C.runInitializers(),C.donePromise.then(()=>(function QM(n){Do(n,"Expected localeId to be defined"),"string"==typeof n&&(KM=n.toLowerCase().replace(/_/g,"-"))}(m.injector.get($l,Ib)||Ib),this._moduleDoBootstrap(m),m))})})}bootstrapModule(e,i=[]){const r=Ik({},i);return function vV(n,t,e){const i=new NC(e);return Promise.resolve(i)}(0,0,e).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(e){const i=e.injector.get(Lb);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!e.instance.ngDoBootstrap)throw new zt(403,!1);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new zt(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(iT,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(je(Nr))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function Ik(n,t){return Array.isArray(t)?t.reduce(Ik,n):Object.assign(Object.assign({},n),t)}let Lb=(()=>{class n{constructor(e,i,r){this._zone=e,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new Lt(m=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{m.next(this._stable),m.complete()})}),u=new Lt(m=>{let y;this._zone.runOutsideAngular(()=>{y=this._zone.onStable.subscribe(()=>{Xn.assertNotInAngularZone(),QC(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,m.next(!0))})})});const C=this._zone.onUnstable.subscribe(()=>{Xn.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{m.next(!1)}))});return()=>{y.unsubscribe(),C.unsubscribe()}});this.isStable=Er(s,u.pipe(un()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const r=e instanceof q0;if(!this._injector.get(Rx).done)throw!r&&function Cu(n){const t=mr(n)||ys(n)||vs(n);return null!==t&&t.standalone}(e),new zt(405,false);let u;u=r?e:this._injector.get(eh).resolveComponentFactory(e),this.componentTypes.push(u.componentType);const m=function xV(n){return n.isBoundToModule}(u)?void 0:this._injector.get(dm),C=u.create(Nr.NULL,[],i||u.selector,m),I=C.location.nativeElement,A=C.injector.get(_k,null);return null==A||A.registerApplication(I),C.onDestroy(()=>{this.detachView(C.hostView),Ox(this.components,C),null==A||A.unregisterApplication(I)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new zt(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;Ox(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(pk,[]).concat(this._bootstrapListeners).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Ox(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new zt(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(e){return new(e||n)(je(Xn),je(Jc),je(bl))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Ox(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let Ak=!0,Cr=(()=>{class n{}return n.__NG_ELEMENT_ID__=DV,n})();function DV(n){return function IV(n,t,e){if(Gh(n)&&!e){const i=Ss(n.index,t);return new or(i,i)}return 47&n.type?new or(t[16],t):null}(Io(),Pt(),16==(16&n))}class Ok{constructor(){}supports(t){return kp(t)}create(t){return new LV(t)}}const PV=(n,t)=>t;class LV{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||PV}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,s=null;for(;e||i;){const u=!i||e&&e.currentIndex<Nk(i,r,s)?e:i,m=Nk(u,r,s),y=u.currentIndex;if(u===i)r--,i=i._nextRemoved;else if(e=e._next,null==u.previousIndex)r++;else{s||(s=[]);const C=m-r,I=y-r;if(C!=I){for(let B=0;B<C;B++){const j=B<s.length?s[B]:s[B]=0,K=j+B;I<=K&&K<C&&(s[B]=j+1)}s[u.previousIndex]=I-C}}m!==y&&t(u,m,y)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!kp(t))throw new zt(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,s,u,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let m=0;m<this.length;m++)s=t[m],u=this._trackByFn(m,s),null!==e&&Object.is(e.trackById,u)?(i&&(e=this._verifyReinsertion(e,s,u,m)),Object.is(e.item,s)||this._addIdentityChange(e,s)):(e=this._mismatch(e,s,u,m),i=!0),e=e._next}else r=0,function By(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Ju()]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,m=>{u=this._trackByFn(r,m),null!==e&&Object.is(e.trackById,u)?(i&&(e=this._verifyReinsertion(e,m,u,r)),Object.is(e.item,m)||this._addIdentityChange(e,m)):(e=this._mismatch(e,m,u,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let s;return null===t?s=this._itTail:(s=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,s,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,s,r)):t=this._addAfter(new OV(e,i),s,r),t}_verifyReinsertion(t,e,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?t=this._reinsertAfter(s,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,s=t._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new Fk),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Fk),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class OV{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class FV{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class Fk{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new FV,this.map.set(e,i)),i.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Nk(n,t,e){const i=n.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}class Bk{constructor(){}supports(t){return t instanceof Map||yl(t)}create(){return new NV}}class NV{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||yl(t)))throw new zt(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const s=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,s)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const s=r._prev,u=r._next;return s&&(s._next=u),u&&(u._prev=s),r._next=null,r._prev=null,r}const i=new BV(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class BV{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function zk(){return new sd([new Ok])}let sd=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||zk()),deps:[[n,new up,new cp]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new zt(901,!1)}}return n.\u0275prov=Qt({token:n,providedIn:"root",factory:zk}),n})();function Vk(){return new Qy([new Bk])}let Qy=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||Vk()),deps:[[n,new up,new cp]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(i)return i;throw new zt(901,!1)}}return n.\u0275prov=Qt({token:n,providedIn:"root",factory:Vk}),n})();const jV=wk(null,"core",[]);let UV=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(je(Lb))},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({}),n})();function fh(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let Bx=null;function ad(){return Bx}const Gn=new It("DocumentToken");let cT=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:function(){return function GV(){return je(jk)}()},providedIn:"platform"}),n})();const WV=new It("Location Initialized");let jk=(()=>{class n extends cT{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ad().getBaseHref(this._doc)}onPopState(e){const i=ad().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=ad().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,r){Uk()?this._history.pushState(e,i,r):this.location.hash=r}replaceState(e,i,r){Uk()?this._history.replaceState(e,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(je(Gn))},n.\u0275prov=Qt({token:n,factory:function(){return function XV(){return new jk(je(Gn))}()},providedIn:"platform"}),n})();function Uk(){return!!window.history.pushState}function uT(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function Hk(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function mh(n){return n&&"?"!==n[0]?"?"+n:n}let fm=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:function(){return Fr(qk)},providedIn:"root"}),n})();const $k=new It("appBaseHref");let qk=(()=>{class n extends fm{constructor(e,i){var r,s,u;super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=null!==(u=null!==(r=null!=i?i:this._platformLocation.getBaseHrefFromDOM())&&void 0!==r?r:null===(s=Fr(Gn).location)||void 0===s?void 0:s.origin)&&void 0!==u?u:""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return uT(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+mh(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,s){const u=this.prepareExternalUrl(r+mh(s));this._platformLocation.pushState(e,i,u)}replaceState(e,i,r,s){const u=this.prepareExternalUrl(r+mh(s));this._platformLocation.replaceState(e,i,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(je(cT),je($k,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ZV=(()=>{class n extends fm{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=uT(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,s){let u=this.prepareExternalUrl(r+mh(s));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.pushState(e,i,u)}replaceState(e,i,r,s){let u=this.prepareExternalUrl(r+mh(s));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(je(cT),je($k,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),zx=(()=>{class n{constructor(e){this._subject=new tn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._baseHref=Hk(Gk(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){var e;null===(e=this._urlChangeSubscription)||void 0===e||e.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+mh(i))}normalize(e){return n.stripTrailingSlash(function KV(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,Gk(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+mh(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+mh(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){var i,r;null===(r=(i=this._locationStrategy).historyGo)||void 0===r||r.call(i,e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{var i;const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(null===(i=this._urlChangeSubscription)||void 0===i||i.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i,complete:r})}}return n.normalizeQueryParams=mh,n.joinWithSlash=uT,n.stripTrailingSlash=Hk,n.\u0275fac=function(e){return new(e||n)(je(fm))},n.\u0275prov=Qt({token:n,factory:function(){return function YV(){return new zx(je(fm))}()},providedIn:"root"}),n})();function Gk(n){return n.replace(/\/index.html$/,"")}var Ko=(()=>((Ko=Ko||{})[Ko.Format=0]="Format",Ko[Ko.Standalone=1]="Standalone",Ko))(),ur=(()=>((ur=ur||{})[ur.Narrow=0]="Narrow",ur[ur.Abbreviated=1]="Abbreviated",ur[ur.Wide=2]="Wide",ur[ur.Short=3]="Short",ur))(),Po=(()=>((Po=Po||{})[Po.Short=0]="Short",Po[Po.Medium=1]="Medium",Po[Po.Long=2]="Long",Po[Po.Full=3]="Full",Po))(),li=(()=>((li=li||{})[li.Decimal=0]="Decimal",li[li.Group=1]="Group",li[li.List=2]="List",li[li.PercentSign=3]="PercentSign",li[li.PlusSign=4]="PlusSign",li[li.MinusSign=5]="MinusSign",li[li.Exponential=6]="Exponential",li[li.SuperscriptingExponent=7]="SuperscriptingExponent",li[li.PerMille=8]="PerMille",li[li.Infinity=9]="Infinity",li[li.NaN=10]="NaN",li[li.TimeSeparator=11]="TimeSeparator",li[li.CurrencyDecimal=12]="CurrencyDecimal",li[li.CurrencyGroup=13]="CurrencyGroup",li))();function Vx(n,t){return Ec(Wa(n)[In.DateFormat],t)}function jx(n,t){return Ec(Wa(n)[In.TimeFormat],t)}function Ux(n,t){return Ec(Wa(n)[In.DateTimeFormat],t)}function Tc(n,t){const e=Wa(n),i=e[In.NumberSymbols][t];if(void 0===i){if(t===li.CurrencyDecimal)return e[In.NumberSymbols][li.Decimal];if(t===li.CurrencyGroup)return e[In.NumberSymbols][li.Group]}return i}function Xk(n){if(!n[In.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[In.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Ec(n,t){for(let e=t;e>-1;e--)if(void 0!==n[e])return n[e];throw new Error("Locale data API: locale data undefined")}function hT(n){const[t,e]=n.split(":");return{hours:+t,minutes:+e}}const u6=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Jy={},d6=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Is=(()=>((Is=Is||{})[Is.Short=0]="Short",Is[Is.ShortGMT=1]="ShortGMT",Is[Is.Long=2]="Long",Is[Is.Extended=3]="Extended",Is))(),vi=(()=>((vi=vi||{})[vi.FullYear=0]="FullYear",vi[vi.Month=1]="Month",vi[vi.Date=2]="Date",vi[vi.Hours=3]="Hours",vi[vi.Minutes=4]="Minutes",vi[vi.Seconds=5]="Seconds",vi[vi.FractionalSeconds=6]="FractionalSeconds",vi[vi.Day=7]="Day",vi))(),$i=(()=>(($i=$i||{})[$i.DayPeriods=0]="DayPeriods",$i[$i.Days=1]="Days",$i[$i.Months=2]="Months",$i[$i.Eras=3]="Eras",$i))();function h6(n,t,e,i){let r=function x6(n){if(Kk(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,s=1,u=1]=n.split("-").map(m=>+m);return Hx(r,s-1,u)}const e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(u6))return function w6(n){const t=new Date(0);let e=0,i=0;const r=n[8]?t.setUTCFullYear:t.setFullYear,s=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));const u=Number(n[4]||0)-e,m=Number(n[5]||0)-i,y=Number(n[6]||0),C=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return s.call(t,u,m,y,C),t}(i)}const t=new Date(n);if(!Kk(t))throw new Error(`Unable to convert "${n}" into a date`);return t}(n);t=gh(e,t)||t;let m,u=[];for(;t;){if(m=d6.exec(t),!m){u.push(t);break}{u=u.concat(m.slice(1));const I=u.pop();if(!I)break;t=I}}let y=r.getTimezoneOffset();i&&(y=Yk(i,y),r=function v6(n,t,e){const i=e?-1:1,r=n.getTimezoneOffset();return function y6(n,t){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+t),n}(n,i*(Yk(t,r)-r))}(r,i,!0));let C="";return u.forEach(I=>{const A=function _6(n){if(fT[n])return fT[n];let t;switch(n){case"G":case"GG":case"GGG":t=uo($i.Eras,ur.Abbreviated);break;case"GGGG":t=uo($i.Eras,ur.Wide);break;case"GGGGG":t=uo($i.Eras,ur.Narrow);break;case"y":t=us(vi.FullYear,1,0,!1,!0);break;case"yy":t=us(vi.FullYear,2,0,!0,!0);break;case"yyy":t=us(vi.FullYear,3,0,!1,!0);break;case"yyyy":t=us(vi.FullYear,4,0,!1,!0);break;case"Y":t=Wx(1);break;case"YY":t=Wx(2,!0);break;case"YYY":t=Wx(3);break;case"YYYY":t=Wx(4);break;case"M":case"L":t=us(vi.Month,1,1);break;case"MM":case"LL":t=us(vi.Month,2,1);break;case"MMM":t=uo($i.Months,ur.Abbreviated);break;case"MMMM":t=uo($i.Months,ur.Wide);break;case"MMMMM":t=uo($i.Months,ur.Narrow);break;case"LLL":t=uo($i.Months,ur.Abbreviated,Ko.Standalone);break;case"LLLL":t=uo($i.Months,ur.Wide,Ko.Standalone);break;case"LLLLL":t=uo($i.Months,ur.Narrow,Ko.Standalone);break;case"w":t=pT(1);break;case"ww":t=pT(2);break;case"W":t=pT(1,!0);break;case"d":t=us(vi.Date,1);break;case"dd":t=us(vi.Date,2);break;case"c":case"cc":t=us(vi.Day,1);break;case"ccc":t=uo($i.Days,ur.Abbreviated,Ko.Standalone);break;case"cccc":t=uo($i.Days,ur.Wide,Ko.Standalone);break;case"ccccc":t=uo($i.Days,ur.Narrow,Ko.Standalone);break;case"cccccc":t=uo($i.Days,ur.Short,Ko.Standalone);break;case"E":case"EE":case"EEE":t=uo($i.Days,ur.Abbreviated);break;case"EEEE":t=uo($i.Days,ur.Wide);break;case"EEEEE":t=uo($i.Days,ur.Narrow);break;case"EEEEEE":t=uo($i.Days,ur.Short);break;case"a":case"aa":case"aaa":t=uo($i.DayPeriods,ur.Abbreviated);break;case"aaaa":t=uo($i.DayPeriods,ur.Wide);break;case"aaaaa":t=uo($i.DayPeriods,ur.Narrow);break;case"b":case"bb":case"bbb":t=uo($i.DayPeriods,ur.Abbreviated,Ko.Standalone,!0);break;case"bbbb":t=uo($i.DayPeriods,ur.Wide,Ko.Standalone,!0);break;case"bbbbb":t=uo($i.DayPeriods,ur.Narrow,Ko.Standalone,!0);break;case"B":case"BB":case"BBB":t=uo($i.DayPeriods,ur.Abbreviated,Ko.Format,!0);break;case"BBBB":t=uo($i.DayPeriods,ur.Wide,Ko.Format,!0);break;case"BBBBB":t=uo($i.DayPeriods,ur.Narrow,Ko.Format,!0);break;case"h":t=us(vi.Hours,1,-12);break;case"hh":t=us(vi.Hours,2,-12);break;case"H":t=us(vi.Hours,1);break;case"HH":t=us(vi.Hours,2);break;case"m":t=us(vi.Minutes,1);break;case"mm":t=us(vi.Minutes,2);break;case"s":t=us(vi.Seconds,1);break;case"ss":t=us(vi.Seconds,2);break;case"S":t=us(vi.FractionalSeconds,1);break;case"SS":t=us(vi.FractionalSeconds,2);break;case"SSS":t=us(vi.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=qx(Is.Short);break;case"ZZZZZ":t=qx(Is.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=qx(Is.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=qx(Is.Long);break;default:return null}return fT[n]=t,t}(I);C+=A?A(r,e,y):"''"===I?"'":I.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),C}function Hx(n,t,e){const i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function gh(n,t){const e=function QV(n){return Wa(n)[In.LocaleId]}(n);if(Jy[e]=Jy[e]||{},Jy[e][t])return Jy[e][t];let i="";switch(t){case"shortDate":i=Vx(n,Po.Short);break;case"mediumDate":i=Vx(n,Po.Medium);break;case"longDate":i=Vx(n,Po.Long);break;case"fullDate":i=Vx(n,Po.Full);break;case"shortTime":i=jx(n,Po.Short);break;case"mediumTime":i=jx(n,Po.Medium);break;case"longTime":i=jx(n,Po.Long);break;case"fullTime":i=jx(n,Po.Full);break;case"short":const r=gh(n,"shortTime"),s=gh(n,"shortDate");i=$x(Ux(n,Po.Short),[r,s]);break;case"medium":const u=gh(n,"mediumTime"),m=gh(n,"mediumDate");i=$x(Ux(n,Po.Medium),[u,m]);break;case"long":const y=gh(n,"longTime"),C=gh(n,"longDate");i=$x(Ux(n,Po.Long),[y,C]);break;case"full":const I=gh(n,"fullTime"),A=gh(n,"fullDate");i=$x(Ux(n,Po.Full),[I,A])}return i&&(Jy[e][t]=i),i}function $x(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return null!=t&&i in t?t[i]:e})),n}function lu(n,t,e="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,s=e));let u=String(n);for(;u.length<t;)u="0"+u;return i&&(u=u.slice(u.length-t)),s+u}function us(n,t,e=0,i=!1,r=!1){return function(s,u){let m=function f6(n,t){switch(n){case vi.FullYear:return t.getFullYear();case vi.Month:return t.getMonth();case vi.Date:return t.getDate();case vi.Hours:return t.getHours();case vi.Minutes:return t.getMinutes();case vi.Seconds:return t.getSeconds();case vi.FractionalSeconds:return t.getMilliseconds();case vi.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,s);if((e>0||m>-e)&&(m+=e),n===vi.Hours)0===m&&-12===e&&(m=12);else if(n===vi.FractionalSeconds)return function p6(n,t){return lu(n,3).substring(0,t)}(m,t);const y=Tc(u,li.MinusSign);return lu(m,t,y,i,r)}}function uo(n,t,e=Ko.Format,i=!1){return function(r,s){return function m6(n,t,e,i,r,s){switch(e){case $i.Months:return function t6(n,t,e){const i=Wa(n),s=Ec([i[In.MonthsFormat],i[In.MonthsStandalone]],t);return Ec(s,e)}(t,r,i)[n.getMonth()];case $i.Days:return function e6(n,t,e){const i=Wa(n),s=Ec([i[In.DaysFormat],i[In.DaysStandalone]],t);return Ec(s,e)}(t,r,i)[n.getDay()];case $i.DayPeriods:const u=n.getHours(),m=n.getMinutes();if(s){const C=function o6(n){const t=Wa(n);return Xk(t),(t[In.ExtraData][2]||[]).map(i=>"string"==typeof i?hT(i):[hT(i[0]),hT(i[1])])}(t),I=function s6(n,t,e){const i=Wa(n);Xk(i);const s=Ec([i[In.ExtraData][0],i[In.ExtraData][1]],t)||[];return Ec(s,e)||[]}(t,r,i),A=C.findIndex(B=>{if(Array.isArray(B)){const[j,K]=B,pe=u>=j.hours&&m>=j.minutes,Se=u<K.hours||u===K.hours&&m<K.minutes;if(j.hours<K.hours){if(pe&&Se)return!0}else if(pe||Se)return!0}else if(B.hours===u&&B.minutes===m)return!0;return!1});if(-1!==A)return I[A]}return function JV(n,t,e){const i=Wa(n),s=Ec([i[In.DayPeriodsFormat],i[In.DayPeriodsStandalone]],t);return Ec(s,e)}(t,r,i)[u<12?0:1];case $i.Eras:return function n6(n,t){return Ec(Wa(n)[In.Eras],t)}(t,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,s,n,t,e,i)}}function qx(n){return function(t,e,i){const r=-1*i,s=Tc(e,li.MinusSign),u=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case Is.Short:return(r>=0?"+":"")+lu(u,2,s)+lu(Math.abs(r%60),2,s);case Is.ShortGMT:return"GMT"+(r>=0?"+":"")+lu(u,1,s);case Is.Long:return"GMT"+(r>=0?"+":"")+lu(u,2,s)+":"+lu(Math.abs(r%60),2,s);case Is.Extended:return 0===i?"Z":(r>=0?"+":"")+lu(u,2,s)+":"+lu(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}function Zk(n){return Hx(n.getFullYear(),n.getMonth(),n.getDate()+(4-n.getDay()))}function pT(n,t=!1){return function(e,i){let r;if(t){const s=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,u=e.getDate();r=1+Math.floor((u+s)/7)}else{const s=Zk(e),u=function b6(n){const t=Hx(n,0,1).getDay();return Hx(n,0,1+(t<=4?4:11)-t)}(s.getFullYear()),m=s.getTime()-u.getTime();r=1+Math.round(m/6048e5)}return lu(r,n,Tc(i,li.MinusSign))}}function Wx(n,t=!1){return function(e,i){return lu(Zk(e).getFullYear(),n,Tc(i,li.MinusSign),t)}}const fT={};function Yk(n,t){n=n.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function Kk(n){return n instanceof Date&&!isNaN(n.valueOf())}function tR(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[r,s]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(s)}return null}let Ob=(()=>{class n{constructor(e,i,r,s){this._iterableDiffers=e,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(kp(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${ji(i.item)}`);this._toggleClass(i.item,!0)}),e.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!0)):Object.keys(e).forEach(i=>this._toggleClass(i,!!e[i])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!1)):Object.keys(e).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(e,i){(e=e.trim())&&e.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(e){return new(e||n)(H(sd),H(Qy),H(En),H(gc))},n.\u0275dir=Bt({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),n})();class O6{constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Sl=(()=>{class n{constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,s,u)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new O6(r.item,this._ngForOf,-1,-1),null===u?void 0:u);else if(null==u)i.remove(null===s?void 0:s);else if(null!==s){const m=i.get(s);i.move(m,u),rR(m,r)}});for(let r=0,s=i.length;r<s;r++){const m=i.get(r).context;m.index=r,m.count=s,m.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{rR(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(H(zo),H(eo),H(sd))},n.\u0275dir=Bt({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function rR(n,t){n.context.$implicit=t.item}let ho=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new N6,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){oR("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){oR("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(H(zo),H(eo))},n.\u0275dir=Bt({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class N6{constructor(){this.$implicit=null,this.ngIf=null}}function oR(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${ji(t)}'.`)}class vT{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let Fb=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const i=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(e)}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),n})(),Zx=(()=>{class n{constructor(e,i,r){this.ngSwitch=r,r._addCase(),this._view=new vT(e,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(e){return new(e||n)(H(zo),H(eo),H(Fb,9))},n.\u0275dir=Bt({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),n})(),aR=(()=>{class n{constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[r,s]=e.split("."),u=-1===r.indexOf("-")?void 0:Qs.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${i}${s}`:i,u):this._renderer.removeStyle(this._ngEl.nativeElement,r,u)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Qy),H(gc))},n.\u0275dir=Bt({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),n})(),tv=(()=>{class n{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:s,ngTemplateOutletInjector:u}=this;this._viewRef=i.createEmbeddedView(r,s,u?{injector:u}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(e){return new(e||n)(H(zo))},n.\u0275dir=Bt({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[hr]}),n})();function cu(n,t){return new zt(2100,!1)}class V6{createSubscription(t,e){return t.subscribe({next:e,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class j6{createSubscription(t,e){return t.then(e,i=>{throw i})}dispose(t){}}const U6=new j6,H6=new V6;let nv=(()=>{class n{constructor(e){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,i=>this._updateLatestValue(e,i))}_selectStrategy(e){if(zy(e))return U6;if(cM(e))return H6;throw cu()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,i){e===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(H(Cr,16))},n.\u0275pipe=wo({name:"async",type:n,pure:!1,standalone:!0}),n})();const q6=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let lR=(()=>{class n{transform(e){if(null==e)return null;if("string"!=typeof e)throw cu();return e.replace(q6,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=wo({name:"titlecase",type:n,pure:!0,standalone:!0}),n})();const W6=new It("DATE_PIPE_DEFAULT_TIMEZONE");let cR=(()=>{class n{constructor(e,i){this.locale=e,this.defaultTimezone=i}transform(e,i="mediumDate",r,s){var u;if(null==e||""===e||e!=e)return null;try{return h6(e,i,s||this.locale,null!==(u=null!=r?r:this.defaultTimezone)&&void 0!==u?u:void 0)}catch(m){throw cu()}}}return n.\u0275fac=function(e){return new(e||n)(H($l,16),H(W6,24))},n.\u0275pipe=wo({name:"date",type:n,pure:!0,standalone:!0}),n})(),pr=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({}),n})();const dR="browser";let lj=(()=>{class n{}return n.\u0275prov=Qt({token:n,providedIn:"root",factory:()=>new cj(je(Gn),window)}),n})();class cj{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function uj(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const u=s.getElementById(t)||s.querySelector(`[name="${t}"]`);if(u)return u}r=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=hR(this.window.history)||hR(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function hR(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class pR{}class TT extends class Nj extends class qV{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function $V(n){Bx||(Bx=n)}(new TT)}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function Bj(){return rv=rv||document.querySelector("base"),rv?rv.getAttribute("href"):null}();return null==e?null:function zj(n){Qx=Qx||document.createElement("a"),Qx.setAttribute("href",n);const t=Qx.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){rv=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return tR(document.cookie,t)}}let Qx,rv=null;const _R=new It("TRANSITION_ID"),jj=[{provide:kx,useFactory:function Vj(n,t,e){return()=>{e.get(Rx).donePromise.then(()=>{const i=ad(),r=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[_R,Gn,Nr],multi:!0}];let Hj=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();const Jx=new It("EventManagerPlugins");let ew=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(r=>r.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,r){return this._findPluginFor(i).addEventListener(e,i,r)}addGlobalEventListener(e,i,r){return this._findPluginFor(i).addGlobalEventListener(e,i,r)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const u=r[s];if(u.supports(e))return this._eventNameToPlugin.set(e,u),u}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(je(Jx),je(Xn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();class yR{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const r=ad().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,i)}}let vR=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),ov=(()=>{class n extends vR{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,r){e.forEach(s=>{const u=this._doc.createElement("style");u.textContent=s,r.push(i.appendChild(u))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(xR),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(e,r,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(xR))}}return n.\u0275fac=function(e){return new(e||n)(je(Gn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();function xR(n){ad().remove(n)}const ET={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},DT=/%COMP%/g;function tw(n,t,e){for(let i=0;i<t.length;i++){let r=t[i];Array.isArray(r)?tw(n,r,e):(r=r.replace(DT,n),e.push(r))}return e}function CR(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let nw=(()=>{class n{constructor(e,i,r){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new IT(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case Ws.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new Zj(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(e),r}case 1:case Ws.ShadowDom:return new Yj(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const r=tw(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(je(ew),je(ov),je(Pb))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();class IT{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(ET[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(ER(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(ER(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;const s=ET[r];s?t.setAttributeNS(s,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const r=ET[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(Qs.DashCase|Qs.Important)?t.style.setProperty(e,i,r&Qs.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&Qs.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,CR(i)):this.eventManager.addEventListener(t,e,CR(i))}}function ER(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class Zj extends IT{constructor(t,e,i,r){super(t),this.component=i;const s=tw(r+"-"+i.id,i.styles,[]);e.addStyles(s),this.contentAttr=function Gj(n){return"_ngcontent-%COMP%".replace(DT,n)}(r+"-"+i.id),this.hostAttr=function Wj(n){return"_nghost-%COMP%".replace(DT,n)}(r+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class Yj extends IT{constructor(t,e,i,r){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=tw(r.id,r.styles,[]);for(let u=0;u<s.length;u++){const m=document.createElement("style");m.textContent=s[u],this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let Kj=(()=>{class n extends yR{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r){return e.addEventListener(i,r,!1),()=>this.removeEventListener(e,i,r)}removeEventListener(e,i,r){return e.removeEventListener(i,r)}}return n.\u0275fac=function(e){return new(e||n)(je(Gn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();const DR=["alt","control","meta","shift"],Qj={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Jj={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let e4=(()=>{class n extends yR{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,r){const s=n.parseEventName(i),u=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ad().onAndCancel(e,s.domEventName,u))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let u="",m=i.indexOf("code");if(m>-1&&(i.splice(m,1),u="code."),DR.forEach(C=>{const I=i.indexOf(C);I>-1&&(i.splice(I,1),u+=C+".")}),u+=s,0!=i.length||0===s.length)return null;const y={};return y.domEventName=r,y.fullKey=u,y}static matchEventFullKeyCode(e,i){let r=Qj[e.key]||e.key,s="";return i.indexOf("code.")>-1&&(r=e.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),DR.forEach(u=>{u!==r&&(0,Jj[u])(e)&&(s+=u+".")}),s+=r,s===i)}static eventCallback(e,i,r){return s=>{n.matchEventFullKeyCode(s,e)&&r.runGuarded(()=>i(s))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(je(Gn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();const o4=wk(jV,"browser",[{provide:Px,useValue:dR},{provide:hk,useValue:function t4(){TT.makeCurrent()},multi:!0},{provide:Gn,useFactory:function r4(){return function k0(n){J_=n}(document),document},deps:[]}]),AR=new It(""),kR=[{provide:Lx,useClass:class Uj{addToWindow(t){Lr.getAngularTestability=(i,r=!0)=>{const s=t.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},Lr.getAllAngularTestabilities=()=>t.getAllTestabilities(),Lr.getAllAngularRootElements=()=>t.getAllRootElements(),Lr.frameworkStabilizers||(Lr.frameworkStabilizers=[]),Lr.frameworkStabilizers.push(i=>{const r=Lr.getAllAngularTestabilities();let s=r.length,u=!1;const m=function(y){u=u||y,s--,0==s&&i(u)};r.forEach(function(y){y.whenStable(m)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:i?ad().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}},deps:[]},{provide:_k,useClass:tT,deps:[Xn,nT,Lx]},{provide:tT,useClass:tT,deps:[Xn,nT,Lx]}],RR=[{provide:ly,useValue:"root"},{provide:bl,useFactory:function n4(){return new bl},deps:[]},{provide:Jx,useClass:Kj,multi:!0,deps:[Gn,Xn,Px]},{provide:Jx,useClass:e4,multi:!0,deps:[Gn]},{provide:nw,useClass:nw,deps:[ew,ov,Pb]},{provide:Kf,useExisting:nw},{provide:vR,useExisting:ov},{provide:ov,useClass:ov,deps:[Gn]},{provide:ew,useClass:ew,deps:[Jx,Xn]},{provide:pR,useClass:Hj,deps:[]},[]];let PR=(()=>{class n{constructor(e){}static withServerTransition(e){return{ngModule:n,providers:[{provide:Pb,useValue:e.appId},{provide:_R,useExisting:Pb},jj]}}}return n.\u0275fac=function(e){return new(e||n)(je(AR,12))},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[...RR,...kR],imports:[pr,UV]}),n})(),LR=(()=>{class n{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return n.\u0275fac=function(e){return new(e||n)(je(Gn))},n.\u0275prov=Qt({token:n,factory:function(e){let i=null;return i=e?new e:function a4(){return new LR(je(Gn))}(),i},providedIn:"root"}),n})();"undefined"!=typeof window&&window;let NR=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:function(e){let i=null;return i=e?new(e||n):je(BR),i},providedIn:"root"}),n})(),BR=(()=>{class n extends NR{constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case lr.NONE:return i;case lr.HTML:return $a(i,"HTML")?Ha(i):Wf(this._doc,String(i)).toString();case lr.STYLE:return $a(i,"Style")?Ha(i):i;case lr.SCRIPT:if($a(i,"Script"))return Ha(i);throw new Error("unsafe value used in a script context");case lr.URL:return $a(i,"URL")?Ha(i):gp(String(i));case lr.RESOURCE_URL:if($a(i,"ResourceURL"))return Ha(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function P0(n){return new T1(n)}(e)}bypassSecurityTrustStyle(e){return function mp(n){return new E1(n)}(e)}bypassSecurityTrustScript(e){return function k1(n){return new D1(n)}(e)}bypassSecurityTrustUrl(e){return function R1(n){return new I1(n)}(e)}bypassSecurityTrustResourceUrl(e){return function P1(n){return new M1(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(je(Gn))},n.\u0275prov=Qt({token:n,factory:function(e){let i=null;return i=e?new e:function f4(n){return new BR(n.get(Gn))}(je(Nr)),i},providedIn:"root"}),n})();class zR{}const bh="*";function Ms(n,t){return{type:7,name:n,definitions:t,options:{}}}function er(n,t=null){return{type:4,styles:t,timings:n}}function VR(n,t=null){return{type:3,steps:n,options:t}}function jR(n,t=null){return{type:2,steps:n,options:t}}function Bn(n){return{type:6,styles:n,offset:null}}function fr(n,t,e){return{type:0,name:n,styles:t,options:e}}function sv(n){return{type:5,steps:n}}function Xi(n,t,e=null){return{type:1,expr:n,animation:t,options:e}}function kT(n=null){return{type:9,options:n}}function RT(n,t,e=null){return{type:11,selector:n,animation:t,options:e}}function UR(n){Promise.resolve().then(n)}class av{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){UR(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class HR{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,r=0;const s=this.players.length;0==s?UR(()=>this._onFinish()):this.players.forEach(u=>{u.onDone(()=>{++e==s&&this._onFinish()}),u.onDestroy(()=>{++i==s&&this._onDestroy()}),u.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((u,m)=>Math.max(u,m.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function $R(n){return new zt(3e3,!1)}function Y4(){return"undefined"!=typeof window&&void 0!==window.document}function LT(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function Lp(n){switch(n.length){case 0:return new av;case 1:return n[0];default:return new HR(n)}}function qR(n,t,e,i,r=new Map,s=new Map){const u=[],m=[];let y=-1,C=null;if(i.forEach(I=>{const A=I.get("offset"),B=A==y,j=B&&C||new Map;I.forEach((K,pe)=>{let Se=pe,Xe=K;if("offset"!==pe)switch(Se=t.normalizePropertyName(Se,u),Xe){case"!":Xe=r.get(pe);break;case bh:Xe=s.get(pe);break;default:Xe=t.normalizeStyleValue(pe,Se,Xe,u)}j.set(Se,Xe)}),B||m.push(j),C=j,y=A}),u.length)throw function B4(n){return new zt(3502,!1)}();return m}function OT(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&FT(e,"start",n)));break;case"done":n.onDone(()=>i(e&&FT(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&FT(e,"destroy",n)))}}function FT(n,t,e){const i=e.totalTime,s=NT(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==i?n.totalTime:i,!!e.disabled),u=n._data;return null!=u&&(s._data=u),s}function NT(n,t,e,i,r="",s=0,u){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:r,totalTime:s,disabled:!!u}}function ql(n,t,e){let i=n.get(t);return i||n.set(t,i=e),i}function GR(n){const t=n.indexOf(":");return[n.substring(1,t),n.slice(t+1)]}let BT=(n,t)=>!1,WR=(n,t,e)=>[],XR=null;function zT(n){const t=n.parentNode||n.host;return t===XR?null:t}(LT()||"undefined"!=typeof Element)&&(Y4()?(XR=(()=>document.documentElement)(),BT=(n,t)=>{for(;t;){if(t===n)return!0;t=zT(t)}return!1}):BT=(n,t)=>n.contains(t),WR=(n,t,e)=>{if(e)return Array.from(n.querySelectorAll(t));const i=n.querySelector(t);return i?[i]:[]});let mm=null,ZR=!1;const YR=BT,KR=WR;let QR=(()=>{class n{validateStyleProperty(e){return function Q4(n){mm||(mm=function J4(){return"undefined"!=typeof document?document.body:null}()||{},ZR=!!mm.style&&"WebkitAppearance"in mm.style);let t=!0;return mm.style&&!function K4(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in mm.style,!t&&ZR&&(t="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in mm.style)),t}(e)}matchesElement(e,i){return!1}containsElement(e,i){return YR(e,i)}getParentElement(e){return zT(e)}query(e,i,r){return KR(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,s,u,m=[],y){return new av(r,s)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),VT=(()=>{class n{}return n.NOOP=new QR,n})();const jT="ng-enter",iw="ng-leave",rw="ng-trigger",ow=".ng-trigger",eP="ng-animating",UT=".ng-animating";function _h(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:HT(parseFloat(t[1]),t[2])}function HT(n,t){return"s"===t?1e3*n:n}function sw(n,t,e){return n.hasOwnProperty("duration")?n:function n5(n,t,e){let r,s=0,u="";if("string"==typeof n){const m=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===m)return t.push($R()),{duration:0,delay:0,easing:""};r=HT(parseFloat(m[1]),m[2]);const y=m[3];null!=y&&(s=HT(parseFloat(y),m[4]));const C=m[5];C&&(u=C)}else r=n;if(!e){let m=!1,y=t.length;r<0&&(t.push(function g4(){return new zt(3100,!1)}()),m=!0),s<0&&(t.push(function b4(){return new zt(3101,!1)}()),m=!0),m&&t.splice(y,0,$R())}return{duration:r,delay:s,easing:u}}(n,t,e)}function lv(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function tP(n){const t=new Map;return Object.keys(n).forEach(e=>{t.set(e,n[e])}),t}function Op(n,t=new Map,e){if(e)for(let[i,r]of e)t.set(i,r);for(let[i,r]of n)t.set(i,r);return t}function iP(n,t,e){return e?t+":"+e+";":""}function rP(n){let t="";for(let e=0;e<n.style.length;e++){const i=n.style.item(e);t+=iP(0,i,n.style.getPropertyValue(i))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=iP(0,a5(e),n.style[e]));n.setAttribute("style",t)}function ld(n,t,e){n.style&&(t.forEach((i,r)=>{const s=qT(r);e&&!e.has(r)&&e.set(r,n.style[s]),n.style[s]=i}),LT()&&rP(n))}function gm(n,t){n.style&&(t.forEach((e,i)=>{const r=qT(i);n.style[r]=""}),LT()&&rP(n))}function cv(n){return Array.isArray(n)?1==n.length?n[0]:jR(n):n}const $T=new RegExp("{{\\s*(.+?)\\s*}}","g");function oP(n){let t=[];if("string"==typeof n){let e;for(;e=$T.exec(n);)t.push(e[1]);$T.lastIndex=0}return t}function uv(n,t,e){const i=n.toString(),r=i.replace($T,(s,u)=>{let m=t[u];return null==m&&(e.push(function y4(n){return new zt(3003,!1)}()),m=""),m.toString()});return r==i?n:r}function aw(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const s5=/-+([a-z0-9])/g;function qT(n){return n.replace(s5,(...t)=>t[1].toUpperCase())}function a5(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Gl(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw function v4(n){return new zt(3004,!1)}()}}function sP(n,t){return window.getComputedStyle(n)[t]}function p5(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function f5(n,t,e){if(":"==n[0]){const y=function m5(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(function L4(n){return new zt(3016,!1)}()),"* => *"}}(n,e);if("function"==typeof y)return void t.push(y);n=y}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(function P4(n){return new zt(3015,!1)}()),t;const r=i[1],s=i[2],u=i[3];t.push(aP(r,u));"<"==s[0]&&!("*"==r&&"*"==u)&&t.push(aP(u,r))}(i,e,t)):e.push(n),e}const dw=new Set(["true","1"]),hw=new Set(["false","0"]);function aP(n,t){const e=dw.has(n)||hw.has(n),i=dw.has(t)||hw.has(t);return(r,s)=>{let u="*"==n||n==r,m="*"==t||t==s;return!u&&e&&"boolean"==typeof r&&(u=r?dw.has(n):hw.has(n)),!m&&i&&"boolean"==typeof s&&(m=s?dw.has(t):hw.has(t)),u&&m}}const g5=new RegExp("s*:selfs*,?","g");function GT(n,t,e,i){return new b5(n).build(t,e,i)}class b5{constructor(t){this._driver=t}build(t,e,i){const r=new v5(e);return this._resetContextStyleTimingState(r),Gl(this,cv(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,r=e.depCount=0;const s=[],u=[];return"@"==t.name.charAt(0)&&e.errors.push(function w4(){return new zt(3006,!1)}()),t.definitions.forEach(m=>{if(this._resetContextStyleTimingState(e),0==m.type){const y=m,C=y.name;C.toString().split(/\s*,\s*/).forEach(I=>{y.name=I,s.push(this.visitState(y,e))}),y.name=C}else if(1==m.type){const y=this.visitTransition(m,e);i+=y.queryCount,r+=y.depCount,u.push(y)}else e.errors.push(function S4(){return new zt(3007,!1)}())}),{type:7,name:t.name,states:s,transitions:u,queryCount:i,depCount:r,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const s=new Set,u=r||{};i.styles.forEach(m=>{m instanceof Map&&m.forEach(y=>{oP(y).forEach(C=>{u.hasOwnProperty(C)||s.add(C)})})}),s.size&&(aw(s.values()),e.errors.push(function C4(n,t){return new zt(3008,!1)}()))}return{type:0,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=Gl(this,cv(t.animation),e);return{type:1,matchers:p5(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:bm(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(i=>Gl(this,i,e)),options:bm(t.options)}}visitGroup(t,e){const i=e.currentTime;let r=0;const s=t.steps.map(u=>{e.currentTime=i;const m=Gl(this,u,e);return r=Math.max(r,e.currentTime),m});return e.currentTime=r,{type:3,steps:s,options:bm(t.options)}}visitAnimate(t,e){const i=function w5(n,t){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return WT(sw(n,t).duration,0,"");const e=n;if(e.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=WT(0,0,"");return s.dynamic=!0,s.strValue=e,s}const r=sw(e,t);return WT(r.duration,r.delay,r.easing)}(t.timings,e.errors);e.currentAnimateTimings=i;let r,s=t.styles?t.styles:Bn({});if(5==s.type)r=this.visitKeyframes(s,e);else{let u=t.styles,m=!1;if(!u){m=!0;const C={};i.easing&&(C.easing=i.easing),u=Bn(C)}e.currentTime+=i.duration+i.delay;const y=this.visitStyle(u,e);y.isEmptyStep=m,r=y}return e.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let m of r)"string"==typeof m?m===bh?i.push(m):e.errors.push(new zt(3002,!1)):i.push(tP(m));let s=!1,u=null;return i.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(u=m.get("easing"),m.delete("easing")),!s))for(let y of m.values())if(y.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:u,offset:t.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let r=e.currentTime,s=e.currentTime;i&&s>0&&(s-=i.duration+i.delay),t.styles.forEach(u=>{"string"!=typeof u&&u.forEach((m,y)=>{const C=e.collectedStyles.get(e.currentQuerySelector),I=C.get(y);let A=!0;I&&(s!=r&&s>=I.startTime&&r<=I.endTime&&(e.errors.push(function E4(n,t,e,i,r){return new zt(3010,!1)}()),A=!1),s=I.startTime),A&&C.set(y,{startTime:s,endTime:r}),e.options&&function o5(n,t,e){const i=t.params||{},r=oP(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||e.push(function _4(n){return new zt(3001,!1)}())})}(m,e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function D4(){return new zt(3011,!1)}()),i;let s=0;const u=[];let m=!1,y=!1,C=0;const I=t.steps.map(Xe=>{const At=this._makeStyleAst(Xe,e);let pt=null!=At.offset?At.offset:function x5(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const e=n;t=parseFloat(e.get("offset")),e.delete("offset")}return t}(At.styles),kt=0;return null!=pt&&(s++,kt=At.offset=pt),y=y||kt<0||kt>1,m=m||kt<C,C=kt,u.push(kt),At});y&&e.errors.push(function I4(){return new zt(3012,!1)}()),m&&e.errors.push(function M4(){return new zt(3200,!1)}());const A=t.steps.length;let B=0;s>0&&s<A?e.errors.push(function A4(){return new zt(3202,!1)}()):0==s&&(B=1/(A-1));const j=A-1,K=e.currentTime,pe=e.currentAnimateTimings,Se=pe.duration;return I.forEach((Xe,At)=>{const pt=B>0?At==j?1:B*At:u[At],kt=pt*Se;e.currentTime=K+pe.delay+kt,pe.duration=kt,this._validateStyleAst(Xe,e),Xe.offset=pt,i.styles.push(Xe)}),i}visitReference(t,e){return{type:8,animation:Gl(this,cv(t.animation),e),options:bm(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:bm(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:bm(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;const[s,u]=function _5(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(g5,"")),n=n.replace(/@\*/g,ow).replace(/@\w+/g,e=>ow+"-"+e.slice(1)).replace(/:animating/g,UT),[n,t]}(t.selector);e.currentQuerySelector=i.length?i+" "+s:s,ql(e.collectedStyles,e.currentQuerySelector,new Map);const m=Gl(this,cv(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:u,animation:m,originalSelector:t.selector,options:bm(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(function k4(){return new zt(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:sw(t.timings,e.errors,!0);return{type:12,animation:Gl(this,cv(t.animation),e),timings:i,options:null}}}class v5{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function bm(n){return n?(n=lv(n)).params&&(n.params=function y5(n){return n?lv(n):null}(n.params)):n={},n}function WT(n,t,e){return{duration:n,delay:t,easing:e}}function XT(n,t,e,i,r,s,u=null,m=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:u,subTimeline:m}}class pw{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const T5=new RegExp(":enter","g"),D5=new RegExp(":leave","g");function ZT(n,t,e,i,r,s=new Map,u=new Map,m,y,C=[]){return(new I5).buildKeyframes(n,t,e,i,r,s,u,m,y,C)}class I5{buildKeyframes(t,e,i,r,s,u,m,y,C,I=[]){C=C||new pw;const A=new YT(t,e,C,r,s,I,[]);A.options=y;const B=y.delay?_h(y.delay):0;A.currentTimeline.delayNextStep(B),A.currentTimeline.setStyles([u],null,A.errors,y),Gl(this,i,A);const j=A.timelines.filter(K=>K.containsAnimation());if(j.length&&m.size){let K;for(let pe=j.length-1;pe>=0;pe--){const Se=j[pe];if(Se.element===e){K=Se;break}}K&&!K.allowOnlyTimelineStyles()&&K.setStyles([m],null,A.errors,y)}return j.length?j.map(K=>K.buildKeyframes()):[XT(e,[],[],[],0,B,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.get(e.element);if(i){const r=e.createSubContext(t.options),s=e.currentTimeline.currentTime,u=this._visitSubInstructions(i,r,r.options);s!=u&&e.transformIntoNewTimeline(u)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,i),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,i){var r;for(const s of t){const u=null==s?void 0:s.delay;if(u){const m="number"==typeof u?u:_h(uv(u,null!==(r=null==s?void 0:s.params)&&void 0!==r?r:{},e.errors));i.delayNextStep(m)}}}_visitSubInstructions(t,e,i){let s=e.currentTimeline.currentTime;const u=null!=i.duration?_h(i.duration):null,m=null!=i.delay?_h(i.delay):null;return 0!==u&&t.forEach(y=>{const C=e.appendInstructionToTimeline(y,u,m);s=Math.max(s,C.duration+C.delay)}),s}visitReference(t,e){e.updateOptions(t.options,!0),Gl(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let r=e;const s=t.options;if(s&&(s.params||s.delay)&&(r=e.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=fw);const u=_h(s.delay);r.delayNextStep(u)}t.steps.length&&(t.steps.forEach(u=>Gl(this,u,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let r=e.currentTimeline.currentTime;const s=t.options&&t.options.delay?_h(t.options.delay):0;t.steps.forEach(u=>{const m=e.createSubContext(t.options);s&&m.delayNextStep(s),Gl(this,u,m),r=Math.max(r,m.currentTimeline.currentTime),i.push(m.currentTimeline)}),i.forEach(u=>e.currentTimeline.mergeTimelineCollectedStyles(u)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return sw(e.params?uv(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());const s=t.style;5==s.type?this.visitKeyframes(s,e):(e.incrementTime(i.duration),this.visitStyle(s,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(s):i.setStyles(t.styles,s,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,r=e.currentTimeline.duration,s=i.duration,m=e.createSubContext().currentTimeline;m.easing=i.easing,t.styles.forEach(y=>{m.forwardTime((y.offset||0)*s),m.setStyles(y.styles,y.easing,e.errors,e.options),m.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(m),e.transformIntoNewTimeline(r+s),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,r=t.options||{},s=r.delay?_h(r.delay):0;s&&(6===e.previousNode.type||0==i&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=fw);let u=i;const m=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=m.length;let y=null;m.forEach((C,I)=>{e.currentQueryIndex=I;const A=e.createSubContext(t.options,C);s&&A.delayNextStep(s),C===e.element&&(y=A.currentTimeline),Gl(this,t.animation,A),A.currentTimeline.applyStylesToKeyframe(),u=Math.max(u,A.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(u),y&&(e.currentTimeline.mergeTimelineCollectedStyles(y),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,r=e.currentTimeline,s=t.timings,u=Math.abs(s.duration),m=u*(e.currentQueryTotal-1);let y=u*e.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":y=m-y;break;case"full":y=i.currentStaggerTime}const I=e.currentTimeline;y&&I.delayNextStep(y);const A=I.currentTime;Gl(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=r.currentTime-A+(r.startTime-i.currentTimeline.startTime)}}const fw={};class YT{constructor(t,e,i,r,s,u,m,y){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=u,this.timelines=m,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=fw,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=y||new mw(this._driver,e,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=_h(i.duration)),null!=i.delay&&(r.delay=_h(i.delay));const s=i.params;if(s){let u=r.params;u||(u=this.options.params={}),Object.keys(s).forEach(m=>{(!e||!u.hasOwnProperty(m))&&(u[m]=uv(s[m],u,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return t}createSubContext(t=null,e,i){const r=e||this.element,s=new YT(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(t),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(t){return this.previousNode=fw,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const r={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},s=new M5(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,r,s,u){let m=[];if(r&&m.push(this.element),t.length>0){t=(t=t.replace(T5,"."+this._enterClassName)).replace(D5,"."+this._leaveClassName);let C=this._driver.query(this.element,t,1!=i);0!==i&&(C=i<0?C.slice(C.length+i,C.length):C.slice(0,i)),m.push(...C)}return!s&&0==m.length&&u.push(function R4(n){return new zt(3014,!1)}()),m}}class mw{constructor(t,e,i,r){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new mw(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||bh),this._currentKeyframe.set(e,bh);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,r){var s;e&&this._previousKeyframe.set("easing",e);const u=r&&r.params||{},m=function A5(n,t){const e=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||t.keys();for(let s of i)e.set(s,bh)}else Op(r,e)}),e}(t,this._globalTimelineStyles);for(let[y,C]of m){const I=uv(C,u,i);this._pendingStyles.set(y,I),this._localTimelineStyles.has(y)||this._backFill.set(y,null!==(s=this._globalTimelineStyles.get(y))&&void 0!==s?s:bh),this._updateStyle(y,I)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{const r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((m,y)=>{const C=Op(m,new Map,this._backFill);C.forEach((I,A)=>{"!"===I?t.add(A):I===bh&&e.add(A)}),i||C.set("offset",y/this.duration),r.push(C)});const s=t.size?aw(t.values()):[],u=e.size?aw(e.values()):[];if(i){const m=r[0],y=new Map(m);m.set("offset",0),y.set("offset",1),r=[m,y]}return XT(this.element,r,s,u,this.duration,this.startTime,this.easing,!1)}}class M5 extends mw{constructor(t,e,i,r,s,u,m=!1){super(t,e,u.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=m,this.timings={duration:u.duration,delay:u.delay,easing:u.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const s=[],u=i+e,m=e/u,y=Op(t[0]);y.set("offset",0),s.push(y);const C=Op(t[0]);C.set("offset",uP(m)),s.push(C);const I=t.length-1;for(let A=1;A<=I;A++){let B=Op(t[A]);const j=B.get("offset");B.set("offset",uP((e+j*i)/u)),s.push(B)}i=u,e=0,r="",t=s}return XT(this.element,t,this.preStyleProps,this.postStyleProps,i,e,r,!0)}}function uP(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class KT{}const k5=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class R5 extends KT{normalizePropertyName(t,e){return qT(t)}normalizeStyleValue(t,e,i,r){let s="";const u=i.toString().trim();if(k5.has(e)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const m=i.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&0==m[1].length&&r.push(function x4(n,t){return new zt(3005,!1)}())}return u+s}}function dP(n,t,e,i,r,s,u,m,y,C,I,A,B){return{type:0,element:n,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:s,toState:i,toStyles:u,timelines:m,queriedElements:y,preStyleProps:C,postStyleProps:I,totalTime:A,errors:B}}const QT={};class hP{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,r){return function P5(n,t,e,i,r){return n.some(s=>s(t,e,i,r))}(this.ast.matchers,t,e,i,r)}buildStyles(t,e,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(null==t?void 0:t.toString())||r),r?r.buildStyles(e,i):new Map}build(t,e,i,r,s,u,m,y,C,I){var A;const B=[],j=this.ast.options&&this.ast.options.params||QT,pe=this.buildStyles(i,m&&m.params||QT,B),Se=y&&y.params||QT,Xe=this.buildStyles(r,Se,B),At=new Set,pt=new Map,kt=new Map,yn="void"===r,kn={params:L5(Se,j),delay:null===(A=this.ast.options)||void 0===A?void 0:A.delay},Si=I?[]:ZT(t,e,this.ast.animation,s,u,pe,Xe,kn,C,B);let ci=0;if(Si.forEach(ts=>{ci=Math.max(ts.duration+ts.delay,ci)}),B.length)return dP(e,this._triggerName,i,r,yn,pe,Xe,[],[],pt,kt,ci,B);Si.forEach(ts=>{const gu=ts.element,Lh=ql(pt,gu,new Set);ts.preStyleProps.forEach(_d=>Lh.add(_d));const Oh=ql(kt,gu,new Set);ts.postStyleProps.forEach(_d=>Oh.add(_d)),gu!==e&&At.add(gu)});const no=aw(At.values());return dP(e,this._triggerName,i,r,yn,pe,Xe,Si,no,pt,kt,ci)}}function L5(n,t){const e=lv(t);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(e[i]=n[i]);return e}class O5{constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){const i=new Map,r=lv(this.defaultParams);return Object.keys(t).forEach(s=>{const u=t[s];null!==u&&(r[s]=u)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((u,m)=>{u&&(u=uv(u,r,e));const y=this.normalizer.normalizePropertyName(m,e);u=this.normalizer.normalizeStyleValue(m,y,u,e),i.set(y,u)})}),i}}class N5{constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states=new Map,e.states.forEach(r=>{this.states.set(r.name,new O5(r.style,r.options&&r.options.params||{},i))}),pP(this.states,"true","1"),pP(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new hP(t,r,this.states))}),this.fallbackTransition=function B5(n,t,e){return new hP(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(u,m)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,r){return this.transitionFactories.find(u=>u.match(t,e,i,r))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function pP(n,t,e){n.has(t)?n.has(e)||n.set(e,n.get(t)):n.has(e)&&n.set(t,n.get(e))}const z5=new pw;class V5{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,e){const i=[],s=GT(this._driver,e,i,[]);if(i.length)throw function z4(n){return new zt(3503,!1)}();this._animations.set(t,s)}_buildPlayer(t,e,i){const r=t.element,s=qR(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(r,s,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const r=[],s=this._animations.get(t);let u;const m=new Map;if(s?(u=ZT(this._driver,e,s,jT,iw,new Map,new Map,i,z5,r),u.forEach(I=>{const A=ql(m,I.element,new Map);I.postStyleProps.forEach(B=>A.set(B,null))})):(r.push(function V4(){return new zt(3300,!1)}()),u=[]),r.length)throw function j4(n){return new zt(3504,!1)}();m.forEach((I,A)=>{I.forEach((B,j)=>{I.set(j,this._driver.computeStyle(A,j,bh))})});const C=Lp(u.map(I=>{const A=m.get(I.element);return this._buildPlayer(I,new Map,A)}));return this._playersById.set(t,C),C.onDestroy(()=>this.destroy(t)),this.players.push(C),C}destroy(t){const e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById.get(t);if(!e)throw function U4(n){return new zt(3301,!1)}();return e}listen(t,e,i,r){const s=NT(e,"","","");return OT(this._getPlayer(t),i,s,r),()=>{}}command(t,e,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,e,r[0]||{});const s=this._getPlayer(t);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const fP="ng-animate-queued",JT="ng-animate-disabled",q5=[],mP={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},G5={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Dc="__ng_removed";class eE{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=function Y5(n){return null!=n?n:null}(i?t.value:t),i){const s=lv(t);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const i=this.options.params;Object.keys(e).forEach(r=>{null==i[r]&&(i[r]=e[r])})}}}const dv="void",tE=new eE(dv);class W5{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Ic(e,this._hostClassName)}listen(t,e,i,r){if(!this._triggers.has(e))throw function H4(n,t){return new zt(3302,!1)}();if(null==i||0==i.length)throw function $4(n){return new zt(3303,!1)}();if(!function K5(n){return"start"==n||"done"==n}(i))throw function q4(n,t){return new zt(3400,!1)}();const s=ql(this._elementListeners,t,[]),u={name:e,phase:i,callback:r};s.push(u);const m=ql(this._engine.statesByElement,t,new Map);return m.has(e)||(Ic(t,rw),Ic(t,rw+"-"+e),m.set(e,tE)),()=>{this._engine.afterFlush(()=>{const y=s.indexOf(u);y>=0&&s.splice(y,1),this._triggers.has(e)||m.delete(e)})}}register(t,e){return!this._triggers.has(t)&&(this._triggers.set(t,e),!0)}_getTrigger(t){const e=this._triggers.get(t);if(!e)throw function G4(n){return new zt(3401,!1)}();return e}trigger(t,e,i,r=!0){const s=this._getTrigger(e),u=new nE(this.id,e,t);let m=this._engine.statesByElement.get(t);m||(Ic(t,rw),Ic(t,rw+"-"+e),this._engine.statesByElement.set(t,m=new Map));let y=m.get(e);const C=new eE(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&y&&C.absorbOptions(y.options),m.set(e,C),y||(y=tE),C.value!==dv&&y.value===C.value){if(!function eU(n,t){const e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){const s=e[r];if(!t.hasOwnProperty(s)||n[s]!==t[s])return!1}return!0}(y.params,C.params)){const pe=[],Se=s.matchStyles(y.value,y.params,pe),Xe=s.matchStyles(C.value,C.params,pe);pe.length?this._engine.reportError(pe):this._engine.afterFlush(()=>{gm(t,Se),ld(t,Xe)})}return}const B=ql(this._engine.playersByElement,t,[]);B.forEach(pe=>{pe.namespaceId==this.id&&pe.triggerName==e&&pe.queued&&pe.destroy()});let j=s.matchTransition(y.value,C.value,t,C.params),K=!1;if(!j){if(!r)return;j=s.fallbackTransition,K=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:j,fromState:y,toState:C,player:u,isFallbackTransition:K}),K||(Ic(t,fP),u.onStart(()=>{Nb(t,fP)})),u.onDone(()=>{let pe=this.players.indexOf(u);pe>=0&&this.players.splice(pe,1);const Se=this._engine.playersByElement.get(t);if(Se){let Xe=Se.indexOf(u);Xe>=0&&Se.splice(Xe,1)}}),this.players.push(u),B.push(u),u}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,ow,!0);i.forEach(r=>{if(r[Dc])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(u=>u.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,i,r){const s=this._engine.statesByElement.get(t),u=new Map;if(s){const m=[];if(s.forEach((y,C)=>{if(u.set(C,y.value),this._triggers.has(C)){const I=this.trigger(t,C,dv,r);I&&m.push(I)}}),m.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,u),i&&Lp(m).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const r=new Set;e.forEach(s=>{const u=s.name;if(r.has(u))return;r.add(u);const y=this._triggers.get(u).fallbackTransition,C=i.get(u)||tE,I=new eE(dv),A=new nE(this.id,u,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:u,transition:y,fromState:C,toState:I,player:A,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(t):[];if(s&&s.length)r=!0;else{let u=t;for(;u=u.parentNode;)if(i.statesByElement.get(u)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,e);else{const s=t[Dc];(!s||s===mP)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){Ic(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,u=this._elementListeners.get(s);u&&u.forEach(m=>{if(m.name==i.triggerName){const y=NT(s,i.triggerName,i.fromState.value,i.toState.value);y._data=t,OT(i.player,m.phase,y,m.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{const s=i.transition.ast.depCount,u=r.transition.ast.depCount;return 0==s||0==u?s-u:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(i=>i.element===t)||e,e}}class X5{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){const i=new W5(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let u=!1,m=this.driver.getParentElement(e);for(;m;){const y=r.get(m);if(y){const C=i.indexOf(y);i.splice(C+1,0,t),u=!0;break}m=this.driver.getParentElement(m)}u||i.unshift(t)}else i.push(t);return r.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let r=this._namespaceLookup[t];r&&r.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&e.add(s)}return e}trigger(t,e,i,r){if(gw(e)){const s=this._fetchNamespace(t);if(s)return s.trigger(e,i,r),!0}return!1}insertNode(t,e,i,r){if(!gw(e))return;const s=e[Dc];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const u=this.collectedLeaveElements.indexOf(e);u>=0&&this.collectedLeaveElements.splice(u,1)}if(t){const u=this._fetchNamespace(t);u&&u.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Ic(t,JT)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Nb(t,JT))}removeNode(t,e,i,r){if(gw(e)){const s=t?this._fetchNamespace(t):null;if(s?s.removeNode(e,r):this.markElementAsRemoved(t,e,!1,r),i){const u=this.namespacesByHostElement.get(e);u&&u.id!==t&&u.removeNode(e,r)}}else this._onRemovalComplete(e,r)}markElementAsRemoved(t,e,i,r,s){this.collectedLeaveElements.push(e),e[Dc]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(t,e,i,r,s){return gw(e)?this._fetchNamespace(t).listen(e,i,r,s):()=>{}}_buildInstruction(t,e,i,r,s){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,e,s)}destroyInnerAnimations(t){let e=this.driver.query(t,ow,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,UT,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Lp(this.players).onDone(()=>t());t()})}processLeaveNode(t){var e;const i=t[Dc];if(i&&i.setForRemoval){if(t[Dc]=mP,i.namespaceId){this.destroyInnerAnimations(t);const r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}!(null===(e=t.classList)||void 0===e)&&e.contains(JT)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Ic(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?Lp(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function W4(n){return new zt(3402,!1)}()}_flushAnimations(t,e){const i=new pw,r=[],s=new Map,u=[],m=new Map,y=new Map,C=new Map,I=new Set;this.disabledNodes.forEach(zn=>{I.add(zn);const Qn=this.driver.query(zn,".ng-animate-queued",!0);for(let ui=0;ui<Qn.length;ui++)I.add(Qn[ui])});const A=this.bodyNode,B=Array.from(this.statesByElement.keys()),j=_P(B,this.collectedEnterElements),K=new Map;let pe=0;j.forEach((zn,Qn)=>{const ui=jT+pe++;K.set(Qn,ui),zn.forEach(dr=>Ic(dr,ui))});const Se=[],Xe=new Set,At=new Set;for(let zn=0;zn<this.collectedLeaveElements.length;zn++){const Qn=this.collectedLeaveElements[zn],ui=Qn[Dc];ui&&ui.setForRemoval&&(Se.push(Qn),Xe.add(Qn),ui.hasAnimation?this.driver.query(Qn,".ng-star-inserted",!0).forEach(dr=>Xe.add(dr)):At.add(Qn))}const pt=new Map,kt=_P(B,Array.from(Xe));kt.forEach((zn,Qn)=>{const ui=iw+pe++;pt.set(Qn,ui),zn.forEach(dr=>Ic(dr,ui))}),t.push(()=>{j.forEach((zn,Qn)=>{const ui=K.get(Qn);zn.forEach(dr=>Nb(dr,ui))}),kt.forEach((zn,Qn)=>{const ui=pt.get(Qn);zn.forEach(dr=>Nb(dr,ui))}),Se.forEach(zn=>{this.processLeaveNode(zn)})});const yn=[],kn=[];for(let zn=this._namespaceList.length-1;zn>=0;zn--)this._namespaceList[zn].drainQueuedTransitions(e).forEach(ui=>{const dr=ui.player,Uo=ui.element;if(yn.push(dr),this.collectedEnterElements.length){const Ca=Uo[Dc];if(Ca&&Ca.setForMove){if(Ca.previousTriggersValues&&Ca.previousTriggersValues.has(ui.triggerName)){const Hm=Ca.previousTriggersValues.get(ui.triggerName),Pc=this.statesByElement.get(ui.element);if(Pc&&Pc.has(ui.triggerName)){const s1=Pc.get(ui.triggerName);s1.value=Hm,Pc.set(ui.triggerName,s1)}}return void dr.destroy()}}const yd=!A||!this.driver.containsElement(A,Uo),Zl=pt.get(Uo),Jp=K.get(Uo),Lo=this._buildInstruction(ui,i,Jp,Zl,yd);if(Lo.errors&&Lo.errors.length)return void kn.push(Lo);if(yd)return dr.onStart(()=>gm(Uo,Lo.fromStyles)),dr.onDestroy(()=>ld(Uo,Lo.toStyles)),void r.push(dr);if(ui.isFallbackTransition)return dr.onStart(()=>gm(Uo,Lo.fromStyles)),dr.onDestroy(()=>ld(Uo,Lo.toStyles)),void r.push(dr);const dB=[];Lo.timelines.forEach(Ca=>{Ca.stretchStartingKeyframe=!0,this.disabledNodes.has(Ca.element)||dB.push(Ca)}),Lo.timelines=dB,i.append(Uo,Lo.timelines),u.push({instruction:Lo,player:dr,element:Uo}),Lo.queriedElements.forEach(Ca=>ql(m,Ca,[]).push(dr)),Lo.preStyleProps.forEach((Ca,Hm)=>{if(Ca.size){let Pc=y.get(Hm);Pc||y.set(Hm,Pc=new Set),Ca.forEach((s1,NI)=>Pc.add(NI))}}),Lo.postStyleProps.forEach((Ca,Hm)=>{let Pc=C.get(Hm);Pc||C.set(Hm,Pc=new Set),Ca.forEach((s1,NI)=>Pc.add(NI))})});if(kn.length){const zn=[];kn.forEach(Qn=>{zn.push(function X4(n,t){return new zt(3505,!1)}())}),yn.forEach(Qn=>Qn.destroy()),this.reportError(zn)}const Si=new Map,ci=new Map;u.forEach(zn=>{const Qn=zn.element;i.has(Qn)&&(ci.set(Qn,Qn),this._beforeAnimationBuild(zn.player.namespaceId,zn.instruction,Si))}),r.forEach(zn=>{const Qn=zn.element;this._getPreviousPlayers(Qn,!1,zn.namespaceId,zn.triggerName,null).forEach(dr=>{ql(Si,Qn,[]).push(dr),dr.destroy()})});const no=Se.filter(zn=>vP(zn,y,C)),ts=new Map;bP(ts,this.driver,At,C,bh).forEach(zn=>{vP(zn,y,C)&&no.push(zn)});const Lh=new Map;j.forEach((zn,Qn)=>{bP(Lh,this.driver,new Set(zn),y,"!")}),no.forEach(zn=>{var Qn,ui;const dr=ts.get(zn),Uo=Lh.get(zn);ts.set(zn,new Map([...Array.from(null!==(Qn=null==dr?void 0:dr.entries())&&void 0!==Qn?Qn:[]),...Array.from(null!==(ui=null==Uo?void 0:Uo.entries())&&void 0!==ui?ui:[])]))});const Oh=[],_d=[],h_={};u.forEach(zn=>{const{element:Qn,player:ui,instruction:dr}=zn;if(i.has(Qn)){if(I.has(Qn))return ui.onDestroy(()=>ld(Qn,dr.toStyles)),ui.disabled=!0,ui.overrideTotalTime(dr.totalTime),void r.push(ui);let Uo=h_;if(ci.size>1){let Zl=Qn;const Jp=[];for(;Zl=Zl.parentNode;){const Lo=ci.get(Zl);if(Lo){Uo=Lo;break}Jp.push(Zl)}Jp.forEach(Lo=>ci.set(Lo,Uo))}const yd=this._buildAnimation(ui.namespaceId,dr,Si,s,Lh,ts);if(ui.setRealPlayer(yd),Uo===h_)Oh.push(ui);else{const Zl=this.playersByElement.get(Uo);Zl&&Zl.length&&(ui.parentPlayer=Lp(Zl)),r.push(ui)}}else gm(Qn,dr.fromStyles),ui.onDestroy(()=>ld(Qn,dr.toStyles)),_d.push(ui),I.has(Qn)&&r.push(ui)}),_d.forEach(zn=>{const Qn=s.get(zn.element);if(Qn&&Qn.length){const ui=Lp(Qn);zn.setRealPlayer(ui)}}),r.forEach(zn=>{zn.parentPlayer?zn.syncPlayerEvents(zn.parentPlayer):zn.destroy()});for(let zn=0;zn<Se.length;zn++){const Qn=Se[zn],ui=Qn[Dc];if(Nb(Qn,iw),ui&&ui.hasAnimation)continue;let dr=[];if(m.size){let yd=m.get(Qn);yd&&yd.length&&dr.push(...yd);let Zl=this.driver.query(Qn,UT,!0);for(let Jp=0;Jp<Zl.length;Jp++){let Lo=m.get(Zl[Jp]);Lo&&Lo.length&&dr.push(...Lo)}}const Uo=dr.filter(yd=>!yd.destroyed);Uo.length?Q5(this,Qn,Uo):this.processLeaveNode(Qn)}return Se.length=0,Oh.forEach(zn=>{this.players.push(zn),zn.onDone(()=>{zn.destroy();const Qn=this.players.indexOf(zn);this.players.splice(Qn,1)}),zn.play()}),Oh}elementContainsData(t,e){let i=!1;const r=e[Dc];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,r,s){let u=[];if(e){const m=this.playersByQueriedElement.get(t);m&&(u=m)}else{const m=this.playersByElement.get(t);if(m){const y=!s||s==dv;m.forEach(C=>{C.queued||!y&&C.triggerName!=r||u.push(C)})}}return(i||r)&&(u=u.filter(m=>!(i&&i!=m.namespaceId||r&&r!=m.triggerName))),u}_beforeAnimationBuild(t,e,i){const s=e.element,u=e.isRemovalTransition?void 0:t,m=e.isRemovalTransition?void 0:e.triggerName;for(const y of e.timelines){const C=y.element,I=C!==s,A=ql(i,C,[]);this._getPreviousPlayers(C,I,u,m,e.toState).forEach(j=>{const K=j.getRealPlayer();K.beforeDestroy&&K.beforeDestroy(),j.destroy(),A.push(j)})}gm(s,e.fromStyles)}_buildAnimation(t,e,i,r,s,u){const m=e.triggerName,y=e.element,C=[],I=new Set,A=new Set,B=e.timelines.map(K=>{const pe=K.element;I.add(pe);const Se=pe[Dc];if(Se&&Se.removedBeforeQueried)return new av(K.duration,K.delay);const Xe=pe!==y,At=function J5(n){const t=[];return yP(n,t),t}((i.get(pe)||q5).map(Si=>Si.getRealPlayer())).filter(Si=>!!Si.element&&Si.element===pe),pt=s.get(pe),kt=u.get(pe),yn=qR(0,this._normalizer,0,K.keyframes,pt,kt),kn=this._buildPlayer(K,yn,At);if(K.subTimeline&&r&&A.add(pe),Xe){const Si=new nE(t,m,pe);Si.setRealPlayer(kn),C.push(Si)}return kn});C.forEach(K=>{ql(this.playersByQueriedElement,K.element,[]).push(K),K.onDone(()=>function Z5(n,t,e){let i=n.get(t);if(i){if(i.length){const r=i.indexOf(e);i.splice(r,1)}0==i.length&&n.delete(t)}return i}(this.playersByQueriedElement,K.element,K))}),I.forEach(K=>Ic(K,eP));const j=Lp(B);return j.onDestroy(()=>{I.forEach(K=>Nb(K,eP)),ld(y,e.toStyles)}),A.forEach(K=>{ql(r,K,[]).push(j)}),j}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new av(t.duration,t.delay)}}class nE{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new av,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>OT(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){ql(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function gw(n){return n&&1===n.nodeType}function gP(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function bP(n,t,e,i,r){const s=[];e.forEach(y=>s.push(gP(y)));const u=[];i.forEach((y,C)=>{const I=new Map;y.forEach(A=>{const B=t.computeStyle(C,A,r);I.set(A,B),(!B||0==B.length)&&(C[Dc]=G5,u.push(C))}),n.set(C,I)});let m=0;return e.forEach(y=>gP(y,s[m++])),u}function _P(n,t){const e=new Map;if(n.forEach(m=>e.set(m,[])),0==t.length)return e;const r=new Set(t),s=new Map;function u(m){if(!m)return 1;let y=s.get(m);if(y)return y;const C=m.parentNode;return y=e.has(C)?C:r.has(C)?1:u(C),s.set(m,y),y}return t.forEach(m=>{const y=u(m);1!==y&&e.get(y).push(m)}),e}function Ic(n,t){var e;null===(e=n.classList)||void 0===e||e.add(t)}function Nb(n,t){var e;null===(e=n.classList)||void 0===e||e.remove(t)}function Q5(n,t,e){Lp(e).onDone(()=>n.processLeaveNode(t))}function yP(n,t){for(let e=0;e<n.length;e++){const i=n[e];i instanceof HR?yP(i.players,t):t.push(i)}}function vP(n,t,e){const i=e.get(n);if(!i)return!1;let r=t.get(n);return r?i.forEach(s=>r.add(s)):t.set(n,i),e.delete(n),!0}class bw{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new X5(t,e,i),this._timelineEngine=new V5(t,e,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(t,e,i,r,s){const u=t+"-"+r;let m=this._triggerCache[u];if(!m){const y=[],I=GT(this._driver,s,y,[]);if(y.length)throw function N4(n,t){return new zt(3404,!1)}();m=function F5(n,t,e){return new N5(n,t,e)}(r,I,this._normalizer),this._triggerCache[u]=m}this._transitionEngine.registerTrigger(e,r,m)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,r){this._transitionEngine.insertNode(t,e,i,r)}onRemove(t,e,i,r){this._transitionEngine.removeNode(t,e,r||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,r){if("@"==i.charAt(0)){const[s,u]=GR(i);this._timelineEngine.command(s,e,u,r)}else this._transitionEngine.trigger(t,e,i,r)}listen(t,e,i,r,s){if("@"==i.charAt(0)){const[u,m]=GR(i);return this._timelineEngine.listen(u,e,m,s)}return this._transitionEngine.listen(t,e,i,r,s)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let nU=(()=>{class n{constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(e);s||n.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&ld(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ld(this._element,this._initialStyles),this._endStyles&&(ld(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(gm(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(gm(this._element,this._endStyles),this._endStyles=null),ld(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function iE(n){let t=null;return n.forEach((e,i)=>{(function iU(n){return"display"===n||"position"===n})(i)&&(t=t||new Map,t.set(i,e))}),t}class xP{constructor(t,e,i,r){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){return t.animate(this._convertKeyframesToObject(e),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:sP(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const e="start"===t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class rU{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,e){return!1}containsElement(t,e){return YR(t,e)}getParentElement(t){return zT(t)}query(t,e,i){return KR(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}animate(t,e,i,r,s,u=[]){const y={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(y.easing=s);const C=new Map,I=u.filter(j=>j instanceof xP);(function l5(n,t){return 0===n||0===t})(i,r)&&I.forEach(j=>{j.currentSnapshot.forEach((K,pe)=>C.set(pe,K))});let A=function r5(n){return n.length?n[0]instanceof Map?n:n.map(t=>tP(t)):[]}(e).map(j=>Op(j));A=function c5(n,t,e){if(e.size&&t.length){let i=t[0],r=[];if(e.forEach((s,u)=>{i.has(u)||r.push(u),i.set(u,s)}),r.length)for(let s=1;s<t.length;s++){let u=t[s];r.forEach(m=>u.set(m,sP(n,m)))}}return t}(t,A,C);const B=function tU(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=iE(t[0]),t.length>1&&(i=iE(t[t.length-1]))):t instanceof Map&&(e=iE(t)),e||i?new nU(n,e,i):null}(t,A);return new xP(t,A,y,B)}}let oU=(()=>{class n extends zR{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:Ws.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(e)?jR(e):e;return wP(this._renderer,null,i,"register",[r]),new sU(i,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(je(Kf),je(Gn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();class sU extends class m4{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new aU(this._id,t,e||{},this._renderer)}}class aU{constructor(t,e,i,r){this.id=t,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return wP(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function wP(n,t,e,i,r){return n.setProperty(t,`@@${e}:${i}`,r)}const SP="@.disabled";let lU=(()=>{class n{constructor(e,i,r){this.delegate=e,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,u)=>{const m=null==u?void 0:u.parentNode(s);m&&u.removeChild(m,s)}}createRenderer(e,i){const s=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let I=this._rendererCache.get(s);return I||(I=new CP("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,I)),I}const u=i.id,m=i.id+"-"+this._currentId;this._currentId++,this.engine.register(m,e);const y=I=>{Array.isArray(I)?I.forEach(y):this.engine.registerTrigger(u,m,e,I.name,I)};return i.data.animation.forEach(y),new cU(this,m,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,r){e>=0&&e<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[u,m]=s;u(m)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(je(Kf),je(bw),je(Xn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();class CP{constructor(t,e,i,r){this.namespaceId=t,this.delegate=e,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?s=>e.destroyNode(s):null}get data(){return this.delegate.data}destroy(){var t;this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),null===(t=this._onDestroy)||void 0===t||t.call(this)}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,r=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,r){this.delegate.setAttribute(t,e,i,r)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,r){this.delegate.setStyle(t,e,i,r)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){"@"==e.charAt(0)&&e==SP?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class cU extends CP{constructor(t,e,i,r,s){super(e,i,r,s),this.factory=t,this.namespaceId=e}setProperty(t,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==SP?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if("@"==e.charAt(0)){const r=function uU(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let s=e.slice(1),u="";return"@"!=s.charAt(0)&&([s,u]=function dU(n){const t=n.indexOf(".");return[n.substring(0,t),n.slice(t+1)]}(s)),this.engine.listen(this.namespaceId,r,s,u,m=>{this.factory.scheduleListenerCallback(m._data||-1,i,m)})}return this.delegate.listen(t,e,i)}}const TP=[{provide:zR,useClass:oU},{provide:KT,useFactory:function pU(){return new R5}},{provide:bw,useClass:(()=>{class n extends bw{constructor(e,i,r,s){super(e.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(je(Gn),je(VT),je(KT),je(Lb))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})()},{provide:Kf,useFactory:function fU(n,t,e){return new lU(n,t,e)},deps:[nw,bw,Xn]}],rE=[{provide:VT,useFactory:()=>new rU},{provide:rd,useValue:"BrowserAnimations"},...TP],EP=[{provide:VT,useClass:QR},{provide:rd,useValue:"NoopAnimations"},...TP];let mU=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?EP:rE}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:rE,imports:[PR]}),n})();function Ln(...n){return ro(n,Oc(n))}function Fp(n,t){return ye(t)?Wn(n,t,1):Wn(n,1)}function Tr(n,t){return ki((e,i)=>{let r=0;e.subscribe(Ii(i,s=>n.call(t,s,r++)&&i.next(s)))})}class DP{}class IP{}class yh{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),s=r.toLowerCase(),u=e.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(u):this.headers.set(s,[u])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const r=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof yh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new yh;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof yh?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const s=t.value;if(s){let u=this.headers.get(e);if(!u)return;u=u.filter(m=>-1===s.indexOf(m)),0===u.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,u)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class gU{encodeKey(t){return MP(t)}encodeValue(t){return MP(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const _U=/%(\d[a-f0-9])/gi,yU={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function MP(n){return encodeURIComponent(n).replace(_U,(t,e)=>{var i;return null!==(i=yU[e])&&void 0!==i?i:t})}function yw(n){return`${n}`}class Np{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new gU,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function bU(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[u,m]=-1==s?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,s)),t.decodeValue(r.slice(s+1))],y=e.get(u)||[];y.push(m),e.set(u,y)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],r=Array.isArray(i)?i.map(yw):[yw(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(s=>{e.push({param:i,value:s,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new Np({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(yw(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(yw(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class vU{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function AP(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function kP(n){return"undefined"!=typeof Blob&&n instanceof Blob}function RP(n){return"undefined"!=typeof FormData&&n instanceof FormData}class hv{constructor(t,e,i,r){let s;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function xU(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new yh),this.context||(this.context=new vU),this.params){const u=this.params.toString();if(0===u.length)this.urlWithParams=e;else{const m=e.indexOf("?");this.urlWithParams=e+(-1===m?"?":m<e.length-1?"&":"")+u}}else this.params=new Np,this.urlWithParams=e}serializeBody(){return null===this.body?null:AP(this.body)||kP(this.body)||RP(this.body)||function wU(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Np?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||RP(this.body)?null:kP(this.body)?this.body.type||null:AP(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Np?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const i=t.method||this.method,r=t.url||this.url,s=t.responseType||this.responseType,u=void 0!==t.body?t.body:this.body,m=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,y=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let C=t.headers||this.headers,I=t.params||this.params;const A=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(C=Object.keys(t.setHeaders).reduce((B,j)=>B.set(j,t.setHeaders[j]),C)),t.setParams&&(I=Object.keys(t.setParams).reduce((B,j)=>B.set(j,t.setParams[j]),I)),new hv(i,r,u,{params:I,headers:C,context:A,reportProgress:y,responseType:s,withCredentials:m})}}var ds=(()=>((ds=ds||{})[ds.Sent=0]="Sent",ds[ds.UploadProgress=1]="UploadProgress",ds[ds.ResponseHeader=2]="ResponseHeader",ds[ds.DownloadProgress=3]="DownloadProgress",ds[ds.Response=4]="Response",ds[ds.User=5]="User",ds))();class oE{constructor(t,e=200,i="OK"){this.headers=t.headers||new yh,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class sE extends oE{constructor(t={}){super(t),this.type=ds.ResponseHeader}clone(t={}){return new sE({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class vw extends oE{constructor(t={}){super(t),this.type=ds.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new vw({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class PP extends oE{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function aE(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let LP=(()=>{class n{constructor(e){this.handler=e}request(e,i,r={}){let s;if(e instanceof hv)s=e;else{let y,C;y=r.headers instanceof yh?r.headers:new yh(r.headers),r.params&&(C=r.params instanceof Np?r.params:new Np({fromObject:r.params})),s=new hv(e,i,void 0!==r.body?r.body:null,{headers:y,context:r.context,params:C,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const u=Ln(s).pipe(Fp(y=>this.handler.handle(y)));if(e instanceof hv||"events"===r.observe)return u;const m=u.pipe(Tr(y=>y instanceof vw));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return m.pipe(W(y=>{if(null!==y.body&&!(y.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return y.body}));case"blob":return m.pipe(W(y=>{if(null!==y.body&&!(y.body instanceof Blob))throw new Error("Response is not a Blob.");return y.body}));case"text":return m.pipe(W(y=>{if(null!==y.body&&"string"!=typeof y.body)throw new Error("Response is not a string.");return y.body}));default:return m.pipe(W(y=>y.body))}case"response":return m;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new Np).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,aE(r,i))}post(e,i,r={}){return this.request("POST",e,aE(r,i))}put(e,i,r={}){return this.request("PUT",e,aE(r,i))}}return n.\u0275fac=function(e){return new(e||n)(je(DP))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();class OP{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const FP=new It("HTTP_INTERCEPTORS");let SU=(()=>{class n{intercept(e,i){return i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();const CU=/^\)\]\}',?\n/;let NP=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Lt(i=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((j,K)=>r.setRequestHeader(j,K.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const j=e.detectContentTypeHeader();null!==j&&r.setRequestHeader("Content-Type",j)}if(e.responseType){const j=e.responseType.toLowerCase();r.responseType="json"!==j?j:"text"}const s=e.serializeBody();let u=null;const m=()=>{if(null!==u)return u;const j=r.statusText||"OK",K=new yh(r.getAllResponseHeaders()),pe=function TU(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||e.url;return u=new sE({headers:K,status:r.status,statusText:j,url:pe}),u},y=()=>{let{headers:j,status:K,statusText:pe,url:Se}=m(),Xe=null;204!==K&&(Xe=void 0===r.response?r.responseText:r.response),0===K&&(K=Xe?200:0);let At=K>=200&&K<300;if("json"===e.responseType&&"string"==typeof Xe){const pt=Xe;Xe=Xe.replace(CU,"");try{Xe=""!==Xe?JSON.parse(Xe):null}catch(kt){Xe=pt,At&&(At=!1,Xe={error:kt,text:Xe})}}At?(i.next(new vw({body:Xe,headers:j,status:K,statusText:pe,url:Se||void 0})),i.complete()):i.error(new PP({error:Xe,headers:j,status:K,statusText:pe,url:Se||void 0}))},C=j=>{const{url:K}=m(),pe=new PP({error:j,status:r.status||0,statusText:r.statusText||"Unknown Error",url:K||void 0});i.error(pe)};let I=!1;const A=j=>{I||(i.next(m()),I=!0);let K={type:ds.DownloadProgress,loaded:j.loaded};j.lengthComputable&&(K.total=j.total),"text"===e.responseType&&!!r.responseText&&(K.partialText=r.responseText),i.next(K)},B=j=>{let K={type:ds.UploadProgress,loaded:j.loaded};j.lengthComputable&&(K.total=j.total),i.next(K)};return r.addEventListener("load",y),r.addEventListener("error",C),r.addEventListener("timeout",C),r.addEventListener("abort",C),e.reportProgress&&(r.addEventListener("progress",A),null!==s&&r.upload&&r.upload.addEventListener("progress",B)),r.send(s),i.next({type:ds.Sent}),()=>{r.removeEventListener("error",C),r.removeEventListener("abort",C),r.removeEventListener("load",y),r.removeEventListener("timeout",C),e.reportProgress&&(r.removeEventListener("progress",A),null!==s&&r.upload&&r.upload.removeEventListener("progress",B)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(je(pR))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();const lE=new It("XSRF_COOKIE_NAME"),cE=new It("XSRF_HEADER_NAME");class BP{}let EU=(()=>{class n{constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=tR(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(je(Gn),je(Px),je(lE))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),uE=(()=>{class n{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(e);const s=this.tokenService.getToken();return null!==s&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,s)})),i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(je(BP),je(cE))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),DU=(()=>{class n{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(FP,[]);this.chain=i.reduceRight((r,s)=>new OP(r,s),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(je(IP),je(Nr))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),IU=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:uE,useClass:SU}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:lE,useValue:e.cookieName}:[],e.headerName?{provide:cE,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[uE,{provide:FP,useExisting:uE,multi:!0},{provide:BP,useClass:EU},{provide:lE,useValue:"XSRF-TOKEN"},{provide:cE,useValue:"X-XSRF-TOKEN"}]}),n})(),MU=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[LP,{provide:DP,useClass:DU},NP,{provide:IP,useExisting:NP}],imports:[IU.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})();const{isArray:AU}=Array,{getPrototypeOf:kU,prototype:RU,keys:PU}=Object;function zP(n){if(1===n.length){const t=n[0];if(AU(t))return{args:t,keys:null};if(function LU(n){return n&&"object"==typeof n&&kU(n)===RU}(t)){const e=PU(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:OU}=Array;function dE(n){return W(t=>function FU(n,t){return OU(t)?n(...t):n(t)}(n,t))}function VP(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function jP(...n){const t=Bh(n),{args:e,keys:i}=zP(n),r=new Lt(s=>{const{length:u}=e;if(!u)return void s.complete();const m=new Array(u);let y=u,C=u;for(let I=0;I<u;I++){let A=!1;Bi(e[I]).subscribe(Ii(s,B=>{A||(A=!0,C--),m[I]=B},()=>y--,void 0,()=>{(!y||!A)&&(C||s.next(i?VP(i,m):m),s.complete())}))}});return t?r.pipe(dE(t)):r}let UP=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return n.\u0275fac=function(e){return new(e||n)(H(gc),H(En))},n.\u0275dir=Bt({type:n}),n})(),_m=(()=>{class n extends UP{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,features:[Xt]}),n})();const Za=new It("NgValueAccessor"),BU={provide:Za,useExisting:zi(()=>Mc),multi:!0},VU=new It("CompositionEventMode");let Mc=(()=>{class n extends UP{constructor(e,i,r){super(e,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function zU(){const n=ad()?ad().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return n.\u0275fac=function(e){return new(e||n)(H(gc),H(En),H(VU,8))},n.\u0275dir=Bt({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,i){1&e&&Ft("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},features:[Un([BU]),Xt]}),n})();function Bp(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function $P(n){return null!=n&&"number"==typeof n.length}const $s=new It("NgValidators"),zp=new It("NgAsyncValidators"),UU=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class hE{static min(t){return function qP(n){return t=>{if(Bp(t.value)||Bp(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}(t)}static max(t){return function GP(n){return t=>{if(Bp(t.value)||Bp(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}(t)}static required(t){return WP(t)}static requiredTrue(t){return XP(t)}static email(t){return function ZP(n){return Bp(n.value)||UU.test(n.value)?null:{email:!0}}(t)}static minLength(t){return function YP(n){return t=>Bp(t.value)||!$P(t.value)?null:t.value.length<n?{minlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function KP(n){return t=>$P(t.value)&&t.value.length>n?{maxlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static pattern(t){return function QP(n){if(!n)return xw;let t,e;return"string"==typeof n?(e="","^"!==n.charAt(0)&&(e+="^"),e+=n,"$"!==n.charAt(n.length-1)&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(Bp(i.value))return null;const r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(t)}static nullValidator(t){return null}static compose(t){return o2(t)}static composeAsync(t){return s2(t)}}function WP(n){return Bp(n.value)?{required:!0}:null}function XP(n){return!0===n.value?null:{required:!0}}function xw(n){return null}function JP(n){return null!=n}function e2(n){return zy(n)?ro(n):n}function t2(n){let t={};return n.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function n2(n,t){return t.map(e=>e(n))}function r2(n){return n.map(t=>function HU(n){return!n.validate}(t)?t:e=>t.validate(e))}function o2(n){if(!n)return null;const t=n.filter(JP);return 0==t.length?null:function(e){return t2(n2(e,t))}}function pE(n){return null!=n?o2(r2(n)):null}function s2(n){if(!n)return null;const t=n.filter(JP);return 0==t.length?null:function(e){return jP(n2(e,t).map(e2)).pipe(W(t2))}}function fE(n){return null!=n?s2(r2(n)):null}function a2(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function l2(n){return n._rawValidators}function c2(n){return n._rawAsyncValidators}function mE(n){return n?Array.isArray(n)?n:[n]:[]}function ww(n,t){return Array.isArray(n)?n.includes(t):n===t}function u2(n,t){const e=mE(t);return mE(n).forEach(r=>{ww(e,r)||e.push(r)}),e}function d2(n,t){return mE(t).filter(e=>!ww(n,e))}class h2{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=pE(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=fE(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class Wl extends h2{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Ya extends h2{get formDirective(){return null}get path(){return null}}let uu=(()=>{class n extends class p2{constructor(t){this._cd=t}get isTouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.touched)}get isUntouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.untouched)}get isPristine(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pristine)}get isDirty(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.dirty)}get isValid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.valid)}get isInvalid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.invalid)}get isPending(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pending)}get isSubmitted(){var t;return!(null===(t=this._cd)||void 0===t||!t.submitted)}}{constructor(e){super(e)}}return n.\u0275fac=function(e){return new(e||n)(H(Wl,2))},n.\u0275dir=Bt({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,i){2&e&&Li("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Xt]}),n})();const pv="VALID",Cw="INVALID",Bb="PENDING",fv="DISABLED";function yE(n){return(Tw(n)?n.validators:n)||null}function m2(n){return Array.isArray(n)?pE(n):n||null}function vE(n,t){return(Tw(t)?t.asyncValidators:n)||null}function g2(n){return Array.isArray(n)?fE(n):n||null}function Tw(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class y2{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=m2(this._rawValidators),this._composedAsyncValidatorFn=g2(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===pv}get invalid(){return this.status===Cw}get pending(){return this.status==Bb}get disabled(){return this.status===fv}get enabled(){return this.status!==fv}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=m2(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=g2(t)}addValidators(t){this.setValidators(u2(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(u2(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(d2(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(d2(t,this._rawAsyncValidators))}hasValidator(t){return ww(this._rawValidators,t)}hasAsyncValidator(t){return ww(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Bb,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=fv,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=pv,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===pv||this.status===Bb)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?fv:pv}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Bb,this._hasOwnPendingAsyncValidator=!0;const e=e2(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new tn,this.statusChanges=new tn}_calculateStatus(){return this._allControlsDisabled()?fv:this.errors?Cw:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Bb)?Bb:this._anyControlsHaveStatus(Cw)?Cw:pv}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Tw(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}class xE extends y2{constructor(t,e,i){super(yE(e),vE(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){(function _2(n,t,e){n._forEachChild((i,r)=>{if(void 0===e[r])throw new zt(1002,"")})})(this,0,t),Object.keys(t).forEach(i=>{(function b2(n,t,e){const i=n.controls;if(!(t?Object.keys(i):i).length)throw new zt(1e3,"");if(!i[e])throw new zt(1001,"")})(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(i=>{const r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,s)=>{i=e(i,r,s)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}function mv(n,t){var e,i;wE(n,t),t.valueAccessor.writeValue(n.value),n.disabled&&(null===(i=(e=t.valueAccessor).setDisabledState)||void 0===i||i.call(e,!0)),function JU(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&v2(n,t)})}(n,t),function tH(n,t){const e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function eH(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&v2(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function QU(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function Dw(n,t,e=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),Mw(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Iw(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function wE(n,t){const e=l2(n);null!==t.validator?n.setValidators(a2(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=c2(n);null!==t.asyncValidator?n.setAsyncValidators(a2(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();Iw(t._rawValidators,r),Iw(t._rawAsyncValidators,r)}function Mw(n,t){let e=!1;if(null!==n){if(null!==t.validator){const r=l2(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(u=>u!==t.validator);s.length!==r.length&&(e=!0,n.setValidators(s))}}if(null!==t.asyncValidator){const r=c2(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(u=>u!==t.asyncValidator);s.length!==r.length&&(e=!0,n.setAsyncValidators(s))}}}const i=()=>{};return Iw(t._rawValidators,i),Iw(t._rawAsyncValidators,i),e}function v2(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function x2(n,t){wE(n,t)}function SE(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}function S2(n,t){n._syncPendingControls(),t.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function CE(n,t){if(!t)return null;let e,i,r;return Array.isArray(t),t.forEach(s=>{s.constructor===Mc?e=s:function rH(n){return Object.getPrototypeOf(n.constructor)===_m}(s)?i=s:r=s}),r||i||e||null}const sH={provide:Ya,useExisting:zi(()=>zb)},gv=(()=>Promise.resolve())();let zb=(()=>{class n extends Ya{constructor(e,i){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new tn,this.form=new xE({},pE(e),fE(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){gv.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),mv(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){gv.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){gv.then(()=>{const i=this._findContainer(e.path),r=new xE({});x2(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){gv.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){gv.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){var i;return this.submitted=!0,S2(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return n.\u0275fac=function(e){return new(e||n)(H($s,10),H(zp,10))},n.\u0275dir=Bt({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,i){1&e&&Ft("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Un([sH]),Xt]}),n})();function C2(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function T2(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const Aw=class extends y2{constructor(t=null,e,i){super(yE(e),vE(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Tw(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=T2(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){C2(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){C2(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){T2(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},cH={provide:Wl,useExisting:zi(()=>cd)},I2=(()=>Promise.resolve())();let cd=(()=>{class n extends Wl{constructor(e,i,r,s,u){super(),this._changeDetectorRef=u,this.control=new Aw,this._registered=!1,this.update=new tn,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=CE(0,s)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),SE(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){mv(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){I2.then(()=>{var i;this.control.setValue(e,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&fh(i);I2.then(()=>{var s;r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),null===(s=this._changeDetectorRef)||void 0===s||s.markForCheck()})}_getPath(e){return this._parent?function Ew(n,t){return[...t.path,n]}(e,this._parent):[e]}}return n.\u0275fac=function(e){return new(e||n)(H(Ya,9),H($s,10),H(zp,10),H(Za,10),H(Cr,8))},n.\u0275dir=Bt({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Un([cH]),Xt,hr]}),n})(),A2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({}),n})();const TE=new It("NgModelWithFormControlWarning"),mH={provide:Wl,useExisting:zi(()=>kw)};let kw=(()=>{class n extends Wl{constructor(e,i,r,s){super(),this._ngModelWarningConfig=s,this.update=new tn,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=CE(0,r)}set isDisabled(e){}ngOnChanges(e){if(this._isControlChanged(e)){const i=e.form.previousValue;i&&Dw(i,this,!1),mv(this.form,this),this.form.updateValueAndValidity({emitEvent:!1})}SE(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&Dw(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)(H($s,10),H(zp,10),H(Za,10),H(TE,8))},n.\u0275dir=Bt({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[Un([mH]),Xt,hr]}),n})();const gH={provide:Ya,useExisting:zi(()=>Vb)};let Vb=(()=>{class n extends Ya{constructor(e,i){super(),this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new tn,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Mw(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return mv(i,e),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){Dw(e.control||null,e,!1),function oH(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){var i;return this.submitted=!0,S2(this.form,this.directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(Dw(i||null,e),(n=>n instanceof Aw)(r)&&(mv(r,e),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);x2(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function nH(n,t){return Mw(n,t)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){wE(this.form,this),this._oldForm&&Mw(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(e){return new(e||n)(H($s,10),H(zp,10))},n.\u0275dir=Bt({type:n,selectors:[["","formGroup",""]],hostBindings:function(e,i){1&e&&Ft("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Un([gH]),Xt,hr]}),n})(),ym=(()=>{class n{constructor(){this._validator=xw}ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):xw,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,features:[hr]}),n})();const IH={provide:$s,useExisting:zi(()=>AE),multi:!0},MH={provide:$s,useExisting:zi(()=>kE),multi:!0};let AE=(()=>{class n extends ym{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=fh,this.createValidator=e=>WP}enabled(e){return e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,i){2&e&&fn("required",i._enabled?"":null)},inputs:{required:"required"},features:[Un([IH]),Xt]}),n})(),kE=(()=>{class n extends AE{constructor(){super(...arguments),this.createValidator=e=>XP}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(e,i){2&e&&fn("required",i._enabled?"":null)},features:[Un([MH]),Xt]}),n})(),q2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[A2]}),n})(),LH=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[q2]}),n})(),OH=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:TE,useValue:e.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[q2]}),n})();class sa extends Kt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}const Rw=ke(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function vm(...n){const t=Oc(n),e=Bh(n),{args:i,keys:r}=zP(n);if(0===i.length)return ro([],t);const s=new Lt(function NH(n,t,e=vt){return i=>{G2(t,()=>{const{length:r}=n,s=new Array(r);let u=r,m=r;for(let y=0;y<r;y++)G2(t,()=>{const C=ro(n[y],t);let I=!1;C.subscribe(Ii(i,A=>{s[y]=A,I||(I=!0,m--),m||i.next(e(s.slice()))},()=>{--u||i.complete()}))},i)},i)}}(i,t,r?u=>VP(r,u):vt));return e?s.pipe(dE(e)):s}function G2(n,t,e){n?Tl(e,n,t):t()}function bv(...n){return function BH(){return Ql(1)}()(ro(n,Oc(n)))}function xm(n){return new Lt(t=>{Bi(n()).subscribe(t)})}function jb(n,t){const e=ye(n)?n:()=>n,i=r=>r.error(e());return new Lt(t?r=>t.schedule(i,0,r):i)}function RE(){return ki((n,t)=>{let e=null;n._refCount++;const i=Ii(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const r=n._connection,s=e;e=null,r&&(!s||r===s)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class PE extends Lt{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,vo(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new ie;const e=this.getSubject();t.add(this.source.subscribe(Ii(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=ie.EMPTY)}return t}refCount(){return RE()(this)}}function aa(n,t){return ki((e,i)=>{let r=null,s=0,u=!1;const m=()=>u&&!r&&i.complete();e.subscribe(Ii(i,y=>{null==r||r.unsubscribe();let C=0;const I=s++;Bi(n(y,I)).subscribe(r=Ii(i,A=>i.next(t?t(y,A,I,C++):A),()=>{r=null,m()}))},()=>{u=!0,m()}))})}function jr(n){return n<=0?()=>bs:ki((t,e)=>{let i=0;t.subscribe(Ii(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function As(...n){const t=Oc(n);return ki((e,i)=>{(t?bv(n,e,t):bv(n,e)).subscribe(i)})}function Pw(n){return ki((t,e)=>{let i=!1;t.subscribe(Ii(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function W2(n=zH){return ki((t,e)=>{let i=!1;t.subscribe(Ii(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function zH(){return new Rw}function Vp(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Tr((r,s)=>n(r,s,i)):vt,jr(1),e?Pw(t):W2(()=>new Rw))}function Vo(n,t,e){const i=ye(n)||t||e?{next:n,error:t,complete:e}:n;return i?ki((r,s)=>{var u;null===(u=i.subscribe)||void 0===u||u.call(i);let m=!0;r.subscribe(Ii(s,y=>{var C;null===(C=i.next)||void 0===C||C.call(i,y),s.next(y)},()=>{var y;m=!1,null===(y=i.complete)||void 0===y||y.call(i),s.complete()},y=>{var C;m=!1,null===(C=i.error)||void 0===C||C.call(i,y),s.error(y)},()=>{var y,C;m&&(null===(y=i.unsubscribe)||void 0===y||y.call(i)),null===(C=i.finalize)||void 0===C||C.call(i)}))}):vt}function vh(n){return ki((t,e)=>{let s,i=null,r=!1;i=t.subscribe(Ii(e,void 0,void 0,u=>{s=Bi(n(u,vh(n)(t))),i?(i.unsubscribe(),i=null,s.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(e))})}function VH(n,t,e,i,r){return(s,u)=>{let m=e,y=t,C=0;s.subscribe(Ii(u,I=>{const A=C++;y=m?n(y,I,A):(m=!0,I),i&&u.next(y)},r&&(()=>{m&&u.next(y),u.complete()})))}}function X2(n,t){return ki(VH(n,t,arguments.length>=2,!0))}function LE(n){return n<=0?()=>bs:ki((t,e)=>{let i=[];t.subscribe(Ii(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function Z2(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Tr((r,s)=>n(r,s,i)):vt,LE(1),e?Pw(t):W2(()=>new Rw))}function Y2(n,t=!1){return ki((e,i)=>{let r=0;e.subscribe(Ii(i,s=>{const u=n(s,r++);(u||t)&&i.next(s),!u&&i.complete()}))})}function _v(n){return W(()=>n)}function Lw(n){return ki((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}const tr="primary",yv=Symbol("RouteTitle");class jH{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Ub(n){return new jH(n)}function UH(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const u=i[s],m=n[s];if(u.startsWith(":"))r[u.substring(1)]=m;else if(u!==m.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function ud(n,t){const e=n?Object.keys(n):void 0,i=t?Object.keys(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let s=0;s<e.length;s++)if(r=e[s],!K2(n[r],t[r]))return!1;return!0}function K2(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((r,s)=>i[s]===r)}return n===t}function Q2(n){return Array.prototype.concat.apply([],n)}function J2(n){return n.length>0?n[n.length-1]:null}function la(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function jp(n){return DC(n)?n:zy(n)?ro(Promise.resolve(n)):Ln(n)}const qH={exact:function nL(n,t,e){if(!Sm(n.segments,t.segments)||!Ow(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!nL(n.children[i],t.children[i],e))return!1;return!0},subset:iL},eL={exact:function GH(n,t){return ud(n,t)},subset:function WH(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>K2(n[e],t[e]))},ignored:()=>!0};function tL(n,t,e){return qH[e.paths](n.root,t.root,e.matrixParams)&&eL[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function iL(n,t,e){return rL(n,t,t.segments,e)}function rL(n,t,e,i){if(n.segments.length>e.length){const r=n.segments.slice(0,e.length);return!(!Sm(r,e)||t.hasChildren()||!Ow(r,e,i))}if(n.segments.length===e.length){if(!Sm(n.segments,e)||!Ow(n.segments,e,i))return!1;for(const r in t.children)if(!n.children[r]||!iL(n.children[r],t.children[r],i))return!1;return!0}{const r=e.slice(0,n.segments.length),s=e.slice(n.segments.length);return!!(Sm(n.segments,r)&&Ow(n.segments,r,i)&&n.children[tr])&&rL(n.children[tr],t,s,i)}}function Ow(n,t,e){return t.every((i,r)=>eL[e](n[r].parameters,i.parameters))}class wm{constructor(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ub(this.queryParams)),this._queryParamMap}toString(){return YH.serialize(this)}}class sr{constructor(t,e){this.segments=t,this.children=e,this.parent=null,la(e,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Fw(this)}}class vv{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Ub(this.parameters)),this._parameterMap}toString(){return lL(this)}}function Sm(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}let oL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:function(){return new FE},providedIn:"root"}),n})();class FE{parse(t){const e=new o8(t);return new wm(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${xv(t.root,!0)}`,i=function JH(n){const t=Object.keys(n).map(e=>{const i=n[e];return Array.isArray(i)?i.map(r=>`${Nw(e)}=${Nw(r)}`).join("&"):`${Nw(e)}=${Nw(i)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function KH(n){return encodeURI(n)}(t.fragment)}`:""}`}}const YH=new FE;function Fw(n){return n.segments.map(t=>lL(t)).join("/")}function xv(n,t){if(!n.hasChildren())return Fw(n);if(t){const e=n.children[tr]?xv(n.children[tr],!1):"",i=[];return la(n.children,(r,s)=>{s!==tr&&i.push(`${s}:${xv(r,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function ZH(n,t){let e=[];return la(n.children,(i,r)=>{r===tr&&(e=e.concat(t(i,r)))}),la(n.children,(i,r)=>{r!==tr&&(e=e.concat(t(i,r)))}),e}(n,(i,r)=>r===tr?[xv(n.children[tr],!1)]:[`${r}:${xv(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[tr]?`${Fw(n)}/${e[0]}`:`${Fw(n)}/(${e.join("//")})`}}function sL(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Nw(n){return sL(n).replace(/%3B/gi,";")}function NE(n){return sL(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Bw(n){return decodeURIComponent(n)}function aL(n){return Bw(n.replace(/\+/g,"%20"))}function lL(n){return`${NE(n.path)}${function QH(n){return Object.keys(n).map(t=>`;${NE(t)}=${NE(n[t])}`).join("")}(n.parameters)}`}const e8=/^[^\/()?;=#]+/;function zw(n){const t=n.match(e8);return t?t[0]:""}const t8=/^[^=?&#]+/,i8=/^[^&#]+/;class o8{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new sr([],{}):new sr([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[tr]=new sr(t,e)),i}parseSegment(){const t=zw(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new zt(4009,!1);return this.capture(t),new vv(Bw(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=zw(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=zw(this.remaining);r&&(i=r,this.capture(i))}t[Bw(e)]=Bw(i)}parseQueryParam(t){const e=function n8(n){const t=n.match(t8);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const u=function r8(n){const t=n.match(i8);return t?t[0]:""}(this.remaining);u&&(i=u,this.capture(i))}const r=aL(e),s=aL(i);if(t.hasOwnProperty(r)){let u=t[r];Array.isArray(u)||(u=[u],t[r]=u),u.push(s)}else t[r]=s}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=zw(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new zt(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=tr);const u=this.parseChildren();e[s]=1===Object.keys(u).length?u[tr]:new sr([],u),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new zt(4011,!1)}}function BE(n){return n.segments.length>0?new sr([],{[tr]:n}):n}function Vw(n){const t={};for(const i of Object.keys(n.children)){const s=Vw(n.children[i]);(s.segments.length>0||s.hasChildren())&&(t[i]=s)}return function s8(n){if(1===n.numberOfChildren&&n.children[tr]){const t=n.children[tr];return new sr(n.segments.concat(t.segments),t.children)}return n}(new sr(n.segments,t))}function Cm(n){return n instanceof wm}function c8(n,t,e,i,r){var s;if(0===e.length)return Hb(t.root,t.root,t.root,i,r);const m=function dL(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new uL(!0,0,n);let t=0,e=!1;const i=n.reduce((r,s,u)=>{if("object"==typeof s&&null!=s){if(s.outlets){const m={};return la(s.outlets,(y,C)=>{m[C]="string"==typeof y?y.split("/"):y}),[...r,{outlets:m}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===u?(s.split("/").forEach((m,y)=>{0==y&&"."===m||(0==y&&""===m?e=!0:".."===m?t++:""!=m&&r.push(m))}),r):[...r,s]},[]);return new uL(e,t,i)}(e);return m.toRoot()?Hb(t.root,t.root,new sr([],{}),i,r):function y(I){var A;const B=function d8(n,t,e,i){if(n.isAbsolute)return new $b(t.root,!0,0);if(-1===i)return new $b(e,e===t.root,0);return function hL(n,t,e){let i=n,r=t,s=e;for(;s>r;){if(s-=r,i=i.parent,!i)throw new zt(4005,!1);r=i.segments.length}return new $b(i,!1,r-s)}(e,i+(wv(n.commands[0])?0:1),n.numberOfDoubleDots)}(m,t,null===(A=n.snapshot)||void 0===A?void 0:A._urlSegment,I),j=B.processChildren?Cv(B.segmentGroup,B.index,m.commands):VE(B.segmentGroup,B.index,m.commands);return Hb(t.root,B.segmentGroup,j,i,r)}(null===(s=n.snapshot)||void 0===s?void 0:s._lastPathIndex)}function wv(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Sv(n){return"object"==typeof n&&null!=n&&n.outlets}function Hb(n,t,e,i,r){let u,s={};i&&la(i,(y,C)=>{s[C]=Array.isArray(y)?y.map(I=>`${I}`):`${y}`}),u=n===t?e:cL(n,t,e);const m=BE(Vw(u));return new wm(m,s,r)}function cL(n,t,e){const i={};return la(n.children,(r,s)=>{i[s]=r===t?e:cL(r,t,e)}),new sr(n.segments,i)}class uL{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&wv(i[0]))throw new zt(4003,!1);const r=i.find(Sv);if(r&&r!==J2(i))throw new zt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class $b{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function VE(n,t,e){if(n||(n=new sr([],{})),0===n.segments.length&&n.hasChildren())return Cv(n,t,e);const i=function p8(n,t,e){let i=0,r=t;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return s;const u=n.segments[r],m=e[i];if(Sv(m))break;const y=`${m}`,C=i<e.length-1?e[i+1]:null;if(r>0&&void 0===y)break;if(y&&C&&"object"==typeof C&&void 0===C.outlets){if(!fL(y,C,u))return s;i+=2}else{if(!fL(y,{},u))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new sr(n.segments.slice(0,i.pathIndex),{});return s.children[tr]=new sr(n.segments.slice(i.pathIndex),n.children),Cv(s,0,r)}return i.match&&0===r.length?new sr(n.segments,{}):i.match&&!n.hasChildren()?jE(n,t,e):i.match?Cv(n,0,r):jE(n,t,e)}function Cv(n,t,e){if(0===e.length)return new sr(n.segments,{});{const i=function h8(n){return Sv(n[0])?n[0].outlets:{[tr]:n}}(e),r={};return la(i,(s,u)=>{"string"==typeof s&&(s=[s]),null!==s&&(r[u]=VE(n.children[u],t,s))}),la(n.children,(s,u)=>{void 0===i[u]&&(r[u]=s)}),new sr(n.segments,r)}}function jE(n,t,e){const i=n.segments.slice(0,t);let r=0;for(;r<e.length;){const s=e[r];if(Sv(s)){const y=f8(s.outlets);return new sr(i,y)}if(0===r&&wv(e[0])){i.push(new vv(n.segments[t].path,pL(e[0]))),r++;continue}const u=Sv(s)?s.outlets[tr]:`${s}`,m=r<e.length-1?e[r+1]:null;u&&m&&wv(m)?(i.push(new vv(u,pL(m))),r+=2):(i.push(new vv(u,{})),r++)}return new sr(i,{})}function f8(n){const t={};return la(n,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[i]=jE(new sr([],{}),0,e))}),t}function pL(n){const t={};return la(n,(e,i)=>t[i]=`${e}`),t}function fL(n,t,e){return n==e.path&&ud(t,e.parameters)}class xh{constructor(t,e){this.id=t,this.url=e}}class UE extends xh{constructor(t,e,i="imperative",r=null){super(t,e),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Tm extends xh{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class jw extends xh{constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class mL extends xh{constructor(t,e,i,r){super(t,e),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class m8 extends xh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class g8 extends xh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class b8 extends xh{constructor(t,e,i,r,s){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class _8 extends xh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class y8 extends xh{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class v8{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class x8{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class w8{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class S8{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class C8{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class T8{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class gL{constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class bL{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=HE(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=HE(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=$E(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return $E(t,this._root).map(e=>e.value)}}function HE(n,t){if(n===t.value)return t;for(const e of t.children){const i=HE(n,e);if(i)return i}return null}function $E(n,t){if(n===t.value)return[t];for(const e of t.children){const i=$E(n,e);if(i.length)return i.unshift(t),i}return[]}class wh{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function qb(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class _L extends bL{constructor(t,e){super(t),this.snapshot=e,qE(this,t)}toString(){return this.snapshot.toString()}}function yL(n,t){const e=function D8(n,t){const u=new Uw([],{},{},"",{},tr,t,null,n.root,-1,{});return new xL("",new wh(u,[]))}(n,t),i=new sa([new vv("",{})]),r=new sa({}),s=new sa({}),u=new sa({}),m=new sa(""),y=new Em(i,r,u,m,s,tr,t,e.root);return y.snapshot=e.root,new _L(new wh(y,[]),e)}class Em{constructor(t,e,i,r,s,u,m,y){var C,I;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=u,this.component=m,this.title=null!==(I=null===(C=this.data)||void 0===C?void 0:C.pipe(W(A=>A[yv])))&&void 0!==I?I:Ln(void 0),this._futureSnapshot=y}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(W(t=>Ub(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(W(t=>Ub(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function vL(n,t="emptyOnly"){const e=n.pathFromRoot;let i=0;if("always"!==t)for(i=e.length-1;i>=1;){const r=e[i],s=e[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function I8(n){return n.reduce((t,e)=>{var i;return{params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign(Object.assign(Object.assign({},e.data),t.resolve),null===(i=e.routeConfig)||void 0===i?void 0:i.data),e._resolvedData)}},{params:{},data:{},resolve:{}})}(e.slice(i))}class Uw{constructor(t,e,i,r,s,u,m,y,C,I,A,B){var j;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=u,this.component=m,this.title=null===(j=this.data)||void 0===j?void 0:j[yv],this.routeConfig=y,this._urlSegment=C,this._lastPathIndex=I,this._correctedLastPathIndex=null!=B?B:I,this._resolve=A}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ub(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ub(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class xL extends bL{constructor(t,e){super(e),this.url=t,qE(this,e)}toString(){return wL(this._root)}}function qE(n,t){t.value._routerState=n,t.children.forEach(e=>qE(n,e))}function wL(n){const t=n.children.length>0?` { ${n.children.map(wL).join(", ")} } `:"";return`${n.value}${t}`}function GE(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,ud(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),ud(t.params,e.params)||n.params.next(e.params),function HH(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!ud(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),ud(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function WE(n,t){const e=ud(n.params,t.params)&&function XH(n,t){return Sm(n,t)&&n.every((e,i)=>ud(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||WE(n.parent,t.parent))}function Tv(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const r=function A8(n,t,e){return t.children.map(i=>{for(const r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return Tv(n,i,r);return Tv(n,i)})}(n,t,e);return new wh(i,r)}{if(n.shouldAttach(t.value)){const s=n.retrieve(t.value);if(null!==s){const u=s.route;return u.value._futureSnapshot=t.value,u.children=t.children.map(m=>Tv(n,m)),u}}const i=function k8(n){return new Em(new sa(n.url),new sa(n.params),new sa(n.queryParams),new sa(n.fragment),new sa(n.data),n.outlet,n.component,n)}(t.value),r=t.children.map(s=>Tv(n,s));return new wh(i,r)}}const XE="ngNavigationCancelingError";function SL(n,t){const{redirectTo:e,navigationBehaviorOptions:i}=Cm(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=CL(!1,0,t);return r.url=e,r.navigationBehaviorOptions=i,r}function CL(n,t,e){const i=new Error("NavigationCancelingError: "+(n||""));return i[XE]=!0,i.cancellationCode=t,e&&(i.url=e),i}function TL(n){return EL(n)&&Cm(n.url)}function EL(n){return n&&n[XE]}class R8{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Ev,this.attachRef=null}}let Ev=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(e,i){const r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){const i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new R8,this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Hw=!1;let ZE=(()=>{class n{constructor(e,i,r,s,u){this.parentContexts=e,this.location=i,this.changeDetector=s,this.environmentInjector=u,this.activated=null,this._activatedRoute=null,this.activateEvents=new tn,this.deactivateEvents=new tn,this.attachEvents=new tn,this.detachEvents=new tn,this.name=r||tr,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){var e;(null===(e=this.parentContexts.getContext(this.name))||void 0===e?void 0:e.outlet)===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new zt(4012,Hw);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new zt(4012,Hw);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new zt(4012,Hw);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new zt(4013,Hw);this._activatedRoute=e;const r=this.location,u=e._futureSnapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,y=new P8(e,m,r.injector);if(i&&function L8(n){return!!n.resolveComponentFactory}(i)){const C=i.resolveComponentFactory(u);this.activated=r.createComponent(C,r.length,y)}else this.activated=r.createComponent(u,{index:r.length,injector:y,environmentInjector:null!=i?i:this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)(H(Ev),H(zo),qo("name"),H(Cr),H(Jc))},n.\u0275dir=Bt({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),n})();class P8{constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===Em?this.route:t===Ev?this.childContexts:this.parent.get(t,e)}}let YE=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["ng-component"]],standalone:!0,features:[TA],decls:1,vars:0,template:function(e,i){1&e&&en(0,"router-outlet")},dependencies:[ZE],encapsulation:2}),n})();function DL(n,t){var e;return n.providers&&!n._injector&&(n._injector=Dx(n.providers,t,`Route: ${n.path}`)),null!==(e=n._injector)&&void 0!==e?e:t}function QE(n){const t=n.children&&n.children.map(QE),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==tr&&(e.component=YE),e}function Ac(n){return n.outlet||tr}function IL(n,t){const e=n.filter(i=>Ac(i)===t);return e.push(...n.filter(i=>Ac(i)!==t)),e}function Dv(n){var t;if(!n)return null;if(null!==(t=n.routeConfig)&&void 0!==t&&t._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const i=e.routeConfig;if(null!=i&&i._loadedInjector)return i._loadedInjector;if(null!=i&&i._injector)return i._injector}return null}class z8{constructor(t,e,i,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),GE(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const r=qb(e);t.children.forEach(s=>{const u=s.value.outlet;this.deactivateRoutes(s,r[u],i),delete r[u]}),la(r,(s,u)=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(t,e,i){const r=t.value,s=e?e.value:null;if(r===s)if(r.component){const u=i.getContext(r.outlet);u&&this.deactivateChildRoutes(t,e,u.children)}else this.deactivateChildRoutes(t,e,i);else s&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=qb(t);for(const u of Object.keys(s))this.deactivateRouteAndItsChildren(s[u],r);if(i&&i.outlet){const u=i.outlet.detach(),m=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:u,route:t,contexts:m})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,s=qb(t);for(const u of Object.keys(s))this.deactivateRouteAndItsChildren(s[u],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,e,i){const r=qb(e);t.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new T8(s.value.snapshot))}),t.children.length&&this.forwardEvent(new S8(t.value.snapshot))}activateRoutes(t,e,i){var r;const s=t.value,u=e?e.value:null;if(GE(s),s===u)if(s.component){const m=i.getOrCreateContext(s.outlet);this.activateChildRoutes(t,e,m.children)}else this.activateChildRoutes(t,e,i);else if(s.component){const m=i.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const y=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),m.children.onOutletReAttached(y.contexts),m.attachRef=y.componentRef,m.route=y.route.value,m.outlet&&m.outlet.attach(y.componentRef,y.route.value),GE(y.route.value),this.activateChildRoutes(t,null,m.children)}else{const y=Dv(s.snapshot),C=null!==(r=null==y?void 0:y.get(eh))&&void 0!==r?r:null;m.attachRef=null,m.route=s,m.resolver=C,m.injector=y,m.outlet&&m.outlet.activateWith(s,m.injector),this.activateChildRoutes(t,null,m.children)}}else this.activateChildRoutes(t,null,i)}}class ML{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class $w{constructor(t,e){this.component=t,this.route=e}}function V8(n,t,e){const i=n._root;return Iv(i,t?t._root:null,e,[i.value])}function Gb(n,t){const e=Symbol(),i=t.get(n,e);return i===e?"function"!=typeof n||function xu(n){return null!==vu(n)}(n)?t.get(n):n:i}function Iv(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=qb(t);return n.children.forEach(u=>{(function U8(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,u=t?t.value:null,m=e?e.getContext(n.value.outlet):null;if(u&&s.routeConfig===u.routeConfig){const y=function H8(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!Sm(n.url,t.url);case"pathParamsOrQueryParamsChange":return!Sm(n.url,t.url)||!ud(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!WE(n,t)||!ud(n.queryParams,t.queryParams);default:return!WE(n,t)}}(u,s,s.routeConfig.runGuardsAndResolvers);y?r.canActivateChecks.push(new ML(i)):(s.data=u.data,s._resolvedData=u._resolvedData),Iv(n,t,s.component?m?m.children:null:e,i,r),y&&m&&m.outlet&&m.outlet.isActivated&&r.canDeactivateChecks.push(new $w(m.outlet.component,u))}else u&&Mv(t,m,r),r.canActivateChecks.push(new ML(i)),Iv(n,null,s.component?m?m.children:null:e,i,r)})(u,s[u.value.outlet],e,i.concat([u.value]),r),delete s[u.value.outlet]}),la(s,(u,m)=>Mv(u,e.getContext(m),r)),r}function Mv(n,t,e){const i=qb(n),r=n.value;la(i,(s,u)=>{Mv(s,r.component?t?t.children.getContext(u):null:t,e)}),e.canDeactivateChecks.push(new $w(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function Av(n){return"function"==typeof n}function JE(n){return n instanceof Rw||"EmptyError"===(null==n?void 0:n.name)}const qw=Symbol("INITIAL_VALUE");function Wb(){return aa(n=>vm(n.map(t=>t.pipe(jr(1),As(qw)))).pipe(W(t=>{for(const e of t)if(!0!==e){if(e===qw)return qw;if(!1===e||e instanceof wm)return e}return!0}),Tr(t=>t!==qw),jr(1)))}function AL(n){return function Dt(...n){return oi(n)}(Vo(t=>{if(Cm(t))throw SL(0,t)}),W(t=>!0===t))}const eD={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function kL(n,t,e,i,r){const s=tD(n,t,e);return s.matched?function s$(n,t,e,i){const r=t.canMatch;return r&&0!==r.length?Ln(r.map(u=>{const m=Gb(u,n);return jp(function Z8(n){return n&&Av(n.canMatch)}(m)?m.canMatch(t,e):n.runInContext(()=>m(t,e)))})).pipe(Wb(),AL()):Ln(!0)}(i=DL(t,i),t,e).pipe(W(u=>!0===u?s:Object.assign({},eD))):Ln(s)}function tD(n,t,e){var i;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},eD):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const s=(t.matcher||UH)(e,n,t);if(!s)return Object.assign({},eD);const u={};la(s.posParams,(y,C)=>{u[C]=y.path});const m=s.consumed.length>0?Object.assign(Object.assign({},u),s.consumed[s.consumed.length-1].parameters):u;return{matched:!0,consumedSegments:s.consumed,remainingSegments:e.slice(s.consumed.length),parameters:m,positionalParamSegments:null!==(i=s.posParams)&&void 0!==i?i:{}}}function Gw(n,t,e,i,r="corrected"){if(e.length>0&&function c$(n,t,e){return e.some(i=>Ww(n,t,i)&&Ac(i)!==tr)}(n,e,i)){const u=new sr(t,function l$(n,t,e,i){const r={};r[tr]=i,i._sourceSegment=n,i._segmentIndexShift=t.length;for(const s of e)if(""===s.path&&Ac(s)!==tr){const u=new sr([],{});u._sourceSegment=n,u._segmentIndexShift=t.length,r[Ac(s)]=u}return r}(n,t,i,new sr(e,n.children)));return u._sourceSegment=n,u._segmentIndexShift=t.length,{segmentGroup:u,slicedSegments:[]}}if(0===e.length&&function u$(n,t,e){return e.some(i=>Ww(n,t,i))}(n,e,i)){const u=new sr(n.segments,function a$(n,t,e,i,r,s){const u={};for(const m of i)if(Ww(n,e,m)&&!r[Ac(m)]){const y=new sr([],{});y._sourceSegment=n,y._segmentIndexShift="legacy"===s?n.segments.length:t.length,u[Ac(m)]=y}return Object.assign(Object.assign({},r),u)}(n,t,e,i,n.children,r));return u._sourceSegment=n,u._segmentIndexShift=t.length,{segmentGroup:u,slicedSegments:e}}const s=new sr(n.segments,n.children);return s._sourceSegment=n,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:e}}function Ww(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function RL(n,t,e,i){return!!(Ac(n)===i||i!==tr&&Ww(t,e,n))&&("**"===n.path||tD(t,n,e).matched)}function PL(n,t,e){return 0===t.length&&!n.children[e]}const Xw=!1;class Zw{constructor(t){this.segmentGroup=t||null}}class LL{constructor(t){this.urlTree=t}}function kv(n){return jb(new Zw(n))}function OL(n){return jb(new LL(n))}class f${constructor(t,e,i,r,s){this.injector=t,this.configLoader=e,this.urlSerializer=i,this.urlTree=r,this.config=s,this.allowRedirects=!0}apply(){const t=Gw(this.urlTree.root,[],[],this.config).segmentGroup,e=new sr(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,e,tr).pipe(W(s=>this.createUrlTree(Vw(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(vh(s=>{if(s instanceof LL)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof Zw?this.noMatchError(s):s}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,tr).pipe(W(r=>this.createUrlTree(Vw(r),t.queryParams,t.fragment))).pipe(vh(r=>{throw r instanceof Zw?this.noMatchError(r):r}))}noMatchError(t){return new zt(4002,Xw)}createUrlTree(t,e,i){const r=BE(t);return new wm(r,e,i)}expandSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,e,i).pipe(W(s=>new sr([],s))):this.expandSegment(t,i,e,i.segments,r,!0)}expandChildren(t,e,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return ro(r).pipe(Fp(s=>{const u=i.children[s],m=IL(e,s);return this.expandSegmentGroup(t,m,u,s).pipe(W(y=>({segment:y,outlet:s})))}),X2((s,u)=>(s[u.outlet]=u.segment,s),{}),Z2())}expandSegment(t,e,i,r,s,u){return ro(i).pipe(Fp(m=>this.expandSegmentAgainstRoute(t,e,i,m,r,s,u).pipe(vh(C=>{if(C instanceof Zw)return Ln(null);throw C}))),Vp(m=>!!m),vh((m,y)=>{if(JE(m))return PL(e,r,s)?Ln(new sr([],{})):kv(e);throw m}))}expandSegmentAgainstRoute(t,e,i,r,s,u,m){return RL(r,e,s,u)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,s,u):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,u):kv(e):kv(e)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,s,u){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,r,u):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,u)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,i,r){const s=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?OL(s):this.lineralizeSegments(i,s).pipe(Wn(u=>{const m=new sr(u,{});return this.expandSegment(t,m,e,u,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,s,u){const{matched:m,consumedSegments:y,remainingSegments:C,positionalParamSegments:I}=tD(e,r,s);if(!m)return kv(e);const A=this.applyRedirectCommands(y,r.redirectTo,I);return r.redirectTo.startsWith("/")?OL(A):this.lineralizeSegments(r,A).pipe(Wn(B=>this.expandSegment(t,e,i,B.concat(C),u,!1)))}matchSegmentAgainstRoute(t,e,i,r,s){return"**"===i.path?(t=DL(i,t),i.loadChildren?(i._loadedRoutes?Ln({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe(W(m=>(i._loadedRoutes=m.routes,i._loadedInjector=m.injector,new sr(r,{})))):Ln(new sr(r,{}))):kL(e,i,r,t).pipe(aa(({matched:u,consumedSegments:m,remainingSegments:y})=>{var C;return u?(t=null!==(C=i._injector)&&void 0!==C?C:t,this.getChildConfig(t,i,r).pipe(Wn(A=>{var B;const j=null!==(B=A.injector)&&void 0!==B?B:t,K=A.routes,{segmentGroup:pe,slicedSegments:Se}=Gw(e,m,y,K),Xe=new sr(pe.segments,pe.children);if(0===Se.length&&Xe.hasChildren())return this.expandChildren(j,K,Xe).pipe(W(yn=>new sr(m,yn)));if(0===K.length&&0===Se.length)return Ln(new sr(m,{}));const At=Ac(i)===s;return this.expandSegment(j,Xe,K,Se,At?tr:s,!0).pipe(W(kt=>new sr(m.concat(kt.segments),kt.children)))}))):kv(e)}))}getChildConfig(t,e,i){return e.children?Ln({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?Ln({routes:e._loadedRoutes,injector:e._loadedInjector}):function o$(n,t,e,i){const r=t.canLoad;return void 0===r||0===r.length?Ln(!0):Ln(r.map(u=>{const m=Gb(u,n);return jp(function q8(n){return n&&Av(n.canLoad)}(m)?m.canLoad(t,e):n.runInContext(()=>m(t,e)))})).pipe(Wb(),AL())}(t,e,i).pipe(Wn(r=>r?this.configLoader.loadChildren(t,e).pipe(Vo(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):function h$(n){return jb(CL(Xw,3))}())):Ln({routes:[],injector:t})}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return Ln(i);if(r.numberOfChildren>1||!r.children[tr])return jb(new zt(4e3,Xw));r=r.children[tr]}}applyRedirectCommands(t,e,i){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,i)}applyRedirectCreateUrlTree(t,e,i,r){const s=this.createSegmentGroup(t,e.root,i,r);return new wm(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return la(t,(r,s)=>{if("string"==typeof r&&r.startsWith(":")){const m=r.substring(1);i[s]=e[m]}else i[s]=r}),i}createSegmentGroup(t,e,i,r){const s=this.createSegments(t,e.segments,i,r);let u={};return la(e.children,(m,y)=>{u[y]=this.createSegmentGroup(t,m,i,r)}),new sr(s,u)}createSegments(t,e,i,r){return e.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,r):this.findOrReturn(s,i))}findPosParam(t,e,i){const r=i[e.path.substring(1)];if(!r)throw new zt(4001,Xw);return r}findOrReturn(t,e){let i=0;for(const r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}}class g${}class y${constructor(t,e,i,r,s,u,m,y){this.injector=t,this.rootComponentType=e,this.config=i,this.urlTree=r,this.url=s,this.paramsInheritanceStrategy=u,this.relativeLinkResolution=m,this.urlSerializer=y}recognize(){const t=Gw(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,tr).pipe(W(e=>{if(null===e)return null;const i=new Uw([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},tr,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new wh(i,e),s=new xL(this.url,r);return this.inheritParamsAndData(s._root),s}))}inheritParamsAndData(t){const e=t.value,i=vL(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,e,i):this.processSegment(t,e,i,i.segments,r)}processChildren(t,e,i){return ro(Object.keys(i.children)).pipe(Fp(r=>{const s=i.children[r],u=IL(e,r);return this.processSegmentGroup(t,u,s,r)}),X2((r,s)=>r&&s?(r.push(...s),r):null),Y2(r=>null!==r),Pw(null),Z2(),W(r=>{if(null===r)return null;const s=FL(r);return function v$(n){n.sort((t,e)=>t.value.outlet===tr?-1:e.value.outlet===tr?1:t.value.outlet.localeCompare(e.value.outlet))}(s),s}))}processSegment(t,e,i,r,s){return ro(e).pipe(Fp(u=>{var m;return this.processSegmentAgainstRoute(null!==(m=u._injector)&&void 0!==m?m:t,u,i,r,s)}),Vp(u=>!!u),vh(u=>{if(JE(u))return PL(i,r,s)?Ln([]):Ln(null);throw u}))}processSegmentAgainstRoute(t,e,i,r,s){var u,m;if(e.redirectTo||!RL(e,i,r,s))return Ln(null);let y;if("**"===e.path){const C=r.length>0?J2(r).parameters:{},I=BL(i)+r.length;y=Ln({snapshot:new Uw(r,C,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,VL(e),Ac(e),null!==(m=null!==(u=e.component)&&void 0!==u?u:e._loadedComponent)&&void 0!==m?m:null,e,NL(i),I,jL(e),I),consumedSegments:[],remainingSegments:[]})}else y=kL(i,e,r,t).pipe(W(({matched:C,consumedSegments:I,remainingSegments:A,parameters:B})=>{var j,K;if(!C)return null;const pe=BL(i)+I.length;return{snapshot:new Uw(I,B,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,VL(e),Ac(e),null!==(K=null!==(j=e.component)&&void 0!==j?j:e._loadedComponent)&&void 0!==K?K:null,e,NL(i),pe,jL(e),pe),consumedSegments:I,remainingSegments:A}}));return y.pipe(aa(C=>{var I,A;if(null===C)return Ln(null);const{snapshot:B,consumedSegments:j,remainingSegments:K}=C;t=null!==(I=e._injector)&&void 0!==I?I:t;const pe=null!==(A=e._loadedInjector)&&void 0!==A?A:t,Se=function x$(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(e),{segmentGroup:Xe,slicedSegments:At}=Gw(i,j,K,Se.filter(kt=>void 0===kt.redirectTo),this.relativeLinkResolution);if(0===At.length&&Xe.hasChildren())return this.processChildren(pe,Se,Xe).pipe(W(kt=>null===kt?null:[new wh(B,kt)]));if(0===Se.length&&0===At.length)return Ln([new wh(B,[])]);const pt=Ac(e)===s;return this.processSegment(pe,Se,Xe,At,pt?tr:s).pipe(W(kt=>null===kt?null:[new wh(B,kt)]))}))}}function w$(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function FL(n){const t=[],e=new Set;for(const i of n){if(!w$(i)){t.push(i);continue}const r=t.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):t.push(i)}for(const i of e){const r=FL(i.children);t.push(new wh(i.value,r))}return t.filter(i=>!e.has(i))}function NL(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function BL(n){var t,e;let i=n,r=null!==(t=i._segmentIndexShift)&&void 0!==t?t:0;for(;i._sourceSegment;)i=i._sourceSegment,r+=null!==(e=i._segmentIndexShift)&&void 0!==e?e:0;return r-1}function VL(n){return n.data||{}}function jL(n){return n.resolve||{}}function UL(n){return"string"==typeof n.title||null===n.title}function nD(n){return aa(t=>{const e=n(t);return e?ro(e).pipe(W(()=>t)):Ln(t)})}let HL=(()=>{class n{buildTitle(e){var i;let r,s=e.root;for(;void 0!==s;)r=null!==(i=this.getResolvedTitleForRoute(s))&&void 0!==i?i:r,s=s.children.find(u=>u.outlet===tr);return r}getResolvedTitleForRoute(e){return e.data[yv]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:function(){return Fr($L)},providedIn:"root"}),n})(),$L=(()=>{class n extends HL{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(e){return new(e||n)(je(LR))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class A${}class R$ extends class k${shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const Kw=new It("",{providedIn:"root",factory:()=>({})}),iD=new It("ROUTES");let rD=(()=>{class n{constructor(e,i){this.injector=e,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Ln(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=jp(e.loadComponent()).pipe(Vo(s=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=s}),Lw(()=>{this.componentLoaders.delete(e)})),r=new PE(i,()=>new Kt).pipe(RE());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Ln({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(W(m=>{this.onLoadEndListener&&this.onLoadEndListener(i);let y,C,I=!1;Array.isArray(m)?C=m:(y=m.create(e).injector,C=Q2(y.get(iD,[],$n.Self|$n.Optional)));return{routes:C.map(QE),injector:y}}),Lw(()=>{this.childrenLoaders.delete(i)})),u=new PE(s,()=>new Kt).pipe(RE());return this.childrenLoaders.set(i,u),u}loadModuleFactoryOrRoutes(e){return jp(e()).pipe(Wn(i=>i instanceof SA||Array.isArray(i)?Ln(i):ro(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(e){return new(e||n)(je(Nr),je(KC))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class L${}class O${shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function F$(n){throw n}function N$(n,t,e){return t.parse("/")}const B$={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},z$={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function GL(){var n,t;const e=Fr(oL),i=Fr(Ev),r=Fr(zx),s=Fr(Nr),u=Fr(KC),m=null!==(n=Fr(iD,{optional:!0}))&&void 0!==n?n:[],y=null!==(t=Fr(Kw,{optional:!0}))&&void 0!==t?t:{},C=Fr($L),I=Fr(HL,{optional:!0}),A=Fr(L$,{optional:!0}),B=Fr(A$,{optional:!0}),j=new hs(null,e,i,r,s,u,Q2(m));return A&&(j.urlHandlingStrategy=A),B&&(j.routeReuseStrategy=B),j.titleStrategy=null!=I?I:C,function V$(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(t.canceledNavigationResolution=n.canceledNavigationResolution)}(y,j),j}let hs=(()=>{class n{constructor(e,i,r,s,u,m,y){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=r,this.location=s,this.config=y,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Kt,this.errorHandler=F$,this.malformedUriErrorHandler=N$,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>Ln(void 0),this.urlHandlingStrategy=new O$,this.routeReuseStrategy=new R$,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=u.get(rD),this.configLoader.onLoadEndListener=B=>this.triggerEvent(new x8(B)),this.configLoader.onLoadStartListener=B=>this.triggerEvent(new v8(B)),this.ngModule=u.get(dm),this.console=u.get(aV);const A=u.get(Xn);this.isNgZoneEnabled=A instanceof Xn&&Xn.isInAngularZone(),this.resetConfig(y),this.currentUrlTree=function $H(){return new wm(new sr([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=yL(this.currentUrlTree,this.rootComponentType),this.transitions=new sa({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(Tr(r=>0!==r.id),W(r=>Object.assign(Object.assign({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),aa(r=>{let s=!1,u=!1;return Ln(r).pipe(Vo(m=>{this.currentNavigation={id:m.id,initialUrl:m.rawUrl,extractedUrl:m.extractedUrl,trigger:m.source,extras:m.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),aa(m=>{const y=this.browserUrlTree.toString(),C=!this.navigated||m.extractedUrl.toString()!==y||y!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||C)&&this.urlHandlingStrategy.shouldProcessUrl(m.rawUrl))return WL(m.source)&&(this.browserUrlTree=m.extractedUrl),Ln(m).pipe(aa(A=>{const B=this.transitions.getValue();return i.next(new UE(A.id,this.serializeUrl(A.extractedUrl),A.source,A.restoredState)),B!==this.transitions.getValue()?bs:Promise.resolve(A)}),function m$(n,t,e,i){return aa(r=>function p$(n,t,e,i,r){return new f$(n,t,e,i,r).apply()}(n,t,e,r.extractedUrl,i).pipe(W(s=>Object.assign(Object.assign({},r),{urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Vo(A=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:A.urlAfterRedirects}),r.urlAfterRedirects=A.urlAfterRedirects}),function C$(n,t,e,i,r,s){return Wn(u=>function _$(n,t,e,i,r,s,u="emptyOnly",m="legacy"){return new y$(n,t,e,i,r,u,m,s).recognize().pipe(aa(y=>null===y?function b$(n){return new Lt(t=>t.error(n))}(new g$):Ln(y)))}(n,t,e,u.urlAfterRedirects,i.serialize(u.urlAfterRedirects),i,r,s).pipe(W(m=>Object.assign(Object.assign({},u),{targetSnapshot:m}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),Vo(A=>{if(r.targetSnapshot=A.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!A.extras.skipLocationChange){const j=this.urlHandlingStrategy.merge(A.urlAfterRedirects,A.rawUrl);this.setBrowserUrl(j,A)}this.browserUrlTree=A.urlAfterRedirects}const B=new m8(A.id,this.serializeUrl(A.extractedUrl),this.serializeUrl(A.urlAfterRedirects),A.targetSnapshot);i.next(B)}));if(C&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:B,extractedUrl:j,source:K,restoredState:pe,extras:Se}=m,Xe=new UE(B,this.serializeUrl(j),K,pe);i.next(Xe);const At=yL(j,this.rootComponentType).snapshot;return Ln(r=Object.assign(Object.assign({},m),{targetSnapshot:At,urlAfterRedirects:j,extras:Object.assign(Object.assign({},Se),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=m.rawUrl,m.resolve(null),bs}),Vo(m=>{const y=new g8(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot);this.triggerEvent(y)}),W(m=>r=Object.assign(Object.assign({},m),{guards:V8(m.targetSnapshot,m.currentSnapshot,this.rootContexts)})),function K8(n,t){return Wn(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:u}}=e;return 0===u.length&&0===s.length?Ln(Object.assign(Object.assign({},e),{guardsResult:!0})):function Q8(n,t,e,i){return ro(n).pipe(Wn(r=>function r$(n,t,e,i,r){const s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return s&&0!==s.length?Ln(s.map(m=>{var y;const C=null!==(y=Dv(t))&&void 0!==y?y:r,I=Gb(m,C);return jp(function X8(n){return n&&Av(n.canDeactivate)}(I)?I.canDeactivate(n,t,e,i):C.runInContext(()=>I(n,t,e,i))).pipe(Vp())})).pipe(Wb()):Ln(!0)}(r.component,r.route,e,t,i)),Vp(r=>!0!==r,!0))}(u,i,r,n).pipe(Wn(m=>m&&function $8(n){return"boolean"==typeof n}(m)?function J8(n,t,e,i){return ro(t).pipe(Fp(r=>bv(function t$(n,t){return null!==n&&t&&t(new w8(n)),Ln(!0)}(r.route.parent,i),function e$(n,t){return null!==n&&t&&t(new C8(n)),Ln(!0)}(r.route,i),function i$(n,t,e){const i=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(u=>function j8(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(u)).filter(u=>null!==u).map(u=>xm(()=>Ln(u.guards.map(y=>{var C;const I=null!==(C=Dv(u.node))&&void 0!==C?C:e,A=Gb(y,I);return jp(function W8(n){return n&&Av(n.canActivateChild)}(A)?A.canActivateChild(i,n):I.runInContext(()=>A(i,n))).pipe(Vp())})).pipe(Wb())));return Ln(s).pipe(Wb())}(n,r.path,e),function n$(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Ln(!0);const r=i.map(s=>xm(()=>{var u;const m=null!==(u=Dv(t))&&void 0!==u?u:e,y=Gb(s,m);return jp(function G8(n){return n&&Av(n.canActivate)}(y)?y.canActivate(t,n):m.runInContext(()=>y(t,n))).pipe(Vp())}));return Ln(r).pipe(Wb())}(n,r.route,e))),Vp(r=>!0!==r,!0))}(i,s,n,t):Ln(m)),W(m=>Object.assign(Object.assign({},e),{guardsResult:m})))})}(this.ngModule.injector,m=>this.triggerEvent(m)),Vo(m=>{if(r.guardsResult=m.guardsResult,Cm(m.guardsResult))throw SL(0,m.guardsResult);const y=new b8(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot,!!m.guardsResult);this.triggerEvent(y)}),Tr(m=>!!m.guardsResult||(this.restoreHistory(m),this.cancelNavigationTransition(m,"",3),!1)),nD(m=>{if(m.guards.canActivateChecks.length)return Ln(m).pipe(Vo(y=>{const C=new _8(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(C)}),aa(y=>{let C=!1;return Ln(y).pipe(function T$(n,t){return Wn(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return Ln(e);let s=0;return ro(r).pipe(Fp(u=>function E$(n,t,e,i){const r=n.routeConfig,s=n._resolve;return void 0!==(null==r?void 0:r.title)&&!UL(r)&&(s[yv]=r.title),function D$(n,t,e,i){const r=function I$(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return Ln({});const s={};return ro(r).pipe(Wn(u=>function M$(n,t,e,i){var r;const s=null!==(r=Dv(t))&&void 0!==r?r:i,u=Gb(n,s);return jp(u.resolve?u.resolve(t,e):s.runInContext(()=>u(t,e)))}(n[u],t,e,i).pipe(Vp(),Vo(m=>{s[u]=m}))),LE(1),_v(s),vh(u=>JE(u)?bs:jb(u)))}(s,n,t,i).pipe(W(u=>(n._resolvedData=u,n.data=vL(n,e).resolve,r&&UL(r)&&(n.data[yv]=r.title),null)))}(u.route,i,n,t)),Vo(()=>s++),LE(1),Wn(u=>s===r.length?Ln(e):bs))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Vo({next:()=>C=!0,complete:()=>{C||(this.restoreHistory(y),this.cancelNavigationTransition(y,"",2))}}))}),Vo(y=>{const C=new y8(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(C)}))}),nD(m=>{const y=C=>{var I;const A=[];(null===(I=C.routeConfig)||void 0===I?void 0:I.loadComponent)&&!C.routeConfig._loadedComponent&&A.push(this.configLoader.loadComponent(C.routeConfig).pipe(Vo(B=>{C.component=B}),W(()=>{})));for(const B of C.children)A.push(...y(B));return A};return vm(y(m.targetSnapshot.root)).pipe(Pw(),jr(1))}),nD(()=>this.afterPreactivation()),W(m=>{const y=function M8(n,t,e){const i=Tv(n,t._root,e?e._root:void 0);return new _L(i,t)}(this.routeReuseStrategy,m.targetSnapshot,m.currentRouterState);return r=Object.assign(Object.assign({},m),{targetRouterState:y})}),Vo(m=>{this.currentUrlTree=m.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(m.urlAfterRedirects,m.rawUrl),this.routerState=m.targetRouterState,"deferred"===this.urlUpdateStrategy&&(m.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,m),this.browserUrlTree=m.urlAfterRedirects)}),((n,t,e)=>W(i=>(new z8(t,i.targetRouterState,i.currentRouterState,e).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,m=>this.triggerEvent(m)),Vo({next(){s=!0},complete(){s=!0}}),Lw(()=>{var m;s||u||this.cancelNavigationTransition(r,"",1),(null===(m=this.currentNavigation)||void 0===m?void 0:m.id)===r.id&&(this.currentNavigation=null)}),vh(m=>{var y;if(u=!0,EL(m)){TL(m)||(this.navigated=!0,this.restoreHistory(r,!0));const C=new jw(r.id,this.serializeUrl(r.extractedUrl),m.message,m.cancellationCode);if(i.next(C),TL(m)){const I=this.urlHandlingStrategy.merge(m.url,this.rawUrlTree),A={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||WL(r.source)};this.scheduleNavigation(I,"imperative",null,A,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{this.restoreHistory(r,!0);const C=new mL(r.id,this.serializeUrl(r.extractedUrl),m,null!==(y=r.targetSnapshot)&&void 0!==y?y:void 0);i.next(C);try{r.resolve(this.errorHandler(m))}catch(I){r.reject(I)}}return bs}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var r;const s={replaceUrl:!0},u=null!==(r=e.state)&&void 0!==r&&r.navigationId?e.state:null;if(u){const y=Object.assign({},u);delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(s.state=y)}const m=this.parseUrl(e.url);this.scheduleNavigation(m,i,u,s)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){this.config=e.map(QE),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:r,queryParams:s,fragment:u,queryParamsHandling:m,preserveFragment:y}=i,C=r||this.routerState.root,I=y?this.currentUrlTree.fragment:u;let A=null;switch(m){case"merge":A=Object.assign(Object.assign({},this.currentUrlTree.queryParams),s);break;case"preserve":A=this.currentUrlTree.queryParams;break;default:A=s||null}return null!==A&&(A=this.removeEmptyProps(A)),c8(C,this.currentUrlTree,e,A,null!=I?I:null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=Cm(e)?e:this.parseUrl(e),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function j$(n){for(let t=0;t<n.length;t++){if(null==n[t])throw new zt(4008,false)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,e)}return i}isActive(e,i){let r;if(r=!0===i?Object.assign({},B$):!1===i?Object.assign({},z$):i,Cm(e))return tL(this.currentUrlTree,e,r);const s=this.parseUrl(e);return tL(this.currentUrlTree,s,r)}removeEmptyProps(e){return Object.keys(e).reduce((i,r)=>{const s=e[r];return null!=s&&(i[r]=s),i},{})}processNavigations(){this.navigations.subscribe(e=>{var i;this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new Tm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,null===(i=this.titleStrategy)||void 0===i||i.updateTitle(this.routerState.snapshot),e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,r,s,u){var m,y;if(this.disposed)return Promise.resolve(!1);let C,I,A;u?(C=u.resolve,I=u.reject,A=u.promise):A=new Promise((K,pe)=>{C=K,I=pe});const B=++this.navigationId;let j;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),j=r&&r.\u0275routerPageId?r.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?null!==(m=this.browserPageId)&&void 0!==m?m:0:(null!==(y=this.browserPageId)&&void 0!==y?y:0)+1):j=0,this.setTransition({id:B,targetPageId:j,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:s,resolve:C,reject:I,promise:A,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),A.catch(K=>Promise.reject(K))}setBrowserUrl(e,i){const r=this.urlSerializer.serialize(e),s=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",s):this.location.go(r,"",s)}restoreHistory(e,i=!1){var r,s;if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)||0===u?this.currentUrlTree===(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)&&0===u&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(u)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i,r){const s=new jw(e.id,this.serializeUrl(e.extractedUrl),i,r);this.triggerEvent(s),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return n.\u0275fac=function(e){nu()},n.\u0275prov=Qt({token:n,factory:function(){return GL()},providedIn:"root"}),n})();function WL(n){return"imperative"!==n}let Xb=(()=>{class n{constructor(e,i,r){this.router=e,this.route=i,this.locationStrategy=r,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.href=null,this.onChanges=new Kt,this.subscription=e.events.subscribe(s=>{s instanceof Tm&&this.updateTargetUrlAndHref()})}set preserveFragment(e){this._preserveFragment=fh(e)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(e){this._skipLocationChange=fh(e)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(e){this._replaceUrl=fh(e)}get replaceUrl(){return this._replaceUrl}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:null}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,i,r,s,u){return!!(0!==e||i||r||s||u||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!1)}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return n.\u0275fac=function(e){return new(e||n)(H(hs),H(Em),H(fm))},n.\u0275dir=Bt({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,i){1&e&&Ft("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&e&&fn("target",i.target)("href",i.href,_a)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[hr]}),n})();class XL{}let $$=(()=>{class n{constructor(e,i,r,s,u){this.router=e,this.injector=r,this.preloadingStrategy=s,this.loader=u}setUpPreloading(){this.subscription=this.router.events.pipe(Tr(e=>e instanceof Tm),Fp(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){var r,s,u;const m=[];for(const y of i){y.providers&&!y._injector&&(y._injector=Dx(y.providers,e,`Route: ${y.path}`));const C=null!==(r=y._injector)&&void 0!==r?r:e,I=null!==(s=y._loadedInjector)&&void 0!==s?s:C;y.loadChildren&&!y._loadedRoutes&&void 0===y.canLoad||y.loadComponent&&!y._loadedComponent?m.push(this.preloadConfig(C,y)):(y.children||y._loadedRoutes)&&m.push(this.processRoutes(I,null!==(u=y.children)&&void 0!==u?u:y._loadedRoutes))}return ro(m).pipe(Ql())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):Ln(null);const s=r.pipe(Wn(u=>{var m;return null===u?Ln(void 0):(i._loadedRoutes=u.routes,i._loadedInjector=u.injector,this.processRoutes(null!==(m=u.injector)&&void 0!==m?m:e,u.routes))}));return i.loadComponent&&!i._loadedComponent?ro([s,this.loader.loadComponent(i)]).pipe(Ql()):s})}}return n.\u0275fac=function(e){return new(e||n)(je(hs),je(KC),je(Jc),je(XL),je(rD))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const sD=new It("");let ZL=(()=>{class n{constructor(e,i,r={}){this.router=e,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof UE?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Tm&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof gL&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new gL(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){nu()},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();function Zb(n,t){return{\u0275kind:n,\u0275providers:t}}function aD(n){return[{provide:iD,multi:!0,useValue:n}]}function KL(){const n=Fr(Nr);return t=>{var e,i;const r=n.get(Lb);if(t!==r.components[0])return;const s=n.get(hs),u=n.get(QL);1===n.get(lD)&&s.initialNavigation(),null===(e=n.get(JL,null,$n.Optional))||void 0===e||e.setUpPreloading(),null===(i=n.get(sD,null,$n.Optional))||void 0===i||i.init(),s.resetRootComponentType(r.componentTypes[0]),u.closed||(u.next(),u.unsubscribe())}}const QL=new It("",{factory:()=>new Kt}),lD=new It("",{providedIn:"root",factory:()=>1});const JL=new It("");function X$(n){return Zb(0,[{provide:JL,useExisting:$$},{provide:XL,useExisting:n}])}const eO=new It("ROUTER_FORROOT_GUARD"),Z$=[zx,{provide:oL,useClass:FE},{provide:hs,useFactory:GL},Ev,{provide:Em,useFactory:function YL(n){return n.routerState.root},deps:[hs]},rD];function Y$(){return new vk("Router",hs)}let tS=(()=>{class n{constructor(e){}static forRoot(e,i){return{ngModule:n,providers:[Z$,[],aD(e),{provide:eO,useFactory:eq,deps:[[hs,new cp,new up]]},{provide:Kw,useValue:i||{}},null!=i&&i.useHash?{provide:fm,useClass:ZV}:{provide:fm,useClass:qk},{provide:sD,useFactory:()=>{const n=Fr(hs),t=Fr(lj),e=Fr(Kw);return e.scrollOffset&&t.setOffset(e.scrollOffset),new ZL(n,t,e)}},null!=i&&i.preloadingStrategy?X$(i.preloadingStrategy).\u0275providers:[],{provide:vk,multi:!0,useFactory:Y$},null!=i&&i.initialNavigation?tq(i):[],[{provide:tO,useFactory:KL},{provide:pk,multi:!0,useExisting:tO}]]}}static forChild(e){return{ngModule:n,providers:[aD(e)]}}}return n.\u0275fac=function(e){return new(e||n)(je(eO,8))},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[YE]}),n})();function eq(n){return"guarded"}function tq(n){return["disabled"===n.initialNavigation?Zb(3,[{provide:kx,multi:!0,useFactory:()=>{const t=Fr(hs);return()=>{t.setUpLocationChangeListener()}}},{provide:lD,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?Zb(2,[{provide:lD,useValue:0},{provide:kx,multi:!0,deps:[Nr],useFactory:t=>{const e=t.get(WV,Promise.resolve());let i=!1;return()=>e.then(()=>new Promise(s=>{const u=t.get(hs),m=t.get(QL);(function r(s){t.get(hs).events.pipe(Tr(m=>m instanceof Tm||m instanceof jw||m instanceof mL),W(m=>m instanceof Tm||m instanceof jw&&(0===m.code||1===m.code)&&null),Tr(m=>null!==m),jr(1)).subscribe(()=>{s()})})(()=>{s(!0),i=!0}),u.afterPreactivation=()=>(s(!0),i||m.closed?Ln(void 0):m),u.initialNavigation()}))}}]).\u0275providers:[]]}const tO=new It("");let cD;try{cD="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){cD=!1}let Yb,ps=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function aj(n){return n===dR}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!cD)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(je(Px))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const nO=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function iO(){if(Yb)return Yb;if("object"!=typeof document||!document)return Yb=new Set(nO),Yb;let n=document.createElement("input");return Yb=new Set(nO.filter(t=>(n.setAttribute("type",t),n.type===t))),Yb}let Rv,Dm,uD;function Up(n){return function iq(){if(null==Rv&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Rv=!0}))}finally{Rv=Rv||!1}return Rv}()?n:!!n.capture}function rq(){if(null==Dm){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Dm=!1,Dm;if("scrollBehavior"in document.documentElement.style)Dm=!0;else{const n=Element.prototype.scrollTo;Dm=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return Dm}function du(){let n="undefined"!=typeof document&&document?document.activeElement:null;for(;n&&n.shadowRoot;){const t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function Hp(n){return n.composedPath?n.composedPath()[0]:n.target}function dD(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function ca(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}class _q extends ie{constructor(t,e){super()}schedule(t,e=0){return this}}const iS={setInterval(n,t,...e){const{delegate:i}=iS;return null!=i&&i.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){const{delegate:t}=iS;return((null==t?void 0:t.clearInterval)||clearInterval)(n)},delegate:void 0};class gD extends _q{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){var i;if(this.closed)return this;this.state=t;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,e),this}requestAsyncId(t,e,i=0){return iS.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&iS.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,i=!1;try{this.work(t)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,p(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}const aO={now:()=>(aO.delegate||Date).now(),delegate:void 0};class Pv{constructor(t,e=Pv.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}Pv.now=aO.now;class bD extends Pv{constructor(t,e=Pv.now){super(t,e),this.actions=[],this._active=!1}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const rS=new bD(gD),yq=rS;function Lv(n,t=rS){return ki((e,i)=>{let r=null,s=null,u=null;const m=()=>{if(r){r.unsubscribe(),r=null;const C=s;s=null,i.next(C)}};function y(){const C=u+n,I=t.now();if(I<C)return r=this.schedule(void 0,C-I),void i.add(r);m()}e.subscribe(Ii(i,C=>{s=C,u=t.now(),r||(r=t.schedule(y,n),i.add(r))},()=>{m(),i.complete()},void 0,()=>{s=r=null}))})}function lO(n){return Tr((t,e)=>n<=e)}function $p(n,t=vt){return n=null!=n?n:vq,ki((e,i)=>{let r,s=!0;e.subscribe(Ii(i,u=>{const m=t(u);(s||!n(r,m))&&(s=!1,r=m,i.next(u))}))})}function vq(n,t){return n===t}function Oi(n){return ki((t,e)=>{Bi(n).subscribe(Ii(e,()=>e.complete(),$e)),!e.closed&&t.subscribe(e)})}function Hn(n){return null!=n&&"false"!=`${n}`}function Th(n,t=0){return function xq(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):t}function oS(n){return Array.isArray(n)?n:[n]}function fs(n){return null==n?"":"string"==typeof n?n:`${n}px`}function Am(n){return n instanceof En?n.nativeElement:n}function _D(n,t=/\s+/){const e=[];if(null!=n){const i=Array.isArray(n)?n:`${n}`.split(t);for(const r of i){const s=`${r}`.trim();s&&e.push(s)}}return e}let cO=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),uO=(()=>{class n{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,i)=>this._cleanupObserver(i))}observe(e){const i=Am(e);return new Lt(r=>{const u=this._observeElement(i).subscribe(r);return()=>{u.unsubscribe(),this._unobserveElement(i)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const i=new Kt,r=this._mutationObserverFactory.create(s=>i.next(s));r&&r.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:r,stream:i,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:i,stream:r}=this._observedElements.get(e);i&&i.disconnect(),r.complete(),this._observedElements.delete(e)}}}return n.\u0275fac=function(e){return new(e||n)(je(cO))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),dO=(()=>{class n{constructor(e,i,r){this._contentObserver=e,this._elementRef=i,this._ngZone=r,this.event=new tn,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(e){this._disabled=Hn(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=Th(e),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(Lv(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){var e;null===(e=this._currentSubscription)||void 0===e||e.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(H(uO),H(En),H(Xn))},n.\u0275dir=Bt({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),sS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[cO]}),n})();const hO=new Set;let Qb,wq=(()=>{class n{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Cq}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function Sq(n){if(!hO.has(n))try{Qb||(Qb=document.createElement("style"),Qb.setAttribute("type","text/css"),document.head.appendChild(Qb)),Qb.sheet&&(Qb.sheet.insertRule(`@media ${n} {body{ }}`,0),hO.add(n))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}return n.\u0275fac=function(e){return new(e||n)(je(ps))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Cq(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let yD=(()=>{class n{constructor(e,i){this._mediaMatcher=e,this._zone=i,this._queries=new Map,this._destroySubject=new Kt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return pO(oS(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let s=vm(pO(oS(e)).map(u=>this._registerQuery(u).observable));return s=bv(s.pipe(jr(1)),s.pipe(lO(1),Lv(0))),s.pipe(W(u=>{const m={matches:!1,breakpoints:{}};return u.forEach(({matches:y,query:C})=>{m.matches=m.matches||y,m.breakpoints[C]=y}),m}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),s={observable:new Lt(u=>{const m=y=>this._zone.run(()=>u.next(y));return i.addListener(m),()=>{i.removeListener(m)}}).pipe(As(i),W(({matches:u})=>({query:e,matches:u})),Oi(this._destroySubject)),mql:i};return this._queries.set(e,s),s}}return n.\u0275fac=function(e){return new(e||n)(je(wq),je(Xn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function pO(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function aS(n,t){return(n.getAttribute(t)||"").match(/\S+/g)||[]}const mO="cdk-describedby-message",lS="cdk-describedby-host";let vD=0,gO=(()=>{class n{constructor(e,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+vD++,this._document=e,this._id=Fr(Pb)+"-"+vD++}describe(e,i,r){if(!this._canBeDescribed(e,i))return;const s=xD(i,r);"string"!=typeof i?(bO(i,this._id),this._messageRegistry.set(s,{messageElement:i,referenceCount:0})):this._messageRegistry.has(s)||this._createMessageElement(i,r),this._isElementDescribedByMessage(e,s)||this._addMessageReference(e,s)}removeDescription(e,i,r){var s;if(!i||!this._isElementNode(e))return;const u=xD(i,r);if(this._isElementDescribedByMessage(e,u)&&this._removeMessageReference(e,u),"string"==typeof i){const m=this._messageRegistry.get(u);m&&0===m.referenceCount&&this._deleteMessageElement(u)}0===(null===(s=this._messagesContainer)||void 0===s?void 0:s.childNodes.length)&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){var e;const i=this._document.querySelectorAll(`[${lS}="${this._id}"]`);for(let r=0;r<i.length;r++)this._removeCdkDescribedByReferenceIds(i[r]),i[r].removeAttribute(lS);null===(e=this._messagesContainer)||void 0===e||e.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,i){const r=this._document.createElement("div");bO(r,this._id),r.textContent=e,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(xD(e,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(e){var i,r;null===(r=null===(i=this._messageRegistry.get(e))||void 0===i?void 0:i.messageElement)||void 0===r||r.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let s=0;s<i.length;s++)i[s].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(e),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(e){const i=aS(e,"aria-describedby").filter(r=>0!=r.indexOf(mO));e.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(e,i){const r=this._messageRegistry.get(i);(function Tq(n,t,e){const i=aS(n,t);i.some(r=>r.trim()==e.trim())||(i.push(e.trim()),n.setAttribute(t,i.join(" ")))})(e,"aria-describedby",r.messageElement.id),e.setAttribute(lS,this._id),r.referenceCount++}_removeMessageReference(e,i){const r=this._messageRegistry.get(i);r.referenceCount--,function Eq(n,t,e){const r=aS(n,t).filter(s=>s!=e.trim());r.length?n.setAttribute(t,r.join(" ")):n.removeAttribute(t)}(e,"aria-describedby",r.messageElement.id),e.removeAttribute(lS)}_isElementDescribedByMessage(e,i){const r=aS(e,"aria-describedby"),s=this._messageRegistry.get(i),u=s&&s.messageElement.id;return!!u&&-1!=r.indexOf(u)}_canBeDescribed(e,i){if(!this._isElementNode(e))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),s=e.getAttribute("aria-label");return!(!r||s&&s.trim()===r)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(e){return new(e||n)(je(Gn),je(ps))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function xD(n,t){return"string"==typeof n?`${t||""}/${n}`:n}function bO(n,t){n.id||(n.id=`${mO}-${t}-${vD++}`)}class _O{constructor(t){this._items=t,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new Kt,this._typeaheadSubscription=ie.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new Kt,this.change=new Kt,t instanceof hm&&t.changes.subscribe(e=>{if(this._activeItem){const r=e.toArray().indexOf(this._activeItem);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r)}})}skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(Vo(e=>this._pressedLetters.push(e)),Lv(t),Tr(()=>this._pressedLetters.length>0),W(()=>this._pressedLetters.join(""))).subscribe(e=>{const i=this._getItemsArray();for(let r=1;r<i.length+1;r++){const s=(this._activeItemIndex+r)%i.length,u=i[s];if(!this._skipPredicateFn(u)&&0===u.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(s);break}}this._pressedLetters=[]}),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}setActiveItem(t){const e=this._activeItem;this.updateActiveItem(t),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(t){const e=t.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(s=>!t[s]||this._allowedModifierKeys.indexOf(s)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;default:return void((r||ca(t,"shiftKey"))&&(t.key&&1===t.key.length?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){const e=this._getItemsArray(),i="number"==typeof t?t:e.indexOf(t),r=e[i];this._activeItem=null==r?null:r,this._activeItemIndex=i}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const r=(this._activeItemIndex+t*i+e.length)%e.length;if(!this._skipPredicateFn(e[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,e){const i=this._getItemsArray();if(i[t]){for(;this._skipPredicateFn(i[t]);)if(!i[t+=e])return;this.setActiveItem(t)}}_getItemsArray(){return this._items instanceof hm?this._items.toArray():this._items}}class yO extends _O{setActiveItem(t){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(t),this.activeItem&&this.activeItem.setActiveStyles()}}class wD extends _O{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}}let km=(()=>{class n{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function Iq(n){return!!(n.offsetWidth||n.offsetHeight||"function"==typeof n.getClientRects&&n.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function Dq(n){try{return n.frameElement}catch(t){return null}}(function Fq(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}(e));if(i&&(-1===xO(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),s=xO(e);return e.hasAttribute("contenteditable")?-1!==s:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function Lq(n){let t=n.nodeName.toLowerCase(),e="input"===t&&n.type;return"text"===e||"password"===e||"select"===t||"textarea"===t}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==s:"video"===r?-1!==s&&(null!==s||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function Oq(n){return!function Aq(n){return function Rq(n){return"input"==n.nodeName.toLowerCase()}(n)&&"hidden"==n.type}(n)&&(function Mq(n){let t=n.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(n)||function kq(n){return function Pq(n){return"a"==n.nodeName.toLowerCase()}(n)&&n.hasAttribute("href")}(n)||n.hasAttribute("contenteditable")||vO(n))}(e)&&!this.isDisabled(e)&&((null==i?void 0:i.ignoreVisibility)||this.isVisible(e))}}return n.\u0275fac=function(e){return new(e||n)(je(ps))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function vO(n){if(!n.hasAttribute("tabindex")||void 0===n.tabIndex)return!1;let t=n.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function xO(n){if(!vO(n))return null;const t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class wO{constructor(t,e,i,r,s=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,s||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(jr(1)).subscribe(t)}}let Jb=(()=>{class n{constructor(e,i,r){this._checker=e,this._ngZone=i,this._document=r}create(e,i=!1){return new wO(e,this._checker,this._ngZone,this._document,i)}}return n.\u0275fac=function(e){return new(e||n)(je(km),je(Xn),je(Gn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Nq=(()=>{class n{constructor(e,i,r){this._elementRef=e,this._focusTrapFactory=i,this._previouslyFocusedElement=null,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(e){this.focusTrap.enabled=Hn(e)}get autoCapture(){return this._autoCapture}set autoCapture(e){this._autoCapture=Hn(e)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}ngOnChanges(e){const i=e.autoCapture;i&&!i.firstChange&&this.autoCapture&&this.focusTrap.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=du(),this.focusTrap.focusInitialElementWhenReady()}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Jb),H(Gn))},n.\u0275dir=Bt({type:n,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:["cdkTrapFocus","enabled"],autoCapture:["cdkTrapFocusAutoCapture","autoCapture"]},exportAs:["cdkTrapFocus"],features:[hr]}),n})();class Bq extends wO{constructor(t,e,i,r,s,u,m){super(t,e,i,r,m.defer),this._focusTrapManager=s,this._inertStrategy=u,this._focusTrapManager.register(this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const zq=new It("FOCUS_TRAP_INERT_STRATEGY");class Vq{constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=e=>this._trapFocus(t,e),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){!this._listener||(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,e){var i;const r=e.target,s=t._element;r&&!s.contains(r)&&(null===(i=r.closest)||void 0===i||!i.call(r,"div.cdk-overlay-pane"))&&setTimeout(()=>{t.enabled&&!s.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let jq=(()=>{class n{constructor(){this._focusTrapStack=[]}register(e){this._focusTrapStack=this._focusTrapStack.filter(r=>r!==e);let i=this._focusTrapStack;i.length&&i[i.length-1]._disable(),i.push(e),e._enable()}deregister(e){e._disable();const i=this._focusTrapStack,r=i.indexOf(e);-1!==r&&(i.splice(r,1),i.length&&i[i.length-1]._enable())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),SO=(()=>{class n{constructor(e,i,r,s,u){this._checker=e,this._ngZone=i,this._focusTrapManager=r,this._document=s,this._inertStrategy=u||new Vq}create(e,i={defer:!1}){let r;return r="boolean"==typeof i?{defer:i}:i,new Bq(e,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,r)}}return n.\u0275fac=function(e){return new(e||n)(je(km),je(Xn),je(jq),je(Gn),je(zq,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const $q=new It("cdk-input-modality-detector-options"),qq={ignoreKeys:[18,17,224,91,16]},e_=Up({passive:!0,capture:!0});let Gq=(()=>{class n{constructor(e,i,r,s){this._platform=e,this._mostRecentTarget=null,this._modality=new sa(null),this._lastTouchMs=0,this._onKeydown=u=>{var m,y;null!==(y=null===(m=this._options)||void 0===m?void 0:m.ignoreKeys)&&void 0!==y&&y.some(C=>C===u.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Hp(u))},this._onMousedown=u=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function Uq(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(u)?"keyboard":"mouse"),this._mostRecentTarget=Hp(u))},this._onTouchstart=u=>{!function Hq(n){const t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(u)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Hp(u)):this._modality.next("keyboard")},this._options=Object.assign(Object.assign({},qq),s),this.modalityDetected=this._modality.pipe(lO(1)),this.modalityChanged=this.modalityDetected.pipe($p()),e.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,e_),r.addEventListener("mousedown",this._onMousedown,e_),r.addEventListener("touchstart",this._onTouchstart,e_)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,e_),document.removeEventListener("mousedown",this._onMousedown,e_),document.removeEventListener("touchstart",this._onTouchstart,e_))}}return n.\u0275fac=function(e){return new(e||n)(je(ps),je(Xn),je(Gn),je($q,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Wq=new It("liveAnnouncerElement",{providedIn:"root",factory:function Xq(){return null}}),Zq=new It("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let TO=(()=>{class n{constructor(e,i,r,s){this._ngZone=i,this._defaultOptions=s,this._document=r,this._liveElement=e||this._createLiveElement()}announce(e,...i){const r=this._defaultOptions;let s,u;return 1===i.length&&"number"==typeof i[0]?u=i[0]:[s,u]=i,this.clear(),clearTimeout(this._previousTimeout),s||(s=r&&r.politeness?r.politeness:"polite"),null==u&&r&&(u=r.duration),this._liveElement.setAttribute("aria-live",s),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(m=>this._currentResolve=m)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,"number"==typeof u&&(this._previousTimeout=setTimeout(()=>this.clear(),u)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){var e,i;clearTimeout(this._previousTimeout),null===(e=this._liveElement)||void 0===e||e.remove(),this._liveElement=null,null===(i=this._currentResolve)||void 0===i||i.call(this),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let s=0;s<i.length;s++)i[s].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),this._document.body.appendChild(r),r}}return n.\u0275fac=function(e){return new(e||n)(je(Wq,8),je(Xn),je(Gn),je(Zq,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Yq=new It("cdk-focus-monitor-default-options"),cS=Up({passive:!0,capture:!0});let xa=(()=>{class n{constructor(e,i,r,s,u){this._ngZone=e,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Kt,this._rootNodeFocusAndBlurListener=m=>{for(let C=Hp(m);C;C=C.parentElement)"focus"===m.type?this._onFocus(m,C):this._onBlur(m,C)},this._document=s,this._detectionMode=(null==u?void 0:u.detectionMode)||0}monitor(e,i=!1){const r=Am(e);if(!this._platform.isBrowser||1!==r.nodeType)return Ln(null);const s=function sq(n){if(function oq(){if(null==uD){const n="undefined"!=typeof document?document.head:null;uD=!(!n||!n.createShadowRoot&&!n.attachShadow)}return uD}()){const t=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),u=this._elementInfo.get(r);if(u)return i&&(u.checkChildren=!0),u.subject;const m={checkChildren:i,subject:new Kt,rootNode:s};return this._elementInfo.set(r,m),this._registerGlobalListeners(m),m.subject}stopMonitoring(e){const i=Am(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const s=Am(e);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([m,y])=>this._originChanged(m,i,y)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!(null==e||!e.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),s=Hp(e);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,cS),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,cS)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Oi(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,cS),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,cS),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,s)=>{(s===e||r.checkChildren&&s.contains(e))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const s=e.labels;if(s)for(let u=0;u<s.length;u++)if(s[u].contains(i))return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(je(Xn),je(ps),je(Gq),je(Gn,8),je(Yq,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Kq=(()=>{class n{constructor(e,i){this._elementRef=e,this._focusMonitor=i,this._focusOrigin=null,this.cdkFocusChange=new tn}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){const e=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(e,1===e.nodeType&&e.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>{this._focusOrigin=i,this.cdkFocusChange.emit(i)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(xa))},n.\u0275dir=Bt({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"]}),n})();const EO="cdk-high-contrast-black-on-white",DO="cdk-high-contrast-white-on-black",SD="cdk-high-contrast-active";let IO=(()=>{class n{constructor(e,i){this._platform=e,this._document=i,this._breakpointSubscription=Fr(yD).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(SD,EO,DO),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?e.add(SD,EO):2===i&&e.add(SD,DO)}}}return n.\u0275fac=function(e){return new(e||n)(je(ps),je(Gn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Rm=(()=>{class n{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(e){return new(e||n)(je(IO))},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[sS]}),n})();class CD{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class dd extends CD{constructor(t,e,i,r){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=r}}class Pm extends CD{constructor(t,e,i,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class Qq extends CD{constructor(t){super(),this.element=t instanceof En?t.nativeElement:t}}class Ov{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof dd?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof Pm?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof Qq?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class Jq extends Ov{constructor(t,e,i,r,s){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=u=>{const m=u.element,y=this._document.createComment("dom-portal");m.parentNode.insertBefore(y,m),this.outletElement.appendChild(m),this._attachedPortal=u,super.setDisposeFn(()=>{y.parentNode&&y.parentNode.replaceChild(m,y)})},this._document=s}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||Nr.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let hd=(()=>{class n extends Ov{constructor(e,i,r){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new tn,this.attachDomPortal=s=>{const u=s.element,m=this._document.createComment("dom-portal");s.setAttachedHost(this),u.parentNode.insertBefore(m,u),this._getRootNode().appendChild(u),this._attachedPortal=s,super.setDisposeFn(()=>{m.parentNode&&m.parentNode.replaceChild(u,m)})},this._document=r}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,s=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),u=i.createComponent(s,i.length,e.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(u.hostView.rootNodes[0]),super.setDisposeFn(()=>u.destroy()),this._attachedPortal=e,this._attachedRef=u,this.attached.emit(u),u}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return n.\u0275fac=function(e){return new(e||n)(H(eh),H(zo),H(Gn))},n.\u0275dir=Bt({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Xt]}),n})(),ua=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({}),n})();class MO{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const i=this._customTokens.get(t);return void 0!==i?i:this._parentInjector.get(t,e)}}const eG=["addListener","removeListener"],tG=["addEventListener","removeEventListener"],nG=["on","off"];function hu(n,t,e,i){if(ye(e)&&(i=e,e=void 0),i)return hu(n,t,e).pipe(dE(i));const[r,s]=function oG(n){return ye(n.addEventListener)&&ye(n.removeEventListener)}(n)?tG.map(u=>m=>n[u](t,m,e)):function iG(n){return ye(n.addListener)&&ye(n.removeListener)}(n)?eG.map(AO(n,t)):function rG(n){return ye(n.on)&&ye(n.off)}(n)?nG.map(AO(n,t)):[];if(!r&&ze(n))return Wn(u=>hu(u,t,e))(Bi(n));if(!r)throw new TypeError("Invalid event target");return new Lt(u=>{const m=(...y)=>u.next(1<y.length?y:y[0]);return r(m),()=>s(m)})}function AO(n,t){return e=>i=>n[e](t,i)}const Fv={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=Fv;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=t(s=>{e=void 0,n(s)});return new ie(()=>null==e?void 0:e(r))},requestAnimationFrame(...n){const{delegate:t}=Fv;return((null==t?void 0:t.requestAnimationFrame)||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=Fv;return((null==t?void 0:t.cancelAnimationFrame)||cancelAnimationFrame)(...n)},delegate:void 0};new class aG extends bD{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class sG extends gD{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Fv.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:s}=t;null!=e&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(Fv.cancelAnimationFrame(e),t._scheduled=void 0)}});let TD,cG=1;const uS={};function kO(n){return n in uS&&(delete uS[n],!0)}const uG={setImmediate(n){const t=cG++;return uS[t]=!0,TD||(TD=Promise.resolve()),TD.then(()=>kO(t)&&n()),t},clearImmediate(n){kO(n)}},{setImmediate:dG,clearImmediate:hG}=uG,dS={setImmediate(...n){const{delegate:t}=dS;return((null==t?void 0:t.setImmediate)||dG)(...n)},clearImmediate(n){const{delegate:t}=dS;return((null==t?void 0:t.clearImmediate)||hG)(n)},delegate:void 0};new class fG extends bD{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class pG extends gD{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=dS.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:s}=t;null!=e&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==e&&(dS.clearImmediate(e),t._scheduled=void 0)}});function ED(n=0,t,e=yq){let i=-1;return null!=t&&(Da(t)?e=t:i=t),new Lt(r=>{let s=function bG(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;s<0&&(s=0);let u=0;return e.schedule(function(){r.closed||(r.next(u++),0<=i?this.schedule(void 0,i):r.complete())},s)})}function RO(n,t=rS){return function gG(n){return ki((t,e)=>{let i=!1,r=null,s=null,u=!1;const m=()=>{if(null==s||s.unsubscribe(),s=null,i){i=!1;const C=r;r=null,e.next(C)}u&&e.complete()},y=()=>{s=null,u&&e.complete()};t.subscribe(Ii(e,C=>{i=!0,r=C,s||Bi(n(C)).subscribe(s=Ii(e,m,y))},()=>{u=!0,(!i||!s||s.closed)&&e.complete()}))})}(()=>ED(n,t))}const _G=new It("cdk-dir-doc",{providedIn:"root",factory:function yG(){return Fr(Gn)}}),vG=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let qp=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new tn,e){const r=e.documentElement?e.documentElement.dir:null;this.value=function xG(n){const t=(null==n?void 0:n.toLowerCase())||"";return"auto"===t&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?vG.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(je(_G,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),hS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({}),n})(),PO=(()=>{class n{constructor(e,i,r){this._ngZone=e,this._platform=i,this._scrolled=new Kt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new Lt(i=>{this._globalSubscription||this._addGlobalListener();const r=e>0?this._scrolled.pipe(RO(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Ln()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(Tr(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,e)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let r=Am(i),s=e.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>hu(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(je(Xn),je(ps),je(Gn,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),pu=(()=>{class n{constructor(e,i,r){this._platform=e,this._change=new Kt,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(e.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,s=r.getBoundingClientRect();return{top:-s.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(RO(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(je(ps),je(Xn),je(Gn,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Lm=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({}),n})(),DD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[hS,Lm,hS,Lm]}),n})();const CG=["*",[["sbb-option"],["ng-container"],["sbb-option-hint"],["sbb-autocomplete-hint"]]],TG=["*","sbb-option, ng-container, sbb-option-hint, sbb-autocomplete-hint"];function EG(n,t){if(1&n&&en(0,"sbb-pseudo-checkbox",2),2&n){const e=St();Le("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function DG(n,t){if(1&n&&(X(0,"span",3),Ce(1),Y()),2&n){const e=St();ae(1),wi("(",e.group.label,")")}}const IG=["*"],MG=(new tu("14.1.7"),"undefined"!=typeof globalThis&&globalThis),AG="undefined"!=typeof window&&window,kG="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ID=MG||"undefined"!=typeof global&&global||AG||kG,MD=function(n,...t){if(MD.translate){const i=MD.translate(n,t);n=i[0],t=i[1]}let e=NO(n[0],n.raw[0]);for(let i=1;i<n.length;i++)e+=t[i-1]+NO(n[i],n.raw[i]);return e};function NO(n,t){return":"===t.charAt(0)?n.substring(function RG(n,t){for(let e=1,i=1;e<n.length;e++,i++)if("\\"===t[i])i++;else if(":"===n[e])return e;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(n,t)+1):n}const AD=new sa("standard");function Om(n){return class extends n{constructor(...t){super(...t),this.variant=AD}get variantSnapshot(){return AD.value}}}const LG=new It("sbb-sanity-checks",{providedIn:"root",factory:function PG(){return!0}});let Zi=(()=>{class n{constructor(e,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,AD.next(this._document.documentElement.classList.contains("sbb-lean")?"lean":"standard"),e._applyBodyHighContrastModeCssClasses(),function OG(){"function"!=typeof ID.$localize&&(ID.$localize=Object.assign(MD,ID.$localize))}(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!dD()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return n.\u0275fac=function(e){return new(e||n)(je(IO),je(LG,8),je(Gn))},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({}),n})();function Ka(n){return class extends n{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=Hn(t)}}}function pS(n){return class extends n{constructor(...t){super(...t),this.errorState=!1}updateErrorState(){const t=this.errorState,s=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);s!==t&&(this.errorState=s,this.stateChanges.next())}}}function BO(n){return class extends n{constructor(...t){super(...t),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new Lt(e=>{this._isInitialized?this._notifySubscriber(e):this._pendingSubscribers.push(e)})}_markInitialized(){this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(t){t.next(),t.complete()}}}function t_(n,t=0){return class extends n{constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?Th(e):this.defaultTabIndex}}}class Gp{deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this._locale=t}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){const i=this.isValid(t),r=this.isValid(e);return i&&r?!this.compareDate(t,e):i===r}return t===e}clampDate(t,e,i){return e&&this.compareDate(t,e)<0?e:i&&this.compareDate(t,i)>0?i:t}}const fS=new It("sbb-date-formats"),FG={dateInput:"EEEEEE, dd.MM.yyyy",dateInputPure:"dd.MM.yyyy",dateA11yLabel:"dd MM yyyy"},zO=new It("SBB_DATEPICKER_2DIGIT_YEAR_PIVOT"),NG=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function kD(n,t){const e=Array(n);for(let i=0;i<n;i++)e[i]=t(i);return e}let VO=(()=>{class n extends Gp{constructor(e,i){super(),this._locale=e,this._titleCasePipe=new lR,this._datePipe=new cR(e),this._yearPivot="number"==typeof i?i:(new Date).getFullYear()-1975}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthName(e){return this._datePipe.transform(e,"LLLL")}getMonthNames(e){let i;switch(e){case"long":i="LLLL";break;case"narrow":i="LLLLL";break;default:i="LLL"}return kD(12,r=>this._datePipe.transform(new Date(2017,r,1),i))}getDateNames(){return kD(31,e=>this._datePipe.transform(new Date(2017,0,e+1),"d"))}getDayOfWeekNames(e){let i;switch(e){case"long":i="EEEE";break;case"narrow":i="EEEEE";break;default:i="EEE"}return kD(7,r=>this._datePipe.transform(new Date(2017,0,r+1),i))}getYearName(e){return this._datePipe.transform(e,"yyyy")}getFirstDayOfWeek(){return 1}getNumDaysInMonth(e){const i=new Date(0);return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.setHours(0,0,0,0),i.getDate()}clone(e){return new Date(e.valueOf())}createDate(e,i,r){if(i<0||i>11)throw Error(`Invalid month index "${i}". Month index has to be between 0 and 11.`);if(r<1)throw Error(`Invalid date "${r}". Date has to be greater than 0.`);const s=this._createDateWithOverflow(e,i,r);if(s.getMonth()!==i)throw Error(`Invalid date "${r}" for month with index "${i}".`);return s}today(){const e=new Date;return e.setHours(0,0,0,0),e}parse(e){return"number"==typeof e?new Date(e):"string"==typeof e?this._parseStringDate(e):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");return this._titleCasePipe.transform(this._datePipe.transform(e,i))}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){const r=e.getMonth()+i,s=new Date(0);s.setFullYear(e.getFullYear(),r,1),s.setHours(0,0,0,0);const u=this.getNumDaysInMonth(s),m=this.clone(e);return m.setMonth(r,Math.min(u,e.getDate())),m}addCalendarDays(e,i){const r=this.clone(e);return r.setDate(r.getDate()+i),r}toIso8601(e){return this._datePipe.transform(e,"yyyy-MM-dd")}deserialize(e){if("string"==typeof e){if(!e)return null;if(NG.test(e)){const i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.valueOf())}invalid(){return new Date(NaN)}_parseStringDate(e){const i=/^(\w+,[ ]?)?(\d+)\.(\d+)\.(\d+)$/.exec(e);if(!i)return null;const r=this._createDateWithOverflow(+i[4],+i[3]-1,+i[2]);return this._normalizeYear(r)}_normalizeYear(e){if(e.getFullYear()<0||e.getFullYear()>=100)return e;const i=e.getFullYear()<=this._yearPivot?2e3:1900;return new Date(e.getFullYear()+i,e.getMonth(),e.getDate())}_createDateWithOverflow(e,i,r){const s=new Date(e,i,r);return e>=0&&e<100&&s.setFullYear(this.getYear(s)-1900),s}}return n.\u0275fac=function(e){return new(e||n)(je($l),je(zO,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),RD=(()=>{class n{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const mS=new It("SBB_OPTION_PARENT_COMPONENT"),BG=Ka(class{});let zG=0;const jO=new It("SbbOptgroup");let PD=(()=>{class n extends BG{constructor(e){var i;super(),this._labelId="sbb-optgroup-label-"+zG++,this._inert=null!==(i=null==e?void 0:e.inertGroups)&&void 0!==i&&i}}return n.\u0275fac=function(e){return new(e||n)(H(mS,8))},n.\u0275cmp=mn({type:n,selectors:[["sbb-optgroup"]],hostAttrs:[1,"sbb-optgroup","sbb-menu-group"],hostVars:5,hostBindings:function(e,i){2&e&&(fn("role",i._inert?null:"group")("aria-disabled",i._inert?null:i.disabled.toString())("aria-labelledby",i._inert?null:i._labelId),Li("sbb-disabled",i.disabled))},inputs:{disabled:"disabled",label:"label"},exportAs:["sbbOptgroup"],features:[Un([{provide:jO,useExisting:n}]),Xt],ngContentSelectors:TG,decls:4,vars:2,consts:[[1,"sbb-label","sbb-optgroup-label",3,"id"]],template:function(e,i){1&e&&(Ro(CG),X(0,"label",0),Ce(1),Pr(2),Y(),Pr(3,1)),2&e&&(Le("id",i._labelId),ae(1),wi("",i.label," "))},encapsulation:2,changeDetection:0}),n})(),VG=(()=>{class n{constructor(){this.state="unchecked",this.disabled=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["sbb-pseudo-checkbox"]],hostAttrs:[1,"sbb-pseudo-checkbox"],hostVars:6,hostBindings:function(e,i){2&e&&Li("sbb-selection-disabled",i.disabled)("sbb-selection-checked","checked"===i.state)("sbb-selection-indeterminate","indeterminate"===i.state)},inputs:{state:"state",disabled:"disabled"},decls:4,vars:0,consts:[[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"]],template:function(e,i){1&e&&(X(0,"div",0)(1,"span",1),F(),X(2,"svg",2),en(3,"polyline",3),Y()()())},encapsulation:2,changeDetection:0}),n})(),jG=0;class UO{constructor(t,e=!1){this.source=t,this.isUserInput=e}}let Nv=(()=>{class n{constructor(e,i,r,s,u){this._element=e,this._document=i,this._changeDetectorRef=r,this._parent=s,this.group=u,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this._highlighted=!1,this.id="sbb-option-"+jG++,this.onSelectionChange=new tn,this._stateChanges=new Kt}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=Hn(e),this._changeDetectorRef.markForCheck()}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this.selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this.active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this.active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!ca(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this.selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_highlight(e,i){if(void 0===this._originalInnerHtml)this._originalInnerHtml=this._element.nativeElement.innerHTML;else{if(e===this._highlightValue)return;this._highlighted&&(this._element.nativeElement.innerHTML=this._originalInnerHtml,this._highlighted=!1)}if(this._highlightValue=e,e&&this._originalInnerHtml){const r=i||(y=>y),s=(e=r(e)).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),u=new RegExp(`${s}+`,"i"),m=this._findAllTextNodesWithMatch(u,r);m.forEach(y=>this._highlightNode(y,u,r)),this._highlighted=!!m.length}}_findAllTextNodesWithMatch(e,i,r=this._element.nativeElement){const s=[],u=r.childNodes;for(let m=0;m<u.length;m++){const y=u[m];3===y.nodeType&&e.test(i(y.textContent||""))?s.push(y):y.childNodes.length&&s.push(...this._findAllTextNodesWithMatch(e,i,y))}return s}_highlightNode(e,i,r){const s=[],u=this._document;i.lastIndex=0;let y,m=e.textContent||"";do{if(y=r(m).match(i),!y){s.push(u.createTextNode(m));continue}y.index&&(s.push(u.createTextNode(m.substring(0,y.index))),m=m.substring(y.index));const I=u.createElement("strong");I.textContent=m.substring(0,y[0].length),s.push(I),m=m.substring(y[0].length)}while(y);const C=e.parentNode;s.forEach(I=>C.insertBefore(I,e)),C.removeChild(e)}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new UO(this,e))}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Gn),H(Cr),H(mS,8),H(jO,8))},n.\u0275cmp=mn({type:n,selectors:[["sbb-option"]],hostAttrs:["role","option",1,"sbb-option","sbb-menu-item","sbb-link-reset"],hostVars:12,hostBindings:function(e,i){1&e&&Ft("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._selectViaInteraction()}),2&e&&(Cc("id",i.id),fn("tabindex",i._getTabIndex())("aria-selected",i._getAriaSelected())("aria-disabled",i.disabled.toString()),Li("sbb-selected",i.selected)("sbb-option-multiple",i.multiple)("sbb-focused",i.active)("sbb-disabled",i.disabled))},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["sbbOption"],ngContentSelectors:IG,decls:3,vars:2,consts:[[3,"disabled","state",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],[3,"disabled","state"],[1,"cdk-visually-hidden"]],template:function(e,i){1&e&&(Ro(),ft(0,EG,1,2,"sbb-pseudo-checkbox",0),Pr(1),ft(2,DG,2,1,"span",1)),2&e&&(Le("ngIf",i.multiple),ae(2),Le("ngIf",i.group&&i.group._inert))},dependencies:[ho,VG],styles:[".sbb-option.sbb-menu-item{cursor:default}.sbb-pseudo-checkbox{display:inline-block;margin-right:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-bottom:calc(-0.3rem * var(--sbb-scaling-factor));overflow:hidden;line-height:0}.sbb-pseudo-checkbox .sbb-selection-container{margin:0}"],encapsulation:2,changeDetection:0}),n})();function HO(n,t,e,i){return n<e?n:n+t>e+i?Math.max(0,n-i+t):e}let HG=0,$G=(()=>{class n{constructor(){this.id="sbb-option-hint-"+HG++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["sbb-option-hint"]],hostAttrs:[1,"sbb-option-hint","sbb-label"],hostVars:1,hostBindings:function(e,i){2&e&&fn("id",i.id)}}),n})(),gS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi]}),n})();const qG=["*"];let bS;function Bv(n){var t;return(null===(t=function GG(){if(void 0===bS&&(bS=null,"undefined"!=typeof window)){const n=window;void 0!==n.trustedTypes&&(bS=n.trustedTypes.createPolicy("sbb-esta#angular",{createHTML:t=>t}))}return bS}())||void 0===t?void 0:t.createHTML(n))||n}function $O(n){return Error(`Unable to find icon with the name "${n}"`)}function qO(n){return Error(`The URL provided to SbbIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function GO(n){return Error(`The literal provided to SbbIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class Wp{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let XG=(()=>{class n{constructor(e,i,r,s){this._httpClient=e,this._sanitizer=i,this._errorHandler=s,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["sbb-icons"],this._sbbCdnSupportedNamespaces=["kom","fpl"],this._document=r}addSvgIcon(e,i,r){return this.addSvgIconInNamespace("",e,i,r)}addSvgIconLiteral(e,i,r){return this.addSvgIconLiteralInNamespace("",e,i,r)}addSvgIconInNamespace(e,i,r,s){return this._addSvgIconConfig(e,i,new Wp(r,null,s))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,r,s){const u=this._sanitizer.sanitize(lr.HTML,r);if(!u)throw GO(r);const m=Bv(u);return this._addSvgIconConfig(e,i,new Wp("",m,s))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,r){return this._addSvgIconSetConfig(e,new Wp(i,null,r))}addSvgIconSetLiteralInNamespace(e,i,r){const s=this._sanitizer.sanitize(lr.HTML,i);if(!s)throw GO(i);const u=Bv(s);return this._addSvgIconSetConfig(e,new Wp("",u,r))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(lr.RESOURCE_URL,e);if(!i)throw qO(e);const r=this._cachedIconsByUrl.get(i);return r?Ln(_S(r)):this._loadSvgIconFromConfig(new Wp(e,null)).pipe(Vo(s=>this._cachedIconsByUrl.set(i,s)),W(s=>_S(s)))}getNamedSvgIcon(e,i=""){const r=WO(i,e);let s=this._svgIconConfigs.get(r);if(s)return this._getSvgFromConfig(s);if(s=this._getIconConfigFromResolvers(i,e),s)return this._svgIconConfigs.set(r,s),this._getSvgFromConfig(s);const u=this._iconSetConfigs.get(i);return u?this._getSvgFromIconSetConfigs(e,u):jb($O(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?Ln(_S(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(W(i=>_S(i)))}_getSvgFromIconSetConfigs(e,i){const r=this._extractIconWithNameFromAnySet(e,i);return r?Ln(r):jP(i.filter(u=>!u.svgText).map(u=>this._loadSvgIconSetFromConfig(u).pipe(vh(m=>{const C=`Loading icon set URL: ${this._sanitizer.sanitize(lr.RESOURCE_URL,u.url)} failed: ${m.message}`;return this._errorHandler.handleError(new Error(C)),Ln(null)})))).pipe(W(()=>{const u=this._extractIconWithNameFromAnySet(e,i);if(!u)throw $O(e);return u}))}_extractIconWithNameFromAnySet(e,i){for(let r=i.length-1;r>=0;r--){const s=i[r];if(s.svgText&&s.svgText.toString().indexOf(e)>-1){const u=this._svgElementFromConfig(s),m=this._extractSvgIconFromSet(u,e,s.options);if(m)return m}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(Vo(i=>e.svgText=i),W(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?Ln(null):this._fetchIcon(e).pipe(Vo(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,r){const s=e.querySelector(`[id="${i}"]`);if(!s)return null;const u=s.cloneNode(!0);if(u.removeAttribute("id"),"svg"===u.nodeName.toLowerCase())return this._setSvgAttributes(u,r);if("symbol"===u.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(u),r);const m=this._svgElementFromString(Bv("<svg></svg>"));return m.appendChild(u),this._setSvgAttributes(m,r)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(e){const i=this._svgElementFromString(Bv("<svg></svg>")),r=e.attributes;for(let s=0;s<r.length;s++){const{name:u,value:m}=r[s];"id"!==u&&i.setAttribute(u,m)}for(let s=0;s<e.childNodes.length;s++)e.childNodes[s].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[s].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){var i;const{url:r,options:s}=e,u=null!==(i=null==s?void 0:s.withCredentials)&&void 0!==i&&i;if(!this._httpClient)throw function WG(){return Error("Could not find HttpClient provider for use with Sbb Angular icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==r)throw Error(`Cannot fetch icon from URL "${r}".`);const m=this._sanitizer.sanitize(lr.RESOURCE_URL,r);if(!m)throw qO(r);const y=this._inProgressUrlFetches.get(m);if(y)return y;const C=this._httpClient.get(m,{responseType:"text",withCredentials:u}).pipe(W(I=>Bv(I)),Lw(()=>this._inProgressUrlFetches.delete(m)),un());return this._inProgressUrlFetches.set(m,C),C}_addSvgIconConfig(e,i,r){return this._svgIconConfigs.set(WO(e,i),r),this}_addSvgIconSetConfig(e,i){const r=this._iconSetConfigs.get(e);return r?r.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let r=0;r<this._resolvers.length;r++){const s=this._resolvers[r](i,e);if(s)return ZG(s)?new Wp(s.url,null,s.options):new Wp(s,null)}if(-1!==this._sbbCdnSupportedNamespaces.indexOf(e)){const r=this._sanitizer.bypassSecurityTrustResourceUrl(`https://icons.app.sbb.ch/${e}/${i}.svg`);return new Wp(r,null)}}}return n.\u0275fac=function(e){return new(e||n)(je(LP,8),je(NR),je(Gn,8),je(bl))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function _S(n){return n.cloneNode(!0)}function WO(n,t){return n+":"+t}function ZG(n){return!(!n.url||!n.options)}const YG=new It("sbb-icon-location",{providedIn:"root",factory:function KG(){const n=Fr(Gn),t=n?n.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),XO=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],QG=XO.map(n=>`[${n}]`).join(", "),JG=/^url\(['"]?#(.*?)['"]?\)$/;let Qa=(()=>{class n{constructor(e,i,r,s,u){this._elementRef=e,this._iconRegistry=i,this._location=s,this._errorHandler=u,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=ie.EMPTY,r||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=Hn(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=e.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=(this.fontSet?[this._iconRegistry.classNameForFontAlias(this.fontSet)]:this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>e.classList.remove(r)),i.forEach(r=>e.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((r,s)=>{r.forEach(u=>{s.setAttribute(u.name,`url('${e}#${u.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(QG),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let s=0;s<i.length;s++)XO.forEach(u=>{const m=i[s],y=m.getAttribute(u),C=y?y.match(JG):null;if(C){let I=r.get(m);I||(I=[],r.set(m,I)),I.push({name:u,value:C[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,r]=this._splitIconName(e);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(jr(1)).subscribe(s=>this._setSvgElement(s),s=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${s.message}`))})}}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(XG),qo("aria-hidden"),H(YG),H(bl))},n.\u0275cmp=mn({type:n,selectors:[["sbb-icon"]],hostAttrs:["role","img",1,"sbb-icon","notranslate"],hostVars:5,hostBindings:function(e,i){2&e&&(fn("data-sbb-icon-type",i._usingFontIcon()?"font":"svg")("data-sbb-icon-name",i._svgName||i.fontIcon)("data-sbb-icon-namespace",i._svgNamespace||i.fontSet),Li("sbb-icon-inline",i.inline))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["sbbIcon"],ngContentSelectors:qG,decls:1,vars:0,template:function(e,i){1&e&&(Ro(),Pr(0))},styles:[".sbb-icon{background-repeat:no-repeat;display:inline-block;line-height:0;overflow:hidden}.sbb-icon svg:not(.color-immutable) [fill]:not([fill=none]){fill:currentColor}.sbb-icon svg:not(.color-immutable) [stroke]:not([stroke=none]){stroke:currentColor}.sbb-icon svg:not(.color-immutable)>:where(path,polygon,polyline):where(:not([stroke]):not([fill])),.sbb-icon svg:not(.color-immutable) :where(:not([stroke]):not([fill])) :where(path,polygon,polyline):where(:not([stroke]):not([fill])){fill:currentColor}.sbb-icon.sbb-icon-inline{vertical-align:middle;margin-block-start:calc(-.2666666667rem*var(--sbb-scaling-factor));margin-block-end:calc(-.1333333333rem*var(--sbb-scaling-factor))}:where(.sbb-icon-fit) .sbb-icon,.sbb-icon:where(.sbb-icon-fit),:where(.sbb-icon-fit,.sbb-icon-scaled) .sbb-icon svg,.sbb-icon:where(.sbb-icon-fit,.sbb-icon-scaled) svg{width:100%;height:100%}:where(.sbb-icon-scaled) .sbb-icon,.sbb-icon:where(.sbb-icon-scaled){width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default)}"],encapsulation:2,changeDetection:0}),n})(),yo=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[Zi]}),n})();const ZO=["*"],eW=["tabListContainer"],tW=["tabList"],nW=["tabListInner"],iW=["nextPaginator"],rW=["previousPaginator"],lW=["sbb-tab-nav-bar",""];new It("SbbTabContent"),new It("SbbTabLabel"),new It("SBB_TAB"),Ka(class{}),new It("SBB_TAB_GROUP"),Ms("translateTab",[fr("hidden",Bn({visibility:"hidden"})),Xi("* => void, * => hidden",[Bn({opacity:1}),er("{{animationDurationHide}} ease",Bn({opacity:0}))]),Xi("hidden => show",[Bn({opacity:0,visibility:"visible"}),er("{{animationDuration}} ease",Bn({opacity:1}))]),Xi("void => show",er("0s"))]),new It("SBB_TABS_CONFIG"),Ka(class{});const LD=Up({passive:!0}),dW=Om(class{});let hW=(()=>{class n extends dW{constructor(e,i,r,s,u,m){super(),this._elementRef=e,this._changeDetectorRef=i,this._viewportRuler=r,this._ngZone=s,this._platform=u,this._animationMode=m,this._scrollShadowTrigger=new Kt,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new Kt,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new Kt,this._disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new tn,this.indexFocused=new tn,s.runOutsideAngular(()=>{hu(e.nativeElement,"mouseleave").pipe(Oi(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get disablePagination(){return this._disablePagination}set disablePagination(e){this._disablePagination=Hn(e)}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){e=Th(e),this._selectedIndex!==e&&(this._selectedIndexChanged=!0,this._selectedIndex=e,this._keyManager&&this._keyManager.updateActiveItem(e))}ngAfterViewInit(){hu(this._previousPaginator.nativeElement,"touchstart",LD).pipe(Oi(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),hu(this._nextPaginator.nativeElement,"touchstart",LD).pipe(Oi(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){const e=this._viewportRuler.change(150),i=()=>this.updatePagination();this._keyManager=new wD(this._items).withHorizontalOrientation("ltr").withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(jr(1)).subscribe(i),Er(e,this._items.changes,this.variant).pipe(Oi(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),i()})})}),this._keyManager.change.pipe(Oi(this._destroyed)).subscribe(r=>{this.indexFocused.emit(r),this._setTabFocus(r)}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Tr(r=>"standard"===r),aa(()=>Er(hu(this._tabListContainer.nativeElement,"scroll",LD),this._scrollShadowTrigger,e)),As(null),W(()=>this._calculateScrollState()),$p(),Oi(this._destroyed)).subscribe(r=>this._applyScrollShadows(r))}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Oi(this._destroyed)).subscribe(r=>{"lean"===r?this._tabListContainer.nativeElement.scrollLeft=0:this._tabList.nativeElement.style.removeProperty("transform")})})}ngAfterContentChecked(){this._tabLabelCount!==this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(e){if(!ca(e))switch(e.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(e));break;default:this._keyManager.onKeydown(e)}}_onContentChanges(){const e=this._elementRef.nativeElement.textContent;e!==this._currentTextContent&&(this._currentTextContent=e||"",this._ngZone.run(()=>{this.updatePagination(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(e){!this._isValidIndex(e)||this.focusIndex===e||!this._keyManager||this._keyManager.setActiveItem(e)}_isValidIndex(e){if(!this._items)return!0;const i=this._items?this._items.toArray()[e]:null;return!!i&&!i.disabled}_setTabFocus(e){this._showPaginationControls&&this._scrollToLabel(e),this._items&&this._items.length&&(this._items.toArray()[e].focus(),this._tabListContainer.nativeElement.scrollLeft=0)}_updateTabScrollPosition(){this.disablePagination||"standard"===this.variantSnapshot||(this._tabList.nativeElement.style.transform=`translateX(${Math.round(-this.scrollDistance)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0))}get scrollDistance(){return this._scrollDistance}set scrollDistance(e){this._scrollTo(e)}_scrollHeader(e){return this._scrollTo(this._scrollDistance+("before"===e?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(e){this._stopInterval(),this._scrollHeader(e)}_scrollToLabel(e){if(this.disablePagination||"standard"===this.variantSnapshot)return;const i=this._items?this._items.toArray()[e]:null;if(!i)return;const r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:s,offsetWidth:u}=i.elementRef.nativeElement,y=s+u,C=this.scrollDistance,I=this.scrollDistance+r;s<C?this.scrollDistance-=C-s+60:y>I&&(this.scrollDistance+=y-I+60)}_checkPaginationEnabled(){if(this.disablePagination||"standard"===this.variantSnapshot)this._showPaginationControls=!1;else{const e=this._tabListInner.nativeElement.scrollWidth-this._elementRef.nativeElement.offsetWidth>1;e||(this.scrollDistance=0),e!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=e}}_checkScrollingControls(){this.disablePagination||"standard"===this.variantSnapshot?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0===this.scrollDistance,this._disableScrollAfter=this.scrollDistance===this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabListInner.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(e,i){i&&null!=i.button&&0!==i.button||(this._stopInterval(),ED(650,100).pipe(Oi(Er(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:r,distance:s}=this._scrollHeader(e);(0===s||s>=r)&&this._stopInterval()}))}_scrollTo(e){if(this.disablePagination||"standard"===this.variantSnapshot)return{maxScrollDistance:0,distance:0};const i=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(i,e)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:i,distance:this._scrollDistance}}_calculateScrollState(){const e=this._tabListContainer.nativeElement;if(e.scrollWidth===e.offsetWidth)return"hidden";const i=0===e.scrollLeft;return i||e.scrollWidth-e.scrollLeft-e.offsetWidth<=1?i?"left":"right":"middle"}_applyScrollShadows(e){const i=this._elementRef.nativeElement;"hidden"===e||"left"===e?i.classList.remove("sbb-tab-header-left-shadow"):i.classList.add("sbb-tab-header-left-shadow"),"hidden"===e||"right"===e?i.classList.remove("sbb-tab-header-right-shadow"):i.classList.add("sbb-tab-header-right-shadow")}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Cr),H(pu),H(Xn),H(ps),H(rd,8))},n.\u0275dir=Bt({type:n,inputs:{disablePagination:"disablePagination"},features:[Xt]}),n})(),KO=0,QO=(()=>{class n extends hW{constructor(e,i,r,s,u,m){super(e,r,s,i,u,m)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(As(null),Oi(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const e=this._items.toArray();for(let i=0;i<e.length;i++)if(e[i].active)return this.selectedIndex=i,this._changeDetectorRef.markForCheck(),void(this.tabPanel&&(this.tabPanel._activeTabId=e[i].id));this.selectedIndex=-1}_getRole(){return this.tabPanel?"tablist":this._elementRef.nativeElement.getAttribute("role")}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Xn),H(Cr),H(pu),H(ps),H(rd,8))},n.\u0275dir=Bt({type:n,inputs:{tabPanel:"tabPanel"},features:[Xt]}),n})(),yS=(()=>{class n extends QO{constructor(e,i,r,s,u,m){super(e,i,r,s,u,m)}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Xn),H(Cr),H(pu),H(ps),H(rd,8))},n.\u0275cmp=mn({type:n,selectors:[["","sbb-tab-nav-bar",""]],contentQueries:function(e,i,r){if(1&e&&Vr(r,vS,5),2&e){let s;Fn(s=Nn())&&(i._items=s)}},viewQuery:function(e,i){if(1&e&&(cr(eW,7),cr(tW,7),cr(nW,7),cr(iW,5),cr(rW,5)),2&e){let r;Fn(r=Nn())&&(i._tabListContainer=r.first),Fn(r=Nn())&&(i._tabList=r.first),Fn(r=Nn())&&(i._tabListInner=r.first),Fn(r=Nn())&&(i._nextPaginator=r.first),Fn(r=Nn())&&(i._previousPaginator=r.first)}},hostAttrs:[1,"sbb-tab-nav-bar","sbb-tab-header"],hostVars:3,hostBindings:function(e,i){2&e&&(fn("role",i._getRole()),Li("sbb-tab-header-pagination-controls-enabled",i._showPaginationControls&&"lean"===i.variantSnapshot))},exportAs:["sbbTabNavBar","sbbTabNav"],features:[Xt],attrs:lW,ngContentSelectors:ZO,decls:13,vars:8,consts:[["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-before","sbb-button-reset-frameless",3,"disabled","click","mousedown","touchend"],["previousPaginator",""],["svgIcon","kom:chevron-left-small",1,"sbb-tab-header-pagination-chevron"],[1,"sbb-tab-link-container","sbb-scrollbar",3,"keydown"],["tabListContainer",""],[1,"sbb-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"sbb-tab-links"],["tabListInner",""],["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-after","sbb-button-reset-frameless",3,"disabled","mousedown","click","touchend"],["nextPaginator",""],["svgIcon","kom:chevron-right-small",1,"sbb-tab-header-pagination-chevron"]],template:function(e,i){1&e&&(Ro(),X(0,"button",0,1),Ft("click",function(){return i._handlePaginatorClick("before")})("mousedown",function(s){return i._handlePaginatorPress("before",s)})("touchend",function(){return i._stopInterval()}),en(2,"sbb-icon",2),Y(),X(3,"div",3,4),Ft("keydown",function(s){return i._handleKeydown(s)}),X(5,"div",5,6),Ft("cdkObserveContent",function(){return i._onContentChanges()}),X(7,"div",7,8),Pr(9),Y()()(),X(10,"button",9,10),Ft("mousedown",function(s){return i._handlePaginatorPress("after",s)})("click",function(){return i._handlePaginatorClick("after")})("touchend",function(){return i._stopInterval()}),en(12,"sbb-icon",11),Y()),2&e&&(Li("sbb-tab-header-pagination-disabled",i._disableScrollBefore),Le("disabled",i._disableScrollBefore||null),ae(5),Li("_sbb-animation-noopable","NoopAnimations"===i._animationMode),ae(5),Li("sbb-tab-header-pagination-disabled",i._disableScrollAfter),Le("disabled",i._disableScrollAfter||null))},dependencies:[dO,Qa],styles:['.sbb-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.sbb-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:2.1333333333rem;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;color:var(--sbb-color-granite);box-shadow:0 .1333333333rem .2666666667rem -.0666666667rem rgba(0,0,0,.2),0 .2666666667rem .3333333333rem rgba(0,0,0,.1411764706),0 .0666666667rem .6666666667rem rgba(0,0,0,.1215686275)}.sbb-tab-header-pagination::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-header-pagination::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-header-pagination::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}.sbb-tab-header-pagination-controls-enabled .sbb-tab-header-pagination{display:flex}.sbb-tab-header-pagination:hover:not(.sbb-tab-header-pagination-disabled){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-header-pagination::after{right:0;left:0}.sbb-tab-header-pagination.sbb-tab-header-pagination-after.sbb-tab-header-pagination-disabled::after{left:-.0666666667rem}.sbb-tab-header-pagination-disabled .sbb-tab-header-pagination-chevron{opacity:.4}.sbb-tab-header-pagination-disabled{box-shadow:none;cursor:default}.sbb-tab-list{flex-grow:1;position:relative;transition:transform var(--sbb-transition-duration-slow) var(--sbb-transition-timing-fast-start);will-change:transform}.sbb-tab-header{position:relative}:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{position:absolute;top:0;content:"";z-index:2;width:.8rem;height:calc(100% - .5rem);transition:transform var(--sbb-transition-duration-fast) var(--sbb-transition-timing-default);pointer-events:none}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{width:calc(1.6rem * var(--sbb-scaling-factor))}}:where(html:not(.sbb-lean)) .sbb-tab-header::before{left:0;transform:translateX(-100%);background:linear-gradient(270deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-left-shadow::before{transform:translateX(0)}:where(html:not(.sbb-lean)) .sbb-tab-header::after{right:0;transform:translateX(100%);background:linear-gradient(90deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-right-shadow::after{transform:translateX(0)}.sbb-tab-links{display:flex;padding-top:calc(0.1333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tab-links{padding-top:0}:where(html.sbb-lean) .sbb-tab-links::after{content:"";width:100%;flex-grow:1;flex-shrink:1;border-bottom:var(--sbb-border-width) solid var(--sbb-color-graphite)}.sbb-tab-link-container{display:flex;position:relative;flex-grow:1;overflow-x:auto;z-index:1;padding-bottom:1.3333333333rem}:where(html.sbb-lean) .sbb-tab-link-container{overflow:hidden;padding-bottom:0}.sbb-tab-link{margin-right:2.1333333333rem;cursor:pointer;box-sizing:border-box;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;font-family:var(--sbb-font-light);font-size:1.3333333333rem;color:var(--sbb-color-text);line-height:1em;padding-bottom:1.3333333333rem;outline:none;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0)}.sbb-tab-link::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-link::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-link::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-link{margin-right:calc(2.8rem * var(--sbb-scaling-factor));font-size:calc(1.7333333333rem * var(--sbb-scaling-factor))}}:where(html.sbb-lean) .sbb-tab-link{font-size:var(--sbb-font-size);line-height:1.3333333333rem;padding:.4rem 1rem .6rem;background-color:var(--sbb-color-background);margin-right:0;border:var(--sbb-border-width) solid rgba(0,0,0,0);border-bottom:none;border-radius:var(--sbb-border-radius) var(--sbb-border-radius) 0 0}.sbb-tab-link:last-child{margin-right:0 !important}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-label-active::after{width:100%}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active{border-color:var(--sbb-color-graphite)}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active::after{display:none}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{border-bottom-color:var(--sbb-color-call-to-action-hover)}:where(html:not(.sbb-lean)) .sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{width:100%}.sbb-tab-link.sbb-tab-label-active:is(:hover,:focus){color:currentColor;cursor:default}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active:focus-visible{outline:var(--sbb-border-width) solid var(--sbb-color-black);outline-offset:calc(-1*var(--sbb-border-width))}.sbb-tab-link.sbb-tab-disabled{color:var(--sbb-color-storm)}.sbb-tab-link.sbb-tab-disabled:is(:hover,:focus){cursor:default}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-disabled::after{width:0 !important}.sbb-tab-link .sbb-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}:where(html.sbb-lean) .sbb-tab-link .sbb-badge:not(.sbb-badge-hidden){padding-right:.7333333333rem}:where(html.sbb-lean) .sbb-tab-link .sbb-badge-content{transform:scale(0.8)}[sbb-stretch-tabs] .sbb-tab-link{flex-basis:0;flex-grow:1}:where(html.sbb-lean) .sbb-tab-link{overflow:unset}.sbb-tab-link.sbb-tab-disabled{pointer-events:none}:is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){display:block;position:relative;overflow:hidden;transition:height var(--sbb-transition-duration-slow)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){border:var(--sbb-border-width) solid var(--sbb-color-graphite);border-top:none;background-color:var(--sbb-color-background)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){padding:1rem}'],encapsulation:2}),n})();const pW=t_(Ka(class{}));let fW=(()=>{class n extends pW{constructor(e,i,r,s){super(),this._tabNavBar=e,this.elementRef=i,this._focusMonitor=s,this._isActive=!1,this.id="sbb-tab-link-"+KO++,this.tabIndex=parseInt(r,10)||0}get active(){return this._isActive}set active(e){const i=Hn(e);i!==this._isActive&&(this._isActive=i,this._tabNavBar.updateActiveLink())}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}_handleKeydown(e){this._tabNavBar.tabPanel&&32===e.keyCode&&this.elementRef.nativeElement.click()}_getAriaControls(){var e;return this._tabNavBar.tabPanel?null===(e=this._tabNavBar.tabPanel)||void 0===e?void 0:e.id:this.elementRef.nativeElement.getAttribute("aria-controls")}_getAriaSelected(){return this._tabNavBar.tabPanel?this.active?"true":"false":this.elementRef.nativeElement.getAttribute("aria-selected")}_getAriaCurrent(){return this.active&&!this._tabNavBar.tabPanel?"page":null}_getRole(){return this._tabNavBar.tabPanel?"tab":this.elementRef.nativeElement.getAttribute("role")}_getTabIndex(){return this._tabNavBar.tabPanel?this._isActive?0:-1:this.tabIndex}}return n.\u0275fac=function(e){return new(e||n)(H(QO),H(En),qo("tabindex"),H(xa))},n.\u0275dir=Bt({type:n,inputs:{active:"active",id:"id"},features:[Xt]}),n})(),vS=(()=>{class n extends fW{constructor(e,i,r,s){super(e,i,r,s)}}return n.\u0275fac=function(e){return new(e||n)(H(yS),H(En),qo("tabindex"),H(xa))},n.\u0275dir=Bt({type:n,selectors:[["","sbb-tab-link",""],["","sbbTabLink",""]],hostAttrs:[1,"sbb-tab-link","sbb-link-reset"],hostVars:11,hostBindings:function(e,i){1&e&&Ft("focus",function(){return i._handleFocus()})("keydown",function(s){return i._handleKeydown(s)}),2&e&&(fn("aria-controls",i._getAriaControls())("aria-current",i._getAriaCurrent())("aria-disabled",i.disabled)("aria-selected",i._getAriaSelected())("id",i.id)("tabIndex",i._getTabIndex())("role",i._getRole()),Li("sbb-tab-disabled",i.disabled)("sbb-tab-label-active",i.active))},inputs:{disabled:"disabled",tabIndex:"tabIndex"},exportAs:["sbbTabLink"],features:[Xt]}),n})(),OD=(()=>{class n{constructor(){this.id="sbb-tab-nav-panel-"+KO++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["sbb-tab-nav-panel"]],hostAttrs:["role","tabpanel",1,"sbb-tab-nav-panel"],hostVars:2,hostBindings:function(e,i){2&e&&fn("aria-labelledby",i._activeTabId)("id",i.id)},inputs:{id:"id"},exportAs:["sbbTabNavPanel"],ngContentSelectors:ZO,decls:1,vars:0,template:function(e,i){1&e&&(Ro(),Pr(0))},encapsulation:2,changeDetection:0}),n})(),JO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,ua,sS,Rm,Lm,Zi,yo]}),n})();const xS="undefined"==typeof window||void 0===window.document||window.location.hostname.includes("github.io")?"PROD":"DEBUG",FD="0.11.1",mW="undefined"!=typeof process&&process.versions&&process.versions.node;"DEBUG"===xS&&(console.log("OJP-SDK: DEBUG features are enabled"),console.log("OJP-SDK: version: "+FD));const zv={ContinousLeg:"#009933",TransferLeg:"#0000ff",TimedLeg:"#D04D44"},gW=["ContinousLeg","TimedLeg","TransferLeg"],Xp={Unknown:"#ffafcc",LongDistanceRail:"#D04D44",SBahn:"#0d6efd",Bus:"#0d6efd",PostAuto:"#EBBE24",OnDemand:"#D77D00",Aerial:"#8B4513",Funicular:"#006400",Walk:"#009933","Self-Drive Car":"#ff004f","Shared Mobility":"#32CD32",Guidance:"#6f0000",Transfer:"#088F8F",Water:"#005AB3"},bW=["LongDistanceRail","SBahn","Bus","PostAuto","OnDemand","Aerial","Walk","Guidance","Transfer","Self-Drive Car","Shared Mobility","Water"];var _W=We(9611);class ND{constructor(t,e,i,r,s){this.name=t,this.parentName=e,this.attributes=i,this.children=r,this.text=s}findTextFromChildNamed(t){var e;const i=t.split("/");let r=this;return i.forEach((u,m)=>{r&&(r=r.findChildNamed(u))}),null!==(e=null==r?void 0:r.text)&&void 0!==e?e:null}findChildNamed(t){const e=t.split("/");let i=this;return e.forEach((r,s)=>{var u;i=null!==(u=null==i?void 0:i.children.find(y=>y.name===r))&&void 0!==u?u:null}),i}findChildrenNamed(t){t.includes("/")&&(console.error("ERROR - do you want to use more than one level for findChildrenNamed? Use findTextFromChildNamed."),console.log(t));const e=[];return this.children.forEach(i=>{i.name===t&&e.push(i)}),e}computeText(){const t=[];if(null===this.text){if(0===this.children.length)return null;this.children.forEach(e=>{const i=e.computeText();i&&t.push(i)})}else t.push(this.text);return t.join(" ")}}class Vv{constructor(){this.mapUriNS={"http://www.vdv.de/ojp":"","http://www.siri.org.uk/siri":"siri"},this.rootNode=new ND("root",null,{},[],null),this.currentNode=this.rootNode,this.stack=[]}resetNodes(){this.rootNode=new ND("root",null,{},[],null),this.currentNode=this.rootNode,this.stack=[]}parseXML(t){if(mW)Promise.resolve().then(We.t.bind(We,9611,19)).then(e=>{const i=e.default.createStream(!0,{trim:!0,xmlns:!0});this._parseXML(t,i)});else{const e=_W.createStream(!0,{trim:!0,xmlns:!0});this._parseXML(t,e)}}_parseXML(t,e){this.resetNodes(),e.on("opentag",i=>{this.onOpenTag(i)}),e.on("text",i=>{this.onText(i)}),e.on("closetag",i=>{this.onSaxCloseTag(i)}),e.on("error",i=>{this.onError(i)}),e.on("end",()=>{this.onEnd()}),e.write(t),e.end()}onOpenTag(t){const e=(()=>{var r;const s=[],u=null!==(r=this.mapUriNS[t.uri])&&void 0!==r?r:"";return""!==u&&s.push(u),s.push(t.local),s.join(":")})(),i=new ND(e,this.currentNode.name,t.attributes,[],null);this.currentNode.children.push(i),this.stack.push(i),this.currentNode=i}onText(t){this.currentNode.text=t}onSaxCloseTag(t){this.stack.pop(),this.onCloseTag(this.currentNode.name),this.currentNode=this.stack[this.stack.length-1]}onCloseTag(t){}onError(t){}onEnd(){}}class yW extends Vv{constructor(){super(),this.callback=null,this.fareResults=[]}parseXML(t){this.fareResults=[],super.parseXML(t)}onCloseTag(t){if("FareResult"===t){const e=zD.initWithFareResultTreeNode(this.currentNode);e&&this.fareResults.push(e)}}onError(t){console.error("ERROR: SAX parser"),console.log(t),this.callback&&this.callback({fareResults:this.fareResults,message:"ERROR"})}onEnd(){this.callback&&this.callback({fareResults:this.fareResults,message:"NovaFares.DONE"})}}class BD{constructor(t,e,i,r){this.fareProductId=t,this.fareAuthorityRef=e,this.price=i,this.travelClass=r}static initFromFareProductNode(t){const e=t.findTextFromChildNamed("FareProductId"),i=t.findTextFromChildNamed("FareAuthorityRef"),r=t.findTextFromChildNamed("Price"),s=t.findTextFromChildNamed("TravelClass");if(null===e||null===i||null===r||null===s)return null;const u=parseFloat(r);return new BD(e,i,u,s)}}class zD{constructor(t,e){this.tripId=t,this.tripFareResults=e}static initWithFareResultTreeNode(t){const e=t.findTextFromChildNamed("ResultId");if(null===e)return null;const i=t.findChildrenNamed("TripFareResult"),r=[];return i.forEach(u=>{const m=u.findTextFromChildNamed("FromTripLegIdRef"),y=u.findTextFromChildNamed("ToTripLegIdRef");if(null===m||null===y)return;const C=parseInt(m,10),I=parseInt(y,10),A=u.findChildNamed("FareProduct");if(null===A)return;const B=BD.initFromFareProductNode(A);null!==B&&r.push({fromTripLegIdRef:C,toTripLegIdRef:I,fareProduct:B})}),0===r.length?null:new zD(e,r)}}class wa{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t){return wa.formatDate(t).substring(11,16)}static formatDistance(t){return t>1e3?(t/1e3).toFixed(1)+"km":t+"m"}}var Jo=(()=>{return(n=Jo||(Jo={})).LegType="leg.type",n.DrawType="draw.type",n.PointType="point.type",n.LineType="line.type",Jo;var n})();class kc{static FilterBeelines(){return this.FilterByDrawType("Beeline")}static FilterWalkingLegs(){return["all",this.FilterByDrawType("LegLine"),this.FilterByLineType("Walk")]}static FilterLegPoints(){return this.FilterByDrawType("LegPoint")}static ColorCaseByLegLineType(){const t=["case"];return bW.forEach(e=>{t.push(["==",["get",Jo.LineType],e]),t.push(Xp[e])}),t.push("#FF1493"),t}static FilterByDrawType(t){return["==",["get",Jo.DrawType],t]}static FilterByPointType(t){return["==",["get",Jo.PointType],t]}static FilterByLineType(t){return["==",["get",Jo.LineType],t]}static FilterTimedLegTracks(){return["all",this.FilterByDrawType("LegLine")]}static ColorCaseByLegType(){const t=["case"];return gW.forEach(e=>{t.push(["==",["get",Jo.LegType],e]),t.push(zv[e])}),t.push("#FF1493"),t}}class Wr{constructor(t,e){this.longitude=parseFloat(t.toFixed(6)),this.latitude=parseFloat(e.toFixed(6)),this.properties=null}static initWithStringCoords(t,e){if(null===t||null===e)return null;const i=parseFloat(t),r=parseFloat(e);return 0===i||0===r?null:new Wr(i,r)}static initWithLocationTreeNode(t){const e=t.findTextFromChildNamed("GeoPosition/siri:Longitude"),i=t.findTextFromChildNamed("GeoPosition/siri:Latitude");return Wr.initWithStringCoords(e,i)}static initWithFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates,s=new Wr(e[0],e[1]);return s.properties=t.properties,s}asLngLat(){return[this.longitude,this.latitude]}asLatLngString(t=!0){let e="";return e=t?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,e}asPosition(){return[this.longitude,this.latitude]}distanceFrom(t){const i=(t.latitude-this.latitude)*Math.PI/180,r=(t.longitude-this.longitude)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),u=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return Math.round(6371*u*1e3)}}class Eh{constructor(t,e,i,r="StopPlace"){this.stopPlaceRef=t,this.stopPlaceName=e,this.topographicPlaceRef=i,this.stopType=r}static initWithLocationTreeNode(t){let e="StopPlace",i=t.findTextFromChildNamed("StopPlace/StopPlaceRef"),r=t.findTextFromChildNamed("StopPlace/StopPlaceName/Text"),s=t.findTextFromChildNamed("StopPlace/TopographicPlaceRef");return null===i&&(e="StopPoint",i=t.findTextFromChildNamed("StopPoint/siri:StopPointRef"),r=t.findTextFromChildNamed("StopPoint/StopPointName/Text"),s=t.findTextFromChildNamed("StopPoint/TopographicPlaceRef")),null===i&&(e="StopPoint",i=t.findTextFromChildNamed("siri:StopPointRef")),null===i?null:new Eh(i,r,s,e)}static initWithServiceTreeNode(t,e){const i=t.findTextFromChildNamed(e+"StopPointRef"),r=t.findTextFromChildNamed(e+"Text/Text");return i&&r?new Eh(i,r,null,"StopPlace"):null}}class wS{constructor(t){this.addressCode=t,this.addressName=null,this.topographicPlaceRef=null,this.topographicPlaceName=null,this.street=null,this.houseNumber=null,this.postCode=null}static initWithLocationTreeNode(t){const e=t.findChildNamed("Address");if(null===e)return null;const i=e.findTextFromChildNamed("AddressCode");if(null===i)return null;const r=new wS(i);return r.addressName=e.findTextFromChildNamed("AddressName/Text"),r.topographicPlaceRef=e.findTextFromChildNamed("TopographicPlaceRef"),r.topographicPlaceName=e.findTextFromChildNamed("TopographicPlaceName"),r.street=e.findTextFromChildNamed("Street"),r.houseNumber=e.findTextFromChildNamed("HouseNumber"),r.postCode=e.findTextFromChildNamed("PostCode"),r}}const VD={service:["atm","hairdresser"],shopping:["all","clothes","optician"],catering:["all"],accommodation:["all"]};class jD{constructor(t,e,i,r,s){this.code=t,this.name=e,this.category=i,this.subCategory=r,this.categoryTags=s}static initWithLocationTreeNode(t){const e=t.findChildNamed("PointOfInterest");if(null===e)return null;const i=e.findTextFromChildNamed("PointOfInterestCode"),r=e.findTextFromChildNamed("PointOfInterestName/Text");if(!i||!r)return null;const s=[];let u=null,m=null;return e.findChildrenNamed("PointOfInterestCategory").forEach(I=>{const A=I.findTextFromChildNamed("OsmTag/Value");A&&s.push(A);const B=I.findTextFromChildNamed("OsmTag/Tag");("POI_0"===B||"amenity"===B)&&(u=A),"POI_1"===B&&(m=A)}),null===u?(console.error("PointOfInterest.initWithLocationTreeNode error - no category"),console.log(t),null):new jD(i,r,u,m,s)}computePoiMapIcon(){const t="poi-unknown";return this.category in VD?this.subCategory&&VD[this.category].indexOf(this.subCategory)>-1?"poi-"+this.category+"-"+this.subCategory:VD[this.category].indexOf("all")>-1?"poi-"+this.category+"-all":t:t}}class UD{constructor(t,e){this.code=t,this.name=e}static initWithLocationTreeNode(t){const e=t.findTextFromChildNamed("TopographicPlace/TopographicPlaceCode"),i=t.findTextFromChildNamed("TopographicPlace/TopographicPlaceName/Text");return e&&i?new UD(e,i):null}}const vW=/^([0-9\.]+?),([0-9\.]+?)$/;class to{constructor(){this.address=null,this.locationName=null,this.stopPlace=null,this.geoPosition=null,this.poi=null,this.topographicPlace=null,this.attributes={},this.probability=null,this.originSystem=null}static initWithTreeNode(t){const e=new to;return e.address=wS.initWithLocationTreeNode(t),e.geoPosition=Wr.initWithLocationTreeNode(t),e.locationName=t.findTextFromChildNamed("LocationName/Text"),e.poi=jD.initWithLocationTreeNode(t),e.stopPlace=Eh.initWithLocationTreeNode(t),e.topographicPlace=UD.initWithLocationTreeNode(t),e.attributes=to.computeAttributes(t),e}static initWithLocationResultTreeNode(t){const e=t.findChildNamed("Location");if(null===e)return null;const i=to.initWithTreeNode(e),r=t.findTextFromChildNamed("Probability");return r&&(i.probability=parseFloat(r)),i.originSystem=t.findTextFromChildNamed("OriginSystem"),i}static initWithStopPlaceRef(t,e=""){const i=new to;return i.stopPlace=new Eh(t,e,null),i}static initWithLngLat(t,e){const i=new to;return i.geoPosition=new Wr(t,e),i}static computeAttributes(t){const e={},i=t.findChildNamed("Attribute");i&&i.children.forEach(s=>{const u=s.name.split(":"),m=1===u.length?u[0]:u[1],y=s.computeText();null!==y&&(e[m]=y)});const r=t.findChildNamed("Extension/LocationExtensionStructure");return r&&r.children.forEach(s=>{e[s.name]=s.text}),e}static initWithFeature(t){var e,i,r,s;const u=Wr.initWithFeature(t);if(null===u)return null;const m=t.properties;if(null===m)return null;const y=new to;y.geoPosition=u,y.locationName=null!==(e=m.locationName)&&void 0!==e?e:null;const C=m["stopPlace.stopPlaceRef"];if(C){const A=null!==(i=m["stopPlace.stopPlaceName"])&&void 0!==i?i:null;y.stopPlace=new Eh(C,A,null)}const I=m.addressCode;if(I){const A=new wS(I);A.addressName=null!==(r=m.addressName)&&void 0!==r?r:null,A.topographicPlaceRef=null!==(s=m.topographicPlaceRef)&&void 0!==s?s:null}return y}static initFromLiteralCoords(t){let e=t.trim();e=e.replace(/\(.+?\)/g,""),e=e.replace(/[^0-9\.,]/g,"");const i=e.match(vW);if(null===i)return null;let r=parseFloat(i[1]),s=parseFloat(i[2]);r>s&&(r=parseFloat(i[2]),s=parseFloat(i[1]));const u=to.initWithLngLat(r,s),m=t.trim().match(/\(([^\)]*)\)?/);return null!==m&&(u.locationName=m[1]),u}asGeoJSONFeature(){var t,e,i,r,s,u,m,y,C,I,A,B,j,K,pe;if(null===this.geoPosition)return null;const Se={};(null!==(e=null===(t=this.stopPlace)||void 0===t?void 0:t.stopPlaceRef)&&void 0!==e?e:null)&&(Se["stopPlace.stopPlaceRef"]=null!==(r=null===(i=this.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"",Se["stopPlace.stopPlaceName"]=null!==(u=null===(s=this.stopPlace)||void 0===s?void 0:s.stopPlaceName)&&void 0!==u?u:"",Se["stopPlace.topographicPlaceRef"]=null!==(y=null===(m=this.stopPlace)||void 0===m?void 0:m.topographicPlaceRef)&&void 0!==y?y:""),this.address&&(Se.addressCode=null!==(I=null===(C=this.address)||void 0===C?void 0:C.addressCode)&&void 0!==I?I:"",Se.addressName=null!==(B=null===(A=this.address)||void 0===A?void 0:A.addressName)&&void 0!==B?B:"",Se.topographicPlaceRef=null!==(K=null===(j=this.address)||void 0===j?void 0:j.topographicPlaceRef)&&void 0!==K?K:""),this.poi&&(Se["poi.name"]=this.poi.name,Se["poi.code"]=this.poi.code,Se["poi.category"]=this.poi.category,Se["poi.subcategory"]=this.poi.subCategory,Se["poi.osm.tags"]=this.poi.categoryTags.join(",")),Se.locationName=null!==(pe=this.locationName)&&void 0!==pe?pe:"";for(let pt in this.attributes)Se["OJP.Attr."+pt]=this.attributes[pt];return{type:"Feature",properties:Se,geometry:{type:"Point",coordinates:[this.geoPosition.longitude,this.geoPosition.latitude]}}}computeLocationName(t=!0){var e,i;return null!==(e=this.stopPlace)&&void 0!==e&&e.stopPlaceName?this.stopPlace.stopPlaceName:null!==(i=this.topographicPlace)&&void 0!==i&&i.name?this.topographicPlace.name:this.poi&&this.poi.name?this.poi.name:this.locationName?this.locationName:t&&this.geoPosition?this.geoPosition.asLatLngString():null}findClosestLocation(t){const e=this.geoPosition;if(null===e)return null;let i=null;return t.forEach(r=>{const s=r.geoPosition;if(null===s)return;const u=e.distanceFrom(s);(null===i||u<i.distance)&&(i={location:r,distance:u})}),i}getLocationType(){return this.stopPlace?"stop":this.poi?"poi":this.address?"address":this.topographicPlace?"topographicPlace":null}patchWithAnotherLocation(t){this.locationName=t.locationName,this.stopPlace=t.stopPlace,this.geoPosition=t.geoPosition}}class pd{constructor(t){Array.isArray(t)||(t=[t]),this.minLongitude=Math.min.apply(null,t.map(r=>r.longitude)),this.minLatitude=Math.min.apply(null,t.map(r=>r.latitude)),this.maxLongitude=Math.max.apply(null,t.map(r=>r.longitude)),this.maxLatitude=Math.max.apply(null,t.map(r=>r.latitude)),this.southWest=new Wr(this.minLongitude,this.minLatitude),this.northEast=new Wr(this.maxLongitude,this.maxLatitude),this.center=new Wr((this.southWest.longitude+this.northEast.longitude)/2,(this.southWest.latitude+this.northEast.latitude)/2)}static initFromGeoPosition(t,e,i){const r=.1*e/7612,s=.1*i/11119,u=new Wr(t.longitude-r/2,t.latitude-s/2),m=new Wr(t.longitude+r/2,t.latitude+s/2);return new pd([u,m])}static initFromGeoJSONFeatures(t){const e=new pd([]);return t.forEach(i=>{var r;const s=null!==(r=i.bbox)&&void 0!==r?r:null;if(s){const u=new Wr(s[0],s[1]);e.extend(u);const m=new Wr(s[2],s[3]);e.extend(m)}else"LineString"===i.geometry.type&&i.geometry.coordinates.forEach(m=>{const y=new Wr(m[0],m[1]);e.extend(y)})}),e}extend(t){Array.isArray(t)||(t=[t]),t.forEach(r=>{const s=Math.min(this.southWest.longitude,r.longitude),u=Math.min(this.southWest.latitude,r.latitude),m=Math.max(this.northEast.longitude,r.longitude),y=Math.max(this.northEast.latitude,r.latitude);this.southWest=new Wr(s,u),this.northEast=new Wr(m,y)}),this.center=new Wr((this.southWest.longitude+this.northEast.longitude)/2,(this.southWest.latitude+this.northEast.latitude)/2),this.minLongitude=this.southWest.longitude,this.minLatitude=this.southWest.latitude,this.maxLongitude=this.northEast.longitude,this.maxLatitude=this.northEast.latitude}asFeatureBBOX(){return[this.southWest.longitude,this.southWest.latitude,this.northEast.longitude,this.northEast.latitude]}isValid(){return this.southWest.longitude!==1/0}containsGeoPosition(t){return!(t.longitude<this.southWest.longitude||t.latitude<this.southWest.latitude||t.longitude>this.northEast.longitude||t.latitude>this.northEast.latitude)}computeWidth(){const t=new Wr(this.southWest.longitude,this.northEast.latitude);return(new Wr(this.northEast.longitude,this.southWest.latitude).distanceFrom(this.southWest)+this.northEast.distanceFrom(t))/2}computeHeight(){const t=new Wr(this.southWest.longitude,this.northEast.latitude);return(new Wr(this.northEast.longitude,this.southWest.latitude).distanceFrom(this.northEast)+this.southWest.distanceFrom(t))/2}asPolygon(){const t=this.southWest,e=new Wr(this.southWest.longitude,this.northEast.latitude),i=this.northEast,r=new Wr(this.northEast.longitude,this.southWest.latitude);return{type:"Polygon",coordinates:[[t.asPosition(),e.asPosition(),i.asPosition(),r.asPosition(),t.asPosition()]]}}}class jv{constructor(t,e){if(this.timetableTime=t,this.estimatedTime=e,e){const i=(e.getTime()-t.getTime())/1e3;this.delayMinutes=Math.floor(i/60)}else this.delayMinutes=null}static initWithParentTreeNode(t,e){const i=t.findChildNamed(e);return null===i?null:jv.initWithContextTreeNode(i)}static initWithContextTreeNode(t){const e=t.findTextFromChildNamed("TimetabledTime");if(null===e)return null;const i=new Date(Date.parse(e));let r=null;const s=t.findTextFromChildNamed("EstimatedTime");return s&&(r=new Date(Date.parse(s))),new jv(i,r)}}class Dh{constructor(t,e,i,r,s,u){this.stopPointType=t,this.location=e,this.arrivalData=i,this.departureData=r,this.plannedPlatform=s,this.actualPlatform=null,this.sequenceOrder=u,this.isNotServicedStop=null,this.siriSituationIds=[],this.siriSituations=[],this.vehicleAccessType=null}static initWithTreeNode(t,e){const i=t.findTextFromChildNamed("siri:StopPointRef"),r=t.findTextFromChildNamed("StopPointName/Text");if(!i||!r)return null;const s=new to;s.stopPlace=new Eh(i,r,null);const u=jv.initWithParentTreeNode(t,"ServiceArrival"),m=jv.initWithParentTreeNode(t,"ServiceDeparture"),y=t.findTextFromChildNamed("PlannedQuay/Text"),C=t.findTextFromChildNamed("Order"),I=null===C?null:parseInt(C,10),A=new Dh(e,s,u,m,y,I);A.actualPlatform=t.findTextFromChildNamed("EstimatedQuay/Text");const B=t.findChildNamed("NotServicedStop");return B&&(A.isNotServicedStop="true"===B.text),A.siriSituationIds=[],t.findChildrenNamed("SituationFullRef").forEach(K=>{const pe=K.findTextFromChildNamed("siri:SituationNumber");pe&&A.siriSituationIds.push(pe)}),A.vehicleAccessType=Dh.computePlatformAssistance(t),A}static computePlatformAssistance(t){const e=t.findTextFromChildNamed("NameSuffix/Text");return null===e?null:"PLATFORM_ACCESS_WITH_ASSISTANCE"===e?"PLATFORM_ACCESS_WITH_ASSISTANCE":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===e?"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===e?"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE":"PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===e?"PLATFORM_ACCESS_WITHOUT_ASSISTANCE":"NO_DATA"===e?"NO_DATA":null}patchSituations(t){this.siriSituations=[],this.siriSituationIds.forEach(e=>{var i;const r=null!==(i=t[e])&&void 0!==i?i:null;r&&this.siriSituations.push(r)})}}class HD{constructor(t,e,i){this.ptMode=t,this.name=e,this.shortName=i,this.isDemandMode=!1}static initWithServiceTreeNode(t){const e=t.findTextFromChildNamed("Mode/PtMode");if(null===e)return null;const i=t.findTextFromChildNamed("Mode/Name/Text"),r=t.findTextFromChildNamed("Mode/ShortName/Text"),s=new HD(e,i,r),u=t.findTextFromChildNamed("Mode/siri:BusSubmode");return s.isDemandMode="demandAndResponseBus"===u||"unknown"===u,s}isRail(){return"rail"===this.ptMode}hasPrecisePolyline(){if(this.isDemandMode)return!0;const e=this.computePublicTransportPictogram();return-1===["picto-bus","picto-bus-fallback","picto-tram"].indexOf(e)}computePublicTransportPictogram(){return"bus"===this.ptMode?"picto-bus":this.isRail()?"picto-railway":"tram"===this.ptMode?"picto-tram":"CC"===this.shortName?"picto-rack-railway":"FUN"===this.shortName?"picto-funicular":"PB"===this.shortName?"picto-cablecar":"GB"===this.shortName?"picto-gondola":"SL"===this.shortName?"picto-chairlift":"water"===this.ptMode?"picto-boat":this.isDemandMode?"car-sharing":"picto-bus-fallback"}addToXMLNode(t){const e=t.ele("ojp:Mode");e.ele("ojp:PtMode",this.ptMode),this.name&&e.ele("ojp:Name").ele("ojp:Text",this.name),this.shortName&&e.ele("ojp:ShortName").ele("ojp:Text",this.shortName)}}class Uv{constructor(t,e,i){this.journeyRef=t,this.lineRef=null,this.directionRef=null,this.ptMode=e,this.agencyID=i,this.originStopPlace=null,this.destinationStopPlace=null,this.serviceLineNumber=null,this.journeyNumber=null,this.siriSituationIds=[],this.siriSituations=[],this.serviceAttributes={}}static initWithTreeNode(t){const e=t.findChildNamed("Service");if(null===e)return null;const i=e.findTextFromChildNamed("JourneyRef"),r=HD.initWithServiceTreeNode(e),s=e.findTextFromChildNamed("OperatorRef"),u=null==s?void 0:s.replace("ojp:","");if(!(i&&r&&u))return null;const m=new Uv(i,r,u);return m.lineRef=e.findTextFromChildNamed("siri:LineRef"),m.directionRef=e.findTextFromChildNamed("siri:DirectionRef"),m.originStopPlace=Eh.initWithServiceTreeNode(e,"Origin"),m.destinationStopPlace=Eh.initWithServiceTreeNode(e,"Destination"),m.serviceLineNumber=e.findTextFromChildNamed("PublishedLineName/Text"),m.journeyNumber=t.findTextFromChildNamed("Extension/PublishedJourneyNumber/Text"),m.siriSituationIds=[],e.findChildrenNamed("SituationFullRef").forEach(C=>{const I=C.findTextFromChildNamed("siri:SituationNumber");I&&m.siriSituationIds.push(I)}),m.serviceAttributes={},e.findChildrenNamed("Attribute").forEach(C=>{let I=C.findTextFromChildNamed("Code");if(null===I)return console.error("ERROR - cant find code for Attribute"),void console.log(C);I.startsWith("A_")&&(I=I.replace(/A_*/,""));const A=C.findTextFromChildNamed("Text/Text");if(null===A)return console.error("ERROR - cant find code/text for Attribute"),void console.log(C);const B={code:I,text:A,extra:{}};C.children.forEach(j=>{if(j.name.startsWith("siri:")){const K=j.name.split("siri:");if(2!==K.length)return;const Se=j.text;if(null===Se)return;B.extra[K[1]]=Se}}),m.serviceAttributes[I]=B}),m}computeLegLineType(){return"801"===this.agencyID?"PostAuto":this.ptMode.isRail()?"LongDistanceRail":this.ptMode.isDemandMode?"OnDemand":"Bus"}formatServiceName(){var t,e,i,r;if(this.ptMode.isDemandMode)return null!==(t=this.serviceLineNumber)&&void 0!==t?t:"OnDemand";const s=[];return this.serviceLineNumber?(this.ptMode.isRail()||s.push(null!==(e=this.ptMode.shortName)&&void 0!==e?e:this.ptMode.ptMode),s.push(this.serviceLineNumber),s.push(null!==(i=this.journeyNumber)&&void 0!==i?i:"")):s.push(null!==(r=this.ptMode.shortName)&&void 0!==r?r:this.ptMode.ptMode),s.push("("+this.agencyID+")"),s.join(" ")}addToXMLNode(t){const e=t.ele("ojp:Service");e.ele("ojp:JourneyRef",this.journeyRef),this.lineRef&&e.ele("siri:LineRef",this.lineRef),this.directionRef&&e.ele("siri:DirectionRef",this.directionRef),this.ptMode.addToXMLNode(e),this.serviceLineNumber&&e.ele("ojp:PublishedLineName").ele("ojp:Text",this.serviceLineNumber);let i=this.agencyID;i.startsWith("ojp:")||(i="ojp:"+i),e.ele("ojp:OperatorRef",i)}}class $D{constructor(t,e){this.stopPoint=t,this.journeyService=e,this.prevStopPoints=[],this.nextStopPoints=[]}static initWithTreeNode(t){const e=t.findChildNamed("StopEvent");if(null===e)return null;const i=e.findChildNamed("ThisCall/CallAtStop");if(null===i)return null;const r=Dh.initWithTreeNode(i,"Intermediate");if(null===r)return null;const s=Uv.initWithTreeNode(e);if(null===s)return null;const u=new $D(r,s);return["PreviousCall","OnwardCall"].forEach(y=>{const I="PreviousCall"===y?u.prevStopPoints:u.nextStopPoints;e.findChildrenNamed(y).forEach(B=>{const j=B.findChildNamed("CallAtStop");if(null===j)return;const K=Dh.initWithTreeNode(j,"Intermediate");K&&I.push(K)})}),u}patchStopEventLocations(t){let e=[this.stopPoint];["prev","next"].forEach(r=>{e=e.concat("prev"===r?this.prevStopPoints:this.nextStopPoints)}),e.forEach(r=>{var s;const u=null===(s=r.location.stopPlace)||void 0===s?void 0:s.stopPlaceRef;u&&u in t&&(r.location=t[u])})}}function eF(n,t,e,i,r,s,u){try{var m=n[s](u),y=m.value}catch(C){return void e(C)}m.done?t(y):Promise.resolve(y).then(i,r)}function Hv(n){return function(){var t=this,e=arguments;return new Promise(function(i,r){var s=n.apply(t,e);function u(y){eF(s,i,r,u,m,"next",y)}function m(y){eF(s,i,r,u,m,"throw",y)}u(void 0)})}}var xW=We(8472);class SS{constructor(t){this.stageConfig=t,this.requestInfo={requestDateTime:null,requestXML:null,responseDateTime:null,responseXML:null,parseDateTime:null,error:null},this.logRequests="DEBUG"===xS,this.mockRequestXML=null,this.mockResponseXML=null}buildRequestXML(){return"<override/>"}fetchOJPResponse(){this.requestInfo.requestDateTime=new Date,this.requestInfo.requestXML=this.mockRequestXML?this.mockRequestXML:this.buildRequestXML();const t=this.stageConfig.apiEndpoint;this.logRequests&&(console.log("OJP Request: /POST - "+t),console.log(this.requestInfo.requestXML));const e={method:"POST",body:this.requestInfo.requestXML,headers:{"Content-Type":"text/xml",Authorization:"Bearer "+this.stageConfig.authBearerKey}};return new Promise(r=>{if(this.mockResponseXML)return this.requestInfo.responseXML=this.mockResponseXML,this.requestInfo.responseDateTime=new Date,void r(this.requestInfo);xW(t,e).then(s=>s.ok?s.text():(this.requestInfo.error={error:"FetchError",message:"HTTP ERROR - Status:"+s.status+" - URL:"+t},null)).then(s=>{null!==s&&(this.requestInfo.responseXML=s,this.requestInfo.responseDateTime=new Date),r(this.requestInfo)}).catch(s=>{this.requestInfo.error={error:"FetchError",message:s},r(this.requestInfo)})})}}class tF{constructor(t,e,i,r){this.legType=t,this.legID=e,this.fromLocation=i,this.toLocation=r,this.legTrack=null,this.legDuration=null}patchLocations(t){[this.fromLocation,this.toLocation].forEach(e=>{var i;this.patchLocation(e,t),!e.geoPosition&&null!==(i=this.legTrack)&&void 0!==i&&i.hasGeoData&&(e===this.fromLocation?this.fromLocation.geoPosition=this.legTrack.fromGeoPosition():this.toLocation.geoPosition=this.legTrack.toGeoPosition())})}patchSituations(t){}patchLocation(t,e){var i,r;if(t.geoPosition)return;let s=null!==(r=null===(i=t.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;return null===s?(console.error("TripLeg.patchLocation - no stopPlaceRef found in location"),void console.log(t)):(s in e||(s=class wW{static convertStopPointToStopPlace(t){if(!t.includes(":sloid:"))return t;const e=t.match(/^([^:]+?):([^:]+?):sloid:([^:]+?):([^:]+?):([^:]+?)$/);return null===e?t:"ch"===e[1]?"85"+e[3].padStart(5,"0").slice(-5):(console.log("convertStopPointToStopPlace: unhandled countryRef for "+t),console.log(e),t)}}.convertStopPointToStopPlace(s)),s in e?void t.patchWithAnotherLocation(e[s]):(console.error("TripLeg.patchLocation - no stopPlaceRef found in mapContextLocations"),console.log(t),console.log("location.stopPlace?.stopPlaceRef :"+s),void console.log(e)))}computeGeoJSONFeatures(){let t=[];if(this.useBeeline()){const r=this.computeBeelineFeature();r&&t.push(r)}const i=this.computeLinePointFeatures();return t=t.concat(i),t=t.concat(this.computeSpecificJSONFeatures()),t.forEach(r=>{r.properties&&(r.properties["leg.idx"]=this.legID-1,r.properties[Jo.LegType]=this.computeLegType())}),t}useBeeline(){var t;return!(null!==(t=this.legTrack)&&void 0!==t&&t.hasGeoData)}computeLegType(){return"TimedLeg"==this.legType?"TimedLeg":"TransferLeg"==this.legType?"TransferLeg":"ContinousLeg"==this.legType?"ContinousLeg":"n/a"}computeSpecificJSONFeatures(){return[]}computeLegColor(){var t;return null!==(t=zv[this.legType])&&void 0!==t?t:zv.TimedLeg}computeLinePointsData(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{var r,s;const u=i.asGeoJSONFeature();if(null!=u&&u.properties){const m=i===this.fromLocation,y=m?"From":"To",C=m?null===(r=this.legTrack)||void 0===r?void 0:r.fromGeoPosition():null===(s=this.legTrack)||void 0===s?void 0:s.toGeoPosition();C&&(u.geometry.coordinates=C.asPosition()),t.push({type:y,feature:u})}}),t}computeLinePointFeatures(){const t=[],e=this.computeLegLineType();return this.computeLinePointsData().forEach(r=>{const u=r.feature;null!==u.properties&&(u.properties[Jo.PointType]=r.type,u.properties[Jo.DrawType]="LegPoint",u.properties[Jo.LineType]=e,u.bbox=[u.geometry.coordinates[0],u.geometry.coordinates[1],u.geometry.coordinates[0],u.geometry.coordinates[1]],t.push(u))}),t}computeLegLineType(){return"Unknown"}computeBeelineFeature(){const t=this.computeBeelineGeoPositions();if(t.length<2)return null;const e=[];t.forEach(y=>{e.push(y.asPosition())});const i={};i[Jo.DrawType]="Beeline";const s=this.computeLegLineType();i[Jo.LineType]=s;const u=new pd(t);return{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e},bbox:u.asFeatureBBOX()}}computeBeelineGeoPositions(){const t=[];return[this.fromLocation,this.toLocation].forEach(i=>{i.geoPosition&&t.push(i.geoPosition)}),t}addToXMLNode(t){}}class CS{constructor(t,e){this.coordinates=t,this.bbox=e}static initWithTreeNode(t){const e=t.findChildNamed("LinkProjection");if(null===e)return null;const i=[];if(e.findChildrenNamed("Position").forEach(m=>{const y=m.findTextFromChildNamed("siri:Longitude"),C=m.findTextFromChildNamed("siri:Latitude");if(y&&C){const I=new Wr(parseFloat(y),parseFloat(C));i.push(I)}}),i.length<2)return null;const s=new pd(i);return new CS(i,s)}computeLength(){let t=0;return this.coordinates.forEach((e,i)=>{0!==i&&(t+=e.distanceFrom(this.coordinates[i-1]))}),t}asGeoJSONFeature(){const t={type:"Feature",bbox:this.bbox.asFeatureBBOX(),properties:{},geometry:{type:"LineString",coordinates:[]}};return this.coordinates.forEach(e=>{t.geometry.coordinates.push([e.longitude,e.latitude])}),t}}class qD{constructor(t){this.sections=t}static initWithTreeNode(t){const e=t.findChildNamed("PathGuidance");if(null===e)return null;let i=[];return e.findChildrenNamed("PathGuidanceSection").forEach(u=>{const m=GD.initWithSectionTreeNode(u);m&&i.push(m)}),new qD(i)}}class GD{constructor(){this.trackSection=null,this.guidanceAdvice=null,this.turnAction=null}static initWithSectionTreeNode(t){const e=new GD,i=t.findChildNamed("TrackSection");return i&&(e.trackSection=WD.initWithTrackSectionTreeNode(i)),e.guidanceAdvice=t.findTextFromChildNamed("GuidanceAdvice"),e.turnAction=t.findTextFromChildNamed("TurnAction"),e}}class WD{constructor(){this.linkProjection=null,this.roadName=null,this.duration=null,this.length=null}static initWithTrackSectionTreeNode(t){const e=new WD;e.linkProjection=CS.initWithTreeNode(t),e.roadName=t.findTextFromChildNamed("RoadName"),e.duration=t.findTextFromChildNamed("Duration");const i=t.findTextFromChildNamed("Length");return null!==i&&(e.length=parseInt(i,10)),e}}class fd{constructor(t,e){this.hours=t,this.minutes=e,this.totalMinutes=60*t+e}static initWithTreeNode(t,e="Duration"){const i=t.findTextFromChildNamed(e);return null===i?null:fd.initFromDurationText(i)}static initFromDurationText(t){if(null===t)return null;let e=0;const i=(t=t.replace("PT","")).match(/([0-9]+?)H/);i&&(e=parseInt(i[1]));let r=0;const s=t.match(/([0-9]+?)M/);return s&&(r=parseInt(s[1])),new fd(e,r)}static initFromTotalMinutes(t){const e=Math.floor(t/60);return new fd(e,t-60*e)}formatDuration(){const t=[];return this.hours>0&&t.push(this.hours+"h "),t.push(this.minutes+"min"),t.join("")}plus(t){return fd.initFromTotalMinutes(this.totalMinutes+t.totalMinutes)}asOJPFormattedText(){const t=[];return t.push("PT"),t.push(this.hours+"H"),t.push(this.minutes+"M"),t.join("")}}class TS{constructor(t){this.trackSections=t;let e=0;this.hasGeoData=!1,t.forEach(i=>{i.linkProjection&&(this.hasGeoData=!0),i.duration&&(e+=i.duration.totalMinutes)}),this.duration=null,e>0&&(this.duration=fd.initFromTotalMinutes(e))}plus(t){return null!==this.duration&&null!==t.duration&&(this.duration=this.duration.plus(t.duration)),this.trackSections=this.trackSections.concat(t.trackSections),this}static initWithLegTreeNode(t){const e=t.findChildNamed("LegTrack");if(null===e)return null;const i=[];return e.findChildrenNamed("TrackSection").forEach(u=>{const m=XD.initWithTreeNode(u);m&&i.push(m)}),new TS(i)}fromGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[0].linkProjection;return null===e?null:e.coordinates[0]}toGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[this.trackSections.length-1].linkProjection;return null===e?null:e.coordinates[e.coordinates.length-1]}}class XD{constructor(t,e){this.fromLocation=t,this.toLocation=e,this.duration=null,this.length=null,this.linkProjection=null}static initWithTreeNode(t){const e=t.findChildNamed("TrackStart"),i=t.findChildNamed("TrackEnd");if(!e||!i)return null;const r=to.initWithTreeNode(e),s=to.initWithTreeNode(i);if(!r||!s)return console.error("CANT instantiate TrackSection.initWithTreeNode"),console.log(t),null;const u=new XD(r,s);u.duration=fd.initWithTreeNode(t);const m=CS.initWithTreeNode(t);u.linkProjection=m;const y=t.findTextFromChildNamed("Length");return null===y?m&&(u.length=m.computeLength()):u.length=parseInt(y,10),u}}class ES{constructor(t){this.bookingArrangements=t}static initWithLegTreeNode(t){const e=t.findChildNamed("Service/BookingArrangements");if(null===e)return null;const i=e.findChildrenNamed("BookingArrangement");if(0===i.length)return console.error("ERROR - no BookingArrangements nodes found"),null;const r=[];return i.forEach(u=>{const m=u.findTextFromChildNamed("BookingAgencyName/Text");let y=u.findTextFromChildNamed("InfoUrl");if(null===m||null===y||(y=y.trim(),y.length<2))return;"<"===y[0]&&(y=y.substring(1,y.length-1));var C=document.createElement("textarea");C.innerHTML=y.trim(),y=C.innerText;const I={agencyCode:m.trim(),agencyName:ES.computeAgencyName(m),infoURL:y};r.push(I)}),new ES(r)}static computeAgencyName(t){return(t=t.trim()).endsWith("_local.ch")?"local.ch":t.endsWith("_maps.google.ch")?"maps.google.com":t.endsWith("_openstreetmap.org")?"openstreetmap.org":"n/a catalog: "+t}}class DS extends tF{constructor(t,e,i,r,s){super(t,e,r,s),this.legTransportMode=null,this.legDistance=i,this.pathGuidance=null,this.walkDuration=null,this.serviceBooking=null,this.transferMode=null}static initWithTreeNode(t,e,i){var r;const s=e.findChildNamed("LegStart"),u=e.findChildNamed("LegEnd");if(null===s||null===u)return null;const m=to.initWithTreeNode(s),y=to.initWithTreeNode(u);if(null===m||null===y)return null;let C=null!==(r=e.findTextFromChildNamed("Length"))&&void 0!==r?r:"0";const I=parseInt(C),A=new DS(i,t,I,m,y);return A.legDuration=fd.initWithTreeNode(e),A.pathGuidance=qD.initWithTreeNode(e),A.legTransportMode=A.computeLegTransportModeFromTreeNode(e,i),A.transferMode=A.computeLegTransferModeFromTreeNode(e),("taxi"===A.legTransportMode||"others-drive-car"===A.legTransportMode)&&(A.serviceBooking=ES.initWithLegTreeNode(e)),A.legTrack=TS.initWithLegTreeNode(e),"TransferLeg"===i&&(A.walkDuration=fd.initWithTreeNode(e,"WalkDuration")),A}computeLegTransportModeFromTreeNode(t,e){let i=null;if("TransferLeg"===e)return null;if(("TimedLeg"===e||"ContinousLeg"===e)&&(i=t.findTextFromChildNamed("Service/IndividualMode"),null===i)){const u=[];["Service/PersonalMode","Service/PersonalModeOfOperation","Service/Mode/PtMode","Service/Mode/siri:RailSubmode","Service/Mode/siri:WaterSubmode"].forEach(y=>{const C=t.findTextFromChildNamed(y);null!==C&&u.push(C)}),i=u.join(".")}const r=t.findTextFromChildNamed("Service/BookingArrangements/BookingArrangement/BookingAgencyName/Text"),s=this.computeLegTransportModeFromString(i,r);return null===s&&(console.error("ERROR computeLegTransportModeFromString"),console.log("=> CANT handle mode --"+i+"--"),console.log(t)),s}computeLegTransferModeFromTreeNode(t){const e=t.findTextFromChildNamed("TransferMode");return null===e?null:"walk"===e?"walk":"remainInVehicle"===e?"remainInVehicle":(console.error("CANT map TransferMode from =="+e+"=="),null)}computeLegTransportModeFromString(t,e=null){return null===t?null:"walk"===t?"walk":"self-drive-car"===t?"self-drive-car":"cycle"===t?"cycle":"taxi"===t?-1!==(null==e?void 0:e.indexOf("_limousine_"))?"others-drive-car":"taxi":"car.own"===t?"self-drive-car":"car.own.rail.vehicleTunnelTransportRailService"===t?"car-shuttle-train":"car.own.water.localCarFerry"===t?"car-ferry":null}isDriveCarLeg(){return"self-drive-car"===this.legTransportMode}isSharedMobility(){return null!==this.legTransportMode&&-1!==["cycle","bicycle_rental","car_sharing","escooter_rental"].indexOf(this.legTransportMode)}isWalking(){return"walk"===this.legTransportMode}isTaxi(){return"taxi"===this.legTransportMode||"others-drive-car"===this.legTransportMode}computeSpecificJSONFeatures(){var t,e;const i=[];return null===(t=this.pathGuidance)||void 0===t||t.sections.forEach((r,s)=>{var u,m,y,C,I,A,B,j,K,pe;const Se=null===(m=null===(u=r.trackSection)||void 0===u?void 0:u.linkProjection)||void 0===m?void 0:m.asGeoJSONFeature();null!=Se&&Se.properties&&(Se.properties[Jo.DrawType]="LegLine",Se.properties[Jo.LineType]="Guidance",Se.properties["PathGuidanceSection.idx"]=s,Se.properties["PathGuidanceSection.TrackSection.RoadName"]=null!==(C=null===(y=r.trackSection)||void 0===y?void 0:y.roadName)&&void 0!==C?C:"",Se.properties["PathGuidanceSection.TrackSection.Duration"]=null!==(A=null===(I=r.trackSection)||void 0===I?void 0:I.duration)&&void 0!==A?A:"",Se.properties["PathGuidanceSection.TrackSection.Length"]=null!==(j=null===(B=r.trackSection)||void 0===B?void 0:B.length)&&void 0!==j?j:"",Se.properties["PathGuidanceSection.GuidanceAdvice"]=null!==(K=r.guidanceAdvice)&&void 0!==K?K:"",Se.properties["PathGuidanceSection.TurnAction"]=null!==(pe=r.turnAction)&&void 0!==pe?pe:"",i.push(Se))}),null===(e=this.legTrack)||void 0===e||e.trackSections.forEach(r=>{var s;const u=null===(s=r.linkProjection)||void 0===s?void 0:s.asGeoJSONFeature();null!=u&&u.properties&&(u.properties[Jo.DrawType]="LegLine",u.properties[Jo.LineType]=this.computeLegLineType(),i.push(u))}),i}computeLegLineType(){return this.isDriveCarLeg()?"Self-Drive Car":this.isSharedMobility()?"Shared Mobility":this.isTaxi()?"OnDemand":"TransferLeg"===this.legType?"Transfer":"car-ferry"===this.legTransportMode?"Water":"Walk"}computeLinePointsData(){return"TransferLeg"===this.legType?[]:super.computeLinePointsData()}computeLegColor(){return this.isDriveCarLeg()?Xp["Self-Drive Car"]:this.isSharedMobility()?Xp["Shared Mobility"]:"TransferLeg"===this.legType?Xp.Transfer:this.isTaxi()?Xp.OnDemand:"car-ferry"===this.legTransportMode?Xp.Water:Xp.Walk}formatDistance(){return this.legDistance>1e3?(this.legDistance/1e3).toFixed(1)+" km":this.legDistance+" m"}useBeeline(){if("TransferLeg"===this.legType){if(null===this.pathGuidance)return super.useBeeline();let t=!1;return this.pathGuidance.sections.forEach(e=>{var i;null!==(i=e.trackSection)&&void 0!==i&&i.linkProjection&&(t=!0)}),!1===t}return super.useBeeline()}addToXMLNode(t){const e=t.ele("ojp:TripLeg");e.ele("ojp:LegId",this.legID),e.ele("ojp:"+this.legType)}}class n_ extends tF{constructor(t,e,i,r,s=[]){super("TimedLeg",t,i.location,r.location),this.service=e,this.fromStopPoint=i,this.toStopPoint=r,this.intermediateStopPoints=s}static initWithTreeNode(t,e){const i=Uv.initWithTreeNode(e);if(null===i)return null;const r=e.findChildNamed("LegBoard"),s=e.findChildNamed("LegAlight");if(null===r||null===s)return null;const u=Dh.initWithTreeNode(r,"From"),m=Dh.initWithTreeNode(s,"To");if(null===u||null===m)return null;const y=[];e.findChildrenNamed("LegIntermediates").forEach(A=>{const B=Dh.initWithTreeNode(A,"Intermediate");B&&y.push(B)});const I=new n_(t,i,u,m,y);return I.legTrack=TS.initWithLegTreeNode(e),I.legTrack&&null===I.legDuration&&(I.legDuration=I.legTrack.duration),I}patchLocations(t){super.patchLocations(t),this.intermediateStopPoints.forEach(e=>{this.patchLocation(e.location,t)})}computeDepartureTime(){return this.computeStopPointTime(this.fromStopPoint.departureData)}computeArrivalTime(){return this.computeStopPointTime(this.toStopPoint.arrivalData)}computeStopPointTime(t){var e;return null===t?null:null!==(e=t.estimatedTime)&&void 0!==e?e:t.timetableTime}computeSpecificJSONFeatures(){var t;let e=[];const i=this.service.computeLegLineType();return!this.useBeeline()&&(null===(t=this.legTrack)||void 0===t||t.trackSections.forEach(s=>{var u;const m=null===(u=s.linkProjection)||void 0===u?void 0:u.asGeoJSONFeature();null!=m&&m.properties&&(m.properties[Jo.DrawType]="LegLine",m.properties[Jo.LineType]=i,e.push(m))})),e}computeLegLineType(){return this.service.computeLegLineType()}computeLinePointsData(){const t=super.computeLinePointsData();return this.intermediateStopPoints.forEach(e=>{const i=e.location.asGeoJSONFeature();null!=i&&i.properties&&t.push({type:"Intermediate",feature:i})}),t}computeLegColor(){var t;const e=super.computeLegColor(),i=this.service.computeLegLineType();return null!==(t=Xp[i])&&void 0!==t?t:e}computeBeelineGeoPositions(){const t=[],e=[];return e.push(this.fromStopPoint),this.intermediateStopPoints.forEach(i=>{e.push(i)}),e.push(this.toStopPoint),e.forEach(i=>{i.location.geoPosition&&t.push(i.location.geoPosition)}),t}useBeeline(){const t=this.service.ptMode.hasPrecisePolyline();return super.useBeeline()||!t}patchSituations(t){this.service.siriSituations=[],this.service.siriSituationIds.forEach(e=>{var i;const r=null!==(i=t[e])&&void 0!==i?i:null;r&&this.service.siriSituations.push(r)})}addToXMLNode(t){const e=t.ele("ojp:TripLeg");e.ele("ojp:LegId",this.legID);const i=e.ele("ojp:TimedLeg"),r=["Arr","Dep"],s=(u,m)=>{var y;const I=i.ele("From"===m?"ojp:LegBoard":"To"===m?"ojp:LegAlight":"ojp:LegIntermediates"),A=u.location.stopPlace;A&&(I.ele("siri:StopPointRef",A.stopPlaceRef),I.ele("ojp:StopPointName").ele("ojp:Text",null!==(y=A.stopPlaceName)&&void 0!==y?y:"n/a")),r.forEach(B=>{const j="Arr"===B,K=j?u.arrivalData:u.departureData;K&&I.ele(j?"ojp:ServiceArrival":"ojp:ServiceDeparture").ele("ojp:TimetabledTime",K.timetableTime.toISOString())})};s(this.fromStopPoint,"From"),this.intermediateStopPoints.forEach(u=>{s(u,"Intermediate")}),s(this.toStopPoint,"To"),this.service.addToXMLNode(i)}}class Ja{constructor(t){this.location=t,this.minDuration=2,this.maxDuration=30,this.minDistance=100,this.maxDistance=2e4,this.customTransportMode=null}static Empty(){const t=new to;return new Ja(t)}}class ZD{constructor(t,e,i){this.stopPoints=t,this.service=e,this.metadata=i}static initFromTreeNode(t){var e,i,r;const s=t.findChildNamed("Service");if(null===s)return console.error("TripInfoResult.initFromTreeNode: no service node found"),console.log(t),null;const u=Uv.initWithTreeNode(t);if(null===u)return console.error("JourneyService.initFromTreeNode: cant init service"),console.log(s),null;const m=t.findChildrenNamed("PreviousCall"),y=t.findChildrenNamed("OnwardCall"),C=m.concat(y),I=[];if(C.forEach(j=>{const K=Dh.initWithTreeNode(j,"Intermediate");null!==K&&I.push(K)}),I.length<2)return console.error("TripInfoResult.initFromTreeNode: expected minimum 2 stops"),console.log(t),null;const A={transportTypeName:null!==(e=t.findTextFromChildNamed("Extension/TransportTypeName/Text"))&&void 0!==e?e:"TransportTypeName n/a",publishedJourneyNumber:null!==(i=t.findTextFromChildNamed("Extension/PublishedJourneyNumber/Text"))&&void 0!==i?i:"PublishedJourneyNumber n/a",operatorName:null!==(r=t.findTextFromChildNamed("Extension/OperatorName/Text"))&&void 0!==r?r:"OperatorName n/a"};return new ZD(I,u,A)}patchLocations(t){this.stopPoints.forEach(e=>{var i,r;const s=null!==(r=null===(i=e.location.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;return null===s?(console.error("TripInfoResult.patchLocations - no stopPlaceRef found in location"),void console.log(e)):s in t?void e.location.patchWithAnotherLocation(t[s]):(console.error("TripInfoResult.patchLocations - no stopPlaceRef found in mapContextLocations"),console.log(e),void console.log(t))})}}class YD{constructor(t,e,i){this.id=t,this.legs=e,this.stats=i,this.tripFareResults=[]}static initFromTreeNode(t){const e=t.findTextFromChildNamed("TripId");if(null===e)return null;const i=fd.initFromDurationText(t.findTextFromChildNamed("Duration"));if(null===i)return null;const r=t.findTextFromChildNamed("Transfers");if(null===r)return null;const s=t.findTextFromChildNamed("StartTime"),u=t.findTextFromChildNamed("EndTime");if(null===s||null===u)return null;const m=new Date(Date.parse(s)),y=new Date(Date.parse(u)),C=[];let I=0;if(t.findChildrenNamed("TripLeg").forEach(pt=>{var kt,yn;const kn=class SW{static initWithTreeNode(t){const e=t.findTextFromChildNamed("LegId");if(null===e)return null;const i=parseInt(e,10),r=t.findChildNamed("TransferLeg");if(r){const m=DS.initWithTreeNode(i,r,"TransferLeg");if(m)return m}const s=t.findChildNamed("TimedLeg");if(s){const m=n_.initWithTreeNode(i,s);if(m)return m}const u=t.findChildNamed("ContinuousLeg");if(u){const m=DS.initWithTreeNode(i,u,"ContinousLeg");if(m)return m}return null}}.initWithTreeNode(pt);null!==kn&&((null!==(yn=null===(kt=kn.legTrack)||void 0===kt?void 0:kt.trackSections)&&void 0!==yn?yn:[]).forEach(ci=>{var no;I+=null!==(no=ci.length)&&void 0!==no?no:0}),C.push(kn))}),0===C.length)return console.error("Trip.initFromTreeNode no legs found ?"),console.log(t),null;let B=0,j="trip";const K=t.findTextFromChildNamed("Distance");null===K?(j="legs-sum",B=I):B=parseInt(K);const pe={duration:i,distanceMeters:B,distanceSource:j,transferNo:parseInt(r),startDatetime:m,endDatetime:y,isCancelled:null,isInfeasable:null},Se=t.findChildNamed("Cancelled");Se&&(pe.isCancelled="true"===Se.text);const Xe=t.findChildNamed("Infeasible");return Xe&&(pe.isInfeasable="true"===Xe.text),new YD(e,C,pe)}computeDepartureTime(){var t;const e=this.legs.filter(u=>u instanceof n_);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),null;const r=e[0].fromStopPoint.departureData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeArrivalTime(){var t;const e=this.legs.filter(u=>u instanceof n_);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),new Date;const r=e[e.length-1].toStopPoint.arrivalData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeGeoJSON(){let t=[];return this.legs.forEach(i=>{const r=i.computeGeoJSONFeatures();t=t.concat(r)}),{type:"FeatureCollection",features:t}}computeFromLocation(){return 0===this.legs.length?null:this.legs[0].fromLocation}computeToLocation(){return 0===this.legs.length?null:this.legs[this.legs.length-1].toLocation}computeBBOX(){var t,e;const i=new pd([]),r=null===(t=this.computeFromLocation())||void 0===t?void 0:t.geoPosition;r?i.extend(r):(console.error("Trip.computeBBOX - cant computeFromLocation"),console.log(this));const s=null===(e=this.computeToLocation())||void 0===e?void 0:e.geoPosition;return s?i.extend(s):(console.error("Trip.computeBBOX - cant computeToLocation"),console.log(this)),this.legs.forEach(u=>{u.computeGeoJSONFeatures().forEach(y=>{var C;const I=null!==(C=y.bbox)&&void 0!==C?C:null;null!==I&&(i.extend(new Wr(I[0],I[1])),i.extend(new Wr(I[2],I[3])))})}),i}addToXMLNode(t){const e=t.ele("ojp:Trip");e.ele("ojp:TripId",this.id),e.ele("ojp:Duration",this.stats.duration.asOJPFormattedText()),e.ele("ojp:StartTime",this.stats.startDatetime.toISOString()),e.ele("ojp:EndTime",this.stats.endDatetime.toISOString()),e.ele("ojp:Transfers",this.stats.transferNo),e.ele("ojp:Distance",this.stats.distanceMeters),this.legs.forEach(i=>{i.addToXMLNode(e)})}}var nF=We(7904);class IS{constructor(t){this.language=t,this.serviceRequestNode=this.computeBaseServiceRequestNode()}computeBaseServiceRequestNode(){const t=nF.create("siri:OJP",{version:"1.0",encoding:"utf-8"});t.att("xmlns","http://www.vdv.de/ojp"),t.att("xmlns:siri","http://www.siri.org.uk/siri"),t.att("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),t.att("xmlns:xsd","http://www.w3.org/2001/XMLSchema"),t.att("xsi:schemaLocation","http://www.vdv.de/ojp"),t.att("version","1.0");const e=t.ele("siri:OJPRequest").ele("siri:ServiceRequest");return e.ele("siri:ServiceRequestContext").ele("siri:Language",this.language),e}buildRequestorRef(){return"OJP_JS_SDK_v"+FD}buildRequestNode(){this.serviceRequestNode=this.computeBaseServiceRequestNode()}buildRequestXML(){return this.buildRequestNode(),this.serviceRequestNode.end({pretty:!0})}}class md extends IS{constructor(t,e,i,r=new Date,s="Dep",u="NumberOfResults"){super(t),this.fromTripLocation=e,this.toTripLocation=i,this.departureDate=r,this.tripRequestBoardingType=s,this.numberOfResultsType=u,this.modeType="monomodal",this.transportMode="public_transport",this.includeLegProjection=!0}static Empty(){const t=Ja.Empty();return new md("en",t,t,new Date,"Dep","NumberOfResults")}static initWithLocationsAndDate(t,e,i,r=new Date,s="Dep",u="NumberOfResults"){if(null===e||null===i)return null;const m=new Ja(e),y=new Ja(i);return md.initWithTripLocationsAndDate(t,m,y,r,s,u)}static initWithTripLocationsAndDate(t,e,i,r=new Date,s="Dep",u="NumberOfResults"){return null===e||null===i||!e.location.geoPosition&&!e.location.stopPlace||!i.location.geoPosition&&!i.location.stopPlace?null:new md(t,e,i,r,s,u)}buildRequestNode(){super.buildRequestNode();const e=(new Date).toISOString();this.serviceRequestNode.ele("siri:RequestTimestamp",e),this.serviceRequestNode.ele("siri:RequestorRef",this.buildRequestorRef());const i=this.serviceRequestNode.ele("OJPTripRequest");i.ele("siri:RequestTimestamp",e);const s="monomodal"===this.modeType,u=this.transportMode,m=["From","To"];m.forEach(A=>{var B,j,K,pe;const Se="From"===A,Xe=Se?this.fromTripLocation:this.toTripLocation,At=Xe.location,kt=i.ele(Se?"Origin":"Destination"),yn=kt.ele("PlaceRef");if(null!==(B=At.stopPlace)&&void 0!==B&&B.stopPlaceRef){const Si=null!==(j=At.locationName)&&void 0!==j?j:"n/a";let ci=null!==(pe=null===(K=At.stopPlace)||void 0===K?void 0:K.stopPlaceRef)&&void 0!==pe?pe:"";yn.ele("StopPlaceRef",ci),yn.ele("LocationName").ele("Text",Si)}else if(At.geoPosition){const Si=yn.ele("GeoPosition");Si.ele("siri:Longitude",At.geoPosition.longitude),Si.ele("siri:Latitude",At.geoPosition.latitude);const ci=At.geoPosition.asLatLngString();yn.ele("LocationName").ele("Text",ci)}const kn=this.departureDate.toISOString();if(Se?"Dep"===this.tripRequestBoardingType&&kt.ele("DepArrTime",kn):"Arr"===this.tripRequestBoardingType&&kt.ele("DepArrTime",kn),s){if(Se&&-1!==["walk","cycle"].indexOf(u)){const ci=kt.ele("IndividualTransportOptions");ci.ele("Mode",u),"walk"===u&&ci.ele("MaxDuration","PT3000M"),"cycle"===u&&ci.ele("MaxDuration","PT600M")}}else if(("taxi"===u||"others-drive-car"===u)&&(()=>!(Se&&"mode_at_end"===this.modeType||!Se&&"mode_at_start"===this.modeType))()){const no=kt.ele("IndividualTransportOptions");Xe.customTransportMode&&no.ele("Mode",Xe.customTransportMode),no.ele("MinDuration","PT"+Xe.minDuration+"M"),no.ele("MaxDuration","PT"+Xe.maxDuration+"M"),no.ele("MinDistance",Xe.minDistance),no.ele("MaxDistance",Xe.maxDistance)}});const y=i.ele("Params");if(y.ele(this.numberOfResultsType,5),y.ele("IncludeTrackSections",!0),y.ele("IncludeLegProjection",this.includeLegProjection),y.ele("IncludeTurnDescription",!0),y.ele("IncludeIntermediateStops",!0),s)-1!==["walk","self-drive-car","cycle","taxi","others-drive-car"].indexOf(u)&&y.ele("ItModesToCover",u),["car","car-ferry","car-shuttle-train","car_sharing","self-drive-car","others-drive-car"].includes(u)&&y.ele("ModeAndModeOfOperationFilter").ele("siri:WaterSubmode","localCarFerry"),-1!==["bicycle_rental","car_sharing","escooter_rental"].indexOf(u)&&y.ele("Extension").ele("ItModesToCover",u);else if("taxi"!==u&&"others-drive-car"!==u){const j=y.ele("Extension");m.forEach(K=>{const pe="From"===K;if(pe&&"mode_at_end"===this.modeType||!pe&&"mode_at_start"===this.modeType)return;const Se=pe?this.fromTripLocation:this.toTripLocation,At=j.ele(pe?"Origin":"Destination");At.ele("MinDuration","PT"+Se.minDuration+"M"),At.ele("MaxDuration","PT"+Se.maxDuration+"M"),At.ele("MinDistance",Se.minDistance),At.ele("MaxDistance",Se.maxDistance),Se.customTransportMode&&At.ele("Mode",Se.customTransportMode)})}y.ele("UseRealtimeData","explanatory")}}const Ih={key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"57c5dbbbf1fe4d00010000186ba6e4bb4be543a9b4e40d2d6495592b"};class KD{constructor(t){this.sourceType=t,this.countryRef=null,this.name=null,this.externalCode=null}static initWithSituationTreeNode(t){const e=t.findTextFromChildNamed("siri:Source/siri:SourceType");if(null===e)return console.log("ERROR - cant PtSituationSource.initFromSituationNode"),console.log(t),null;const i=new KD(e);return i.countryRef=t.findTextFromChildNamed("siri:Source/siri:CountryRef"),i.name=t.findTextFromChildNamed("siri:Source/siri:Name"),i.externalCode=t.findTextFromChildNamed("siri:Source/siri:ExternalCode"),i}}class Xl{constructor(t,e,i,r,s,u,m,y,C,I,A,B,j){this.situationNumber=t,this.creationTime=e,this.countryRef=i,this.participantRef=r,this.version=s,this.source=u,this.progress=m,this.validityPeriods=y,this.alertCause=C,this.priority=I,this.scopeType=A,this.publishingActions=B,this.isPlanned=j,this.situationContentV1=null,this.treeNode=null}static initWithSituationTreeNode(t){var e,i,r;const s=t.findTextFromChildNamed("siri:SituationNumber"),u=t.findTextFromChildNamed("siri:CreationTime");if(null===u)return console.error("ERROR - creationTimeS is null","PtSituationElement.initFromSituationNode"),console.log(t),null;const m=new Date(u),y=null!==(e=t.findTextFromChildNamed("siri:CountryRef"))&&void 0!==e?e:"n/a CountryRef",C=t.findTextFromChildNamed("siri:ParticipantRef"),I=t.findTextFromChildNamed("siri:Version");if(null===I)return console.error("ERROR - Version is NULL","PtSituationElement.initFromSituationNode"),console.log(t),null;const A=parseInt(I),B=KD.initWithSituationTreeNode(t),j=null!==(i=t.findTextFromChildNamed("siri:Progress"))&&void 0!==i?i:"n/a Progress",K=[];if(t.findChildrenNamed("siri:ValidityPeriod").forEach(ci=>{const no=ci.findTextFromChildNamed("siri:StartTime"),ts=ci.findTextFromChildNamed("siri:EndTime");if(!no||!ts)return;const gu={startDate:new Date(no),endDate:new Date(ts)};K.push(gu)}),0===K.length)return console.error("initFromSituationNode: EMPTY <ValidityPeriod>"),console.log(s),console.log(t),null;const Se=null!==(r=t.findTextFromChildNamed("siri:AlertCause"))&&void 0!==r?r:"n/a AlertCause",Xe=t.findTextFromChildNamed("siri:Priority");if(null===Xe)return console.error("ERROR - Priority is NULL","PtSituationElement.initFromSituationNode"),console.log(t),null;const At=parseInt(Xe),pt=(()=>{const ci=t.findTextFromChildNamed("siri:ScopeType");return"line"===ci||"route"===ci?"line":"stopPlace"===ci||"stopPoint"===ci?"stopPlace":"vehicleJourney"===ci?"vehicleJourney":null})();if(!(s&&y&&C&&B&&j&&Se&&pt))return console.error("ERROR - cant init","PtSituationElement.initFromSituationNode"),console.log(t),null;const yn="true"===t.findTextFromChildNamed("siri:Planned"),kn=Xl.computePublishingActionsFromSituationNode(s,pt,t),Si=new Xl(s,m,y,C,A,B,j,K,Se,At,pt,kn,yn);return Si.treeNode=t,Si.situationContentV1=this.computeSituationContentV1(t),0===Si.publishingActions.length&&null===Si.situationContentV1&&(console.error("PtSituationElement.initWithSituationTreeNode: empty actions, no metadata found"),console.log(t)),Si}static computePublishingActionsFromSituationNode(t,e,i){const r=[],s=i.findChildNamed("siri:PublishingActions");return null===s||s.findChildrenNamed("siri:PublishingAction").forEach(m=>{const y=Xl.computePublishingAction(t,e,m);if(null===y)return console.error("ERROR - cant compute PublishingAction","PtSituationElement.initFromSituationNode"),void console.log(m);r.push(y)}),r}static computePublishingAction(t,e,i){const r=i.findChildNamed("siri:PassengerInformationAction");if(null===r)return console.error("computePublishingAction: NO <PassengerInformationAction>"),console.log(t),console.log(i),null;const s=r.findTextFromChildNamed("siri:ActionRef"),u=r.findTextFromChildNamed("siri:OwnerRef"),m=[];r.findChildrenNamed("siri:Perspective").forEach(j=>{const K=j.text;K&&m.push(K)});const C=i.findChildNamed("siri:PassengerInformationAction/siri:TextualContent");let I={};return C&&(I={},C.children.forEach(j=>{const K=j.name.replace("siri:","").replace("Content","");if(K in I||(I[K]=[]),j.children.length>0){const pe=j.children[0].text;null!==pe&&I[K].push(pe.trim())}})),{affects:Xl.computeAffects(t,e,i),passengerInformation:{actionRef:s,ownerRef:u,perspectives:m,mapTextualContent:I}}}static computeAffects(t,e,i){const r=[],s=i.findChildNamed("siri:PublishAtScope/siri:Affects/siri:Networks/siri:AffectedNetwork");if(s&&s.findChildrenNamed("siri:AffectedLine").forEach(m=>{var y;const C=Xl.computeLineNetwork(m);if(null!==C&&("line"===e&&r.push({type:"entire-line",affect:C}),"stopPlace"===e)){const I=null!==(y=m.findTextFromChildNamed("siri:Direction/siri:DirectionRef"))&&void 0!==y?y:"n/a",A=m.findChildrenNamed("siri:StopPlaces/siri:AffectedStopPlace"),B=Xl.computeAffectedStopPlaces(A);r.push({type:"partial-line",affect:{lineNetwork:C,directionRef:I,stopPlaces:B}})}}),"stopPlace"===e){const u=i.findChildNamed("siri:PublishAtScope/siri:Affects/siri:StopPlaces");if(u){const m=u.findChildrenNamed("siri:AffectedStopPlace");Xl.computeAffectedStopPlaces(m).forEach(C=>{r.push({type:"stop",affect:C})})}}return"vehicleJourney"===e&&Xl.computeAffectedJourneys(t,i).forEach(m=>{r.push({type:"vehicle-journey",affect:m})}),r}static computeLineNetwork(t){const e=t.findTextFromChildNamed("siri:AffectedOperator/siri:OperatorRef"),i=t.findTextFromChildNamed("siri:LineRef"),r=t.findTextFromChildNamed("siri:PublishedLineName");if(null===e||null===i||null===r)return console.log("ERROR: LineNetwork cant init"),console.log(t),null;const s=t.findChildrenNamed("siri:StopPlaces/siri:AffectedStopPlace");return{operator:{operatorRef:e},lineRef:i,publishedLineName:r,stopPlaces:Xl.computeAffectedStopPlaces(s)}}static computeAffectedStopPlaces(t){const e=[];return t.forEach(i=>{const r=i.findTextFromChildNamed("siri:StopPlaceRef"),s=i.findTextFromChildNamed("siri:PlaceName");if(null===r||null===s)return console.log("ERROR: StopPlace cant init"),console.log(i),null;e.push({stopPlaceRef:r,placeName:s})}),e}static computeAffectedJourneys(t,e){const i=[];return e.findChildrenNamed("siri:PublishAtScope/siri:Affects/siri:VehicleJourneys/siri:AffectedVehicleJourney").forEach((s,u)=>{const m=s.findChildNamed("siri:FramedVehicleJourneyRef");if(null===m)return console.error("computeAffectedJourneys - NULL FramedVehicleJourneyRef"),console.log(t),void console.log(s);const y=m.findTextFromChildNamed("siri:DataFrameRef"),C=m.findTextFromChildNamed("siri:DatedVehicleJourneyRef");if(null===y||null===C)return console.error("computeAffectedJourneys - NULL FramedVehicleJourneyRef members"),console.log(t),void console.log(m);const I={dataFrameRef:y,datedVehicleJourneyRef:C},A=s.findTextFromChildNamed("siri:Operator/siri:OperatorRef");if(null===A)return console.error("computeAffectedJourneys - NULL operatorRef"),console.log(t),void console.log(s);let B=null;const j=s.findTextFromChildNamed("siri:Origins/siri:StopPlaceRef");null!==j&&(B={stopPlaceRef:j,placeName:s.findTextFromChildNamed("siri:Origins/siri:PlaceName")});let K=null;const pe=s.findTextFromChildNamed("siri:Destinations/siri:StopPlaceRef");null!==pe&&(K={stopPlaceRef:pe,placeName:s.findTextFromChildNamed("siri:Destinations/siri:PlaceName")});const Se=s.findChildrenNamed("siri:Calls/siri:Call"),Xe=[];Se.forEach(yn=>{const kn=yn.findTextFromChildNamed("siri:StopPlaceRef");null!==kn&&Xe.push(kn)});const At=s.findTextFromChildNamed("siri:LineRef"),pt=s.findTextFromChildNamed("siri:PublishedLineName");i.push({framedVehicleJourneyRef:I,operator:{operatorRef:A},origin:B,destination:K,callStopsRef:Xe,lineRef:At,publishedLineName:pt})}),i}isActive(t=new Date){var e;return null!==(null!==(e=this.validityPeriods.find(r=>r.startDate<t&&r.endDate>t))&&void 0!==e?e:null)}static computeSituationContentV1(t){const e=t.findTextFromChildNamed("siri:Summary");if(null===e)return console.error("ERROR: SituationContent.initFromSituationNode - empty summary"),console.log(t),null;const i=[];t.findChildrenNamed("siri:Description").forEach(y=>{const C=y.text;C&&i.push(C)});const s=[];return t.findChildrenNamed("siri:Detail").forEach(y=>{const C=y.text;C&&s.push(C)}),{summary:e,descriptions:i,details:s}}}class CW extends Vv{constructor(){super(),this.callback=null,this.trips=[],this.tripsNo=0,this.mapContextLocations={},this.mapContextSituations={}}reset(){this.trips=[],this.tripsNo=0,this.mapContextLocations={},this.mapContextSituations={}}parseXML(t){this.reset(),this.tripsNo=t.split("<TripResult>").length-1,0===this.tripsNo&&(this.tripsNo=t.split("<ojp:TripResult>").length-1),this.callback&&this.callback({trips:this.trips,tripsNo:this.tripsNo,message:"TripRequest.TripsNo"}),super.parseXML(t)}onCloseTag(t){if("Trip"===t&&"TripResult"===this.currentNode.parentName){const e=YD.initFromTreeNode(this.currentNode);e&&(e.legs.forEach(i=>{i.patchLocations(this.mapContextLocations),i.patchSituations(this.mapContextSituations)}),this.trips.push(e),this.callback&&this.callback({tripsNo:this.tripsNo,trips:this.trips,message:"TripRequest.Trip"}))}if("TripResponseContext"===t){const e=this.currentNode.findChildNamed("Places");e&&(this.mapContextLocations={},e.findChildrenNamed("Location").forEach(s=>{var u,m;const y=to.initWithTreeNode(s),C=null!==(m=null===(u=y.stopPlace)||void 0===u?void 0:u.stopPlaceRef)&&void 0!==m?m:null;null!==C&&(this.mapContextLocations[C]=y)}));const i=this.currentNode.findChildNamed("Situations");i&&(this.mapContextSituations={},i.findChildrenNamed("PtSituation").forEach(s=>{const u=Xl.initWithSituationTreeNode(s);u&&(this.mapContextSituations[u.situationNumber]=u)}))}}onEnd(){"DEBUG"===xS&&this.validateSituations(),this.callback&&this.callback({tripsNo:this.tripsNo,trips:this.trips,message:"TripRequest.DONE"})}validateSituations(){const t=Object.values(this.mapContextSituations);if(0===t.length)return;const e={};t.forEach(i=>{e[i.situationNumber]=!1}),this.trips.forEach(i=>{i.legs.forEach(r=>{"TimedLeg"===r.legType&&r.service.siriSituations.forEach(u=>{u.situationNumber in e?e[u.situationNumber]=!0:(console.error("TimedLeg has situation which can be found in context"),console.log(u.situationNumber),console.log(this.mapContextSituations),console.log("======================================================================"))})})});for(const i in e)!1===e[i]&&(console.error("Situation "+i+" cant be map to any of the trips"),console.log(this.mapContextSituations[i]),console.log(this.trips),console.log("======================================================================"));this.trips.forEach(i=>{i.legs.forEach(r=>{if("TimedLeg"!==r.legType)return;const s=r;s.service.siriSituationIds.forEach(u=>{u in e||(console.error("Situation "+u+" is in the <Trip> but cant be found in the context"),console.log(this.mapContextSituations),console.log(i),console.log(s),console.log("======================================================================"))})})})}}class Rc extends SS{constructor(t,e){super(t),this.requestParams=e,this.response=null,this.requestInfo.requestXML=this.buildRequestXML()}static initWithResponseMock(t){const e=md.Empty(),i=new Rc(Ih,e);return i.mockResponseXML=t,i}static initWithRequestMock(t,e=Ih){const i=md.Empty(),r=new Rc(e,i);return r.mockRequestXML=t,r}static initWithStopRefs(t,e,i,r,s=new Date,u="Dep"){const m=to.initWithStopPlaceRef(i),y=to.initWithStopPlaceRef(r),C=md.initWithLocationsAndDate(e,m,y,s,u);return null===C?null:new Rc(t,C)}static initWithLocationsAndDate(t,e,i,r,s,u="Dep"){const m=md.initWithLocationsAndDate(e,i,r,s,u);return null===m?null:new Rc(t,m)}static initWithTripLocationsAndDate(t,e,i,r,s,u="Dep",m="NumberOfResults"){const y=md.initWithTripLocationsAndDate(e,i,r,s,u,m);return null===y?null:new Rc(t,y)}buildRequestXML(){return this.requestParams.buildRequestXML()}fetchResponse(){var t=this;return Hv(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{t.parseTripRequestResponse(i)})})()}fetchResponseWithCallback(t){this.fetchOJPResponse().then(e=>{this.requestInfo=e,this.parseTripRequestResponse(t)})}parseTripRequestResponse(t){if(this.response=null,null!==this.requestInfo.error||null===this.requestInfo.responseXML){return void t({tripsNo:0,trips:[],message:"ERROR"})}const e=new CW;e.callback=i=>{"TripRequest.Trip"===i.message&&1===i.trips.length&&(this.requestInfo.parseDateTime=new Date),this.response=i,t(i)},e.parseXML(this.requestInfo.responseXML)}}class TW{constructor(t,e){this.stageConfig=t,this.requestParams=e,this.tripRequests=[],this.sections=[]}fetchResponse(t){const e=this.requestParams.departureDate;this.tripRequests=[],this.computeTripResponse(0,e,t)}computeTripResponse(t,e,i){const r=t===this.requestParams.tripModeTypes.length-1,m=md.initWithTripLocationsAndDate(this.requestParams.language,this.requestParams.tripLocations[t],this.requestParams.tripLocations[t+1],e,this.requestParams.tripRequestBoardingType);if(null===m)return void console.error("JourneyRequest - TripsRequestParams null for trip idx "+t);m.includeLegProjection=this.requestParams.includeLegProjection,m.numberOfResultsType=this.requestParams.numberOfResultsType,m.modeType=this.requestParams.tripModeTypes[t],m.transportMode=this.requestParams.transportModes[t];const y=new Rc(this.stageConfig,m);this.tripRequests.push(y),y.fetchResponseWithCallback(C=>{if("ERROR"!==C.message){if(t>this.sections.length-1&&this.sections.push(C),this.sections[t]=C,("TripRequest.TripsNo"===C.message||"TripRequest.Trip"===C.message)&&i({sections:this.sections,message:C.message,error:null}),"TripRequest.DONE"===C.message){if(!(C.trips.length>0))return void i({sections:this.sections,message:"JourneyRequest.DONE",error:null});r?i({sections:this.sections,message:"JourneyRequest.DONE",error:null}):this.computeTripResponse(t+1,e=C.trips[0].stats.endDatetime,i)}}else i({sections:this.sections,message:"ERROR",error:{error:"ParseTripsXMLError",message:"TODO - handle this"}})})}}class QD{constructor(t,e,i,r,s,u,m){this.tripLocations=e,this.tripModeTypes=i,this.transportModes=r,this.departureDate=s,this.includeLegProjection=!0,this.tripRequestBoardingType=u,this.numberOfResultsType=m,this.language=t}static initWithLocationsAndDate(t,e,i,r,s,u,m,y,C){if(null===e||null===i)return null;if(!e.location.geoPosition&&!e.location.stopPlace||!i.location.geoPosition&&!i.location.stopPlace)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken from, to"),console.log(e),console.log(i),null;let I=!1;if(r.forEach(j=>{null===j.location.geoPosition&&(I=!0)}),I)return console.error("JourneyRequestParams.initWithLocationsAndDate - broken via"),console.log(r),null;if(r.length+1!==s.length)return console.error("JourneyRequestParams.initWithLocationsAndDate - wrong via/mot types"),console.log(r),console.log(s),null;let A=[];return A.push(e),A=A.concat(r),A.push(i),new QD(t,A,s,u,m,y,C)}}class EW extends Vv{constructor(){super(),this.callback=null,this.locations=[]}parseXML(t){this.locations=[],super.parseXML(t)}onCloseTag(t){if("Location"===t&&"OJPLocationInformationDelivery"===this.currentNode.parentName){const e=to.initWithLocationResultTreeNode(this.currentNode);e&&this.locations.push(e)}}onError(t){console.error("ERROR: SAX parser"),console.log(t),this.callback&&this.callback({locations:this.locations,message:"ERROR"})}onEnd(){this.callback&&this.callback({locations:this.locations,message:"LocationInformation.DONE"})}}class fu extends IS{constructor(t){super(t),this.locationName=null,this.stopPlaceRef=null,this.restrictionTypes=[],this.poiRestriction=null,this.numberOfResults=null,this.bboxWest=null,this.bboxNorth=null,this.bboxEast=null,this.bboxSouth=null,this.circleCenter=null,this.circleRadius=null}static initWithLocationName(t,e,i=null,r=10){const s=new fu(t);return s.locationName=e,s.numberOfResults=r,null!==i&&(s.restrictionTypes=i),s}static initWithStopPlaceRef(t,e){const i=new fu(t);return i.stopPlaceRef=e,i}static initWithBBOXAndType(t,e,i,r,s,u,m=1e3,y=null){const C=new fu(t);return C.bboxWest=e,C.bboxNorth=i,C.bboxEast=r,C.bboxSouth=s,C.numberOfResults=m,C.restrictionTypes=u,C.poiRestriction=y,C}static initWithCircleLngLatRadius(t,e,i,r,s=[],u=1e3){const m=new fu(t);return m.circleCenter=new Wr(e,i),m.circleRadius=r,m.restrictionTypes=s,m.numberOfResults=u,m}buildRequestNode(){var t,e,i,r,s,u,m;super.buildRequestNode();const C=(new Date).toISOString();this.serviceRequestNode.ele("siri:RequestTimestamp",C),this.serviceRequestNode.ele("siri:RequestorRef",this.buildRequestorRef());const I=this.serviceRequestNode.ele("OJPLocationInformationRequest");I.ele("siri:RequestTimestamp",C);const A=null!==(t=this.locationName)&&void 0!==t?t:null;null!==A&&I.ele("InitialInput").ele("LocationName",A);const B=null!==(e=this.stopPlaceRef)&&void 0!==e?e:null;if(B){const kt=I.ele("PlaceRef");kt.ele("StopPlaceRef",B),kt.ele("LocationName").ele("Text","n/a")}const j=null!==(i=this.bboxWest)&&void 0!==i?i:null,K=null!==(r=this.bboxNorth)&&void 0!==r?r:null,pe=null!==(s=this.bboxEast)&&void 0!==s?s:null,Se=null!==(u=this.bboxSouth)&&void 0!==u?u:null;if(j&&K&&pe&&Se){const kt=I.ele("InitialInput").ele("GeoRestriction").ele("Rectangle"),yn=kt.ele("UpperLeft");yn.ele("siri:Longitude",j.toFixed(6)),yn.ele("siri:Latitude",K.toFixed(6));const kn=kt.ele("LowerRight");kn.ele("siri:Longitude",pe.toFixed(6)),kn.ele("siri:Latitude",Se.toFixed(6))}if(null!==this.circleCenter&&null!==this.circleRadius){const kt=I.ele("InitialInput").ele("GeoRestriction").ele("Circle"),yn=kt.ele("Center");yn.ele("siri:Longitude",this.circleCenter.longitude.toFixed(6)),yn.ele("siri:Latitude",this.circleCenter.latitude.toFixed(6)),kt.ele("Radius",this.circleRadius)}const Xe=I.ele("Restrictions");this.restrictionTypes.forEach(kt=>{if(Xe.ele("Type",kt),"poi"===kt&&this.poiRestriction){const kn=Xe.ele("PointOfInterestFilter").ele("PointOfInterestCategory"),ci="shared_mobility"===this.poiRestriction.poiType?"amenity":"POI";this.poiRestriction.tags.forEach(no=>{const ts=kn.ele("OsmTag");ts.ele("Tag",ci),ts.ele("Value",no)})}});const At=null!==(m=this.numberOfResults)&&void 0!==m?m:10;Xe.ele("NumberOfResults",At),I.ele("siri:Extensions").ele("ParamsExtension").ele("PrivateModeFilter").ele("Exclude","false")}}class el extends SS{constructor(t,e){super(t),this.requestParams=e,this.requestInfo.requestXML=this.buildRequestXML()}static initWithResponseMock(t){const e=new fu("en"),i=new el(Ih,e);return i.mockResponseXML=t,i}static initWithRequestMock(t,e=Ih){const i=new fu("en"),r=new el(e,i);return r.mockRequestXML=t,r}static initWithLocationName(t,e,i,r,s=10){const u=fu.initWithLocationName(e,i,r,s);return new el(t,u)}static initWithStopPlaceRef(t,e,i){const r=fu.initWithStopPlaceRef(e,i);return new el(t,r)}static initWithCircleLngLatRadius(t,e,i,r,s,u=[],m=1e3){const y=fu.initWithCircleLngLatRadius(e,i,r,s,u,m);return new el(t,y)}static initWithBBOXAndType(t,e,i,r,s,u,m,y=1e3,C=null){const I=fu.initWithBBOXAndType(e,i,r,s,u,m,y,C);return new el(t,I)}buildRequestXML(){return this.requestParams.buildRequestXML()}fetchResponse(){var t=this;return Hv(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{const r={locations:[],message:null};if(null!==t.requestInfo.error||null===t.requestInfo.responseXML)return r.message="ERROR",void i(r);const s=new EW;s.callback=({locations:u,message:m})=>{r.locations=u,r.message=m,"LocationInformation.DONE"===m&&(t.requestInfo.parseDateTime=new Date),i(r)},s.parseXML(t.requestInfo.responseXML)})})()}fetchLocations(){var t=this;return Hv(function*(){const e=yield t.fetchResponse();return new Promise(r=>{"LocationInformation.DONE"===e.message&&r(e.locations)})})()}}class MS extends IS{constructor(t,e,i,r,s){super(t),this.stopPlaceRef=e,this.geoPosition=i,this.depArrTime=s,this.numberOfResults=10,this.stopEventType=r,this.includePreviousCalls=!1,this.includeOnwardCalls=!1,this.includeRealtimeData=!0}static Empty(){return new MS("en",null,null,"departure",new Date)}buildRequestNode(){super.buildRequestNode();const t=(new Date).toISOString(),e=this.depArrTime.toISOString();this.serviceRequestNode.ele("siri:RequestTimestamp",t),this.serviceRequestNode.ele("siri:RequestorRef",this.buildRequestorRef());const i=this.serviceRequestNode.ele("OJPStopEventRequest");i.ele("siri:RequestTimestamp",t);const r=i.ele("Location");if(this.stopPlaceRef){const m=r.ele("PlaceRef");m.ele("StopPlaceRef",this.stopPlaceRef),m.ele("LocationName").ele("Text","")}r.ele("DepArrTime",e);const s=i.ele("Params");s.ele("NumberOfResults",this.numberOfResults),s.ele("StopEventType",this.stopEventType),s.ele("IncludePreviousCalls",this.includePreviousCalls),s.ele("IncludeOnwardCalls",this.includeOnwardCalls),s.ele("IncludeRealtimeData",this.includeRealtimeData),i.ele("siri:Extensions").ele("ParamsExtension").ele("PrivateModeFilter").ele("Exclude","false")}}class DW extends Vv{constructor(){super(),this.callback=null,this.stopEvents=[],this.mapContextLocations={},this.mapContextSituations={}}reset(){this.stopEvents=[],this.mapContextLocations={},this.mapContextSituations={}}parseXML(t){this.reset(),super.parseXML(t)}onCloseTag(t){if("StopEventResult"===t){const e=$D.initWithTreeNode(this.currentNode);e&&(e.patchStopEventLocations(this.mapContextLocations),e.stopPoint.patchSituations(this.mapContextSituations),this.stopEvents.push(e))}if("StopEventResponseContext"===t){const e=this.currentNode.findChildNamed("Places");e&&(this.mapContextLocations={},e.findChildrenNamed("Location").forEach(s=>{var u,m;const y=to.initWithTreeNode(s),C=null!==(m=null===(u=y.stopPlace)||void 0===u?void 0:u.stopPlaceRef)&&void 0!==m?m:null;null!==C&&(this.mapContextLocations[C]=y)}));const i=this.currentNode.findChildNamed("Situations");i&&(this.mapContextSituations={},i.findChildrenNamed("PtSituation").forEach(s=>{const u=Xl.initWithSituationTreeNode(s);u&&(this.mapContextSituations[u.situationNumber]=u)}))}}onEnd(){"DEBUG"===xS&&this.validateSituations(),this.callback&&this.callback({stopEvents:this.stopEvents,message:"StopEvent.DONE"})}validateSituations(){const t=Object.values(this.mapContextSituations);if(0===t.length)return;const e={};t.forEach(i=>{e[i.situationNumber]=!1}),this.stopEvents.forEach(i=>{i.stopPoint.siriSituations.forEach(r=>{r.situationNumber in e?e[r.situationNumber]=!0:(console.error("StopPoint has situation which can be found in context"),console.log(r.situationNumber),console.log(this.mapContextSituations),console.log("======================================================================"))})});for(const i in e)!1===e[i]&&(console.error("Situation "+i+" cant be map to any of the stop events"),console.log(this.mapContextSituations[i]),console.log(this.stopEvents),console.log("======================================================================"));this.stopEvents.forEach(i=>{i.stopPoint.siriSituationIds.forEach(r=>{r in e||(console.error("Situation "+r+" is in the stopEvent but cant be found in the context"),console.log(this.mapContextSituations),console.log(i.stopPoint),console.log("======================================================================"))})})}}class Mh extends SS{constructor(t,e){e.includePreviousCalls=!0,e.includeOnwardCalls=!0,super(t),this.requestParams=e,this.requestInfo.requestXML=this.buildRequestXML()}static Empty(t=Ih){const e=MS.Empty();return new Mh(t,e)}static initWithMock(t){const e=Mh.Empty();return e.mockResponseXML=t,e}static initWithRequestMock(t,e=Ih){const i=Mh.Empty(e);return i.mockRequestXML=t,i}static initWithStopPlaceRef(t,e,i,r,s){const u=new MS(e,i,null,r,s);return new Mh(t,u)}buildRequestXML(){return this.requestParams.buildRequestXML()}fetchResponse(){var t=this;return Hv(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{const r={stopEvents:[],message:null};if(null!==t.requestInfo.error||null===t.requestInfo.responseXML)return r.message="ERROR",void i(r);const s=new DW;s.callback=({stopEvents:u,message:m})=>{r.stopEvents=u,r.message=m,"StopEvent.DONE"===m&&(t.requestInfo.parseDateTime=new Date,i(r))},s.parseXML(t.requestInfo.responseXML)})})()}}class AS extends IS{constructor(t,e,i){super(t),this.journeyRef=e,this.operatingDayRef=i}static Empty(){return new AS("en","n/a","n/a")}buildRequestNode(){super.buildRequestNode();const t=(new Date).toISOString();this.serviceRequestNode.ele("siri:RequestTimestamp",t),this.serviceRequestNode.ele("siri:RequestorRef",this.buildRequestorRef());const e=this.serviceRequestNode.ele("OJPTripInfoRequest");e.ele("siri:RequestTimestamp",t),e.ele("JourneyRef",this.journeyRef),e.ele("OperatingDayRef",this.operatingDayRef);const i=e.ele("Params");i.ele("IncludeCalls",!0),i.ele("IncludeService",!0)}}class IW extends Vv{constructor(){super(),this.callback=null,this.tripInfoResult=null,this.mapContextLocations={},this.mapContextSituations={}}reset(){this.tripInfoResult=null,this.mapContextLocations={},this.mapContextSituations={}}parseXML(t){this.reset(),super.parseXML(t)}onCloseTag(t){if("TripInfoResult"===t){const e=ZD.initFromTreeNode(this.currentNode);e&&e.patchLocations(this.mapContextLocations),this.tripInfoResult=e}if("TripInfoResponseContext"===t){const e=this.currentNode.findChildNamed("Places");e&&(this.mapContextLocations={},e.findChildrenNamed("Location").forEach(s=>{var u,m;const y=to.initWithTreeNode(s),C=null!==(m=null===(u=y.stopPlace)||void 0===u?void 0:u.stopPlaceRef)&&void 0!==m?m:null;null!==C&&(this.mapContextLocations[C]=y)}));const i=this.currentNode.findChildNamed("Situations");i&&(this.mapContextSituations={},i.findChildrenNamed("PtSituation").forEach(s=>{const u=Xl.initWithSituationTreeNode(s);u&&(this.mapContextSituations[u.situationNumber]=u)}))}}onEnd(){this.callback&&this.callback({tripInfoResult:this.tripInfoResult,message:"TripInfoRequest.DONE"})}}class gd extends SS{constructor(t,e){super(t),this.requestParams=e,this.requestInfo.requestXML=this.buildRequestXML()}static Empty(t=Ih){const e=AS.Empty();return new gd(t,e)}static initWithMock(t){const e=gd.Empty();return e.mockResponseXML=t,e}static initWithRequestMock(t,e=Ih){const i=gd.Empty(e);return i.mockRequestXML=t,i}static initWithJourneyRef(t,e,i,r=null){null===r&&(r=(new Date).toISOString().substring(0,10));const s=new AS(e,i,r);return new gd(t,s)}buildRequestXML(){return this.requestParams.buildRequestXML()}fetchResponse(){var t=this;return Hv(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{const r={tripInfoResult:null,message:null};if(null!==t.requestInfo.error||null===t.requestInfo.responseXML)return r.message="ERROR",void i(r);const s=new IW;s.callback=({tripInfoResult:u,message:m})=>{r.tripInfoResult=u,r.message=m,"TripInfoRequest.DONE"===m&&(t.requestInfo.parseDateTime=new Date,i(r))},s.parseXML(t.requestInfo.responseXML)})})()}}class MW{constructor(t){this.trips=t}asXML(){const t=nF.create("siri:OJP",{version:"1.0",encoding:"utf-8"});t.att("xmlns:ojp","http://www.vdv.de/ojp"),t.att("xmlns:siri","http://www.siri.org.uk/siri"),t.att("version","1.0");const e=t.ele("siri:OJPResponse").ele("siri:ServiceDelivery").ele("ojp:OJPTripDelivery");return this.trips.forEach(r=>{const s=e.ele("ojp:TripResult");s.ele("ojp:ResultId",r.id),r.addToXMLNode(s)}),e.end({pretty:!0})}}const Zp={app_stages:[{key:"PROD",apiEndpoint:"https://api.opentransportdata.swiss/ojp2020",authBearerKey:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6Ijk0YTFhNjExYjM5ZjQ4MWNiMGI5MjFiNTgyNmM1ZGFjIiwiaCI6Im11cm11cjEyOCJ9"},{key:"INT",apiEndpoint:"https://odpch-api.clients.liip.ch/ojp-passiv-int",authBearerKey:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImJkOTNmYzA1ZGMwYzQwM2Q4MWYzMmFhNWMxNWZjMjU2IiwiaCI6Im11cm11cjEyOCJ9"},{key:"TEST",apiEndpoint:"https://odpch-api.clients.liip.ch/ojp-test",authBearerKey:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImZlYWJiMjEzZDcyZTRhYmM5N2RhYWJiZDM5YWZmZWIwIiwiaCI6Im11cm11cjEyOCJ9"},{key:"LA Beta",apiEndpoint:"https://api.opentransportdata.swiss/ojp-la-aktiv",authBearerKey:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6ImE5ZDFkYmI4YWVjMDRiYjFiZjA2ZmUyNmZmZTk2YTY2IiwiaCI6Im11cm11cjEyOCJ9"}],map_app_map_layers:{stops:{LIR_Restriction_Type:"stop",minZoom:13,layer_ids:["stops-circle","stops-label"],click_layer_ids:"SAME_AS_LAYER_IDS"},addresses:{LIR_Restriction_Type:"address",minZoom:17,layer_ids:["address-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_cars:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["car_sharing"]},minZoom:12,layer_ids:["car-rental-icon","car-rental-text-number","car-rental-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_bicycles:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["bicycle_rental"]},minZoom:14,layer_ids:["bike-icon","bike-text-number","bike-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_scooters:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["escooter_rental"]},minZoom:14,layer_ids:["scooter-icon","scooter-text-number","scooter-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},charging_stations:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["charging_station"]},minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sbb_services:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["sbb_services"]},minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},pois_other:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["other"]},minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},"pois-ALL":{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"poi",tags:["service","shopping","leisure","catering","public","parkride","accommodation"]},minZoom:16,layer_ids:["poi-all"],click_layer_ids:"SAME_AS_LAYER_IDS"}}};var AW=We(9898),ks=We.n(AW);class Yp{static formatMapboxLngLatAsLatLng(t){return t.lat.toFixed(6)+","+t.lng.toFixed(6)}static computePointLngLatFromFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates;return ks().LngLat.convert(e)}static bboxPxFromLngLatWidthPx(t,e,i,r=null){null===r&&(r=i);const s=t.project(e);return[[s.x-i/2,s.y+r/2],[s.x+i/2,s.y-r/2]]}static areBoundsInsideOtherBounds(t,e){return!(t.getWest()<e.getWest()||t.getNorth()>e.getNorth()||t.getEast()>e.getEast()||t.getSouth()<e.getSouth())}static queryNearbyFeaturesByLayerIDs(t,e,i){const r=Yp.bboxPxFromLngLatWidthPx(t,e,30),s=t.queryRenderedFeatures(r,{layers:i});let u=[],m=null;return s.forEach(y=>{const C=Yp.computePointLngLatFromFeature(y);if(null===C)return;const I=Math.round(e.distanceTo(C));null!==m&&I>m||(m=I,u.push({feature:y,distance:I}))}),u.sort((y,C)=>y.distance-C.distance),u}}class JD{constructor(t){this.map=t,this.container=null,this.debugCenterEl=null,this.debugZoomEl=null}onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",this.container.innerHTML=document.getElementById("map-debug-control").innerHTML,t.on("move",()=>{this.updateDebugCenter()}),t.on("zoom",()=>{this.updateDebugZoom()}),setTimeout(()=>{this.debugCenterEl=document.getElementById("map_debug_center"),this.debugZoomEl=document.getElementById("map_debug_zoom"),this.updateDebugZoom(),this.updateDebugCenter()},200),this.container}onRemove(){this.map=null,this.container=null}updateDebugZoom(){!this.map||!this.debugZoomEl||(this.debugZoomEl.innerText=this.map.getZoom().toFixed(2).toString())}updateDebugCenter(){if(!this.map||!this.debugCenterEl)return;const t=this.map.getCenter().toArray().map(e=>e.toFixed(6));this.debugCenterEl.innerText=t.join(",")}}class iF{static prettyPrintXML(t){var e=(new DOMParser).parseFromString(t,"application/xml"),i=(new DOMParser).parseFromString(['<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">','  <xsl:strip-space elements="*"/>','  <xsl:template match="para[content-style][not(text())]">','    <xsl:value-of select="normalize-space(.)"/>',"  </xsl:template>",'  <xsl:template match="node()|@*">','    <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',"  </xsl:template>",'  <xsl:output indent="yes"/>',"</xsl:stylesheet>"].join("\n"),"application/xml");try{var r=new XSLTProcessor;r.importStylesheet(i);var s=r.transformToDocument(e);return(new XMLSerializer).serializeToString(s)}catch(m){return console.error("XML_Helpers.prettyPrintXML - fails, see TODO"),t}}}const rF=rq();class kW{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=fs(-this._previousScrollPosition.left),t.style.top=fs(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,s=i.scrollBehavior||"",u=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),rF&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),rF&&(i.scrollBehavior=s,r.scrollBehavior=u)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class RW{constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class oF{enable(){}disable(){}attach(){}}function eI(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function sF(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class PW{constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();eI(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let LW=(()=>{class n{constructor(e,i,r,s){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new oF,this.close=u=>new RW(this._scrollDispatcher,this._ngZone,this._viewportRuler,u),this.block=()=>new kW(this._viewportRuler,this._document),this.reposition=u=>new PW(this._scrollDispatcher,this._viewportRuler,this._ngZone,u),this._document=s}}return n.\u0275fac=function(e){return new(e||n)(je(PO),je(pu),je(Xn),je(Gn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class Fm{constructor(t){if(this.scrollStrategy=new oF,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class OW{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}class Kp{constructor(t,e,i,r,s,u,m,y,C,I=!1){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=u,this._document=m,this._location=y,this._outsideClickDispatcher=C,this._animationsDisabled=I,this._backdropElement=null,this._backdropClick=new Kt,this._attachments=new Kt,this._detachments=new Kt,this._locationChanges=ie.EMPTY,this._backdropClickHandler=A=>this._backdropClick.next(A),this._backdropTransitionendHandler=A=>{this._disposeBackdrop(A.target)},this._keydownEvents=new Kt,this._outsidePointerEvents=new Kt,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(jr(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof(null==e?void 0:e.onDestroy)&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){var t;const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(t=this._host)||void 0===t||t.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=fs(this._config.width),t.height=fs(this._config.height),t.minWidth=fs(this._config.minWidth),t.minHeight=fs(this._config.minHeight),t.maxWidth=fs(this._config.maxWidth),t.maxHeight=fs(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),this._animationsDisabled||"undefined"==typeof requestAnimationFrame?this._backdropElement.classList.add(t):this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})})}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,i){const r=oS(e||[]).filter(s=>!!s);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Oi(Er(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let r_=(()=>{class n{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){var e;null===(e=this._containerElement)||void 0===e||e.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||dD()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(e),dD()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(e){return new(e||n)(je(Gn),je(ps))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const aF="cdk-overlay-connected-position-bounding-box",FW=/([A-Za-z%]+)$/;class NW{constructor(t,e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Kt,this._resizeSubscription=ie.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(aF),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let u;for(let m of this._preferredPositions){let y=this._getOriginPoint(t,r,m),C=this._getOverlayPoint(y,e,m),I=this._getOverlayFit(C,e,i,m);if(I.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(m,y);this._canFitWithFlexibleDimensions(I,C,i)?s.push({position:m,origin:y,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(y,m)}):(!u||u.overlayFit.visibleArea<I.visibleArea)&&(u={overlayFit:I,overlayPoint:C,originPoint:y,position:m,overlayRect:e})}if(s.length){let m=null,y=-1;for(const C of s){const I=C.boundingBoxRect.width*C.boundingBoxRect.height*(C.position.weight||1);I>y&&(y=I,m=C)}return this._isPushed=!1,void this._applyPosition(m.position,m.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(u.position,u.originPoint);this._applyPosition(u.position,u.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Nm(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(aF),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let r,s;if("center"==i.originX)r=t.left+t.width/2;else{const u=this._isRtl()?t.right:t.left,m=this._isRtl()?t.left:t.right;r="start"==i.originX?u:m}return e.left<0&&(r-=e.left),s="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,e.top<0&&(s-=e.top),{x:r,y:s}}_getOverlayPoint(t,e,i){let r,s;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,s="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+r,y:t.y+s}}_getOverlayFit(t,e,i,r){const s=cF(e);let{x:u,y:m}=t,y=this._getOffset(r,"x"),C=this._getOffset(r,"y");y&&(u+=y),C&&(m+=C);let B=0-m,j=m+s.height-i.height,K=this._subtractOverflows(s.width,0-u,u+s.width-i.width),pe=this._subtractOverflows(s.height,B,j),Se=K*pe;return{visibleArea:Se,isCompletelyWithinViewport:s.width*s.height===Se,fitsInViewportVertically:pe===s.height,fitsInViewportHorizontally:K==s.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,s=i.right-e.x,u=lF(this._overlayRef.getConfig().minHeight),m=lF(this._overlayRef.getConfig().minWidth),C=t.fitsInViewportHorizontally||null!=m&&m<=s;return(t.fitsInViewportVertically||null!=u&&u<=r)&&C}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=cF(e),s=this._viewportRect,u=Math.max(t.x+r.width-s.width,0),m=Math.max(t.y+r.height-s.height,0),y=Math.max(s.top-i.top-t.y,0),C=Math.max(s.left-i.left-t.x,0);let I=0,A=0;return I=r.width<=s.width?C||-u:t.x<this._viewportMargin?s.left-i.left-t.x:0,A=r.height<=s.height?y||-m:t.y<this._viewportMargin?s.top-i.top-t.y:0,this._previousPushAmount={x:I,y:A},{x:t.x+I,y:t.y+A}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new OW(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let s=0;s<e.length;s++)e[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,r=this._isRtl();let s,u,m,I,A,B;if("top"===e.overlayY)u=t.y,s=i.height-u+this._viewportMargin;else if("bottom"===e.overlayY)m=i.height-t.y+2*this._viewportMargin,s=i.height-m+this._viewportMargin;else{const j=Math.min(i.bottom-t.y+i.top,t.y),K=this._lastBoundingBoxSize.height;s=2*j,u=t.y-j,s>K&&!this._isInitialRender&&!this._growAfterOpen&&(u=t.y-K/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)B=i.width-t.x+this._viewportMargin,I=t.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)A=t.x,I=i.right-t.x;else{const j=Math.min(i.right-t.x+i.left,t.x),K=this._lastBoundingBoxSize.width;I=2*j,A=t.x-j,I>K&&!this._isInitialRender&&!this._growAfterOpen&&(A=t.x-K/2)}return{top:u,left:A,bottom:m,right:B,width:I,height:s}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,u=this._overlayRef.getConfig().maxWidth;r.height=fs(i.height),r.top=fs(i.top),r.bottom=fs(i.bottom),r.width=fs(i.width),r.left=fs(i.left),r.right=fs(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=fs(s)),u&&(r.maxWidth=fs(u))}this._lastBoundingBoxSize=i,Nm(this._boundingBox.style,r)}_resetBoundingBoxStyles(){Nm(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Nm(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,u=this._overlayRef.getConfig();if(r){const I=this._viewportRuler.getViewportScrollPosition();Nm(i,this._getExactOverlayY(e,t,I)),Nm(i,this._getExactOverlayX(e,t,I))}else i.position="static";let m="",y=this._getOffset(e,"x"),C=this._getOffset(e,"y");y&&(m+=`translateX(${y}px) `),C&&(m+=`translateY(${C}px)`),i.transform=m.trim(),u.maxHeight&&(r?i.maxHeight=fs(u.maxHeight):s&&(i.maxHeight="")),u.maxWidth&&(r?i.maxWidth=fs(u.maxWidth):s&&(i.maxWidth="")),Nm(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=fs(s.y),r}_getExactOverlayX(t,e,i){let u,r={left:"",right:""},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),u=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===u?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=fs(s.x),r}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:sF(t,i),isOriginOutsideView:eI(t,i),isOverlayClipped:sF(e,i),isOverlayOutsideView:eI(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&oS(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof En)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function Nm(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function lF(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split(FW);return e&&"px"!==e?null:parseFloat(t)}return n||null}function cF(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const uF="cdk-global-overlay-wrapper";class BW{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(uF),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:u,maxHeight:m}=i,y=!("100%"!==r&&"100vw"!==r||u&&"100%"!==u&&"100vw"!==u),C=!("100%"!==s&&"100vh"!==s||m&&"100%"!==m&&"100vh"!==m),I=this._xPosition,A=this._xOffset,B="rtl"===this._overlayRef.getConfig().direction;let j="",K="",pe="";y?pe="flex-start":"center"===I?(pe="center",B?K=A:j=A):B?"left"===I||"end"===I?(pe="flex-end",j=A):("right"===I||"start"===I)&&(pe="flex-start",K=A):"left"===I||"start"===I?(pe="flex-start",j=A):("right"===I||"end"===I)&&(pe="flex-end",K=A),t.position=this._cssPosition,t.marginLeft=y?"0":j,t.marginTop=C?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=y?"0":K,e.justifyContent=pe,e.alignItems=C?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(uF),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let zW=(()=>{class n{constructor(e,i,r,s){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new BW}flexibleConnectedTo(e){return new NW(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(je(pu),je(Gn),je(ps),je(r_))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),dF=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(je(Gn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),VW=(()=>{class n extends dF{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let u=s.length-1;u>-1;u--)if(s[u]._keydownEvents.observers.length>0){const m=s[u]._keydownEvents;this._ngZone?this._ngZone.run(()=>m.next(r)):m.next(r);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(je(Gn),je(Xn,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),jW=(()=>{class n extends dF{constructor(e,i,r){super(e),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=Hp(s)},this._clickListener=s=>{const u=Hp(s),m="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:u;this._pointerDownEventTarget=null;const y=this._attachedOverlays.slice();for(let C=y.length-1;C>-1;C--){const I=y[C];if(I._outsidePointerEvents.observers.length<1||!I.hasAttached())continue;if(I.overlayElement.contains(u)||I.overlayElement.contains(m))break;const A=I._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>A.next(s)):A.next(s)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(e){return new(e||n)(je(Gn),je(ps),je(Xn,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),UW=0,jo=(()=>{class n{constructor(e,i,r,s,u,m,y,C,I,A,B,j){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=u,this._injector=m,this._ngZone=y,this._document=C,this._directionality=I,this._location=A,this._outsideClickDispatcher=B,this._animationsModuleType=j}create(e){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),u=new Fm(e);return u.direction=u.direction||this._directionality.value,new Kp(s,i,r,u,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+UW++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(Lb)),new Jq(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(je(LW),je(r_),je(eh),je(zW),je(VW),je(Nr),je(Xn),je(Gn),je(qp),je(zx),je(jW),je(rd,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();const HW=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],hF=new It("cdk-connected-overlay-scroll-strategy");let pF=(()=>{class n{constructor(e){this.elementRef=e}}return n.\u0275fac=function(e){return new(e||n)(H(En))},n.\u0275dir=Bt({type:n,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),n})(),fF=(()=>{class n{constructor(e,i,r,s,u){this._overlay=e,this._dir=u,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=ie.EMPTY,this._attachSubscription=ie.EMPTY,this._detachSubscription=ie.EMPTY,this._positionSubscription=ie.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new tn,this.positionChange=new tn,this.attach=new tn,this.detach=new tn,this.overlayKeydown=new tn,this.overlayOutsideClick=new tn,this._templatePortal=new Pm(i,r),this._scrollStrategyFactory=s,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=Hn(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=Hn(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=Hn(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=Hn(e)}get push(){return this._push}set push(e){this._push=Hn(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=HW);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!ca(i)&&(i.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{this.overlayOutsideClick.next(i)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),i=new Fm({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(e){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return e.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(e),e}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof pF?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(Y2(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(H(jo),H(eo),H(zo),H(hF),H(qp,8))},n.\u0275dir=Bt({type:n,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[hr]}),n})();const qW={provide:hF,deps:[jo],useFactory:function $W(n){return()=>n.scrollStrategies.reposition()}};let Cl=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[jo,qW],imports:[hS,ua,DD,DD]}),n})();function GW(n,t){}function WW(n,t){}function XW(n,t){1&n&&(X(0,"button",1),en(1,"sbb-icon",2),Y()),2&n&&Le("aria-label",St().closeAriaLabel)}const ZW=["*"];class kS{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let mF=(()=>{class n extends Ov{constructor(e,i,r,s,u,m,y,C){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=u,this._ngZone=m,this._overlayRef=y,this._focusMonitor=C,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=I=>{this._portalOutlet.hasAttached();const A=this._portalOutlet.attachDomPortal(I);return this._contentAttached(),A},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=du(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=du();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=du())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Jb),H(Gn,8),H(kS),H(km),H(Xn),H(Kp),H(xa))},n.\u0275cmp=mn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&cr(hd,7),2&e){let r;Fn(r=Nn())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&fn("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Xt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&ft(0,GW,0,0,"ng-template",0)},dependencies:[hd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class tI{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new Kt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!ca(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const gF=new It("DialogScrollStrategy"),YW=new It("DialogData"),KW=new It("DefaultDialogConfig"),JW={provide:gF,deps:[jo],useFactory:function QW(n){return()=>n.scrollStrategies.block()}};let e7=0,bF=(()=>{class n{constructor(e,i,r,s,u,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=u,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Kt,this._afterOpenedAtThisLevel=new Kt,this._ariaHiddenElements=new Map,this.afterAllClosed=xm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(As(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new kS;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+e7++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),u=this._overlay.create(s),m=new tI(u,i),y=this._attachContainer(u,m,i);return m.containerInstance=y,this._attachDialogContent(e,m,y,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){nI(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){nI(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),nI(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new Fm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s;const u=r.injector||(null===(s=r.viewContainerRef)||void 0===s?void 0:s.injector),m=[{provide:kS,useValue:r},{provide:tI,useValue:i},{provide:Kp,useValue:e}];let y;r.container?"function"==typeof r.container?y=r.container:(y=r.container.type,m.push(...r.container.providers(r))):y=mF;const C=new dd(y,r.viewContainerRef,Nr.create({parent:u||this._injector,providers:m}),r.componentFactoryResolver);return e.attach(C).instance}_attachDialogContent(e,i,r,s){if(e instanceof eo){const u=this._createInjector(s,i,r,void 0);let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new Pm(e,null,m,u))}else{const u=this._createInjector(s,i,r,this._injector),m=r.attachComponentPortal(new dd(e,s.viewContainerRef,u,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r,s){var u;const m=e.injector||(null===(u=e.viewContainerRef)||void 0===u?void 0:u.injector),y=[{provide:YW,useValue:e.data},{provide:tI,useValue:i}];return e.providers&&("function"==typeof e.providers?y.push(...e.providers(i,e,r)):y.push(...e.providers)),e.direction&&(!m||!m.get(qp,null,$n.Optional))&&y.push({provide:qp,useValue:{value:e.direction,change:Ln()}}),Nr.create({parent:m||s,providers:y})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,u)=>{s?u.setAttribute("aria-hidden",s):u.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(je(jo),je(Nr),je(KW,8),je(n,12),je(r_),je(gF))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();function nI(n,t){let e=n.length;for(;e--;)t(n[e])}let t7=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[bF,JW],imports:[Cl,ua,Rm,ua]}),n})();const o_={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},n7={dialogContainer:Ms("dialogContainer",[fr("void, exit",Bn({opacity:0,transform:"scale(0.7)"})),fr("enter",Bn({transform:"none"})),Xi("* => enter",VR([er("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Bn({transform:"none",opacity:1})),RT("@*",kT(),{optional:!0})]),o_),Xi("* => void, * => exit",VR([er("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Bn({opacity:0})),RT("@*",kT(),{optional:!0})]),o_)])};class $v{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.maxHeight="96vh",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.delayFocusTrap=!1,this.closeOnNavigation=!0,this.enterAnimationDuration=o_.params.enterAnimationDuration,this.exitAnimationDuration=o_.params.exitAnimationDuration}}let _F=(()=>{class n extends mF{constructor(e,i,r,s,u,m,y,C){super(e,i,r,s,u,m,y,C),this._animationStateChanged=new tn,this._state="enter"}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_getAnimationState(){return{value:this._state,params:{enterAnimationDuration:this._config.enterAnimationDuration||o_.params.enterAnimationDuration,exitAnimationDuration:this._config.exitAnimationDuration||o_.params.exitAnimationDuration}}}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Jb),H(Gn,8),H($v),H(km),H(Xn),H(Kp),H(xa))},n.\u0275cmp=mn({type:n,selectors:[["ng-component"]],features:[Xt],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),i7=(()=>{class n extends _F{constructor(e,i,r,s,u,m,y,C,I){super(e,i,r,s,u,m,y,I),this._changeDetectorRef=C}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?this._openAnimationDone(i):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Jb),H(Gn,8),H($v),H(km),H(Xn),H(Kp),H(Cr),H(xa))},n.\u0275cmp=mn({type:n,selectors:[["sbb-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&Vy("@dialogContainer.done",function(s){return i._onAnimationDone(s)})("@dialogContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(Cc("id",i._config.id),fn("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Uy("@dialogContainer",i._getAnimationState()))},features:[Xt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&ft(0,WW,0,0,"ng-template",0)},dependencies:[hd],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-dialog-container{display:flex;flex-direction:column;border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);box-shadow:var(--sbb-box-shadow-below);width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .sbb-dialog-container{outline:solid .0666666667rem}.sbb-dialog-container>*:only-child:not(.sbb-dialog-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-dialog-content{display:block;padding:var(--sbb-dialog-padding);flex:1 1 auto;max-height:80vh;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-dialog-content>*:first-child{margin-top:0}.sbb-dialog-title{font-size:var(--sbb-font-size);padding:calc(1rem * var(--sbb-scaling-factor)) calc(2.6666666667rem * var(--sbb-scaling-factor)) calc(1rem * var(--sbb-scaling-factor)) var(--sbb-dialog-padding);flex:0 0 auto;display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(3.5333333333rem * var(--sbb-scaling-factor))}.sbb-dialog-title-close-button{position:absolute;right:calc(1.0666666667rem * var(--sbb-scaling-factor));cursor:pointer;line-height:0}.sbb-dialog-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}.sbb-dialog-actions{padding:calc(0.4666666667rem * var(--sbb-scaling-factor)) calc(1.0666666667rem * var(--sbb-scaling-factor));display:flex;flex:0 0 auto;flex-wrap:wrap;gap:var(--sbb-button-gap);align-items:center;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}.sbb-dialog-actions.sbb-dialog-actions-align-start,.sbb-dialog-actions[align=start],.sbb-dialog-actions[align=left]{justify-content:flex-start}.sbb-dialog-actions.sbb-dialog-actions-align-center,.sbb-dialog-actions[align=center]{justify-content:center}.sbb-dialog-actions.sbb-dialog-actions-align-end,.sbb-dialog-actions[align=end]{justify-content:flex-end}"],encapsulation:2,data:{animation:[n7.dialogContainer]}}),n})();class RS{constructor(t,e,i){this.ref=t,this._containerInstance=i,this._afterOpened=new Kt,this._beforeClosed=new Kt,this._state=0,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe(Tr(r=>"opened"===r.state),jr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(Tr(r=>"closed"===r.state),jr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Er(this.backdropClick(),this.keydownEvents().pipe(Tr(r=>27===r.keyCode&&!this.disableClose&&!ca(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),yF(this,"keydown"===r.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(Tr(e=>"closing"===e.state),jr(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this.ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this.ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this.ref.backdropClick}keydownEvents(){return this.ref.keydownEvents}updatePosition(t){const e=this.ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this.ref.updatePosition(),this}updateSize(t="",e=""){return this.ref.updateSize(t,e),this}addPanelClass(t){return this.ref.addPanelClass(t),this}removePanelClass(t){return this.ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this.ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function yF(n,t,e){return n._closeInteractionType=t,n.close(e)}const r7=new It("SbbDialogData"),o7=new It("sbb-dialog-default-options"),vF=new It("sbb-dialog-scroll-strategy"),a7={provide:vF,deps:[jo],useFactory:function s7(n){return()=>n.scrollStrategies.block()}};let l7=0,xF=(()=>{class n{constructor(e,i,r,s,u,m,y,C,I){this._overlay=e,this._defaultOptions=r,this._parentDialog=s,this._dialogRefConstructor=y,this._dialogContainerType=C,this._dialogDataToken=I,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Kt,this._afterOpenedAtThisLevel=new Kt,this._idPrefix="sbb-dialog-",this.afterAllClosed=xm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(As(void 0))),this._scrollStrategy=m,this._dialog=i.get(bF)}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){let r;(i=Object.assign(Object.assign({},this._defaultOptions||new $v),i)).id=i.id||`${this._idPrefix}${l7++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy(),i.backdropClass=i.backdropClass||"sbb-overlay-background";const s=this._dialog.open(e,Object.assign(Object.assign({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:$v,useValue:i},{provide:kS,useValue:i}]},templateContext:()=>({dialogRef:r,lightboxRef:r}),providers:(u,m,y)=>(r=new this._dialogRefConstructor(u,i,y),r.updatePosition(null==i?void 0:i.position),[{provide:this._dialogContainerType,useValue:y},{provide:this._dialogDataToken,useValue:m.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentInstance=s.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const u=this.openDialogs.indexOf(r);u>-1&&(this.openDialogs.splice(u,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){nu()},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),tl=(()=>{class n extends xF{constructor(e,i,r,s,u,m){super(e,i,r,u,m,s,RS,i7,r7)}}return n.\u0275fac=function(e){return new(e||n)(je(jo),je(Nr),je(o7,8),je(vF),je(n,12),je(r_))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),c7=0,Qp=(()=>{class n{constructor(e,i,r){this._dialogRef=e,this._elementRef=i,this._dialog=r,this.ariaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this.type="button",this._canCloseInterceptor=()=>!0}ngOnInit(){this._dialogRef||(this._dialogRef=wF(this._elementRef,this._dialog.openDialogs))}ngOnChanges(e){const i=e._sbbDialogClose||e._sbbDialogCloseResult;i&&(this.dialogResult=i.currentValue)}_onButtonClick(e){!this._canCloseInterceptor()||yF(this._dialogRef,0===e.screenX&&0===e.screenY?"keyboard":"mouse",this.dialogResult)}}return n.\u0275fac=function(e){return new(e||n)(H(RS,8),H(En),H(tl))},n.\u0275dir=Bt({type:n,selectors:[["","sbb-dialog-close",""],["","sbbDialogClose",""]],hostVars:2,hostBindings:function(e,i){1&e&&Ft("click",function(s){return i._onButtonClick(s)}),2&e&&fn("aria-label",i.ariaLabel||null)("type",i.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["sbb-dialog-close","dialogResult"],_sbbDialogClose:["sbbDialogClose","_sbbDialogClose"]},exportAs:["sbbDialogClose"],features:[hr]}),n})(),u7=(()=>{class n{constructor(e,i,r,s){this._dialogRef=e,this._elementRef=i,this._dialog=r,this._changeDetectorRef=s,this.id="sbb-dialog-title-"+c7++,this.closeAriaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this._closeEnabled=!0}ngOnInit(){this._dialogRef||(this._dialogRef=wF(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const e=this._dialogRef._containerInstance;!e||(e._config.disableClose&&(this._closeEnabled=!1,this._changeDetectorRef.markForCheck()),e._ariaLabelledBy||(e._ariaLabelledBy=this.id))})}}return n.\u0275fac=function(e){return new(e||n)(H(RS,8),H(En),H(tl),H(Cr))},n.\u0275dir=Bt({type:n,inputs:{id:"id",closeAriaLabel:"closeAriaLabel"}}),n})(),Bm=(()=>{class n extends u7{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275cmp=mn({type:n,selectors:[["sbb-dialog-title"],["","sbb-dialog-title",""],["","sbbDialogTitle",""]],hostAttrs:[1,"sbb-dialog-title"],hostVars:1,hostBindings:function(e,i){2&e&&Cc("id",i.id)},exportAs:["sbbDialogTitle"],features:[Xt],ngContentSelectors:ZW,decls:2,vars:1,consts:[["sbb-dialog-close","","class","sbb-dialog-title-close-button sbb-button-reset-frameless",3,"aria-label",4,"ngIf"],["sbb-dialog-close","",1,"sbb-dialog-title-close-button","sbb-button-reset-frameless",3,"aria-label"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(Ro(),Pr(0),ft(1,XW,2,1,"button",0)),2&e&&(ae(1),Le("ngIf",i._closeEnabled))},dependencies:[ho,Qa,Qp],encapsulation:2,changeDetection:0}),n})(),zm=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["","sbb-dialog-content",""],["sbb-dialog-content"],["","sbbDialogContent",""]],hostAttrs:[1,"sbb-dialog-content","sbb-scrollbar"]}),n})(),Vm=(()=>{class n{constructor(){this.align="end"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["","sbb-dialog-actions",""],["sbb-dialog-actions"],["","sbbDialogActions",""]],hostAttrs:[1,"sbb-dialog-actions"],hostVars:6,hostBindings:function(e,i){2&e&&Li("sbb-dialog-actions-align-start","start"===i.align)("sbb-dialog-actions-align-center","center"===i.align)("sbb-dialog-actions-align-end","end"===i.align)},inputs:{align:"align"}}),n})();function wF(n,t){let e=n.nativeElement.parentElement;for(;e&&!e.classList.contains("sbb-dialog-container")&&!e.classList.contains("sbb-lightbox-container");)e=e.parentElement;return e?t.find(i=>i.id===e.id):null}let iI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[tl,a7],imports:[pr,t7,Cl,ua,Zi,yo]}),n})(),PS=(()=>{class n{constructor(){this.requestXmlS="loading...",this.responseXmlS="loading..."}updateRequestData(e){this.requestXmlS=e.requestXML?iF.prettyPrintXML(e.requestXML):"n/a",this.responseXmlS=e.responseXML?iF.prettyPrintXML(e.responseXML):"n/a"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["debug-xml-popover"]],decls:15,vars:2,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(X(0,"div",0),Ce(1,"Debug XML"),Y(),X(2,"div",1)(3,"div",2)(4,"div"),Ce(5," Request XML "),X(6,"textarea",3),Ce(7),Y()(),X(8,"div"),Ce(9," Response XML "),X(10,"textarea",3),Ce(11),Y()()()(),X(12,"div",4)(13,"button",5),Ce(14," Close "),Y()()),2&e&&(ae(7),An(i.requestXmlS),ae(4),An(i.responseXmlS))},dependencies:[Qp,Bm,zm,Vm],encapsulation:2}),n})();const d7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#0000FF","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),h7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"{stopPlace.stopPlaceName} \\n {stopPlace.stopPlaceRefLabel}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.2,0.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),p7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#eb0000","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),f7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-charging-station","icon-allow-overlap":true,"icon-size":0.5}}'),m7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"car-15","icon-allow-overlap":true,"icon-size":1.4}}'),g7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"bicycle-15","icon-allow-overlap":true,"icon-size":1.4}}'),b7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-scooter","icon-allow-overlap":true,"icon-size":0.4}}'),LS=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","layout":{"text-field":"{sharedVehicle.itemsNo}","text-allow-overlap":true,"text-size":12,"text-offset":[0.7,-1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-color":["case",["==",["get","sharedVehicle.itemsNo"],0],"red","#006400"],"text-halo-width":1}}'),OS=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":15,"layout":{"text-field":"{sharedVehicle.provider}","text-allow-overlap":true,"text-size":12,"text-offset":[0,1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),SF={"stops-circle":d7,"stops-label":h7,"address-circle":p7,"charging-station-icon":f7,"charging-station-text-number":LS,"charging-station-text-provider":OS,"car-rental-icon":m7,"car-rental-text-number":LS,"car-rental-text-provider":OS,"bike-icon":g7,"bike-text-number":LS,"bike-text-provider":OS,"scooter-icon":b7,"scooter-text-number":LS,"scooter-text-provider":OS,"poi-all":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":["get","style.icon-image"],"icon-allow-overlap":true,"icon-size":0.4}}')};class qv{constructor(t,e,i,r,s){this.language=t,this.layerKey=e,this.map=i,this.restrictionType=r.LIR_Restriction_Type,this.restrictionPOI=r.LIR_POI_Type?r.LIR_POI_Type:null,this.minZoom=r.minZoom,this.features=[],this.mapSourceID=e+"-map-src",this.userTripService=s,this.isEnabled=!1,this.lastOJPRequest=null,this.addMapSourceAndLayers(),this.currentLocations=[]}addMapSourceAndLayers(){var t;this.map.addSource(this.mapSourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.layerKey in Zp.map_app_map_layers?(null!==(t=Zp.map_app_map_layers[this.layerKey].layer_ids)&&void 0!==t?t:[this.layerKey]).forEach(r=>{if(!(r in SF))return void console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layer def for "+r);const u=JSON.parse(JSON.stringify(SF[r]));u.id=r,u.source=this.mapSourceID,this.map.addLayer(u)}):console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layers defined for "+this.layerKey)}shouldLoadNewFeatures(){return!(!this.isEnabled||this.map.getZoom()<this.minZoom)}refreshFeatures(){var t;return Ke(this,void 0,void 0,function*(){if(!this.shouldLoadNewFeatures())return void this.removeAllFeatures();const i="poi"===this.restrictionType&&"poi"===(null===(t=this.restrictionPOI)||void 0===t?void 0:t.poiType)?1e3:300,r=this.map.getBounds(),s=el.initWithBBOXAndType(this.userTripService.getStageConfig(),this.language,r.getWest(),r.getNorth(),r.getEast(),r.getSouth(),[this.restrictionType],i,this.restrictionPOI);this.lastOJPRequest=s;const u=Zp.map_app_map_layers[this.layerKey],m=yield s.fetchResponse();if("ERROR"===m.message)return console.log("AppMapLayer: "+this.layerKey+" backend ERROR"),void console.log(m);const y=[],C={};m.locations.forEach((A,B)=>{var j,K,pe,Se,Xe;if(null===A.geoPosition)return;if("poi"===this.restrictionType&&"shared_mobility"===(null===(j=this.restrictionPOI)||void 0===j?void 0:j.poiType)){const kn=null!==(K=u.LIR_POI_Type)&&void 0!==K?K:null;if(null===kn)return void y.push(A);const Si=null!==(Se=null===(pe=A.poi)||void 0===pe?void 0:pe.category)&&void 0!==Se?Se:null;if(null===Si)return void y.push(A);if(!kn.tags.includes(Si))return void y.push(A)}const pt=A.geoPosition.asLatLngString();if(!(pt in C)){const kn={type:"Feature",properties:{locations_idx:[]},geometry:{type:"Point",coordinates:A.geoPosition.asPosition()}};C[pt]=kn}const kt=null!==(Xe=C[pt])&&void 0!==Xe?Xe:null;null!==kt&&null!==kt.properties&&kt.properties.locations_idx.push(B)}),this.currentLocations=m.locations;const I=Object.values(C);I.forEach(A=>{if(null===A.properties)return;const B=A.properties.locations_idx,j=[];B.forEach(K=>{var pe;const Se=null!==(pe=m.locations[K])&&void 0!==pe?pe:null;Se&&j.push(Se)}),A.properties.locations_idx=B.join(","),this.annotateFeatureFromLocations(A,j)}),this.setSourceFeatures(I)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceID).setData({type:"FeatureCollection",features:t})}annotateFeatureFromLocations(t,e){}handleMapClick(t){var e,i,r;if(!this.shouldLoadNewFeatures())return!1;const s=Zp.map_app_map_layers[this.layerKey];let u=null!==(e=s.click_layer_ids)&&void 0!==e?e:[];if(0===u.length)return!1;"SAME_AS_LAYER_IDS"===u&&(u=null!==(i=s.layer_ids)&&void 0!==i?i:[this.layerKey]);const m=Yp.queryNearbyFeaturesByLayerIDs(this.map,t.lngLat,u);if(0===m.length)return!1;const y=m[0];if(null===y.feature.properties)return!1;let C=null!==(r=y.feature.properties.locations_idx)&&void 0!==r?r:"";if(C=C.trim(),""===C)return!1;const I=[];C.split(",").forEach(j=>{var K;const pe=parseInt(j,10),Se=null!==(K=this.currentLocations[pe])&&void 0!==K?K:null;Se&&!(pe in I)&&(I[pe]=Se)});const B=Object.values(I);return 0!==B.length&&(this.showPopup(B),!0)}showPopup(t){var e,i;const r=t[0],s=null!==(i=null===(e=r.geoPosition)||void 0===e?void 0:e.asLngLat())&&void 0!==i?i:null;if(null===s)return;const u=this.computePopupHTML(t);if(null===u)return;const m=document.createElement("div");m.innerHTML=u;const y=new(ks().Popup)({focusAfterOpen:!1,maxWidth:"400px"});m.addEventListener("click",C=>{const A=C.target.getAttribute("data-endpoint-type");null!==A&&(this.userTripService.updateTripEndpoint(r,A,"MapPopupClick"),y.remove())}),y.setLngLat(s).setDOMContent(m).addTo(this.map)}computePopupHTML(t){var e,i,r,s;if(0===t.length)return null;const u=t[0],m=document.getElementById("map-endpoint-picker-popup");if(null===m)return null;let y=m.innerHTML;y=y.replace("[GEO_RESTRICTION_TYPE]",this.restrictionType);const C=null!==(s=null!==(i=null===(e=u.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null===(r=u.asGeoJSONFeature())||void 0===r?void 0:r.properties)&&void 0!==s?s:null;if(null==C)return y=y.replace("[GEOJSON_PROPERTIES_TABLE]","ERROR: cant read GeoJSON properties"),y;const I=[];for(let B in C){let j=C[B];if("string"==typeof j){const pe=new String(j);pe.startsWith("http")&&(j='<a href="'+pe+'" target="_blank">'+pe+"</a>")}I.push("<tr><td>"+B+"</td><td>"+j+"</td></tr>")}const A='<table class="table">'+I.join("")+"</table>";return y=y.replace("[GEOJSON_PROPERTIES_TABLE]",A),y}}class y7 extends qv{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=0;e.forEach((r,s)=>{"available"===this.computeLocationStatus(r)&&(i+=1)}),t.properties["sharedVehicle.itemsNo"]=i}computeLocationStatus(t){var e;const i=null!==(e=t.attributes.locationStatus)&&void 0!==e?e:null;if(null===i)return null;const r=i.toUpperCase();return"AVAILABALE"===r?"available":"OCCUPIED"===r?"occupied":"UNKNOWN"===r?"unknown":null}computePopupHTML(t){var e;const i=document.getElementById("map-poi-picker-popup");if(null===i||0===t.length)return null;const r=t[0];if(null===r.poi||"charging_station"!==r.poi.category)return null;const s=[];s.push('<tr><td style="width:50px;">Name</td><td>'+r.poi.name+" - "+r.locationName+"</td></tr>");let u=r.poi.code;u=u.replace(r.poi.name,""),u=u.replace(null!==(e=r.locationName)&&void 0!==e?e:"n/a",""),s.push("<tr><td>Code</td><td>"+u+"</td></tr>");const m=[];t.forEach((I,A)=>{var B;if(null===I.poi)return;const j=this.computeLocationStatus(I);if(null===j)return;const K=(()=>{let Xe="bg-success";return"occupied"===j&&(Xe="bg-danger"),"unknown"===j&&(Xe="bg-secondary"),'<span class="badge rounded-pill '+Xe+'">'+j.toUpperCase()+"</span>"})(),pe=null!==(B=I.attributes.Code)&&void 0!==B?B:null;m.push("<li>"+K+" "+pe+"</li>")}),s.push('<tr><td colspan="2"><p>Chargers ('+t.length+")</p><ul>"+m.join("")+"</ul></td></tr>");let y=i.innerHTML;y=y.replace("[POI_NAME]","Charging Station");const C='<table class="table popup-charging-station">'+s.join("")+"</table>";return y=y.replace("[GEOJSON_PROPERTIES_TABLE]",C),y}}class v7 extends qv{annotateFeatureFromLocations(t,e){null!==t.properties&&(0===e.length||null===e[0].poi||(t.properties["style.icon-image"]=e[0].poi.computePoiMapIcon()))}computePopupHTML(t){if(0===t.length)return null;const e=t[0];if(null===e.poi)return null;const i=document.getElementById("map-poi-picker-popup");if(null===i)return null;let r=i.innerHTML;r=r.replace("[POI_NAME]",e.poi.name);const s=[];s.push("<tr><td>Code</td><td>"+e.poi.code.substring(0,20)+"...</td></tr>"),s.push("<tr><td>Category</td><td>"+e.poi.category+"</td></tr>"),s.push("<tr><td>SubCategory</td><td>"+e.poi.subCategory+"</td></tr>");const u='<table class="table">'+s.join("")+"</table>";return r=r.replace("[GEOJSON_PROPERTIES_TABLE]",u),r}}class Gv{constructor(t,e,i,r,s){this.poiType=t,this.vehicleType=e,this.provider=i,this.code=r,this.name=s,this.hireFacility=null,this.isFixedStation=!1,this.docksNo=null,this.vehiclesNo=null,this.vehicleName=null}static initFromLocation(t){var e,i,r;if(null===t.poi)return null;const s=t.poi.category,u=(()=>{var K;const pe=null!==(K=t.attributes.Code)&&void 0!==K?K:null;return null!==pe?pe:t.poi.code})(),m=(()=>{if("bicycle_rental"===s){if("Publibike"===t.locationName)return["PubliBike","Bike"];if("Publiebike"===t.locationName)return["PubliBike","E-Bike"];if("Nextbike"===t.locationName)return["Nextbike","Bike"]}return u.startsWith("2em_cars")?["2EM Car Sharing","Car"]:u.startsWith("2em_cars_e")?["2EM Car Sharing","E-Car"]:u.startsWith("bird-")?["Bird","E-Scooter"]:u.startsWith("bolt_")?["Bolt","E-Scooter"]:u.startsWith("carvelo2go")?["Carvelo2go","E-CargoBike"]:u.startsWith("donkey_kreuzlingen")?["Regivelo.ch","Bike"]:u.startsWith("donkey_")?["Donkey Republic","Bike"]:u.startsWith("edrivecarsharing")?["E-drive Car Sharing","E-Car"]:u.startsWith("bird-platform-partner-jmfleetswl-")?["JM Fleets","E-Scooter"]:u.startsWith("liemobil_liechtenstein_ebike")?["LIEmobil","E-Bike"]:u.startsWith("lime_")?u.includes("_escooter")?["Lime","E-Scooter"]:["Lime","E-Bike"]:u.startsWith("mobility")?["Mobility","Car"]:u.startsWith("emobility")?["Mobility","E-Car"]:u.startsWith("nextbike_ch")?["Nextbike","Bike"]:u.startsWith("pickebike_")?u.includes("_emoped")?["Pick-e-Bike","E-Moped"]:["Pick-e-Bike","E-Bike"]:u.startsWith("share_birrer_ch")?["Share Birrer","E-Car"]:u.startsWith("sponticar")?["Sponti-Car","E-Car"]:u.startsWith("tier")?["TIER","E-Scooter"]:u.startsWith("tier_ebike")?["TIER","E-Bike"]:u.startsWith("voiscooters.com")?["VOI","E-Scooter"]:[null,"E-Scooter"]})(),y=m[0],C=m[1];if(null===y)return console.error("CANT DETECT provider"),console.log(t),null;const I="escooter_rental"===s?null!==(K=t.attributes.Text)&&void 0!==K?K:null:"2EM Car Sharing"===y?y:"bicycle_rental"===s||"car_sharing"===s?t.poi.name:null;var K;if(null===I)return console.error("CANT find name"),console.log(t),null;const A=new Gv(s,C,y,u,I),B=null!==(e=t.attributes.num_docks_available)&&void 0!==e?e:null;null!==B&&(A.docksNo=parseInt(B,10));const j=null!==(i=t.attributes.num_vehicles_available)&&void 0!==i?i:null;return null!==j&&(A.isFixedStation=!0,A.vehiclesNo=parseInt(j,10)),A.hireFacility=null!==(r=t.attributes.HireFacility)&&void 0!==r?r:null,"2EM Car Sharing"===y&&(A.vehicleName=t.poi.name),A}computeProviderLabel(){return"2EM Car Sharing"===this.provider?"2EM Car":"Carvelo2go"===this.provider?"Carvelo":"E-drive Car Sharing"===this.provider?"E-drive":"Donkey Republic"===this.provider?"Donkey Rep.":this.provider}}class x7 extends qv{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=null;e.forEach(s=>{const u=Gv.initFromLocation(s);null!==u&&null!==u.vehiclesNo&&(null===i&&(i=0),i+=u.vehiclesNo)}),null!==i&&(t.properties["sharedVehicle.itemsNo"]=i);const r=Gv.initFromLocation(e[0]);r&&(t.properties["sharedVehicle.provider"]=r.computeProviderLabel())}computePopupHTML(t){if(0===t.length)return null;const e=document.getElementById("map-poi-picker-popup");if(null===e)return null;let i=e.innerHTML;const r=[];if(t.forEach(I=>{const A=Gv.initFromLocation(I);A&&r.push(A)}),0===r.length){const I=t[0];i=i.replace("[POI_NAME]","GENERIC SHARED MOBILITY");const A=[];for(let j in I.attributes){let K=I.attributes[j];if("string"==typeof K){const Se=new String(K);Se.startsWith("http")&&(K='<a href="'+Se+'" target="_blank">'+Se+"</a>")}A.push("<tr><td>"+j+"</td><td>"+K+"</td></tr>")}const B='<table class="table">'+A.join("")+"</table>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",B),null}const s=r[0];i=i.replace("[POI_NAME]",s.provider);const m=[];if(m.push('<tr><td style="width:75px;">Name</td><td>'+s.name+"</td></tr>"),m.push("<tr><td>Code</td><td>"+s.code+"</td></tr>"),s.isFixedStation){const I=[];r.forEach(A=>{let j=A.vehiclesNo+" "+A.vehicleType+(1===A.vehiclesNo?"":"s");null!==A.vehicleName&&(j+=" - "+A.vehicleName),I.push("<li>"+j+"</li>")}),m.push('<tr><td class="align-middle">Vehicles</td><td><ul>'+I.join("")+"</ul></td></tr>")}const C='<div class="popup-shared-mobility">'+['<table class="table">'+m.join("")+"</table>"].join("")+"</div>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",C),i}}class w7 extends qv{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;const i=e[0];if(null===i.stopPlace)return;const r=i.stopPlace.stopPlaceRef;t.properties["stopPlace.stopPlaceRef"]=r,t.properties["stopPlace.stopPlaceName"]=i.stopPlace.stopPlaceName;let s=r.slice();s.length>32&&(s=r.substring(0,32)+"..."),t.properties["stopPlace.stopPlaceRefLabel"]=s}computePopupHTML(t){var e,i;if(0===t.length)return null;const r=document.getElementById("map-endpoint-stop-picker-popup");if(null===r)return null;const s=t[0],u=s.computeLocationName(),m=null!==(i=null===(e=s.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&void 0!==i?i:null;if(null===u||null===m)return null;let y=r.innerHTML;return y=y.replace("[STOP_NAME]",u),y=y.replace("[STOP_ID]",m),y}}class CF{static init(t,e,i,r,s){var u,m,y;return"stop"===r.LIR_Restriction_Type?new w7(t,e,i,r,s):(null===(u=r.LIR_POI_Type)||void 0===u?void 0:u.tags.includes("charging_station"))?new y7(t,e,i,r,s):"shared_mobility"===(null===(m=r.LIR_POI_Type)||void 0===m?void 0:m.poiType)?new x7(t,e,i,r,s):"poi"===(null===(y=r.LIR_POI_Type)||void 0===y?void 0:y.poiType)?new v7(t,e,i,r,s):new qv(t,e,i,r,s)}}class rI{constructor(t,e,i,r){this.debugXmlPopover=e,this.prevMapBoundsHash="",this.map=t,this.layersData=[],this.userTripService=i,this.languageService=r}onAdd(t){this.map=t;const e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",e.innerHTML=document.getElementById("map-layers-legend-control").innerHTML,this.addLayers(e,t),this.addPOICompositeLayers(e,t),t.on("zoom",i=>{this.onZoomChanged(t)}),this.onZoomChanged(t),t.on("idle",i=>{this.handleMapIdleEvents(t)}),t.on("click",i=>{this.handleMapClickEvents(i,t)}),e}onRemove(){this.map=null}addLayers(t,e){t.querySelectorAll(".map-layer-data").forEach(i=>{var r;const s=i.getAttribute("data-map-layer-key");if(null===s)return;const u=i.querySelector(".map-layer-checkbox");if(null===u)return;const m=i.querySelector(".layer-xml-info"),y=null!==(r=Zp.map_app_map_layers[s])&&void 0!==r?r:null;if(null===y)return console.error("ERROR - MapLayersLegendControl - cant find layerKey "+s+" in APP_CONFIG"),u.disabled=!0,i.insertAdjacentHTML("beforeend",'<span class="badge bg-danger text-white">ERROR</span>'),void(m&&m.classList.add("d-none"));const C=CF.init(this.languageService.language,s,e,y,this.userTripService);C.isEnabled=u.checked,m&&this.addLayerInfoClickHandler(m,C),u.addEventListener("change",A=>{C.isEnabled=u.checked,u.checked?C.refreshFeatures():C.removeAllFeatures()}),this.layersData.push({inputEls:[u],xmlInfoEl:m,layer:C})})}addLayerInfoClickHandler(t,e){t.addEventListener("click",i=>{const r=e.lastOJPRequest;if(r){const s=this.debugXmlPopover.open(PS,{position:{top:"10px"}});s.afterOpened().subscribe(()=>{s.componentInstance.updateRequestData(r.requestInfo)})}})}addPOICompositeLayers(t,e){t.querySelectorAll(".map-composite-pois").forEach(i=>{this.addPOICompositeLayer(i,e)})}addPOICompositeLayer(t,e){const i="pois-ALL",r=JSON.parse(JSON.stringify(Zp.map_app_map_layers[i])),s=[],u=[];t.querySelectorAll(".map-layer-poi").forEach(I=>{const A=I,B=A.getAttribute("data-osm-tag");null!==B&&(u.push(A),A.checked&&s.push(B),A.addEventListener("change",j=>{const K=[];u.forEach(pe=>{const Se=pe.getAttribute("data-osm-tag");pe.checked&&Se&&K.push(Se)}),m.restrictionPOI&&(m.restrictionPOI.tags=K),m.isEnabled=K.length>0,m.refreshFeatures(),C.xmlInfoEl&&(m.isEnabled?C.xmlInfoEl.classList.remove("d-none"):C.xmlInfoEl.classList.add("d-none"))}))}),r.LIR_POI_Type={poiType:"poi",tags:s};const m=CF.init(this.languageService.language,i,e,r,this.userTripService);m.isEnabled=s.length>0;const y=t.querySelector(".layer-xml-info");this.addLayerInfoClickHandler(y,m);const C={layer:m,inputEls:u,xmlInfoEl:y};this.layersData.push(C)}handleMapIdleEvents(t){const e=t.getBounds().toString();this.prevMapBoundsHash!==e&&(this.prevMapBoundsHash=e,this.layersData.forEach(r=>{r.layer.refreshFeatures()}))}onZoomChanged(t){this.layersData.forEach(e=>{var i;const r=e.layer.minZoom,s=t.getZoom()<r;null===(i=e.inputEls)||void 0===i||i.forEach(u=>{u.disabled=s}),e.xmlInfoEl&&(s?e.xmlInfoEl.classList.add("d-none"):e.xmlInfoEl.classList.remove("d-none"))})}handleMapClickEvents(t,e){let i=!1;this.layersData.forEach(r=>{i||r.layer.handleMapClick(t)&&(i=!0)})}}let mu=(()=>{class n{constructor(){this.newMapBoundsRequested=new tn,this.newMapCenterAndZoomRequested=new tn,this.initialMapCenter=null,this.initialMapZoom=null}tryToCenterAndZoomToLocation(e,i=16){var r,s;if(null===e)return;const u=null!==(s=null===(r=e.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;null!==u&&this.newMapCenterAndZoomRequested.emit({lnglat:u,zoom:i})}createMap(e){const i=new(ks().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),r=new(ks().Map)({container:e,style:"mapbox://styles/mapbox/light-v10",bounds:i,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});return this.initialMapCenter?(r.setCenter(this.initialMapCenter),this.initialMapZoom&&r.setZoom(this.initialMapZoom)):r.fitBounds(i,{padding:50,duration:0}),r}zoomToTrip(e){const i=e.computeBBOX();if(!1===i.isValid())return;const s={bounds:new(ks().LngLatBounds)(i.asFeatureBBOX())};this.newMapBoundsRequested.emit(s)}zoomToBounds(e,i){var r,s;const u=i.bounds;if(u.getSouthWest().distanceTo(u.getNorthEast())<20)return void e.jumpTo({center:u.getCenter(),zoom:16});const C=null!==(r=i.padding)&&void 0!==r?r:{left:50,top:170,right:50,bottom:100};if(null!==(s=i.onlyIfOutside)&&void 0!==s&&s&&Yp.areBoundsInsideOtherBounds(u,e.getBounds()))return;const A=[u.getWest(),u.getSouth(),u.getEast(),u.getNorth()];e.fitBounds(A,{padding:C})}zoomToLocation(e,i){e.flyTo({center:i.lnglat,zoom:i.zoom})}addControls(e,i,r,s){const u=new(ks().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(u,"bottom-right");const m=new(ks().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(m);const y=new JD(e);e.addControl(y,"top-left");const C=new rI(e,i,r,s);e.addControl(C,"top-right")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Sa=(()=>{class n{constructor(e){this.mapService=e,this.embedQueryParams=new URLSearchParams,this.defaultsInited=new tn,this.locationsUpdated=new tn,this.geoLocationsUpdated=new tn,this.tripsUpdated=new tn,this.tripFaresUpdated=new tn,this.activeTripSelected=new tn,this.tripRequestFinished=new tn,this.viaAtIndexRemoved=new tn,this.viaAtIndexUpdated=new tn,this.searchParamsReset=new tn,this.queryParams=new URLSearchParams(document.location.search),this.fromTripLocation=null,this.toTripLocation=null,this.viaTripLocations=[],this.currentBoardingType="Dep",this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.journeyTripRequests=[],this.departureDate=this.computeInitialDate(),this.currentAppStage="PROD",this.permalinkRelativeURL=null}initDefaults(e){var i,r,s,u,m;let y=this.queryParams.get("stage");y&&(this.currentAppStage=this.computeAppStageFromString(y));const I=null!==(i=this.queryParams.get("from"))&&void 0!==i?i:"8507000",A=null!==(r=this.queryParams.get("to"))&&void 0!==r?r:"8503000",B=[],j=this.getStageConfig(),K=["From","To"];K.forEach(kt=>{let kn="From"===kt?I:A;if("LA Beta"===this.currentAppStage){const ci=kn.match(/^[^\|]+?\|(.+?)$/);ci?kn=ci[1]:console.error("ERROR LA Beta - CANT match stopPlaceRef")}const Si=to.initFromLiteralCoords(kn);if(Si){const ci=new Promise(no=>{no([Si])});B.push(ci)}else{let ci=el.initWithStopPlaceRef(j,e,kn);"string"==typeof kn&&/^[A-Z]/.test(kn)&&(ci=el.initWithLocationName(j,e,kn,[]));const no=ci.fetchLocations();B.push(no)}});const pe=new pd([]),Se=null!==(s=this.queryParams.get("via"))&&void 0!==s?s:null;(null===Se?[]:Se.split(";")).forEach(kt=>{const yn=to.initFromLiteralCoords(kt);if(yn){const kn=new Ja(yn);this.viaTripLocations.push(kn),yn.geoPosition&&pe.extend(yn.geoPosition)}}),this.journeyTripsPlaceholder=[],this.tripModeTypes=[];const At=null!==(u=this.queryParams.get("mode_types"))&&void 0!==u?u:null;At?At.split(";").forEach(kt=>{this.tripModeTypes.push(kt),this.journeyTripsPlaceholder.push("-")}):(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"]),this.tripTransportModes=[];const pt=null!==(m=this.queryParams.get("transport_modes"))&&void 0!==m?m:null;pt?pt.split(";").forEach(kt=>{this.tripTransportModes.push(kt)}):this.tripTransportModes=["public_transport"],Promise.all(B).then(kt=>{if(K.forEach(yn=>{const kn="From"===yn,Si=kn?kt[0]:kt[1];if(0===Si.length)return;const ci=Si[0];kn?this.fromTripLocation=new Ja(ci):this.toTripLocation=new Ja(ci),ci.geoPosition&&pe.extend(ci.geoPosition)}),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.updatePermalinkAddress(),pe.isValid()&&(this.queryParams.has("from")||this.queryParams.has("to"))&&!this.mapService.initialMapCenter){const Si={bounds:new(ks().LngLatBounds)(pe.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(Si)}this.defaultsInited.emit()})}refetchEndpointsByName(e){const i=[],r=new Promise((u,m)=>{u(null)}),s=["From","To"];s.forEach(u=>{const C="From"===u?this.fromTripLocation:this.toTripLocation;if(null===C)return void i.push(r);const I=C.location.geoPosition;if(null===I)return void i.push(r);const A=pd.initFromGeoPosition(I,200,200),B=this.getStageConfig(),K=el.initWithBBOXAndType(B,e,A.southWest.longitude,A.northEast.latitude,A.northEast.longitude,A.southWest.latitude,["stop"],300).fetchLocations();i.push(K)}),Promise.all(i).then(u=>{s.forEach(m=>{const y="From"===m,C=y?u[0]:u[1];if(null===C)return;const I=y?this.fromTripLocation:this.toTripLocation;if(null===I)return void i.push(r);const A=I.location.findClosestLocation(C);null!==A&&(y?this.fromTripLocation=new Ja(A.location):this.toTripLocation=new Ja(A.location),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit())})})}switchEndpoints(){const e=Object.assign({},this.fromTripLocation);this.fromTripLocation=Object.assign({},this.toTripLocation),this.toTripLocation=Object.assign({},e),this.updatePermalinkAddress(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit()}computeAppStageFromString(e){const i=Zp.app_stages.map(m=>m.key),r=i.map(m=>m.toLowerCase()),s=e.trim(),u=r.indexOf(s.toLowerCase());return-1!==u?i[u]:"PROD"}updateTripEndpoint(e,i,r){if("From"===i&&(this.fromTripLocation=e?new Ja(e):null),"To"===i&&(this.toTripLocation=e?new Ja(e):null),e&&"Via"===i){const s=new Ja(e);this.viaTripLocations.push(s),this.journeyTripsPlaceholder.push("-"),this.tripModeTypes.push("monomodal"),this.tripTransportModes.push("public_transport")}this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateViaPoint(e,i){this.viaTripLocations[i].location=e,this.viaAtIndexUpdated.emit({location:e,idx:i}),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}updateTrips(e){this.massageTrips(e),this.tripsUpdated.emit(e)}selectActiveTrip(e){this.activeTripSelected.emit(e)}updateFares(e){this.tripFaresUpdated.emit(e)}removeViaAtIndex(e){this.viaTripLocations.splice(e,1),this.tripModeTypes.splice(e,1),this.journeyTripsPlaceholder.splice(e,1),this.tripTransportModes.splice(e,1),0===this.viaTripLocations.length&&(this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"]),this.viaAtIndexRemoved.emit(e),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updatePermalinkAddress()}computeTripRequestXML(e,i){const r=this.getStageConfig(),s=Rc.initWithTripLocationsAndDate(r,e,this.fromTripLocation,this.toTripLocation,i);return null===s||null===s.requestInfo.requestXML?"BROKEN TripsRequestParams":s.requestInfo.requestXML}updatePermalinkAddress(){const e=new URLSearchParams;["From","To"].forEach(C=>{var I,A,B,j;const K="From"===C?this.fromTripLocation:this.toTripLocation,pe=C.toLowerCase(),Se=null!==(A=null===(I=null==K?void 0:K.location.stopPlace)||void 0===I?void 0:I.stopPlaceRef)&&void 0!==A?A:null;if(Se)e.append(pe,Se);else{let Xe=null!==(j=null===(B=null==K?void 0:K.location.geoPosition)||void 0===B?void 0:B.asLatLngString(!0))&&void 0!==j?j:null;if(Xe){const pt=null==K?void 0:K.location.computeLocationName(!1);pt&&(Xe=Xe+"("+pt+")"),e.append(pe,Xe)}}});const r=[];this.viaTripLocations.forEach(C=>{var I,A;const B=C.location,j=null!==(A=null===(I=null==B?void 0:B.geoPosition)||void 0===I?void 0:I.asLatLngString(!0))&&void 0!==A?A:null;j&&r.push(j)}),r.length>0&&e.append("via",r.join(";")),e.append("mode_types",this.tripModeTypes.join(";")),e.append("transport_modes",this.tripTransportModes.join(";"));const s=wa.formatDate(this.departureDate);e.append("trip_datetime",s.substring(0,16));const u=this.currentAppStage.toLowerCase();e.append("stage",u),this.permalinkRelativeURL=document.location.pathname.replace("/embed","")+"?"+e.toString();const m=new URLSearchParams;["from","to"].forEach(C=>{const I=e.get(C);null!==I&&m.append(C,I)}),this.embedQueryParams=m}computeInitialDate(){var e;const i=new Date,r=null!==(e=this.queryParams.get("trip_datetime"))&&void 0!==e?e:null;return null===r?i:new Date(Date.parse(r))}getStageConfig(e=this.currentAppStage){var i;const r=null!==(i=Zp.app_stages.find(s=>s.key===e))&&void 0!==i?i:null;return null===r?(console.error("ERROR - cant find stage"+e+" using PROD"),Ih):r}updateAppStage(e){this.currentAppStage=e,this.updatePermalinkAddress()}updateDepartureDateTime(e){this.departureDate=e,this.updatePermalinkAddress()}updateTripMode(e,i,r){this.tripModeTypes[r]=e,this.tripTransportModes[r]=i,this.updatePermalinkAddress()}computeTripLocationsToUpdate(e){const i=[],r=[this.fromTripLocation];this.viaTripLocations.forEach(y=>{r.push(y)}),r.push(this.toTripLocation);const s=this.tripModeTypes[e],u=r[e];u&&("mode_at_start"===s||"mode_at_start_end"===s)&&i.push(u);const m=r[e+1];return m&&("mode_at_end"===s||"mode_at_start_end"===s)&&i.push(m),i}updateTripLocationRestrictions(e,i,r,s,u){this.computeTripLocationsToUpdate(u).forEach(y=>{y.minDuration=e,y.maxDuration=i,y.minDistance=r,y.maxDistance=s})}updateTripLocationCustomMode(e){const i=this.computeTripLocationsToUpdate(e),r=this.tripModeTypes[e];i.forEach(s=>{s.customTransportMode="monomodal"===r?null:this.tripTransportModes[e]})}updateParamsFromTrip(e){if(!(e.legs.length>0))return;const s=e.legs[e.legs.length-1];this.fromTripLocation=new Ja(e.legs[0].fromLocation),this.toTripLocation=new Ja(s.toLocation),this.viaTripLocations=[],this.journeyTripsPlaceholder=["-"],this.tripModeTypes=["monomodal"],this.tripTransportModes=["public_transport"],this.geoLocationsUpdated.emit(),this.updatePermalinkAddress()}massageTrips(e){this.sortTrips(e),this.patchTripLegEndpointCoords(e),this.mergeTripLegs(e)}sortTrips(e){var i;const r=this.tripModeTypes,s=this.tripTransportModes;if(1!==r.length||1!==s.length)return;const m=s[0];if("monomodal"!==r[0]||"public_transport"===m)return;const y=null!==(i=e.find(C=>{var I;return null!==(null!==(I=C.legs.find(B=>"ContinousLeg"===B.legType&&C.legs[0].legTransportMode===m))&&void 0!==I?I:null)}))&&void 0!==i?i:null;if(y){const C=e.indexOf(y);e.splice(C,1),e.unshift(y)}}patchTripLegEndpointCoords(e){e.forEach(i=>{i.legs.forEach((r,s)=>{var u,m,y,C;if("TimedLeg"!==r.legType)return;const I=r,A=null!==(m=null===(u=I.legTrack)||void 0===u?void 0:u.fromGeoPosition())&&void 0!==m?m:null;if(s>0&&null!==A){const j=i.legs[s-1];null===j.toLocation.geoPosition&&(j.toLocation.geoPosition=A)}const B=null!==(C=null===(y=I.legTrack)||void 0===y?void 0:y.toGeoPosition())&&void 0!==C?C:null;if(s<i.legs.length-1&&null!==B){const j=i.legs[s+1];null===j.fromLocation.geoPosition&&(j.fromLocation.geoPosition=B)}})})}mergeTripLegs(e){e.forEach(i=>{const r=[];let s=-1;i.legs.forEach((u,m)=>{if(m<=s)return;const y=m+1,C=m+2;if(C>=i.legs.length)return void r.push(u);let I=!1;const A=i.legs[y],B=i.legs[C];if("TimedLeg"===u.legType&&"TransferLeg"===A.legType&&"TimedLeg"===B.legType&&"remainInVehicle"===A.transferMode&&(I=!0,s=C),I){const j=this.mergeTimedLegs(u,B);r.push(j)}else r.push(u)}),i.legs.length>0&&i.legs.length!==r.length&&(i.legs=r)})}mergeTimedLegs(e,i){let r=e.intermediateStopPoints.slice();e.toStopPoint.stopPointType="Intermediate",r.push(e.toStopPoint),r=r.concat(i.intermediateStopPoints.slice());const s=new n_(e.legID,e.service,e.fromStopPoint,i.toStopPoint,r);return null!==e.legDuration&&null!==i.legDuration&&(s.legDuration=e.legDuration.plus(i.legDuration)),null!==e.legTrack&&null!==i.legTrack&&(s.legTrack=e.legTrack.plus(i.legTrack)),s}fetchFares(){if(0===this.journeyTripRequests.length)return;const e=this.journeyTripRequests[0].response;if(null===e)return;const r=new MW(e.trips).asXML();fetch("https://tools.odpch.ch/ojp-nova/ojp2023",{body:r,method:"POST"}).then(m=>{m.text().then(y=>{const C=new yW;C.callback=I=>{"NovaFares.DONE"===I.message?this.updateFares(I.fareResults):(console.error("NOVA ERROR"),console.log(y))},C.parseXML(y)})})}}return n.\u0275fac=function(e){return new(e||n)(je(mu))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),bd=(()=>{class n{constructor(){this.language=this.guessLanguage()}guessLanguage(){let i=new URLSearchParams(document.location.search).get("lang");if(null!==i){if(i=i.trim().toLowerCase(),"de"===i)return"de";if("en"===i)return"en";if("fr"===i)return"fr";if("it"===i)return"it"}const r={de:"de","de-DE":"de","de-AT":"de","de-CH":"de",en:"en","en-US":"en","en-GB":"en","en-AU":"en","en-CA":"en",fr:"fr","fr-FR":"fr","fr-CA":"fr","fr-BE":"fr","fr-CH":"fr",it:"it","it-IT":"it","it-CH":"it"},s=navigator.languages?navigator.languages:[navigator.language];for(const u of s){const m=u.split("-")[0];if(r[u])return r[u];if(r[m])return r[m]}return"en"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class S7{constructor(t=!1,e,i=!0,r){this._multiple=t,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new Kt,e&&e.length&&(t?e.forEach(s=>this._markSelected(s)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...t){this._verifyValueAssignment(t),t.forEach(i=>this._markSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...t){this._verifyValueAssignment(t),t.forEach(i=>this._unmarkSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...t){this._verifyValueAssignment(t);const e=this.selected,i=new Set(t);t.forEach(s=>this._markSelected(s)),e.filter(s=>!i.has(s)).forEach(s=>this._unmarkSelected(s));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();const e=this._hasQueuedChanges();return t&&this._emitChangeEvent(),e}isSelected(t){if(this.compareWith){for(const e of this._selection)if(this.compareWith(e,t))return!0;return!1}return this._selection.has(t)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}}let sI=(()=>{class n{constructor(){this._listeners=[]}notify(e,i){for(let r of this._listeners)r(e,i)}listen(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(i=>e!==i)}}ngOnDestroy(){this._listeners=[]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),C7=0;const aI=new It("CdkAccordion");let T7=(()=>{class n{constructor(){this._stateChanges=new Kt,this._openCloseAllActions=new Kt,this.id="cdk-accordion-"+C7++,this._multi=!1}get multi(){return this._multi}set multi(e){this._multi=Hn(e)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(e){this._stateChanges.next(e)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[Un([{provide:aI,useExisting:n}]),hr]}),n})(),E7=0,D7=(()=>{class n{constructor(e,i,r){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=r,this._openCloseAllSubscription=ie.EMPTY,this.closed=new tn,this.opened=new tn,this.destroyed=new tn,this.expandedChange=new tn,this.id="cdk-accordion-child-"+E7++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((s,u)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===u&&this.id!==s&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(e){e=Hn(e),this._expanded!==e&&(this._expanded=e,this.expandedChange.emit(e),e?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){this._disabled=Hn(e)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}}return n.\u0275fac=function(e){return new(e||n)(H(aI,12),H(Cr),H(sI))},n.\u0275dir=Bt({type:n,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[Un([{provide:aI,useValue:void 0}])]}),n})(),I7=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({}),n})();const M7=["body"];function A7(n,t){}const k7=[[["sbb-expansion-panel-header"]],"*"],R7=["sbb-expansion-panel-header","*"];function P7(n,t){1&n&&en(0,"sbb-icon",5),2&n&&Le("@indicatorRotate",St(2)._getExpandedState())}function L7(n,t){1&n&&en(0,"sbb-icon",9)}function O7(n,t){1&n&&en(0,"sbb-icon",10)}function F7(n,t){1&n&&(na(0,6),ft(1,L7,1,0,"sbb-icon",7),ft(2,O7,1,0,"sbb-icon",8),ia()),2&n&&(Le("ngSwitch",St(2)._isExpanded()),ae(1),Le("ngSwitchCase",!1),ae(1),Le("ngSwitchCase",!0))}function N7(n,t){1&n&&(X(0,"span",2),Mb(1,"async"),ft(2,P7,1,1,"sbb-icon",3),ft(3,F7,3,3,"ng-container",4),Y()),2&n&&(Le("ngSwitch",Ab(1,3,St().panel.variant)),ae(2),Le("ngSwitchCase","lean"),ae(1),Le("ngSwitchCase","standard"))}const B7=["*"],lI=new It("SBB_ACCORDION"),DF="225ms cubic-bezier(0.4,0.0,0.2,1)",IF={indicatorRotate:Ms("indicatorRotate",[fr("collapsed, void",Bn({transform:"rotate(90deg)"})),fr("expanded",Bn({transform:"rotate(-90deg)"})),Xi("expanded <=> collapsed, void => collapsed",er(DF))]),bodyExpansion:Ms("bodyExpansion",[fr("collapsed, void",Bn({height:"0px",visibility:"hidden"})),fr("expanded",Bn({height:"*",visibility:"visible"})),Xi("expanded <=> collapsed, void => collapsed",er(DF))])},MF=new It("SBB_EXPANSION_PANEL");let z7=(()=>{class n{constructor(e,i){this._template=e,this._expansionPanel=i}}return n.\u0275fac=function(e){return new(e||n)(H(eo),H(MF,8))},n.\u0275dir=Bt({type:n,selectors:[["ng-template","sbbExpansionPanelContent",""]]}),n})();const V7=Om(D7);let j7=0,Ah=(()=>{class n extends V7{constructor(e,i,r,s,u){super(i,r,s),this._viewContainerRef=e,this._hideToggle=!1,this.afterExpand=new tn,this.afterCollapse=new tn,this._inputChanges=new Kt,this._headerId="sbb-expansion-panel-header-"+j7++,this._bodyAnimationDone=new Kt,this.accordion=i,this._document=u,this._bodyAnimationDone.pipe($p((m,y)=>m.fromState===y.fromState&&m.toState===y.toState)).subscribe(m=>{"void"!==m.fromState&&("expanded"===m.toState?this.afterExpand.emit():"collapsed"===m.toState&&this.afterCollapse.emit())})}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=Hn(e)}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(As(null),Tr(()=>this.expanded&&!this._portal),jr(1)).subscribe(()=>{this._portal=new Pm(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}}return n.\u0275fac=function(e){return new(e||n)(H(zo),H(lI,12),H(Cr),H(sI),H(Gn))},n.\u0275cmp=mn({type:n,selectors:[["sbb-expansion-panel"]],contentQueries:function(e,i,r){if(1&e&&Vr(r,z7,5),2&e){let s;Fn(s=Nn())&&(i._lazyContent=s.first)}},viewQuery:function(e,i){if(1&e&&cr(M7,5),2&e){let r;Fn(r=Nn())&&(i._body=r.first)}},hostAttrs:[1,"sbb-expansion-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Li("sbb-expanded",i.expanded)},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["sbbExpansionPanel"],features:[Un([{provide:lI,useValue:void 0},{provide:MF,useExisting:n}]),Xt,hr],ngContentSelectors:R7,decls:6,vars:4,consts:[["role","region",1,"sbb-expansion-panel-content",3,"id"],["body",""],[1,"sbb-expansion-panel-body","sbb-expansion-panel-horizontal-padding"],[3,"cdkPortalOutlet"]],template:function(e,i){1&e&&(Ro(k7),Pr(0),X(1,"div",0,1),Ft("@bodyExpansion.done",function(s){return i._bodyAnimationDone.next(s)}),X(3,"div",2),Pr(4,1),ft(5,A7,0,0,"ng-template",3),Y()()),2&e&&(ae(1),Le("@bodyExpansion",i._getExpandedState())("id",i.id),fn("aria-labelledby",i._headerId),ae(4),Le("cdkPortalOutlet",i._portal))},dependencies:[hd],styles:['.sbb-expansion-panel{box-sizing:content-box;display:block;margin:0;transition:border-color var(--sbb-transition-fast-start);border:var(--sbb-border-width-thin) solid var(--sbb-color-milk)}.sbb-expansion-panel+.sbb-expansion-panel{margin-top:calc(var(--sbb-border-width-thin)*2)}.sbb-expansion-panel.sbb-expanded{border-color:var(--sbb-color-cloud)}.sbb-expansion-panel.sbb-expanded.sbb-expansion-panel-full-width{border-left-color:rgba(0,0,0,0);border-right-color:rgba(0,0,0,0);border-left-width:0;border-right-width:0;padding-left:var(--sbb-border-width-thin);padding-right:var(--sbb-border-width-thin)}.sbb-expansion-panel-horizontal-padding{padding-left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));padding-right:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin))}.sbb-expansion-panel-header{cursor:pointer;display:flex;align-items:center;position:relative;background-color:var(--sbb-color-milk);outline:none;padding-top:var(--sbb-expansion-panel-header-padding-top);padding-bottom:var(--sbb-expansion-panel-header-padding-bottom)}:where(html.sbb-lean) .sbb-expansion-panel-header{padding-bottom:calc(0.8rem - var(--sbb-border-width-thin))}.sbb-expansion-panel-header.sbb-expanded::after{content:"";display:block;position:absolute;height:0;bottom:0;width:calc(100% - var(--sbb-expansion-panel-padding-horizontal)*2 + var(--sbb-border-width-thin)*2);left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-cloud)}.sbb-expansion-panel-header:is(.sbb-expanded,.sbb-expanded:is(:focus,:hover)){background:inherit}.sbb-expansion-panel-header.sbb-disabled{cursor:default;opacity:.75}.sbb-expansion-panel-header-indicator{flex:0 0 auto;line-height:0;height:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);margin-left:1.6rem;color:var(--sbb-color-black);margin-top:-0.5em;margin-bottom:-0.5em}:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%;padding:calc(0.2666666667rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin))}@media all and (min-width: 40.1875em)and (max-width: 64.0525em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.6666666667rem}}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{height:calc(2.1333333333rem * var(--sbb-scaling-factor));width:calc(2.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.4rem}}@media all and (min-width: 240.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.9333333333rem}}.sbb-expansion-panel-header-content{display:flex;flex:1;overflow:hidden;font-family:var(--sbb-font-light);font-size:var(--sbb-font-size-large);line-height:var(--sbb-expansion-panel-line-height)}.sbb-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.sbb-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.sbb-expansion-panel-content.ng-animating,.sbb-expansion-panel:not(.sbb-expanded) .sbb-expansion-panel-content{overflow:hidden}.sbb-expansion-panel-body{font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:var(--sbb-divider-medium);padding-bottom:var(--sbb-divider-medium)}.sbb-expansion-panel-body>*:first-child{margin-top:0}'],encapsulation:2,data:{animation:[IF.bodyExpansion]},changeDetection:0}),n})();const H7=t_(class U7{});let Wv=(()=>{class n extends H7{constructor(e,i,r,s,u,m){super(),this.panel=e,this._element=i,this._focusMonitor=r,this._changeDetectorRef=s,this._document=u,this._parentChangeSubscription=ie.EMPTY;const y=e.accordion?e.accordion._stateChanges.pipe(Tr(C=>!!C.hideToggle)):bs;this.tabIndex=parseInt(m||"",10)||0,this._parentChangeSubscription=Er(e.opened,e.closed,y,e._inputChanges.pipe(Tr(C=>!(!C.hideToggle&&!C.disabled)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe(Tr(()=>e._containsFocus())).subscribe(()=>r.focusVia(i,"program"))}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_keydown(e){switch(e.keyCode){case 32:case 13:!ca(e)&&this._isFocused()&&(e.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e))}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}_isFocused(){var e;return(null===(e=this._document)||void 0===e?void 0:e.activeElement)===this._element.nativeElement}}return n.\u0275fac=function(e){return new(e||n)(H(Ah,1),H(En),H(xa),H(Cr),H(Gn),qo("tabindex"))},n.\u0275cmp=mn({type:n,selectors:[["sbb-expansion-panel-header"]],hostAttrs:["role","button",1,"sbb-expansion-panel-header","sbb-expansion-panel-horizontal-padding"],hostVars:9,hostBindings:function(e,i){1&e&&Ft("click",function(){return i._toggle()})("keydown",function(s){return i._keydown(s)}),2&e&&(fn("id",i.panel._headerId)("tabindex",i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.disabled),Li("sbb-expanded",i._isExpanded())("sbb-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},features:[Xt],ngContentSelectors:B7,decls:3,vars:1,consts:[[1,"sbb-expansion-panel-header-content"],["class","sbb-expansion-panel-header-indicator sbb-icon-fit",3,"ngSwitch",4,"ngIf"],[1,"sbb-expansion-panel-header-indicator","sbb-icon-fit",3,"ngSwitch"],["svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchCase"],["svgIcon","kom:chevron-right-small"],[3,"ngSwitch"],["svgIcon","kom:plus-small",4,"ngSwitchCase"],["svgIcon","kom:minus-small",4,"ngSwitchCase"],["svgIcon","kom:plus-small"],["svgIcon","kom:minus-small"]],template:function(e,i){1&e&&(Ro(),X(0,"span",0),Pr(1),Y(),ft(2,N7,4,5,"span",1)),2&e&&(ae(2),Le("ngIf",i._showToggle()))},dependencies:[ho,Fb,Zx,Qa,nv],encapsulation:2,data:{animation:[IF.indicatorRotate]},changeDetection:0}),n})(),FS=(()=>{class n extends T7{constructor(){super(...arguments),this._ownHeaders=new hm,this._hideToggle=!1}get hideToggle(){return this._hideToggle}set hideToggle(e){this._hideToggle=Hn(e)}ngAfterContentInit(){this._headers.changes.pipe(As(this._headers)).subscribe(e=>{this._ownHeaders.reset(e.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new wD(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(e){this._keyManager.onKeydown(e)}_handleHeaderFocus(e){this._keyManager.updateActiveItem(e)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,selectors:[["sbb-accordion"]],contentQueries:function(e,i,r){if(1&e&&Vr(r,Wv,5),2&e){let s;Fn(s=Nn())&&(i._headers=s)}},hostAttrs:[1,"sbb-accordion"],inputs:{hideToggle:"hideToggle"},exportAs:["sbbAccordion"],features:[Un([{provide:lI,useExisting:n}]),Xt]}),n})(),AF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,I7,ua,Zi,yo]}),n})();class kh{static computeIconFilenameForService(t){return t.ptMode.computePublicTransportPictogram()}static computeIconFilenameForLeg(t){if("TransferLeg"===t.legType)return"picto-walk";if("TimedLeg"===t.legType)return kh.computeIconFilenameForService(t.service);if("ContinousLeg"===t.legType){const e=t;return e.isDriveCarLeg()?"car-sharing":e.isSharedMobility()?"velo-scooter-sharing":e.isTaxi()?"taxi":"car-shuttle-train"===e.legTransportMode?"autozug":"car-ferry"===e.legTransportMode?"ferry":"picto-walk"}return"picto-bus-fallback"}static updateLocationDataWithTime(t,e,i=!1){["Arr","Dep"].forEach(s=>{const u="Arr"===s,m=u?e.arrivalData:e.departureData;if(null===m)return;const y=wa.formatTimeHHMM(m.timetableTime);u?t.arrText=y:t.depText=y;const C=m.delayMinutes;if(C){const I=[];I.push(" "),I.push(C>0?"+":""),I.push(""+C),I.push("'");const A=I.join("");u?t.arrDelayText=A:t.depDelayText=A}}),t.platformText=e.plannedPlatform,t.actualPlatformText=e.actualPlatform,null!==t.actualPlatformText&&t.platformText===t.actualPlatformText&&(t.actualPlatformText=null),t.geoPosition=e.location.geoPosition,t.isNotServicedStop=!0===e.isNotServicedStop}static computeSituationsData(t){const e=[];return t.forEach(i=>{const r=i.situationContentV1;null!==r&&e.push({summary:r.summary,descriptions:r.descriptions,details:r.details})}),e}}let NS=(()=>{class n{constructor(){this.tripInfoResultUpdated=new tn,this.locationSelected=new tn}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function $7(n,t){1&n&&ra(0)}function q7(n,t){if(1&n&&(X(0,"div")(1,"div"),Ce(2),Y()()),2&n){const e=St(2).$implicit;ae(2),wi("Pl. ",e.platformText,"")}}function G7(n,t){if(1&n&&(X(0,"div")(1,"div"),Ce(2,"Pl. "),X(3,"del"),Ce(4),Y(),X(5,"span",7),Ce(6),Y()()()),2&n){const e=St(2).$implicit;ae(4),wi(" ",e.platformText,""),ae(2),wi(" ",e.actualPlatformText,"")}}function W7(n,t){if(1&n&&(X(0,"div",11),ft(1,q7,3,1,"div",12),ft(2,G7,7,2,"div",12),Y()),2&n){const e=St().$implicit;ae(1),Le("ngIf",null===e.actualPlatformText),ae(1),Le("ngIf",null!==e.actualPlatformText)}}function X7(n,t){if(1&n){const e=zr();X(0,"tr",5),Ft("click",function(){const s=si(e).$implicit;return fi(St(2).zoomToLocation(s))}),X(1,"td",6)(2,"span"),Ce(3),Y(),X(4,"span",7),Ce(5),Y()(),X(6,"td",6)(7,"span"),Ce(8),Y(),X(9,"span",7),Ce(10),Y()(),X(11,"td",8)(12,"div",9),Ce(13),Y(),ft(14,W7,3,2,"div",10),Y()()}if(2&n){const e=t.$implicit;ae(3),An(e.arrText),ae(2),An(e.arrDelayText),ae(3),An(e.depText),ae(2),An(e.depDelayText),ae(3),An(e.locationText),ae(1),Le("ngIf",null!==e.platformText)}}function Z7(n,t){if(1&n&&(X(0,"table",2)(1,"thead")(2,"tr")(3,"th",3),Ce(4,"Arr"),Y(),X(5,"th",3),Ce(6,"Dep"),Y(),X(7,"th",3),Ce(8,"Stop"),Y()()(),X(9,"tbody"),ft(10,X7,15,6,"tr",4),Y()()),2&n){const e=St();ae(10),Le("ngForOf",e.stopPointsData)}}let Y7=(()=>{class n{constructor(){this.stopPointsData=[],this.locationSelected=new tn}ngOnInit(){}ngAfterViewInit(){}zoomToLocation(e){this.locationSelected.emit(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["service-stops"]],inputs:{stopPointsData:"stopPointsData"},outputs:{locationSelected:"locationSelected"},decls:3,vars:1,consts:[[4,"ngTemplateOutlet"],["variant2",""],[1,"table","table-hover","mb-0"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"fit","stop-time"],[1,"time-delay"],[1,"stop-info","d-flex"],[1,"flex-grow-1"],["class","d-flex gap-2",4,"ngIf"],[1,"d-flex","gap-2"],[4,"ngIf"]],template:function(e,i){1&e&&(ft(0,$7,1,0,"ng-container",0),ft(1,Z7,11,1,"ng-template",null,1,hh)),2&e&&Le("ngTemplateOutlet",va(2))},dependencies:[Sl,ho,tv],styles:[".table[_ngcontent-%COMP%]   td.fit[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th.fit[_ngcontent-%COMP%]{white-space:nowrap;width:1%}.time-departure[_ngcontent-%COMP%]{font-weight:700;font-size:16px}.stop-info[_ngcontent-%COMP%]{font-size:16px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}"]}),n})();function K7(n,t){if(1&n){const e=zr();X(0,"div")(1,"div",1)(2,"div",2)(3,"div"),en(4,"img",3),Y(),X(5,"div",4),Ce(6),Y(),X(7,"div",5),Ce(8),Y(),X(9,"div",6),Ce(10),Y()(),X(11,"h2",7),Ce(12),Y(),X(13,"div",8)(14,"service-stops",9),Ft("locationSelected",function(r){return si(e),fi(St().onLocationSelected(r))}),Y()(),X(15,"div",10),Ce(16,"Permalink: "),X(17,"a",11),Ce(18),Y()()()()}if(2&n){const e=St();ae(4),oa("src",e.model.serviceIconPath,_a),ae(2),An(e.model.serviceLineText),ae(2),An(e.model.serviceTripId),ae(2),wi("(",e.model.serviceOperator,")"),ae(2),wx("",e.model.serviceFromText," \u2192 ",e.model.serviceToText,""),ae(2),Le("stopPointsData",e.model.stopPointsData),ae(3),Le("href","./trip?ref="+e.model.journeyRef,_a),ae(1),An(e.model.journeyRef)}}let kF=(()=>{class n{constructor(e){this.tripInfoService=e,this.model={},this.model.tripInfoResult=null,this.model.stopPointsData=[]}ngOnInit(){this.tripInfoService.tripInfoResultUpdated.subscribe(e=>{this.updatePageModel(e)})}ngAfterViewInit(){}updatePageModel(e){var i,r,s,u,m,y;if(this.model.tripInfoResult=e,null===e)return;const C=null!==(i=e.service)&&void 0!==i?i:null;if(null===C||e.stopPoints.length<2)return;this.model.journeyRef=C.journeyRef,this.model.serviceFromText=null!==(r=e.stopPoints[0].location.computeLocationName())&&void 0!==r?r:"n/a (from)",this.model.serviceToText=null!==(s=e.stopPoints[e.stopPoints.length-1].location.computeLocationName())&&void 0!==s?s:"n/a (from)",this.model.serviceLineText=null!==(u=C.serviceLineNumber)&&void 0!==u?u:"n/a (serviceLineNumber)",this.model.serviceTripId=null!==(m=C.journeyNumber)&&void 0!==m?m:"n/a (journeyNumber)",this.model.serviceOperator=null!==(y=C.agencyID)&&void 0!==y?y:"n/a (agencyID)";const B=kh.computeIconFilenameForService(C);this.model.serviceIconPath="assets/pictograms/"+B+".png",this.model.stopPointsData=(()=>{const j=[];return e.stopPoints.forEach(K=>{var pe;const Se={locationText:null!==(pe=K.location.computeLocationName())&&void 0!==pe?pe:"n/a"};kh.updateLocationDataWithTime(Se,K),j.push(Se)}),j})()}onLocationSelected(e){this.tripInfoService.locationSelected.emit(e)}}return n.\u0275fac=function(e){return new(e||n)(H(NS))},n.\u0275cmp=mn({type:n,selectors:[["trip-info-result"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"px-3"],[1,"d-flex","align-items-center","gap-2","mt-3"],[1,"leg-icon",3,"src"],[1,"service-line-number"],[1,"service-trip-id"],[1,"service-operator"],[1,"mt-3"],[1,"p-1"],[3,"stopPointsData","locationSelected"],[1,"mt-3","mb-2"],["target","_blank",3,"href"]],template:function(e,i){1&e&&ft(0,K7,19,9,"div",0),2&e&&Le("ngIf",null!==i.model.tripInfoResult)},dependencies:[ho,Y7],styles:[".leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.service-line-number[_ngcontent-%COMP%]{font-size:20px;font-weight:700}"]}),n})();function Q7(n,t){1&n&&(X(0,"div",7)(1,"div",8)(2,"span",9),Ce(3,"Loading..."),Y()(),X(4,"div"),Ce(5,"fetching OJP TripInfoRequest ..."),Y()())}function J7(n,t){if(1&n&&(X(0,"div",10),Ce(1),Y()),2&n){const e=St();ae(1),wi(" ",e.model.errorMessage," ")}}let e9=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.tripInfoService=i,this.languageService=r,this.model={},this.model.title="TripInfoResult",this.model.errorMessage=null,this.model.isFetching=!1}fetchJourneyRef(e){return Ke(this,void 0,void 0,function*(){this.model.title="JourneyRef: "+e;const i=this.userTripService.getStageConfig(),r=gd.initWithJourneyRef(i,this.languageService.language,e);this.model.isFetching=!0;const s=yield r.fetchResponse();if(this.model.isFetching=!1,null===s.tripInfoResult)return console.error("fetchJourneyRef - error"),console.log(e),void(this.model.errorMessage="ERROR while fetching the TripInfoRequest, check console for more details.");this.tripInfoService.tripInfoResultUpdated.emit(s.tripInfoResult)})}}return n.\u0275fac=function(e){return new(e||n)(H(Sa),H(NS),H(bd))},n.\u0275cmp=mn({type:n,selectors:[["trip-info-result-popover"]],decls:10,vars:3,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["class","p-2 d-flex gap-2",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],[1,"p-2","d-flex","gap-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"],["role","alert",1,"alert","alert-danger"]],template:function(e,i){1&e&&(X(0,"div",0),Ce(1),Y(),X(2,"div",1)(3,"div",2),ft(4,Q7,6,0,"div",3),ft(5,J7,2,1,"div",4),en(6,"trip-info-result"),Y()(),X(7,"div",5)(8,"button",6),Ce(9," Close "),Y()()),2&e&&(ae(1),An(i.model.title),ae(3),Le("ngIf",i.model.isFetching),ae(1),Le("ngIf",i.model.errorMessage))},dependencies:[ho,Qp,Bm,zm,Vm,kF],encapsulation:2}),n})();const t9=["tooltip"];function n9(n,t){1&n&&ra(0)}function i9(n,t){if(1&n&&(na(0),ft(1,n9,1,0,"ng-container",7),ia()),2&n){const e=t.ngIf;ae(1),Le("ngTemplateOutlet",e)}}function r9(n,t){1&n&&Ce(0),2&n&&An(St().message)}function o9(n,t){if(1&n){const e=zr();X(0,"button",8),Ft("click",function(){return si(e),fi(St().hide(0))}),en(1,"sbb-icon",9),Y()}}function s9(n,t){1&n&&Pr(0)}const a9=["*"],cI="tooltip-panel",RF=Up({passive:!0}),PF=new It("sbb-tooltip-scroll-strategy"),d9={provide:PF,deps:[jo],useFactory:function u9(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},h9=new It("sbb-tooltip-default-options",{providedIn:"root",factory:function p9(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500,autoFocus:!0,restoreFocus:!0}}});class LF{constructor(t){this.instance=t}}let f9=(()=>{class n{constructor(e,i,r,s,u,m,y,C,I,A,B){this._overlay=e,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=s,this._ngZone=u,this._platform=m,this._ariaDescriber=y,this._focusMonitor=C,this._defaultOptions=A,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="sbb",this.trigger="hover",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this.tooltipPanelClass="",this._passiveListeners=[],this._destroyed=new Kt,this.opened=new tn,this.dismissed=new tn,this._scrollStrategy=I,this._document=B,null!=A&&A.touchGestures&&(this.touchGestures=A.touchGestures)}get disabled(){return this._disabled}set disabled(e){this._disabled=Hn(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=Th(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=Th(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){"string"==typeof this._message&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=e instanceof eo?e:null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),"string"==typeof this._message&&this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this._message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_preventClickBubbling(e){!this.disabled&&"click"===this.trigger&&e.stopPropagation()}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Tr(()=>"hover"===this.trigger),Oi(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{e.removeEventListener(i,r,RF)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),"string"==typeof this._message&&this._ariaDescriber.removeDescription(e,this._message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay){var i,r;if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const s=this._createOverlay();this._detach(),this._portal=this._portal||new dd(this._tooltipComponent,this._viewContainerRef),this._tooltipInstance=s.attach(this._portal).instance,this._tooltipInstance._triggerElement=this._elementRef.nativeElement,this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay,this.message instanceof eo&&this._ariaDescriber.describe(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._tooltipInstance.afterShown().pipe(Oi(this._destroyed)).subscribe(()=>this.opened.emit(new LF(this))),this._tooltipInstance.afterHidden().pipe(Oi(this._destroyed)).subscribe(()=>{this.dismissed.emit(new LF(this)),this._detach()}),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),"click"===this.trigger?(this._tooltipInstance._config={autoFocus:null===(i=this._defaultOptions.autoFocus)||void 0===i||i,restoreFocus:null===(r=this._defaultOptions.restoreFocus)||void 0===r||r},this._tooltipInstance._initializeWithAttachedContent(),this._tooltipInstance._triggeredByClick=!0):(this._tooltipInstance._config=void 0,this._tooltipInstance._triggeredByClick=!1),this._tooltipInstance.show(e)}hide(e=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(e)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){var e;if(this._overlayRef)return this._overlayRef;const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=`${this._cssClassPrefix}-${cI}-`,s=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i).withPositions([{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:2},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top",offsetX:5,offsetY:2,panelClass:`${r}left`},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetX:-5,offsetY:2,panelClass:`${r}right`},{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-2},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",offsetX:5,offsetY:-2,panelClass:`${r}left`},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetX:-5,offsetY:-2,panelClass:`${r}right`}]);return s.positionChanges.pipe(Oi(this._destroyed)).subscribe(u=>{this._updateCurrentPositionClass(u.connectionPair),this._tooltipInstance&&u.scrollableViewProperties.isOriginOutsideView&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({positionStrategy:s,panelClass:_D(this.tooltipPanelClass).concat(`${this._cssClassPrefix}-${cI}`),scrollStrategy:this._scrollStrategy()}),this._overlayRef.detachments().pipe(Oi(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.keydownEvents().pipe(Oi(this._destroyed)).subscribe(u=>{this._isTooltipVisible()&&27===u.keyCode&&!ca(u)&&(u.preventDefault(),u.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._overlayRef.outsidePointerEvents().pipe(Oi(this._destroyed)).subscribe(()=>{var u;return null===(u=this._tooltipInstance)||void 0===u?void 0:u._handleBodyInteraction()}),!(null===(e=this._defaultOptions)||void 0===e)&&e.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&(this.message instanceof eo&&this._tooltipInstance&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._overlayRef.detach()),this._tooltipInstance=null}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(jr(1),Oi(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_updateCurrentPositionClass(e){const{overlayY:i,originX:r,originY:s}=e;let u;if(u="center"===i?"start"===r?"left":"right":"bottom"===i&&"top"===s?"above":"below",u!==this._currentPosition){const m=this._overlayRef;if(m){const y=`${this._cssClassPrefix}-${cI}-`;m.removePanelClass(y+this._currentPosition),m.addPanelClass(y+u)}this._currentPosition=u}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||("click"===this.trigger?this._passiveListeners.push(["click",()=>this.show(0)]):this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{var r;const s=i.relatedTarget;(!s||null===(r=this._overlayRef)||void 0===r||!r.overlayElement.contains(s))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,RF)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(e.clientX,e.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const i=this._elementRef.nativeElement,r=i.style;("on"===e||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===e||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(e){nu()},n.\u0275dir=Bt({type:n,hostBindings:function(e,i){1&e&&Ft("click",function(s){return i._preventClickBubbling(s)})},inputs:{trigger:["sbbTooltipTrigger","trigger"],disabled:["sbbTooltipDisabled","disabled"],showDelay:["sbbTooltipShowDelay","showDelay"],hideDelay:["sbbTooltipHideDelay","hideDelay"],touchGestures:["sbbTooltipTouchGestures","touchGestures"],message:["sbbTooltip","message"],tooltipClass:["sbbTooltipClass","tooltipClass"],tooltipPanelClass:["sbbTooltipPanelClass","tooltipPanelClass"]},outputs:{opened:"opened",dismissed:"dismissed"}}),n})(),OF=(()=>{class n extends f9{constructor(e,i,r,s,u,m,y,C,I,A,B){super(e,i,r,s,u,m,y,C,I,A,B),this._tooltipComponent=g9}}return n.\u0275fac=function(e){return new(e||n)(H(jo),H(En),H(PO),H(zo),H(Xn),H(ps),H(gO),H(xa),H(PF),H(h9,8),H(Gn))},n.\u0275dir=Bt({type:n,selectors:[["","sbbTooltip",""]],hostVars:3,hostBindings:function(e,i){2&e&&(fn("aria-expanded","click"===i.trigger?i._isTooltipVisible():null),Li("sbb-tooltip-trigger","click"===i.trigger))},exportAs:["sbbTooltip"],features:[Xt]}),n})(),m9=(()=>{class n{constructor(e,i,r,s,u,m){this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=r,this._focusMonitor=s,this._visibility="initial",this._closeInteractionType=null,this._config={},this._closeOnInteraction=!1,this._elementFocusedBeforeDialogWasOpened=null,this._isVisible=!1,this._onShow=new Kt,this._onHide=new Kt,this._triggeredByClick=!1,this._animationsDisabled="NoopAnimations"===m,this._document=u}show(e){clearTimeout(this._hideTimeoutId),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._showTimeoutId=void 0,this._toggleVisibility(!0)},e)}hide(e){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0,this._markForCheck()},e)}afterShown(){return this._onShow}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onShow.complete(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){!this._triggeredByClick&&(!e||!this._triggerElement.contains(e))&&this.hide(this._mouseLeaveHideDelay)}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next(),e&&this.isVisible()&&this._config&&this._trapFocus(),!e&&!this.isVisible()&&this._restoreFocus()}_toggleVisibility(e){const i=this._tooltip.nativeElement,r=this._showAnimation,s=this._hideAnimation;if(i.classList.remove(e?s:r),i.classList.add(e?r:s),this._isVisible=e,e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const u=getComputedStyle(i);("0s"===u.getPropertyValue("animation-duration")||"none"===u.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow.next(),this._animationsDisabled&&(i.classList.add("_sbb-animation-noopable"),this._finalizeAnimation(e))}_trapFocus(){var e;null!==(e=this._config)&&void 0!==e&&e.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){var e;const i=this._elementFocusedBeforeDialogWasOpened;if((null===(e=this._config)||void 0===e?void 0:e.restoreFocus)&&i&&"function"==typeof i.focus){const r=du(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null)}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=du())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=du();return e===i||e.contains(i)}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(SO),H(Cr),H(xa),H(Gn,8),H(rd,8))},n.\u0275dir=Bt({type:n}),n})(),g9=(()=>{class n extends m9{constructor(e,i,r,s,u,m,y){super(e,i,r,s,u,y),this._breakpointObserver=m,this._isHandset=this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait), (max-width: 1024.99px) and (orientation: landscape)"),this._showAnimation="sbb-tooltip-container-show",this._hideAnimation="sbb-tooltip-container-hide"}get _templateRef(){return this.message instanceof eo?this.message:null}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(SO),H(Cr),H(xa),H(Gn,8),H(yD),H(rd,8))},n.\u0275cmp=mn({type:n,selectors:[["sbb-tooltip-component"]],viewQuery:function(e,i){if(1&e&&cr(t9,7),2&e){let r;Fn(r=Nn())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true",1,"sbb-tooltip-component"],hostVars:2,hostBindings:function(e,i){1&e&&Ft("mouseleave",function(s){return i._handleMouseLeave(s)}),2&e&&td("zoom",i.isVisible()?1:null)},features:[Xt],decls:9,vars:10,consts:[[1,"sbb-tooltip-container",3,"animationend"],["tooltip",""],[1,"sbb-tooltip",3,"ngClass"],[1,"sbb-tooltip-content"],[4,"ngIf","ngIfElse"],["stringMessage",""],["type","button","class","sbb-tooltip-icon sbb-tooltip-close-button sbb-icon-fit sbb-button-reset-frameless",3,"click",4,"ngIf"],[4,"ngTemplateOutlet"],["type","button",1,"sbb-tooltip-icon","sbb-tooltip-close-button","sbb-icon-fit","sbb-button-reset-frameless",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){if(1&e&&(X(0,"div",0,1),Ft("animationend",function(s){return i._handleAnimationEnd(s)}),Mb(2,"async"),X(3,"div",2)(4,"div",3),ft(5,i9,2,1,"ng-container",4),ft(6,r9,1,1,"ng-template",null,5,hh),Y(),ft(8,o9,2,0,"button",6),Y()()),2&e){const r=va(7);let s;Li("sbb-tooltip-handset",null==(s=Ab(2,8,i._isHandset))?null:s.matches),ae(3),Li("sbb-tooltip-has-close-button",i._triggeredByClick),Le("ngClass",i.tooltipClass),ae(2),Le("ngIf",i._templateRef)("ngIfElse",r),ae(3),Le("ngIf",i._triggeredByClick)}},dependencies:[Ob,ho,tv,Qa,nv],styles:['.sbb-tooltip-component{display:block;filter:drop-shadow(0 var(--sbb-box-shadow-width) 0 var(--sbb-box-shadow-color))}.sbb-tooltip-container{height:100%;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);opacity:0}.sbb-tooltip-container._sbb-animation-noopable{animation:none;opacity:1}.sbb-tooltip-container::after,.sbb-tooltip-container::before{top:calc(.5*var(--sbb-border-width));left:0;right:0;margin-left:auto;margin-right:auto;content:"";height:var(--sbb-tooltip-content-arrow-size);width:var(--sbb-tooltip-content-arrow-size);position:absolute;pointer-events:none;transform:rotate(45deg);border:var(--sbb-border-width) solid rgba(0,0,0,0)}.sbb-tooltip-panel-above .sbb-tooltip-container::after,.sbb-tooltip-panel-above .sbb-tooltip-container::before{top:auto;bottom:calc(.5*var(--sbb-tooltip-shadow-arrow-size));transform:rotate(225deg)}.sbb-tooltip-panel-left .sbb-tooltip-container::after,.sbb-tooltip-panel-left .sbb-tooltip-container::before{margin-right:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-panel-right .sbb-tooltip-container::after,.sbb-tooltip-panel-right .sbb-tooltip-container::before{margin-left:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-container::before{border-color:var(--sbb-color-weak-accent);z-index:1}.sbb-tooltip-container::after{background-color:var(--sbb-tooltip-background-color);background-clip:padding-box;z-index:2;--sbb-tooltip-arrow-padding-offset: 0rem;clip-path:polygon(0 0, calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)) 0, 0 calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)))}html.sbb-lean .sbb-tooltip-container::after{--sbb-tooltip-arrow-padding-offset: 0.0666666667rem}.sbb-tooltip-panel-above .sbb-tooltip-container{margin-bottom:calc(0.8rem * var(--sbb-scaling-factor))}@keyframes sbb-tooltip-container-show{0%{opacity:0}100%{opacity:1}}@keyframes sbb-tooltip-container-hide{0%{opacity:1}100%{opacity:0}}.sbb-tooltip-container-show{animation:sbb-tooltip-container-show var(--sbb-transition-duration-fast) cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip-container-hide{animation:sbb-tooltip-container-hide 75ms cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip{max-width:calc(30.6666666667rem * var(--sbb-scaling-factor));padding:var(--sbb-tooltip-padding);position:relative;overflow:hidden;color:var(--sbb-color-granite);text-overflow:ellipsis;background-color:var(--sbb-tooltip-background-color);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);z-index:2}.cdk-high-contrast-active .sbb-tooltip{outline:solid 1px}.sbb-tooltip-panel-below .sbb-tooltip{margin-top:var(--sbb-tooltip-arrow-offset)}:where(html.sbb-lean) .sbb-tooltip{color:var(--sbb-color-text)}.sbb-tooltip-zero-padding{--sbb-tooltip-padding: 0}.sbb-tooltip-has-close-button{padding-right:calc(4.7333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tooltip-has-close-button{padding-right:3.2rem}.sbb-tooltip-zero-padding .sbb-tooltip-has-close-button{padding-right:0}.sbb-tooltip-close-button{color:var(--sbb-color-weak-accent);position:absolute;width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);top:var(--sbb-tooltip-padding);right:var(--sbb-tooltip-padding);line-height:0}:where(html:not(.sbb-lean)) .sbb-tooltip-close-button{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%}.sbb-tooltip-panel-non-interactive{pointer-events:none}'],encapsulation:2,changeDetection:0}),n})();const b9=Ka(class{});let _9=1,FF=(()=>{class n extends b9{constructor(){super(...arguments),this.id="sbb-tooltip-id-"+_9++,this.trigger="click",this._destroyed=new Kt,this.svgIcon="kom:circle-question-mark-small",this.opened=new tn,this.dismissed=new tn}get hoverShowDelay(){return this._hoverShowDelay}set hoverShowDelay(e){this._hoverShowDelay=Th(e,0)}get hoverHideDelay(){return this._hoverHideDelay}set hoverHideDelay(e){this._hoverHideDelay=Th(e,0)}ngOnInit(){this._tooltip.opened.pipe(Oi(this._destroyed)).subscribe(e=>this.opened.emit(e)),this._tooltip.dismissed.pipe(Oi(this._destroyed)).subscribe(e=>this.dismissed.emit(e))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}show(){this._tooltip.show(0)}hide(){this._tooltip.hide(0)}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275cmp=mn({type:n,selectors:[["sbb-tooltip"]],viewQuery:function(e,i){if(1&e&&cr(OF,7),2&e){let r;Fn(r=Nn())&&(i._tooltip=r.first)}},hostAttrs:[1,"sbb-tooltip-wrapper"],hostVars:2,hostBindings:function(e,i){2&e&&fn("id",i.id)("aria-expanded",i._tooltip._isTooltipVisible())},inputs:{disabled:"disabled",id:"id",trigger:"trigger",hoverShowDelay:"hoverShowDelay",hoverHideDelay:"hoverHideDelay",svgIcon:"svgIcon",sbbTooltipClass:"sbbTooltipClass",sbbTooltipPanelClass:"sbbTooltipPanelClass"},outputs:{opened:"opened",dismissed:"dismissed"},features:[Xt],ngContentSelectors:a9,decls:5,vars:9,consts:[["type","button",1,"sbb-tooltip-icon","sbb-tooltip-trigger","sbb-icon-scaled","sbb-button-reset-frameless",3,"sbbTooltip","sbbTooltipTrigger","sbbTooltipShowDelay","sbbTooltipHideDelay","sbbTooltipClass","sbbTooltipPanelClass","click"],["tooltip","sbbTooltip"],[3,"svgIcon"],["tooltipTemplate",""]],template:function(e,i){if(1&e){const r=zr();Ro(),X(0,"button",0,1),Ft("click",function(){return si(r),fi(va(1).show(0))}),en(2,"sbb-icon",2),Y(),ft(3,s9,1,0,"ng-template",null,3,hh)}if(2&e){const r=va(1),s=va(4);Li("sbb-tooltip-trigger-active",r._isTooltipVisible()),Le("sbbTooltip",s)("sbbTooltipTrigger",i.trigger)("sbbTooltipShowDelay",i.hoverShowDelay)("sbbTooltipHideDelay",i.hoverHideDelay)("sbbTooltipClass",i.sbbTooltipClass)("sbbTooltipPanelClass",i.sbbTooltipPanelClass),ae(2),Le("svgIcon",i.svgIcon)}},dependencies:[Qa,OF],encapsulation:2,changeDetection:0}),n})(),NF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[d9],imports:[Rm,pr,Cl,ua,Zi,yo,Lm]}),n})();function y9(n,t){if(1&n){const e=zr();X(0,"div",16)(1,"div",17),Ft("click",function(){return si(e),fi(St().handleTapOnLegHeading())}),Ce(2,"MAP"),Y()()}}function v9(n,t){1&n&&ra(0)}function x9(n,t){1&n&&ra(0)}function w9(n,t){1&n&&ra(0)}function S9(n,t){if(1&n&&(X(0,"div")(1,"div"),Ce(2),Y()()),2&n){const e=St(3);ae(2),wi(", Pl. ",e.legInfoDataModel.fromLocationData.platformText,"")}}function C9(n,t){if(1&n&&(X(0,"div")(1,"div"),Ce(2,", Pl. "),X(3,"del"),Ce(4),Y(),X(5,"span",24),Ce(6),Y()()()),2&n){const e=St(3);ae(4),wi(" ",e.legInfoDataModel.fromLocationData.platformText,""),ae(2),wi(" ",e.legInfoDataModel.fromLocationData.actualPlatformText,"")}}function T9(n,t){if(1&n&&(X(0,"div"),ft(1,S9,3,1,"div",21),ft(2,C9,7,2,"div",21),Y()),2&n){const e=St(2);ae(1),Le("ngIf",!e.legInfoDataModel.fromLocationData.actualPlatformText),ae(1),Le("ngIf",e.legInfoDataModel.fromLocationData.actualPlatformText)}}function E9(n,t){1&n&&(X(0,"div")(1,"span",29),Ce(2,"not serviced"),Y()())}function D9(n,t){if(1&n&&en(0,"img",30),2&n){const e=St(2);oa("src",e.legInfoDataModel.fromLocationData.platformAssistanceIconPath,_a),oa("title",e.legInfoDataModel.fromLocationData.platformAssistanceTooltip)}}function I9(n,t){if(1&n&&(X(0,"span"),Ce(1),Y()),2&n){const e=St(2);ae(1),An(e.legInfoDataModel.fromLocationData.depText)}}function M9(n,t){if(1&n&&(X(0,"span")(1,"del"),Ce(2),Y()()),2&n){const e=St(2);ae(2),An(e.legInfoDataModel.fromLocationData.depText)}}function A9(n,t){1&n&&ra(0)}function k9(n,t){if(1&n&&(X(0,"div")(1,"div"),Ce(2),Y()()),2&n){const e=St(3);ae(2),wi(", Pl. ",e.legInfoDataModel.toLocationData.platformText,"")}}function R9(n,t){if(1&n&&(X(0,"div")(1,"div"),Ce(2,", Pl. "),X(3,"del"),Ce(4),Y(),X(5,"span",24),Ce(6),Y()()()),2&n){const e=St(3);ae(4),wi(" ",e.legInfoDataModel.toLocationData.platformText,""),ae(2),wi(" ",e.legInfoDataModel.toLocationData.actualPlatformText,"")}}function P9(n,t){if(1&n&&(X(0,"div"),ft(1,k9,3,1,"div",21),ft(2,R9,7,2,"div",21),Y()),2&n){const e=St(2);ae(1),Le("ngIf",!e.legInfoDataModel.toLocationData.actualPlatformText),ae(1),Le("ngIf",e.legInfoDataModel.toLocationData.actualPlatformText)}}function L9(n,t){1&n&&(X(0,"div")(1,"span",29),Ce(2,"not serviced"),Y()())}function O9(n,t){if(1&n&&en(0,"img",30),2&n){const e=St(2);oa("src",e.legInfoDataModel.toLocationData.platformAssistanceIconPath,_a),oa("title",e.legInfoDataModel.toLocationData.platformAssistanceTooltip)}}function F9(n,t){if(1&n&&(X(0,"span"),Ce(1),Y()),2&n){const e=St(2);ae(1),An(e.legInfoDataModel.toLocationData.arrText)}}function N9(n,t){if(1&n&&(X(0,"span")(1,"del"),Ce(2),Y()()),2&n){const e=St(2);ae(2),An(e.legInfoDataModel.toLocationData.arrText)}}function B9(n,t){if(1&n){const e=zr();X(0,"div",18)(1,"div",19),Ft("click",function(){return si(e),fi(St().handleClickOnLocation("From"))}),X(2,"div",20)(3,"div"),Ce(4),Y(),ft(5,T9,3,2,"div",21),Y(),ft(6,E9,3,0,"div",21),Y(),X(7,"div",22),ft(8,D9,1,2,"img",23),ft(9,I9,2,1,"span",21),ft(10,M9,3,1,"span",21),X(11,"span",24),Ce(12),Y()()(),X(13,"div",25)(14,"div",26),en(15,"div",27),Y(),ft(16,A9,1,0,"ng-container",28),X(17,"div",26),en(18,"div",27),Y()(),X(19,"div",18)(20,"div",19),Ft("click",function(){return si(e),fi(St().handleClickOnLocation("To"))}),X(21,"div",20)(22,"div"),Ce(23),Y(),ft(24,P9,3,2,"div",21),Y(),ft(25,L9,3,0,"div",21),Y(),X(26,"div",22),ft(27,O9,1,2,"img",23),ft(28,F9,2,1,"span",21),ft(29,N9,3,1,"span",21),X(30,"span",24),Ce(31),Y()()()}if(2&n){const e=St(),i=va(25);ae(4),An(e.legInfoDataModel.fromLocationData.locationText),ae(1),Le("ngIf",e.legInfoDataModel.fromLocationData.platformText),ae(1),Le("ngIf",e.legInfoDataModel.fromLocationData.isNotServicedStop),ae(2),Le("ngIf",null!==e.legInfoDataModel.fromLocationData.platformAssistanceIconPath),ae(1),Le("ngIf",!e.legInfoDataModel.fromLocationData.isNotServicedStop),ae(1),Le("ngIf",e.legInfoDataModel.fromLocationData.isNotServicedStop),ae(2),An(e.legInfoDataModel.fromLocationData.depDelayText),ae(4),Le("ngTemplateOutlet",i),ae(7),An(e.legInfoDataModel.toLocationData.locationText),ae(1),Le("ngIf",e.legInfoDataModel.toLocationData.platformText),ae(1),Le("ngIf",e.legInfoDataModel.toLocationData.isNotServicedStop),ae(2),Le("ngIf",null!==e.legInfoDataModel.toLocationData.platformAssistanceIconPath),ae(1),Le("ngIf",!e.legInfoDataModel.toLocationData.isNotServicedStop),ae(1),Le("ngIf",e.legInfoDataModel.toLocationData.isNotServicedStop),ae(2),An(e.legInfoDataModel.toLocationData.arrDelayText)}}function z9(n,t){if(1&n&&(X(0,"li"),Ce(1),Y()),2&n){const e=t.$implicit;ae(1),wi(" ",e," ")}}function V9(n,t){if(1&n&&(X(0,"sbb-tooltip",35)(1,"ul",36),ft(2,z9,2,1,"li",37),Y()()),2&n){const e=St(2);ae(2),Le("ngForOf",e.legInfoDataModel.guidanceTextLines)}}function j9(n,t){1&n&&(X(0,"div"),en(1,"div",38),Y())}function U9(n,t){if(1&n){const e=zr();X(0,"div",18)(1,"div",31)(2,"div",32)(3,"div",33),Ft("click",function(){return si(e),fi(St().handleClickOnLocation("From"))}),Ce(4),Y(),ft(5,V9,3,1,"sbb-tooltip",34),ft(6,j9,2,0,"div",21),X(7,"div",33),Ft("click",function(){return si(e),fi(St().handleClickOnLocation("To"))}),Ce(8),Y()()(),X(9,"div",22)(10,"div"),Ce(11),Y()()()}if(2&n){const e=St();ae(4),An(e.legInfoDataModel.fromLocationData.locationText),ae(1),Le("ngIf",e.legInfoDataModel.hasGuidance),ae(1),Le("ngIf",0==e.legInfoDataModel.hasGuidance),ae(2),An(e.legInfoDataModel.toLocationData.locationText),ae(3),An(e.legInfoDataModel.durationText)}}function H9(n,t){if(1&n&&(X(0,"li"),Ce(1," Book on "),X(2,"a",40),Ce(3),Y()()),2&n){const e=t.$implicit;ae(2),oa("href",e.infoURL,_a),ae(1),An(e.agencyName)}}function $9(n,t){if(1&n){const e=zr();X(0,"div",18)(1,"div",31)(2,"div",32)(3,"div",33),Ft("click",function(){return si(e),fi(St().handleClickOnLocation("From"))}),Ce(4),Y(),X(5,"ul",39),ft(6,H9,4,2,"li",37),Y(),X(7,"div",33),Ft("click",function(){return si(e),fi(St().handleClickOnLocation("To"))}),Ce(8),Y()()(),X(9,"div",22)(10,"div"),Ce(11),Y()()()}if(2&n){const e=St();ae(4),An(e.legInfoDataModel.fromLocationData.locationText),ae(2),Le("ngForOf",e.legInfoDataModel.bookingArrangements),ae(2),An(e.legInfoDataModel.toLocationData.locationText),ae(3),An(e.legInfoDataModel.durationText)}}function q9(n,t){if(1&n&&(X(0,"div")(1,"button",49),Ce(2),en(3,"i",50)(4,"i",51),Y()()),2&n){const e=St(2);ae(1),fn("data-bs-target","#"+e.legElementId)("aria-controls",e.legElementId),ae(1),wi("",e.legInfoDataModel.serviceIntermediaryStopsText," ")}}function G9(n,t){if(1&n&&(X(0,"div",52)(1,"sbb-tooltip",53)(2,"div"),Ce(3),Y()()()),2&n){const e=t.$implicit;ae(1),oa("svgIcon",e.icon),ae(2),wi(" ",e.caption," ")}}function W9(n,t){if(1&n&&(na(0),X(1,"div"),Ce(2),Y(),ia()),2&n){const e=St().$implicit;ae(2),wi(" ",e.descriptions[0]," ")}}function X9(n,t){if(1&n&&(X(0,"li"),Ce(1),Y()),2&n){const e=t.$implicit;ae(1),wi(" ",e," ")}}function Z9(n,t){if(1&n&&(na(0),X(1,"ul",36),ft(2,X9,2,1,"li",37),Y(),X(3,"h6"),Ce(4,"Detail"),Y(),ia()),2&n){const e=St().$implicit;ae(2),Le("ngForOf",e.descriptions)}}function Y9(n,t){if(1&n&&(X(0,"li"),Ce(1),Y()),2&n){const e=t.$implicit;ae(1),wi(" ",e," ")}}function K9(n,t){if(1&n&&(X(0,"div")(1,"sbb-tooltip",56)(2,"p")(3,"strong"),Ce(4),Y()(),ft(5,W9,3,1,"ng-container",21),ft(6,Z9,5,1,"ng-container",21),X(7,"ul",36),ft(8,Y9,2,1,"li",37),Y()()()),2&n){const e=t.$implicit;ae(4),An(e.summary),ae(1),Le("ngIf",1===e.descriptions.length),ae(1),Le("ngIf",e.descriptions.length>1),ae(2),Le("ngForOf",e.details)}}function Q9(n,t){if(1&n&&(X(0,"div",54)(1,"div",55),ft(2,K9,9,4,"div",37),Y()()),2&n){const e=St(2);ae(2),Le("ngForOf",e.legInfoDataModel.situations)}}function J9(n,t){1&n&&(X(0,"div")(1,"span",29),Ce(2,"not serviced"),Y()())}function eX(n,t){if(1&n&&(X(0,"div"),Ce(1),X(2,"span",24),Ce(3),Y()()),2&n){const e=St().$implicit;let i;ae(1),wi("",null!==(i=e.arrText)&&void 0!==i?i:"\u2000"," "),ae(2),An(e.arrDelayText)}}function tX(n,t){if(1&n&&(X(0,"div")(1,"del"),Ce(2),Y(),X(3,"span",24),Ce(4),Y()()),2&n){const e=St().$implicit;let i;ae(2),An(null!==(i=e.arrText)&&void 0!==i?i:"\u2000"),ae(2),An(e.arrDelayText)}}function nX(n,t){if(1&n&&(X(0,"div"),Ce(1),X(2,"span",24),Ce(3),Y()()),2&n){const e=St().$implicit;ae(1),wi("",e.depText," "),ae(2),An(e.depDelayText)}}function iX(n,t){if(1&n&&(X(0,"div")(1,"del"),Ce(2),Y(),X(3,"span",24),Ce(4),Y()()),2&n){const e=St().$implicit;ae(2),An(e.depText),ae(2),An(e.depDelayText)}}function rX(n,t){if(1&n&&(X(0,"tr")(1,"td")(2,"div",55)(3,"div"),Ce(4),Y(),ft(5,J9,3,0,"div",21),Y()(),X(6,"td",57),ft(7,eX,4,2,"div",21),ft(8,tX,5,2,"div",21),Y(),X(9,"td",58),ft(10,nX,4,2,"div",21),ft(11,iX,5,2,"div",21),Y()()),2&n){const e=t.$implicit;ae(4),An(e.locationText),ae(1),Le("ngIf",e.isNotServicedStop),ae(2),Le("ngIf",!e.isNotServicedStop),ae(1),Le("ngIf",e.isNotServicedStop),ae(2),Le("ngIf",!e.isNotServicedStop),ae(1),Le("ngIf",e.isNotServicedStop)}}function oX(n,t){if(1&n){const e=zr();X(0,"div",41)(1,"div")(2,"button",42),Ft("click",function(){si(e);const r=St();return fi(r.loadTripInfoResultPopover(r.legInfoDataModel.serviceJourneyRef))}),Ce(3),Y()(),X(4,"div"),Ce(5),Y()(),X(6,"div",43),ft(7,q9,5,3,"div",21),X(8,"div",44)(9,"div",41),ft(10,G9,4,2,"div",45),Y()(),ft(11,Q9,3,1,"div",46),Y(),X(12,"div",47)(13,"table",48)(14,"tbody"),ft(15,rX,12,6,"tr",37),Y()()()}if(2&n){const e=St();ae(3),An(e.legInfoDataModel.serviceInfo),ae(2),wi(" to ",e.legInfoDataModel.serviceDestinationText,""),ae(2),Le("ngIf",null!==e.legInfoDataModel.serviceIntermediaryStopsText),ae(3),Le("ngForOf",e.legInfoDataModel.serviceAttributes),ae(1),Le("ngIf",e.legInfoDataModel.hasSituations),ae(1),Le("id",e.legElementId),ae(3),Le("ngForOf",e.legInfoDataModel.intermediaryLocationsData)}}const sX=function(n,t){return{"background-color":n,"border-color":t}};let aX=(()=>{class n{constructor(e,i,r){this.mapService=e,this.router=i,this.tripInfoResultPopover=r,this.isLastLeg=!1,this.legElementId="n/a",this.legInfoDataModel={},this.isEmbed=-1!==this.router.url.indexOf("/embed/")}ngOnInit(){void 0===this.leg||void 0===this.legIdx||(this.legElementId="leg_"+this.legId,this.initLegInfo())}computeLegLeadingText(){if(void 0===this.leg||void 0===this.legIdx)return"n/a";const e=this.legIdx+1+". ";if("TransferLeg"===this.leg.legType){const i="Transfer",r=this.leg;let s="";return r.walkDuration&&(s=" "+r.walkDuration.formatDuration()),e+i+s}if("ContinousLeg"===this.leg.legType){const r=this.computeLegLeadingTextContinousLeg(this.leg);let s="";return this.leg.legDuration&&(s=" "+this.leg.legDuration.formatDuration()),e+r+" - "+s}if("TimedLeg"===this.leg.legType){const i=this.leg;let r=i.service.ptMode.name;i.service.ptMode.isDemandMode&&(r="OnDemand "+r);let s="";return this.leg.legDuration&&(s=" "+this.leg.legDuration.formatDuration()),e+r+" - "+s}return e+this.leg.legType}computeLegLeadingTextContinousLeg(e){return"walk"===e.legTransportMode?"Walk":e.isDriveCarLeg()?"Drive":e.isSharedMobility()?"Ride":e.isTaxi()?"others-drive-car"===e.legTransportMode?"Limo":"Taxi":"car-shuttle-train"===e.legTransportMode?"Ride Autoverladezug":"car-ferry"===e.legTransportMode?"Use Ferry":"PLACEHOLDER - NEW MOT?"}computeLegPillClassName(){return this.leg?"ContinousLeg"===this.leg.legType?"continous-leg-pill":"TimedLeg"===this.leg.legType?"timed-leg-pill":"TransferLeg"===this.leg.legType?"transfer-leg-pill":"":""}handleTapOnLegHeading(){if(!this.leg)return;const e=this.leg.computeGeoJSONFeatures(),i=pd.initFromGeoJSONFeatures(e);if(!i.isValid())return console.error("Invalid BBOX for leg"),void console.log(this.leg);const s={bounds:new(ks().LngLatBounds)(i.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(s)}computeLegColor(){var e,i;return null!==(i=null===(e=this.leg)||void 0===e?void 0:e.computeLegColor())&&void 0!==i?i:zv.TimedLeg}initLegInfo(){var e,i,r,s;if(void 0===this.leg)return;const u=this.leg;this.legInfoDataModel.legColor=this.computeLegColor(),this.legInfoDataModel.leadingText=this.computeLegLeadingText();const m="TransferLeg"===u.legType;this.legInfoDataModel.guidanceTextLines=[],m&&(null!==(i=null===(e=u.pathGuidance)||void 0===e?void 0:e.sections)&&void 0!==i?i:[]).forEach(j=>{var K,pe,Se,Xe,At,pt;if(null===j.guidanceAdvice)return;const kt=[null!==(K=j.guidanceAdvice)&&void 0!==K?K:"","(",null!==(pe=j.turnAction)&&void 0!==pe?pe:"",") - ",null!==(Xe=null===(Se=j.trackSection)||void 0===Se?void 0:Se.roadName)&&void 0!==Xe?Xe:""],yn=null!==(pt=null===(At=j.trackSection)||void 0===At?void 0:At.length)&&void 0!==pt?pt:0;yn>0&&(kt.push(" ("),kt.push(""+yn),kt.push("m)"));const kn=kt.join("");this.legInfoDataModel.guidanceTextLines.push(kn)});let y="TransferLeg"===u.legType;const C="ContinousLeg"===u.legType;if(C){const A=u;y=A.isWalking(),y&&(this.legInfoDataModel.distanceText=A.formatDistance())}this.legInfoDataModel.isWalking=y,this.legInfoDataModel.legTemplate=C&&u.isTaxi()?"taxi":"TimedLeg"===u.legType?"timed":"walk",this.legInfoDataModel.bookingArrangements=C?null===u.serviceBooking?[]:u.serviceBooking.bookingArrangements:[],this.legInfoDataModel.durationText=null!==(s=null===(r=u.legDuration)||void 0===r?void 0:r.formatDuration())&&void 0!==s?s:"",this.legInfoDataModel.hasGuidance=this.legInfoDataModel.guidanceTextLines.length>0;const I=kh.computeIconFilenameForLeg(u);if(this.legInfoDataModel.legIconPath="assets/pictograms/"+I+".png",this.legInfoDataModel.isTimed="TimedLeg"===u.legType,this.legInfoDataModel.fromLocationData=this.computeLocationData(u,"From"),this.legInfoDataModel.toLocationData=this.computeLocationData(u,"To"),this.legInfoDataModel.intermediaryLocationsData=(()=>{const A=[];return"TimedLeg"!==u.legType||u.intermediateStopPoints.forEach(j=>{var K;const pe={locationText:null!==(K=j.location.computeLocationName())&&void 0!==K?K:"n/a"};kh.updateLocationDataWithTime(pe,j),A.push(pe)}),A})(),this.legInfoDataModel.situations="TimedLeg"!==u.legType?[]:kh.computeSituationsData(u.service.siriSituations),this.legInfoDataModel.hasSituations=this.legInfoDataModel.situations.length>0,"TimedLeg"===u.legType){const A=u;this.legInfoDataModel.fromLocationData.platformAssistanceIconPath=this.computePlatformAssistanceIconPath(A,"From"),this.legInfoDataModel.fromLocationData.platformAssistanceTooltip=this.computePlatformAssistanceTooltip(A,"From"),this.legInfoDataModel.toLocationData.platformAssistanceIconPath=this.computePlatformAssistanceIconPath(A,"To"),this.legInfoDataModel.toLocationData.platformAssistanceTooltip=this.computePlatformAssistanceTooltip(A,"To")}var A,B;this.legInfoDataModel.serviceAttributes=this.computeServiceAttributeModel(u),this.legInfoDataModel.serviceDestinationText="TimedLeg"!==u.legType?null:null!==(B=null===(A=u.service.destinationStopPlace)||void 0===A?void 0:A.stopPlaceName)&&void 0!==B?B:"n/a",this.legInfoDataModel.serviceInfo=(()=>"TimedLeg"!==u.legType?null:this.formatServiceName(u))(),this.legInfoDataModel.serviceIntermediaryStopsText=(()=>{if("TimedLeg"!==u.legType)return null;const B=u.intermediateStopPoints.length;return 0===B?null:1===B?"1 stop":B+" stops"})(),this.legInfoDataModel.serviceInfo=(()=>"TimedLeg"!==u.legType?null:this.formatServiceName(u))(),this.legInfoDataModel.serviceJourneyRef="TimedLeg"!==u.legType?null:u.service.journeyRef}formatServiceName(e){var i,r,s;const u=e.service,m=[];return u.serviceLineNumber?(u.ptMode.isRail()||m.push(null!==(i=u.ptMode.shortName)&&void 0!==i?i:u.ptMode.ptMode),m.push(u.serviceLineNumber),m.push(null!==(r=u.journeyNumber)&&void 0!==r?r:"")):m.push(null!==(s=u.ptMode.shortName)&&void 0!==s?s:u.ptMode.ptMode),m.push("("+u.agencyID+")"),m.join(" ")}computeServiceAttributeModel(e){const i=[];if("TimedLeg"!==e.legType)return i;const r=e;for(const[s,u]of Object.entries(r.service.serviceAttributes)){const m=s.startsWith("ojp")?null:s.toLowerCase().startsWith("i_")||["sa-ba","ba","sa-hl","hl"].includes(s.toLowerCase())?"kom:circle-information-large":"fpl:sa-"+s.toLowerCase();null!==m&&i.push({icon:m,caption:u.text})}return i}computePlatformAssistanceIconPath(e,i){const r="From"===i?e.fromStopPoint:e.toStopPoint,s="PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===r.vehicleAccessType?"platform_independent":"PLATFORM_ACCESS_WITH_ASSISTANCE"===r.vehicleAccessType?"platform_help_driver":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===r.vehicleAccessType?"platform_advance_notice":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===r.vehicleAccessType?"platform_not_possible":"NO_DATA"===r.vehicleAccessType?"platform_no_information":null;return null===s?null:"assets/platform-assistance/"+s+".jpg"}computePlatformAssistanceTooltip(e,i){const r="From"===i?e.fromStopPoint:e.toStopPoint;return"PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===r.vehicleAccessType?"Step-free access; level entry/exit.":"PLATFORM_ACCESS_WITH_ASSISTANCE"===r.vehicleAccessType?"Step-free access; entry/exit through staff assistance, no prior registration necessary.":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===r.vehicleAccessType?"Step-free access; entry/exit through staff assistance, advance registration required.":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===r.vehicleAccessType?"Not usable for wheelchairs.":"No available information about vehicle access."}computeLocationData(e,i){var r;const s="From"===i,m={locationText:null!==(r=(s?e.fromLocation:e.toLocation).computeLocationName())&&void 0!==r?r:"",platformText:null,arrText:null,arrDelayText:null,depText:null,depDelayText:null};if("TimedLeg"===e.legType){const y=e;kh.updateLocationDataWithTime(m,s?y.fromStopPoint:y.toStopPoint)}return m}handleClickOnLocation(e){this.leg&&this.mapService.tryToCenterAndZoomToLocation("From"===e?this.leg.fromLocation:this.leg.toLocation)}loadTripInfoResultPopover(e){if(null===e)return void console.error("loadTripInfoResultPopover: cant fetch empty journeyRef");const i=this.tripInfoResultPopover.open(e9,{position:{top:"20px"}});i.afterOpened().subscribe(()=>{i.componentInstance.fetchJourneyRef(e)})}}return n.\u0275fac=function(e){return new(e||n)(H(mu),H(hs),H(tl))},n.\u0275cmp=mn({type:n,selectors:[["result-trip-leg"]],inputs:{leg:"leg",legId:"legId",legIdx:"legIdx",isLastLeg:"isLastLeg"},decls:26,vars:14,consts:[[1,"mb-2","d-flex","flex-row"],["type","button",1,"btn","btn-primary","btn-sm","font-weight-bold",3,"ngStyle","click"],["class","ms-auto",4,"ngIf"],[1,"mb-2","d-flex","flex-row","align-items-center"],[1,"flex-grow-0","leg-left-side"],[1,"d-flex","flex-column","leg-icon-wrapper"],[1,"text-center"],[1,"leg-icon",3,"src"],[1,"flex-grow-1"],[4,"ngIf","ngIfThen"],[1,"mb-2"],[1,"border-bottom",2,"height","8px"],["timedLegTemplate",""],["walkingLegTemplate",""],["taxiLegTemplate",""],["timedLegTemplateVariant2",""],[1,"ms-auto"],[1,"badge","leg-pill","pill-hover","bg-primary",3,"click"],[1,"d-flex","flex-row","align-items-center"],[1,"flex-grow-1","leg-location","location-hover",3,"click"],[1,"d-flex"],[4,"ngIf"],[1,"flex-grow-0","leg-time","leg-right-side"],["class","leg-platform-assistance",3,"src","title",4,"ngIf"],[1,"time-delay"],[1,"px-2"],[1,"d-flex","flex-row","align-items-center",2,"height","16px"],[1,"separator"],[4,"ngTemplateOutlet"],[1,"badge","rounded-pill","bg-danger","fw-bolder"],[1,"leg-platform-assistance",3,"src","title"],[1,"flex-grow-1","leg-location"],[1,"d-flex","flex-column","leg-location"],[1,"location-hover",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium",4,"ngIf"],["svgIcon","kom:arrow-change-horizontal-medium"],[1,"tooltip-list"],[4,"ngFor","ngForOf"],[1,"border-bottom",2,"height","8px","margin-left","4px","margin-right","8px"],[1,"booking-arrangement"],["target","_blank",3,"href"],[1,"d-flex","gap-1","align-items-center"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"d-flex","gap-2","align-items-center","mt-2"],[1,"service-attributes"],["class","service-attribute",4,"ngFor","ngForOf"],["class","mt-2",4,"ngIf"],[1,"py-2","collapse",3,"id"],[1,"table","table-hover","table-stops","mb-0","align-middle"],["type","button","data-bs-toggle","collapse","aria-expanded","false",1,"btn","btn-primary","btn-sm","btn-collapse","collapsed"],[1,"bi","bi-chevron-down"],[1,"bi","bi-chevron-up"],[1,"service-attribute"],[1,"sbb-icon-fit",3,"svgIcon"],[1,"mt-2"],[1,"d-flex","gap-2"],["svgIcon","fpl:info"],[1,"fit"],[1,"fit","stop-time"]],template:function(e,i){if(1&e&&(X(0,"div")(1,"div",0)(2,"button",1),Ft("click",function(){return i.handleTapOnLegHeading()}),Ce(3),Y(),ft(4,y9,3,0,"div",2),Y(),X(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6),en(9,"img",7),Y(),X(10,"div",6),Ce(11),Y()()(),X(12,"div",8),ft(13,v9,1,0,"ng-container",9),ft(14,x9,1,0,"ng-container",9),ft(15,w9,1,0,"ng-container",9),Y()(),X(16,"div",10),en(17,"div",11),Y()(),ft(18,B9,32,15,"ng-template",null,12,hh),ft(20,U9,12,5,"ng-template",null,13,hh),ft(22,$9,12,4,"ng-template",null,14,hh),ft(24,oX,16,7,"ng-template",null,15,hh)),2&e){const r=va(19),s=va(21),u=va(23);ae(2),Le("ngStyle",PA(11,sX,i.legInfoDataModel.legColor,i.legInfoDataModel.legColor)),ae(1),An(i.legInfoDataModel.leadingText),ae(1),Le("ngIf",!1===i.isEmbed),ae(5),oa("src",i.legInfoDataModel.legIconPath,_a),ae(2),An(i.legInfoDataModel.distanceText),ae(2),Le("ngIf","walk"==i.legInfoDataModel.legTemplate)("ngIfThen",s),ae(1),Le("ngIf","timed"==i.legInfoDataModel.legTemplate)("ngIfThen",r),ae(1),Le("ngIf","taxi"==i.legInfoDataModel.legTemplate)("ngIfThen",u)}},dependencies:[Sl,ho,tv,aR,FF],styles:[".font-weight-bold[_ngcontent-%COMP%]{font-weight:700}.pill-hover[_ngcontent-%COMP%]:hover, .location-hover[_ngcontent-%COMP%]:hover{cursor:pointer}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}.leg-left-side[_ngcontent-%COMP%]{width:50px}.leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.leg-location[_ngcontent-%COMP%]{background-color:transparent;margin-left:4px}.leg-time-wrapper[_ngcontent-%COMP%]{background-color:transparent}.leg-time[_ngcontent-%COMP%]{font-size:15px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}.booking-arrangement[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:4px}.booking-arrangement[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:0;padding-left:0}.leg-platform-assistance[_ngcontent-%COMP%]{width:30px}.separator[_ngcontent-%COMP%]{width:100%;height:1px;background-color:#dee2e6}.btn-collapse.collapsed[_ngcontent-%COMP%]   .bi-chevron-down[_ngcontent-%COMP%]{display:inline}.btn-collapse[_ngcontent-%COMP%]   .bi-chevron-down[_ngcontent-%COMP%], .btn-collapse.collapsed[_ngcontent-%COMP%]   .bi-chevron-up[_ngcontent-%COMP%]{display:none}.btn-collapse[_ngcontent-%COMP%]   .bi-chevron-up[_ngcontent-%COMP%]{display:inline}.intermediary-stops[_ngcontent-%COMP%]{font-size:14px}.table-stops[_ngcontent-%COMP%]{font-size:13px}.table-stops[_ngcontent-%COMP%]   td.fit[_ngcontent-%COMP%], .table-stops[_ngcontent-%COMP%]   th.fit[_ngcontent-%COMP%]{white-space:nowrap;width:1%}"]}),n})();function lX(n,t){1&n&&(X(0,"div")(1,"span",8),Ce(2,"Cancelled"),Y()())}function cX(n,t){1&n&&(X(0,"div")(1,"span",9),Ce(2,"Infeasable"),Y()())}function uX(n,t){if(1&n&&en(0,"result-trip-leg",10),2&n){const e=t.$implicit,i=t.index,r=St();let s;Le("leg",e)("legId",r.idx+"_"+i)("legIdx",i)("isLastLeg",r.idx===(null!==(s=null==r.trip||null==r.trip.legs?null:r.trip.legs.length)&&void 0!==s?s:1)-1)}}function dX(n,t){if(1&n&&(X(0,"li"),Ce(1),Y()),2&n){const e=t.$implicit;ae(1),AC(" Legs ",e.fromTripLegIdRef,"-",e.toTripLegIdRef," : ",e.fareProduct.price," CHF (",e.fareProduct.travelClass,") ")}}let hX=(()=>{class n{constructor(e,i){this.userTripService=e,this.mapService=i,this.tripHeaderStats={}}ngOnInit(){var e;this.trip&&this.initTripHeaderStats(this.trip),this.tripPanel&&0===this.idx&&this.tripPanel.open(),null===(e=this.tripPanel)||void 0===e||e.afterExpand.subscribe(r=>{this.trip&&(this.userTripService.selectActiveTrip(this.trip),this.mapService.zoomToTrip(this.trip))})}initTripHeaderStats(e){var i;this.tripHeaderStats.title="Trip "+((null!==(i=this.idx)&&void 0!==i?i:0)+1),this.tripHeaderStats.isCancelled=!0===e.stats.isCancelled,this.tripHeaderStats.isInfeasable=!0===e.stats.isInfeasable,this.tripHeaderStats.tripChangesInfo=0===e.stats.transferNo?"direct":1===e.stats.transferNo?e.stats.transferNo+" transfer":e.stats.transferNo+" transfers",this.tripHeaderStats.tripFromTime=wa.formatTimeHHMM(e.stats.startDatetime),this.tripHeaderStats.tripToTime=wa.formatTimeHHMM(e.stats.endDatetime),this.tripHeaderStats.tripDurationS=e.stats.duration.formatDuration(),this.tripHeaderStats.tripDistanceS=wa.formatDistance(e.stats.distanceMeters)}}return n.\u0275fac=function(e){return new(e||n)(H(Sa),H(mu))},n.\u0275cmp=mn({type:n,selectors:[["journey-result-row"]],viewQuery:function(e,i){if(1&e&&cr(Ah,7),2&e){let r;Fn(r=Nn())&&(i.tripPanel=r.first)}},inputs:{trip:"trip",idx:"idx"},decls:25,vars:11,consts:[[3,"hideToggle"],[1,"d-flex","justify-content-between","w-100","trip-info"],[1,"trip-info-header","d-flex","gap-1"],[4,"ngIf"],[1,"trip-info-header"],[3,"leg","legId","legIdx","isLastLeg",4,"ngFor","ngForOf"],[1,"trip-fares"],[4,"ngFor","ngForOf"],[1,"badge","rounded-pill","bg-danger","fw-bolder"],[1,"badge","rounded-pill","bg-warning","fw-bolder","text-dark"],[3,"leg","legId","legIdx","isLastLeg"]],template:function(e,i){1&e&&(X(0,"sbb-expansion-panel",0)(1,"sbb-expansion-panel-header")(2,"div",1)(3,"div")(4,"div",2)(5,"div"),Ce(6),Y(),ft(7,lX,3,0,"div",3),ft(8,cX,3,0,"div",3),X(9,"div")(10,"span"),Ce(11),Y()()(),X(12,"div"),Ce(13),Y()(),X(14,"div",4)(15,"div"),Ce(16),Y(),X(17,"div"),Ce(18),Y()()()(),X(19,"div"),ft(20,uX,1,4,"result-trip-leg",5),Y(),X(21,"div"),Ce(22,"Price: "),X(23,"ul",6),ft(24,dX,2,4,"li",7),Y()()()),2&e&&(Le("hideToggle",!0),ae(6),An(i.tripHeaderStats.title),ae(1),Le("ngIf",!0===i.tripHeaderStats.isCancelled),ae(1),Le("ngIf",!0===i.tripHeaderStats.isInfeasable),ae(3),wi(" - ",i.tripHeaderStats.tripChangesInfo,""),ae(2),wx("",i.tripHeaderStats.tripDurationS," - ",i.tripHeaderStats.tripDistanceS,""),ae(3),An(i.tripHeaderStats.tripFromTime),ae(2),An(i.tripHeaderStats.tripToTime),ae(2),Le("ngForOf",null==i.trip?null:i.trip.legs),ae(4),Le("ngForOf",null==i.trip?null:i.trip.tripFareResults))},dependencies:[Sl,ho,Ah,Wv,aX],styles:[".trip-info[_ngcontent-%COMP%]{font-size:14px}.trip-info-header[_ngcontent-%COMP%]{font-size:16px}.trip-fares[_ngcontent-%COMP%]{margin-top:2px;margin-bottom:2px}"]}),n})();function pX(n,t){1&n&&en(0,"span",6)}function fX(n,t){if(1&n){const e=zr();X(0,"div",2)(1,"div",3)(2,"button",4),Ft("click",function(){return si(e),fi(St().loadPreviousTrips())}),ft(3,pX,1,0,"span",5),Ce(4," Earlier connections "),Y()()()}if(2&n){const e=St();ae(2),Le("disabled",e.isFetchingPrevTrips),ae(1),Le("ngIf",e.isFetchingPrevTrips)}}function mX(n,t){if(1&n&&en(0,"journey-result-row",7),2&n){const i=t.index;Le("trip",t.$implicit)("idx",i)}}function gX(n,t){1&n&&en(0,"span",6)}function bX(n,t){if(1&n){const e=zr();X(0,"div",2)(1,"div",3)(2,"button",4),Ft("click",function(){return si(e),fi(St().loadNextTrips())}),ft(3,gX,1,0,"span",5),Ce(4," Later connections "),Y()()()}if(2&n){const e=St();ae(2),Le("disabled",e.isFetchingNextTrips),ae(1),Le("ngIf",e.isFetchingNextTrips)}}let BF=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.languageService=r,this.trips=[],this.isFetchingPrevTrips=!1,this.isFetchingNextTrips=!1}ngOnInit(){this.userTripService.tripsUpdated.subscribe(e=>{this.trips=e}),this.userTripService.searchParamsReset.subscribe(()=>{this.trips=[]}),this.userTripService.tripFaresUpdated.subscribe(e=>{this.trips.forEach(i=>{i.tripFareResults=[]}),e.forEach(i=>{var r;const s=null!==(r=this.trips.find(u=>u.id===i.tripId))&&void 0!==r?r:null;if(null===s)return console.error("ERROR - cant find fare for trip "+i.tripId),console.log(this.trips),void console.log(i);s.tripFareResults=i.tripFareResults})})}loadPreviousTrips(){if(0===this.trips.length)return;const e=this.trips[0].computeDepartureTime();null!==e&&(this.isFetchingPrevTrips=!0,this.loadTrips("NumberOfResultsBefore",e))}loadNextTrips(){if(0===this.trips.length)return;const e=this.trips[this.trips.length-1].computeDepartureTime();null!==e&&(this.isFetchingNextTrips=!0,this.loadTrips("NumberOfResultsAfter",e))}loadTrips(e,i){const r=this.userTripService.getStageConfig(),s=Rc.initWithTripLocationsAndDate(r,this.languageService.language,this.userTripService.fromTripLocation,this.userTripService.toTripLocation,i,this.userTripService.currentBoardingType,e);null!==s&&(this.userTripService.journeyTripRequests=[s],s.fetchResponse().then(u=>{this.isFetchingPrevTrips=!1,this.isFetchingNextTrips=!1;const m=u.trips;if(this.userTripService.updateTrips(m),this.userTripService.tripRequestFinished.emit(s.requestInfo),m.length>0){const C=m[0];this.userTripService.selectActiveTrip(C),this.mapService.zoomToTrip(C),this.userTripService.fetchFares()}else this.userTripService.selectActiveTrip(null)}))}}return n.\u0275fac=function(e){return new(e||n)(H(Sa),H(mu),H(bd))},n.\u0275cmp=mn({type:n,selectors:[["journey-results"]],decls:4,vars:3,consts:[["class","row",4,"ngIf"],[3,"trip","idx",4,"ngFor","ngForOf"],[1,"row"],[1,"col","text-center","link-connection"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[3,"trip","idx"]],template:function(e,i){1&e&&(ft(0,fX,5,2,"div",0),X(1,"sbb-accordion"),ft(2,mX,1,2,"journey-result-row",1),Y(),ft(3,bX,5,2,"div",0)),2&e&&(Le("ngIf",i.trips.length>0),ae(2),Le("ngForOf",i.trips),ae(1),Le("ngIf",i.trips.length>0))},dependencies:[Sl,ho,FS,hX],styles:[".link-connection[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}"]}),n})();const _X=JSON.parse('{"id":"ojp-trip-leg-beeline","type":"line","source":"[SOURCE]","filter":["[CASE_FILTER_BY_DRAW_TYPE]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":0.4,"line-color":["[CASE_COLOR_BY_LEG_TYPE]"]}}'),yX=JSON.parse('{"id":"ojp-trip-timed-leg-point-circle","type":"circle","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegPoint]"],"layout":{},"paint":{"circle-radius":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",8,"OTHERWISE",2],"circle-color":["IF POINT_TYPE: TO","COLOR BY TIMED_LEG","OTHERWISE","#FFF"],"circle-stroke-color":["IF POINT_TYPE: TO","#FFF","OTHERWISE","COLOR BY TIMED_LEG"],"circle-stroke-width":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",1,"OTHERWISE",3]}}'),vX=JSON.parse('{"id":"ojp-trip-timed-leg-track","type":"line","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegLine]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":1,"line-color":["[CASE COLOR BY TIMED_LEG"]}}'),xX=JSON.parse('{"id":"ojp-trip-walking-leg-line","type":"line","source":"[SOURCE]","filter":["all","[FILTER BY DRAW_TYPE == ContinousLegLine]","[FILTER BY LINE_TYPE == Walk]"],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#009933","line-width":4,"line-dasharray":[0.2,2]}}');class wX{constructor(t){this.mapSourceId="trip-data",this.features=[],this.map=t,this.addMapSourceAndLayers()}renderTrip(t){if(t){const e=t.computeGeoJSON();this.setSourceFeatures(e.features)}else this.removeAllFeatures()}addMapSourceAndLayers(){this.map.addSource(this.mapSourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const t=_X;t.filter=kc.FilterBeelines(),t.paint&&(t.paint["line-color"]=kc.ColorCaseByLegLineType());const e=kc.ColorCaseByLegLineType(),i=yX;if(i.filter=kc.FilterLegPoints(),i.paint){const m=["case",kc.FilterByPointType("From"),4,kc.FilterByPointType("To"),8,2];i.paint["circle-radius"]=m;const y=["case",kc.FilterByPointType("To"),e,"#FFF"];i.paint["circle-color"]=y;const C=["case",kc.FilterByPointType("To"),"#FFF",e];i.paint["circle-stroke-color"]=C;const I=["case",kc.FilterByPointType("From"),4,kc.FilterByPointType("To"),1,3];i.paint["circle-stroke-width"]=I}const r=vX;r.filter=kc.FilterTimedLegTracks(),r.paint&&(r.paint["line-color"]=e);const s=xX;s.filter=kc.FilterWalkingLegs(),s.paint&&(s.paint["line-color"]=zv.ContinousLeg),[t,r,s,i].forEach(m=>{const y=m;y.source=this.mapSourceId,this.map.addLayer(y)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceId).setData({type:"FeatureCollection",features:t})}}let SX=(()=>{class n{constructor(e,i,r,s){this.userTripService=e,this.languageService=i,this.mapService=r,this.debugXmlPopover=s,this.fromMarker=new(ks().Marker),this.toMarker=new(ks().Marker),["From","To"].forEach(m=>{var y=document.createElement("div");y.className="marker-journey-endpoint marker-journey-endpoint-"+m;const C=new(ks().Marker)({element:y,draggable:!0,anchor:"bottom"});C.on("dragend",I=>{this.handleMarkerDrag(C,m)}),"From"===m&&(this.fromMarker=C),"To"===m&&(this.toMarker=C)}),this.viaMarkers=[],this.mapLoadingPromise=null,this.popupContextMenu=new(ks().Popup)({focusAfterOpen:!1}),this.tripRenderController=null}ngOnInit(){this.userTripService.geoLocationsUpdated.subscribe(e=>{this.updateMarkers()}),this.userTripService.activeTripSelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s;null===(s=this.tripRenderController)||void 0===s||s.renderTrip(e)})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToBounds(r,e)})}),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToLocation(r,e)})}),this.userTripService.viaAtIndexRemoved.subscribe(e=>{e>this.viaMarkers.length-1||(this.viaMarkers[e].remove(),this.viaMarkers.splice(e,1))}),this.initMap()}initMap(){const e=this.mapService.createMap("map_canvas");this.mapLoadingPromise=new Promise((i,r)=>{e.on("load",s=>{i(e),this.onMapLoad(e)})})}updateMarkers(){["From","To"].forEach(s=>{var u;const m="From"===s,y=m?this.userTripService.fromTripLocation:this.userTripService.toTripLocation;this.updateMarkerLocation(m?this.fromMarker:this.toMarker,null!==(u=null==y?void 0:y.location)&&void 0!==u?u:null)});const i=this.viaMarkers.length,r=this.userTripService.viaTripLocations.length;if(i>r){let s=this.viaMarkers;r>0&&(s=this.viaMarkers.splice(r,i-r)),s.forEach(u=>{u.remove()})}this.userTripService.viaTripLocations.forEach((s,u)=>{var m;let y=null!==(m=this.viaMarkers[u])&&void 0!==m?m:null;null===y&&(y=this.createViaMarker(s.location),this.viaMarkers.push(y)),this.updateMarkerLocation(y,s.location)})}handleMarkerDrag(e,i){const r=e.getLngLat();let s=to.initWithLngLat(r.lng,r.lat);this.userTripService.updateTripEndpoint(s,i,"MapDragend")}onMapLoad(e){this.mapService.addControls(e,this.debugXmlPopover,this.userTripService,this.languageService),e.on("contextmenu",i=>{this.showPickupPopup(e,i.lngLat)}),e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,u)=>{s?console.error(s):!e.hasImage(i.id)&&u&&e.addImage(i.id,u)})}),this.tripRenderController=new wX(e)}showPickupPopup(e,i){let r=document.getElementById("map-endpoint-coords-picker-popup").innerHTML;const s=Yp.formatMapboxLngLatAsLatLng(i);r=r.replace("[PICKER_COORDS]",s);const u=document.createElement("div");u.innerHTML=r,u.addEventListener("click",m=>{const C=m.target.getAttribute("data-endpoint-type");if(null===C)return;const I=to.initWithLngLat(i.lng,i.lat);this.userTripService.updateTripEndpoint(I,C,"MapPopupClick"),this.popupContextMenu.remove()}),this.popupContextMenu.setLngLat(i).setDOMContent(u).addTo(e)}updateMarkerLocation(e,i){var r,s,u;const m=null!==(s=null===(r=null==i?void 0:i.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==s?s:null;if(null===m)return void e.remove();const y=void 0===e.getLngLat();e.setLngLat(m),y&&(null===(u=this.mapLoadingPromise)||void 0===u||u.then(C=>{e.addTo(C)}))}createViaMarker(e){var i;const r=document.createElement("div");r.className="marker-journey-endpoint marker-journey-endpoint-Via";let s=!1;null===(null===(i=e.geoPosition)||void 0===i?void 0:i.properties)&&(s=!0);const u=new(ks().Marker)({element:r,anchor:"bottom",draggable:s}),m=this.viaMarkers.length;return u.on("dragend",y=>{const C=u.getLngLat();let I=to.initWithLngLat(C.lng,C.lat);this.userTripService.updateViaPoint(I,m)}),u}}return n.\u0275fac=function(e){return new(e||n)(H(Sa),H(bd),H(mu),H(tl))},n.\u0275cmp=mn({type:n,selectors:[["app-map"]],decls:48,vars:0,consts:[["id","map_canvas",1,"map_wrapper"],[1,"d-none"],["id","map-endpoint-coords-picker-popup"],[1,"popup-picker","p-2"],[1,"popup-picker-header","mb-2"],[1,"popup-picker-body"],["type","button","data-endpoint-type","From",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","To",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","Via",1,"btn","btn-primary","btn-sm"],["id","map-endpoint-stop-picker-popup"],["id","map-endpoint-picker-popup"],["id","map-poi-picker-popup"]],template:function(e,i){1&e&&(en(0,"div",0),X(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),Ce(5," Coords: [PICKER_COORDS] "),Y(),X(6,"div",5)(7,"button",6),Ce(8,"From"),Y(),X(9,"button",7),Ce(10,"To"),Y(),X(11,"button",8),Ce(12,"Via"),Y()()()(),X(13,"div",9)(14,"div",3)(15,"div",4),Ce(16," [STOP_NAME] ([STOP_ID]) "),Y(),X(17,"div",5)(18,"button",6),Ce(19,"From"),Y(),X(20,"button",7),Ce(21,"To"),Y(),X(22,"button",8),Ce(23,"Via"),Y()()()(),X(24,"div",10)(25,"div",3)(26,"div",4),Ce(27," TYPE: [GEO_RESTRICTION_TYPE] "),Y(),X(28,"div",5),Ce(29," [GEOJSON_PROPERTIES_TABLE] "),X(30,"button",6),Ce(31,"From"),Y(),X(32,"button",7),Ce(33,"To"),Y(),X(34,"button",8),Ce(35,"Via"),Y()()()(),X(36,"div",11)(37,"div",3)(38,"div",4),Ce(39," [POI_NAME] "),Y(),X(40,"div",5),Ce(41," [GEOJSON_PROPERTIES_TABLE] "),X(42,"button",6),Ce(43,"From"),Y(),X(44,"button",7),Ce(45,"To"),Y(),X(46,"button",8),Ce(47,"Via"),Y()()()()())},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}.popup-picker-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"]}),n})();class zF{static computeExecutionTime(t,e){return null===t||null===e?0:(e.getTime()-t.getTime())/1e3}}function CX(n,t){1&n&&en(0,"span",11)}let TX=(()=>{class n{constructor(e){this.userTripService=e,this.tripCustomRequestSaved=new tn,this.tripCustomResponseSaved=new tn,this.inputTripRequestXML="... loading",this.inputTripRequestResponseXML="Paste custom OJP TripRequest Response XML here...",this.isRunningTripRequest=!1}parseCustomRequestXML(){this.isRunningTripRequest=!0;const e=this.userTripService.getStageConfig(),i=Rc.initWithRequestMock(this.inputTripRequestXML,e);i.fetchResponse().then(r=>{if("ERROR"===r.message)return console.error("ERROR fetching OJP response"),void console.log(r);const s=i.requestInfo.responseXML;if(null===s)return console.error("ERROR parsing OJP response"),void console.log(i);this.tripCustomRequestSaved.emit(s)})}parseCustomResponseXML(){this.tripCustomResponseSaved.emit(this.inputTripRequestResponseXML)}}return n.\u0275fac=function(e){return new(e||n)(H(Sa))},n.\u0275cmp=mn({type:n,selectors:[["input-xml-popover"]],outputs:{tripCustomRequestSaved:"tripCustomRequestSaved",tripCustomResponseSaved:"tripCustomResponseSaved"},decls:26,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptriprequest/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(X(0,"div",0),Ce(1,"Custom Trip Request / Response XML"),Y(),X(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),Ce(6,"Trip Request XML"),Y(),X(7,"div")(8,"a",4),Ce(9,"Cookbook opentransportdata.swiss"),Y()()(),X(10,"textarea",5),Ft("ngModelChange",function(s){return i.inputTripRequestXML=s}),Y(),X(11,"div",6)(12,"button",7),Ft("click",function(){return i.parseCustomRequestXML()}),ft(13,CX,1,0,"span",8),Ce(14," Execute OJPTripRequest "),Y()(),en(15,"hr"),X(16,"div",3)(17,"div"),Ce(18,"Trip Request Response XML"),Y()(),X(19,"textarea",5),Ft("ngModelChange",function(s){return i.inputTripRequestResponseXML=s}),Y(),X(20,"div",6)(21,"button",7),Ft("click",function(){return i.parseCustomResponseXML()}),Ce(22," Display Trips "),Y()()()(),X(23,"div",9)(24,"button",10),Ce(25," Close "),Y()()),2&e&&(ae(10),Le("ngModel",i.inputTripRequestXML),ae(2),Le("disabled",i.isRunningTripRequest),ae(1),Le("ngIf",i.isRunningTripRequest),ae(6),Le("ngModel",i.inputTripRequestResponseXML),ae(2),Le("disabled",i.isRunningTripRequest))},dependencies:[ho,Mc,uu,cd,Qp,Bm,zm,Vm],encapsulation:2}),n})();const EX=["input"],DX=["*"],IX=new It("sbb-checkbox-default-options",{providedIn:"root",factory:function VF(){return{clickAction:"check-indeterminate"}}});const MX={provide:$s,useExisting:zi(()=>AX),multi:!0};let AX=(()=>{class n extends kE{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,selectors:[["sbb-checkbox","required","","formControlName",""],["sbb-checkbox","required","","formControl",""],["sbb-checkbox","required","","ngModel",""]],features:[Un([MX]),Xt]}),n})(),kX=0;const RX={clickAction:"check-indeterminate"},PX={provide:Za,useExisting:zi(()=>UF),multi:!0};class LX{}const OX=t_(Ka(class{}));let jF=(()=>{class n extends OX{constructor(e,i,r,s,u){super(),this._elementRef=e,this._changeDetectorRef=i,this._focusMonitor=r,this._options=u,this.ariaLabel="",this.ariaLabelledby=null,this._uniqueId="sbb-checkbox-"+ ++kX,this.id=this._uniqueId,this.labelPosition="after",this.name=null,this.change=new tn,this.indeterminateChange=new tn,this._onTouched=()=>{},this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||RX,this.tabIndex=parseInt(s,10)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(e){this._required=Hn(e)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{e||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(e){const i=Hn(e);i!==this.checked&&(this._checked=i,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){const i=Hn(e);i!==this.disabled&&(this._disabled=i,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(e){const i=e!==this._indeterminate;this._indeterminate=Hn(e),i&&this.indeterminateChange.emit(this._indeterminate),this._syncIndeterminate(this._indeterminate)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(e){this.checked=!!e}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_getAriaChecked(){return this.checked?"true":this.indeterminate?"mixed":"false"}_emitChangeEvent(){const e=new LX;e.source=this,e.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(e)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_onInputClick(e){var i;const r=null===(i=this._options)||void 0===i?void 0:i.clickAction;e.stopPropagation(),this.disabled||"noop"===r?!this.disabled&&"noop"===r&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==r&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._emitChangeEvent())}focus(e,i){e?this._focusMonitor.focusVia(this._inputElement,e,i):this._inputElement.nativeElement.focus(i)}_onInteractionEvent(e){e.stopPropagation()}_syncIndeterminate(e){const i=this._inputElement;i&&(i.nativeElement.indeterminate=e)}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Cr),H(xa),qo("tabindex"),H(IX,8))},n.\u0275dir=Bt({type:n,viewQuery:function(e,i){if(1&e&&cr(EX,5),2&e){let r;Fn(r=Nn())&&(i._inputElement=r.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},features:[Xt]}),n})(),UF=(()=>{class n extends jF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275cmp=mn({type:n,selectors:[["sbb-checkbox"]],hostAttrs:[1,"sbb-checkbox","sbb-selection-item"],hostVars:10,hostBindings:function(e,i){2&e&&(Cc("id",i.id),fn("tabindex",null)("aria-label",null)("aria-labelledby",null),Li("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckbox"],features:[Un([PX]),Xt],ngContentSelectors:DX,decls:11,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content",3,"cdkObserveContent"],[2,"display","none"]],template:function(e,i){1&e&&(Ro(),X(0,"label",0)(1,"input",1,2),Ft("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),Y(),X(3,"div",3)(4,"span",4),F(),X(5,"svg",5),en(6,"polyline",6),Y()()(),J(),X(7,"div",7),Ft("cdkObserveContent",function(){return i._onLabelTextChange()}),X(8,"span",8),Ce(9,"\xa0"),Y(),Pr(10),Y()()),2&e&&(fn("for",i.inputId),ae(1),Le("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),fn("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},dependencies:[dO],encapsulation:2,changeDetection:0}),n})(),HF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[sS,Zi]}),n})(),FX=(()=>{class n{constructor(e){var i,r;this.userTripService=e,this.embedHTMLs="n/a",this.fromLocationText="",this.toLocationText="",this.fromLocationChecked=!1,this.toLocationChecked=!0,this.fromLocationText=n.computeLocationText(null===(i=e.fromTripLocation)||void 0===i?void 0:i.location),this.toLocationText=n.computeLocationText(null===(r=e.toTripLocation)||void 0===r?void 0:r.location),this.updateEmbedHTML()}static computeLocationText(e){var i,r,s,u,m;if(!e)return"";const y=e.getLocationType();if("stop"===y)return e.computeLocationName()+"(stopRef "+(null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"")+")";const C=e.geoPosition;return C?(null!==(s=e.computeLocationName())&&void 0!==s?s:"")+"(coords "+(null!==(u=C.asLatLngString(!0))&&void 0!==u?u:"")+")":y+" - "+(null!==(m=e.computeLocationName())&&void 0!==m?m:"")}updateEmbedHTML(){const e=new URLSearchParams;["from","to"].forEach(s=>{const u=(()=>{if("from"===s?this.fromLocationChecked:this.toLocationChecked){const y=this.userTripService.embedQueryParams.get(s);if(null!==y)return y}return""})();e.append(s,u)});const i=document.location.pathname.replace("/search","/embed/search")+"?"+e.toString(),r=document.location.protocol+"//"+document.location.host+i;this.embedHTMLs='<iframe src="'+r+'" width="100%" height="100%" frameBorder="0"></iframe>'}}return n.\u0275fac=function(e){return new(e||n)(H(Sa))},n.\u0275cmp=mn({type:n,selectors:[["embed-search-popover"]],decls:20,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[3,"ngModel","ngModelChange","change"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(X(0,"div",0),Ce(1,"Embed journey in another website"),Y(),X(2,"div",1)(3,"div",2)(4,"p"),Ce(5,"Select which journey endpoints should be prefilled:"),Y(),X(6,"div")(7,"div")(8,"sbb-checkbox",3),Ft("ngModelChange",function(s){return i.fromLocationChecked=s})("change",function(){return i.updateEmbedHTML()}),Ce(9),Y()(),X(10,"div")(11,"sbb-checkbox",3),Ft("ngModelChange",function(s){return i.toLocationChecked=s})("change",function(){return i.updateEmbedHTML()}),Ce(12),Y()()(),X(13,"p"),Ce(14,"Copy the following code in the target webpage"),Y(),X(15,"textarea",4),Ce(16),Y()()(),X(17,"div",5)(18,"button",6),Ce(19," Close "),Y()()),2&e&&(ae(8),Le("ngModel",i.fromLocationChecked),ae(1),wi("(From) ",i.fromLocationText,""),ae(2),Le("ngModel",i.toLocationChecked),ae(1),wi("(To) ",i.toLocationText,""),ae(4),An(i.embedHTMLs))},dependencies:[uu,cd,UF,Qp,Bm,zm,Vm],encapsulation:2}),n})();function NX(n,t){}const $F=new It("SbbNotificationToastData");class BS{constructor(){this.politeness="assertive",this.duration=0,this.data=null,this.verticalPosition="bottom",this.type="success"}}const BX={notificationState:Ms("state",[fr("void, hidden",Bn({transform:"scale(0.8)",opacity:0})),fr("visible",Bn({transform:"scale(1)",opacity:1})),Xi("* => visible",er("150ms cubic-bezier(0, 0, 0.2, 1)")),Xi("* => void, * => hidden",er("75ms cubic-bezier(0.4, 0.0, 1, 1)",Bn({opacity:0})))])};let zX=(()=>{class n extends Ov{constructor(e,i,r,s){super(),this._ngZone=e,this._elementRef=i,this._changeDetectorRef=r,this.config=s,this._destroyed=!1,this._onExit=new Kt,this._onEnter=new Kt,this._animationState="void",this.attachDomPortal=u=>{this._assertNotAttached();const m=this._portalOutlet.attachDomPortal(u);return this._afterPortalAttached(),m},this._role="assertive"!==s.politeness||s.announcementMessage?"off"===s.politeness?null:"status":"alert"}get _svgIcon(){switch(this.config.type){case"success":return"kom:tick-small";case"error":case"warn":return"kom:sign-exclamation-point-small";default:return"kom:circle-information-small"}}attachComponentPortal(e){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}onAnimationEnd(e){const{fromState:i,toState:r}=e;if(("void"===r&&"void"!==i||"hidden"===r)&&this._completeExit(),"visible"===r){const s=this._onEnter;this._ngZone.run(()=>{s.next(),s.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("sbb-exit",""),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(jr(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){const e=this._elementRef.nativeElement,i=this.config.panelClass;i&&(Array.isArray(i)?i.forEach(r=>e.classList.add(r)):e.classList.add(i)),e.classList.add("sbb-notification-toast-center")}_assertNotAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach notification content after content is already attached")}}return n.\u0275fac=function(e){return new(e||n)(H(Xn),H(En),H(Cr),H(BS))},n.\u0275dir=Bt({type:n,viewQuery:function(e,i){if(1&e&&cr(hd,7),2&e){let r;Fn(r=Nn())&&(i._portalOutlet=r.first)}},features:[Xt]}),n})(),VX=(()=>{class n extends zX{_afterPortalAttached(){super._afterPortalAttached(),"top"===this.config.verticalPosition&&this._elementRef.nativeElement.classList.add("sbb-notification-toast-top")}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275cmp=mn({type:n,selectors:[["sbb-notification-toast-container"]],hostAttrs:[1,"sbb-notification-toast"],hostVars:10,hostBindings:function(e,i){1&e&&Vy("@state.done",function(s){return i.onAnimationEnd(s)}),2&e&&(fn("role",i._role),Uy("@state",i._animationState),Li("sbb-notification-toast-success","success"===i.config.type)("sbb-notification-toast-info","info"===i.config.type)("sbb-notification-toast-warn","warn"===i.config.type)("sbb-notification-toast-error","error"===i.config.type))},features:[Xt],decls:6,vars:1,consts:[[1,"sbb-notification-toast-icon-wrapper","sbb-icon-fit"],[3,"svgIcon"],[1,"sbb-notification-toast-content"],["cdkPortalOutlet",""],["type","button",1,"sbb-notification-toast-icon-wrapper","sbb-notification-toast-icon-close-wrapper","sbb-icon-fit",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(X(0,"span",0),en(1,"sbb-icon",1),Y(),X(2,"div",2),ft(3,NX,0,0,"ng-template",3),Y(),X(4,"button",4),Ft("click",function(){return i.exit()}),en(5,"sbb-icon",5),Y()),2&e&&(ae(1),Le("svgIcon",i._svgIcon))},dependencies:[hd,Qa],styles:[".sbb-notification-toast{display:flex;min-height:calc(3.2rem * var(--sbb-scaling-factor));border-radius:var(--sbb-border-radius);color:var(--sbb-color-white);background-color:var(--sbb-color-background);font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:calc(0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin));padding-bottom:calc(\n    0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin) - var(\n        --sbb-line-height\n      ) + var(--sbb-icon-size-default)\n  );margin:calc(1.3333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-notification-toast{padding-bottom:calc(\n      0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin)\n    )}.sbb-notification-toast-mobile .sbb-notification-toast{margin:calc(0.5333333333rem * var(--sbb-scaling-factor));max-width:100%;min-width:0;width:100%}.sbb-notification-toast-mobile{width:100%}.sbb-notification-toast-error{background-color:var(--sbb-color-error)}:is(.sbb-notification-toast-error,.sbb-notification-toast-error :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-success{border:var(--sbb-border-width-thin) solid var(--sbb-color-green)}:is(.sbb-notification-toast-success,.sbb-notification-toast-success :is(a,button)){color:var(--sbb-color-green)}.sbb-notification-toast-info{border:var(--sbb-border-width-thin) solid var(--sbb-color-granite)}:is(.sbb-notification-toast-info,.sbb-notification-toast-info :is(a,button)){color:var(--sbb-color-granite)}.sbb-notification-toast-warn{background-color:var(--sbb-color-orange)}:is(.sbb-notification-toast-warn,.sbb-notification-toast-warn :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-content{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-right:calc(1.6rem * var(--sbb-scaling-factor))}.sbb-notification-toast-icon-wrapper{min-width:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);margin-left:calc(1.0666666667rem * var(--sbb-scaling-factor));border:none;background:none;padding:0;align-self:flex-start}.sbb-notification-toast-icon-close-wrapper{cursor:pointer;margin-left:auto;margin-right:calc(1.4666666667rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[BX.notificationState]}}),n})();const jX=Math.pow(2,31)-1;class uI{constructor(t,e){this._overlayRef=e,this._afterDismissed=new Kt,this._afterOpened=new Kt,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,jX))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._afterDismissed.next(null),this._afterDismissed.complete()}afterDismissed(){return this._afterDismissed.asObservable()}afterOpened(){return this.containerInstance._onEnter}}let UX=(()=>{class n{constructor(e,i){this.notificationToastRef=e,this.data=i}dismiss(){this.notificationToastRef.dismiss()}}return n.\u0275fac=function(e){return new(e||n)(H(uI),H($F))},n.\u0275cmp=mn({type:n,selectors:[["sbb-simple-notification"]],decls:2,vars:1,template:function(e,i){1&e&&(X(0,"span"),Ce(1),Y()),2&e&&(ae(1),An(i.data.message))},encapsulation:2,changeDetection:0}),n})(),dI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,ua,Cl,Zi,yo]}),n})();const HX=new It("notification-default-options",{providedIn:"root",factory:function $X(){return new BS}});let hI=(()=>{class n{constructor(e,i,r,s,u,m){this._overlay=e,this._injector=i,this._live=r,this._breakpointObserver=s,this._parentNotification=u,this._defaultConfig=m,this._notificationRefAtThisLevel=null,this._simpleNotificationToastComponent=UX,this._notificationToastContainerComponent=VX,this._mobileDeviceCssClass="sbb-notification-toast-mobile"}get _openedNotificationRef(){const e=this._parentNotification;return e?e._openedNotificationRef:this._notificationRefAtThisLevel}set _openedNotificationRef(e){this._parentNotification?this._parentNotification._openedNotificationRef=e:this._notificationRefAtThisLevel=e}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i){const r=Object.assign(Object.assign({},this._defaultConfig),i);return r.data={message:e},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this._simpleNotificationToastComponent,r)}dismiss(){this._openedNotificationRef&&this._openedNotificationRef.dismiss()}ngOnDestroy(){this._notificationRefAtThisLevel&&this._notificationRefAtThisLevel.dismiss()}_attachNotificationToastContainer(e,i){var r;const s=null===(r=null==i?void 0:i.viewContainerRef)||void 0===r?void 0:r.injector,u=new MO(s||this._injector,new WeakMap([[BS,i]])),m=new dd(this._notificationToastContainerComponent,i.viewContainerRef,u),y=e.attach(m);return y.instance.config=i,y.instance}_attach(e,i){const r=Object.assign(Object.assign(Object.assign({},new BS),this._defaultConfig),i),s=this._createOverlay(r),u=this._attachNotificationToastContainer(s,r),m=new uI(u,s);if(e instanceof eo){const y=new Pm(e,null,{$implicit:r.data,notificationRef:m});m.instance=u.attachTemplatePortal(y)}else{const y=this._createInjector(r,m),C=new dd(e,void 0,y),I=u.attachComponentPortal(C);m.instance=I.instance}return this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait)").pipe(Oi(s.detachments())).subscribe(y=>{const C=s.overlayElement.classList;y.matches?C.add(this._mobileDeviceCssClass):C.remove(this._mobileDeviceCssClass)}),this._animateNotification(m,r),this._openedNotificationRef=m,this._openedNotificationRef}_animateNotification(e,i){e.afterDismissed().subscribe(()=>{this._openedNotificationRef===e&&(this._openedNotificationRef=null),i.announcementMessage&&this._live.clear()}),this._openedNotificationRef?(this._openedNotificationRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedNotificationRef.dismiss()):e.containerInstance.enter(),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),i.announcementMessage&&this._live.announce(i.announcementMessage,i.politeness)}_createOverlay(e){const i=new Fm,r=this._overlay.position().global();return r.centerHorizontally(),"top"===e.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(e,i){var r;const s=null===(r=null==e?void 0:e.viewContainerRef)||void 0===r?void 0:r.injector;return new MO(s||this._injector,new WeakMap([[uI,i],[$F,e.data]]))}}return n.\u0275fac=function(e){return new(e||n)(je(jo),je(Nr),je(TO),je(yD),je(n,12),je(HX))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:dI}),n})();const qX=["sbb-button",""];function GX(n,t){1&n&&en(0,"sbb-icon",2),2&n&&Le("svgIcon",St().svgIcon)}function WX(n,t){1&n&&en(0,"sbb-icon",3),2&n&&Le("svgIcon",St().svgIcon)}const XX=["*"],ZX=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button","sbb-frameless-button","sbb-link"],YX=["sbb-button","sbb-secondary-button","sbb-frameless-button","sbb-link"],KX=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button"],qF={"sbb-button":"kom:arrow-right-small","sbb-secondary-button":"kom:arrow-right-small","sbb-frameless-button":"kom:plus-small","sbb-link":"kom:arrow-right-small"},QX=Ka(Om(class{constructor(n){this._elementRef=n}}));let GF=(()=>{class n extends QX{constructor(e,i,r,s){super(e),this._focusMonitor=i,this._animationMode=r,this._contentObserver=s,this._hasIconIndicator=this._hasHostAttributes(...YX),this._hasIconButtonClass=!1,this._iconRefs=new hm;for(const u of ZX)this._hasHostAttributes(u)&&(this._getHostElement().classList.add(u),u in qF&&(this.svgIcon=qF[u]));e.nativeElement.classList.add("sbb-button-base")}ngAfterContentInit(){var e,i;const r=null!==(i=null===(e=this._contentObserver)||void 0===e?void 0:e.observe(this._elementRef))&&void 0!==i?i:this._iconRefs.changes;this._isIconButton=null==r?void 0:r.pipe(As([]),W(()=>this._hasHostAttributes(...KX)&&""===this._elementRef.nativeElement.textContent.trim()&&1===this._iconRefs.length)),this._isIconButton.subscribe(s=>this._hasIconButtonClass=s),this._leftIconVisible=vm([this.variant,this._isIconButton]).pipe(W(([s,u])=>!u&&"standard"===s&&this._hasIconIndicator)),this._rightIconVisible=vm([this.variant,this._isIconButton]).pipe(W(([s,u])=>!u&&("standard"===s&&this._hasIconIndicator||"lean"===s&&this._hasHostAttributes("sbb-link"))))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,i){e?this._focusMonitor.focusVia(this._getHostElement(),e,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_hasHostAttributes(...e){return e.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(xa),H(rd,8),H(uO,8))},n.\u0275cmp=mn({type:n,selectors:[["button","sbb-button",""],["button","sbb-alt-button",""],["button","sbb-secondary-button",""],["button","sbb-ghost-button",""],["button","sbb-frameless-button",""],["button","sbb-link",""]],contentQueries:function(e,i,r){if(1&e&&Vr(r,Qa,4,En),2&e){let s;Fn(s=Nn())&&(i._iconRefs=s)}},hostVars:7,hostBindings:function(e,i){2&e&&(fn("disabled",i.disabled||null),Li("_sbb-animation-noopable","NoopAnimations"===i._animationMode)("sbb-disabled",i.disabled)("sbb-icon-button",i._hasIconButtonClass))},inputs:{disabled:"disabled",svgIcon:"svgIcon"},exportAs:["sbbButton"],features:[Xt],attrs:qX,ngContentSelectors:XX,decls:5,vars:6,consts:[["class","sbb-button-indicator-icon sbb-button-left-icon",3,"svgIcon",4,"ngIf"],["class","sbb-button-indicator-icon sbb-button-right-icon",3,"svgIcon",4,"ngIf"],[1,"sbb-button-indicator-icon","sbb-button-left-icon",3,"svgIcon"],[1,"sbb-button-indicator-icon","sbb-button-right-icon",3,"svgIcon"]],template:function(e,i){1&e&&(Ro(),ft(0,GX,1,1,"sbb-icon",0),Mb(1,"async"),Pr(2),ft(3,WX,1,1,"sbb-icon",1),Mb(4,"async")),2&e&&(Le("ngIf",Ab(1,2,i._leftIconVisible)&&i.svgIcon),ae(3),Le("ngIf",Ab(4,4,i._rightIconVisible)&&i.svgIcon))},dependencies:[ho,Qa,nv],encapsulation:2,changeDetection:0}),n})(),pI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi,yo]}),n})();const eZ=["connectionContainer"];function tZ(n,t){if(1&n&&(na(0),X(1,"span"),Ce(2),Y(),ia()),2&n){const e=St();ae(2),An(e.label)}}function nZ(n,t){1&n&&Pr(0,1,["*ngSwitchCase","true"])}function iZ(n,t){1&n&&Pr(0,2,["*ngIf","_hasErrors()"])}const rZ=["*",[["sbb-label"]],[["sbb-error"],["","sbbError",""]]],oZ=["*","sbb-label","sbb-error,[sbbError]"];let sZ=0;const WF=new It("SbbError");let aZ=(()=>{class n{constructor(e,i){this.id="sbb-error-"+sZ++,e||i.nativeElement.setAttribute("aria-live","polite")}}return n.\u0275fac=function(e){return new(e||n)(qo("aria-live"),H(En))},n.\u0275dir=Bt({type:n,selectors:[["sbb-error"],["","sbbError",""]],hostAttrs:["aria-atomic","true",1,"sbb-error"],hostVars:1,hostBindings:function(e,i){2&e&&fn("id",i.id)},inputs:{id:"id"},features:[Un([{provide:WF,useExisting:n}])]}),n})();class Xv{}let zS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=Bt({type:n,selectors:[["sbb-label"]],hostAttrs:[1,"sbb-label"]}),n})(),lZ=0;const VS=new It("SBB_FORM_FIELD");let a_=(()=>{class n{constructor(e,i){this._elementRef=e,this._changeDetectorRef=i,this._destroyed=new Kt,this._labelId="sbb-form-field-label-"+lZ++}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(e){this._explicitFormFieldControl=e}getLabelId(){return this._hasLabel()||this.label?this._labelId:null}ngAfterContentInit(){this._validateControlChild();const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`sbb-form-field-type-${e.controlType}`),e.stateChanges.pipe(As(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(Oi(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._errorChildren.changes.pipe(As(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()})}ngAfterContentChecked(){this._validateControlChild()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(e){const i=this._control?this._control.ngControl:null;return i&&i[e]}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_hasErrors(){return!!(this._errorChildren&&this._errorChildren.length&&this._control.errorState)}_syncDescribedByIds(){if(this._control){const e=[];this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),this._errorChildren&&e.push(...this._errorChildren.map(i=>i.id)),this._control.setDescribedByIds(e)}}_validateControlChild(){}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Cr))},n.\u0275cmp=mn({type:n,selectors:[["sbb-form-field"]],contentQueries:function(e,i,r){if(1&e&&(Vr(r,Xv,5),Vr(r,Xv,7),Vr(r,zS,5),Vr(r,zS,7),Vr(r,WF,5)),2&e){let s;Fn(s=Nn())&&(i._controlNonStatic=s.first),Fn(s=Nn())&&(i._controlStatic=s.first),Fn(s=Nn())&&(i._labelChildNonStatic=s.first),Fn(s=Nn())&&(i._labelChildStatic=s.first),Fn(s=Nn())&&(i._errorChildren=s)}},viewQuery:function(e,i){if(1&e&&cr(eZ,7),2&e){let r;Fn(r=Nn())&&(i._connectionContainerRef=r.first)}},hostAttrs:[1,"sbb-form-field"],hostVars:20,hostBindings:function(e,i){2&e&&Li("sbb-form-field-invalid",null==i._control?null:i._control.errorState)("sbb-form-field-disabled",null==i._control?null:i._control.disabled)("sbb-focused",null==i._control?null:i._control.focused)("ng-untouched",i._shouldForward("untouched"))("ng-touched",i._shouldForward("touched"))("ng-pristine",i._shouldForward("pristine"))("ng-dirty",i._shouldForward("dirty"))("ng-valid",i._shouldForward("valid"))("ng-invalid",i._shouldForward("invalid"))("ng-pending",i._shouldForward("pending"))},inputs:{label:"label"},exportAs:["sbbFormField"],features:[Un([{provide:VS,useExisting:n}])],ngContentSelectors:oZ,decls:10,vars:9,consts:[[1,"sbb-form-field-wrapper"],[1,"sbb-form-field-label-wrapper",3,"click"],[1,"sbb-label","sbb-form-field-label",3,"id","ngSwitch"],[4,"ngSwitchCase"],[1,"sbb-form-field-input-wrapper"],["connectionContainer",""],[1,"sbb-form-field-error-wrapper"],[4,"ngIf"]],template:function(e,i){1&e&&(Ro(rZ),X(0,"div",0)(1,"div",1),Ft("click",function(s){return i._control.onContainerClick&&i._control.onContainerClick(s)}),X(2,"label",2),ft(3,tZ,3,1,"ng-container",3),ft(4,nZ,1,0,"ng-content",3),Y()(),X(5,"div",4,5),Pr(7),Y(),X(8,"div",6),ft(9,iZ,1,0,"ng-content",7),Y()()),2&e&&(ae(2),Li("sbb-form-field-empty",i._control.empty),Le("id",i._labelId)("ngSwitch",i._hasLabel()),fn("for",i._control.id)("aria-owns",i._control.id),ae(1),Le("ngSwitchCase",!1),ae(1),Le("ngSwitchCase",!0),ae(5),Le("ngIf",i._hasErrors()))},dependencies:[ho,Fb,Zx],styles:[".sbb-form-field{display:inline-block;position:relative;width:var(--sbb-form-field-width)}.sbb-form-field-short{width:33.333%}@media all and (min-width: 26.3125em){.sbb-form-field-short{width:25%}}@media all and (min-width: 64.0625em){.sbb-form-field-short{width:16.66666%}}.sbb-form-field-medium{width:100%}@media all and (min-width: 40.1875em){.sbb-form-field-medium{width:50%}}.sbb-form-field-long{width:100%}.sbb-form-field-wrapper{padding-bottom:calc(1.5333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-form-field-wrapper{padding-bottom:1.0666666667rem}.sbb-form-field-flexible-errors .sbb-form-field-wrapper{padding-bottom:0}.sbb-form-field-label-wrapper{margin-bottom:var(--sbb-form-label-wrapper-margin-bottom);padding-left:var(--sbb-form-label-wrapper-padding-left)}.sbb-form-field .sbb-input-element{width:100%;max-width:100%}.sbb-form-field textarea.sbb-input-element{resize:vertical;overflow:auto}.sbb-form-field textarea.sbb-input-element.cdk-textarea-autosize{resize:none}.sbb-form-field-error-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.sbb-form-field-flexible-errors .sbb-form-field-error-wrapper{position:relative}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) :is(.sbb-icon,.sbb-tooltip-icon),:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-icon svg{vertical-align:bottom;width:calc(1.0666666667rem * var(--sbb-scaling-factor));height:calc(1.0666666667rem * var(--sbb-scaling-factor))}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-icon:not(:hover):not(:focus){color:inherit}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-trigger{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor))}.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap,.sbb-form-group-vertical{display:flex;gap:var(--sbb-divider-thin)}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap){align-items:flex-start}.sbb-form-group-wrap{flex-wrap:wrap}.sbb-form-group-center{justify-content:center}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap):where(:not(.sbb-form-group-vertical)) :is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){margin-top:calc(var(--sbb-form-label-line-height) + var(--sbb-form-label-wrapper-margin-bottom))}.sbb-form-group-vertical{flex-direction:column}.sbb-form-group-vertical.sbb-form-group-center{justify-content:inherit;align-items:center}.sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){width:var(--sbb-form-field-width)}:where(html:not(.sbb-lean)) .sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button) .sbb-button-right-icon{right:unset !important}"],encapsulation:2,changeDetection:0}),n})(),jS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi]}),n})();const XF=Up({passive:!0});let cZ=(()=>{class n{constructor(e,i){this._platform=e,this._ngZone=i,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return bs;const i=Am(e),r=this._monitoredElements.get(i);if(r)return r.subject;const s=new Kt,u="cdk-text-field-autofilled",m=y=>{"cdk-text-field-autofill-start"!==y.animationName||i.classList.contains(u)?"cdk-text-field-autofill-end"===y.animationName&&i.classList.contains(u)&&(i.classList.remove(u),this._ngZone.run(()=>s.next({target:y.target,isAutofilled:!1}))):(i.classList.add(u),this._ngZone.run(()=>s.next({target:y.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{i.addEventListener("animationstart",m,XF),i.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(i,{subject:s,unlisten:()=>{i.removeEventListener("animationstart",m,XF)}}),s}stopMonitoring(e){const i=Am(e),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}}return n.\u0275fac=function(e){return new(e||n)(je(ps),je(Xn))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),fI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({}),n})();const ZF=new It("SBB_INPUT_VALUE_ACCESSOR");let uZ=0;const dZ=["button","checkbox","file","hidden","image","radio","range","reset","submit"],hZ=pS(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Kt}});let jm=(()=>{class n extends hZ{constructor(e,i,r,s,u,m,y,C,I){super(m,s,u,r),this._elementRef=e,this._platform=i,this.ngControl=r,this._autofillMonitor=C,this.focused=!1,this.controlType="sbb-input",this.autofilled=!1,this._disabled=!1,this.id="sbb-native-input-"+uZ++,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(j=>iO().has(j)),this._iOSKeyupListener=j=>{const K=j.target;!K.value&&0===K.selectionStart&&0===K.selectionEnd&&(K.setSelectionRange(1,1),K.setSelectionRange(0,0))};const A=this._elementRef.nativeElement,B=A.nodeName.toLowerCase();this._inputValueAccessor=y||A,this._previousNativeValue=this.value,i.IOS&&I.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isNativeSelect="select"===B,this._isTextarea="textarea"===B,this._isNativeSelect&&(this.controlType=A.multiple?"sbb-native-select-multiple":"sbb-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(e){this._disabled=Hn(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get required(){return this._required}set required(e){this._required=Hn(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&iO().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=Hn(e)}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()}),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_validateType(){dZ.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){const e=this._elementRef.nativeElement.validity;return e&&e.badInput}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(ps),H(Wl,10),H(zb,8),H(Vb,8),H(RD),H(ZF,10),H(cZ),H(Xn))},n.\u0275dir=Bt({type:n,selectors:[["input","sbbInput",""],["select","sbbInput",""],["textarea","sbbInput",""]],hostAttrs:[1,"sbb-input-element"],hostVars:9,hostBindings:function(e,i){1&e&&Ft("focus",function(){return i._focusChanged(!0)})("blur",function(){return i._focusChanged(!1)}),2&e&&(Cc("disabled",i.disabled)("required",i.required),fn("id",i.id)("name",i.name||null)("readonly",i.readonly&&!i._isNativeSelect||null)("aria-invalid",i.empty&&i.required?null:i.errorState)("aria-required",i.required)("placeholder",i.readonly?"-":i.placeholder||null)("tabindex",i.empty&&i.readonly?-1:null))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["sbbInput"],features:[Un([{provide:Xv,useExisting:n}]),Xt,hr]}),n})(),YF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[fI,Zi,jS,fI,jS]}),n})();const pZ=["sbb-calendar-body",""];function fZ(n,t){1&n&&en(0,"td",4),2&n&&fn("colspan",St(2).firstRowOffset)}function mZ(n,t){if(1&n){const e=zr();X(0,"td",5)(1,"button",6),Ft("click",function(){const s=si(e).$implicit;return fi(St(2).cellClicked(s))})("focus",function(r){const u=si(e).$implicit;return fi(St(2)._emitActiveDateChange(u,r))}),X(2,"div",7),Ce(3),Y()()()}if(2&n){const e=t.$implicit,i=t.index,r=St().index,s=St();td("width",100/s.numCols,"%"),fn("data-sbb-row",r)("data-sbb-col",i),ae(1),Li("sbb-calendar-body-disabled",!e.enabled)("sbb-calendar-body-active",s.isActiveCell(r,i))("sbb-calendar-body-range-background","range"===e.rangeBackground)("sbb-calendar-body-range-background-offset-start",null!==e.rangeBackground&&0===r&&s.firstRowOffset&&0===i)("sbb-calendar-body-selected-begin","begin"===e.rangeBackground)("sbb-calendar-body-selected-end","end"===e.rangeBackground)("sbb-calendar-body-selected",s.selectedValue===e.value)("sbb-calendar-body-today",s.todayValue===e.value),Le("tabindex",s.isActiveCell(r,i)?0:-1),fn("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",s.selectedValue===e.value)("aria-current",s.todayValue===e.value?"date":null),ae(2),An(e.displayValue)}}function gZ(n,t){if(1&n&&(X(0,"tr",1),ft(1,fZ,1,1,"td",2),ft(2,mZ,4,26,"td",3),Y()),2&n){const e=t.$implicit,i=t.index,r=St();ae(1),Le("ngIf",0===i&&r.firstRowOffset),ae(1),Le("ngForOf",e)}}function bZ(n,t){if(1&n&&(X(0,"th")(1,"span",5),Ce(2),Y(),X(3,"span",6),Ce(4),Y()()),2&n){const e=t.$implicit;ae(2),An(e.long),ae(2),An(e.narrow)}}function _Z(n,t){}function yZ(n,t){if(1&n){const e=zr();X(0,"button",3),Ft("click",function(){return si(e),fi(St().prevDay())}),en(1,"sbb-icon",4),Y()}if(2&n){const e=St();Le("disabled",e.disabled),fn("aria-label",e.prevDayAriaLabel)}}function vZ(n,t){1&n&&en(0,"sbb-datepicker-toggle")}function xZ(n,t){if(1&n){const e=zr();X(0,"button",5),Ft("click",function(){return si(e),fi(St().nextDay())}),en(1,"sbb-icon",6),Y()}if(2&n){const e=St();Le("disabled",e.disabled),fn("aria-label",e.nextDayAriaLabel)}}const wZ=["*"];class SZ{constructor(t,e,i,r,s){this.value=t,this.displayValue=e,this.ariaLabel=i,this.enabled=r,this.rangeBackground=s}}let KF=(()=>{class n{constructor(e,i){this._elementRef=e,this._ngZone=i,this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.selectedValueChange=new tn,this.activeDateChange=new tn}ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this.focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}cellClicked(e){!this.allowDisabledSelection&&!e.enabled||this.selectedValueChange.emit(e.value)}_emitActiveDateChange(e,i){e.enabled&&this.activeDateChange.emit(e.value)}get firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}isActiveCell(e,i){let r=e*this.numCols+i;return e&&(r-=this.firstRowOffset),r===this.activeCell}focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(jr(1)).subscribe(()=>{setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector(".sbb-calendar-body-active");e&&e.focus()})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Xn))},n.\u0275cmp=mn({type:n,selectors:[["","sbb-calendar-body",""]],hostAttrs:["role","grid",1,"sbb-calendar-body"],hostVars:1,hostBindings:function(e,i){2&e&&fn("aria-readonly",!0)},inputs:{label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell"},outputs:{selectedValueChange:"selectedValueChange",activeDateChange:"activeDateChange"},exportAs:["sbbCalendarBody"],attrs:pZ,decls:1,vars:1,consts:[["role","row",4,"ngFor","ngForOf"],["role","row"],["class","sbb-calendar-body-label",4,"ngIf"],["role","gridcell","class","sbb-calendar-body-cell-container",3,"width",4,"ngFor","ngForOf"],[1,"sbb-calendar-body-label"],["role","gridcell",1,"sbb-calendar-body-cell-container"],["type","button",1,"sbb-calendar-body-cell","sbb-button-reset-frameless",3,"tabindex","click","focus"],[1,"sbb-calendar-body-cell-content"]],template:function(e,i){1&e&&ft(0,gZ,3,2,"tr",0),2&e&&Le("ngForOf",i.rows)},dependencies:[Sl,ho],encapsulation:2,changeDetection:0}),n})();function Um(n){return Error(`SbbDatepicker: No provider found for ${n}.`)}class QF{constructor(t,e){this.start=t,this.end=e}}const mI=new It("SBB_DATEPICKER");let JF=(()=>{class n{constructor(e,i,r,s,u){if(this._dateAdapter=e,this.locale=i,this._changeDetectorRef=r,this._dateFormats=s,this.selectedChange=new tn,this.userSelection=new tn,this.activeDateChange=new tn,this.dateRange=null,!this._dateAdapter)throw Um("DateAdapter");if(!this._dateFormats)throw Um("SBB_DATE_FORMATS");u&&u.connected&&u.datepickerInput.value&&u.connected.datepickerInput.value?this.dateRange=new QF(u.datepickerInput.value,u.connected.datepickerInput.value):u&&u.main&&u.datepickerInput.value&&u.main.datepickerInput.value&&(this.dateRange=new QF(u.main.datepickerInput.value,u.datepickerInput.value));const m=this._dateAdapter.getFirstDayOfWeek(),y=this._dateAdapter.getDayOfWeekNames("narrow"),I=this._dateAdapter.getDayOfWeekNames("long").map((A,B)=>({long:A,narrow:y[B]}));this.weekdays=I.slice(m).concat(I.slice(0,m)),this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(e){const i=this._activeDate,r=this._getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this.init()}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this.selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}ngAfterContentInit(){this.init()}dateSelected(e){if(this.selectedDate!==e){const i=this._getDateFromDayOfMonth(e);this.selectedChange.emit(i)}this.userSelection.emit()}_updateActiveDate(e){const i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(e),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}handleCalendarBodyKeydown(e){const i=this._activeDate;switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:return void((!this.dateFilter||this.dateFilter(this._activeDate))&&(this.dateSelected(this._dateAdapter.getDate(this._activeDate)),this.userSelection.emit(),e.preventDefault()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}init(){this.selectedDate=this._getDateInCurrentMonth(this.selected),this.todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this.monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();const e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this.firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(e)-this._dateAdapter.getFirstDayOfWeek())%7,this._createWeekCells(),this._changeDetectorRef.markForCheck()}focusActiveCell(){this.sbbCalendarBody.focusActiveCell()}_focusActiveCellAfterViewChecked(){this.sbbCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromDayOfMonth(e){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),e)}_createWeekCells(){const e=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this.weeks=[[]];for(let r=0,s=this.firstWeekOffset;r<e;r++,s++){7===s&&(this.weeks.push([]),s=0);const u=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),m=this._shouldEnableDate(u),y=this._dateAdapter.format(u,this._dateFormats.dateA11yLabel),C=this._shouldApplyRangeBackground(u);this.weeks[this.weeks.length-1].push(new SZ(r+1,i[r],y,m,C))}}_shouldApplyRangeBackground(e){return this.dateRange&&this.dateRange.start&&this.dateRange.end&&!this._dateAdapter.sameDate(this.dateRange.start,this.dateRange.end)?this._dateAdapter.compareDate(e,this.dateRange.start)>0&&this._dateAdapter.compareDate(e,this.dateRange.end)<0?"range":this._isRangeLimit(e):null}_isRangeLimit(e){return 0===this._dateAdapter.compareDate(e,this.dateRange.start)?"begin":0===this._dateAdapter.compareDate(e,this.dateRange.end)?"end":null}_shouldEnableDate(e){return!!e&&(!this.dateFilter||this.dateFilter(e))&&(!this.minDate||this._dateAdapter.compareDate(e,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(e,this.maxDate)<=0)}_getDateInCurrentMonth(e){return e&&this._hasSameMonthAndYear(e,this.activeDate)?this._dateAdapter.getDate(e):null}_hasSameMonthAndYear(e,i){return!(!e||!i||this._dateAdapter.getMonth(e)!==this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(e)!==this._dateAdapter.getYear(i))}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(H(Gp,8),H($l),H(Cr),H(fS,8),H(mI,8))},n.\u0275cmp=mn({type:n,selectors:[["sbb-month-view"]],viewQuery:function(e,i){if(1&e&&cr(KF,7),2&e){let r;Fn(r=Nn())&&(i.sbbCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection",activeDateChange:"activeDateChange"},exportAs:["sbbMonthView"],decls:7,vars:7,consts:[[1,"sbb-calendar-table"],[1,"sbb-calendar-table-header"],[4,"ngFor","ngForOf"],["colspan","7","aria-hidden","true",1,"sbb-calendar-table-header-divider"],["sbb-calendar-body","",3,"label","rows","todayValue","selectedValue","labelMinRequiredCells","activeCell","selectedValueChange","activeDateChange","keydown"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(e,i){1&e&&(X(0,"table",0)(1,"thead",1)(2,"tr"),ft(3,bZ,5,2,"th",2),Y(),X(4,"tr"),en(5,"th",3),Y()(),X(6,"tbody",4),Ft("selectedValueChange",function(s){return i.dateSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keydown",function(s){return i.handleCalendarBodyKeydown(s)}),Y()()),2&e&&(ae(3),Le("ngForOf",i.weekdays),ae(3),oa("label",i.monthLabel),Le("rows",i.weeks)("todayValue",i.todayDate)("selectedValue",i.selectedDate)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1))},dependencies:[Sl,KF],encapsulation:2,changeDetection:0}),n})(),CZ=(()=>{class n{constructor(e,i,r){this._dateAdapter=e,this._labelSwitchToPreviousMonth=$localize`:Button label to switch to the previous month@@sbbDatepickerSwitchToPreviousMonth:Change to the previous month`,this._labelSwitchToNextMonth=$localize`:Button label to switch to the next month@@sbbDatepickerSwitchToNextMonth:Change to the next month`,this._labelSwitchToPreviousYear=$localize`:Button label to switch to the previous year@@sbbDatepickerSwitchToPreviousYear:Change to the previous year`,this._labelSwitchToNextYear=$localize`:Button label to switch to the next year@@sbbDatepickerSwitchToNextYear:Change to the next year`,this.calendar=i,this.calendar.stateChanges.subscribe(()=>r.markForCheck())}get monthText(){return this._dateAdapter.getMonthName(this.calendar.activeDate)}get yearText(){return this._dateAdapter.getYearName(this.calendar.activeDate)}previousMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1);this._assignActiveDate(e)}previousMonthEnabled(){return!this.calendar.minDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.minDate)}nextMonthEnabled(){return!this.calendar.maxDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.maxDate)}_isSameMonthView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(e)===this._dateAdapter.getMonth(i)}previousYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,1);this._assignActiveDate(e)}previousYearEnabled(){return!this.calendar.minDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.minDate)}nextYearEnabled(){return!this.calendar.maxDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.maxDate)}_isSameYearView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)}_assignActiveDate(e){this.calendar.activeDate=this.calendar.minDate&&this._dateAdapter.compareDate(this.calendar.minDate,e)>0?this.calendar.minDate:this.calendar.maxDate&&this._dateAdapter.compareDate(this.calendar.maxDate,e)<0?this.calendar.maxDate:e}}return n.\u0275fac=function(e){return new(e||n)(H(Gp,8),H(zi(()=>bI)),H(Cr))},n.\u0275cmp=mn({type:n,selectors:[["sbb-calendar-header"]],hostAttrs:[1,"sbb-calendar-header","sbb-icon-scaled"],exportAs:["sbbCalendarHeader"],decls:15,vars:12,consts:[[1,"sbb-calendar-controls"],[1,"sbb-calendar-controls-months"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-previous",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["aria-live","polite",1,"sbb-calendar-controls-label"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-next",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"],[1,"sbb-calendar-controls-years"]],template:function(e,i){1&e&&(X(0,"div",0)(1,"div",1)(2,"button",2),Ft("click",function(){return i.previousMonthClicked()}),en(3,"sbb-icon",3),Y(),X(4,"span",4),Ce(5),Y(),X(6,"button",5),Ft("click",function(){return i.nextMonthClicked()}),en(7,"sbb-icon",6),Y()(),X(8,"div",7)(9,"button",2),Ft("click",function(){return i.previousYearClicked()}),en(10,"sbb-icon",3),Y(),X(11,"span",4),Ce(12),Y(),X(13,"button",5),Ft("click",function(){return i.nextYearClicked()}),en(14,"sbb-icon",6),Y()()()),2&e&&(ae(2),Le("disabled",!i.previousMonthEnabled()),fn("aria-label",i._labelSwitchToPreviousMonth),ae(2),fn("aria-label",i.monthText),ae(1),An(i.monthText),ae(1),Le("disabled",!i.nextMonthEnabled()),fn("aria-label",i._labelSwitchToNextMonth),ae(3),Le("disabled",!i.previousYearEnabled()),fn("aria-label",i._labelSwitchToPreviousYear),ae(2),fn("aria-label",i.yearText),ae(1),An(i.yearText),ae(1),Le("disabled",!i.nextYearEnabled()),fn("aria-label",i._labelSwitchToNextYear))},dependencies:[Qa],encapsulation:2,changeDetection:0}),n})(),bI=(()=>{class n{constructor(e,i,r){if(this._dateAdapter=e,this._dateFormats=i,this._changeDetectorRef=r,this._moveFocusOnNextTick=!1,this.selectedChange=new tn,this.userSelection=new tn,this.stateChanges=new Kt,!this._dateAdapter)throw Um("DateAdapter");if(!this._dateFormats)throw Um("SBB_DATE_FORMATS")}get startAt(){return this._startAt}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get activeDate(){return this._clampedActiveDate}set activeDate(e){this._clampedActiveDate=this._dateAdapter.clampDate(e,this.minDate,this.maxDate),this.stateChanges.next()}ngAfterContentInit(){this.calendarHeaderPortal=new dd(this.headerComponent||CZ),this.activeDate=this.startAt||this._dateAdapter.today()}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this.stateChanges.complete()}ngOnChanges(e){const i=e.minDate&&!this._dateAdapter.sameDate(e.minDate.previousValue,e.minDate.currentValue)?e.minDate:void 0,r=e.maxDate&&!this._dateAdapter.sameDate(e.maxDate.previousValue,e.maxDate.currentValue)?e.maxDate:void 0,s=i||r||e.dateFilter;if(s&&!s.firstChange){const u=this._getCurrentViewComponent();u&&(this._changeDetectorRef.detectChanges(),u.init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent().focusActiveCell()}dateSelected(e){e&&!this._dateAdapter.sameDate(e,this.selected)&&this.selectedChange.emit(e)}userSelected(){this.userSelection.emit()}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}_getCurrentViewComponent(){return this.monthView}}return n.\u0275fac=function(e){return new(e||n)(H(Gp,8),H(fS,8),H(Cr))},n.\u0275cmp=mn({type:n,selectors:[["sbb-calendar"]],viewQuery:function(e,i){if(1&e&&cr(JF,7),2&e){let r;Fn(r=Nn())&&(i.monthView=r.first)}},hostAttrs:[1,"sbb-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection"},exportAs:["sbbCalendar"],features:[hr],decls:3,vars:6,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"sbb-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","activeDateChange","selectedChange","userSelection"]],template:function(e,i){1&e&&(ft(0,_Z,0,0,"ng-template",0),X(1,"div",1)(2,"sbb-month-view",2),Ft("activeDateChange",function(s){return i.activeDate=s})("selectedChange",function(s){return i.dateSelected(s)})("userSelection",function(){return i.userSelected()}),Y()()),2&e&&(Le("cdkPortalOutlet",i.calendarHeaderPortal),ae(2),Le("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate))},dependencies:[hd,Kq,JF],encapsulation:2,changeDetection:0}),n})(),TZ=(()=>{class n{ngAfterViewInit(){this.calendar.focusActiveCell()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["sbb-datepicker-content"]],viewQuery:function(e,i){if(1&e&&cr(bI,7),2&e){let r;Fn(r=Nn())&&(i.calendar=r.first)}},hostAttrs:[1,"sbb-datepicker-content"],exportAs:["sbbDatepickerContent"],decls:1,vars:10,consts:[["cdkTrapFocus","","role","dialog",1,"sbb-datepicker-content-container",3,"id","ngClass","startAt","minDate","maxDate","dateFilter","headerComponent","selected","selectedChange","userSelection"]],template:function(e,i){if(1&e&&(X(0,"sbb-calendar",0),Ft("selectedChange",function(s){return i.datepicker.select(s)})("userSelection",function(){return i.datepicker.close()}),Y()),2&e){let r;Le("id",i.datepicker.id)("ngClass",i.datepicker.panelClass)("startAt",i.datepicker.startAt)("minDate",i.datepicker.minDate)("maxDate",i.datepicker.maxDate)("dateFilter",i.datepicker.dateFilter)("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i.datepicker.selected),fn("aria-modal",!0)("aria-labelledby",null!==(r=i._dialogLabelId)&&void 0!==r?r:void 0)}},dependencies:[Ob,Nq,bI],styles:['.sbb-datepicker-content{position:relative;top:var(--sbb-datepicker-content-offset);font-size:var(--sbb-font-size)}.sbb-datepicker-panel-above .sbb-datepicker-content{top:auto;bottom:var(--sbb-datepicker-content-offset)}.sbb-datepicker-content::after{top:var(--sbb-datepicker-calendar-arrow-offset);left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width));content:"";height:var(--sbb-datepicker-calendar-arrow-width);width:var(--sbb-datepicker-calendar-arrow-width);position:absolute;pointer-events:none;transform:rotate(-135deg);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid rgba(0,0,0,0);border-right-color:var(--sbb-color-weak-accent);border-bottom-color:var(--sbb-color-weak-accent);clip-path:polygon(-0.4px 100%, 100% -0.4px, 100% 100%)}.sbb-datepicker-with-arrows .sbb-datepicker-content::after{left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width) + var(--sbb-icon-size-default) + var(--sbb-datepicker-button-gap))}.sbb-datepicker-panel-above .sbb-datepicker-content::after{top:auto;bottom:var(--sbb-datepicker-calendar-arrow-offset);transform:rotate(45deg);clip-path:var(--sbb-box-shadow-arrow-clip-path);box-shadow:var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-arrow-width) 0 var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-color)}.sbb-calendar{display:block;max-width:100%;width:var(--sbb-datepicker-calendar-width);height:var(--sbb-datepicker-calendar-height);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);box-shadow:var(--sbb-box-shadow-below)}.sbb-calendar-header{display:block;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls{display:flex;height:var(--sbb-datepicker-calendar-header-height);align-items:center}.sbb-calendar-controls-months,.sbb-calendar-controls-years{display:flex;height:var(--sbb-datepicker-calendar-header-height);flex:1 0 50%;text-align:center;position:relative}.sbb-calendar-controls-months::after{content:"";display:block;position:absolute;width:0;height:100%;top:0;right:0;border-right:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls-button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;flex-grow:0;outline:0;padding-left:var(--sbb-datepicker-calendar-controls-padding);padding-right:var(--sbb-datepicker-calendar-controls-padding);height:var(--sbb-datepicker-calendar-header-height);cursor:pointer;color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-controls-button:is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-calendar-controls-button:disabled{cursor:default;opacity:0}.sbb-calendar-controls-button-previous{float:left;padding-right:0}.sbb-calendar-controls-button-next{float:right;padding-left:0}.sbb-calendar-controls-label{flex-grow:1;flex-shrink:1;font-family:var(--sbb-font-light);font-size:1.4rem;line-height:3.2;color:var(--sbb-datepicker-calendar-header-color)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-calendar-controls-label{font-size:var(--sbb-font-size-large)}}:where(html.sbb-lean) .sbb-calendar-controls-label{font-size:var(--sbb-font-size);line-height:2.4rem}.sbb-calendar-content{padding:0 var(--sbb-datepicker-calendar-table-content-padding-width)}.sbb-calendar-table{width:100%;border-spacing:0;border-collapse:collapse;margin:0;position:relative}.sbb-calendar-table :is(td,th){color:var(--sbb-color-weak-accent);font-size:var(--sbb-font-size);line-height:1.5}.sbb-calendar-table-header::after{content:"";display:block;position:absolute;top:calc(2.2rem * var(--sbb-scaling-factor));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color);width:calc(100% + var(--sbb-datepicker-calendar-table-content-padding-width)*2);left:calc(var(--sbb-datepicker-calendar-table-content-padding-width)*-1)}.sbb-calendar-table-header tr th{font-family:var(--sbb-font-roman);font-weight:400;font-size:var(--sbb-font-size-small);text-transform:uppercase;padding:calc(0.4666666667rem * var(--sbb-scaling-factor));color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-table-header-divider{height:calc(1rem * var(--sbb-scaling-factor))}.sbb-calendar-body-cell-container{position:relative;height:0;padding:0;line-height:0;text-align:center}.sbb-calendar-body-cell{position:relative;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0;cursor:pointer}.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end)::before{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color);width:100%;left:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end,.sbb-calendar-body-range-background-offset-start))::before{width:50%}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-range-background-offset-start))::before{left:auto;right:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color)}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{border-radius:50% 0 0 50%}.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background::after{border-radius:0 50% 50% 0}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::before{display:none}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::after{border-radius:50%}.sbb-calendar-body-cell,.sbb-calendar-body-label{padding-top:var(--sbb-datepicker-calendar-body-cell-padding);padding-bottom:var(--sbb-datepicker-calendar-body-cell-padding)}.sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-cement);cursor:default}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-storm)}.sbb-calendar-body-cell.sbb-calendar-body-disabled::after{content:"";width:calc(2.1333333333rem * var(--sbb-scaling-factor));height:calc(0.0666666667rem * var(--sbb-scaling-factor));top:calc(1.6666666667rem * var(--sbb-scaling-factor));left:calc(50% - var(--sbb-datepicker-calendar-body-cell-disabled-offset));background-color:var(--sbb-color-cement);display:block;position:absolute;transform:rotate(-45deg)}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled::after{background-color:var(--sbb-color-storm);width:1.6rem;top:1.2rem}.sbb-calendar-body-today{font-family:var(--sbb-font-bold);color:var(--sbb-color-black)}.sbb-calendar-body-cell-content{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));border:var(--sbb-border-width) solid rgba(0,0,0,0);border-radius:50%;z-index:1}.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):is(:hover,:focus) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-call-to-action-hover);border-color:var(--sbb-color-call-to-action-hover)}:is(.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled).sbb-calendar-body-selected,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-weak-accent);border-color:var(--sbb-color-weak-accent)}'],encapsulation:2,changeDetection:0}),n})(),EZ=(()=>{class n{constructor(e,i,r){this._changeDetectorRef=e,this._datepicker=i,this._labelShowCalendar=$localize`:Open calendar@@sbbDatepickerOpenCalendar:Show calendar`,this._stateChanges=ie.EMPTY;const s=Number(r);this.tabIndex=s||0===s?s:null}get disabled(){return void 0===this._disabled?this._datepicker.disabled:this._disabled}set disabled(e){this._disabled=Hn(e)}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}open(e){this._datepicker&&!this.disabled&&(this._datepicker.open(),e.stopPropagation())}_watchStateChanges(){const e=this._datepicker?this._datepicker.disabledChange:Ln(),i=this._datepicker&&this._datepicker.datepickerInput?this._datepicker.datepickerInput.disabledChange:Ln(),r=this._datepicker?Er(this._datepicker.openedStream,this._datepicker.closedStream):Ln();this._stateChanges.unsubscribe(),this._stateChanges=Er(e,i,r).subscribe(()=>this._changeDetectorRef.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(H(Cr),H(mI),qo("tabindex"))},n.\u0275cmp=mn({type:n,selectors:[["sbb-datepicker-toggle"]],hostAttrs:[1,"sbb-datepicker-toggle"],hostVars:3,hostBindings:function(e,i){2&e&&(fn("tabindex",null),Li("sbb-datepicker-toggle-active",i._datepicker&&i._datepicker.opened))},inputs:{tabIndex:"tabIndex",disabled:"disabled"},features:[hr],decls:2,vars:3,consts:[["aria-haspopup","true","type","button",1,"sbb-datepicker-toggle-button","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:calendar-small"]],template:function(e,i){1&e&&(X(0,"button",0),Ft("click",function(s){return i.open(s)}),en(1,"sbb-icon",1),Y()),2&e&&(Le("disabled",i.disabled),fn("aria-label",i._labelShowCalendar)("tabindex",i.disabled?-1:i.tabIndex))},dependencies:[Qa],encapsulation:2,changeDetection:0}),n})(),DZ=0;const eN=new It("sbb-datepicker-scroll-strategy"),MZ={provide:eN,deps:[jo],useFactory:function IZ(n){return()=>n.scrollStrategies.reposition()}};let US=(()=>{class n{constructor(e,i,r,s,u,m,y){if(this._overlay=e,this._ngZone=i,this._viewContainerRef=r,this._changeDetectorRef=s,this._scrollStrategy=u,this._dateAdapter=m,this.locale=y,this._arrows=!1,this._toggle=!0,this.openedStream=new tn,this.closedStream=new tn,this._opened=!1,this.id="sbb-datepicker-"+DZ++,this._validSelected=null,this.nextDayAriaLabel=$localize`:Next day button's aria-label@@sbbDatePickerNextDayAriaLabel:Next day`,this.prevDayAriaLabel=$localize`:Previous day button's aria-label@@sbbDatePickerPrevDayAriaLabel:Previous day`,this._focusedElementBeforeOpen=null,this._inputSubscription=ie.EMPTY,this._inputChangeSubscription=ie.EMPTY,this._connectedDatepickerSubscription=ie.EMPTY,this._posStrategySubscription=ie.EMPTY,this.disabledChange=new Kt,this.selectedChanged=new Kt,!this._dateAdapter)throw Um("DateAdapter");this._dateAdapter.setLocale(y)}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.value:null)}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(e){const i=Hn(e);i!==this._disabled&&(this._disabled=i,this.disabledChange.next(i))}set connected(e){e!==this._connected&&this._connected&&(this._connected.main=null),e&&(e.main=this),this._connected=e}get connected(){return this._connected}get arrows(){return this._arrows}set arrows(e){this._arrows=Hn(e)}get arrowsVisible(){var e;return this.arrows&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get toggle(){return this._toggle}set toggle(e){this._toggle=Hn(e)}set notoggle(e){this._toggle=!Hn(e)}get toggleVisible(){var e;return this.toggle&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get opened(){return this._opened}set opened(e){Hn(e)?this.open():this.close()}get selected(){return this._validSelected}set selected(e){this._validSelected=e,this._changeDetectorRef.markForCheck()}get minDate(){return this.datepickerInput&&this.datepickerInput.min}get maxDate(){return this.datepickerInput&&this.datepickerInput.max}get dateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}get prevDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.minDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.minDate)>0)}get nextDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.maxDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.maxDate)<0)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._inputChangeSubscription.unsubscribe(),this._connectedDatepickerSubscription.unsubscribe(),this.disabledChange.complete(),this.popupRef&&(this._posStrategySubscription.unsubscribe(),this.popupRef.dispose(),this._popupComponentRef=null)}select(e){const i=this.selected;this.selected=e,this._dateAdapter.sameDate(i,this.selected)||this.selectedChanged.next(e)}nextDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,1),this.selectedChanged.next(this.selected))}prevDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,-1),this.selectedChanged.next(this.selected))}registerInput(e){if(this.datepickerInput)throw Error("A SbbDatepicker can only be associated with a single input.");this.datepickerInput=e,this._inputSubscription=this.datepickerInput.valueChange.subscribe(i=>this.selected=i),this._inputChangeSubscription=Er(this.datepickerInput.disabledChange,this.datepickerInput.readonlyChange).subscribe(()=>this._changeDetectorRef.markForCheck()),this._connectedDatepickerSubscription=Er(this.openedStream.pipe(_v("opened")),this.selectedChanged.pipe(_v("selected")),this.closedStream.pipe(_v("closed"))).pipe(function JX(n,t=null){return t=null!=t?t:n,ki((e,i)=>{let r=[],s=0;e.subscribe(Ii(i,u=>{let m=null;s++%t==0&&r.push([]);for(const y of r)y.push(u),n<=y.length&&(m=null!=m?m:[],m.push(y));if(m)for(const y of m)p(r,y),i.next(y)},()=>{for(const u of r)i.next(u);i.complete()},void 0,()=>{r=null}))})}(3,1),Tr(([i,r,s])=>!!this.connected&&!!this.datepickerInput.value&&"opened"===i&&"selected"===r&&"closed"===s&&(!this.connected.datepickerInput.value||this._dateAdapter.compareDate(this.datepickerInput.value,this.connected.datepickerInput.value)>0)),Vo(()=>{this.connected.datepickerInput.value&&(this.connected.datepickerInput.value=null,this.connected.datepickerInput._cvaOnChange(null))})).subscribe(()=>this.connected.open())}open(){if(!this._opened&&!this.disabled){if(!this.datepickerInput)throw Error("Attempted to open an SbbDatepicker with no associated input.");this._focusedElementBeforeOpen=du(),this._openAsPopup(),this._opened=!0,this.openedStream.emit()}}close(){if(!this._opened)return;this.popupRef&&this.popupRef.hasAttached()&&this.popupRef.detach(),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();const e=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(e)):e()}_getPanelClasses(){return["sbb-datepicker-panel",this.arrows?"sbb-datepicker-with-arrows":"sbb-datepicker-no-arrows"]}_openAsPopup(){this._calendarPortal||(this._calendarPortal=new dd(TZ,this._viewContainerRef)),this.popupRef?this.popupRef.getConfig().panelClass=this._getPanelClasses():this._createPopup(),this.popupRef.hasAttached()||(this._popupComponentRef=this.popupRef.attach(this._calendarPortal),this._popupComponentRef.instance.datepicker=this,this._popupComponentRef.instance._dialogLabelId=this.datepickerInput.getOverlayLabelId(),this._ngZone.onStable.asObservable().pipe(jr(1)).subscribe(()=>{this.popupRef.updatePosition()}))}_createPopup(){const e=new Fm({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"sbb-overlay-transparent-backdrop",scrollStrategy:this._scrollStrategy(),panelClass:this._getPanelClasses()});this.popupRef=this._overlay.create(e),Er(this.popupRef.backdropClick(),this.popupRef.detachments(),this.popupRef.keydownEvents().pipe(Tr(i=>27===i.keyCode||this.datepickerInput&&i.altKey&&38===i.keyCode))).subscribe(()=>this.close())}_createPopupPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".sbb-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withPush(!1).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}]);return this._posStrategySubscription=e.positionChanges.subscribe(i=>{"top"===i.connectionPair.originY?this.popupRef.hostElement.classList.add("sbb-datepicker-panel-above"):this.popupRef.hostElement.classList.remove("sbb-datepicker-panel-above")}),e}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(H(jo),H(Xn),H(zo),H(Cr),H(eN),H(Gp,8),H($l))},n.\u0275cmp=mn({type:n,selectors:[["sbb-datepicker"]],hostAttrs:[1,"sbb-datepicker"],hostVars:6,hostBindings:function(e,i){2&e&&Li("sbb-datepicker-arrows-enabled",i.arrowsVisible)("sbb-datepicker-toggle-enabled",i.toggleVisible)("sbb-datepicker-disabled",i.disabled)},inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",disabled:"disabled",panelClass:"panelClass",connected:"connected",arrows:"arrows",toggle:"toggle",notoggle:"notoggle",opened:"opened",nextDayAriaLabel:"nextDayAriaLabel",prevDayAriaLabel:"prevDayAriaLabel"},outputs:{openedStream:"opened",closedStream:"closed"},exportAs:["sbbDatepicker"],features:[Un([{provide:mI,useExisting:n}])],ngContentSelectors:wZ,decls:4,vars:3,consts:[["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-left sbb-icon-scaled",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-right sbb-icon-scaled",3,"disabled","click",4,"ngIf"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-left","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-right","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"]],template:function(e,i){1&e&&(Ro(),ft(0,yZ,2,2,"button",0),ft(1,vZ,1,0,"sbb-datepicker-toggle",1),Pr(2),ft(3,xZ,2,2,"button",2)),2&e&&(Le("ngIf",i.prevDayActive),ae(1),Le("ngIf",i.toggleVisible),ae(2),Le("ngIf",i.nextDayActive))},dependencies:[ho,Qa,EZ],styles:[".sbb-datepicker{display:inline-block;position:relative;color:var(--sbb-color-weak-accent)}.sbb-form-field .sbb-datepicker{width:100%}.sbb-datepicker-disabled{color:var(--sbb-color-granite)}.sbb-datepicker>.sbb-date-input{width:100%}:is(.sbb-datepicker-toggle-enabled,.sbb-datepicker-arrows-enabled)>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-right:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled.sbb-datepicker-toggle-enabled>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-and-arrows-padding)}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button){background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;position:absolute;top:50%;transform:translateY(-50%);outline:0;color:inherit;line-height:0}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled){cursor:pointer}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled):is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-datepicker-arrow-button-left,.sbb-datepicker-toggle-button{left:var(--sbb-datepicker-button-offset)}.sbb-datepicker-arrows-enabled .sbb-datepicker-toggle-button{left:var(--sbb-datepicker-adjacent-button-offset)}.sbb-datepicker-arrow-button-right{right:var(--sbb-datepicker-button-offset)}"],encapsulation:2,changeDetection:0}),n})();class HS{constructor(t,e){this.target=t,this.targetElement=e,this.value=this.target.value}}const AZ={provide:Za,useExisting:zi(()=>Zv),multi:!0},kZ={provide:$s,useExisting:zi(()=>Zv),multi:!0};let Zv=(()=>{class n{constructor(e,i,r,s,u){if(this._elementRef=e,this._dateAdapter=i,this._dateFormats=r,this._datepicker=s,this._formField=u,this._disabled=!1,this._readonly=!1,this.dateChange=new tn,this.dateInput=new tn,this.inputBlurred=new tn,this.valueChange=new tn,this.disabledChange=new tn,this.readonlyChange=new tn,this._datepickerSubscription=ie.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{sbbDateParse:{text:this._elementRef.nativeElement.value}},this._minValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.min||!y||this._dateAdapter.compareDate(this.min,y)<=0?null:{sbbDateMin:{min:this.min,actual:y}}},this._maxValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return!this.max||!y||this._dateAdapter.compareDate(this.max,y)>=0?null:{sbbDateMax:{max:this.max,actual:y}}},this._filterValidator=m=>{const y=this._getValidDateOrNull(this._dateAdapter.deserialize(m.value));return this._dateFilter&&y&&!this._dateFilter(y)?{sbbDateFilter:!0}:null},this._validator=hE.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw Um("DateAdapter");if(!this._dateFormats)throw Um("SBB_DATE_FORMATS")}set dateFilter(e){this._dateFilter=e,this._validatorOnChange()}get dateFilter(){return this._dateFilter}get value(){return this._value}set value(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._getValidDateOrNull(e);const i=this.value;this._value=e,this._formatValue(e),this._dateAdapter.sameDate(i,e)||this.valueChange.emit(e)}get min(){return this._min||(this._datepicker&&this._datepicker.main&&this._datepicker.main.datepickerInput&&this._datepicker.main.datepickerInput.value?this._datepicker.main.datepickerInput.value:null)}set min(e){this._min=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get max(){return this._max}set max(e){this._max=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get disabled(){return this._disabled}set disabled(e){const i=Hn(e),r=this._elementRef.nativeElement;this._disabled!==i&&(this._disabled=i,this.disabledChange.emit(i)),i&&r.blur&&r.blur()}get readonly(){return this._readonly}set readonly(e){this._readonly=Hn(e),this.readonlyChange.next(this._readonly)}ngOnInit(){!this._datepicker||(this._datepicker.registerInput(this),this._datepickerSubscription.unsubscribe(),this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(e=>{this.value=e,this._cvaOnChange(e),this._onTouched(),this.dateInput.emit(new HS(this,this._elementRef.nativeElement)),this.dateChange.emit(new HS(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this.valueChange.complete(),this.disabledChange.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}getConnectedOverlayOrigin(){return this._elementRef}writeValue(e){this.value=e}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){this._datepicker&&e.altKey&&40===e.keyCode&&(this._datepicker.open(),e.preventDefault())}_onInput(e){let i=this._dateAdapter.parse(e);this._lastValueValid=!i||this._dateAdapter.isValid(i),i=this._getValidDateOrNull(i),this._dateAdapter.sameDate(i,this._value)?this._validatorOnChange():(this._value=i,this._cvaOnChange(i),this.valueChange.emit(i),this.dateInput.emit(new HS(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new HS(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched(),this.inputBlurred.emit()}_formatValue(e){var i;const r=this._datepicker?this._dateFormats.dateInput:null!==(i=this._dateFormats.dateInputPure)&&void 0!==i?i:this._dateFormats.dateInput;this._elementRef.nativeElement.value=null!=e?this._dateAdapter.format(e,r):""}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Gp,8),H(fS,8),H(US,8),H(VS,8))},n.\u0275dir=Bt({type:n,selectors:[["input","sbbDateInput",""]],hostAttrs:[1,"sbb-date-input"],hostVars:5,hostBindings:function(e,i){1&e&&Ft("keydown",function(s){return i._onKeydown(s)})("input",function(s){return i._onInput(s.target.value)})("change",function(){return i._onChange()})("blur",function(){return i._onBlur()}),2&e&&(Cc("disabled",i.disabled),fn("aria-haspopup",i._datepicker?"dialog":null)("aria-owns",(null==i._datepicker?null:i._datepicker.opened)&&i._datepicker.id||null)("min",i.min?i._dateAdapter.toIso8601(i.min):null)("max",i.max?i._dateAdapter.toIso8601(i.max):null))},inputs:{dateFilter:"dateFilter",value:"value",min:"min",max:"max",disabled:"disabled",readonly:"readonly"},outputs:{dateChange:"dateChange",dateInput:"dateInput",inputBlurred:"inputBlurred"},exportAs:["sbbDateInput"],features:[Un([AZ,kZ,{provide:ZF,useExisting:n}])]}),n})(),tN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[MZ,{provide:Gp,useClass:VO},{provide:fS,useValue:FG}],imports:[pr,ua,Rm,Cl,Zi,yo]}),n})();const RZ=["input"],PZ=["*"];let LZ=0;const OZ={provide:Za,useExisting:zi(()=>$S),multi:!0};class nN{constructor(t,e){this.source=t,this.value=e}}const iN=new It("SbbRadioGroup"),_I=new It("SbbRadioButton");let FZ=(()=>{class n{constructor(e){this._changeDetector=e,this.change=new tn,this._value=null,this._name="sbb-radio-group-"+LZ++,this._selected=null,this._isInitialized=!1,this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{}}get name(){return this._name}set name(e){this._name=e,this._updateRadioButtonNames()}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}get selected(){return this._selected}set selected(e){this._selected=e,this.value=e?e.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(e){this._disabled=Hn(e),this._markRadiosForCheck()}get required(){return this._required}set required(e){this._required=Hn(e),this._markRadiosForCheck()}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}ngAfterContentInit(){this._isInitialized=!0}_touch(){this._onTouched&&this._onTouched()}_emitChangeEvent(){this._isInitialized&&this.change.emit(new nN(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(e=>e._markForCheck())}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetector.markForCheck()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(e=>{e.name=this.name,e._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(i=>{i.checked=this.value===i.value,i.checked&&(this._selected=i)}))}}return n.\u0275fac=function(e){return new(e||n)(H(Cr))},n.\u0275dir=Bt({type:n,contentQueries:function(e,i,r){if(1&e&&Vr(r,_I,5),2&e){let s;Fn(s=Nn())&&(i._radios=s)}},hostAttrs:[1,"sbb-radio-group-base"],inputs:{name:"name",value:"value",selected:"selected",disabled:"disabled",required:"required"},outputs:{change:"change"}}),n})(),$S=(()=>{class n extends FZ{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275dir=Bt({type:n,selectors:[["sbb-radio-group"]],contentQueries:function(e,i,r){if(1&e&&Vr(r,_I,5),2&e){let s;Fn(s=Nn())&&(i._radios=s)}},hostAttrs:["role","radiogroup",1,"sbb-radio-group"],exportAs:["sbbRadioGroup"],features:[Un([OZ,{provide:iN,useExisting:n}]),Xt]}),n})();const BZ=t_(class NZ{});let zZ=0,VZ=(()=>{class n extends BZ{constructor(e,i,r,s,u,m){super(),this._elementRef=i,this._changeDetector=r,this._focusMonitor=s,this._radioDispatcher=u,this._uniqueId="sbb-radio-button-"+ ++zZ,this.id=this._uniqueId,this.change=new tn,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=e,m&&(this.tabIndex=Th(m,0)),this._removeUniqueSelectionListener=u.listen((y,C)=>{y!==this.id&&C===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(e){const i=Hn(e);this._checked!==i&&(this._checked=i,i&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!i&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),i&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(e){this._setDisabled(Hn(e))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(e){this._required=Hn(e)}get inputId(){return`${this.id||this._uniqueId}-input`}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{!e&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new nN(this,this._value))}_onInputClick(e){e.stopPropagation()}_onInputChange(e){null==e||e.stopPropagation();const i=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),i&&this.radioGroup._emitChangeEvent())}_setDisabled(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}_updateTabIndex(){var e;const i=this.radioGroup;let r;if(r=i&&i.selected&&!this.disabled?i.selected===this?this.tabIndex:-1:this.tabIndex,r!==this._previousTabIndex){const s=null===(e=this._inputElement)||void 0===e?void 0:e.nativeElement;s&&(s.setAttribute("tabindex",r+""),this._previousTabIndex=r)}}}return n.\u0275fac=function(e){nu()},n.\u0275dir=Bt({type:n,viewQuery:function(e,i){if(1&e&&cr(RZ,5),2&e){let r;Fn(r=Nn())&&(i._inputElement=r.first)}},hostVars:1,hostBindings:function(e,i){2&e&&fn("id",i.id)},inputs:{id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],checked:"checked",value:"value",disabled:"disabled",required:"required"},outputs:{change:"change"},features:[Xt]}),n})(),yI=(()=>{class n extends VZ{constructor(e,i,r,s,u,m){super(e,i,r,s,u,m)}}return n.\u0275fac=function(e){return new(e||n)(H(iN,8),H(En),H(Cr),H(xa),H(sI),qo("tabindex"))},n.\u0275cmp=mn({type:n,selectors:[["sbb-radio-button"]],hostAttrs:[1,"sbb-radio-button","sbb-selection-item"],hostVars:9,hostBindings:function(e,i){1&e&&Ft("focus",function(){return i._inputElement.nativeElement.focus()}),2&e&&(fn("tabindex",null)("id",i.id)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),Li("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbRadioButton"],features:[Un([{provide:_I,useExisting:n}]),Xt],ngContentSelectors:PZ,decls:9,vars:11,consts:[[1,"sbb-selection-item-label"],["type","radio",1,"sbb-selection-input","sbb-radio-input","sbb-transparent-parent-overlay",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],[1,"sbb-selection-content"],[2,"display","none"]],template:function(e,i){1&e&&(Ro(),X(0,"label",0)(1,"input",1,2),Ft("change",function(s){return i._onInputChange(s)})("click",function(s){return i._onInputClick(s)}),Y(),X(3,"div",3),en(4,"div",4),Y(),X(5,"div",5)(6,"span",6),Ce(7,"\xa0"),Y(),Pr(8),Y()()),2&e&&(fn("for",i.inputId),ae(1),Le("id",i.inputId)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex)("required",i.required),fn("name",i.name)("value",i.value)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),vI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[Zi]}),n})();const jZ=/[0-9]{3,4}/,UZ=/([0-9]{1,2})[.:,\-;_hH]?([0-9]{1,2})?/,HZ=/([0-9]{1,2})([0-9]{2})/;let oN=(()=>{class n{constructor(e,i,r,s,u){this._elementRef=e,this._renderer=i,this._control=r,this._input=u,this._document=s,this.placeholder="HH:MM"}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=null!=e?e:"HH:MM",this._input&&(this._input.placeholder=this._placeholder)}_onBlur(e){const i=this._validateInput(e);if(!i||i.length<=2)return;const r=this._parseHour(i[1]),s=this._parseMinute(i[2]);if(this._control&&this._control.control)this._control.control.setValue(`${r}:${s}`);else{this._renderer.setProperty(this._elementRef.nativeElement,"value",`${r}:${s}`);const u=this._document.createEvent("Event");u.initEvent("input",!0,!0),this._elementRef.nativeElement.dispatchEvent(u)}}_validateInput(e){return jZ.test(e)?e.match(HZ):e?e.match(UZ):null}_parseHour(e){return e.length>1?e:"0"+e}_parseMinute(e){return(e=e||"00").length>1?e:"0"+e}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(gc),H(Wl,10),H(Gn),H(jm,8))},n.\u0275dir=Bt({type:n,selectors:[["input","sbbTimeInput",""]],hostAttrs:["type","text","pattern","[0-9]*","inputmode","numeric",1,"sbb-time-input","sbb-input-element"],hostVars:1,hostBindings:function(e,i){1&e&&Ft("blur",function(s){return i._onBlur(s.target.value)}),2&e&&fn("placeholder",i.placeholder)},inputs:{placeholder:"placeholder"},exportAs:["sbbTimeInput"]}),n})(),sN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[Zi]}),n})();function aN(n,t){return t?e=>bv(t.pipe(jr(1),function $Z(){return ki((n,t)=>{n.subscribe(Ii(t,$e))})}()),e.pipe(aN(n))):Wn((e,i)=>n(e,i).pipe(jr(1),_v(e)))}const GZ=["panel"];function WZ(n,t){if(1&n&&(X(0,"div",0,1),Pr(2),Y()),2&n){const e=t.id,i=St();Le("id",i.id)("ngClass",i._classList),fn("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}const XZ=["*"];let ZZ=0;class YZ{constructor(t,e){this.source=t,this.option=e}}const lN=new It("sbb-autocomplete-default-options",{providedIn:"root",factory:function KZ(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1}}});let cN=(()=>{class n{constructor(e,i,r,s){this._changeDetectorRef=e,this._elementRef=i,this._activeOptionChanges=ie.EMPTY,this._visibleClass="sbb-autocomplete-visible",this._hiddenClass="sbb-autocomplete-hidden",this._showPanel=new sa(!1),this._isOpen=!1,this.displayWith=null,this.localeNormalizer=null,this.optionSelected=new tn,this.opened=new tn,this.closed=new tn,this.optionActivated=new tn,this._classList={},this._showHintIfNoOptions=!1,this.id="sbb-autocomplete-"+ZZ++,this.inertGroups=(null==s?void 0:s.SAFARI)||!1,this._autoActiveFirstOption=!!r.autoActiveFirstOption,this._autoSelectActiveOption=!!r.autoSelectActiveOption}get showPanel(){return this._showPanel.value}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=Hn(e)}get autoSelectActiveOption(){return this._autoSelectActiveOption}set autoSelectActiveOption(e){this._autoSelectActiveOption=Hn(e)}set classList(e){this._classList=e&&e.length?_D(e).reduce((i,r)=>(i[r]=!0,i),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}get showHintIfNoOptions(){return this._showHintIfNoOptions}set showHintIfNoOptions(e){this._showHintIfNoOptions=Hn(e)}ngAfterContentInit(){this._keyManager=new yO(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this._showPanel.next(!!this.options.length||!!this.hints.length&&this.showHintIfNoOptions),this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const i=new YZ(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}}return n.\u0275fac=function(e){return new(e||n)(H(Cr),H(En),H(lN),H(ps))},n.\u0275cmp=mn({type:n,selectors:[["sbb-autocomplete"]],contentQueries:function(e,i,r){if(1&e&&(Vr(r,Nv,5),Vr(r,PD,5),Vr(r,$G,5)),2&e){let s;Fn(s=Nn())&&(i.options=s),Fn(s=Nn())&&(i.optionGroups=s),Fn(s=Nn())&&(i.hints=s)}},viewQuery:function(e,i){if(1&e&&(cr(eo,7),cr(GZ,5)),2&e){let r;Fn(r=Nn())&&(i.template=r.first),Fn(r=Nn())&&(i.panel=r.first)}},hostAttrs:[1,"sbb-autocomplete"],inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",localeNormalizer:"localeNormalizer",autoActiveFirstOption:"autoActiveFirstOption",autoSelectActiveOption:"autoSelectActiveOption",panelWidth:"panelWidth",classList:["class","classList"],showHintIfNoOptions:"showHintIfNoOptions"},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["sbbAutocomplete"],features:[Un([{provide:mS,useExisting:n}])],ngContentSelectors:XZ,decls:1,vars:0,consts:[["role","listbox",1,"sbb-panel","sbb-panel-padded","sbb-autocomplete-panel","sbb-scrollbar",3,"id","ngClass"],["panel",""]],template:function(e,i){1&e&&(Ro(),ft(0,WZ,3,4,"ng-template"))},dependencies:[Ob],styles:[".sbb-autocomplete-visible{visibility:visible}.sbb-autocomplete-hidden{visibility:hidden;padding:0 !important}:where(html:not(.sbb-lean)) .sbb-autocomplete-panel .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,changeDetection:0}),n})();const uN=new It("sbb-autocomplete-scroll-strategy"),JZ={provide:uN,deps:[jo],useFactory:function QZ(n){return()=>n.scrollStrategies.reposition()}};let qS=(()=>{class n{constructor(e,i,r,s,u,m,y,C,I,A){this._element=e,this._overlay=i,this._viewContainerRef=r,this._zone=s,this._changeDetectorRef=u,this._formField=y,this._document=C,this._viewportRuler=I,this._defaults=A,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._viewportSubscription=ie.EMPTY,this._positionSubscription=ie.EMPTY,this._highlightSubscription=ie.EMPTY,this._connectedElementClassSubscription=ie.EMPTY,this._inputValue=new sa(""),this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new Kt,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="sbb-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=xm(()=>{const B=this.autocomplete?this.autocomplete.options:null;return B?B.changes.pipe(As(B),aa(()=>Er(...B.map(j=>j.onSelectionChange)))):this._zone.onStable.pipe(jr(1),aa(()=>this.optionSelections))}),this._scrollStrategy=m}get autocomplete(){return this._autocomplete}set autocomplete(e){if(this._autocomplete=e,this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),!e)return;const i=e.options?Ln(null):this._zone.onStable.pipe(jr(1));this._highlightSubscription=i.pipe(aa(()=>vm([this._inputValue,e.options.changes.pipe(As(e.options.toArray()))])),Tr(r=>!!r[1]&&!!r[1].length)).subscribe(([r,s])=>{s.forEach(u=>u._highlight(r,this.autocomplete.localeNormalizer))}),this._connectedElementClassSubscription=this.autocomplete._showPanel.pipe($p(),Tr(r=>!r)).subscribe(()=>{this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")})}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=Hn(e)}ngAfterViewInit(){const e=this._getWindow();void 0!==e&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();void 0!==e&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay()}closePanel(){!this._overlayAttached||(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above"),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return Er(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Tr(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Tr(()=>this._overlayAttached)):Ln()).pipe(W(e=>e instanceof UO?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return Er(hu(this._document,"click"),hu(this._document,"auxclick"),hu(this._document,"touchend")).pipe(Tr(e=>{const i=Hp(e),r=this._formField?this._formField._elementRef.nativeElement:null,s=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&i!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!r||!r.contains(i))&&(!s||!s.contains(i))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(i)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const i=e.keyCode,r=ca(e);if(27===i&&!r&&e.preventDefault(),this.activeOption&&13===i&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const s=this.autocomplete._keyManager.activeItem,u=38===i||40===i;9===i||u&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):u&&this._canOpen()&&this.openPanel(),(u||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){const i=e.target;let r=i.value;"number"===i.type&&(r=""===r?null:parseFloat(r)),this._previousValue!==r&&(this._previousValue=r,this._pendingAutoselectedOption=null,this._onChange(r),this._inputValue.next(i.value),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay()):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_updateSize(){var e;null===(e=this._overlayRef)||void 0===e||e.updateSize({width:this._getPanelWidth()})}_subscribeToClosingActions(){const e=this._zone.onStable.pipe(jr(1)),i=this.autocomplete.options.changes.pipe(Vo(()=>this._positionStrategy.reapplyLastPosition()),function qZ(n,t=rS){const e=ED(n,t);return aN(()=>e)}(0));return Er(e,i).pipe(aa(()=>(this._zone.run(()=>{const r=this.panelOpen;if(this._resetActiveItem(),this.autocomplete._setVisibility(),this._changeDetectorRef.detectChanges(),this.panelOpen){const s=this.autocomplete.panel.nativeElement.scrollTop;this._overlayRef.updatePosition(),this.autocomplete.panel.nativeElement.scrollTop=s}r!==this.panelOpen&&(this.panelOpen?this.autocomplete.opened.emit():this.autocomplete.closed.emit())}),this.panelClosingActions)),jr(1)).subscribe(r=>this._setValueAndClose(r))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const i=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(null!=i?i:"")}_updateNativeInputValue(e){this._formField&&this._formField._control?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e,this._inputValue.next(e)}_setValueAndClose(e){const i=e?e.source:this._pendingAutoselectedOption;i&&(this._clearPreviousSelectedOption(i),this._assignOptionValue(i.value),this._onChange(i.value),this.autocomplete._emitSelectEvent(i),this._element.nativeElement.focus()),this.closePanel()}_clearPreviousSelectedOption(e){this.autocomplete.options.forEach(i=>{i!==e&&i.selected&&i.deselect()})}_attachOverlay(){var e;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new Pm(this.autocomplete.template,this._viewContainerRef,{id:null===(e=this._formField)||void 0===e?void 0:e.getLabelId()}),i=this._overlay.create(this._getOverlayConfig()),this._overlayRef=i,this._positionStrategy&&(this._positionSubscription.unsubscribe(),this._positionSubscription=vm([this._positionStrategy.positionChanges,this.autocomplete._showPanel]).subscribe(([s,u])=>{this.autocomplete.panel&&u&&(this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel"),"top"===s.connectionPair.originY?(this.autocomplete.panel.nativeElement.classList.add("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.autocomplete.panel.nativeElement.classList.remove("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")))})),this._handleOverlayEvents(i),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})})),i&&!i.hasAttached()&&(i.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const r=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&r!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var e;return new Fm({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),panelClass:_D(null===(e=this._defaults)||void 0===e?void 0:e.overlayPanelClass).concat("sbb-overlay-panel"),minHeight:0})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!0).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,s=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}];let u;u="above"===this.position?s:"below"===this.position?i:[...i,...s],e.withPositions(u)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;e.autoActiveFirstOption?e._keyManager.setFirstItemActive():e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}_scrollToOption(e){const i=this.autocomplete,r=function UG(n,t,e){if(e.length){const i=t.toArray(),r=e.toArray();let s=0;for(let u=0;u<n+1;u++)i[u].group&&i[u].group===r[s]&&s++;return s}return 0}(e,i.options,i.optionGroups);if(0===e&&1===r)i._setScrollTop(0);else if(i.panel){const s=i.options.toArray()[e];if(s){const u=s._getHostElement(),m=HO(u.offsetTop,u.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(m)}}}_handleOverlayEvents(e){e.keydownEvents().subscribe(i=>{var r;(27===i.keyCode&&!ca(i)||38===i.keyCode&&ca(i,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(null!==(r=this._valueBeforeAutoSelection)&&void 0!==r?r:""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),i.stopPropagation(),i.preventDefault())}),e.outsidePointerEvents().subscribe()}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(jo),H(zo),H(Xn),H(Cr),H(uN),H(VS,9),H(Gn,8),H(pu),H(lN,8))},n.\u0275dir=Bt({type:n,selectors:[["input","sbbAutocomplete",""]],hostAttrs:[1,"sbb-autocomplete-trigger"],hostVars:9,hostBindings:function(e,i){1&e&&Ft("focusin",function(){return i._handleFocus()})("blur",function(){return i._onTouched()})("input",function(s){return i._handleInput(s)})("keydown",function(s){return i._handleKeydown(s)})("click",function(){return i._handleClick()}),2&e&&(fn("autocomplete",i.autocompleteAttribute)("role",i.autocompleteDisabled?null:"combobox")("aria-autocomplete",i.autocompleteDisabled?null:"list")("aria-activedescendant",i.panelOpen&&i.activeOption?i.activeOption.id:null)("aria-expanded",i.autocompleteDisabled?null:i.panelOpen.toString())("aria-owns",i.autocompleteDisabled||!i.panelOpen||null==i.autocomplete?null:i.autocomplete.id)("aria-haspopup",i.autocompleteDisabled?null:"listbox"),Li("sbb-focused",i.panelOpen))},inputs:{autocomplete:["sbbAutocomplete","autocomplete"],position:["sbbAutocompletePosition","position"],connectedTo:["sbbAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["sbbAutocompleteDisabled","autocompleteDisabled"]},exportAs:["sbbAutocompleteTrigger"],features:[Un([{provide:Za,useExisting:zi(()=>n),multi:!0}]),hr]}),n})(),dN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[JZ],imports:[pr,Rm,Cl,Zi,gS,gS,Cl]}),n})();function eY(n,t){if(1&n&&(X(0,"sbb-option",11),Ce(1),Y()),2&n){const e=t.$implicit,i=t.index;Le("value",St(2).$implicit[0]+"."+i),ae(1),wi(" ",e.computeLocationName()," ")}}function tY(n,t){if(1&n&&(X(0,"sbb-optgroup",9),ft(1,eY,2,2,"sbb-option",10),Y()),2&n){const e=St().$implicit,i=St();Le("label",e[1]),ae(1),Le("ngForOf",i.mapLookupLocations[e[0]])}}function nY(n,t){if(1&n&&(na(0),ft(1,tY,2,2,"sbb-optgroup",8),ia()),2&n){const e=t.$implicit,i=St();ae(1),Le("ngIf",i.mapLookupLocations[e[0]].length>0)}}class iY{isErrorState(t,e){return!!(t&&t.invalid&&(t.dirty||t.touched||e&&e.submitted))}}let rY=(()=>{class n{constructor(e,i,r){this.mapService=e,this.userTripService=i,this.languageService=r,this.shouldFetchNewData=!0,this.inputControl=new Aw("",[hE.required]),this.inputControlMatcher=new iY,this.placeholder="",this.endpointType="From",this.inputValue="",this.selectedLocation=new tn,this.mapLookupLocations={},this.resetMapLocations(),this.optionLocationTypes=[["stop","Stops"],["poi","POIs"],["topographicPlace","Topographic Places"],["address","Addresses"]]}ngOnInit(){this.inputControl.valueChanges.pipe(Lv(500),$p()).subscribe(e=>{if(null===e||!this.shouldFetchNewData)return;if(0===e.trim().length)return void this.selectedLocation.emit(null);if(e.length<1)return;const i=to.initFromLiteralCoords(e);if(i)return this.resetMapLocations(),void this.handleCoordsPick(i);this.fetchJourneyPoints(e)})}ngOnChanges(e){if("inputValue"in e){const i=e.inputValue.currentValue;if(""===i)return;this.inputControl.setValue(i,{emitEvent:!1})}}onOpenAutocomplete(){this.shouldFetchNewData=!0}onOptionSelected(e){this.shouldFetchNewData=!1;const i=e.option.value.split(".");if(2!==i.length)return;const r=i[0],s=parseInt(i[1],10),u=this.mapLookupLocations[r][s],m=u.computeLocationName();this.inputControl.setValue(m),this.selectedLocation.emit(u)}fetchJourneyPoints(e){return Ke(this,void 0,void 0,function*(){let i=this.userTripService.getStageConfig();const s=yield el.initWithLocationName(i,this.languageService.language,e,[]).fetchResponse();this.resetMapLocations(),s.locations.forEach(u=>{const m=u.getLocationType();null!==m&&this.mapLookupLocations[m].push(u)})})}handleTapOnMapButton(){var e;const i="From"===this.endpointType?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,r=null!==(e=null==i?void 0:i.location)&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(r)}handleCoordsPick(e){const i=e.geoPosition;if(null===i)return;const r=i.asLatLngString(!1);this.inputControl.setValue(r),this.selectedLocation.emit(e)}resetMapLocations(){this.mapLookupLocations={address:[],poi:[],stop:[],topographicPlace:[]}}}return n.\u0275fac=function(e){return new(e||n)(H(mu),H(Sa),H(bd))},n.\u0275cmp=mn({type:n,selectors:[["journey-point-input"]],inputs:{placeholder:"placeholder",endpointType:"endpointType",inputValue:"inputValue"},outputs:{selectedLocation:"selectedLocation"},features:[hr],decls:11,vars:5,consts:[[1,"w-100","trip-endpoint"],[1,"endpoint-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["sbbInput","","type","text",1,"trip-endpoint",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected","opened"],["journeyPoint","sbbAutocomplete"],[4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(X(0,"sbb-form-field",0)(1,"div",1),Ft("click",function(){return i.handleTapOnMapButton()}),F(),X(2,"svg",2),en(3,"path",3),Y(),Ce(4),Y(),J(),en(5,"input",4),X(6,"sbb-error"),Ce(7,"Mandatory field, please complete."),Y()(),X(8,"sbb-autocomplete",5,6),Ft("optionSelected",function(s){return i.onOptionSelected(s)})("opened",function(){return i.onOpenAutocomplete()}),ft(10,nY,2,1,"ng-container",7),Y()),2&e){const r=va(9);ae(4),wi(" ",i.placeholder," "),ae(1),Le("placeholder",i.placeholder)("formControl",i.inputControl)("sbbAutocomplete",r),ae(5),Le("ngForOf",i.optionLocationTypes)}},dependencies:[Sl,ho,Mc,uu,kw,Nv,PD,cN,qS,a_,aZ,jm],styles:[".endpoint-label[_ngcontent-%COMP%]{font-size:12px}.endpoint-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})();const oY=["panel"];function sY(n,t){if(1&n&&(X(0,"span",7),Ce(1),Y()),2&n){const e=St();ae(1),An(e.readonly?"-":e.placeholder||"\xa0")}}function aY(n,t){if(1&n&&(X(0,"span",8)(1,"span"),Ce(2),Y()()),2&n){const e=St();ae(2),An(e.triggerValue||"\xa0")}}function lY(n,t){1&n&&en(0,"sbb-icon",9)}function cY(n,t){1&n&&en(0,"sbb-icon",10)}function uY(n,t){if(1&n){const e=zr();X(0,"div",11,12),Ft("@transformPanel.done",function(r){return si(e),fi(St()._panelDoneAnimatingStream.next(r.toState))})("keydown",function(r){return si(e),fi(St()._handleKeydown(r))}),Pr(2),Y()}if(2&n){const e=St();td("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),Li("sbb-select-multiple",e.multiple),Le("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),fn("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const dY=["*"],hY={transformPanel:Ms("transformPanel",[fr("void",Bn({opacity:0})),fr("showing",Bn({opacity:1})),fr("showing-multiple",Bn({opacity:1})),Xi("void => *",er("120ms cubic-bezier(0, 0, 0.2, 1)")),Xi("* => void",er("100ms 25ms linear",Bn({opacity:0})))])};let hN=0;const pN=new It("sbb-select-scroll-strategy"),fY=new It("SBB_SELECT_CONFIG"),mY={provide:pN,deps:[jo],useFactory:function pY(n){return()=>n.scrollStrategies.reposition()}};class gY{constructor(t,e){this.source=t,this.value=e}}const bY=t_(Ka(pS(Om(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Kt}}))));let _Y=(()=>{class n extends bY{constructor(e,i,r,s,u,m,y,C,I,A,B,j,K){var pe;super(s,m,y,I),this._viewportRuler=e,this._changeDetectorRef=i,this._ngZone=r,this._elementRef=u,this._parentFormField=C,this.ngControl=I,this._liveAnnouncer=j,this._defaultOptions=K,this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"}],this._panelOpen=!1,this._compareWith=(Se,Xe)=>Se===Xe,this._uid="sbb-select-"+hN++,this._triggerAriaLabelledBy=null,this._destroy=new Kt,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="sbb-select-value-"+hN++,this._panelDoneAnimatingStream=new Kt,this._overlayPanelClass=(null===(pe=this._defaultOptions)||void 0===pe?void 0:pe.overlayPanelClass)||"sbb-overlay-panel",this._focused=!1,this.controlType="sbb-select",this._multiple=!1,this._readonly=!1,this.ariaLabel="",this.optionSelectionChanges=xm(()=>{const Se=this.options;return Se?Se.changes.pipe(As(Se),aa(()=>Er(...Se.map(Xe=>Xe.onSelectionChange)))):this._ngZone.onStable.pipe(jr(1),aa(()=>this.optionSelectionChanges))}),this.openedChange=new tn,this._openedStream=this.openedChange.pipe(Tr(Se=>Se),W(()=>{})),this._closedStream=this.openedChange.pipe(Tr(Se=>!Se),W(()=>{})),this.selectionChange=new tn,this.valueChange=new tn,this.ngControl&&(this.ngControl.valueAccessor=this),null!=(null==K?void 0:K.typeaheadDebounceInterval)&&(this._typeaheadDebounceInterval=K.typeaheadDebounceInterval),this._scrollStrategyFactory=B,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(A,10)||0,this.id=this.id,this._overlayOrigin=new pF(u)}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){var e,i,r,s;return null!==(s=null!==(e=this._required)&&void 0!==e?e:null===(r=null===(i=this.ngControl)||void 0===i?void 0:i.control)||void 0===r?void 0:r.hasValidator(hE.required))&&void 0!==s&&s}set required(e){this._required=Hn(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=Hn(e)}get readonly(){return this._readonly}set readonly(e){this._readonly=Hn(e),this.stateChanges.next()}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){this._assignValue(e)&&this._onChange(e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=Th(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new S7(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe($p(),Oi(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(Oi(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(Oi(this._destroy)).subscribe(e=>{e.added.forEach(i=>i.select()),e.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(As(null),Oi(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby(),i=this.ngControl;if(e!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?r.setAttribute("aria-labelledby",e):r.removeAttribute("aria-labelledby")}this.ngControl&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(e){(e.disabled||e.userAriaDescribedBy)&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this._elementRef.nativeElement).fontSize||"0",10),this._ngZone.onStable.pipe(jr(1)).subscribe(()=>{this._triggerFontSize&&this.overlayDir.overlayRef&&this.overlayDir.overlayRef.overlayElement&&(this.overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`),this._calculateOverlayPosition()}))}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation("ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this._assignValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){var e,i;return this.multiple?(null===(e=this._selectionModel)||void 0===e?void 0:e.selected)||[]:null===(i=this._selectionModel)||void 0===i?void 0:i.selected[0]}get triggerValue(){return this.empty?"":this._multiple?this._selectionModel.selected.map(i=>i.viewValue).join(", "):this._selectionModel.selected[0].viewValue}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const i=e.keyCode,r=40===i||38===i||37===i||39===i,s=13===i||32===i,u=this._keyManager;if(!u.isTyping()&&s&&!ca(e)||(this.multiple||e.altKey)&&r)e.preventDefault(),this.open();else if(!this.multiple){const m=this.selected;u.onKeydown(e);const y=this.selected;y&&m!==y&&this._liveAnnouncer.announce(y.viewValue,1e4)}}_handleOpenKeydown(e){const i=this._keyManager,r=e.keyCode,s=40===r||38===r,u=i.isTyping();if(s&&e.altKey)e.preventDefault(),this.close();else if(u||13!==r&&32!==r||!i.activeItem||ca(e))if(!u&&this._multiple&&65===r&&e.ctrlKey){e.preventDefault();const m=this.options.some(y=>!y.disabled&&!y.selected);this.options.forEach(y=>{y.disabled||(m?y.select():y.deselect())})}else{const m=i.activeItemIndex;i.onKeydown(e),this._multiple&&s&&e.shiftKey&&i.activeItem&&i.activeItemIndex!==m&&i.activeItem._selectViaInteraction()}else e.preventDefault(),i.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this.overlayDir.positionChange.pipe(jr(1)).subscribe(e=>{"top"===e.connectionPair.originY?(this.panel.nativeElement.classList.add("sbb-panel-above"),this._elementRef.nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.panel.nativeElement.classList.remove("sbb-panel-above"),this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above")),this._changeDetectorRef.detectChanges(),this._positioningSettled()})}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(e);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(e){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return null!=r.value&&this._compareWith(r.value,e)}catch(s){return!1}});return i&&this._selectionModel.select(i),i}_assignValue(e){return!!(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e,!0)}_initKeyManager(){this._keyManager=new yO(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation("ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(Oi(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(Oi(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=Er(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(Oi(e)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),Er(...this.options.map(i=>i._stateChanges)).pipe(Oi(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,i){const r=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(r!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),i&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),i&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),r!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,e):e.indexOf(i)-e.indexOf(r)),this.stateChanges.next()}}_propagateChanges(e){let i=null;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:e,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(new gY(this,i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0&&!this.readonly}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let r=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(r+=" "+this.ariaLabelledby),r}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this.overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),e||this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above"),this.openedChange.emit(e)}_getOverlayMinWidth(){var e;return null===(e=this._triggerRect)||void 0===e?void 0:e.width}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}_calculateOverlayScroll(e,i,r){const s=e._getHostElement().offsetHeight,u=e._getHostElement().offsetTop;return Math.min(Math.max(0,u-i+s/2),r)}_scrollOptionIntoView(e){if(0===e)this.panel.nativeElement.scrollTop=0;else{const i=this.options.toArray()[e];if(i){const r=i._getHostElement();this.panel.nativeElement.scrollTop=HO(r.offsetTop,r.offsetHeight,this.panel.nativeElement.scrollTop,this.panel.nativeElement.offsetHeight)}}}_positioningSettled(){this.panel.nativeElement.scrollTop=this._scrollTop}_calculateOverlayPosition(){if(!this.panel)return;const e=this.panel.nativeElement.clientHeight,r=this.panel.nativeElement.scrollHeight-e,s=this._selectionModel.selected[0];this._scrollTop=this.empty||-1===this.options.toArray().indexOf(s)?0:this._calculateOverlayScroll(s,e/2,r)}}return n.\u0275fac=function(e){return new(e||n)(H(pu),H(Cr),H(Xn),H(RD),H(En),H(zb,8),H(Vb,8),H(VS,8),H(Wl,10),qo("tabindex"),H(pN),H(TO),H(fY,8))},n.\u0275cmp=mn({type:n,selectors:[["sbb-select"]],contentQueries:function(e,i,r){if(1&e&&(Vr(r,Nv,5),Vr(r,PD,5)),2&e){let s;Fn(s=Nn())&&(i.options=s),Fn(s=Nn())&&(i.optionGroups=s)}},viewQuery:function(e,i){if(1&e&&(cr(oY,5),cr(fF,5)),2&e){let r;Fn(r=Nn())&&(i.panel=r.first),Fn(r=Nn())&&(i.overlayDir=r.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"sbb-select","sbb-input-element"],hostVars:26,hostBindings:function(e,i){1&e&&Ft("click",function(){return i.toggle()})("keydown",function(s){return i._handleKeydown(s)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&e&&(fn("id",i.id)("tabindex",i.readonly?-1:i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-owns",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),Li("sbb-disabled",i.disabled)("sbb-select-invalid",i.errorState)("sbb-select-required",i.required)("sbb-select-empty",i.empty)("sbb-select-multiple",i.multiple)("sbb-readonly",i.readonly)("sbb-focused",i.focused)("sbb-input-with-open-panel",i.panelOpen))},inputs:{disabled:"disabled",tabIndex:"tabIndex",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",readonly:"readonly",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["sbbSelect"],features:[Un([{provide:Xv,useExisting:n},{provide:mS,useExisting:n}]),Xt,hr],ngContentSelectors:dY,decls:8,vars:20,consts:[["aria-hidden","true",1,"sbb-select-value",3,"ngSwitch"],["class","sbb-select-placeholder",4,"ngSwitchCase"],["class","sbb-select-value-text",4,"ngSwitchCase"],[3,"ngSwitch"],["class","sbb-icon-scaled sbb-select-arrow-icon","svgIcon","kom:chevron-small-down-small",4,"ngSwitchCase"],["class","sbb-icon-scaled sbb-select-arrow-icon sbb-select-arrow-icon-lean","svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayFlexibleDimensions","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","cdkConnectedOverlayOffsetX","cdkConnectedOverlayOffsetY","cdkConnectedOverlayMinHeight","backdropClick","attach","detach"],[1,"sbb-select-placeholder"],[1,"sbb-select-value-text"],["svgIcon","kom:chevron-small-down-small",1,"sbb-icon-scaled","sbb-select-arrow-icon"],["svgIcon","kom:chevron-right-small",1,"sbb-icon-scaled","sbb-select-arrow-icon","sbb-select-arrow-icon-lean"],["role","listbox","tabindex","-1",1,"sbb-panel","sbb-panel-padded","sbb-select-panel","sbb-scrollbar",3,"ngClass","keydown"],["panel",""]],template:function(e,i){1&e&&(Ro(),X(0,"div",0),ft(1,sY,2,1,"span",1),ft(2,aY,3,1,"span",2),Y(),na(3,3),Mb(4,"async"),ft(5,lY,1,0,"sbb-icon",4),ft(6,cY,1,0,"sbb-icon",5),ia(),ft(7,uY,3,12,"ng-template",6),Ft("backdropClick",function(){return i.close()})("attach",function(){return i._onAttached()})("detach",function(){return i.close()})),2&e&&(Li("sbb-select-value-empty",i.empty),Le("ngSwitch",i.empty),fn("id",i._valueId),ae(1),Le("ngSwitchCase",!0),ae(1),Le("ngSwitchCase",!1),ae(1),Le("ngSwitch",Ab(4,18,i.variant)),ae(2),Le("ngSwitchCase","standard"),ae(1),Le("ngSwitchCase","lean"),ae(1),Le("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",i._overlayOrigin)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayWidth",i._getOverlayMinWidth())("cdkConnectedOverlayOffsetX",0)("cdkConnectedOverlayOffsetY",i._offsetY)("cdkConnectedOverlayMinHeight",30))},dependencies:[Ob,Fb,Zx,fF,Qa,nv],styles:[".sbb-select{display:inline-block;cursor:pointer;position:relative;text-align:left;padding-right:calc(2.9333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-select{padding-right:2.5333333333rem}.sbb-select:is([readonly],.sbb-readonly){cursor:default}.sbb-form-field .sbb-select,.sbb-table th.sbb-header-cell.sbb-table-filter .sbb-select{display:block}.sbb-select-value{overflow:hidden;text-overflow:ellipsis}:where(html.sbb-lean) .sbb-select-value-empty{color:var(--sbb-color-storm)}.sbb-select-arrow-icon{position:absolute;top:50%;transform:translateY(-50%);right:calc(0.6rem * var(--sbb-scaling-factor));color:var(--sbb-color-granite)}:where(html.sbb-lean) .sbb-select-arrow-icon{right:.4rem}.sbb-select:is([readonly],.sbb-readonly) .sbb-select-arrow-icon{display:none}.sbb-select-arrow-icon>svg{transition:transform 120ms cubic-bezier(0, 0, 0.2, 1)}.sbb-input-with-open-panel .sbb-select-arrow-icon>svg{transform:rotate(180deg)}.sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(90deg)}.sbb-input-with-open-panel .sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(-90deg)}.sbb-select-panel :is(.sbb-menu-group+.sbb-menu-group,.sbb-menu-item+.sbb-menu-group,.sbb-menu-group+.sbb-menu-item){border-top:none}:where(html:not(.sbb-lean)) .sbb-select-panel.sbb-select-multiple .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[hY.transformPanel]},changeDetection:0}),n})(),fN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[mY],imports:[pr,Cl,Zi,yo,gS,gS,Cl]}),n})();const yY=["settingsContainer"];function vY(n,t){if(1&n&&(X(0,"sbb-option",17),Ce(1),Y()),2&n){const e=t.$implicit,i=St();Le("value",e.modeType),ae(1),An(i.computeTripModeTypeText(e.modeType))}}function xY(n,t){if(1&n){const e=zr();X(0,"div",18),Ft("click",function(){return si(e),fi(St().showRequestXmlPopover())}),X(1,"span",19),Ce(2,"XML"),Y()()}}function wY(n,t){if(1&n&&(X(0,"sbb-option",17),Ce(1),Y()),2&n){const e=t.$implicit,i=St();Le("value",e),ae(1),An(i.computeTripTransportModeText(e))}}function SY(n,t){if(1&n){const e=zr();X(0,"div",20)(1,"div",21),Ft("click",function(){return si(e),fi(St().handleTapOnMapButton())}),F(),X(2,"svg",22),en(3,"path",23),Y(),Ce(4," Via "),Y(),J(),X(5,"div",24)(6,"div"),Ce(7),Y(),en(8,"div",25),X(9,"button",26),Ft("click",function(){return si(e),fi(St().removeVia())}),F(),X(10,"svg",27),en(11,"path",28)(12,"path",29),Y(),Ce(13," Remove "),Y()()()}if(2&n){const e=St();ae(7),An(e.computeViaName())}}let CY=(()=>{class n{constructor(e,i,r){this.debugXmlPopover=e,this.userTripService=i,this.mapService=r,this.tripTransportModeData=[{modeType:"monomodal",transportModes:["public_transport","walk","cycle","self-drive-car","bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start",transportModes:["walk","cycle","bicycle_rental","escooter_rental","taxi","others-drive-car"]},{modeType:"mode_at_end",transportModes:["walk","bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start_end",transportModes:["walk","bicycle_rental","escooter_rental"]}],this.tripModeType=this.tripTransportModeData[0].modeType,this.tripTransportModes=JSON.parse(JSON.stringify(this.tripTransportModeData[0].transportModes)),this.tripTransportMode=this.tripTransportModes[0],this.tripModeTypeIdx=0,this.tripMotTypeDataModel={},this.settingsCollapseID="mode_custom_mode_settings_NOT_READY_YET",this.endpointMinDurationS="2",this.endpointMaxDurationS="30",this.endpointMinDistanceS="100",this.endpointMaxDistanceS="20000"}ngOnInit(){var e;this.tripModeType=this.userTripService.tripModeTypes[this.tripModeTypeIdx];const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.tripModeType))&&void 0!==e?e:this.tripTransportModeData[0];this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.tripTransportMode=this.userTripService.tripTransportModes[this.tripModeTypeIdx],this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment(),this.tripMotTypeDataModel.requestInfo=null,this.userTripService.activeTripSelected.subscribe(r=>{this.updateRequestDataModel()}),this.userTripService.defaultsInited.subscribe(r=>{this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx)}),this.settingsCollapseID="mode_custom_mode_settings_"+this.tripModeTypeIdx}isLastSegment(){return this.tripModeTypeIdx===this.userTripService.tripModeTypes.length-1}handleTapOnMapButton(){var e;const i=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;this.mapService.tryToCenterAndZoomToLocation(i.location)}computeViaName(){var e,i,r;const s=null!==(e=this.userTripService.viaTripLocations[this.tripModeTypeIdx])&&void 0!==e?e:null;return null===s?"":null!==(r=null===(i=s.location.geoPosition)||void 0===i?void 0:i.asLatLngString())&&void 0!==r?r:""}removeVia(){this.userTripService.removeViaAtIndex(this.tripModeTypeIdx)}onTripModeChange(){var e;const i=null!==(e=this.tripTransportModeData.find(s=>s.modeType===this.tripModeType))&&void 0!==e?e:null;null!==i&&(this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),-1!==this.tripTransportModes.indexOf(this.tripTransportMode)||(this.tripTransportMode=this.tripTransportModes[0]),this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx))}onTransportModeChange(){this.userTripService.updateTripMode(this.tripModeType,this.tripTransportMode,this.tripModeTypeIdx),this.userTripService.updateTripLocationCustomMode(this.tripModeTypeIdx),"public_transport"===this.tripTransportMode&&this.settingsContainer.nativeElement.classList.remove("show")}updateRequestDataModel(){var e;this.tripMotTypeDataModel.isNotLastSegment=!this.isLastSegment();const i=null!==(e=this.userTripService.journeyTripRequests[this.tripModeTypeIdx])&&void 0!==e?e:null;this.tripMotTypeDataModel.requestInfo=null!==i?i.requestInfo:null}showRequestXmlPopover(){const e=this.debugXmlPopover.open(PS,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{this.tripMotTypeDataModel.requestInfo&&e.componentInstance.updateRequestData(this.tripMotTypeDataModel.requestInfo)})}computeTripModeTypeText(e){var i;return null!==(i={monomodal:"Monomodal",mode_at_start:"Mode at Start",mode_at_end:"Mode at End",mode_at_start_end:"Mode at Start & End"}[e])&&void 0!==i?i:"n/a"}computeTripTransportModeText(e){var i;return null!==(i={public_transport:"Public Transport",walk:"Walking",cycle:"Own Bicycle",escooter_rental:"eScooter Sharing",car_sharing:"Car Sharing","self-drive-car":"Own Car",bicycle_rental:"Bicycle Sharing",charging_station:"Charging Stations",taxi:"Taxi","others-drive-car":"Limousine","car-shuttle-train":"Autoverlad",car:"Car","car-ferry":"Ferry"}[e])&&void 0!==i?i:"n/a"}onRestrictionsChange(){const e=parseInt(this.endpointMinDurationS,10),i=parseInt(this.endpointMaxDurationS,10),r=parseInt(this.endpointMinDistanceS,10),s=parseInt(this.endpointMaxDistanceS,10);this.userTripService.updateTripLocationRestrictions(e,i,r,s,this.tripModeTypeIdx)}}return n.\u0275fac=function(e){return new(e||n)(H(tl),H(Sa),H(mu))},n.\u0275cmp=mn({type:n,selectors:[["trip-mode-type"]],viewQuery:function(e,i){if(1&e&&cr(yY,5),2&e){let r;Fn(r=Nn())&&(i.settingsContainer=r.first)}},inputs:{tripModeTypeIdx:"tripModeTypeIdx"},decls:39,vars:14,consts:[[1,"trip-mot-type-container"],[1,"d-flex","align-items-center","via-mot"],[1,"flex-grow-1"],[1,"w-100"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","xml-info",3,"click",4,"ngIf"],[1,"mobility-settings"],["sbb-secondary-button","","type","button","data-bs-toggle","collapse","aria-expanded","false",3,"disabled"],["svgIcon","kom:combined-mobility-small"],[1,"mobility-settings-left-v2","endpoint-settings-wrapper","collapse",3,"id"],["settingsContainer",""],[1,"endpoint-settings","d-none2"],[1,"d-flex","align-items-center","mb-2"],["sbbInput","",2,"width","50px",3,"ngModel","ngModelChange","change"],["sbbInput","",2,"width","70px",3,"ngModel","ngModelChange","change"],["class","via-content",4,"ngIf"],[3,"value"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"via-content"],[1,"via-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],[1,"d-flex","align-items-center"],[2,"width","8px"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-x-circle"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"]],template:function(e,i){1&e&&(X(0,"div",0)(1,"div",1)(2,"div",2)(3,"sbb-form-field",3)(4,"sbb-label"),Ce(5,"Choose Monomodal / Multimodal"),Y(),X(6,"sbb-select",4),Ft("ngModelChange",function(s){return i.tripModeType=s})("selectionChange",function(){return i.onTripModeChange()}),ft(7,vY,2,2,"sbb-option",5),Y()()(),ft(8,xY,3,0,"div",6),Y(),X(9,"div",1)(10,"div",2)(11,"sbb-form-field",3)(12,"sbb-label"),Ce(13,"Choose MOT (Mode of Transport)"),Y(),X(14,"sbb-select",4),Ft("ngModelChange",function(s){return i.tripTransportMode=s})("selectionChange",function(){return i.onTransportModeChange()}),ft(15,wY,2,2,"sbb-option",5),Y()()(),X(16,"div",7)(17,"button",8),en(18,"sbb-icon",9),Y()()(),X(19,"div",10,11)(21,"div",12)(22,"div",13)(23,"div",2),Ce(24," Duration (mins) "),Y(),X(25,"div")(26,"input",14),Ft("ngModelChange",function(s){return i.endpointMinDurationS=s})("change",function(){return i.onRestrictionsChange()}),Y(),X(27,"span"),Ce(28," to "),Y(),X(29,"input",14),Ft("ngModelChange",function(s){return i.endpointMaxDurationS=s})("change",function(){return i.onRestrictionsChange()}),Y()()(),X(30,"div",13)(31,"div",2),Ce(32," Distance (meters) "),Y(),X(33,"div")(34,"input",14),Ft("ngModelChange",function(s){return i.endpointMinDistanceS=s})("change",function(){return i.onRestrictionsChange()}),Y(),X(35,"span"),Ce(36," to "),Y(),X(37,"input",15),Ft("ngModelChange",function(s){return i.endpointMaxDistanceS=s})("change",function(){return i.onRestrictionsChange()}),Y()()()()(),ft(38,SY,14,1,"div",16),Y()),2&e&&(ae(6),Le("ngModel",i.tripModeType),ae(1),Le("ngForOf",i.tripTransportModeData),ae(1),Le("ngIf",i.tripMotTypeDataModel.requestInfo),ae(6),Le("ngModel",i.tripTransportMode),ae(1),Le("ngForOf",i.tripTransportModes),ae(2),oa("disabled","monomodal"===i.tripModeType),fn("data-bs-target","#"+i.settingsCollapseID+("monomodal"===i.tripModeType?"_DISABLED":""))("aria-controls",i.settingsCollapseID),ae(2),oa("id",i.settingsCollapseID),ae(7),Le("ngModel",i.endpointMinDurationS),ae(3),Le("ngModel",i.endpointMaxDurationS),ae(5),Le("ngModel",i.endpointMinDistanceS),ae(3),Le("ngModel",i.endpointMaxDistanceS),ae(1),Le("ngIf",i.tripMotTypeDataModel.isNotLastSegment))},dependencies:[Sl,ho,Mc,uu,cd,Nv,GF,a_,zS,Qa,jm,_Y],styles:[".trip-mot-type-container[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.via-content[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:16px}.via-mot[_ngcontent-%COMP%]{margin-left:12px}.via-label[_ngcontent-%COMP%]{font-size:12px}.via-label[_ngcontent-%COMP%]:hover{cursor:pointer}.xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}.mobility-settings[_ngcontent-%COMP%]{margin-left:5px;margin-top:3px}.mobility-settings-left-v2[_ngcontent-%COMP%]{margin-left:10px}.endpoint-settings[_ngcontent-%COMP%]{margin-bottom:18px;margin-left:12px;margin-right:12px;padding:0 14px;border-color:#cacaca;border-style:solid;border-width:0 1px 1px 1px;border-radius:2px}"]}),n})();function TY(n,t){1&n&&ra(0)}function EY(n,t){1&n&&en(0,"trip-mode-type",29),2&n&&Le("tripModeTypeIdx",t.index)}function DY(n,t){if(1&n&&(na(0),ft(1,EY,1,1,"trip-mode-type",28),ia()),2&n){const e=St(2);ae(1),Le("ngForOf",e.userTripService.journeyTripsPlaceholder)}}function IY(n,t){if(1&n&&(X(0,"sbb-radio-button",30),Ce(1),Y()),2&n){const e=t.$implicit;Le("value",e),ae(1),An(e)}}function MY(n,t){if(1&n){const e=zr();X(0,"sbb-radio-button",34),Ft("change",function(r){return si(e),fi(St(3).onChangeStageAPI(r))}),Ce(1),Y()}if(2&n){const e=t.$implicit,i=St(3);Le("value",e)("checked",i.userTripService.currentAppStage==e),ae(1),wi(" ",e," ")}}function AY(n,t){if(1&n&&(X(0,"div",31)(1,"div")(2,"sbb-radio-group",32),ft(3,MY,2,3,"sbb-radio-button",33),Y()()()),2&n){const e=St(2);ae(3),Le("ngForOf",e.appStageOptions)}}function kY(n,t){1&n&&en(0,"span",35)}function RY(n,t){if(1&n){const e=zr();X(0,"div",36)(1,"button",37),Ft("click",function(){return si(e),fi(St(2).loadInputTripXMLPopover())}),Ce(2," Debug XML "),Y()()}}function PY(n,t){if(1&n){const e=zr();X(0,"div",6)(1,"div",7)(2,"journey-point-input",8),Ft("selectedLocation",function(r){return si(e),fi(St().onLocationSelected(r,"From"))}),Y()()(),ft(3,DY,2,1,"ng-container",9),X(4,"div",10)(5,"div",7)(6,"journey-point-input",8),Ft("selectedLocation",function(r){return si(e),fi(St().onLocationSelected(r,"To"))}),Y()(),X(7,"div",11)(8,"button",12),Ft("click",function(){return si(e),fi(St().swapEndpoints())}),en(9,"sbb-icon",13),Y()()(),X(10,"div",6)(11,"div")(12,"sbb-form-field",14)(13,"sbb-datepicker",15)(14,"input",16),Ft("ngModelChange",function(r){return si(e),fi(St().searchDate=r)})("dateChange",function(){return si(e),fi(St().onChangeDateTime())}),Y()()()(),X(15,"div",17)(16,"sbb-form-field",18)(17,"input",19),Ft("ngModelChange",function(r){return si(e),fi(St().searchTime=r)})("change",function(){return si(e),fi(St().onChangeDateTime())}),Y()()(),X(18,"div",20)(19,"sbb-radio-group",21),Ft("ngModelChange",function(r){return si(e),fi(St().userTripService.currentBoardingType=r)}),ft(20,IY,2,2,"sbb-radio-button",22),Y()()(),ft(21,AY,4,1,"div",23),X(22,"div",6)(23,"div",24)(24,"button",25),Ft("click",function(){return si(e),fi(St().handleTapOnSearch())}),ft(25,kY,1,0,"span",26),Ce(26," Search Journeys "),Y()(),ft(27,RY,3,0,"div",27),Y()}if(2&n){const e=St();ae(2),Le("endpointType","From")("inputValue",e.fromLocationText)("placeholder","From"),ae(1),Le("ngIf",!e.isEmbed),ae(3),Le("endpointType","To")("inputValue",e.toLocationText)("placeholder","To"),ae(8),Le("ngModel",e.searchDate),ae(3),Le("ngModel",e.searchTime),ae(2),Le("ngModel",e.userTripService.currentBoardingType),ae(1),Le("ngForOf",e.tripRequestBoardingTypes),ae(1),Le("ngIf",!1===e.isEmbed),ae(3),Le("disabled",e.shouldDisableSearchButton()),ae(1),Le("ngIf",e.isSearching),ae(2),Le("ngIf",!e.isEmbed)}}function LY(n,t){if(1&n&&(X(0,"div")(1,"span",41),Ce(2),Y()()),2&n){const e=St(2);ae(2),An(e.requestDurationF)}}function OY(n,t){if(1&n){const e=zr();na(0),X(1,"div")(2,"a",42),Ce(3,"Permalink"),Y()(),X(4,"div",43),Ce(5," | "),Y(),X(6,"div")(7,"a",44),Ft("click",function(){return si(e),fi(St(2).loadEmbedHTMLPopover())}),Ce(8,"Embed"),Y()(),ia()}if(2&n){const e=St(2);ae(2),oa("href",e.userTripService.permalinkRelativeURL,_a)}}function FY(n,t){if(1&n&&(X(0,"div",38)(1,"div",1)(2,"div",39),ft(3,LY,3,1,"div",9),en(4,"div",40),ft(5,OY,9,1,"ng-container",9),Y()()()),2&n){const e=St();ae(3),Le("ngIf",null!==e.requestDurationF),ae(2),Le("ngIf",null!==e.userTripService.permalinkRelativeURL)}}function NY(n,t){if(1&n&&(X(0,"div",38)(1,"div",1)(2,"div",39)(3,"div")(4,"a",42),Ce(5,"Open in OJP Demo App"),Y()()()()()),2&n){const e=St();ae(4),oa("href",e.userTripService.permalinkRelativeURL,_a)}}let mN=(()=>{class n{constructor(e,i,r,s,u,m,y){this.notificationToast=e,this.tripXmlPopover=i,this.embedHTMLPopover=r,this.router=s,this.languageService=u,this.userTripService=m,this.mapService=y,this.appStageOptions=[];const C=this.userTripService.departureDate;this.searchDate=C,this.searchTime=wa.formatTimeHHMM(C),this.fromLocationText="",this.toLocationText="",this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.isSearching=!1,this.tripRequestFormattedXML="RequestXML",this.tripResponseFormattedXML="ResponseXML",this.requestDurationF=null,this.lastCustomTripRequestXML=null,this.useMocks=!1,this.headerText="Search",this.tripRequestBoardingTypes=["Dep","Arr"];const I=new URLSearchParams(document.location.search);this.useMocks="yes"===I.get("use_mocks"),this.isEmbed=-1!==this.router.url.indexOf("/embed/")}ngOnInit(){this.userTripService.locationsUpdated.subscribe(e=>{this.updateLocationTexts()}),this.userTripService.tripsUpdated.subscribe(e=>{e.length>0?this.collapseSearchPanel():this.expandSearchPanel()}),this.userTripService.searchParamsReset.subscribe(()=>{this.expandSearchPanel(),this.requestDurationF=null}),this.userTripService.defaultsInited.subscribe(e=>{this.customInitFromParams()}),this.userTripService.tripRequestFinished.subscribe(e=>{const i=zF.computeExecutionTime(e.requestDateTime,e.responseDateTime),r=zF.computeExecutionTime(e.responseDateTime,e.parseDateTime);this.requestDurationF=(i+r).toFixed(2)+" sec"}),this.userTripService.initDefaults(this.languageService.language)}customInitFromParams(){var e;if(this.useMocks)return void this.initLocationsFromMocks();const i=new URLSearchParams(document.location.search);if(null!==(e=i.get("do_search"))&&void 0!==e&&e)return void this.handleTapOnSearch();const s=i.get("gist");s&&this.initFromGistRef(s)}updateLocationTexts(){const i=[];if(["From","To"].forEach(r=>{var s,u;const m="From"===r?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,y=null!==(s=null==m?void 0:m.location)&&void 0!==s?s:null;if(null===y)return;let C=null!==(u=y.computeLocationName())&&void 0!==u?u:"";"From"===r?this.fromLocationText=C.trim():this.toLocationText=C.trim(),i.push(C)}),this.isEmbed){const r=[];r.push(""===this.fromLocationText?"From Location":this.fromLocationText),r.push("-"),r.push(""===this.toLocationText?"To Location":this.toLocationText),this.headerText=r.join(" ")}}initLocationsFromMocks(){return Ke(this,void 0,void 0,function*(){const i=yield(yield fetch("/path/to/mock")).text();this.initFromMockXML(i)})}initFromMockXML(e){return Ke(this,void 0,void 0,function*(){const i=Rc.initWithResponseMock(e);i.fetchResponseWithCallback(r=>{"TripRequest.Trip"===r.message&&1===r.trips.length&&this.handleCustomTripResponse(r.trips,i,!1),"TripRequest.DONE"===r.message&&(this.userTripService.massageTrips(r.trips),this.handleCustomTripResponse(r.trips,i,!0))})})}initFromGistRef(e){return Ke(this,void 0,void 0,function*(){const i=e.match(/https:\/\/gist.github.com\/[^\/]+?\/([0-9a-z]*)/);i&&(e=i[1]);const r="https://api.github.com/gists/"+e,u=(yield(yield fetch(r)).json()).files;for(const m in u){const y=u[m];if("XML"===y.language){this.initFromMockXML(y.content);break}}})}onLocationSelected(e,i){this.userTripService.updateTripEndpoint(e,i,"SearchForm")}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value),this.userTripService.refetchEndpointsByName(this.languageService.language)}onChangeDateTime(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}computeFormDepartureDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}shouldDisableSearchButton(){return!!this.isSearching}handleTapOnSearch(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate());const e=QD.initWithLocationsAndDate(this.languageService.language,this.userTripService.fromTripLocation,this.userTripService.toTripLocation,this.userTripService.viaTripLocations,this.userTripService.tripModeTypes,this.userTripService.tripTransportModes,this.userTripService.departureDate,this.userTripService.currentBoardingType,"NumberOfResults");if(null===e)return void this.notificationToast.open("Please check from/to input points",{type:"error",verticalPosition:"top"});this.notificationToast.dismiss();const i=this.userTripService.getStageConfig(),r=new TW(i,e);this.isSearching=!0,r.fetchResponse(s=>{if(s.error)return this.notificationToast.open(s.error.message,{type:"error",verticalPosition:"top"}),this.isSearching=!1,this.userTripService.journeyTripRequests=[],this.requestDurationF=null,this.userTripService.updateTrips([]),void this.userTripService.selectActiveTrip(null);const u=s.sections.flatMap(m=>m.trips);if(this.userTripService.journeyTripRequests=r.tripRequests,"JourneyRequest.DONE"===s.message)if(0===u.length&&this.notificationToast.open("No trips found",{type:"info",verticalPosition:"top"}),this.userTripService.tripRequestFinished.emit(r.tripRequests[0].requestInfo),this.isSearching=!1,this.userTripService.updateTrips(u),u.length>0){const y=u[0];this.userTripService.selectActiveTrip(y),this.mapService.zoomToTrip(y),this.userTripService.fetchFares()}else this.userTripService.selectActiveTrip(null);else"TripRequest.Trip"===s.message&&(this.userTripService.updateTrips(u),1===u.length)&&this.mapService.zoomToTrip(u[0]),"ERROR"===s.message&&(this.isSearching=!1)})}expandSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.open()}collapseSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.close()}loadInputTripXMLPopover(){const e=this.tripXmlPopover.open(TX,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{const i=e.componentInstance;i.inputTripRequestXML=this.userTripService.computeTripRequestXML(this.languageService.language,this.computeFormDepartureDate());const r=s=>{this.lastCustomTripRequestXML=i.inputTripRequestXML;const u=Rc.initWithResponseMock(s);u.fetchResponse().then(m=>{i.inputTripRequestResponseXML=s,e.close(),this.userTripService.massageTrips(m.trips),this.handleCustomTripResponse(m.trips,u,!0)})};i.tripCustomRequestSaved.subscribe(r),i.tripCustomResponseSaved.subscribe(r)})}handleCustomTripResponse(e,i,r){if(this.requestDurationF="USER XML",this.isSearching=!1,this.userTripService.tripRequestFinished.emit(i.requestInfo),this.userTripService.journeyTripRequests=[i],this.userTripService.updateTrips(e),this.updateSearchForm(e),e.length>0){const u=e[0];this.userTripService.selectActiveTrip(u),this.mapService.zoomToTrip(u),r&&this.userTripService.fetchFares()}}updateSearchForm(e){0!==e.length&&(this.userTripService.updateParamsFromTrip(e[0]),this.updateLocationTexts())}swapEndpoints(){this.userTripService.switchEndpoints()}loadEmbedHTMLPopover(){this.embedHTMLPopover.open(FX,{position:{top:"20px"}}).afterOpened().subscribe(()=>{})}}return n.\u0275fac=function(e){return new(e||n)(H(hI),H(tl),H(tl),H(hs),H(bd),H(Sa),H(mu))},n.\u0275cmp=mn({type:n,selectors:[["app-search-form"]],viewQuery:function(e,i){if(1&e&&cr(Ah,7),2&e){let r;Fn(r=Nn())&&(i.searchPanel=r.first)}},decls:11,vars:5,consts:[[1,"row","mb-1"],[1,"col"],[3,"expanded"],[4,"ngTemplateOutlet"],["searchContent",""],["class","row mb-2",4,"ngIf"],[1,"d-flex"],[1,"flex-grow-1","journey-endpoint"],[3,"endpointType","inputValue","placeholder","selectedLocation"],[4,"ngIf"],[1,"d-flex","align-items-center"],[1,"swap-endpoints"],["sbb-secondary-button","","data-bs-toggle","collapse","aria-expanded","false",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px","width","100px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[2,"margin-top","28px"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["class","mb-2 d-flex",4,"ngIf"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","ms-auto",4,"ngIf"],[3,"tripModeTypeIdx",4,"ngFor","ngForOf"],[3,"tripModeTypeIdx"],[3,"value"],[1,"mb-2","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"row","mb-2"],[1,"d-flex","flex-row-reverse"],[2,"width","7px"],[1,"badge","bg-success"],["target","_blank",3,"href"],["clas","text-center",2,"width","7px","margin-left","4px"],["target","_blank","role","button",1,"text-decoration-underline",3,"click"]],template:function(e,i){if(1&e&&(X(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Ce(5),Y(),ft(6,TY,1,0,"ng-container",3),Y()()()(),ft(7,PY,28,15,"ng-template",null,4,hh),ft(9,FY,6,2,"div",5),ft(10,NY,6,1,"div",5)),2&e){const r=va(8);ae(3),Le("expanded",!0),ae(2),An(i.headerText),ae(1),Le("ngTemplateOutlet",r),ae(3),Le("ngIf",!i.isEmbed),ae(1),Le("ngIf",i.isEmbed&&null!==i.userTripService.permalinkRelativeURL)}},dependencies:[Sl,ho,tv,Mc,uu,cd,FS,Ah,Wv,GF,US,Zv,a_,Qa,jm,yI,$S,oN,rY,CY],styles:[".debug-xml[_ngcontent-%COMP%]:hover{cursor:pointer}.swap-endpoints[_ngcontent-%COMP%]{margin-left:5px;margin-top:10px}"]}),n})(),xI=(()=>{class n{constructor(){this.model={sdkVersion:FD,lastUpdate:"28.August 2024"}}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["web-footer"]],decls:132,vars:2,consts:[[1,"d-none"],["id","map-debug-control"],[1,"fw-bold"],["id","map_debug_center"],["id","map_debug_zoom"],["id","map-layers-legend-control"],[1,"map-layers-legend-wrapper"],[1,"d-flex","flex-row"],[1,"flex-grow-1","map-layers-header"],["href","#map_layers_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_body",1,"content-collapse","align-middle"],[1,"bi","bi-plus-circle"],[1,"bi","bi-dash-circle"],["id","map_layers_body",1,"collapse","show"],["data-map-layer-key","stops",1,"map-layer-data","mb-2"],["type","checkbox","checked","",1,"map-layer-checkbox","align-middle"],[1,"layer-text"],[1,"layer-xml-info","badge","bg-info","text-dark"],["data-map-layer-key","addresses",1,"map-layer-data","mb-2"],["type","checkbox",1,"map-layer-checkbox","align-middle"],[1,"flex-grow-1"],["href","#map_layers_mobility_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_mobility_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_mobility_body",1,"collapse","mb-2",2,"margin-left","8px"],["data-map-layer-key","sharing_cars",1,"map-layer-data"],["data-map-layer-key","sharing_bicycles",1,"map-layer-data"],["data-map-layer-key","sharing_scooters",1,"map-layer-data"],["data-map-layer-key","charging_stations",1,"map-layer-data"],[1,"map-composite-pois"],["href","#map_layers_pois_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_pois_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_pois_body",1,"collapse","mb-2",2,"margin-left","8px"],["type","checkbox","data-osm-tag","service",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","shopping",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","leisure",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","catering",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","public",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","parkride",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","accommodation",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","sbb_services",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","other",1,"map-layer-poi","align-middle"],[1,"row","bg-ojp-blue","text-white"],[1,"bg-ojp-orange","w-100",2,"height","5px"],[1,"col"],[1,"footer"],["href","https://opentransportdata.swiss/en/","target","_blank"],["href","https://github.com/openTdataCH/ojp-demo-app-src/blob/main/CHANGELOG.md","target","_blank"],["href","https://github.com/openTdataCH/ojp-js/blob/main/CHANGELOG.md","target","_blank"],[1,"row",2,"height","16px"]],template:function(e,i){1&e&&(X(0,"div",0)(1,"div",1)(2,"div")(3,"span",2),Ce(4,"Center"),Y(),Ce(5,": "),X(6,"span",3),Ce(7,"n/a"),Y()(),X(8,"div")(9,"span",2),Ce(10,"Zoom"),Y(),Ce(11,": "),X(12,"span",4),Ce(13,"n/a"),Y()()(),X(14,"div",5)(15,"div",6)(16,"div",7)(17,"div",8),Ce(18,"Toggle Map Layers"),Y(),X(19,"div")(20,"a",9),en(21,"i",10)(22,"i",11),Y()()(),X(23,"div",12)(24,"div",13),en(25,"input",14),X(26,"span",15),Ce(27,"Stops (z13+)"),Y(),X(28,"span",16),Ce(29,"XML"),Y()(),X(30,"div",17),en(31,"input",18),X(32,"span",15),Ce(33,"Addresses (z17+)"),Y(),X(34,"span",16),Ce(35,"XML"),Y()(),X(36,"div",7)(37,"div",19),Ce(38,"Shared Mobility"),Y(),X(39,"div")(40,"a",20),en(41,"i",10)(42,"i",11),Y()()(),X(43,"div",21)(44,"div",22),en(45,"input",18),X(46,"span",15),Ce(47,"Shared Cars (z12+)"),Y(),X(48,"span",16),Ce(49,"XML"),Y()(),X(50,"div",23),en(51,"input",18),X(52,"span",15),Ce(53,"Shared Bicycles (z14+)"),Y(),X(54,"span",16),Ce(55,"XML"),Y()(),X(56,"div",24),en(57,"input",18),X(58,"span",15),Ce(59,"Shared Scooters (z14+)"),Y(),X(60,"span",16),Ce(61,"XML"),Y()(),X(62,"div",25),en(63,"input",18),X(64,"span",15),Ce(65,"Charging Stations (z12+)"),Y(),X(66,"span",16),Ce(67,"XML"),Y()()(),X(68,"div",26)(69,"div",7)(70,"div",19),Ce(71,"Other POIs (z16+) "),X(72,"span",16),Ce(73,"XML"),Y()(),X(74,"div")(75,"a",27),en(76,"i",10)(77,"i",11),Y()()(),X(78,"div",28)(79,"div"),en(80,"input",29),X(81,"span",15),Ce(82,"Service"),Y()(),X(83,"div"),en(84,"input",30),X(85,"span",15),Ce(86,"Shopping"),Y()(),X(87,"div"),en(88,"input",31),X(89,"span",15),Ce(90,"Leisure"),Y()(),X(91,"div"),en(92,"input",32),X(93,"span",15),Ce(94,"Catering"),Y()(),X(95,"div"),en(96,"input",33),X(97,"span",15),Ce(98,"Public"),Y()(),X(99,"div"),en(100,"input",34),X(101,"span",15),Ce(102,"Parkride"),Y()(),X(103,"div"),en(104,"input",35),X(105,"span",15),Ce(106,"Accommodation"),Y()(),X(107,"div"),en(108,"input",36),X(109,"span",15),Ce(110,"SBB Services"),Y()(),X(111,"div"),en(112,"input",37),X(113,"span",15),Ce(114,"Other"),Y()()()()()()()(),X(115,"div",38),en(116,"div",39),X(117,"div",40)(118,"div",41)(119,"div"),Ce(120," \xa9 "),X(121,"a",42),Ce(122,"Open-Data-Plattform Mobilit\xe4t Schweiz"),Y(),Ce(123," 2021 - 2024 "),Y(),X(124,"div"),Ce(125," Last Update: "),X(126,"a",43),Ce(127),Y(),Ce(128," - "),X(129,"a",44),Ce(130),Y()()()()(),en(131,"div",45)),2&e&&(ae(127),An(i.model.lastUpdate),ae(3),wi("OJP SDK ",i.model.sdkVersion,""))},encapsulation:2}),n})(),wI=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["web-header"]],decls:19,vars:0,consts:[[1,"row"],[1,"col","nav-main","bg-ojp-blue"],[1,"d-flex","flex-row","align-items-center","justify-content-between"],[1,"navbar-brand","text-white"],["src","assets/opentransportdata.swiss.header-icons.svg","height","23",1,"mb-2"],[1,"d-none","d-md-flex"],[1,"nav-item"],["href","https://github.com/openTdataCH/ojp-demo-app-src",1,"nav-link"],["href","https://github.com/openTdataCH/ojp-demo-app-src/blob/main/docs/README.md",1,"nav-link"],["href","https://opentransportdata.swiss/en/cookbook/open-journey-planner-ojp/",1,"nav-link"],[1,"bg-ojp-orange","w-100",2,"height","10px"]],template:function(e,i){1&e&&(X(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"span",3),Ce(5,"OJP Demo"),Y(),en(6,"br")(7,"img",4),Y(),X(8,"div",5)(9,"div",6)(10,"a",7),Ce(11,"Source Code"),Y()(),X(12,"div",6)(13,"a",8),Ce(14,"Docs"),Y()(),X(15,"div",6)(16,"a",9),Ce(17,"OJP Cookbook"),Y()()()()(),en(18,"div",10),Y())},encapsulation:2}),n})(),BY=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["journey-search"]],decls:19,vars:6,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active"],["sbb-tab-link","",3,"active","routerLink"],["tabPanel",""],[1,"row"],[1,"col-md-5"],[1,"col-md-7"]],template:function(e,i){if(1&e&&(X(0,"div",0),en(1,"web-header"),X(2,"div",1)(3,"nav",2)(4,"a",3),Ce(5,"Journey Search"),Y(),X(6,"a",4),Ce(7,"Station Board"),Y(),X(8,"a",4),Ce(9,"Trip Info"),Y()(),X(10,"sbb-tab-nav-panel",null,5)(12,"div",6)(13,"div",7),en(14,"app-search-form")(15,"journey-results"),Y(),X(16,"div",8),en(17,"app-map"),Y()()()(),en(18,"web-footer"),Y()),2&e){const r=va(11);ae(3),Le("tabPanel",r),ae(1),Le("active","true"),ae(2),Le("active","false")("routerLink","../board"),ae(2),Le("active","false")("routerLink","../trip")}},dependencies:[Xb,yS,OD,vS,BF,SX,mN,xI,wI],styles:[".app-root[_ngcontent-%COMP%]{border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})();const zY=JSON.parse('{"id":"ojp-service-track-line","type":"line","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"LineString"]],"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-width":4,"line-opacity":1,"line-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"]}}'),VY=JSON.parse('{"id":"ojp-service-track-stop","type":"circle","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"Point"]],"layout":{},"paint":{"circle-radius":["case",["==",["get","point-size"],"large"],6,4],"circle-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"],"circle-stroke-color":"#FFF","circle-stroke-width":["case",["==",["get","point-size"],"large"],3,1]}}');class gN{constructor(t){this.map=t,this.sourceID="stop-event-service-data",this.geojsonFeatures=[],this.addMapLayers(t)}addMapLayers(t){t.addSource(this.sourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const i=zY;i.source=this.sourceID,t.addLayer(i);const r=VY;r.source=this.sourceID,t.addLayer(r)}drawStopEvent(t){this.drawStopPoints(t.prevStopPoints,t.nextStopPoints,t.stopPoint)}drawServiceStopPoints(t){this.drawStopPoints([],t,t[0])}drawStopPoints(t,e,i){this.geojsonFeatures=[];const r={prev:[],next:[]},s={prev:[],next:[]},u=["prev","next"];if(u.forEach(y=>{const C="prev"===y;let I=C?t:e;I.forEach((A,B)=>{const j=A.location.geoPosition;if(null===j)return;r[y].push(j.asPosition());const K=0===B,pe=B===I.length-1,Se=A.location.asGeoJSONFeature();Se&&Se.properties&&(Se.properties["point-type"]=y,Se.properties["point-size"]=C?K?"large":"normal":pe?"large":"normal",s[y].push(Se))})}),i){const y=i.location.geoPosition;if(y){r.prev.push(y.asPosition()),r.next.unshift(y.asPosition());const C=i.location.asGeoJSONFeature();C&&C.properties&&(C.properties["point-type"]="next",C.properties["point-size"]="large",s.next.push(C))}}u.forEach(y=>{const C=r[y];C.length<2||(this.geojsonFeatures.push({type:"Feature",properties:{"line-type":y},geometry:{type:"LineString",coordinates:C}}),this.geojsonFeatures=this.geojsonFeatures.concat(s[y]))}),this.udateStopEventSource({type:"FeatureCollection",features:this.geojsonFeatures})}resetStopEventLayers(){this.geojsonFeatures=[],this.udateStopEventSource({type:"FeatureCollection",features:[]})}udateStopEventSource(t){const e=this.map.getSource(this.sourceID);if(null===e)return console.error("ERROR - cant find the source "+this.sourceID),void console.log(this.map.getStyle());e.setData(t)}}let SI=(()=>{class n{constructor(){this.stationBoardDataUpdated=new tn,this.stationBoardEntrySelected=new tn,this.stationOnMapClicked=new tn}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),jY=(()=>{class n{constructor(e,i,r,s,u){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.stationBoardService=s,this.languageService=u,this.mapLoadingPromise=null,this.stopEventServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToLocation(r,e)})}),this.stationBoardService.stationBoardEntrySelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.updateMapForEntry(e)})})}initMap(){const e=this.mapService.createMap("map_canvas_station_board");this.mapLoadingPromise=new Promise((i,r)=>{e.on("load",s=>{i(e),this.onMapLoad(e)})})}onMapLoad(e){this.addMapControls(e),this.addMapListeners(e),this.stopEventServiceRenderer=new gN(e)}addMapControls(e){const i=new(ks().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(ks().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new JD(e);e.addControl(s,"top-left");const u=new rI(e,this.debugXmlPopover,this.userTripService,this.languageService);e.addControl(u,"top-right")}updateMapForEntry(e){var i,r;null===e?null===(i=this.stopEventServiceRenderer)||void 0===i||i.resetStopEventLayers():null===(r=this.stopEventServiceRenderer)||void 0===r||r.drawStopEvent(e)}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,u)=>{s?console.error(s):!e.hasImage(i.id)&&u&&e.addImage(i.id,u)})}),e.on("click",i=>{const r=Yp.queryNearbyFeaturesByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);r.length>0&&this.stationBoardService.stationOnMapClicked.emit(r[0].feature)})}}return n.\u0275fac=function(e){return new(e||n)(H(Sa),H(mu),H(tl),H(SI),H(bd))},n.\u0275cmp=mn({type:n,selectors:[["station-board-map"]],decls:1,vars:0,consts:[["id","map_canvas_station_board",1,"map_wrapper"]],template:function(e,i){1&e&&en(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),n})();const UY=["stationBoardWrapper"];function HY(n,t){if(1&n&&(X(0,"div")(1,"div"),Ce(2),Y()()),2&n){const e=St(2).$implicit;ae(2),wi("Pl. ",e.stopPlatform,"")}}function $Y(n,t){if(1&n&&(X(0,"div")(1,"div"),Ce(2,"Pl. "),X(3,"del"),Ce(4),Y(),Ce(5),Y()()),2&n){const e=St(2).$implicit;ae(4),wi(" ",e.stopPlatform,""),ae(1),wi(" ",e.stopPlatformActual,"")}}function qY(n,t){if(1&n&&(X(0,"div",14),ft(1,HY,3,1,"div",13),ft(2,$Y,6,2,"div",13),Y()),2&n){const e=St().$implicit;ae(1),Le("ngIf",!e.stopPlatformActual),ae(1),Le("ngIf",e.stopPlatformActual)}}function GY(n,t){if(1&n&&(X(0,"div")(1,"div",15),Ce(2),Y()()),2&n){const e=St().$implicit,i=St();ae(2),An(i.formatStopEventTime(e,"stopTime"))}}function WY(n,t){if(1&n&&(X(0,"div")(1,"del"),Ce(2),Y()()),2&n){const e=St(2).$implicit,i=St();ae(2),An(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function XY(n,t){if(1&n&&(X(0,"div"),ft(1,WY,3,1,"div",13),X(2,"div",15),Ce(3),Y(),X(4,"div",16),Ce(5),Y()()),2&n){const e=St().$implicit,i=St();ae(1),Le("ngIf",i.hasDelayDifferentTime(e)),ae(2),An(i.formatStopEventTime(e,"stopTimeActual")),ae(2),An(i.formatStopEventTime(e,"stopDelayText"))}}function ZY(n,t){if(1&n&&(na(0),X(1,"div"),Ce(2),Y(),ia()),2&n){const e=St().$implicit;ae(2),wi(" ",e.descriptions[0]," ")}}function YY(n,t){if(1&n&&(X(0,"li"),Ce(1),Y()),2&n){const e=t.$implicit;ae(1),wi(" ",e," ")}}function KY(n,t){if(1&n&&(na(0),X(1,"ul",20),ft(2,YY,2,1,"li",18),Y(),X(3,"h6"),Ce(4,"Detail"),Y(),ia()),2&n){const e=St().$implicit;ae(2),Le("ngForOf",e.descriptions)}}function QY(n,t){if(1&n&&(X(0,"li"),Ce(1),Y()),2&n){const e=t.$implicit;ae(1),wi(" ",e," ")}}function JY(n,t){if(1&n&&(X(0,"div")(1,"sbb-tooltip",19)(2,"p")(3,"strong"),Ce(4),Y()(),ft(5,ZY,3,1,"ng-container",13),ft(6,KY,5,1,"ng-container",13),X(7,"ul",20),ft(8,QY,2,1,"li",18),Y()()()),2&n){const e=t.$implicit;ae(4),An(e.summary),ae(1),Le("ngIf",1===e.descriptions.length),ae(1),Le("ngIf",e.descriptions.length>1),ae(2),Le("ngForOf",e.details)}}function eK(n,t){if(1&n&&(X(0,"div")(1,"div",17),ft(2,JY,9,4,"div",18),Y()()),2&n){const e=St().$implicit;ae(2),Le("ngForOf",e.situations)}}const tK=function(n){return{"item-selected":n}};function nK(n,t){if(1&n&&(X(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),Ce(5),Y(),X(6,"div",7),Ce(7),Y()(),X(8,"div",8)(9,"div",9),Ce(10),Y(),ft(11,qY,3,2,"div",10),X(12,"div",11)(13,"span"),Ce(14),Y(),Ce(15," - "),X(16,"span"),Ce(17),Y()()(),X(18,"div",12),ft(19,GY,3,1,"div",13),ft(20,XY,6,3,"div",13),ft(21,eK,3,1,"div",13),Y()()()()),2&n){const e=t.$implicit,i=t.index,r=St();Le("ngClass",function RA(n,t,e,i){return LA(Pt(),$o(),n,t,e,i)}(11,tK,i===r.selectedIDx)),fn("data-index",i),ae(5),An(e.serviceLineNumber),ae(2),An(e.tripNumber),ae(3),An(e.tripHeading),ae(1),Le("ngIf",e.stopPlatform),ae(3),wi("Operator: ",e.tripOperator,""),ae(3),wi("Type: ",e.servicePtMode,""),ae(2),Le("ngIf",!r.hasDelay(e)),ae(1),Le("ngIf",r.hasDelay(e)),ae(1),Le("ngIf",r.hasSituations(e))}}let bN=(()=>{class n{constructor(e){this.stationBoardService=e,this.stopEventsData=[],this.selectedIDx=null,this.stationBoardType="Departures"}ngOnInit(){this.stationBoardService.stationBoardDataUpdated.subscribe(e=>{this.stationBoardType=e.type;const i=e.items;this.stopEventsData=[],i.forEach(r=>{const s=this.computeStationBoardModel(r);this.stopEventsData.push(s)}),i.length>0?this.selectDataRowAtIndex(0):this.stationBoardService.stationBoardEntrySelected.emit(null)})}ngAfterViewInit(){var e;(null===(e=this.stationBoardWrapperRef)||void 0===e?void 0:e.nativeElement).addEventListener("click",i=>{var r,s;const u=i.target;if(null===u)return;const m=null!==(s=null===(r=u.closest(".card-item"))||void 0===r?void 0:r.getAttribute("data-index"))&&void 0!==s?s:null;if(null===m)return;const y=parseInt(m,10);this.selectedIDx!==y&&this.selectDataRowAtIndex(y)})}selectDataRowAtIndex(e){this.selectedIDx=e,this.stationBoardService.stationBoardEntrySelected.emit(this.stopEventsData[e].stopEvent)}hasDelay(e){const i=e.mapStationBoardTime[this.stationBoardType];return!!i&&i.hasDelay}hasDelayDifferentTime(e){const i=e.mapStationBoardTime[this.stationBoardType];return!!i&&i.hasDelayDifferentTime}formatStopEventTime(e,i){const r=e.mapStationBoardTime[this.stationBoardType];return null===r?null:r[i]}hasSituations(e){return e.situations.length>0}computeServiceLineNumber(e){var i;const r=null!==(i=e.journeyService.ptMode.shortName)&&void 0!==i?i:"N/A";return e.journeyService.serviceLineNumber||r}computeStopTime(e){return null===e?null:wa.formatTimeHHMM(e)}computeDelayTime(e,i){var r;const u="Arrivals"===i?e.arrivalData:e.departureData,m=null!==(r=null==u?void 0:u.delayMinutes)&&void 0!==r?r:null;if(null===m)return null;if(0===m)return"ON TIME";const y=[];return y.push(" "),y.push(m>0?"+":""),y.push(""+m),y.push("'"),y.join("")}computeStopTimeData(e,i){var r;const u="Arrivals"===i?e.arrivalData:e.departureData;if(null===u)return null;const m=null!==u.delayMinutes,y=wa.formatTimeHHMM(u.timetableTime),C=u.estimatedTime?wa.formatTimeHHMM(u.estimatedTime):"n/a",I=!!u.estimatedTime&&y!==C,A=this.computeStopTime(u.timetableTime);return null===A?null:{stopTime:A,stopTimeActual:this.computeStopTime(null!==(r=u.estimatedTime)&&void 0!==r?r:null),stopDelayText:this.computeDelayTime(e,i),hasDelay:m,hasDelayDifferentTime:I}}computeStationBoardModel(e){var i,r,s;const u=this.computeServiceLineNumber(e),m=null!==(i=e.journeyService.ptMode.shortName)&&void 0!==i?i:"N/A",y=this.computeStopTimeData(e.stopPoint,"Arrivals"),C=this.computeStopTimeData(e.stopPoint,"Departures");return{stopEvent:e,serviceLineNumber:u,servicePtMode:m,tripNumber:e.journeyService.journeyNumber,tripHeading:null!==(s=null===(r=e.journeyService.destinationStopPlace)||void 0===r?void 0:r.stopPlaceName)&&void 0!==s?s:"N/A",tripOperator:e.journeyService.agencyID,mapStationBoardTime:{Arrivals:y,Departures:C},stopPlatform:e.stopPoint.plannedPlatform,stopPlatformActual:e.stopPoint.plannedPlatform===e.stopPoint.actualPlatform?null:e.stopPoint.actualPlatform,situations:kh.computeSituationsData(e.stopPoint.siriSituations)}}}return n.\u0275fac=function(e){return new(e||n)(H(SI))},n.\u0275cmp=mn({type:n,selectors:[["station-board-result"]],viewQuery:function(e,i){if(1&e&&cr(UY,5),2&e){let r;Fn(r=Nn())&&(i.stationBoardWrapperRef=r.first)}},decls:3,vars:1,consts:[["stationBoardWrapper",""],["class","card card card-item mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","card","card-item","mb-2",3,"ngClass"],[1,"card-body"],[1,"d-flex","dep-content","align-items-center"],[1,"service-line-number-wrapper"],[1,"service-line-number","text-center"],[1,"trip-info","text-center"],[1,"flex-fill","dep-center"],[1,"trip-heading"],["class","stop-platform-text",4,"ngIf"],[1,"trip-debug"],[1,"text-center"],[4,"ngIf"],[1,"stop-platform-text"],[1,"departure-time"],[1,"departure-delay"],[1,"d-flex","gap-2"],[4,"ngFor","ngForOf"],["svgIcon","fpl:info"],[1,"tooltip-list"]],template:function(e,i){1&e&&(X(0,"div",null,0),ft(2,nK,22,13,"div",1),Y()),2&e&&(ae(2),Le("ngForOf",i.stopEventsData))},dependencies:[Ob,Sl,ho,FF],styles:[".service-line-number-wrapper[_ngcontent-%COMP%]{padding:0 16px 0 4px}.service-line-number[_ngcontent-%COMP%]{font-size:24px}.service-pt-mode[_ngcontent-%COMP%]{font-size:12px}.trip-heading[_ngcontent-%COMP%]{margin-top:2px;font-size:20px}.trip-info[_ngcontent-%COMP%]{font-size:12px}.stop-platform-wrapper[_ngcontent-%COMP%]{margin-right:4px}.stop-platform-text[_ngcontent-%COMP%]{font-size:14px}.stop-platform[_ngcontent-%COMP%]{font-size:18px}.departure-time[_ngcontent-%COMP%]{width:80px;font-size:20px}.departure-delay[_ngcontent-%COMP%]{color:#c45f00}.trip-debug[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:12px}.card-item[_ngcontent-%COMP%]{cursor:pointer}.item-selected[_ngcontent-%COMP%]{background-color:#f5f5f5}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}"]}),n})();function iK(n,t){if(1&n&&(X(0,"sbb-option",5),Ce(1),Y()),2&n){const e=t.$implicit,i=St();Le("value",e.stopPlaceRef),ae(1),wi(" ",i.renderLookupName(e)," ")}}let _N=(()=>{class n{constructor(e,i){this.userTripService=e,this.languageService=i,this.locationSelected=new tn,this.searchInputControl=new Aw(""),this.stopLookups=[n.AroundMeStopLookup],this.currentStopLookup=null,this.isBusySearching=!1,this.hackIgnoreInputChangesFlag=!1}static get AroundMeStopLookup(){return{stopPlaceRef:"AROUND_ME",stopName:"Current Location",special_type:"around_me",location:null}}ngOnInit(){this.searchInputControl.valueChanges.pipe(Lv(500),$p()).subscribe(e=>{this.onInputChangeAfterIdle()})}renderLookupName(e){let i=e.stopName;return e.distance&&(i+=" ("+e.distance+" m)"),i}onInputChangeAfterIdle(){const e=this.searchInputControl.value.trim();this.hackIgnoreInputChangesFlag?this.hackIgnoreInputChangesFlag=!1:0!==e.length?e.length<3||this.fetchLookupLocations(e):this.stopLookups=[n.AroundMeStopLookup]}fetchLookupLocations(e){return Ke(this,void 0,void 0,function*(){this.isBusySearching=!0;const r=this.userTripService.getStageConfig(),u=yield el.initWithLocationName(r,this.languageService.language,e,["stop"]).fetchResponse();this.parseLocations(u.locations),this.isBusySearching=!1})}parseLocations(e,i=null){this.stopLookups=[],e.forEach(r=>{var s;const u=null===(s=r.stopPlace)||void 0===s?void 0:s.stopPlaceRef;if(null===u)return;const y={stopPlaceRef:u,stopName:r.computeLocationName(),location:r};r.geoPosition&&i&&(y.distance=r.geoPosition.distanceFrom(i)),this.stopLookups.push(y)}),i&&this.stopLookups.sort((r,s)=>null==r.distance||null==s.distance?0:r.distance-s.distance),this.stopLookups=this.stopLookups.slice(0,10)}onStopLookupSelected(e){var i;const r=e.option.value;let s=null!==(i=this.stopLookups.find(m=>m.stopPlaceRef===r))&&void 0!==i?i:null;if(null===s)return void console.log("WHOOPS - cant find the stop for: "+r);if("around_me"===s.special_type)return void this.handleGeolocationLookup();this.currentStopLookup=s,this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s.stopName);const u=s.location;u&&this.locationSelected.emit(u)}handleGeolocationLookup(){navigator.geolocation?(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue("... looking up location"),navigator.geolocation.getCurrentPosition(e=>{this.handleNewGeoPosition(e,i=>{var r;const s=new Wr(e.coords.longitude,e.coords.latitude);this.parseLocations(i,s),null===(r=this.autocompleteInputTrigger)||void 0===r||r.openPanel()})})):console.log("no navigator.geolocation enabled")}handleNewGeoPosition(e,i){return Ke(this,void 0,void 0,function*(){const u=e.coords.longitude-.025,m=e.coords.longitude+.025,y=e.coords.latitude+.025,C=e.coords.latitude-.025,I=this.userTripService.getStageConfig(),B=yield el.initWithBBOXAndType(I,this.languageService.language,u,y,m,C,["stop"],300).fetchResponse();i(B.locations)})}updateLocationText(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceName)&&void 0!==r?r:null;null!==s&&(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(s))}}return n.\u0275fac=function(e){return new(e||n)(H(Sa),H(bd))},n.\u0275cmp=mn({type:n,selectors:[["station-board-input"]],viewQuery:function(e,i){if(1&e&&cr(qS,7),2&e){let r;Fn(r=Nn())&&(i.autocompleteInputTrigger=r.first)}},outputs:{locationSelected:"locationSelected"},decls:6,vars:4,consts:[["label","Station",1,"w-100"],["sbbInput","","type","text",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected"],["autocompleteTemplate","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(X(0,"div")(1,"sbb-form-field",0),en(2,"input",1),Y(),X(3,"sbb-autocomplete",2,3),Ft("optionSelected",function(s){return i.onStopLookupSelected(s)}),ft(5,iK,2,2,"sbb-option",4),Y()()),2&e){const r=va(4);ae(2),Le("placeholder","Type to search for stations")("formControl",i.searchInputControl)("sbbAutocomplete",r),ae(3),Le("ngForOf",i.stopLookups)}},dependencies:[Sl,Mc,uu,kw,Nv,cN,qS,a_,jm],encapsulation:2}),n})();function rK(n,t){1&n&&en(0,"span",12)}let oK=(()=>{class n{constructor(e){this.userTripService=e,this.customRequestSaved=new tn,this.customResponseSaved=new tn,this.customRequestXMLs="... wait",this.customResponseXMLs="Paste custom OJP StopEventRequest Response XML here...",this.isRunningRequest=!1}parseCustomRequestXML(){this.isRunningRequest=!0;const e=this.userTripService.getStageConfig(),i=Mh.initWithRequestMock(this.customRequestXMLs,e);i.fetchResponse().then(r=>{this.isRunningRequest=!1;const s=i.requestInfo.responseXML;null!==s?this.customRequestSaved.emit(s):console.log("ERROR - no response from StopEventRequest")})}parseCustomResponseXML(){this.customResponseSaved.emit(this.customResponseXMLs)}}return n.\u0275fac=function(e){return new(e||n)(H(Sa))},n.\u0275cmp=mn({type:n,selectors:[["custom-stop-event-popover"]],outputs:{customRequestSaved:"customRequestSaved",customResponseSaved:"customResponseSaved"},decls:26,vars:4,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojp-stopeventservice/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(X(0,"div",0),Ce(1,"Custom StopEvent Request / Response XML"),Y(),X(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),Ce(6,"StopEvent Request XML"),Y(),X(7,"div")(8,"a",4),Ce(9,"Cookbook opentransportdata.swiss"),Y()()(),X(10,"textarea",5),Ft("ngModelChange",function(s){return i.customRequestXMLs=s}),Y(),X(11,"div",6)(12,"button",7),Ft("click",function(){return i.parseCustomRequestXML()}),ft(13,rK,1,0,"span",8),Ce(14," Execute OJP StopEvent Request "),Y()(),en(15,"hr"),X(16,"div",3)(17,"div"),Ce(18,"StopEvent Request Response XML"),Y()(),X(19,"textarea",5),Ft("ngModelChange",function(s){return i.customResponseXMLs=s}),Y(),X(20,"div",6)(21,"button",9),Ft("click",function(){return i.parseCustomResponseXML()}),Ce(22," Display StopEvents "),Y()()()(),X(23,"div",10)(24,"button",11),Ce(25," Close "),Y()()),2&e&&(ae(10),Le("ngModel",i.customRequestXMLs),ae(2),Le("disabled",i.isRunningRequest),ae(1),Le("ngIf",i.isRunningRequest),ae(6),Le("ngModel",i.customResponseXMLs))},dependencies:[ho,Mc,uu,cd,Qp,Bm,zm,Vm],encapsulation:2}),n})(),sK=(()=>{class n{constructor(){this.embedHTMLs="n/a"}updateEmbedHTML(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"n/a",u=document.location.pathname.replace("/board","/embed/board")+"?stop_id="+s,m=document.location.protocol+"//"+document.location.host+u;this.embedHTMLs='<iframe src="'+m+'" width="100%" height="100%" frameBorder="0"></iframe>'}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["embed-station-board-popover"]],decls:11,vars:1,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(X(0,"div",0),Ce(1,"Embed journey in another website"),Y(),X(2,"div",1)(3,"div",2)(4,"p"),Ce(5,"Copy the following code in the target webpage"),Y(),X(6,"textarea",3),Ce(7),Y()()(),X(8,"div",4)(9,"button",5),Ce(10," Close "),Y()()),2&e&&(ae(7),An(i.embedHTMLs))},dependencies:[Qp,Bm,zm,Vm],encapsulation:2}),n})();function aK(n,t){if(1&n){const e=zr();X(0,"div",20),Ft("click",function(){return si(e),fi(St().showRequestXmlPopover())}),X(1,"span",21),Ce(2,"XML"),Y()()}}function lK(n,t){if(1&n&&(X(0,"sbb-radio-button",25),Ce(1),Y()),2&n){const e=t.$implicit;Le("value",e),ae(1),wi(" ",e," ")}}function cK(n,t){if(1&n){const e=zr();X(0,"div",22)(1,"div")(2,"sbb-radio-group",23),Ft("ngModelChange",function(r){return si(e),fi(St().stationBoardType=r)})("change",function(){return si(e),fi(St().onTypeChanged())}),ft(3,lK,2,2,"sbb-radio-button",24),Y()()()}if(2&n){const e=St();ae(2),Le("ngModel",e.stationBoardType),ae(1),Le("ngForOf",e.stationBoardTypes)}}function uK(n,t){if(1&n){const e=zr();X(0,"sbb-radio-button",28),Ft("change",function(r){return si(e),fi(St(2).onChangeStageAPI(r))}),Ce(1),Y()}if(2&n){const e=t.$implicit,i=St(2);Le("value",e)("checked",i.userTripService.currentAppStage==e),ae(1),wi(" ",e," ")}}function dK(n,t){if(1&n&&(X(0,"div",22)(1,"div")(2,"sbb-radio-group",26),ft(3,uK,2,3,"sbb-radio-button",27),Y()()()),2&n){const e=St();ae(3),Le("ngForOf",e.appStageOptions)}}function hK(n,t){1&n&&en(0,"span",29)}function pK(n,t){if(1&n){const e=zr();X(0,"div",30)(1,"button",31),Ft("click",function(){return si(e),fi(St().loadCustomXMLPopover())}),Ce(2," Custom XML "),Y()()}}function fK(n,t){if(1&n&&(X(0,"div",0)(1,"div",1)(2,"div",32)(3,"div")(4,"a",33),Ce(5,"Open in OJP Demo App"),Y()()()()()),2&n){const e=St();ae(4),oa("href",e.permalinkURLAddress,_a)}}function mK(n,t){if(1&n){const e=zr();na(0),X(1,"div",35),Ce(2," | "),Y(),X(3,"div")(4,"a",36),Ft("click",function(){return si(e),fi(St(2).loadEmbedHTMLPopover())}),Ce(5,"Embed"),Y()(),ia()}}function gK(n,t){if(1&n&&(X(0,"div",0)(1,"div",1)(2,"div",32)(3,"div")(4,"a",33),Ce(5,"Permalink"),Y()(),ft(6,mK,6,0,"ng-container",34),Y()()()),2&n){const e=St();ae(4),oa("href",e.permalinkURLAddress,_a),ae(2),Le("ngIf",null!==e.searchLocation)}}let yN=(()=>{class n{constructor(e,i,r,s,u,m,y,C,I){this.notificationToast=e,this.debugXmlPopover=i,this.customXmlPopover=r,this.mapService=s,this.stationBoardService=u,this.languageService=m,this.userTripService=y,this.embedHTMLPopover=C,this.router=I,this.headerText="Search",this.useMocks=!1,this.queryParams=new URLSearchParams(document.location.search),this.appStageOptions=["PROD","INT","TEST","LA Beta"],this.stationBoardTypes=["Departures","Arrivals"],this.stationBoardType=this.computeStationBoardType(),this.searchLocation=null,this.searchDate=this.computeSearchDateTime(),this.searchTime=wa.formatTimeHHMM(this.searchDate),this.isSearching=!1,this.permalinkURLAddress="",this.updatePermalinkURLAddress(),this.currentRequestInfo=null;const A=new URLSearchParams(document.location.search);this.useMocks="yes"===A.get("use_mocks"),this.isEmbed=-1!==this.router.url.indexOf("/embed/"),this.isEmbed&&(this.headerText=this.stationBoardType)}ngOnInit(){const e=this.queryParams.get("stage");if(e){const r=this.computeAppStageFromString(e);r&&this.userTripService.updateAppStage(r)}const i=this.queryParams.get("stop_id");i&&(this.updateCurrentRequestData(i),this.fetchStopEventsForStopRef(i),this.lookupStopPlaceRef(i)),this.stationBoardService.stationOnMapClicked.subscribe(r=>{this.handleMapClick(r)}),this.useMocks&&this.useMocks&&"localhost"===document.location.hostname&&this.fetchStopEventFromMocks()}computeAppStageFromString(e){const i=this.appStageOptions.map(u=>u.toLowerCase()),r=e.trim(),s=i.indexOf(r.toLowerCase());return-1!==s?this.appStageOptions[s]:null}onLocationSelected(e){var i,r;const s=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;s&&this.updateCurrentRequestData(s),this.searchLocation=e,this.mapService.tryToCenterAndZoomToLocation(e),this.updatePermalinkURLAddress(),this.updateHeaderText(),this.resetResultList()}onDateTimeChanged(){const e=this.searchTime.split(":");if(2===e.length){const i=parseInt(e[0],10),r=parseInt(e[1],10);this.searchDate.setHours(i),this.searchDate.setMinutes(r)}this.updatePermalinkURLAddress()}onTypeChanged(){this.updatePermalinkURLAddress()}isSearchButtonDisabled(){return!(!this.isSearching&&null!==this.searchLocation)}searchButtonClicked(){var e,i,r;this.notificationToast.dismiss();const s=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null!==s?this.fetchStopEventsForStopRef(s):console.error("ERROR - no stopPlaceRef available")}computeSearchDateTime(){let e=new Date;const i=this.queryParams.get("day");i&&(e=new Date(Date.parse(i)));const r=this.queryParams.get("time"),s=new Date;let u=s.getHours(),m=s.getMinutes();if(r){const y=r.split(":");2===y.length&&(u=parseInt(y[0],10),m=parseInt(y[1],10))}return e.setHours(u),e.setMinutes(m),e}computeStationBoardType(){return"arr"===this.queryParams.get("type")?"Arrivals":"Departures"}updatePermalinkURLAddress(){var e,i,r;const s=new URLSearchParams;"Arrivals"===this.stationBoardType&&s.set("type","arr");const u=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;u&&s.set("stop_id",u);const m=wa.formatDate(new Date),y=wa.formatDate(this.searchDate),C=m.substring(0,10),I=y.substring(0,10);I!==C&&s.set("day",I);const A=m.substring(11,16),B=y.substring(11,16);A!==B&&s.set("time",B);const j=document.location.pathname.replace("/embed","")+"?"+s.toString();this.permalinkURLAddress=j}fetchStopEventsForStopRef(e){const i=this.computeStopEventRequest(e);i.fetchResponse().then(r=>{this.currentRequestInfo=i.requestInfo,this.parseStopEvents(r.stopEvents)})}fetchStopEventFromMocks(){return Ke(this,void 0,void 0,function*(){const i=yield(yield fetch("/path/to/mock.xml")).text();Mh.initWithMock(i).fetchResponse().then(s=>{this.parseStopEvents(s.stopEvents)})})}computeStopEventRequest(e){const i="Arrivals"===this.stationBoardType?"arrival":"departure",r=this.computeStopBoardDate(),s=this.userTripService.getStageConfig();return Mh.initWithStopPlaceRef(s,this.languageService.language,e,i,r)}parseStopEvents(e){var i;e.length>0&&(null===(i=this.searchPanel)||void 0===i||i.close()),this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:e})}lookupStopPlaceRef(e){return Ke(this,void 0,void 0,function*(){const i=this.userTripService.getStageConfig(),s=yield el.initWithStopPlaceRef(i,this.languageService.language,e).fetchResponse();if(0===s.locations.length)return void console.error("ERROR - cant find stopPlaceRef with ID: "+e);const u=s.locations[0];this.searchLocation=u,this.mapService.tryToCenterAndZoomToLocation(u),this.updatePermalinkURLAddress(),this.updateHeaderText(),this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(u)})}updateHeaderText(){if(!this.isEmbed||null===this.searchLocation)return;const e=this.searchLocation.computeLocationName();null!==e&&(this.headerText=e+" "+this.stationBoardType)}handleMapClick(e){var i;const r=to.initWithFeature(e);null!==r&&(this.searchLocation=r,this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(r),this.resetResultList(),this.updatePermalinkURLAddress(),null===(i=this.searchPanel)||void 0===i||i.open())}resetResultList(){this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:[]})}computeStopBoardDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),s=parseInt(i[1]);e.setHours(r),e.setMinutes(s)}return e}showRequestXmlPopover(){const e=this.debugXmlPopover.open(PS,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{this.currentRequestInfo&&e.componentInstance.updateRequestData(this.currentRequestInfo)})}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value)}loadCustomXMLPopover(){const e=this.customXmlPopover.open(oK,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{var i,r;this.notificationToast.dismiss();const s=e.componentInstance;if(null===this.currentRequestInfo){const m=this.computeStopEventRequest("8503000");this.currentRequestInfo=m.requestInfo}s.customRequestXMLs=null!==(r=null===(i=this.currentRequestInfo)||void 0===i?void 0:i.requestXML)&&void 0!==r?r:"n/a",s.customRequestSaved.subscribe(u=>{e.close(),this.handleCustomResponse(u)}),s.customResponseSaved.subscribe(u=>{e.close(),this.handleCustomResponse(u)})})}handleCustomResponse(e){null!==this.currentRequestInfo&&(this.currentRequestInfo.responseDateTime=new Date,this.currentRequestInfo.responseXML=e,Mh.initWithMock(e).fetchResponse().then(r=>{const s=r.stopEvents;s.length>0?(this.mapService.tryToCenterAndZoomToLocation(s[0].stopPoint.location),this.parseStopEvents(r.stopEvents)):this.notificationToast.open("No StopEvents found",{type:"error",verticalPosition:"top"})}))}updateCurrentRequestData(e){const i=this.computeStopEventRequest(e);this.currentRequestInfo=i.requestInfo}loadEmbedHTMLPopover(){const e=this.embedHTMLPopover.open(sK,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{this.searchLocation&&e.componentInstance.updateEmbedHTML(this.searchLocation)})}}return n.\u0275fac=function(e){return new(e||n)(H(hI),H(tl),H(tl),H(mu),H(SI),H(bd),H(Sa),H(tl),H(hs))},n.\u0275cmp=mn({type:n,selectors:[["station-board-search"]],viewQuery:function(e,i){if(1&e&&(cr(Ah,7),cr(_N,5)),2&e){let r;Fn(r=Nn())&&(i.searchPanel=r.first),Fn(r=Nn())&&(i.autocompleteInputComponent=r.first)}},decls:28,vars:12,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],[3,"locationSelected"],["class","xml-info",3,"click",4,"ngIf"],["class","mb-3 d-flex",4,"ngIf"],[1,"d-flex"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"margin-left","8px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","ms-auto",4,"ngIf"],["class","row mb-2",4,"ngIf"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"d-flex","flex-row-reverse"],["target","_blank",3,"href"],[4,"ngIf"],["clas","text-center",2,"width","7px","margin-left","4px"],["target","_blank","role","button",1,"text-decoration-underline",3,"click"]],template:function(e,i){1&e&&(X(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Ce(5),Y(),X(6,"div",3)(7,"div",4)(8,"station-board-input",5),Ft("locationSelected",function(s){return i.onLocationSelected(s)}),Y()(),ft(9,aK,3,0,"div",6),Y(),ft(10,cK,4,2,"div",7),X(11,"div",8)(12,"div")(13,"sbb-form-field",9)(14,"sbb-datepicker",10)(15,"input",11),Ft("ngModelChange",function(s){return i.searchDate=s})("dateChange",function(){return i.onDateTimeChanged()}),Y()()()(),X(16,"div",12)(17,"sbb-form-field",13)(18,"input",14),Ft("ngModelChange",function(s){return i.searchTime=s})("change",function(){return i.onDateTimeChanged()}),Y()()()(),ft(19,dK,4,1,"div",7),X(20,"div",8)(21,"div",15)(22,"button",16),Ft("click",function(){return i.searchButtonClicked()}),ft(23,hK,1,0,"span",17),Ce(24," Search "),Y()(),ft(25,pK,3,0,"div",18),Y()()()()(),ft(26,fK,6,1,"div",19),ft(27,gK,7,2,"div",19)),2&e&&(ae(3),Le("expanded",!0),ae(2),An(i.headerText),ae(4),Le("ngIf",(null==i.currentRequestInfo?null:i.currentRequestInfo.requestXML)&&!i.isEmbed),ae(1),Le("ngIf",!i.isEmbed),ae(5),Le("ngModel",i.searchDate),ae(3),Le("ngModel",i.searchTime),ae(1),Le("ngIf",!i.isEmbed),ae(3),Le("disabled",i.isSearchButtonDisabled()),ae(1),Le("ngIf",i.isSearching),ae(2),Le("ngIf",!i.isEmbed),ae(1),Le("ngIf",i.isEmbed),ae(1),Le("ngIf",!i.isEmbed))},dependencies:[Sl,ho,Mc,uu,cd,FS,Ah,Wv,US,Zv,a_,jm,yI,$S,oN,_N],styles:[".xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}"]}),n})(),bK=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["station-board"]],decls:19,vars:6,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active","routerLink"],["sbb-tab-link","",3,"active"],["tabPanel",""],[1,"row"],[1,"col-md-5"],[1,"col-md-7"]],template:function(e,i){if(1&e&&(X(0,"div",0),en(1,"web-header"),X(2,"div",1)(3,"nav",2)(4,"a",3),Ce(5,"Journey Search"),Y(),X(6,"a",4),Ce(7,"Station Board"),Y(),X(8,"a",3),Ce(9,"Trip Info"),Y()(),X(10,"sbb-tab-nav-panel",null,5)(12,"div",6)(13,"div",7),en(14,"station-board-search")(15,"station-board-result"),Y(),X(16,"div",8),en(17,"station-board-map"),Y()()()(),en(18,"web-footer"),Y()),2&e){const r=va(11);ae(3),Le("tabPanel",r),ae(1),Le("active","false")("routerLink","../search"),ae(2),Le("active","true"),ae(2),Le("active","false")("routerLink","../trip")}},dependencies:[Xb,yS,OD,vS,jY,bN,yN,xI,wI],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})(),_K=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(X(0,"div",0)(1,"div",1)(2,"div",2),en(3,"app-search-form")(4,"journey-results"),Y()()())},dependencies:[BF,mN],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})(),yK=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(X(0,"div",0)(1,"div",1)(2,"div",2),en(3,"station-board-search")(4,"station-board-result"),Y()()())},dependencies:[bN,yN],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})(),vK=(()=>{class n{constructor(e,i,r,s,u){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.tripInfoService=s,this.languageService=u,this.mapLoadingPromise=null,this.journeyServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToLocation(r,e)})}),this.tripInfoService.tripInfoResultUpdated.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var s,u;null===e?null===(s=this.journeyServiceRenderer)||void 0===s||s.resetStopEventLayers():(null===(u=this.journeyServiceRenderer)||void 0===u||u.drawServiceStopPoints(e.stopPoints),this.zoomToJourneyService())})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToBounds(r,e)})}),this.tripInfoService.locationSelected.subscribe(e=>{var i,r;const s=null!==(i=e.geoPosition)&&void 0!==i?i:null;null!==s&&(null===(r=this.mapLoadingPromise)||void 0===r||r.then(u=>{this.mapService.zoomToLocation(u,{lnglat:s.asLngLat(),zoom:16})}))})}initMap(){const e=this.mapService.createMap("map_canvas_trip_info");this.mapLoadingPromise=new Promise((i,r)=>{e.on("load",s=>{i(e),this.onMapLoad(e)})})}zoomToJourneyService(){var e,i;const r=null!==(i=null===(e=this.journeyServiceRenderer)||void 0===e?void 0:e.geojsonFeatures)&&void 0!==i?i:[];if(r.length<2)return;const s=pd.initFromGeoJSONFeatures(r);if(!s.isValid())return console.error("Invalid BBOX for features"),void console.log(r);const m={bounds:new(ks().LngLatBounds)(s.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(m)}onMapLoad(e){this.addMapControls(e),this.addMapListeners(e),this.journeyServiceRenderer=new gN(e)}addMapControls(e){const i=new(ks().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(ks().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const s=new JD(e);e.addControl(s,"top-left");const u=new rI(e,this.debugXmlPopover,this.userTripService,this.languageService);e.addControl(u,"top-right")}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(s,u)=>{s?console.error(s):!e.hasImage(i.id)&&u&&e.addImage(i.id,u)})}),e.on("click",i=>{const r=Yp.queryNearbyFeaturesByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);r.length>0&&console.log(r[0])})}}return n.\u0275fac=function(e){return new(e||n)(H(Sa),H(mu),H(tl),H(NS),H(bd))},n.\u0275cmp=mn({type:n,selectors:[["trip-info-map"]],decls:1,vars:0,consts:[["id","map_canvas_trip_info",1,"map_wrapper"]],template:function(e,i){1&e&&en(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),n})();function xK(n,t){1&n&&en(0,"span",12)}let wK=(()=>{class n{constructor(e){this.userTripService=e,this.customRequestSaved=new tn,this.customResponseSaved=new tn,this.customRequestXMLs="... wait",this.customResponseXMLs="Paste custom OJP TripInfoRequest Response XML here...",this.isRunningRequest=!1}parseCustomRequestXML(){this.isRunningRequest=!0;const e=this.userTripService.getStageConfig(),i=gd.initWithRequestMock(this.customRequestXMLs,e);i.fetchResponse().then(r=>{this.isRunningRequest=!1,null!==i.requestInfo.responseXML?this.customRequestSaved.emit(i):console.log("ERROR - no response from StopEventRequest")})}parseCustomResponseXML(){this.customResponseSaved.emit(this.customResponseXMLs)}}return n.\u0275fac=function(e){return new(e||n)(H(Sa))},n.\u0275cmp=mn({type:n,selectors:[["custom-trip-info-popover"]],outputs:{customRequestSaved:"customRequestSaved",customResponseSaved:"customResponseSaved"},decls:26,vars:4,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptripinforequest/"],["rows","7",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(X(0,"div",0),Ce(1,"Custom TripInfo Request / Response XML"),Y(),X(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),Ce(6,"TripInfo Request XML"),Y(),X(7,"div")(8,"a",4),Ce(9,"Cookbook opentransportdata.swiss"),Y()()(),X(10,"textarea",5),Ft("ngModelChange",function(s){return i.customRequestXMLs=s}),Y(),X(11,"div",6)(12,"button",7),Ft("click",function(){return i.parseCustomRequestXML()}),ft(13,xK,1,0,"span",8),Ce(14," Execute OJP TripInfo Request "),Y()(),en(15,"hr"),X(16,"div",3)(17,"div"),Ce(18,"TripInfo Request Response XML"),Y()(),X(19,"textarea",5),Ft("ngModelChange",function(s){return i.customResponseXMLs=s}),Y(),X(20,"div",6)(21,"button",9),Ft("click",function(){return i.parseCustomResponseXML()}),Ce(22," Display TripInfo "),Y()()()(),X(23,"div",10)(24,"button",11),Ce(25," Close "),Y()()),2&e&&(ae(10),Le("ngModel",i.customRequestXMLs),ae(2),Le("disabled",i.isRunningRequest),ae(1),Le("ngIf",i.isRunningRequest),ae(6),Le("ngModel",i.customResponseXMLs))},dependencies:[ho,Mc,uu,cd,Qp,Bm,zm,Vm],encapsulation:2}),n})();function SK(n,t){if(1&n){const e=zr();X(0,"div",20),Ft("click",function(){return si(e),fi(St().showRequestXmlPopover())}),X(1,"span",21),Ce(2,"XML"),Y()()}}function CK(n,t){if(1&n){const e=zr();X(0,"sbb-radio-button",22),Ft("change",function(r){return si(e),fi(St().onChangeStageAPI(r))}),Ce(1),Y()}if(2&n){const e=t.$implicit,i=St();Le("value",e)("checked",i.userTripService.currentAppStage==e),ae(1),wi(" ",e," ")}}function TK(n,t){1&n&&en(0,"span",23)}let EK=(()=>{class n{constructor(e,i,r,s,u,m){this.notificationToast=e,this.debugXmlPopover=i,this.customXmlPopover=r,this.tripInfoService=s,this.languageService=u,this.userTripService=m,this.headerText="Search Trip Info",this.useMocks=!1,this.queryParams=new URLSearchParams(document.location.search),this.model={journeyRef:"",journeyDateTime:new Date,appStageOptions:["PROD","INT","TEST","LA Beta"],isSearching:!1,permalinkURLAddress:""},this.updatePermalinkURLAddress(),this.currentRequestInfo=null;const y=new URLSearchParams(document.location.search);this.useMocks="yes"===y.get("use_mocks")}ngOnInit(){const e=this.queryParams.get("stage");if(e){const i=this.computeAppStageFromString(e);i&&this.userTripService.updateAppStage(i)}this.tripInfoService.tripInfoResultUpdated.subscribe(i=>{var r;null!==i&&(null===(r=this.searchPanel)||void 0===r||r.close())}),this.initFromUserVars()}initFromUserVars(){const e=this.queryParams.get("ref");e&&(this.model.journeyRef=e,this.fetchTripInfo()),this.useMocks&&this.useMocks&&"localhost"===document.location.hostname&&this.fetchStopEventFromMocks()}computeAppStageFromString(e){const i=this.model.appStageOptions.map(u=>u.toLowerCase()),r=e.trim(),s=i.indexOf(r.toLowerCase());return-1!==s?this.model.appStageOptions[s]:null}onDateTimeChanged(){this.updatePermalinkURLAddress()}isSearchButtonDisabled(){return!!this.model.isSearching}searchButtonClicked(){this.notificationToast.dismiss(),this.fetchTripInfo()}updatePermalinkURLAddress(){const e=new URLSearchParams;e.set("ref",this.model.journeyRef);const i=wa.formatDate(this.model.journeyDateTime).substring(0,10);e.set("day",i);const r=document.location.pathname+"?"+e.toString();this.model.permalinkURLAddress=r}fetchTripInfo(){return Ke(this,void 0,void 0,function*(){const e=this.userTripService.getStageConfig(),i=wa.formatDate(this.model.journeyDateTime).substring(0,10),r=gd.initWithJourneyRef(e,this.languageService.language,this.model.journeyRef,i);this.model.isSearching=!0;const s=yield r.fetchResponse();this.model.isSearching=!1,null===s.tripInfoResult&&(this.notificationToast.open("Invalid TripInfoRequest result",{type:"error",verticalPosition:"top"}),console.log(this.model.journeyRef)),this.parseTripInfo(r.requestInfo,s.tripInfoResult)})}fetchStopEventFromMocks(){return Ke(this,void 0,void 0,function*(){const i=yield(yield fetch("/path/to/mock.xml")).text(),r=gd.initWithMock(i);r.fetchResponse().then(s=>{this.parseTripInfo(r.requestInfo,s.tripInfoResult)})})}showRequestXmlPopover(){const e=this.debugXmlPopover.open(PS,{position:{top:"10px"}});e.afterOpened().subscribe(()=>{this.currentRequestInfo&&e.componentInstance.updateRequestData(this.currentRequestInfo)})}parseTripInfo(e,i){this.currentRequestInfo=e,this.tripInfoService.tripInfoResultUpdated.emit(i)}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value)}loadCustomXMLPopover(){const e=this.customXmlPopover.open(wK,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{var i,r;this.notificationToast.dismiss();const s=e.componentInstance;s.customRequestXMLs=null!==(r=null===(i=this.currentRequestInfo)||void 0===i?void 0:i.requestXML)&&void 0!==r?r:"n/a",s.customRequestSaved.subscribe(u=>{e.close(),this.currentRequestInfo=u.requestInfo,u.requestInfo.requestXML&&this.handleCustomResponse(u.requestInfo.requestXML)}),s.customResponseSaved.subscribe(u=>{e.close(),this.handleCustomResponse(u)})})}handleCustomResponse(e){if(null===this.currentRequestInfo)return;this.currentRequestInfo.responseDateTime=new Date,this.currentRequestInfo.responseXML=e;const i=gd.initWithMock(e);i.fetchResponse().then(r=>{this.parseTripInfo(i.requestInfo,r.tripInfoResult)})}}return n.\u0275fac=function(e){return new(e||n)(H(hI),H(tl),H(tl),H(NS),H(bd),H(Sa))},n.\u0275cmp=mn({type:n,selectors:[["trip-info-search"]],viewQuery:function(e,i){if(1&e&&cr(Ah,7),2&e){let r;Fn(r=Nn())&&(i.searchPanel=r.first)}},decls:30,vars:8,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],[1,"sbb-form-field-long"],["sbbInput","","placeholder","type a JourneyRef","value","",3,"ngModel","ngModelChange"],["class","xml-info",3,"click",4,"ngIf"],[1,"d-flex"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(X(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Ce(5),Y(),X(6,"div",3)(7,"div",4)(8,"sbb-form-field",5)(9,"sbb-label"),Ce(10,"Journey Ref"),Y(),X(11,"input",6),Ft("ngModelChange",function(s){return i.model.journeyRef=s}),Y()()(),ft(12,SK,3,0,"div",7),Y(),X(13,"div",8)(14,"div")(15,"sbb-form-field",9)(16,"sbb-datepicker",10)(17,"input",11),Ft("ngModelChange",function(s){return i.model.journeyDateTime=s})("dateChange",function(){return i.onDateTimeChanged()}),Y()()()()(),X(18,"div",12)(19,"div")(20,"sbb-radio-group",13),ft(21,CK,2,3,"sbb-radio-button",14),Y()()(),X(22,"div",8)(23,"div",15)(24,"button",16),Ft("click",function(){return i.searchButtonClicked()}),ft(25,TK,1,0,"span",17),Ce(26," Search "),Y()(),X(27,"div",18)(28,"button",19),Ft("click",function(){return i.loadCustomXMLPopover()}),Ce(29," Custom XML "),Y()()()()()()()),2&e&&(ae(3),Le("expanded",!0),ae(2),An(i.headerText),ae(6),Le("ngModel",i.model.journeyRef),ae(1),Le("ngIf",null==i.currentRequestInfo?null:i.currentRequestInfo.requestXML),ae(5),Le("ngModel",i.model.journeyDateTime),ae(4),Le("ngForOf",i.model.appStageOptions),ae(3),Le("disabled",i.isSearchButtonDisabled()),ae(1),Le("ngIf",i.model.isSearching))},dependencies:[Sl,ho,Mc,uu,cd,FS,Ah,Wv,US,Zv,a_,zS,jm,yI,$S],styles:[".xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}"]}),n})();const DK=[{path:"embed/search",component:_K},{path:"embed/board",component:yK},{path:"search",component:BY},{path:"board",component:bK},{path:"trip",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["trip-info"]],decls:19,vars:6,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active","routerLink"],["sbb-tab-link","",3,"active"],["tabPanel",""],[1,"row"],[1,"col-md-5"],[1,"col-md-7"]],template:function(e,i){if(1&e&&(X(0,"div",0),en(1,"web-header"),X(2,"div",1)(3,"nav",2)(4,"a",3),Ce(5,"Journey Search"),Y(),X(6,"a",3),Ce(7,"Station Board"),Y(),X(8,"a",4),Ce(9,"Trip Info"),Y()(),X(10,"sbb-tab-nav-panel",null,5)(12,"div",6)(13,"div",7),en(14,"trip-info-search")(15,"trip-info-result"),Y(),X(16,"div",8),en(17,"trip-info-map"),Y()()()(),en(18,"web-footer"),Y()),2&e){const r=va(11);ae(3),Le("tabPanel",r),ae(1),Le("active","false")("routerLink","../search"),ae(2),Le("active","false")("routerLink","../board"),ae(2),Le("active","true")}},dependencies:[Xb,yS,OD,vS,vK,EK,kF,xI,wI],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})()},{path:"searchOJP-Demo",redirectTo:"/search",pathMatch:"full"},{path:"",redirectTo:"/search",pathMatch:"full"}];let IK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[tS.forRoot(DK),tS]}),n})(),MK=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=mn({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(e,i){1&e&&en(0,"router-outlet")},dependencies:[ZE],encapsulation:2}),n})();Ms("showDismiss",[fr("void, dismissed",Bn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),fr("visible",Bn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),Xi("void => visible",er("0.25s cubic-bezier(0.4,0.0,0.2,1)")),Xi("visible => dismissed",er("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]);let vN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,tS,Zi,yo]}),n})();Ka(class{});let CI=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[Rm,Zi]}),n})();Ms("transformMenu",[fr("void",Bn({opacity:0})),fr("enter-usermenu",Bn({width:"{{width}}",maxHeight:"100%"}),{params:{width:"288px"}}),Xi("void => enter",er("120ms cubic-bezier(0, 0, 0.2, 1)",Bn({opacity:1}))),Xi("enter => void",er("100ms linear",Bn({opacity:0}))),Xi("void => enter-usermenu",er("300ms cubic-bezier(.785,.135,.15,.86)",sv([Bn({width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)",offset:0}),Bn({width:"{{width}}",height:"*",opacity:1,maxHeight:"100%",offset:1})]))),Xi("enter-usermenu => void",er("300ms cubic-bezier(.785,.135,.15,.86)",Bn({opacity:0,width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)"})))]),new It("SbbMenuContent"),new It("SBB_MENU_PANEL"),Ka(class{}),new It("sbb-menu-default-options",{providedIn:"root",factory:function LK(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}}),new It("sbb-menu-inherited-trigger-context");const NK={provide:new It("sbb-menu-scroll-strategy"),deps:[jo],useFactory:function FK(n){return()=>n.scrollStrategies.reposition()}};Up({passive:!0}),Om(class{});let GS=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[NK],imports:[pr,Cl,ua,Zi,yo,Lm]}),n})(),xN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi,GS,yo]}),n})();new It("recaptcha-settings");let wN=(()=>{class n{get nativeWindow(){return function VK(){return window}()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();const jK=new It("recaptcha-language"),UK=new It("recaptcha-base-url"),HK=new It("recaptcha-nonce-tag");let $K=(()=>{class n{constructor(e,i,r,s,u){this._windowRef=e,this._language=r||null,this._baseUrl=s||null,this._nonce=u||null,this._document=i,this._init(),this.ready=n._ready.pipe(Tr(m=>!!m))}_init(){if(n._ready)return;this._windowRef.nativeWindow.ng2recaptchaloaded=()=>{n._ready.next(grecaptcha)},n._ready=new sa(null);const e=this._document.createElement("script");e.innerHTML="",e.src=`${this._baseUrl||"https://www.google.com/recaptcha/api.js"}?render=explicit&onload=ng2recaptchaloaded${this._language?"&hl="+this._language:""}`,this._nonce&&(e.nonce=this._nonce),e.async=!0,e.defer=!0,this._document.head.appendChild(e)}}return n._ready=null,n.\u0275fac=function(e){return new(e||n)(je(wN),je(Gn),je(jK,8),je(UK,8),je(HK,8))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),SN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[$K,wN],imports:[pr,Zi]}),n})();const qK=["*",[["sbb-checkbox-panel-subtitle"]],[["sbb-checkbox-panel-warning"]],[["sbb-checkbox-panel-note"]]],GK=["*","sbb-checkbox-panel-subtitle","sbb-checkbox-panel-warning","sbb-checkbox-panel-note"],WK={provide:Za,useExisting:zi(()=>XK),multi:!0};let XK=(()=>{class n extends jF{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=Ui(n)))(i||n)}}(),n.\u0275cmp=mn({type:n,selectors:[["sbb-checkbox-panel"]],hostAttrs:[1,"sbb-checkbox-panel","sbb-selection-panel-item","sbb-checkbox","sbb-selection-item"],hostVars:8,hostBindings:function(e,i){2&e&&(Cc("id",i.id),fn("tabindex",null),Li("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckboxPanel"],features:[Un([WK]),Xt],ngContentSelectors:GK,decls:16,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content"],[1,"sbb-selection-inner-content"],[2,"display","none"]],template:function(e,i){1&e&&(Ro(qK),X(0,"label",0)(1,"input",1,2),Ft("change",function(s){return i._onInteractionEvent(s)})("click",function(s){return i._onInputClick(s)}),Y(),X(3,"span",3)(4,"span",4),F(),X(5,"svg",5),en(6,"polyline",6),Y()()(),J(),X(7,"span",7)(8,"span",8)(9,"span",9),Ce(10,"\xa0"),Y(),X(11,"span"),Pr(12),Y(),Pr(13,1),Y(),Pr(14,2),Pr(15,3),Y()()),2&e&&(fn("for",i.inputId),ae(1),Le("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),fn("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),CN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi]}),n})();new It("SBB_CHIP_LIST"),new It("SBB_CHIP"),new It("SbbChipRemove"),new It("SbbChipTrailingIcon"),t_(class YK{constructor(t){this._elementRef=t}},-1);const kN=new It("sbb-chips-default-options");pS(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Kt}});let RN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[{provide:kN,useValue:{separatorKeyCodes:[13]}}],imports:[pr,Zi,yo]}),n})();new It("FILE_SELECTOR_OPTIONS");const es={TEXT:["text/*"],IMAGE:["image/*"],IMAGE_JPG:["image/jpeg","image/pjpeg"],IMAGE_PNG:["image/png"],IMAGE_SVG:["image/svg+xml"],IMAGE_GIF:["image/gif"],AUDIO:["audio/*"],AUDIO_MP4:["audio/mp4"],AUDIO_MP3:["audio/mpeg","audio/mp3"],AUDIO_OGG:["audio/ogg"],AUDIO_WAVE:["audio/wave"],AUDIO_WAV:["audio/wav","audio/x-wav","audio/x-pn-wav","audio/webm"],VIDEO:["video/*"],VIDEO_MP4:["video/mp4"],VIDEO_MPEG:["video/mpeg"],VIDEO_OGG:["video/ogg"],VIDEO_MOV:["video/quicktime"],VIDEO_WEBM:["video/webm"],VIDEO_AVI:["video/x-msvideo"],VIDEO_WMV:["video/x-ms-wmv"],PDF:["application/pdf"],MS_WORD_DOC:["application/msword","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],MS_EXCEL:["application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-excel.sheet.macroEnabled.12","application/vnd.ms-excel.template.macroEnabled.12","application/vnd.ms-excel.addin.macroEnabled.12","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],MS_POWERPOINT:["application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.ms-powerpoint.addin.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],ZIP:["application/x-gtar","application/x-gcompress","application/compress","application/x-tar","application/x-rar-compressed","application/octet-stream","application/x-zip-compressed","application/zip-compressed","application/x-7z-compressed","application/gzip","application/zip","application/x-bzip2"]};(new Map).set("doc",[...es.MS_WORD_DOC,...es.MS_EXCEL,...es.MS_POWERPOINT]).set("audio",[...es.AUDIO_MP4,...es.AUDIO_MP3,...es.AUDIO_OGG,...es.AUDIO_WAVE,...es.AUDIO_WAV]).set("image",[...es.IMAGE_GIF,...es.IMAGE_JPG,...es.IMAGE_PNG,...es.IMAGE_SVG]).set("pdf",es.PDF).set("video",[...es.VIDEO_MP4,...es.VIDEO_MPEG,...es.VIDEO_OGG,...es.VIDEO_MOV,...es.VIDEO_WEBM,...es.VIDEO_AVI,...es.VIDEO_WMV]).set("zip",es.ZIP),Ka(class{constructor(n){this._elementRef=n}});let PN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi,yo]}),n})();new It("SBB_HEADER"),Ms("menu",[fr("open",Bn({left:0})),fr("void",Bn({left:-305,visibility:"hidden"})),Xi("open => void, void => open",[er("0.3s ease-in-out")])]);const mQ={provide:new It("sbb-header-menu-scroll-strategy"),deps:[jo],useFactory:function fQ(n){return()=>n.scrollStrategies.reposition()}};Up({passive:!0}),Ka(class{});let LN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[mQ],imports:[pr,sS,Cl,ua,Zi,yo]}),n})();function gQ(n,t){}function bQ(n,t){}class EI{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let _Q=(()=>{class n extends Ov{constructor(e,i,r,s,u,m,y,C){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=s,this._interactivityChecker=u,this._ngZone=m,this._overlayRef=y,this._focusMonitor=C,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=I=>{this._portalOutlet.hasAttached();const A=this._portalOutlet.attachDomPortal(I);return this._contentAttached(),A},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=du(),s=this._elementRef.nativeElement;(!r||r===this._document.body||r===s||s.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=du();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=du())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Jb),H(Gn,8),H(EI),H(km),H(Xn),H(Kp),H(xa))},n.\u0275cmp=mn({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&cr(hd,7),2&e){let r;Fn(r=Nn())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&fn("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Xt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&ft(0,gQ,0,0,"ng-template",0)},dependencies:[hd],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class DI{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new Kt,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!ca(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const ON=new It("DialogScrollStrategy"),yQ=new It("DialogData"),vQ=new It("DefaultDialogConfig"),wQ={provide:ON,deps:[jo],useFactory:function xQ(n){return()=>n.scrollStrategies.block()}};let SQ=0,CQ=(()=>{class n{constructor(e,i,r,s,u,m){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=u,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Kt,this._afterOpenedAtThisLevel=new Kt,this._ariaHiddenElements=new Map,this.afterAllClosed=xm(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(As(void 0))),this._scrollStrategy=m}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new EI;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+SQ++,i.id&&this.getDialogById(i.id);const s=this._getOverlayConfig(i),u=this._overlay.create(s),m=new DI(u,i),y=this._attachContainer(u,m,i);return m.containerInstance=y,this._attachDialogContent(e,m,y,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){II(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){II(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),II(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new Fm({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var s;const u=r.injector||(null===(s=r.viewContainerRef)||void 0===s?void 0:s.injector),m=[{provide:EI,useValue:r},{provide:DI,useValue:i},{provide:Kp,useValue:e}];let y;r.container?"function"==typeof r.container?y=r.container:(y=r.container.type,m.push(...r.container.providers(r))):y=_Q;const C=new dd(y,r.viewContainerRef,Nr.create({parent:u||this._injector,providers:m}),r.componentFactoryResolver);return e.attach(C).instance}_attachDialogContent(e,i,r,s){if(e instanceof eo){const u=this._createInjector(s,i,r,void 0);let m={$implicit:s.data,dialogRef:i};s.templateContext&&(m=Object.assign(Object.assign({},m),"function"==typeof s.templateContext?s.templateContext():s.templateContext)),r.attachTemplatePortal(new Pm(e,null,m,u))}else{const u=this._createInjector(s,i,r,this._injector),m=r.attachComponentPortal(new dd(e,s.viewContainerRef,u,s.componentFactoryResolver));i.componentInstance=m.instance}}_createInjector(e,i,r,s){var u;const m=e.injector||(null===(u=e.viewContainerRef)||void 0===u?void 0:u.injector),y=[{provide:yQ,useValue:e.data},{provide:DI,useValue:i}];return e.providers&&("function"==typeof e.providers?y.push(...e.providers(i,e,r)):y.push(...e.providers)),e.direction&&(!m||!m.get(qp,null,$n.Optional))&&y.push({provide:qp,useValue:{value:e.direction,change:Ln()}}),Nr.create({parent:m||s,providers:y})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((s,u)=>{s?u.setAttribute("aria-hidden",s):u.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const s=i[r];s!==e&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(je(jo),je(Nr),je(vQ,8),je(n,12),je(r_),je(ON))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})();function II(n,t){let e=n.length;for(;e--;)t(n[e])}let TQ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[CQ,wQ],imports:[Cl,ua,Rm,ua]}),n})();const WS={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},EQ={lightboxContainer:Ms("lightboxContainer",[fr("void, exit",Bn({opacity:0,transform:"scale(0.7)"})),fr("enter",Bn({transform:"none"})),Xi("* => enter",er("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",Bn({transform:"none",opacity:1})),WS),Xi("* => void, * => exit",er("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",Bn({opacity:0})),WS)])};let DQ=(()=>{class n extends _F{constructor(e,i,r,s,u,m,y,C,I,A){var B;super(e,i,r,s,u,m,y,I),this._changeDetectorRef=C,this._viewportRuler=A,this._destroyed=new Kt,null===(B=this._viewportRuler)||void 0===B||B.change().pipe(Oi(this._destroyed),As(null)).subscribe(()=>{this._height=this._viewportRuler.getViewportSize().height})}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}ngOnDestroy(){super.ngOnDestroy(),this._destroyed.next(),this._destroyed.complete()}}return n.\u0275fac=function(e){return new(e||n)(H(En),H(Jb),H(Gn,8),H($v),H(km),H(Xn),H(Kp),H(Cr),H(xa),H(pu))},n.\u0275cmp=mn({type:n,selectors:[["sbb-lightbox-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-lightbox-container"],hostVars:8,hostBindings:function(e,i){1&e&&Vy("@lightboxContainer.done",function(s){return i._onAnimationDone(s)})("@lightboxContainer.start",function(s){return i._onAnimationStart(s)}),2&e&&(Cc("id",i._config.id),fn("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Uy("@lightboxContainer",i._getAnimationState()),td("height",i._height,"px"))},features:[Xt],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&ft(0,bQ,0,0,"ng-template",0)},dependencies:[hd],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-lightbox-container{display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);width:100%;height:100vh}.cdk-high-contrast-active .sbb-lightbox-container{outline:solid .0666666667rem}.sbb-lightbox-container>*:only-child:not(.sbb-lightbox-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-lightbox-content{display:block;padding:var(--sbb-divider-big) var(--sbb-lightbox-padding-horizontal);flex:1 1 auto;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-lightbox-content>*:first-child{margin-top:0}.sbb-lightbox-title{padding:calc(1.4rem * var(--sbb-scaling-factor)) 3.7333333333rem calc(1.1333333333rem * var(--sbb-scaling-factor)) 1.3333333333rem;flex:0 0 auto;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(4.2666666667rem * var(--sbb-scaling-factor))}@media all and (min-width: 40.1875em){.sbb-lightbox-title{padding-left:1.6rem;padding-right:4rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title{padding-left:calc(5.3333333333rem * var(--sbb-scaling-factor));padding-right:calc(6.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em)and (max-width: 240.0525em){:where(html:not(.sbb-lean)) .sbb-lightbox-title{padding-top:1.8666666667rem;padding-bottom:1.8666666667rem}}.sbb-lightbox-title-close-button{position:absolute;right:1.3333333333rem;cursor:pointer;line-height:0;color:var(--sbb-color-storm);outline:0}.sbb-lightbox-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}@media all and (min-width: 40.1875em){.sbb-lightbox-title-close-button{right:1.6rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title-close-button{right:calc(3.7333333333rem * var(--sbb-scaling-factor))}}.sbb-lightbox-actions{padding:var(--sbb-lightbox-actions-padding-vertical) var(--sbb-lightbox-padding-horizontal);display:flex;flex:0 0 auto;flex-flow:column wrap;gap:var(--sbb-button-gap);align-items:center;justify-content:space-between;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}@media all and (min-width: 40.1875em){.sbb-lightbox-actions{flex-direction:row}}"],encapsulation:2,data:{animation:[EQ.lightboxContainer]}}),n})();class IQ extends RS{constructor(t,e,i){super(t,e,i),this.closeRequest=new Kt,t.overlayRef.keydownEvents().pipe(Tr(r=>27===r.keyCode&&!!this.disableClose&&!ca(r))).subscribe(()=>this.closeRequest.next(null)),t.overlayRef.detachments().subscribe(()=>{this.closeRequest.complete()})}updatePosition(){return this}updateSize(){return this}}const MQ=new It("SbbLightboxData"),AQ=new It("sbb-lightbox-default-options"),FN=new It("sbb-lightbox-scroll-strategy"),RQ={provide:FN,deps:[jo],useFactory:function kQ(n){return()=>n.scrollStrategies.block()}};let PQ=0,LQ=(()=>{class n extends xF{constructor(e,i,r,s,u,m){super(e,i,r,u,m,s,IQ,DQ,MQ),this._idPrefix="sbb-lightbox-"}get openLightboxes(){return this.openDialogs}open(e,i){const r=Object.assign(Object.assign({},i),{width:"100vw",minWidth:"100vw",maxWidth:"100vw",height:"auto",minHeight:"auto",maxHeight:"none"});return r.id=r.id||`${this._idPrefix}${PQ++}`,super.open(e,r)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}getLightboxById(e){return this.getDialogById(e)}}return n.\u0275fac=function(e){return new(e||n)(je(jo),je(Nr),je(AQ,8),je(FN),je(n,12),je(r_))},n.\u0275prov=Qt({token:n,factory:n.\u0275fac}),n})(),NN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[LQ,RQ],imports:[pr,TQ,iI,Cl,ua,Zi,yo]}),n})(),BN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi]}),n})();Ms("showDismiss",[fr("void, dismissed",Bn({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),fr("visible",Bn({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),Xi("visible => dismissed",er("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]),Om(class{});let zN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi,yo]}),n})();new It("SBB_PAGINATOR_DEFAULT_OPTIONS"),Ka(BO(class{}));let VN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,tS,Zi,yo]}),n})(),zQ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[hS]}),n})();Ms("stepTransition",[Xi("* => previous, * => next",[Bn({opacity:1}),er("150ms ease",Bn({opacity:0}))]),Xi("previous => current, next => current",[Bn({opacity:0}),er("500ms ease",Bn({opacity:1}))]),Xi("void => current",er("0s"))]);let jN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,ua,zQ,Zi,yo]}),n})(),UN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi,vI]}),n})();Ms("growShrink",[fr("void",Bn({opacity:0,width:"0px"})),fr("open",Bn({opacity:1,width:"*"})),Xi("void => *",er("300ms ease")),Xi("* => void",er("300ms 25ms linear"))]);const $Q={provide:new It("sbb-select-scroll-strategy"),deps:[jo],useFactory:function HQ(n){return()=>n.scrollStrategies.reposition()}};["start","center","end"].map(n=>({originX:n,originY:"top",overlayX:n,overlayY:"top"}));let HN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({providers:[$Q],imports:[pr,ua,Cl,Zi,pI,yo]}),n})();new It("SBB_SIDEBAR_CONTAINER"),Ms("transform",[fr("open, open-instant",Bn({transform:"none",visibility:"visible"})),fr("void",Bn({"box-shadow":"none",visibility:"hidden"})),Xi("void => open-instant",er("0ms")),Xi("void <=> open, open-instant => void",er("300ms cubic-bezier(0.785, 0.135, 0.15, 0.86)"))]);let $N=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Lm,Zi,yo,Lm]}),n})(),qN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi,yo]}),n})(),oJ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[DD]}),n})();new It("SBB_SORT_DEFAULT_OPTIONS"),BO(Ka(class{}));const d_="225ms cubic-bezier(0.4,0.0,0.2,1)";Ms("indicator",[fr("active-asc, asc",Bn({transform:"scaleY(-1)"})),fr("active-desc, desc",Bn({transform:"scaleY(1)"})),Xi("active-asc <=> active-desc",er(d_)),Xi("asc <=> desc",er("0ms"))]),Ms("arrowOpacity",[fr("desc-to-active, asc-to-active, active",Bn({opacity:1})),fr("desc-to-hint, asc-to-hint, hint",Bn({opacity:.54})),fr("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",Bn({opacity:0})),Xi("* => asc, * => desc, * => active, * => hint, * => void",er("0ms")),Xi("* <=> *",er(d_))]),Ms("arrowPosition",[Xi("* => desc-to-hint, * => desc-to-active",er(d_,sv([Bn({transform:"translateY(-25%)"}),Bn({transform:"translateY(0)"})]))),Xi("* => hint-to-desc, * => active-to-desc",er(d_,sv([Bn({transform:"translateY(0)"}),Bn({transform:"translateY(25%)"})]))),Xi("* => asc-to-hint, * => asc-to-active",er(d_,sv([Bn({transform:"translateY(25%)"}),Bn({transform:"translateY(0)"})]))),Xi("* => hint-to-asc, * => active-to-asc",er(d_,sv([Bn({transform:"translateY(0)"}),Bn({transform:"translateY(-25%)"})]))),fr("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",Bn({transform:"translateY(0)"})),fr("hint-to-desc, active-to-desc, desc",Bn({transform:"translateY(-25%)"})),fr("hint-to-asc, active-to-asc, asc",Bn({transform:"translateY(25%)"}))]),Ms("allowChildren",[Xi("* <=> *",[RT("@*",kT(),{optional:!0})])]),Ka(class{}),Up({passive:!0});let rB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[oJ,pr,Zi]}),n})(),oB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi,CI]}),n})();pS(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new Kt}});let sB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,fI,Zi]}),n})(),aB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi]}),n})();const lB="225ms cubic-bezier(0.785, 0.135, 0.15, 0.86)";Ms("translateHeight",[fr("void",Bn({height:0,paddingTop:0,paddingBottom:0})),fr("auto",Bn({height:"*",paddingTop:"*",paddingBottom:"*"})),Xi("fixed => auto, initial => auto, * => void",[Bn({height:"{{currentHeight}}px"}),er(lB)]),Xi("void => fixed, void => auto",er(lB)),Xi("void => initial",er(0))]);let cB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,ua,Zi,yo]}),n})();Om(class{});let uB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[pr,Zi,yo,GS]}),n})();const $J=[AF,vN,dN,CI,xN,pI,SN,HF,CN,RN,tN,iI,PN,jS,LN,yo,YF,NN,BN,GS,zN,dI,VN,jN,vI,UN,HN,fN,$N,qN,rB,JO,oB,sB,aB,sN,cB,NF,uB];let qJ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n}),n.\u0275inj=Sn({imports:[$J,AF,vN,dN,CI,xN,pI,SN,HF,CN,RN,tN,iI,PN,jS,LN,yo,YF,NN,BN,GS,zN,dI,VN,jN,vI,UN,HN,fN,$N,qN,rB,JO,oB,sB,aB,sN,cB,NF,uB]}),n})(),GJ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=wn({type:n,bootstrap:[MK]}),n.\u0275inj=Sn({imports:[pr,PR,mU,MU,IK,LH,OH,qJ]}),n})();(function EV(){Ak=!1})(),o4().bootstrapModule(GJ).catch(n=>console.error(n))},5343:(on,hn)=>{"use strict";hn.byteLength=function re(Ge){var wt=Qe(Ge),vn=wt[1];return 3*(wt[0]+vn)/4-vn},hn.toByteArray=function Ye(Ge){var wt,xe,Jt=Qe(Ge),vn=Jt[0],Cn=Jt[1],st=new ke(function Ue(Ge,wt,Jt){return 3*(wt+Jt)/4-Jt}(0,vn,Cn)),ln=0,Te=Cn>0?vn-4:vn;for(xe=0;xe<Te;xe+=4)wt=ye[Ge.charCodeAt(xe)]<<18|ye[Ge.charCodeAt(xe+1)]<<12|ye[Ge.charCodeAt(xe+2)]<<6|ye[Ge.charCodeAt(xe+3)],st[ln++]=wt>>16&255,st[ln++]=wt>>8&255,st[ln++]=255&wt;return 2===Cn&&(wt=ye[Ge.charCodeAt(xe)]<<2|ye[Ge.charCodeAt(xe+1)]>>4,st[ln++]=255&wt),1===Cn&&(wt=ye[Ge.charCodeAt(xe)]<<10|ye[Ge.charCodeAt(xe+1)]<<4|ye[Ge.charCodeAt(xe+2)]>>2,st[ln++]=wt>>8&255,st[ln++]=255&wt),st},hn.fromByteArray=function $e(Ge){for(var wt,Jt=Ge.length,vn=Jt%3,Cn=[],ln=0,Te=Jt-vn;ln<Te;ln+=16383)Cn.push(Ct(Ge,ln,ln+16383>Te?Te:ln+16383));return 1===vn?Cn.push(We[(wt=Ge[Jt-1])>>2]+We[wt<<4&63]+"=="):2===vn&&Cn.push(We[(wt=(Ge[Jt-2]<<8)+Ge[Jt-1])>>10]+We[wt>>4&63]+We[wt<<2&63]+"="),Cn.join("")};for(var We=[],ye=[],ke="undefined"!=typeof Uint8Array?Uint8Array:Array,Ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,ie=Ie.length;p<ie;++p)We[p]=Ie[p],ye[Ie.charCodeAt(p)]=p;function Qe(Ge){var wt=Ge.length;if(wt%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var Jt=Ge.indexOf("=");return-1===Jt&&(Jt=wt),[Jt,Jt===wt?0:4-Jt%4]}function bt(Ge){return We[Ge>>18&63]+We[Ge>>12&63]+We[Ge>>6&63]+We[63&Ge]}function Ct(Ge,wt,Jt){for(var Cn=[],st=wt;st<Jt;st+=3)Cn.push(bt((Ge[st]<<16&16711680)+(Ge[st+1]<<8&65280)+(255&Ge[st+2])));return Cn.join("")}ye["-".charCodeAt(0)]=62,ye["_".charCodeAt(0)]=63},3172:(on,hn,We)=>{"use strict";var ye=We(5343),ke=We(8461),Ie="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;hn.Buffer=re,hn.SlowBuffer=function st(fe){return+fe!=fe&&(fe=0),re.alloc(+fe)},hn.INSPECT_MAX_BYTES=50;var p=2147483647;function Qe(fe){if(fe>p)throw new RangeError('The value "'+fe+'" is invalid for option "size"');var V=new Uint8Array(fe);return Object.setPrototypeOf(V,re.prototype),V}function re(fe,V,q){if("number"==typeof fe){if("string"==typeof V)throw new TypeError('The "string" argument must be of type string. Received type number');return Ct(fe)}return Ue(fe,V,q)}function Ue(fe,V,q){if("string"==typeof fe)return function $e(fe,V){if(("string"!=typeof V||""===V)&&(V="utf8"),!re.isEncoding(V))throw new TypeError("Unknown encoding: "+V);var q=0|ln(fe,V),Me=Qe(q),Ke=Me.write(fe,V);return Ke!==q&&(Me=Me.slice(0,Ke)),Me}(fe,V);if(ArrayBuffer.isView(fe))return function wt(fe){if(Ci(fe,Uint8Array)){var V=new Uint8Array(fe);return Jt(V.buffer,V.byteOffset,V.byteLength)}return Ge(fe)}(fe);if(null==fe)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof fe);if(Ci(fe,ArrayBuffer)||fe&&Ci(fe.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(Ci(fe,SharedArrayBuffer)||fe&&Ci(fe.buffer,SharedArrayBuffer)))return Jt(fe,V,q);if("number"==typeof fe)throw new TypeError('The "value" argument must not be of type number. Received type number');var Me=fe.valueOf&&fe.valueOf();if(null!=Me&&Me!==fe)return re.from(Me,V,q);var Ke=function vn(fe){if(re.isBuffer(fe)){var V=0|Cn(fe.length),q=Qe(V);return 0===q.length||fe.copy(q,0,0,V),q}return void 0!==fe.length?"number"!=typeof fe.length||Xr(fe.length)?Qe(0):Ge(fe):"Buffer"===fe.type&&Array.isArray(fe.data)?Ge(fe.data):void 0}(fe);if(Ke)return Ke;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof fe[Symbol.toPrimitive])return re.from(fe[Symbol.toPrimitive]("string"),V,q);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof fe)}function Ye(fe){if("number"!=typeof fe)throw new TypeError('"size" argument must be of type number');if(fe<0)throw new RangeError('The value "'+fe+'" is invalid for option "size"')}function Ct(fe){return Ye(fe),Qe(fe<0?0:0|Cn(fe))}function Ge(fe){for(var V=fe.length<0?0:0|Cn(fe.length),q=Qe(V),Me=0;Me<V;Me+=1)q[Me]=255&fe[Me];return q}function Jt(fe,V,q){if(V<0||fe.byteLength<V)throw new RangeError('"offset" is outside of buffer bounds');if(fe.byteLength<V+(q||0))throw new RangeError('"length" is outside of buffer bounds');var Me;return Me=void 0===V&&void 0===q?new Uint8Array(fe):void 0===q?new Uint8Array(fe,V):new Uint8Array(fe,V,q),Object.setPrototypeOf(Me,re.prototype),Me}function Cn(fe){if(fe>=p)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+p.toString(16)+" bytes");return 0|fe}function ln(fe,V){if(re.isBuffer(fe))return fe.length;if(ArrayBuffer.isView(fe)||Ci(fe,ArrayBuffer))return fe.byteLength;if("string"!=typeof fe)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof fe);var q=fe.length,Me=arguments.length>2&&!0===arguments[2];if(!Me&&0===q)return 0;for(var Ke=!1;;)switch(V){case"ascii":case"latin1":case"binary":return q;case"utf8":case"utf-8":return W(fe).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*q;case"hex":return q>>>1;case"base64":return Ri(fe).length;default:if(Ke)return Me?-1:W(fe).length;V=(""+V).toLowerCase(),Ke=!0}}function Te(fe,V,q){var Me=!1;if((void 0===V||V<0)&&(V=0),V>this.length||((void 0===q||q>this.length)&&(q=this.length),q<=0)||(q>>>=0)<=(V>>>=0))return"";for(fe||(fe="utf8");;)switch(fe){case"hex":return qi(this,V,q);case"utf8":case"utf-8":return vt(this,V,q);case"ascii":return Lt(this,V,q);case"latin1":case"binary":return cn(this,V,q);case"base64":return He(this,V,q);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Fi(this,V,q);default:if(Me)throw new TypeError("Unknown encoding: "+fe);fe=(fe+"").toLowerCase(),Me=!0}}function xe(fe,V,q){var Me=fe[V];fe[V]=fe[q],fe[q]=Me}function Ae(fe,V,q,Me,Ke){if(0===fe.length)return-1;if("string"==typeof q?(Me=q,q=0):q>2147483647?q=2147483647:q<-2147483648&&(q=-2147483648),Xr(q=+q)&&(q=Ke?0:fe.length-1),q<0&&(q=fe.length+q),q>=fe.length){if(Ke)return-1;q=fe.length-1}else if(q<0){if(!Ke)return-1;q=0}if("string"==typeof V&&(V=re.from(V,Me)),re.isBuffer(V))return 0===V.length?-1:ce(fe,V,q,Me,Ke);if("number"==typeof V)return V&=255,"function"==typeof Uint8Array.prototype.indexOf?Ke?Uint8Array.prototype.indexOf.call(fe,V,q):Uint8Array.prototype.lastIndexOf.call(fe,V,q):ce(fe,[V],q,Me,Ke);throw new TypeError("val must be string, number or Buffer")}function ce(fe,V,q,Me,Ke){var nr,qt=1,nn=fe.length,Ni=V.length;if(void 0!==Me&&("ucs2"===(Me=String(Me).toLowerCase())||"ucs-2"===Me||"utf16le"===Me||"utf-16le"===Me)){if(fe.length<2||V.length<2)return-1;qt=2,nn/=2,Ni/=2,q/=2}function Di(ms,Ea){return 1===qt?ms[Ea]:ms.readUInt16BE(Ea*qt)}if(Ke){var io=-1;for(nr=q;nr<nn;nr++)if(Di(fe,nr)===Di(V,-1===io?0:nr-io)){if(-1===io&&(io=nr),nr-io+1===Ni)return io*qt}else-1!==io&&(nr-=nr-io),io=-1}else for(q+Ni>nn&&(q=nn-Ni),nr=q;nr>=0;nr--){for(var yr=!0,Ta=0;Ta<Ni;Ta++)if(Di(fe,nr+Ta)!==Di(V,Ta)){yr=!1;break}if(yr)return nr}return-1}function ut(fe,V,q,Me){q=Number(q)||0;var Ke=fe.length-q;Me?(Me=Number(Me))>Ke&&(Me=Ke):Me=Ke;var qt=V.length;Me>qt/2&&(Me=qt/2);for(var nn=0;nn<Me;++nn){var Ni=parseInt(V.substr(2*nn,2),16);if(Xr(Ni))return nn;fe[q+nn]=Ni}return nn}function se(fe,V,q,Me){return Jn(W(V,fe.length-q),fe,q,Me)}function be(fe,V,q,Me){return Jn(function Nt(fe){for(var V=[],q=0;q<fe.length;++q)V.push(255&fe.charCodeAt(q));return V}(V),fe,q,Me)}function lt(fe,V,q,Me){return Jn(Ri(V),fe,q,Me)}function gt(fe,V,q,Me){return Jn(function Je(fe,V){for(var q,Me,qt=[],nn=0;nn<fe.length&&!((V-=2)<0);++nn)Me=(q=fe.charCodeAt(nn))>>8,qt.push(q%256),qt.push(Me);return qt}(V,fe.length-q),fe,q,Me)}function He(fe,V,q){return ye.fromByteArray(0===V&&q===fe.length?fe:fe.slice(V,q))}function vt(fe,V,q){q=Math.min(fe.length,q);for(var Me=[],Ke=V;Ke<q;){var Di,nr,io,yr,qt=fe[Ke],nn=null,Ni=qt>239?4:qt>223?3:qt>191?2:1;if(Ke+Ni<=q)switch(Ni){case 1:qt<128&&(nn=qt);break;case 2:128==(192&(Di=fe[Ke+1]))&&(yr=(31&qt)<<6|63&Di)>127&&(nn=yr);break;case 3:nr=fe[Ke+2],128==(192&(Di=fe[Ke+1]))&&128==(192&nr)&&(yr=(15&qt)<<12|(63&Di)<<6|63&nr)>2047&&(yr<55296||yr>57343)&&(nn=yr);break;case 4:nr=fe[Ke+2],io=fe[Ke+3],128==(192&(Di=fe[Ke+1]))&&128==(192&nr)&&128==(192&io)&&(yr=(15&qt)<<18|(63&Di)<<12|(63&nr)<<6|63&io)>65535&&yr<1114112&&(nn=yr)}null===nn?(nn=65533,Ni=1):nn>65535&&(Me.push((nn-=65536)>>>10&1023|55296),nn=56320|1023&nn),Me.push(nn),Ke+=Ni}return function oi(fe){var V=fe.length;if(V<=4096)return String.fromCharCode.apply(String,fe);for(var q="",Me=0;Me<V;)q+=String.fromCharCode.apply(String,fe.slice(Me,Me+=4096));return q}(Me)}function Lt(fe,V,q){var Me="";q=Math.min(fe.length,q);for(var Ke=V;Ke<q;++Ke)Me+=String.fromCharCode(127&fe[Ke]);return Me}function cn(fe,V,q){var Me="";q=Math.min(fe.length,q);for(var Ke=V;Ke<q;++Ke)Me+=String.fromCharCode(fe[Ke]);return Me}function qi(fe,V,q){var Me=fe.length;(!V||V<0)&&(V=0),(!q||q<0||q>Me)&&(q=Me);for(var Ke="",qt=V;qt<q;++qt)Ke+=Zr[fe[qt]];return Ke}function Fi(fe,V,q){for(var Me=fe.slice(V,q),Ke="",qt=0;qt<Me.length-1;qt+=2)Ke+=String.fromCharCode(Me[qt]+256*Me[qt+1]);return Ke}function xi(fe,V,q){if(fe%1!=0||fe<0)throw new RangeError("offset is not uint");if(fe+V>q)throw new RangeError("Trying to access beyond buffer length")}function Kt(fe,V,q,Me,Ke,qt){if(!re.isBuffer(fe))throw new TypeError('"buffer" argument must be a Buffer instance');if(V>Ke||V<qt)throw new RangeError('"value" argument is out of bounds');if(q+Me>fe.length)throw new RangeError("Index out of range")}function To(fe,V,q,Me,Ke,qt){if(q+Me>fe.length)throw new RangeError("Index out of range");if(q<0)throw new RangeError("Index out of range")}function vo(fe,V,q,Me,Ke){return V=+V,q>>>=0,Ke||To(fe,0,q,4),ke.write(fe,V,q,Me,23,4),q+4}function ki(fe,V,q,Me,Ke){return V=+V,q>>>=0,Ke||To(fe,0,q,8),ke.write(fe,V,q,Me,52,8),q+8}hn.kMaxLength=p,!(re.TYPED_ARRAY_SUPPORT=function ie(){try{var fe=new Uint8Array(1),V={foo:function(){return 42}};return Object.setPrototypeOf(V,Uint8Array.prototype),Object.setPrototypeOf(fe,V),42===fe.foo()}catch(q){return!1}}())&&"undefined"!=typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(re.prototype,"parent",{enumerable:!0,get:function(){if(re.isBuffer(this))return this.buffer}}),Object.defineProperty(re.prototype,"offset",{enumerable:!0,get:function(){if(re.isBuffer(this))return this.byteOffset}}),re.poolSize=8192,re.from=function(fe,V,q){return Ue(fe,V,q)},Object.setPrototypeOf(re.prototype,Uint8Array.prototype),Object.setPrototypeOf(re,Uint8Array),re.alloc=function(fe,V,q){return function bt(fe,V,q){return Ye(fe),fe<=0?Qe(fe):void 0!==V?"string"==typeof q?Qe(fe).fill(V,q):Qe(fe).fill(V):Qe(fe)}(fe,V,q)},re.allocUnsafe=function(fe){return Ct(fe)},re.allocUnsafeSlow=function(fe){return Ct(fe)},re.isBuffer=function(V){return null!=V&&!0===V._isBuffer&&V!==re.prototype},re.compare=function(V,q){if(Ci(V,Uint8Array)&&(V=re.from(V,V.offset,V.byteLength)),Ci(q,Uint8Array)&&(q=re.from(q,q.offset,q.byteLength)),!re.isBuffer(V)||!re.isBuffer(q))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(V===q)return 0;for(var Me=V.length,Ke=q.length,qt=0,nn=Math.min(Me,Ke);qt<nn;++qt)if(V[qt]!==q[qt]){Me=V[qt],Ke=q[qt];break}return Me<Ke?-1:Ke<Me?1:0},re.isEncoding=function(V){switch(String(V).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},re.concat=function(V,q){if(!Array.isArray(V))throw new TypeError('"list" argument must be an Array of Buffers');if(0===V.length)return re.alloc(0);var Me;if(void 0===q)for(q=0,Me=0;Me<V.length;++Me)q+=V[Me].length;var Ke=re.allocUnsafe(q),qt=0;for(Me=0;Me<V.length;++Me){var nn=V[Me];if(Ci(nn,Uint8Array))qt+nn.length>Ke.length?re.from(nn).copy(Ke,qt):Uint8Array.prototype.set.call(Ke,nn,qt);else{if(!re.isBuffer(nn))throw new TypeError('"list" argument must be an Array of Buffers');nn.copy(Ke,qt)}qt+=nn.length}return Ke},re.byteLength=ln,re.prototype._isBuffer=!0,re.prototype.swap16=function(){var V=this.length;if(V%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var q=0;q<V;q+=2)xe(this,q,q+1);return this},re.prototype.swap32=function(){var V=this.length;if(V%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var q=0;q<V;q+=4)xe(this,q,q+3),xe(this,q+1,q+2);return this},re.prototype.swap64=function(){var V=this.length;if(V%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var q=0;q<V;q+=8)xe(this,q,q+7),xe(this,q+1,q+6),xe(this,q+2,q+5),xe(this,q+3,q+4);return this},re.prototype.toLocaleString=re.prototype.toString=function(){var V=this.length;return 0===V?"":0===arguments.length?vt(this,0,V):Te.apply(this,arguments)},re.prototype.equals=function(V){if(!re.isBuffer(V))throw new TypeError("Argument must be a Buffer");return this===V||0===re.compare(this,V)},re.prototype.inspect=function(){var V="",q=hn.INSPECT_MAX_BYTES;return V=this.toString("hex",0,q).replace(/(.{2})/g,"$1 ").trim(),this.length>q&&(V+=" ... "),"<Buffer "+V+">"},Ie&&(re.prototype[Ie]=re.prototype.inspect),re.prototype.compare=function(V,q,Me,Ke,qt){if(Ci(V,Uint8Array)&&(V=re.from(V,V.offset,V.byteLength)),!re.isBuffer(V))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof V);if(void 0===q&&(q=0),void 0===Me&&(Me=V?V.length:0),void 0===Ke&&(Ke=0),void 0===qt&&(qt=this.length),q<0||Me>V.length||Ke<0||qt>this.length)throw new RangeError("out of range index");if(Ke>=qt&&q>=Me)return 0;if(Ke>=qt)return-1;if(q>=Me)return 1;if(this===V)return 0;for(var nn=(qt>>>=0)-(Ke>>>=0),Ni=(Me>>>=0)-(q>>>=0),Di=Math.min(nn,Ni),nr=this.slice(Ke,qt),io=V.slice(q,Me),yr=0;yr<Di;++yr)if(nr[yr]!==io[yr]){nn=nr[yr],Ni=io[yr];break}return nn<Ni?-1:Ni<nn?1:0},re.prototype.includes=function(V,q,Me){return-1!==this.indexOf(V,q,Me)},re.prototype.indexOf=function(V,q,Me){return Ae(this,V,q,Me,!0)},re.prototype.lastIndexOf=function(V,q,Me){return Ae(this,V,q,Me,!1)},re.prototype.write=function(V,q,Me,Ke){if(void 0===q)Ke="utf8",Me=this.length,q=0;else if(void 0===Me&&"string"==typeof q)Ke=q,Me=this.length,q=0;else{if(!isFinite(q))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");q>>>=0,isFinite(Me)?(Me>>>=0,void 0===Ke&&(Ke="utf8")):(Ke=Me,Me=void 0)}var qt=this.length-q;if((void 0===Me||Me>qt)&&(Me=qt),V.length>0&&(Me<0||q<0)||q>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ke||(Ke="utf8");for(var nn=!1;;)switch(Ke){case"hex":return ut(this,V,q,Me);case"utf8":case"utf-8":return se(this,V,q,Me);case"ascii":case"latin1":case"binary":return be(this,V,q,Me);case"base64":return lt(this,V,q,Me);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return gt(this,V,q,Me);default:if(nn)throw new TypeError("Unknown encoding: "+Ke);Ke=(""+Ke).toLowerCase(),nn=!0}},re.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},re.prototype.slice=function(V,q){var Me=this.length;(V=~~V)<0?(V+=Me)<0&&(V=0):V>Me&&(V=Me),(q=void 0===q?Me:~~q)<0?(q+=Me)<0&&(q=0):q>Me&&(q=Me),q<V&&(q=V);var Ke=this.subarray(V,q);return Object.setPrototypeOf(Ke,re.prototype),Ke},re.prototype.readUintLE=re.prototype.readUIntLE=function(V,q,Me){V>>>=0,q>>>=0,Me||xi(V,q,this.length);for(var Ke=this[V],qt=1,nn=0;++nn<q&&(qt*=256);)Ke+=this[V+nn]*qt;return Ke},re.prototype.readUintBE=re.prototype.readUIntBE=function(V,q,Me){V>>>=0,q>>>=0,Me||xi(V,q,this.length);for(var Ke=this[V+--q],qt=1;q>0&&(qt*=256);)Ke+=this[V+--q]*qt;return Ke},re.prototype.readUint8=re.prototype.readUInt8=function(V,q){return V>>>=0,q||xi(V,1,this.length),this[V]},re.prototype.readUint16LE=re.prototype.readUInt16LE=function(V,q){return V>>>=0,q||xi(V,2,this.length),this[V]|this[V+1]<<8},re.prototype.readUint16BE=re.prototype.readUInt16BE=function(V,q){return V>>>=0,q||xi(V,2,this.length),this[V]<<8|this[V+1]},re.prototype.readUint32LE=re.prototype.readUInt32LE=function(V,q){return V>>>=0,q||xi(V,4,this.length),(this[V]|this[V+1]<<8|this[V+2]<<16)+16777216*this[V+3]},re.prototype.readUint32BE=re.prototype.readUInt32BE=function(V,q){return V>>>=0,q||xi(V,4,this.length),16777216*this[V]+(this[V+1]<<16|this[V+2]<<8|this[V+3])},re.prototype.readIntLE=function(V,q,Me){V>>>=0,q>>>=0,Me||xi(V,q,this.length);for(var Ke=this[V],qt=1,nn=0;++nn<q&&(qt*=256);)Ke+=this[V+nn]*qt;return Ke>=(qt*=128)&&(Ke-=Math.pow(2,8*q)),Ke},re.prototype.readIntBE=function(V,q,Me){V>>>=0,q>>>=0,Me||xi(V,q,this.length);for(var Ke=q,qt=1,nn=this[V+--Ke];Ke>0&&(qt*=256);)nn+=this[V+--Ke]*qt;return nn>=(qt*=128)&&(nn-=Math.pow(2,8*q)),nn},re.prototype.readInt8=function(V,q){return V>>>=0,q||xi(V,1,this.length),128&this[V]?-1*(255-this[V]+1):this[V]},re.prototype.readInt16LE=function(V,q){V>>>=0,q||xi(V,2,this.length);var Me=this[V]|this[V+1]<<8;return 32768&Me?4294901760|Me:Me},re.prototype.readInt16BE=function(V,q){V>>>=0,q||xi(V,2,this.length);var Me=this[V+1]|this[V]<<8;return 32768&Me?4294901760|Me:Me},re.prototype.readInt32LE=function(V,q){return V>>>=0,q||xi(V,4,this.length),this[V]|this[V+1]<<8|this[V+2]<<16|this[V+3]<<24},re.prototype.readInt32BE=function(V,q){return V>>>=0,q||xi(V,4,this.length),this[V]<<24|this[V+1]<<16|this[V+2]<<8|this[V+3]},re.prototype.readFloatLE=function(V,q){return V>>>=0,q||xi(V,4,this.length),ke.read(this,V,!0,23,4)},re.prototype.readFloatBE=function(V,q){return V>>>=0,q||xi(V,4,this.length),ke.read(this,V,!1,23,4)},re.prototype.readDoubleLE=function(V,q){return V>>>=0,q||xi(V,8,this.length),ke.read(this,V,!0,52,8)},re.prototype.readDoubleBE=function(V,q){return V>>>=0,q||xi(V,8,this.length),ke.read(this,V,!1,52,8)},re.prototype.writeUintLE=re.prototype.writeUIntLE=function(V,q,Me,Ke){V=+V,q>>>=0,Me>>>=0,Ke||Kt(this,V,q,Me,Math.pow(2,8*Me)-1,0);var nn=1,Ni=0;for(this[q]=255&V;++Ni<Me&&(nn*=256);)this[q+Ni]=V/nn&255;return q+Me},re.prototype.writeUintBE=re.prototype.writeUIntBE=function(V,q,Me,Ke){V=+V,q>>>=0,Me>>>=0,Ke||Kt(this,V,q,Me,Math.pow(2,8*Me)-1,0);var nn=Me-1,Ni=1;for(this[q+nn]=255&V;--nn>=0&&(Ni*=256);)this[q+nn]=V/Ni&255;return q+Me},re.prototype.writeUint8=re.prototype.writeUInt8=function(V,q,Me){return V=+V,q>>>=0,Me||Kt(this,V,q,1,255,0),this[q]=255&V,q+1},re.prototype.writeUint16LE=re.prototype.writeUInt16LE=function(V,q,Me){return V=+V,q>>>=0,Me||Kt(this,V,q,2,65535,0),this[q]=255&V,this[q+1]=V>>>8,q+2},re.prototype.writeUint16BE=re.prototype.writeUInt16BE=function(V,q,Me){return V=+V,q>>>=0,Me||Kt(this,V,q,2,65535,0),this[q]=V>>>8,this[q+1]=255&V,q+2},re.prototype.writeUint32LE=re.prototype.writeUInt32LE=function(V,q,Me){return V=+V,q>>>=0,Me||Kt(this,V,q,4,4294967295,0),this[q+3]=V>>>24,this[q+2]=V>>>16,this[q+1]=V>>>8,this[q]=255&V,q+4},re.prototype.writeUint32BE=re.prototype.writeUInt32BE=function(V,q,Me){return V=+V,q>>>=0,Me||Kt(this,V,q,4,4294967295,0),this[q]=V>>>24,this[q+1]=V>>>16,this[q+2]=V>>>8,this[q+3]=255&V,q+4},re.prototype.writeIntLE=function(V,q,Me,Ke){if(V=+V,q>>>=0,!Ke){var qt=Math.pow(2,8*Me-1);Kt(this,V,q,Me,qt-1,-qt)}var nn=0,Ni=1,Di=0;for(this[q]=255&V;++nn<Me&&(Ni*=256);)V<0&&0===Di&&0!==this[q+nn-1]&&(Di=1),this[q+nn]=(V/Ni>>0)-Di&255;return q+Me},re.prototype.writeIntBE=function(V,q,Me,Ke){if(V=+V,q>>>=0,!Ke){var qt=Math.pow(2,8*Me-1);Kt(this,V,q,Me,qt-1,-qt)}var nn=Me-1,Ni=1,Di=0;for(this[q+nn]=255&V;--nn>=0&&(Ni*=256);)V<0&&0===Di&&0!==this[q+nn+1]&&(Di=1),this[q+nn]=(V/Ni>>0)-Di&255;return q+Me},re.prototype.writeInt8=function(V,q,Me){return V=+V,q>>>=0,Me||Kt(this,V,q,1,127,-128),V<0&&(V=255+V+1),this[q]=255&V,q+1},re.prototype.writeInt16LE=function(V,q,Me){return V=+V,q>>>=0,Me||Kt(this,V,q,2,32767,-32768),this[q]=255&V,this[q+1]=V>>>8,q+2},re.prototype.writeInt16BE=function(V,q,Me){return V=+V,q>>>=0,Me||Kt(this,V,q,2,32767,-32768),this[q]=V>>>8,this[q+1]=255&V,q+2},re.prototype.writeInt32LE=function(V,q,Me){return V=+V,q>>>=0,Me||Kt(this,V,q,4,2147483647,-2147483648),this[q]=255&V,this[q+1]=V>>>8,this[q+2]=V>>>16,this[q+3]=V>>>24,q+4},re.prototype.writeInt32BE=function(V,q,Me){return V=+V,q>>>=0,Me||Kt(this,V,q,4,2147483647,-2147483648),V<0&&(V=4294967295+V+1),this[q]=V>>>24,this[q+1]=V>>>16,this[q+2]=V>>>8,this[q+3]=255&V,q+4},re.prototype.writeFloatLE=function(V,q,Me){return vo(this,V,q,!0,Me)},re.prototype.writeFloatBE=function(V,q,Me){return vo(this,V,q,!1,Me)},re.prototype.writeDoubleLE=function(V,q,Me){return ki(this,V,q,!0,Me)},re.prototype.writeDoubleBE=function(V,q,Me){return ki(this,V,q,!1,Me)},re.prototype.copy=function(V,q,Me,Ke){if(!re.isBuffer(V))throw new TypeError("argument should be a Buffer");if(Me||(Me=0),!Ke&&0!==Ke&&(Ke=this.length),q>=V.length&&(q=V.length),q||(q=0),Ke>0&&Ke<Me&&(Ke=Me),Ke===Me||0===V.length||0===this.length)return 0;if(q<0)throw new RangeError("targetStart out of bounds");if(Me<0||Me>=this.length)throw new RangeError("Index out of range");if(Ke<0)throw new RangeError("sourceEnd out of bounds");Ke>this.length&&(Ke=this.length),V.length-q<Ke-Me&&(Ke=V.length-q+Me);var qt=Ke-Me;return this===V&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(q,Me,Ke):Uint8Array.prototype.set.call(V,this.subarray(Me,Ke),q),qt},re.prototype.fill=function(V,q,Me,Ke){if("string"==typeof V){if("string"==typeof q?(Ke=q,q=0,Me=this.length):"string"==typeof Me&&(Ke=Me,Me=this.length),void 0!==Ke&&"string"!=typeof Ke)throw new TypeError("encoding must be a string");if("string"==typeof Ke&&!re.isEncoding(Ke))throw new TypeError("Unknown encoding: "+Ke);if(1===V.length){var qt=V.charCodeAt(0);("utf8"===Ke&&qt<128||"latin1"===Ke)&&(V=qt)}}else"number"==typeof V?V&=255:"boolean"==typeof V&&(V=Number(V));if(q<0||this.length<q||this.length<Me)throw new RangeError("Out of range index");if(Me<=q)return this;var nn;if(q>>>=0,Me=void 0===Me?this.length:Me>>>0,V||(V=0),"number"==typeof V)for(nn=q;nn<Me;++nn)this[nn]=V;else{var Ni=re.isBuffer(V)?V:re.from(V,Ke),Di=Ni.length;if(0===Di)throw new TypeError('The value "'+V+'" is invalid for argument "value"');for(nn=0;nn<Me-q;++nn)this[nn+q]=Ni[nn%Di]}return this};var Ii=/[^+/0-9A-Za-z-_]/g;function W(fe,V){V=V||1/0;for(var q,Me=fe.length,Ke=null,qt=[],nn=0;nn<Me;++nn){if((q=fe.charCodeAt(nn))>55295&&q<57344){if(!Ke){if(q>56319){(V-=3)>-1&&qt.push(239,191,189);continue}if(nn+1===Me){(V-=3)>-1&&qt.push(239,191,189);continue}Ke=q;continue}if(q<56320){(V-=3)>-1&&qt.push(239,191,189),Ke=q;continue}q=65536+(Ke-55296<<10|q-56320)}else Ke&&(V-=3)>-1&&qt.push(239,191,189);if(Ke=null,q<128){if((V-=1)<0)break;qt.push(q)}else if(q<2048){if((V-=2)<0)break;qt.push(q>>6|192,63&q|128)}else if(q<65536){if((V-=3)<0)break;qt.push(q>>12|224,q>>6&63|128,63&q|128)}else{if(!(q<1114112))throw new Error("Invalid code point");if((V-=4)<0)break;qt.push(q>>18|240,q>>12&63|128,q>>6&63|128,63&q|128)}}return qt}function Ri(fe){return ye.toByteArray(function ge(fe){if((fe=(fe=fe.split("=")[0]).trim().replace(Ii,"")).length<2)return"";for(;fe.length%4!=0;)fe+="=";return fe}(fe))}function Jn(fe,V,q,Me){for(var Ke=0;Ke<Me&&!(Ke+q>=V.length||Ke>=fe.length);++Ke)V[Ke+q]=fe[Ke];return Ke}function Ci(fe,V){return fe instanceof V||null!=fe&&null!=fe.constructor&&null!=fe.constructor.name&&fe.constructor.name===V.name}function Xr(fe){return fe!=fe}var Zr=function(){for(var fe="0123456789abcdef",V=new Array(256),q=0;q<16;++q)for(var Me=16*q,Ke=0;Ke<16;++Ke)V[Me+Ke]=fe[q]+fe[Ke];return V}()},8472:function(on,hn){var Ie,We="undefined"!=typeof self?self:this,ye=function(){function Ie(){this.fetch=!1,this.DOMException=We.DOMException}return Ie.prototype=We,new Ie}();Ie=ye,function(ie){var Qe_searchParams="URLSearchParams"in Ie,Qe_iterable="Symbol"in Ie&&"iterator"in Symbol,Qe_blob="FileReader"in Ie&&"Blob"in Ie&&function(){try{return new Blob,!0}catch(He){return!1}}(),Qe_formData="FormData"in Ie,Qe_arrayBuffer="ArrayBuffer"in Ie;if(Qe_arrayBuffer)var Ue=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Ye=ArrayBuffer.isView||function(He){return He&&Ue.indexOf(Object.prototype.toString.call(He))>-1};function bt(He){if("string"!=typeof He&&(He=String(He)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(He))throw new TypeError("Invalid character in header field name");return He.toLowerCase()}function Ct(He){return"string"!=typeof He&&(He=String(He)),He}function $e(He){var vt={next:function(){var Dt=He.shift();return{done:void 0===Dt,value:Dt}}};return Qe_iterable&&(vt[Symbol.iterator]=function(){return vt}),vt}function Ge(He){this.map={},He instanceof Ge?He.forEach(function(vt,Dt){this.append(Dt,vt)},this):Array.isArray(He)?He.forEach(function(vt){this.append(vt[0],vt[1])},this):He&&Object.getOwnPropertyNames(He).forEach(function(vt){this.append(vt,He[vt])},this)}function wt(He){if(He.bodyUsed)return Promise.reject(new TypeError("Already read"));He.bodyUsed=!0}function Jt(He){return new Promise(function(vt,Dt){He.onload=function(){vt(He.result)},He.onerror=function(){Dt(He.error)}})}function vn(He){var vt=new FileReader,Dt=Jt(vt);return vt.readAsArrayBuffer(He),Dt}function ln(He){if(He.slice)return He.slice(0);var vt=new Uint8Array(He.byteLength);return vt.set(new Uint8Array(He)),vt.buffer}function Te(){return this.bodyUsed=!1,this._initBody=function(He){this._bodyInit=He,He?"string"==typeof He?this._bodyText=He:Qe_blob&&Blob.prototype.isPrototypeOf(He)?this._bodyBlob=He:Qe_formData&&FormData.prototype.isPrototypeOf(He)?this._bodyFormData=He:Qe_searchParams&&URLSearchParams.prototype.isPrototypeOf(He)?this._bodyText=He.toString():Qe_arrayBuffer&&Qe_blob&&function re(He){return He&&DataView.prototype.isPrototypeOf(He)}(He)?(this._bodyArrayBuffer=ln(He.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Qe_arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(He)||Ye(He))?this._bodyArrayBuffer=ln(He):this._bodyText=He=Object.prototype.toString.call(He):this._bodyText="",this.headers.get("content-type")||("string"==typeof He?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Qe_searchParams&&URLSearchParams.prototype.isPrototypeOf(He)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Qe_blob&&(this.blob=function(){var He=wt(this);if(He)return He;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?wt(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(vn)}),this.text=function(){var He=wt(this);if(He)return He;if(this._bodyBlob)return function Cn(He){var vt=new FileReader,Dt=Jt(vt);return vt.readAsText(He),Dt}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function st(He){for(var vt=new Uint8Array(He),Dt=new Array(vt.length),oi=0;oi<vt.length;oi++)Dt[oi]=String.fromCharCode(vt[oi]);return Dt.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Qe_formData&&(this.formData=function(){return this.text().then(ut)}),this.json=function(){return this.text().then(JSON.parse)},this}Ge.prototype.append=function(He,vt){He=bt(He),vt=Ct(vt);var Dt=this.map[He];this.map[He]=Dt?Dt+", "+vt:vt},Ge.prototype.delete=function(He){delete this.map[bt(He)]},Ge.prototype.get=function(He){return He=bt(He),this.has(He)?this.map[He]:null},Ge.prototype.has=function(He){return this.map.hasOwnProperty(bt(He))},Ge.prototype.set=function(He,vt){this.map[bt(He)]=Ct(vt)},Ge.prototype.forEach=function(He,vt){for(var Dt in this.map)this.map.hasOwnProperty(Dt)&&He.call(vt,this.map[Dt],Dt,this)},Ge.prototype.keys=function(){var He=[];return this.forEach(function(vt,Dt){He.push(Dt)}),$e(He)},Ge.prototype.values=function(){var He=[];return this.forEach(function(vt){He.push(vt)}),$e(He)},Ge.prototype.entries=function(){var He=[];return this.forEach(function(vt,Dt){He.push([Dt,vt])}),$e(He)},Qe_iterable&&(Ge.prototype[Symbol.iterator]=Ge.prototype.entries);var xe=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function ce(He,vt){var Dt=(vt=vt||{}).body;if(He instanceof ce){if(He.bodyUsed)throw new TypeError("Already read");this.url=He.url,this.credentials=He.credentials,vt.headers||(this.headers=new Ge(He.headers)),this.method=He.method,this.mode=He.mode,this.signal=He.signal,!Dt&&null!=He._bodyInit&&(Dt=He._bodyInit,He.bodyUsed=!0)}else this.url=String(He);if(this.credentials=vt.credentials||this.credentials||"same-origin",(vt.headers||!this.headers)&&(this.headers=new Ge(vt.headers)),this.method=function Ae(He){var vt=He.toUpperCase();return xe.indexOf(vt)>-1?vt:He}(vt.method||this.method||"GET"),this.mode=vt.mode||this.mode||null,this.signal=vt.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&Dt)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Dt)}function ut(He){var vt=new FormData;return He.trim().split("&").forEach(function(Dt){if(Dt){var oi=Dt.split("="),Lt=oi.shift().replace(/\+/g," "),cn=oi.join("=").replace(/\+/g," ");vt.append(decodeURIComponent(Lt),decodeURIComponent(cn))}}),vt}function se(He){var vt=new Ge;return He.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(oi){var Lt=oi.split(":"),cn=Lt.shift().trim();if(cn){var qi=Lt.join(":").trim();vt.append(cn,qi)}}),vt}function be(He,vt){vt||(vt={}),this.type="default",this.status=void 0===vt.status?200:vt.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in vt?vt.statusText:"OK",this.headers=new Ge(vt.headers),this.url=vt.url||"",this._initBody(He)}ce.prototype.clone=function(){return new ce(this,{body:this._bodyInit})},Te.call(ce.prototype),Te.call(be.prototype),be.prototype.clone=function(){return new be(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Ge(this.headers),url:this.url})},be.error=function(){var He=new be(null,{status:0,statusText:""});return He.type="error",He};var lt=[301,302,303,307,308];be.redirect=function(He,vt){if(-1===lt.indexOf(vt))throw new RangeError("Invalid status code");return new be(null,{status:vt,headers:{location:He}})},ie.DOMException=Ie.DOMException;try{new ie.DOMException}catch(He){ie.DOMException=function(vt,Dt){this.message=vt,this.name=Dt;var oi=Error(vt);this.stack=oi.stack},ie.DOMException.prototype=Object.create(Error.prototype),ie.DOMException.prototype.constructor=ie.DOMException}function gt(He,vt){return new Promise(function(Dt,oi){var Lt=new ce(He,vt);if(Lt.signal&&Lt.signal.aborted)return oi(new ie.DOMException("Aborted","AbortError"));var cn=new XMLHttpRequest;function qi(){cn.abort()}cn.onload=function(){var Fi={status:cn.status,statusText:cn.statusText,headers:se(cn.getAllResponseHeaders()||"")};Fi.url="responseURL"in cn?cn.responseURL:Fi.headers.get("X-Request-URL"),Dt(new be("response"in cn?cn.response:cn.responseText,Fi))},cn.onerror=function(){oi(new TypeError("Network request failed"))},cn.ontimeout=function(){oi(new TypeError("Network request failed"))},cn.onabort=function(){oi(new ie.DOMException("Aborted","AbortError"))},cn.open(Lt.method,Lt.url,!0),"include"===Lt.credentials?cn.withCredentials=!0:"omit"===Lt.credentials&&(cn.withCredentials=!1),"responseType"in cn&&Qe_blob&&(cn.responseType="blob"),Lt.headers.forEach(function(Fi,xi){cn.setRequestHeader(xi,Fi)}),Lt.signal&&(Lt.signal.addEventListener("abort",qi),cn.onreadystatechange=function(){4===cn.readyState&&Lt.signal.removeEventListener("abort",qi)}),cn.send(void 0===Lt._bodyInit?null:Lt._bodyInit)})}gt.polyfill=!0,Ie.fetch||(Ie.fetch=gt,Ie.Headers=Ge,Ie.Request=ce,Ie.Response=be),ie.Headers=Ge,ie.Request=ce,ie.Response=be,ie.fetch=gt,Object.defineProperty(ie,"__esModule",{value:!0})}({}),ye.fetch.ponyfill=!0,delete ye.fetch.polyfill;var ke=ye;(hn=ke.fetch).default=ke.fetch,hn.fetch=ke.fetch,hn.Headers=ke.Headers,hn.Request=ke.Request,hn.Response=ke.Response,on.exports=hn},6570:on=>{function hn(ye){if(ye)return function We(ye){for(var ke in hn.prototype)ye[ke]=hn.prototype[ke];return ye}(ye)}on.exports=hn,hn.prototype.on=hn.prototype.addEventListener=function(ye,ke){return this._callbacks=this._callbacks||{},(this._callbacks[ye]=this._callbacks[ye]||[]).push(ke),this},hn.prototype.once=function(ye,ke){var Ie=this;function p(){Ie.off(ye,p),ke.apply(this,arguments)}return this._callbacks=this._callbacks||{},p.fn=ke,this.on(ye,p),this},hn.prototype.off=hn.prototype.removeListener=hn.prototype.removeAllListeners=hn.prototype.removeEventListener=function(ye,ke){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var Ie=this._callbacks[ye];if(!Ie)return this;if(1==arguments.length)return delete this._callbacks[ye],this;for(var p,ie=0;ie<Ie.length;ie++)if((p=Ie[ie])===ke||p.fn===ke){Ie.splice(ie,1);break}return this},hn.prototype.emit=function(ye){this._callbacks=this._callbacks||{};var ke=[].slice.call(arguments,1),Ie=this._callbacks[ye];if(Ie)for(var p=0,ie=(Ie=Ie.slice(0)).length;p<ie;++p)Ie[p].apply(this,ke);return this},hn.prototype.listeners=function(ye){return this._callbacks=this._callbacks||{},this._callbacks[ye]||[]},hn.prototype.hasListeners=function(ye){return!!this.listeners(ye).length}},8461:(on,hn)=>{hn.read=function(We,ye,ke,Ie,p){var ie,Qe,re=8*p-Ie-1,Ue=(1<<re)-1,Ye=Ue>>1,bt=-7,Ct=ke?p-1:0,$e=ke?-1:1,Ge=We[ye+Ct];for(Ct+=$e,ie=Ge&(1<<-bt)-1,Ge>>=-bt,bt+=re;bt>0;ie=256*ie+We[ye+Ct],Ct+=$e,bt-=8);for(Qe=ie&(1<<-bt)-1,ie>>=-bt,bt+=Ie;bt>0;Qe=256*Qe+We[ye+Ct],Ct+=$e,bt-=8);if(0===ie)ie=1-Ye;else{if(ie===Ue)return Qe?NaN:1/0*(Ge?-1:1);Qe+=Math.pow(2,Ie),ie-=Ye}return(Ge?-1:1)*Qe*Math.pow(2,ie-Ie)},hn.write=function(We,ye,ke,Ie,p,ie){var Qe,re,Ue,Ye=8*ie-p-1,bt=(1<<Ye)-1,Ct=bt>>1,$e=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,Ge=Ie?0:ie-1,wt=Ie?1:-1,Jt=ye<0||0===ye&&1/ye<0?1:0;for(ye=Math.abs(ye),isNaN(ye)||ye===1/0?(re=isNaN(ye)?1:0,Qe=bt):(Qe=Math.floor(Math.log(ye)/Math.LN2),ye*(Ue=Math.pow(2,-Qe))<1&&(Qe--,Ue*=2),(ye+=Qe+Ct>=1?$e/Ue:$e*Math.pow(2,1-Ct))*Ue>=2&&(Qe++,Ue/=2),Qe+Ct>=bt?(re=0,Qe=bt):Qe+Ct>=1?(re=(ye*Ue-1)*Math.pow(2,p),Qe+=Ct):(re=ye*Math.pow(2,Ct-1)*Math.pow(2,p),Qe=0));p>=8;We[ke+Ge]=255&re,Ge+=wt,re/=256,p-=8);for(Qe=Qe<<p|re,Ye+=p;Ye>0;We[ke+Ge]=255&Qe,Ge+=wt,Qe/=256,Ye-=8);We[ke+Ge-wt]|=128*Jt}},9898:function(on){on.exports=function(){"use strict";var hn,We,ye;function ke(p,ie){if(hn)if(We){var Qe="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+hn+")(sharedChunk); ("+We+")(sharedChunk); self.onerror = null;",re={};hn(re),ye=ie(re),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(ye.workerUrl=window.URL.createObjectURL(new Blob([Qe],{type:"text/javascript"})))}else We=ie;else hn=ie}return ke(0,function(p){var ie="undefined"!=typeof self?self:{},Qe="2.15.0";let re;const Ue={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==re){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{re=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(o){re=a}}return re},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ue.API_URL)return null;try{const a=new URL(Ue.API_URL);return"api.mapbox.cn"===a.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===a.hostname?"https://events.mapbox.com/events/v2":null}catch(a){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ye={supported:!1,testSupport:function(a){!$e&&Ct&&(Ge?wt(a):bt=a)}};let bt,Ct,$e=!1,Ge=!1;function wt(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Ct),a.isContextLost())return;Ye.supported=!0}catch(l){}a.deleteTexture(o),$e=!0}ie.document&&(Ct=ie.document.createElement("img"),Ct.onload=function(){bt&&wt(bt),bt=null,Ge=!0},Ct.onerror=function(){$e=!0,bt=null},Ct.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Jt="01";function vn(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Cn=st;function st(a,o,l,d){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(d-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=l,this.p2y=d}st.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,d=0;d<8;d++){var f=this.sampleCurveX(l)-a;if(Math.abs(f)<o)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=f/b}var v=0,w=1;for(l=a,d=0;d<20&&(f=this.sampleCurveX(l),!(Math.abs(f-a)<o));d++)a>f?v=l:w=l,l=.5*(w-v)+v;return l},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var ln=vn(Cn),Te=xe;function xe(a,o){this.x=a,this.y=o}xe.prototype={clone:function(){return new xe(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,l=a.y-this.y;return o*o+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),l=Math.sin(a),d=l*this.x+o*this.y;return this.x=o*this.x-l*this.y,this.y=d,this},_rotateAround:function(a,o){var l=Math.cos(a),d=Math.sin(a),f=o.y+d*(this.x-o.x)+l*(this.y-o.y);return this.x=o.x+l*(this.x-o.x)-d*(this.y-o.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},xe.convert=function(a){return a instanceof xe?a:Array.isArray(a)?new xe(a[0],a[1]):a};var Ae=vn(Te);const ce=Math.PI/180,ut=180/Math.PI;function se(a){return a*ce}function be(a){return a*ut}const lt=[[0,0],[1,0],[1,1],[0,1]];function gt(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,l=o*a;return 4*(a<.5?l:3*(a-o)+l-.75)}function He(a,o,l,d){const f=new ln(a,o,l,d);return function(b){return f.solve(b)}}const vt=He(.25,.1,.25,1);function Dt(a,o,l){return Math.min(l,Math.max(o,a))}function oi(a,o,l){return(l=Dt((l-a)/(o-a),0,1))*l*(3-2*l)}function Lt(a,o,l){const d=l-o,f=((a-o)%d+d)%d+o;return f===o?l:f}function cn(a,o,l){if(!a.length)return l(null,[]);let d=a.length;const f=new Array(a.length);let b=null;a.forEach((v,w)=>{o(v,(T,E)=>{T&&(b=T),f[w]=E,0==--d&&l(b,f)})})}function qi(a){const o=[];for(const l in a)o.push(a[l]);return o}function Fi(a,...o){for(const l of o)for(const d in l)a[d]=l[d];return a}let xi=1;function Kt(){return xi++}function To(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function vo(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function ki(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Ii(a,o){a.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function ge(a,o){return-1!==a.indexOf(o,a.length-o.length)}function W(a,o,l){const d={};for(const f in a)d[f]=o.call(l||this,a[f],f,a);return d}function Nt(a,o,l){const d={};for(const f in a)o.call(l||this,a[f],f,a)&&(d[f]=a[f]);return d}function Je(a){return Array.isArray(a)?a.map(Je):"object"==typeof a&&a?W(a,Je):a}const Ri={};function Jn(a){Ri[a]||("undefined"!=typeof console&&console.warn(a),Ri[a]=!0)}function Ci(a,o,l){return(l.y-a.y)*(o.x-a.x)>(o.y-a.y)*(l.x-a.x)}function Xr(a){let o=0;for(let l,d,f=0,b=a.length,v=b-1;f<b;v=f++)l=a[f],d=a[v],o+=(d.x-l.x)*(l.y+d.y);return o}function Zr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function fe(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,f,b)=>{const v=f||b;return o[d]=!v||v.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let V=null;function q(a){if(null==V){const o=a.navigator?a.navigator.userAgent:null;V=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return V}function Me(a){try{const o=ie[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(o){return!1}}function Ke(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const qt="mapbox-tiles";let Di,nr,nn=500,Ni=50;function io(){try{return ie.caches}catch(a){}}function yr(){io()&&!Di&&(Di=ie.caches.open(qt))}function Ta(a){const o=a.indexOf("?");if(o<0)return a;const d=function(f){const b=f.indexOf("?");return b>0?f.slice(b+1).split("&"):[]}(a).filter(f=>{const b=f.split("=");return"language"===b[0]||"worldview"===b[0]});return d.length?`${a.slice(0,o)}?${d.join("&")}`:a.slice(0,o)}let ms=1/0;const Ea={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ea);class Yl extends Error{constructor(o,l,d){401===l&&tt(d)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Kl=Zr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ie.location.protocol?ie.parent:ie).location.href,Lc=function(a,o){if(!(/^file:/.test(l=a.url)||/^file:/.test(Kl())&&!/^\w+:/.test(l))){if(ie.fetch&&ie.Request&&ie.AbortController&&ie.Request.prototype.hasOwnProperty("signal"))return function(d,f){const b=new ie.AbortController,v=new ie.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Kl(),referrerPolicy:d.referrerPolicy,signal:b.signal});let w=!1,T=!1;const E=(k=v.url).indexOf("sku=")>0&&tt(k);var k;"json"===d.type&&v.headers.set("Accept","application/json");const P=(N,z,G)=>{if(T)return;if(N&&"SecurityError"!==N.message&&Jn(N.toString()),z&&G)return L(z);const ee=Date.now();ie.fetch(v).then(de=>{if(de.ok){const De=E?de.clone():null;return L(de,De,ee)}return f(new Yl(de.statusText,de.status,d.url))}).catch(de=>{"AbortError"!==de.name&&f(new Error(`${de.message} ${d.url}`))})},L=(N,z,G)=>{("arrayBuffer"===d.type?N.arrayBuffer():"json"===d.type?N.json():N.text()).then(ee=>{T||(z&&G&&function(de,De,he){if(yr(),!Di)return;const we={status:De.status,statusText:De.statusText,headers:new ie.Headers};De.headers.forEach((at,rt)=>we.headers.set(rt,at));const Re=fe(De.headers.get("Cache-Control")||"");if(Re["no-store"])return;Re["max-age"]&&we.headers.set("Expires",new Date(he+1e3*Re["max-age"]).toUTCString());const Pe=we.headers.get("Expires");Pe&&(new Date(Pe).getTime()-he<42e4||function(at,rt){if(void 0===nr)try{new Response(new ReadableStream),nr=!0}catch(yt){nr=!1}nr?rt(at.body):at.blob().then(rt)}(De,at=>{const rt=new ie.Response(at,we);yr(),Di&&Di.then(yt=>yt.put(Ta(de.url),rt)).catch(yt=>Jn(yt.message))}))}(v,z,G),w=!0,f(null,ee,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(ee=>{T||f(new Error(ee.message))})};return E?function(N,z){if(yr(),!Di)return z(null);const G=Ta(N.url);Di.then(ee=>{ee.match(G).then(de=>{const De=function(he){if(!he)return!1;const we=new Date(he.headers.get("Expires")||0),Re=fe(he.headers.get("Cache-Control")||"");return we>Date.now()&&!Re["no-cache"]}(de);ee.delete(G),De&&ee.put(G,de.clone()),z(null,de,De)}).catch(z)}).catch(z)}(v,P):P(null,null),{cancel:()=>{T=!0,w||b.abort()}}}(a,o);if(Zr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var l;return function(d,f){const b=new ie.XMLHttpRequest;b.open(d.method||"GET",d.url,!0),"arrayBuffer"===d.type&&(b.responseType="arraybuffer");for(const v in d.headers)b.setRequestHeader(v,d.headers[v]);return"json"===d.type&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials="include"===d.credentials,b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||0===b.status)&&null!==b.response){let v=b.response;if("json"===d.type)try{v=JSON.parse(b.response)}catch(w){return f(w)}f(null,v,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else f(new Yl(b.statusText,b.status,d.url))},b.send(d.body),{cancel:()=>b.abort()}}(a,o)},bu=function(a,o){return Lc(Fi(a,{type:"arrayBuffer"}),o)};function Fh(a){const o=ie.document.createElement("a");return o.href=a,o.protocol===ie.document.location.protocol&&o.host===ie.document.location.host}const Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Z,Q;Z=[],Q=0;const ve=function(a,o){if(Ye.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Q>=Ue.MAX_PARALLEL_IMAGE_REQUESTS){const b={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return Z.push(b),b}Q++;let l=!1;const d=()=>{if(!l)for(l=!0,Q--;Z.length&&Q<Ue.MAX_PARALLEL_IMAGE_REQUESTS;){const b=Z.shift(),{requestParameters:v,callback:w,cancelled:T}=b;T||(b.cancel=ve(v,w).cancel)}},f=bu(a,(b,v,w,T)=>{d(),b?o(b):v&&(ie.createImageBitmap?function(E,k){const P=new ie.Blob([new Uint8Array(E)],{type:"image/png"});ie.createImageBitmap(P).then(L=>{k(null,L)}).catch(L=>{k(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(E,k)=>o(E,k,w,T)):function(E,k){const P=new ie.Image,L=ie.URL;P.onload=()=>{k(null,P),L.revokeObjectURL(P.src),P.onload=null,ie.requestAnimationFrame(()=>{P.src=Ee})},P.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new ie.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?L.createObjectURL(N):Ee}(v,(E,k)=>o(E,k,w,T)))});return{cancel:()=>{f.cancel(),d()}}},Oe="NO_ACCESS_TOKEN";function Ve(a){return 0===a.indexOf("mapbox:")}function tt(a){return Ue.API_URL_REGEX.test(a)}function et(a){return Ue.API_CDN_URL_REGEX.test(a)}function ze(a){return Ue.API_STYLE_REGEX.test(a)&&!ct(a)}function ct(a){return Ue.API_SPRITE_REGEX.test(a)}const Zt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function rn(a){const o=a.match(Zt);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Gt(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}const ii="mapbox.eventData";function mi(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(ie.atob(o[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class ni{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const l=mi(Ue.ACCESS_TOKEN);let d="";return d=l&&l.u?ie.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,b)=>String.fromCharCode(Number("0x"+b)))):Ue.ACCESS_TOKEN||"",o?`${ii}.${o}:${d}`:`${ii}:${d}`}fetchEventData(){const o=Me("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(o)try{const f=ie.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const b=ie.localStorage.getItem(d);b&&(this.anonId=b)}catch(f){Jn("Unable to read from LocalStorage")}}saveEventData(){const o=Me("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(o)try{ie.localStorage.setItem(d,this.anonId),Object.keys(this.eventData).length>=1&&ie.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(f){Jn("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,d,f){if(!Ue.EVENTS_URL)return;const b=rn(Ue.EVENTS_URL);b.params.push(`access_token=${f||Ue.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(o).toISOString()},w=l?Fi(v,l):v,T={url:Gt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var k;this.pendingRequest=(k=E=>{this.pendingRequest=null,d(E),this.saveEventData(),this.processRequests(f)},Lc(Fi(T,{method:"POST"}),k))}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}const gi=new class extends ni{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){Ue.EVENTS_URL&&Ue.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>Ve(l)||tt(l))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=mi(Ue.ACCESS_TOKEN),l=o?o.u:Ue.ACCESS_TOKEN;let d=l!==this.eventData.tokenU;ki(this.anonId)||(this.anonId=To(),d=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),v=new Date(f),w=(f-this.eventData.lastSuccess)/864e5;d=d||w>=1||w<-1||b.getDate()!==v.getDate()}else d=!0;d?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Qe,skuId:Jt,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},a):this.processRequests()}},Mi=gi.postTurnstileEvent.bind(gi),Bi=new class extends ni{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,l,d){this.skuToken=o,this.errorCb=d,Ue.EVENTS_URL&&(l||Ue.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Oe)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),ki(this.anonId)||(this.anonId=To()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Qe,skuId:Jt,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):o&&(this.success[o]=!0)},a))}},po=Bi.postMapLoadEvent.bind(Bi),ns=new class extends ni{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){Ue.EVENTS_URL&&(a||Ue.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:l}=this.queue.shift(),d=function(f){const b=ie.performance.getEntriesByType("resource"),v=ie.performance.getEntriesByType("mark"),w=function(L){const N={};if(L)for(const z in L)if("other"!==z)for(const G of L[z]){const ee=`${z}ResolveRangeMin`,de=`${z}ResolveRangeMax`,De=`${z}RequestCount`,he=`${z}RequestCachedCount`;N[ee]=Math.min(N[ee]||1/0,G.startTime),N[de]=Math.max(N[de]||-1/0,G.responseEnd);const we=Re=>{void 0===N[Re]&&(N[Re]=0),++N[Re]};void 0!==G.transferSize&&0===G.transferSize&&we(he),we(De)}return N}(function(L,N){const z={};if(L)for(const G of L){const ee=N(G);void 0===z[ee]&&(z[ee]=[]),z[ee].push(G)}return z}(b,$m)),T=ie.devicePixelRatio,E=ie.navigator.connection||ie.navigator.mozConnection||ie.navigator.webkitConnection,k={counters:[],metadata:[],attributes:[]},P=(L,N,z)=>{null!=z&&L.push({name:N,value:z.toString()})};for(const L in w)P(k.counters,L,w[L]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(P(k.counters,"interactionRangeMin",f.interactionRange[0]),P(k.counters,"interactionRangeMax",f.interactionRange[1])),v)for(const L of Object.keys(_u)){const N=_u[L],z=v.find(G=>G.name===N);z&&P(k.counters,N,z.startTime)}return P(k.counters,"visibilityHidden",f.visibilityHidden),P(k.attributes,"style",function(L){if(L)for(const N of L){const z=N.name.split("?")[0];if(ze(z)){const G=z.split("/").slice(-2);if(2===G.length)return`mapbox://styles/${G[0]}/${G[1]}`}}}(b)),P(k.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),P(k.attributes,"fogEnabled",f.fogEnabled?"true":"false"),P(k.attributes,"projection",f.projection),P(k.attributes,"zoom",f.zoom),P(k.metadata,"devicePixelRatio",T),P(k.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),P(k.metadata,"navigatorUserAgent",ie.navigator.userAgent),P(k.metadata,"screenWidth",ie.screen.width),P(k.metadata,"screenHeight",ie.screen.height),P(k.metadata,"windowWidth",ie.innerWidth),P(k.metadata,"windowHeight",ie.innerHeight),P(k.metadata,"mapWidth",f.width/T),P(k.metadata,"mapHeight",f.height/T),P(k.metadata,"webglRenderer",f.renderer),P(k.metadata,"webglVendor",f.vendor),P(k.metadata,"sdkVersion",Qe),P(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(l);for(const f of d.metadata);for(const f of d.counters);for(const f of d.attributes);this.postEvent(o,d,()=>{},a)}},xo=ns.postPerformanceEvent.bind(ns),nl=new class extends ni{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,l,d){if(!Ue.API_URL||!Ue.SESSION_PATH)return;const f=rn(Ue.API_URL+Ue.SESSION_PATH);f.params.push(`sku=${o||""}`),f.params.push(`access_token=${d||Ue.ACCESS_TOKEN||""}`);const b={url:Gt(f),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=v=>{this.pendingRequest=null,l(v),this.saveEventData(),this.processRequests(d)},Lc(Fi(b,{method:"GET"}),w))}getSessionAPI(a,o,l,d){this.skuToken=o,this.errorCb=d,Ue.SESSION_PATH&&Ue.API_URL&&(l||Ue.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Oe)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,d=>{d?this.errorCb(d):o&&(this.success[o]=!0)},a)}},Eo=nl.getSessionAPI.bind(nl),gs=new Set,_u={create:"create",load:"load",fullLoad:"fullLoad"},Tl={mark(a){ie.performance.mark(a)},measure(a,o,l){ie.performance.measure(a,o,l)}};function $m(a){const o=a.name.split("?")[0];return et(o)&&o.includes("mapbox-gl.js")?"javascript":et(o)&&o.includes("mapbox-gl.css")?"css":Ue.API_FONTS_REGEX.test(o)?"fontRange":ct(o)?"sprite":ze(o)?"style":Ue.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const Wn=ie.performance;function Ql(a){const o=a?a.url.toString():void 0;return Wn.getEntriesByName(o)}let bs,qm,Nh,Da;const Ia={now:()=>void 0!==Nh?Nh:ie.performance.now(),setNow(a){Nh=a},restoreNow(){Nh=void 0},frame(a){const o=ie.requestAnimationFrame(a);return{cancel:()=>ie.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:l,height:d}=a;Da||(Da=ie.document.createElement("canvas"));const f=Da.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(l>Da.width||d>Da.height)&&(Da.width=l,Da.height=d),f.clearRect(-o,-o,l+2*o,d+2*o),f.drawImage(a,0,0,l,d),f.getImageData(-o,-o,l+2*o,d+2*o)},resolveURL:a=>(bs||(bs=ie.document.createElement("a")),bs.href=a,bs.href),get devicePixelRatio(){return ie.devicePixelRatio},get prefersReducedMotion(){return!!ie.matchMedia&&(null==qm&&(qm=ie.matchMedia("(prefers-reduced-motion: reduce)")),qm.matches)}};function Bh(a,o,l){l[a]&&-1!==l[a].indexOf(o)||(l[a]=l[a]||[],l[a].push(o))}function Oc(a,o,l){if(l&&l[a]){const d=l[a].indexOf(o);-1!==d&&l[a].splice(d,1)}}class Fc{constructor(o,l={}){Fi(this,l),this.type=o}}class il extends Fc{constructor(o,l={}){super("error",Fi({error:o},l))}}class yu{on(o,l){return this._listeners=this._listeners||{},Bh(o,l,this._listeners),this}off(o,l){return Oc(o,l,this._listeners),Oc(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Bh(o,l,this._oneTimeListeners),this):new Promise(d=>this.once(o,d))}fire(o,l){"string"==typeof o&&(o=new Fc(o,l||{}));const d=o.type;if(this.listens(d)){o.target=this;const f=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const w of f)w.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const w of b)Oc(d,w,this._oneTimeListeners),w.call(this,o);const v=this._eventedParent;v&&(Fi(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(o))}else o instanceof il&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var _t=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function El(a,...o){for(const l of o)for(const d in l)a[d]=l[d];return a}function fo(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Oo(a){if(Array.isArray(a))return a.map(Oo);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const l in a)o[l]=Oo(a[l]);return o}return fo(a)}class ef extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}var rl=ef;class tf{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[d,f]of l)this.bindings[d]=f}concat(o){return new tf(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var ro=tf;const Er={kind:"null"},un={kind:"number"},Ti={kind:"string"},Tn={kind:"boolean"},_s={kind:"color"},ji={kind:"object"},bi={kind:"value"},qs={kind:"collator"},zi={kind:"formatted"},qn={kind:"resolvedImage"};function Rs(a,o){return{kind:"array",itemType:a,N:o}}function Hr(a){if("array"===a.kind){const o=Hr(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const zt=[Er,un,Ti,Tn,_s,zi,ji,Rs(bi),qn];function da(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!da(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const l of zt)if(!da(l,o))return null}return`Expected ${Hr(a)} but found ${Hr(o)} instead.`}function ri(a,o){return o.some(l=>l.kind===a.kind)}function Yi(a,o){return o.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var nf,p_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function vd(a){return(a=Math.round(a))<0?0:a>255?255:a}function Jl(a){return vd("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function is(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function xd(a,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(o-a)*l*6:2*l<1?o:3*l<2?a+(o-a)*(2/3-l)*6:a}try{nf={}.parseCSSColor=function(a){var o,l=a.replace(/ /g,"").toLowerCase();if(l in p_)return p_[l].slice();if("#"===l[0])return 4===l.length?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===l.length&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var d=l.indexOf("("),f=l.indexOf(")");if(-1!==d&&f+1===l.length){var b=l.substr(0,d),v=l.substr(d+1,f-(d+1)).split(","),w=1;switch(b){case"rgba":if(4!==v.length)return null;w=is(v.pop());case"rgb":return 3!==v.length?null:[Jl(v[0]),Jl(v[1]),Jl(v[2]),w];case"hsla":if(4!==v.length)return null;w=is(v.pop());case"hsl":if(3!==v.length)return null;var T=(parseFloat(v[0])%360+360)%360/360,E=is(v[1]),k=is(v[2]),P=k<=.5?k*(E+1):k+E-k*E,L=2*k-P;return[vd(255*xd(L,P,T+1/3)),vd(255*xd(L,P,T)),vd(255*xd(L,P,T-1/3)),w];default:return null}}return null}}catch(a){}class Ps{constructor(o,l,d,f=1){this.r=o,this.g=l,this.b=d,this.a=f}static parse(o){if(!o)return;if(o instanceof Ps)return o;if("string"!=typeof o)return;const l=nf(o);return l?new Ps(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,d,f]=this.toArray();return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(d)},${f})`}toArray(){const{r:o,g:l,b:d,a:f}=this;return 0===f?[0,0,0,0]:[255*o/f,255*l/f,255*d/f,f]}toArray01(){const{r:o,g:l,b:d,a:f}=this;return 0===f?[0,0,0,0]:[o/f,l/f,d/f,f]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:d,a:f}=this;return[o,l,d,f]}}Ps.black=new Ps(0,0,0,1),Ps.white=new Ps(1,1,1,1),Ps.transparent=new Ps(0,0,0,0),Ps.red=new Ps(1,0,0,1),Ps.blue=new Ps(0,0,1,1);var mo=Ps;class Ma{constructor(o,l,d){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Gm{constructor(o,l,d,f,b){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=d,this.fontStack=f,this.textColor=b}}class Gs{constructor(o){this.sections=o}static fromString(o){return new Gs([new Gm(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof Gs?o:Gs.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.name]);continue}o.push(l.text);const d={};l.fontStack&&(d["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(d["font-scale"]=l.scale),l.textColor&&(d["text-color"]=["rgba"].concat(l.textColor.toArray())),o.push(d)}return o}}class Aa{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Aa({name:o,available:!1}):null}serialize(){return["image",this.name]}}function f_(a,o,l,d){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===d||"number"==typeof d&&d>=0&&d<=1?null:`Invalid rgba value [${[a,o,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof d?[a,o,l,d]:[a,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wd(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof mo||a instanceof Ma||a instanceof Gs||a instanceof Aa)return!0;if(Array.isArray(a)){for(const o of a)if(!wd(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!wd(a[o]))return!1;return!0}return!1}function oo(a){if(null===a)return Er;if("string"==typeof a)return Ti;if("boolean"==typeof a)return Tn;if("number"==typeof a)return un;if(a instanceof mo)return _s;if(a instanceof Ma)return qs;if(a instanceof Gs)return zi;if(a instanceof Aa)return qn;if(Array.isArray(a)){const o=a.length;let l;for(const d of a){const f=oo(d);if(l){if(l===f)continue;l=bi;break}l=f}return Rs(l||bi,o)}return ji}function Sd(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof mo||a instanceof Gs||a instanceof Aa?a.toString():JSON.stringify(a)}class Wm{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!wd(o[1]))return l.error("invalid value");const d=o[1];let f=oo(d);const b=l.expectedType;return"array"!==f.kind||0!==f.N||!b||"array"!==b.kind||"number"==typeof b.N&&0!==b.N||(f=b),new Wm(f,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof mo?["rgba"].concat(this.value.toArray()):this.value instanceof Gs?this.value.serialize():this.value}}var Do=Wm,di=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const Xm={string:Ti,number:un,boolean:Tn,object:ji};class Zm{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let d,f=1;const b=o[0];if("array"===b){let w,T;if(o.length>2){const E=o[1];if("string"!=typeof E||!(E in Xm)||"object"===E)return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=Xm[E],f++}else w=bi;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);T=o[2],f++}d=Rs(w,T)}else d=Xm[b];const v=[];for(;f<o.length;f++){const w=l.parse(o[f],f,bi);if(!w)return null;v.push(w)}return new Zm(d,v)}evaluate(o){for(let l=0;l<this.args.length;l++){const d=this.args[l].evaluate(o);if(!da(this.type,oo(d)))return d;if(l===this.args.length-1)throw new di(`Expected value to be of type ${Hr(this.type)}, but found ${Hr(oo(d))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const d=o.itemType;if("string"===d.kind||"number"===d.kind||"boolean"===d.kind){l.push(d.kind);const f=o.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(d=>d.serialize()))}}var ec=Zm;class Qt{constructor(o){this.type=zi,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const d=o[1];if(!Array.isArray(d)&&"object"==typeof d)return l.error("First argument must be an image or text section.");const f=[];let b=!1;for(let v=1;v<=o.length-1;++v){const w=o[v];if(b&&"object"==typeof w&&!Array.isArray(w)){b=!1;let T=null;if(w["font-scale"]&&(T=l.parse(w["font-scale"],1,un),!T))return null;let E=null;if(w["text-font"]&&(E=l.parse(w["text-font"],1,Rs(Ti)),!E))return null;let k=null;if(w["text-color"]&&(k=l.parse(w["text-color"],1,_s),!k))return null;const P=f[f.length-1];P.scale=T,P.font=E,P.textColor=k}else{const T=l.parse(o[v],1,bi);if(!T)return null;const E=T.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,f.push({content:T,scale:null,font:null,textColor:null})}}return new Qt(f)}evaluate(o){return new Gs(this.sections.map(l=>{const d=l.content.evaluate(o);return oo(d)===qn?new Gm("",d,null,null,null):new Gm(Sd(d),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const d={};l.scale&&(d["font-scale"]=l.scale.serialize()),l.font&&(d["text-font"]=l.font.serialize()),l.textColor&&(d["text-color"]=l.textColor.serialize()),o.push(d)}return o}}class rf{constructor(o){this.type=qn,this.input=o}static parse(o,l){if(2!==o.length)return l.error("Expected two arguments.");const d=l.parse(o[1],1,Ti);return d?new rf(d):l.error("No image name provided.")}evaluate(o){const l=this.input.evaluate(o),d=Aa.fromString(l);return d&&o.availableImages&&(d.available=o.availableImages.indexOf(l)>-1),d}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Sn={"to-boolean":Tn,"to-color":_s,"to-number":un,"to-string":Ti};class vu{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const d=o[0];if(("to-boolean"===d||"to-string"===d)&&2!==o.length)return l.error("Expected one argument.");const f=Sn[d],b=[];for(let v=1;v<o.length;v++){const w=l.parse(o[v],v,bi);if(!w)return null;b.push(w)}return new vu(f,b)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let l,d;for(const f of this.args){if(l=f.evaluate(o),d=null,l instanceof mo)return l;if("string"==typeof l){const b=o.parseColor(l);if(b)return b}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:f_(l[0],l[1],l[2],l[3]),!d))return new mo(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new di(d||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const d of this.args){if(l=d.evaluate(o),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new di(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Gs.fromString(Sd(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?Aa.fromString(Sd(this.args[0].evaluate(o))):Sd(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Qt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new rf(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}var xu=vu;const ka=["Unknown","Point","LineString","Polygon"];var sf=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ka[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:l,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*o-a[0])+this.featureDistanceData.bearing[1]*(d*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=mo.parse(a)),o}};class Nc{constructor(o,l,d,f){this.name=o,this.type=l,this._evaluate=d,this.args=f}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const d=o[0],f=Nc.definitions[d];if(!f)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=v.filter(([E])=>!Array.isArray(E)||E.length===o.length-1);let T=null;for(const[E,k]of w){T=new Bc(l.registry,l.path,null,l.scope);const P=[];let L=!1;for(let N=1;N<o.length;N++){const z=o[N],G=Array.isArray(E)?E[N-1]:E.type,ee=T.parse(z,1+P.length,G);if(!ee){L=!0;break}P.push(ee)}if(!L)if(Array.isArray(E)&&E.length!==P.length)T.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let N=0;N<P.length;N++){const z=Array.isArray(E)?E[N]:E.type,G=P[N];T.concat(N+1).checkSubtype(z,G.type)}if(0===T.errors.length)return new Nc(d,b,k,P)}}if(1===w.length)l.errors.push(...T.errors);else{const E=(w.length?w:v).map(([P])=>{return L=P,Array.isArray(L)?`(${L.map(Hr).join(", ")})`:`(${Hr(L.type)}...)`;var L}).join(" | "),k=[];for(let P=1;P<o.length;P++){const L=l.parse(o[P],1+k.length);if(!L)return null;k.push(Hr(L.type))}l.error(`Expected arguments of type ${E}, but found (${k.join(", ")}) instead.`)}return null}static register(o,l){Nc.definitions=l;for(const d in l)o[d]=Nc}}var ol=Nc;class tc{constructor(o,l,d){this.type=qs,this.locale=d,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const d=o[1];if("object"!=typeof d||Array.isArray(d))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==d["case-sensitive"]&&d["case-sensitive"],1,Tn);if(!f)return null;const b=l.parse(void 0!==d["diacritic-sensitive"]&&d["diacritic-sensitive"],1,Tn);if(!b)return null;let v=null;return d.locale&&(v=l.parse(d.locale,1,Ti),!v)?null:new tc(f,b,v)}evaluate(o){return new Ma(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const Ra=8192;function Cd(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function wu(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function $n(a,o){const l=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,o.z);return[Math.round(l*f*Ra),Math.round(d*f*Ra)]}function zh(a,o,l){const d=a[0]-o[0],f=a[1]-o[1],b=a[0]-l[0],v=a[1]-l[1];return d*v-b*f==0&&d*b<=0&&f*v<=0}function Vh(a,o){let l=!1;for(let v=0,w=o.length;v<w;v++){const T=o[v];for(let E=0,k=T.length;E<k-1;E++){if(zh(a,T[E],T[E+1]))return!1;(f=T[E])[1]>(d=a)[1]!=(b=T[E+1])[1]>d[1]&&d[0]<(b[0]-f[0])*(d[1]-f[1])/(b[1]-f[1])+f[0]&&(l=!l)}}var d,f,b;return l}function Ls(a,o){for(let l=0;l<o.length;l++)if(Vh(a,o[l]))return!0;return!1}function jh(a,o,l,d){const f=d[0]-l[0],b=d[1]-l[1],v=(a[0]-l[0])*b-f*(a[1]-l[1]),w=(o[0]-l[0])*b-f*(o[1]-l[1]);return v>0&&w<0||v<0&&w>0}function Td(a,o,l){for(const E of l)for(let k=0;k<E.length-1;++k)if((w=[(v=E[k+1])[0]-(b=E[k])[0],v[1]-b[1]])[0]*(T=[(f=o)[0]-(d=a)[0],f[1]-d[1]])[1]-w[1]*T[0]!=0&&jh(d,f,b,v)&&jh(b,v,d,f))return!0;var d,f,b,v,w,T;return!1}function Ai(a,o){for(let l=0;l<a.length;++l)if(!Vh(a[l],o))return!1;for(let l=0;l<a.length-1;++l)if(Td(a[l],a[l+1],o))return!1;return!0}function Pa(a,o){for(let l=0;l<o.length;l++)if(Ai(a,o[l]))return!0;return!1}function Ym(a,o,l){const d=[];for(let f=0;f<a.length;f++){const b=[];for(let v=0;v<a[f].length;v++){const w=$n(a[f][v],l);Cd(o,w),b.push(w)}d.push(b)}return d}function m_(a,o,l){const d=[];for(let f=0;f<a.length;f++){const b=Ym(a[f],o,l);d.push(b)}return d}function Ws(a,o,l,d){if(a[0]<l[0]||a[0]>l[2]){const f=.5*d;let b=a[0]-l[0]>f?-d:l[0]-a[0]>f?d:0;0===b&&(b=a[0]-l[2]>f?-d:l[2]-a[0]>f?d:0),a[0]+=b}Cd(o,a)}function Lr(a,o,l,d){const f=Math.pow(2,d.z)*Ra,b=[d.x*Ra,d.y*Ra],v=[];if(!a)return v;for(const w of a)for(const T of w){const E=[T.x+b[0],T.y+b[1]];Ws(E,o,l,f),v.push(E)}return v}function Km(a,o,l,d){const f=Math.pow(2,d.z)*Ra,b=[d.x*Ra,d.y*Ra],v=[];if(!a)return v;for(const T of a){const E=[];for(const k of T){const P=[k.x+b[0],k.y+b[1]];Cd(o,P),E.push(P)}v.push(E)}if(o[2]-o[0]<=f/2){(w=o)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of v)for(const E of T)Ws(E,o,l,f)}var w;return v}class Ed{constructor(o,l){this.type=Tn,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(wd(o[1])){const d=o[1];if("FeatureCollection"===d.type)for(let f=0;f<d.features.length;++f){const b=d.features[f].geometry.type;if("Polygon"===b||"MultiPolygon"===b)return new Ed(d,d.features[f].geometry)}else if("Feature"===d.type){const f=d.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Ed(d,d.geometry)}else if("Polygon"===d.type||"MultiPolygon"===d.type)return new Ed(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,d){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===d.type){const w=Ym(d.coordinates,b,v),T=Lr(l.geometry(),f,b,v);if(!wu(f,b))return!1;for(const E of T)if(!Vh(E,w))return!1}if("MultiPolygon"===d.type){const w=m_(d.coordinates,b,v),T=Lr(l.geometry(),f,b,v);if(!wu(f,b))return!1;for(const E of T)if(!Ls(E,w))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,d){const f=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(!v)return!1;if("Polygon"===d.type){const w=Ym(d.coordinates,b,v),T=Km(l.geometry(),f,b,v);if(!wu(f,b))return!1;for(const E of T)if(!Ai(E,w))return!1}if("MultiPolygon"===d.type){const w=m_(d.coordinates,b,v),T=Km(l.geometry(),f,b,v);if(!wu(f,b))return!1;for(const E of T)if(!Pa(E,w))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Dl=Ed;function Gi(a){if(a instanceof ol&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Dl)return!1;let o=!0;return a.eachChild(l=>{o&&!Gi(l)&&(o=!1)}),o}function ha(a){if(a instanceof ol&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(l=>{o&&!ha(l)&&(o=!1)}),o}function Il(a,o){if(a instanceof ol&&o.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(d=>{l&&!Il(d,o)&&(l=!1)}),l}class Su{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const d=o[1];return l.scope.has(d)?new Su(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var af=Su;class Xs{constructor(o,l=[],d,f=new ro,b=[]){this.registry=o,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=f,this.errors=b,this.expectedType=d}parse(o,l,d,f,b={}){return l?this.concat(l,d,f)._parse(o,b):this._parse(o,b)}_parse(o,l){function d(f,b,v){return"assert"===v?new ec(b,[f]):"coerce"===v?new xu(b,[f]):f}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=o[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[f];if(b){let v=b.parse(o,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,T=v.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==T.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(w,T))return null}else v=d(v,w,l.typeAnnotation||"coerce");else v=d(v,w,l.typeAnnotation||"assert")}if(!(v instanceof Do)&&"resolvedImage"!==v.type.kind&&lf(v)){const w=new sf;try{v=new Do(v.type,v.evaluate(w))}catch(T){return this.error(T.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,d){const f="number"==typeof o?this.path.concat(o):this.path,b=d?this.scope.concat(d):this.scope;return new Xs(this.registry,f,l||null,b,this.errors)}error(o,...l){const d=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new rl(d,o))}checkSubtype(o,l){const d=da(o,l);return d&&this.error(d),d}}var Bc=Xs;function lf(a){if(a instanceof af)return lf(a.boundExpression);if(a instanceof ol&&"error"===a.name||a instanceof tc||a instanceof Dl)return!1;const o=a instanceof xu||a instanceof ec;let l=!0;return a.eachChild(d=>{l=o?l&&lf(d):l&&d instanceof Do}),!!l&&Gi(a)&&Il(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function mn(a,o){const l=a.length-1;let d,f,b=0,v=l,w=0;for(;b<=v;)if(w=Math.floor((b+v)/2),d=a[w],f=a[w+1],d<=o){if(w===l||o<f)return w;b=w+1}else{if(!(d>o))throw new di("Input is not a number.");v=w-1}return 0}class Uh{constructor(o,l,d){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,b]of d)this.labels.push(f),this.outputs.push(b)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const d=l.parse(o[1],1,un);if(!d)return null;const f=[];let b=null;l.expectedType&&"value"!==l.expectedType.kind&&(b=l.expectedType);for(let v=1;v<o.length;v+=2){const w=1===v?-1/0:o[v],T=o[v+1],E=v,k=v+1;if("number"!=typeof w)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(f.length&&f[f.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=l.parse(T,k,b);if(!P)return null;b=b||P.type,f.push([w,P])}return new Uh(b,d,f)}evaluate(o){const l=this.labels,d=this.outputs;if(1===l.length)return d[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return d[0].evaluate(o);const b=l.length;return f>=l[b-1]?d[b-1].evaluate(o):d[mn(l,f)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}var Hh=Uh;function Vi(a,o,l){return a*(1-l)+o*l}var wn=Object.freeze({__proto__:null,array:function(a,o,l){return a.map((d,f)=>Vi(d,o[f],l))},color:function(a,o,l){return new mo(Vi(a.r,o.r,l),Vi(a.g,o.g,l),Vi(a.b,o.b,l),Vi(a.a,o.a,l))},number:Vi});const Bt=4/29,wo=6/29,mr=3*wo*wo,vs=Math.PI/180,Cu=180/Math.PI;function xs(a){return a>.008856451679035631?Math.pow(a,1/3):a/mr+Bt}function Tu(a){return a>wo?a*a*a:mr*(a-Bt)}function Dd(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function nc(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Id(a){const o=nc(a.r),l=nc(a.g),d=nc(a.b),f=xs((.4124564*o+.3575761*l+.1804375*d)/.95047),b=xs((.2126729*o+.7151522*l+.072175*d)/1);return{l:116*b-16,a:500*(f-b),b:200*(b-xs((.0193339*o+.119192*l+.9503041*d)/1.08883)),alpha:a.a}}function ic(a){let o=(a.l+16)/116,l=isNaN(a.a)?o:o+a.a/500,d=isNaN(a.b)?o:o-a.b/200;return o=1*Tu(o),l=.95047*Tu(l),d=1.08883*Tu(d),new mo(Dd(3.2404542*l-1.5371385*o-.4985314*d),Dd(-.969266*l+1.8760108*o+.041556*d),Dd(.0556434*l-.2040259*o+1.0572252*d),a.alpha)}function rs(a,o,l){const d=o-a;return a+l*(d>180||d<-180?d-360*Math.round(d/360):d)}const Md={forward:Id,reverse:ic,interpolate:function(a,o,l){return{l:Vi(a.l,o.l,l),a:Vi(a.a,o.a,l),b:Vi(a.b,o.b,l),alpha:Vi(a.alpha,o.alpha,l)}}},Ho={forward:function(a){const{l:o,a:l,b:d}=Id(a),f=Math.atan2(d,l)*Cu;return{h:f<0?f+360:f,c:Math.sqrt(l*l+d*d),l:o,alpha:a.a}},reverse:function(a){const o=a.h*vs,l=a.c;return ic({l:a.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:a.alpha})},interpolate:function(a,o,l){return{h:rs(a.h,o.h,l),c:Vi(a.c,o.c,l),l:Vi(a.l,o.l,l),alpha:Vi(a.alpha,o.alpha,l)}}};var xn=Object.freeze({__proto__:null,hcl:Ho,lab:Md});class hi{constructor(o,l,d,f,b){this.type=o,this.operator=l,this.interpolation=d,this.input=f,this.labels=[],this.outputs=[];for(const[v,w]of b)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(o,l,d,f){let b=0;if("exponential"===o.name)b=Br(l,o.base,d,f);else if("linear"===o.name)b=Br(l,1,d,f);else if("cubic-bezier"===o.name){const v=o.controlPoints;b=new ln(v[0],v[1],v[2],v[3]).solve(Br(l,1,d,f))}return b}static parse(o,l){let[d,f,b,...v]=o;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const E=f[1];if("number"!=typeof E)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:E}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const E=f.slice(1);if(4!==E.length||E.some(k=>"number"!=typeof k||k<0||k>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:E}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(b=l.parse(b,2,un),!b)return null;const w=[];let T=null;"interpolate-hcl"===d||"interpolate-lab"===d?T=_s:l.expectedType&&"value"!==l.expectedType.kind&&(T=l.expectedType);for(let E=0;E<v.length;E+=2){const k=v[E],P=v[E+1],L=E+3,N=E+4;if("number"!=typeof k)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(w.length&&w[w.length-1][0]>=k)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const z=l.parse(P,N,T);if(!z)return null;T=T||z.type,w.push([k,z])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new hi(T,d,f,b,w):l.error(`Type ${Hr(T)} is not interpolatable.`)}evaluate(o){const l=this.labels,d=this.outputs;if(1===l.length)return d[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return d[0].evaluate(o);const b=l.length;if(f>=l[b-1])return d[b-1].evaluate(o);const v=mn(l,f),w=hi.interpolationFactor(this.interpolation,f,l[v],l[v+1]),T=d[v].evaluate(o),E=d[v+1].evaluate(o);return"interpolate"===this.operator?wn[this.type.kind.toLowerCase()](T,E,w):"interpolate-hcl"===this.operator?Ho.reverse(Ho.interpolate(Ho.forward(T),Ho.forward(E),w)):Md.reverse(Md.interpolate(Md.forward(T),Md.forward(E),w))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let d=0;d<this.labels.length;d++)l.push(this.labels[d],this.outputs[d].serialize());return l}}function Br(a,o,l,d){const f=d-l,b=a-l;return 0===f?0:1===o?b/f:(Math.pow(o,b)-1)/(Math.pow(o,f)-1)}var so=hi;class sl{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let d=null;const f=l.expectedType;f&&"value"!==f.kind&&(d=f);const b=[];for(const w of o.slice(1)){const T=l.parse(w,1+b.length,d,void 0,{typeAnnotation:"omit"});if(!T)return null;d=d||T.type,b.push(T)}const v=f&&b.some(w=>da(f,w.type));return new sl(v?bi:d,b)}evaluate(o){let l,d=null,f=0;for(const b of this.args){if(f++,d=b.evaluate(o),d&&d instanceof Aa&&!d.available&&(l||(l=d),d=null,f===this.args.length))return l;if(null!==d)break}return d}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var So=sl;class al{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const d=[];for(let b=1;b<o.length-1;b+=2){const v=o[b];if("string"!=typeof v)return l.error(`Expected string, but found ${typeof v} instead.`,b);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",b);const w=l.parse(o[b+1],b+1);if(!w)return null;d.push([v,w])}const f=l.parse(o[o.length-1],o.length-1,l.expectedType,d);return f?new al(d,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,d]of this.bindings)o.push(l,d.serialize());return o.push(this.result.serialize()),o}}var Yr=al;class zc{constructor(o,l,d){this.type=o,this.index=l,this.input=d}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,un),f=l.parse(o[2],2,Rs(l.expectedType||bi));return d&&f?new zc(f.type.itemType,d,f):null}evaluate(o){const l=this.index.evaluate(o),d=this.input.evaluate(o);if(l<0)throw new di(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new di(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new di(`Array index must be an integer, but found ${l} instead.`);return d[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ad=zc;class Ei{constructor(o,l){this.type=Tn,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,bi),f=l.parse(o[2],2,bi);return d&&f?ri(d.type,[Tn,Ti,un,Er,bi])?new Ei(d,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hr(d.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(null==d)return!1;if(!Yi(l,["boolean","string","number","null"]))throw new di(`Expected first argument to be of type boolean, string, number or null, but found ${Hr(oo(l))} instead.`);if(!Yi(d,["string","array"]))throw new di(`Expected second argument to be of type array or string, but found ${Hr(oo(d))} instead.`);return d.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Vc=Ei;class ll{constructor(o,l,d){this.type=un,this.needle=o,this.haystack=l,this.fromIndex=d}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,bi),f=l.parse(o[2],2,bi);if(!d||!f)return null;if(!ri(d.type,[Tn,Ti,un,Er,bi]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hr(d.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,un);return b?new ll(d,f,b):null}return new ll(d,f)}evaluate(o){const l=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(!Yi(l,["boolean","string","number","null"]))throw new di(`Expected first argument to be of type boolean, string, number or null, but found ${Hr(oo(l))} instead.`);if(!Yi(d,["string","array"]))throw new di(`Expected second argument to be of type array or string, but found ${Hr(oo(d))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(o);return d.indexOf(l,f)}return d.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var qh=ll;class Ml{constructor(o,l,d,f,b,v){this.inputType=o,this.type=l,this.input=d,this.cases=f,this.outputs=b,this.otherwise=v}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let d,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const b={},v=[];for(let E=2;E<o.length-1;E+=2){let k=o[E];const P=o[E+1];Array.isArray(k)||(k=[k]);const L=l.concat(E);if(0===k.length)return L.error("Expected at least one branch label.");for(const z of k){if("number"!=typeof z&&"string"!=typeof z)return L.error("Branch labels must be numbers or strings.");if("number"==typeof z&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof z&&Math.floor(z)!==z)return L.error("Numeric branch labels must be integer values.");if(d){if(L.checkSubtype(d,oo(z)))return null}else d=oo(z);if(void 0!==b[String(z)])return L.error("Branch labels must be unique.");b[String(z)]=v.length}const N=l.parse(P,E,f);if(!N)return null;f=f||N.type,v.push(N)}const w=l.parse(o[1],1,bi);if(!w)return null;const T=l.parse(o[o.length-1],o.length-1,f);return T?"value"!==w.type.kind&&l.concat(1).checkSubtype(d,w.type)?null:new Ml(d,f,w,b,v,T):null}evaluate(o){const l=this.input.evaluate(o);return(oo(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),d=[],f={};for(const v of l){const w=f[this.cases[v]];void 0===w?(f[this.cases[v]]=d.length,d.push([this.cases[v],[v]])):d[w][1].push(v)}const b=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,w]of d)o.push(1===w.length?b(w[0]):w.map(b)),o.push(this.outputs[v].serialize());return o.push(this.otherwise.serialize()),o}}var os=Ml;class jc{constructor(o,l,d){this.type=o,this.branches=l,this.otherwise=d}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&"value"!==l.expectedType.kind&&(d=l.expectedType);const f=[];for(let v=1;v<o.length-1;v+=2){const w=l.parse(o[v],v,Tn);if(!w)return null;const T=l.parse(o[v+1],v+1,d);if(!T)return null;f.push([w,T]),d=d||T.type}const b=l.parse(o[o.length-1],o.length-1,d);return b?new jc(d,f,b):null}evaluate(o){for(const[l,d]of this.branches)if(l.evaluate(o))return d.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,d]of this.branches)o(l),o(d);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Uc=jc;class ws{constructor(o,l,d,f){this.type=o,this.input=l,this.beginIndex=d,this.endIndex=f}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=l.parse(o[1],1,bi),f=l.parse(o[2],2,un);if(!d||!f)return null;if(!ri(d.type,[Rs(bi),Ti,bi]))return l.error(`Expected first argument to be of type array or string, but found ${Hr(d.type)} instead`);if(4===o.length){const b=l.parse(o[3],3,un);return b?new ws(d.type,d,f,b):null}return new ws(d.type,d,f)}evaluate(o){const l=this.input.evaluate(o),d=this.beginIndex.evaluate(o);if(!Yi(l,["string","array"]))throw new di(`Expected first argument to be of type array or string, but found ${Hr(oo(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(o);return l.slice(d,f)}return l.slice(d)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Hc=ws;function kd(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Or(a,o,l,d){return 0===d.compare(o,l)}function Eu(a,o,l){const d="=="!==a&&"!="!==a;return class hB{constructor(b,v,w){this.type=Tn,this.lhs=b,this.rhs=v,this.collator=w,this.hasUntypedArgument="value"===b.type.kind||"value"===v.type.kind}static parse(b,v){if(3!==b.length&&4!==b.length)return v.error("Expected two or three arguments.");const w=b[0];let T=v.parse(b[1],1,bi);if(!T)return null;if(!kd(w,T.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${Hr(T.type)}'.`);let E=v.parse(b[2],2,bi);if(!E)return null;if(!kd(w,E.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${Hr(E.type)}'.`);if(T.type.kind!==E.type.kind&&"value"!==T.type.kind&&"value"!==E.type.kind)return v.error(`Cannot compare types '${Hr(T.type)}' and '${Hr(E.type)}'.`);d&&("value"===T.type.kind&&"value"!==E.type.kind?T=new ec(E.type,[T]):"value"!==T.type.kind&&"value"===E.type.kind&&(E=new ec(T.type,[E])));let k=null;if(4===b.length){if("string"!==T.type.kind&&"string"!==E.type.kind&&"value"!==T.type.kind&&"value"!==E.type.kind)return v.error("Cannot use collator to compare non-string types.");if(k=v.parse(b[3],3,qs),!k)return null}return new hB(T,E,k)}evaluate(b){const v=this.lhs.evaluate(b),w=this.rhs.evaluate(b);if(d&&this.hasUntypedArgument){const T=oo(v),E=oo(w);if(T.kind!==E.kind||"string"!==T.kind&&"number"!==T.kind)throw new di(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${E.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const T=oo(v),E=oo(w);if("string"!==T.kind||"string"!==E.kind)return o(b,v,w)}return this.collator?l(b,v,w,this.collator.evaluate(b)):o(b,v,w)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}serialize(){const b=[a];return this.eachChild(v=>{b.push(v.serialize())}),b}}}const g_=Eu("==",function(a,o,l){return o===l},Or),Os=Eu("!=",function(a,o,l){return o!==l},function(a,o,l,d){return!Or(0,o,l,d)}),La=Eu("<",function(a,o,l){return o<l},function(a,o,l,d){return d.compare(o,l)<0}),cf=Eu(">",function(a,o,l){return o>l},function(a,o,l,d){return d.compare(o,l)>0}),Gh=Eu("<=",function(a,o,l){return o<=l},function(a,o,l,d){return d.compare(o,l)<=0}),Rd=Eu(">=",function(a,o,l){return o>=l},function(a,o,l,d){return d.compare(o,l)>=0});class Fs{constructor(o,l,d,f,b,v){this.type=Ti,this.number=o,this.locale=l,this.currency=d,this.unit=f,this.minFractionDigits=b,this.maxFractionDigits=v}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const d=l.parse(o[1],1,un);if(!d)return null;const f=o[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let b=null;if(f.locale&&(b=l.parse(f.locale,1,Ti),!b))return null;let v=null;if(f.currency&&(v=l.parse(f.currency,1,Ti),!v))return null;let w=null;if(f.unit&&(w=l.parse(f.unit,1,Ti),!w))return null;let T=null;if(f["min-fraction-digits"]&&(T=l.parse(f["min-fraction-digits"],1,un),!T))return null;let E=null;return f["max-fraction-digits"]&&(E=l.parse(f["max-fraction-digits"],1,un),!E)?null:new Fs(d,b,v,w,T,E)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Du{constructor(o){this.type=un,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const d=l.parse(o[1],1);return d?"array"!==d.type.kind&&"string"!==d.type.kind&&"value"!==d.type.kind?l.error(`Expected argument of type string or array, but found ${Hr(d.type)} instead.`):new Du(d):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new di(`Expected value to be of type string or array, but found ${Hr(oo(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}const b_={"==":g_,"!=":Os,">":cf,"<":La,">=":Rd,"<=":Gh,array:ec,at:Ad,boolean:ec,case:Uc,coalesce:So,collator:tc,format:Qt,image:rf,in:Vc,"index-of":qh,interpolate:so,"interpolate-hcl":so,"interpolate-lab":so,length:Du,let:Yr,literal:Do,match:os,number:ec,"number-format":Fs,object:ec,slice:Hc,step:Hh,string:ec,"to-boolean":xu,"to-color":xu,"to-number":xu,"to-string":xu,var:af,within:Dl};function Jm(a,[o,l,d,f]){o=o.evaluate(a),l=l.evaluate(a),d=d.evaluate(a);const b=f?f.evaluate(a):1,v=f_(o,l,d,b);if(v)throw new di(v);return new mo(o/255*b,l/255*b,d/255*b,b)}function Al(a,o){return a in o}function uf(a,o){const l=o[a];return void 0===l?null:l}function Oa(a){return{type:a}}ol.register(b_,{error:[{kind:"error"},[Ti],(a,[o])=>{throw new di(o.evaluate(a))}],typeof:[Ti,[bi],(a,[o])=>Hr(oo(o.evaluate(a)))],"to-rgba":[Rs(un,4),[_s],(a,[o])=>o.evaluate(a).toArray()],rgb:[_s,[un,un,un],Jm],rgba:[_s,[un,un,un,un],Jm],has:{type:Tn,overloads:[[[Ti],(a,[o])=>Al(o.evaluate(a),a.properties())],[[Ti,ji],(a,[o,l])=>Al(o.evaluate(a),l.evaluate(a))]]},get:{type:bi,overloads:[[[Ti],(a,[o])=>uf(o.evaluate(a),a.properties())],[[Ti,ji],(a,[o,l])=>uf(o.evaluate(a),l.evaluate(a))]]},"feature-state":[bi,[Ti],(a,[o])=>uf(o.evaluate(a),a.featureState||{})],properties:[ji,[],a=>a.properties()],"geometry-type":[Ti,[],a=>a.geometryType()],id:[bi,[],a=>a.id()],zoom:[un,[],a=>a.globals.zoom],pitch:[un,[],a=>a.globals.pitch||0],"distance-from-center":[un,[],a=>a.distanceFromCenter()],"heatmap-density":[un,[],a=>a.globals.heatmapDensity||0],"line-progress":[un,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[un,[],a=>a.globals.skyRadialProgress||0],accumulated:[bi,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[un,Oa(un),(a,o)=>{let l=0;for(const d of o)l+=d.evaluate(a);return l}],"*":[un,Oa(un),(a,o)=>{let l=1;for(const d of o)l*=d.evaluate(a);return l}],"-":{type:un,overloads:[[[un,un],(a,[o,l])=>o.evaluate(a)-l.evaluate(a)],[[un],(a,[o])=>-o.evaluate(a)]]},"/":[un,[un,un],(a,[o,l])=>o.evaluate(a)/l.evaluate(a)],"%":[un,[un,un],(a,[o,l])=>o.evaluate(a)%l.evaluate(a)],ln2:[un,[],()=>Math.LN2],pi:[un,[],()=>Math.PI],e:[un,[],()=>Math.E],"^":[un,[un,un],(a,[o,l])=>Math.pow(o.evaluate(a),l.evaluate(a))],sqrt:[un,[un],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[un,[un],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[un,[un],(a,[o])=>Math.log(o.evaluate(a))],log2:[un,[un],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[un,[un],(a,[o])=>Math.sin(o.evaluate(a))],cos:[un,[un],(a,[o])=>Math.cos(o.evaluate(a))],tan:[un,[un],(a,[o])=>Math.tan(o.evaluate(a))],asin:[un,[un],(a,[o])=>Math.asin(o.evaluate(a))],acos:[un,[un],(a,[o])=>Math.acos(o.evaluate(a))],atan:[un,[un],(a,[o])=>Math.atan(o.evaluate(a))],min:[un,Oa(un),(a,o)=>Math.min(...o.map(l=>l.evaluate(a)))],max:[un,Oa(un),(a,o)=>Math.max(...o.map(l=>l.evaluate(a)))],abs:[un,[un],(a,[o])=>Math.abs(o.evaluate(a))],round:[un,[un],(a,[o])=>{const l=o.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[un,[un],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[un,[un],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[Tn,[Ti,bi],(a,[o,l])=>a.properties()[o.value]===l.value],"filter-id-==":[Tn,[bi],(a,[o])=>a.id()===o.value],"filter-type-==":[Tn,[Ti],(a,[o])=>a.geometryType()===o.value],"filter-<":[Tn,[Ti,bi],(a,[o,l])=>{const d=a.properties()[o.value],f=l.value;return typeof d==typeof f&&d<f}],"filter-id-<":[Tn,[bi],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l<d}],"filter->":[Tn,[Ti,bi],(a,[o,l])=>{const d=a.properties()[o.value],f=l.value;return typeof d==typeof f&&d>f}],"filter-id->":[Tn,[bi],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l>d}],"filter-<=":[Tn,[Ti,bi],(a,[o,l])=>{const d=a.properties()[o.value],f=l.value;return typeof d==typeof f&&d<=f}],"filter-id-<=":[Tn,[bi],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l<=d}],"filter->=":[Tn,[Ti,bi],(a,[o,l])=>{const d=a.properties()[o.value],f=l.value;return typeof d==typeof f&&d>=f}],"filter-id->=":[Tn,[bi],(a,[o])=>{const l=a.id(),d=o.value;return typeof l==typeof d&&l>=d}],"filter-has":[Tn,[bi],(a,[o])=>o.value in a.properties()],"filter-has-id":[Tn,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Tn,[Rs(Ti)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[Tn,[Rs(bi)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[Tn,[Ti,Rs(bi)],(a,[o,l])=>l.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[Tn,[Ti,Rs(bi)],(a,[o,l])=>function(d,f,b,v){for(;b<=v;){const w=b+v>>1;if(f[w]===d)return!0;f[w]>d?v=w-1:b=w+1}return!1}(a.properties()[o.value],l.value,0,l.value.length-1)],all:{type:Tn,overloads:[[[Tn,Tn],(a,[o,l])=>o.evaluate(a)&&l.evaluate(a)],[Oa(Tn),(a,o)=>{for(const l of o)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Tn,overloads:[[[Tn,Tn],(a,[o,l])=>o.evaluate(a)||l.evaluate(a)],[Oa(Tn),(a,o)=>{for(const l of o)if(l.evaluate(a))return!0;return!1}]]},"!":[Tn,[Tn],(a,[o])=>!o.evaluate(a)],"is-supported-script":[Tn,[Ti],(a,[o])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(o.evaluate(a))}],upcase:[Ti,[Ti],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[Ti,[Ti],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[Ti,Oa(bi),(a,o)=>o.map(l=>Sd(l.evaluate(a))).join("")],"resolved-locale":[Ti,[qs],(a,[o])=>o.evaluate(a).resolvedLocale()]});var Wh=b_;function __(a){return{result:"success",value:a}}function Iu(a){return{result:"error",value:a}}function Pd(a){return"data-driven"===a["property-type"]}function df(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function hf(a){return!!a.expression&&a.expression.interpolated}function Ki(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Xh(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function y_(a){return a}function pf(a,o){const l="color"===o.type,d=a.stops&&"object"==typeof a.stops[0][0],f=d||!(d||void 0!==a.property),b=a.type||(hf(o)?"exponential":"interval");if(l&&((a=El({},a)).stops&&(a.stops=a.stops.map(E=>[E[0],mo.parse(E[1])])),a.default=mo.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!xn[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let v,w,T;if("exponential"===b)v=Fa;else if("interval"===b)v=Od;else if("categorical"===b){v=v_,w=Object.create(null);for(const E of a.stops)w[E[0]]=E[1];T=typeof a.stops[0][0]}else{if("identity"!==b)throw new Error(`Unknown function type "${b}"`);v=x_}if(d){const E={},k=[];for(let N=0;N<a.stops.length;N++){const z=a.stops[N],G=z[0].zoom;void 0===E[G]&&(E[G]={zoom:G,type:a.type,property:a.property,default:a.default,stops:[]},k.push(G)),E[G].stops.push([z[0].value,z[1]])}const P=[];for(const N of k)P.push([E[N].zoom,pf(E[N],o)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:so.interpolationFactor.bind(void 0,L),zoomStops:P.map(N=>N[0]),evaluate:({zoom:N},z)=>Fa({stops:P,base:a.base},o,N).evaluate(N,z)}}if(f){const E="exponential"===b?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:so.interpolationFactor.bind(void 0,E),zoomStops:a.stops.map(k=>k[0]),evaluate:({zoom:k})=>v(a,o,k,w,T)}}return{kind:"source",evaluate(E,k){const P=k&&k.properties?k.properties[a.property]:void 0;return void 0===P?Ld(a.default,o.default):v(a,o,P,w,T)}}}function Ld(a,o,l){return void 0!==a?a:void 0!==o?o:void 0!==l?l:void 0}function v_(a,o,l,d,f){return Ld(typeof l===f?d[l]:void 0,a.default,o.default)}function Od(a,o,l){if("number"!==Ki(l))return Ld(a.default,o.default);const d=a.stops.length;if(1===d||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[d-1][0])return a.stops[d-1][1];const f=mn(a.stops.map(b=>b[0]),l);return a.stops[f][1]}function Fa(a,o,l){const d=void 0!==a.base?a.base:1;if("number"!==Ki(l))return Ld(a.default,o.default);const f=a.stops.length;if(1===f||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];const b=mn(a.stops.map(k=>k[0]),l),v=function(k,P,L,N){const z=N-L,G=k-L;return 0===z?0:1===P?G/z:(Math.pow(P,G)-1)/(Math.pow(P,z)-1)}(l,d,a.stops[b][0],a.stops[b+1][0]),w=a.stops[b][1],T=a.stops[b+1][1];let E=wn[o.type]||y_;if(a.colorSpace&&"rgb"!==a.colorSpace){const k=xn[a.colorSpace];E=(P,L)=>k.reverse(k.interpolate(k.forward(P),k.forward(L),v))}return"function"==typeof w.evaluate?{evaluate(...k){const P=w.evaluate.apply(void 0,k),L=T.evaluate.apply(void 0,k);if(void 0!==P&&void 0!==L)return E(P,L,v)}}:E(w,T,v)}function x_(a,o,l){return"color"===o.type?l=mo.parse(l):"formatted"===o.type?l=Gs.fromString(l.toString()):"resolvedImage"===o.type?l=Aa.fromString(l.toString()):Ki(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),Ld(l,a.default,o.default)}class ff{constructor(o,l){var d;this.expression=o,this._warningHistory={},this._evaluator=new sf,this._defaultValue=l?"color"===(d=l).type&&(Xh(d.default)||Array.isArray(d.default))?new mo(0,0,0,0):"color"===d.type?mo.parse(d.default)||null:void 0===d.default?null:d.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(o,l,d,f,b,v,w,T){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,d,f,b,v,w,T){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new di(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,"undefined"!=typeof console&&console.warn(E.message)),this._defaultValue}}}function Fd(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Wh}function pa(a,o){const l=new Bc(Wh,[],o?function(f){const b={color:_s,string:Ti,number:un,enum:Ti,boolean:Tn,formatted:zi,resolvedImage:qn};return"array"===f.type?Rs(b[f.value]||bi,f.length):b[f.type]}(o):void 0),d=l.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return d?__(new ff(d,o)):Iu(l.errors)}class mf{constructor(o,l){this.kind=o,this._styleExpression=l,this.isStateDependent="constant"!==o&&!ha(l.expression)}evaluateWithoutErrorHandling(o,l,d,f,b,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,f,b,v)}evaluate(o,l,d,f,b,v){return this._styleExpression.evaluate(o,l,d,f,b,v)}}class hr{constructor(o,l,d,f){this.kind=o,this.zoomStops=d,this._styleExpression=l,this.isStateDependent="camera"!==o&&!ha(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(o,l,d,f,b,v){return this._styleExpression.evaluateWithoutErrorHandling(o,l,d,f,b,v)}evaluate(o,l,d,f,b,v){return this._styleExpression.evaluate(o,l,d,f,b,v)}interpolationFactor(o,l,d){return this.interpolationType?so.interpolationFactor(this.interpolationType,o,l,d):0}}function Mu(a,o){if("error"===(a=pa(a,o)).result)return a;const l=a.value.expression,d=Gi(l);if(!d&&!Pd(o))return Iu([new rl("","data expressions not supported")]);const f=Il(l,["zoom","pitch","distance-from-center"]);if(!f&&!df(o))return Iu([new rl("","zoom expressions not supported")]);const b=Yh(l);return b||f?b instanceof rl?Iu([b]):b instanceof so&&!hf(o)?Iu([new rl("",'"interpolate" expressions cannot be used with this property')]):__(b?new hr(d?"camera":"composite",a.value,b.labels,b instanceof so?b.interpolation:void 0):new mf(d?"constant":"source",a.value)):Iu([new rl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zh{constructor(o,l){this._parameters=o,this._specification=l,El(this,pf(this._parameters,this._specification))}static deserialize(o){return new Zh(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Yh(a){let o=null;if(a instanceof Yr)o=Yh(a.result);else if(a instanceof So){for(const l of a.args)if(o=Yh(l),o)break}else(a instanceof Hh||a instanceof so)&&a.input instanceof ol&&"zoom"===a.input.name&&(o=a);return o instanceof rl||a.eachChild(l=>{const d=Yh(l);d instanceof rl?o=d:!o&&d?o=new rl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&d&&o!==d&&(o=new rl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class pn{constructor(o,l,d,f){this.message=(o?`${o}: `:"")+d,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function fa(a){const o=a.key,l=a.value,d=a.valueSpec||{},f=a.objectElementValidators||{},b=a.style,v=a.styleSpec;let w=[];const T=Ki(l);if("object"!==T)return[new pn(o,l,`object expected, ${T} found`)];for(const E in l){const k=E.split(".")[0];let P;f[k]?P=f[k]:d[k]?P=Pt:f["*"]?P=f["*"]:d["*"]&&(P=Pt),P?w=w.concat(P({key:(o&&`${o}.`)+E,value:l[E],valueSpec:d[k]||d["*"],style:b,styleSpec:v,object:l,objectKey:E},l)):w.push(new pn(o,l[E],`unknown property "${E}"`))}for(const E in d)f[E]||d[E].required&&void 0===d[E].default&&void 0===l[E]&&w.push(new pn(o,l,`missing required property "${E}"`));return w}function eg(a){const o=a.value,l=a.valueSpec,d=a.style,f=a.styleSpec,b=a.key,v=a.arrayElementValidator||Pt;if("array"!==Ki(o))return[new pn(b,o,`array expected, ${Ki(o)} found`)];if(l.length&&o.length!==l.length)return[new pn(b,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new pn(b,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let w={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};f.$version<7&&(w.function=l.function),"object"===Ki(l.value)&&(w=l.value);let T=[];for(let E=0;E<o.length;E++)T=T.concat(v({array:o,arrayIndex:E,value:o[E],valueSpec:w,style:d,styleSpec:f,key:`${b}[${E}]`}));return T}function $c(a){const o=a.key,l=a.value,d=a.valueSpec;let f=Ki(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new pn(o,l,`number expected, ${f} found`)];if("minimum"in d){let b=d.minimum;if("array"===Ki(d.minimum)&&(b=d.minimum[a.arrayIndex]),l<b)return[new pn(o,l,`${l} is less than the minimum value ${b}`)]}if("maximum"in d){let b=d.maximum;if("array"===Ki(d.maximum)&&(b=d.maximum[a.arrayIndex]),l>b)return[new pn(o,l,`${l} is greater than the maximum value ${b}`)]}return[]}function Nd(a){const o=a.valueSpec,l=fo(a.value.type);let d,f,b,v={};const w="categorical"!==l&&void 0===a.value.property,T=!w,E="array"===Ki(a.value.stops)&&"array"===Ki(a.value.stops[0])&&"object"===Ki(a.value.stops[0][0]),k=fa({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(N){if("identity"===l)return[new pn(N.key,N.value,'identity function may not have a "stops" property')];let z=[];const G=N.value;return z=z.concat(eg({key:N.key,value:G,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:P})),"array"===Ki(G)&&0===G.length&&z.push(new pn(N.key,G,"array must have at least one stop")),z},default:function(N){return Pt({key:N.key,value:N.value,valueSpec:o,style:N.style,styleSpec:N.styleSpec})}}});return"identity"===l&&w&&k.push(new pn(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||k.push(new pn(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!hf(a.valueSpec)&&k.push(new pn(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(T&&!Pd(a.valueSpec)?k.push(new pn(a.key,a.value,"property functions not supported")):w&&!df(a.valueSpec)&&k.push(new pn(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!E||void 0!==a.value.property||k.push(new pn(a.key,a.value,'"property" property is required')),k;function P(N){let z=[];const G=N.value,ee=N.key;if("array"!==Ki(G))return[new pn(ee,G,`array expected, ${Ki(G)} found`)];if(2!==G.length)return[new pn(ee,G,`array length 2 expected, length ${G.length} found`)];if(E){if("object"!==Ki(G[0]))return[new pn(ee,G,`object expected, ${Ki(G[0])} found`)];if(void 0===G[0].zoom)return[new pn(ee,G,"object stop key must have zoom")];if(void 0===G[0].value)return[new pn(ee,G,"object stop key must have value")];const de=fo(G[0].zoom);if("number"!=typeof de)return[new pn(ee,G[0].zoom,"stop zoom values must be numbers")];if(b&&b>de)return[new pn(ee,G[0].zoom,"stop zoom values must appear in ascending order")];de!==b&&(b=de,f=void 0,v={}),z=z.concat(fa({key:`${ee}[0]`,value:G[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:$c,value:L}}))}else z=z.concat(L({key:`${ee}[0]`,value:G[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},G));return Fd(Oo(G[1]))?z.concat([new pn(`${ee}[1]`,G[1],"expressions are not allowed in function stops.")]):z.concat(Pt({key:`${ee}[1]`,value:G[1],valueSpec:o,style:N.style,styleSpec:N.styleSpec}))}function L(N,z){const G=Ki(N.value),ee=fo(N.value),de=null!==N.value?N.value:z;if(d){if(G!==d)return[new pn(N.key,de,`${G} stop domain type must match previous stop domain type ${d}`)]}else d=G;if("number"!==G&&"string"!==G&&"boolean"!==G&&"number"!=typeof ee&&"string"!=typeof ee&&"boolean"!=typeof ee)return[new pn(N.key,de,"stop domain value must be a number, string, or boolean")];if("number"!==G&&"categorical"!==l){let De=`number expected, ${G} found`;return Pd(o)&&void 0===l&&(De+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pn(N.key,de,De)]}return"categorical"!==l||"number"!==G||"number"==typeof ee&&isFinite(ee)&&Math.floor(ee)===ee?"categorical"!==l&&"number"===G&&"number"==typeof ee&&"number"==typeof f&&void 0!==f&&ee<f?[new pn(N.key,de,"stop domain values must appear in ascending order")]:(f=ee,"categorical"===l&&ee in v?[new pn(N.key,de,"stop domain values must be unique")]:(v[ee]=!0,[])):[new pn(N.key,de,`integer expected, found ${String(ee)}`)]}}function Dr(a){const o=("property"===a.expressionContext?Mu:pa)(Oo(a.value),a.valueSpec);if("error"===o.result)return o.value.map(d=>new pn(`${a.key}${d.key}`,a.value,d.message));const l=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new pn(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!ha(l))return[new pn(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return qc(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!Il(l,["zoom","feature-state"]))return[new pn(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!Gi(l))return[new pn(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qc(a,o){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const f of o.valueSpec.expression.parameters)l.delete(f);if(0===l.size)return[];const d=[];return a instanceof ol&&l.has(a.name)?[new pn(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(f=>{d.push(...qc(f,o))}),d)}function Kh(a){const o=a.key,l=a.value,d=a.valueSpec,f=[];return Array.isArray(d.values)?-1===d.values.indexOf(fo(l))&&f.push(new pn(o,l,`expected one of [${d.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(d.values).indexOf(fo(l))&&f.push(new pn(o,l,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function Bd(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!Bd(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function Qh(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Bd(a)||(a=ku(a));const l=a;let d=!0;try{d=function(E){if(!Au(E))return E;let k=Oo(E);return Kr(k),k=w_(k),k}(l)}catch(E){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const f=_t[`filter_${o}`],b=pa(d,f);let v=null;if("error"===b.result)throw new Error(b.value.map(E=>`${E.key}: ${E.message}`).join(", "));v=(E,k,P)=>b.value.evaluate(E,k,{},P);let w=null,T=null;if(d!==l){const E=pa(l,f);if("error"===E.result)throw new Error(E.value.map(k=>`${k.key}: ${k.message}`).join(", "));w=(k,P,L,N,z)=>E.value.evaluate(k,P,{},L,void 0,void 0,N,z),T=!Gi(E.value.expression)}return{filter:v,dynamicFilter:w||void 0,needGeometry:Ns(d),needFeature:!!T}}function w_(a){if(!Array.isArray(a))return a;const o=function(l){if(tg.has(l[0]))for(let d=1;d<l.length;d++)if(Au(l[d]))return!0;return l}(a);return!0===o?o:o.map(l=>w_(l))}function Kr(a){let o=!1;const l=[];if("case"===a[0]){for(let d=1;d<a.length-1;d+=2)o=o||Au(a[d]),l.push(a[d+1]);l.push(a[a.length-1])}else if("match"===a[0]){o=o||Au(a[1]);for(let d=2;d<a.length-1;d+=2)l.push(a[d+1]);l.push(a[a.length-1])}else if("step"===a[0]){o=o||Au(a[1]);for(let d=1;d<a.length-1;d+=2)l.push(a[d+1])}o&&(a.length=0,a.push("any",...l));for(let d=1;d<a.length;d++)Kr(a[d])}function Au(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<a.length;l++)if(Au(a[l]))return!0;return!1}const tg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Jh(a,o){return a<o?-1:a>o?1:0}function Ns(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(Ns(a[o]))return!0;return!1}function ku(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?zd(a[1],a[2],"=="):"!="===o?ep(zd(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?zd(a[1],a[2],o):"any"===o?(l=a.slice(1),["any"].concat(l.map(ku))):"all"===o?["all"].concat(a.slice(1).map(ku)):"none"===o?["all"].concat(a.slice(1).map(ku).map(ep)):"in"===o?rc(a[1],a.slice(2)):"!in"===o?ep(rc(a[1],a.slice(2))):"has"===o?Ss(a[1]):"!has"===o?ep(Ss(a[1])):"within"!==o||a;var l}function zd(a,o,l){switch(a){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,a,o]}}function rc(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",a,["literal",o.sort(Jh)]]:["filter-in-small",a,["literal",o]]}}function Ss(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ep(a){return["!",a]}function oc(a){return Bd(Oo(a.value))?Dr(El({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):Vd(a)}function Vd(a){const o=a.value,l=a.key;if("array"!==Ki(o))return[new pn(l,o,`array expected, ${Ki(o)} found`)];const d=a.styleSpec;let f,b=[];if(o.length<1)return[new pn(l,o,"filter array must have at least 1 element")];switch(b=b.concat(Kh({key:`${l}[0]`,value:o[0],valueSpec:d.filter_operator,style:a.style,styleSpec:a.styleSpec})),fo(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===fo(o[1])&&b.push(new pn(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&b.push(new pn(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(f=Ki(o[1]),"string"!==f&&b.push(new pn(`${l}[1]`,o[1],`string expected, ${f} found`)));for(let v=2;v<o.length;v++)f=Ki(o[v]),"$type"===fo(o[1])?b=b.concat(Kh({key:`${l}[${v}]`,value:o[v],valueSpec:d.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&b.push(new pn(`${l}[${v}]`,o[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<o.length;v++)b=b.concat(Vd({key:`${l}[${v}]`,value:o[v],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=Ki(o[1]),2!==o.length?b.push(new pn(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==f&&b.push(new pn(`${l}[1]`,o[1],`string expected, ${f} found`));break;case"within":f=Ki(o[1]),2!==o.length?b.push(new pn(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==f&&b.push(new pn(`${l}[1]`,o[1],`object expected, ${f} found`))}return b}function cl(a,o){const l=a.key,d=a.style,f=a.styleSpec,b=a.value,v=a.objectKey,w=f[`${o}_${a.layerType}`];if(!w)return[];const T=v.match(/^(.*)-transition$/);if("paint"===o&&T&&w[T[1]]&&w[T[1]].transition)return Pt({key:l,value:b,valueSpec:f.transition,style:d,styleSpec:f});const E=a.valueSpec||w[v];if(!E)return[new pn(l,b,`unknown property "${v}"`)];let k;if("string"===Ki(b)&&Pd(E)&&!E.tokens&&(k=/^{([^}]+)}$/.exec(b))){const L=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new pn(l,b,`"${v}" does not support interpolation syntax\nUse an identity property function instead: ${L}.`)]}const P=[];return"symbol"===a.layerType&&("text-field"===v&&d&&!d.glyphs&&P.push(new pn(l,b,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&Xh(Oo(b))&&"identity"===fo(b.type)&&P.push(new pn(l,b,'"text-font" does not support identity functions'))),P.concat(Pt({key:a.key,value:b,valueSpec:E,style:d,styleSpec:f,expressionContext:"property",propertyType:o,propertyKey:v}))}function gf(a){return cl(a,"paint")}function jd(a){return cl(a,"layout")}function pi(a){let o=[];const l=a.value,d=a.key,f=a.style,b=a.styleSpec;l.type||l.ref||o.push(new pn(d,l,'either "type" or "ref" is required'));let v=fo(l.type);const w=fo(l.ref);if(l.id){const T=fo(l.id);for(let E=0;E<a.arrayIndex;E++){const k=f.layers[E];fo(k.id)===T&&o.push(new pn(d,l.id,`duplicate layer id "${l.id}", previously used at line ${k.id.__line__}`))}}if("ref"in l){let T;["type","source","source-layer","filter","layout"].forEach(E=>{E in l&&o.push(new pn(d,l[E],`"${E}" is prohibited for ref layers`))}),f.layers.forEach(E=>{fo(E.id)===w&&(T=E)}),T?T.ref?o.push(new pn(d,l.ref,"ref cannot reference another ref layer")):v=fo(T.type):"string"==typeof w&&o.push(new pn(d,l.ref,`ref layer "${w}" not found`))}else if("background"!==v&&"sky"!==v)if(l.source){const T=f.sources&&f.sources[l.source],E=T&&fo(T.type);T?"vector"===E&&"raster"===v?o.push(new pn(d,l.source,`layer "${l.id}" requires a raster source`)):"raster"===E&&"raster"!==v?o.push(new pn(d,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==E||l["source-layer"]?"raster-dem"===E&&"hillshade"!==v?o.push(new pn(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===E&&T.lineMetrics||o.push(new pn(d,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new pn(d,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new pn(d,l.source,`source "${l.source}" not found`))}else o.push(new pn(d,l,'missing required property "source"'));return o=o.concat(fa({key:d,value:l,valueSpec:b.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pt({key:`${d}.type`,value:l.type,valueSpec:b.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:T=>oc(El({layerType:v},T)),layout:T=>fa({layer:l,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":E=>jd(El({layerType:v},E))}}),paint:T=>fa({layer:l,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":E=>gf(El({layerType:v},E))}})}})),o}function kl(a){const o=a.value,l=a.key,d=Ki(o);return"string"!==d?[new pn(l,o,`string expected, ${d} found`)]:[]}const S_={promoteId:function({key:a,value:o}){if("string"===Ki(o))return kl({key:a,value:o});{const l=[];for(const d in o)l.push(...kl({key:`${a}.${d}`,value:o[d]}));return l}}};function ng(a){const o=a.value,l=a.key,d=a.styleSpec,f=a.style;if(!o.type)return[new pn(l,o,'"type" is required')];const b=fo(o.type);let v;switch(b){case"vector":case"raster":case"raster-dem":return v=fa({key:l,value:o,valueSpec:d[`source_${b.replace("-","_")}`],style:a.style,styleSpec:d,objectElementValidators:S_}),v;case"geojson":if(v=fa({key:l,value:o,valueSpec:d.source_geojson,style:f,styleSpec:d,objectElementValidators:S_}),o.cluster)for(const w in o.clusterProperties){const[T,E]=o.clusterProperties[w],k="string"==typeof T?[T,["accumulated"],["get",w]]:T;v.push(...Dr({key:`${l}.${w}.map`,value:E,expressionContext:"cluster-map"})),v.push(...Dr({key:`${l}.${w}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return v;case"video":return fa({key:l,value:o,valueSpec:d.source_video,style:f,styleSpec:d});case"image":return fa({key:l,value:o,valueSpec:d.source_image,style:f,styleSpec:d});case"canvas":return[new pn(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kh({key:`${l}.type`,value:o.type,valueSpec:{values:C_(d)},style:f,styleSpec:d})}}function C_(a){return a.source.reduce((o,l)=>{const d=a[l];return"enum"===d.type.type&&(o=o.concat(Object.keys(d.type.values))),o},[])}function ig(a){const o=a.value,l=a.styleSpec,d=l.light,f=a.style;let b=[];const v=Ki(o);if(void 0===o)return b;if("object"!==v)return b=b.concat([new pn("light",o,`object expected, ${v} found`)]),b;for(const w in o){const T=w.match(/^(.*)-transition$/);b=b.concat(T&&d[T[1]]&&d[T[1]].transition?Pt({key:w,value:o[w],valueSpec:l.transition,style:f,styleSpec:l}):d[w]?Pt({key:w,value:o[w],valueSpec:d[w],style:f,styleSpec:l}):[new pn(w,o[w],`unknown property "${w}"`)])}return b}function tp(a){const o=a.value,l=a.key,d=a.style,f=a.styleSpec,b=f.terrain;let v=[];const w=Ki(o);if(void 0===o)return v;if("object"!==w)return v=v.concat([new pn("terrain",o,`object expected, ${w} found`)]),v;for(const T in o){const E=T.match(/^(.*)-transition$/);v=v.concat(E&&b[E[1]]&&b[E[1]].transition?Pt({key:T,value:o[T],valueSpec:f.transition,style:d,styleSpec:f}):b[T]?Pt({key:T,value:o[T],valueSpec:b[T],style:d,styleSpec:f}):[new pn(T,o[T],`unknown property "${T}"`)])}if(o.source){const T=d.sources&&d.sources[o.source],E=T&&fo(T.type);T?"raster-dem"!==E&&v.push(new pn(l,o.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):v.push(new pn(l,o.source,`source "${o.source}" not found`))}else v.push(new pn(l,o,'terrain is missing required property "source"'));return v}function rg(a){const o=a.value,l=a.style,d=a.styleSpec,f=d.fog;let b=[];const v=Ki(o);if(void 0===o)return b;if("object"!==v)return b=b.concat([new pn("fog",o,`object expected, ${v} found`)]),b;for(const w in o){const T=w.match(/^(.*)-transition$/);b=b.concat(T&&f[T[1]]&&f[T[1]].transition?Pt({key:w,value:o[w],valueSpec:d.transition,style:l,styleSpec:d}):f[w]?Pt({key:w,value:o[w],valueSpec:f[w],style:l,styleSpec:d}):[new pn(w,o[w],`unknown property "${w}"`)])}return b}const og={"*":()=>[],array:eg,boolean:function(a){const o=a.value,l=a.key,d=Ki(o);return"boolean"!==d?[new pn(l,o,`boolean expected, ${d} found`)]:[]},number:$c,color:function(a){const o=a.key,l=a.value,d=Ki(l);return"string"!==d?[new pn(o,l,`color expected, ${d} found`)]:null===nf(l)?[new pn(o,l,`color expected, "${l}" found`)]:[]},enum:Kh,filter:oc,function:Nd,layer:pi,object:fa,source:ng,light:ig,terrain:tp,fog:rg,string:kl,formatted:function(a){return 0===kl(a).length?[]:Dr(a)},resolvedImage:function(a){return 0===kl(a).length?[]:Dr(a)},projection:function(a){const o=a.value,l=a.styleSpec,d=l.projection,f=a.style;let b=[];const v=Ki(o);if("object"===v)for(const w in o)b=b.concat(Pt({key:w,value:o[w],valueSpec:d[w],style:f,styleSpec:l}));else"string"!==v&&(b=b.concat([new pn("projection",o,`object or string expected, ${v} found`)]));return b}};function Pt(a){const o=a.value,l=a.valueSpec,d=a.styleSpec;return l.expression&&Xh(fo(o))?Nd(a):l.expression&&Fd(Oo(o))?Dr(a):l.type&&og[l.type]?og[l.type](a):fa(El({},a,{valueSpec:l.type?d[l.type]:l}))}function ir(a){const o=a.value,l=a.key,d=kl(a);return d.length||(-1===o.indexOf("{fontstack}")&&d.push(new pn(l,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&d.push(new pn(l,o,'"glyphs" url must include a "{range}" token'))),d}function si(a,o=_t){return Zs(Pt({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:ir,"*":()=>[]}}))}const fi=a=>Zs(gf(a)),Io=a=>Zs(jd(a));function Zs(a){return a.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function Ru(a,o){let l=!1;if(o&&o.length)for(const d of o)a.fire(new il(new Error(d.message))),l=!0;return l}var ul=ma;function ma(a,o,l){var d=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],this.d=(o=f[1])+2*(l=f[2]);for(var b=0;b<this.d*this.d;b++){var v=f[3+b],w=f[3+b+1];d.push(v===w?null:f.subarray(v,w))}var T=f[3+d.length+1];this.keys=f.subarray(f[3+d.length],T),this.bboxes=f.subarray(T),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var E=0;E<this.d*this.d;E++)d.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=l,this.scale=o/a,this.uid=0;var k=l/o*a;this.min=-k,this.max=a+k}ma.prototype.insert=function(a,o,l,d,f){this._forEachCell(o,l,d,f,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(f)},ma.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ma.prototype._insertCell=function(a,o,l,d,f,b){this.cells[f].push(b)},ma.prototype.query=function(a,o,l,d,f){var b=this.min,v=this.max;if(a<=b&&o<=b&&v<=l&&v<=d&&!f)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(a,o,l,d,this._queryCell,w,{},f),w},ma.prototype._queryCell=function(a,o,l,d,f,b,v,w){var T=this.cells[f];if(null!==T)for(var E=this.keys,k=this.bboxes,P=0;P<T.length;P++){var L=T[P];if(void 0===v[L]){var N=4*L;(w?w(k[N+0],k[N+1],k[N+2],k[N+3]):a<=k[N+2]&&o<=k[N+3]&&l>=k[N+0]&&d>=k[N+1])?(v[L]=!0,b.push(E[L])):v[L]=!1}}},ma.prototype._forEachCell=function(a,o,l,d,f,b,v,w){for(var T=this._convertToCellCoord(a),E=this._convertToCellCoord(o),k=this._convertToCellCoord(l),P=this._convertToCellCoord(d),L=T;L<=k;L++)for(var N=E;N<=P;N++){var z=this.d*N+L;if((!w||w(this._convertFromCellCoord(L),this._convertFromCellCoord(N),this._convertFromCellCoord(L+1),this._convertFromCellCoord(N+1)))&&f.call(this,a,o,l,d,z,b,v,w))return}},ma.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},ma.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},ma.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=3+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var f=new Int32Array(o+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var b=o,v=0;v<a.length;v++){var w=a[v];f[3+v]=b,f.set(w,b),b+=w.length}return f[3+a.length]=b,f.set(this.keys,b),f[3+a.length+1]=b+=this.keys.length,f.set(this.bboxes,b),b+=this.bboxes.length,f.buffer};var Pu=vn(ul);const np={};function bn(a,o,l={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),np[o]={klass:a,omit:l.omit||[]}}bn(Object,"Object"),Pu.serialize=function(a,o){const l=a.toArrayBuffer();return o&&o.push(l),{buffer:l}},Pu.deserialize=function(a){return new Pu(a.buffer)},Object.defineProperty(Pu,"name",{value:"Grid"}),bn(Pu,"Grid"),bn(mo,"Color"),bn(Error,"Error"),bn(Yl,"AJAXError"),bn(Aa,"ResolvedImage"),bn(Zh,"StylePropertyFunction"),bn(ff,"StyleExpression",{omit:["_evaluator"]}),bn(hr,"ZoomDependentExpression"),bn(mf,"ZoomConstantExpression"),bn(ol,"CompoundExpression",{omit:["_evaluate"]});for(const a in Wh)np[Wh[a]._classRegistryKey]||bn(Wh[a],`Expression${a}`);function ip(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function $o(a){return ie.ImageBitmap&&a instanceof ie.ImageBitmap}function Bs(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(ip(a)||$o(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return o&&o.push(l.buffer),l}if(a instanceof ie.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const d of a)l.push(Bs(d,o));return l}if("object"==typeof a){const l=a.constructor,d=l._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${d}`);const f=l.serialize?l.serialize(a,o):{};if(!l.serialize){for(const b in a)a.hasOwnProperty(b)&&(np[d].omit.indexOf(b)>=0||(f[b]=Bs(a[b],o)));a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==d&&(f.$name=d),f}throw new Error("can't serialize object of type "+typeof a)}function sc(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||ip(a)||$o(a)||ArrayBuffer.isView(a)||a instanceof ie.ImageData)return a;if(Array.isArray(a))return a.map(sc);if("object"==typeof a){const o=a.$name||"Object",{klass:l}=np[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(a);const d=Object.create(l.prototype);for(const f of Object.keys(a))"$name"!==f&&(d[f]=sc(a[f]));return d}throw new Error("can't deserialize object of type "+typeof a)}const sn_Latin_1_Supplement=a=>a>=128&&a<=255,sn_Arabic=a=>a>=1536&&a<=1791,sn_Arabic_Supplement=a=>a>=1872&&a<=1919,sn_Arabic_Extended_A=a=>a>=2208&&a<=2303,sn_Hangul_Jamo=a=>a>=4352&&a<=4607,sn_Unified_Canadian_Aboriginal_Syllabics=a=>a>=5120&&a<=5759,sn_Khmer=a=>a>=6016&&a<=6143,sn_Unified_Canadian_Aboriginal_Syllabics_Extended=a=>a>=6320&&a<=6399,sn_General_Punctuation=a=>a>=8192&&a<=8303,sn_Letterlike_Symbols=a=>a>=8448&&a<=8527,sn_Number_Forms=a=>a>=8528&&a<=8591,sn_Miscellaneous_Technical=a=>a>=8960&&a<=9215,sn_Control_Pictures=a=>a>=9216&&a<=9279,sn_Optical_Character_Recognition=a=>a>=9280&&a<=9311,sn_Enclosed_Alphanumerics=a=>a>=9312&&a<=9471,sn_Geometric_Shapes=a=>a>=9632&&a<=9727,sn_Miscellaneous_Symbols=a=>a>=9728&&a<=9983,sn_Miscellaneous_Symbols_and_Arrows=a=>a>=11008&&a<=11263,sn_CJK_Radicals_Supplement=a=>a>=11904&&a<=12031,sn_Kangxi_Radicals=a=>a>=12032&&a<=12255,sn_Ideographic_Description_Characters=a=>a>=12272&&a<=12287,sn_CJK_Symbols_and_Punctuation=a=>a>=12288&&a<=12351,sn_Hiragana=a=>a>=12352&&a<=12447,sn_Katakana=a=>a>=12448&&a<=12543,sn_Bopomofo=a=>a>=12544&&a<=12591,sn_Hangul_Compatibility_Jamo=a=>a>=12592&&a<=12687,sn_Kanbun=a=>a>=12688&&a<=12703,sn_Bopomofo_Extended=a=>a>=12704&&a<=12735,sn_CJK_Strokes=a=>a>=12736&&a<=12783,sn_Katakana_Phonetic_Extensions=a=>a>=12784&&a<=12799,sn_Enclosed_CJK_Letters_and_Months=a=>a>=12800&&a<=13055,sn_CJK_Compatibility=a=>a>=13056&&a<=13311,sn_CJK_Unified_Ideographs_Extension_A=a=>a>=13312&&a<=19903,sn_Yijing_Hexagram_Symbols=a=>a>=19904&&a<=19967,sn_CJK_Unified_Ideographs=a=>a>=19968&&a<=40959,sn_Yi_Syllables=a=>a>=40960&&a<=42127,sn_Yi_Radicals=a=>a>=42128&&a<=42191,sn_Hangul_Jamo_Extended_A=a=>a>=43360&&a<=43391,sn_Hangul_Syllables=a=>a>=44032&&a<=55215,sn_Hangul_Jamo_Extended_B=a=>a>=55216&&a<=55295,sn_Private_Use_Area=a=>a>=57344&&a<=63743,sn_CJK_Compatibility_Ideographs=a=>a>=63744&&a<=64255,sn_Arabic_Presentation_Forms_A=a=>a>=64336&&a<=65023,sn_Vertical_Forms=a=>a>=65040&&a<=65055,sn_CJK_Compatibility_Forms=a=>a>=65072&&a<=65103,sn_Small_Form_Variants=a=>a>=65104&&a<=65135,sn_Arabic_Presentation_Forms_B=a=>a>=65136&&a<=65279,sn_Halfwidth_and_Fullwidth_Forms=a=>a>=65280&&a<=65519;function Na(a){for(const o of a)if(_f(o.charCodeAt(0)))return!0;return!1}function T_(a){for(const o of a)if(!bf(o.charCodeAt(0)))return!1;return!0}function bf(a){return!(sn_Arabic(a)||sn_Arabic_Supplement(a)||sn_Arabic_Extended_A(a)||sn_Arabic_Presentation_Forms_A(a)||sn_Arabic_Presentation_Forms_B(a))}function _f(a){return!(746!==a&&747!==a&&(a<4352||!(sn_Bopomofo_Extended(a)||sn_Bopomofo(a)||sn_CJK_Compatibility_Forms(a)&&!(a>=65097&&a<=65103)||sn_CJK_Compatibility_Ideographs(a)||sn_CJK_Compatibility(a)||sn_CJK_Radicals_Supplement(a)||sn_CJK_Strokes(a)||!(!sn_CJK_Symbols_and_Punctuation(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||sn_CJK_Unified_Ideographs_Extension_A(a)||sn_CJK_Unified_Ideographs(a)||sn_Enclosed_CJK_Letters_and_Months(a)||sn_Hangul_Compatibility_Jamo(a)||sn_Hangul_Jamo_Extended_A(a)||sn_Hangul_Jamo_Extended_B(a)||sn_Hangul_Jamo(a)||sn_Hangul_Syllables(a)||sn_Hiragana(a)||sn_Ideographic_Description_Characters(a)||sn_Kanbun(a)||sn_Kangxi_Radicals(a)||sn_Katakana_Phonetic_Extensions(a)||sn_Katakana(a)&&12540!==a||!(!sn_Halfwidth_and_Fullwidth_Forms(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!sn_Small_Form_Variants(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||sn_Unified_Canadian_Aboriginal_Syllabics(a)||sn_Unified_Canadian_Aboriginal_Syllabics_Extended(a)||sn_Vertical_Forms(a)||sn_Yijing_Hexagram_Symbols(a)||sn_Yi_Syllables(a)||sn_Yi_Radicals(a))))}function sg(a){return!(_f(a)||(o=a,sn_Latin_1_Supplement(o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||sn_General_Punctuation(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||sn_Letterlike_Symbols(o)||sn_Number_Forms(o)||sn_Miscellaneous_Technical(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||sn_Control_Pictures(o)&&9251!==o||sn_Optical_Character_Recognition(o)||sn_Enclosed_Alphanumerics(o)||sn_Geometric_Shapes(o)||sn_Miscellaneous_Symbols(o)&&!(o>=9754&&o<=9759)||sn_Miscellaneous_Symbols_and_Arrows(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||sn_CJK_Symbols_and_Punctuation(o)||sn_Katakana(o)||sn_Private_Use_Area(o)||sn_CJK_Compatibility_Forms(o)||sn_Small_Form_Variants(o)||sn_Halfwidth_and_Fullwidth_Forms(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function rp(a){return a>=1424&&a<=2303||sn_Arabic_Presentation_Forms_A(a)||sn_Arabic_Presentation_Forms_B(a)}function yf(a,o){return!(!o&&rp(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||sn_Khmer(a))}function ag(a){for(const o of a)if(rp(o.charCodeAt(0)))return!0;return!1}const Ud="deferred",vf="loading",op="loaded";let ac=null,g="unavailable",c=null;const h=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(g="error"),ac&&ac(a)};function _(){x.fire(new Fc("pluginStateChange",{pluginStatus:g,pluginURL:c}))}const x=new yu,S=function(){return g},D=function(){if(g!==Ud||!c)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");g=vf,_(),c&&bu({url:c},a=>{a?h(a):(g=op,_())})},M={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>g===op||null!=M.applyArabicShaping,isLoading:()=>g===vf,setState(a){g=a.pluginStatus,c=a.pluginURL},isParsed:()=>null!=M.applyArabicShaping&&null!=M.processBidirectionalText&&null!=M.processStyledBidirectionalText,getPluginURL:()=>c};class R{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(l,d){for(const f of l)if(!yf(f.charCodeAt(0),d))return!1;return!0}(o,M.isLoaded())}}class O{constructor(o,l){this.property=o,this.value=l,this.expression=function(d,f){if(Xh(d))return new Zh(d,f);if(Fd(d)){const b=Mu(d,f);if("error"===b.result)throw new Error(b.value.map(v=>`${v.key}: ${v.message}`).join(", "));return b.value}{let b=d;return"string"==typeof d&&"color"===f.type&&(b=mo.parse(d)),{kind:"constant",evaluate:()=>b}}}(void 0===l?o.specification.default:l,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,d){return this.property.possiblyEvaluate(this,o,l,d)}}class F{constructor(o){this.property=o,this.value=new O(o,void 0)}transitioned(o,l){return new J(this.property,this.value,l,Fi({},o.transition,this.transition),o.now)}untransitioned(){return new J(this.property,this.value,null,{},0)}}class U{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Je(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new F(this._values[o].property)),this._values[o].value=new O(this._values[o].property,null===l?void 0:Je(l))}getTransition(o){return Je(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new F(this._values[o].property)),this._values[o].transition=Je(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const d=this.getValue(l);void 0!==d&&(o[l]=d);const f=this.getTransition(l);void 0!==f&&(o[`${l}-transition`]=f)}return o}transitioned(o,l){const d=new ne(this._properties);for(const f of Object.keys(this._values))d._values[f]=this._values[f].transitioned(o,l._values[f]);return d}untransitioned(){const o=new ne(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class J{constructor(o,l,d,f,b){const v=f.delay||0,w=f.duration||0;b=b||0,this.property=o,this.value=l,this.begin=b+v,this.end=this.begin+w,o.specification.transition&&(f.delay||f.duration)&&(this.prior=d)}possiblyEvaluate(o,l,d){const f=o.now||0,b=this.value.possiblyEvaluate(o,l,d),v=this.prior;if(v){if(f>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(f<this.begin)return v.possiblyEvaluate(o,l,d);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(o,l,d),b,gt(w))}}return b}}class ne{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,d){const f=new ue(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,d);return f}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class le{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return Je(this._values[o].value)}setValue(o,l){this._values[o]=new O(this._values[o].property,null===l?void 0:Je(l))}serialize(){const o={};for(const l of Object.keys(this._values)){const d=this.getValue(l);void 0!==d&&(o[l]=d)}return o}possiblyEvaluate(o,l,d){const f=new ue(this._properties);for(const b of Object.keys(this._values))f._values[b]=this._values[b].possiblyEvaluate(o,l,d);return f}}class oe{constructor(o,l,d){this.property=o,this.value=l,this.parameters=d}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,d,f){return this.property.evaluate(this.value,this.parameters,o,l,d,f)}}class ue{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class ${constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,d){const f=wn[this.specification.type];return f?f(o,l,d):o}}class te{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,d,f){return new oe(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},d,f)}:o.expression,l)}interpolate(o,l,d){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new oe(this,{kind:"constant",value:void 0},o.parameters);const f=wn[this.specification.type];return f?new oe(this,{kind:"constant",value:f(o.value.value,l.value.value,d)},o.parameters):o}evaluate(o,l,d,f,b,v){return"constant"===o.kind?o.value:o.evaluate(l,d,f,b,v)}}class me{constructor(o){this.specification=o}possiblyEvaluate(o,l,d,f){return!!o.expression.evaluate(l,null,{},d,f)}interpolate(){return!1}}class _e{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new R(0,{});for(const d in o){const f=o[d];f.specification.overridable&&this.overridableProperties.push(d);const b=this.defaultPropertyValues[d]=new O(f,void 0),v=this.defaultTransitionablePropertyValues[d]=new F(f);this.defaultTransitioningPropertyValues[d]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=b.possiblyEvaluate(l)}}}function Be(a,o){return 256*(a=Dt(Math.floor(a),0,255))+Dt(Math.floor(o),0,255)}bn(te,"DataDrivenProperty"),bn($,"DataConstantProperty"),bn(me,"ColorRampProperty");const Fe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ne{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ze{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function qe(a,o=1){let l=0,d=0;return{members:a.map(f=>{const b=Fe[f.type].BYTES_PER_ELEMENT,v=l=ot(l,Math.max(o,b)),w=f.components||1;return d=Math.max(d,b),l+=b*w,{name:f.name,type:f.type,components:w,offset:v}}),size:ot(l,Math.max(d,o)),alignment:o}}function ot(a,o){return Math.ceil(a/o)*o}class Vt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const f=2*o;return this.int16[f+0]=l,this.int16[f+1]=d,o}}Vt.prototype.bytesPerElement=4,bn(Vt,"StructArrayLayout2i4");class nt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,d)}emplace(o,l,d,f){const b=3*o;return this.int16[b+0]=l,this.int16[b+1]=d,this.int16[b+2]=f,o}}nt.prototype.bytesPerElement=6,bn(nt,"StructArrayLayout3i6");class Tt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,d,f)}emplace(o,l,d,f,b){const v=4*o;return this.int16[v+0]=l,this.int16[v+1]=d,this.int16[v+2]=f,this.int16[v+3]=b,o}}Tt.prototype.bytesPerElement=8,bn(Tt,"StructArrayLayout4i8");class ht extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,f,b,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,d,f,b,v,w)}emplace(o,l,d,f,b,v,w,T){const E=6*o,k=12*o,P=3*o;return this.int16[E+0]=l,this.int16[E+1]=d,this.uint8[k+4]=f,this.uint8[k+5]=b,this.uint8[k+6]=v,this.uint8[k+7]=w,this.float32[P+2]=T,o}}ht.prototype.bytesPerElement=12,bn(ht,"StructArrayLayout2i4ub1f12");class jt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,d,f)}emplace(o,l,d,f,b){const v=4*o;return this.float32[v+0]=l,this.float32[v+1]=d,this.float32[v+2]=f,this.float32[v+3]=b,o}}jt.prototype.bytesPerElement=16,bn(jt,"StructArrayLayout4f16");class it extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,d,f,b)}emplace(o,l,d,f,b,v){const w=6*o,T=3*o;return this.uint16[w+0]=l,this.uint16[w+1]=d,this.uint16[w+2]=f,this.uint16[w+3]=b,this.float32[T+2]=v,o}}it.prototype.bytesPerElement=12,bn(it,"StructArrayLayout4ui1f12");class xt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,d,f)}emplace(o,l,d,f,b){const v=4*o;return this.uint16[v+0]=l,this.uint16[v+1]=d,this.uint16[v+2]=f,this.uint16[v+3]=b,o}}xt.prototype.bytesPerElement=8,bn(xt,"StructArrayLayout4ui8");class Ut extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,f,b,v){const w=this.length;return this.resize(w+1),this.emplace(w,o,l,d,f,b,v)}emplace(o,l,d,f,b,v,w){const T=6*o;return this.int16[T+0]=l,this.int16[T+1]=d,this.int16[T+2]=f,this.int16[T+3]=b,this.int16[T+4]=v,this.int16[T+5]=w,o}}Ut.prototype.bytesPerElement=12,bn(Ut,"StructArrayLayout6i12");class Rt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,f,b,v,w,T,E,k,P,L){const N=this.length;return this.resize(N+1),this.emplace(N,o,l,d,f,b,v,w,T,E,k,P,L)}emplace(o,l,d,f,b,v,w,T,E,k,P,L,N){const z=12*o;return this.int16[z+0]=l,this.int16[z+1]=d,this.int16[z+2]=f,this.int16[z+3]=b,this.uint16[z+4]=v,this.uint16[z+5]=w,this.uint16[z+6]=T,this.uint16[z+7]=E,this.int16[z+8]=k,this.int16[z+9]=P,this.int16[z+10]=L,this.int16[z+11]=N,o}}Rt.prototype.bytesPerElement=24,bn(Rt,"StructArrayLayout4i4ui4i24");class $t extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,f,b,v){const w=this.length;return this.resize(w+1),this.emplace(w,o,l,d,f,b,v)}emplace(o,l,d,f,b,v,w){const T=10*o,E=5*o;return this.int16[T+0]=l,this.int16[T+1]=d,this.int16[T+2]=f,this.float32[E+2]=b,this.float32[E+3]=v,this.float32[E+4]=w,o}}$t.prototype.bytesPerElement=20,bn($t,"StructArrayLayout3i3f20");class Mn extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}Mn.prototype.bytesPerElement=4,bn(Mn,"StructArrayLayout1ul4");class jn extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,f,b,v,w,T,E,k,P,L,N){const z=this.length;return this.resize(z+1),this.emplace(z,o,l,d,f,b,v,w,T,E,k,P,L,N)}emplace(o,l,d,f,b,v,w,T,E,k,P,L,N,z){const G=20*o,ee=10*o;return this.int16[G+0]=l,this.int16[G+1]=d,this.int16[G+2]=f,this.int16[G+3]=b,this.int16[G+4]=v,this.float32[ee+3]=w,this.float32[ee+4]=T,this.float32[ee+5]=E,this.float32[ee+6]=k,this.int16[G+14]=P,this.uint32[ee+8]=L,this.uint16[G+18]=N,this.uint16[G+19]=z,o}}jn.prototype.bytesPerElement=40,bn(jn,"StructArrayLayout5i4f1i1ul2ui40");class _n extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,f,b,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,d,f,b,v,w)}emplace(o,l,d,f,b,v,w,T){const E=8*o;return this.int16[E+0]=l,this.int16[E+1]=d,this.int16[E+2]=f,this.int16[E+4]=b,this.int16[E+5]=v,this.int16[E+6]=w,this.int16[E+7]=T,o}}_n.prototype.bytesPerElement=16,bn(_n,"StructArrayLayout3i2i2i16");class Rn extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,d,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,d,f,b)}emplace(o,l,d,f,b,v){const w=4*o,T=8*o;return this.float32[w+0]=l,this.float32[w+1]=d,this.float32[w+2]=f,this.int16[T+6]=b,this.int16[T+7]=v,o}}Rn.prototype.bytesPerElement=16,bn(Rn,"StructArrayLayout2f1f2i16");class _i extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,d,f)}emplace(o,l,d,f,b){const v=12*o,w=3*o;return this.uint8[v+0]=l,this.uint8[v+1]=d,this.float32[w+1]=f,this.float32[w+2]=b,o}}_i.prototype.bytesPerElement=12,bn(_i,"StructArrayLayout2ub2f12");class ai extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,d)}emplace(o,l,d,f){const b=3*o;return this.float32[b+0]=l,this.float32[b+1]=d,this.float32[b+2]=f,o}}ai.prototype.bytesPerElement=12,bn(ai,"StructArrayLayout3f12");class Dn extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,d)}emplace(o,l,d,f){const b=3*o;return this.uint16[b+0]=l,this.uint16[b+1]=d,this.uint16[b+2]=f,o}}Dn.prototype.bytesPerElement=6,bn(Dn,"StructArrayLayout3ui6");class rr extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,f,b,v,w,T,E,k,P,L,N,z,G,ee,de,De,he,we,Re){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,o,l,d,f,b,v,w,T,E,k,P,L,N,z,G,ee,de,De,he,we,Re)}emplace(o,l,d,f,b,v,w,T,E,k,P,L,N,z,G,ee,de,De,he,we,Re,Pe){const at=30*o,rt=15*o,yt=60*o;return this.int16[at+0]=l,this.int16[at+1]=d,this.int16[at+2]=f,this.float32[rt+2]=b,this.float32[rt+3]=v,this.uint16[at+8]=w,this.uint16[at+9]=T,this.uint32[rt+5]=E,this.uint32[rt+6]=k,this.uint32[rt+7]=P,this.uint16[at+16]=L,this.uint16[at+17]=N,this.uint16[at+18]=z,this.float32[rt+10]=G,this.float32[rt+11]=ee,this.uint8[yt+48]=de,this.uint8[yt+49]=De,this.uint8[yt+50]=he,this.uint32[rt+13]=we,this.int16[at+28]=Re,this.uint8[yt+58]=Pe,o}}rr.prototype.bytesPerElement=60,bn(rr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class gr extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,d,f,b,v,w,T,E,k,P,L,N,z,G,ee,de,De,he,we,Re,Pe,at,rt,yt,Ht,dt,Mt,Et,Ot){const Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,o,l,d,f,b,v,w,T,E,k,P,L,N,z,G,ee,de,De,he,we,Re,Pe,at,rt,yt,Ht,dt,Mt,Et,Ot)}emplace(o,l,d,f,b,v,w,T,E,k,P,L,N,z,G,ee,de,De,he,we,Re,Pe,at,rt,yt,Ht,dt,Mt,Et,Ot,Wt){const mt=38*o,an=19*o;return this.int16[mt+0]=l,this.int16[mt+1]=d,this.int16[mt+2]=f,this.float32[an+2]=b,this.float32[an+3]=v,this.int16[mt+8]=w,this.int16[mt+9]=T,this.int16[mt+10]=E,this.int16[mt+11]=k,this.int16[mt+12]=P,this.int16[mt+13]=L,this.uint16[mt+14]=N,this.uint16[mt+15]=z,this.uint16[mt+16]=G,this.uint16[mt+17]=ee,this.uint16[mt+18]=de,this.uint16[mt+19]=De,this.uint16[mt+20]=he,this.uint16[mt+21]=we,this.uint16[mt+22]=Re,this.uint16[mt+23]=Pe,this.uint16[mt+24]=at,this.uint16[mt+25]=rt,this.uint16[mt+26]=yt,this.uint16[mt+27]=Ht,this.uint16[mt+28]=dt,this.uint32[an+15]=Mt,this.float32[an+16]=Et,this.float32[an+17]=Ot,this.float32[an+18]=Wt,o}}gr.prototype.bytesPerElement=76,bn(gr,"StructArrayLayout3i2f6i15ui1ul3f76");class vr extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}vr.prototype.bytesPerElement=4,bn(vr,"StructArrayLayout1f4");class Pi extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,d,f,b){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,d,f,b)}emplace(o,l,d,f,b,v){const w=5*o;return this.float32[w+0]=l,this.float32[w+1]=d,this.float32[w+2]=f,this.float32[w+3]=b,this.float32[w+4]=v,o}}Pi.prototype.bytesPerElement=20,bn(Pi,"StructArrayLayout5f20");class ss extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,d,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,d,f)}emplace(o,l,d,f,b){const v=6*o;return this.uint32[3*o+0]=l,this.uint16[v+2]=d,this.uint16[v+3]=f,this.uint16[v+4]=b,o}}ss.prototype.bytesPerElement=12,bn(ss,"StructArrayLayout1ul3ui12");class ao extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const f=2*o;return this.uint16[f+0]=l,this.uint16[f+1]=d,o}}ao.prototype.bytesPerElement=4,bn(ao,"StructArrayLayout2ui4");class zs extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}zs.prototype.bytesPerElement=2,bn(zs,"StructArrayLayout1ui2");class ga extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const d=this.length;return this.resize(d+1),this.emplace(d,o,l)}emplace(o,l,d){const f=2*o;return this.float32[f+0]=l,this.float32[f+1]=d,o}}ga.prototype.bytesPerElement=8,bn(ga,"StructArrayLayout2f8");class Ir extends Ne{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ir.prototype.size=40;class ar extends jn{get(o){return new Ir(this,o)}}bn(ar,"CollisionBoxArray");class Qi extends Ne{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}Qi.prototype.size=60;class lo extends rr{get(o){return new Qi(this,o)}}bn(lo,"PlacedSymbolArray");class as extends Ne{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}as.prototype.size=76;class Rr extends gr{get(o){return new as(this,o)}}bn(Rr,"SymbolInstanceArray");class Cs extends vr{getoffsetX(o){return this.float32[1*o+0]}}bn(Cs,"GlyphOffsetArray");class sp extends Vt{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}bn(sp,"SymbolLineVertexArray");class dl extends Ne{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}dl.prototype.size=12;class Rl extends ss{get(o){return new dl(this,o)}}bn(Rl,"FeatureIndexArray");class Pl extends ao{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}bn(Pl,"FillExtrusionCentroidArray");const Ll=qe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),lc=qe([{name:"a_dash",components:4,type:"Uint16"}]);var Ol={exports:{}},Jv=function(a,o){var l,d,f,b,v,w,T,E;for(d=a.length-(l=3&a.length),f=o,v=3432918353,w=461845907,E=0;E<d;)T=255&a.charCodeAt(E)|(255&a.charCodeAt(++E))<<8|(255&a.charCodeAt(++E))<<16|(255&a.charCodeAt(++E))<<24,++E,f=27492+(65535&(b=5*(65535&(f=(f^=T=(65535&(T=(T=(65535&T)*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(T=0,l){case 3:T^=(255&a.charCodeAt(E+2))<<16;case 2:T^=(255&a.charCodeAt(E+1))<<8;case 1:f^=T=(65535&(T=(T=(65535&(T^=255&a.charCodeAt(E)))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return f^=a.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0},e0=function(a,o){for(var l,d=a.length,f=o^d,b=0;d>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++b;switch(d){case 3:f^=(255&a.charCodeAt(b+2))<<16;case 2:f^=(255&a.charCodeAt(b+1))<<8;case 1:f=1540483477*(65535&(f^=255&a.charCodeAt(b)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};Ol.exports=Jv,Ol.exports.murmur3=Jv,Ol.exports.murmur2=e0;var qo=vn(Ol.exports);class Gc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,l,d,f){this.ids.push($d(o)),this.positions.push(l,d,f)}getPositions(o){const l=$d(o);let d=0,f=this.ids.length-1;for(;d<f;){const v=d+f>>1;this.ids[v]>=l?f=v:d=v+1}const b=[];for(;this.ids[d]===l;)b.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return b}static serialize(o,l){const d=new Float64Array(o.ids),f=new Uint32Array(o.positions);return Lu(d,f,0,d.length-1),l&&l.push(d.buffer,f.buffer),{ids:d,positions:f}}static deserialize(o){const l=new Gc;return l.ids=o.ids,l.positions=o.positions,l.indexed=!0,l}}function $d(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:qo(String(a))}function Lu(a,o,l,d){for(;l<d;){const f=a[l+d>>1];let b=l-1,v=d+1;for(;;){do{b++}while(a[b]<f);do{v--}while(a[v]>f);if(b>=v)break;xf(a,b,v),xf(o,3*b,3*v),xf(o,3*b+1,3*v+1),xf(o,3*b+2,3*v+2)}v-l<d-v?(Lu(a,o,l,v),l=v+1):(Lu(a,o,v+1,d),d=v)}}function xf(a,o,l){const d=a[o];a[o]=a[l],a[l]=d}bn(Gc,"FeaturePositionMap");class Fl{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}}class Wc extends Fl{constructor(o){super(o),this.current=0}set(o,l,d){this.fetchUniformLocation(o,l)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class a1 extends Fl{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,d){this.fetchUniformLocation(o,l)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class t0 extends Fl{constructor(o){super(o),this.current=mo.transparent}set(o,l,d){this.fetchUniformLocation(o,l)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const It=new Float32Array(16),BI=new Float32Array(9),zI=new Float32Array(4);function n0(a){return[Be(255*a.r,255*a.g),Be(255*a.b,255*a.a)]}class cg{constructor(o,l,d){this.value=o,this.uniformNames=l.map(f=>`u_${f}`),this.type=d}setUniform(o,l,d,f,b){l.set(o,b,f.constantOr(this.value))}getBinding(o,l){return"color"===this.type?new t0(o):new Wc(o)}}class wf{constructor(o,l){this.uniformNames=l.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,d,f,b){const v="u_pattern"===b||"u_dash"===b?this.pattern:"u_pixel_ratio"===b?this.pixelRatio:null;v&&l.set(o,b,v)}getBinding(o,l){return"u_pattern"===l||"u_dash"===l?new a1(o):new Wc(o)}}class Ou{constructor(o,l,d,f){this.expression=o,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===d?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(o,l,d,f,b,v){const w=this.paintVertexArray.length,T=this.expression.evaluate(new R(0),l,{},b,f,v);this.paintVertexArray.resize(o),this._setPaintValue(w,o,T)}updatePaintArray(o,l,d,f,b){const v=this.expression.evaluate({zoom:0},d,f,void 0,b);this._setPaintValue(o,l,v)}_setPaintValue(o,l,d){if("color"===this.type){const f=n0(d);for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,f[0],f[1])}else{for(let f=o;f<l;f++)this.paintVertexArray.emplace(f,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cc{constructor(o,l,d,f,b,v){this.expression=o,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=d,this.useIntegerZoom=f,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===d?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(o,l,d,f,b,v){const w=this.expression.evaluate(new R(this.zoom),l,{},b,f,v),T=this.expression.evaluate(new R(this.zoom+1),l,{},b,f,v),E=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(E,o,w,T)}updatePaintArray(o,l,d,f,b){const v=this.expression.evaluate({zoom:this.zoom},d,f,void 0,b),w=this.expression.evaluate({zoom:this.zoom+1},d,f,void 0,b);this._setPaintValue(o,l,v,w)}_setPaintValue(o,l,d,f){if("color"===this.type){const b=n0(d),v=n0(f);for(let w=o;w<l;w++)this.paintVertexArray.emplace(w,b[0],b[1],v[0],v[1])}else{for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,d,f);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,d,f,b){const v=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,w=Dt(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);l.set(o,b,w)}getBinding(o,l){return new Wc(o)}}class hl{constructor(o,l,d,f,b){this.expression=o,this.layerId=b,this.paintVertexAttributes=("array"===d?lc:Ll).members;for(let v=0;v<l.length;++v);this.paintVertexArray=new f}populatePaintArray(o,l,d){const f=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(f,o,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(o,l,d,f,b,v){this._setPaintValues(o,l,d.patterns&&d.patterns[this.layerId],v)}_setPaintValues(o,l,d,f){if(!f||!d)return;const b=f[d];if(!b)return;const{tl:v,br:w,pixelRatio:T}=b;for(let E=o;E<l;E++)this.paintVertexArray.emplace(E,v[0],v[1],w[0],w[1],T)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qd{constructor(o,l,d=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const b in o.paint._values){if(!d(b))continue;const v=o.paint.get(b);if(!(v instanceof oe&&Pd(v.property.specification)))continue;const w=E_(b,o.type),T=v.value,E=v.property.specification.type,k=!!v.property.useIntegerZoom,P="line-dasharray"===b||b.endsWith("pattern"),L="line-dasharray"===b&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==T.kind||L)if("source"===T.kind||L||P){const N=r0(b,E,"source");this.binders[b]=P?new hl(T,w,E,N,o.id):new Ou(T,w,E,N),f.push(`/a_${b}`)}else{const N=r0(b,E,"composite");this.binders[b]=new cc(T,w,E,k,l,N),f.push(`/z_${b}`)}else this.binders[b]=P?new wf(T.value,w):new cg(T.value,w,E),f.push(`/u_${b}`)}this.cacheKey=f.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof Ou||l instanceof cc?l.maxValue:0}populatePaintArrays(o,l,d,f,b,v){for(const w in this.binders){const T=this.binders[w];(T instanceof Ou||T instanceof cc||T instanceof hl)&&T.populatePaintArray(o,l,d,f,b,v)}}setConstantPatternPositions(o){for(const l in this.binders){const d=this.binders[l];d instanceof wf&&d.setConstantPatternPositions(o)}}updatePaintArrays(o,l,d,f,b,v){let w=!1;for(const T in o){const E=l.getPositions(T);for(const k of E){const P=d.feature(k.index);for(const L in this.binders){const N=this.binders[L];if((N instanceof Ou||N instanceof cc||N instanceof hl)&&!0===N.expression.isStateDependent){const z=f.paint.get(L);N.expression=z.value,N.updatePaintArray(k.start,k.end,P,o[T],b,v),w=!0}}}}return w}defines(){const o=[];for(const l in this.binders){const d=this.binders[l];(d instanceof cg||d instanceof wf)&&o.push(...d.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Ou||d instanceof cc||d instanceof hl)for(let f=0;f<d.paintVertexAttributes.length;f++)o.push(d.paintVertexAttributes[f].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof cg||d instanceof wf||d instanceof cc)for(const f of d.uniformNames)o.push(f)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const d in this.binders){const f=this.binders[d];if(f instanceof cg||f instanceof wf||f instanceof cc)for(const b of f.uniformNames)l.push({name:b,property:d,binding:f.getBinding(o,b)})}return l}setUniforms(o,l,d,f,b){for(const{name:v,property:w,binding:T}of d)this.binders[w].setUniform(o,T,b,f.get(w),v)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof Ou||l instanceof cc||l instanceof hl)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(const l in this.binders){const d=this.binders[l];(d instanceof Ou||d instanceof cc||d instanceof hl)&&d.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof Ou||l instanceof cc||l instanceof hl)&&l.destroy()}}}class ap{constructor(o,l,d=(()=>!0)){this.programConfigurations={};for(const f of o)this.programConfigurations[f.id]=new qd(f,l,d);this.needsUpload=!1,this._featureMap=new Gc,this._bufferOffset=0}populatePaintArrays(o,l,d,f,b,v,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(o,l,f,b,v,w);void 0!==l.id&&this._featureMap.add(l.id,d,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,d,f,b){for(const v of d)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(o,this._featureMap,l,v,f,b)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const Go={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function E_(a,o){return Go[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const Sf={"line-pattern":{source:it,composite:it},"fill-pattern":{source:it,composite:it},"fill-extrusion-pattern":{source:it,composite:it},"line-dasharray":{source:xt,composite:xt}},VI={color:{source:ga,composite:jt},number:{source:vr,composite:ga}};function r0(a,o,l){const d=Sf[a];return d&&d[l]||VI[o][l]}bn(cg,"ConstantBinder"),bn(wf,"PatternConstantBinder"),bn(Ou,"SourceExpressionBinder"),bn(hl,"PatternCompositeBinder"),bn(cc,"CompositeExpressionBinder"),bn(qd,"ProgramConfiguration",{omit:["_buffers"]}),bn(ap,"ProgramConfigurationSet");const ba="-transition";class Wo extends yu{constructor(o,l){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),l.layout&&(this._unevaluatedLayout=new le(l.layout)),l.paint)){this._transitionablePaint=new U(l.paint);for(const d in o.paint)this.setPaintProperty(d,o.paint[d],{validate:!1});for(const d in o.layout)this.setLayoutProperty(d,o.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ue(l.paint)}}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l,d={}){null!=l&&this._validate(Io,`layers.${this.id}.layout.${o}`,o,l,d)||("visibility"!==o?this._unevaluatedLayout.setValue(o,l):this.visibility=l)}getPaintProperty(o){return ge(o,ba)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l,d={}){if(null!=l&&this._validate(fi,`layers.${this.id}.paint.${o}`,o,l,d))return!1;if(ge(o,ba))return this._transitionablePaint.setTransition(o.slice(0,-11),l||void 0),!1;{const f=this._transitionablePaint._values[o],b=f.value.isDataDriven(),v=f.value;this._transitionablePaint.setValue(o,l),this._handleSpecialPaintPropertyUpdate(o);const w=this._transitionablePaint._values[o].value,T=w.isDataDriven(),E=ge(o,"pattern")||"line-dasharray"===o;return T||b||E||this._handleOverridablePaintPropertyUpdate(o,v,w)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,l,d){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Nt(o,(l,d)=>!(void 0===l||"layout"===d&&!Object.keys(l).length||"paint"===d&&!Object.keys(l).length))}_validate(o,l,d,f,b={}){return(!b||!1!==b.validate)&&Ru(this,o.call(si,{key:l,layerType:this.type,objectKey:d,value:f,styleSpec:_t,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof oe&&Pd(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Qh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const o0=qe([{name:"a_pos",components:2,type:"Int16"}],4),ug=qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $r{constructor(o=[]){this.segments=o}prepareSegment(o,l,d,f){let b=this.segments[this.segments.length-1];return o>$r.MAX_VERTEX_ARRAY_LENGTH&&Jn(`Max vertices per segment is ${$r.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!b||b.vertexLength+o>$r.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==f)&&(b={vertexOffset:l.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},void 0!==f&&(b.sortKey=f),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,d,f){return new $r([{vertexOffset:o,primitiveOffset:l,vertexLength:d,primitiveLength:f,vaos:{},sortKey:0}])}}$r.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bn($r,"SegmentVector");var On=8192;class Fu{constructor(o,l){o&&(l?this.setSouthWest(o).setNorthEast(l):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof xr?new xr(o.lng,o.lat):xr.convert(o),this}setSouthWest(o){return this._sw=o instanceof xr?new xr(o.lng,o.lat):xr.convert(o),this}extend(o){const l=this._sw,d=this._ne;let f,b;if(o instanceof xr)f=o,b=o;else{if(!(o instanceof Fu))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(Fu.convert(o)):this.extend(xr.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(xr.convert(o)):this;if(f=o._sw,b=o._ne,!f||!b)return this}return l||d?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),d.lng=Math.max(b.lng,d.lng),d.lat=Math.max(b.lat,d.lat)):(this._sw=new xr(f.lng,f.lat),this._ne=new xr(b.lng,b.lat)),this}getCenter(){return new xr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new xr(this.getWest(),this.getNorth())}getSouthEast(){return new xr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:d}=xr.convert(o);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&f}static convert(o){return!o||o instanceof Fu?o:new Fu(o)}}var dg=1e-6,Ba="undefined"!=typeof Float32Array?Float32Array:Array;function l1(){var a=new Ba(9);return Ba!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function D_(a,o,l){var d=o[0],f=o[1],b=o[2],v=o[3],w=o[4],T=o[5],E=o[6],k=o[7],P=o[8],L=l[0],N=l[1],z=l[2],G=l[3],ee=l[4],de=l[5],De=l[6],he=l[7],we=l[8];return a[0]=L*d+N*v+z*E,a[1]=L*f+N*w+z*k,a[2]=L*b+N*T+z*P,a[3]=G*d+ee*v+de*E,a[4]=G*f+ee*w+de*k,a[5]=G*b+ee*T+de*P,a[6]=De*d+he*v+we*E,a[7]=De*f+he*w+we*k,a[8]=De*b+he*T+we*P,a}function go(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Cf(a,o){var l=o[0],d=o[1],f=o[2],b=o[3],v=o[4],w=o[5],T=o[6],E=o[7],k=o[8],P=o[9],L=o[10],N=o[11],z=o[12],G=o[13],ee=o[14],de=o[15],De=l*w-d*v,he=l*T-f*v,we=l*E-b*v,Re=d*T-f*w,Pe=d*E-b*w,at=f*E-b*T,rt=k*G-P*z,yt=k*ee-L*z,Ht=k*de-N*z,dt=P*ee-L*G,Mt=P*de-N*G,Et=L*de-N*ee,Ot=De*Et-he*Mt+we*dt+Re*Ht-Pe*yt+at*rt;return Ot?(a[0]=(w*Et-T*Mt+E*dt)*(Ot=1/Ot),a[1]=(f*Mt-d*Et-b*dt)*Ot,a[2]=(G*at-ee*Pe+de*Re)*Ot,a[3]=(L*Pe-P*at-N*Re)*Ot,a[4]=(T*Ht-v*Et-E*yt)*Ot,a[5]=(l*Et-f*Ht+b*yt)*Ot,a[6]=(ee*we-z*at-de*he)*Ot,a[7]=(k*at-L*we+N*he)*Ot,a[8]=(v*Mt-w*Ht+E*rt)*Ot,a[9]=(d*Ht-l*Mt-b*rt)*Ot,a[10]=(z*Pe-G*we+de*De)*Ot,a[11]=(P*we-k*Pe-N*De)*Ot,a[12]=(w*yt-v*dt-T*rt)*Ot,a[13]=(l*dt-d*yt+f*rt)*Ot,a[14]=(G*he-z*Re-ee*De)*Ot,a[15]=(k*Re-P*he+L*De)*Ot,a):null}function pl(a,o,l){var d=o[0],f=o[1],b=o[2],v=o[3],w=o[4],T=o[5],E=o[6],k=o[7],P=o[8],L=o[9],N=o[10],z=o[11],G=o[12],ee=o[13],de=o[14],De=o[15],he=l[0],we=l[1],Re=l[2],Pe=l[3];return a[0]=he*d+we*w+Re*P+Pe*G,a[1]=he*f+we*T+Re*L+Pe*ee,a[2]=he*b+we*E+Re*N+Pe*de,a[3]=he*v+we*k+Re*z+Pe*De,a[4]=(he=l[4])*d+(we=l[5])*w+(Re=l[6])*P+(Pe=l[7])*G,a[5]=he*f+we*T+Re*L+Pe*ee,a[6]=he*b+we*E+Re*N+Pe*de,a[7]=he*v+we*k+Re*z+Pe*De,a[8]=(he=l[8])*d+(we=l[9])*w+(Re=l[10])*P+(Pe=l[11])*G,a[9]=he*f+we*T+Re*L+Pe*ee,a[10]=he*b+we*E+Re*N+Pe*de,a[11]=he*v+we*k+Re*z+Pe*De,a[12]=(he=l[12])*d+(we=l[13])*w+(Re=l[14])*P+(Pe=l[15])*G,a[13]=he*f+we*T+Re*L+Pe*ee,a[14]=he*b+we*E+Re*N+Pe*de,a[15]=he*v+we*k+Re*z+Pe*De,a}function hg(a,o,l){var d,f,b,v,w,T,E,k,P,L,N,z,G=l[0],ee=l[1],de=l[2];return o===a?(a[12]=o[0]*G+o[4]*ee+o[8]*de+o[12],a[13]=o[1]*G+o[5]*ee+o[9]*de+o[13],a[14]=o[2]*G+o[6]*ee+o[10]*de+o[14],a[15]=o[3]*G+o[7]*ee+o[11]*de+o[15]):(f=o[1],b=o[2],v=o[3],w=o[4],T=o[5],E=o[6],k=o[7],P=o[8],L=o[9],N=o[10],z=o[11],a[0]=d=o[0],a[1]=f,a[2]=b,a[3]=v,a[4]=w,a[5]=T,a[6]=E,a[7]=k,a[8]=P,a[9]=L,a[10]=N,a[11]=z,a[12]=d*G+w*ee+P*de+o[12],a[13]=f*G+T*ee+L*de+o[13],a[14]=b*G+E*ee+N*de+o[14],a[15]=v*G+k*ee+z*de+o[15]),a}function Nu(a,o,l){var d=l[0],f=l[1],b=l[2];return a[0]=o[0]*d,a[1]=o[1]*d,a[2]=o[2]*d,a[3]=o[3]*d,a[4]=o[4]*f,a[5]=o[5]*f,a[6]=o[6]*f,a[7]=o[7]*f,a[8]=o[8]*b,a[9]=o[9]*b,a[10]=o[10]*b,a[11]=o[11]*b,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function I_(a,o,l){var d=Math.sin(l),f=Math.cos(l),b=o[4],v=o[5],w=o[6],T=o[7],E=o[8],k=o[9],P=o[10],L=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=b*f+E*d,a[5]=v*f+k*d,a[6]=w*f+P*d,a[7]=T*f+L*d,a[8]=E*f-b*d,a[9]=k*f-v*d,a[10]=P*f-w*d,a[11]=L*f-T*d,a}function pg(a,o,l){var d=Math.sin(l),f=Math.cos(l),b=o[0],v=o[1],w=o[2],T=o[3],E=o[8],k=o[9],P=o[10],L=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f-E*d,a[1]=v*f-k*d,a[2]=w*f-P*d,a[3]=T*f-L*d,a[8]=b*d+E*f,a[9]=v*d+k*f,a[10]=w*d+P*f,a[11]=T*d+L*f,a}function s0(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function a0(a,o,l){var d,f,b,v=l[0],w=l[1],T=l[2],E=Math.hypot(v,w,T);return E<dg?null:(v*=E=1/E,w*=E,T*=E,d=Math.sin(o),f=Math.cos(o),a[0]=v*v*(b=1-f)+f,a[1]=w*v*b+T*d,a[2]=T*v*b-w*d,a[3]=0,a[4]=v*w*b-T*d,a[5]=w*w*b+f,a[6]=T*w*b+v*d,a[7]=0,a[8]=v*T*b+w*d,a[9]=w*T*b-v*d,a[10]=T*T*b+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var c1=pl;function M_(){var a=new Ba(3);return Ba!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function fg(a){var o=new Ba(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function Bu(a){return Math.hypot(a[0],a[1],a[2])}function Tf(a,o,l){var d=new Ba(3);return d[0]=a,d[1]=o,d[2]=l,d}function za(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a}function Ef(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a}function Df(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a}function If(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a}function Mf(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a}function Va(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a}function lp(a,o,l,d){return a[0]=o[0]+l[0]*d,a[1]=o[1]+l[1]*d,a[2]=o[2]+l[2]*d,a}function Fo(a,o){var l=o[0],d=o[1],f=o[2],b=l*l+d*d+f*f;return b>0&&(b=1/Math.sqrt(b)),a[0]=o[0]*b,a[1]=o[1]*b,a[2]=o[2]*b,a}function Ts(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function A_(a,o,l){var d=o[0],f=o[1],b=o[2],v=l[0],w=l[1],T=l[2];return a[0]=f*T-b*w,a[1]=b*v-d*T,a[2]=d*w-f*v,a}function je(a,o,l){var d=o[0],f=o[1],b=o[2],v=l[3]*d+l[7]*f+l[11]*b+l[15];return a[0]=(l[0]*d+l[4]*f+l[8]*b+l[12])/(v=v||1),a[1]=(l[1]*d+l[5]*f+l[9]*b+l[13])/v,a[2]=(l[2]*d+l[6]*f+l[10]*b+l[14])/v,a}function k_(a,o,l){var d=l[0],f=l[1],b=l[2],v=o[0],w=o[1],T=o[2],E=f*T-b*w,k=b*v-d*T,P=d*w-f*v,L=f*P-b*k,N=b*E-d*P,z=d*k-f*E,G=2*l[3];return k*=G,P*=G,N*=2,z*=2,a[0]=v+(E*=G)+(L*=2),a[1]=w+k+N,a[2]=T+P+z,a}var Fr,ja=Ef,Af=Df,u1=Bu;function l0(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a}function c0(a,o){var l=o[0],d=o[1],f=o[2],b=o[3],v=l*l+d*d+f*f+b*b;return v>0&&(v=1/Math.sqrt(v)),a[0]=l*v,a[1]=d*v,a[2]=f*v,a[3]=b*v,a}function Xc(a,o,l){var d=o[0],f=o[1],b=o[2],v=o[3];return a[0]=l[0]*d+l[4]*f+l[8]*b+l[12]*v,a[1]=l[1]*d+l[5]*f+l[9]*b+l[13]*v,a[2]=l[2]*d+l[6]*f+l[10]*b+l[14]*v,a[3]=l[3]*d+l[7]*f+l[11]*b+l[15]*v,a}function cp(){var a=new Ba(4);return Ba!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function R_(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function up(a,o,l){l*=.5;var d=o[0],f=o[1],b=o[2],v=o[3],w=Math.sin(l),T=Math.cos(l);return a[0]=d*T+v*w,a[1]=f*T+b*w,a[2]=b*T-f*w,a[3]=v*T-d*w,a}function u0(a,o,l){l*=.5;var d=o[0],f=o[1],b=o[2],v=o[3],w=Math.sin(l),T=Math.cos(l);return a[0]=d*T-b*w,a[1]=f*T+v*w,a[2]=b*T+d*w,a[3]=v*T-f*w,a}M_(),Fr=new Ba(4),Ba!=Float32Array&&(Fr[0]=0,Fr[1]=0,Fr[2]=0,Fr[3]=0);var d0=c0;M_(),Tf(1,0,0),Tf(0,1,0),cp(),cp(),l1();const kf=qe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Rf}=kf,P_=qe([{name:"a_pos_3",components:3,type:"Int16"}]);var Pf=qe([{name:"a_pos",type:"Int16",components:2}]);class L_{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,d){const f=Ts(l,this.dir);if(Math.abs(f)<1e-6)return!1;const b=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/f;return d[0]=this.pos[0]+this.dir[0]*b,d[1]=this.pos[1]+this.dir[1]*b,d[2]=this.pos[2]+this.dir[2]*b,!0}closestPointOnSphere(o,l,d){if(G=(N=this.pos)[0],ee=N[1],de=N[2],De=(z=o)[0],he=z[1],we=z[2],Math.abs(G-De)<=dg*Math.max(1,Math.abs(G),Math.abs(De))&&Math.abs(ee-he)<=dg*Math.max(1,Math.abs(ee),Math.abs(he))&&Math.abs(de-we)<=dg*Math.max(1,Math.abs(de),Math.abs(we))||0===l)return d[0]=d[1]=d[2]=0,!1;var N,z,G,ee,de,De,he,we;const[f,b,v]=this.dir,w=this.pos[0]-o[0],T=this.pos[1]-o[1],E=this.pos[2]-o[2],k=f*f+b*b+v*v,P=2*(w*f+T*b+E*v),L=P*P-4*k*(w*w+T*T+E*E-l*l);if(L<0){const N=Math.max(-P/2,0),z=w+f*N,G=T+b*N,ee=E+v*N,de=Math.hypot(z,G,ee);return d[0]=z*l/de,d[1]=G*l/de,d[2]=ee*l/de,!1}{const N=(-P-Math.sqrt(L))/(2*k);if(N<0){const z=Math.hypot(w,T,E);return d[0]=w*l/z,d[1]=T*l/z,d[2]=E*l/z,!1}return d[0]=w+f*N,d[1]=T+b*N,d[2]=E+v*N,!0}}}class zu{constructor(o,l,d,f,b){this.TL=o,this.TR=l,this.BR=d,this.BL=f,this.horizon=b}static fromInvProjectionMatrix(o,l,d){const f=[-1,1,1],b=[1,1,1],v=[1,-1,1],w=[-1,-1,1],T=je(f,f,o),E=je(b,b,o),k=je(v,v,o),P=je(w,w,o);return new zu(T,E,k,P,l/d)}}class Gd{constructor(o,l){this.points=o,this.planes=l}static fromInvProjectionMatrix(o,l,d,f){const b=Math.pow(2,d),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const E=Xc([],T,o),k=1/E[3]/l*b;return(P=E)[0]=(L=E)[0]*(N=[k,k,f?1/E[3]:k,k])[0],P[1]=L[1]*N[1],P[2]=L[2]*N[2],P[3]=L[3]*N[3],P;var P,L,N}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const E=Fo([],A_([],ja([],v[T[0]],v[T[1]]),ja([],v[T[2]],v[T[1]]))),k=-Ts(E,v[T[1]]);return E.concat(k)});return new Gd(v,w)}}class Vs{static fromPoints(o){const l=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const f of o)If(l,l,f),Mf(d,d,f);return new Vs(l,d)}static applyTransform(o,l){const d=o.getCorners();for(let f=0;f<d.length;++f)je(d[f],d[f],l);return Vs.fromPoints(d)}constructor(o,l){this.min=o,this.max=l,this.center=Va([],za([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],d=fg(this.min),f=fg(this.max);for(let b=0;b<l.length;b++)d[b]=l[b]?this.min[b]:this.center[b],f[b]=l[b]?this.center[b]:this.max[b];return f[2]=this.max[2],new Vs(d,f)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){const l=this.getCorners();let d=!0;for(let f=0;f<o.planes.length;f++){const b=o.planes[f];let v=0;for(let w=0;w<l.length;w++)v+=Ts(b,l[w])+b[3]>=0;if(0===v)return 0;v!==l.length&&(d=!1)}if(d)return 2;for(let f=0;f<3;f++){let b=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<o.points.length;w++){const T=o.points[w][f]-this.min[f];b=Math.min(b,T),v=Math.max(v,T)}if(v<0||b>this.max[f]-this.min[f])return 0}return 1}}const uc=On/Math.PI/2,Lf=[64,32,16],fl=-uc,Ks=uc,p0=[new Vs([fl,fl,fl],[Ks,Ks,Ks]),new Vs([fl,fl,fl],[0,0,Ks]),new Vs([0,fl,fl],[Ks,0,Ks]),new Vs([fl,0,fl],[0,Ks,Ks]),new Vs([0,0,fl],[Ks,Ks,Ks])];function mg(a){return a*uc/zf}function F_(a,o,l,d=!0){const f=Va([],a._camera.position,a.worldSize),b=[o,l,1,1];Xc(b,b,a.pixelMatrixInverse),l0(b,b,1/b[3]);const v=Fo([],ja([],b,f)),w=a.globeMatrix,T=[w[12],w[13],w[14]],E=ja([],T,f),k=Bu(E),P=Fo([],E),L=a.worldSize/(2*Math.PI),N=Ts(P,v),z=Math.asin(L/k);if(z<Math.acos(N)){if(!d)return null;const Ht=[],dt=[];Va(Ht,v,k/N),Fo(dt,ja(dt,Ht,E)),Fo(v,za(v,E,Va(v,dt,Math.tan(z)*k)))}const G=[];new L_(f,v).closestPointOnSphere(T,L,G);const ee=Fo([],Ke(w,0)),de=Fo([],Ke(w,1)),De=Fo([],Ke(w,2)),he=Ts(ee,G),we=Ts(de,G),Re=Ts(De,G),Pe=be(Math.asin(-we/L));let at=be(Math.atan2(he,Re));at=a.center.lng+function(Ht,dt){const Mt=(dt-Ht+180)%360-180;return Mt<-180?Mt+360:Mt}(a.center.lng,at);const rt=hc(at),yt=Dt(Nl(Pe),0,1);return new Mo(rt,yt)}class UI{constructor(o,l,d){this.a=ja([],o,d),this.b=ja([],l,d),this.center=d;const f=Fo([],this.a),b=Fo([],this.b);this.angle=Math.acos(Ts(f,b))}}function gg(a,o){if(0===a.angle)return null;let l;return l=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(d,f,b,v){const w=Math.sin(b);return d*(Math.sin((1-v)*b)/w)+f*(Math.sin(v*b)/w)}(a.a[o],a.b[o],a.angle,Dt(l,0,1))+a.center[o]}function Zc(a){if(a.z<=1)return p0[a.z+2*a.y+a.x];const o=Of(N_(a));return Vs.fromPoints(o)}function Xd(a,o,l){return Va(a,a,1-l),lp(a,a,o,l)}function f0(a,o){const l=Zd(o.zoom);if(0===l)return Zc(a);const d=N_(a),f=Of(d),b=hc(d.getWest())*o.worldSize,v=hc(d.getEast())*o.worldSize,w=Nl(d.getNorth())*o.worldSize,T=Nl(d.getSouth())*o.worldSize,E=[b,w,0],k=[v,w,0],P=[b,T,0],L=[v,T,0],N=Cf([],o.globeMatrix);return je(E,E,N),je(k,k,N),je(P,P,N),je(L,L,N),f[0]=Xd(f[0],P,l),f[1]=Xd(f[1],L,l),f[2]=Xd(f[2],k,l),f[3]=Xd(f[3],E,l),Vs.fromPoints(f)}function bg(a,o,l){for(const d of a)je(d,d,o),Va(d,d,l)}function N_({x:a,y:o,z:l}){const d=1/(1<<l),f=new xr(Ua(a*d),wr((o+1)*d)),b=new xr(Ua((a+1)*d),wr(o*d));return new Fu(f,b)}function Of(a){const o=se(a.getNorth()),l=se(a.getSouth()),d=Math.cos(o),f=Math.cos(l),b=Math.sin(o),v=Math.sin(l),w=a.getWest(),T=a.getEast();return[Ff(f,v,w),Ff(f,v,T),Ff(d,b,T),Ff(d,b,w)]}function Ff(a,o,l,d=uc){return l=se(l),[a*Math.sin(l)*d,-o*d,a*Math.cos(l)*d]}function Nf(a,o,l){return Ff(Math.cos(se(a)),Math.sin(se(a)),o,l)}function _g(a,o,l,d){const f=1<<l.z,b=(a/On+l.x)/f;return Nf(wr((o/On+l.y)/f),Ua(b),d)}function B_({min:a,max:o}){return 16383/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const d1=new Float64Array(16);function Bf(a){const o=B_(a),l=s0(d1,[o,o,o]);return hg(l,l,((d=[])[0]=-(f=a.min)[0],d[1]=-f[1],d[2]=-f[2],d));var d,f}function yg(a){const o=(d=a.min,(l=d1)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=d[0],l[13]=d[1],l[14]=d[2],l[15]=1,l);var l,d;const f=1/B_(a);return Nu(o,o,[f,f,f])}function vg(a,o,l,d,f){const b=function(T){const E=On/(2*Math.PI);return T/(2*Math.PI)/E}(l),v=[a,o,-l/(2*Math.PI)],w=go(new Float64Array(16));return hg(w,w,v),Nu(w,w,[b,b,b]),I_(w,w,se(-f)),pg(w,w,se(-d)),w}function Zd(a){return oi(5,6,a)}function z_(a,o){const l=Nf(o.lat,o.lng);return v=(f=Ef([],function(z){const G=Nf(z._center.lat,z._center.lng);let ee=A_([],Tf(0,1,0),G);const de=a0([],-z.angle,G);ee=je(ee,ee,de),a0(de,-z._pitch,ee);const De=Fo([],G);return Va(De,De,mg(z.cameraToCenterDistance/z.pixelsPerMeter)),je(De,De,de),za([],G,De)}(a),l))[0],w=f[1],T=f[2],E=(b=l)[0],k=b[1],P=b[2],N=(L=Math.sqrt(v*v+w*w+T*T)*Math.sqrt(E*E+k*k+P*P))&&Ts(f,b)/L,Math.acos(Math.min(Math.max(N,-1),1));var f,b,v,w,T,E,k,P,L,N}function xg(a,o){return z_(a,o)>Math.PI/2*1.01}const Qs=se(85),h1=Math.cos(Qs),p1=Math.sin(Qs),zf=6371008.8,V_=2*Math.PI*zf;class dc{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new dc(Lt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,d=this.lat*l,f=o.lat*l,b=Math.sin(d)*Math.sin(f)+Math.cos(d)*Math.cos(f)*Math.cos((o.lng-this.lng)*l);return zf*Math.acos(Math.min(b,1))}toBounds(o=0){const l=360*o/40075017,d=l/Math.cos(Math.PI/180*this.lat);return new Fu(new dc(this.lng-d,this.lat-l),new dc(this.lng+d,this.lat+l))}toEcef(o){const l=mg(o);return Nf(this.lat,this.lng,uc+l)}static convert(o){if(o instanceof dc)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new dc(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new dc(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var xr=dc;function j_(a){return V_*Math.cos(a*Math.PI/180)}function hc(a){return(180+a)/360}function Nl(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Bl(a,o){return a/j_(o)}function Ua(a){return 360*a-180}function wr(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function wg(a,o){return a*j_(wr(o))}const Xo=85.051129;function Sg(a){return 1/Math.cos(a*Math.PI/180)}class Mo{constructor(o,l,d=0){this.x=+o,this.y=+l,this.z=+d}static fromLngLat(o,l=0){const d=xr.convert(o);return new Mo(hc(d.lng),Nl(d.lat),Bl(l,d.lat))}toLngLat(){return new xr(Ua(this.x),wr(this.y))}toAltitude(){return wg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/V_*Sg(wr(this.y))}}function Yd(a,o,l,d,f,b,v,w,T){const E=(o+d)/2,k=(l+f)/2,P=new Ae(E,k);w(P),function(L,N,z,G,ee,de){const De=z-ee,he=G-de;return Math.abs((G-N)*De-(z-L)*he)/Math.hypot(De,he)}(P.x,P.y,b.x,b.y,v.x,v.y)>=T?(Yd(a,o,l,E,k,b,P,w,T),Yd(a,E,k,d,f,P,v,w,T)):a.push(v)}function U_(a,o,l){let d=a[0],f=d.x,b=d.y;o(d);const v=[d];for(let w=1;w<a.length;w++){const T=a[w],{x:E,y:k}=T;o(T),Yd(v,f,b,E,k,d,T,o,l),f=E,b=k,d=T}return v}function H_(a,o,l,d){if(d(o,l)){const f=o.add(l)._mult(.5);H_(a,o,f,d),H_(a,f,l,d)}else a.push(l)}function f1(a,o){let l=a[0];const d=[l];for(let f=1;f<a.length;f++){const b=a[f];H_(d,l,b,o),l=b}return d}const Cg=Math.pow(2,14)-1,m0=-Cg-1;function g0(a,o){const l=Math.round(a.x*o),d=Math.round(a.y*o);return a.x=Dt(l,m0,Cg),a.y=Dt(d,m0,Cg),(l<a.x||l>a.x+1||d<a.y||d>a.y+1)&&Jn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Yc(a,o,l){const d=a.loadGeometry(),f=a.extent,b=On/f;if(o&&l&&l.projection.isReprojectedInTileSpace){const v=1<<o.z,{scale:w,x:T,y:E,projection:k}=l,P=L=>{const N=Ua((o.x+L.x/f)/v),z=wr((o.y+L.y/f)/v),G=k.project(N,z);L.x=(G.x*w-T)*f,L.y=(G.y*w-E)*f};for(let L=0;L<d.length;L++)if(1!==a.type)d[L]=U_(d[L],P,1);else{const N=[];for(const z of d[L])z.x<0||z.x>=f||z.y<0||z.y>=f||(P(z),N.push(z));d[L]=N}}for(const v of d)for(const w of v)g0(w,b);return d}function Vu(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?Yc(a):[]}}function Tg(a,o,l,d,f){a.emplaceBack(2*o+(d+1)/2,2*l+(f+1)/2)}function Eg(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class Vf{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new Vt,this.indexArray=new Dn,this.segments=new $r,this.programConfigurations=new ap(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,d,f){const b=this.layers[0],v=[];let w=null;"circle"===b.type&&(w=b.layout.get("circle-sort-key"));for(const{feature:E,id:k,index:P,sourceLayerIndex:L}of o){const N=this.layers[0]._featureFilter.needGeometry,z=Vu(E,N);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),z,d))continue;const G=w?w.evaluate(z,{},d):void 0,ee={id:k,properties:E.properties,type:E.type,sourceLayerIndex:L,index:P,geometry:N?z.geometry:Yc(E,d,f),patterns:{},sortKey:G};v.push(ee)}w&&v.sort((E,k)=>E.sortKey-k.sortKey);let T=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new Ut,T=f.projection);for(const E of v){const{geometry:k,index:P,sourceLayerIndex:L}=E,N=o[P].feature;this.addFeature(E,k,P,l.availableImages,d,T),l.featureIndex.insert(N,k,P,L,this.index)}}update(o,l,d,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,o0.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,ug.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,d,f,b,v){for(const w of l)for(const T of w){const E=T.x,k=T.y;if(E<0||E>=On||k<0||k>=On)continue;if(v){const N=v.projectTilePoint(E,k,b),z=v.upVector(b,E,k),G=this.globeExtVertexArray;Eg(G,N,z),Eg(G,N,z),Eg(G,N,z),Eg(G,N,z)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),L=P.vertexLength;Tg(this.layoutVertexArray,E,k,-1,-1),Tg(this.layoutVertexArray,E,k,1,-1),Tg(this.layoutVertexArray,E,k,1,1),Tg(this.layoutVertexArray,E,k,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,{},f,b)}}function Dg(a,o){for(let l=0;l<a.length;l++)if(ju(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(ju(a,o[l]))return!0;return!!Kd(a,o)}function m1(a,o,l){return!!ju(a,o)||!!q_(o,a,l)}function $_(a,o){if(1===a.length)return Mg(o,a[0]);for(let l=0;l<o.length;l++){const d=o[l];for(let f=0;f<d.length;f++)if(ju(a,d[f]))return!0}for(let l=0;l<a.length;l++)if(Mg(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(Kd(a,o[l]))return!0;return!1}function g1(a,o,l){if(a.length>1){if(Kd(a,o))return!0;for(let d=0;d<o.length;d++)if(q_(o[d],a,l))return!0}for(let d=0;d<a.length;d++)if(q_(a[d],o,l))return!0;return!1}function Kd(a,o){if(0===a.length||0===o.length)return!1;for(let l=0;l<a.length-1;l++){const d=a[l],f=a[l+1];for(let b=0;b<o.length-1;b++)if(b1(d,f,o[b],o[b+1]))return!0}return!1}function b1(a,o,l,d){return Ci(a,l,d)!==Ci(o,l,d)&&Ci(a,o,l)!==Ci(a,o,d)}function q_(a,o,l){const d=l*l;if(1===o.length)return a.distSqr(o[0])<d;for(let f=1;f<o.length;f++)if(Ig(a,o[f-1],o[f])<d)return!0;return!1}function Ig(a,o,l){const d=o.distSqr(l);if(0===d)return a.distSqr(o);const f=((a.x-o.x)*(l.x-o.x)+(a.y-o.y)*(l.y-o.y))/d;return a.distSqr(f<0?o:f>1?l:l.sub(o)._mult(f)._add(o))}function Mg(a,o){let l,d,f,b=!1;for(let v=0;v<a.length;v++){l=a[v];for(let w=0,T=l.length-1;w<l.length;T=w++)d=l[w],f=l[T],d.y>o.y!=f.y>o.y&&o.x<(f.x-d.x)*(o.y-d.y)/(f.y-d.y)+d.x&&(b=!b)}return b}function ju(a,o){let l=!1;for(let d=0,f=a.length-1;d<a.length;f=d++){const b=a[d],v=a[f];b.y>o.y!=v.y>o.y&&o.x<(v.x-b.x)*(o.y-b.y)/(v.y-b.y)+b.x&&(l=!l)}return l}function _1(a,o,l,d,f){for(const v of a)if(o<=v.x&&l<=v.y&&d>=v.x&&f>=v.y)return!0;const b=[new Ae(o,l),new Ae(o,f),new Ae(d,f),new Ae(d,l)];if(a.length>2)for(const v of b)if(ju(a,v))return!0;for(let v=0;v<a.length-1;v++)if(dp(a[v],a[v+1],b))return!0;return!1}function dp(a,o,l){const d=l[0],f=l[2];if(a.x<d.x&&o.x<d.x||a.x>f.x&&o.x>f.x||a.y<d.y&&o.y<d.y||a.y>f.y&&o.y>f.y)return!1;const b=Ci(a,o,l[0]);return b!==Ci(a,o,l[1])||b!==Ci(a,o,l[2])||b!==Ci(a,o,l[3])}function Uu(a,o,l){const d=o.paint.get(a).value;return"constant"===d.kind?d.value:l.programConfigurations.get(o.id).getMaxValue(a)}function jf(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function b0(a,o,l,d,f){if(!o[0]&&!o[1])return a;const b=Ae.convert(o)._mult(f);"viewport"===l&&b._rotate(-d);const v=[];for(let w=0;w<a.length;w++)v.push(a[w].sub(b));return v}function Ag(a,o,l,d){const f=Ae.convert(a)._mult(d);return"viewport"===o&&f._rotate(-l),f}bn(Vf,"CircleBucket",{omit:["layers"]});const y1=new _e({"circle-sort-key":new te(_t.layout_circle["circle-sort-key"])});var v1={paint:new _e({"circle-radius":new te(_t.paint_circle["circle-radius"]),"circle-color":new te(_t.paint_circle["circle-color"]),"circle-blur":new te(_t.paint_circle["circle-blur"]),"circle-opacity":new te(_t.paint_circle["circle-opacity"]),"circle-translate":new $(_t.paint_circle["circle-translate"]),"circle-translate-anchor":new $(_t.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $(_t.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $(_t.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new te(_t.paint_circle["circle-stroke-width"]),"circle-stroke-color":new te(_t.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new te(_t.paint_circle["circle-stroke-opacity"])}),layout:y1};function _0(a,o,l,d,f,b,v,w,T){if(b&&a.queryGeometry.isAboveHorizon)return!1;b&&(T*=a.pixelToTileUnitsFactor);const E=a.tileID.canonical,k=l.projection.upVectorScale(E,l.center.lat,l.worldSize).metersToTile;for(const P of o)for(const L of P){const N=L.add(w),z=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(N.x,N.y,!0):0,G=l.projection.projectTilePoint(N.x,N.y,E);if(z>0){const he=l.projection.upVector(E,N.x,N.y);G.x+=he[0]*k*z,G.y+=he[1]*k*z,G.z+=he[2]*k*z}const ee=b?N:x1(G.x,G.y,G.z,d),de=b?a.tilespaceRays.map(he=>v0(he,z)):a.queryGeometry.screenGeometry,De=Xc([],[G.x,G.y,G.z,1],d);if(!v&&b?T*=De[3]/l.cameraToCenterDistance:v&&!b&&(T*=l.cameraToCenterDistance/De[3]),b){const he=wr((L.y/On+E.y)/(1<<E.z));T/=l.projection.pixelsPerMeter(he,1)/Bl(1,he)}if(m1(de,ee,T))return!0}return!1}function x1(a,o,l,d){const f=Xc([],[a,o,l,1],d);return new Ae(f[0]/f[3],f[1]/f[3])}const y0=Tf(0,0,0),w1=Tf(0,0,1);function v0(a,o){const l=M_();return y0[2]=o,a.intersectsPlane(y0,w1,l),new Ae(l[0],l[1])}class kg extends Vf{}function G_(a,{width:o,height:l},d,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==o*l*d)throw new RangeError("mismatched image size")}else f=new Uint8Array(o*l*d);return a.width=o,a.height=l,a.data=f,a}function Rg(a,o,l){const{width:d,height:f}=o;d===a.width&&f===a.height||(W_(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,d),height:Math.min(a.height,f)},l),a.width=d,a.height=f,a.data=o.data)}function W_(a,o,l,d,f,b){if(0===f.width||0===f.height)return o;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>o.width||f.height>o.height||d.x>o.width-f.width||d.y>o.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const v=a.data,w=o.data;for(let T=0;T<f.height;T++){const E=((l.y+T)*a.width+l.x)*b,k=((d.y+T)*o.width+d.x)*b;for(let P=0;P<f.width*b;P++)w[k+P]=v[E+P]}return o}bn(kg,"HeatmapBucket",{omit:["layers"]});class Kc{constructor(o,l){G_(this,o,1,l)}resize(o){Rg(this,new Kc(o),1)}clone(){return new Kc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,f,b){W_(o,l,d,f,b,1)}}class Js{constructor(o,l){G_(this,o,4,l)}resize(o){Rg(this,new Js(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Js({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,d,f,b){W_(o,l,d,f,b,4)}}bn(Kc,"AlphaImage"),bn(Js,"RGBAImage");var x0={paint:new _e({"heatmap-radius":new te(_t.paint_heatmap["heatmap-radius"]),"heatmap-weight":new te(_t.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $(_t.paint_heatmap["heatmap-intensity"]),"heatmap-color":new me(_t.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $(_t.paint_heatmap["heatmap-opacity"])})};function Qc(a){const o={},l=a.resolution||256,d=a.clips?a.clips.length:1,f=a.image||new Js({width:l,height:d}),b=(v,w,T)=>{o[a.evaluationKey]=T;const E=a.expression.evaluate(o);f.data[v+w+0]=Math.floor(255*E.r/E.a),f.data[v+w+1]=Math.floor(255*E.g/E.a),f.data[v+w+2]=Math.floor(255*E.b/E.a),f.data[v+w+3]=Math.floor(255*E.a)};if(a.clips)for(let v=0,w=0;v<d;++v,w+=4*l)for(let T=0,E=0;T<l;T++,E+=4){const k=T/(l-1),{start:P,end:L}=a.clips[v];b(w,E,P*(1-k)+L*k)}else for(let v=0,w=0;v<l;v++,w+=4)b(0,w,v/(l-1));return f}var w0={paint:new _e({"hillshade-illumination-direction":new $(_t.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $(_t.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $(_t.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $(_t.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $(_t.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $(_t.paint_hillshade["hillshade-accent-color"])})};const S0=qe([{name:"a_pos",components:2,type:"Int16"}],4),{members:S1}=S0;var C0={exports:{}};function Qd(a,o,l){l=l||2;var d,f,b,v,w,T,E,k=o&&o.length,P=k?o[0]*l:a.length,L=T0(a,0,P,l,!0),N=[];if(!L||L.next===L.prev)return N;if(k&&(L=function(G,ee,de,De){var he,we,Re,Pe=[];for(he=0,we=ee.length;he<we;he++)(Re=T0(G,ee[he]*De,he<we-1?ee[he+1]*De:G.length,De,!1))===Re.next&&(Re.steiner=!0),Pe.push(Y_(Re));for(Pe.sort(Lg),he=0;he<Pe.length;he++)de=I0(Pe[he],de);return de}(a,o,L,l)),a.length>80*l){d=b=a[0],f=v=a[1];for(var z=l;z<P;z+=l)(w=a[z])<d&&(d=w),(T=a[z+1])<f&&(f=T),w>b&&(b=w),T>v&&(v=T);E=0!==(E=Math.max(b-d,v-f))?32767/E:0}return hp(L,N,l,d,f,E,0),N}function T0(a,o,l,d,f){var b,v;if(f===A0(a,o,l,d)>0)for(b=o;b<l;b+=d)v=qu(b,a[b],a[b+1],v);else for(b=l-d;b>=o;b-=d)v=qu(b,a[b],a[b+1],v);return v&&Og(v,v.next)&&($f(v),v=v.next),v}function Hu(a,o){if(!a)return a;o||(o=a);var l,d=a;do{if(l=!1,d.steiner||!Og(d,d.next)&&0!==co(d.prev,d,d.next))d=d.next;else{if($f(d),(d=o=d.prev)===d.next)break;l=!0}}while(l||d!==o);return o}function hp(a,o,l,d,f,b,v){if(a){!v&&b&&function(k,P,L,N){var z=k;do{0===z.z&&(z.z=Uf(z.x,z.y,P,L,N)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next}while(z!==k);z.prevZ.nextZ=null,z.prevZ=null,function(G){var ee,de,De,he,we,Re,Pe,at,rt=1;do{for(de=G,G=null,we=null,Re=0;de;){for(Re++,De=de,Pe=0,ee=0;ee<rt&&(Pe++,De=De.nextZ);ee++);for(at=rt;Pe>0||at>0&&De;)0!==Pe&&(0===at||!De||de.z<=De.z)?(he=de,de=de.nextZ,Pe--):(he=De,De=De.nextZ,at--),we?we.nextZ=he:G=he,he.prevZ=we,we=he;de=De}we.nextZ=null,rt*=2}while(Re>1)}(z)}(a,d,f,b);for(var w,T,E=a;a.prev!==a.next;)if(w=a.prev,T=a.next,b?X_(a,d,f,b):E0(a))o.push(w.i/l|0),o.push(a.i/l|0),o.push(T.i/l|0),$f(a),a=T.next,E=T.next;else if((a=T)===E){v?1===v?hp(a=D0(Hu(a),o,l),o,l,d,f,b,2):2===v&&Pg(a,o,l,d,f,b):hp(Hu(a),o,l,d,f,b,1);break}}}function E0(a){var o=a.prev,l=a,d=a.next;if(co(o,l,d)>=0)return!1;for(var f=o.x,b=l.x,v=d.x,w=o.y,T=l.y,E=d.y,k=f<b?f<v?f:v:b<v?b:v,P=w<T?w<E?w:E:T<E?T:E,L=f>b?f>v?f:v:b>v?b:v,N=w>T?w>E?w:E:T>E?T:E,z=d.next;z!==o;){if(z.x>=k&&z.x<=L&&z.y>=P&&z.y<=N&&pc(f,w,b,T,v,E,z.x,z.y)&&co(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function X_(a,o,l,d){var f=a.prev,b=a,v=a.next;if(co(f,b,v)>=0)return!1;for(var w=f.x,T=b.x,E=v.x,k=f.y,P=b.y,L=v.y,N=w<T?w<E?w:E:T<E?T:E,z=k<P?k<L?k:L:P<L?P:L,G=w>T?w>E?w:E:T>E?T:E,ee=k>P?k>L?k:L:P>L?P:L,de=Uf(N,z,o,l,d),De=Uf(G,ee,o,l,d),he=a.prevZ,we=a.nextZ;he&&he.z>=de&&we&&we.z<=De;){if(he.x>=N&&he.x<=G&&he.y>=z&&he.y<=ee&&he!==f&&he!==v&&pc(w,k,T,P,E,L,he.x,he.y)&&co(he.prev,he,he.next)>=0||(he=he.prevZ,we.x>=N&&we.x<=G&&we.y>=z&&we.y<=ee&&we!==f&&we!==v&&pc(w,k,T,P,E,L,we.x,we.y)&&co(we.prev,we,we.next)>=0))return!1;we=we.nextZ}for(;he&&he.z>=de;){if(he.x>=N&&he.x<=G&&he.y>=z&&he.y<=ee&&he!==f&&he!==v&&pc(w,k,T,P,E,L,he.x,he.y)&&co(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;we&&we.z<=De;){if(we.x>=N&&we.x<=G&&we.y>=z&&we.y<=ee&&we!==f&&we!==v&&pc(w,k,T,P,E,L,we.x,we.y)&&co(we.prev,we,we.next)>=0)return!1;we=we.nextZ}return!0}function D0(a,o,l){var d=a;do{var f=d.prev,b=d.next.next;!Og(f,b)&&M0(f,d,d.next,b)&&$u(f,b)&&$u(b,f)&&(o.push(f.i/l|0),o.push(d.i/l|0),o.push(b.i/l|0),$f(d),$f(d.next),d=a=b),d=d.next}while(d!==a);return Hu(d)}function Pg(a,o,l,d,f,b){var v=a;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&C1(v,w)){var T=Fg(v,w);return v=Hu(v,v.next),T=Hu(T,T.next),hp(v,o,l,d,f,b,0),void hp(T,o,l,d,f,b,0)}w=w.next}v=v.next}while(v!==a)}function Lg(a,o){return a.x-o.x}function I0(a,o){var l=function(f,b){var v,w=b,T=f.x,E=f.y,k=-1/0;do{if(E<=w.y&&E>=w.next.y&&w.next.y!==w.y){var P=w.x+(E-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(P<=T&&P>k&&(k=P,v=w.x<w.next.x?w:w.next,P===T))return v}w=w.next}while(w!==b);if(!v)return null;var L,N=v,z=v.x,G=v.y,ee=1/0;w=v;do{T>=w.x&&w.x>=z&&T!==w.x&&pc(E<G?T:k,E,z,G,E<G?k:T,E,w.x,w.y)&&(L=Math.abs(E-w.y)/(T-w.x),$u(w,f)&&(L<ee||L===ee&&(w.x>v.x||w.x===v.x&&Z_(v,w)))&&(v=w,ee=L)),w=w.next}while(w!==N);return v}(a,o);if(!l)return o;var d=Fg(l,a);return Hu(d,d.next),Hu(l,l.next)}function Z_(a,o){return co(a.prev,a,o.prev)<0&&co(o.next,a,a.next)<0}function Uf(a,o,l,d,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-d)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Y_(a){var o=a,l=a;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==a);return l}function pc(a,o,l,d,f,b,v,w){return(f-v)*(o-w)>=(a-v)*(b-w)&&(a-v)*(d-w)>=(l-v)*(o-w)&&(l-v)*(b-w)>=(f-v)*(d-w)}function C1(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(l,d){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==d.i&&f.next.i!==d.i&&M0(f,f.next,l,d))return!0;f=f.next}while(f!==l);return!1}(a,o)&&($u(a,o)&&$u(o,a)&&function(l,d){var f=l,b=!1,v=(l.x+d.x)/2,w=(l.y+d.y)/2;do{f.y>w!=f.next.y>w&&f.next.y!==f.y&&v<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(b=!b),f=f.next}while(f!==l);return b}(a,o)&&(co(a.prev,a,o.prev)||co(a,o.prev,o))||Og(a,o)&&co(a.prev,a,a.next)>0&&co(o.prev,o,o.next)>0)}function co(a,o,l){return(o.y-a.y)*(l.x-o.x)-(o.x-a.x)*(l.y-o.y)}function Og(a,o){return a.x===o.x&&a.y===o.y}function M0(a,o,l,d){var f=pp(co(a,o,l)),b=pp(co(a,o,d)),v=pp(co(l,d,a)),w=pp(co(l,d,o));return f!==b&&v!==w||!(0!==f||!Hf(a,l,o))||!(0!==b||!Hf(a,d,o))||!(0!==v||!Hf(l,a,d))||!(0!==w||!Hf(l,o,d))}function Hf(a,o,l){return o.x<=Math.max(a.x,l.x)&&o.x>=Math.min(a.x,l.x)&&o.y<=Math.max(a.y,l.y)&&o.y>=Math.min(a.y,l.y)}function pp(a){return a>0?1:a<0?-1:0}function $u(a,o){return co(a.prev,a,a.next)<0?co(a,o,a.next)>=0&&co(a,a.prev,o)>=0:co(a,o,a.prev)<0||co(a,a.next,o)<0}function Fg(a,o){var l=new K_(a.i,a.x,a.y),d=new K_(o.i,o.x,o.y),f=a.next,b=o.prev;return a.next=o,o.prev=a,l.next=f,f.prev=l,d.next=l,l.prev=d,b.next=d,d.prev=b,d}function qu(a,o,l,d){var f=new K_(a,o,l);return d?(f.next=d.next,f.prev=d,d.next.prev=f,d.next=f):(f.prev=f,f.next=f),f}function $f(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function K_(a,o,l){this.i=a,this.x=o,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A0(a,o,l,d){for(var f=0,b=o,v=l-d;b<l;b+=d)f+=(a[v]-a[b])*(a[b+1]+a[v+1]),v=b;return f}C0.exports=Qd,C0.exports.default=Qd,Qd.deviation=function(a,o,l,d){var f=o&&o.length,b=Math.abs(A0(a,0,f?o[0]*l:a.length,l));if(f)for(var v=0,w=o.length;v<w;v++)b-=Math.abs(A0(a,o[v]*l,v<w-1?o[v+1]*l:a.length,l));var T=0;for(v=0;v<d.length;v+=3){var E=d[v]*l,k=d[v+1]*l,P=d[v+2]*l;T+=Math.abs((a[E]-a[P])*(a[k+1]-a[E+1])-(a[E]-a[k])*(a[P+1]-a[E+1]))}return 0===b&&0===T?0:Math.abs((T-b)/b)},Qd.flatten=function(a){for(var o=a[0][0].length,l={vertices:[],holes:[],dimensions:o},d=0,f=0;f<a.length;f++){for(var b=0;b<a[f].length;b++)for(var v=0;v<o;v++)l.vertices.push(a[f][b][v]);f>0&&l.holes.push(d+=a[f-1].length)}return l};var Q_=vn(C0.exports);function J_(a,o,l,d,f){k0(a,o,l||0,d||a.length-1,f||Ng)}function k0(a,o,l,d,f){for(;d>l;){if(d-l>600){var b=d-l+1,v=o-l+1,w=Math.log(b),T=.5*Math.exp(2*w/3),E=.5*Math.sqrt(w*T*(b-T)/b)*(v-b/2<0?-1:1);k0(a,o,Math.max(l,Math.floor(o-v*T/b+E)),Math.min(d,Math.floor(o+(b-v)*T/b+E)),f)}var k=a[o],P=l,L=d;for(fp(a,l,o),f(a[d],k)>0&&fp(a,l,d);P<L;){for(fp(a,P,L),P++,L--;f(a[P],k)<0;)P++;for(;f(a[L],k)>0;)L--}0===f(a[l],k)?fp(a,l,L):fp(a,++L,d),L<=o&&(l=L+1),o<=L&&(d=L-1)}}function fp(a,o,l){var d=a[o];a[o]=a[l],a[l]=d}function Ng(a,o){return a<o?-1:a>o?1:0}function qf(a,o){const l=a.length;if(l<=1)return[a];const d=[];let f,b;for(let v=0;v<l;v++){const w=Xr(a[v]);0!==w&&(a[v].area=Math.abs(w),void 0===b&&(b=w<0),b===w<0?(f&&d.push(f),f=[a[v]]):f.push(a[v]))}if(f&&d.push(f),o>1)for(let v=0;v<d.length;v++)d[v].length<=o||(J_(d[v],o,1,d[v].length-1,R0),d[v]=d[v].slice(0,o));return d}function R0(a,o){return o.area-a.area}function Bg(a,o,l){const d=l.patternDependencies;let f=!1;for(const b of o){const v=b.paint.get(`${a}-pattern`);v.isConstant()||(f=!0);const w=v.constantOr(null);w&&(f=!0,d[w]=!0)}return f}function zg(a,o,l,d,f){const b=f.patternDependencies;for(const v of o){const w=v.paint.get(`${a}-pattern`).value;if("constant"!==w.kind){let T=w.evaluate({zoom:d},l,{},f.availableImages);T=T&&T.name?T.name:T,b[T]=!0,l.patterns[v.id]=T}}return l}class fc{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Vt,this.indexArray=new Dn,this.indexArray2=new ao,this.programConfigurations=new ap(o.layers,o.zoom),this.segments=new $r,this.segments2=new $r,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}populate(o,l,d,f){this.hasPattern=Bg("fill",this.layers,l);const b=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:w,id:T,index:E,sourceLayerIndex:k}of o){const P=this.layers[0]._featureFilter.needGeometry,L=Vu(w,P);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),L,d))continue;const N=b?b.evaluate(L,{},d,l.availableImages):void 0,z={id:T,properties:w.properties,type:w.type,sourceLayerIndex:k,index:E,geometry:P?L.geometry:Yc(w,d,f),patterns:{},sortKey:N};v.push(z)}b&&v.sort((w,T)=>w.sortKey-T.sortKey);for(const w of v){const{geometry:T,index:E,sourceLayerIndex:k}=w;if(this.hasPattern){const P=zg("fill",this.layers,w,this.zoom,l);this.patternFeatures.push(P)}else this.addFeature(w,T,E,d,{},l.availableImages);l.featureIndex.insert(o[E].feature,T,E,k,this.index)}}update(o,l,d,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,f)}addFeatures(o,l,d,f,b){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,d,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,S1),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,d,f,b,v=[]){for(const w of qf(l,500)){let T=0;for(const z of w)T+=z.length;const E=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),k=E.vertexLength,P=[],L=[];for(const z of w){if(0===z.length)continue;z!==w[0]&&L.push(P.length/2);const G=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),ee=G.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(ee+z.length-1,ee),P.push(z[0].x),P.push(z[0].y);for(let de=1;de<z.length;de++)this.layoutVertexArray.emplaceBack(z[de].x,z[de].y),this.indexArray2.emplaceBack(ee+de-1,ee+de),P.push(z[de].x),P.push(z[de].y);G.vertexLength+=z.length,G.primitiveLength+=z.length}const N=Q_(P,L);for(let z=0;z<N.length;z+=3)this.indexArray.emplaceBack(k+N[z],k+N[z+1],k+N[z+2]);E.vertexLength+=T,E.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,b,v,f)}}bn(fc,"FillBucket",{omit:["layers","patternFeatures"]});const T1=new _e({"fill-sort-key":new te(_t.layout_fill["fill-sort-key"])});var E1={paint:new _e({"fill-antialias":new $(_t.paint_fill["fill-antialias"]),"fill-opacity":new te(_t.paint_fill["fill-opacity"]),"fill-color":new te(_t.paint_fill["fill-color"]),"fill-outline-color":new te(_t.paint_fill["fill-outline-color"]),"fill-translate":new $(_t.paint_fill["fill-translate"]),"fill-translate-anchor":new $(_t.paint_fill["fill-translate-anchor"]),"fill-pattern":new te(_t.paint_fill["fill-pattern"])}),layout:T1};const D1=qe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),I1=qe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),M1=qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ha}=D1;var $a={},A1=Te,P0=mp;function mp(a,o,l,d,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=f,a.readFields(k1,this,o)}function k1(a,o,l){1==a?o.id=l.readVarint():2==a?function(d,f){for(var b=d.readVarint()+d.pos;d.pos<b;){var v=f._keys[d.readVarint()],w=f._values[d.readVarint()];f.properties[v]=w}}(l,o):3==a?o.type=l.readVarint():4==a&&(o._geometry=l.pos)}function R1(a){for(var o,l,d=0,f=0,b=a.length,v=b-1;f<b;v=f++)d+=((l=a[v]).x-(o=a[f]).x)*(o.y+l.y);return d}mp.types=["Unknown","Point","LineString","Polygon"],mp.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,l=a.readVarint()+a.pos,d=1,f=0,b=0,v=0,w=[];a.pos<l;){if(f<=0){var T=a.readVarint();d=7&T,f=T>>3}if(f--,1===d||2===d)b+=a.readSVarint(),v+=a.readSVarint(),1===d&&(o&&w.push(o),o=[]),o.push(new A1(b,v));else{if(7!==d)throw new Error("unknown command "+d);o&&o.push(o[0].clone())}}return o&&w.push(o),w},mp.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,l=1,d=0,f=0,b=0,v=1/0,w=-1/0,T=1/0,E=-1/0;a.pos<o;){if(d<=0){var k=a.readVarint();l=7&k,d=k>>3}if(d--,1===l||2===l)(f+=a.readSVarint())<v&&(v=f),f>w&&(w=f),(b+=a.readSVarint())<T&&(T=b),b>E&&(E=b);else if(7!==l)throw new Error("unknown command "+l)}return[v,T,w,E]},mp.prototype.toGeoJSON=function(a,o,l){var d,f,b=this.extent*Math.pow(2,l),v=this.extent*a,w=this.extent*o,T=this.loadGeometry(),E=mp.types[this.type];function k(N){for(var z=0;z<N.length;z++){var G=N[z];N[z]=[360*(G.x+v)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+w)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(d=0;d<T.length;d++)P[d]=T[d][0];k(T=P);break;case 2:for(d=0;d<T.length;d++)k(T[d]);break;case 3:for(T=function(N){var z=N.length;if(z<=1)return[N];for(var G,ee,de=[],De=0;De<z;De++){var he=R1(N[De]);0!==he&&(void 0===ee&&(ee=he<0),ee===he<0?(G&&de.push(G),G=[N[De]]):G.push(N[De]))}return G&&de.push(G),de}(T),d=0;d<T.length;d++)for(f=0;f<T[d].length;f++)k(T[d][f])}1===T.length?T=T[0]:E="Multi"+E;var L={type:"Feature",geometry:{type:E,coordinates:T},properties:this.properties};return"id"in this&&(L.id=this.id),L};var P1=P0,ey=L0;function L0(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(L1,this,o),this.length=this._features.length}function L1(a,o,l){15===a?o.version=l.readVarint():1===a?o.name=l.readString():5===a?o.extent=l.readVarint():2===a?o._features.push(l.pos):3===a?o._keys.push(l.readString()):4===a&&o._values.push(function(d){for(var f=null,b=d.readVarint()+d.pos;d.pos<b;){var v=d.readVarint()>>3;f=1===v?d.readString():2===v?d.readFloat():3===v?d.readDouble():4===v?d.readVarint64():5===v?d.readVarint():6===v?d.readSVarint():7===v?d.readBoolean():null}return f}(l))}L0.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new P1(this._pbf,o,this.extent,this._keys,this._values)};var O1=ey;function F1(a,o,l){if(3===a){var d=new O1(l,l.readVarint()+l.pos);d.length&&(o[d.name]=d)}}var gp=$a.VectorTile=function(a,o){this.layers=a.readFields(F1,{},o)},ml=$a.VectorTileFeature=P0;function Gu(a,o,l,d){const f=[],b=0===d?(v,w,T,E,k,P)=>{v.push(new Ae(P,T+(P-w)/(E-w)*(k-T)))}:(v,w,T,E,k,P)=>{v.push(new Ae(w+(P-T)/(k-T)*(E-w),P))};for(const v of a){const w=[];for(const T of v){if(T.length<=2)continue;const E=[];for(let L=0;L<T.length-1;L++){const N=T[L].x,z=T[L].y,G=T[L+1].x,ee=T[L+1].y,de=0===d?N:z,De=0===d?G:ee;de<o?De>o&&b(E,N,z,G,ee,o):de>l?De<l&&b(E,N,z,G,ee,l):E.push(T[L]),De<o&&de>=o&&b(E,N,z,G,ee,o),De>l&&de<=l&&b(E,N,z,G,ee,l)}let k=T[T.length-1];const P=0===d?k.x:k.y;P>=o&&P<=l&&E.push(k),E.length&&(k=E[E.length-1],E[0].x===k.x&&E[0].y===k.y||E.push(E[0]),w.push(E))}w.length&&f.push(w)}return f}$a.VectorTileLayer=ey;const O0=ml.types,F0=Math.pow(2,13);function bp(a,o,l,d,f,b,v,w){a.emplaceBack((o<<1)+v,(l<<1)+b,(Math.floor(d*F0)<<1)+f,Math.round(w))}function Vg(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class N1{constructor(){this.acc=new Ae(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ae(o.x,o.y),this.max=new Ae(o.x,o.y))}append(o,l){this.currentPolyCount.edges++,this.acc._add(o);const d=this.min,f=this.max;o.x<d.x?d.x=o.x:o.x>f.x&&(f.x=o.x),o.y<d.y?d.y=o.y:o.y>f.y&&(f.y=o.y),((0===o.x||o.x===On)&&o.x===l.x)!=((0===o.y||o.y===On)&&o.y===l.y)&&this.processBorderOverlap(o,l),l.x<0!=o.x<0&&this.addBorderIntersection(0,Vi(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>On!=o.x>On&&this.addBorderIntersection(1,Vi(l.y,o.y,(On-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,Vi(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>On!=o.y>On&&this.addBorderIntersection(3,Vi(l.x,o.x,(On-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[o];l<d[0]&&(d[0]=l),l>d[1]&&(d[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const d=0===o.x?0:1;this.addBorderIntersection(d,l.y),this.addBorderIntersection(d,o.y)}else{const d=0===o.y?2:3;this.addBorderIntersection(d,l.x),this.addBorderIntersection(d,o.x)}}centroid(){const o=this.polyCount.reduce((l,d)=>l+d.edges,0);return 0!==o?this.acc.div(o)._round():new Ae(0,0)}span(){return new Ae(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0)}}class jg{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new Tt,this.centroidVertexArray=new Pl,this.indexArray=new Dn,this.programConfigurations=new ap(o.layers,o.zoom),this.segments=new $r,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=o.enableTerrain}populate(o,l,d,f){this.features=[],this.hasPattern=Bg("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(b){const v=Math.exp(Math.PI*(1-b.y/(1<<b.z)*2));return 80150034*v/(v*v+1)/On/(1<<b.z)}(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:b,id:v,index:w,sourceLayerIndex:T}of o){const E=this.layers[0]._featureFilter.needGeometry,k=Vu(b,E);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),k,d))continue;const P={id:v,sourceLayerIndex:T,index:w,geometry:E?k.geometry:Yc(b,d,f),properties:b.properties,type:b.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(zg("fill-extrusion",this.layers,P,this.zoom,l)):this.addFeature(P,P.geometry,w,d,{},l.availableImages,f),l.featureIndex.insert(b,P.geometry,w,T,this.index,L)}this.sortBorders()}addFeatures(o,l,d,f,b){for(const v of this.features){const{geometry:w}=v;this.addFeature(v,w,v.index,l,d,f,b)}this.sortBorders()}update(o,l,d,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Ha),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,M1.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,I1.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,d,f,b,v,w){const T=[new Ae(0,0),new Ae(On,On)],E=w.projection,k="globe"===E.name,P=this.enableTerrain&&!k?new N1:null,L="Polygon"===O0[o.type];k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ut);const N=qf(l,500);for(let de=N.length-1;de>=0;de--){const De=N[de];(0===De.length||(z=De[0]).every(he=>he.x<=0)||z.every(he=>he.x>=On)||z.every(he=>he.y<=0)||z.every(he=>he.y>=On))&&N.splice(de,1)}var z;let G;if(k)G=z0(N,T,f);else{G=[];for(const de of N)G.push({polygon:de,bounds:T})}const ee=L?this.edgeRadius:0;for(const{polygon:de,bounds:De}of G){let he=0,we=0;for(const Pe of de)L&&!Pe[0].equals(Pe[Pe.length-1])&&Pe.push(Pe[0]),we+=L?Pe.length-1:Pe.length;const Re=this.segments.prepareSegment((L?5:4)*we,this.layoutVertexArray,this.indexArray);if(L){const Pe=[],at=[];he=Re.vertexLength;for(const yt of de){let Ht,dt;yt.length&&yt!==de[0]&&at.push(Pe.length/2),Ht=yt[1].sub(yt[0])._perp()._unit();for(let Mt=1;Mt<yt.length;Mt++){const Et=yt[Mt],Ot=yt[Mt===yt.length-1?1:Mt+1];let{x:Wt,y:mt}=Et;if(ee){dt=Ot.sub(Et)._perp()._unit();const an=Ht.add(dt)._unit(),gn=ee*Math.min(4,1/(Ht.x*an.x+Ht.y*an.y));Wt+=gn*an.x,mt+=gn*an.y,Ht=dt}bp(this.layoutVertexArray,Wt,mt,0,0,1,1,0),Re.vertexLength++,Pe.push(Et.x,Et.y),k&&Vg(this.layoutVertexExtArray,E.projectTilePoint(Wt,mt,f),E.upVector(f,Wt,mt))}}const rt=Q_(Pe,at);for(let yt=0;yt<rt.length;yt+=3)this.indexArray.emplaceBack(he+rt[yt],he+rt[yt+2],he+rt[yt+1]),Re.primitiveLength++}for(const Pe of de){P&&Pe.length&&P.startRing(Pe[0]);let at,rt,yt,Ht=Pe.length>4&&ny(Pe[Pe.length-2],Pe[0],Pe[1]),dt=ee?ty(Pe[Pe.length-2],Pe[0],Pe[1],ee):0;rt=Pe[1].sub(Pe[0])._perp()._unit();let Mt=!0;for(let Et=1,Ot=0;Et<Pe.length;Et++){let Wt=Pe[Et-1],mt=Pe[Et];const an=Pe[Et===Pe.length-1?1:Et+1];if(P&&L&&P.currentPolyCount.top++,z1(mt,Wt,De)){ee&&(rt=an.sub(mt)._perp()._unit(),Mt=!Mt);continue}P&&P.append(mt,Wt);const gn=mt.sub(Wt)._perp(),dn=gn.x/(Math.abs(gn.x)+Math.abs(gn.y)),Zn=gn.y>0?1:0,Yt=Wt.dist(mt);if(Ot+Yt>32768&&(Ot=0),ee){yt=an.sub(mt)._perp()._unit();let ti=B1(Wt,mt,an,Ug(rt,yt),ee);isNaN(ti)&&(ti=0);const Vn=mt.sub(Wt)._unit();Wt=Wt.add(Vn.mult(dt))._round(),mt=mt.add(Vn.mult(-ti))._round(),dt=ti,rt=yt}const Pn=Re.vertexLength,ei=Pe.length>4&&ny(Wt,mt,an);let Hi=N0(Ot,Ht,Mt);if(bp(this.layoutVertexArray,Wt.x,Wt.y,dn,Zn,0,0,Hi),bp(this.layoutVertexArray,Wt.x,Wt.y,dn,Zn,0,1,Hi),Ot+=Yt,Hi=N0(Ot,ei,!Mt),Ht=ei,bp(this.layoutVertexArray,mt.x,mt.y,dn,Zn,0,0,Hi),bp(this.layoutVertexArray,mt.x,mt.y,dn,Zn,0,1,Hi),Re.vertexLength+=4,this.indexArray.emplaceBack(Pn+0,Pn+1,Pn+2),this.indexArray.emplaceBack(Pn+1,Pn+3,Pn+2),Re.primitiveLength+=2,ee){const ti=he+(1===Et?Pe.length-2:Et-2),Vn=1===Et?he:ti+1;if(this.indexArray.emplaceBack(Pn+1,ti,Pn+3),this.indexArray.emplaceBack(ti,Vn,Pn+3),Re.primitiveLength+=2,void 0===at&&(at=Pn),!z1(an,Pe[Et],De)){const Wi=Et===Pe.length-1?at:Re.vertexLength;this.indexArray.emplaceBack(Pn+2,Pn+3,Wi),this.indexArray.emplaceBack(Pn+3,Wi+1,Wi),this.indexArray.emplaceBack(Pn+3,Vn,Wi+1),Re.primitiveLength+=3}Mt=!Mt}if(k){const ti=this.layoutVertexExtArray,Vn=E.projectTilePoint(Wt.x,Wt.y,f),Wi=E.projectTilePoint(mt.x,mt.y,f),Yn=E.upVector(f,Wt.x,Wt.y),Kn=E.upVector(f,mt.x,mt.y);Vg(ti,Vn,Yn),Vg(ti,Vn,Yn),Vg(ti,Wi,Kn),Vg(ti,Wi,Kn)}}L&&(he+=Pe.length-1)}}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const de=P.borders,De=this.featuresOnBorder.push(P)-1;for(let he=0;he<4;he++)de[he][0]!==Number.MAX_VALUE&&this.borders[he].push(De)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,b,v,f)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((l,d)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[d].borders[o][0])}encodeCentroid(o,l,d=!0){let f,b;if(o)if(0!==o.y){const w=l.span()._mult(this.tileToMeter);f=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(w.x/10)),b=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else f=Math.ceil(7*(o.x+450)),b=0;else f=0,b=+d;let v=d?this.centroidVertexArray.length:l.vertexArrayOffset;for(const w of l.polyCount){d&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let T=0;T<w.top;T++)this.centroidVertexArray.emplace(v++,f,b);for(let T=0;T<2*w.edges;T++)this.centroidVertexArray.emplace(v++,0,b),this.centroidVertexArray.emplace(v++,f,b)}}}function Ug(a,o){const l=a.add(o)._unit();return a.x*l.x+a.y*l.y}function ty(a,o,l,d){const f=o.sub(a)._perp()._unit(),b=l.sub(o)._perp()._unit();return B1(a,o,l,Ug(f,b),d)}function B1(a,o,l,d,f){const b=Math.sqrt(1-d*d);return Math.min(a.dist(o)/3,o.dist(l)/3,f*b/d)}function z1(a,o,l){return a.x<l[0].x&&o.x<l[0].x||a.x>l[1].x&&o.x>l[1].x||a.y<l[0].y&&o.y<l[0].y||a.y>l[1].y&&o.y>l[1].y}function ny(a,o,l){if(a.x<0||a.x>=On||o.x<0||o.x>=On||l.x<0||l.x>=On)return!1;const d=l.sub(o),f=d.perp(),b=a.sub(o);return(d.x*b.x+d.y*b.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(b.x*b.x+b.y*b.y))>-.866&&f.x*b.x+f.y*b.y<0}function N0(a,o,l){const d=o?2|a:-3&a;return l?1|d:-2&d}function B0(){const a=Math.PI/32,o=Math.tan(a),l=zf;return l*Math.sqrt(1+2*o*o)-l}function z0(a,o,l){const d=1<<l.z,f=Ua(l.x/d),b=Ua((l.x+1)/d),v=wr(l.y/d),w=wr((l.y+1)/d);return function(T,E,k,P,L=0,N){const z=[];if(!T.length||!k||!P)return z;const G=(Pe,at)=>{for(const rt of Pe)z.push({polygon:rt,bounds:at})},ee=Math.ceil(Math.log2(k)),de=Math.ceil(Math.log2(P)),De=ee-de,he=[];for(let Pe=0;Pe<Math.abs(De);Pe++)he.push(De>0?0:1);for(let Pe=0;Pe<Math.min(ee,de);Pe++)he.push(0),he.push(1);let we=T;if(we=Gu(we,E[0].y-L,E[1].y+L,1),we=Gu(we,E[0].x-L,E[1].x+L,0),!we.length)return z;const Re=[];for(he.length?Re.push({polygons:we,bounds:E,depth:0}):G(we,E);Re.length;){const Pe=Re.pop(),at=Pe.depth,rt=he[at],yt=Pe.bounds[0],Ht=Pe.bounds[1],dt=0===rt?yt.x:yt.y,Mt=0===rt?Ht.x:Ht.y,Et=N?N(rt,dt,Mt):.5*(dt+Mt),Ot=Gu(Pe.polygons,dt-L,Et+L,rt),Wt=Gu(Pe.polygons,Et-L,Mt+L,rt);if(Ot.length){const mt=[yt,new Ae(0===rt?Et:Ht.x,1===rt?Et:Ht.y)];he.length>at+1?Re.push({polygons:Ot,bounds:mt,depth:at+1}):G(Ot,mt)}if(Wt.length){const mt=[new Ae(0===rt?Et:yt.x,1===rt?Et:yt.y),Ht];he.length>at+1?Re.push({polygons:Wt,bounds:mt,depth:at+1}):G(Wt,mt)}}return z}(a,o,Math.ceil((b-f)/11.25),Math.ceil((v-w)/11.25),1,(T,E,k)=>{if(0===T)return.5*(E+k);{const P=wr((l.y+E/On)/d);return(Nl(.5*(wr((l.y+k/On)/d)+P))*d-l.y)*On}})}bn(jg,"FillExtrusionBucket",{omit:["layers","features"]}),bn(N1,"PartMetadata");const V1=new _e({"fill-extrusion-edge-radius":new $(_t["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var V0={paint:new _e({"fill-extrusion-opacity":new $(_t["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new te(_t["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $(_t["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $(_t["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new te(_t["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new te(_t["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new te(_t["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $(_t["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new $(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new $(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new $(_t["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:V1};function Gf(a,o,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[a*d-2*Math.PI*6378137/2,o*d-2*Math.PI*6378137/2]}class Wf{constructor(o,l,d){this.z=o,this.x=l,this.y=d,this.key=lr(0,o,o,l,d)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const d=(v=this.y,w=this.z,T=Gf(256*(b=this.x),256*(v=Math.pow(2,w)-v-1),w),E=Gf(256*(b+1),256*(v+1),w),T[0]+","+T[1]+","+E[0]+","+E[1]),f=function(b,v,w){let T,E="";for(let k=b;k>0;k--)T=1<<k-1,E+=(v&T?1:0)+(w&T?2:0);return E}(this.z,this.x,this.y);var b,v,w,T,E;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hg{constructor(o,l){this.wrap=o,this.canonical=l,this.key=lr(o,l.z,l.z,l.x,l.y)}}class js{constructor(o,l,d,f,b){this.overscaledZ=o,this.wrap=l,this.canonical=new Wf(d,+f,+b),this.key=0===l&&o===d?this.canonical.key:lr(l,o,d,f,b)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new js(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new js(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return lr(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-o;return lr(this.wrap*+l,o,o,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new js(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,d=2*this.canonical.x,f=2*this.canonical.y;return[new js(l,this.wrap,l,d,f),new js(l,this.wrap,l,d+1,f),new js(l,this.wrap,l,d,f+1),new js(l,this.wrap,l,d+1,f+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new js(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new js(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function lr(a,o,l,d,f){const b=1<<Math.min(l,22);let v=b*(f%b)+d%b;return a&&l<22&&(v+=b*b*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*v+l)+(o-l)}bn(Wf,"CanonicalTileID"),bn(js,"OverscaledTileID",{omit:["projMatrix"]});class _p extends Ae{constructor(o,l,d){super(o,l),this.z=d}}function Xf(a,o){return a.x*o.x+a.y*o.y}function _a(a,o){if(1===a.length){let l=0;const d=o[l++];let f;for(;!f||d.equals(f);)if(f=o[l++],!f)return 1/0;for(;l<o.length;l++){const b=o[l],v=a[0],w=f.sub(d),T=b.sub(d),E=v.sub(d),k=Xf(w,w),P=Xf(w,T),L=Xf(T,T),N=Xf(E,w),z=Xf(E,T),G=k*L-P*P,ee=(L*N-P*z)/G,de=(k*z-P*N)/G,De=d.z*(1-ee-de)+f.z*ee+b.z*de;if(isFinite(De))return De}return 1/0}{let l=1/0;for(const d of o)l=Math.min(l,d.z);return l}}function iy(a,o,l,d,f,b,v,w){const T=v*f.getElevationAt(a,o,!0,!0),E=0!==b[0],k=E?0===b[1]?v*(b[0]/7-450):v*function(P,L,N){const z=Math.floor(L[0]/8),G=Math.floor(L[1]/8),ee=10*(L[0]-8*z),de=10*(L[1]-8*G),De=P.getElevationAt(z,G,!0,!0),he=P.getMeterToDEM(N),we=Math.floor(.5*(ee*he-1)),Re=Math.floor(.5*(de*he-1)),Pe=P.tileCoordToPixel(z,G),at=2*we+1,rt=2*Re+1,yt=(gn=at,dn=rt,[(Wt=P).getElevationAtPixel(mt=Pe.x-we,an=Pe.y-Re,!0),Wt.getElevationAtPixel(mt+dn,an,!0),Wt.getElevationAtPixel(mt,an+dn,!0),Wt.getElevationAtPixel(mt+gn,an+dn,!0)]),Ht=Math.abs(yt[0]-yt[1]),dt=Math.abs(yt[2]-yt[3]),Mt=Math.abs(yt[0]-yt[2])+Math.abs(yt[1]-yt[3]),Et=Math.min(.25,.5*he*(Ht+dt)/at),Ot=Math.min(.25,.5*he*Mt/rt);var Wt,mt,an,gn,dn;return De+Math.max(Et*ee,Ot*de)}(f,b,w):T;return{base:T+(0===l)?-1:l,top:E?Math.max(k+d,T+l+2):T+d}}const j1=qe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:U1}=j1,H1=qe([{name:"a_packed",components:4,type:"Float32"}]),{members:$1}=H1,q1=ml.types,$I=Math.cos(Math.PI/180*37.5);class ry{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new ht,this.layoutVertexArray2=new jt,this.indexArray=new Dn,this.programConfigurations=new ap(o.layers,o.zoom),this.segments=new $r,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,d,f){this.hasPattern=Bg("line",this.layers,l);const b=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:k,id:P,index:L,sourceLayerIndex:N}of o){const z=this.layers[0]._featureFilter.needGeometry,G=Vu(k,z);if(!this.layers[0]._featureFilter.filter(new R(this.zoom),G,d))continue;const ee=b?b.evaluate(G,{},d):void 0,de={id:P,properties:k.properties,type:k.type,sourceLayerIndex:N,index:L,geometry:z?G.geometry:Yc(k,d,f),patterns:{},sortKey:ee};v.push(de)}b&&v.sort((k,P)=>k.sortKey-P.sortKey);const{lineAtlas:w,featureIndex:T}=l,E=this.addConstantDashes(w);for(const k of v){const{geometry:P,index:L,sourceLayerIndex:N}=k;if(E&&this.addFeatureDashes(k,w),this.hasPattern){const z=zg("line",this.layers,k,this.zoom,l);this.patternFeatures.push(z)}else this.addFeature(k,P,L,d,w.positions,l.availableImages);T.insert(o[L].feature,P,L,N,this.index)}}addConstantDashes(o){let l=!1;for(const d of this.layers){const f=d.paint.get("line-dasharray").value,b=d.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==b.kind)l=!0;else{const v=b.value,w=f.value;if(!w)continue;o.addDash(w,v)}}return l}addFeatureDashes(o,l){const d=this.zoom;for(const f of this.layers){const b=f.paint.get("line-dasharray").value,v=f.layout.get("line-cap").value;if("constant"===b.kind&&"constant"===v.kind)continue;let w,T;if("constant"===b.kind){if(w=b.value,!w)continue}else w=b.evaluate({zoom:d},o);T="constant"===v.kind?v.value:v.evaluate({zoom:d},o),l.addDash(w,T),o.patterns[f.id]=l.getKey(w,T)}}update(o,l,d,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,d,f)}addFeatures(o,l,d,f,b){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,l,d,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,$1)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,U1),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,d,f,b,v){const w=this.layers[0].layout,T=w.get("line-join").evaluate(o,{}),E=w.get("line-cap").evaluate(o,{}),k=w.get("line-miter-limit"),P=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const L of l)this.addLine(L,o,T,E,k,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,b,v,f)}addLine(o,l,d,f,b,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<o.length-1;de++)this.totalDistance+=o[de].dist(o[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===q1[l.type];let T=o.length;for(;T>=2&&o[T-1].equals(o[T-2]);)T--;let E=0;for(;E<T-1&&o[E].equals(o[E+1]);)E++;if(T<(w?3:2))return;"bevel"===d&&(b=1.05);const k=this.overscaling<=16?15*On/(512*this.overscaling):0,P=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let L,N,z,G,ee;this.e1=this.e2=-1,w&&(L=o[T-2],ee=o[E].sub(L)._unit()._perp());for(let de=E;de<T;de++){if(z=de===T-1?w?o[E+1]:void 0:o[de+1],z&&o[de].equals(z))continue;ee&&(G=ee),L&&(N=L),L=o[de],ee=z?z.sub(L)._unit()._perp():G,G=G||ee;let De=G.add(ee);0===De.x&&0===De.y||De._unit();const he=G.x*ee.x+G.y*ee.y,we=De.x*ee.x+De.y*ee.y,Re=0!==we?1/we:1/0,Pe=2*Math.sqrt(2-2*we),at=we<$I&&N&&z,rt=G.x*ee.y-G.y*ee.x>0;if(at&&de>E){const dt=L.dist(N);if(dt>2*k){const Mt=L.sub(L.sub(N)._mult(k/dt)._round());this.updateDistance(N,Mt),this.addCurrentVertex(Mt,G,0,0,P),N=Mt}}const yt=N&&z;let Ht=yt?d:w?"butt":f;if(yt&&"round"===Ht&&(Re<v?Ht="miter":Re<=2&&(Ht="fakeround")),"miter"===Ht&&Re>b&&(Ht="bevel"),"bevel"===Ht&&(Re>2&&(Ht="flipbevel"),Re<b&&(Ht="miter")),N&&this.updateDistance(N,L),"miter"===Ht)De._mult(Re),this.addCurrentVertex(L,De,0,0,P);else if("flipbevel"===Ht){if(Re>100)De=ee.mult(-1);else{const dt=Re*G.add(ee).mag()/G.sub(ee).mag();De._perp()._mult(dt*(rt?-1:1))}this.addCurrentVertex(L,De,0,0,P),this.addCurrentVertex(L,De.mult(-1),0,0,P)}else if("bevel"===Ht||"fakeround"===Ht){const dt=-Math.sqrt(Re*Re-1),Mt=rt?dt:0,Et=rt?0:dt;if(N&&this.addCurrentVertex(L,G,Mt,Et,P),"fakeround"===Ht){const Ot=Math.round(180*Pe/Math.PI/20);for(let Wt=1;Wt<Ot;Wt++){let mt=Wt/Ot;if(.5!==mt){const gn=mt-.5;mt+=mt*gn*(mt-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*gn*gn+(.848013+he*(.215638*he-1.06021)))}const an=ee.sub(G)._mult(mt)._add(G)._unit()._mult(rt?-1:1);this.addHalfVertex(L,an.x,an.y,!1,rt,0,P)}}z&&this.addCurrentVertex(L,ee,-Mt,-Et,P)}else if("butt"===Ht)this.addCurrentVertex(L,De,0,0,P);else if("square"===Ht){const dt=N?1:-1;N||this.addCurrentVertex(L,De,dt,dt,P),this.addCurrentVertex(L,De,0,0,P),N&&this.addCurrentVertex(L,De,dt,dt,P)}else"round"===Ht&&(N&&(this.addCurrentVertex(L,G,0,0,P),this.addCurrentVertex(L,G,1,1,P,!0)),z&&(this.addCurrentVertex(L,ee,-1,-1,P,!0),this.addCurrentVertex(L,ee,0,0,P)));if(at&&de<T-1){const dt=L.dist(z);if(dt>2*k){const Mt=L.add(z.sub(L)._mult(k/dt)._round());this.updateDistance(L,Mt),this.addCurrentVertex(Mt,ee,0,0,P),L=Mt}}}}addCurrentVertex(o,l,d,f,b,v=!1){const w=l.y*f-l.x,T=-l.y-l.x*f;this.addHalfVertex(o,l.x+l.y*d,l.y-l.x*d,v,!1,d,b),this.addHalfVertex(o,w,T,v,!0,-f,b)}addHalfVertex({x:o,y:l},d,f,b,v,w,T){this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(l<<1)+(v?1:0),Math.round(63*d)+128,Math.round(63*f)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),T.primitiveLength++),v?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,l){this.distance+=o.dist(l),this.updateScaledDistance()}}bn(ry,"LineBucket",{omit:["layers","patternFeatures"]});const Zf=new _e({"line-cap":new te(_t.layout_line["line-cap"]),"line-join":new te(_t.layout_line["line-join"]),"line-miter-limit":new $(_t.layout_line["line-miter-limit"]),"line-round-limit":new $(_t.layout_line["line-round-limit"]),"line-sort-key":new te(_t.layout_line["line-sort-key"])});var $g={paint:new _e({"line-opacity":new te(_t.paint_line["line-opacity"]),"line-color":new te(_t.paint_line["line-color"]),"line-translate":new $(_t.paint_line["line-translate"]),"line-translate-anchor":new $(_t.paint_line["line-translate-anchor"]),"line-width":new te(_t.paint_line["line-width"]),"line-gap-width":new te(_t.paint_line["line-gap-width"]),"line-offset":new te(_t.paint_line["line-offset"]),"line-blur":new te(_t.paint_line["line-blur"]),"line-dasharray":new te(_t.paint_line["line-dasharray"]),"line-pattern":new te(_t.paint_line["line-pattern"]),"line-gradient":new me(_t.paint_line["line-gradient"]),"line-trim-offset":new $(_t.paint_line["line-trim-offset"])}),layout:Zf};const oy=new class extends te{possiblyEvaluate(a,o){return o=new R(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,l,d){return o=Fi({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,l,d)}}($g.paint.properties["line-width"].specification);function sy(a,o){return o>0?o+2*a:a}oy.useIntegerZoom=!0;const j0=qe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),G1=qe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),U0=qe([{name:"a_projected_pos",components:4,type:"Float32"}],4);qe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const H0=qe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),ay=qe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const W1=qe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),X1=qe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);qe([{name:"triangle",components:3,type:"Uint16"}]),qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),qe([{type:"Float32",name:"offsetX"}]),qe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const gl=128;function qg(a,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new R(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:d,interpolationType:f}=l;let b=0;for(;b<d.length&&d[b]<=a;)b++;b=Math.max(0,b-1);let v=b;for(;v<d.length&&d[v]<a+1;)v++;v=Math.min(d.length-1,v);const w=d[b],T=d[v];return"composite"===l.kind?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:T,minSize:l.evaluate(new R(w)),maxSize:l.evaluate(new R(T)),interpolationType:f}}}function mc(a,{uSize:o,uSizeT:l},{lowerSize:d,upperSize:f}){return"source"===a.kind?d/gl:"composite"===a.kind?Vi(d/gl,f/gl,l):o}function yp(a,o){let l=0,d=0;if("constant"===a.kind)d=a.layoutSize;else if("source"!==a.kind){const{interpolationType:f,minZoom:b,maxZoom:v}=a,w=f?Dt(so.interpolationFactor(f,o,b,v),0,1):0;"camera"===a.kind?d=Vi(a.minSize,a.maxSize,w):l=w}return{uSizeT:l,uSize:d}}var ly=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:gl,evaluateSizeForFeature:mc,evaluateSizeForZoom:yp,getSizeData:qg});function Gg(a,o,l){return a.sections.forEach(d=>{d.text=function(f,b,v){const w=b.layout.get("text-transform").evaluate(v,{});return"uppercase"===w?f=f.toLocaleUpperCase():"lowercase"===w&&(f=f.toLocaleLowerCase()),M.applyArabicShaping&&(f=M.applyArabicShaping(f)),f}(d.text,o,l)}),a}const Yf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function cy(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function Wg(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var Jc=Mr,uy=function(a,o,l,d,f){var b,v,w=8*f-d-1,T=(1<<w)-1,E=T>>1,k=-7,P=l?f-1:0,L=l?-1:1,N=a[o+P];for(P+=L,b=N&(1<<-k)-1,N>>=-k,k+=w;k>0;b=256*b+a[o+P],P+=L,k-=8);for(v=b&(1<<-k)-1,b>>=-k,k+=d;k>0;v=256*v+a[o+P],P+=L,k-=8);if(0===b)b=1-E;else{if(b===T)return v?NaN:1/0*(N?-1:1);v+=Math.pow(2,d),b-=E}return(N?-1:1)*v*Math.pow(2,b-d)},Xg=function(a,o,l,d,f,b){var v,w,T,E=8*b-f-1,k=(1<<E)-1,P=k>>1,L=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,N=d?0:b-1,z=d?1:-1,G=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,v=k):(v=Math.floor(Math.log(o)/Math.LN2),o*(T=Math.pow(2,-v))<1&&(v--,T*=2),(o+=v+P>=1?L/T:L*Math.pow(2,1-P))*T>=2&&(v++,T/=2),v+P>=k?(w=0,v=k):v+P>=1?(w=(o*T-1)*Math.pow(2,f),v+=P):(w=o*Math.pow(2,P-1)*Math.pow(2,f),v=0));f>=8;a[l+N]=255&w,N+=z,w/=256,f-=8);for(v=v<<f|w,E+=f;E>0;a[l+N]=255&v,N+=z,v/=256,E-=8);a[l+N-z]|=128*G};function Mr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Mr.Varint=0,Mr.Fixed64=1,Mr.Bytes=2,Mr.Fixed32=5;var dy=4294967296,hy=1/dy,Jd="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function eu(a){return a.type===Mr.Bytes?a.readVarint()+a.pos:a.pos+1}function $0(a,o,l){var d=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));l.realloc(d);for(var f=l.pos-1;f>=a;f--)l.buf[f+d]=l.buf[f]}function Z1(a,o){for(var l=0;l<a.length;l++)o.writeVarint(a[l])}function py(a,o){for(var l=0;l<a.length;l++)o.writeSVarint(a[l])}function Y1(a,o){for(var l=0;l<a.length;l++)o.writeFloat(a[l])}function q0(a,o){for(var l=0;l<a.length;l++)o.writeDouble(a[l])}function K1(a,o){for(var l=0;l<a.length;l++)o.writeBoolean(a[l])}function G0(a,o){for(var l=0;l<a.length;l++)o.writeFixed32(a[l])}function qI(a,o){for(var l=0;l<a.length;l++)o.writeSFixed32(a[l])}function Q1(a,o){for(var l=0;l<a.length;l++)o.writeFixed64(a[l])}function eh(a,o){for(var l=0;l<a.length;l++)o.writeSFixed64(a[l])}function Zg(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function zl(a,o,l){a[l]=o,a[l+1]=o>>>8,a[l+2]=o>>>16,a[l+3]=o>>>24}function En(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}Mr.prototype={destroy:function(){this.buf=null},readFields:function(a,o,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),f=d>>3,b=this.pos;this.type=7&d,a(f,o,this),this.pos===b&&this.skip(d)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=Zg(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=En(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Zg(this.buf,this.pos)+Zg(this.buf,this.pos+4)*dy;return this.pos+=8,a},readSFixed64:function(){var a=Zg(this.buf,this.pos)+En(this.buf,this.pos+4)*dy;return this.pos+=8,a},readFloat:function(){var a=uy(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=uy(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,l,d=this.buf;return o=127&(l=d[this.pos++]),l<128?o:(o|=(127&(l=d[this.pos++]))<<7,l<128?o:(o|=(127&(l=d[this.pos++]))<<14,l<128?o:(o|=(127&(l=d[this.pos++]))<<21,l<128?o:function(f,b,v){var w,T,E=v.buf;if(w=(112&(T=E[v.pos++]))>>4,T<128||(w|=(127&(T=E[v.pos++]))<<3,T<128)||(w|=(127&(T=E[v.pos++]))<<10,T<128)||(w|=(127&(T=E[v.pos++]))<<17,T<128)||(w|=(127&(T=E[v.pos++]))<<24,T<128)||(w|=(1&(T=E[v.pos++]))<<31,T<128))return function vp(a,o,l){return l?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(f,w,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(l=d[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&Jd?Jd.decode(this.buf.subarray(o,a)):function(l,d,f){for(var b="",v=d;v<f;){var w,T,E,k=l[v],P=null,L=k>239?4:k>223?3:k>191?2:1;if(v+L>f)break;1===L?k<128&&(P=k):2===L?128==(192&(w=l[v+1]))&&(P=(31&k)<<6|63&w)<=127&&(P=null):3===L?(T=l[v+2],128==(192&(w=l[v+1]))&&128==(192&T)&&((P=(15&k)<<12|(63&w)<<6|63&T)<=2047||P>=55296&&P<=57343)&&(P=null)):4===L&&(T=l[v+2],E=l[v+3],128==(192&(w=l[v+1]))&&128==(192&T)&&128==(192&E)&&((P=(15&k)<<18|(63&w)<<12|(63&T)<<6|63&E)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,L=1):P>65535&&(P-=65536,b+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),b+=String.fromCharCode(P),v+=L}return b}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==Mr.Bytes)return a.push(this.readVarint(o));var l=eu(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==Mr.Bytes)return a.push(this.readSVarint());var o=eu(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Mr.Bytes)return a.push(this.readBoolean());var o=eu(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Mr.Bytes)return a.push(this.readFloat());var o=eu(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Mr.Bytes)return a.push(this.readDouble());var o=eu(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Mr.Bytes)return a.push(this.readFixed32());var o=eu(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Mr.Bytes)return a.push(this.readSFixed32());var o=eu(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Mr.Bytes)return a.push(this.readFixed64());var o=eu(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Mr.Bytes)return a.push(this.readSFixed64());var o=eu(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===Mr.Varint)for(;this.buf[this.pos++]>127;);else if(o===Mr.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Mr.Fixed32)this.pos+=4;else{if(o!==Mr.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var l=new Uint8Array(o);l.set(this.buf),this.buf=l,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),zl(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),zl(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),zl(this.buf,-1&a,this.pos),zl(this.buf,Math.floor(a*hy),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),zl(this.buf,-1&a,this.pos),zl(this.buf,Math.floor(a*hy),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,l){var d,f,b,w;if(o>=0?(d=o%4294967296|0,f=o/4294967296|0):(f=~(-o/4294967296),4294967295^(d=~(-o%4294967296))?d=d+1|0:(d=0,f=f+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),b=d,(w=l).buf[w.pos++]=127&b|128,b>>>=7,w.buf[w.pos++]=127&b|128,b>>>=7,w.buf[w.pos++]=127&b|128,b>>>=7,w.buf[w.pos++]=127&b|128,w.buf[w.pos]=127&(b>>>=7),function(b,v){var w=(7&b)<<4;v.buf[v.pos++]|=w|((b>>>=3)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b|((b>>>=7)?128:0),b&&(v.buf[v.pos++]=127&b)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(d,f,b){for(var v,w,T=0;T<f.length;T++){if((v=f.charCodeAt(T))>55295&&v<57344){if(!w){v>56319||T+1===f.length?(d[b++]=239,d[b++]=191,d[b++]=189):w=v;continue}if(v<56320){d[b++]=239,d[b++]=191,d[b++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(d[b++]=239,d[b++]=191,d[b++]=189,w=null);v<128?d[b++]=v:(v<2048?d[b++]=v>>6|192:(v<65536?d[b++]=v>>12|224:(d[b++]=v>>18|240,d[b++]=v>>12&63|128),d[b++]=v>>6&63|128),d[b++]=63&v|128)}return b}(this.buf,a,this.pos);var l=this.pos-o;l>=128&&$0(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),Xg(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Xg(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var l=0;l<o;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,o){this.pos++;var l=this.pos;a(o,this);var d=this.pos-l;d>=128&&$0(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,o,l){this.writeTag(a,Mr.Bytes),this.writeRawMessage(o,l)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,Z1,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,py,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,K1,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,Y1,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,q0,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,G0,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,qI,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,Q1,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,eh,o)},writeBytesField:function(a,o){this.writeTag(a,Mr.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,Mr.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,Mr.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,Mr.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,Mr.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,Mr.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,Mr.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,Mr.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,Mr.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,Mr.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,Boolean(o))}};var Yg=vn(Jc);function Kf(a,o,l){o.glyphs=[],1===a&&l.readMessage(gc,o)}function gc(a,o,l){if(3===a){const{id:d,bitmap:f,width:b,height:v,left:w,top:T,advance:E}=l.readMessage(J1,{});o.glyphs.push({id:d,bitmap:new Kc({width:b+6,height:v+6},f),metrics:{width:b,height:v,left:w,top:T,advance:E}})}else 4===a?o.ascender=l.readSVarint():5===a&&(o.descender=l.readSVarint())}function J1(a,o,l){1===a?o.id=l.readVarint():2===a?o.bitmap=l.readBytes():3===a?o.width=l.readVarint():4===a?o.height=l.readVarint():5===a?o.left=l.readSVarint():6===a?o.top=l.readSVarint():7===a&&(o.advance=l.readVarint())}function tu(a){let o=0,l=0;for(const v of a)o+=v.w*v.h,l=Math.max(l,v.w);a.sort((v,w)=>w.h-v.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let f=0,b=0;for(const v of a)for(let w=d.length-1;w>=0;w--){const T=d[w];if(!(v.w>T.w||v.h>T.h)){if(v.x=T.x,v.y=T.y,b=Math.max(b,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===T.w&&v.h===T.h){const E=d.pop();w<d.length&&(d[w]=E)}else v.h===T.h?(T.x+=v.w,T.w-=v.w):v.w===T.w?(T.y+=v.h,T.h-=v.h):(d.push({x:T.x+v.w,y:T.y,w:T.w-v.w,h:v.h}),T.y+=v.h,T.h-=v.h);break}}return{w:f,h:b,fill:o/(f*b)||0}}class Qf{constructor(o,{pixelRatio:l,version:d,stretchX:f,stretchY:b,content:v}){this.paddedRect=o,this.pixelRatio=l,this.stretchX=f,this.stretchY=b,this.content=v,this.version=d}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Kg{constructor(o,l){const d={},f={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,d,b),this.addImages(l,f,b);const{w:v,h:w}=tu(b),T=new Js({width:v||1,height:w||1});for(const E in o){const k=o[E],P=d[E].paddedRect;Js.copy(k.data,T,{x:0,y:0},{x:P.x+1,y:P.y+1},k.data)}for(const E in l){const k=l[E],P=f[E].paddedRect,L=P.x+1,N=P.y+1,z=k.data.width,G=k.data.height;Js.copy(k.data,T,{x:0,y:0},{x:L,y:N},k.data),Js.copy(k.data,T,{x:0,y:G-1},{x:L,y:N-1},{width:z,height:1}),Js.copy(k.data,T,{x:0,y:0},{x:L,y:N+G},{width:z,height:1}),Js.copy(k.data,T,{x:z-1,y:0},{x:L-1,y:N},{width:1,height:G}),Js.copy(k.data,T,{x:0,y:0},{x:L+z,y:N},{width:1,height:G})}this.image=T,this.iconPositions=d,this.patternPositions=f}addImages(o,l,d){for(const f in o){const b=o[f],v={x:0,y:0,w:b.data.width+2,h:b.data.height+2};d.push(v),l[f]=new Qf(v,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>o.hasImage(d)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in o.updatedImages)this.patchUpdatedImage(this.iconPositions[d],o.getImage(d),l),this.patchUpdatedImage(this.patternPositions[d],o.getImage(d),l)}patchUpdatedImage(o,l,d){if(!o||!l||o.version===l.version)return;o.version=l.version;const[f,b]=o.tl;d.update(l.data,void 0,{x:f,y:b})}}bn(Qf,"ImagePosition"),bn(Kg,"ImageAtlas");const qa={horizontal:1,vertical:2,horizontalOnly:3};class bl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const d=new bl;return d.scale=o||1,d.fontStack=l,d}static forImage(o){const l=new bl;return l.imageName=o,l}}class xp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const d=new xp;for(let f=0;f<o.sections.length;f++){const b=o.sections[f];b.image?d.addImageSection(b):d.addTextSection(b,l)}return d}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(l,d){let f="";for(let b=0;b<l.length;b++){const v=l.charCodeAt(b+1)||null,w=l.charCodeAt(b-1)||null;f+=!d&&(v&&sg(v)&&!Yf[l[b+1]]||w&&sg(w)&&!Yf[l[b-1]])||!Yf[l[b]]?l[b]:Yf[l[b]]}return f}(this.text,o)}trim(){let o=0;for(let d=0;d<this.text.length&&Jg[this.text.charCodeAt(d)];d++)o++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=o&&Jg[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const d=new xp;return d.text=this.text.substring(o,l),d.sectionIndex=this.sectionIndex.slice(o,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(bl.forText(o.scale,o.fontStack||l));const d=this.sections.length-1;for(let f=0;f<o.text.length;++f)this.sectionIndex.push(d)}addImageSection(o){const l=o.image?o.image.name:"";if(0===l.length)return void Jn("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(bl.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Jn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fy(a,o,l,d,f,b,v,w,T,E,k,P,L,N,z){const G=xp.fromFeature(a,f);P===qa.vertical&&G.verticalizePunctuation(L);let ee=[];const de=function(Pe,at,rt,yt,Ht,dt){if(!Pe)return[];const Mt=[],Et=function(an,gn,dn,Zn,Yt,Pn){let ei=0;for(let Hi=0;Hi<an.length();Hi++){const ti=an.getSection(Hi);ei+=Z0(an.getCharCode(Hi),ti,Zn,Yt,gn,Pn)}return ei/Math.max(1,Math.ceil(ei/dn))}(Pe,at,rt,yt,Ht,dt),Ot=Pe.text.indexOf("\u200b")>=0;let Wt=0;for(let an=0;an<Pe.length();an++){const gn=Pe.getSection(an),dn=Pe.getCharCode(an);if(Jg[dn]||(Wt+=Z0(dn,gn,yt,Ht,at,dt)),an<Pe.length()-1){const Zn=!((mt=dn)<11904||!(sn_Bopomofo_Extended(mt)||sn_Bopomofo(mt)||sn_CJK_Compatibility_Forms(mt)||sn_CJK_Compatibility_Ideographs(mt)||sn_CJK_Compatibility(mt)||sn_CJK_Radicals_Supplement(mt)||sn_CJK_Strokes(mt)||sn_CJK_Symbols_and_Punctuation(mt)||sn_CJK_Unified_Ideographs_Extension_A(mt)||sn_CJK_Unified_Ideographs(mt)||sn_Enclosed_CJK_Letters_and_Months(mt)||sn_Halfwidth_and_Fullwidth_Forms(mt)||sn_Hiragana(mt)||sn_Ideographic_Description_Characters(mt)||sn_Kangxi_Radicals(mt)||sn_Katakana_Phonetic_Extensions(mt)||sn_Katakana(mt)||sn_Vertical_Forms(mt)||sn_Yi_Radicals(mt)||sn_Yi_Syllables(mt)));(eC[dn]||Zn||gn.imageName)&&Mt.push(th(an+1,Wt,Et,Mt,tC(dn,Pe.getCharCode(an+1),Zn&&Ot),!1))}}var mt;return bc(th(Pe.length(),Wt,Et,Mt,0,!0))}(G,E,b,o,d,N),{processBidirectionalText:De,processStyledBidirectionalText:he}=M;if(De&&1===G.sections.length){const Pe=De(G.toString(),de);for(const at of Pe){const rt=new xp;rt.text=at,rt.sections=G.sections;for(let yt=0;yt<at.length;yt++)rt.sectionIndex.push(0);ee.push(rt)}}else if(he){const Pe=he(G.text,G.sectionIndex,de);for(const at of Pe){const rt=new xp;rt.text=at[0],rt.sectionIndex=at[1],rt.sections=G.sections,ee.push(rt)}}else ee=function(Pe,at){const rt=[],yt=Pe.text;let Ht=0;for(const dt of at)rt.push(Pe.substring(Ht,dt)),Ht=dt;return Ht<yt.length&&rt.push(Pe.substring(Ht,yt.length)),rt}(G,de);const we=[],Re={positionedLines:we,text:G.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Pe,at,rt,yt,Ht,dt,Mt,Et,Ot,Wt,mt,an){let gn=0,dn=0,Zn=0;const Yt="right"===Et?1:"left"===Et?0:.5;let Pn=!1;for(const Yn of Ht){const Kn=Yn.getSections();for(const or of Kn){if(or.imageName)continue;const Ar=at[or.fontStack];if(Ar&&(Pn=void 0!==Ar.ascender&&void 0!==Ar.descender,!Pn))break}if(!Pn)break}let ei=0;for(const Yn of Ht){Yn.trim();const Kn=Yn.getMaxScale(),or=24*(Kn-1),Ar={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[ei]=Ar;const br=Ar.positionedGlyphs;let _r=0;if(!Yn.length()){dn+=dt,++ei;continue}let qr=0,Qr=0;for(let Sr=0;Sr<Yn.length();Sr++){const ko=Yn.getSection(Sr),bo=Yn.getSectionIndex(Sr),Jr=Yn.getCharCode(Sr);let Ji=ko.scale,_o=null,kr=null,Es=null,Xt=24,Zo=0;const Co=!(Ot===qa.horizontal||!mt&&!_f(Jr)||mt&&(Jg[Jr]||(Hi=Jr,sn_Arabic(Hi)||sn_Arabic_Supplement(Hi)||sn_Arabic_Extended_A(Hi)||sn_Arabic_Presentation_Forms_A(Hi)||sn_Arabic_Presentation_Forms_B(Hi))));if(ko.imageName){const Us=yt[ko.imageName];if(!Us)continue;Es=ko.imageName,Pe.iconsInText=Pe.iconsInText||!0,kr=Us.paddedRect;const No=Us.displaySize;Ji=24*Ji/an,_o={width:No[0],height:No[1],left:1,top:-3,advance:Co?No[1]:No[0],localGlyph:!1},Zo=Pn?-_o.height*Ji:24*Kn-17-No[1]*Ji,Xt=_o.advance;const Hl=(Co?No[0]:No[1])*Ji-24*Kn;Hl>0&&Hl>_r&&(_r=Hl)}else{const Us=rt[ko.fontStack];if(!Us)continue;Us[Jr]&&(kr=Us[Jr]);const No=at[ko.fontStack];if(!No)continue;const Hl=No.glyphs[Jr];if(!Hl)continue;if(_o=Hl.metrics,Xt=8203!==Jr?24:0,Pn){const Ap=void 0!==No.ascender?Math.abs(No.ascender):0,am=void 0!==No.descender?Math.abs(No.descender):0,lm=(Ap+am)*Ji;qr<lm&&(qr=lm,Qr=(Ap-am)/2*Ji),Zo=-Ap*Ji}else Zo=24*(Kn-Ji)-17}Co?(Pe.verticalizable=!0,br.push({glyph:Jr,imageName:Es,x:gn,y:dn+Zo,vertical:Co,scale:Ji,localGlyph:_o.localGlyph,fontStack:ko.fontStack,sectionIndex:bo,metrics:_o,rect:kr}),gn+=Xt*Ji+Wt):(br.push({glyph:Jr,imageName:Es,x:gn,y:dn+Zo,vertical:Co,scale:Ji,localGlyph:_o.localGlyph,fontStack:ko.fontStack,sectionIndex:bo,metrics:_o,rect:kr}),gn+=_o.advance*Ji+Wt)}0!==br.length&&(Zn=Math.max(gn-Wt,Zn),Pn?K0(br,Yt,_r,Qr,dt*Kn/2):K0(br,Yt,_r,0,dt/2)),gn=0;const Gr=dt*Kn+_r;Ar.lineOffset=Math.max(_r,or),dn+=Gr,++ei}var Hi;const ti=dn,{horizontalAlign:Vn,verticalAlign:Wi}=my(Mt);(function(Yn,Kn,or,Ar,br,_r){const qr=(Kn-or)*br,Qr=-_r*Ar;for(const Gr of Yn)for(const Sr of Gr.positionedGlyphs)Sr.x+=qr,Sr.y+=Qr})(Pe.positionedLines,Yt,Vn,Wi,Zn,ti),Pe.top+=-Wi*ti,Pe.bottom=Pe.top+ti,Pe.left+=-Vn*Zn,Pe.right=Pe.left+Zn,Pe.hasBaseline=Pn}(Re,o,l,d,ee,v,w,T,P,E,L,z),!function(Pe){for(const at of Pe)if(0!==at.positionedGlyphs.length)return!1;return!0}(we)&&Re}const Jg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},eC={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Z0(a,o,l,d,f,b){if(o.imageName){const v=d[o.imageName];return v?v.displaySize[0]*o.scale*24/b+f:0}{const v=l[o.fontStack],w=v&&v.glyphs[a];return w?w.metrics.advance*o.scale+f:0}}function Y0(a,o,l,d){const f=Math.pow(a-o,2);return d?a<o?f/2:2*f:f+Math.abs(l)*l}function tC(a,o,l){let d=0;return 10===a&&(d-=1e4),l&&(d+=150),40!==a&&65288!==a||(d+=50),41!==o&&65289!==o||(d+=50),d}function th(a,o,l,d,f,b){let v=null,w=Y0(o,l,f,b);for(const T of d){const E=Y0(o-T.x,l,f,b)+T.badness;E<=w&&(v=T,w=E)}return{index:a,x:o,priorBreak:v,badness:w}}function bc(a){return a?bc(a.priorBreak).concat(a.index):[]}function my(a){let o=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function K0(a,o,l,d,f){if(!(o||l||d||f))return;const b=a.length-1,v=a[b],w=(v.x+v.metrics.advance*v.scale)*o;for(let T=0;T<=b;T++)a[T].x-=w,a[T].y+=l+d+f}function GI(a,o,l){const{horizontalAlign:d,verticalAlign:f}=my(l),b=o[0]-a.displaySize[0]*d,v=o[1]-a.displaySize[1]*f;return{image:a,top:v,bottom:v+a.displaySize[1],left:b,right:b+a.displaySize[0]}}function nC(a,o,l,d,f,b){const v=a.image;let w;if(v.content){const ee=v.content,de=v.pixelRatio||1;w=[ee[0]/de,ee[1]/de,v.displaySize[0]-ee[2]/de,v.displaySize[1]-ee[3]/de]}const T=o.left*b,E=o.right*b;let k,P,L,N;"width"===l||"both"===l?(N=f[0]+T-d[3],P=f[0]+E+d[1]):(N=f[0]+(T+E-v.displaySize[0])/2,P=N+v.displaySize[0]);const z=o.top*b,G=o.bottom*b;return"height"===l||"both"===l?(k=f[1]+z-d[0],L=f[1]+G+d[2]):(k=f[1]+(z+G-v.displaySize[1])/2,L=k+v.displaySize[1]),{image:v,top:k,right:P,bottom:L,left:N,collisionPadding:w}}class _c extends Ae{constructor(o,l,d,f,b){super(o,l),this.angle=f,this.z=d,void 0!==b&&(this.segment=b)}clone(){return new _c(this.x,this.y,this.z,this.angle,this.segment)}}function iC(a,o,l,d,f){if(void 0===o.segment)return!0;let b=o,v=o.segment+1,w=0;for(;w>-l/2;){if(v--,v<0)return!1;w-=a[v].dist(b),b=a[v]}w+=a[v].dist(a[v+1]),v++;const T=[];let E=0;for(;w<l/2;){const k=a[v],P=a[v+1];if(!P)return!1;let L=a[v-1].angleTo(k)-k.angleTo(P);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:L}),E+=L;w-T[0].distance>d;)E-=T.shift().angleDelta;if(E>f)return!1;v++,w+=k.dist(P)}return!0}function gy(a){let o=0;for(let l=0;l<a.length-1;l++)o+=a[l].dist(a[l+1]);return o}function rC(a,o,l){return a?.6*o*l:0}function by(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function oC(a,o,l,d,f,b){const v=rC(l,f,b),w=by(l,d)*b;let T=0;const E=gy(a)/2;for(let k=0;k<a.length-1;k++){const P=a[k],L=a[k+1],N=P.dist(L);if(T+N>E){const z=(E-T)/N,G=Vi(P.x,L.x,z),ee=Vi(P.y,L.y,z),de=new _c(G,ee,0,L.angleTo(P),k);return!v||iC(a,de,w,v,o)?de:void 0}T+=N}}function Q0(a,o,l,d,f,b,v,w,T){const E=rC(d,b,v),k=by(d,f),P=k*v,L=0===a[0].x||a[0].x===T||0===a[0].y||a[0].y===T;return o-P<o/4&&(o=P+o/4),J0(a,L?o/2*w%o:(k/2+2*b)*v*w%o,o,E,l,P,L,!1,T)}function J0(a,o,l,d,f,b,v,w,T){const E=b/2,k=gy(a);let P=0,L=o-l,N=[];for(let z=0;z<a.length-1;z++){const G=a[z],ee=a[z+1],de=G.dist(ee),De=ee.angleTo(G);for(;L+l<P+de;){L+=l;const he=(L-P)/de,we=Vi(G.x,ee.x,he),Re=Vi(G.y,ee.y,he);if(we>=0&&we<T&&Re>=0&&Re<T&&L-E>=0&&L+E<=k){const Pe=new _c(we,Re,0,De,z);Pe._round(),d&&!iC(a,Pe,b,d,f)||N.push(Pe)}}P+=de}return w||N.length||v||(N=J0(a,P/2,l,d,f,b,v,!0,T)),N}function ex(a,o,l,d,f){const b=[];for(let v=0;v<a.length;v++){const w=a[v];let T;for(let E=0;E<w.length-1;E++){let k=w[E],P=w[E+1];k.x<o&&P.x<o||(k.x<o?k=new Ae(o,k.y+(o-k.x)/(P.x-k.x)*(P.y-k.y))._round():P.x<o&&(P=new Ae(o,k.y+(o-k.x)/(P.x-k.x)*(P.y-k.y))._round()),k.y<l&&P.y<l||(k.y<l?k=new Ae(k.x+(l-k.y)/(P.y-k.y)*(P.x-k.x),l)._round():P.y<l&&(P=new Ae(k.x+(l-k.y)/(P.y-k.y)*(P.x-k.x),l)._round()),k.x>=d&&P.x>=d||(k.x>=d?k=new Ae(d,k.y+(d-k.x)/(P.x-k.x)*(P.y-k.y))._round():P.x>=d&&(P=new Ae(d,k.y+(d-k.x)/(P.x-k.x)*(P.y-k.y))._round()),k.y>=f&&P.y>=f||(k.y>=f?k=new Ae(k.x+(f-k.y)/(P.y-k.y)*(P.x-k.x),f)._round():P.y>=f&&(P=new Ae(k.x+(f-k.y)/(P.y-k.y)*(P.x-k.x),f)._round()),T&&k.equals(T[T.length-1])||(T=[k],b.push(T)),T.push(P)))))}}return b}bn(_c,"Anchor");const ta=1e20;function tx(a,o,l,d,f,b,v,w,T){for(let E=o;E<o+d;E++)_y(a,l*b+E,b,f,v,w,T);for(let E=l;E<l+f;E++)_y(a,E*b+o,1,d,v,w,T)}function _y(a,o,l,d,f,b,v){b[0]=0,v[0]=-ta,v[1]=ta,f[0]=a[o];for(let w=1,T=0,E=0;w<d;w++){f[w]=a[o+w*l];const k=w*w;do{const P=b[T];E=(f[w]-f[P]+k-P*P)/(w-P)/2}while(E<=v[T]&&--T>-1);T++,b[T]=w,v[T]=E,v[T+1]=ta}for(let w=0,T=0;w<d;w++){for(;v[T+1]<w;)T++;const E=b[T],k=w-E;a[o+w*l]=f[E]+k*k}}const yy={none:0,ideographs:1,all:2};class wp{constructor(o,l,d){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=d,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,l){const d=[];for(const f in o)for(const b of o[f])d.push({stack:f,id:b});cn(d,({stack:f,id:b},v)=>{let w=this.entries[f];w||(w=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=w.glyphs[b];if(void 0!==T)return void v(null,{stack:f,id:b,glyph:T});if(T=this._tinySDF(w,f,b),T)return w.glyphs[b]=T,void v(null,{stack:f,id:b,glyph:T});const E=Math.floor(b/256);if(256*E>65535)return void v(new Error("glyphs > 65535 not supported"));if(w.ranges[E])return void v(null,{stack:f,id:b,glyph:T});let k=w.requests[E];k||(k=w.requests[E]=[],wp.loadGlyphRange(f,E,this.url,this.requestManager,(P,L)=>{if(L){w.ascender=L.ascender,w.descender=L.descender;for(const N in L.glyphs)this._doesCharSupportLocalGlyph(+N)||(w.glyphs[+N]=L.glyphs[+N]);w.ranges[E]=!0}for(const N of k)N(P,L);delete w.requests[E]})),k.push((P,L)=>{P?v(P):L&&v(null,{stack:f,id:b,glyph:L.glyphs[b]||null})})},(f,b)=>{if(f)l(f);else if(b){const v={};for(const{stack:w,id:T,glyph:E}of b)void 0===v[w]&&(v[w]={}),void 0===v[w].glyphs&&(v[w].glyphs={}),v[w].glyphs[T]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},v[w].ascender=this.entries[w].ascender,v[w].descender=this.entries[w].descender;l(null,v)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==yy.none&&(this.localGlyphMode===yy.all?!!this.localFontFamily:!!this.localFontFamily&&(sn_CJK_Unified_Ideographs(o)||sn_Hangul_Syllables(o)||sn_Hiragana(o)||sn_Katakana(o)||sn_CJK_Symbols_and_Punctuation(o)))}_tinySDF(o,l,d){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(d))return;let b=o.tinySDF;if(!b){let G="400";/bold/i.test(l)?G="900":/medium/i.test(l)?G="500":/light/i.test(l)&&(G="200"),b=o.tinySDF=new wp.TinySDF({fontFamily:f,fontWeight:G,fontSize:48,buffer:6,radius:16}),b.fontWeight=G}if(this.localGlyphs[b.fontWeight][d])return this.localGlyphs[b.fontWeight][d];const v=String.fromCharCode(d),{data:w,width:T,height:E,glyphWidth:k,glyphHeight:P,glyphLeft:L,glyphTop:N,glyphAdvance:z}=b.draw(v);return this.localGlyphs[b.fontWeight][d]={id:d,bitmap:new Kc({width:T,height:E},w),metrics:{width:k/2,height:P/2,left:L/2,top:N/2-27,advance:z/2,localGlyph:!0}}}}wp.loadGlyphRange=function(a,o,l,d,f){const b=256*o,v=b+255,w=d.transformRequest(d.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${b}-${v}`),Ea.Glyphs);bu(w,(T,E)=>{if(T)f(T);else if(E){const k={},P=new Yg(E).readFields(Kf,{});for(const L of P.glyphs)k[L.id]=L;f(null,{glyphs:k,ascender:P.ascender,descender:P.descender})}})},wp.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:l=8,cutoff:d=.25,fontFamily:f="sans-serif",fontWeight:b="normal",fontStyle:v="normal"}={}){this.buffer=o,this.cutoff=d,this.radius=l;const w=this.size=a+4*o,T=this._createCanvas(w),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${v} ${b} ${a}px ${f}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:d,actualBoundingBoxLeft:f,actualBoundingBoxRight:b}=this.ctx.measureText(a),v=Math.ceil(l),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-f))),T=Math.min(this.size-this.buffer,v+Math.ceil(d)),E=w+2*this.buffer,k=T+2*this.buffer,P=Math.max(E*k,0),L=new Uint8ClampedArray(P),N={data:L,width:E,height:k,glyphWidth:w,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:o};if(0===w||0===T)return N;const{ctx:z,buffer:G,gridInner:ee,gridOuter:de}=this;z.clearRect(G,G,w,T),z.fillText(a,G,G+v);const De=z.getImageData(G,G,w,T);de.fill(ta,0,P),ee.fill(0,0,P);for(let he=0;he<T;he++)for(let we=0;we<w;we++){const Re=De.data[4*(he*w+we)+3]/255;if(0===Re)continue;const Pe=(he+G)*E+we+G;if(1===Re)de[Pe]=0,ee[Pe]=ta;else{const at=.5-Re;de[Pe]=at>0?at*at:0,ee[Pe]=at<0?at*at:0}}tx(de,0,0,E,k,E,this.f,this.v,this.z),tx(ee,G,G,w,T,E,this.f,this.v,this.z);for(let he=0;he<P;he++){const we=Math.sqrt(de[he])-Math.sqrt(ee[he]);L[he]=Math.round(255-255*(we/this.radius+this.cutoff))}return N}};function vy(a,o,l,d){const f=[],b=a.image,v=b.pixelRatio,w=b.paddedRect.w-2,T=b.paddedRect.h-2,E=a.right-a.left,k=a.bottom-a.top,P=b.stretchX||[[0,w]],L=b.stretchY||[[0,T]],N=(dt,Mt)=>dt+Mt[1]-Mt[0],z=P.reduce(N,0),G=L.reduce(N,0),ee=w-z,de=T-G;let De=0,he=z,we=0,Re=G,Pe=0,at=ee,rt=0,yt=de;if(b.content&&d){const dt=b.content;De=eb(P,0,dt[0]),we=eb(L,0,dt[1]),he=eb(P,dt[0],dt[2]),Re=eb(L,dt[1],dt[3]),Pe=dt[0]-De,rt=dt[1]-we,at=dt[2]-dt[0]-he,yt=dt[3]-dt[1]-Re}const Ht=(dt,Mt,Et,Ot)=>{const Wt=tb(dt.stretch-De,he,E,a.left),mt=yi(dt.fixed-Pe,at,dt.stretch,z),an=tb(Mt.stretch-we,Re,k,a.top),gn=yi(Mt.fixed-rt,yt,Mt.stretch,G),dn=tb(Et.stretch-De,he,E,a.left),Zn=yi(Et.fixed-Pe,at,Et.stretch,z),Yt=tb(Ot.stretch-we,Re,k,a.top),Pn=yi(Ot.fixed-rt,yt,Ot.stretch,G),ei=new Ae(Wt,an),Hi=new Ae(dn,an),ti=new Ae(dn,Yt),Vn=new Ae(Wt,Yt),Wi=new Ae(mt/v,gn/v),Yn=new Ae(Zn/v,Pn/v),Kn=o*Math.PI/180;if(Kn){const br=Math.sin(Kn),_r=Math.cos(Kn),qr=[_r,-br,br,_r];ei._matMult(qr),Hi._matMult(qr),Vn._matMult(qr),ti._matMult(qr)}const or=dt.stretch+dt.fixed,Ar=Mt.stretch+Mt.fixed;return{tl:ei,tr:Hi,bl:Vn,br:ti,tex:{x:b.paddedRect.x+1+or,y:b.paddedRect.y+1+Ar,w:Et.stretch+Et.fixed-or,h:Ot.stretch+Ot.fixed-Ar},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Wi,pixelOffsetBR:Yn,minFontScaleX:at/v/E,minFontScaleY:yt/v/k,isSDF:l}};if(d&&(b.stretchX||b.stretchY)){const dt=nx(P,ee,z),Mt=nx(L,de,G);for(let Et=0;Et<dt.length-1;Et++){const Ot=dt[Et],Wt=dt[Et+1];for(let mt=0;mt<Mt.length-1;mt++)f.push(Ht(Ot,Mt[mt],Wt,Mt[mt+1]))}}else f.push(Ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return f}function eb(a,o,l){let d=0;for(const f of a)d+=Math.max(o,Math.min(l,f[1]))-Math.max(o,Math.min(l,f[0]));return d}function nx(a,o,l){const d=[{fixed:-1,stretch:0}];for(const[f,b]of a){const v=d[d.length-1];d.push({fixed:f-v.stretch,stretch:v.stretch}),d.push({fixed:f-v.stretch,stretch:v.stretch+(b-f)})}return d.push({fixed:o+1,stretch:l}),d}function tb(a,o,l,d){return a/o*l+d}function yi(a,o,l,d){return a-o*l/d}function ae(a,o,l,d){const f=o+a.positionedLines[d].lineOffset;return 0===d?l+f/2:l+(f+(o+a.positionedLines[d-1].lineOffset))/2}class ix{constructor(o=[],l=rx){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:d}=this,f=l[o];for(;o>0;){const b=o-1>>1,v=l[b];if(d(f,v)>=0)break;l[o]=v,o=b}l[o]=f}_down(o){const{data:l,compare:d}=this,f=this.length>>1,b=l[o];for(;o<f;){let v=1+(o<<1),w=l[v];const T=v+1;if(T<this.length&&d(l[T],w)<0&&(v=T,w=l[T]),d(w,b)>=0)break;l[o]=w,o=v}l[o]=b}}function rx(a,o){return a<o?-1:a>o?1:0}function sC(a,o=1,l=!1){let d=1/0,f=1/0,b=-1/0,v=-1/0;const w=a[0];for(let N=0;N<w.length;N++){const z=w[N];(!N||z.x<d)&&(d=z.x),(!N||z.y<f)&&(f=z.y),(!N||z.x>b)&&(b=z.x),(!N||z.y>v)&&(v=z.y)}const T=Math.min(b-d,v-f);let E=T/2;const k=new ix([],aC);if(0===T)return new Ae(d,f);for(let N=d;N<b;N+=T)for(let z=f;z<v;z+=T)k.push(new nh(N+E,z+E,E,a));let P=function(N){let z=0,G=0,ee=0;const de=N[0];for(let De=0,he=de.length,we=he-1;De<he;we=De++){const Re=de[De],Pe=de[we],at=Re.x*Pe.y-Pe.x*Re.y;G+=(Re.x+Pe.x)*at,ee+=(Re.y+Pe.y)*at,z+=3*at}return new nh(G/z,ee/z,0,N)}(a),L=k.length;for(;k.length;){const N=k.pop();(N.d>P.d||!P.d)&&(P=N,l&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,L)),N.max-P.d<=o||(E=N.h/2,k.push(new nh(N.p.x-E,N.p.y-E,E,a)),k.push(new nh(N.p.x+E,N.p.y-E,E,a)),k.push(new nh(N.p.x-E,N.p.y+E,E,a)),k.push(new nh(N.p.x+E,N.p.y+E,E,a)),L+=4)}return l&&(console.log(`num probes: ${L}`),console.log(`best distance: ${P.d}`)),P.p}function aC(a,o){return o.max-a.max}class nh{constructor(o,l,d,f){this.p=new Ae(o,l),this.h=d,this.d=function(b,v){let w=!1,T=1/0;for(let E=0;E<v.length;E++){const k=v[E];for(let P=0,L=k.length,N=L-1;P<L;N=P++){const z=k[P],G=k[N];z.y>b.y!=G.y>b.y&&b.x<(G.x-z.x)*(b.y-z.y)/(G.y-z.y)+z.x&&(w=!w),T=Math.min(T,Ig(b,z,G))}}return(w?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const nb=Number.POSITIVE_INFINITY,lC=Math.sqrt(2);function ox(a,[o,l]){let d=0,f=0;if(l===nb){o<0&&(o=0);const b=o/lC;switch(a){case"top-right":case"top-left":f=b-7;break;case"bottom-right":case"bottom-left":f=7-b;break;case"bottom":f=7-o;break;case"top":f=o-7}switch(a){case"top-right":case"bottom-right":d=-b;break;case"top-left":case"bottom-left":d=b;break;case"left":d=o;break;case"right":d=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),a){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(a){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}}return[d,f]}function WI(a,o,l,d,f,b,v,w,T,E){a.createArrays(),a.tilePixelRatio=On/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const k=a.layers[0].layout,P=a.layers[0]._unevaluatedLayout._values,L={};if("composite"===a.textSizeData.kind){const{minZoom:G,maxZoom:ee}=a.textSizeData;L.compositeTextSizes=[P["text-size"].possiblyEvaluate(new R(G),w),P["text-size"].possiblyEvaluate(new R(ee),w)]}if("composite"===a.iconSizeData.kind){const{minZoom:G,maxZoom:ee}=a.iconSizeData;L.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new R(G),w),P["icon-size"].possiblyEvaluate(new R(ee),w)]}L.layoutTextSize=P["text-size"].possiblyEvaluate(new R(T+1),w),L.layoutIconSize=P["icon-size"].possiblyEvaluate(new R(T+1),w),L.textMaxSize=P["text-size"].possiblyEvaluate(new R(18),w);const N="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),z=k.get("text-size");for(const G of a.features){const ee=k.get("text-font").evaluate(G,{},w).join(","),de=z.evaluate(G,{},w),De=L.layoutTextSize.evaluate(G,{},w),he=(L.layoutIconSize.evaluate(G,{},w),{horizontal:{},vertical:void 0}),we=G.text;let Re,Pe=[0,0];if(we){const yt=we.toString(),Ht=24*k.get("text-letter-spacing").evaluate(G,{},w),dt=24*k.get("text-line-height").evaluate(G,{},w),Mt=T_(yt)?Ht:0,Et=k.get("text-anchor").evaluate(G,{},w),Ot=k.get("text-variable-anchor");if(!Ot){const dn=k.get("text-radial-offset").evaluate(G,{},w);Pe=dn?ox(Et,[24*dn,nb]):k.get("text-offset").evaluate(G,{},w).map(Zn=>24*Zn)}let Wt=N?"center":k.get("text-justify").evaluate(G,{},w);const mt="point"===k.get("symbol-placement"),an=mt?24*k.get("text-max-width").evaluate(G,{},w):1/0,gn=dn=>{a.allowVerticalPlacement&&Na(yt)&&(he.vertical=fy(we,o,l,f,ee,an,dt,Et,dn,Mt,Pe,qa.vertical,!0,De,de))};if(!N&&Ot){const dn="auto"===Wt?Ot.map(Yt=>ib(Yt)):[Wt];let Zn=!1;for(let Yt=0;Yt<dn.length;Yt++){const Pn=dn[Yt];if(!he.horizontal[Pn])if(Zn)he.horizontal[Pn]=he.horizontal[0];else{const ei=fy(we,o,l,f,ee,an,dt,"center",Pn,Mt,Pe,qa.horizontal,!1,De,de);ei&&(he.horizontal[Pn]=ei,Zn=1===ei.positionedLines.length)}}gn("left")}else{if("auto"===Wt&&(Wt=ib(Et)),mt||k.get("text-writing-mode").indexOf("horizontal")>=0||!Na(yt)){const dn=fy(we,o,l,f,ee,an,dt,Et,Wt,Mt,Pe,qa.horizontal,!1,De,de);dn&&(he.horizontal[Wt]=dn)}gn(mt?"left":Wt)}}let at=!1;if(G.icon&&G.icon.name){const yt=d[G.icon.name];yt&&(Re=GI(f[G.icon.name],k.get("icon-offset").evaluate(G,{},w),k.get("icon-anchor").evaluate(G,{},w)),at=yt.sdf,void 0===a.sdfIcons?a.sdfIcons=yt.sdf:a.sdfIcons!==yt.sdf&&Jn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yt.pixelRatio!==a.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const rt=ob(he.horizontal)||he.vertical;a.iconsInText||(a.iconsInText=!!rt&&rt.iconsInText),(rt||Re)&&sx(a,G,he,Re,d,L,De,0,Pe,at,v,w,E)}b&&a.generateCollisionDebugBuffers(T,a.collisionBoxArray)}function ib(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sx(a,o,l,d,f,b,v,w,T,E,k,P,L){let N=b.textMaxSize.evaluate(o,{},P);void 0===N&&(N=v);const z=a.layers[0].layout,G=z.get("icon-offset").evaluate(o,{},P),ee=ob(l.horizontal)||l.vertical,de="globe"===L.name,he=v/24,we=a.tilePixelRatio*N/24,Re=(Et=a.overscaling,a.zoom>18&&Et>2&&(Et>>=1),Math.max(On/(512*Et),1)*z.get("symbol-spacing")),Pe=z.get("text-padding")*a.tilePixelRatio,at=z.get("icon-padding")*a.tilePixelRatio,rt=se(z.get("text-max-angle")),yt="map"===z.get("text-rotation-alignment")&&"point"!==z.get("symbol-placement"),Ht="map"===z.get("icon-rotation-alignment")&&"point"!==z.get("symbol-placement"),dt=z.get("symbol-placement"),Mt=Re/2;var Et;const Ot=z.get("icon-text-fit");let Wt;d&&"none"!==Ot&&(a.allowVerticalPlacement&&l.vertical&&(Wt=nC(d,l.vertical,Ot,z.get("icon-text-fit-padding"),G,he)),ee&&(d=nC(d,ee,Ot,z.get("icon-text-fit-padding"),G,he)));const mt=(an,gn,dn)=>{if(gn.x<0||gn.x>=On||gn.y<0||gn.y>=On)return;let Zn=null;if(de){const{x:Yt,y:Pn,z:ei}=L.projectTilePoint(gn.x,gn.y,dn);Zn={anchor:new _c(Yt,Pn,ei,0,void 0),up:L.upVector(dn,gn.x,gn.y)}}!function(Yt,Pn,ei,Hi,ti,Vn,Wi,Yn,Kn,or,Ar,br,_r,qr,Qr,Gr,Sr,ko,bo,Jr,Ji,_o,kr,Es,Xt){const Zo=Yt.addToLineVertexArray(Pn,Hi);let Co,Us,No,Hl,Ap,am,lm,cm=0,Ju=0,TC=0,kp=0,Ny=-1,By=-1;const yl={};let vx=qo("");const Hs=ei?ei.anchor:Pn;let uh=0,ls=0;if(void 0===Kn._unevaluatedLayout.getValue("text-radial-offset")?[uh,ls]=Kn.layout.get("text-offset").evaluate(Ji,{},Xt).map(fn=>24*fn):(uh=24*Kn.layout.get("text-radial-offset").evaluate(Ji,{},Xt),ls=nb),Yt.allowVerticalPlacement&&ti.vertical){const fn=ti.vertical;if(Qr)am=ax(fn),Yn&&(lm=ax(Yn));else{const Yo=Kn.layout.get("text-rotate").evaluate(Ji,{},Xt)+90;No=sb(or,Hs,Pn,Ar,br,_r,fn,qr,Yo,Gr),Yn&&(Hl=sb(or,Hs,Pn,Ar,br,_r,Yn,ko,Yo))}}if(Vn){const fn=Kn.layout.get("icon-rotate").evaluate(Ji,{},Xt),Yo="none"!==Kn.layout.get("icon-text-fit"),Sc=vy(Vn,fn,kr,Yo),ed=Yn?vy(Yn,fn,kr,Yo):void 0;Us=sb(or,Hs,Pn,Ar,br,_r,Vn,ko,fn),cm=4*Sc.length;const dh=Yt.iconSizeData;let xl=null;"source"===dh.kind?(xl=[gl*Kn.layout.get("icon-size").evaluate(Ji,{},Xt)],xl[0]>Wu&&Jn(`${Yt.layerIds[0]}: Value for "icon-size" is >= ${Nr}. Reduce your "icon-size".`)):"composite"===dh.kind&&(xl=[gl*_o.compositeIconSizes[0].evaluate(Ji,{},Xt),gl*_o.compositeIconSizes[1].evaluate(Ji,{},Xt)],(xl[0]>Wu||xl[1]>Wu)&&Jn(`${Yt.layerIds[0]}: Value for "icon-size" is >= ${Nr}. Reduce your "icon-size".`)),Yt.addSymbols(Yt.icon,Sc,xl,Jr,bo,Ji,!1,ei,Pn,Zo.lineStartIndex,Zo.lineLength,-1,Es,Xt),Ny=Yt.icon.placedSymbolArray.length-1,ed&&(Ju=4*ed.length,Yt.addSymbols(Yt.icon,ed,xl,Jr,bo,Ji,qa.vertical,ei,Pn,Zo.lineStartIndex,Zo.lineLength,-1,Es,Xt),By=Yt.icon.placedSymbolArray.length-1)}for(const fn in ti.horizontal){const Yo=ti.horizontal[fn];Co||(vx=qo(Yo.text),Qr?Ap=ax(Yo):Co=sb(or,Hs,Pn,Ar,br,_r,Yo,qr,Kn.layout.get("text-rotate").evaluate(Ji,{},Xt),Gr));const Sc=1===Yo.positionedLines.length;if(TC+=rb(Yt,ei,Pn,Yo,Wi,Kn,Qr,Ji,Gr,Zo,ti.vertical?qa.horizontal:qa.horizontalOnly,Sc?Object.keys(ti.horizontal):[fn],yl,Ny,_o,Es,Xt),Sc)break}ti.vertical&&(kp+=rb(Yt,ei,Pn,ti.vertical,Wi,Kn,Qr,Ji,Gr,Zo,qa.vertical,["vertical"],yl,By,_o,Es,Xt));let ya=-1;const Rp=(fn,Yo)=>fn?Math.max(fn,Yo):Yo;ya=Rp(Ap,ya),ya=Rp(am,ya),ya=Rp(lm,ya);const vl=ya>-1?1:0;Yt.glyphOffsetArray.length>=Zu.MAX_GLYPHS&&Jn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ji.sortKey&&Yt.addToSortKeyRanges(Yt.symbolInstances.length,Ji.sortKey),Yt.symbolInstances.emplaceBack(Hs.x,Hs.y,Hs.z,Pn.x,Pn.y,yl.right>=0?yl.right:-1,yl.center>=0?yl.center:-1,yl.left>=0?yl.left:-1,yl.vertical>=0?yl.vertical:-1,Ny,By,vx,void 0!==Co?Co:Yt.collisionBoxArray.length,void 0!==Co?Co+1:Yt.collisionBoxArray.length,void 0!==No?No:Yt.collisionBoxArray.length,void 0!==No?No+1:Yt.collisionBoxArray.length,void 0!==Us?Us:Yt.collisionBoxArray.length,void 0!==Us?Us+1:Yt.collisionBoxArray.length,Hl||Yt.collisionBoxArray.length,Hl?Hl+1:Yt.collisionBoxArray.length,Ar,TC,kp,cm,Ju,vl,0,uh,ls,ya)}(a,gn,Zn,an,l,d,f,Wt,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,Pe,yt,T,0,at,Ht,G,o,b,E,k,P)};if("line"===dt)for(const an of ex(o.geometry,0,0,On,On)){const gn=Q0(an,Re,rt,l.vertical||ee,d,24,we,a.overscaling,On);for(const dn of gn)ee&&XI(a,ee.text,Mt,dn)||mt(an,dn,P)}else if("line-center"===dt){for(const an of o.geometry)if(an.length>1){const gn=oC(an,rt,l.vertical||ee,d,24,we);gn&&mt(an,gn,P)}}else if("Polygon"===o.type)for(const an of qf(o.geometry,0)){const gn=sC(an,16);mt(an[0],new _c(gn.x,gn.y,0,0,void 0),P)}else if("LineString"===o.type)for(const an of o.geometry)mt(an,new _c(an[0].x,an[0].y,0,0,void 0),P);else if("Point"===o.type)for(const an of o.geometry)for(const gn of an)mt([gn],new _c(gn.x,gn.y,0,0,void 0),P)}const Nr=255,Wu=Nr*gl;function rb(a,o,l,d,f,b,v,w,T,E,k,P,L,N,z,G,ee){const de=function(we,Re,Pe,at,rt,yt,Ht,dt){const Mt=[];if(0===Re.positionedLines.length)return Mt;const Et=at.layout.get("text-rotate").evaluate(yt,{})*Math.PI/180,Ot=function(dn){const Zn=dn[0],Yt=dn[1],Pn=Zn*Yt;return Pn>0?[Zn,-Yt]:Pn<0?[-Zn,Yt]:0===Zn?[Yt,Zn]:[Yt,-Zn]}(Pe);let Wt=Math.abs(Re.top-Re.bottom);for(const dn of Re.positionedLines)Wt-=dn.lineOffset;const mt=Re.positionedLines.length,an=Wt/mt;let gn=Re.top-Pe[1];for(let dn=0;dn<mt;++dn){const Zn=Re.positionedLines[dn];gn=ae(Re,an,gn,dn);for(const Yt of Zn.positionedGlyphs){if(!Yt.rect)continue;const Pn=Yt.rect||{};let ei=4,Hi=!0,ti=1,Vn=0;if(Yt.imageName){const kr=Ht[Yt.imageName];if(!kr)continue;if(kr.sdf){Jn("SDF images are not supported in formatted text and will be ignored.");continue}Hi=!1,ti=kr.pixelRatio,ei=1/ti}const Wi=(rt||dt)&&Yt.vertical,Yn=Yt.metrics.advance*Yt.scale/2,Kn=Yt.metrics,or=Yt.rect;if(null===or)continue;dt&&Re.verticalizable&&(Vn=Yt.imageName?Yn-Yt.metrics.width*Yt.scale/2:0);const Ar=rt?[Yt.x+Yn,Yt.y]:[0,0];let br=[0,0],_r=[0,0],qr=!1;rt||(Wi?(_r=[Yt.x+Yn+Ot[0],Yt.y+Ot[1]-Vn],qr=!0):br=[Yt.x+Yn+Pe[0],Yt.y+Pe[1]-Vn]);const Qr=or.w*Yt.scale/(ti*(Yt.localGlyph?2:1)),Gr=or.h*Yt.scale/(ti*(Yt.localGlyph?2:1));let Sr,ko,bo,Jr;if(Wi){const kr=Yt.y-gn,Es=new Ae(-Yn,Yn-kr),Xt=-Math.PI/2,Zo=new Ae(..._r);Sr=new Ae(-Yn+br[0],br[1]),Sr._rotateAround(Xt,Es)._add(Zo),Sr.x+=-kr+Yn,Sr.y-=(Kn.left-ei)*Yt.scale;const Co=Yt.imageName?Kn.advance*Yt.scale:24*Yt.scale,Us=String.fromCharCode(Yt.glyph);cy(Us)?Sr.x+=(1-ei)*Yt.scale:Wg(Us)?Sr.x+=Co-Kn.height*Yt.scale+(-ei-1)*Yt.scale:Sr.x+=Yt.imageName||Kn.width+2*ei===or.w&&Kn.height+2*ei===or.h?(Co-Gr)/2:(Co-(Kn.height+2*ei)*Yt.scale)/2,ko=new Ae(Sr.x,Sr.y-Qr),bo=new Ae(Sr.x+Gr,Sr.y),Jr=new Ae(Sr.x+Gr,Sr.y-Qr)}else{const kr=(Kn.left-ei)*Yt.scale-Yn+br[0],Es=(-Kn.top-ei)*Yt.scale+br[1],Xt=kr+Qr,Zo=Es+Gr;Sr=new Ae(kr,Es),ko=new Ae(Xt,Es),bo=new Ae(kr,Zo),Jr=new Ae(Xt,Zo)}if(Et){let kr;kr=rt?new Ae(0,0):qr?new Ae(Ot[0],Ot[1]):new Ae(Pe[0],Pe[1]),Sr._rotateAround(Et,kr),ko._rotateAround(Et,kr),bo._rotateAround(Et,kr),Jr._rotateAround(Et,kr)}const Ji=new Ae(0,0),_o=new Ae(0,0);Mt.push({tl:Sr,tr:ko,bl:bo,br:Jr,tex:Pn,writingMode:Re.writingMode,glyphOffset:Ar,sectionIndex:Yt.sectionIndex,isSDF:Hi,pixelOffsetTL:Ji,pixelOffsetBR:_o,minFontScaleX:0,minFontScaleY:0})}}return Mt}(0,d,T,b,v,w,f,a.allowVerticalPlacement),De=a.textSizeData;let he=null;"source"===De.kind?(he=[gl*b.layout.get("text-size").evaluate(w,{},ee)],he[0]>Wu&&Jn(`${a.layerIds[0]}: Value for "text-size" is >= ${Nr}. Reduce your "text-size".`)):"composite"===De.kind&&(he=[gl*z.compositeTextSizes[0].evaluate(w,{},ee),gl*z.compositeTextSizes[1].evaluate(w,{},ee)],(he[0]>Wu||he[1]>Wu)&&Jn(`${a.layerIds[0]}: Value for "text-size" is >= ${Nr}. Reduce your "text-size".`)),a.addSymbols(a.text,de,he,T,v,w,k,o,l,E.lineStartIndex,E.lineLength,N,G,ee);for(const we of P)L[we]=a.text.placedSymbolArray.length-1;return 4*de.length}function ob(a){for(const o in a)return a[o];return null}function sb(a,o,l,d,f,b,v,w,T,E){let k=v.top,P=v.bottom,L=v.left,N=v.right;const z=v.collisionPadding;if(z&&(L-=z[0],k-=z[1],N+=z[2],P+=z[3]),T){const G=new Ae(L,k),ee=new Ae(N,k),de=new Ae(L,P),De=new Ae(N,P),he=se(T);let we=new Ae(0,0);E&&(we=new Ae(E[0],E[1])),G._rotateAround(he,we),ee._rotateAround(he,we),de._rotateAround(he,we),De._rotateAround(he,we),L=Math.min(G.x,ee.x,de.x,De.x),N=Math.max(G.x,ee.x,de.x,De.x),k=Math.min(G.y,ee.y,de.y,De.y),P=Math.max(G.y,ee.y,de.y,De.y)}return a.emplaceBack(o.x,o.y,o.z,l.x,l.y,L,k,N,P,w,d,f,b),a.length-1}function ax(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function XI(a,o,l,d){const f=a.compareText;if(o in f){const b=f[o];for(let v=b.length-1;v>=0;v--)if(d.dist(b[v])<l)return!0}else f[o]=[];return f[o].push(d),!1}function cC(a,o){const l=a.fovAboveCenter,d=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,f=(a._camera.position[2]*a.worldSize-d)/Math.cos(a._pitch),b=Math.sin(l)*f/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),v=Math.sin(a._pitch)*b+f;return Math.min(1.01*v,f*(1/a._horizonShift))}function ih(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const l=Math.pow(2,-a.z),d=a.x*l,f=(a.x+1)*l,b=a.y*l,v=(a.y+1)*l,w=Ua(d),T=Ua(f),E=wr(b),k=wr(v),P=o.project(w,E),L=o.project(T,E),N=o.project(T,k),z=o.project(w,k);let G=Math.min(P.x,L.x,N.x,z.x),ee=Math.min(P.y,L.y,N.y,z.y),de=Math.max(P.x,L.x,N.x,z.x),De=Math.max(P.y,L.y,N.y,z.y);const he=l/16;function we(Pe,at,rt,yt,Ht,dt){const Mt=(rt+Ht)/2,Et=(yt+dt)/2,Ot=o.project(Ua(Mt),wr(Et)),Wt=Math.max(0,G-Ot.x,ee-Ot.y,Ot.x-de,Ot.y-De);G=Math.min(G,Ot.x),de=Math.max(de,Ot.x),ee=Math.min(ee,Ot.y),De=Math.max(De,Ot.y),Wt>he&&(we(Pe,Ot,rt,yt,Mt,Et),we(Ot,at,Mt,Et,Ht,dt))}we(P,L,d,b,f,b),we(L,N,f,b,f,v),we(N,z,f,v,d,v),we(z,P,d,v,d,b),G-=he,ee-=he,de+=he,De+=he;const Re=1/Math.max(de-G,De-ee);return{scale:Re,x:G*Re,y:ee*Re,x2:de*Re,y2:De*Re,projection:o}}const lx=go(new Float32Array(16));class rh{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new xr(0,0)}projectTilePoint(o,l,d){return{x:o,y:l,z:0}}locationPoint(o,l,d=!0){return o._coordinatePoint(o.locationCoordinate(l),d)}pixelsPerMeter(o,l){return Bl(1,o)*l}pixelSpaceConversion(o,l,d){return 1}farthestPixelDistance(o){return cC(o,o.pixelsPerMeter)}pointCoordinate(o,l,d,f){const b=o.horizonLineFromTop(!1),v=new Ae(l,Math.max(b,d));return o.rayIntersectionCoordinate(o.pointRayIntersection(v,f))}pointCoordinate3D(o,l,d){const f=new Ae(l,d);if(o.elevation)return o.elevation.pointCoordinate(f);{const b=this.pointCoordinate(o,f.x,f.y,0);return[b.x,b.y,b.z]}}isPointAboveHorizon(o,l){if(o.elevation)return!this.pointCoordinate3D(o,l.x,l.y);const d=o.horizonLineFromTop();return l.y<d}createInversionMatrix(o,l){return lx}createTileMatrix(o,l,d){let f,b,v;const w=d.canonical,T=go(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=ih(w,this);f=1,b=E.x+d.wrap*E.scale,v=E.y,Nu(T,T,[f/E.scale,f/E.scale,o.pixelsPerMeter/l])}else f=l/o.zoomScale(w.z),b=(w.x+Math.pow(2,w.z)*d.wrap)*f,v=w.y*f;return hg(T,T,[b,v,0]),Nu(T,T,[f/On,f/On,1]),T}upVector(o,l,d){return[0,0,1]}upVectorScale(o,l,d){return{metersToTile:1}}}class uC extends rh{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,d]=this.parallels=o.parallels||[29.5,45.5],f=Math.sin(se(l));this.n=(f+Math.sin(se(d)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:d,c:f,r0:b}=this,v=se(o-this.center[0]),w=se(l),T=Math.sqrt(f-2*d*Math.sin(w))/d;return{x:T*Math.sin(v*d),y:T*Math.cos(v*d)-b,z:0}}unproject(o,l){const{n:d,c:f,r0:b}=this,v=b+l;let w=Math.atan2(o,Math.abs(v))*Math.sign(v);v*d<0&&(w-=Math.PI*Math.sign(o)*Math.sign(v));const T=se(this.center[0])*d;w=Lt(w,-Math.PI-T,Math.PI-T);const E=Dt(be(w/d)+this.center[0],-180,180),k=Math.asin(Dt((f-(o*o+v*v)*d*d)/(2*d),-1,1)),P=Dt(be(k),-Xo,Xo);return new xr(E,P)}}const yc=1.340264,Jf=-.081106,Tp=893e-6,Xu=.003796,ab=Math.sqrt(3)/2;class cx extends rh{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const d=Math.asin(ab*Math.sin(l)),f=d*d,b=f*f*f;return{x:.5*(o*Math.cos(d)/(ab*(yc+3*Jf*f+b*(7*Tp+9*Xu*f)))/Math.PI+.5),y:1-.5*(d*(yc+Jf*f+b*(Tp+Xu*f))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,f=d*d,b=f*f*f;for(let k,P,L,N=0;N<12&&(P=d*(yc+Jf*f+b*(Tp+Xu*f))-l,L=yc+3*Jf*f+b*(7*Tp+9*Xu*f),k=P/L,d=Dt(d-k,-Math.PI/3,Math.PI/3),f=d*d,b=f*f*f,!(Math.abs(k)<1e-12));++N);const v=ab*o*(yc+3*Jf*f+b*(7*Tp+9*Xu*f))/Math.cos(d),w=Math.asin(Math.sin(d)/ab),T=Dt(180*v/Math.PI,-180,180),E=Dt(180*w/Math.PI,-Xo,Xo);return new xr(T,E)}}class dC extends rh{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const d=360*(o-.5),f=Dt(360*(.5-l),-Xo,Xo);return new xr(d,f)}}const Ep=Math.PI/2;function lb(a){return Math.tan((Ep+a)/2)}class hC extends rh{constructor(o){super(o),this.center=o.center||[0,30];const[l,d]=this.parallels=o.parallels||[30,30];let f=se(l),b=se(d);this.southernCenter=f+b<0,this.southernCenter&&(f=-f,b=-b);const v=Math.cos(f),w=lb(f);this.n=f===b?Math.sin(f):Math.log(v/Math.cos(b))/Math.log(lb(b)/w),this.f=v*Math.pow(lb(f),this.n)/this.n}project(o,l){l=se(l),this.southernCenter&&(l=-l),o=se(o-this.center[0]);const d=1e-6,{n:f,f:b}=this;b>0?l<-Ep+d&&(l=-Ep+d):l>Ep-d&&(l=Ep-d);const v=b/Math.pow(lb(l),f);let w=v*Math.sin(f*o),T=b-v*Math.cos(f*o);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:d,f}=this,b=f-l,v=Math.sign(b),w=Math.sign(d)*Math.sqrt(o*o+b*b);let T=Math.atan2(o,Math.abs(b))*v;b*d<0&&(T-=Math.PI*Math.sign(o)*v);const E=Dt(be(T/d)+this.center[0],-180,180),k=Dt(be(2*Math.atan(Math.pow(f/w,1/d))-Ep),-Xo,Xo);return new xr(E,this.southernCenter?-k:k)}}class ux extends rh{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:hc(o),y:Nl(l),z:0}}unproject(o,l){const d=Ua(o),f=wr(l);return new xr(d,f)}}const xy=se(Xo);class pC extends rh{project(o,l){const d=(l=se(l))*l,f=d*d;return{x:.5*((o=se(o))*(.8707-.131979*d+f*(f*(.003971*d-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+d*(.015085+f*(.028874*d-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let d=l=(2*(1-l)-1)*Math.PI,f=25,b=0,v=d*d;do{v=d*d;const E=v*v;b=(d*(1.007226+v*(.015085+E*(.028874*v-.044475-.005916*E)))-l)/(1.007226+v*(.045255+E*(.259866*v-.311325-.005916*11*E))),d=Dt(d-b,-xy,xy)}while(Math.abs(b)>1e-6&&--f>0);v=d*d;const w=Dt(be(o/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),T=be(d);return new xr(w,T)}}const wy=se(Xo);class dx extends rh{project(o,l){l=se(l),o=se(o);const d=Math.cos(l),f=2/Math.PI,b=Math.acos(d*Math.cos(o/2)),v=Math.sin(b)/b,w=.5*(o*f+2*d*Math.sin(o/2)/v)||0,T=.5*(l+Math.sin(l)/v)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(o,l){let d=o=(2*o-.5)*Math.PI,f=l=(2*(1-l)-1)*Math.PI,b=25;const v=1e-6;let w=0,T=0;do{const E=Math.cos(f),k=Math.sin(f),P=2*k*E,L=k*k,N=E*E,z=Math.cos(d/2),G=Math.sin(d/2),ee=2*z*G,de=G*G,De=1-N*z*z,he=De?1/De:0,we=De?Math.acos(E*z)*Math.sqrt(1/De):0,Re=.5*(2*we*E*G+2*d/Math.PI)-o,Pe=.5*(we*k+f)-l,at=.5*he*(N*de+we*E*z*L)+1/Math.PI,rt=he*(ee*P/4-we*k*G),yt=.125*he*(P*G-we*k*N*ee),Ht=.5*he*(L*z+we*de*E)+.5,dt=rt*yt-Ht*at;w=(Pe*rt-Re*Ht)/dt,T=(Re*yt-Pe*at)/dt,d=Dt(d-w,-Math.PI,Math.PI),f=Dt(f-T,-wy,wy)}while((Math.abs(w)>v||Math.abs(T)>v)&&--b>0);return new xr(be(d),be(f))}}class cb extends rh{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(se(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:d,cosPhi:f}=this;return{x:se(o)*f*d+.5,y:-Math.sin(se(l))/f*d+.5,z:0}}unproject(o,l){const{scale:d,cosPhi:f}=this,b=-(l-.5)/d,v=Dt(be((o-.5)/d)/f,-180,180),w=Math.asin(Dt(b*f,-1,1)),T=Dt(be(w),-Xo,Xo);return new xr(v,T)}}class ZI extends ux{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,d){const f=_g(o,l,d);return je(f,f,Bf(Zc(d))),{x:f[0],y:f[1],z:f[2]}}locationPoint(o,l){const d=Nf(l.lat,l.lng),f=Fo([],d),b=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;lp(d,d,f,Bl(1,0)*On*b);const v=go(new Float64Array(16));return pl(v,o.pixelMatrix,o.globeMatrix),je(d,d,v),new Ae(d[0],d[1])}pixelsPerMeter(o,l){return Bl(1,0)*l}pixelSpaceConversion(o,l,d){const f=Bl(1,o)*l,b=Vi(Bl(1,45)*l,f,d);return this.pixelsPerMeter(o,l)/b}createTileMatrix(o,l,d){const f=yg(Zc(d.canonical));return pl(new Float64Array(16),o.globeMatrix,f)}createInversionMatrix(o,l){const{center:d}=o,f=Bf(Zc(l));return pg(f,f,se(d.lng)),I_(f,f,se(d.lat)),Nu(f,f,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(o,l,d,f){return F_(o,l,d,!0)||new Mo(0,0)}pointCoordinate3D(o,l,d){const f=this.pointCoordinate(o,l,d,0);return[f.x,f.y,f.z]}isPointAboveHorizon(o,l){return!F_(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(f,b){const v=f.cameraToCenterDistance,w=f._centerAltitude*b,T=f._camera,E=f._camera.forward(),k=za([],Va([],E,-v),[0,0,w]),P=f.worldSize/(2*Math.PI),L=[0,0,-P],N=f.width/f.height,z=Math.tan(f.fovAboveCenter),G=Va([],T.up(),z),ee=Va([],T.right(),z*N),de=Fo([],za([],za([],E,G),ee)),De=[];let he;if(new L_(k,de).closestPointOnSphere(L,P,De)){const we=za([],De,L),Re=ja([],we,k);he=Math.cos(f.fovAboveCenter)*Bu(Re)}else{const we=ja([],k,L),Re=ja([],L,k);Fo(Re,Re);const Pe=Bu(we)-P;he=Math.sqrt(Pe*(Pe+2*P));const at=Math.acos(he/(P+Pe))-Math.acos(Ts(E,Re));he*=Math.cos(at)}return 1.01*he}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),d=Zd(o.zoom);if(d>0){const f=cC(o,Bl(1,o.center.lat)*o.worldSize),b=o.worldSize/(2*Math.PI),v=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Vi(l,f+b*(1-Math.cos(v)),Math.pow(d,10))}return l}upVector(o,l,d){return _g(l,d,o,1)}upVectorScale(o){return{metersToTile:mg(B_(Zc(o)))}}}function ub(a){const o=a.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new ux(a);case"equirectangular":return new dC(a);case"naturalEarth":return new pC(a);case"equalEarth":return new cx(a);case"winkelTripel":return new dx(a);case"albers":return l?new cb(a):new uC(a);case"lambertConformalConic":return l?new cb(a):new hC(a);case"globe":return new ZI(a)}throw new Error(`Invalid projection name: ${a.name}`)}const fC=ml.types,YI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function H(a,o,l,d,f,b,v,w,T,E,k,P,L){const N=w?Math.min(Wu,Math.round(w[0])):0,z=w?Math.min(Wu,Math.round(w[1])):0;a.emplaceBack(o,l,Math.round(32*d),Math.round(32*f),b,v,(N<<1)+(T?1:0),z,16*E,16*k,256*P,256*L)}function nu(a,o,l,d,f,b,v){a.emplaceBack(o,l,d,f,b,v)}function em(a,o,l,d,f){a.emplaceBack(o,l,d,f),a.emplaceBack(o,l,d,f),a.emplaceBack(o,l,d,f),a.emplaceBack(o,l,d,f)}function db(a){for(const o of a.sections)if(ag(o.text))return!0;return!1}class Ga{constructor(o){this.layoutVertexArray=new Rt,this.indexArray=new Dn,this.programConfigurations=o,this.segments=new $r,this.dynamicLayoutVertexArray=new jt,this.opacityVertexArray=new Mn,this.placedSymbolArray=new lo,this.globeExtVertexArray=new $t}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,l,d,f){this.isEmpty()||(d&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,j0.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,U0.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,YI,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,G1.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||f)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}bn(Ga,"SymbolBuffers");class hb{constructor(o,l,d){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new d,this.segments=new $r,this.collisionVertexArray=new _i,this.collisionVertexArrayExt=new ai}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,H0.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,ay.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}bn(hb,"CollisionBuffers");class Zu{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(v=>v.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=go([]),this.placementViewportMatrix=go([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qg(this.zoom,l["text-size"]),this.iconSizeData=qg(this.zoom,l["icon-size"]);const d=this.layers[0].layout,f=d.get("symbol-sort-key"),b=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==b&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===b||"auto"===b&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(v=>qa[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new Ga(new ap(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new Ga(new ap(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Cs,this.lineVertexArray=new sp,this.symbolInstances=new Rr}calculateGlyphDependencies(o,l,d,f,b){for(let v=0;v<o.length;v++)if(l[o.charCodeAt(v)]=!0,f&&b){const w=Yf[o.charAt(v)];w&&(l[w.charCodeAt(0)]=!0)}}populate(o,l,d,f){const b=this.layers[0],v=b.layout,w="globe"===this.projection.name,T=v.get("text-font"),E=v.get("text-field"),k=v.get("icon-image"),P=("constant"!==E.value.kind||E.value.value instanceof Gs&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),L="constant"!==k.value.kind||!!k.value.value||Object.keys(k.parameters).length>0,N=v.get("symbol-sort-key");if(this.features=[],!P&&!L)return;const z=l.iconDependencies,G=l.glyphDependencies,ee=l.availableImages,de=new R(this.zoom);for(const{feature:De,id:he,index:we,sourceLayerIndex:Re}of o){const Pe=b._featureFilter.needGeometry,at=Vu(De,Pe);if(!b._featureFilter.filter(de,at,d))continue;if(Pe||(at.geometry=Yc(De,d,f)),w&&1!==De.type&&d.z<=5){const dt=at.geometry,Mt=.98078528056,Et=(Ot,Wt)=>Ts(_g(Ot.x,Ot.y,d,1),_g(Wt.x,Wt.y,d,1))<Mt;for(let Ot=0;Ot<dt.length;Ot++)dt[Ot]=f1(dt[Ot],Et)}let rt,yt;if(P){const dt=b.getValueAndResolveTokens("text-field",at,d,ee),Mt=Gs.factory(dt);db(Mt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===S()||this.hasRTLText&&M.isParsed())&&(rt=Gg(Mt,b,at))}if(L){const dt=b.getValueAndResolveTokens("icon-image",at,d,ee);yt=dt instanceof Aa?dt:Aa.fromString(dt)}if(!rt&&!yt)continue;const Ht=this.sortFeaturesByKey?N.evaluate(at,{},d):void 0;if(this.features.push({id:he,text:rt,icon:yt,index:we,sourceLayerIndex:Re,geometry:at.geometry,properties:De.properties,type:fC[De.type],sortKey:Ht}),yt&&(z[yt.name]=!0),rt){const dt=T.evaluate(at,{},d).join(","),Mt="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(qa.vertical)>=0;for(const Et of rt.sections)if(Et.image)z[Et.image.name]=!0;else{const Ot=Na(rt.toString()),Wt=Et.fontStack||dt,mt=G[Wt]=G[Wt]||{};this.calculateGlyphDependencies(Et.text,mt,Mt,this.allowVerticalPlacement,Ot)}}}"line"===v.get("symbol-placement")&&(this.features=function(De){const he={},we={},Re=[];let Pe=0;function at(dt){Re.push(De[dt]),Pe++}function rt(dt,Mt,Et){const Ot=we[dt];return delete we[dt],we[Mt]=Ot,Re[Ot].geometry[0].pop(),Re[Ot].geometry[0]=Re[Ot].geometry[0].concat(Et[0]),Ot}function yt(dt,Mt,Et){const Ot=he[Mt];return delete he[Mt],he[dt]=Ot,Re[Ot].geometry[0].shift(),Re[Ot].geometry[0]=Et[0].concat(Re[Ot].geometry[0]),Ot}function Ht(dt,Mt,Et){const Ot=Et?Mt[0][Mt[0].length-1]:Mt[0][0];return`${dt}:${Ot.x}:${Ot.y}`}for(let dt=0;dt<De.length;dt++){const Mt=De[dt],Et=Mt.geometry,Ot=Mt.text?Mt.text.toString():null;if(!Ot){at(dt);continue}const Wt=Ht(Ot,Et),mt=Ht(Ot,Et,!0);if(Wt in we&&mt in he&&we[Wt]!==he[mt]){const an=yt(Wt,mt,Et),gn=rt(Wt,mt,Re[an].geometry);delete he[Wt],delete we[mt],we[Ht(Ot,Re[gn].geometry,!0)]=gn,Re[an].geometry=null}else Wt in we?rt(Wt,mt,Et):mt in he?yt(Wt,mt,Et):(at(dt),he[Wt]=Pe-1,we[mt]=Pe-1)}return Re.filter(dt=>dt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((De,he)=>De.sortKey-he.sortKey)}update(o,l,d,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,l,this.layers,d,f),this.icon.programConfigurations.updatePaintArrays(o,l,this.layers,d,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ub(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const d=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:f,y:b}of l)this.lineVertexArray.emplaceBack(f,b);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(o,l,d,f,b,v,w,T,E,k,P,L,N,z){const G=o.indexArray,ee=o.layoutVertexArray,de=o.globeExtVertexArray,De=o.segments.prepareSegment(4*l.length,ee,G,this.canOverlap?v.sortKey:void 0),he=this.glyphOffsetArray.length,we=De.vertexLength,Re=this.allowVerticalPlacement&&w===qa.vertical?Math.PI/2:0,Pe=v.text&&v.text.sections;for(let rt=0;rt<l.length;rt++){const{tl:yt,tr:Ht,bl:dt,br:Mt,tex:Et,pixelOffsetTL:Ot,pixelOffsetBR:Wt,minFontScaleX:mt,minFontScaleY:an,glyphOffset:gn,isSDF:dn,sectionIndex:Zn}=l[rt],Yt=De.vertexLength,Pn=gn[1];if(H(ee,E.x,E.y,yt.x,Pn+yt.y,Et.x,Et.y,d,dn,Ot.x,Ot.y,mt,an),H(ee,E.x,E.y,Ht.x,Pn+Ht.y,Et.x+Et.w,Et.y,d,dn,Wt.x,Ot.y,mt,an),H(ee,E.x,E.y,dt.x,Pn+dt.y,Et.x,Et.y+Et.h,d,dn,Ot.x,Wt.y,mt,an),H(ee,E.x,E.y,Mt.x,Pn+Mt.y,Et.x+Et.w,Et.y+Et.h,d,dn,Wt.x,Wt.y,mt,an),T){const{x:ei,y:Hi,z:ti}=T.anchor,[Vn,Wi,Yn]=T.up;nu(de,ei,Hi,ti,Vn,Wi,Yn),nu(de,ei,Hi,ti,Vn,Wi,Yn),nu(de,ei,Hi,ti,Vn,Wi,Yn),nu(de,ei,Hi,ti,Vn,Wi,Yn),em(o.dynamicLayoutVertexArray,ei,Hi,ti,Re)}else em(o.dynamicLayoutVertexArray,E.x,E.y,E.z,Re);G.emplaceBack(Yt,Yt+1,Yt+2),G.emplaceBack(Yt+1,Yt+2,Yt+3),De.vertexLength+=4,De.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gn[0]),rt!==l.length-1&&Zn===l[rt+1].sectionIndex||o.programConfigurations.populatePaintArrays(ee.length,v,v.index,{},N,z,Pe&&Pe[Zn])}const at=T?T.anchor:E;o.placedSymbolArray.emplaceBack(at.x,at.y,at.z,E.x,E.y,he,this.glyphOffsetArray.length-he,we,k,P,E.segment,d?d[0]:0,d?d[1]:0,f[0],f[1],w,0,!1,0,L,0)}_commitLayoutVertex(o,l,d,f,b,v,w){o.emplaceBack(l,d,f,b,v,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(o,l,d,f,b,v,w){const T=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),E=T.vertexLength,k=w.tileAnchorX,P=w.tileAnchorY;for(let N=0;N<4;N++)d.collisionVertexArray.emplaceBack(0,0,0,0);d.collisionVertexArrayExt.emplaceBack(l,-o.padding,-o.padding),d.collisionVertexArrayExt.emplaceBack(l,o.padding,-o.padding),d.collisionVertexArrayExt.emplaceBack(l,o.padding,o.padding),d.collisionVertexArrayExt.emplaceBack(l,-o.padding,o.padding),this._commitLayoutVertex(d.layoutVertexArray,f,b,v,k,P,new Ae(o.x1,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,f,b,v,k,P,new Ae(o.x2,o.y1)),this._commitLayoutVertex(d.layoutVertexArray,f,b,v,k,P,new Ae(o.x2,o.y2)),this._commitLayoutVertex(d.layoutVertexArray,f,b,v,k,P,new Ae(o.x1,o.y2)),T.vertexLength+=4;const L=d.indexArray;L.emplaceBack(E,E+1),L.emplaceBack(E+1,E+2),L.emplaceBack(E+2,E+3),L.emplaceBack(E+3,E),T.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,d,f,b,v){for(let w=f;w<b;w++){const T=d.get(w),E=this.getSymbolInstanceTextSize(o,v,l,w);this._addCollisionDebugVertices(T,E,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(o,l,d,f,b,v){for(let w=f;w<b;w++){const T=d.get(w),E=this.getSymbolInstanceIconSize(o,l,v.placedIconSymbolIndex);this._addCollisionDebugVertices(T,E,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,v)}}generateCollisionDebugBuffers(o,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hb(_n,W1.members,ao),this.iconCollisionBox=new hb(_n,W1.members,ao);const d=yp(this.iconSizeData,o),f=yp(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const v=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(f,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(f,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(d,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(o,l,d,f){const b=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),v=mc(this.textSizeData,o,b)/24;return this.tilePixelRatio*v}getSymbolInstanceIconSize(o,l,d){const f=this.icon.placedSymbolArray.get(d),b=mc(this.iconSizeData,o,f);return this.tilePixelRatio*b}_commitDebugCollisionVertexUpdate(o,l,d){o.emplaceBack(l,-d,-d),o.emplaceBack(l,d,-d),o.emplaceBack(l,d,d),o.emplaceBack(l,-d,d)}_updateTextDebugCollisionBoxes(o,l,d,f,b,v){for(let w=f;w<b;w++){const T=d.get(w),E=this.getSymbolInstanceTextSize(o,v,l,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,T.padding)}}_updateIconDebugCollisionBoxes(o,l,d,f,b,v){for(let w=f;w<b;w++){const T=d.get(w),E=this.getSymbolInstanceIconSize(o,l,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,T.padding)}}updateCollisionDebugBuffers(o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=yp(this.iconSizeData,o),f=yp(this.textSizeData,o);for(let b=0;b<this.symbolInstances.length;b++){const v=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(f,o,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(f,o,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(d,o,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(d,o,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,d,f,b,v,w,T,E){const k={};if(l<d){const{x1:P,y1:L,x2:N,y2:z,padding:G,projectedAnchorX:ee,projectedAnchorY:de,projectedAnchorZ:De,tileAnchorX:he,tileAnchorY:we,featureIndex:Re}=o.get(l);k.textBox={x1:P,y1:L,x2:N,y2:z,padding:G,projectedAnchorX:ee,projectedAnchorY:de,projectedAnchorZ:De,tileAnchorX:he,tileAnchorY:we},k.textFeatureIndex=Re}if(f<b){const{x1:P,y1:L,x2:N,y2:z,padding:G,projectedAnchorX:ee,projectedAnchorY:de,projectedAnchorZ:De,tileAnchorX:he,tileAnchorY:we,featureIndex:Re}=o.get(f);k.verticalTextBox={x1:P,y1:L,x2:N,y2:z,padding:G,projectedAnchorX:ee,projectedAnchorY:de,projectedAnchorZ:De,tileAnchorX:he,tileAnchorY:we},k.verticalTextFeatureIndex=Re}if(v<w){const{x1:P,y1:L,x2:N,y2:z,padding:G,projectedAnchorX:ee,projectedAnchorY:de,projectedAnchorZ:De,tileAnchorX:he,tileAnchorY:we,featureIndex:Re}=o.get(v);k.iconBox={x1:P,y1:L,x2:N,y2:z,padding:G,projectedAnchorX:ee,projectedAnchorY:de,projectedAnchorZ:De,tileAnchorX:he,tileAnchorY:we},k.iconFeatureIndex=Re}if(T<E){const{x1:P,y1:L,x2:N,y2:z,padding:G,projectedAnchorX:ee,projectedAnchorY:de,projectedAnchorZ:De,tileAnchorX:he,tileAnchorY:we,featureIndex:Re}=o.get(T);k.verticalIconBox={x1:P,y1:L,x2:N,y2:z,padding:G,projectedAnchorX:ee,projectedAnchorY:de,projectedAnchorZ:De,tileAnchorX:he,tileAnchorY:we},k.verticalIconFeatureIndex=Re}return k}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,l){const d=o.placedSymbolArray.get(l),f=d.vertexStartIndex+4*d.numGlyphs;for(let b=d.vertexStartIndex;b<f;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),d=Math.cos(o),f=[],b=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const T=this.symbolInstances.get(w);f.push(0|Math.round(l*T.tileAnchorX+d*T.tileAnchorY)),b.push(T.featureIndex)}return v.sort((w,T)=>f[w]-f[T]||b[T]-b[w]),v}addToSortKeyRanges(o,l){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:b,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:E}=d;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),b>=0&&b!==f&&this.addIndicesForPlacedSymbol(this.text,b),v>=0&&v!==b&&v!==f&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}bn(Zu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Zu.MAX_GLYPHS=65535,Zu.addDynamicAttributes=em;const Sy=new _e({"symbol-placement":new $(_t.layout_symbol["symbol-placement"]),"symbol-spacing":new $(_t.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $(_t.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new te(_t.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $(_t.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $(_t.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new $(_t.layout_symbol["icon-ignore-placement"]),"icon-optional":new $(_t.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $(_t.layout_symbol["icon-rotation-alignment"]),"icon-size":new te(_t.layout_symbol["icon-size"]),"icon-text-fit":new $(_t.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $(_t.layout_symbol["icon-text-fit-padding"]),"icon-image":new te(_t.layout_symbol["icon-image"]),"icon-rotate":new te(_t.layout_symbol["icon-rotate"]),"icon-padding":new $(_t.layout_symbol["icon-padding"]),"icon-keep-upright":new $(_t.layout_symbol["icon-keep-upright"]),"icon-offset":new te(_t.layout_symbol["icon-offset"]),"icon-anchor":new te(_t.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $(_t.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $(_t.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $(_t.layout_symbol["text-rotation-alignment"]),"text-field":new te(_t.layout_symbol["text-field"]),"text-font":new te(_t.layout_symbol["text-font"]),"text-size":new te(_t.layout_symbol["text-size"]),"text-max-width":new te(_t.layout_symbol["text-max-width"]),"text-line-height":new te(_t.layout_symbol["text-line-height"]),"text-letter-spacing":new te(_t.layout_symbol["text-letter-spacing"]),"text-justify":new te(_t.layout_symbol["text-justify"]),"text-radial-offset":new te(_t.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $(_t.layout_symbol["text-variable-anchor"]),"text-anchor":new te(_t.layout_symbol["text-anchor"]),"text-max-angle":new $(_t.layout_symbol["text-max-angle"]),"text-writing-mode":new $(_t.layout_symbol["text-writing-mode"]),"text-rotate":new te(_t.layout_symbol["text-rotate"]),"text-padding":new $(_t.layout_symbol["text-padding"]),"text-keep-upright":new $(_t.layout_symbol["text-keep-upright"]),"text-transform":new te(_t.layout_symbol["text-transform"]),"text-offset":new te(_t.layout_symbol["text-offset"]),"text-allow-overlap":new $(_t.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new $(_t.layout_symbol["text-ignore-placement"]),"text-optional":new $(_t.layout_symbol["text-optional"])});var jl={paint:new _e({"icon-opacity":new te(_t.paint_symbol["icon-opacity"]),"icon-color":new te(_t.paint_symbol["icon-color"]),"icon-halo-color":new te(_t.paint_symbol["icon-halo-color"]),"icon-halo-width":new te(_t.paint_symbol["icon-halo-width"]),"icon-halo-blur":new te(_t.paint_symbol["icon-halo-blur"]),"icon-translate":new $(_t.paint_symbol["icon-translate"]),"icon-translate-anchor":new $(_t.paint_symbol["icon-translate-anchor"]),"text-opacity":new te(_t.paint_symbol["text-opacity"]),"text-color":new te(_t.paint_symbol["text-color"],{runtimeType:_s,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new te(_t.paint_symbol["text-halo-color"]),"text-halo-width":new te(_t.paint_symbol["text-halo-width"]),"text-halo-blur":new te(_t.paint_symbol["text-halo-blur"]),"text-translate":new $(_t.paint_symbol["text-translate"]),"text-translate-anchor":new $(_t.paint_symbol["text-translate-anchor"])}),layout:Sy};class pb{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Er,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bn(pb,"FormatSectionOverride",{omit:["defaultValue"]});class tm extends Wo{constructor(o){super(o,jl)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const f=[];for(const b of d)f.indexOf(b)<0&&f.push(b);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,l,d,f){const b=this.layout.get(o).evaluate(l,{},d,f),v=this._unevaluatedLayout._values[o];return v.isDataDriven()||Fd(v.value)||!b?b:(w=l.properties,b.replace(/{([^{}]+)}/g,(E,k)=>k in w?String(w[k]):""));var w}createBucket(o){return new Zu(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of jl.paint.overridableProperties){if(!tm.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),d=new pb(l),f=new ff(d,l.property.specification);let b=null;b="constant"===l.value.kind||"source"===l.value.kind?new mf("source",f):new hr("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new oe(l.property,b,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&tm.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const d=o.get("text-field"),f=jl.paint.properties[l];let b=!1;const v=w=>{for(const T of w)if(f.overrides&&f.overrides.hasOverride(T))return void(b=!0)};if("constant"===d.value.kind&&d.value.value instanceof Gs)v(d.value.value.sections);else if("source"===d.value.kind){const w=E=>{b||(E instanceof Do&&oo(E.value)===zi?v(E.value.sections):E instanceof Qt?v(E.sections):E.eachChild(w))},T=d.value;T._styleExpression&&w(T._styleExpression.expression)}return b}getProgramConfiguration(o){return new qd(this,o)}}var Cy={paint:new _e({"background-color":new $(_t.paint_background["background-color"]),"background-pattern":new $(_t.paint_background["background-pattern"]),"background-opacity":new $(_t.paint_background["background-opacity"])})},KI={paint:new _e({"raster-opacity":new $(_t.paint_raster["raster-opacity"]),"raster-hue-rotate":new $(_t.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $(_t.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $(_t.paint_raster["raster-brightness-max"]),"raster-saturation":new $(_t.paint_raster["raster-saturation"]),"raster-contrast":new $(_t.paint_raster["raster-contrast"]),"raster-resampling":new $(_t.paint_raster["raster-resampling"]),"raster-fade-duration":new $(_t.paint_raster["raster-fade-duration"])})};class hx extends Wo{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var QI={paint:new _e({"sky-type":new $(_t.paint_sky["sky-type"]),"sky-atmosphere-sun":new $(_t.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new $(_t.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new $(_t.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new $(_t.paint_sky["sky-gradient-radius"]),"sky-gradient":new me(_t.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new $(_t.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new $(_t.paint_sky["sky-atmosphere-color"]),"sky-opacity":new $(_t.paint_sky["sky-opacity"])})};function Dp(a,o,l){const d=[0,0,1],f=R_([]);return u0(f,f,l?-se(a)+Math.PI:se(a)),up(f,f,-se(o)),k_(d,d,f),Fo(d,d)}const fb={circle:class extends Wo{constructor(a){super(a,v1)}createBucket(a){return new Vf(a)}queryRadius(a){const o=a;return Uu("circle-radius",this,o)+Uu("circle-stroke-width",this,o)+jf(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,l,d,f,b,v,w){const T=Ag(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return _0(a,d,b,v,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,E)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new qd(this,a)}},heatmap:class extends Wo{createBucket(a){return new kg(a)}constructor(a){super(a,x0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Qc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Uu("heatmap-radius",this,a)}queryIntersectsFeature(a,o,l,d,f,b,v,w){const T=this.paint.get("heatmap-radius").evaluate(o,l);return _0(a,d,b,v,w,!0,!0,new Ae(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new qd(this,a)}},hillshade:class extends Wo{constructor(a){super(a,w0)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Wo{constructor(a){super(a,E1)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new qd(this,a)}recalculate(a,o){super.recalculate(a,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new fc(a)}queryRadius(){return jf(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,l,d,f,b){return!a.queryGeometry.isAboveHorizon&&$_(b0(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),d)}isTileClipped(){return!0}},"fill-extrusion":class extends Wo{constructor(a){super(a,V0)}createBucket(a){return new jg(a)}queryRadius(){return jf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new qd(this,a)}queryIntersectsFeature(a,o,l,d,f,b,v,w,T){const E=Ag(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(o,l),P=this.paint.get("fill-extrusion-base").evaluate(o,l),L=[0,0],N=w&&b.elevation,z=b.elevation?b.elevation.exaggeration():1,G=a.tile.getBucket(this);if(N&&G instanceof jg){const we=G.centroidVertexArray,Re=T+1;Re<we.length&&(L[0]=we.geta_centroid_pos0(Re),L[1]=we.geta_centroid_pos1(Re))}if(0===L[0]&&1===L[1])return!1;"globe"===b.projection.name&&(d=z0([d],[new Ae(0,0),new Ae(On,On)],a.tileID.canonical).map(we=>we.polygon).flat());const ee=N?w:null,[de,De]=(Re=d,Pe=P,at=k,rt=E,yt=v,Ht=ee,dt=L,Mt=z,Et=b.center.lat,"globe"===(we=b).projection.name?function(Wt,mt,an,gn,dn,Zn,Yt,Pn,ei,Hi,ti){const Vn=[],Wi=[],Yn=Wt.projection.upVectorScale(ti,Wt.center.lat,Wt.worldSize).metersToTile,Kn=[0,0,0,1],or=[0,0,0,1],Ar=(_r,qr,Qr,Gr)=>{_r[0]=qr,_r[1]=Qr,_r[2]=Gr,_r[3]=1},br=B0();an>0&&(an+=br),gn+=br;for(const _r of mt){const qr=[],Qr=[];for(const Gr of _r){const Sr=Gr.x+dn.x,ko=Gr.y+dn.y,bo=Wt.projection.projectTilePoint(Sr,ko,ti),Jr=Wt.projection.upVector(ti,Gr.x,Gr.y);let Ji=an,_o=gn;if(Yt){const kr=iy(Sr,ko,an,gn,Yt,Pn,ei,Hi);Ji+=kr.base,_o+=kr.top}0!==an?Ar(Kn,bo.x+Jr[0]*Yn*Ji,bo.y+Jr[1]*Yn*Ji,bo.z+Jr[2]*Yn*Ji):Ar(Kn,bo.x,bo.y,bo.z),Ar(or,bo.x+Jr[0]*Yn*_o,bo.y+Jr[1]*Yn*_o,bo.z+Jr[2]*Yn*_o),je(Kn,Kn,Zn),je(or,or,Zn),qr.push(new _p(Kn[0],Kn[1],Kn[2])),Qr.push(new _p(or[0],or[1],or[2]))}Vn.push(qr),Wi.push(Qr)}return[Vn,Wi]}(we,Re,Pe,at,rt,yt,Ht,dt,Mt,Et,a.tileID.canonical):Ht?function(Wt,mt,an,gn,dn,Zn,Yt,Pn,ei){const Hi=[],ti=[],Vn=[0,0,0,1];for(const Wi of Wt){const Yn=[],Kn=[];for(const or of Wi){const Ar=or.x+gn.x,br=or.y+gn.y,_r=iy(Ar,br,mt,an,Zn,Yt,Pn,ei);Vn[0]=Ar,Vn[1]=br,Vn[2]=_r.base,Vn[3]=1,Xc(Vn,Vn,dn),Vn[3]=Math.max(Vn[3],1e-5);const qr=new _p(Vn[0]/Vn[3],Vn[1]/Vn[3],Vn[2]/Vn[3]);Vn[0]=Ar,Vn[1]=br,Vn[2]=_r.top,Vn[3]=1,Xc(Vn,Vn,dn),Vn[3]=Math.max(Vn[3],1e-5);const Qr=new _p(Vn[0]/Vn[3],Vn[1]/Vn[3],Vn[2]/Vn[3]);Yn.push(qr),Kn.push(Qr)}Hi.push(Yn),ti.push(Kn)}return[Hi,ti]}(Re,Pe,at,rt,yt,Ht,dt,Mt,Et):function(Wt,mt,an,gn,dn){const Zn=[],Yt=[],Pn=dn[8]*mt,ei=dn[9]*mt,Hi=dn[10]*mt,ti=dn[11]*mt,Vn=dn[8]*an,Wi=dn[9]*an,Yn=dn[10]*an,Kn=dn[11]*an;for(const or of Wt){const Ar=[],br=[];for(const _r of or){const qr=_r.x+gn.x,Qr=_r.y+gn.y,Gr=dn[0]*qr+dn[4]*Qr+dn[12],Sr=dn[1]*qr+dn[5]*Qr+dn[13],ko=dn[2]*qr+dn[6]*Qr+dn[14],bo=dn[3]*qr+dn[7]*Qr+dn[15],Jr=Gr+Pn,Ji=Sr+ei,_o=ko+Hi,kr=Math.max(bo+ti,1e-5),Es=Gr+Vn,Xt=Sr+Wi,Zo=ko+Yn,Co=Math.max(bo+Kn,1e-5);Ar.push(new _p(Jr/kr,Ji/kr,_o/kr)),br.push(new _p(Es/Co,Xt/Co,Zo/Co))}Zn.push(Ar),Yt.push(br)}return[Zn,Yt]}(Re,Pe,at,rt,yt)),he=a.queryGeometry;var we,Re,Pe,at,rt,yt,Ht,dt,Mt,Et;return function(we,Re,Pe){let at=1/0;$_(Pe,Re)&&(at=_a(Pe,Re[0]));for(let rt=0;rt<Re.length;rt++){const yt=Re[rt],Ht=we[rt];for(let dt=0;dt<yt.length-1;dt++){const Mt=yt[dt],Et=[Mt,yt[dt+1],Ht[dt+1],Ht[dt],Mt];Dg(Pe,Et)&&(at=Math.min(at,_a(Pe,Et)))}}return at!==1/0&&at}(de,De,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},line:class extends Wo{constructor(a){super(a,$g),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Hh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=oy.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new ry(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new qd(this,a)}queryRadius(a){const o=a,l=sy(Uu("line-width",this,o),Uu("line-gap-width",this,o)),d=Uu("line-offset",this,o);return l/2+Math.abs(d)+jf(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,l,d,f,b){if(a.queryGeometry.isAboveHorizon)return!1;const v=b0(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,a.pixelToTileUnitsFactor),w=a.pixelToTileUnitsFactor/2*sy(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),T=this.paint.get("line-offset").evaluate(o,l);return T&&(d=function(E,k){const P=[],L=new Ae(0,0);for(let N=0;N<E.length;N++){const z=E[N],G=[];for(let ee=0;ee<z.length;ee++){const de=z[ee],De=z[ee+1],he=0===ee?L:de.sub(z[ee-1])._unit()._perp(),we=ee===z.length-1?L:De.sub(de)._unit()._perp(),Re=he._add(we)._unit();Re._mult(1/(Re.x*we.x+Re.y*we.y)),G.push(Re._mult(k)._add(de))}P.push(G)}return P}(d,T*a.pixelToTileUnitsFactor)),function(E,k,P){for(let L=0;L<k.length;L++){const N=k[L];if(E.length>=3)for(let z=0;z<N.length;z++)if(ju(E,N[z]))return!0;if(g1(E,N,P))return!0}return!1}(v,d,w)}isTileClipped(){return!0}},symbol:tm,background:class extends Wo{constructor(a){super(a,Cy)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Wo{constructor(a){super(a,KI)}getProgramIds(){return["raster"]}},sky:class extends Wo{constructor(a){super(a,QI),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Qc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const d=this.paint.get("sky-atmosphere-sun"),f=!d,b=a.style.light,v=b.properties.get("position");return f&&"viewport"===b.properties.get("anchor")&&Jn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?Dp(v.azimuthal,90-v.polar,o):Dp(d[0],90-d[1],o)}const l=this.paint.get("sky-gradient-center");return Dp(l[0],90-l[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class oh{constructor(o,l,d,f){this.context=o,this.format=d,this.texture=o.gl.createTexture(),this.update(l,f)}update(o,l,d){const{width:f,height:b}=o,{context:v}=this,{gl:w}=v,{HTMLImageElement:T,HTMLCanvasElement:E,HTMLVideoElement:k,ImageData:P,ImageBitmap:L}=ie;if(w.bindTexture(w.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!l||!1!==l.premultiply)),d||this.size&&this.size[0]===f&&this.size[1]===b){const{x:N,y:z}=d||{x:0,y:0};o instanceof T||o instanceof E||o instanceof k||o instanceof P||L&&o instanceof L?w.texSubImage2D(w.TEXTURE_2D,0,N,z,w.RGBA,w.UNSIGNED_BYTE,o):w.texSubImage2D(w.TEXTURE_2D,0,N,z,f,b,w.RGBA,w.UNSIGNED_BYTE,o.data)}else this.size=[f,b],o instanceof T||o instanceof E||o instanceof k||o instanceof P||L&&o instanceof L?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,o):w.texImage2D(w.TEXTURE_2D,0,this.format,f,b,0,this.format,w.UNSIGNED_BYTE,o.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(o,l){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),o!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?o===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:o),this.filter=o),l!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class Ty{constructor(o){this._callback=o,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Ey{constructor(){this.tasks={},this.taskQueue=[],Ii(["process"],this),this.invoker=new Ty(this.process),this.nextId=0}add(o,l){const d=this.nextId++,f=function({type:b,isSymbolTile:v,zoom:w}){return w=w||0,"message"===b?0:"maybePrepare"!==b||v?"parseTile"!==b||v?"parseTile"===b&&v?300-w:"maybePrepare"===b&&v?400-w:500:200-w:100-w}(l);if(0===f){Zr();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[d]={fn:o,metadata:l,priority:f,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){Zr();try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const b=this.tasks[this.taskQueue[f]];b.priority<l&&(l=b.priority,o=f)}if(null===o)return null;const d=this.taskQueue[o];return this.taskQueue.splice(o,1),d}remove(){this.invoker.remove()}}class mC{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const d=o[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const gC=["tile","layer","source","sourceLayer","state"];class px{constructor(o,l,d,f,b){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=d,this._y=f,this.properties=o.properties,this.id=b}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const l of gC)void 0!==this[l]&&(o[l]=this[l]);return o}}const iu=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,l=0,d=0,f=0,b=0,v=0,w=0;for(1&o?f=b=v=32:l=d=w=32;(o>>=1)>1;){const E=l+f>>1,k=d+b>>1;1&o?(f=l,b=d,l=v,d=w):(l=f,d=b,f=v,b=w),v=E,w=k}const T=4*a;iu[T+0]=l,iu[T+1]=d,iu[T+2]=f,iu[T+3]=b}const ru=new Uint16Array(2178),Yu=new Uint8Array(1089),Dy=new Uint16Array(1089);function Iy(a){return 0===a?-.03125:32===a?.03125:0}var My=qe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const fx={type:2,extent:On,loadGeometry:()=>[[new Ae(0,0),new Ae(8193,0),new Ae(8193,8193),new Ae(0,8193),new Ae(0,0)]]};class nm{constructor(o,l,d,f,b){this.tileID=o,this.uid=Kt(),this.uses=0,this.tileSize=l,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(o){const l=o+this.timeAdded;l<Ia.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ih(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,d){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(f,b){const v={};if(!b)return v;for(const w of f){const T=w.layerIds.map(E=>b.getLayer(E)).filter(Boolean);if(0!==T.length){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(E=>T.filter(k=>k.id===E)[0]));for(const E of T)v[E.id]=w}}return v}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const b=this.buckets[f];if(b instanceof Zu){if(this.hasSymbolBuckets=!0,!d)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const b=this.buckets[f];if(b instanceof Zu&&b.hasRTLText){this.hasRTLText=!0,M.isLoading()||M.isLoaded()||"deferred"!==S()||D();break}}this.queryPadding=0;for(const f in this.buckets){const b=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new ar}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const d in this.buckets){const f=this.buckets[d];f.uploadPending()&&f.upload(o)}const l=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new oh(o,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new oh(o,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new oh(o,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,l,d,f,b,v,w,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:w,transform:v,params:b,tileTransform:this.tileTransform},o,l,d):{}}querySourceFeatures(o,l){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const f=d.loadVTLayers(),b=l?l.sourceLayer:"",v=f._geojsonTileLayer||f[b];if(!v)return;const w=Qh(l&&l.filter),{z:T,x:E,y:k}=this.tileID.canonical,P={z:T,x:E,y:k};for(let L=0;L<v.length;L++){const N=v.feature(L);if(w.needGeometry){const ee=Vu(N,!0);if(!w.filter(new R(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!w.filter(new R(this.tileID.overscaledZ),N))continue;const z=d.getId(N,b),G=new px(N,T,E,k,z);G.tile=P,o.push(G)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const l=this.expirationTime;if(o.cacheControl){const d=fe(o.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const d=Date.now();let f=!1;if(this.expirationTime>d)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const b=this.expirationTime-l;b?this.expirationTime=d+Math.max(b,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!l)return;const d=this.latestFeatureIndex.loadVTLayers(),f=l.style.listImages();for(const b in this.buckets){if(!l.style.hasLayer(b))continue;const v=this.buckets[b],w=v.layers[0].sourceLayer||"_geojsonTileLayer",T=d[w],E=o[w];if(!T||!E||0===Object.keys(E).length)continue;if(v.update(E,T,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof ry||v instanceof fc){const P=l.style._getSourceCache(v.layers[0].source);l._terrain&&l._terrain.enabled&&P&&v.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(P.id,this.tileID)}const k=l&&l.style&&l.style.getLayer(b);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ia.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=Ia.now()+o}setTexture(o,l){const d=l.context,f=d.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new oh(d,o,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(o,l){const d={};for(const f of l)d[f]=!0;this.dependencies[o]=d}hasDependency(o,l){for(const d of o){const f=this.dependencies[d];if(f)for(const b of l)if(f[b])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const d=Yc(fx,this.tileID.canonical,this.tileTransform)[0],f=new Vt,b=new zs;for(let v=0;v<d.length;v++){const{x:w,y:T}=d[v];f.emplaceBack(w,T),b.emplaceBack(v)}b.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(b),this._tileDebugBuffer=o.createVertexBuffer(f,Pf.members),this._tileDebugSegments=$r.simpleSegment(0,0,f.length,b.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const d=Yc(fx,this.tileID.canonical,this.tileTransform)[0];let f,b;if(this.isRaster){const v=function(w,T){const E=ih(w,T),k=Math.pow(2,w.z);for(let ee=0;ee<33;ee++)for(let de=0;de<33;de++){const De=Ua((w.x+(de+Iy(de))/32)/k),he=wr((w.y+(ee+Iy(ee))/32)/k),we=T.project(De,he),Re=33*ee+de;ru[2*Re+0]=Math.round((we.x*E.scale-E.x)*On),ru[2*Re+1]=Math.round((we.y*E.scale-E.y)*On)}Yu.fill(0),Dy.fill(0);for(let ee=2045;ee>=0;ee--){const de=4*ee,De=iu[de+0],he=iu[de+1],we=iu[de+2],Re=iu[de+3],Pe=De+we>>1,at=he+Re>>1,rt=Pe+at-he,yt=at+De-Pe,Ht=33*he+De,dt=33*Re+we,Mt=33*at+Pe,Et=Math.hypot((ru[2*Ht+0]+ru[2*dt+0])/2-ru[2*Mt+0],(ru[2*Ht+1]+ru[2*dt+1])/2-ru[2*Mt+1])>=16;Yu[Mt]=Yu[Mt]||(Et?1:0),ee<1022&&(Yu[Mt]=Yu[Mt]||Yu[33*(he+yt>>1)+(De+rt>>1)]||Yu[33*(Re+yt>>1)+(we+rt>>1)])}const P=new Tt,L=new Dn;let N=0;function z(ee,de){const De=33*de+ee;return 0===Dy[De]&&(P.emplaceBack(ru[2*De+0],ru[2*De+1],ee*On/32,de*On/32),Dy[De]=++N),Dy[De]-1}function G(ee,de,De,he,we,Re){const Pe=ee+De>>1,at=de+he>>1;if(Math.abs(ee-we)+Math.abs(de-Re)>1&&Yu[33*at+Pe])G(we,Re,ee,de,Pe,at),G(De,he,we,Re,Pe,at);else{const rt=z(ee,de),yt=z(De,he),Ht=z(we,Re);L.emplaceBack(rt,yt,Ht)}}return G(0,0,32,32,32,0),G(32,32,0,0,0,32),{vertices:P,indices:L}}(this.tileID.canonical,l);f=v.vertices,b=v.indices}else{f=new Tt,b=new Dn;for(const{x:w,y:T}of d)f.emplaceBack(w,T,0,0);const v=Q_(f.int16,void 0,4);for(let w=0;w<v.length;w+=3)b.emplaceBack(v[w],v[w+1],v[w+2])}this._tileBoundsBuffer=o.createVertexBuffer(f,My.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(b),this._tileBoundsSegments=$r.simpleSegment(0,0,f.length,b.length)}_makeGlobeTileDebugBuffers(o,l){const d=l.projection;if(!d||"globe"!==d.name||l.freezeTileCoverage)return;const f=this.tileID.canonical,b=Bf(f0(f,l)),v=Zd(l.zoom);let w;v>0&&(w=Cf(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,f,l,b,w,v),this._makeGlobeTileDebugTextBuffer(o,f,l,b,w,v)}_globePoint(o,l,d,f,b,v,w){let T=_g(o,l,d);if(v){const E=1<<d.z,k=hc(f.center.lng),P=Nl(f.center.lat),L=(d.x+.5)/E-k;let N=0;L>.5?N=-1:L<-.5&&(N=1);let z=(o/On+d.x)/E+N,G=(l/On+d.y)/E;z=(z-k)*f._pixelsPerMercatorPixel+k,G=(G-P)*f._pixelsPerMercatorPixel+P;const ee=[z*f.worldSize,G*f.worldSize,0];je(ee,ee,v),T=Xd(T,ee,w)}return je(T,T,b)}_makeGlobeTileDebugBorderBuffer(o,l,d,f,b,v){const w=new Vt,T=new zs,E=new nt,k=(L,N,z,G,ee)=>{const de=(z-L)/(ee-1),De=(G-N)/(ee-1),he=w.length;for(let we=0;we<ee;we++){const Re=L+we*de,Pe=N+we*De;w.emplaceBack(Re,Pe);const at=this._globePoint(Re,Pe,l,d,f,b,v);E.emplaceBack(at[0],at[1],at[2]),T.emplaceBack(he+we)}},P=On;k(0,0,P,0,16),k(P,0,P,P,16),k(P,P,0,P,16),k(0,P,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(T),this._tileDebugBuffer=o.createVertexBuffer(w,Pf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(E,P_.members),this._tileDebugSegments=$r.simpleSegment(0,0,w.length,T.length)}_makeGlobeTileDebugTextBuffer(o,l,d,f,b,v){const T=new Vt,E=new Dn,k=new nt,P=25;E.reserve(32),T.reserve(P),k.reserve(P);const L=(N,z)=>P*N+z;for(let N=0;N<P;N++){const z=2048*N;for(let G=0;G<P;G++){const ee=2048*G;T.emplaceBack(ee,z);const de=this._globePoint(ee,z,l,d,f,b,v);k.emplaceBack(de[0],de[1],de[2])}}for(let N=0;N<4;N++)for(let z=0;z<4;z++){const G=L(N,z),ee=L(N,z+1),de=L(N+1,z),De=L(N+1,z+1);E.emplaceBack(G,ee,de),E.emplaceBack(de,ee,De)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(E),this._tileDebugTextBuffer=o.createVertexBuffer(T,Pf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(k,P_.members),this._tileDebugTextSegments=$r.simpleSegment(0,0,P,32)}}class JI{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,d){const f=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][f]=this.stateChanges[o][f]||{},Fi(this.stateChanges[o][f],d),null===this.deletedStates[o]){this.deletedStates[o]={};for(const b in this.state[o])b!==f&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][f]){this.deletedStates[o][f]={};for(const b in this.state[o][f])d[b]||(this.deletedStates[o][f][b]=null)}else for(const b in d)this.deletedStates[o]&&this.deletedStates[o][f]&&null===this.deletedStates[o][f][b]&&delete this.deletedStates[o][f][b]}removeFeatureState(o,l,d){if(null===this.deletedStates[o])return;const f=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},d&&void 0!==l)null!==this.deletedStates[o][f]&&(this.deletedStates[o][f]=this.deletedStates[o][f]||{},this.deletedStates[o][f][d]=null);else if(void 0!==l)if(this.stateChanges[o]&&this.stateChanges[o][f])for(d in this.deletedStates[o][f]={},this.stateChanges[o][f])this.deletedStates[o][f][d]=null;else this.deletedStates[o][f]=null;else this.deletedStates[o]=null}getState(o,l){const d=String(l),f=Fi({},(this.state[o]||{})[d],(this.stateChanges[o]||{})[d]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const b=this.deletedStates[o][l];if(null===b)return{};for(const v in b)delete f[v]}return f}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){const d={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const b={};for(const v in this.stateChanges[f])this.state[f][v]||(this.state[f][v]={}),Fi(this.state[f][v],this.stateChanges[f][v]),b[v]=this.state[f][v];d[f]=b}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const b={};if(null===this.deletedStates[f])for(const v in this.state[f])b[v]={},this.state[f][v]={};else for(const v in this.deletedStates[f]){if(null===this.deletedStates[f][v])this.state[f][v]={};else if(this.state[f][v])for(const w of Object.keys(this.deletedStates[f][v]))delete this.state[f][v][w];b[v]=this.state[f][v]}d[f]=d[f]||{},Fi(d[f],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(d).length)for(const f in o)o[f].setFeatureState(d,l)}}class bC{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const d=this.toIdx(o,l);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function _C(a,o,l,d){let f=0,b=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(d[v])<1e-15){if(l[v]<a[v]||l[v]>o[v])return null}else{const w=1/d[v];let T=(a[v]-l[v])*w,E=(o[v]-l[v])*w;if(T>E){const k=T;T=E,E=k}if(T>f&&(f=T),E<b&&(b=E),f>b)return null}return f}function yC(a,o,l,d,f,b,v,w,T,E,k){const P=d-a,L=f-o,N=b-l,z=v-a,G=w-o,ee=T-l,de=k[1]*ee-k[2]*G,De=k[2]*z-k[0]*ee,he=k[0]*G-k[1]*z,we=P*de+L*De+N*he;if(Math.abs(we)<1e-15)return null;const Re=1/we,Pe=E[0]-a,at=E[1]-o,rt=E[2]-l,yt=(Pe*de+at*De+rt*he)*Re;if(yt<0||yt>1)return null;const Ht=at*N-rt*L,dt=rt*P-Pe*N,Mt=Pe*L-at*P,Et=(k[0]*Ht+k[1]*dt+k[2]*Mt)*Re;return Et<0||yt+Et>1?null:(z*Ht+G*dt+ee*Mt)*Re}function vC(a,o,l){return(a-o)/(l-o)}function xC(a,o,l,d,f,b,v,w,T){const E=1<<l,k=b-d,P=v-f,L=(a+1)/E*k+d,N=(o+0)/E*P+f,z=(o+1)/E*P+f;w[0]=(a+0)/E*k+d,w[1]=N,T[0]=L,T[1]=z}class wC{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(b){const v=Math.ceil(Math.log2(b.dim/8)),w=[];let T=Math.ceil(Math.pow(2,v));const E=1/T,k=(N,z,G,ee,de)=>{const De=ee?1:0,he=(N+1)*G-De,we=z*G,Re=(z+1)*G-De;de[0]=N*G,de[1]=we,de[2]=he,de[3]=Re};let P=new bC(T);const L=[];for(let N=0;N<T*T;N++){k(N%T,Math.floor(N/T),E,!1,L);const z=sh(L[0],L[1],b),G=sh(L[2],L[1],b),ee=sh(L[2],L[3],b),de=sh(L[0],L[3],b);P.minimums.push(Math.min(z,G,ee,de)),P.maximums.push(Math.max(z,G,ee,de)),P.leaves.push(1)}for(w.push(P),T/=2;T>=1;T/=2){const N=w[w.length-1];P=new bC(T);for(let z=0;z<T*T;z++){k(z%T,Math.floor(z/T),2,!0,L);const G=N.getElevation(L[0],L[1]),ee=N.getElevation(L[2],L[1]),de=N.getElevation(L[2],L[3]),De=N.getElevation(L[0],L[3]),he=N.isLeaf(L[0],L[1]),we=N.isLeaf(L[2],L[1]),Re=N.isLeaf(L[2],L[3]),Pe=N.isLeaf(L[0],L[3]),at=Math.min(G.min,ee.min,de.min,De.min),rt=Math.max(G.max,ee.max,de.max,De.max),yt=he&&we&&Re&&Pe;P.maximums.push(rt),P.minimums.push(at),P.leaves.push(rt-at<=5&&yt?1:0)}w.push(P)}return w}(this.dem),d=l.length-1,f=l[d];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,d,0)}raycastRoot(o,l,d,f,b,v,w=1){return _C([o,l,-100],[d,f,this.maximums[0]*w],b,v)}raycast(o,l,d,f,b,v,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(o,l,d,f,b,v,w);if(null==T)return null;const E=[],k=[],P=[],L=[],N=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:z,t:G,nodex:ee,nodey:de,depth:De}=N.pop();if(this.leaves[z]){xC(ee,de,De,o,l,d,f,P,L);const we=1<<De,Re=(ee+0)/we,Pe=(ee+1)/we,at=(de+0)/we,rt=(de+1)/we,yt=sh(Re,at,this.dem)*w,Ht=sh(Pe,at,this.dem)*w,dt=sh(Pe,rt,this.dem)*w,Mt=sh(Re,rt,this.dem)*w,Et=yC(P[0],P[1],yt,L[0],P[1],Ht,L[0],L[1],dt,b,v),Ot=yC(L[0],L[1],dt,P[0],L[1],Mt,P[0],P[1],yt,b,v),Wt=Math.min(null!==Et?Et:Number.MAX_VALUE,null!==Ot?Ot:Number.MAX_VALUE);if(Wt!==Number.MAX_VALUE)return Wt;{const mt=lp([],b,v,G);if(SC(yt,Ht,Mt,dt,vC(mt[0],P[0],L[0]),vC(mt[1],P[1],L[1]))>=mt[2])return G}continue}let he=0;for(let we=0;we<this._siblingOffset.length;we++){xC((ee<<1)+this._siblingOffset[we][0],(de<<1)+this._siblingOffset[we][1],De+1,o,l,d,f,P,L),P[2]=-100,L[2]=this.maximums[this.childOffsets[z]+we]*w;const Re=_C(P,L,b,v);if(null!=Re){const Pe=Re;E[we]=Pe;let at=!1;for(let rt=0;rt<he&&!at;rt++)Pe>=E[k[rt]]&&(k.splice(rt,0,we),at=!0);at||(k[he]=we),he++}}for(let we=0;we<he;we++){const Re=k[we];N.push({idx:this.childOffsets[z]+Re,t:E[Re],nodex:(ee<<1)+this._siblingOffset[Re][0],nodey:(de<<1)+this._siblingOffset[Re][1],depth:De+1})}}return null}_addNode(o,l,d){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,d,f,b){if(1===o[f].isLeaf(l,d))return;this.childOffsets[b]||(this.childOffsets[b]=this.nodeCount);const v=f-1,w=o[v];let T=0,E=0;for(let k=0;k<this._siblingOffset.length;k++){const P=2*l+this._siblingOffset[k][0],L=2*d+this._siblingOffset[k][1],N=w.getElevation(P,L),z=w.isLeaf(P,L),G=this._addNode(N.min,N.max,z);z&&(T|=1<<k),E||(E=G)}for(let k=0;k<this._siblingOffset.length;k++)T&1<<k||this._construct(o,2*l+this._siblingOffset[k][0],2*d+this._siblingOffset[k][1],v,E+k)}}function SC(a,o,l,d,f,b){return Vi(Vi(a,l,b),Vi(o,d,b),f)}function sh(a,o,l){const d=l.dim,f=Dt(a*d-.5,0,d-1),b=Dt(o*d-.5,0,d-1),v=Math.floor(f),w=Math.floor(b),T=Math.min(v+1,d-1),E=Math.min(w+1,d-1);return SC(l.get(v,w),l.get(T,w),l.get(v,E),l.get(T,E),f-v,b-w)}const CC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Ku(a,o,l){return(256*a*256+256*o+l)/10-1e4}function Ay(a,o,l){return 256*a+o+l/256-32768}class mb{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,d,f=!1,b=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&"mapbox"!==d&&"terrarium"!==d)return Jn(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const v=this.dim=l.height-2,w=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=d||"mapbox",this.borderReady=f,!f){for(let T=0;T<v;T++)w[this._idx(-1,T)]=w[this._idx(0,T)],w[this._idx(v,T)]=w[this._idx(v-1,T)],w[this._idx(T,-1)]=w[this._idx(T,0)],w[this._idx(T,v)]=w[this._idx(T,v-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(v,-1)]=w[this._idx(v-1,0)],w[this._idx(-1,v)]=w[this._idx(0,v-1)],w[this._idx(v,v)]=w[this._idx(v-1,v-1)],b&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new wC(this)}get(o,l,d=!1){d&&(o=Dt(o,-1,this.dim),l=Dt(l,-1,this.dim));const f=4*this._idx(o,l);return("terrarium"===this.encoding?Ay:Ku)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(o){return CC[o]}get unpackVector(){return CC[this.encoding]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const d=[0,0,0,0],f=mb.getUnpackVector(l);let b=Math.floor((o+f[3])/f[2]);return d[2]=b%256,b=Math.floor(b/256),d[1]=b%256,b=Math.floor(b/256),d[0]=b,d}getPixels(){return new Js({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,d){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,b=l*this.dim+this.dim,v=d*this.dim,w=d*this.dim+this.dim;switch(l){case-1:f=b-1;break;case 1:b=f+1}switch(d){case-1:v=w-1;break;case 1:w=v+1}const T=-l*this.dim,E=-d*this.dim;for(let k=v;k<w;k++)for(let P=f;P<b;P++){const L=4*this._idx(P,k),N=4*this._idx(P+T,k+E);this.pixels[L+0]=o.pixels[N+0],this.pixels[L+1]=o.pixels[N+1],this.pixels[L+2]=o.pixels[N+2],this.pixels[L+3]=o.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}bn(mb,"DEMData"),bn(wC,"DemMinMaxQuadTree",{omit:["dem"]});class mx{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(const o in this.data)for(const l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,d){const f=o.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const b={value:l,timeout:void 0};if(void 0!==d&&(b.timeout=setTimeout(()=>{this.remove(o,b)},d)),this.data[f].push(b),this.order.push(f),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){const l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;const d=o.wrapped().key,f=void 0===l?0:this.data[d].indexOf(l),b=this.data[d][f];return this.data[d].splice(f,1),b.timeout&&clearTimeout(b.timeout),0===this.data[d].length&&delete this.data[d],this.onRemove(b.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){const l=[];for(const d in this.data)for(const f of this.data[d])o(f.value)||l.push(f);for(const d of l)this.remove(d.value.tileID,d)}}class Qu{constructor(o,l,d){this.func=o,this.mask=l,this.range=d}}Qu.ReadOnly=!1,Qu.ReadWrite=!0,Qu.disabled=new Qu(519,Qu.ReadOnly,[0,1]);class im{constructor(o,l,d,f,b,v){this.test=o,this.ref=l,this.mask=d,this.fail=f,this.depthFail=b,this.pass=v}}im.disabled=new im({func:519,mask:0},0,0,7680,7680,7680);class xc{constructor(o,l,d){this.blendFunction=o,this.blendColor=l,this.mask=d}}xc.Replace=[1,0],xc.disabled=new xc(xc.Replace,mo.transparent,[!1,!1,!1,!1]),xc.unblended=new xc(xc.Replace,mo.transparent,[!0,!0,!0,!0]),xc.alphaBlended=new xc([1,771],mo.transparent,[!0,!0,!0,!0]);class Ul{constructor(o,l,d){this.enable=o,this.mode=l,this.frontFace=d}}Ul.disabled=new Ul(!1,1029,2305),Ul.backCCW=new Ul(!0,1029,2305),Ul.backCW=new Ul(!0,1029,2304),Ul.frontCW=new Ul(!0,1028,2304),Ul.frontCCW=new Ul(!0,1028,2305);class ah extends yu{constructor(o,l,d){super(),this.id=o,this._onlySymbols=d,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new mx(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new JI,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const l=this._tiles[o];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const d=this._tiles[l];d.upload(o),d.prepare(this.map.style.imageManager)}}getIds(){return qi(this._tiles).map(o=>o.tileID).sort(ky).map(o=>o.key)}getRenderableIds(o){const l=[];for(const d in this._tiles)this._isIdRenderable(+d,o)&&l.push(this._tiles[d]);return o?l.sort((d,f)=>{const b=d.tileID,v=f.tileID,w=new Ae(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),T=new Ae(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-v.overscaledZ||T.y-w.y||T.x-w.x}).map(d=>d.tileID.key):l.map(d=>d.tileID).sort(ky).map(d=>d.key)}hasRenderableParent(o){const l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){const d=this._tiles[o];d&&("loading"!==d.state&&(d.state=l),this._loadTile(d,this._tileLoaded.bind(this,d,o,l)))}_tileLoaded(o,l,d,f){if(f)if(o.state="errored",404!==f.status)this._source.fire(new il(f,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=Ia.now(),"expired"===d&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new Fc("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const b=l[f];if(o.neighboringTiles&&o.neighboringTiles[b]){const v=this.getTileByID(b);d(o,v),d(v,o)}}function d(f,b){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let v=b.tileID.canonical.x-f.tileID.canonical.x;const w=b.tileID.canonical.y-f.tileID.canonical.y,T=Math.pow(2,f.tileID.canonical.z),E=b.tileID.key;0===v&&0===w||Math.abs(w)>1||(Math.abs(v)>1&&(1===Math.abs(v+T)?v+=T:1===Math.abs(v-T)&&(v-=T)),b.dem&&f.dem&&(f.dem.backfillBorder(b.dem,v,w),f.neighboringTiles&&f.neighboringTiles[E]&&(f.neighboringTiles[E].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,d,f){for(const b in this._tiles){let v=this._tiles[b];if(f[b]||!v.hasData()||v.tileID.overscaledZ<=l||v.tileID.overscaledZ>d)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>l+1;){const E=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[E.key],v&&v.hasData()&&(w=E)}let T=w;for(;T.overscaledZ>l;)if(T=T.scaledTo(T.overscaledZ-1),o[T.key]){f[w.key]=w;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){const d=this._loadedParentTiles[o.key];return d&&d.tileID.overscaledZ>=l?d:null}for(let d=o.overscaledZ-1;d>=l;d--){const f=o.scaledTo(d),b=this._getLoadedTile(f);if(b)return b}}_getLoadedTile(o){const l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;const d=Math.ceil(o.width/l)+1,f=Math.ceil(o.height/l)+1,b=Math.floor(d*f*5),v="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,b):b,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(w)}handleWrapJump(o){const l=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,l){const d={};for(const f in this._tiles){const b=this._tiles[f];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+l),d[b.tileID.key]=b}this._tiles=d;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(o,l,d){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;let f;this.updateCacheSize(o,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new js(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(f=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(w=>this._source.hasTile(w)))):f=[];const b=this._updateRetainedTiles(f);if(gx(this._source.type)&&0!==f.length){const w={},T={},E=Object.keys(b);for(const P of E){const L=b[P],N=this._tiles[P];if(!N||N.fadeEndTime&&N.fadeEndTime<=Ia.now())continue;const z=this.findLoadedParent(L,Math.max(L.overscaledZ-ah.maxOverzooming,this._source.minzoom));z&&(this._addTile(z.tileID),w[z.tileID.key]=z.tileID),T[P]=L}const k=f[f.length-1].overscaledZ;for(const P in this._tiles){const L=this._tiles[P];if(b[P]||!L.hasData())continue;let N=L.tileID;for(;N.overscaledZ>k;){N=N.scaledTo(N.overscaledZ-1);const z=this._tiles[N.key];if(z&&z.hasData()&&T[N.key]){b[P]=L.tileID;break}}}for(const P in w)b[P]||(this._coveredTiles[P]=!0,b[P]=w[P])}for(const w in b)this._tiles[w].clearFadeHold();const v=function(w,T){const E=[];for(const k in w)k in T||E.push(k);return E}(this._tiles,b);for(const w of v){const T=this._tiles[w];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const l={};if(0===o.length)return l;const d={},f=o.reduce((E,k)=>Math.min(E,k.overscaledZ),1/0),b=o[0].overscaledZ,v=Math.max(b-ah.maxOverzooming,this._source.minzoom),w=Math.max(b+ah.maxUnderzooming,this._source.minzoom),T={};for(const E of o){const k=this._addTile(E);l[E.key]=E,k.hasData()||f<this._source.maxzoom&&(T[E.key]=E)}this._retainLoadedChildren(T,f,w,l);for(const E of o){let k=this._tiles[E.key];if(k.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const L=E.children(this._source.maxzoom)[0],N=this.getTile(L);if(N&&N.hasData()){l[L.key]=L;continue}}else{const L=E.children(this._source.maxzoom);if(l[L[0].key]&&l[L[1].key]&&l[L[2].key]&&l[L[3].key])continue}let P=k.wasRequested();for(let L=E.overscaledZ-1;L>=v;--L){const N=E.scaledTo(L);if(d[N.key]||(d[N.key]=!0,k=this.getTile(N),!k&&P&&(k=this._addTile(N)),k&&(l[N.key]=N,P=k.wasRequested(),k.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const l=[];let d,f=this._tiles[o].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){d=this._loadedParentTiles[f.key];break}l.push(f.key);const b=f.scaledTo(f.overscaledZ-1);if(d=this._getLoadedTile(b),d)break;f=b}for(const b of l)this._loadedParentTiles[b]=d}}_addTile(o){let l=this._tiles[o.key];if(l)return l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));const d=Boolean(l);if(!d){const f=this.map?this.map.painter:null;l=new nm(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,d||this._source.fire(new Fc("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const d=l.getExpiryTimeout();d&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},d))}_removeTile(o){const l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,d){const f=[],b=this.transform;if(!b)return f;const v="globe"===b.projection.name,w=hc(b.center.lng);for(const T in this._tiles){const E=this._tiles[T];if(d&&E.clearQueryDebugViz(),E.holdingForFade())continue;let k;if(v){const P=E.tileID.canonical;if(0===P.z){const L=[Math.abs(Dt(w,...rm(P,-1))-w),Math.abs(Dt(w,...rm(P,1))-w)];k=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(Dt(w,...rm(P,-1))-w),Math.abs(Dt(w,...rm(P,0))-w),Math.abs(Dt(w,...rm(P,1))-w)];k=[L.indexOf(Math.min(...L))-1]}}else k=[0];for(const P of k){const L=o.containsTile(E,b,l,P);L&&f.push(L)}}return f}getVisibleCoordinates(o){const l=this.getRenderableIds(o).map(d=>this._tiles[d].tileID);for(const d of l)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(gx(this._source.type))for(const o in this._tiles){const l=this._tiles[o];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=Ia.now())return!0}return!1}setFeatureState(o,l,d){this._state.updateState(o=o||"_geojsonTileLayer",l,d)}removeFeatureState(o,l,d){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,d)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,d){const f=this._tiles[o];f&&f.setDependencies(l,d)}reloadTilesForDependencies(o,l){for(const d in this._tiles)this._tiles[d].hasDependency(o,l)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(o,l))}_preloadTiles(o,l){if(!this._sourceLoaded){const w=()=>{this._sourceLoaded&&(this._source.off("data",w),this._preloadTiles(o,l))};return void this._source.on("data",w)}const d=new Map,f=Array.isArray(o)?o:[o],b=this.map.painter.terrain,v=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const w of f){const T=w.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of T)d.set(E.key,E);this.usedForTerrain&&w.updateElevation(!1)}cn(Array.from(d.values()),(w,T)=>{const E=new nm(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,k=>{"raster-dem"===this._source.type&&E.dem&&this._backfillDEM(E),T(k,E)})},l)}}function ky(a,o){const l=Math.abs(2*a.wrap)-+(a.wrap<0),d=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||d-l||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function gx(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function rm(a,o){const l=1<<a.z;return[a.x/l+o,(a.x+1)/l+o]}ah.maxOverzooming=10,ah.maxUnderzooming=3;class lh{constructor(o,l,d){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=d}static create(o,l,d){const f=d||o.findDEMTileFor(l);if(!f||!f.dem)return;const b=f.dem,v=f.tileID,w=1<<l.canonical.z-v.canonical.z;return new lh(f,f.tileSize/On/w,[(l.canonical.x/w-v.canonical.x)*b.dim,(l.canonical.y/w-v.canonical.y)*b.dim])}tileCoordToPixel(o,l){const d=l*this._scale+this._offset[1],f=Math.floor(o*this._scale+this._offset[0]),b=Math.floor(d);return new Ae(f,b)}getElevationAt(o,l,d,f){const b=o*this._scale+this._offset[0],v=l*this._scale+this._offset[1],w=Math.floor(b),T=Math.floor(v),E=this._dem;return f=!!f,d?Vi(Vi(E.get(w,T,f),E.get(w,T+1,f),v-T),Vi(E.get(w+1,T,f),E.get(w+1,T+1,f),v-T),b-w):E.get(w,T,f)}getElevationAtPixel(o,l,d){return this._dem.get(o,l,!!d)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*Bl(1,o)*this._dem.stride}}class ch{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Pu(On,16,0),this.featureIndexArray=new Rl,this.promoteId=l}insert(o,l,d,f,b,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,f,b,v);const T=this.grid;for(let E=0;E<l.length;E++){const k=l[E],P=[1/0,1/0,-1/0,-1/0];for(let L=0;L<k.length;L++){const N=k[L];P[0]=Math.min(P[0],N.x),P[1]=Math.min(P[1],N.y),P[2]=Math.max(P[2],N.x),P[3]=Math.max(P[3],N.y)}P[0]<On&&P[1]<On&&P[2]>=0&&P[3]>=0&&T.insert(w,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new gp(new Yg(this.rawTileData)).layers,this.sourceLayerCoder=new mC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,d,f){this.loadVTLayers();const b=o.params||{},v=Qh(b.filter),w=o.tileResult,T=o.transform,E=w.bufferedTilespaceBounds,k=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(z,G,ee,de)=>_1(w.bufferedTilespaceGeometry,z,G,ee,de));k.sort(Ip);let P=null;T.elevation&&k.length>0&&(P=lh.create(T.elevation,this.tileID));const L={};let N;for(let z=0;z<k.length;z++){const G=k[z];if(G===N)continue;N=G;const ee=this.featureIndexArray.get(G);let de=null;this.loadMatchingFeature(L,ee,v,b.layers,b.availableImages,l,d,f,(De,he,we,Re=0)=>(de||(de=Yc(De,this.tileID.canonical,o.tileTransform)),he.queryIntersectsFeature(w,De,we,de,this.z,o.transform,o.pixelPosMatrix,P,Re)))}return L}loadMatchingFeature(o,l,d,f,b,v,w,T,E){const{featureIndex:k,bucketIndex:P,sourceLayerIndex:L,layoutVertexArrayOffset:N}=l,z=this.bucketLayerIDs[P];if(f&&!function(De,he){for(let we=0;we<De.length;we++)if(he.indexOf(De[we])>=0)return!0;return!1}(f,z))return;const G=this.sourceLayerCoder.decode(L),ee=this.vtLayers[G].feature(k);if(d.needGeometry){const De=Vu(ee,!0);if(!d.filter(new R(this.tileID.overscaledZ),De,this.tileID.canonical))return}else if(!d.filter(new R(this.tileID.overscaledZ),ee))return;const de=this.getId(ee,G);for(let De=0;De<z.length;De++){const he=z[De];if(f&&f.indexOf(he)<0)continue;const we=v[he];if(!we)continue;let Re={};void 0!==de&&T&&(Re=T.getState(we.sourceLayer||"_geojsonTileLayer",de));const Pe=Fi({},w[he]);Pe.paint=_b(Pe.paint,we.paint,ee,Re,b),Pe.layout=_b(Pe.layout,we.layout,ee,Re,b);const at=!E||E(ee,we,Re,N);if(!at)continue;const rt=new px(ee,this.z,this.x,this.y,de);rt.layer=Pe;let yt=o[he];void 0===yt&&(yt=o[he]=[]),yt.push({featureIndex:k,feature:rt,intersectionZ:at})}}lookupSymbolFeatures(o,l,d,f,b,v,w,T){const E={};this.loadVTLayers();const k=Qh(b);for(const P of o)this.loadMatchingFeature(E,{bucketIndex:d,sourceLayerIndex:f,featureIndex:P,layoutVertexArrayOffset:0},k,v,w,T,l);return E}loadFeature(o){const{featureIndex:l,sourceLayerIndex:d}=o;this.loadVTLayers();const f=this.sourceLayerCoder.decode(d),b=this.vtFeatures[f];if(b[l])return b[l];const v=this.vtLayers[f].feature(l);return b[l]=v,v}hasLayer(o){for(const l of this.bucketLayerIDs)for(const d of l)if(o===d)return!0;return!1}getId(o,l){let d=o.id;if(this.promoteId){const f="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=f&&(d=o.properties[f]),"boolean"==typeof d&&(d=Number(d))}return d}}function _b(a,o,l,d,f){return W(a,(b,v)=>{const w=o instanceof ue?o.get(v):null;return w&&w.evaluate?w.evaluate(l,d,f):w})}function Ip(a,o){return o-a}bn(ch,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class yb{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new Kc({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const d=this.getKey(o,l);return this.positions[d]}trim(){const o=this.width,l=this.height=vo(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,d){const f=[];let b=o.length%2==1?-o[o.length-1]*d:0,v=o[0]*d,w=!0;f.push({left:b,right:v,isDash:w,zeroLength:0===o[0]});let T=o[0];for(let E=1;E<o.length;E++){w=!w;const k=o[E];b=T*d,T+=k,v=T*d,f.push({left:b,right:v,isDash:w,zeroLength:0===k})}return f}addRoundDash(o,l,d){const f=l/2;for(let b=-d;b<=d;b++){const v=this.width*(this.nextRow+d+b);let w=0,T=o[w];for(let E=0;E<this.width;E++){E/T.right>1&&(T=o[++w]);const k=Math.abs(E-T.left),P=Math.abs(E-T.right),L=Math.min(k,P);let N;const z=b/d*(f+1);if(T.isDash){const G=f-Math.abs(z);N=Math.sqrt(L*L+G*G)}else N=f-Math.sqrt(L*L+z*z);this.image.data[v+E]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(o,l){for(let T=o.length-1;T>=0;--T){const E=o[T],k=o[T+1];E.zeroLength?o.splice(T,1):k&&k.isDash===E.isDash&&(k.left=E.left,o.splice(T,1))}const d=o[0],f=o[o.length-1];d.isDash===f.isDash&&(d.left=f.left-this.width,f.right=d.right+this.width);const b=this.width*this.nextRow;let v=0,w=o[v];for(let T=0;T<this.width;T++){T/w.right>1&&(w=o[++v]);const E=Math.abs(T-w.left),k=Math.abs(T-w.right),P=Math.min(E,k);this.image.data[b+T]=Math.max(0,Math.min(255,(w.isDash?P:-P)+l+128))}}addDash(o,l){const d=this.getKey(o,l);if(this.positions[d])return this.positions[d];const f="round"===l,b=f?7:0,v=2*b+1;if(this.nextRow+v>this.height)return Jn("LineAtlas out of space"),null;0===o.length&&o.push(1);let w=0;for(let k=0;k<o.length;k++)o[k]<0&&(Jn("Negative value is found in line dasharray, replacing values with 0"),o[k]=0),w+=o[k];if(0!==w){const k=this.width/w,P=this.getDashRanges(o,this.width,k);f?this.addRoundDash(P,k,b):this.addRegularDash(P,"square"===l?.5*k:0)}const T=this.nextRow+b;this.nextRow+=v;const E={tl:[T,b],br:[w,0]};return this.positions[d]=E,E}}bn(yb,"LineAtlas");class Ry{constructor(o){const l={},d=[];for(const w in o){const T=o[w],E=l[w]={};for(const k in T.glyphs){const P=T.glyphs[+k];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const L=P.metrics.localGlyph?2:1,N={x:0,y:0,w:P.bitmap.width+2*L,h:P.bitmap.height+2*L};d.push(N),E[k]=N}}const{w:f,h:b}=tu(d),v=new Kc({width:f||1,height:b||1});for(const w in o){const T=o[w];for(const E in T.glyphs){const k=T.glyphs[+E];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const P=l[w][E],L=k.metrics.localGlyph?2:1;Kc.copy(k.bitmap,v,{x:0,y:0},{x:P.x+L,y:P.y+L},k.bitmap)}}this.image=v,this.positions=l}}bn(Ry,"GlyphAtlas");class bx{constructor(o){this.tileID=new js(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=ih(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,l,d,f,b){this.status="parsing",this.data=o,this.collisionBoxArray=new ar;const v=new mC(Object.keys(o.layers).sort()),w=new ch(this.tileID,this.promoteId);w.bucketLayerIDs=[];const T={},E=new yb(256,256),k={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:d},P=l.familiesBySource[this.source];for(const Re in P){const Pe=o.layers[Re];if(!Pe)continue;let at=!1,rt=!1;for(const dt of P[Re])"symbol"===dt[0].type?at=!0:rt=!0;if(!0===this.isSymbolTile&&!at||!1===this.isSymbolTile&&!rt)continue;1===Pe.version&&Jn(`Vector tile source "${this.source}" layer "${Re}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yt=v.encode(Re),Ht=[];for(let dt=0;dt<Pe.length;dt++){const Mt=Pe.feature(dt),Et=w.getId(Mt,Re);Ht.push({feature:Mt,id:Et,index:dt,sourceLayerIndex:yt})}for(const dt of P[Re]){const Mt=dt[0];void 0!==this.isSymbolTile&&"symbol"===Mt.type!==this.isSymbolTile||Mt.minzoom&&this.zoom<Math.floor(Mt.minzoom)||Mt.maxzoom&&this.zoom>=Mt.maxzoom||"none"!==Mt.visibility&&(sm(dt,this.zoom,d),(T[Mt.id]=Mt.createBucket({index:w.bucketLayerIDs.length,layers:dt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:d})).populate(Ht,k,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(dt.map(Et=>Et.id)))}}let L,N,z,G;E.trim();const ee={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},de=()=>{if(L)return b(L);if(N&&z&&G){const Re=new Ry(N),Pe=new Kg(z,G);for(const at in T){const rt=T[at];rt instanceof Zu?(sm(rt.layers,this.zoom,d),WI(rt,N,Re.positions,z,Pe.iconPositions,this.showCollisionBoxes,d,this.tileID.canonical,this.tileZoom,this.projection)):rt.hasPattern&&(rt instanceof ry||rt instanceof fc||rt instanceof jg)&&(sm(rt.layers,this.zoom,d),rt.addFeatures(k,this.tileID.canonical,Pe.patternPositions,d,this.tileTransform))}this.status="done",b(null,{buckets:qi(T).filter(at=>!at.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Re.image,lineAtlas:E,imageAtlas:Pe,glyphMap:this.returnDependencies?N:null,iconMap:this.returnDependencies?z:null,glyphPositions:this.returnDependencies?Re.positions:null})}},De=W(k.glyphDependencies,Re=>Object.keys(Re).map(Number));Object.keys(De).length?f.send("getGlyphs",{uid:this.uid,stacks:De},(Re,Pe)=>{L||(L=Re,N=Pe,de())},void 0,!1,ee):N={};const he=Object.keys(k.iconDependencies);he.length?f.send("getImages",{icons:he,source:this.source,tileID:this.tileID,type:"icons"},(Re,Pe)=>{L||(L=Re,z=Pe,de())},void 0,!1,ee):z={};const we=Object.keys(k.patternDependencies);we.length?f.send("getImages",{icons:we,source:this.source,tileID:this.tileID,type:"patterns"},(Re,Pe)=>{L||(L=Re,G=Pe,de())},void 0,!1,ee):G={},de()}}function sm(a,o,l){const d=new R(o);for(const f of a)f.recalculate(d,l)}class vb{constructor(o){this.entries={},this.scheduler=o}request(o,l,d,f){const b=this.entries[o]=this.entries[o]||{callbacks:[]};if(b.result){const[v,w]=b.result;return this.scheduler?this.scheduler.add(()=>{f(v,w)},l):f(v,w),()=>{}}return b.callbacks.push(f),b.cancel||(b.cancel=d((v,w)=>{b.result=[v,w];for(const T of b.callbacks)this.scheduler?this.scheduler.add(()=>{T(v,w)},l):T(v,w);setTimeout(()=>delete this.entries[o],3e3)})),()=>{b.result||(b.callbacks=b.callbacks.filter(v=>v!==f),b.callbacks.length||(b.cancel(),delete this.entries[o]))}}}function Py(a,o,l){const d=JSON.stringify(a.request);return a.data&&(this.deduped.entries[d]={result:[null,a.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const b=bu(a.request,(v,w,T,E)=>{v?f(v):w&&f(null,{vectorTile:l?void 0:new gp(new Yg(w)),rawData:w,cacheControl:T,expires:E})});return()=>{b.cancel(),f()}},o)}const xb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ly{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,d]=new Uint8Array(o,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const f=d>>4;if(1!==f)throw new Error(`Got v${f} data when expected v1.`);const b=xb[15&d];if(!b)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(o,2,1),[w]=new Uint32Array(o,4,1);return new Ly(w,v,b,o)}constructor(o,l=64,d=Float64Array,f){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=d,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const b=xb.indexOf(this.ArrayType),v=2*o*this.ArrayType.BYTES_PER_ELEMENT,w=o*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${d}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+w+T,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+T),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+w+T,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=o,this.coords[this._pos++]=l,d}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return _x(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,d,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:v,nodeSize:w}=this,T=[0,b.length-1,0],E=[];for(;T.length;){const k=T.pop()||0,P=T.pop()||0,L=T.pop()||0;if(P-L<=w){for(let ee=L;ee<=P;ee++){const de=v[2*ee],De=v[2*ee+1];de>=o&&de<=d&&De>=l&&De<=f&&E.push(b[ee])}continue}const N=L+P>>1,z=v[2*N],G=v[2*N+1];z>=o&&z<=d&&G>=l&&G<=f&&E.push(b[N]),(0===k?o<=z:l<=G)&&(T.push(L),T.push(N-1),T.push(1-k)),(0===k?d>=z:f>=G)&&(T.push(N+1),T.push(P),T.push(1-k))}return E}within(o,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:b,nodeSize:v}=this,w=[0,f.length-1,0],T=[],E=d*d;for(;w.length;){const k=w.pop()||0,P=w.pop()||0,L=w.pop()||0;if(P-L<=v){for(let ee=L;ee<=P;ee++)Fy(b[2*ee],b[2*ee+1],o,l)<=E&&T.push(f[ee]);continue}const N=L+P>>1,z=b[2*N],G=b[2*N+1];Fy(z,G,o,l)<=E&&T.push(f[N]),(0===k?o-d<=z:l-d<=G)&&(w.push(L),w.push(N-1),w.push(1-k)),(0===k?o+d>=z:l+d>=G)&&(w.push(N+1),w.push(P),w.push(1-k))}return T}}function _x(a,o,l,d,f,b){if(f-d<=l)return;const v=d+f>>1;yx(a,o,v,d,f,b),_x(a,o,l,d,v-1,1-b),_x(a,o,l,v+1,f,1-b)}function yx(a,o,l,d,f,b){for(;f>d;){if(f-d>600){const E=f-d+1,k=l-d+1,P=Math.log(E),L=.5*Math.exp(2*P/3),N=.5*Math.sqrt(P*L*(E-L)/E)*(k-E/2<0?-1:1);yx(a,o,l,Math.max(d,Math.floor(l-k*L/E+N)),Math.min(f,Math.floor(l+(E-k)*L/E+N)),b)}const v=o[2*l+b];let w=d,T=f;for(Mp(a,o,d,l),o[2*f+b]>v&&Mp(a,o,d,f);w<T;){for(Mp(a,o,w,T),w++,T--;o[2*w+b]<v;)w++;for(;o[2*T+b]>v;)T--}o[2*d+b]===v?Mp(a,o,d,T):(T++,Mp(a,o,T,f)),T<=l&&(d=T+1),l<=T&&(f=T-1)}}function Mp(a,o,l,d){Oy(a,l,d),Oy(o,2*l,2*d),Oy(o,2*l+1,2*d+1)}function Oy(a,o,l){const d=a[o];a[o]=a[l],a[l]=d}function Fy(a,o,l,d){const f=a-l,b=o-d;return f*f+b*b}p.ARRAY_TYPE=Ba,p.AUTH_ERR_MSG=Oe,p.Aabb=Vs,p.Actor=class{constructor(a,o,l){this.target=a,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Ii(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Zr()?a:ie,this.scheduler=new Ey}send(a,o,l,d,f=!1,b){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=b,this.callbacks[v]=l);const w=q(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!l,targetMapId:d,mustQueue:f,sourceMapId:this.mapId,data:Bs(o,w)},w),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(a){const o=a.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const d=this.cancelCallbacks[l];delete this.cancelCallbacks[l],d&&d.cancel()}else if(o.mustQueue||Zr()){const d=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,o),d&&d.metadata||{type:"message"})}else this.processTask(l,o)}processTask(a,o){if("<response>"===o.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(o.error?l(sc(o.error)):l(null,sc(o.data)))}else{const l=q(this.globalScope)?void 0:[],d=o.hasCallback?(b,v)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:b?Bs(b):null,data:Bs(v,l)},l)}:b=>{},f=sc(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,f,d);else if(this.parent.getWorkerSource){const b=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,b[0],f.source)[b[1]](f,d)}else d(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Wf,p.Color=mo,p.ColorMode=xc,p.CullFaceMode=Ul,p.DEMData=mb,p.DataConstantProperty=$,p.DedupedRequest=vb,p.DepthMode=Qu,p.EXTENT=On,p.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const l=o.getSource().maxzoom,d=1<<l,f=Math.floor(a.x),b=Math.floor((a.x-f)*d),v=Math.floor(a.y*d),w=this.findDEMTileFor(new js(l,f,l,b,v));return!(!w||!w.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const d=this._source();if(!d||a.y<0||a.y>1)return o;const f=d.getSource().maxzoom,b=1<<f,v=Math.floor(a.x),w=a.x-v,T=new js(f,v,f,Math.floor(w*b),Math.floor(a.y*b)),E=this.findDEMTileFor(T);if(!E||!E.dem)return o;const k=E.dem,P=1<<E.tileID.canonical.z,L=(w*P-E.tileID.canonical.x)*k.dim,N=(a.y*P-E.tileID.canonical.y)*k.dim,z=Math.floor(L),G=Math.floor(N);return(l?this.exaggeration():1)*Vi(Vi(k.get(z,G),k.get(z,G+1),N-G),Vi(k.get(z+1,G),k.get(z+1,G+1),N-G),L-z)}getAtTileOffset(a,o,l){const d=1<<a.canonical.z;return this.getAtPointOrZero(new Mo(a.wrap+(a.canonical.x+o/On)/d,(a.canonical.y+l/On)/d))}getAtTileOffsetFunc(a,o,l,d){return f=>{const b=this.getAtTileOffset(a,f.x,f.y),v=d.upVector(a.canonical,f.x,f.y);return Va(v,v,b*d.upVectorScale(a.canonical,o,l).metersToTile),v}}getForTilePoints(a,o,l,d){if(this.isUsingMockSource())return!1;const f=lh.create(this,a,d);return!!f&&(o.forEach(b=>{b[2]=this.exaggeration()*f.getElevationAt(b[0],b[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const l=o.dem.tree,d=o.tileID,f=1<<a.canonical.z-d.canonical.z;let b=a.canonical.x/f-d.canonical.x,v=a.canonical.y/f-d.canonical.y,w=0;for(let T=0;T<a.canonical.z-d.canonical.z&&!l.leaves[w];T++){b*=2,v*=2;const E=2*Math.floor(v)+Math.floor(b);w=l.childOffsets[w]+E,b%=1,v%=1}return{min:this.exaggeration()*l.minimums[w],max:this.exaggeration()*l.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=il,p.EvaluationParameters=R,p.Event=Fc,p.Evented=yu,p.FillExtrusionBucket=jg,p.Frustum=Gd,p.FrustumCorners=zu,p.GLOBE_RADIUS=uc,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=6,p.GLOBE_ZOOM_THRESHOLD_MIN=5,p.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,o){const l=new Vt,d=new Dn,f=[],b=a+1+2,v=o[0]+1,w=o[0]+1+(1+o.length),T=(E,k,P)=>{let L=E===b-1?E-2:0===E?E:E-1;return L+=P?24575:0,[L,k]};for(let E=0;E<b;++E)l.emplaceBack(...T(E,0,!0));for(let E=0;E<v;++E)for(let k=0;k<b;++k)l.emplaceBack(...T(k,E,(0===k||k===b-1)&&!0));for(let E=0;E<o.length;++E){const k=o[E];for(let P=0;P<b;++P)l.emplaceBack(...T(P,k,!0))}for(let E=0;E<o.length;++E){const k=d.length,P=o[E]+1+2,L=new Dn;for(let G=0;G<P-1;G++){const ee=G===P-2,de=ee?b*(w-o.length+E-G):b;for(let De=0;De<b-1;De++){const he=G*b+De;0===G||ee||0===De||De===b-2?(L.emplaceBack(he+1,he,he+de),L.emplaceBack(he+de,he+de+1,he+1)):(d.emplaceBack(he+1,he,he+de),d.emplaceBack(he+de,he+de+1,he+1))}}const N=$r.simpleSegment(0,k,l.length,d.length-k);for(let G=0;G<L.uint16.length;G+=3)d.emplaceBack(L.uint16[G],L.uint16[G+1],L.uint16[G+2]);const z=$r.simpleSegment(0,k,l.length,d.length-k);f.push({withoutSkirts:N,withSkirts:z})}return{vertices:l,indices:d,segments:f}}_createGrid(a){const o=this._fillGridMeshWithLods(64,Lf);this._gridSegments=o.segments,this._gridBuffer=a.createVertexBuffer(o.vertices,Pf.members),this._gridIndexBuffer=a.createIndexBuffer(o.indices,!0)}_createPoles(a){const o=new Dn;for(let f=0;f<=64;f++)o.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const l=new Pi,d=new Pi;this._poleSegments=[];for(let f=0,b=0;f<5;f++){const v=360/(1<<f);l.emplaceBack(0,-uc,0,.5,0),d.emplaceBack(0,-uc,0,.5,1);for(let w=0;w<=64;w++){const T=w/64,E=Vi(0,v,T),[k,P,L]=Ff(h1,p1,E,uc);l.emplaceBack(k,P,L,T,0),d.emplaceBack(k,P,L,T,1)}this._poleSegments.push($r.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,Rf,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(d,Rf,!1)}getGridBuffers(a,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const l=new ao,d=64,f=d+1+2,b=1;this._wireframeSegments=[];for(let v=0,w=0;v<Lf.length;v++){const T=Lf[v];for(let k=b;k<T+b;k++)for(let P=b;P<d+b;P++){const L=k*f+P;l.emplaceBack(L,L+1),l.emplaceBack(L,L+f),l.emplaceBack(L,L+f+1)}const E=T*d*3;this._wireframeSegments.push($r.simpleSegment(0,w,(T+1)*f,E)),w+=E}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},p.GlyphManager=wp,p.ImagePosition=Qf,p.KDBush=Ly,p.LivePerformanceUtils=Tl,p.LngLat=xr,p.LngLatBounds=Fu,p.LocalGlyphMode=yy,p.MAX_MERCATOR_LATITUDE=Xo,p.MercatorCoordinate=Mo,p.ONE_EM=24,p.OverscaledTileID=js,p.PerformanceMarkers=_u,p.Point=Ae,p.Properties=_e,p.RGBAImage=Js,p.Ray=L_,p.RequestManager=class{constructor(a,o,l){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let l=0;l<10;l++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Jt,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!Ve(a))return a;const l=rn(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!Ve(a))return a;const l=rn(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeSourceURL(a,o,l,d){if(!Ve(a))return a;const f=rn(a);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),l&&f.params.push(`language=${l}`),d&&f.params.push(`worldview=${d}`),this._makeAPIURL(f,this._customAccessToken||o)}normalizeSpriteURL(a,o,l,d){const f=rn(a);return Ve(a)?(f.path=`/styles/v1${f.path}/sprite${o}${l}`,this._makeAPIURL(f,this._customAccessToken||d)):(f.path+=`${o}${l}`,Gt(f))}normalizeTileURL(a,o,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Ve(a))return a;const d=rn(a);d.path=d.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||l&&"raster"!==d.authority&&512===l?"@2x":""}${Ye.supported?".webp":"$1"}`),"raster"===d.authority?d.path=`/${Ue.RASTER_URL_PREFIX}${d.path}`:(d.path=d.path.replace(/^.+\/v4\//,"/"),d.path=`/${Ue.TILE_URL_VERSION}${d.path}`);const f=this._customAccessToken||function(b){for(const v of b){const w=v.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(d.params)||Ue.ACCESS_TOKEN;return Ue.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&d.params.push(`sku=${this._skuToken}`),this._makeAPIURL(d,f)}canonicalizeTileURL(a,o){const l=rn(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let d="mapbox://";l.path.match(/^\/raster\/v1\//)?d+=`raster/${l.path.replace(`/${Ue.RASTER_URL_PREFIX}/`,"")}`:d+=`tiles/${l.path.replace(`/${Ue.TILE_URL_VERSION}/`,"")}`;let f=l.params;return o&&(f=f.filter(b=>!b.match(/^access_token=/))),f.length&&(d+=`?${f.join("&")}`),d}canonicalizeTileset(a,o){const l=!!o&&Ve(o),d=[];for(const f of a.tiles||[])tt(f)?d.push(this.canonicalizeTileURL(f,l)):d.push(f);return d}_makeAPIURL(a,o){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",d=rn(Ue.API_URL);if(a.protocol=d.protocol,a.authority=d.authority,"http"===a.protocol){const f=a.params.indexOf("secure");f>=0&&a.params.splice(f,1)}if("/"!==d.path&&(a.path=`${d.path}${a.path}`),!Ue.REQUIRE_ACCESS_TOKEN)return Gt(a);if(o=o||Ue.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(f=>-1===f.indexOf("access_token")),a.params.push(`access_token=${o||""}`),Gt(a)}},p.ResourceType=Ea,p.SegmentVector=$r,p.SourceCache=ah,p.StencilMode=im,p.StructArrayLayout1ui2=zs,p.StructArrayLayout2f1f2i16=Rn,p.StructArrayLayout2i4=Vt,p.StructArrayLayout2ui4=ao,p.StructArrayLayout3f12=ai,p.StructArrayLayout3ui6=Dn,p.StructArrayLayout4i8=Tt,p.StructArrayLayout5f20=Pi,p.Texture=oh,p.Tile=nm,p.Transitionable=U,p.Uniform1f=Wc,p.Uniform1i=class extends Fl{constructor(a){super(a),this.current=0}set(a,o,l){this.fetchUniformLocation(a,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},p.Uniform2f=class extends Fl{constructor(a){super(a),this.current=[0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},p.Uniform3f=class extends Fl{constructor(a){super(a),this.current=[0,0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},p.Uniform4f=a1,p.UniformColor=t0,p.UniformMatrix2f=class extends Fl{constructor(a){super(a),this.current=zI}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let d=0;d<4;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},p.UniformMatrix3f=class extends Fl{constructor(a){super(a),this.current=BI}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let d=0;d<9;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},p.UniformMatrix4f=class extends Fl{constructor(a){super(a),this.current=It}set(a,o,l){if(this.fetchUniformLocation(a,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let d=1;d<16;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},p.UnwrappedTileID=Hg,p.ValidationError=pn,p.VectorTileFeature=ml,p.VectorTileWorkerSource=class extends yu{constructor(a,o,l,d,f){super(),this.actor=a,this.layerIndex=o,this.availableImages=l,this.loadVectorData=f||Py,this.loading={},this.loaded={},this.deduped=new vb(a.scheduler),this.isSpriteLoaded=d,this.scheduler=a.scheduler}loadTile(a,o){const l=a.uid,d=a&&a.request,f=d&&d.collectResourceTiming,b=this.loading[l]=new bx(a);b.abort=this.loadVectorData(a,(v,w)=>{const T=!this.loading[l];if(delete this.loading[l],T||v||!w)return b.status="done",T||(this.loaded[l]=b),o(v);const E=w.rawData,k={};w.expires&&(k.expires=w.expires),w.cacheControl&&(k.cacheControl=w.cacheControl),b.vectorTile=w.vectorTile||new gp(new Yg(E));const P=()=>{b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,N)=>{if(L||!N)return o(L);const z={};if(f){const G=Ql(d);G.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify(G)))}o(null,Fi({rawTileData:E.slice(0)},N,k,z))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[l]=b})}reloadTile(a,o){const l=this.loaded,d=a.uid,f=this;if(l&&l[d]){const b=l[d];b.showCollisionBoxes=a.showCollisionBoxes,b.enableTerrain=!!a.enableTerrain,b.projection=a.projection,b.tileTransform=ih(a.tileID.canonical,a.projection);const v=(w,T)=>{const E=b.reloadCallback;E&&(delete b.reloadCallback,b.parse(b.vectorTile,f.layerIndex,this.availableImages,f.actor,E)),o(w,T)};"parsing"===b.status?b.reloadCallback=v:"done"===b.status&&(b.vectorTile?b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(a,o){const l=a.uid,d=this.loading[l];d&&(d.abort&&d.abort(),delete this.loading[l]),o()}removeTile(a,o){const l=this.loaded,d=a.uid;l&&l[d]&&delete l[d],o()}},p.WritingMode=qa,p.ZoomDependentExpression=hr,p.add=za,p.addDynamicAttributes=em,p.adjoint=function(a,o){var l=o[0],d=o[1],f=o[2],b=o[3],v=o[4],w=o[5],T=o[6],E=o[7],k=o[8];return a[0]=v*k-w*E,a[1]=f*E-d*k,a[2]=d*w-f*v,a[3]=w*T-b*k,a[4]=l*k-f*T,a[5]=f*b-l*w,a[6]=b*E-v*T,a[7]=d*T-l*E,a[8]=l*v-d*b,a},p.asyncAll=cn,p.bezier=He,p.bindAll=Ii,p.boundsAttributes=My,p.bufferConvexPolygon=function(a,o){const l=[];for(let d=0;d<a.length;d++){const f=Lt(d-1,-1,a.length-1),b=Lt(d+1,-1,a.length-1),v=a[d],w=a[b],T=a[f].sub(v).unit(),E=w.sub(v).unit(),k=E.angleWithSep(T.x,T.y),P=T.add(E).unit().mult(-1*o/Math.sin(k/2));l.push(v.add(P))}return l},p.cacheEntryPossiblyAdded=function(a){ms++,ms>Ni&&(a.getActor().send("enforceCacheSizeLimit",nn),ms=0)},p.calculateGlobeLabelMatrix=function(a,o){const{x:l,y:d}=a.point,f=vg(l,d,a.worldSize/a._pixelsPerMercatorPixel,0,0);return pl(f,f,yg(Zc(o)))},p.calculateGlobeMatrix=function(a){const{x:o,y:l}=a.point,{lng:d,lat:f}=a._center;return vg(o,l,a.worldSize,d,f)},p.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,l=o/Bl(1,a.center.lat),d=go(new Float64Array(16));return hg(d,d,[a.point.x,a.point.y,0]),Nu(d,d,[l,l,o]),Float32Array.from(d)},p.circumferenceAtLatitude=j_,p.clamp=Dt,p.clearTileCache=function(a){if(!io())return;const o=ie.caches.delete(qt);a&&o.catch(a).then(()=>a())},p.clipLine=ex,p.clone=function(a){var o=new Ba(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},p.clone$1=Je,p.collisionCircleLayout=X1,p.config=Ue,p.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},p.create=function(){var a=new Ba(16);return Ba!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},p.create$1=l1,p.createExpression=pa,p.createLayout=qe,p.createStyleLayer=function(a){return"custom"===a.type?new hx(a):new fb[a.type](a)},p.cross=A_,p.degToRad=se,p.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},p.div=function(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a},p.dot=Ts,p.earthRadius=zf,p.ease=vt,p.easeCubicInOut=gt,p.ecefToLatLng=function([a,o,l]){const d=Math.hypot(a,o,l),f=Math.atan2(a,l),b=.5*Math.PI-Math.acos(-o/d);return new xr(be(f),be(b))},p.emitValidationErrors=Ru,p.endsWith=ge,p.enforceCacheSizeLimit=function(a){yr(),Di&&Di.then(o=>{o.keys().then(l=>{for(let d=0;d<l.length-a;d++)o.delete(l[d])})})},p.evaluateSizeForFeature=mc,p.evaluateSizeForZoom=yp,p.evaluateVariableOffset=ox,p.evented=x,p.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},p.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},p.exported=Ia,p.exported$1=Ye,p.extend=Fi,p.extend$1=El,p.fillExtrusionHeightLift=B0,p.filterObject=Nt,p.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},p.fromQuat=function(a,o){var l=o[0],d=o[1],f=o[2],b=o[3],v=l+l,w=d+d,T=f+f,E=l*v,k=d*v,P=d*w,L=f*v,N=f*w,z=f*T,G=b*v,ee=b*w,de=b*T;return a[0]=1-P-z,a[1]=k+de,a[2]=L-ee,a[3]=0,a[4]=k-de,a[5]=1-E-z,a[6]=N+G,a[7]=0,a[8]=L+ee,a[9]=N-G,a[10]=1-E-P,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.fromRotation=function(a,o){var l=Math.sin(o),d=Math.cos(o);return a[0]=d,a[1]=l,a[2]=0,a[3]=-l,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},p.fromScaling=s0,p.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return lt[o]},p.getAABBPointSquareDist=function(a,o,l){let d=0;for(let f=0;f<2;++f){const b=l?l[f]:0;a[f]>b&&(d+=(a[f]-b)*(a[f]-b)),o[f]<b&&(d+=(b-o[f])*(b-o[f]))}return d},p.getAnchorAlignment=my,p.getAnchorJustification=ib,p.getBounds=function(a){let o=1/0,l=1/0,d=-1/0,f=-1/0;for(const b of a)o=Math.min(o,b.x),l=Math.min(l,b.y),d=Math.max(d,b.x),f=Math.max(f,b.y);return{min:new Ae(o,l),max:new Ae(d,f)}},p.getColumn=Ke,p.getDefaultExportFromCjs=vn,p.getGridMatrix=function(a,o,l,d){const f=o.getNorth(),b=o.getSouth(),v=o.getWest(),w=o.getEast(),T=1<<a.z,E=w-v,k=f-b,P=E/64,L=-k/Lf[l],N=[0,P,0,L,0,0,f,v,0];if(a.z>0){const z=180/d;D_(N,N,[z/E+1,0,0,0,z/k+1,0,-.5*z/P,.5*z/L,1])}return N[2]=T,N[5]=a.x,N[8]=a.y,N},p.getImage=ve,p.getJSON=function(a,o){return Lc(Fi(a,{type:"json"}),o)},p.getLatitudinalLod=function(a){const o=Xo-5;a=Dt(a,-o,o)/o*90;const l=Math.pow(Math.abs(Math.sin(se(a))),3);return Math.round(l*(Lf.length-1))},p.getMapSessionAPI=Eo,p.getPerformanceMeasurement=Ql,p.getProjection=ub,p.getRTLTextPluginStatus=S,p.getReferrer=Kl,p.getTilePoint=function(a,{x:o,y:l},d=0){return new Ae(((o-d)*a.scale-a.x)*On,(l*a.scale-a.y)*On)},p.getTileVec3=function(a,o,l=0){return Tf(((o.x-l)*a.scale-a.x)*On,(o.y*a.scale-a.y)*On,wg(o.z,o.y))},p.getVideo=function(a,o){const l=ie.document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let d=0;d<a.length;d++){const f=ie.document.createElement("source");Fh(a[d])||(l.crossOrigin="Anonymous"),f.src=a[d],l.appendChild(f)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(a){const o=[0,0,0],l=go(new Float64Array(16));return pl(l,a.pixelMatrix,a.globeMatrix),je(o,o,l),new Ae(o[0],o[1])},p.globeDenormalizeECEF=yg,p.globeECEFOrigin=function(a,o){const l=[0,0,0];return je(l,l,Bf(Zc(o.canonical))),je(l,l,a),l},p.globeMetersToEcef=mg,p.globeNormalizeECEF=Bf,p.globePixelsToTileUnits=function(a,o){return On/(512*Math.pow(2,a))*B_(Zc(o))},p.globePoleMatrixForTile=function(a,o,l){const d=go(new Float64Array(16)),f=(o/(1<<a)-.5)*Math.PI*2;return pg(d,l.globeMatrix,f),Float32Array.from(d)},p.globeTileBounds=Zc,p.globeTiltAtLngLat=z_,p.globeToMercatorTransition=Zd,p.globeUseCustomAntiAliasing=function(a,o,l){const d=Zd(l.zoom),f=a.style.map._antialias,b=!!o.extStandardDerivatives,v=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===d&&!f&&!v&&b},p.identity=go,p.identity$1=R_,p.invert=Cf,p.isFullscreen=function(){return!!ie.document.fullscreenElement||!!ie.document.webkitFullscreenElement},p.isLngLatBehindGlobe=xg,p.isMapAuthenticated=function(a){return gs.has(a)},p.isMapboxURL=Ve,p.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!q(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=wr,p.latLngToECEF=Nf,p.len=u1,p.length=Bu,p.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},p.lngFromMercatorX=Ua,p.loadVectorTile=Py,p.makeRequest=Lc,p.mapValue=function(a,o,l,d,f){return Dt((a-o)/(l-o)*(f-d)+d,d,f)},p.mercatorScale=Sg,p.mercatorXfromLng=hc,p.mercatorYfromLat=Nl,p.mercatorZfromAltitude=Bl,p.mul=c1,p.mul$1=Af,p.multiply=pl,p.multiply$1=D_,p.multiply$2=Df,p.nextPowerOfTwo=vo,p.normalize=Fo,p.normalize$1=d0,p.normalize$2=c0,p.number=Vi,p.ortho=function(a,o,l,d,f,b,v){var w=1/(o-l),T=1/(d-f),E=1/(b-v);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*E,a[11]=0,a[12]=(o+l)*w,a[13]=(f+d)*T,a[14]=(v+b)*E,a[15]=1,a},p.pbf=Jc,p.perspective=function(a,o,l,d,f){var b,v=1/Math.tan(o/2);return a[0]=v/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=f&&f!==1/0?(a[10]=(f+d)*(b=1/(d-f)),a[14]=2*f*d*b):(a[10]=-1,a[14]=-2*d),a},p.pick=function(a,o){const l={};for(let d=0;d<o.length;d++){const f=o[d];f in a&&(l[f]=a[f])}return l},p.plugin=M,p.pointGeometry=Te,p.polesInViewport=function(a){const o=go(new Float64Array(16));pl(o,a.pixelMatrix,a.globeMatrix);const l=[0,fl,0],d=[0,Ks,0];return je(l,l,o),je(d,d,o),[l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!xg(a,new xr(a.center.lat,90)),d[0]>0&&d[0]<=a.width&&d[1]>0&&d[1]<=a.height&&!xg(a,new xr(a.center.lat,-90))]},p.polygonContainsPoint=ju,p.polygonIntersectsBox=_1,p.polygonIntersectsPolygon=Dg,p.polygonizeBounds=function(a,o,l=0,d=!0){const f=new Ae(l,l),b=a.sub(f),v=o.add(f),w=[b,new Ae(v.x,b.y),v,new Ae(b.x,v.y)];return d&&w.push(b.clone()),w},p.posAttributes=Pf,p.postMapLoadEvent=po,p.postPerformanceEvent=xo,p.postTurnstileEvent=Mi,p.potpack=tu,p.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},p.radToDeg=be,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(a){return a({pluginStatus:g,pluginURL:c}),x.on("pluginStateChange",a),a},p.removeAuthState=function(a){gs.delete(a)},p.renderColorRamp=Qc,p.resample=U_,p.rotateX=I_,p.rotateX$1=up,p.rotateY=pg,p.rotateY$1=u0,p.rotateZ=function(a,o,l){var d=Math.sin(l),f=Math.cos(l),b=o[0],v=o[1],w=o[2],T=o[3],E=o[4],k=o[5],P=o[6],L=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*f+E*d,a[1]=v*f+k*d,a[2]=w*f+P*d,a[3]=T*f+L*d,a[4]=E*f-b*d,a[5]=k*f-v*d,a[6]=P*f-w*d,a[7]=L*f-T*d,a},p.rotateZ$1=function(a,o,l){l*=.5;var d=o[0],f=o[1],b=o[2],v=o[3],w=Math.sin(l),T=Math.cos(l);return a[0]=d*T+f*w,a[1]=f*T-d*w,a[2]=b*T+v*w,a[3]=v*T-b*w,a},p.scale=Nu,p.scale$1=l0,p.scale$2=Va,p.scaleAndAdd=lp,p.set=function(a,o,l,d){return a[0]=o,a[1]=l,a[2]=d,a},p.setCacheLimits=function(a,o){nn=a,Ni=o},p.setColumn=function(a,o,l){a[4*o+0]=l[0],a[4*o+1]=l[1],a[4*o+2]=l[2],a[4*o+3]=l[3]},p.setRTLTextPlugin=function(a,o,l=!1){if(g===Ud||g===vf||g===op)throw new Error("setRTLTextPlugin cannot be called multiple times.");c=Ia.resolveURL(a),g=Ud,ac=o,_(),l||D()},p.smoothstep=oi,p.spec=_t,p.squaredLength=function(a){var o=a[0],l=a[1],d=a[2];return o*o+l*l+d*d},p.storeAuthState=function(a,o){o?gs.add(a):gs.delete(a)},p.sub=ja,p.subtract=Ef,p.symbolSize=ly,p.tileAABB=function(a,o,l,d,f,b,v,w,T){if("globe"===T.name)return function HI(a,o,l){const d=o/a.worldSize,f=a.globeMatrix;if(l.z<=1){const rt=Zc(l).getCorners();return bg(rt,f,d),Vs.fromPoints(rt)}const b=N_(l),v=Of(b);bg(v,f,d);const w=Number.MAX_VALUE,T=[-w,-w,-w],E=[w,w,w];if(b.contains(a.center)){for(const Ht of v)If(E,E,Ht),Mf(T,T,Ht);T[2]=0;const rt=a.point,yt=[rt.x*d,rt.y*d,0];return If(E,E,yt),Mf(T,T,yt),new Vs(E,T)}const k=[f[12]*d,f[13]*d,f[14]*d],P=b.getCenter(),L=Dt(a.center.lat,-Xo,Xo),N=Dt(P.lat,-Xo,Xo),z=hc(a.center.lng),G=Nl(L);let ee=z-hc(P.lng);const de=G-Nl(N);ee>.5?ee-=1:ee<-.5&&(ee+=1);let De=0;Math.abs(ee)>Math.abs(de)?De=ee>=0?1:3:(De=de>=0?0:2,lp(k,k,[f[4]*d,f[5]*d,f[6]*d],-Math.sin(se(de>=0?b.getSouth():b.getNorth()))*uc));const he=v[De],we=v[(De+1)%4],Re=new UI(he,we,k),Pe=[gg(Re,0)||he[0],gg(Re,1)||he[1],gg(Re,2)||he[2]],at=Zd(a.zoom);if(at>0){const rt=function({x:Ht,y:dt,z:Mt},Et,Ot,Wt,mt){const an=1/(1<<Mt);let gn=Ht*an,dn=gn+an,Zn=dt*an,Yt=Zn+an,Pn=0;const ei=(gn+dn)/2-Wt;return ei>.5?Pn=-1:ei<-.5&&(Pn=1),gn=((gn+Pn)*Et-(Wt*=Et))*Ot+Wt,dn=((dn+Pn)*Et-Wt)*Ot+Wt,Zn=(Zn*Et-(mt*=Et))*Ot+mt,Yt=(Yt*Et-mt)*Ot+mt,[[gn,Yt,0],[dn,Yt,0],[dn,Zn,0],[gn,Zn,0]]}(l,o,a._pixelsPerMercatorPixel,z,G);for(let Ht=0;Ht<v.length;Ht++)Xd(v[Ht],rt[Ht],at);const yt=za([],rt[De],rt[(De+1)%4]);Va(yt,yt,.5),Xd(Pe,yt,at)}for(const rt of v)If(E,E,rt),Mf(T,T,rt);return E[2]=Math.min(he[2],we[2]),If(E,E,Pe),Mf(T,T,Pe),new Vs(E,T)}(a,o,new Wf(l,d,f));const E=ih({z:l,x:d,y:f},T);return new Vs([(b+E.x/E.scale)*o,o*(E.y/E.scale),v],[(b+E.x2/E.scale)*o,o*(E.y2/E.scale),w])},p.tileCornersToBounds=N_,p.tileTransform=ih,p.transformMat3=function(a,o,l){var d=o[0],f=o[1],b=o[2];return a[0]=d*l[0]+f*l[3]+b*l[6],a[1]=d*l[1]+f*l[4]+b*l[7],a[2]=d*l[2]+f*l[5]+b*l[8],a},p.transformMat4=je,p.transformMat4$1=Xc,p.transformQuat=k_,p.transitionTileAABBinECEF=f0,p.translate=hg,p.transpose=function(a,o){if(a===o){var l=o[1],d=o[2],f=o[5];a[1]=o[3],a[2]=o[6],a[3]=l,a[5]=o[7],a[6]=d,a[7]=f}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},p.triggerPluginCompletionEvent=h,p.uniqueId=Kt,p.updateGlobeVertexNormal=function(a,o,l,d,f){const b=5*o+2;a.float32[b+0]=l,a.float32[b+1]=d,a.float32[b+2]=f},p.validateCustomStyleLayer=function(a){const o=[],l=a.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},p.validateFilter=a=>Zs(oc(a)),p.validateFog=a=>Zs(rg(a)),p.validateLayer=a=>Zs(pi(a)),p.validateLight=a=>Zs(ig(a)),p.validateSource=a=>Zs(ng(a)),p.validateStyle=si,p.validateTerrain=a=>Zs(tp(a)),p.values=qi,p.vectorTile=$a,p.version=Qe,p.warnOnce=Jn,p.window=ie,p.wrap=Lt}),ke(0,function(p){function ie(Ee){if("number"==typeof Ee||"boolean"==typeof Ee||"string"==typeof Ee||null==Ee)return JSON.stringify(Ee);if(Array.isArray(Ee)){let Q="[";for(const ve of Ee)Q+=`${ie(ve)},`;return`${Q}]`}let Z="{";for(const Q of Object.keys(Ee).sort())Z+=`${Q}:${ie(Ee[Q])},`;return`${Z}}`}function Qe(Ee){let Z="";for(const Q of p.refProperties)Z+=`/${ie(Ee[Q])}`;return Z}class re{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,Q){for(const Oe of Z)this._layerConfigs[Oe.id]=Oe,(this._layers[Oe.id]=p.createStyleLayer(Oe)).compileFilter(),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id];for(const Oe of Q)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};const ve=function(Oe,Ve){const tt={};for(let ze=0;ze<Oe.length;ze++){const ct=Ve&&Ve[Oe[ze].id]||Qe(Oe[ze]);Ve&&(Ve[Oe[ze].id]=ct);let Zt=tt[ct];Zt||(Zt=tt[ct]=[]),Zt.push(Oe[ze])}const et=[];for(const ze in tt)et.push(tt[ze]);return et}(p.values(this._layerConfigs),this.keyCache);for(const Oe of ve){const Ve=Oe.map(rn=>this._layers[rn.id]),tt=Ve[0];if("none"===tt.visibility)continue;const et=tt.source||"";let ze=this.familiesBySource[et];ze||(ze=this.familiesBySource[et]={});const ct=tt.sourceLayer||"_geojsonTileLayer";let Zt=ze[ct];Zt||(Zt=ze[ct]=[]),Zt.push(Ve)}}}class Ue{loadTile(Z,Q){const{uid:ve,encoding:Oe,rawImageData:Ve,padding:tt,buildQuadTree:et}=Z,ze=p.window.ImageBitmap&&Ve instanceof p.window.ImageBitmap?this.getImageData(Ve,tt):Ve;Q(null,new p.DEMData(ve,ze,Oe,tt<1,et))}getImageData(Z,Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const ve=this.offscreenCanvasContext.getImageData(-Q,-Q,Z.width+2*Q,Z.height+2*Q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ve}}function Ye(Ee,Z){if(0!==Ee.length){bt(Ee[0],Z);for(var Q=1;Q<Ee.length;Q++)bt(Ee[Q],!Z)}}function bt(Ee,Z){for(var Q=0,ve=0,Oe=0,Ve=Ee.length,tt=Ve-1;Oe<Ve;tt=Oe++){var et=(Ee[Oe][0]-Ee[tt][0])*(Ee[tt][1]+Ee[Oe][1]),ze=Q+et;ve+=Math.abs(Q)>=Math.abs(et)?Q-ze+et:et-ze+Q,Q=ze}Q+ve>=0!=!!Z&&Ee.reverse()}var Ct=p.getDefaultExportFromCjs(function Ee(Z,Q){var ve,Oe=Z&&Z.type;if("FeatureCollection"===Oe)for(ve=0;ve<Z.features.length;ve++)Ee(Z.features[ve],Q);else if("GeometryCollection"===Oe)for(ve=0;ve<Z.geometries.length;ve++)Ee(Z.geometries[ve],Q);else if("Feature"===Oe)Ee(Z.geometry,Q);else if("Polygon"===Oe)Ye(Z.coordinates,Q);else if("MultiPolygon"===Oe)for(ve=0;ve<Z.coordinates.length;ve++)Ye(Z.coordinates[ve],Q);return Z});const $e=p.VectorTileFeature.prototype.toGeoJSON;var Ge={exports:{}},wt=p.pointGeometry,Jt=p.vectorTile.VectorTileFeature,vn=Cn;function Cn(Ee,Z){this.options=Z||{},this.features=Ee,this.length=Ee.length}function st(Ee,Z){this.id="number"==typeof Ee.id?Ee.id:void 0,this.type=Ee.type,this.rawGeometry=1===Ee.type?[Ee.geometry]:Ee.geometry,this.properties=Ee.tags,this.extent=Z||4096}Cn.prototype.feature=function(Ee){return new st(this.features[Ee],this.options.extent)},st.prototype.loadGeometry=function(){var Ee=this.rawGeometry;this.geometry=[];for(var Z=0;Z<Ee.length;Z++){for(var Q=Ee[Z],ve=[],Oe=0;Oe<Q.length;Oe++)ve.push(new wt(Q[Oe][0],Q[Oe][1]));this.geometry.push(ve)}return this.geometry},st.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ee=this.geometry,Z=1/0,Q=-1/0,ve=1/0,Oe=-1/0,Ve=0;Ve<Ee.length;Ve++)for(var tt=Ee[Ve],et=0;et<tt.length;et++){var ze=tt[et];Z=Math.min(Z,ze.x),Q=Math.max(Q,ze.x),ve=Math.min(ve,ze.y),Oe=Math.max(Oe,ze.y)}return[Z,ve,Q,Oe]},st.prototype.toGeoJSON=Jt.prototype.toGeoJSON;var ln=p.pbf,Te=vn;function xe(Ee){var Z=new ln;return function(Q,ve){for(var Oe in Q.layers)ve.writeMessage(3,Ae,Q.layers[Oe])}(Ee,Z),Z.finish()}function Ae(Ee,Z){var Q;Z.writeVarintField(15,Ee.version||1),Z.writeStringField(1,Ee.name||""),Z.writeVarintField(5,Ee.extent||4096);var ve={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<Ee.length;Q++)ve.feature=Ee.feature(Q),Z.writeMessage(2,ce,ve);var Oe=ve.keys;for(Q=0;Q<Oe.length;Q++)Z.writeStringField(3,Oe[Q]);var Ve=ve.values;for(Q=0;Q<Ve.length;Q++)Z.writeMessage(4,gt,Ve[Q])}function ce(Ee,Z){var Q=Ee.feature;void 0!==Q.id&&Z.writeVarintField(1,Q.id),Z.writeMessage(2,ut,Ee),Z.writeVarintField(3,Q.type),Z.writeMessage(4,lt,Q)}function ut(Ee,Z){var Q=Ee.feature,ve=Ee.keys,Oe=Ee.values,Ve=Ee.keycache,tt=Ee.valuecache;for(var et in Q.properties){var ze=Q.properties[et],ct=Ve[et];if(null!==ze){void 0===ct&&(ve.push(et),Ve[et]=ct=ve.length-1),Z.writeVarint(ct);var Zt=typeof ze;"string"!==Zt&&"boolean"!==Zt&&"number"!==Zt&&(ze=JSON.stringify(ze));var rn=Zt+":"+ze,Gt=tt[rn];void 0===Gt&&(Oe.push(ze),tt[rn]=Gt=Oe.length-1),Z.writeVarint(Gt)}}}function se(Ee,Z){return(Z<<3)+(7&Ee)}function be(Ee){return Ee<<1^Ee>>31}function lt(Ee,Z){for(var Q=Ee.loadGeometry(),ve=Ee.type,Oe=0,Ve=0,tt=Q.length,et=0;et<tt;et++){var ze=Q[et],ct=1;1===ve&&(ct=ze.length),Z.writeVarint(se(1,ct));for(var Zt=3===ve?ze.length-1:ze.length,rn=0;rn<Zt;rn++){1===rn&&1!==ve&&Z.writeVarint(se(2,Zt-1));var Gt=ze[rn].x-Oe,ii=ze[rn].y-Ve;Z.writeVarint(be(Gt)),Z.writeVarint(be(ii)),Oe+=Gt,Ve+=ii}3===ve&&Z.writeVarint(se(7,1))}}function gt(Ee,Z){var Q=typeof Ee;"string"===Q?Z.writeStringField(1,Ee):"boolean"===Q?Z.writeBooleanField(7,Ee):"number"===Q&&(Ee%1!=0?Z.writeDoubleField(3,Ee):Ee<0?Z.writeSVarintField(6,Ee):Z.writeVarintField(5,Ee))}Ge.exports=xe,Ge.exports.fromVectorTileJs=xe,Ge.exports.fromGeojsonVt=function(Ee,Z){Z=Z||{};var Q={};for(var ve in Ee)Q[ve]=new Te(Ee[ve].features,Z),Q[ve].name=ve,Q[ve].version=Z.version,Q[ve].extent=Z.extent;return xe({layers:Q})},Ge.exports.GeoJSONWrapper=Te;var He=p.getDefaultExportFromCjs(Ge.exports);const vt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},Dt=Math.fround||(oi=new Float32Array(1),Ee=>(oi[0]=+Ee,oi[0]));var oi;class Fi{constructor(Z){this.options=Object.assign(Object.create(vt),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:Q,minZoom:ve,maxZoom:Oe}=this.options;Q&&console.time("total time");const Ve=`prepare ${Z.length} points`;Q&&console.time(Ve),this.points=Z;const tt=[];for(let ze=0;ze<Z.length;ze++){const ct=Z[ze];if(!ct.geometry)continue;const[Zt,rn]=ct.geometry.coordinates,Gt=Dt(To(Zt)),ii=Dt(vo(rn));tt.push(Gt,ii,1/0,ze,-1,1),this.options.reduce&&tt.push(0)}let et=this.trees[Oe+1]=this._createTree(tt);Q&&console.timeEnd(Ve);for(let ze=Oe;ze>=ve;ze--){const ct=+Date.now();et=this.trees[ze]=this._createTree(this._cluster(et,ze)),Q&&console.log("z%d: %d clusters in %dms",ze,et.numItems,+Date.now()-ct)}return Q&&console.timeEnd("total time"),this}getClusters(Z,Q){let ve=((Z[0]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,Z[1]));let Ve=180===Z[2]?180:((Z[2]+180)%360+360)%360-180;const tt=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ve=-180,Ve=180;else if(ve>Ve){const rn=this.getClusters([ve,Oe,180,tt],Q),Gt=this.getClusters([-180,Oe,Ve,tt],Q);return rn.concat(Gt)}const et=this.trees[this._limitZoom(Q)],ze=et.range(To(ve),vo(tt),To(Ve),vo(Oe)),ct=et.data,Zt=[];for(const rn of ze){const Gt=this.stride*rn;Zt.push(ct[Gt+5]>1?xi(ct,Gt,this.clusterProps):this.points[ct[Gt+3]])}return Zt}getChildren(Z){const Q=this._getOriginId(Z),ve=this._getOriginZoom(Z),Oe="No cluster with the specified id.",Ve=this.trees[ve];if(!Ve)throw new Error(Oe);const tt=Ve.data;if(Q*this.stride>=tt.length)throw new Error(Oe);const et=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),ze=Ve.within(tt[Q*this.stride],tt[Q*this.stride+1],et),ct=[];for(const Zt of ze){const rn=Zt*this.stride;tt[rn+4]===Z&&ct.push(tt[rn+5]>1?xi(tt,rn,this.clusterProps):this.points[tt[rn+3]])}if(0===ct.length)throw new Error(Oe);return ct}getLeaves(Z,Q,ve){const Oe=[];return this._appendLeaves(Oe,Z,Q=Q||10,ve=ve||0,0),Oe}getTile(Z,Q,ve){const Oe=this.trees[this._limitZoom(Z)],Ve=Math.pow(2,Z),{extent:tt,radius:et}=this.options,ze=et/tt,ct=(ve-ze)/Ve,Zt=(ve+1+ze)/Ve,rn={features:[]};return this._addTileFeatures(Oe.range((Q-ze)/Ve,ct,(Q+1+ze)/Ve,Zt),Oe.data,Q,ve,Ve,rn),0===Q&&this._addTileFeatures(Oe.range(1-ze/Ve,ct,1,Zt),Oe.data,Ve,ve,Ve,rn),Q===Ve-1&&this._addTileFeatures(Oe.range(0,ct,ze/Ve,Zt),Oe.data,-1,ve,Ve,rn),rn.features.length?rn:null}getClusterExpansionZoom(Z){let Q=this._getOriginZoom(Z)-1;for(;Q<=this.options.maxZoom;){const ve=this.getChildren(Z);if(Q++,1!==ve.length)break;Z=ve[0].properties.cluster_id}return Q}_appendLeaves(Z,Q,ve,Oe,Ve){const tt=this.getChildren(Q);for(const et of tt){const ze=et.properties;if(ze&&ze.cluster?Ve+ze.point_count<=Oe?Ve+=ze.point_count:Ve=this._appendLeaves(Z,ze.cluster_id,ve,Oe,Ve):Ve<Oe?Ve++:Z.push(et),Z.length===ve)break}return Ve}_createTree(Z){const Q=new p.KDBush(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ve=0;ve<Z.length;ve+=this.stride)Q.add(Z[ve],Z[ve+1]);return Q.finish(),Q.data=Z,Q}_addTileFeatures(Z,Q,ve,Oe,Ve,tt){for(const et of Z){const ze=et*this.stride,ct=Q[ze+5]>1;let Zt,rn,Gt;if(ct)Zt=Kt(Q,ze,this.clusterProps),rn=Q[ze],Gt=Q[ze+1];else{const ni=this.points[Q[ze+3]];Zt=ni.properties;const[gi,Mi]=ni.geometry.coordinates;rn=To(gi),Gt=vo(Mi)}const ii={type:1,geometry:[[Math.round(this.options.extent*(rn*Ve-ve)),Math.round(this.options.extent*(Gt*Ve-Oe))]],tags:Zt};let mi;mi=ct||this.options.generateId?Q[ze+3]:this.points[Q[ze+3]].id,void 0!==mi&&(ii.id=mi),tt.features.push(ii)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,Q){const{radius:ve,extent:Oe,reduce:Ve,minPoints:tt}=this.options,et=ve/(Oe*Math.pow(2,Q)),ze=Z.data,ct=[],Zt=this.stride;for(let rn=0;rn<ze.length;rn+=Zt){if(ze[rn+2]<=Q)continue;ze[rn+2]=Q;const Gt=ze[rn],ii=ze[rn+1],mi=Z.within(ze[rn],ze[rn+1],et),ni=ze[rn+5];let gi=ni;for(const Mi of mi){const Bi=Mi*Zt;ze[Bi+2]>Q&&(gi+=ze[Bi+5])}if(gi>ni&&gi>=tt){let Mi,Bi=Gt*ni,po=ii*ni,ns=-1;const xo=((rn/Zt|0)<<5)+(Q+1)+this.points.length;for(const nl of mi){const Eo=nl*Zt;if(ze[Eo+2]<=Q)continue;ze[Eo+2]=Q;const gs=ze[Eo+5];Bi+=ze[Eo]*gs,po+=ze[Eo+1]*gs,ze[Eo+4]=xo,Ve&&(Mi||(Mi=this._map(ze,rn,!0),ns=this.clusterProps.length,this.clusterProps.push(Mi)),Ve(Mi,this._map(ze,Eo)))}ze[rn+4]=xo,ct.push(Bi/gi,po/gi,1/0,xo,-1,gi),Ve&&ct.push(ns)}else{for(let Mi=0;Mi<Zt;Mi++)ct.push(ze[rn+Mi]);if(gi>1)for(const Mi of mi){const Bi=Mi*Zt;if(!(ze[Bi+2]<=Q)){ze[Bi+2]=Q;for(let po=0;po<Zt;po++)ct.push(ze[Bi+po])}}}}return ct}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,Q,ve){if(Z[Q+5]>1){const tt=this.clusterProps[Z[Q+6]];return ve?Object.assign({},tt):tt}const Oe=this.points[Z[Q+3]].properties,Ve=this.options.map(Oe);return ve&&Ve===Oe?Object.assign({},Ve):Ve}}function xi(Ee,Z,Q){return{type:"Feature",id:Ee[Z+3],properties:Kt(Ee,Z,Q),geometry:{type:"Point",coordinates:[(ve=Ee[Z],360*(ve-.5)),ki(Ee[Z+1])]}};var ve}function Kt(Ee,Z,Q){const ve=Ee[Z+5],Oe=ve>=1e4?`${Math.round(ve/1e3)}k`:ve>=1e3?Math.round(ve/100)/10+"k":ve,Ve=Ee[Z+6],tt=-1===Ve?{}:Object.assign({},Q[Ve]);return Object.assign(tt,{cluster:!0,cluster_id:Ee[Z+3],point_count:ve,point_count_abbreviated:Oe})}function To(Ee){return Ee/360+.5}function vo(Ee){const Z=Math.sin(Ee*Math.PI/180),Q=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Q<0?0:Q>1?1:Q}function ki(Ee){const Z=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function Ii(Ee,Z,Q,ve){for(var Oe,Ve=ve,tt=Q-Z>>1,et=Q-Z,ze=Ee[Z],ct=Ee[Z+1],Zt=Ee[Q],rn=Ee[Q+1],Gt=Z+3;Gt<Q;Gt+=3){var ii=ge(Ee[Gt],Ee[Gt+1],ze,ct,Zt,rn);if(ii>Ve)Oe=Gt,Ve=ii;else if(ii===Ve){var mi=Math.abs(Gt-tt);mi<et&&(Oe=Gt,et=mi)}}Ve>ve&&(Oe-Z>3&&Ii(Ee,Z,Oe,ve),Ee[Oe+2]=Ve,Q-Oe>3&&Ii(Ee,Oe,Q,ve))}function ge(Ee,Z,Q,ve,Oe,Ve){var tt=Oe-Q,et=Ve-ve;if(0!==tt||0!==et){var ze=((Ee-Q)*tt+(Z-ve)*et)/(tt*tt+et*et);ze>1?(Q=Oe,ve=Ve):ze>0&&(Q+=tt*ze,ve+=et*ze)}return(tt=Ee-Q)*tt+(et=Z-ve)*et}function W(Ee,Z,Q,ve){var Oe={id:void 0===Ee?null:Ee,type:Z,geometry:Q,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ve){var tt=Ve.geometry,et=Ve.type;if("Point"===et||"MultiPoint"===et||"LineString"===et)Nt(Ve,tt);else if("Polygon"===et||"MultiLineString"===et)for(var ze=0;ze<tt.length;ze++)Nt(Ve,tt[ze]);else if("MultiPolygon"===et)for(ze=0;ze<tt.length;ze++)for(var ct=0;ct<tt[ze].length;ct++)Nt(Ve,tt[ze][ct])}(Oe),Oe}function Nt(Ee,Z){for(var Q=0;Q<Z.length;Q+=3)Ee.minX=Math.min(Ee.minX,Z[Q]),Ee.minY=Math.min(Ee.minY,Z[Q+1]),Ee.maxX=Math.max(Ee.maxX,Z[Q]),Ee.maxY=Math.max(Ee.maxY,Z[Q+1])}function Je(Ee,Z,Q,ve){if(Z.geometry){var Oe=Z.geometry.coordinates,Ve=Z.geometry.type,tt=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),et=[],ze=Z.id;if(Q.promoteId?ze=Z.properties[Q.promoteId]:Q.generateId&&(ze=ve||0),"Point"===Ve)Ri(Oe,et);else if("MultiPoint"===Ve)for(var ct=0;ct<Oe.length;ct++)Ri(Oe[ct],et);else if("LineString"===Ve)Jn(Oe,et,tt,!1);else if("MultiLineString"===Ve){if(Q.lineMetrics){for(ct=0;ct<Oe.length;ct++)Jn(Oe[ct],et=[],tt,!1),Ee.push(W(ze,"LineString",et,Z.properties));return}Ci(Oe,et,tt,!1)}else if("Polygon"===Ve)Ci(Oe,et,tt,!0);else{if("MultiPolygon"!==Ve){if("GeometryCollection"===Ve){for(ct=0;ct<Z.geometry.geometries.length;ct++)Je(Ee,{id:ze,geometry:Z.geometry.geometries[ct],properties:Z.properties},Q,ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ct=0;ct<Oe.length;ct++){var Zt=[];Ci(Oe[ct],Zt,tt,!0),et.push(Zt)}}Ee.push(W(ze,Ve,et,Z.properties))}}function Ri(Ee,Z){Z.push(Xr(Ee[0])),Z.push(Zr(Ee[1])),Z.push(0)}function Jn(Ee,Z,Q,ve){for(var Oe,Ve,tt=0,et=0;et<Ee.length;et++){var ze=Xr(Ee[et][0]),ct=Zr(Ee[et][1]);Z.push(ze),Z.push(ct),Z.push(0),et>0&&(tt+=ve?(Oe*ct-ze*Ve)/2:Math.sqrt(Math.pow(ze-Oe,2)+Math.pow(ct-Ve,2))),Oe=ze,Ve=ct}var Zt=Z.length-3;Z[2]=1,Ii(Z,0,Zt,Q),Z[Zt+2]=1,Z.size=Math.abs(tt),Z.start=0,Z.end=Z.size}function Ci(Ee,Z,Q,ve){for(var Oe=0;Oe<Ee.length;Oe++){var Ve=[];Jn(Ee[Oe],Ve,Q,ve),Z.push(Ve)}}function Xr(Ee){return Ee/360+.5}function Zr(Ee){var Z=Math.sin(Ee*Math.PI/180),Q=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return Q<0?0:Q>1?1:Q}function fe(Ee,Z,Q,ve,Oe,Ve,tt,et){if(ve/=Z,Ve>=(Q/=Z)&&tt<ve)return Ee;if(tt<Q||Ve>=ve)return null;for(var ze=[],ct=0;ct<Ee.length;ct++){var Zt=Ee[ct],rn=Zt.geometry,Gt=Zt.type,ii=0===Oe?Zt.minX:Zt.minY,mi=0===Oe?Zt.maxX:Zt.maxY;if(ii>=Q&&mi<ve)ze.push(Zt);else if(!(mi<Q||ii>=ve)){var ni=[];if("Point"===Gt||"MultiPoint"===Gt)V(rn,ni,Q,ve,Oe);else if("LineString"===Gt)q(rn,ni,Q,ve,Oe,!1,et.lineMetrics);else if("MultiLineString"===Gt)Ke(rn,ni,Q,ve,Oe,!1);else if("Polygon"===Gt)Ke(rn,ni,Q,ve,Oe,!0);else if("MultiPolygon"===Gt)for(var gi=0;gi<rn.length;gi++){var Mi=[];Ke(rn[gi],Mi,Q,ve,Oe,!0),Mi.length&&ni.push(Mi)}if(ni.length){if(et.lineMetrics&&"LineString"===Gt){for(gi=0;gi<ni.length;gi++)ze.push(W(Zt.id,Gt,ni[gi],Zt.tags));continue}"LineString"!==Gt&&"MultiLineString"!==Gt||(1===ni.length?(Gt="LineString",ni=ni[0]):Gt="MultiLineString"),"Point"!==Gt&&"MultiPoint"!==Gt||(Gt=3===ni.length?"Point":"MultiPoint"),ze.push(W(Zt.id,Gt,ni,Zt.tags))}}}return ze.length?ze:null}function V(Ee,Z,Q,ve,Oe){for(var Ve=0;Ve<Ee.length;Ve+=3){var tt=Ee[Ve+Oe];tt>=Q&&tt<=ve&&(Z.push(Ee[Ve]),Z.push(Ee[Ve+1]),Z.push(Ee[Ve+2]))}}function q(Ee,Z,Q,ve,Oe,Ve,tt){for(var et,ze,ct=Me(Ee),Zt=0===Oe?nn:Ni,rn=Ee.start,Gt=0;Gt<Ee.length-3;Gt+=3){var ii=Ee[Gt],mi=Ee[Gt+1],ni=Ee[Gt+2],gi=Ee[Gt+3],Mi=Ee[Gt+4],Bi=0===Oe?ii:mi,po=0===Oe?gi:Mi,ns=!1;tt&&(et=Math.sqrt(Math.pow(ii-gi,2)+Math.pow(mi-Mi,2))),Bi<Q?po>Q&&(ze=Zt(ct,ii,mi,gi,Mi,Q),tt&&(ct.start=rn+et*ze)):Bi>ve?po<ve&&(ze=Zt(ct,ii,mi,gi,Mi,ve),tt&&(ct.start=rn+et*ze)):qt(ct,ii,mi,ni),po<Q&&Bi>=Q&&(ze=Zt(ct,ii,mi,gi,Mi,Q),ns=!0),po>ve&&Bi<=ve&&(ze=Zt(ct,ii,mi,gi,Mi,ve),ns=!0),!Ve&&ns&&(tt&&(ct.end=rn+et*ze),Z.push(ct),ct=Me(Ee)),tt&&(rn+=et)}var xo=Ee.length-3;ii=Ee[xo],mi=Ee[xo+1],ni=Ee[xo+2],(Bi=0===Oe?ii:mi)>=Q&&Bi<=ve&&qt(ct,ii,mi,ni),xo=ct.length-3,Ve&&xo>=3&&(ct[xo]!==ct[0]||ct[xo+1]!==ct[1])&&qt(ct,ct[0],ct[1],ct[2]),ct.length&&Z.push(ct)}function Me(Ee){var Z=[];return Z.size=Ee.size,Z.start=Ee.start,Z.end=Ee.end,Z}function Ke(Ee,Z,Q,ve,Oe,Ve){for(var tt=0;tt<Ee.length;tt++)q(Ee[tt],Z,Q,ve,Oe,Ve,!1)}function qt(Ee,Z,Q,ve){Ee.push(Z),Ee.push(Q),Ee.push(ve)}function nn(Ee,Z,Q,ve,Oe,Ve){var tt=(Ve-Z)/(ve-Z);return Ee.push(Ve),Ee.push(Q+(Oe-Q)*tt),Ee.push(1),tt}function Ni(Ee,Z,Q,ve,Oe,Ve){var tt=(Ve-Q)/(Oe-Q);return Ee.push(Z+(ve-Z)*tt),Ee.push(Ve),Ee.push(1),tt}function Di(Ee,Z){for(var Q=[],ve=0;ve<Ee.length;ve++){var Oe,Ve=Ee[ve],tt=Ve.type;if("Point"===tt||"MultiPoint"===tt||"LineString"===tt)Oe=nr(Ve.geometry,Z);else if("MultiLineString"===tt||"Polygon"===tt){Oe=[];for(var et=0;et<Ve.geometry.length;et++)Oe.push(nr(Ve.geometry[et],Z))}else if("MultiPolygon"===tt)for(Oe=[],et=0;et<Ve.geometry.length;et++){for(var ze=[],ct=0;ct<Ve.geometry[et].length;ct++)ze.push(nr(Ve.geometry[et][ct],Z));Oe.push(ze)}Q.push(W(Ve.id,tt,Oe,Ve.tags))}return Q}function nr(Ee,Z){var Q=[];Q.size=Ee.size,void 0!==Ee.start&&(Q.start=Ee.start,Q.end=Ee.end);for(var ve=0;ve<Ee.length;ve+=3)Q.push(Ee[ve]+Z,Ee[ve+1],Ee[ve+2]);return Q}function io(Ee,Z){if(Ee.transformed)return Ee;var Q,ve,Oe,Ve=1<<Ee.z,tt=Ee.x,et=Ee.y;for(Q=0;Q<Ee.features.length;Q++){var ze=Ee.features[Q],ct=ze.geometry,Zt=ze.type;if(ze.geometry=[],1===Zt)for(ve=0;ve<ct.length;ve+=2)ze.geometry.push(yr(ct[ve],ct[ve+1],Z,Ve,tt,et));else for(ve=0;ve<ct.length;ve++){var rn=[];for(Oe=0;Oe<ct[ve].length;Oe+=2)rn.push(yr(ct[ve][Oe],ct[ve][Oe+1],Z,Ve,tt,et));ze.geometry.push(rn)}}return Ee.transformed=!0,Ee}function yr(Ee,Z,Q,ve,Oe,Ve){return[Math.round(Q*(Ee*ve-Oe)),Math.round(Q*(Z*ve-Ve))]}function Ta(Ee,Z,Q,ve,Oe){for(var Ve=Z===Oe.maxZoom?0:Oe.tolerance/((1<<Z)*Oe.extent),tt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Q,y:ve,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},et=0;et<Ee.length;et++){tt.numFeatures++,ms(tt,Ee[et],Ve,Oe);var ze=Ee[et].minX,ct=Ee[et].minY,Zt=Ee[et].maxX,rn=Ee[et].maxY;ze<tt.minX&&(tt.minX=ze),ct<tt.minY&&(tt.minY=ct),Zt>tt.maxX&&(tt.maxX=Zt),rn>tt.maxY&&(tt.maxY=rn)}return tt}function ms(Ee,Z,Q,ve){var Oe=Z.geometry,Ve=Z.type,tt=[];if("Point"===Ve||"MultiPoint"===Ve)for(var et=0;et<Oe.length;et+=3)tt.push(Oe[et]),tt.push(Oe[et+1]),Ee.numPoints++,Ee.numSimplified++;else if("LineString"===Ve)Ea(tt,Oe,Ee,Q,!1,!1);else if("MultiLineString"===Ve||"Polygon"===Ve)for(et=0;et<Oe.length;et++)Ea(tt,Oe[et],Ee,Q,"Polygon"===Ve,0===et);else if("MultiPolygon"===Ve)for(var ze=0;ze<Oe.length;ze++){var ct=Oe[ze];for(et=0;et<ct.length;et++)Ea(tt,ct[et],Ee,Q,!0,0===et)}if(tt.length){var Zt=Z.tags||null;if("LineString"===Ve&&ve.lineMetrics){for(var rn in Zt={},Z.tags)Zt[rn]=Z.tags[rn];Zt.mapbox_clip_start=Oe.start/Oe.size,Zt.mapbox_clip_end=Oe.end/Oe.size}var Gt={geometry:tt,type:"Polygon"===Ve||"MultiPolygon"===Ve?3:"LineString"===Ve||"MultiLineString"===Ve?2:1,tags:Zt};null!==Z.id&&(Gt.id=Z.id),Ee.features.push(Gt)}}function Ea(Ee,Z,Q,ve,Oe,Ve){var tt=ve*ve;if(ve>0&&Z.size<(Oe?tt:ve))Q.numPoints+=Z.length/3;else{for(var et=[],ze=0;ze<Z.length;ze+=3)(0===ve||Z[ze+2]>tt)&&(Q.numSimplified++,et.push(Z[ze]),et.push(Z[ze+1])),Q.numPoints++;Oe&&function(ct,Zt){for(var rn=0,Gt=0,ii=ct.length,mi=ii-2;Gt<ii;mi=Gt,Gt+=2)rn+=(ct[Gt]-ct[mi])*(ct[Gt+1]+ct[mi+1]);if(rn>0===Zt)for(Gt=0,ii=ct.length;Gt<ii/2;Gt+=2){var ni=ct[Gt],gi=ct[Gt+1];ct[Gt]=ct[ii-2-Gt],ct[Gt+1]=ct[ii-1-Gt],ct[ii-2-Gt]=ni,ct[ii-1-Gt]=gi}}(et,Ve),Ee.push(et)}}function Yl(Ee,Z){var Q=(Z=this.options=function(Oe,Ve){for(var tt in Ve)Oe[tt]=Ve[tt];return Oe}(Object.create(this.options),Z)).debug;if(Q&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var Oe,Ve,tt,et,ze,ct,ve=function(Oe,Ve){var tt=[];if("FeatureCollection"===Oe.type)for(var et=0;et<Oe.features.length;et++)Je(tt,Oe.features[et],Ve,et);else Je(tt,"Feature"===Oe.type?Oe:{geometry:Oe},Ve);return tt}(Ee,Z);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),et=Oe=ve,ze=fe(Oe,1,-1-(tt=(Ve=Z).buffer/Ve.extent),tt,0,-1,2,Ve),ct=fe(Oe,1,1-tt,2+tt,0,-1,2,Ve),(ze||ct)&&(et=fe(Oe,1,-tt,1+tt,0,-1,2,Ve)||[],ze&&(et=Di(ze,1).concat(et)),ct&&(et=et.concat(Di(ct,-1)))),(ve=et).length&&this.splitTile(ve,0,0,0),Q&&(ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Kl(Ee,Z,Q){return 32*((1<<Ee)*Q+Z)+Ee}function Lc(Ee,Z){const Q=Ee.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const ve=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!ve)return Z(null,null);const Oe=new class{constructor(tt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=tt.length,this._features=tt}feature(tt){return new class{constructor(et){this._feature=et,this.extent=p.EXTENT,this.type=et.type,this.properties=et.tags,"id"in et&&!isNaN(et.id)&&(this.id=parseInt(et.id,10))}loadGeometry(){if(1===this._feature.type){const et=[];for(const ze of this._feature.geometry)et.push([new p.Point(ze[0],ze[1])]);return et}{const et=[];for(const ze of this._feature.geometry){const ct=[];for(const Zt of ze)ct.push(new p.Point(Zt[0],Zt[1]));et.push(ct)}return et}}toGeoJSON(et,ze,ct){return $e.call(this,et,ze,ct)}}(this._features[tt])}}(ve.features);let Ve=He(Oe);0===Ve.byteOffset&&Ve.byteLength===Ve.buffer.byteLength||(Ve=new Uint8Array(Ve)),Z(null,{vectorTile:Oe,rawData:Ve.buffer})}Yl.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Yl.prototype.splitTile=function(Ee,Z,Q,ve,Oe,Ve,tt){for(var et=[Ee,Z,Q,ve],ze=this.options,ct=ze.debug;et.length;){ve=et.pop(),Q=et.pop(),Z=et.pop(),Ee=et.pop();var Zt=1<<Z,rn=Kl(Z,Q,ve),Gt=this.tiles[rn];if(!Gt&&(ct>1&&console.time("creation"),Gt=this.tiles[rn]=Ta(Ee,Z,Q,ve,ze),this.tileCoords.push({z:Z,x:Q,y:ve}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,Q,ve,Gt.numFeatures,Gt.numPoints,Gt.numSimplified),console.timeEnd("creation"));var ii="z"+Z;this.stats[ii]=(this.stats[ii]||0)+1,this.total++}if(Gt.source=Ee,Oe){if(Z===ze.maxZoom||Z===Oe)continue;var mi=1<<Oe-Z;if(Q!==Math.floor(Ve/mi)||ve!==Math.floor(tt/mi))continue}else if(Z===ze.indexMaxZoom||Gt.numPoints<=ze.indexMaxPoints)continue;if(Gt.source=null,0!==Ee.length){ct>1&&console.time("clipping");var ni,gi,Mi,Bi,po,ns,xo=.5*ze.buffer/ze.extent,nl=.5-xo,Eo=.5+xo,gs=1+xo;ni=gi=Mi=Bi=null,po=fe(Ee,Zt,Q-xo,Q+Eo,0,Gt.minX,Gt.maxX,ze),ns=fe(Ee,Zt,Q+nl,Q+gs,0,Gt.minX,Gt.maxX,ze),Ee=null,po&&(ni=fe(po,Zt,ve-xo,ve+Eo,1,Gt.minY,Gt.maxY,ze),gi=fe(po,Zt,ve+nl,ve+gs,1,Gt.minY,Gt.maxY,ze),po=null),ns&&(Mi=fe(ns,Zt,ve-xo,ve+Eo,1,Gt.minY,Gt.maxY,ze),Bi=fe(ns,Zt,ve+nl,ve+gs,1,Gt.minY,Gt.maxY,ze),ns=null),ct>1&&console.timeEnd("clipping"),et.push(ni||[],Z+1,2*Q,2*ve),et.push(gi||[],Z+1,2*Q,2*ve+1),et.push(Mi||[],Z+1,2*Q+1,2*ve),et.push(Bi||[],Z+1,2*Q+1,2*ve+1)}}},Yl.prototype.getTile=function(Ee,Z,Q){var ve=this.options,Oe=ve.extent,Ve=ve.debug;if(Ee<0||Ee>24)return null;var tt=1<<Ee,et=Kl(Ee,Z=(Z%tt+tt)%tt,Q);if(this.tiles[et])return io(this.tiles[et],Oe);Ve>1&&console.log("drilling down to z%d-%d-%d",Ee,Z,Q);for(var ze,ct=Ee,Zt=Z,rn=Q;!ze&&ct>0;)ct--,Zt=Math.floor(Zt/2),rn=Math.floor(rn/2),ze=this.tiles[Kl(ct,Zt,rn)];return ze&&ze.source?(Ve>1&&console.log("found parent tile z%d-%d-%d",ct,Zt,rn),Ve>1&&console.time("drilling down"),this.splitTile(ze.source,ct,Zt,rn,Ee,Z,Q),Ve>1&&console.timeEnd("drilling down"),this.tiles[et]?io(this.tiles[et],Oe):null):null};class bu extends p.VectorTileWorkerSource{constructor(Z,Q,ve,Oe,Ve){super(Z,Q,ve,Oe,Lc),Ve&&(this.loadGeoJSON=Ve)}loadData(Z,Q){const ve=Z&&Z.request,Oe=ve&&ve.collectResourceTiming;this.loadGeoJSON(Z,(Ve,tt)=>{if(Ve||!tt)return Q(Ve);if("object"!=typeof tt)return Q(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{Ct(tt,!0);try{if(Z.filter){const ze=p.createExpression(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ze.result)throw new Error(ze.value.map(Zt=>`${Zt.key}: ${Zt.message}`).join(", "));const ct=tt.features.filter(Zt=>ze.value.evaluate({zoom:0},Zt));tt={type:"FeatureCollection",features:ct}}this._geoJSONIndex=Z.cluster?new Fi(function({superclusterOptions:ze,clusterProperties:ct}){if(!ct||!ze)return ze;const Zt={},rn={},Gt={accumulated:null,zoom:0},ii={properties:null},mi=Object.keys(ct);for(const ni of mi){const[gi,Mi]=ct[ni],Bi=p.createExpression(Mi),po=p.createExpression("string"==typeof gi?[gi,["accumulated"],["get",ni]]:gi);Zt[ni]=Bi.value,rn[ni]=po.value}return ze.map=ni=>{ii.properties=ni;const gi={};for(const Mi of mi)gi[Mi]=Zt[Mi].evaluate(Gt,ii);return gi},ze.reduce=(ni,gi)=>{ii.properties=gi;for(const Mi of mi)Gt.accumulated=ni[Mi],ni[Mi]=rn[Mi].evaluate(Gt,ii)},ze}(Z)).load(tt.features):new Yl(ze=tt,Z.geojsonVtOptions)}catch(ze){return Q(ze)}this.loaded={};const et={};if(Oe){const ze=p.getPerformanceMeasurement(ve);ze&&(et.resourceTiming={},et.resourceTiming[Z.source]=JSON.parse(JSON.stringify(ze)))}Q(null,et)}var ze})}reloadTile(Z,Q){const ve=this.loaded;return ve&&ve[Z.uid]?super.reloadTile(Z,Q):this.loadTile(Z,Q)}loadGeoJSON(Z,Q){if(Z.request)p.getJSON(Z.request,Q);else{if("string"!=typeof Z.data)return Q(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return Q(null,JSON.parse(Z.data))}catch(ve){return Q(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,Q){try{Q(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(ve){Q(ve)}}getClusterChildren(Z,Q){try{Q(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(ve){Q(ve)}}getClusterLeaves(Z,Q){try{Q(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(ve){Q(ve)}}}class Fh{constructor(Z){this.self=Z,this.actor=new p.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:bu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Q,ve)=>{if(this.workerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.workerSourceTypes[Q]=ve},this.self.registerRTLTextPlugin=Q=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=Q.applyArabicShaping,p.plugin.processBidirectionalText=Q.processBidirectionalText,p.plugin.processStyledBidirectionalText=Q.processStyledBidirectionalText}}clearCaches(Z,Q,ve){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],ve()}checkIfReady(Z,Q,ve){ve()}setReferrer(Z,Q){this.referrer=Q}spriteLoaded(Z,Q){this.isSpriteLoaded[Z]=Q;for(const ve in this.workerSources[Z]){const Oe=this.workerSources[Z][ve];for(const Ve in Oe)Oe[Ve]instanceof p.VectorTileWorkerSource&&(Oe[Ve].isSpriteLoaded=Q,Oe[Ve].fire(new p.Event("isSpriteLoaded")))}}setImages(Z,Q,ve){this.availableImages[Z]=Q;for(const Oe in this.workerSources[Z]){const Ve=this.workerSources[Z][Oe];for(const tt in Ve)Ve[tt].availableImages=Q}ve()}enableTerrain(Z,Q,ve){this.terrain=Q,ve()}setProjection(Z,Q){this.projections[Z]=p.getProjection(Q)}setLayers(Z,Q,ve){this.getLayerIndex(Z).replace(Q),ve()}updateLayers(Z,Q,ve){this.getLayerIndex(Z).update(Q.layers,Q.removedIds),ve()}loadTile(Z,Q,ve){const Oe=this.enableTerrain?p.extend({enableTerrain:this.terrain},Q):Q;Oe.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Q.type,Q.source).loadTile(Oe,ve)}loadDEMTile(Z,Q,ve){const Oe=this.enableTerrain?p.extend({buildQuadTree:this.terrain},Q):Q;this.getDEMWorkerSource(Z,Q.source).loadTile(Oe,ve)}reloadTile(Z,Q,ve){const Oe=this.enableTerrain?p.extend({enableTerrain:this.terrain},Q):Q;Oe.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,Q.type,Q.source).reloadTile(Oe,ve)}abortTile(Z,Q,ve){this.getWorkerSource(Z,Q.type,Q.source).abortTile(Q,ve)}removeTile(Z,Q,ve){this.getWorkerSource(Z,Q.type,Q.source).removeTile(Q,ve)}removeSource(Z,Q,ve){if(!this.workerSources[Z]||!this.workerSources[Z][Q.type]||!this.workerSources[Z][Q.type][Q.source])return;const Oe=this.workerSources[Z][Q.type][Q.source];delete this.workerSources[Z][Q.type][Q.source],void 0!==Oe.removeSource?Oe.removeSource(Q,ve):ve()}loadWorkerSource(Z,Q,ve){try{this.self.importScripts(Q.url),ve()}catch(Oe){ve(Oe.toString())}}syncRTLPluginState(Z,Q,ve){try{p.plugin.setState(Q);const Oe=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=Oe){this.self.importScripts(Oe);const Ve=p.plugin.isParsed();ve(Ve?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Oe}`),Ve)}}catch(Oe){ve(Oe.toString())}}getAvailableImages(Z){let Q=this.availableImages[Z];return Q||(Q=[]),Q}getLayerIndex(Z){let Q=this.layerIndexes[Z];return Q||(Q=this.layerIndexes[Z]=new re),Q}getWorkerSource(Z,Q,ve){return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][Q]||(this.workerSources[Z][Q]={}),this.workerSources[Z][Q][ve]||(this.workerSources[Z][Q][ve]=new this.workerSourceTypes[Q]({send:(Ve,tt,et,ze,ct,Zt)=>{this.actor.send(Ve,tt,et,Z,ct,Zt)},scheduler:this.actor.scheduler},this.getLayerIndex(Z),this.getAvailableImages(Z),this.isSpriteLoaded[Z])),this.workerSources[Z][Q][ve]}getDEMWorkerSource(Z,Q){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][Q]||(this.demWorkerSources[Z][Q]=new Ue),this.demWorkerSources[Z][Q]}enforceCacheSizeLimit(Z,Q){p.enforceCacheSizeLimit(Q)}getWorkerPerformanceMetrics(Z,Q,ve){ve(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Fh(self)),Fh}),ke(0,function(p){function ie(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let h=0;h<g.length;h++)if(!ie(g[h],c[h]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==c){if("object"!=typeof c||Object.keys(g).length!==Object.keys(c).length)return!1;for(const h in g)if(!ie(g[h],c[h]))return!1;return!0}return g===c}var Qe=re;function re(g){return c=g,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,S=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(S);try{x=new Worker(D),_=!0}catch(M){_=!1}return x&&x.terminate(),URL.revokeObjectURL(D),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var S=x.getImageData(0,0,1,1);return S&&S.width===_.width}()||(void 0===Ue[h=c&&c.failIfMajorPerformanceCaveat]&&(Ue[h]=function(_){var x,D,M,R,S=(D=_,M=document.createElement("canvas"),(R=Object.create(re.webGLContextAttributes)).failIfMajorPerformanceCaveat=D,M.getContext("webgl",R)||M.getContext("experimental-webgl",R));if(!S)return!1;try{x=S.createShader(S.VERTEX_SHADER)}catch(D){return!1}return!(!x||S.isContextLost())&&(S.shaderSource(x,"void main() {}"),S.compileShader(x),!0===S.getShaderParameter(x,S.COMPILE_STATUS))}(h)),!Ue[h]||document.documentMode));var c,h}var Ue={};function Ye(g,c,h){const _=p.window.document.createElement(g);return void 0!==c&&(_.className=c),h&&h.appendChild(_),_}function bt(g,c,h){const _=p.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const x of Object.keys(c))_.setAttributeNS(null,x,c[x]);return h&&h.appendChild(_),_}re.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ct=p.window.document&&p.window.document.documentElement.style,$e=Ct&&void 0!==Ct.userSelect?"userSelect":"WebkitUserSelect";let Ge;function wt(){Ct&&$e&&(Ge=Ct[$e],Ct[$e]="none")}function Jt(){Ct&&$e&&(Ct[$e]=Ge)}function vn(g){g.preventDefault(),g.stopPropagation(),p.window.removeEventListener("click",vn,!0)}function Cn(){p.window.addEventListener("click",vn,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",vn,!0)},0)}function st(g,c){const h=g.getBoundingClientRect();return xe(g,h,c)}function ln(g,c){const h=g.getBoundingClientRect(),_=[];for(let x=0;x<c.length;x++)_.push(xe(g,h,c[x]));return _}function Te(g){return void 0!==p.window.InstallTrigger&&2===g.button&&g.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function xe(g,c,h){const _=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new p.Point((h.clientX-c.left)*_,(h.clientY-c.top)*_)}function Ae(g,c){var h=c[0],_=c[1],x=c[2],S=c[3],D=h*S-x*_;return D?(g[0]=S*(D=1/D),g[1]=-_*D,g[2]=-x*D,g[3]=h*D,g):null}function ce(g){const{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class ut extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,h){this._validate(c,h)&&(this.images[c]=h)}_validate(c,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),_=!1),_}_validateStretch(c,h){if(!c)return!0;let _=0;for(const x of c){if(x[0]<_||x[1]<x[0]||h<x[1])return!1;_=x[1]}return!0}_validateContent(c,h){return!(c&&(4!==c.length||c[0]<0||h.data.width<c[0]||c[1]<0||h.data.height<c[1]||c[2]<0||h.data.width<c[2]||c[3]<0||h.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,h){h.version=this.images[c].version+1,this.images[c]=h,this.updatedImages[c]=!0}removeImage(c){const h=this.images[c];delete this.images[c],delete this.patterns[c],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,h){let _=!0;if(!this.isLoaded())for(const x of c)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(c,h):this.requestors.push({ids:c,callback:h})}_notify(c,h){const _={};for(const x of c){this.images[x]||this.fire(new p.Event("styleimagemissing",{id:x}));const S=this.images[x];S?_[x]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:Boolean(S.userImage&&S.userImage.render)}:p.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:c,height:h}=this.atlasImage;return{width:c,height:h}}getPattern(c){const h=this.patterns[c],_=this.getImage(c);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},S=new p.ImagePosition(x,_);this.patterns[c]={bin:x,position:S}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const h=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(c,this.atlasImage,h.RGBA),this.atlasTexture&&this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const S in this.patterns)c.push(this.patterns[S].bin);const{w:h,h:_}=p.potpack(c),x=this.atlasImage;x.resize({width:h||1,height:_||1});for(const S in this.patterns){const{bin:D}=this.patterns[S],M=D.x+1,R=D.y+1,O=this.images[S].data,F=O.width,U=O.height;p.RGBAImage.copy(O,x,{x:0,y:0},{x:M,y:R},{width:F,height:U}),p.RGBAImage.copy(O,x,{x:0,y:U-1},{x:M,y:R-1},{width:F,height:1}),p.RGBAImage.copy(O,x,{x:0,y:0},{x:M,y:R+U},{width:F,height:1}),p.RGBAImage.copy(O,x,{x:F-1,y:0},{x:M-1,y:R},{width:1,height:U}),p.RGBAImage.copy(O,x,{x:0,y:0},{x:M+F,y:R},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const h of c){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];ce(_)&&this.updateImage(h,_)}}}const se=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(g,c){return function([h,_,x]){const S=p.degToRad(_+90),D=p.degToRad(x);return{x:h*Math.cos(S)*Math.sin(D),y:h*Math.sin(S)*Math.sin(D),z:h*Math.cos(D),azimuthal:_,polar:x}}(g.expression.evaluate(c))}interpolate(g,c,h){return{x:p.number(g.x,c.x,h),y:p.number(g.y,c.y,h),z:p.number(g.z,c.z,h),azimuthal:p.number(g.azimuthal,c.azimuthal,h),polar:p.number(g.polar,c.polar,h)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class be extends p.Evented{constructor(c){super(),this._transitionable=new p.Transitionable(se),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,h={}){if(!this._validate(p.validateLight,c,h))for(const _ in c){const x=c[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),x):this._transitionable.setValue(_,x)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const lt=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let gt=class extends p.Evented{constructor(g,c){super(),this._transitionable=new p.Transitionable(lt),this.set(g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(g){for(const c in g){const h=g[c];p.endsWith(c,"-transition")?this._transitionable.setTransition(c.slice(0,-11),h):this._transitionable.setValue(c,h)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}};function He(g,c,h,_){const x=p.smoothstep(45,65,h),[S,D]=vt(g,_),M=p.length(c);let R=1-Math.min(1,Math.exp((M-S)/(D-S)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*x*g.alpha}function vt(g,c){const h=.5/Math.tan(.5*c);return[g.range[0]+h,g.range[1]+h]}const Dt=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class oi extends p.Evented{constructor(c,h){super(),this._transitionable=new p.Transitionable(Dt),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const c=this._transform,h="globe"===c.projection.name,_=p.globeToMercatorTransition(c.zoom),x=this.properties.get("range"),S=[.5,3];return{range:h?[p.number(S[0],x[0],_),p.number(S[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,h={}){if(!this._validate(p.validateFog,c,h)){for(const _ of Object.keys(p.spec.fog))c&&void 0===c[_]&&(c[_]=p.spec.fog[_].default);for(const _ in c){const x=c[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),x):this._transitionable.setValue(_,x)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,c))*h.a}getOpacityAtLatLng(c,h){return this._transform.projection.supportsFog?function(_,x,S){const D=p.MercatorCoordinate.fromLngLat(x),M=S.elevation?S.elevation.getAtPointOrZero(D):0,R=[D.x,D.y,M];return p.transformMat4(R,R,S.mercatorFogMatrix),He(_,R,S.pitch,S._fov)}(this.state,c,h):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?vt(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,h,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Lt{constructor(c,h){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){const S=new Lt.Actor(_[x],h,this.id);S.name=`Worker ${x}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,h,_){p.asyncAll(this.actors,(x,S)=>{x.send(c,h,S)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function cn(g,c,h){return c*(p.EXTENT/(g.tileSize*Math.pow(2,h-g.tileID.overscaledZ)))}Lt.Actor=p.Actor;class qi{constructor(c,h,_,x){this.screenBounds=c,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(c,h){let _,x;if(c instanceof p.Point||"number"==typeof c[0]){const S=p.Point.convert(c);_=[S],x=h.isPointAboveHorizon(S)}else{const S=p.Point.convert(c[0]),D=p.Point.convert(c[1]);_=[S,D],x=p.polygonizeBounds(S,D).every(M=>h.isPointAboveHorizon(M))}return new qi(_,h.getCameraPoint(),x,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],x=p.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),p.bufferConvexPolygon(x,c)}bufferedCameraGeometryGlobe(c){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],x=p.polygonizeBounds(h,_,c),S=this.cameraPoint.clone();switch(3*((S.y>h.y)+(S.y>_.y))+((S.x>h.x)+(S.x>_.x))){case 0:x[0]=S,x[4]=S.clone();break;case 1:x.splice(1,0,S);break;case 2:x[1]=S;break;case 3:x.splice(4,0,S);break;case 5:x.splice(2,0,S);break;case 6:x[3]=S;break;case 7:x.splice(3,0,S);break;case 8:x[2]=S}return x}containsTile(c,h,_,x=0){const S=c.queryPadding/h._pixelsPerMercatorPixel+1,D=_?this._bufferedCameraMercator(S,h):this._bufferedScreenMercator(S,h);let M=c.tileID.wrap+(D.unwrapped?x:0);const R=D.polygon.map(ue=>p.getTilePoint(c.tileTransform,ue,M));if(!p.polygonIntersectsBox(R,0,0,p.EXTENT,p.EXTENT))return;M=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const O=this.screenGeometryMercator.polygon.map(ue=>p.getTileVec3(c.tileTransform,ue,M)),F=O.map(ue=>new p.Point(ue[0],ue[1])),U=h.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),J=p.getTileVec3(c.tileTransform,U,M),ne=O.map(ue=>{const $=p.sub(ue,ue,J);return p.normalize($,$),new p.Ray(J,$)}),le=cn(c,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:ne,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(oe=p.getBounds(R),oe.min.x=p.clamp(oe.min.x,0,p.EXTENT),oe.min.y=p.clamp(oe.min.y,0,p.EXTENT),oe.max.x=p.clamp(oe.max.x,0,p.EXTENT),oe.max.y=p.clamp(oe.max.y,0,p.EXTENT),oe),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:le};var oe}_bufferedScreenMercator(c,h){const _=Kt(c);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),h):{polygon:this.bufferedScreenGeometry(c).map(S=>h.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(c,h){const _=Kt(c);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),h):{polygon:this.bufferedCameraGeometry(c).map(S=>h.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(c,h){const _=function(S,D){const M=p.multiply([],D.pixelMatrix,D.globeMatrix),R=[0,-p.GLOBE_RADIUS,0,1],O=[0,p.GLOBE_RADIUS,0,1],F=[0,0,0,1];p.transformMat4$1(R,R,M),p.transformMat4$1(O,O,M),p.transformMat4$1(F,F,M);const U=new p.Point(R[0]/R[3],R[1]/R[3]),J=new p.Point(O[0]/O[3],O[1]/O[3]),ne=p.polygonContainsPoint(S,U)&&R[3]<F[3],le=p.polygonContainsPoint(S,J)&&O[3]<F[3];if(!ne&&!le)return null;const oe=function(Ne,Ze,qe){for(let ot=1;ot<Ne.length;ot++){const Vt=xi(Ze.pointCoordinate3D(Ne[ot-1]).x),nt=xi(Ze.pointCoordinate3D(Ne[ot]).x);if(qe<0){if(Vt<nt)return{idx:ot,t:-Vt/(nt-1-Vt)}}else if(nt<Vt)return{idx:ot,t:(1-Vt)/(nt+1-Vt)}}return null}(S,D,ne?-1:1);if(!oe)return null;const{idx:ue,t:$}=oe;let te=ue>1?Fi(S.slice(0,ue),D):[],me=ue<S.length?Fi(S.slice(ue),D):[];te=te.map(Ne=>new p.Point(xi(Ne.x),Ne.y)),me=me.map(Ne=>new p.Point(xi(Ne.x),Ne.y));const _e=[...te];0===_e.length&&_e.push(me[me.length-1]);const Be=p.number(_e[_e.length-1].y,(0===me.length?te[0]:me[0]).y,$);let Fe;return Fe=ne?[new p.Point(0,Be),new p.Point(0,0),new p.Point(1,0),new p.Point(1,Be)]:[new p.Point(1,Be),new p.Point(1,1),new p.Point(0,1),new p.Point(0,Be)],_e.push(...Fe),0===me.length?_e.push(te[0]):_e.push(...me),{polygon:_e.map(Ne=>new p.MercatorCoordinate(Ne.x,Ne.y)),unwrapped:!1}}(c,h);if(_)return _;const x=function(S,D){let M=!1,R=-1/0,O=0;for(let U=0;U<S.length-1;U++)S[U].x>R&&(R=S[U].x,O=U);for(let U=0;U<S.length-1;U++){const J=(O+U)%(S.length-1),ne=S[J],le=S[J+1];Math.abs(ne.x-le.x)>.5&&(ne.x<le.x?(ne.x+=1,0===J&&(S[S.length-1].x+=1)):(le.x+=1,J+1===S.length-1&&(S[0].x+=1)),M=!0)}const F=p.mercatorXfromLng(D.center.lng);return M&&F<Math.abs(F-1)&&S.forEach(U=>{U.x-=1}),{polygon:S,unwrapped:M}}(Fi(c,h).map(S=>new p.Point(xi(S.x),S.y)),h);return{polygon:x.polygon.map(S=>new p.MercatorCoordinate(S.x,S.y)),unwrapped:x.unwrapped}}}function Fi(g,c){return p.resample(g,h=>{const _=c.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function xi(g){return g<0?1+g%1:g%1}function Kt(g){return 100*g|0}function To(g,c,h,_,x){const S=function(D,M){if(D)return x(D);if(M){g.url&&M.tiles&&g.tiles&&delete g.tiles;const R=p.pick(p.extend(M,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(R.vectorLayers=M.vector_layers,R.vectorLayerIds=R.vectorLayers.map(O=>O.id)),R.tiles=c.canonicalizeTileset(R,g.url),x(null,R)}};return g.url?p.getJSON(c.transformRequest(c.normalizeSourceURL(g.url,null,h,_),p.ResourceType.Source),S):p.exported.frame(()=>S(null,g))}class vo{constructor(c,h,_){this.bounds=p.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const h=Math.pow(2,c.z),_=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*h),x=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*h),S=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*h),D=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=_&&c.x<S&&c.y>=x&&c.y<D}}class ki{constructor(c,h,_){this.context=c;const x=c.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ii={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ge{constructor(c,h,_,x){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.context=c;const S=c.gl;this.buffer=S.createBuffer(),c.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,h){for(let _=0;_<this.attributes.length;_++){const x=h.attributes[this.attributes[_].name];void 0!==x&&c.enableVertexAttribArray(x)}}setVertexAttribPointers(c,h,_){for(let x=0;x<this.attributes.length;x++){const S=this.attributes[x],D=h.attributes[S.name];void 0!==D&&c.vertexAttribPointer(D,S.components,c[Ii[S.type]],!1,this.itemSize,S.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class W{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Nt extends W{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Je extends W{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Ri extends W{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Jn extends W{getDefault(){return[!0,!0,!0,!0]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Ci extends W{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Xr extends W{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Zr extends W{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const h=this.current;(c.func!==h.func||c.ref!==h.ref||c.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class fe extends W{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class V extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=c,this.dirty=!1}}class q extends W{getDefault(){return[0,1]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class Me extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=c,this.dirty=!1}}class Ke extends W{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class qt extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.BLEND):h.disable(h.BLEND),this.current=c,this.dirty=!1}}class nn extends W{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class Ni extends W{getDefault(){return p.Color.transparent}set(c){const h=this.current;(c.r!==h.r||c.g!==h.g||c.b!==h.b||c.a!==h.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Di extends W{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class nr extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;c?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=c,this.dirty=!1}}class io extends W{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class yr extends W{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let Ta,ms=class extends W{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Ea extends W{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Yl extends W{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const h=this.current;(c[0]!==h[0]||c[1]!==h[1]||c[2]!==h[2]||c[3]!==h[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Kl extends W{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class Lc extends W{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class bu extends W{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class Fh extends W{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Ee extends W{getDefault(){return null}set(c){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Z extends W{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class Q extends W{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class ve extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class Oe extends W{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Ve extends W{constructor(c,h){super(c),this.context=c,this.parent=h}getDefault(){return null}}class tt extends Ve{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class et extends Ve{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class ze extends et{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ct{constructor(c,h,_,x){this.context=c,this.width=h,this.height=_;const S=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new tt(c,S),x&&(this.depthAttachment=new et(c,S))}destroy(){const c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&c.deleteRenderbuffer(_)}c.deleteFramebuffer(this.framebuffer)}}class Zt{constructor(c,h=!1){if(this.gl=c,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){const _=c;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(c),deleteVertexArrayOES:_.deleteVertexArray.bind(c),bindVertexArrayOES:_.bindVertexArray.bind(c)}}this.clearColor=new Nt(this),this.clearDepth=new Je(this),this.clearStencil=new Ri(this),this.colorMask=new Jn(this),this.depthMask=new Ci(this),this.stencilMask=new Xr(this),this.stencilFunc=new Zr(this),this.stencilOp=new fe(this),this.stencilTest=new V(this),this.depthRange=new q(this),this.depthTest=new Me(this),this.depthFunc=new Ke(this),this.blend=new qt(this),this.blendFunc=new nn(this),this.blendColor=new Ni(this),this.blendEquation=new Di(this),this.cullFace=new nr(this),this.cullFaceSide=new io(this),this.frontFace=new yr(this),this.program=new ms(this),this.activeTexture=new Ea(this),this.viewport=new Yl(this),this.bindFramebuffer=new Kl(this),this.bindRenderbuffer=new Lc(this),this.bindTexture=new bu(this),this.bindVertexBuffer=new Fh(this),this.bindElementBuffer=new Ee(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Z(this),this.pixelStoreUnpack=new Q(this),this.pixelStoreUnpackPremultiplyAlpha=new ve(this),this.pixelStoreUnpackFlipY=new Oe(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,h){return new ki(this,c,h)}createVertexBuffer(c,h,_){return new ge(this,c,h,_)}createRenderbuffer(c,h,_){const x=this.gl,S=x.createRenderbuffer();return this.bindRenderbuffer.set(S),x.renderbufferStorage(x.RENDERBUFFER,c,h,_),this.bindRenderbuffer.set(null),S}createFramebuffer(c,h,_){return new ct(this,c,h,_)}clear({color:c,depth:h,stencil:_}){const x=this.gl;let S=0;c&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(S)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){ie(c.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class rn extends p.Evented{constructor(c,h,_,x){if(super(),this.id=c,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=To(this._options,this.map._requestManager,h,_,(x,S)=>{this._tileJSONRequest=null,this._loaded=!0,x?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),_&&2!==_.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new p.ErrorEvent(x))):S&&(p.extend(this,S),S.bounds&&(this.tileBounds=new vo(S.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(S.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(x)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(c,h){const _=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(_,p.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=h:c.request=c.actor.send("reloadTile",x,S.bind(this));else if(c.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",x,S.bind(this),void 0,!0);else{const D=p.loadVectorTile.call({deduped:this._deduped},x,(M,R)=>{M||!R?S.call(this,M):(x.data={cacheControl:R.cacheControl,expires:R.expires,rawData:R.rawData.slice(0)},c.actor&&c.actor.send("loadTile",x,S.bind(this),void 0,!0))},!0);c.request={cancel:D}}function S(D,M){return delete c.request,c.aborted?h(null):D&&404!==D.status?h(D):(M&&M.resourceTiming&&(c.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&c.setExpiryData(M),c.loadVectorData(M,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Gt extends p.Evented{constructor(c,h,_,x){super(),this.id=c,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=To(this._options,this.map._requestManager,null,null,(h,_)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new p.ErrorEvent(h)):_&&(p.extend(this,_),_.bounds&&(this.tileBounds=new vo(_.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(_.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(h)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,h){const _=p.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);c.request=p.getImage(this.map._requestManager.transformRequest(x,p.ResourceType.Tile),(S,D,M,R)=>(delete c.request,c.aborted?(c.state="unloaded",h(null)):S?(c.state="errored",h(S)):D?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:M,expires:R}),c.setTexture(D,this.map.painter),c.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(c,h,_){c.setTexture(h,_)}static unloadTileData(c,h){c.texture&&h.saveTileTexture(c.texture)}abortTile(c,h){c.request&&(c.request.cancel(),delete c.request),h()}unloadTile(c,h){c.texture&&this.map.painter.saveTileTexture(c.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ii(g,c,h,_,x,S,D,M){const R=[g,h,x,c,_,S,1,1,1],O=[D,M,1],F=p.adjoint([],R),[U,J,ne]=p.transformMat3(O,O,p.transpose(F,F));return p.multiply$1(R,[U,0,0,0,J,0,0,0,ne],R)}class mi extends p.Evented{constructor(c,h,_,x){super(),this.id=c,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=h,this._dirty=!1}load(c,h){this._loaded=h||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(_,x)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new p.ErrorEvent(_));else if(x){const{HTMLImageElement:S}=p.window;this.image=x instanceof S?p.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const h=c.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let x=1/0,S=1/0,D=-1/0,M=-1/0;for(const U of _)x=Math.min(x,U.x),S=Math.min(S,U.y),D=Math.max(D,U.x),M=Math.max(M,U.y);const R=Math.max(D-x,M-S),O=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),F=Math.pow(2,O);return new p.CanonicalTileID(O,Math.floor((x+D)/2*F),Math.floor((S+M)/2*F))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const R in this.tiles){const O=this.tiles[R];"loaded"!==O.state&&(O.state="loaded",O.texture=this.texture)}if(this._boundsArray)return;const h=p.tileTransform(this.tileID,this.map.transform.projection),[_,x,S,D]=this.coordinates.map(R=>{const O=h.projection.project(R[0],R[1]);return p.getTilePoint(h,O)._round()});this.perspectiveTransform=function(R,O,F,U,J,ne,le,oe,ue,$){const te=ii(0,0,R,0,0,O,R,O),me=ii(F,U,J,ne,le,oe,ue,$);return p.multiply$1(me,p.adjoint(te,te),me),[me[6]/me[8]*R/p.EXTENT,me[7]/me[8]*O/p.EXTENT]}(this.width,this.height,_.x,_.y,x.x,x.y,D.x,D.y,S.x,S.y);const M=this._boundsArray=new p.StructArrayLayout4i8;M.emplaceBack(_.x,_.y,0,0),M.emplaceBack(x.x,x.y,p.EXTENT,0),M.emplaceBack(D.x,D.y,0,p.EXTENT),M.emplaceBack(S.x,S.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(M,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,h=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(c,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,h){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},h(null)):(c.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ni={vector:rn,raster:Gt,"raster-dem":class extends Gt{constructor(g,c,h,_){super(g,c,h,_),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,S){x&&(g.state="errored",c(x)),S&&(g.dem=S,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=p.getImage(this.map._requestManager.transformRequest(h,p.ResourceType.Tile),function(x,S,D,M){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(x)g.state="errored",c(x);else if(S){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:D,expires:M});const R=p.window.ImageBitmap&&S instanceof p.window.ImageBitmap&&(null==Ta&&(Ta=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),Ta),O=1-(S.width-p.prevPowerOfTwo(S.width))/2;O<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const F=R?S:p.exported.getImageData(S,O),U={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:F,encoding:this.encoding,padding:O};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",U,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const c=g.canonical,h=Math.pow(2,c.z),_=(c.x-1+h)%h,x=0===c.x?g.wrap-1:g.wrap,S=(c.x+1+h)%h,D=c.x+1===h?g.wrap+1:g.wrap,M={};return M[new p.OverscaledTileID(g.overscaledZ,x,c.z,_,c.y).key]={backfilled:!1},M[new p.OverscaledTileID(g.overscaledZ,D,c.z,S,c.y).key]={backfilled:!1},c.y>0&&(M[new p.OverscaledTileID(g.overscaledZ,x,c.z,_,c.y-1).key]={backfilled:!1},M[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},M[new p.OverscaledTileID(g.overscaledZ,D,c.z,S,c.y-1).key]={backfilled:!1}),c.y+1<h&&(M[new p.OverscaledTileID(g.overscaledZ,x,c.z,_,c.y+1).key]={backfilled:!1},M[new p.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},M[new p.OverscaledTileID(g.overscaledZ,D,c.z,S,c.y+1).key]={backfilled:!1}),M}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=c.data,this._options=p.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const x=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*x,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*x,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*x,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},c),this}getClusterLeaves(g,c,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:c,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=p.extend({},this.workerOptions),c=this._data;"string"==typeof c?(g.request=this.map._requestManager.transformRequest(p.exported.resolveURL(c),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new p.ErrorEvent(h));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),this.fire(new p.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(h,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,x)=>(delete g.request,g.unloadVectorData(),g.aborted?c(null):_?c(_):(g.loadVectorData(x,this.map.painter,"reloadTile"===h),c(null))),void 0,"loadTile"===h)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends mi{constructor(g,c,h,_){super(g,c,h,_),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,p.ResourceType.Source).url);p.getVideo(this.urls,(c,h)=>{this._loaded=!0,c?this.fire(new p.ErrorEvent(c)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:mi,canvas:class extends mi{constructor(g,c,h,_){super(g,c,h,_),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(S=>"number"!=typeof S))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends p.Evented{constructor(g,c,h,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=c,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new vo(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:c,y:h,z:_}=g.canonical;return this._implementation.hasTile({x:c,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){const{x:h,y:_,z:x}=g.tileID.canonical,S=new p.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y:_,z:x},{signal:S.signal})).then(function(D){return delete g.request,g.aborted?(g.state="unloaded",c(null)):void 0===D?(g.state="errored",c(null)):null===D?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):(M=D)instanceof p.window.ImageData||M instanceof p.window.HTMLCanvasElement||M instanceof p.window.ImageBitmap||M instanceof p.window.HTMLImageElement?(this.loadTileData(g,D),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var M}.bind(this)).catch(D=>{20!==D.code&&(g.state="errored",c(D))}),g.request.cancel=()=>S.abort()}loadTileData(g,c){Gt.loadTileData(g,c,this._map.painter)}unloadTileData(g){Gt.unloadTileData(g,this._map.painter)}unloadTile(g,c){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:h,y:_,z:x}=g.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:x})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},gi=function(g,c,h,_){const x=new ni[c.type](g,c,h,_);if(x.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${x.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],x),x};function Mi(g,c){const h=p.identity([]);return p.scale(h,h,[.5*g.width,.5*-g.height,1]),p.translate(h,h,[1,-1,0]),p.multiply(h,h,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(h)}function Bi(g,c,h,_,x,S,D,M=!1){const R=g.tilesIn(_,D,M);R.sort(ns);const O=[];for(const U of R)O.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(c,h,g._state,U,x,S,Mi(g.transform,U.tile.tileID),M)});const F=function(U){const J={},ne={};for(const le of U){const oe=le.queryResults,ue=le.wrappedTileID,$=ne[ue]=ne[ue]||{};for(const te in oe){const me=oe[te],_e=$[te]=$[te]||{},Be=J[te]=J[te]||[];for(const Fe of me)_e[Fe.featureIndex]||(_e[Fe.featureIndex]=!0,Be.push(Fe))}}return J}(O);for(const U in F)F[U].forEach(J=>{const ne=J.feature,le=ne.layer;le&&"background"!==le.type&&"sky"!==le.type&&(ne.source=le.source,le["source-layer"]&&(ne.sourceLayer=le["source-layer"]),ne.state=void 0!==ne.id?g.getFeatureState(le["source-layer"],ne.id):{})});return F}function po(g,c){const h=g.getRenderableIds().map(S=>g.getTileByID(S)),_=[],x={};for(let S=0;S<h.length;S++){const D=h[S],M=D.tileID.canonical.key;x[M]||(x[M]=!0,D.querySourceFeatures(_,c))}return _}function ns(g,c){const h=g.tileID,_=c.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function xo(){return null!=ac.workerClass?new ac.workerClass:new p.window.Worker(ac.workerUrl)}const nl="mapboxgl_preloaded_worker_pool";class Eo{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<Eo.workerCount;)this.workers.push(new xo);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[nl]}numActive(){return Object.keys(this.active).length}}let gs;function _u(){return gs||(gs=new Eo),gs}function Tl(g,c){const h={};for(const _ in g)"ref"!==_&&(h[_]=g[_]);return p.refProperties.forEach(_=>{_ in c&&(h[_]=c[_])}),h}function $m(g){g=g.slice();const c=Object.create(null);for(let h=0;h<g.length;h++)c[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=Tl(g[h],c[g[h].ref]));return g}Eo.workerCount=2;const Wn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ql(g,c,h){h.push({command:Wn.addSource,args:[g,c[g]]})}function bs(g,c,h){c.push({command:Wn.removeSource,args:[g]}),h[g]=!0}function qm(g,c,h,_){bs(g,h,_),Ql(g,c,h)}function Nh(g,c,h){let _;for(_ in g[h])if(g[h].hasOwnProperty(_)&&"data"!==_&&!ie(g[h][_],c[h][_]))return!1;for(_ in c[h])if(c[h].hasOwnProperty(_)&&"data"!==_&&!ie(g[h][_],c[h][_]))return!1;return!0}function Da(g,c,h,_,x,S){let D;for(D in c=c||{},g=g||{})g.hasOwnProperty(D)&&(ie(g[D],c[D])||h.push({command:S,args:[_,D,c[D],x]}));for(D in c)c.hasOwnProperty(D)&&!g.hasOwnProperty(D)&&(ie(g[D],c[D])||h.push({command:S,args:[_,D,c[D],x]}))}function Ia(g){return g.id}function Bh(g,c){return g[c.id]=c,g}class Oc{constructor(c,h){this.reset(c,h)}reset(c,h){this.points=c||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=p.clamp(c,0,1);let h=1,_=this._distances[h];const x=c*this.paddedLength+this.padding;for(;_<x&&h<this._distances.length;)_=this._distances[++h];const S=h-1,D=this._distances[S],M=_-D,R=M>0?(x-D)/M:0;return this.points[S].mult(1-R).add(this.points[h].mult(R))}}class Fc{constructor(c,h,_){const x=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/_),this.yCellCount=Math.ceil(h/_);for(let D=0;D<this.xCellCount*this.yCellCount;D++)x.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,h,_,x,S){this._forEachCell(h,_,x,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(S)}insertCircle(c,h,_,x){this._forEachCell(h-x,_-x,h+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(_),this.circles.push(x)}_insertBoxCell(c,h,_,x,S,D){this.boxCells[S].push(D)}_insertCircleCell(c,h,_,x,S,D){this.circleCells[S].push(D)}_query(c,h,_,x,S,D){if(_<0||c>this.width||x<0||h>this.height)return!S&&[];const M=[];if(c<=0&&h<=0&&this.width<=_&&this.height<=x){if(S)return!0;for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const O=this.circles[3*R],F=this.circles[3*R+1],U=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:O-U,y1:F-U,x2:O+U,y2:F+U})}return D?M.filter(D):M}return this._forEachCell(c,h,_,x,this._queryCell,M,{hitTest:S,seenUids:{box:{},circle:{}}},D),S?M.length>0:M}_queryCircle(c,h,_,x,S){const D=c-_,M=c+_,R=h-_,O=h+_;if(M<0||D>this.width||O<0||R>this.height)return!x&&[];const F=[];return this._forEachCell(D,R,M,O,this._queryCellCircle,F,{hitTest:x,circle:{x:c,y:h,radius:_},seenUids:{box:{},circle:{}}},S),x?F.length>0:F}query(c,h,_,x,S){return this._query(c,h,_,x,!1,S)}hitTest(c,h,_,x,S){return this._query(c,h,_,x,!0,S)}hitTestCircle(c,h,_,x){return this._queryCircle(c,h,_,!0,x)}_queryCell(c,h,_,x,S,D,M,R){const O=M.seenUids,F=this.boxCells[S];if(null!==F){const J=this.bboxes;for(const ne of F)if(!O.box[ne]){O.box[ne]=!0;const le=4*ne;if(c<=J[le+2]&&h<=J[le+3]&&_>=J[le+0]&&x>=J[le+1]&&(!R||R(this.boxKeys[ne]))){if(M.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[ne],x1:J[le],y1:J[le+1],x2:J[le+2],y2:J[le+3]})}}}const U=this.circleCells[S];if(null!==U){const J=this.circles;for(const ne of U)if(!O.circle[ne]){O.circle[ne]=!0;const le=3*ne;if(this._circleAndRectCollide(J[le],J[le+1],J[le+2],c,h,_,x)&&(!R||R(this.circleKeys[ne]))){if(M.hitTest)return D.push(!0),!0;{const oe=J[le],ue=J[le+1],$=J[le+2];D.push({key:this.circleKeys[ne],x1:oe-$,y1:ue-$,x2:oe+$,y2:ue+$})}}}}}_queryCellCircle(c,h,_,x,S,D,M,R){const O=M.circle,F=M.seenUids,U=this.boxCells[S];if(null!==U){const ne=this.bboxes;for(const le of U)if(!F.box[le]){F.box[le]=!0;const oe=4*le;if(this._circleAndRectCollide(O.x,O.y,O.radius,ne[oe+0],ne[oe+1],ne[oe+2],ne[oe+3])&&(!R||R(this.boxKeys[le])))return D.push(!0),!0}}const J=this.circleCells[S];if(null!==J){const ne=this.circles;for(const le of J)if(!F.circle[le]){F.circle[le]=!0;const oe=3*le;if(this._circlesCollide(ne[oe],ne[oe+1],ne[oe+2],O.x,O.y,O.radius)&&(!R||R(this.circleKeys[le])))return D.push(!0),!0}}}_forEachCell(c,h,_,x,S,D,M,R){const O=this._convertToXCellCoord(c),F=this._convertToYCellCoord(h),U=this._convertToXCellCoord(_),J=this._convertToYCellCoord(x);for(let ne=O;ne<=U;ne++)for(let le=F;le<=J;le++)if(S.call(this,c,h,_,x,this.xCellCount*le+ne,D,M,R))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,h,_,x,S,D){const M=x-c,R=S-h,O=_+D;return O*O>M*M+R*R}_circleAndRectCollide(c,h,_,x,S,D,M){const R=(D-x)/2,O=Math.abs(c-(x+R));if(O>R+_)return!1;const F=(M-S)/2,U=Math.abs(h-(S+F));if(U>F+_)return!1;if(O<=R||U<=F)return!0;const J=O-R,ne=U-F;return J*J+ne*ne<=_*_}}const il_unknown=0,il_flipRequired=1,il_flipNotRequired=2,yu=Math.tan(85*Math.PI/180);function _t(g,c,h,_,x,S,D){const M=p.create();if(h)if("globe"===S.name){const R=p.calculateGlobeLabelMatrix(x,c);p.multiply(M,M,R)}else{const R=Ae([],D);M[0]=R[0],M[1]=R[1],M[4]=R[2],M[5]=R[3],_||p.rotateZ(M,M,x.angle)}else p.multiply(M,x.labelPlaneMatrix,g);return M}function El(g,c,h,_,x,S,D){const M=_t(g,c,h,_,x,S,D);return"globe"===S.name&&h||(M[2]=M[6]=M[10]=M[14]=0),M}function fo(g,c,h,_,x,S,D){if(h){if("globe"===S.name){const M=_t(g,c,h,_,x,S,D);return p.invert(M,M),p.multiply(M,g,M),M}{const M=p.clone(g),R=p.identity([]);return R[0]=D[0],R[1]=D[1],R[4]=D[2],R[5]=D[3],p.multiply(M,M,R),_||p.rotateZ(M,M,-x.angle),M}}return x.glCoordMatrix}function Oo(g,c,h,_){const x=[g,c,h,1];h?p.transformMat4$1(x,x,_):bi(x,x,_);const S=x[3];return x[0]/=S,x[1]/=S,x[2]/=S,x}function ef(g,c){return Math.min(.5+g/c*.5,1.5)}function rl(g,c){const h=g[0]/g[3],_=g[1]/g[3];return h>=-c[0]&&h<=c[0]&&_>=-c[1]&&_<=c[1]}function tf(g,c,h,_,x,S,D,M,R,O){const F=h.transform,U=_?g.textSizeData:g.iconSizeData,J=p.evaluateSizeForZoom(U,h.transform.zoom),ne="globe"===F.projection.name,le=[256/h.width*2+1,256/h.height*2+1],oe=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;oe.clear();let ue=null;ne&&(ue=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const $=g.lineVertexArray,te=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,me=h.transform.width/h.transform.height;let _e,Be=!1;for(let Fe=0;Fe<te.length;Fe++){const Ne=te.get(Fe),{numGlyphs:Ze,writingMode:qe}=Ne;if(qe!==p.WritingMode.vertical||Be||_e===p.WritingMode.horizontal||(Be=!0),_e=qe,(Ne.hidden||qe===p.WritingMode.vertical)&&!Be){ji(Ze,oe);continue}Be=!1;const ot=new p.Point(Ne.tileAnchorX,Ne.tileAnchorY);let{x:Vt,y:nt,z:Tt}=F.projection.projectTilePoint(ot.x,ot.y,O.canonical);if(R){const[jn,_n,Rn]=R(ot);Vt+=jn,nt+=_n,Tt+=Rn}const ht=[Vt,nt,Tt,1];if(p.transformMat4$1(ht,ht,c),!rl(ht,le)){ji(Ze,oe);continue}const jt=ef(h.transform.cameraToCenterDistance,ht[3]),it=p.evaluateSizeForFeature(U,J,Ne),xt=D?it/jt:it*jt,Ut=Oo(Vt,nt,Tt,x);if(Ut[3]<=0){ji(Ze,oe);continue}let Rt={};const $t=D?null:R,Mn=un(Ne,xt,!1,M,c,x,S,g.glyphOffsetArray,$,oe,ue,Ut,ot,Rt,me,$t,F.projection,O,D);Be=Mn.useVertical,$t&&Mn.needsFlipping&&(Rt={}),(Mn.notEnoughRoom||Be||Mn.needsFlipping&&un(Ne,xt,!0,M,c,x,S,g.glyphOffsetArray,$,oe,ue,Ut,ot,Rt,me,$t,F.projection,O,D).notEnoughRoom)&&ji(Ze,oe)}_?(g.text.dynamicLayoutVertexBuffer.updateData(oe),ue&&g.text.globeExtVertexBuffer.updateData(ue)):(g.icon.dynamicLayoutVertexBuffer.updateData(oe),ue&&g.icon.globeExtVertexBuffer.updateData(ue))}function ro(g,c,h,_,x,S,D,M,R,O,F,U,J,ne,le,oe){const{lineStartIndex:ue,glyphStartIndex:$,segment:te}=M,me=$+M.numGlyphs,_e=ue+M.lineLength,Be=c.getoffsetX($),Fe=c.getoffsetX(me-1),Ne=_s(g*Be,h,_,x,S,D,te,ue,_e,R,O,F,U,J,!0,ne,le,oe);if(!Ne)return null;const Ze=_s(g*Fe,h,_,x,S,D,te,ue,_e,R,O,F,U,J,!0,ne,le,oe);return Ze?{first:Ne,last:Ze}:null}function Er(g,c,h,_){return g===p.WritingMode.horizontal&&Math.abs(_)>Math.abs(h)?{useVertical:!0}:g===p.WritingMode.vertical?_>0?{needsFlipping:!0}:null:c!==il_unknown&&(0===(x=h)||Math.abs(_/x)>yu)?c===il_flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null;var x}function un(g,c,h,_,x,S,D,M,R,O,F,U,J,ne,le,oe,ue,$,te){const me=c/24,_e=g.lineOffsetX*me,Be=g.lineOffsetY*me,{lineStartIndex:Fe,glyphStartIndex:Ne,numGlyphs:Ze,segment:qe,writingMode:ot,flipState:Vt}=g,nt=Fe+g.lineLength,Tt=ht=>{if(F){const[Ut,Rt,$t]=ht.up,Mn=O.length;p.updateGlobeVertexNormal(F,Mn+0,Ut,Rt,$t),p.updateGlobeVertexNormal(F,Mn+1,Ut,Rt,$t),p.updateGlobeVertexNormal(F,Mn+2,Ut,Rt,$t),p.updateGlobeVertexNormal(F,Mn+3,Ut,Rt,$t)}const[jt,it,xt]=ht.point;p.addDynamicAttributes(O,jt,it,xt,ht.angle)};if(Ze>1){const ht=ro(me,M,_e,Be,h,U,J,g,R,S,ne,oe,!1,ue,$,te);if(!ht)return{notEnoughRoom:!0};if(_&&!h){let[jt,it,xt]=ht.first.point,[Ut,Rt,$t]=ht.last.point;[jt,it]=Oo(jt,it,xt,D),[Ut,Rt]=Oo(Ut,Rt,$t,D);const Mn=Er(ot,Vt,(Ut-jt)*le,Rt-it);if(g.flipState=Mn&&Mn.needsFlipping?il_flipRequired:il_flipNotRequired,Mn)return Mn}Tt(ht.first);for(let jt=Ne+1;jt<Ne+Ze-1;jt++){const it=_s(me*M.getoffsetX(jt),_e,Be,h,U,J,qe,Fe,nt,R,S,ne,oe,!1,!1,ue,$,te);if(!it)return O.length-=4*(jt-Ne),{notEnoughRoom:!0};Tt(it)}Tt(ht.last)}else{if(_&&!h){const jt=Oo(J.x,J.y,0,x),it=Fe+qe+1,xt=new p.Point(R.getx(it),R.gety(it)),Ut=Oo(xt.x,xt.y,0,x),Rt=Ut[3]>0?Ut:Tn(J,xt,jt,1,x,void 0,ue,$.canonical),$t=Er(ot,Vt,(Rt[0]-jt[0])*le,Rt[1]-jt[1]);if(g.flipState=$t&&$t.needsFlipping?il_flipRequired:il_flipNotRequired,$t)return $t}const ht=_s(me*M.getoffsetX(Ne),_e,Be,h,U,J,qe,Fe,nt,R,S,ne,oe,!1,!1,ue,$,te);if(!ht)return{notEnoughRoom:!0};Tt(ht)}return{}}function Ti(g,c,h,_,x){const{x:S,y:D,z:M}=_.projectTilePoint(g.x,g.y,c);if(!x)return Oo(S,D,M,h);const[R,O,F]=x(g);return Oo(S+R,D+O,M+F,h)}function Tn(g,c,h,_,x,S,D,M){const R=Ti(g.sub(c)._unit()._add(g),M,x,D,S);return p.sub(R,h,R),p.normalize(R,R),p.scaleAndAdd(R,h,R,_)}function _s(g,c,h,_,x,S,D,M,R,O,F,U,J,ne,le,oe,ue,$){const te=_?g-c:g+c;let me=te>0?1:-1,_e=0;_&&(me*=-1,_e=Math.PI),me<0&&(_e+=Math.PI);let Be=M+D+(me>0?0:1)|0,Fe=x,Ne=x,Ze=0,qe=0;const ot=Math.abs(te),Vt=[],nt=[];let Tt=S,ht=Tt;const jt=()=>Tn(ht,Tt,Ne,ot-Ze+1,F,J,oe,ue.canonical);for(;Ze+qe<=ot;){if(Be+=me,Be<M||Be>=R)return null;if(Ne=Fe,ht=Tt,Vt.push(Ne),ne&&nt.push(ht),Tt=new p.Point(O.getx(Be),O.gety(Be)),Fe=U[Be],!Fe){const Rn=Ti(Tt,ue.canonical,F,oe,J);Fe=Rn[3]>0?U[Be]=Rn:jt()}Ze+=qe,qe=p.distance(Ne,Fe)}le&&J&&(U[Be]&&(Fe=jt(),qe=p.distance(Ne,Fe)),U[Be]=Fe);const it=(ot-Ze)/qe,xt=Tt.sub(ht)._mult(it)._add(ht),Ut=p.sub([],Fe,Ne),Rt=p.scaleAndAdd([],Ne,Ut,it);let $t=[0,0,1],Mn=Ut[0],jn=Ut[1];if($&&($t=oe.upVector(ue.canonical,xt.x,xt.y),0!==$t[0]||0!==$t[1]||1!==$t[2])){const Rn=[$t[2],0,-$t[0]],_i=p.cross([],$t,Rn);p.normalize(Rn,Rn),p.normalize(_i,_i),Mn=p.dot(Ut,Rn),jn=p.dot(Ut,_i)}if(h){const Rn=p.cross([],$t,Ut);p.normalize(Rn,Rn),p.scaleAndAdd(Rt,Rt,Rn,h*me)}const _n=_e+Math.atan2(jn,Mn);return Vt.push(Rt),ne&&nt.push(xt),{point:Rt,angle:_n,path:Vt,tilePath:nt,up:$t}}function ji(g,c){const h=c.length,_=h+4*g;c.resize(_),c.float32.fill(-1/0,4*h,4*_)}function bi(g,c,h){const _=c[0],x=c[1];return g[0]=h[0]*_+h[4]*x+h[12],g[1]=h[1]*_+h[5]*x+h[13],g[3]=h[3]*_+h[7]*x+h[15],g}const qs=100;class zi{constructor(c,h,_=new Fc(c.width+200,c.height+200,25),x=new Fc(c.width+200,c.height+200,25)){this.transform=c,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+qs,this.screenBottomBoundary=c.height+qs,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=h}placeCollisionBox(c,h,_,x,S,D,M,R){let O=_.projectedAnchorX,F=_.projectedAnchorY,U=_.projectedAnchorZ;const J=_.elevation,ne=_.tileID,le=c.getProjection();if(J&&ne){const[Fe,Ne,Ze]=le.upVector(ne.canonical,_.tileAnchorX,_.tileAnchorY),qe=le.upVectorScale(ne.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=Fe*J*qe,F+=Ne*J*qe,U+=Ze*J*qe}const oe=this.projectAndGetPerspectiveRatio(M,O,F,U,_.tileID,"globe"===le.name||!!J||this.transform.pitch>0,le),ue=D*oe.perspectiveRatio,$=(_.x1*h+x.x-_.padding)*ue+oe.point.x,te=(_.y1*h+x.y-_.padding)*ue+oe.point.y,me=(_.x2*h+x.x+_.padding)*ue+oe.point.x,_e=(_.y2*h+x.y+_.padding)*ue+oe.point.y,Be=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid($,te,me,_e)||!S&&this.grid.hitTest($,te,me,_e,R)||Be?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[$,te,me,_e],offscreen:this.isOffscreen($,te,me,_e),occluded:!1}}placeCollisionCircles(c,h,_,x,S,D,M,R,O,F,U,J,ne,le,oe){const ue=[],$=this.transform.elevation,te=c.getProjection(),me=$?$.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,te):null,_e=new p.Point(_.tileAnchorX,_.tileAnchorY);let{x:Be,y:Fe,z:Ne}=te.projectTilePoint(_e.x,_e.y,oe.canonical);if(me){const[xt,Ut,Rt]=me(_e);Be+=xt,Fe+=Ut,Ne+=Rt}const Ze="globe"===te.name,qe=this.projectAndGetPerspectiveRatio(M,Be,Fe,Ne,oe,Ze||!!$||this.transform.pitch>0,te),{perspectiveRatio:ot}=qe,Vt=(U?D/ot:D*ot)/p.ONE_EM,nt=Oo(Be,Fe,Ne,R),Tt=qe.signedDistanceFromCamera>0?ro(Vt,S,_.lineOffsetX*Vt,_.lineOffsetY*Vt,!1,nt,_e,_,x,R,{},$&&!U?me:null,U&&!!$,te,oe,U):null;let ht=!1,jt=!1,it=!0;if(Tt&&!qe.occluded){const xt=.5*ne*ot+le,Ut=new p.Point(-100,-100),Rt=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),$t=new Oc,{first:Mn,last:jn}=Tt,_n=Mn.path.length;let Rn=[];for(let Dn=_n-1;Dn>=1;Dn--)Rn.push(Mn.path[Dn]);for(let Dn=1;Dn<jn.path.length;Dn++)Rn.push(jn.path[Dn]);const _i=2.5*xt;O&&(Rn=Rn.map(([Dn,rr,gr],vr)=>(me&&!Ze&&(gr=me(vr<_n-1?Mn.tilePath[_n-1-vr]:jn.tilePath[vr-_n+2])[2]),Oo(Dn,rr,gr,O))),Rn.some(Dn=>Dn[3]<=0)&&(Rn=[]));let ai=[];if(Rn.length>0){let Dn=1/0,rr=-1/0,gr=1/0,vr=-1/0;for(const Pi of Rn)Dn=Math.min(Dn,Pi[0]),gr=Math.min(gr,Pi[1]),rr=Math.max(rr,Pi[0]),vr=Math.max(vr,Pi[1]);rr>=Ut.x&&Dn<=Rt.x&&vr>=Ut.y&&gr<=Rt.y&&(ai=[Rn.map(Pi=>new p.Point(Pi[0],Pi[1]))],(Dn<Ut.x||rr>Rt.x||gr<Ut.y||vr>Rt.y)&&(ai=p.clipLine(ai,Ut.x,Ut.y,Rt.x,Rt.y)))}for(const Dn of ai){$t.reset(Dn,.25*xt);let rr=0;rr=$t.length<=.5*xt?1:Math.ceil($t.paddedLength/_i)+1;for(let gr=0;gr<rr;gr++){const vr=gr/Math.max(rr-1,1),Pi=$t.lerp(vr),ss=Pi.x+qs,ao=Pi.y+qs;ue.push(ss,ao,xt,0);const zs=ss-xt,ga=ao-xt,Ir=ss+xt,ar=ao+xt;if(it=it&&this.isOffscreen(zs,ga,Ir,ar),jt=jt||this.isInsideGrid(zs,ga,Ir,ar),!h&&this.grid.hitTestCircle(ss,ao,xt,J)&&(ht=!0,!F))return{circles:[],offscreen:!1,collisionDetected:ht,occluded:!1}}}}return{circles:!F&&ht||!jt?[]:ue,offscreen:it,collisionDetected:ht,occluded:qe.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,x=1/0,S=-1/0,D=-1/0;for(const F of c){const U=new p.Point(F.x+qs,F.y+qs);_=Math.min(_,U.x),x=Math.min(x,U.y),S=Math.max(S,U.x),D=Math.max(D,U.y),h.push(U)}const M=this.grid.query(_,x,S,D).concat(this.ignoredGrid.query(_,x,S,D)),R={},O={};for(const F of M){const U=F.key;if(void 0===R[U.bucketInstanceId]&&(R[U.bucketInstanceId]={}),R[U.bucketInstanceId][U.featureIndex])continue;const J=[new p.Point(F.x1,F.y1),new p.Point(F.x2,F.y1),new p.Point(F.x2,F.y2),new p.Point(F.x1,F.y2)];p.polygonIntersectsPolygon(h,J)&&(R[U.bucketInstanceId][U.featureIndex]=!0,void 0===O[U.bucketInstanceId]&&(O[U.bucketInstanceId]=[]),O[U.bucketInstanceId].push(U.featureIndex))}return O}insertCollisionBox(c,h,_,x,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:S},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,h,_,x,S){const D=h?this.ignoredGrid:this.grid,M={bucketInstanceId:_,featureIndex:x,collisionGroupID:S};for(let R=0;R<c.length;R+=4)D.insertCircle(M,c[R],c[R+1],c[R+2])}projectAndGetPerspectiveRatio(c,h,_,x,S,D,M){const R=[h,_,x,1];let O=!1;x||this.transform.pitch>0?(p.transformMat4$1(R,R,c),this.fogState&&S&&"globe"!==M.name&&(O=function(J,ne,le,oe,ue,$){const te=$.calculateFogTileMatrix(ue),me=[ne,le,oe];return p.transformMat4(me,me,te),He(J,me,$.pitch,$._fov)}(this.fogState,h,_,x,S.toUnwrapped(),this.transform)>.9)):bi(R,R,c);const F=R[3];return{point:new p.Point((R[0]/F+1)/2*this.transform.width+qs,(-R[1]/F+1)/2*this.transform.height+qs),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/F*.5,1.5),signedDistanceFromCamera:F,occluded:D&&R[2]>F||O}}isOffscreen(c,h,_,x){return _<qs||c>=this.screenRightBoundary||x<qs||h>this.screenBottomBoundary}isInsideGrid(c,h,_,x){return _>=0&&c<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const c=p.identity([]);return p.translate(c,c,[-100,-100,0]),c}}function qn(g,c,h){const _=c.createTileMatrix(g,g.worldSize,h.toUnwrapped());return p.multiply(new Float32Array(16),g.projMatrix,_)}function Rs(g,c,h){if(c.projection.name===h.projection.name)return g.projMatrix;const _=h.clone();return _.setProjection(c.projection),qn(_,c.getProjection(),g)}function Hr(g,c,h){return c.name===h.projection.name?g.projMatrix:qn(h,c,g)}class zt{constructor(c,h,_,x){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):x&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class da{constructor(c,h,_,x,S,D=!1){this.text=new zt(c?c.text:null,h,_,S),this.icon=new zt(c?c.icon:null,h,x,S),this.clipped=D}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ri{constructor(c,h,_,x=!1){this.text=c,this.icon=h,this.skipFade=_,this.clipped=x}}class Yi{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class nf{constructor(c,h,_,x,S){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=S}}class p_{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[c]}}function vd(g,c,h,_,x){const{horizontalAlign:S,verticalAlign:D}=p.getAnchorAlignment(g),M=-(S-.5)*c,R=-(D-.5)*h,O=p.evaluateVariableOffset(g,_);return new p.Point(M+O[0]*x,R+O[1]*x)}function Jl(g,c,h,_,x){const S=new p.Point(g,c);return h&&S._rotate(_?x:-x),S}class is{constructor(c,h,_,x,S){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new zi(this.transform,S),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new p_(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,h,_,x){const S=_.getBucket(h),D=_.latestFeatureIndex;if(!S||!D||h.id!==S.layerIds[0])return;const M=S.layers[0].layout,R=_.collisionBoxArray,O=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),F=_.tileSize/p.EXTENT,U=_.tileID.toUnwrapped();this.transform.setProjection(S.projection);const J=(ne=_.tileID,le=S.getProjection(),oe=this.transform,le.name===this.projection?oe.calculateProjMatrix(ne.toUnwrapped()):qn(oe,le,ne));var ne,le,oe;const ue="map"===M.get("text-pitch-alignment"),$="map"===M.get("text-rotation-alignment");h.compileFilter();const te=h.dynamicFilter(),me=h.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(_),Be=El(J,_.tileID.canonical,ue,$,this.transform,S.getProjection(),_e);let Fe=null;if(ue){const qe=fo(J,_.tileID.canonical,ue,$,this.transform,S.getProjection(),_e);Fe=p.multiply([],this.transform.labelPlaneMatrix,qe)}let Ne=null;te&&_.latestFeatureIndex&&(Ne={unwrappedTileID:U,dynamicFilter:te,dynamicFilterNeedsFeature:me,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[S.bucketInstanceId]=new nf(S.bucketInstanceId,D,S.sourceLayerIndex,S.index,_.tileID);const Ze={bucket:S,layout:M,posMatrix:J,textLabelPlaneMatrix:Be,labelToScreenMatrix:Fe,clippingData:Ne,scale:O,textPixelRatio:F,holdingForFade:_.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(S.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(x)for(const qe of S.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:Vt,symbolInstanceEnd:nt}=qe;c.push({sortKey:ot,symbolInstanceStart:Vt,symbolInstanceEnd:nt,parameters:Ze})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Ze})}attemptAnchorPlacement(c,h,_,x,S,D,M,R,O,F,U,J,ne,le,oe,ue,$,te){const{textOffset0:me,textOffset1:_e,crossTileID:Be}=J,Fe=[me,_e],Ne=vd(c,_,x,Fe,S),Ze=this.collisionIndex.placeCollisionBox(le,S,h,Jl(Ne.x,Ne.y,D,M,this.transform.angle),U,R,O,F.predicate);if(ue){const qe=le.getSymbolInstanceIconSize(te,this.transform.zoom,J.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(le,qe,ue,Jl(Ne.x,Ne.y,D,M,this.transform.angle),U,R,O,F.predicate).box.length)return}if(Ze.box.length>0){let qe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Be]&&this.prevPlacement.placements[Be]&&this.prevPlacement.placements[Be].text&&(qe=this.prevPlacement.variableOffsets[Be].anchor),this.variableOffsets[Be]={textOffset:Fe,width:_,height:x,anchor:c,textScale:S,prevAnchor:qe},this.markUsedJustification(le,c,J,oe),le.allowVerticalPlacement&&(this.markUsedOrientation(le,oe,J),this.placedOrientations[Be]=oe),{shift:Ne,placedGlyphBoxes:Ze}}}placeLayerBucketPart(c,h,_,x){const{bucket:S,layout:D,posMatrix:M,textLabelPlaneMatrix:R,labelToScreenMatrix:O,clippingData:F,textPixelRatio:U,holdingForFade:J,collisionBoxArray:ne,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:oe,collisionGroup:ue}=c.parameters,$=D.get("text-optional"),te=D.get("icon-optional"),me=D.get("text-allow-overlap"),_e=D.get("icon-allow-overlap"),Be="map"===D.get("text-rotation-alignment"),Fe="map"===D.get("text-pitch-alignment"),Ne="none"!==D.get("icon-text-fit"),Ze="viewport-y"===D.get("symbol-z-order");this.transform.setProjection(S.projection);let qe=me&&(_e||!S.hasIconData()||te),ot=_e&&(me||!S.hasTextData()||$);!S.collisionArrays&&ne&&S.deserializeCollisionBoxes(ne),_&&x&&S.updateCollisionDebugBuffers(this.transform.zoom,ne);const Vt=(nt,Tt,ht)=>{const{crossTileID:jt,numVerticalGlyphVertices:it}=nt;if(F){const Ir={zoom:this.transform.zoom,pitch:this.transform.pitch};let ar=null;if(F.dynamicFilterNeedsFeature){const Qi=this.retainedQueryData[S.bucketInstanceId];ar=F.featureIndex.loadFeature({featureIndex:nt.featureIndex,bucketIndex:Qi.bucketIndex,sourceLayerIndex:Qi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,F.dynamicFilter)(Ir,ar,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new p.Point(nt.tileAnchorX,nt.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[jt]=new ri(!1,!1,!1,!0),void h.add(jt)}if(h.has(jt))return;if(J)return void(this.placements[jt]=new ri(!1,!1,!1));let xt=!1,Ut=!1,Rt=!0,$t=!1,Mn=!1,jn=null,_n={box:null,offscreen:null,occluded:null},Rn={box:null,offscreen:null,occluded:null},_i=null,ai=null,Dn=null,rr=0,gr=0,vr=0;ht.textFeatureIndex?rr=ht.textFeatureIndex:nt.useRuntimeCollisionCircles&&(rr=nt.featureIndex),ht.verticalTextFeatureIndex&&(gr=ht.verticalTextFeatureIndex);const Pi=Ir=>{Ir.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const ar=this.transform.elevation;(ar||Ir.elevation)&&(Ir.elevation=ar?ar.getAtTileOffset(Ir.tileID,Ir.tileAnchorX,Ir.tileAnchorY):0)},ss=ht.textBox;if(ss){Pi(ss);const Ir=Qi=>{let lo=p.WritingMode.horizontal;if(S.allowVerticalPlacement&&!Qi&&this.prevPlacement){const as=this.prevPlacement.placedOrientations[jt];as&&(this.placedOrientations[jt]=as,lo=as,this.markUsedOrientation(S,lo,nt))}return lo},ar=(Qi,lo)=>{if(S.allowVerticalPlacement&&it>0&&ht.verticalTextBox){for(const as of S.writingModes)if(as===p.WritingMode.vertical?(_n=lo(),Rn=_n):_n=Qi(),_n&&_n.box&&_n.box.length)break}else _n=Qi()};if(D.get("text-variable-anchor")){let Qi=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[jt]){const Rr=this.prevPlacement.variableOffsets[jt];Qi.indexOf(Rr.anchor)>0&&(Qi=Qi.filter(Cs=>Cs!==Rr.anchor),Qi.unshift(Rr.anchor))}const lo=(Rr,Cs,sp)=>{const dl=S.getSymbolInstanceTextSize(le,nt,this.transform.zoom,Tt),Rl=(Rr.x2-Rr.x1)*dl+2*Rr.padding,Pl=(Rr.y2-Rr.y1)*dl+2*Rr.padding,Ll=Ne&&!_e?Cs:null;Ll&&Pi(Ll);let lc={box:[],offscreen:!1,occluded:!1};const Ol=me?2*Qi.length:Qi.length;for(let Hd=0;Hd<Ol;++Hd){const Ui=this.attemptAnchorPlacement(Qi[Hd%Qi.length],Rr,Rl,Pl,dl,Be,Fe,U,M,ue,Hd>=Qi.length,nt,Tt,S,sp,Ll,le,oe);if(Ui&&(lc=Ui.placedGlyphBoxes,lc&&lc.box&&lc.box.length)){xt=!0,jn=Ui.shift;break}}return lc};ar(()=>lo(ss,ht.iconBox,p.WritingMode.horizontal),()=>{const Rr=ht.verticalTextBox;return Rr&&Pi(Rr),S.allowVerticalPlacement&&!(_n&&_n.box&&_n.box.length)&&it>0&&Rr?lo(Rr,ht.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),_n&&(xt=_n.box,Rt=_n.offscreen,$t=_n.occluded);const as=Ir(!(!_n||!_n.box));if(!xt&&this.prevPlacement){const Rr=this.prevPlacement.variableOffsets[jt];Rr&&(this.variableOffsets[jt]=Rr,this.markUsedJustification(S,Rr.anchor,nt,as))}}else{const Qi=(lo,as)=>{const Rr=S.getSymbolInstanceTextSize(le,nt,this.transform.zoom,Tt),Cs=this.collisionIndex.placeCollisionBox(S,Rr,lo,new p.Point(0,0),me,U,M,ue.predicate);return Cs&&Cs.box&&Cs.box.length&&(this.markUsedOrientation(S,as,nt),this.placedOrientations[jt]=as),Cs};ar(()=>Qi(ss,p.WritingMode.horizontal),()=>{const lo=ht.verticalTextBox;return S.allowVerticalPlacement&&it>0&&lo?(Pi(lo),Qi(lo,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Ir(!!(_n&&_n.box&&_n.box.length))}}if(_i=_n,xt=_i&&_i.box&&_i.box.length>0,Rt=_i&&_i.offscreen,$t=_i&&_i.occluded,nt.useRuntimeCollisionCircles){const Ir=S.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex>=0?nt.centerJustifiedTextSymbolIndex:nt.verticalPlacedTextSymbolIndex),ar=p.evaluateSizeForFeature(S.textSizeData,le,Ir),Qi=D.get("text-padding");ai=this.collisionIndex.placeCollisionCircles(S,me,Ir,S.lineVertexArray,S.glyphOffsetArray,ar,M,R,O,_,Fe,ue.predicate,nt.collisionCircleDiameter*ar/p.ONE_EM,Qi,this.retainedQueryData[S.bucketInstanceId].tileID),xt=me||ai.circles.length>0&&!ai.collisionDetected,Rt=Rt&&ai.offscreen,$t=ai.occluded}if(ht.iconFeatureIndex&&(vr=ht.iconFeatureIndex),ht.iconBox){const Ir=ar=>{Pi(ar);const Qi=Ne&&jn?Jl(jn.x,jn.y,Be,Fe,this.transform.angle):new p.Point(0,0),lo=S.getSymbolInstanceIconSize(oe,this.transform.zoom,nt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,lo,ar,Qi,_e,U,M,ue.predicate)};Rn&&Rn.box&&Rn.box.length&&ht.verticalIconBox?(Dn=Ir(ht.verticalIconBox),Ut=Dn.box.length>0):(Dn=Ir(ht.iconBox),Ut=Dn.box.length>0),Rt=Rt&&Dn.offscreen,Mn=Dn.occluded}const ao=$||0===nt.numHorizontalGlyphVertices&&0===it,zs=te||0===nt.numIconVertices;if(ao||zs?zs?ao||(Ut=Ut&&xt):xt=Ut&&xt:Ut=xt=Ut&&xt,xt&&_i&&_i.box&&this.collisionIndex.insertCollisionBox(_i.box,D.get("text-ignore-placement"),S.bucketInstanceId,Rn&&Rn.box&&gr?gr:rr,ue.ID),Ut&&Dn&&this.collisionIndex.insertCollisionBox(Dn.box,D.get("icon-ignore-placement"),S.bucketInstanceId,vr,ue.ID),ai&&(xt&&this.collisionIndex.insertCollisionCircles(ai.circles,D.get("text-ignore-placement"),S.bucketInstanceId,rr,ue.ID),_)){const Ir=S.bucketInstanceId;let ar=this.collisionCircleArrays[Ir];void 0===ar&&(ar=this.collisionCircleArrays[Ir]=new Yi);for(let Qi=0;Qi<ai.circles.length;Qi+=4)ar.circles.push(ai.circles[Qi+0]),ar.circles.push(ai.circles[Qi+1]),ar.circles.push(ai.circles[Qi+2]),ar.circles.push(ai.collisionDetected?1:0)}const ga="globe"!==S.projection.name;qe=qe&&(ga||!$t),ot=ot&&(ga||!Mn),this.placements[jt]=new ri(xt||qe,Ut||ot,Rt||S.justReloaded),h.add(jt)};if(Ze){const nt=S.getSortedSymbolIndexes(this.transform.angle);for(let Tt=nt.length-1;Tt>=0;--Tt){const ht=nt[Tt];Vt(S.symbolInstances.get(ht),ht,S.collisionArrays[ht])}}else for(let nt=c.symbolInstanceStart;nt<c.symbolInstanceEnd;nt++)Vt(S.symbolInstances.get(nt),nt,S.collisionArrays[nt]);if(_&&S.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[S.bucketInstanceId];p.invert(nt.invProjMatrix,M),nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(c,h,_,x){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:R,crossTileID:O}=_,F=p.getAnchorJustification(h),U=x===p.WritingMode.vertical?R:"left"===F?S:"center"===F?D:"right"===F?M:-1;S>=0&&(c.text.placedSymbolArray.get(S).crossTileID=U>=0&&S!==U?0:O),D>=0&&(c.text.placedSymbolArray.get(D).crossTileID=U>=0&&D!==U?0:O),M>=0&&(c.text.placedSymbolArray.get(M).crossTileID=U>=0&&M!==U?0:O),R>=0&&(c.text.placedSymbolArray.get(R).crossTileID=U>=0&&R!==U?0:O)}markUsedOrientation(c,h,_){const x=h===p.WritingMode.horizontal||h===p.WritingMode.horizontalOnly?h:0,S=h===p.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:D,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:O}=_,F=c.text.placedSymbolArray;D>=0&&(F.get(D).placedOrientation=x),M>=0&&(F.get(M).placedOrientation=x),R>=0&&(F.get(R).placedOrientation=x),O>=0&&(F.get(O).placedOrientation=S)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(c):1,S=h?h.opacities:{},D=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(const R in this.placements){const O=this.placements[R],F=S[R];F?(this.opacities[R]=new da(F,x,O.text,O.icon,null,O.clipped),_=_||O.text!==F.text.placed||O.icon!==F.icon.placed):(this.opacities[R]=new da(null,x,O.text,O.icon,O.skipFade,O.clipped),_=_||O.text||O.icon)}for(const R in S){const O=S[R];if(!this.opacities[R]){const F=new da(O,x,!1,!1);F.isHidden()||(this.opacities[R]=F,_=_||O.text.placed||O.icon.placed)}}for(const R in D)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=D[R]);for(const R in M)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=M[R]);_?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)}updateLayerOpacities(c,h){const _=new Set;for(const x of h){const S=x.getBucket(c);S&&x.latestFeatureIndex&&c.id===S.layerIds[0]&&this.updateBucketOpacities(S,_,x.collisionBoxArray)}}updateBucketOpacities(c,h,_){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const x=c.layers[0].layout,S=!!c.layers[0].dynamicFilter(),D=new da(null,0,!1,!1,!0),M=x.get("text-allow-overlap"),R=x.get("icon-allow-overlap"),O=x.get("text-variable-anchor"),F="map"===x.get("text-rotation-alignment"),U="map"===x.get("text-pitch-alignment"),J="none"!==x.get("icon-text-fit"),ne=new da(null,0,M&&(R||!c.hasIconData()||x.get("icon-optional")),R&&(M||!c.hasTextData()||x.get("text-optional")),!0);!c.collisionArrays&&_&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(_);const le=(ue,$,te)=>{for(let me=0;me<$/4;me++)ue.opacityVertexArray.emplaceBack(te)};let oe=0;for(let ue=0;ue<c.symbolInstances.length;ue++){const $=c.symbolInstances.get(ue),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:me,crossTileID:_e,numIconVertices:Be}=$,Fe=h.has(_e);let Ne=this.opacities[_e];Fe?Ne=D:Ne||(Ne=ne,this.opacities[_e]=Ne),h.add(_e);const Ze=te>0||me>0,qe=Be>0,ot=this.placedOrientations[_e],Vt=ot===p.WritingMode.vertical,nt=ot===p.WritingMode.horizontal||ot===p.WritingMode.horizontalOnly;if(!Ze&&!qe||Ne.isHidden()||oe++,Ze){const Tt=wd(Ne.text);le(c.text,te,Vt?oo:Tt),le(c.text,me,nt?oo:Tt);const ht=Ne.text.isHidden(),{leftJustifiedTextSymbolIndex:jt,centerJustifiedTextSymbolIndex:it,rightJustifiedTextSymbolIndex:xt,verticalPlacedTextSymbolIndex:Ut}=$,Rt=c.text.placedSymbolArray,$t=ht||Vt?1:0;jt>=0&&(Rt.get(jt).hidden=$t),it>=0&&(Rt.get(it).hidden=$t),xt>=0&&(Rt.get(xt).hidden=$t),Ut>=0&&(Rt.get(Ut).hidden=ht||nt?1:0);const Mn=this.variableOffsets[_e];Mn&&this.markUsedJustification(c,Mn.anchor,$,ot);const jn=this.placedOrientations[_e];jn&&(this.markUsedJustification(c,"left",$,jn),this.markUsedOrientation(c,jn,$))}if(qe){const Tt=wd(Ne.icon),{placedIconSymbolIndex:ht,verticalPlacedIconSymbolIndex:jt}=$,it=c.icon.placedSymbolArray,xt=Ne.icon.isHidden()?1:0;ht>=0&&(le(c.icon,Be,Vt?oo:Tt),it.get(ht).hidden=xt),jt>=0&&(le(c.icon,$.numVerticalIconVertices,nt?oo:Tt),it.get(jt).hidden=xt)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Tt=c.collisionArrays[ue];if(Tt){let ht=new p.Point(0,0),jt=!0;if(Tt.textBox||Tt.verticalTextBox){if(O){const xt=this.variableOffsets[_e];xt?(ht=vd(xt.anchor,xt.width,xt.height,xt.textOffset,xt.textScale),F&&ht._rotate(U?this.transform.angle:-this.transform.angle)):jt=!1}S&&(jt=!Ne.clipped),Tt.textBox&&xd(c.textCollisionBox.collisionVertexArray,Ne.text.placed,!jt||Vt,ht.x,ht.y),Tt.verticalTextBox&&xd(c.textCollisionBox.collisionVertexArray,Ne.text.placed,!jt||nt,ht.x,ht.y)}const it=jt&&Boolean(!nt&&Tt.verticalIconBox);Tt.iconBox&&xd(c.iconCollisionBox.collisionVertexArray,Ne.icon.placed,it,J?ht.x:0,J?ht.y:0),Tt.verticalIconBox&&xd(c.iconCollisionBox.collisionVertexArray,Ne.icon.placed,!it,J?ht.x:0,J?ht.y:0)}}}if(c.fullyClipped=0===oe,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const ue=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=ue.invProjMatrix,c.placementViewportMatrix=ue.viewportMatrix,c.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>c}setStale(){this.stale=!0}}function xd(g,c,h,_,x){g.emplaceBack(c?1:0,h?1:0,_||0,x||0),g.emplaceBack(c?1:0,h?1:0,_||0,x||0),g.emplaceBack(c?1:0,h?1:0,_||0,x||0),g.emplaceBack(c?1:0,h?1:0,_||0,x||0)}const Ps=Math.pow(2,25),mo=Math.pow(2,24),Ma=Math.pow(2,17),Gm=Math.pow(2,16),Gs=Math.pow(2,9),Aa=Math.pow(2,8),f_=Math.pow(2,1);function wd(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const c=g.placed?1:0,h=Math.floor(127*g.opacity);return h*Ps+c*mo+h*Ma+c*Gm+h*Gs+c*Aa+h*f_+c}const oo=0;class Sd{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,h,_,x,S){const D=this._bucketParts;for(;this._currentTileIndex<c.length;)if(h.getBucketParts(D,x,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((M,R)=>M.sortKey-R.sortKey));this._currentPartIndex<D.length;){const M=D[this._currentPartIndex];if(h.placeLayerBucketPart(M,this._seenCrossTileIDs,_,0===M.symbolInstanceStart),this._currentPartIndex++,S())return!0}return!1}}class Wm{constructor(c,h,_,x,S,D,M,R){this.placement=new is(c,S,D,M,R),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(c,h,_){const x=p.exported.now(),S=()=>{const D=p.exported.now()-x;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=h[c[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if("symbol"===D.type&&(!D.minzoom||D.minzoom<=M)&&(!D.maxzoom||D.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Sd(D)),this._inProgressLayer.continuePlacement(_[D.source],this.placement,this._showCollisionBoxes,D,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const Do=512/p.EXTENT/2;class di{constructor(c,h,_){this.tileID=c,this.bucketInstanceId=_,this.index=new p.KDBush(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=c.canonical.x*p.EXTENT,S=c.canonical.y*p.EXTENT;for(let D=0;D<h.length;D++){const{key:M,crossTileID:R,tileAnchorX:O,tileAnchorY:F}=h.get(D),U=Math.floor((x+O)*Do),J=Math.floor((S+F)*Do);this.index.add(U,J),this.keys.push(M),this.crossTileIDs.push(R)}this.index.finish()}findMatches(c,h,_){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),S=Do/Math.pow(2,h.canonical.z-this.tileID.canonical.z),D=h.canonical.x*p.EXTENT,M=h.canonical.y*p.EXTENT;for(let R=0;R<c.length;R++){const O=c.get(R);if(O.crossTileID)continue;const{key:F,tileAnchorX:U,tileAnchorY:J}=O,ne=Math.floor((D+U)*S),le=Math.floor((M+J)*S),oe=this.index.range(ne-x,le-x,ne+x,le+x);for(const ue of oe){const $=this.crossTileIDs[ue];if(this.keys[ue]===F&&!_.has($)){_.add($),O.crossTileID=$;break}}}}}class Xm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const h=Math.round((c-this.lng)/360);if(0!==h)for(const _ in this.indexes){const x=this.indexes[_],S={};for(const D in x){const M=x[D];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),S[M.tileID.key]=M}this.indexes[_]=S}this.lng=c}addBucket(c,h,_){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let S=0;S<h.symbolInstances.length;S++)h.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const x=this.usedCrossTileIDs[c.overscaledZ];for(const S in this.indexes){const D=this.indexes[S];if(Number(S)>c.overscaledZ)for(const M in D){const R=D[M];R.tileID.isChildOf(c)&&R.findMatches(h.symbolInstances,c,x)}else{const M=D[c.scaledTo(Number(S)).key];M&&M.findMatches(h.symbolInstances,c,x)}}for(let S=0;S<h.symbolInstances.length;S++){const D=h.symbolInstances.get(S);D.crossTileID||(D.crossTileID=_.generate(),x.add(D.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new di(c,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(c,h){for(const _ of h.crossTileIDs)this.usedCrossTileIDs[c].delete(_)}removeStaleBuckets(c){let h=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const S in x)c[x[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[S]),delete x[S],h=!0)}return h}}class ec{constructor(){this.layerIndexes={},this.crossTileIDs=new Xm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,h,_,x){let S=this.layerIndexes[c.id];void 0===S&&(S=this.layerIndexes[c.id]=new Zm);let D=!1;const M={};"globe"!==x.name&&S.handleWrapJump(_);for(const R of h){const O=R.getBucket(c);O&&c.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(R.tileID,O,this.crossTileIDs)&&(D=!0),M[O.bucketInstanceId]=!0)}return S.removeStaleBuckets(M)&&(D=!0),D}pruneUnusedLayers(c){const h={};c.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Qt=(g,c)=>p.emitValidationErrors(g,c&&c.filter(h=>"source.canvas"!==h.identifier)),rf=p.pick(Wn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Sn=p.pick(Wn,["setCenter","setZoom","setBearing","setPitch"]),vu={version:8,layers:[],sources:{}},xu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ka extends p.Evented{constructor(c,h={}){super(),this.map=c,this.dispatcher=new Lt(_u(),this),this.imageManager=new ut,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(c._requestManager,h.localFontFamily?p.LocalGlyphMode.all:h.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new ec,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const _=this;this._rtlTextPluginCallback=ka.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(S,D)=>{if(p.triggerPluginCompletionEvent(S),D&&D.every(M=>M))for(const M in _._sourceCaches){const R=_._sourceCaches[M],O=R.getSource().type;"vector"!==O&&"geojson"!==O||R.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const S=this.getSource(x.sourceId);if(S&&S.vectorLayerIds)for(const D in this._layers){const M=this._layers[D];M.source===S.id&&this._validateLayer(M)}})}loadURL(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!p.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,h.accessToken);const x=this.map._requestManager.transformRequest(c,p.ResourceType.Style);this._request=p.getJSON(x,(S,D)=>{this._request=null,S?this.fire(new p.ErrorEvent(S)):D&&this._load(D,_)})}loadJSON(c,h={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(c,!1!==h.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(vu,!1)}_updateLayerCount(c,h){const _=h?1:-1;c.is3D()&&(this._num3DLayers+=_),"circle"===c.type&&(this._numCircleLayers+=_),"symbol"===c.type&&(this._numSymbolLayers+=_)}_load(c,h){if(h&&Qt(this,p.validateStyle(c)))return;this._loaded=!0,this.stylesheet=p.clone$1(c),this._updateMapProjection();for(const x in c.sources)this.addSource(x,c.sources[x],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const _=$m(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(const x of _){const S=p.createStyleLayer(x);S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new be(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(h,_,x){let S,D,M;const R=p.exported.devicePixelRatio>1?"@2x":"";let O=p.getJSON(_.transformRequest(_.normalizeSpriteURL(h,R,".json"),p.ResourceType.SpriteJSON),(J,ne)=>{O=null,M||(M=J,S=ne,U())}),F=p.getImage(_.transformRequest(_.normalizeSpriteURL(h,R,".png"),p.ResourceType.SpriteImage),(J,ne)=>{F=null,M||(M=J,D=ne,U())});function U(){if(M)x(M);else if(S&&D){const J=p.exported.getImageData(D),ne={};for(const le in S){const{width:oe,height:ue,x:$,y:te,sdf:me,pixelRatio:_e,stretchX:Be,stretchY:Fe,content:Ne}=S[le],Ze=new p.RGBAImage({width:oe,height:ue});p.RGBAImage.copy(J,Ze,{x:$,y:te},{x:0,y:0},{width:oe,height:ue}),ne[le]={data:Ze,pixelRatio:_e,sdf:me,stretchX:Be,stretchY:Fe,content:Ne}}x(null,ne)}}return{cancel(){O&&(O.cancel(),O=null),F&&(F.cancel(),F=null)}}}(c,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new p.ErrorEvent(h));else if(_)for(const x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(c){const h=this.getSource(c.source);if(!h)return;const _=c.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const h=[];for(const _ of c){const x=this._layers[_];"custom"!==x.type&&h.push(x.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():xu[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const h=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(x.length||S.length)&&this._updateWorkerLayers(x,S);for(const D in this._updatedSources){const M=this._updatedSources[D];"reload"===M?this._reloadSource(D):"clear"===M&&this._clearSource(D)}this._updateTilesForChangedImages();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const _={};for(const x in this._sourceCaches){const S=this._sourceCaches[x];_[x]=S.used,S.used=!1}for(const x of this._order){const S=this._layers[x];if(S.recalculate(c,this._availableImages),!S.isHidden(c.zoom)){const M=this._getLayerSourceCache(S);M&&(M.used=!0)}const D=this.map.painter;if(D){const M=S.getProgramIds();if(!M)continue;const R=S.getProgramConfiguration(c.zoom);for(const O of M)D.useProgram(O,R)}}for(const x in _){const S=this._sourceCaches[x];_[x]!==S.used&&S.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),Qt(this,p.validateStyle(c)))return!1;(c=p.clone$1(c)).layers=$m(c.layers);const h=function(x,S){if(!x)return[{command:Wn.setStyle,args:[S]}];let D=[];try{if(!ie(x.version,S.version))return[{command:Wn.setStyle,args:[S]}];ie(x.center,S.center)||D.push({command:Wn.setCenter,args:[S.center]}),ie(x.zoom,S.zoom)||D.push({command:Wn.setZoom,args:[S.zoom]}),ie(x.bearing,S.bearing)||D.push({command:Wn.setBearing,args:[S.bearing]}),ie(x.pitch,S.pitch)||D.push({command:Wn.setPitch,args:[S.pitch]}),ie(x.sprite,S.sprite)||D.push({command:Wn.setSprite,args:[S.sprite]}),ie(x.glyphs,S.glyphs)||D.push({command:Wn.setGlyphs,args:[S.glyphs]}),ie(x.transition,S.transition)||D.push({command:Wn.setTransition,args:[S.transition]}),ie(x.light,S.light)||D.push({command:Wn.setLight,args:[S.light]}),ie(x.fog,S.fog)||D.push({command:Wn.setFog,args:[S.fog]}),ie(x.projection,S.projection)||D.push({command:Wn.setProjection,args:[S.projection]});const M={},R=[];!function(U,J,ne,le){let oe;for(oe in J=J||{},U=U||{})U.hasOwnProperty(oe)&&(J.hasOwnProperty(oe)||bs(oe,ne,le));for(oe in J){if(!J.hasOwnProperty(oe))continue;const ue=J[oe];U.hasOwnProperty(oe)?ie(U[oe],ue)||("geojson"===U[oe].type&&"geojson"===ue.type&&Nh(U,J,oe)?ne.push({command:Wn.setGeoJSONSourceData,args:[oe,ue.data]}):qm(oe,J,ne,le)):Ql(oe,J,ne)}}(x.sources,S.sources,R,M);const O=[];x.layers&&x.layers.forEach(U=>{U.source&&M[U.source]?D.push({command:Wn.removeLayer,args:[U.id]}):O.push(U)});let F=x.terrain;F&&M[F.source]&&(D.push({command:Wn.setTerrain,args:[void 0]}),F=void 0),D=D.concat(R),ie(F,S.terrain)||D.push({command:Wn.setTerrain,args:[S.terrain]}),function(U,J,ne){J=J||[];const le=(U=U||[]).map(Ia),oe=J.map(Ia),ue=U.reduce(Bh,{}),$=J.reduce(Bh,{}),te=le.slice(),me=Object.create(null);let _e,Be,Fe,Ne,Ze,qe,ot;for(_e=0,Be=0;_e<le.length;_e++)Fe=le[_e],$.hasOwnProperty(Fe)?Be++:(ne.push({command:Wn.removeLayer,args:[Fe]}),te.splice(te.indexOf(Fe,Be),1));for(_e=0,Be=0;_e<oe.length;_e++)Fe=oe[oe.length-1-_e],te[te.length-1-_e]!==Fe&&(ue.hasOwnProperty(Fe)?(ne.push({command:Wn.removeLayer,args:[Fe]}),te.splice(te.lastIndexOf(Fe,te.length-Be),1)):Be++,qe=te[te.length-_e],ne.push({command:Wn.addLayer,args:[$[Fe],qe]}),te.splice(te.length-_e,0,Fe),me[Fe]=!0);for(_e=0;_e<oe.length;_e++)if(Fe=oe[_e],Ne=ue[Fe],Ze=$[Fe],!me[Fe]&&!ie(Ne,Ze))if(ie(Ne.source,Ze.source)&&ie(Ne["source-layer"],Ze["source-layer"])&&ie(Ne.type,Ze.type)){for(ot in Da(Ne.layout,Ze.layout,ne,Fe,null,Wn.setLayoutProperty),Da(Ne.paint,Ze.paint,ne,Fe,null,Wn.setPaintProperty),ie(Ne.filter,Ze.filter)||ne.push({command:Wn.setFilter,args:[Fe,Ze.filter]}),ie(Ne.minzoom,Ze.minzoom)&&ie(Ne.maxzoom,Ze.maxzoom)||ne.push({command:Wn.setLayerZoomRange,args:[Fe,Ze.minzoom,Ze.maxzoom]}),Ne)Ne.hasOwnProperty(ot)&&"layout"!==ot&&"paint"!==ot&&"filter"!==ot&&"metadata"!==ot&&"minzoom"!==ot&&"maxzoom"!==ot&&(0===ot.indexOf("paint.")?Da(Ne[ot],Ze[ot],ne,Fe,ot.slice(6),Wn.setPaintProperty):ie(Ne[ot],Ze[ot])||ne.push({command:Wn.setLayerProperty,args:[Fe,ot,Ze[ot]]}));for(ot in Ze)Ze.hasOwnProperty(ot)&&!Ne.hasOwnProperty(ot)&&"layout"!==ot&&"paint"!==ot&&"filter"!==ot&&"metadata"!==ot&&"minzoom"!==ot&&"maxzoom"!==ot&&(0===ot.indexOf("paint.")?Da(Ne[ot],Ze[ot],ne,Fe,ot.slice(6),Wn.setPaintProperty):ie(Ne[ot],Ze[ot])||ne.push({command:Wn.setLayerProperty,args:[Fe,ot,Ze[ot]]}))}else ne.push({command:Wn.removeLayer,args:[Fe]}),qe=te[te.lastIndexOf(Fe)+1],ne.push({command:Wn.addLayer,args:[Ze,qe]})}(O,S.layers,D)}catch(M){console.warn("Unable to compute style diff:",M),D=[{command:Wn.setStyle,args:[S]}]}return D}(this.serialize(),c).filter(x=>!(x.command in Sn));if(0===h.length)return!1;const _=h.filter(x=>!(x.command in rf));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return h.forEach(x=>{"setTransition"!==x.command&&"setProjection"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,h){return this.getImage(c)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,h),this._afterImageUpdated(c),this)}updateImage(c,h){this.imageManager.updateImage(c,h)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,h,_={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateSource,`sources.${c}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=gi(c,h,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:x.serialize(),sourceId:c}));const S=D=>{const M=(D?"symbol:":"other:")+c,R=this._sourceCaches[M]=new p.SourceCache(M,x,D);(D?this._symbolSourceCaches:this._otherSourceCaches)[c]=R,R.style=this,R.onAdd(this.map)};S(!1),"vector"!==h.type&&"geojson"!==h.type||S(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const h=this.getSource(c);if(!h)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(c);for(const x of _)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,h){this._checkLoaded(),this.getSource(c).setData(h),this._changed=!0}getSource(c){const h=this._getSourceCache(c);return h&&h.getSource()}_getSources(){const c=[];for(const h in this._otherSourceCaches){const _=this._getSourceCache(h);_&&c.push(_.getSource())}return c}addLayer(c,h,_={}){this._checkLoaded();const x=c.id;if(this.getLayer(x))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let S;if("custom"===c.type){if(Qt(this,p.validateCustomStyleLayer(c)))return;S=p.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(x,c.source),c=p.clone$1(c),c=p.extend(c,{source:x})),this._validate(p.validateLayer,`layers.${x}`,c,{arrayIndex:-1},_))return;S=p.createStyleLayer(c),this._validateLayer(S),S.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[S.id]=S.serialize(),this._updateLayerCount(S,!0)}const D=h?this._order.indexOf(h):this._order.length;if(h&&-1===D)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(D,0,x),this._layerOrderChanged=!0,this._layers[x]=S;const M=this._getLayerSourceCache(S);if(this._removedLayers[x]&&S.source&&M&&"custom"!==S.type){const R=this._removedLayers[x];delete this._removedLayers[x],R.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",M.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,h){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===h)return;const _=this._order.indexOf(c);this._order.splice(_,1);const x=h?this._order.indexOf(h):this._order.length;h&&-1===x?this.fire(new p.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(x,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const h=this._layers[c];if(!h)return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(c);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=h,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const h in this._layers)if(this._layers[h].type===c)return!0;return!1}setLayerZoomRange(c,h,_){this._checkLoaded();const x=this.getLayer(c);x?x.minzoom===h&&x.maxzoom===_||(null!=h&&(x.minzoom=h),null!=_&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,h,_={}){this._checkLoaded();const x=this.getLayer(c);if(x){if(!ie(x.filter,h))return null==h?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(p.validateFilter,`layers.${x.id}.filter`,h,{layerType:x.type},_)||(x.filter=p.clone$1(h),this._updateLayer(x)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const h=this.getLayer(c);return h&&p.clone$1(h.filter)}setLayoutProperty(c,h,_,x={}){this._checkLoaded();const S=this.getLayer(c);S?ie(S.getLayoutProperty(h),_)||(S.setLayoutProperty(h,_,x),this._updateLayer(S)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,h){const _=this.getLayer(c);if(_)return _.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,h,_,x={}){this._checkLoaded();const S=this.getLayer(c);S?ie(S.getPaintProperty(h),_)||(S.setPaintProperty(h,_,x)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,h){const _=this.getLayer(c);return _&&_.getPaintProperty(h)}setFeatureState(c,h){this._checkLoaded();const _=c.source,x=c.sourceLayer,S=this.getSource(_);if(!S)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const D=S.type;if("geojson"===D&&x)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===D&&!x)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(_);for(const R of M)R.setFeatureState(x,c.id,h)}removeFeatureState(c,h){this._checkLoaded();const _=c.source,x=this.getSource(_);if(!x)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const S=x.type,D="vector"===S?c.sourceLayer:void 0;if("vector"===S&&!D)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(_);for(const R of M)R.removeFeatureState(D,c.id,h)}getFeatureState(c){this._checkLoaded();const h=c.source,_=c.sourceLayer,x=this.getSource(h);if(x){if("vector"!==x.type||_)return void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,c.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();c[_.id]||(c[_.id]=_.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(c){this._updatedLayers[c.id]=!0;const h=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[c.source]="reload",h.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const h=D=>"fill-extrusion"===this._layers[D].type,_={},x=[];for(let D=this._order.length-1;D>=0;D--){const M=this._order[D];if(h(M)){_[M]=D;for(const R of c){const O=R[M];if(O)for(const F of O)x.push(F)}}}x.sort((D,M)=>M.intersectionZ-D.intersectionZ);const S=[];for(let D=this._order.length-1;D>=0;D--){const M=this._order[D];if(h(M))for(let R=x.length-1;R>=0;R--){const O=x[R].feature;if(_[O.layer.id]<D)break;S.push(O),x.pop()}else for(const R of c){const O=R[M];if(O)for(const F of O)S.push(F.feature)}}return S}queryRenderedFeatures(c,h,_){h&&h.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of h.layers){const O=this._layers[R];if(!O)return this.fire(new p.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];x[O.source]=!0}}const S=[];h.availableImages=this._availableImages;const D=h&&h.layers?h.layers.some(R=>{const O=this.getLayer(R);return O&&O.is3D()}):this.has3DLayers(),M=qi.createFromScreenPoints(c,_);for(const R in this._sourceCaches){const O=this._sourceCaches[R].getSource().id;h.layers&&!x[O]||S.push(Bi(this._sourceCaches[R],this._layers,this._serializedLayers,M,h,_,D,!!this.map._showQueryGeometry))}return this.placement&&S.push(function(R,O,F,U,J,ne,le){const oe={},ue=ne.queryRenderedSymbols(U),$=[];for(const te of Object.keys(ue).map(Number))$.push(le[te]);$.sort(ns);for(const te of $){const me=te.featureIndex.lookupSymbolFeatures(ue[te.bucketInstanceId],O,te.bucketIndex,te.sourceLayerIndex,J.filter,J.layers,J.availableImages,R);for(const _e in me){const Be=oe[_e]=oe[_e]||[],Fe=me[_e];Fe.sort((Ne,Ze)=>{const qe=te.featureSortOrder;if(qe){const ot=qe.indexOf(Ne.featureIndex);return qe.indexOf(Ze.featureIndex)-ot}return Ze.featureIndex-Ne.featureIndex});for(const Ne of Fe)Be.push(Ne)}}for(const te in oe)oe[te].forEach(me=>{const _e=me.feature,Be=F(R[te]);if(!Be)return;const Fe=Be.getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=Fe});return oe}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(c,h){h&&h.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(c);let x=[];for(const S of _)x=x.concat(po(S,h));return x}addSourceType(c,h,_){return ka.getSourceType(c)?_(new Error(`A source type called "${c}" already exists.`)):(ka.setSourceType(c,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(c,h={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const D in c)if(!ie(c[D],_[D])){x=!0;break}if(!x)return;const S=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,h),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,h=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=c;if(1===h){if("object"==typeof _.source){const x="terrain-dem-src";this.addSource(x,_.source),_=p.clone$1(_),_=p.extend(_,{source:x})}if(this._validate(p.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,h)}else{const x=this.terrain,S=x.get();for(const D of Object.keys(p.spec.terrain))!_.hasOwnProperty(D)&&p.spec.terrain[D].default&&(_[D]=p.spec.terrain[D].default);for(const D in _)if(!ie(_[D],S[D])){x.set(_),this.stylesheet.terrain=_;const M=this._setTransitionParameters({duration:0});x.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const h=this.fog=new oi(c,this.map.transform);this.stylesheet.fog=c;const _=this._setTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();0===Object.keys(c).length&&h.set(c);for(const x in c)if(!ie(c[x],_[x])){h.set(c),this.stylesheet.fog=c;const S=this._setTransitionParameters({duration:0});h.updateTransitions(S);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:p.exported.now(),transition:p.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...h)}_createTerrain(c,h){const _=this.terrain=new gt(c,h);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const h=this._layers[c];"symbol"===h.type&&this._updateLayer(h)}}_validate(c,h,_,x,S={}){return(!S||!1!==S.validate)&&Qt(this,c.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:_,styleSpec:p.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.clearTiles()}_reloadSource(c){const h=this._getSourceCaches(c);for(const _ of h)_.resume(),_.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const h in this._sourceCaches)this._sourceCaches[h].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const h=this._sourceCaches[c];h.resume(),h.reload()}}_updatePlacement(c,h,_,x,S=!1){let D=!1,M=!1;const R={};for(const O of this._order){const F=this._layers[O];if("symbol"!==F.type)continue;if(!R[F.source]){const J=this._getLayerSourceCache(F);if(!J)continue;R[F.source]=J.getRenderableIds(!0).map(ne=>J.getTileByID(ne)).sort((ne,le)=>le.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(le.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(F,R[F.source],c.center.lng,c.projection);D=D||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),S=S||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),c.zoom))&&(this.pauseablePlacement=new Wm(c,this._order,S,h,_,x,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),M=!0),D&&this.pauseablePlacement.placement.setStale()),M||D)for(const O of this._order){const F=this._layers[O];"symbol"===F.type&&this.placement.updateLayerOpacities(F,R[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const x=S=>{S&&S.setDependencies(h.tileID.key,h.type,h.icons)};x(this._otherSourceCaches[h.source]),x(this._symbolSourceCaches[h.source])}getGlyphs(c,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(c,h,_){return p.makeRequest(h,_)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const h=[];return this._otherSourceCaches[c]&&h.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&h.push(this._symbolSourceCaches[c]),h}_isSourceCacheLoaded(c){const h=this._getSourceCaches(c);return 0===h.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ka.getSourceType=function(g){return ni[g]},ka.setSourceType=function(g,c){ni[g]=c},ka.registerForPluginStateChange=p.registerForPluginStateChange;var sf="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Nc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ol="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",tc="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ra="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Cd={},wu={};const $n=[];Td(sf,$n),Td(ol,$n),Td(tc,$n),Td(Ra,$n),Cd=Ai("",ol),wu=Ai(Ra,tc);const zh=Ai("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Vh=sf,Ls="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var jh={background:Ai("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Ai("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Ai("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Ai("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ai("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Ai("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ai("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ai("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Ai("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Ai("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Ai("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Ai("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Ai("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Ai("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Ai("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ai("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Ai("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Ai("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Ai("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Ai("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Ai("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Ai("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Ai("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Ai("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ai("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Nc),skyboxGradient:Ai("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Nc),skyboxCapture:Ai("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ai("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Ai("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Td(g,c){const h=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of h)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=_.split(" ");for(const S of x)c.includes(S)||c.push(S)}}function Ai(g,c){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},S=[...$n];return Td(g,S),Td(c,S),{fragmentSource:g=g.replace(h,(D,M,R,O,F)=>(x[F]=!0,"define"===M?`\n#ifndef HAS_UNIFORM_u_${F}\nvarying ${R} ${O} ${F};\n#else\nuniform ${R} ${O} u_${F};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${F}\n    ${R} ${O} ${F} = u_${F};\n#endif\n`)),vertexSource:c=c.replace(h,(D,M,R,O,F)=>{const U="float"===O?"vec2":"vec4",J=F.match(/color/)?"color":U;return x[F]?"define"===M?`\n#ifndef HAS_UNIFORM_u_${F}\nuniform lowp float u_${F}_t;\nattribute ${R} ${U} a_${F};\nvarying ${R} ${O} ${F};\n#else\nuniform ${R} ${O} u_${F};\n#endif\n`:"vec4"===J?`\n#ifndef HAS_UNIFORM_u_${F}\n    ${F} = a_${F};\n#else\n    ${R} ${O} ${F} = u_${F};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${F}\n    ${F} = unpack_mix_${J}(a_${F}, u_${F}_t);\n#else\n    ${R} ${O} ${F} = u_${F};\n#endif\n`:"define"===M?`\n#ifndef HAS_UNIFORM_u_${F}\nuniform lowp float u_${F}_t;\nattribute ${R} ${U} a_${F};\n#else\nuniform ${R} ${O} u_${F};\n#endif\n`:"vec4"===J?`\n#ifndef HAS_UNIFORM_u_${F}\n    ${R} ${O} ${F} = a_${F};\n#else\n    ${R} ${O} ${F} = u_${F};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${F}\n    ${R} ${O} ${F} = unpack_mix_${J}(a_${F}, u_${F}_t);\n#else\n    ${R} ${O} ${F} = u_${F};\n#endif\n`}),staticAttributes:_,usedDefines:S}}class Pa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,h,_,x,S,D,M){this.context=c;let R=this.boundPaintVertexBuffers.length!==x.length;for(let F=0;!R&&F<x.length;F++)this.boundPaintVertexBuffers[F]!==x[F]&&(R=!0);let O=this.boundDynamicVertexBuffers.length!==M.length;for(let F=0;!O&&F<M.length;F++)this.boundDynamicVertexBuffers[F]!==M[F]&&(O=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||R||O||this.boundIndexBuffer!==S||this.boundVertexOffset!==D)this.freshBind(h,_,x,S,D,M);else{c.bindVertexArrayOES.set(this.vao);for(const F of M)F&&F.bind();S&&S.dynamicDraw&&S.bind()}}freshBind(c,h,_,x,S,D){let M;const R=c.numAttributes,O=this.context,F=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=D;else{M=O.currentNumAttributes||0;for(let U=R;U<M;U++)F.disableVertexAttribArray(U)}h.enableAttributes(F,c),h.bind(),h.setVertexAttribPointers(F,c,S);for(const U of _)U.enableAttributes(F,c),U.bind(),U.setVertexAttribPointers(F,c,S);for(const U of D)U&&(U.enableAttributes(F,c),U.bind(),U.setVertexAttribPointers(F,c,S));x&&x.bind(),O.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ym(g,c){const h=Math.pow(2,c.canonical.z),_=c.canonical.y;return[new p.MercatorCoordinate(0,_/h).toLngLat().lat,new p.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function m_(g,c,h,_,x,S,D){const M=g.context,R=M.gl,O=h.fbo;if(!O)return;g.prepareDrawTile();const F=g.useProgram("hillshade");M.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,O.colorAttachment.get());const U=((oe,ue,$,te)=>{const me=$.paint.get("hillshade-shadow-color"),_e=$.paint.get("hillshade-highlight-color"),Be=$.paint.get("hillshade-accent-color");let Fe=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===$.paint.get("hillshade-illumination-anchor")&&(Fe-=oe.transform.angle);const Ne=!oe.options.moving;return{u_matrix:te||oe.transform.calculateProjMatrix(ue.tileID.toUnwrapped(),Ne),u_image:0,u_latrange:Ym(0,ue.tileID),u_light:[$.paint.get("hillshade-exaggeration"),Fe],u_shadow:me,u_highlight:_e,u_accent:Be}})(g,h,_,g.terrain?c.projMatrix:null);g.prepareDrawProgram(M,F,c.toUnwrapped());const{tileBoundsBuffer:J,tileBoundsIndexBuffer:ne,tileBoundsSegments:le}=g.getTileBoundsBuffers(h);F.draw(M,R.TRIANGLES,x,S,D,p.CullFaceMode.disabled,U,_.id,J,ne,le)}function Ws(g,c,h){if(!c.needsDEMTextureUpload)return;const _=g.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(h.stride);const S=h.getPixels();c.demTexture?c.demTexture.update(S,{premultiply:!1}):c.demTexture=new p.Texture(_,S,x.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function Lr(g,c,h,_,x,S){const D=g.context,M=D.gl;if(!c.dem)return;const R=c.dem;if(D.activeTexture.set(M.TEXTURE1),Ws(g,c,R),!c.demTexture)return;c.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const O=R.dim;D.activeTexture.set(M.TEXTURE0);let F=c.fbo;if(!F){const le=new p.Texture(D,{width:O,height:O,data:null},M.RGBA);le.bind(M.LINEAR,M.CLAMP_TO_EDGE),F=c.fbo=D.createFramebuffer(O,O,!0),F.colorAttachment.set(le.texture)}D.bindFramebuffer.set(F.framebuffer),D.viewport.set([0,0,O,O]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:J,tileBoundsSegments:ne}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(D,M.TRIANGLES,_,x,S,p.CullFaceMode.disabled,((le,oe)=>{const ue=oe.stride,$=p.create();return p.ortho($,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate($,$,[0,-p.EXTENT,0]),{u_matrix:$,u_image:1,u_dimension:[ue,ue],u_zoom:le.overscaledZ,u_unpack:oe.unpackVector}})(c.tileID,R),h.id,U,J,ne),c.needsHillshadePrepare=!1}const Km=g=>({u_matrix:new p.UniformMatrix4f(g),u_image0:new p.Uniform1i(g),u_skirt_height:new p.Uniform1f(g)}),Ed=(g,c)=>({u_matrix:g,u_image0:0,u_skirt_height:c}),Dl=(g,c,h,_,x,S,D,M,R,O,F,U,J,ne,le)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:x,u_merc_center:S,u_image0:0,u_frustum_tl:D,u_frustum_tr:M,u_frustum_br:R,u_frustum_bl:O,u_globe_pos:F,u_globe_radius:U,u_viewport:J,u_grid_matrix:le?Float32Array.from(le):new Float32Array(9),u_skirt_height:ne});function Gi(g,c){return null!=g&&null!=c&&!(!g.hasData()||!c.hasData())&&null!=g.demTexture&&null!=c.demTexture&&g.tileID.key!==c.tileID.key}const ha=new class{constructor(){this.operations={}}newMorphing(g,c,h,_,x){if(g in this.operations){const S=this.operations[g];S.to.tileID.key!==h.tileID.key&&(S.queued=h)}else this.operations[g]={startTime:_,phase:0,duration:x,from:c,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(const c in this.operations){const h=this.operations[c];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Il={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Su(g){return 6*Math.pow(1.5,22-g)}function af(g,c){const h=1<<g.z;return!c&&(0===g.x||g.x===h-1)||0===g.y||g.y===h-1}const Xs=g=>({u_matrix:g});function Bc(g,c,h,_,x){if(x>0){const S=p.exported.now(),D=(S-g.timeAdded)/x,M=c?(S-c.timeAdded)/x:-1,R=h.getSource(),O=_.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),F=!c||Math.abs(c.tileID.overscaledZ-O)>Math.abs(g.tileID.overscaledZ-O),U=F&&g.refreshedUponExpiration?1:p.clamp(F?D:1-M,0,1);return g.refreshedUponExpiration&&D>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class lf extends p.SourceCache{constructor(c){const h={type:"raster-dem",maxzoom:c.transform.maxZoom},_=new Lt(_u(),null),x=gi("mock-dem",h,_,c.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,h){c.state="loaded",h(null)}}class mn extends p.SourceCache{constructor(c){const h=gi("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new Lt(_u(),null),c.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,h,_){if(c.freezeTileCoverage)return;this.transform=c;const x=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,D)=>{if(S[D.key]="",!this._tiles[D.key]){const M=new p.Tile(D,this._source.tileSize*D.overscaleFactor(),c.tileZoom);M.state="loaded",this._tiles[D.key]=M}return S},{});for(const S in this._tiles)S in x||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(c){const h=this.proxyCachedFBO[c];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Uh extends p.OverscaledTileID{constructor(c,h,_){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class Hh extends p.Elevation{constructor(c,h){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,S]=function(R){const O=new p.StructArrayLayout2i4,F=new p.StructArrayLayout3ui6,U=131;O.reserve(17161),F.reserve(33800);const J=p.EXTENT/128,ne=p.EXTENT+J/2,le=ne+J;for(let ue=-J;ue<le;ue+=J)for(let $=-J;$<le;$+=J){const te=$<0||$>ne||ue<0||ue>ne?24575:0,me=p.clamp(Math.round($),0,p.EXTENT),_e=p.clamp(Math.round(ue),0,p.EXTENT);O.emplaceBack(me+te,_e)}const oe=(ue,$)=>{const te=$*U+ue;F.emplaceBack(te+1,te,te+U),F.emplaceBack(te+U,te+U+1,te+1)};for(let ue=1;ue<129;ue++)for(let $=1;$<129;$++)oe($,ue);return[0,129].forEach(ue=>{for(let $=0;$<130;$++)oe($,ue),oe(ue,$)}),[O,F,32768]}(),D=c.context;this.gridBuffer=D.createVertexBuffer(_,p.posAttributes.members),this.gridIndexBuffer=D.createIndexBuffer(x),this.gridSegments=p.SegmentVector.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,_.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new mn(h.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const M=D.gl;this._overlapStencilMode=new p.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new lf(h.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,h,_){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const x=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const S=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const D=this.getScaledDemTileSize();this.sourceCache.update(h,D,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,S(),this._initializing=!0),S(),h.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=h.getIds().map(R=>{const O=h.getTileByID(R).tileID;return O.projMatrix=_.calculateProjMatrix(O.toUnwrapped()),O});(function(R,O){const F=O.transform.pointCoordinate(O.transform.getCameraPoint()),U=new p.Point(F.x,F.y);R.sort((J,ne)=>{if(ne.overscaledZ-J.overscaledZ)return ne.overscaledZ-J.overscaledZ;const le=new p.Point(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),oe=new p.Point(ne.canonical.x+(1<<ne.canonical.z)*ne.wrap,ne.canonical.y),ue=U.mult(1<<J.canonical.z);return ue.x-=.5,ue.y-=.5,ue.distSqr(le)-ue.distSqr(oe)})})(x,this.painter),this._previousZoom=_.zoom;const S=this.proxyToSource||{};this.proxyToSource={},x.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const D=this._style._sourceCaches;for(const R in D){const O=D[R];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,c[R],S),O.usedForTerrain))continue;const F=c[R];O.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[h.id]=x.map(R=>new Uh(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const M={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const O=this.terrainTileForTile[R.key];if(!O)continue;const F=O.tileID.key;F in M||(this._visibleDemTiles.push(O),M[F]=F)}}_assignTerrainTiles(c){this._initializing||c.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const c=this.painter.context,h=c.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],S=x.dem;!S||x.demTexture&&!x.needsDEMTextureUpload||(c.activeTexture.set(h.TEXTURE1),Ws(this.painter,x,S))}}_prepareDemTileUniforms(c,h,_,x){if(!h||null==h.demTexture)return!1;const S=c.tileID.canonical,D=Math.pow(2,h.tileID.canonical.z-S.z),M=x||"";return _[`u_dem_tl${M}`]=[S.x*D%1,S.y*D%1],_[`u_dem_scale${M}`]=D,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,h=c.gl;if(!this._emptyDepthBufferTexture){const _=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(c,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const h=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const S=x.dem.tree.minimums[0];return S>0&&c++,_+S},0);return c?h/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,h=c.gl;c.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),x=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(x,{premultiply:!1}):S=this._emptyDEMTexture=new p.Texture(c,x,h.RGBA,{premultiply:!1}),S}setupElevationDraw(c,h,_){const x=this.painter.context,S=x.gl,D=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var M;D.u_dem_size=this.sourceCache.getSource().tileSize,D.u_exaggeration=this.exaggeration();let R=null,O=null,F=1;if(_&&_.morphing&&this._useVertexMorphing){const U=_.morphing.srcDemTile,J=_.morphing.dstDemTile;F=_.morphing.phase,U&&J&&(this._prepareDemTileUniforms(c,U,D,"_prev")&&(O=U),this._prepareDemTileUniforms(c,J,D)&&(R=J))}if(O&&R?(x.activeTexture.set(S.TEXTURE2),R.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),x.activeTexture.set(S.TEXTURE4),O.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE,S.NEAREST),D.u_dem_lerp=F):(R=this.terrainTileForTile[c.tileID.key],x.activeTexture.set(S.TEXTURE2),(this._prepareDemTileUniforms(c,R,D)?R.demTexture:this.emptyDEMTexture).bind(S.NEAREST,S.CLAMP_TO_EDGE)),x.activeTexture.set(S.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),this._depthFBO&&(D.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),D.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&R){const U=(1<<R.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;D.u_meter_to_dem=U}if(_&&_.labelPlaneMatrixInv&&(D.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(x,D),"globe"===this.painter.transform.projection.name){const U=this.globeUniformValues(this.painter.transform,c.tileID.canonical,_&&_.useDenormalizedUpVectorScale);h.setGlobeUniformValues(x,U)}}globeUniformValues(c,h,_){const x=c.projection;return{u_tile_tl_up:x.upVector(h,0,0),u_tile_tr_up:x.upVector(h,p.EXTENT,0),u_tile_br_up:x.upVector(h,p.EXTENT,p.EXTENT),u_tile_bl_up:x.upVector(h,0,p.EXTENT),u_tile_up_scale:_?p.globeMetersToEcef(1):x.upVectorScale(h,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const h=this.painter,_=this.painter.context;0!==c.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,S,D,M,R){if("globe"===x.transform.projection.name)!function(O,F,U,J,ne){const le=O.context,oe=le.gl;let ue,$;const te=O.options.showTerrainWireframe?2:0,me=O.transform,_e=p.globeUseCustomAntiAliasing(O,le,me),Be=(jt,it)=>{if($===jt)return;const xt=[Il[jt],"PROJECTION_GLOBE_VIEW"];_e&&xt.push("CUSTOM_ANTIALIASING"),it&&xt.push(Il[te]),ue=O.useProgram("globeRaster",null,xt),$=jt},Fe=O.colorModeForRenderPass(),Ne=new p.DepthMode(oe.LEQUAL,p.DepthMode.ReadWrite,O.depthRangeFor3D);ha.update(ne);const Ze=p.calculateGlobeMercatorMatrix(me),qe=[p.mercatorXfromLng(me.center.lng),p.mercatorYfromLat(me.center.lat)],ot=te?[!1,!0]:[!1],Vt=O.globeSharedBuffers,nt=[me.width*p.exported.devicePixelRatio,me.height*p.exported.devicePixelRatio],Tt=Float32Array.from(me.globeMatrix),ht={useDenormalizedUpVectorScale:!0};if(ot.forEach(jt=>{const it=O.transform,xt=Su(it.zoom)*F.exaggeration();$=-1;const Ut=jt?oe.LINES:oe.TRIANGLES;for(const Rt of J){const $t=U.getTile(Rt),Mn=p.StencilMode.disabled,jn=F.prevTerrainTileForTile[Rt.key],_n=F.terrainTileForTile[Rt.key];Gi(jn,_n)&&ha.newMorphing(Rt.key,jn,_n,ne,250),le.activeTexture.set(oe.TEXTURE0),$t.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const Rn=ha.getMorphValuesForProxy(Rt.key),_i=Rn?1:0;Rn&&p.extend$1(ht,{morphing:{srcDemTile:Rn.from,dstDemTile:Rn.to,phase:p.easeCubicInOut(Rn.phase)}});const ai=p.tileCornersToBounds(Rt.canonical),Dn=p.getLatitudinalLod(ai.getCenter().lat),rr=p.getGridMatrix(Rt.canonical,ai,Dn,it.worldSize/it._pixelsPerMercatorPixel),gr=p.globeNormalizeECEF(p.globeTileBounds(Rt.canonical)),vr=Dl(it.projMatrix,Tt,Ze,gr,p.globeToMercatorTransition(it.zoom),qe,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,nt,xt,rr);if(Be(_i,jt),F.setupElevationDraw($t,ue,ht),O.prepareDrawProgram(le,ue,Rt.toUnwrapped()),Vt){const[Pi,ss,ao]=jt?Vt.getWirefameBuffers(O.context,Dn):Vt.getGridBuffers(Dn,0!==xt);ue.draw(le,Ut,Ne,Mn,Fe,p.CullFaceMode.backCCW,vr,"globe_raster",Pi,ss,ao)}}}),Vt){const jt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];_e&&jt.push("CUSTOM_ANTIALIASING"),ue=O.useProgram("globeRaster",null,jt);for(const it of J){const{x:xt,y:Ut,z:Rt}=it.canonical,$t=0===Ut,Mn=Ut===(1<<Rt)-1,[jn,_n,Rn,_i]=Vt.getPoleBuffers(Rt);if(_i&&($t||Mn)){const ai=U.getTile(it);le.activeTexture.set(oe.TEXTURE0),ai.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);let Dn=p.globePoleMatrixForTile(Rt,xt,me);const rr=p.globeNormalizeECEF(p.globeTileBounds(it.canonical)),gr=(vr,Pi)=>vr.draw(le,oe.TRIANGLES,Ne,p.StencilMode.disabled,Fe,p.CullFaceMode.disabled,Dl(me.projMatrix,Dn,Dn,rr,0,qe,me.frustumCorners.TL,me.frustumCorners.TR,me.frustumCorners.BR,me.frustumCorners.BL,me.globeCenterInViewSpace,me.globeRadius,nt,0),"globe_pole_raster",Pi,Rn,_i);F.setupElevationDraw(ai,ue,ht),O.prepareDrawProgram(le,ue,it.toUnwrapped()),$t&&gr(ue,jn),Mn&&(Dn=p.scale(p.create(),Dn,[1,-1,1]),gr(ue,_n))}}}}(x,S,D,M,R);else{const O=x.context,F=O.gl;let U,J;const ne=x.options.showTerrainWireframe?2:0,le=(me,_e)=>{if(J===me)return;const Be=[Il[me]];_e&&Be.push(Il[ne]),U=x.useProgram("terrainRaster",null,Be),J=me},oe=x.colorModeForRenderPass(),ue=new p.DepthMode(F.LEQUAL,p.DepthMode.ReadWrite,x.depthRangeFor3D);ha.update(R);const $=x.transform,te=Su($.zoom)*S.exaggeration();(ne?[!1,!0]:[!1]).forEach(me=>{J=-1;const _e=me?F.LINES:F.TRIANGLES,[Be,Fe]=me?S.getWirefameBuffer():[S.gridIndexBuffer,S.gridSegments];for(const Ne of M){const Ze=D.getTile(Ne),qe=p.StencilMode.disabled,ot=S.prevTerrainTileForTile[Ne.key],Vt=S.terrainTileForTile[Ne.key];Gi(ot,Vt)&&ha.newMorphing(Ne.key,ot,Vt,R,250),O.activeTexture.set(F.TEXTURE0),Ze.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const nt=ha.getMorphValuesForProxy(Ne.key),Tt=nt?1:0;let ht;nt&&(ht={morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:p.easeCubicInOut(nt.phase)}});const jt=Ed(Ne.projMatrix,af(Ne.canonical,$.renderWorldCopies)?te/10:te);le(Tt,me),S.setupElevationDraw(Ze,U,ht),x.prepareDrawProgram(O,U,Ne.toUnwrapped()),U.draw(O,_e,ue,qe,oe,p.CullFaceMode.backCCW,jt,"terrain_raster",S.gridBuffer,Be,Fe)}})}}(h,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,x=this.proxySourceCache,S=this.proxiedCoords[x.id],D=this._drapedRenderBatches.shift(),M=[],R=h.style.order;let O=0;for(const F of S){const U=x.getTileByID(F.proxyTileKey),J=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][c]:void 0,ne=void 0!==J?x.renderCache[J]:this.pool[O++],le=void 0!==J;if(U.texture=ne.tex,le&&!ne.dirty){M.push(U.tileID);continue}let oe;_.bindFramebuffer.set(ne.fb.framebuffer),this.renderedToTile=!1,ne.dirty&&(_.clear({color:p.Color.transparent,stencil:0}),ne.dirty=!1);for(let ue=D.start;ue<=D.end;++ue){const $=h.style._layers[R[ue]];if($.isHidden(h.transform.zoom))continue;const te=h.style._getLayerSourceCache($),me=te?this.proxyToSource[F.key][te.id]:[F];if(!me)continue;const _e=me;_.viewport.set([0,0,ne.fb.width,ne.fb.height]),oe!==(te?te.id:null)&&(this._setupStencil(ne,me,$,te),oe=te?te.id:null),h.renderLayer(h,te,$,_e)}this.renderedToTile?(ne.dirty=!0,M.push(U.tileID)):le||--O,5===O&&(O=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),D.end+1}postRender(){}renderCacheEfficiency(c){const h=c.order.length;if(0===h)return{efficiency:100};let _,x=0,S=0,D=!1;for(let M=0;M<h;++M){const R=c._layers[c.order[M]];this._style.isLayerDraped(R)?(D&&++x,++S):D||(D=!0,_=R.id)}return 0===S?{efficiency:100}:{efficiency:100*(1-x/S),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{c=Math.min(c,h.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,h,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const D=S.tileID,M=1<<D.overscaledZ,{x:R,y:O}=D.canonical,F=R/M,U=(R+1)/M,J=O/M,ne=(O+1)/M;return{minx:F,miny:J,maxx:U,maxy:ne,t:S.dem.tree.raycastRoot(F,J,U,ne,c,h,_),tile:S}});x.sort((S,D)=>(null!==S.t?S.t:Number.MAX_VALUE)-(null!==D.t?D.t:Number.MAX_VALUE));for(const S of x){if(null==S.t)return null;const D=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,c,h,_);if(null!=D)return D}return null}_createFBO(){const c=this.painter.context,h=c.gl,_=this.drapeBufferSize;c.activeTexture.set(h.TEXTURE0);const x=new p.Texture(c,{width:_[0],height:_[1],data:null},h.RGBA);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);const S=c.createFramebuffer(_[0],_[1],!1);return S.colorAttachment.set(x.texture),S.depthAttachment=new ze(c,S.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:S,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const h=this._style._layers[c],_=h.isHidden(this.painter.transform.zoom);return"custom"===h.type?!_&&h.shouldRedrape():!_&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const _ of this._style._getSources())if(_ instanceof rn){c=!0;break}if(!c)return;const h={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],S=this._style._getLayerSourceCache(x);if(S&&!h[S.id]&&!x.isHidden(this.painter.transform.zoom)&&"line"===x.type&&x.widthExpression()instanceof p.ZoomDependentExpression){h[S.id]=!0;for(const D of this.proxyCoords){const M=this.proxyToSource[D.key][S.id];if(M)for(const R of M)this._clearRenderCacheForTile(S.id,R)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof Gt){c=!0;break}if(!c)return;const h={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],S=this._style._getLayerSourceCache(x);if(!S||h[S.id]||x.isHidden(this.painter.transform.zoom)||"raster"!==x.type)continue;const D=x.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const R=this.proxyToSource[M.key][S.id];if(R)for(const O of R){const F=Bc(S.getTile(O),S.findLoadedParent(O,0),S,this.painter.transform,D);(1!==F.opacity||0!==F.mix)&&this._clearRenderCacheForTile(S.id,O)}}}}_setupDrapedRenderBatches(){const c=this._style.order,h=c.length;if(0===h)return;const _=[];let x,S=0,D=this._style._layers[c[S]];for(;!this._style.isLayerDraped(D)&&D.isHidden(this.painter.transform.zoom)&&++S<h;)D=this._style._layers[c[S]];for(;S<h;++S){const M=this._style._layers[c[S]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?void 0===x&&(x=S):void 0!==x&&(_.push({start:x,end:S-1}),x=void 0))}void 0!==x&&_.push({start:x,end:S-1}),this._drapedRenderBatches=_}_setupRenderCache(c){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const D=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let M=0;M<D.length;++M){const R=Object.values(D[M]);h.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let D=_.length-1;D>=0;D--){const M=_[D];if(h.getTileByID(M.key),void 0!==h.proxyCachedFBO[M.key]){const R=c[M.key],O=this.proxyToSource[M.key];let F=0;for(const U in O){const J=O[U],ne=R[U];if(!ne||ne.length!==J.length||J.some((le,oe)=>le!==ne[oe]||x[U]&&x[U].hasOwnProperty(le.key))){F=-1;break}++F}for(const U in h.proxyCachedFBO[M.key])h.renderCache[h.proxyCachedFBO[M.key][U]].dirty=F<0||F!==Object.values(R).length}}const S=[...this._drapedRenderBatches];S.sort((D,M)=>M.end-M.start-(D.end-D.start));for(const D of S)for(const M of _){if(h.proxyCachedFBO[M.key])continue;let R=h.renderCachePool.pop();void 0===R&&h.renderCache.length<50&&(R=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==R&&(h.proxyCachedFBO[M.key]={},h.proxyCachedFBO[M.key][D.start]=R,h.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(c,h,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,D=S.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let M;if(_.isTileClipped())M=h.length,this._overlapStencilMode.test={func:D.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:D.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(c,h){const _=this.painter,x=this.painter.context,S=x.gl;_._tileClippingMaskIDs={},x.setColorMode(p.ColorMode.disabled),x.setDepthMode(p.DepthMode.disabled);const D=_.useProgram("clippingMask");for(const M of c){const R=_._tileClippingMaskIDs[M.key]=--h;D.draw(x,S.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:S.ALWAYS,mask:0},R,255,S.KEEP,S.KEEP,S.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Xs(M.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(c){const h=this.painter.transform;if(c.x<0||c.x>h.width||c.y<0||c.y>h.height)return null;const _=[c.x,c.y,1,1];p.transformMat4$1(_,_,h.pixelMatrixInverse),p.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const x=h._camera.position,S=p.mercatorZfromAltitude(1,h.center.lat),D=[x[0],x[1],x[2]/S,0],M=p.subtract([],_.slice(0,3),D);p.normalize(M,M);const R=this.raycast(D,M,this._exaggeration);return null!==R&&R?(p.scaleAndAdd(D,D,M,R),D[3]=D[2],D[2]*=S,D):null}drawDepth(){const c=this.painter,h=c.context,_=this.proxySourceCache,x=Math.ceil(c.width),S=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===S||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const D=h.gl,M=h.createFramebuffer(x,S,!0);h.activeTexture.set(D.TEXTURE0);const R=new p.Texture(h,{width:x,height:S,data:null},D.RGBA);R.bind(D.NEAREST,D.CLAMP_TO_EDGE),M.colorAttachment.set(R.texture);const O=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,x,S);M.depthAttachment.set(O),this._depthFBO=M,this._depthTexture=R}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,x,S]),function(D,M,R,O){if("globe"===D.transform.projection.name)return;const F=D.context,U=F.gl;F.clear({depth:1});const J=D.useProgram("terrainDepth"),ne=new p.DepthMode(U.LESS,p.DepthMode.ReadWrite,D.depthRangeFor3D);for(const le of O){const oe=R.getTile(le),ue=Ed(le.projMatrix,0);M.setupElevationDraw(oe,J),J.draw(F,U.TRIANGLES,ne,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,ue,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(c,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,h,_){if(c.getSource()instanceof mi)return this._setupProxiedCoordsForImageSource(c,h,_);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const x=this.proxiedCoords[c.id]=[],S=this.proxyCoords;for(let M=0;M<S.length;M++){const R=S[M],O=this._findTileCoveringTileID(R,c);if(O){const F=this._createProxiedId(R,O,_[R.key]&&_[R.key][c.id]);x.push(F),this.proxyToSource[R.key][c.id]=[F]}}let D=!1;for(let M=0;M<h.length;M++){const R=c.getTile(h[M]);if(!R||!R.hasData())continue;const O=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==R.tileID.canonical.z){const F=this.proxyToSource[O.tileID.key][c.id],U=this._createProxiedId(O.tileID,R,_[O.tileID.key]&&_[O.tileID.key][c.id]);F?F.splice(F.length-1,0,U):this.proxyToSource[O.tileID.key][c.id]=[U],x.push(U),D=!0}}this._sourceTilesOverlap[c.id]=D}_setupProxiedCoordsForImageSource(c,h,_){if(!c.getSource().loaded())return;const x=this.proxiedCoords[c.id]=[],S=this.proxyCoords,D=c.getSource(),M=new p.Point(D.tileID.x,D.tileID.y)._div(1<<D.tileID.z),R=D.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((F,U)=>(F.min.x=Math.min(F.min.x,U.x-M.x),F.min.y=Math.min(F.min.y,U.y-M.y),F.max.x=Math.max(F.max.x,U.x-M.x),F.max.y=Math.max(F.max.y,U.y-M.y),F),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(F,U)=>{const J=F.wrap+F.canonical.x/(1<<F.canonical.z),ne=F.canonical.y/(1<<F.canonical.z),le=p.EXTENT/(1<<F.canonical.z),oe=U.wrap+U.canonical.x/(1<<U.canonical.z),ue=U.canonical.y/(1<<U.canonical.z);return J+le<oe+R.min.x||J>oe+R.max.x||ne+le<ue+R.min.y||ne>ue+R.max.y};for(let F=0;F<S.length;F++){const U=S[F];for(let J=0;J<h.length;J++){const ne=c.getTile(h[J]);if(!ne||!ne.hasData()||O(U,ne.tileID))continue;const le=this._createProxiedId(U,ne,_[U.key]&&_[U.key][c.id]),oe=this.proxyToSource[U.key][c.id];oe?oe.push(le):this.proxyToSource[U.key][c.id]=[le],x.push(le)}}}_createProxiedId(c,h,_){let x=this.orthoMatrix;if(_){const S=_.find(D=>D.key===h.tileID.key);if(S)return S}if(h.tileID.key!==c.key){const S=c.canonical.z-h.tileID.canonical.z;let D,M,R;x=p.create();const O=h.tileID.wrap-c.wrap<<c.overscaledZ;S>0?(D=p.EXTENT>>S,M=D*((h.tileID.canonical.x<<S)-c.canonical.x+O),R=D*((h.tileID.canonical.y<<S)-c.canonical.y)):(D=p.EXTENT<<-S,M=p.EXTENT*(h.tileID.canonical.x-(c.canonical.x+O<<-S)),R=p.EXTENT*(h.tileID.canonical.y-(c.canonical.y<<-S))),p.ortho(x,0,D,0,D,0,1),p.translate(x,x,[M,R,0])}return new Uh(h.tileID,c.key,x)}_findTileCoveringTileID(c,h){let _=h.getTile(c);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[h.id],S=x[c.key];if(_=S?h.getTileByID(S):null,_&&_.hasData()||null===S)return _;let D=_?_.tileID:c,M=D.overscaledZ;const R=h.getSource().minzoom,O=[];if(!S){const U=h.getSource().maxzoom;if(c.canonical.z>=U){const J=c.canonical.z-U;h.getSource().reparseOverscaled?(M=Math.max(c.canonical.z+2,h.transform.tileZoom),D=new p.OverscaledTileID(M,c.wrap,U,c.canonical.x>>J,c.canonical.y>>J)):0!==J&&(M=U,D=new p.OverscaledTileID(M,c.wrap,U,c.canonical.x>>J,c.canonical.y>>J))}D.key!==c.key&&(O.push(D.key),_=h.getTile(D))}const F=U=>{O.forEach(J=>{x[J]=U}),O.length=0};for(M-=1;M>=R&&(!_||!_.hasData());M--){_&&F(_.tileID.key);const U=D.calculateScaledKey(M);if(_=h.getTileByID(U),_&&_.hasData())break;const J=x[U];if(null===J)break;void 0===J?O.push(U):_=h.getTileByID(J)}return F(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,h){let _=this._tilesDirty[c];_||(_=this._tilesDirty[c]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(h){let _=0;const x=new p.StructArrayLayout2ui4,S=131;for(let D=1;D<129;D++){for(let M=1;M<129;M++)_=D*S+M,x.emplaceBack(_,_+1),x.emplaceBack(_,_+S),x.emplaceBack(_+1,_+S),128===D&&x.emplaceBack(_+S,_+S+1);x.emplaceBack(_+1,_+1+S)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Vi{static cacheKey(c,h,_,x){let S=`${h}${x?x.cacheKey:""}`;for(const D of _)c.usedDefines.includes(D)&&(S+=`/${D}`);return S}constructor(c,h,_,x,S,D){const M=c.gl;this.program=M.createProgram();const R=function($){const te=[];for(let me=0;me<$.length;me++){if(null===$[me])continue;const _e=$[me].split(" ");te.push(_e.pop())}return te}(_.staticAttributes),O=x?x.getBinderAttributes():[],F=R.concat(O);let U=x?x.defines():[];U=U.concat(D.map($=>`#define ${$}`));const J=c.isWebGL2?"#version 300 es\n":"",ne=J+U.concat(c.extStandardDerivatives&&0===J.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Ls):Ls,Ls,Vh,zh.fragmentSource,wu.fragmentSource,_.fragmentSource).join("\n"),le=J+U.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Vh,zh.vertexSource,wu.vertexSource,Cd.vertexSource,_.vertexSource).join("\n"),oe=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(oe,ne),M.compileShader(oe),M.attachShader(this.program,oe);const ue=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(ue,le),M.compileShader(ue),M.attachShader(this.program,ue),this.attributes={},this.numAttributes=F.length;for(let $=0;$<this.numAttributes;$++)F[$]&&(M.bindAttribLocation(this.program,$,F[$]),this.attributes[F[$]]=$);M.linkProgram(this.program),M.deleteShader(ue),M.deleteShader(oe),this.fixedUniforms=S(c),this.binderUniforms=x?x.getUniforms(c):[],D.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i($=c),u_dem_prev:new p.Uniform1i($),u_dem_unpack:new p.Uniform4f($),u_dem_tl:new p.Uniform2f($),u_dem_scale:new p.Uniform1f($),u_dem_tl_prev:new p.Uniform2f($),u_dem_scale_prev:new p.Uniform1f($),u_dem_size:new p.Uniform1f($),u_dem_lerp:new p.Uniform1f($),u_exaggeration:new p.Uniform1f($),u_depth:new p.Uniform1i($),u_depth_size_inv:new p.Uniform2f($),u_meter_to_dem:new p.Uniform1f($),u_label_plane_matrix_inv:new p.UniformMatrix4f($)}),D.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new p.Uniform3f($),u_tile_tr_up:new p.Uniform3f($),u_tile_br_up:new p.Uniform3f($),u_tile_bl_up:new p.Uniform3f($),u_tile_up_scale:new p.Uniform1f($)}))(c)),D.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new p.UniformMatrix4f($),u_fog_range:new p.Uniform2f($),u_fog_color:new p.Uniform4f($),u_fog_horizon_blend:new p.Uniform1f($),u_fog_temporal_offset:new p.Uniform1f($),u_frustum_tl:new p.Uniform3f($),u_frustum_tr:new p.Uniform3f($),u_frustum_br:new p.Uniform3f($),u_frustum_bl:new p.Uniform3f($),u_globe_pos:new p.Uniform3f($),u_globe_radius:new p.Uniform1f($),u_globe_transition:new p.Uniform1f($),u_is_globe:new p.Uniform1i($),u_viewport:new p.Uniform2f($)}))(c))}var $}setTerrainUniformValues(c,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)_[x]&&_[x].set(this.program,x,h[x])}}setGlobeUniformValues(c,h){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)_[x]&&_[x].set(this.program,x,h[x])}}setFogUniformValues(c,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const x in h)_[x].set(this.program,x,h[x])}}draw(c,h,_,x,S,D,M,R,O,F,U,J,ne,le,oe){const ue=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(_),c.setStencilMode(x),c.setColorMode(S),c.setCullFace(D);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,M[te]);le&&le.setUniforms(this.program,c,this.binderUniforms,J,{zoom:ne});const $={[ue.LINES]:2,[ue.TRIANGLES]:3,[ue.LINE_STRIP]:1}[h];for(const te of U.get()){const me=te.vaos||(te.vaos={});(me[R]||(me[R]=new Pa)).bind(c,this,O,le?le.getPaintVertexBuffers():[],F,te.vertexOffset,oe||[]),ue.drawElements(h,te.primitiveLength*$,ue.UNSIGNED_SHORT,te.primitiveOffset*$*2)}}}function wn(g,c){const h=Math.pow(2,c.tileID.overscaledZ),_=c.tileSize*Math.pow(2,g.transform.tileZoom)/h,x=_*(c.tileID.canonical.x+c.tileID.wrap*h),S=_*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/cn(c,1,g.transform.tileZoom),u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const Qm=p.create(),$h=(g,c,h,_,x,S,D,M,R,O,F)=>{const U=c.style.light,J=U.properties.get("position"),ne=[J.x,J.y,J.z],le=p.create$1();"viewport"===U.properties.get("anchor")&&(p.fromRotation(le,-c.transform.angle),p.transformMat3(ne,ne,le));const oe=U.properties.get("color"),ue=c.transform,$={u_matrix:g,u_lightpos:ne,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[oe.r,oe.g,oe.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:S};return"globe"===ue.projection.name&&($.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],$.u_zoom_transition=R,$.u_inv_rot_matrix=F,$.u_merc_center=O,$.u_up_dir=ue.projection.upVector(new p.CanonicalTileID(0,0,0),O[0]*p.EXTENT,O[1]*p.EXTENT),$.u_height_lift=M),$},Bt=(g,c,h,_,x,S,D,M,R,O,F,U)=>{const J=$h(g,c,h,_,x,S,D,R,O,F,U),ne={u_height_factor:-Math.pow(2,D.overscaledZ)/M.tileSize/8};return p.extend(J,wn(c,M),ne)},wo=g=>({u_matrix:g}),mr=(g,c,h)=>p.extend(wo(g),wn(c,h)),ys=(g,c)=>({u_matrix:g,u_world:c}),vs=(g,c,h,_)=>p.extend(mr(g,c,h),{u_world:_}),Cu=p.create(),xs=(g,c,h,_,x,S)=>{const D=g.transform,M="globe"===D.projection.name;let R;if("map"===S.paint.get("circle-pitch-alignment"))if(M){const F=p.globePixelsToTileUnits(D.zoom,c.canonical)*D._pixelsPerMercatorPixel;R=Float32Array.from([F,0,0,F])}else R=D.calculatePixelsToTileUnitsMatrix(h);else R=new Float32Array([D.pixelsToGLUnits[0],0,0,D.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:D.cameraToCenterDistance,u_matrix:g.translatePosMatrix(c.projMatrix,h,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:Cu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){O.u_inv_rot_matrix=_,O.u_merc_center=x,O.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],O.u_zoom_transition=p.globeToMercatorTransition(D.zoom);const F=x[0]*p.EXTENT,U=x[1]*p.EXTENT;O.u_up_dir=D.projection.upVector(new p.CanonicalTileID(0,0,0),F,U)}return O},Tu=g=>{const c=[];return"map"===g.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},Dd=(g,c,h,_)=>{const x=p.EXTENT/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(_),u_extrude_scale:[c.pixelsToGLUnits[0]/x,c.pixelsToGLUnits[1]/x]}},nc=(g,c,h=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:h}),Id=p.create(),ic=(g,c,h,_,x,S,D)=>{const M=g.transform,R="globe"===M.projection.name,O=R?p.globePixelsToTileUnits(M.zoom,c.canonical)*M._pixelsPerMercatorPixel:cn(h,1,S),F={u_matrix:c.projMatrix,u_extrude_scale:O,u_intensity:D,u_inv_rot_matrix:Id,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){F.u_inv_rot_matrix=_,F.u_merc_center=x,F.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],F.u_zoom_transition=p.globeToMercatorTransition(M.zoom);const U=x[0]*p.EXTENT,J=x[1]*p.EXTENT;F.u_up_dir=M.projection.upVector(new p.CanonicalTileID(0,0,0),U,J)}return F},rs=(g,c,h,_,x,S,D)=>{const M=g.transform,R=M.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:xn(g,c,h,_),u_pixels_to_tile_units:R,u_device_pixel_ratio:S,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:hi(h)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ho(c,g.transform),u_alpha_discard_threshold:0,u_trim_offset:D}},Md=(g,c,h,_,x)=>{const S=g.transform;return{u_matrix:xn(g,c,h,_),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:Ho(c,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ho(g,c){return 1/cn(g,1,c.tileZoom)}function xn(g,c,h,_){return g.translatePosMatrix(_||c.tileID.projMatrix,c,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function hi(g){const c=g.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const Br=(g,c,h,_,x,S)=>{return{u_matrix:g,u_tl_parent:c,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(M=x.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(D=x.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:so(x.paint.get("raster-hue-rotate")),u_perspective_transform:S};var D,M};function so(g){g*=Math.PI/180;const c=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*c-h+1)/3,(Math.sqrt(3)*c-h+1)/3]}const sl=p.create(),So=(g,c,h,_,x,S,D,M,R,O,F,U,J,ne,le,oe)=>{const ue=x.transform,$={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:ue.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:ue.width/ue.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:D,u_coord_matrix:M,u_is_text:+R,u_pitch_with_map:+_,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:sl,u_up_vector:[0,-1,0]};return"globe"===oe.name&&($.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],$.u_zoom_transition=U,$.u_inv_rot_matrix=ne,$.u_merc_center=J,$.u_camera_forward=ue._camera.forward(),$.u_ecef_origin=p.globeECEFOrigin(ue.globeMatrix,F.toUnwrapped()),$.u_tile_matrix=Float32Array.from(ue.globeMatrix),$.u_up_vector=le),$},al=(g,c,h,_,x,S,D,M,R,O,F,U,J,ne,le,oe,ue)=>p.extend(So(g,c,h,_,x,S,D,M,R,O,U,J,ne,le,oe,ue),{u_gamma_scale:_?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+F}),Yr=(g,c,h,_,x,S,D,M,R,O,F,U,J,ne,le,oe)=>p.extend(al(g,c,h,_,x,S,D,M,!0,R,!0,F,U,J,ne,le,oe),{u_texsize_icon:O,u_texture_icon:1}),zc=(g,c,h)=>({u_matrix:g,u_opacity:c,u_color:h}),Ad=(g,c,h,_,x)=>p.extend(function(S,D,M){const R=D.imageManager.getPattern(S.toString()),{width:O,height:F}=D.imageManager.getPixelSize(),U=Math.pow(2,M.tileID.overscaledZ),J=M.tileSize*Math.pow(2,D.transform.tileZoom)/U,ne=J*(M.tileID.canonical.x+M.tileID.wrap*U),le=J*M.tileID.canonical.y;return{u_image:0,u_pattern_tl:R.tl,u_pattern_br:R.br,u_texsize:[O,F],u_pattern_size:R.displaySize,u_tile_units_to_pixels:1/cn(M,1,D.transform.tileZoom),u_pixel_coord_upper:[ne>>16,le>>16],u_pixel_coord_lower:[65535&ne,65535&le]}}(_,h,x),{u_matrix:g,u_opacity:c}),Ei={fillExtrusion:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_height_factor:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g)}),fill:g=>({u_matrix:new p.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),fillOutline:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),collisionBox:g=>({u_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new p.UniformMatrix4f(g),u_inv_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_viewport_size:new p.Uniform2f(g)}),debug:g=>({u_color:new p.UniformColor(g),u_matrix:new p.UniformMatrix4f(g),u_overlay:new p.Uniform1i(g),u_overlay_scale:new p.Uniform1f(g)}),clippingMask:g=>({u_matrix:new p.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new p.Uniform1f(g),u_intensity:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),heatmapTexture:g=>({u_image:new p.Uniform1i(g),u_color_ramp:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g)}),hillshade:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_latrange:new p.Uniform2f(g),u_light:new p.Uniform2f(g),u_shadow:new p.UniformColor(g),u_highlight:new p.UniformColor(g),u_accent:new p.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_dimension:new p.Uniform2f(g),u_zoom:new p.Uniform1f(g),u_unpack:new p.Uniform4f(g)}),line:g=>({u_matrix:new p.UniformMatrix4f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_units_to_pixels:new p.Uniform2f(g),u_dash_image:new p.Uniform1i(g),u_gradient_image:new p.Uniform1i(g),u_image_height:new p.Uniform1f(g),u_texsize:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g),u_trim_offset:new p.Uniform2f(g)}),linePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_texsize:new p.Uniform2f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_units_to_pixels:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g)}),raster:g=>({u_matrix:new p.UniformMatrix4f(g),u_tl_parent:new p.Uniform2f(g),u_scale_parent:new p.Uniform1f(g),u_fade_t:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_image0:new p.Uniform1i(g),u_image1:new p.Uniform1i(g),u_brightness_low:new p.Uniform1f(g),u_brightness_high:new p.Uniform1f(g),u_saturation_factor:new p.Uniform1f(g),u_contrast_factor:new p.Uniform1f(g),u_spin_weights:new p.Uniform3f(g),u_perspective_transform:new p.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_texture:new p.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_is_halo:new p.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texsize_icon:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_texture_icon:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_is_halo:new p.Uniform1i(g)}),background:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_color:new p.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_pattern_tl:new p.Uniform2f(g),u_pattern_br:new p.Uniform2f(g),u_texsize:new p.Uniform2f(g),u_pattern_size:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),terrainRaster:Km,terrainDepth:Km,skybox:g=>({u_matrix:new p.UniformMatrix4f(g),u_sun_direction:new p.Uniform3f(g),u_cubemap:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new p.UniformMatrix4f(g),u_color_ramp:new p.Uniform1i(g),u_center_direction:new p.Uniform3f(g),u_radius:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new p.UniformMatrix3f(g),u_sun_direction:new p.Uniform3f(g),u_sun_intensity:new p.Uniform1f(g),u_color_tint_r:new p.Uniform4f(g),u_color_tint_m:new p.Uniform4f(g),u_luminance:new p.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new p.UniformMatrix4f(g),u_globe_matrix:new p.UniformMatrix4f(g),u_normalize_matrix:new p.UniformMatrix4f(g),u_merc_matrix:new p.UniformMatrix4f(g),u_zoom_transition:new p.Uniform1f(g),u_merc_center:new p.Uniform2f(g),u_image0:new p.Uniform1i(g),u_grid_matrix:new p.UniformMatrix3f(g),u_skirt_height:new p.Uniform1f(g),u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_globe_pos:new p.Uniform3f(g),u_globe_radius:new p.Uniform1f(g),u_viewport:new p.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_horizon:new p.Uniform1f(g),u_transition:new p.Uniform1f(g),u_fadeout_range:new p.Uniform1f(g),u_color:new p.Uniform4f(g),u_high_color:new p.Uniform4f(g),u_space_color:new p.Uniform4f(g),u_star_intensity:new p.Uniform1f(g),u_star_density:new p.Uniform1f(g),u_star_size:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g),u_horizon_angle:new p.Uniform1f(g),u_rotation_matrix:new p.UniformMatrix4f(g)})};let Vc;function ll(g,c,h,_,x,S,D){const M=g.context,R=M.gl,O=g.transform,F=g.useProgram("collisionBox"),U=[];let J=0,ne=0;for(let _e=0;_e<_.length;_e++){const Be=_[_e],Fe=c.getTile(Be),Ne=Fe.getBucket(h);if(!Ne)continue;const Ze=Rs(Be,Ne,O);let qe=Ze;0===x[0]&&0===x[1]||(qe=g.translatePosMatrix(Ze,Fe,x,S));const ot=D?Ne.textCollisionBox:Ne.iconCollisionBox,Vt=Ne.collisionCircleArray;if(Vt.length>0){const nt=p.create(),Tt=qe;p.mul(nt,Ne.placementInvProjMatrix,O.glCoordMatrix),p.mul(nt,nt,Ne.placementViewportMatrix),U.push({circleArray:Vt,circleOffset:ne,transform:Tt,invTransform:nt,projection:Ne.getProjection()}),J+=Vt.length/4,ne=J}ot&&(g.terrain&&g.terrain.setupElevationDraw(Fe,F),F.draw(M,R.LINES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,Dd(qe,O,Fe,Ne.getProjection()),h.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,null,O.zoom,null,[ot.collisionVertexBuffer,ot.collisionVertexBufferExt]))}if(!D||!U.length)return;const le=g.useProgram("collisionCircle"),oe=new p.StructArrayLayout2f1f2i16;oe.resize(4*J),oe._trim();let ue=0;for(const _e of U)for(let Be=0;Be<_e.circleArray.length/4;Be++){const Fe=4*Be,Ne=_e.circleArray[Fe+0],Ze=_e.circleArray[Fe+1],qe=_e.circleArray[Fe+2],ot=_e.circleArray[Fe+3];oe.emplace(ue++,Ne,Ze,qe,ot,0),oe.emplace(ue++,Ne,Ze,qe,ot,1),oe.emplace(ue++,Ne,Ze,qe,ot,2),oe.emplace(ue++,Ne,Ze,qe,ot,3)}(!Vc||Vc.length<2*J)&&(Vc=function(_e){const Be=2*_e,Fe=new p.StructArrayLayout3ui6;Fe.resize(Be),Fe._trim();for(let Ne=0;Ne<Be;Ne++){const Ze=6*Ne;Fe.uint16[Ze+0]=4*Ne+0,Fe.uint16[Ze+1]=4*Ne+1,Fe.uint16[Ze+2]=4*Ne+2,Fe.uint16[Ze+3]=4*Ne+2,Fe.uint16[Ze+4]=4*Ne+3,Fe.uint16[Ze+5]=4*Ne+0}return Fe}(J));const $=M.createIndexBuffer(Vc,!0),te=M.createVertexBuffer(oe,p.collisionCircleLayout.members,!0);for(const _e of U){const Be={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(me=O).getCameraToCenterDistance(_e.projection),u_viewport_size:[me.width,me.height]};le.draw(M,R.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,Be,h.id,te,$,p.SegmentVector.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,O.zoom)}var me;te.destroy(),$.destroy()}const qh=p.create();function Ml({width:g,height:c,anchor:h,textOffset:_,textScale:x},S){const{horizontalAlign:D,verticalAlign:M}=p.getAnchorAlignment(h),R=-(D-.5)*g,O=-(M-.5)*c,F=p.evaluateVariableOffset(h,_);return new p.Point((R/x+F[0])*S,(O/x+F[1])*S)}function os(g,c,h,_,x,S,D,M,R,O,F){const U=g.text.placedSymbolArray,J=g.text.dynamicLayoutVertexArray,ne=g.icon.dynamicLayoutVertexArray,le={},oe=g.getProjection(),ue=Hr(M,oe,S),$=S.elevation,te=oe.upVectorScale(M.canonical,S.center.lat,S.worldSize).metersToTile;J.clear();for(let me=0;me<U.length;me++){const _e=U.get(me),{tileAnchorX:Be,tileAnchorY:Fe,numGlyphs:Ne}=_e,Ze=_e.hidden||!_e.crossTileID||g.allowVerticalPlacement&&!_e.placedOrientation?null:_[_e.crossTileID];if(Ze){let qe=0,ot=0,Vt=0;if($){const $t=$?$.getAtTileOffset(M,Be,Fe):0,[Mn,jn,_n]=oe.upVector(M.canonical,Be,Fe);qe=$t*Mn*te,ot=$t*jn*te,Vt=$t*_n*te}let[nt,Tt,ht,jt]=Oo(_e.projectedAnchorX+qe,_e.projectedAnchorY+ot,_e.projectedAnchorZ+Vt,h?ue:D);const it=ef(S.getCameraToCenterDistance(oe),jt);let xt=x.evaluateSizeForFeature(g.textSizeData,O,_e)*it/p.ONE_EM;h&&(xt*=g.tilePixelRatio/R);const Ut=Ml(Ze,xt);h?(({x:nt,y:Tt,z:ht}=oe.projectTilePoint(Be+Ut.x,Fe+Ut.y,M.canonical)),[nt,Tt,ht]=Oo(nt+qe,Tt+ot,ht+Vt,D)):(c&&Ut._rotate(-S.angle),nt+=Ut.x,Tt+=Ut.y,ht=0);const Rt=g.allowVerticalPlacement&&_e.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let $t=0;$t<Ne;$t++)p.addDynamicAttributes(J,nt,Tt,ht,Rt);F&&_e.associatedIconIndex>=0&&(le[_e.associatedIconIndex]={x:nt,y:Tt,z:ht,angle:Rt})}else ji(Ne,J)}if(F){ne.clear();const me=g.icon.placedSymbolArray;for(let _e=0;_e<me.length;_e++){const Be=me.get(_e),{numGlyphs:Fe}=Be,Ne=le[_e];if(Be.hidden||!Ne)ji(Fe,ne);else{const{x:Ze,y:qe,z:ot,angle:Vt}=Ne;for(let nt=0;nt<Fe;nt++)p.addDynamicAttributes(ne,Ze,qe,ot,Vt)}}g.icon.dynamicLayoutVertexBuffer.updateData(ne)}g.text.dynamicLayoutVertexBuffer.updateData(J)}function jc(g,c,h){return h.iconsInText&&c?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Uc(g,c,h,_,x,S,D,M,R,O,F,U){const J=g.context,ne=J.gl,le=g.transform,oe="map"===M,ue="map"===R,$=oe&&"point"!==h.layout.get("symbol-placement"),te=oe&&!ue&&!$,me=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let _e=!1;const Be=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),Fe=[p.mercatorXfromLng(le.center.lng),p.mercatorYfromLat(le.center.lat)],Ne=h.layout.get("text-variable-anchor"),Ze="globe"===le.projection.name,qe=[],ot=[0,-1,0];let Vt=ot;!Ze&&!le.mercatorFromTransition||oe||(Vt=function(nt){const Tt=nt._camera.getWorldToCamera(nt.worldSize,1),ht=p.multiply([],Tt,nt.globeMatrix);p.invert(ht,ht);const jt=[0,0,0],it=[0,1,0,0];return p.transformMat4$1(it,it,ht),jt[0]=it[0],jt[1]=it[1],jt[2]=it[2],p.normalize(jt,jt),jt}(le));for(const nt of _){const Tt=c.getTile(nt),ht=Tt.getBucket(h);if(!ht||"mercator"===ht.projection.name&&Ze)continue;const jt=x?ht.text:ht.icon;if(!jt||ht.fullyClipped||!jt.segments.get().length)continue;const it=jt.programConfigurations.get(h.id),xt=x||ht.sdfIcons,Ut=x?ht.textSizeData:ht.iconSizeData,Rt=ue||0!==le.pitch,$t=p.evaluateSizeForZoom(Ut,le.zoom);let Mn,jn,_n,Rn,_i=[0,0],ai=null;if(x)jn=Tt.glyphAtlasTexture,_n=ne.LINEAR,Mn=Tt.glyphAtlasTexture.size,ht.iconsInText&&(_i=Tt.imageAtlasTexture.size,ai=Tt.imageAtlasTexture,Rn=Rt||g.options.rotating||g.options.zooming||"composite"===Ut.kind||"camera"===Ut.kind?ne.LINEAR:ne.NEAREST);else{const Pl=1!==h.layout.get("icon-size").constantOr(0)||ht.iconsNeedLinear;jn=Tt.imageAtlasTexture,_n=xt||g.options.rotating||g.options.zooming||Pl||Rt?ne.LINEAR:ne.NEAREST,Mn=Tt.imageAtlasTexture.size}const Dn="globe"===ht.projection.name,rr=Dn?Vt:ot,gr=Dn?p.globeToMercatorTransition(le.zoom):0,vr=Hr(nt,ht.getProjection(),le),Pi=le.calculatePixelsToTileUnitsMatrix(Tt),ss=_t(vr,Tt.tileID.canonical,ue,oe,le,ht.getProjection(),Pi),ao=g.terrain&&ue&&$?p.invert(p.create(),ss):qh,zs=fo(vr,Tt.tileID.canonical,ue,oe,le,ht.getProjection(),Pi),ga=Ne&&ht.hasTextData(),Ir="none"!==h.layout.get("icon-text-fit")&&ga&&ht.hasIconData();if($){const Pl=le.elevation,Ll=Pl?Pl.getAtTileOffsetFunc(nt,le.center.lat,le.worldSize,ht.getProjection()):null,lc=El(vr,Tt.tileID.canonical,ue,oe,le,ht.getProjection(),Pi);tf(ht,vr,g,x,lc,zs,ue,O,Ll,nt)}const ar=$||x&&Ne||Ir,Qi=g.translatePosMatrix(vr,Tt,S,D),lo=ar?qh:ss,as=g.translatePosMatrix(zs,Tt,S,D,!0),Rr=ht.getProjection().createInversionMatrix(le,nt.canonical),Cs=[];g.terrainRenderModeElevated()&&ue&&Cs.push("PITCH_WITH_MAP_TERRAIN"),Dn&&Cs.push("PROJECTION_GLOBE_VIEW"),ar&&Cs.push("PROJECTED_POS_ON_VIEWPORT");const sp=xt&&0!==h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let dl;dl=xt?ht.iconsInText?Yr(Ut.kind,$t,te,ue,g,Qi,lo,as,Mn,_i,nt,gr,Fe,Rr,rr,ht.getProjection()):al(Ut.kind,$t,te,ue,g,Qi,lo,as,x,Mn,!0,nt,gr,Fe,Rr,rr,ht.getProjection()):So(Ut.kind,$t,te,ue,g,Qi,lo,as,x,Mn,nt,gr,Fe,Rr,rr,ht.getProjection());const Rl={program:g.useProgram(jc(xt,x,ht),it,Cs),buffers:jt,uniformValues:dl,atlasTexture:jn,atlasTextureIcon:ai,atlasInterpolation:_n,atlasInterpolationIcon:Rn,isSDF:xt,hasHalo:sp,tile:Tt,labelPlaneMatrixInv:ao};if(me&&ht.canOverlap){_e=!0;const Pl=jt.segments.get();for(const Ll of Pl)qe.push({segments:new p.SegmentVector([Ll]),sortKey:Ll.sortKey,state:Rl})}else qe.push({segments:jt.segments,sortKey:0,state:Rl})}_e&&qe.sort((nt,Tt)=>nt.sortKey-Tt.sortKey);for(const nt of qe){const Tt=nt.state;if(g.terrain&&g.terrain.setupElevationDraw(Tt.tile,Tt.program,{useDepthForOcclusion:!Ze,labelPlaneMatrixInv:Tt.labelPlaneMatrixInv}),J.activeTexture.set(ne.TEXTURE0),Tt.atlasTexture.bind(Tt.atlasInterpolation,ne.CLAMP_TO_EDGE),Tt.atlasTextureIcon&&(J.activeTexture.set(ne.TEXTURE1),Tt.atlasTextureIcon&&Tt.atlasTextureIcon.bind(Tt.atlasInterpolationIcon,ne.CLAMP_TO_EDGE)),Tt.isSDF){const ht=Tt.uniformValues;Tt.hasHalo&&(ht.u_is_halo=1,ws(Tt.buffers,nt.segments,h,g,Tt.program,Be,F,U,ht)),ht.u_is_halo=0}ws(Tt.buffers,nt.segments,h,g,Tt.program,Be,F,U,Tt.uniformValues)}}function ws(g,c,h,_,x,S,D,M,R){const O=_.context,F=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];x.draw(O,O.gl.TRIANGLES,S,D,M,p.CullFaceMode.disabled,R,h.id,g.layoutVertexBuffer,g.indexBuffer,c,h.paint,_.transform.zoom,g.programConfigurations.get(h.id),F)}function Hc(g,c,h,_,x,S,D){const M=g.context.gl,R=h.paint.get("fill-pattern"),O=R&&R.constantOr(1);let F,U,J,ne,le;D?(U=O&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=M.LINES):(U=O?"fillPattern":"fill",F=M.TRIANGLES);for(const oe of _){const ue=c.getTile(oe);if(O&&!ue.patternsLoaded())continue;const $=ue.getBucket(h);if(!$)continue;g.prepareDrawTile();const te=$.programConfigurations.get(h.id),me=g.useProgram(U,te);O&&(g.context.activeTexture.set(M.TEXTURE0),ue.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),te.updatePaintBuffers());const _e=R.constantOr(null);if(_e&&ue.imageAtlas){const Fe=ue.imageAtlas.patternPositions[_e.toString()];Fe&&te.setConstantPatternPositions(Fe)}const Be=g.translatePosMatrix(oe.projMatrix,ue,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(D){ne=$.indexBuffer2,le=$.segments2;const Fe=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];J="fillOutlinePattern"===U&&O?vs(Be,g,ue,Fe):ys(Be,Fe)}else ne=$.indexBuffer,le=$.segments,J=O?mr(Be,g,ue):wo(Be);g.prepareDrawProgram(g.context,me,oe.toUnwrapped()),me.draw(g.context,F,x,g.stencilModeForClipping(oe),S,p.CullFaceMode.disabled,J,h.id,$.layoutVertexBuffer,ne,le,h.paint,g.transform.zoom,te)}}function kd(g,c,h,_,x,S,D){const M=g.context,R=M.gl,O=g.transform,F=h.paint.get("fill-extrusion-pattern"),U=F.constantOr(1),J=h.paint.get("fill-extrusion-opacity"),ne=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],le=h.layout.get("fill-extrusion-edge-radius"),oe=le>0&&!h.paint.get("fill-extrusion-rounded-roof"),ue=oe?0:le,$="globe"===O.projection.name?p.fillExtrusionHeightLift():0,te="globe"===O.projection.name,me=te?p.globeToMercatorTransition(O.zoom):0,_e=[p.mercatorXfromLng(O.center.lng),p.mercatorYfromLat(O.center.lat)],Be=[];te&&Be.push("PROJECTION_GLOBE_VIEW"),ne[0]>0&&Be.push("FAUX_AO"),oe&&Be.push("ZERO_ROOF_RADIUS");for(const Fe of _){const Ne=c.getTile(Fe),Ze=Ne.getBucket(h);if(!Ze||Ze.projection.name!==O.projection.name)continue;const qe=Ze.programConfigurations.get(h.id),ot=g.useProgram(U?"fillExtrusionPattern":"fillExtrusion",qe,Be);if(g.terrain){const xt=g.terrain;if(g.style.terrainSetForDrapingOnly())xt.setupElevationDraw(Ne,ot,{useMeterToDem:!0});else{if(!Ze.enableTerrain)continue;if(xt.setupElevationDraw(Ne,ot,{useMeterToDem:!0}),Or(M,c,Fe,Ze,h,xt),!Ze.centroidVertexBuffer){const Ut=ot.attributes.a_centroid_pos;void 0!==Ut&&R.vertexAttrib2f(Ut,0,0)}}}U&&(g.context.activeTexture.set(R.TEXTURE0),Ne.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),qe.updatePaintBuffers());const Vt=F.constantOr(null);if(Vt&&Ne.imageAtlas){const xt=Ne.imageAtlas.patternPositions[Vt.toString()];xt&&qe.setConstantPatternPositions(xt)}const nt=g.translatePosMatrix(Fe.projMatrix,Ne,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Tt=O.projection.createInversionMatrix(O,Fe.canonical),ht=h.paint.get("fill-extrusion-vertical-gradient"),jt=U?Bt(nt,g,ht,J,ne,ue,Fe,Ne,$,me,_e,Tt):$h(nt,g,ht,J,ne,ue,Fe,$,me,_e,Tt);g.prepareDrawProgram(M,ot,Fe.toUnwrapped());const it=[];g.terrain&&it.push(Ze.centroidVertexBuffer),te&&it.push(Ze.layoutVertexExtBuffer),ot.draw(M,M.gl.TRIANGLES,x,S,D,p.CullFaceMode.backCCW,jt,h.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,h.paint,g.transform.zoom,qe,it)}}function Or(g,c,h,_,x,S){const D=[$=>{let te=$.canonical.x-1,me=$.wrap;return te<0&&(te=(1<<$.canonical.z)-1,me--),new p.OverscaledTileID($.overscaledZ,me,$.canonical.z,te,$.canonical.y)},$=>{let te=$.canonical.x+1,me=$.wrap;return te===1<<$.canonical.z&&(te=0,me++),new p.OverscaledTileID($.overscaledZ,me,$.canonical.z,te,$.canonical.y)},$=>new p.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,(0===$.canonical.y?1<<$.canonical.z:$.canonical.y)-1),$=>new p.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y===(1<<$.canonical.z)-1?0:$.canonical.y+1)],M=$=>{const te=c.getSource().minzoom,me=Be=>{const Fe=c.getTileByID(Be);if(Fe&&Fe.hasData())return Fe.getBucket(x)},_e=[0,-1,1];for(const Be of _e){if($.overscaledZ+Be<te)continue;const Fe=me($.calculateScaledKey($.overscaledZ+Be));if(Fe)return Fe}},R=[0,0,0],O=($,te)=>(R[0]=Math.min($.min.y,te.min.y),R[1]=Math.max($.max.y,te.max.y),R[2]=p.EXTENT-te.min.x>$.max.x?te.min.x-p.EXTENT:$.max.x,R),F=($,te)=>(R[0]=Math.min($.min.x,te.min.x),R[1]=Math.max($.max.x,te.max.x),R[2]=p.EXTENT-te.min.y>$.max.y?te.min.y-p.EXTENT:$.max.y,R),U=[($,te)=>O($,te),($,te)=>O(te,$),($,te)=>F($,te),($,te)=>F(te,$)],J=new p.Point(0,0);let ne,le,oe;const ue=($,te,me,_e,Be)=>{const Fe=[[_e?me:$,_e?$:me,0],[_e?me:te,_e?te:me,0]],Ne=Be<0?p.EXTENT+Be:Be,Ze=[_e?Ne:($+te)/2,_e?($+te)/2:Ne,0];return 0===me&&Be<0||0!==me&&Be>0?S.getForTilePoints(oe,[Ze],!0,le):Fe.push(Ze),S.getForTilePoints(h,Fe,!0,ne),Math.max(Fe[0][2],Fe[1][2],Ze[2])/S.exaggeration()};for(let $=0;$<4;$++){const te=($<2?1:5)-$,me=_.borders[$];if(0===me.length)continue;const _e=oe=D[$](h),Be=M(_e);if(!(Be&&Be instanceof p.FillExtrusionBucket&&Be.enableTerrain)||_.borderDoneWithNeighborZ[$]===Be.canonical.z&&Be.borderDoneWithNeighborZ[te]===_.canonical.z||(le=S.findDEMTileFor(_e),!le||!le.dem))continue;if(!ne){const qe=S.findDEMTileFor(h);if(!qe||!qe.dem)return;ne=qe}const Fe=Be.borders[te];let Ne=0;const Ze=Be.borderDoneWithNeighborZ[te]!==_.canonical.z;if(_.canonical.z===Be.canonical.z){for(let qe=0;qe<me.length;qe++){const ot=_.featuresOnBorder[me[qe]],Vt=ot.borders[$];let nt;for(;Ne<Fe.length&&(nt=Be.featuresOnBorder[Fe[Ne]],!(nt.borders[te][1]>Vt[0]+3));)Ze&&Be.encodeCentroid(void 0,nt,!1),Ne++;if(nt&&Ne<Fe.length){const Tt=Ne;let ht=0;for(;!(nt.borders[te][0]>Vt[1]-3)&&(ht++,++Ne!==Fe.length);)nt=Be.featuresOnBorder[Fe[Ne]];if(nt=Be.featuresOnBorder[Fe[Tt]],ot.intersectsCount()>1||nt.intersectsCount()>1||1!==ht){1!==ht&&(Ne=Tt),_.encodeCentroid(void 0,ot,!1),Ze&&Be.encodeCentroid(void 0,nt,!1);continue}const jt=U[$](ot,nt),it=$%2?p.EXTENT-1:0;J.x=ue(jt[0],Math.min(p.EXTENT-1,jt[1]),it,$<2,jt[2]),J.y=0,_.encodeCentroid(J,ot,!1),Ze&&Be.encodeCentroid(J,nt,!1)}else _.encodeCentroid(void 0,ot,!1)}_.borderDoneWithNeighborZ[$]=Be.canonical.z,_.needsCentroidUpdate=!0,Ze&&(Be.borderDoneWithNeighborZ[te]=_.canonical.z,Be.needsCentroidUpdate=!0)}else{for(const qe of me)_.encodeCentroid(void 0,_.featuresOnBorder[qe],!1);if(Ze){for(const qe of Fe)Be.encodeCentroid(void 0,Be.featuresOnBorder[qe],!1);Be.borderDoneWithNeighborZ[te]=_.canonical.z,Be.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[$]=Be.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(g)}const Eu=new p.Color(1,0,0,1),g_=new p.Color(0,1,0,1),Os=new p.Color(0,0,1,1),La=new p.Color(1,0,1,1),cf=new p.Color(0,1,1,1);function Gh(g,c,h){const _=g.context,x=g.transform,S=_.gl,D="globe"===x.projection.name,M=D?["PROJECTION_GLOBE_VIEW"]:null;let R=h.projMatrix;if(D&&p.globeToMercatorTransition(x.zoom)>0){const ot=p.transitionTileAABBinECEF(h.canonical,x),Vt=p.globeDenormalizeECEF(ot);R=p.multiply(new Float32Array(16),x.globeMatrix,Vt),p.multiply(R,x.projMatrix,R)}const O=g.useProgram("debug",null,M),F=c.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(F,O);const U=p.DepthMode.disabled,J=p.StencilMode.disabled,ne=g.colorModeForRenderPass();_.activeTexture.set(S.TEXTURE0),g.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),D?F._makeGlobeTileDebugBuffers(g.context,x):F._makeDebugTileBoundsBuffers(g.context,x.projection);const oe=F._tileDebugBuffer||g.debugBuffer,ue=F._tileDebugIndexBuffer||g.debugIndexBuffer,$=F._tileDebugSegments||g.debugSegments;O.draw(_,S.LINE_STRIP,U,J,ne,p.CullFaceMode.disabled,nc(R,p.Color.red),"$debug",oe,ue,$,null,null,null,[F._globeTileDebugBorderBuffer]);const te=F.latestRawTileData,me=Math.floor((te&&te.byteLength||0)/1024),_e=c.getTile(h).tileSize,Be=512/Math.min(_e,512)*(h.overscaledZ/x.zoom)*.5;let Fe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Fe+=` => ${h.overscaledZ}`),Fe+=` ${me}kb`,function(ot,Vt){ot.initDebugOverlayCanvas();const nt=ot.debugOverlayCanvas,Tt=ot.context.gl,ht=ot.debugOverlayCanvas.getContext("2d");ht.clearRect(0,0,nt.width,nt.height),ht.shadowColor="white",ht.shadowBlur=2,ht.lineWidth=1.5,ht.strokeStyle="white",ht.textBaseline="top",ht.font="bold 36px Open Sans, sans-serif",ht.fillText(Vt,5,5),ht.strokeText(Vt,5,5),ot.debugOverlayTexture.update(nt),ot.debugOverlayTexture.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE)}(g,Fe);const Ne=F._tileDebugTextBuffer||g.debugBuffer,Ze=F._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,qe=F._tileDebugTextSegments||g.debugSegments;O.draw(_,S.TRIANGLES,U,J,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,nc(R,p.Color.transparent,Be),"$debug",Ne,Ze,qe,null,null,null,[F._globeTileDebugTextBuffer])}function Rd(g,c,h,_){Du(g,0,c+h/2,g.transform.width,h,_)}function Fs(g,c,h,_){Du(g,c-h/2,0,h,g.transform.height,_)}function Du(g,c,h,_,x,S){const D=g.context,M=D.gl;M.enable(M.SCISSOR_TEST),M.scissor(c*p.exported.devicePixelRatio,h*p.exported.devicePixelRatio,_*p.exported.devicePixelRatio,x*p.exported.devicePixelRatio),D.clear({color:S}),M.disable(M.SCISSOR_TEST)}const b_=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Jm}=b_;function Al(g,c,h,_){g.emplaceBack(c,h,_)}class uf{constructor(c){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,Al(this.vertexArray,-1,-1,1),Al(this.vertexArray,1,-1,1),Al(this.vertexArray,-1,1,1),Al(this.vertexArray,1,1,1),Al(this.vertexArray,-1,-1,-1),Al(this.vertexArray,1,-1,-1),Al(this.vertexArray,-1,1,-1),Al(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Jm),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function Oa(g,c,h,_,x,S){const D=g.gl,M=c.paint.get("sky-atmosphere-color"),R=c.paint.get("sky-atmosphere-halo-color"),O=c.paint.get("sky-atmosphere-sun-intensity"),F={u_matrix_3f:p.fromMat4(p.create$1(),_),u_sun_direction:x,u_sun_intensity:O,u_color_tint_r:[(le=M).r,le.g,le.b,le.a],u_color_tint_m:[(oe=R).r,oe.g,oe.b,oe.a],u_luminance:5e-5};var le,oe;D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+S,c.skyboxTexture,0),h.draw(g,D.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,F,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Wh=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class __{constructor(c){const h=new p.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new p.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(h,Wh.members),this.indexBuffer=c.createIndexBuffer(_),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Iu={symbol:function(g,c,h,_,x){if("translucent"!==g.renderPass)return;const S=p.StencilMode.disabled,D=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(M,R,O,F,U,J,ne){const le=R.transform,oe="map"===U,ue="map"===J;for(const $ of M){const te=F.getTile($),me=te.getBucket(O);if(!me||!me.text||!me.text.segments.get().length)continue;const _e=p.evaluateSizeForZoom(me.textSizeData,le.zoom),Be=Hr($,me.getProjection(),le),Fe=le.calculatePixelsToTileUnitsMatrix(te),Ne=_t(Be,te.tileID.canonical,ue,oe,le,me.getProjection(),Fe),Ze="none"!==O.layout.get("icon-text-fit")&&me.hasIconData();if(_e){const qe=Math.pow(2,le.zoom-te.tileID.overscaledZ);os(me,oe,ue,ne,p.symbolSize,le,Ne,$,qe,_e,Ze)}}}(_,g,h,c,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x),0!==h.paint.get("icon-opacity").constantOr(1)&&Uc(g,c,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),S,D),0!==h.paint.get("text-opacity").constantOr(1)&&Uc(g,c,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),S,D),c.map.showCollisionBoxes&&(ll(g,c,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),ll(g,c,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,h,_){if("translucent"!==g.renderPass)return;const x=h.paint.get("circle-opacity"),S=h.paint.get("circle-stroke-width"),D=h.paint.get("circle-stroke-opacity"),M=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===S.constantOr(1)||0===D.constantOr(1)))return;const R=g.context,O=R.gl,F=g.transform,U=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),J=p.StencilMode.disabled,ne=g.colorModeForRenderPass(),le="globe"===F.projection.name,oe=[p.mercatorXfromLng(F.center.lng),p.mercatorYfromLat(F.center.lat)],ue=[];for(let te=0;te<_.length;te++){const me=_[te],_e=c.getTile(me),Be=_e.getBucket(h);if(!Be||Be.projection.name!==F.projection.name)continue;const Fe=Be.programConfigurations.get(h.id),Ne=Tu(h);le&&Ne.push("PROJECTION_GLOBE_VIEW");const Ze=g.useProgram("circle",Fe,Ne),qe=Be.layoutVertexBuffer,ot=Be.globeExtVertexBuffer,Vt=Be.indexBuffer,nt=F.projection.createInversionMatrix(F,me.canonical),Tt={programConfiguration:Fe,program:Ze,layoutVertexBuffer:qe,globeExtVertexBuffer:ot,indexBuffer:Vt,uniformValues:xs(g,me,_e,nt,oe,h),tile:_e};if(M){const ht=Be.segments.get();for(const jt of ht)ue.push({segments:new p.SegmentVector([jt]),sortKey:jt.sortKey,state:Tt})}else ue.push({segments:Be.segments,sortKey:0,state:Tt})}M&&ue.sort((te,me)=>te.sortKey-me.sortKey);const $={useDepthForOcclusion:!le};for(const te of ue){const{programConfiguration:me,program:_e,layoutVertexBuffer:Be,globeExtVertexBuffer:Fe,indexBuffer:Ne,uniformValues:Ze,tile:qe}=te.state,ot=te.segments;g.terrain&&g.terrain.setupElevationDraw(qe,_e,$),g.prepareDrawProgram(R,_e,qe.tileID.toUnwrapped()),_e.draw(R,O.TRIANGLES,U,J,ne,p.CullFaceMode.disabled,Ze,h.id,Be,Ne,ot,h.paint,F.zoom,me,[Fe])}},heatmap:function(g,c,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const x=g.context,S=x.gl,D=p.StencilMode.disabled,M=new p.ColorMode([S.ONE,S.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(ne,le,oe,ue){const $=ne.gl,te=le.width*ue,me=le.height*ue;ne.activeTexture.set($.TEXTURE1),ne.viewport.set([0,0,te,me]);let _e=oe.heatmapFbo;if(!_e||_e&&(_e.width!==te||_e.height!==me)){_e&&_e.destroy();const Be=$.createTexture();$.bindTexture($.TEXTURE_2D,Be),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),_e=oe.heatmapFbo=ne.createFramebuffer(te,me,!1),function(Fe,Ne,Ze,qe,ot,Vt){const nt=Fe.gl;nt.texImage2D(nt.TEXTURE_2D,0,Fe.isWebGL2&&Fe.extRenderToTextureHalfFloat?nt.RGBA16F:nt.RGBA,ot,Vt,0,nt.RGBA,Fe.extRenderToTextureHalfFloat?Fe.isWebGL2?nt.HALF_FLOAT:Fe.extTextureHalfFloat.HALF_FLOAT_OES:nt.UNSIGNED_BYTE,null),qe.colorAttachment.set(Ze)}(ne,0,Be,_e,te,me)}else $.bindTexture($.TEXTURE_2D,_e.colorAttachment.get()),ne.bindFramebuffer.set(_e.framebuffer)})(x,g,h,"globe"===g.transform.projection.name?.5:.25),x.clear({color:p.Color.transparent});const R=g.transform,O="globe"===R.projection.name,F=O?["PROJECTION_GLOBE_VIEW"]:null,U=O?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,J=[p.mercatorXfromLng(R.center.lng),p.mercatorYfromLat(R.center.lat)];for(let ne=0;ne<_.length;ne++){const le=_[ne];if(c.hasRenderableParent(le))continue;const oe=c.getTile(le),ue=oe.getBucket(h);if(!ue||ue.projection.name!==R.projection.name)continue;const $=ue.programConfigurations.get(h.id),te=g.useProgram("heatmap",$,F),{zoom:me}=g.transform;g.terrain&&g.terrain.setupElevationDraw(oe,te),g.prepareDrawProgram(x,te,le.toUnwrapped());const _e=R.projection.createInversionMatrix(R,le.canonical);te.draw(x,S.TRIANGLES,p.DepthMode.disabled,D,M,U,ic(g,le,oe,_e,J,me,h.paint.get("heatmap-intensity")),h.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,h.paint,g.transform.zoom,$,O?[ue.globeExtVertexBuffer]:null)}x.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(x,S){const D=x.context,M=D.gl,R=S.heatmapFbo;if(!R)return;D.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,R.colorAttachment.get()),D.activeTexture.set(M.TEXTURE1);let O=S.colorRampTexture;O||(O=S.colorRampTexture=new p.Texture(D,S.colorRamp,M.RGBA)),O.bind(M.LINEAR,M.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(D,M.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,x.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:S.paint.get("heatmap-opacity")},S.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,S.paint,x.transform.zoom)}(g,h))},line:function(g,c,h,_){if("translucent"!==g.renderPass)return;const x=h.paint.get("line-opacity"),S=h.paint.get("line-width");if(0===x.constantOr(1)||0===S.constantOr(1))return;const D=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),M=g.colorModeForRenderPass(),R=g.terrain&&g.terrain.renderingToTexture?1:p.exported.devicePixelRatio,O=h.paint.get("line-dasharray"),F=O.constantOr(1),U=h.layout.get("line-cap"),J=h.paint.get("line-pattern"),ne=J.constantOr(1),le=h.paint.get("line-gradient"),oe=ne?"linePattern":"line",ue=g.context,$=ue.gl,te=(_e=>{const Be=[];hi(_e)&&Be.push("RENDER_LINE_DASH"),_e.paint.get("line-gradient")&&Be.push("RENDER_LINE_GRADIENT");const Fe=_e.paint.get("line-trim-offset");0===Fe[0]&&0===Fe[1]||Be.push("RENDER_LINE_TRIM_OFFSET");const Ne=_e.paint.get("line-pattern").constantOr(1),Ze=1!==_e.paint.get("line-opacity").constantOr(1);return!Ne&&Ze&&Be.push("RENDER_LINE_ALPHA_DISCARD"),Be})(h);let me=te.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(me=!1);for(const _e of _){const Be=c.getTile(_e);if(ne&&!Be.patternsLoaded())continue;const Fe=Be.getBucket(h);if(!Fe)continue;g.prepareDrawTile();const Ne=Fe.programConfigurations.get(h.id),Ze=g.useProgram(oe,Ne,te),qe=J.constantOr(null);if(qe&&Be.imageAtlas){const xt=Be.imageAtlas.patternPositions[qe.toString()];xt&&Ne.setConstantPatternPositions(xt)}const ot=O.constantOr(null),Vt=U.constantOr(null);if(!ne&&ot&&Vt&&Be.lineAtlas){const xt=Be.lineAtlas.getDash(ot,Vt);xt&&Ne.setConstantPatternPositions(xt)}let[nt,Tt]=h.paint.get("line-trim-offset");("round"===Vt||"square"===Vt)&&nt!==Tt&&(0===nt&&(nt-=1),1===Tt&&(Tt+=1));const ht=g.terrain?_e.projMatrix:null,jt=ne?Md(g,Be,h,ht,R):rs(g,Be,h,ht,Fe.lineClipsArray.length,R,[nt,Tt]);if(le){const xt=Fe.gradients[h.id];let Ut=xt.texture;if(h.gradientVersion!==xt.version){let Rt=256;if(h.stepInterpolant){const $t=c.getSource().maxzoom,Mn=_e.canonical.z===$t?Math.ceil(1<<g.transform.maxZoom-_e.canonical.z):1;Rt=p.clamp(p.nextPowerOfTwo(Fe.maxLineLength/p.EXTENT*1024*Mn),256,ue.maxTextureSize)}xt.gradient=p.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Rt,image:xt.gradient||void 0,clips:Fe.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new p.Texture(ue,xt.gradient,$.RGBA),xt.version=h.gradientVersion,Ut=xt.texture}ue.activeTexture.set($.TEXTURE1),Ut.bind(h.stepInterpolant?$.NEAREST:$.LINEAR,$.CLAMP_TO_EDGE)}F&&(ue.activeTexture.set($.TEXTURE0),Be.lineAtlasTexture.bind($.LINEAR,$.REPEAT),Ne.updatePaintBuffers()),ne&&(ue.activeTexture.set($.TEXTURE0),Be.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Ne.updatePaintBuffers()),g.prepareDrawProgram(ue,Ze,_e.toUnwrapped());const it=xt=>{Ze.draw(ue,$.TRIANGLES,D,xt,M,p.CullFaceMode.disabled,jt,h.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,h.paint,g.transform.zoom,Ne,[Fe.layoutVertexBuffer2])};if(me){const xt=g.stencilModeForClipping(_e).ref;0===xt&&g.terrain&&ue.clear({stencil:0});const Ut={func:$.EQUAL,mask:255};jt.u_alpha_discard_threshold=.8,it(new p.StencilMode(Ut,xt,255,$.KEEP,$.KEEP,$.INVERT)),jt.u_alpha_discard_threshold=0,it(new p.StencilMode(Ut,xt,255,$.KEEP,$.KEEP,$.KEEP))}else it(g.stencilModeForClipping(_e))}me&&(g.resetStencilClippingMasks(),g.terrain&&ue.clear({stencil:0}))},fill:function(g,c,h,_){const x=h.paint.get("fill-color"),S=h.paint.get("fill-opacity");if(0===S.constantOr(1))return;const D=g.colorModeForRenderPass(),M=h.paint.get("fill-pattern"),R=g.opaquePassEnabledForLayer()&&!M.constantOr(1)&&1===x.constantOr(p.Color.transparent).a&&1===S.constantOr(0)?"opaque":"translucent";if(g.renderPass===R){const O=g.depthModeForSublayer(1,"opaque"===g.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Hc(g,c,h,_,O,D,!1)}if("translucent"===g.renderPass&&h.paint.get("fill-antialias")){const O=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Hc(g,c,h,_,O,D,!0)}},"fill-extrusion":function(g,c,h,_){const x=h.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===g.renderPass){const S=new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==x||h.paint.get("fill-extrusion-pattern").constantOr(1))kd(g,c,h,_,S,p.StencilMode.disabled,p.ColorMode.disabled),kd(g,c,h,_,S,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const D=g.colorModeForRenderPass();kd(g,c,h,_,S,p.StencilMode.disabled,D)}}},hillshade:function(g,c,h,_){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const x=g.context,S=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),D=g.colorModeForRenderPass(),M=g.terrain&&g.terrain.renderingToTexture,[R,O]="translucent"!==g.renderPass||M?[{},_]:g.stencilConfigForOverlap(_);for(const F of O){const U=c.getTile(F);if(U.needsHillshadePrepare&&"offscreen"===g.renderPass)Lr(g,U,h,S,p.StencilMode.disabled,D);else if("translucent"===g.renderPass){const J=M&&g.terrain?g.terrain.stencilModeForRTTOverlap(F):R[F.overscaledZ];m_(g,F,U,h,S,J,D)}}x.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,h,_,x,S){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity")||!_.length)return;const D=g.context,M=D.gl,R=c.getSource(),O=g.useProgram("raster"),F=g.colorModeForRenderPass(),U=g.terrain&&g.terrain.renderingToTexture,[J,ne]=R instanceof mi||U?[{},_]:g.stencilConfigForOverlap(_),le=ne[ne.length-1].overscaledZ,oe=!g.options.moving;for(const ue of ne){const $=U?p.DepthMode.disabled:g.depthModeForSublayer(ue.overscaledZ-le,1===h.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,M.LESS),te=ue.toUnwrapped(),me=c.getTile(ue);if(U&&(!me||!me.hasData()))continue;const _e=U?ue.projMatrix:g.transform.calculateProjMatrix(te,oe),Be=g.terrain&&U?g.terrain.stencilModeForRTTOverlap(ue):J[ue.overscaledZ],Fe=S?0:h.paint.get("raster-fade-duration");me.registerFadeDuration(Fe);const Ne=c.findLoadedParent(ue,0),Ze=Bc(me,Ne,c,g.transform,Fe);let qe,ot;g.terrain&&g.terrain.prepareDrawTile();const Vt="nearest"===h.paint.get("raster-resampling")?M.NEAREST:M.LINEAR;D.activeTexture.set(M.TEXTURE0),me.texture.bind(Vt,M.CLAMP_TO_EDGE),D.activeTexture.set(M.TEXTURE1),Ne?(Ne.texture.bind(Vt,M.CLAMP_TO_EDGE),qe=Math.pow(2,Ne.tileID.overscaledZ-me.tileID.overscaledZ),ot=[me.tileID.canonical.x*qe%1,me.tileID.canonical.y*qe%1]):me.texture.bind(Vt,M.CLAMP_TO_EDGE),me.texture.useMipmap&&D.extTextureFilterAnisotropic&&g.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const nt=Br(_e,ot||[0,0],qe||1,Ze,h,R instanceof mi?R.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(D,O,te),R instanceof mi)R.boundsBuffer&&R.boundsSegments&&O.draw(D,M.TRIANGLES,$,p.StencilMode.disabled,F,p.CullFaceMode.disabled,nt,h.id,R.boundsBuffer,g.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:Tt,tileBoundsIndexBuffer:ht,tileBoundsSegments:jt}=g.getTileBoundsBuffers(me);O.draw(D,M.TRIANGLES,$,Be,F,p.CullFaceMode.disabled,nt,h.id,Tt,ht,jt)}}g.resetStencilClippingMasks()},background:function(g,c,h,_){const x=h.paint.get("background-color"),S=h.paint.get("background-opacity");if(0===S)return;const D=g.context,M=D.gl,R=g.transform,O=R.tileSize,F=h.paint.get("background-pattern");if(g.isPatternMissing(F))return;const U=!F&&1===x.a&&1===S&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==U)return;const J=p.StencilMode.disabled,ne=g.depthModeForSublayer(0,"opaque"===U?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),le=g.colorModeForRenderPass(),oe=g.useProgram(F?"backgroundPattern":"background");let ue,$=_;$||(ue=g.getBackgroundTiles(),$=Object.values(ue).map(te=>te.tileID)),F&&(D.activeTexture.set(M.TEXTURE0),g.imageManager.bind(g.context));for(const te of $){const me=te.toUnwrapped(),_e=_?te.projMatrix:g.transform.calculateProjMatrix(me);g.prepareDrawTile();const Be=c?c.getTile(te):ue?ue[te.key]:new p.Tile(te,O,R.zoom,g),Fe=F?Ad(_e,S,g,F,{tileID:te,tileSize:O}):zc(_e,S,x);g.prepareDrawProgram(D,oe,me);const{tileBoundsBuffer:Ne,tileBoundsIndexBuffer:Ze,tileBoundsSegments:qe}=g.getTileBoundsBuffers(Be);oe.draw(D,M.TRIANGLES,ne,J,le,p.CullFaceMode.disabled,Fe,h.id,Ne,Ze,qe)}},sky:function(g,c,h){const _=g.transform,x="mercator"===_.projection.name||"globe"===_.projection.name?1:p.smoothstep(7,8,_.zoom),S=h.paint.get("sky-opacity")*x;if(0===S)return;const D=g.context,M=h.paint.get("sky-type"),R=new p.DepthMode(D.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),O=g.frameCounter/1e3%1;"atmosphere"===M?"offscreen"===g.renderPass?h.needsSkyboxCapture(g)&&(function(F,U,J,ne){const le=F.context,oe=le.gl;let ue=U.skyboxFbo;if(!ue){ue=U.skyboxFbo=le.createFramebuffer(32,32,!1),U.skyboxGeometry=new uf(le),U.skyboxTexture=le.gl.createTexture(),oe.bindTexture(oe.TEXTURE_CUBE_MAP,U.skyboxTexture),oe.texParameteri(oe.TEXTURE_CUBE_MAP,oe.TEXTURE_WRAP_S,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_CUBE_MAP,oe.TEXTURE_WRAP_T,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_CUBE_MAP,oe.TEXTURE_MIN_FILTER,oe.LINEAR),oe.texParameteri(oe.TEXTURE_CUBE_MAP,oe.TEXTURE_MAG_FILTER,oe.LINEAR);for(let _e=0;_e<6;++_e)oe.texImage2D(oe.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,oe.RGBA,32,32,0,oe.RGBA,oe.UNSIGNED_BYTE,null)}le.bindFramebuffer.set(ue.framebuffer),le.viewport.set([0,0,32,32]);const $=U.getCenter(F,!0),te=F.useProgram("skyboxCapture"),me=new Float64Array(16);p.identity(me),p.rotateY(me,me,.5*-Math.PI),Oa(le,U,te,me,$,0),p.identity(me),p.rotateY(me,me,.5*Math.PI),Oa(le,U,te,me,$,1),p.identity(me),p.rotateX(me,me,.5*-Math.PI),Oa(le,U,te,me,$,2),p.identity(me),p.rotateX(me,me,.5*Math.PI),Oa(le,U,te,me,$,3),p.identity(me),Oa(le,U,te,me,$,4),p.identity(me),p.rotateY(me,me,Math.PI),Oa(le,U,te,me,$,5),le.viewport.set([0,0,F.width,F.height])}(g,h),h.markSkyboxValid(g)):"sky"===g.renderPass&&function(F,U,J,ne,le){const oe=F.context,ue=oe.gl,$=F.transform,te=F.useProgram("skybox");oe.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_CUBE_MAP,U.skyboxTexture);const me={u_matrix:$.skyboxMatrix,u_sun_direction:U.getCenter(F,!1),u_cubemap:0,u_opacity:ne,u_temporal_offset:le};F.prepareDrawProgram(oe,te),te.draw(oe,ue.TRIANGLES,J,p.StencilMode.disabled,F.colorModeForRenderPass(),p.CullFaceMode.backCW,me,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(g,h,R,S,O):"gradient"===M&&"sky"===g.renderPass&&function(F,U,J,ne,le){const oe=F.context,ue=oe.gl,$=F.transform,te=F.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new uf(oe)),oe.activeTexture.set(ue.TEXTURE0);let me=U.colorRampTexture;me||(me=U.colorRampTexture=new p.Texture(oe,U.colorRamp,ue.RGBA)),me.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const _e=(Be=$.skyboxMatrix,Fe=U.getCenter(F,!1),Ne=U.paint.get("sky-gradient-radius"),Ze=ne,qe=le,{u_matrix:Be,u_color_ramp:0,u_center_direction:Fe,u_radius:p.degToRad(Ne),u_opacity:Ze,u_temporal_offset:qe});var Be,Fe,Ne,Ze,qe;F.prepareDrawProgram(oe,te),te.draw(oe,ue.TRIANGLES,J,p.StencilMode.disabled,F.colorModeForRenderPass(),p.CullFaceMode.backCW,_e,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(g,h,R,S,O)},debug:function(g,c,h){for(let _=0;_<h.length;_++)Gh(g,c,h[_])},custom:function(g,c,h,_){const x=g.context,S=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||"offscreen"===g.renderPass)&&h.isLayerDraped()){if("offscreen"===g.renderPass){const D=S.prerender;if(D){if(g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),"globe"===g.transform.projection.name){const M=g.transform.pointMerc;D.call(S,x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[M.x,M.y],g.transform.pixelsPerMeterRatio)}else D.call(S,x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState()}}else if("translucent"===g.renderPass){if(g.terrain&&g.terrain.renderingToTexture){const M=S.renderToTile;if(M){const R=_[0].canonical,O=new p.MercatorCoordinate(R.x+_[0].wrap*(1<<R.z),R.y,R.z);x.setDepthMode(p.DepthMode.disabled),x.setStencilMode(p.StencilMode.disabled),x.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),M.call(S,x.gl,O),x.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),x.setStencilMode(p.StencilMode.disabled);const D="3d"===S.renderingMode?new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(x.setDepthMode(D),"globe"===g.transform.projection.name){const M=g.transform.pointMerc;S.render(x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[M.x,M.y],g.transform.pixelsPerMeterRatio)}else S.render(x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState(),x.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Pd{constructor(c,h,_=!1){this.context=new Zt(c,_),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,h){const _=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Hh(this,c));const x=this._terrain;this.transform.elevation=_?x:null,x.update(c,this.transform,h)}_updateFog(c){const h=c.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=h.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const S=_+.78*(x-_);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,h){if(this.width=c*p.exported.devicePixelRatio,this.height=h*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const c=this.context,h=new p.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(p.EXTENT,0),h.emplaceBack(0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(p.EXTENT,0),_.emplaceBack(0,p.EXTENT),_.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=c.createVertexBuffer(_,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const x=new p.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(x,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const S=new p.StructArrayLayout4i8;S.emplaceBack(0,0,0,0),S.emplaceBack(p.EXTENT,0,p.EXTENT,0),S.emplaceBack(0,p.EXTENT,0,p.EXTENT),S.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(S,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const D=new p.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(D);const M=new p.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])M.emplaceBack(O);this.debugIndexBuffer=c.createIndexBuffer(M),this.emptyTexture=new p.Texture(c,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=p.create();const R=this.context.gl;this.stencilClearMode=new p.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new __(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,h.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,Xs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,h,_){if(!h||this.currentStencilSource===h.id||!c.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const R of _)if(void 0===this._tileClippingMaskIDs[R.key]){M=!0;break}if(!M)return}this.currentStencilSource=h.id;const x=this.context,S=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(p.ColorMode.disabled),x.setDepthMode(p.DepthMode.disabled);const D=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of _){const R=h.getTile(M),O=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:U,tileBoundsSegments:J}=this.getTileBoundsBuffers(R);D.draw(x,S.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:S.ALWAYS,mask:0},O,255,S.KEEP,S.KEEP,S.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Xs(M.projMatrix),"$clipping",F,U,J)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,h=this.context.gl;return new p.StencilMode({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const h=this.context.gl;return new p.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(c){const h=this.context.gl,_=c.sort((D,M)=>M.overscaledZ-D.overscaledZ),x=_[_.length-1].overscaledZ,S=_[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const D={};for(let M=0;M<S;M++)D[M+x]=new p.StencilMode({func:h.GEQUAL,mask:255},M+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=S,[D,_]}return[{[x]:p.StencilMode.disabled},_]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([c.CONSTANT_COLOR,c.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(c,h,_){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new p.DepthMode(_||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,h){this.style=c,this.options=h,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const _=this.style.order,x=this.style._sourceCaches;for(const O in x){const F=x[O];F.used&&F.prepare(this.context)}const S={},D={},M={};for(const O in x){const F=x[O];S[O]=F.getVisibleCoordinates(),D[O]=S[O].slice().reverse(),M[O]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<_.length;O++)if(this.style._layers[_[O]].is3D()){this.opaquePassCutoff=O;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const O of _){const F=this.style._layers[O],U=c._getLayerSourceCache(F);if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const J=U?D[U.id]:void 0;("custom"===F.type||F.isSky()||J&&J.length)&&this.renderLayer(this,U,F,J)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const R=this.terrain;if(R&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&R.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(O);if(O.isSky())continue;const U=F?D[F.id]:void 0;this._renderTileClippingMasks(O,F,U),this.renderLayer(this,F,O,U)}if(this.style.fog&&this.transform.projection.supportsFog&&function(O,F){const U=O.context,J=U.gl,ne=O.transform,le=new p.DepthMode(J.LEQUAL,p.DepthMode.ReadOnly,[0,1]),oe=O.useProgram("globeAtmosphere",null,"globe"===ne.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ue=p.globeToMercatorTransition(ne.zoom),$=F.properties.get("color").toArray01(),te=F.properties.get("high-color").toArray01(),me=F.properties.get("space-color").toArray01PremultipliedAlpha(),_e=p.identity$1([]);p.rotateY$1(_e,_e,-p.degToRad(ne._center.lng)),p.rotateX$1(_e,_e,p.degToRad(ne._center.lat)),p.rotateZ$1(_e,_e,ne.angle),p.rotateX$1(_e,_e,-ne._pitch);const Be=p.fromQuat(new Float32Array(16),_e),Fe=p.mapValue(F.properties.get("star-intensity"),0,1,0,.25),Ze=p.mapValue(F.properties.get("horizon-blend"),0,1,5e-4,.25),qe=p.globeUseCustomAntiAliasing(O,U,ne)&&5e-4===Ze?ne.worldSize/(2*Math.PI*1.025)-1:ne.globeRadius,ot=O.frameCounter/1e3%1,Vt=p.length(ne.globeCenterInViewSpace),nt=Math.sqrt(Math.pow(Vt,2)-Math.pow(qe,2)),Tt=Math.acos(nt/Vt),ht={u_frustum_tl:ne.frustumCorners.TL,u_frustum_tr:ne.frustumCorners.TR,u_frustum_br:ne.frustumCorners.BR,u_frustum_bl:ne.frustumCorners.BL,u_horizon:ne.frustumCorners.horizon,u_transition:ue,u_fadeout_range:Ze,u_color:$,u_high_color:te,u_space_color:me,u_star_intensity:Fe,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ot,u_horizon_angle:Tt,u_rotation_matrix:Be};O.prepareDrawProgram(U,oe);const jt=O.atmosphereBuffer;jt&&oe.draw(U,J.TRIANGLES,le,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,ht,"skybox",jt.vertexBuffer,jt.indexBuffer,jt.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const O=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(O);O.isSky()&&this.renderLayer(this,F,O,F?D[F.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const O=this.style._layers[_[this.currentLayer]],F=c._getLayerSourceCache(O);if(O.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(O)){if(O.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const U=F?("symbol"===O.type?M:D)[F.id]:void 0;this._renderTileClippingMasks(O,F,F?S[F.id]:void 0),this.renderLayer(this,F,O,U),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let O=null;p.values(this.style._layers).forEach(F=>{const U=c._getLayerSourceCache(F);U&&!F.isHidden(this.transform.zoom)&&(!O||O.getSource().maxzoom<U.getSource().maxzoom)&&(O=U)}),O&&this.options.showTileBoundaries&&Iu.debug(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const F=O.transform.padding;Rd(O,O.transform.height-(F.top||0),3,Eu),Rd(O,F.bottom||0,3,g_),Fs(O,F.left||0,3,Os),Fs(O,O.transform.width-(F.right||0),3,La);const U=O.transform.centerPoint;var J,ne,le,oe;Du(J=O,(ne=U.x)-1,(le=O.transform.height-U.y)-10,2,20,oe=cf),Du(J,ne-10,le-1,20,2,oe)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,h,_,x){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(_.type)||c.terrain&&"custom"===_.type)&&Iu[_.type](c,h,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[c.id];_||(_=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,h=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),c.beginQueryEXT(c.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const h={};for(const _ in c){const x=c[_],S=this.context.extTimerQuery,D=S.getQueryObjectEXT(x.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(x.query),h[_]=D}return h}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let _=0;for(const x of c)_+=h.getQueryObjectEXT(x,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(x);return _}translatePosMatrix(c,h,_,x,S){if(!_[0]&&!_[1])return c;const D=S?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(D){const O=Math.sin(D),F=Math.cos(D);_=[_[0]*F-_[1]*O,_[0]*O+_[1]*F]}const M=[S?_[0]:cn(h,_[0],this.transform.zoom),S?_[1]:cn(h,_[1],this.transform.zoom),0],R=new Float32Array(16);return p.translate(R,c,M),R}saveTileTexture(c){const h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const h=this._tileTextures[c];return h&&h.length>0?h.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&0===this.terrain.exaggeration(),_=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),"globe"===this.transform.projection.name&&x.push("GLOBE"),h&&x.push("ZERO_EXAGGERATION"),_&&!c&&0!==_.getOpacity(this.transform.pitch)&&x.push("FOG"),c&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(c,h,_){this.cache=this.cache||{};const x=_||[],S=this.currentGlobalDefines().concat(x),D=Vi.cacheKey(jh[c],c,S,h);return this.cache[D]||(this.cache[D]=new Vi(this.context,c,jh[c],h,Ei[c],S)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const S=x.getOpacity(this.transform.pitch),D=((M,R,O,F,U,J,ne,le,oe,ue,$)=>{const te=M.transform,me=R.properties.get("color").toArray01();me[3]=F;const _e=M.frameCounter/1e3%1;return{u_fog_matrix:O?te.calculateFogTileMatrix(O):M.identityMat,u_fog_range:R.getFovAdjustedRange(te._fov),u_fog_color:me,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:_e,u_frustum_tl:U,u_frustum_tr:J,u_frustum_br:ne,u_frustum_bl:le,u_globe_pos:oe,u_globe_radius:ue,u_viewport:$,u_globe_transition:p.globeToMercatorTransition(te.zoom),u_is_globe:+("globe"===te.projection.name)}})(this,x,_,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);h.setFogUniformValues(c,D)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,h=c.createTexture();return c.bindTexture(c.TEXTURE_2D,h),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)h[x.key]=c[x.key]||new p.Tile(x,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class df{constructor(c=0,h=0,_=0,x=0){if(isNaN(c)||c<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=_,this.right=x}interpolate(c,h,_){return null!=h.top&&null!=c.top&&(this.top=p.number(c.top,h.top,_)),null!=h.bottom&&null!=c.bottom&&(this.bottom=p.number(c.bottom,h.bottom,_)),null!=h.left&&null!=c.left&&(this.left=p.number(c.left,h.left,_)),null!=h.right&&null!=c.right&&(this.right=p.number(c.right,h.right,_)),this}getCenter(c,h){const _=p.clamp((this.left+c-this.right)/2,0,c),x=p.clamp((this.top+h-this.bottom)/2,0,h);return new p.Point(_,x)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new df(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function hf(g,c){const h=p.getColumn(g,3);p.fromQuat(g,c),p.setColumn(g,3,h)}function Ki(g,c){const h=p.identity$1([]);return p.rotateZ$1(h,h,-c),p.rotateX$1(h,h,-g),h}function Xh(g,c){const h=[g[0],g[1],0],_=[c[0],c[1],0];if(p.length(h)>=1e-15){const D=p.normalize([],h);p.scale$2(_,D,p.dot(_,D)),c[0]=_[0],c[1]=_[1]}const x=p.cross([],c,g);if(p.len(x)<1e-15)return null;const S=Math.atan2(-x[1],x[0]);return Ki(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),S)}class y_{constructor(c,h){this.position=c,this.orientation=h}get position(){return this._position}set position(c){if(c){const h=c instanceof p.MercatorCoordinate?c:new p.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(h.x=p.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(c,h){if(this.orientation=null,!this.position)return;const _=this.position,x=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(c)):0,S=p.MercatorCoordinate.fromLngLat(c,x),D=[S.x-_.x,S.y-_.y,S.z-_.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Xh(D,h)}setPitchBearing(c,h){this.orientation=Ki(p.degToRad(c),p.degToRad(-h))}}class pf{constructor(c,h){this._transform=p.identity([]),this.orientation=h,this.position=c}get mercatorPosition(){const c=this.position;return new p.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=p.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var h;c&&p.setColumn(this._transform,3,[(h=c)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||p.identity$1([]),c&&hf(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,h){this._orientation=Ki(c,h),hf(this._transform,this._orientation)}forward(){const c=p.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=p.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=p.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,h){const _=new Float64Array(16);return p.invert(_,this.getWorldToCamera(c,h)),_}getWorldToCameraPosition(c,h,_){const x=this.position;p.scale$2(x,x,-c);const S=new Float64Array(16);return p.fromScaling(S,[_,_,_]),p.translate(S,S,x),S[10]*=h,S}getWorldToCamera(c,h){const _=new Float64Array(16),x=new Float64Array(4),S=this.position;return p.conjugate(x,this._orientation),p.scale$2(S,S,-c),p.fromQuat(_,x),p.translate(_,_,S),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(c,h,_,x){const S=new Float64Array(16);return p.perspective(S,c,h,_,x),S}getDistanceToElevation(c,h=!1){const _=0===c?0:p.mercatorZfromAltitude(c,h?p.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(_-this.position[2])/x[2]}clone(){return new pf([...this.position],[...this.orientation])}}function Ld(g,c){const h=Od(g.projection,g.zoom,g.width,g.height),_=function(S,D,M,R,O){const F=new p.LngLat(M.lng-180*Fa,M.lat),U=new p.LngLat(M.lng+180*Fa,M.lat),J=S.project(F.lng,F.lat),ne=S.project(U.lng,U.lat),le=-Math.atan2(ne.y-J.y,ne.x-J.x),oe=p.MercatorCoordinate.fromLngLat(M);oe.y=p.clamp(oe.y,-1+Fa,1-Fa);const ue=oe.toLngLat(),$=S.project(ue.lng,ue.lat),te=p.MercatorCoordinate.fromLngLat(ue);te.x+=Fa;const me=te.toLngLat(),_e=S.project(me.lng,me.lat),Be=ff(_e.x-$.x,_e.y-$.y,le),Fe=p.MercatorCoordinate.fromLngLat(ue);Fe.y+=Fa;const Ne=Fe.toLngLat(),Ze=S.project(Ne.lng,Ne.lat),qe=ff(Ze.x-$.x,Ze.y-$.y,le),ot=Math.abs(Be.x)/Math.abs(qe.y),Vt=p.identity([]);p.rotateZ(Vt,Vt,-le*(1-(O?0:R)));const nt=p.identity([]);return p.scale(nt,nt,[1,1-(1-ot)*R,1]),nt[4]=-qe.x/qe.y*R,p.rotateZ(nt,nt,le),p.multiply(nt,Vt,nt),nt}(g.projection,0,g.center,h,c),x=v_(g);return p.scale(_,_,[x,x,1]),_}function v_(g){const c=g.projection,h=Od(g.projection,g.zoom,g.width,g.height),_=x_(c,g.center),x=x_(c,p.LngLat.convert(c.center));return Math.pow(2,_*h+(1-h)*x)}function Od(g,c,h,_,x=1/0){const S=g.range;if(!S)return 0;const D=Math.min(x,Math.max(h,_)),M=Math.log(D/1024)/Math.LN2;return p.smoothstep(S[0]+M,S[1]+M,c)}const Fa=1/4e4;function x_(g,c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=new p.LngLat(c.lng-180*Fa,h),x=new p.LngLat(c.lng+180*Fa,h),S=g.project(_.lng,h),D=g.project(x.lng,h),M=p.MercatorCoordinate.fromLngLat(_),R=p.MercatorCoordinate.fromLngLat(x),O=D.x-S.x,F=D.y-S.y,U=R.x-M.x,J=R.y-M.y,ne=Math.sqrt((U*U+J*J)/(O*O+F*F));return Math.log(ne)/Math.LN2}function ff(g,c,h){const _=Math.cos(h),x=Math.sin(h);return{x:g*_-c*x,y:g*x+c*_}}class Fd{constructor(c,h,_,x,S,D,M){this.tileSize=512,this._renderWorldCopies=void 0===S||S,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=null==_?0:_,this._maxPitch=null==x?60:x,this.setProjection(D),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new df,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new pf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new Fd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,h=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(c||_)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const _=!ie(h,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const h=c!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const h=-c*Math.PI/180;var _,x,S,D,M,R,O,F,U,J;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),x=this.rotationMatrix,D=this.angle,M=(S=this.rotationMatrix)[0],R=S[1],O=S[2],F=S[3],U=Math.sin(D),J=Math.cos(D),x[0]=M*J+O*U,x[1]=R*J+F*U,x[2]=M*-U+O*J,x[3]=R*-U+F*J)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const h=p.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=p.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,S=0;for(let D=0;D<h.length;D++){const M=new p.Point(h[D][0]*this.width,_+h[D][1]*(this.height-_)),R=c.pointCoordinate(M);if(!R)continue;const O=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);x+=R[3]*O,S+=O}return 0===S?NaN:x/S}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,x=this._mercatorZfromZoom(c),S=this._mercatorZfromZoom(this._maxZoom),D=Math.max(x-_,S);this._setZoom(this._zoomFromMercatorZ(D))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let _;_=c.z<this._camera.position[2]?[h.x,h.y,h.z]:[c.x,c.y,c.z];const x=p.length(p.sub([],this._camera.position,_));return p.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let h=!1;if(c.orientation&&!p.exactEquals(c.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(c.orientation)),c.position){const _=[c.position.x,c.position.y,c.position.z];p.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,h=new y_;return h.position=new p.MercatorCoordinate(c[0],c[1],c[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(c){if(!p.length$1(c))return!1;p.normalize$1(c,c);const h=p.transformQuat([],[0,0,-1],c),_=p.transformQuat([],[0,-1,0],c);if(_[2]<0)return!1;const x=Xh(h,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(c){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;c[2]=p.clamp(c[2],x/_,x/h),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,h,_){this._unmodified=!1,this._edgeInsets.interpolate(c,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(c){const h=[new p.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const _=this.pointCoordinate(new p.Point(0,0)),x=this.pointCoordinate(new p.Point(this.width,0)),S=this.pointCoordinate(new p.Point(this.width,this.height)),D=this.pointCoordinate(new p.Point(0,this.height)),M=Math.floor(Math.min(_.x,x.x,S.x,D.x)),R=Math.floor(Math.max(_.x,x.x,S.x,D.x)),O=1;for(let F=M-O;F<=R+O;F++)0!==F&&h.push(new p.UnwrappedTileID(F,c))}return h}coveringTiles(c){let h=this.coveringZoomLevel(c);const _=h,x=this.elevation&&!c.isTerrainDEM,S="mercator"===this.projection.name;if(void 0!==c.minzoom&&h<c.minzoom)return[];void 0!==c.maxzoom&&h>c.maxzoom&&(h=c.maxzoom);const D=this.locationCoordinate(this.center),M=this.center.lat,R=1<<h,O=[R*D.x,R*D.y,0],F="globe"===this.projection.name,U=!F,J=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,U),ne=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),le=R*p.mercatorZfromAltitude(1,this.center.lat),oe=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),ue=[R*ne.x,R*ne.y,oe*(U?1:le)],$=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,me=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,_e=c.isTerrainDEM?-me:this._elevation?this._elevation.getMinElevationBelowMSL():0,Be=this.projection.isReprojectedInTileSpace?v_(this):1,Fe=it=>{const Ut=new p.MercatorCoordinate(it.x+25e-6,it.y,it.z),Rt=new p.MercatorCoordinate(it.x,it.y+25e-6,it.z),$t=it.toLngLat(),Mn=Ut.toLngLat(),jn=Rt.toLngLat(),_n=this.locationCoordinate($t),Rn=this.locationCoordinate(Mn),_i=this.locationCoordinate(jn),ai=Math.hypot(Rn.x-_n.x,Rn.y-_n.y),Dn=Math.hypot(_i.x-_n.x,_i.y-_n.y);return Math.sqrt(ai*Dn)*Be/25e-6},Ne=it=>{const xt=me,Ut=_e;return{aabb:p.tileAABB(this,R,0,0,0,it,Ut,xt,this.projection),zoom:0,x:0,y:0,minZ:Ut,maxZ:xt,wrap:it,fullyVisible:!1}},Ze=[];let qe=[];const ot=h,Vt=c.reparseOverscaled?_:h,nt=it=>it*it,Tt=nt((oe-this._centerAltitude)*le),ht=it=>{if(!this._elevation||!it.tileID||!S)return;const xt=this._elevation.getMinMaxForTile(it.tileID),Ut=it.aabb;xt?(Ut.min[2]=xt.min,Ut.max[2]=xt.max,Ut.center[2]=(Ut.min[2]+Ut.max[2])/2):(it.shouldSplit=jt(it),it.shouldSplit||(Ut.min[2]=Ut.max[2]=Ut.center[2]=this._centerAltitude))},jt=it=>{if(it.zoom<te)return!0;if(it.zoom===ot)return!1;if(null!=it.shouldSplit)return it.shouldSplit;const xt=it.aabb.distanceX(ue),Ut=it.aabb.distanceY(ue);let Rt=Tt,$t=1;if(F){Rt=nt(it.aabb.distanceZ(ue));const _n=Math.pow(2,it.zoom),Rn=p.latFromMercatorY((it.y+1)/_n),_i=p.latFromMercatorY(it.y/_n),ai=Math.min(Math.max(M,Rn),_i),Dn=p.circumferenceAtLatitude(ai)/p.circumferenceAtLatitude(M);if($t=ai===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Dn/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&it.zoom===ot-1&&Dn>=.9)return!0}else if(x&&(Rt=nt(it.aabb.distanceZ(ue)*le)),this.projection.isReprojectedInTileSpace&&_<=5){const _n=Math.pow(2,it.zoom),Rn=Fe(new p.MercatorCoordinate((it.x+.5)/_n,(it.y+.5)/_n));$t=Rn>.85?1:Rn}const Mn=xt*xt+Ut*Ut+Rt;return Mn<nt((1<<ot-it.zoom)*$*$t*((_n,Rn)=>{if(Rn*nt(.707)<_n)return 1;const _i=Math.sqrt(Rn/_n);return _i/(1.4144271570014144+(Math.pow(1.1,_i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Rt,Tt),Mn))};if(this.renderWorldCopies)for(let it=1;it<=3;it++)Ze.push(Ne(-it)),Ze.push(Ne(it));for(Ze.push(Ne(0));Ze.length>0;){const it=Ze.pop(),xt=it.x,Ut=it.y;let Rt=it.fullyVisible;if(!Rt){const $t=it.aabb.intersects(J);if(0===$t)continue;Rt=2===$t}if(it.zoom!==ot&&jt(it))for(let $t=0;$t<4;$t++){const Mn=(xt<<1)+$t%2,jn=(Ut<<1)+($t>>1),_n={aabb:S?it.aabb.quadrant($t):p.tileAABB(this,R,it.zoom+1,Mn,jn,it.wrap,it.minZ,it.maxZ,this.projection),zoom:it.zoom+1,x:Mn,y:jn,wrap:it.wrap,fullyVisible:Rt,tileID:void 0,shouldSplit:void 0,minZ:it.minZ,maxZ:it.maxZ};x&&!F&&(_n.tileID=new p.OverscaledTileID(it.zoom+1===ot?Vt:it.zoom+1,it.wrap,it.zoom+1,Mn,jn),ht(_n)),Ze.push(_n)}else{const $t=it.zoom===ot?Vt:it.zoom;if(c.minzoom&&c.minzoom>$t)continue;const Mn=O[0]-(.5+xt+(it.wrap<<it.zoom))*(1<<h-it.zoom),jn=O[1]-.5-Ut,_n=it.tileID?it.tileID:new p.OverscaledTileID($t,it.wrap,it.zoom,xt,Ut);qe.push({tileID:_n,distanceSq:Mn*Mn+jn*jn})}}if(this.fogCullDistSq){const it=this.fogCullDistSq,xt=this.horizonLineFromTop();qe=qe.filter(Ut=>{const Rt=[0,0,0,1],$t=[p.EXTENT,p.EXTENT,0,1],Mn=this.calculateFogTileMatrix(Ut.tileID.toUnwrapped());p.transformMat4$1(Rt,Rt,Mn),p.transformMat4$1($t,$t,Mn);const jn=p.getAABBPointSquareDist(Rt,$t);if(0===jn)return!0;let _n=!1;const Rn=this._elevation;if(Rn&&jn>it&&0!==xt){const _i=this.calculateProjMatrix(Ut.tileID.toUnwrapped());let ai;c.isTerrainDEM||(ai=Rn.getMinMaxForTile(Ut.tileID)),ai||(ai={min:_e,max:me});const Dn=p.furthestTileCorner(this.rotation),rr=[Dn[0]*p.EXTENT,Dn[1]*p.EXTENT,ai.max];p.transformMat4(rr,rr,_i),_n=(1-rr[1])*this.height*.5<xt}return jn<it||_n})}return qe.sort((it,xt)=>it.distanceSq-xt.distanceSq).map(it=>it.tileID)}resize(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const h=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=this.projection.project(c.lng,h);return new p.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,h){let _,x;const S=this.centerPoint;if("globe"===this.projection.name){const M=this.worldSize;_=(h.x-S.x)/M,x=(h.y-S.y)/M}else{const M=this.pointCoordinate(h),R=this.pointCoordinate(S);_=M.x-R.x,x=M.y-R.y}const D=this.locationCoordinate(c);this.setLocation(new p.MercatorCoordinate(D.x-_,D.y-x))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,h){const _=h?p.mercatorZfromAltitude(h,c.lat):void 0,x=this.projection.project(c.lng,c.lat);return new p.MercatorCoordinate(x.x,x.y,_)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,h){const _=null!=h?h:this._centerAltitude,x=[c.x,c.y,0,1],S=[c.x,c.y,1,1];p.transformMat4$1(x,x,this.pixelMatrixInverse),p.transformMat4$1(S,S,this.pixelMatrixInverse);const D=S[3];p.scale$1(x,x,1/x[3]),p.scale$1(S,S,1/D);const M=x[2],R=S[2];return{p0:x,p1:S,t:M===R?0:(_-M)/(R-M)}}screenPointToMercatorRay(c){const h=[c.x,c.y,0,1],_=[c.x,c.y,1,1];return p.transformMat4$1(h,h,this.pixelMatrixInverse),p.transformMat4$1(_,_,this.pixelMatrixInverse),p.scale$1(h,h,1/h[3]),p.scale$1(_,_,1/_[3]),h[2]=p.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=p.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,p.scale$1(h,h,1/this.worldSize),p.scale$1(_,_,1/this.worldSize),new p.Ray([h[0],h[1],h[2]],p.normalize([],p.sub([],_,h)))}rayIntersectionCoordinate(c){const{p0:h,p1:_,t:x}=c,S=p.mercatorZfromAltitude(h[2],this._center.lat),D=p.mercatorZfromAltitude(_[2],this._center.lat);return new p.MercatorCoordinate(p.number(h[0],_[0],x)/this.worldSize,p.number(h[1],_[1],x)/this.worldSize,p.number(S,D,x))}pointCoordinate(c,h=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,h)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let h=this.projection.pointCoordinate3D(this,c.x,c.y);if(h)return new p.MercatorCoordinate(h[0],h[1],h[2]);let _=0,x=this.horizonLineFromTop();if(c.y>x)return this.pointCoordinate(c);const S=.02*x,D=c.clone();for(let M=0;M<10&&x-_>S;M++){D.y=p.number(_,x,.66);const R=this.projection.pointCoordinate3D(this,D.x,D.y);R?(x=D.y,h=R):_=D.y}return h?new p.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(c);const h=this.pointCoordinate(c);return h.y>=0&&h.y<=1}_coordinatePoint(c,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,x=[c.x*this.worldSize,c.y*this.worldSize,_+c.toAltitude(),1];return p.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new p.Point(x[0]/x[3],x[1]/x[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:h}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,S=this.pointLocation3D(new p.Point(h,c)),D=this.pointLocation3D(new p.Point(x,c)),M=this.pointLocation3D(new p.Point(x,_)),R=this.pointLocation3D(new p.Point(h,_));let O=Math.min(S.lng,D.lng,M.lng,R.lng),F=Math.max(S.lng,D.lng,M.lng,R.lng),U=Math.min(S.lat,D.lat,M.lat,R.lat),J=Math.max(S.lat,D.lat,M.lat,R.lat);const ne=Math.pow(2,-this.zoom)/16*270,le="globe"===this.projection.name?1:4,oe=(ue,$,te,me,_e)=>{const Be=(ue+te)/2,Fe=($+me)/2,Ne=new p.Point(Be,Fe),{lng:Ze,lat:qe}=this.pointLocation3D(Ne),ot=Math.max(0,O-Ze,U-qe,Ze-F,qe-J);O=Math.min(O,Ze),F=Math.max(F,Ze),U=Math.min(U,qe),J=Math.max(J,qe),(_e<le||ot>ne)&&(oe(ue,$,Be,Fe,_e+1),oe(Be,Fe,te,me,_e+1))};if(oe(h,c,x,c,1),oe(x,c,x,_,1),oe(x,_,h,_,1),oe(h,_,h,c,1),"globe"===this.projection.name){const[ue,$]=p.polesInViewport(this);ue?(J=90,F=180,O=-180):$&&(U=-90,F=180,O=-180)}return new p.LngLatBounds(new p.LngLat(O,U),new p.LngLat(F,J))}_getBoundsRectangular(c,h){const{top:_,left:x}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,D=this.width-this._edgeInsets.right,M=new p.Point(x,_),R=new p.Point(D,_),O=new p.Point(D,S),F=new p.Point(x,S);let U=this.pointCoordinate(M,c),J=this.pointCoordinate(R,c);const ne=this.pointCoordinate(O,h),le=this.pointCoordinate(F,h),oe=(ue,$)=>($.y-ue.y)/($.x-ue.x);return U.y>1&&J.y>=0?U=new p.MercatorCoordinate((1-le.y)/oe(le,U)+le.x,1):U.y<0&&J.y<=1&&(U=new p.MercatorCoordinate(-le.y/oe(le,U)+le.x,0)),J.y>1&&U.y>=0?J=new p.MercatorCoordinate((1-ne.y)/oe(ne,J)+ne.x,1):J.y<0&&U.y<=1&&(J=new p.MercatorCoordinate(-ne.y/oe(ne,J)+ne.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(ne))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=c.visibleDemTiles.reduce((_,x)=>{if(x.dem){const S=x.dem.tree;_.min=Math.min(_.min,S.minimums[0]),_.max=Math.max(_.max,S.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*c.exaggeration(),h.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return c?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,h){return this.projection.createTileMatrix(this,h,c)}calculateDistanceTileData(c){const h=c.key,_=this._distanceTileDataCache;if(_[h])return _[h];const x=c.canonical,S=1/this.height,D=this.cameraWorldSize,M=D/this.zoomScale(x.z),R=(x.x+Math.pow(2,x.z)*c.wrap)*M,O=x.y*M,F=this.point;F.x*=D/this.worldSize,F.y*=D/this.worldSize;const U=this.angle,J=Math.sin(-U),ne=-Math.cos(-U);return _[h]={bearing:[J,ne],center:[(F.x-R)*S,(F.y-O)*S],scale:M/p.EXTENT*S},_[h]}calculateFogTileMatrix(c){const h=c.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return p.multiply(x,this.worldToFogMatrix,x),_[h]=new Float32Array(x),_[h]}calculateProjMatrix(c,h=!1){const _=c.key,x=h?this._alignedProjMatrixCache:this._projMatrixCache;if(x[_])return x[_];const S=this.calculatePosMatrix(c,this.worldSize);return p.multiply(S,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,S),x[_]=new Float32Array(S),x[_]}calculatePixelsToTileUnitsMatrix(c){const h=c.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const x=function(S,D){const{scale:M}=S.tileTransform,R=M*p.EXTENT/(S.tileSize*Math.pow(2,D.zoom-S.tileID.overscaledZ+S.tileID.canonical.z));return O=new Float32Array(4),J=(F=D.inverseAdjustmentMatrix)[1],ne=F[2],le=F[3],ue=(U=[R,R])[1],O[0]=F[0]*(oe=U[0]),O[1]=J*oe,O[2]=ne*ue,O[3]=le*ue,O;var O,F,U,J,ne,le,oe,ue}(c,this);return _[h]=x,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,h=p.fromScaling([],[c,c,c]);return p.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const h=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),x=this._camera.forward(),S=p.mercatorZfromAltitude(1,this._center.lat);_[2]/=S,x[2]/=S,p.normalize(x,x);const D=c.raycast(_,x,c.exaggeration());if(D){const M=p.scaleAndAdd([],_,x,D),R=new p.MercatorCoordinate(M[0],M[1],p.mercatorZfromAltitude(M[2],p.latFromMercatorY(M[1]))),O=(R.z+p.length([R.x-_[0],R.y-_[1],R.z-_[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const h=this._elevation,_=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(_),S=h.getAtPointOrZero(new p.MercatorCoordinate(...x)),D=this.pixelsPerMeter/this.worldSize*S,M=this._minimumHeightOverTerrain(),R=x[2]-D;if(R<=M)if(R<0||c){const O=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],O.z-x[2]],U=p.length(F);F[2]-=(M-R)/this._pixelsPerMercatorPixel;const J=p.length(F);if(0===J)return;p.scale$2(F,F,U/J*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],O.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const J=this.center;return J.lat=p.clamp(J.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(J.lng=p.clamp(J.lng,this.minLng,this.maxLng)),this.center=J,void(this._constraining=!1)}const h=this._unmodified,{x:_,y:x}=this.point;let S=0,D=_,M=x;const R=this.width/2,O=this.height/2,F=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(x-O<F&&(M=F+O),x+O>U&&(M=U-O),U-F<this.height&&(S=Math.max(S,this.height/(U-F)),M=(U+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const J=this.worldMinX*this.scale,ne=this.worldMaxX*this.scale,le=this.worldSize/2-(J+ne)/2;D=(_+le+this.worldSize)%this.worldSize-le,D-R<J&&(D=J+R),D+R>ne&&(D=ne-R),ne-J<this.width&&(S=Math.max(S,this.width/(ne-J)),D=(ne+J)/2)}D===_&&M===x||(this.center=this.unproject(new p.Point(D,M))),S&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,h=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const _=Od(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x="meters"===this.projection.zAxisUnit?h:1,S=this._camera.getWorldToCamera(this.worldSize,x),D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);D[8]=2*-c.x/this.width,D[9]=2*c.y/this.height;let M=p.mul([],D,S);if(this.projection.isReprojectedInTileSpace){const Fe=this.locationCoordinate(this.center),Ne=p.identity([]);p.translate(Ne,Ne,[Fe.x*this.worldSize,Fe.y*this.worldSize,0]),p.multiply(Ne,Ne,Ld(this)),p.translate(Ne,Ne,[-Fe.x*this.worldSize,-Fe.y*this.worldSize,0]),p.multiply(M,M,Ne),this.inverseAdjustmentMatrix=function(Ze){const qe=Ld(Ze,!0);return Ae([],[qe[0],qe[1],qe[4],qe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],M,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=M,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const R=p.invert([],D);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(R,this.horizonLineFromTop(),this.height);const O=new Float32Array(16);p.identity(O),p.scale(O,O,[1,-1,1]),p.rotateX(O,O,this._pitch),p.rotateZ(O,O,this.angle);const F=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-c.x/this.width,F[9]=2*(c.y+U)/this.height,this.skyboxMatrix=p.multiply(O,F,O);const J=this.point,ne=J.x,le=J.y,oe=this.width%2/2,ue=this.height%2/2,$=Math.cos(this.angle),te=Math.sin(this.angle),me=ne-Math.round(ne)+$*oe+te*ue,_e=le-Math.round(le)+$*ue+te*oe,Be=new Float64Array(M);if(p.translate(Be,Be,[me>.5?me-1:me,_e>.5?_e-1:_e,0]),this.alignedProjMatrix=Be,M=p.create(),p.scale(M,M,[this.width/2,-this.height/2,1]),p.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=p.create(),p.scale(M,M,[1,-1,1]),p.translate(M,M,[-1,-1,0]),p.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},M=p.invert(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const Fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(Fe,Fe,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,S=[c,c,h];p.scale$2(S,S,x),p.scale$2(_,_,-1),p.multiply$2(_,_,S);const D=p.create();p.translate(D,D,_),p.scale(D,D,S),this.mercatorFogMatrix=D,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,h,x)}_computeCameraPosition(c){const h=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-c/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*S,x.y/this.worldSize-_[1]*S,c/this.worldSize*this._centerAltitude-_[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],x=c[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(S=Math.min((h-_)/x,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,c,S),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),S=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,D=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),M=Math.max((c[2]-S)/Math.cos(_),D),R=this._zoomFromMercatorZ(M);p.scaleAndAdd(c,c,h,M),this._pitch=p.clamp(_,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(x,-Math.PI,Math.PI),this._setZoom(p.clamp(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let h=0,_=p.GLOBE_ZOOM_THRESHOLD_MAX,x=0,S=1/0;for(;_-h>1e-6&&_>h;){const D=h+.5*(_-h),M=this.tileSize*Math.pow(2,D),R=this.getCameraToCenterDistance(this.projection,D,M),O=this.scaleZoom(R/(c*this.tileSize)),F=Math.abs(D-O);F<S&&(S=F,x=D),D<O?h=D:_=D}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,h){const _=Math.min(c.x,h.x),x=Math.max(c.x,h.x),S=Math.min(c.y,h.y),D=Math.max(c.y,h.y);if(S<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const M=[new p.Point(_,S),new p.Point(x,D),new p.Point(_,D),new p.Point(x,S)],R=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const F of M){const U=this.pointRayIntersection(F);if(U.t<0)return!0;const J=this.rayIntersectionCoordinate(U);if(J.x<R||J.y<0||J.x>O||J.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(c,h){const _=p.length(p.sub([],this._camera.position,c)),x=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if("globe"===this.projection.name){const c=function([h,_,x],S){const D=[h,_,x,1];p.transformMat4$1(D,D,S);const M=D[3]=Math.max(D[3],1e-6);return D[0]/=M,D[1]/=M,D[2]/=M,D}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,c))}}getCameraToCenterDistance(c,h=this.zoom,_=this.worldSize){const x=Od(c,h,this.width,this.height,1024),S=c.pixelSpaceConversion(this.center.lat,_,x);return.5/Math.tan(.5*this._fov)*this.height*S}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(c,c,this.globeMatrix),c}}function pa(g,c){let h=!1,_=null;const x=()=>{_=null,h&&(g(),_=setTimeout(x,c),h=!1)};return()=>(h=!0,_||x(),_)}class mf{constructor(c){this._hashName=c&&encodeURIComponent(c),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=pa(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,p.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const h=hr(c);if(this._hashName){const _=this._hashName;let x=!1;const S=p.window.location.hash.slice(1).split("&").map(D=>{const M=D.split("=")[0];return M===_?(x=!0,`${M}=${h}`):D}).filter(D=>D);return x||S.push(`${_}=${h}`),`#${S.join("&")}`}return`#${h}`}_getCurrentHash(){const c=p.window.location.hash.replace("#","");if(this._hashName){let h;return c.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(h[3]||0):c.getBearing();return c.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,c)}}function hr(g,c){const h=g.getCenter(),_=Math.round(100*g.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,x),D=Math.round(h.lng*S)/S,M=Math.round(h.lat*S)/S,R=g.getBearing(),O=g.getPitch();let F=c?`/${D}/${M}/${_}`:`${_}/${M}/${D}`;return(R||O)&&(F+="/"+Math.round(10*R)/10),O&&(F+=`/${Math.round(O)}`),F}const Mu={linearity:.3,easing:p.bezier(0,0,.3,1)},Zh=p.extend({deceleration:2500,maxSpeed:1400},Mu),Yh=p.extend({deceleration:20,maxSpeed:1400},Mu),pn=p.extend({deceleration:1e3,maxSpeed:360},Mu),fa=p.extend({deceleration:1e3,maxSpeed:90},Mu);class eg{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,h=p.exported.now();for(;c.length>0&&h-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)h.zoom+=S.zoomDelta||0,h.bearing+=S.bearingDelta||0,h.pitch+=S.pitchDelta||0,S.panDelta&&h.pan._add(S.panDelta),S.around&&(h.around=S.around),S.pinchAround&&(h.pinchAround=S.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const S=Nd(h.pan.mag(),_,p.extend({},Zh,c||{}));x.offset=h.pan.mult(S.amount/h.pan.mag()),x.center=this._map.transform.center,$c(x,S)}if(h.zoom){const S=Nd(h.zoom,_,Yh);x.zoom=this._map.transform.zoom+S.amount,$c(x,S)}if(h.bearing){const S=Nd(h.bearing,_,pn);x.bearing=this._map.transform.bearing+p.clamp(S.amount,-179,179),$c(x,S)}if(h.pitch){const S=Nd(h.pitch,_,fa);x.pitch=this._map.transform.pitch+S.amount,$c(x,S)}if(x.zoom||x.bearing){const S=void 0===h.pinchAround?h.around:h.pinchAround;x.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function $c(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function Nd(g,c,h){const{maxSpeed:_,linearity:x,deceleration:S}=h,D=p.clamp(g*x/(c/1e3),-_,_),M=Math.abs(D)/(S*x);return{easing:h.easing,duration:1e3*M,amount:D*(M/2)}}class Dr extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_,x={}){const S=st(h.getCanvasContainer(),_),D=h.unproject(S);super(c,p.extend({point:S,lngLat:D,originalEvent:_},x)),this._defaultPrevented=!1,this.target=h}}class qc extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){const x="touchend"===c?_.changedTouches:_.touches,S=ln(h.getCanvasContainer(),x),D=S.map(R=>h.unproject(R)),M=S.reduce((R,O,F,U)=>R.add(O.div(U.length)),new p.Point(0,0));super(c,{points:S,point:M,lngLats:D,lngLat:h.unproject(M),originalEvent:_}),this._defaultPrevented=!1}}class Kh extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,h,_){super(c,{originalEvent:_}),this._defaultPrevented=!1}}class Bd{constructor(c,h){this._map=c,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new Kh(c.type,this._map,c))}mousedown(c,h){return this._mousedownPos=h,this._firePreventable(new Dr(c.type,this._map,c))}mouseup(c){this._map.fire(new Dr(c.type,this._map,c))}preclick(c){const h=p.extend({},c);h.type="preclick",this._map.fire(new Dr(h.type,this._map,h))}click(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Dr(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Dr(c.type,this._map,c))}mouseover(c){this._map.fire(new Dr(c.type,this._map,c))}mouseout(c){this._map.fire(new Dr(c.type,this._map,c))}touchstart(c){return this._firePreventable(new qc(c.type,this._map,c))}touchmove(c){this._map.fire(new qc(c.type,this._map,c))}touchend(c){this._map.fire(new qc(c.type,this._map,c))}touchcancel(c){this._map.fire(new qc(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qh{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Dr(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Dr(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class w_{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,h){this.isEnabled()&&c.shiftKey&&0===c.button&&(wt(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(c,h){if(!this._active)return;const _=h,x=this._startPos,S=this._lastPos;if(!x||!S||S.equals(_)||!this._box&&_.dist(x)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Ye("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const D=Math.min(x.x,_.x),M=Math.max(x.x,_.x),R=Math.min(x.y,_.y),O=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${D}px,${R}px)`,this._box.style.width=M-D+"px",this._box.style.height=O-R+"px")})}mouseupWindow(c,h){if(!this._active)return;const _=this._startPos,x=h;if(_&&0===c.button){if(this.reset(),Cn(),_.x!==x.x||_.y!==x.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:S=>S.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Jt(),delete this._startPos,delete this._lastPos}_fireEvent(c,h){return this._map.fire(new p.Event(c,{originalEvent:h}))}}function Kr(g,c){const h={};for(let _=0;_<g.length;_++)h[g[_].identifier]=c[_];return h}class Au{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const S=new p.Point(0,0);for(const D of x)S._add(D);return S.div(x.length)}(h),this.touches=Kr(_,h)))}touchmove(c,h,_){if(this.aborted||!this.centroid)return;const x=Kr(_,h);for(const S in this.touches){const D=x[S];(!D||D.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(c,h,_){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class tg{constructor(c){this.singleTap=new Au(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,h,_){this.singleTap.touchstart(c,h,_)}touchmove(c,h,_){this.singleTap.touchmove(c,h,_)}touchend(c,h,_){const x=this.singleTap.touchend(c,h,_);if(x){const S=c.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(x)<30;if(S&&D||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Jh{constructor(){this._zoomIn=new tg({numTouches:1,numTaps:2}),this._zoomOut=new tg({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,h,_){this._zoomIn.touchstart(c,h,_),this._zoomOut.touchstart(c,h,_)}touchmove(c,h,_){this._zoomIn.touchmove(c,h,_),this._zoomOut.touchmove(c,h,_)}touchend(c,h,_){const x=this._zoomIn.touchend(c,h,_),S=this._zoomOut.touchend(c,h,_);return x?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(x)},{originalEvent:c})}):S?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(S)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ns={0:1,2:2};class ku{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,h){return!1}_move(c,h){return{}}mousedown(c,h){if(this._lastPoint)return;const _=Te(c);this._correctButton(c,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(c,h){const _=this._lastPoint;if(_)if(c.preventDefault(),null!=this._eventButton&&function(x,S){const D=Ns[S];return void 0===x.buttons||(x.buttons&D)!==D}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(c){this._lastPoint&&Te(c)===this._eventButton&&(this._moved&&Cn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zd extends ku{mousedown(c,h){super.mousedown(c,h),this._lastPoint&&(this._active=!0)}_correctButton(c,h){return 0===h&&!c.ctrlKey}_move(c,h){return{around:h,panDelta:h.sub(c)}}}class rc extends ku{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=.8*(h.x-c.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(c){c.preventDefault()}}class Ss extends ku{_correctButton(c,h){return 0===h&&c.ctrlKey||2===h}_move(c,h){const _=-.5*(h.y-c.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(c){c.preventDefault()}}class ep{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(c,h,_){return this._calculateTransform(c,h,_)}touchmove(c,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,h,_)}}touchend(c,h,_){this._calculateTransform(c,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,h,_){_.length>0&&(this._active=!0);const x=Kr(_,h),S=new p.Point(0,0),D=new p.Point(0,0);let M=0;for(const O in x){const F=x[O],U=this._touches[O];U&&(S._add(F),D._add(F.sub(U)),M++,x[O]=F)}if(this._touches=x,M<this._minTouches||!D.mag())return;const R=D.div(M);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(M),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ye("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class oc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,h,_){return{}}touchstart(c,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(c,h,_){const x=this._firstTwoTouches;if(!x)return;c.preventDefault();const[S,D]=x,M=Vd(_,h,S),R=Vd(_,h,D);if(!M||!R)return;const O=this._aroundCenter?null:M.add(R).div(2);return this._move([M,R],O,c)}touchend(c,h,_){if(!this._firstTwoTouches)return;const[x,S]=this._firstTwoTouches,D=Vd(_,h,x),M=Vd(_,h,S);D&&M||(this._active&&Cn(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vd(g,c,h){for(let _=0;_<g.length;_++)if(g[_].identifier===h)return c[_]}function cl(g,c){return Math.log(g/c)/Math.LN2}class gf extends oc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,h){const _=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(cl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:cl(this._distance,_),pinchAround:h}}}function jd(g,c){return 180*g.angleWith(c)/Math.PI}class pi extends oc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,h){const _=this._vector;if(this._vector=c[0].sub(c[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:jd(this._vector,_),pinchAround:h}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const h=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const x=jd(c,_);return Math.abs(x)<h}}function kl(g){return Math.abs(g.y)>Math.abs(g.x)}class S_ extends oc{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,kl(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,h,_){const x=this._lastPoints;if(!x)return;const S=c[0].sub(x[0]),D=c[1].sub(x[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(S,D,_.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(S.y+D.y)/2*-.5})}gestureBeginsVertically(c,h,_){if(void 0!==this._valid)return this._valid;const x=c.mag()>=2,S=h.mag()>=2;if(!x&&!S)return;if(!x||!S)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const D=c.y>0==h.y>0;return kl(c)&&kl(h)&&D}}const ng={panStep:100,bearingStep:15,pitchStep:10};class C_{constructor(){const c=ng;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let h=0,_=0,x=0,S=0,D=0;switch(c.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:c.shiftKey?_=-1:(c.preventDefault(),S=-1);break;case 39:c.shiftKey?_=1:(c.preventDefault(),S=1);break;case 38:c.shiftKey?x=1:(c.preventDefault(),D=-1);break;case 40:c.shiftKey?x=-1:(c.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:M=>{const R=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:ig,zoom:h?Math.round(R)+h*(c.shiftKey?2:1):R,bearing:M.getBearing()+_*this._bearingStep,pitch:M.getPitch()+x*this._pitchStep,offset:[-S*this._panStep,-D*this._panStep],center:M.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ig(g){return g*(2-g)}const tp=4.000244140625;class rg{constructor(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=c.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const _=p.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%tp==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=st(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>tp?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==O&&(O=1/O);const F=h(),U=Math.pow(2,F),J="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(J*O))),"wheel"===this._type&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),x=this._startZoom,S=this._easing;let D,M=!1;if("wheel"===this._type&&x&&S){const R=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),O=S(R);D=p.number(x,_,O),R<1?this._frameId||(this._frameId=!0):M=!0}else D=_,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:D-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let h=p.ease;if(this._prevEase){const _=this._prevEase,x=(p.exported.now()-_.start)/_.duration,S=_.easing(x+.01)-_.easing(x),D=.27/Math.sqrt(S*S+1e-4)*.01,M=Math.sqrt(.0729-D*D);h=p.bezier(D,M,.25,1)}return this._prevEase={start:p.exported.now(),duration:c,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ye("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class og{constructor(c,h){this._clickZoom=c,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Pt{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,h){return c.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(c.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ir{constructor(){this._tap=new tg({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,h,_){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(c,h,_))}touchmove(c,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=h[0],S=x.y-this._swipePoint.y;return this._swipePoint=x,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,h,_)}touchend(c,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(c,h,_)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class si{constructor(c,h,_){this._el=c,this._mousePan=h,this._touchPan=_}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fi{constructor(c,h,_){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Io{constructor(c,h,_,x){this._el=c,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zs=g=>g.zoom||g.drag||g.pitch||g.rotate;class Ru extends p.Event{}class ul{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,h){const _=p.sub([],h,c);this.radius=p.length(_[2]<0?p.div([],_,this.constants):[_[0],_[1],0])}projectRay(c){p.div(c,c,this.constants),p.normalize(c,c),p.mul$1(c,c,this.constants);const h=p.scale$2([],c,this.radius);if(h[2]>0){const _=p.scale$2([],[0,0,1],p.dot(h,[0,0,1])),x=p.scale$2([],p.normalize([],[h[0],h[1],0]),this.radius),S=p.add([],h,p.scale$2([],p.sub([],p.add([],x,_),h),2));h[0]=S[0],h[1]=S[1]}return h}}function Ys(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class ma{constructor(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new eg(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ul,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),p.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[x,S,D]of this._listeners)x.addEventListener(S,x===p.window.document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[c,h,_]of this._listeners)c.removeEventListener(h,c===p.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(c){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new Bd(h,c));const x=h.boxZoom=new w_(h,c);this._add("boxZoom",x);const S=new Jh,D=new Pt;h.doubleClickZoom=new og(D,S),this._add("tapZoom",S),this._add("clickZoom",D);const M=new ir;this._add("tapDragZoom",M);const R=h.touchPitch=new S_(h);this._add("touchPitch",R);const O=new rc(c),F=new Ss(c);h.dragRotate=new fi(c,O,F),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const U=new zd(c),J=new ep(h,c);h.dragPan=new si(_,U,J),this._add("mousePan",U),this._add("touchPan",J,["touchZoom","touchRotate"]);const ne=new pi,le=new gf;h.touchZoomRotate=new Io(_,le,ne,M),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Qh(h));const oe=h.scrollZoom=new rg(h,this);this._add("scrollZoom",oe,["mousePan"]);const ue=h.keyboard=new C_;this._add("keyboard",ue);for(const $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[$]&&h[$].enable(c[$])}_add(c,h,_){this._handlers.push({handlerName:c,handler:h,allowed:_}),this._handlersById[c]=h}stop(c){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,h,_){for(const x in c)if(x!==_&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const h=[];for(const _ of c)this._el.contains(_.target)&&h.push(_);return h}handleEvent(c,h){this._updatingCamera=!0;const _="renderFrame"===c.type,x=_?void 0:c,S={needsRenderFrame:!1},D={},M={},R=c.touches?this._getMapTouches(c.touches):void 0,O=R?ln(this._el,R):_?void 0:st(this._el,c);for(const{handlerName:J,handler:ne,allowed:le}of this._handlers){if(!ne.isEnabled())continue;let oe;this._blockedByActive(M,le,J)?ne.reset():ne[h||c.type]&&(oe=ne[h||c.type](c,O,R),this.mergeHandlerResult(S,D,oe,J,x),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()),(oe||ne.isActive())&&(M[J]=ne)}const F={};for(const J in this._previousActiveHandlers)M[J]||(F[J]=x);this._previousActiveHandlers=M,(Object.keys(F).length||Ys(S))&&(this._changes.push([S,D,F]),this._triggerRenderFrame()),(Object.keys(M).length||Ys(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=S;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(c,h,_,x,S){if(!_)return;p.extend(c,_);const D={handlerName:x,originalEvent:_.originalEvent||S};void 0!==_.zoomDelta&&(h.zoom=D),void 0!==_.panDelta&&(h.drag=D),void 0!==_.pitchDelta&&(h.pitch=D),void 0!==_.bearingDelta&&(h.rotate=D)}_applyChanges(){const c={},h={},_={};for(const[x,S,D]of this._changes)x.panDelta&&(c.panDelta=(c.panDelta||new p.Point(0,0))._add(x.panDelta)),x.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(c.around=x.around),void 0!==x.aroundCoord&&(c.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(c.pinchAround=x.pinchAround),x.noInertia&&(c.noInertia=x.noInertia),p.extend(h,S),p.extend(_,D);this._updateMapTransform(c,h,_),this._changes=[]}_updateMapTransform(c,h,_){const x=this._map,S=x.transform,D=te=>[te.x,te.y,te.z];if((te=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!Ys(c)){const te=S.zoom;S.cameraElevationReference="sea",S.recenterOnTerrain(),S.cameraElevationReference="ground",te!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&x._stop(!0),!Ys(c))return void this._fireEvents(h,_,!0);let{panDelta:M,zoomDelta:R,bearingDelta:O,pitchDelta:F,around:U,aroundCoord:J,pinchAround:ne}=c;S._isCameraConstrained&&(R>0&&(R=0),S._isCameraConstrained=!1),void 0!==ne&&(U=ne),(R||(te=>h.drag&&!this._eventsInProgress.drag)())&&U&&(this._dragOrigin=D(S.pointCoordinate3D(U)),this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",x._stop(!0),U=U||x.transform.centerPoint,O&&(S.bearing+=O),F&&(S.pitch+=F),S._updateCameraState();const le=[0,0,0];if(M)if("mercator"===S.projection.name){const te=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(U).dir),me=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(U.sub(M)).dir);le[0]=me[0]-te[0],le[1]=me[1]-te[1]}else{const te=S.pointCoordinate(U);if("globe"===S.projection.name){M=M.rotate(-S.angle);const me=S._pixelsPerMercatorPixel/S.worldSize;le[0]=-M.x*p.mercatorScale(p.latFromMercatorY(te.y))*me,le[1]=-M.y*p.mercatorScale(S.center.lat)*me}else{const me=S.pointCoordinate(U.sub(M));te&&me&&(le[0]=me.x-te.x,le[1]=me.y-te.y)}}const oe=S.zoom,ue=[0,0,0];if(R){const te=D(J||S.pointCoordinate3D(U)),me={dir:p.normalize([],p.sub([],te,S._camera.position))};if(me.dir[2]<0){const _e=S.zoomDeltaToMovement(te,R);p.scale$2(ue,me.dir,_e)}}const $=p.add(le,le,ue);S._translateCameraConstrained($),R&&Math.abs(S.zoom-oe)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,_,!0)}_fireEvents(c,h,_){const x=Zs(this._eventsInProgress),S=Zs(c),D={};for(const F in c){const{originalEvent:U}=c[F];this._eventsInProgress[F]||(D[`${F}start`]=U),this._eventsInProgress[F]=c[F]}!x&&S&&this._fireEvent("movestart",S.originalEvent);for(const F in D)this._fireEvent(F,D[F]);S&&this._fireEvent("move",S.originalEvent);for(const F in c){const{originalEvent:U}=c[F];this._fireEvent(F,U)}const M={};let R;for(const F in this._eventsInProgress){const{handlerName:U,originalEvent:J}=this._eventsInProgress[F];this._handlersById[U].isActive()||(delete this._eventsInProgress[F],R=h[U]||J,M[`${F}end`]=R)}for(const F in M)this._fireEvent(F,M[F]);const O=Zs(this._eventsInProgress);if(_&&(x||S)&&!O){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=J=>0!==J&&-this._bearingSnap<J&&J<this._bearingSnap;F?(U(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:R})):(this._map.fire(new p.Event("moveend",{originalEvent:R})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,h){this._map.fire(new p.Event(c,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new Ru("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Pu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class np extends p.Evented{constructor(c,h){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=!1!==h.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,h){return this.jumpTo({center:c},h)}panBy(c,h,_){return c=p.Point.convert(c).mult(-1),this.panTo(this.transform.center,p.extend({offset:c},h),_)}panTo(c,h,_){return this.easeTo(p.extend({center:c},h),_)}getZoom(){return this.transform.zoom}setZoom(c,h){return this.jumpTo({zoom:c},h),this}zoomTo(c,h,_){return this.easeTo(p.extend({zoom:c},h),_)}zoomIn(c,h){return this.zoomTo(this.getZoom()+1,c,h),this}zoomOut(c,h){return this.zoomTo(this.getZoom()-1,c,h),this}getBearing(){return this.transform.bearing}setBearing(c,h){return this.jumpTo({bearing:c},h),this}getPadding(){return this.transform.padding}setPadding(c,h){return this.jumpTo({padding:c},h),this}rotateTo(c,h,_){return this.easeTo(p.extend({bearing:c},h),_)}resetNorth(c,h){return this.rotateTo(0,p.extend({duration:1e3},c),h),this}resetNorthPitch(c,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},c),h),this}snapToNorth(c,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,h):this}getPitch(){return this.transform.pitch}setPitch(c,h){return this.jumpTo({pitch:c},h),this}cameraForBounds(c,h){c=p.LngLatBounds.convert(c);const _=h&&h.bearing||0,x=h&&h.pitch||0,S=c.getNorthWest(),D=c.getSouthEast();return this._cameraForBounds(this.transform,S,D,_,x,h)}_extendCameraOptions(c){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=p.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const _=c.padding;c.padding={top:_,bottom:_,right:_,left:_}}return c.padding=p.extend(h,c.padding),c}_minimumAABBFrustumDistance(c,h){const _=h.max[0]-h.min[0],x=h.max[1]-h.min[1];return _/x>c.aspect?_/(2*Math.tan(.5*c.fovX)*c.aspect):x/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,h,_,x,S,D){const M=c.clone(),R=this._extendCameraOptions(D);M.bearing=x,M.pitch=S;const O=p.LngLat.convert(h),F=p.LngLat.convert(_),U=.5*(O.lat+F.lat),J=.5*(O.lng+F.lng),ne=p.latLngToECEF(U,J),le=p.normalize([],ne),oe=p.normalize([],p.cross([],le,[0,1,0])),ue=p.cross([],oe,le),$=[oe[0],oe[1],oe[2],0,ue[0],ue[1],ue[2],0,le[0],le[1],le[2],0,0,0,0,1],te=[ne,p.latLngToECEF(O.lat,O.lng),p.latLngToECEF(F.lat,O.lng),p.latLngToECEF(F.lat,F.lng),p.latLngToECEF(O.lat,F.lng),p.latLngToECEF(U,O.lng),p.latLngToECEF(U,F.lng),p.latLngToECEF(O.lat,J),p.latLngToECEF(F.lat,J)];let me=p.Aabb.fromPoints(te.map(Rt=>[p.dot(oe,Rt),p.dot(ue,Rt),p.dot(le,Rt)]));const _e=p.transformMat4([],me.center,$);0===p.squaredLength(_e)&&p.set(_e,0,0,1),p.normalize(_e,_e),p.scale$2(_e,_e,p.GLOBE_RADIUS),M.center=p.ecefToLatLng(_e);const Be=M.getWorldToCameraMatrix(),Fe=p.invert(new Float64Array(16),Be);me=p.Aabb.applyTransform(me,p.multiply([],Be,$)),p.transformMat4(_e,_e,Be);const Ne=.5*(me.max[2]-me.min[2]),Ze=this._minimumAABBFrustumDistance(M,me),qe=p.scale$2([],[0,0,1],Ne),ot=p.add(qe,_e,qe),Vt=Ze+(0===M.pitch?0:p.distance(_e,ot)),nt=M.globeCenterInViewSpace,Tt=p.sub([],_e,[nt[0],nt[1],nt[2]]);p.normalize(Tt,Tt),p.scale$2(Tt,Tt,Vt);const ht=p.add([],_e,Tt);p.transformMat4(ht,ht,Fe);const jt=p.earthRadius/p.GLOBE_RADIUS,it=p.length(ht),xt=p.mercatorZfromAltitude(Math.max(it*jt-p.earthRadius,Number.EPSILON),0),Ut=Math.min(M.zoomFromMercatorZAdjusted(xt),R.maxZoom);return Ut>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"mercator"}),M.zoom=Ut,this._cameraForBounds(M,h,_,x,S,D)):{center:M.center,zoom:Ut,bearing:x,pitch:S}}queryTerrainElevation(c,h){const _=this.transform.elevation;return _?(h=p.extend({},{exaggerated:!0},h),_.getAtPoint(p.MercatorCoordinate.fromLngLat(c),null,h.exaggerated)):null}_cameraForBounds(c,h,_,x,S,D){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,h,_,x,S,D);const M=c.clone(),R=this._extendCameraOptions(D),O=M.padding;M.bearing=x,M.pitch=S;const F=p.LngLat.convert(h),U=p.LngLat.convert(_),J=new p.LngLat(F.lng,U.lat),ne=new p.LngLat(U.lng,F.lat),le=M.project(F),oe=M.project(U),ue=this.queryTerrainElevation(F),$=this.queryTerrainElevation(U),te=this.queryTerrainElevation(J),me=this.queryTerrainElevation(ne),_e=[[le.x,le.y,Math.min(ue||0,$||0,te||0,me||0)],[oe.x,oe.y,Math.max(ue||0,$||0,te||0,me||0)]];let Be=p.Aabb.fromPoints(_e);const Fe=M.getWorldToCameraMatrix(),Ne=p.invert(new Float64Array(16),Fe);Be=p.Aabb.applyTransform(Be,Fe);const Ze=p.sub([],Be.max,Be.min),qe=O.left||0,ot=O.right||0,Vt=O.bottom||0,nt=O.top||0,{left:Tt,right:ht,top:jt,bottom:it}=R.padding,xt=.5*(qe+ot),Ut=.5*(nt+Vt),Rt=Math.min(M.scaleZoom(M.scale*Math.min((M.width-(qe+ot+Tt+ht))/Ze[0],(M.height-(Vt+nt+it+jt))/Ze[1])),R.maxZoom),$t=M.scale/M.zoomScale(Rt);Be=new p.Aabb([Be.min[0]-(Tt+xt)*$t,Be.min[1]-(it+Ut)*$t,Be.min[2]],[Be.max[0]+(ht+xt)*$t,Be.max[1]+(jt+Ut)*$t,Be.max[2]]);const Mn=.5*Ze[2],jn=this._minimumAABBFrustumDistance(M,Be),_n=[0,0,1,0];p.transformMat4$1(_n,_n,Fe),p.normalize$2(_n,_n);const Rn=p.scale$2([],_n,jn+Mn),_i=p.add([],Be.center,Rn),ai=("number"==typeof R.offset.x&&"number"==typeof R.offset.y?new p.Point(R.offset.x,R.offset.y):p.Point.convert(R.offset)).rotate(-p.degToRad(x));Be.center[0]-=ai.x*$t,Be.center[1]+=ai.y*$t,p.transformMat4(Be.center,Be.center,Ne),p.transformMat4(_i,_i,Ne);const Dn=[Be.center[0],Be.center[1],_i[2]*M.pixelsPerMeter];p.scale$2(Dn,Dn,1/M.worldSize);const rr=p.lngFromMercatorX(Dn[0]),gr=p.latFromMercatorY(Dn[1]),vr=Math.min(M._zoomFromMercatorZ(Dn[2]),R.maxZoom),Pi=new p.LngLat(rr,gr);return M.mercatorFromTransition&&vr<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"globe"}),M.zoom=vr,this._cameraForBounds(M,h,_,x,S,D)):{center:Pi,zoom:vr,bearing:x,pitch:S}}fitBounds(c,h,_){const x=this.cameraForBounds(c,h);return this._fitInternal(x,h,_)}fitScreenCoordinates(c,h,_,x,S){const D=p.Point.convert(c),M=p.Point.convert(h),R=new p.Point(Math.min(D.x,M.x),Math.min(D.y,M.y)),O=new p.Point(Math.max(D.x,M.x),Math.max(D.y,M.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(D,M))return this;const F=this.transform.pointLocation3D(R),U=this.transform.pointLocation3D(O),J=this.transform.pointLocation3D(new p.Point(R.x,O.y)),ne=this.transform.pointLocation3D(new p.Point(O.x,R.y)),le=[Math.min(F.lng,U.lng,J.lng,ne.lng),Math.min(F.lat,U.lat,J.lat,ne.lat)],oe=[Math.max(F.lng,U.lng,J.lng,ne.lng),Math.max(F.lat,U.lat,J.lat,ne.lat)],ue=x&&x.pitch?x.pitch:this.getPitch(),$=this._cameraForBounds(this.transform,le,oe,_,ue,x);return this._fitInternal($,x,S)}_fitInternal(c,h,_){return c?(delete(h=p.extend(c,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(c,h){this.stop();const _=c.preloadOnly?this.transform.clone():this.transform;let x=!1,S=!1,D=!1;return"zoom"in c&&_.zoom!==+c.zoom&&(x=!0,_.zoom=+c.zoom),void 0!==c.center&&(_.center=p.LngLat.convert(c.center)),"bearing"in c&&_.bearing!==+c.bearing&&(S=!0,_.bearing=+c.bearing),"pitch"in c&&_.pitch!==+c.pitch&&(D=!0,_.pitch=+c.pitch),null==c.padding||_.isPaddingEqual(c.padding)||(_.padding=c.padding),c.preloadOnly?(this._preloadTiles(_),this):(this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),x&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),S&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),D&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Pu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return p.warnOnce(Pu),this;this.stop();const x=_.zoom,S=_.pitch,D=_.bearing;_.setFreeCameraOptions(c);const M=x!==_.zoom,R=S!==_.pitch,O=D!==_.bearing;return this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),M&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),O&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),R&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h)),this}easeTo(c,h){this._stop(!1,c.easeId),(!1===(c=p.extend({offset:[0,0],duration:500,easing:p.ease},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const _=this.transform,x=this.getZoom(),S=this.getBearing(),D=this.getPitch(),M=this.getPadding(),R="zoom"in c?+c.zoom:x,O="bearing"in c?this._normalizeBearing(c.bearing,S):S,F="pitch"in c?+c.pitch:D,U="padding"in c?c.padding:_.padding,J=p.Point.convert(c.offset);let ne,le,oe;if("globe"===_.projection.name){const qe=p.MercatorCoordinate.fromLngLat(_.center),ot=J.rotate(-_.angle);qe.x+=ot.x/_.worldSize,qe.y+=ot.y/_.worldSize;const Vt=qe.toLngLat(),nt=p.LngLat.convert(c.center||Vt);this._normalizeCenter(nt),ne=_.centerPoint.add(ot),le=new p.Point(qe.x,qe.y).mult(_.worldSize),oe=new p.Point(p.mercatorXfromLng(nt.lng),p.mercatorYfromLat(nt.lat)).mult(_.worldSize).sub(le)}else{ne=_.centerPoint.add(J);const qe=_.pointLocation(ne),ot=p.LngLat.convert(c.center||qe);this._normalizeCenter(ot),le=_.project(qe),oe=_.project(ot).sub(le)}const ue=_.zoomScale(R-x);let $,te;c.around&&($=p.LngLat.convert(c.around),te=_.locationPoint($));const me=this._zooming||R!==x,_e=this._rotating||S!==O,Be=this._pitching||F!==D,Fe=!_.isPaddingEqual(U),Ne=qe=>ot=>{if(me&&(qe.zoom=p.number(x,R,ot)),_e&&(qe.bearing=p.number(S,O,ot)),Be&&(qe.pitch=p.number(D,F,ot)),Fe&&(qe.interpolatePadding(M,U,ot),ne=qe.centerPoint.add(J)),$)qe.setLocationAtPoint($,te);else{const Vt=qe.zoomScale(qe.zoom-x),nt=R>x?Math.min(2,ue):Math.max(.5,ue),Tt=Math.pow(nt,1-ot),ht=qe.unproject(le.add(oe.mult(ot*Tt)).mult(Vt));qe.setLocationAtPoint(qe.renderWorldCopies?ht.wrap():ht,ne)}return c.preloadOnly||this._fireMoveEvents(h),qe};if(c.preloadOnly){const qe=this._emulate(Ne,c.duration,_);return this._preloadTiles(qe),this}const Ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=me,this._rotating=_e,this._pitching=Be,this._padding=Fe,this._easeId=c.easeId,this._prepareEase(h,c.noMoveStart,Ze),this._ease(Ne(_),qe=>{_.recenterOnTerrain(),this._afterEase(h,qe)},c),this}_prepareEase(c,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new p.Event("movestart",c)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",c)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",c)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new p.Event("move",c)),this._zooming&&this.fire(new p.Event("zoom",c)),this._rotating&&this.fire(new p.Event("rotate",c)),this._pitching&&this.fire(new p.Event("pitch",c))}_afterEase(c,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",c)),x&&this.fire(new p.Event("rotateend",c)),S&&this.fire(new p.Event("pitchend",c)),this.fire(new p.Event("moveend",c))}flyTo(c,h){if(this._prefersReducedMotion(c)){const Rt=p.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Rt,h)}this.stop(),c=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},c);const _=this.transform,x=this.getZoom(),S=this.getBearing(),D=this.getPitch(),M=this.getPadding(),R="zoom"in c?p.clamp(+c.zoom,_.minZoom,_.maxZoom):x,O="bearing"in c?this._normalizeBearing(c.bearing,S):S,F="pitch"in c?+c.pitch:D,U="padding"in c?c.padding:_.padding,J=_.zoomScale(R-x),ne=p.Point.convert(c.offset);let le=_.centerPoint.add(ne);const oe=_.pointLocation(le),ue=p.LngLat.convert(c.center||oe);this._normalizeCenter(ue);const $=_.project(oe),te=_.project(ue).sub($);let me=c.curve;const _e=Math.max(_.width,_.height),Be=_e/J,Fe=te.mag();if("minZoom"in c){const Rt=p.clamp(Math.min(c.minZoom,x,R),_.minZoom,_.maxZoom),$t=_e/_.zoomScale(Rt-x);me=Math.sqrt($t/Fe*2)}const Ne=me*me;function Ze(Rt){const $t=(Be*Be-_e*_e+(Rt?-1:1)*Ne*Ne*Fe*Fe)/(2*(Rt?Be:_e)*Ne*Fe);return Math.log(Math.sqrt($t*$t+1)-$t)}function qe(Rt){return(Math.exp(Rt)-Math.exp(-Rt))/2}function ot(Rt){return(Math.exp(Rt)+Math.exp(-Rt))/2}const Vt=Ze(0);let nt=function(Rt){return ot(Vt)/ot(Vt+me*Rt)},Tt=function(Rt){return _e*((ot(Vt)*(qe($t=Vt+me*Rt)/ot($t))-qe(Vt))/Ne)/Fe;var $t},ht=(Ze(1)-Vt)/me;if(Math.abs(Fe)<1e-6||!isFinite(ht)){if(Math.abs(_e-Be)<1e-6)return this.easeTo(c,h);const Rt=Be<_e?-1:1;ht=Math.abs(Math.log(Be/_e))/me,Tt=function(){return 0},nt=function($t){return Math.exp(Rt*me*$t)}}c.duration="duration"in c?+c.duration:1e3*ht/("screenSpeed"in c?+c.screenSpeed/me:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const jt=S!==O,it=F!==D,xt=!_.isPaddingEqual(U),Ut=Rt=>$t=>{const Mn=$t*ht,jn=1/nt(Mn);Rt.zoom=1===$t?R:x+Rt.scaleZoom(jn),jt&&(Rt.bearing=p.number(S,O,$t)),it&&(Rt.pitch=p.number(D,F,$t)),xt&&(Rt.interpolatePadding(M,U,$t),le=Rt.centerPoint.add(ne));const _n=1===$t?ue:Rt.unproject($.add(te.mult(Tt(Mn))).mult(jn));return Rt.setLocationAtPoint(Rt.renderWorldCopies?_n.wrap():_n,le),Rt._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(h),Rt};if(c.preloadOnly){const Rt=this._emulate(Ut,c.duration,_);return this._preloadTiles(Rt),this}return this._zooming=!0,this._rotating=jt,this._pitching=it,this._padding=xt,this._prepareEase(h,!1),this._ease(Ut(_),()=>this._afterEase(h),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!c){const _=this.handlers;_&&_.stop(!1)}return this}_ease(c,h,_){!1===_.animate||0===_.duration?(c(1),h()):(this._easeStart=p.exported.now(),this._easeOptions=_,this._onEaseFrame=c,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,h){c=p.wrap(c,-180,180);const _=Math.abs(c-h);return Math.abs(c-360-h)<_&&(c-=360),Math.abs(c+360-h)<_&&(c+=360),c}_normalizeCenter(c){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=c.lng-h.center.lng;c.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,h,_){const x=Math.ceil(15*h/1e3),S=[],D=c(_.clone());for(let M=0;M<=x;M++){const R=D(M/x);S.push(R.clone())}return S}}class bn{constructor(c={}){this.options=c,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const h=this.options&&this.options.compact;return this._map=c,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ye("button","mapboxgl-ctrl-attrib-button",this._container),Ye("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ye("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,h){const _=this._map._getUIString(`AttributionControl.${h}`);c.setAttribute("aria-label",_),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(c){const _=h.reduce((x,S,D)=>(S.value&&(x+=`${S.key}=${S.value}${D<h.length-1?"&":""}`),x),"?");c.href=`${p.config.FEEDBACK_URL}/${_}#${hr(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style._sourceCaches;for(const x in h){const S=h[x];if(S.used){const D=S.getSource();D.attribution&&c.indexOf(D.attribution)<0&&c.push(D.attribution)}}c.sort((x,S)=>x.length-S.length),c=c.filter((x,S)=>{for(let D=S+1;D<c.length;D++)if(c[D].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const _=c.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,c.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ip{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Ye("div","mapboxgl-ctrl");const h=Ye("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const h in c){const _=c[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class $o{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h}remove(c){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const x of _)if(x.id===c)return void(x.cancelled=!0)}run(c=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Bs(g,c,h){if(g=new p.LngLat(g.lng,g.lat),c){const _=new p.LngLat(g.lng-360,g.lat),x=new p.LngLat(g.lng+360,g.lat),S=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),D=h.locationPoint(g).distSqr(c),M=c.x<0||c.y<0||c.x>h.width||c.y>h.height;h.locationPoint(_).distSqr(c)<D&&(M||Math.abs(_.lng-h.center.lng)<S)?g=_:h.locationPoint(x).distSqr(c)<D&&(M||Math.abs(x.lng-h.center.lng)<S)&&(g=x)}for(;Math.abs(g.lng-h.center.lng)>180;){const _=h.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const sc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class sn extends p.Evented{constructor(c,h){if(super(),(c instanceof p.window.HTMLElement||h)&&(c=p.extend({element:c},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=p.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ye("div");const x=41,S=27,D=bt("svg",{display:"block",height:x*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${x}`},this._element),M=bt("radialGradient",{id:"shadowGradient"},bt("defs",{},D));bt("stop",{offset:"10%","stop-opacity":.4},M),bt("stop",{offset:"100%","stop-opacity":.05},M),bt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},D),bt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},D),bt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},D),bt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},D),this._offset=p.Point.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const _=this._element.classList;for(const x in sc)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=p.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const h=c.code,_=c.charCode||c.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(c){const h=c.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,h=this._pos;if(!c||!h)return!1;const _=c.unproject(h),x=c.getFreeCameraOptions();if(!x.position)return!1;const S=x.position.toLngLat();return S.distanceTo(_)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const h=this._pos;if(!h||h.x<0||h.x>c.transform.width||h.y<0||h.y>c.transform.height)return void this._clearFadeTimer();const _=c.unproject(h);let x;c._showingGlobe()&&p.isLngLatBehindGlobe(c.transform,this._lngLat)?x=0:(x=1-c._queryFogOpacity(_),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${sc[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const c=this._pos,h=this._map,_=this.getPitchAlignment();if(!h||!c||"map"!==_)return"";if(!h._showingGlobe()){const R=h.getPitch();return R?`rotateX(${R}deg)`:""}const x=p.radToDeg(p.globeTiltAtLngLat(h.transform,this._lngLat)),S=c.sub(p.globeCenterToScreenPoint(h.transform)),D=Math.abs(S.x)+Math.abs(S.y);if(0===D)return"";const M=x/D;return`rotateX(${-S.y*M}deg) rotateY(${S.x*M}deg)`}_calculateZTransform(){const c=this._pos,h=this._map;if(!h||!c)return"";let _=0;const x=this.getRotationAlignment();if("map"===x)if(h._showingGlobe()){const S=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),D=h.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(S);_=p.radToDeg(Math.atan2(D.y,D.x))-90}else _=-h.getBearing();else if("horizon"===x){const S=p.smoothstep(4,6,h.getZoom()),D=p.globeCenterToScreenPoint(h.transform);D.y+=S*h.transform.height;const M=c.sub(D),R=p.radToDeg(Math.atan2(M.y,M.x));_=(R>90?R-270:R+90)*(1-S)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(c){p.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Bs(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===c?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=p.Point.convert(c),this._update(),this}_onMove(c){const h=this._map;if(!h)return;const _=this._pointerdownPos,x=this._positionDelta;if(_&&x){if(!this._isDragging){const S=this._clickTolerance||h._clickTolerance;if(c.point.dist(_)<S)return;this._isDragging=!0}this._pos=c.point.sub(x),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(c){const h=this._map,_=this._pos;h&&_&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(_),this._pointerdownPos=c.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const h=this._map;return h&&(c?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Na={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},T_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bf(g=new p.Point(0,0),c="bottom"){if("number"==typeof g){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new p.Point(0,g);case"top-left":return new p.Point(h,h);case"top-right":return new p.Point(-h,h);case"bottom":return new p.Point(0,-g);case"bottom-left":return new p.Point(h,-h);case"bottom-right":return new p.Point(-h,-h);case"left":return new p.Point(g,0);case"right":return new p.Point(-g,0)}return new p.Point(0,0)}return g instanceof p.Point||Array.isArray(g)?p.Point.convert(g):p.Point.convert(g[c]||[0,0])}class _f{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const h=p.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,h,_){this._start=this.getValue(h),this._end=c,this._startTime=h,this._endTime=h+_}}const sg={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},rp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},yf={showCompass:!0,showZoom:!0,visualizePitch:!1};class ag{constructor(c,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new rc({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,_&&(this.mousePitch=new Ss({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),wt()}move(c,h){const _=this.map,x=this.mouseRotate.mousemoveWindow(c,h),S=x&&x.bearingDelta;if(S&&_.setBearing(_.getBearing()+S),this.mousePitch){const D=this.mousePitch.mousemoveWindow(c,h),M=D&&D.pitchDelta;M&&_.setPitch(_.getPitch()+M)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Jt(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(p.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),st(this.element,c)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,st(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=ln(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=ln(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ud={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},vf={maxWidth:100,unit:"metric"},op={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ac={version:p.version,supported:Qe,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends np{constructor(g){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(g=p.extend({},rp,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(g.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fd(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._useWebGL2=g.useWebGL2,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new $o,this._domRenderTaskQueue=new $o,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},sg,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new _f(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=p.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new ma(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new mf("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,p.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new bn({customAttribution:g.customAttribution})),this._logoControl=new ip,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new p.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new p.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(g,c){if(void 0===c&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[c];return-1!==c.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),this.fire(new p.Event("resize",g)),c&&this.fire(new p.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(p.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=null==g?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=null==g?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=null==g?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=null==g?85:g)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?p.window.navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(c=>"auto"===c?p.window.navigator.language:c):g}setLanguage(g){const c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,c=g.projection.name;let h;"globe"===c&&g.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),h=!0):"mercator"===c&&g.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;if(c="globe"===g.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(p.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(p.Point.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,c,h){if("mouseenter"===g||"mouseover"===g){let _=!1;const x=D=>{const M=c.filter(O=>this.getLayer(O)),R=M.length?this.queryRenderedFeatures(D.point,{layers:M}):[];R.length?_||(_=!0,h.call(this,new Dr(g,this,D.originalEvent,{features:R}))):_=!1},S=()=>{_=!1};return{layers:new Set(c),listener:h,delegates:{mousemove:x,mouseout:S}}}if("mouseleave"===g||"mouseout"===g){let _=!1;const x=D=>{const M=c.filter(R=>this.getLayer(R));(M.length?this.queryRenderedFeatures(D.point,{layers:M}):[]).length?_=!0:_&&(_=!1,h.call(this,new Dr(g,this,D.originalEvent)))},S=D=>{_&&(_=!1,h.call(this,new Dr(g,this,D.originalEvent)))};return{layers:new Set(c),listener:h,delegates:{mousemove:x,mouseout:S}}}{const _=x=>{const S=c.filter(M=>this.getLayer(M)),D=S.length?this.queryRenderedFeatures(x.point,{layers:S}):[];D.length&&(x.features=D,h.call(this,x),delete x.features)};return{layers:new Set(c),listener:h,delegates:{[g]:_}}}}on(g,c,h){if(void 0===h)return super.on(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(g,c,h){if(void 0===h)return super.once(g,c);Array.isArray(c)||(c=[c]);const _=this._createDelegatedListener(g,c,h);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(g,c,h){if(void 0===h)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);const _=(S,D)=>{if(S.size!==D.size)return!1;for(const M of S)if(!D.has(M))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[g]:void 0;return x&&(S=>{for(let D=0;D<S.length;D++){const M=S[D];if(M.listener===h&&_(M.layers,c)){for(const R in M.delegates)this.off(R,M.delegates[R]);return S.splice(D,1),this}}})(x),this}queryRenderedFeatures(g,c){return this.style?(void 0!==c||void 0===g||g instanceof p.Point||Array.isArray(g)||(c=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(g,c){return this.style.querySourceFeatures(g,c)}isPointOnSurface(g){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&p.warnOnce(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(g))}setStyle(g,c){return!1!==(c=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){const c=this._locale[g];if(null==c)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new ka(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ka(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if("string"==typeof g){const h=this._requestManager.normalizeStyleURL(g),_=this._requestManager.transformRequest(h,p.ResourceType.Style);p.getJSON(_,(x,S)=>{x?this.fire(new p.ErrorEvent(x)):S&&this._updateDiff(S,c)})}else"object"==typeof g&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(h){p.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(g,c){return this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const c in g){const h=g[c]._tiles;for(const _ in h){const x=h[_];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(g,c,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,h)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,c,{pixelRatio:h=1,sdf:_=!1,stretchX:x,stretchY:S,content:D}={}){if(this._lazyInitEmptyStyle(),c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap){const{width:M,height:R,data:O}=p.exported.getImageData(c);this.style.addImage(g,{data:new p.RGBAImage({width:M,height:R},O),pixelRatio:h,stretchX:x,stretchY:S,content:D,sdf:_,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:R}=c,O=c;this.style.addImage(g,{data:new p.RGBAImage({width:M,height:R},new Uint8Array(O.data)),pixelRatio:h,stretchX:x,stretchY:S,content:D,sdf:_,version:0,userImage:O}),O.onAdd&&O.onAdd(this,g)}}updateImage(g,c){const h=this.style.getImage(g);if(!h)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap?p.exported.getImageData(c):c,{width:x,height:S}=_;void 0!==x&&void 0!==S?x===h.data.width&&S===h.data.height?(h.data.replace(_.data,!(c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap)),this.style.updateImage(g,h)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${S})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){p.getImage(this._requestManager.transformRequest(g,p.ResourceType.Image),(h,_)=>{c(h,_ instanceof p.window.HTMLImageElement?p.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(g,c){return this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)}moveLayer(g,c){return this.style.moveLayer(g,c),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,c,h){return this.style.setLayerZoomRange(g,c,h),this._update(!0)}setFilter(g,c,h={}){return this.style.setFilter(g,c,h),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,c,h,_={}){return this.style.setPaintProperty(g,c,h,_),this._update(!0)}getPaintProperty(g,c){return this.style.getPaintProperty(g,c)}setLayoutProperty(g,c,h,_={}){return this.style.setLayoutProperty(g,c,h,_),this._update(!0)}getLayoutProperty(g,c){return this.style.getLayoutProperty(g,c)}setLight(g,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(g),this.transform):0}setFeatureState(g,c){return this.style.setFeatureState(g,c),this._update()}removeFeatureState(g,c){return this.style.removeFeatureState(g,c),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let h,_,x,S=this._container;for(;S&&(!_||!x);){const D=p.window.getComputedStyle(S).transform;D&&"none"!==D&&(h=D.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(x=h[3])),S=S.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=x?Math.abs(c/x):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ye("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Ye("div","mapboxgl-canvas-container",g);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=Ye("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=Ye("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=Ye("div",`mapboxgl-ctrl-${x}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){const h=p.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const c=this._markers.indexOf(g);-1!==c&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const c=this._popups.indexOf(g);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const g=p.extend({},Qe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",g),h=c||this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);h?(this._useWebGL2&&!c&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(h,!0),this.painter=new Pd(h,this.transform,!!c),this.on("data",_=>{"source"===_.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(h)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;const h=this.painter.context.extTimerQuery,_=p.exported.now();if(this.listens("gpu-timing-frame")&&(c=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,R=this.transform.pitch,O=p.exported.now(),F=new p.EvaluationParameters(M,{now:O,fadeDuration:x,pitch:R,transition:this.style.getTransition()});this.style.update(F)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const M=p.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,c),setTimeout(()=>{const R=h.getQueryObjectEXT(c,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(c),this.fire(new p.Event("gpu-timing-frame",{cpuTime:M,gpuTime:R})),p.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:R}})},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(M);this.fire(new p.Event("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(M);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:R}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(D||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(S=this._updateAverageElevation(_,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),S=!1;this.transform.elevation&&(S=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=g;const D=Math.abs(_-x);if(D>1){if(this._isInitialLoad||S)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,g,300)}else if(D>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===p.AUTH_ERR_MSG||401===g.status)){const c=this.painter.context.gl;p.storeAuthState(c,!1),this._logoControl instanceof ip&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function x(S){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,S,0);const D=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,D),D}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(x(g),c.canvasCopies.map(x),c.timeStamps)}_canvasPixelComparison(g,c,h){let _=h[1]-h[0];const x=g.length/4;for(let S=0;S<c.length;S++){const D=c[S];let M=0;for(let R=0;R<D.length;R+=4)D[R]===g[R]&&D[R+1]===g[R+1]&&D[R+2]===g[R+2]&&D[R+3]===g[R+3]&&(M+=1);_+=(h[S+2]-h[S+1])*(1-M/x)}return _}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=p.exported.frame(c=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(c)}))}_preloadTiles(g){const c=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(c,(h,_)=>h._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){p.setCacheLimits(g,c)}get version(){return p.version}},NavigationControl:class{constructor(g){this.options=p.extend({},yf,g),this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Ye("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Ye("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:c}):h.resetNorth({},{originalEvent:c}))}),this._compassIcon=Ye("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const c=g.getZoom(),h=c===g.getMaxZoom(),_=c===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ag(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){const h=Ye("button",g,this._container);return h.type="button",h.addEventListener("click",c),h}_setButtonTitle(g,c){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends p.Evented{constructor(g){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},Ud,g),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=pa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const c=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(h=>c("denied"!==h.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){const c=this._map.getMaxBounds(),h=g.coords;return!!c&&(h.longitude<c.getWest()||h.longitude>c.getEast()||h.latitude<c.getSouth()||h.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",g)),this._finish()}}_updateCamera(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,_=this._map.getBearing(),x=p.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(h),x,{geolocateSource:!0})}_updateMarker(g){if(g){const c=new p.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,c=p.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Ye("button","mapboxgl-ctrl-geolocate",this._container),Ye("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ye("div","mapboxgl-user-location"),this._dotElement.appendChild(Ye("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ye("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sn({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ye("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:bn,ScaleControl:class{constructor(g){this.options=p.extend({},vf,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(c){return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,c=this._map,h=c._containerHeight/2,_=c._containerWidth/2-g/2,x=c.unproject([_,h]),S=c.unproject([_+g,h]),D=x.distanceTo(S);if("imperial"===this.options.unit){const M=3.2808*D;M>5280?this._setScale(g,M/5280,"mile"):this._setScale(g,M,"foot")}else"nautical"===this.options.unit?this._setScale(g,D/1852,"nautical-mile"):D>=1e3?this._setScale(g,D/1e3,"kilometer"):this._setScale(g,D,"meter")}_setScale(g,c,h){this._map._requestDomTask(()=>{const _=function(S){const D=Math.pow(10,`${Math.floor(S)}`.length-1);let M=S/D;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(R){const O=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*O)/O}(M),D*M}(c),x=_/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(_):`${_}&nbsp;${op[h]}`,this._container.style.width=g*x+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof p.window.HTMLElement?this._container=g.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Ye("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ye("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(g){super(),this.options=p.extend(Object.create(Na),g),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=p.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(p.window.document.createTextNode(g))}setHTML(g){const c=p.window.document.createDocumentFragment(),h=p.window.document.createElement("body");let _;for(h.innerHTML=g;_=h.firstChild,_;)c.appendChild(_);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Ye("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){const h=this._closeButton=Ye("button","mapboxgl-popup-close-button",c);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const c=this._map,h=this._container,_=this._pos;if(!c||!h||!_)return"bottom";const x=h.offsetWidth,S=h.offsetHeight,D=_.x<x/2,M=_.x>c.transform.width-x/2;if(_.y+g<S)return D?"top-left":M?"top-right":"top";if(_.y>c.transform.height-S){if(D)return"bottom-left";if(M)return"bottom-right"}return D?"left":M?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){const c=this._map,h=this._content;if(!c||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=Ye("div","mapboxgl-popup",c.getContainer()),this._tip=Ye("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bs(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){const x=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),S=bf(this.options.offset),D=this._anchor=this._getAnchor(S.y),M=bf(this.options.offset,D),R=x.add(M).round();c._requestDomTask(()=>{this._container&&D&&(this._container.style.transform=`${sc[D]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&c._showingGlobe()){const x=p.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(T_);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:sn,Style:ka,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:y_,Evented:p.Evented,config:p.config,prewarm:function(){_u().acquire(nl)},clearPrewarmedResources:function(){const g=gs;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(nl),gs=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(g){p.config.ACCESS_TOKEN=g},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(g){p.config.API_URL=g},get workerCount(){return Eo.workerCount},set workerCount(g){Eo.workerCount=g},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){p.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){p.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return ac}),ye}()},9611:(on,hn,We)=>{!function(ye){ye.parser=function(ge,W){return new Ie(ge,W)},ye.SAXParser=Ie,ye.SAXStream=bt,ye.createStream=function Ye(ge,W){return new bt(ge,W)},ye.MAX_BUFFER_LENGTH=65536;var re,ke=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function Ie(ge,W){if(!(this instanceof Ie))return new Ie(ge,W);var Nt=this;(function ie(ge){for(var W=0,Nt=ke.length;W<Nt;W++)ge[ke[W]]=""})(Nt),Nt.q=Nt.c="",Nt.bufferCheckPosition=ye.MAX_BUFFER_LENGTH,Nt.opt=W||{},Nt.opt.lowercase=Nt.opt.lowercase||Nt.opt.lowercasetags,Nt.looseCase=Nt.opt.lowercase?"toLowerCase":"toUpperCase",Nt.tags=[],Nt.closed=Nt.closedRoot=Nt.sawRoot=!1,Nt.tag=Nt.error=null,Nt.strict=!!ge,Nt.noscript=!(!ge&&!Nt.opt.noscript),Nt.state=se.BEGIN,Nt.strictEntities=Nt.opt.strictEntities,Nt.ENTITIES=Object.create(Nt.strictEntities?ye.XML_ENTITIES:ye.ENTITIES),Nt.attribList=[],Nt.opt.xmlns&&(Nt.ns=Object.create(Jt)),Nt.trackPosition=!1!==Nt.opt.position,Nt.trackPosition&&(Nt.position=Nt.line=Nt.column=0),lt(Nt,"onready")}ye.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(ge){function W(){}return W.prototype=ge,new W}),Object.keys||(Object.keys=function(ge){var W=[];for(var Nt in ge)ge.hasOwnProperty(Nt)&&W.push(Nt);return W}),Ie.prototype={end:function(){oi(this)},write:function Ii(ge){var W=this;if(this.error)throw this.error;if(W.closed)return Dt(W,"Cannot write after close. Assign an onready handler.");if(null===ge)return oi(W);"object"==typeof ge&&(ge=ge.toString());for(var Nt=0,Je="";Je=ki(ge,Nt++),W.c=Je,Je;)switch(W.trackPosition&&(W.position++,"\n"===Je?(W.line++,W.column=0):W.column++),W.state){case se.BEGIN:if(W.state=se.BEGIN_WHITESPACE,"\ufeff"===Je)continue;vo(W,Je);continue;case se.BEGIN_WHITESPACE:vo(W,Je);continue;case se.TEXT:if(W.sawRoot&&!W.closedRoot){for(var Ri=Nt-1;Je&&"<"!==Je&&"&"!==Je;)(Je=ki(ge,Nt++))&&W.trackPosition&&(W.position++,"\n"===Je?(W.line++,W.column=0):W.column++);W.textNode+=ge.substring(Ri,Nt-1)}"<"!==Je||W.sawRoot&&W.closedRoot&&!W.strict?(!Te(Je)&&(!W.sawRoot||W.closedRoot)&&Lt(W,"Text data outside of root node."),"&"===Je?W.state=se.TEXT_ENTITY:W.textNode+=Je):(W.state=se.OPEN_WAKA,W.startTagPosition=W.position);continue;case se.SCRIPT:"<"===Je?W.state=se.SCRIPT_ENDING:W.script+=Je;continue;case se.SCRIPT_ENDING:"/"===Je?W.state=se.CLOSE_TAG:(W.script+="<"+Je,W.state=se.SCRIPT);continue;case se.OPEN_WAKA:"!"===Je?(W.state=se.SGML_DECL,W.sgmlDecl=""):Te(Je)||(ce(vn,Je)?(W.state=se.OPEN_TAG,W.tagName=Je):"/"===Je?(W.state=se.CLOSE_TAG,W.tagName=""):"?"===Je?(W.state=se.PROC_INST,W.procInstName=W.procInstBody=""):(Lt(W,"Unencoded <"),W.startTagPosition+1<W.position&&(Je=new Array(W.position-W.startTagPosition).join(" ")+Je),W.textNode+="<"+Je,W.state=se.TEXT));continue;case se.SGML_DECL:"[CDATA["===(W.sgmlDecl+Je).toUpperCase()?(gt(W,"onopencdata"),W.state=se.CDATA,W.sgmlDecl="",W.cdata=""):W.sgmlDecl+Je==="--"?(W.state=se.COMMENT,W.comment="",W.sgmlDecl=""):"DOCTYPE"===(W.sgmlDecl+Je).toUpperCase()?(W.state=se.DOCTYPE,(W.doctype||W.sawRoot)&&Lt(W,"Inappropriately located doctype declaration"),W.doctype="",W.sgmlDecl=""):">"===Je?(gt(W,"onsgmldeclaration",W.sgmlDecl),W.sgmlDecl="",W.state=se.TEXT):(xe(Je)&&(W.state=se.SGML_DECL_QUOTED),W.sgmlDecl+=Je);continue;case se.SGML_DECL_QUOTED:Je===W.q&&(W.state=se.SGML_DECL,W.q=""),W.sgmlDecl+=Je;continue;case se.DOCTYPE:">"===Je?(W.state=se.TEXT,gt(W,"ondoctype",W.doctype),W.doctype=!0):(W.doctype+=Je,"["===Je?W.state=se.DOCTYPE_DTD:xe(Je)&&(W.state=se.DOCTYPE_QUOTED,W.q=Je));continue;case se.DOCTYPE_QUOTED:W.doctype+=Je,Je===W.q&&(W.q="",W.state=se.DOCTYPE);continue;case se.DOCTYPE_DTD:W.doctype+=Je,"]"===Je?W.state=se.DOCTYPE:xe(Je)&&(W.state=se.DOCTYPE_DTD_QUOTED,W.q=Je);continue;case se.DOCTYPE_DTD_QUOTED:W.doctype+=Je,Je===W.q&&(W.state=se.DOCTYPE_DTD,W.q="");continue;case se.COMMENT:"-"===Je?W.state=se.COMMENT_ENDING:W.comment+=Je;continue;case se.COMMENT_ENDING:"-"===Je?(W.state=se.COMMENT_ENDED,W.comment=vt(W.opt,W.comment),W.comment&&gt(W,"oncomment",W.comment),W.comment=""):(W.comment+="-"+Je,W.state=se.COMMENT);continue;case se.COMMENT_ENDED:">"!==Je?(Lt(W,"Malformed comment"),W.comment+="--"+Je,W.state=se.COMMENT):W.state=se.TEXT;continue;case se.CDATA:"]"===Je?W.state=se.CDATA_ENDING:W.cdata+=Je;continue;case se.CDATA_ENDING:"]"===Je?W.state=se.CDATA_ENDING_2:(W.cdata+="]"+Je,W.state=se.CDATA);continue;case se.CDATA_ENDING_2:">"===Je?(W.cdata&&gt(W,"oncdata",W.cdata),gt(W,"onclosecdata"),W.cdata="",W.state=se.TEXT):"]"===Je?W.cdata+="]":(W.cdata+="]]"+Je,W.state=se.CDATA);continue;case se.PROC_INST:"?"===Je?W.state=se.PROC_INST_ENDING:Te(Je)?W.state=se.PROC_INST_BODY:W.procInstName+=Je;continue;case se.PROC_INST_BODY:if(!W.procInstBody&&Te(Je))continue;"?"===Je?W.state=se.PROC_INST_ENDING:W.procInstBody+=Je;continue;case se.PROC_INST_ENDING:">"===Je?(gt(W,"onprocessinginstruction",{name:W.procInstName,body:W.procInstBody}),W.procInstName=W.procInstBody="",W.state=se.TEXT):(W.procInstBody+="?"+Je,W.state=se.PROC_INST_BODY);continue;case se.OPEN_TAG:ce(Cn,Je)?W.tagName+=Je:(cn(W),">"===Je?xi(W):"/"===Je?W.state=se.OPEN_TAG_SLASH:(Te(Je)||Lt(W,"Invalid character in tag name"),W.state=se.ATTRIB));continue;case se.OPEN_TAG_SLASH:">"===Je?(xi(W,!0),Kt(W)):(Lt(W,"Forward-slash in opening tag not followed by >"),W.state=se.ATTRIB);continue;case se.ATTRIB:if(Te(Je))continue;">"===Je?xi(W):"/"===Je?W.state=se.OPEN_TAG_SLASH:ce(vn,Je)?(W.attribName=Je,W.attribValue="",W.state=se.ATTRIB_NAME):Lt(W,"Invalid attribute name");continue;case se.ATTRIB_NAME:"="===Je?W.state=se.ATTRIB_VALUE:">"===Je?(Lt(W,"Attribute without value"),W.attribValue=W.attribName,Fi(W),xi(W)):Te(Je)?W.state=se.ATTRIB_NAME_SAW_WHITE:ce(Cn,Je)?W.attribName+=Je:Lt(W,"Invalid attribute name");continue;case se.ATTRIB_NAME_SAW_WHITE:if("="===Je)W.state=se.ATTRIB_VALUE;else{if(Te(Je))continue;Lt(W,"Attribute without value"),W.tag.attributes[W.attribName]="",W.attribValue="",gt(W,"onattribute",{name:W.attribName,value:""}),W.attribName="",">"===Je?xi(W):ce(vn,Je)?(W.attribName=Je,W.state=se.ATTRIB_NAME):(Lt(W,"Invalid attribute name"),W.state=se.ATTRIB)}continue;case se.ATTRIB_VALUE:if(Te(Je))continue;xe(Je)?(W.q=Je,W.state=se.ATTRIB_VALUE_QUOTED):(Lt(W,"Unquoted attribute value"),W.state=se.ATTRIB_VALUE_UNQUOTED,W.attribValue=Je);continue;case se.ATTRIB_VALUE_QUOTED:if(Je!==W.q){"&"===Je?W.state=se.ATTRIB_VALUE_ENTITY_Q:W.attribValue+=Je;continue}Fi(W),W.q="",W.state=se.ATTRIB_VALUE_CLOSED;continue;case se.ATTRIB_VALUE_CLOSED:Te(Je)?W.state=se.ATTRIB:">"===Je?xi(W):"/"===Je?W.state=se.OPEN_TAG_SLASH:ce(vn,Je)?(Lt(W,"No whitespace between attributes"),W.attribName=Je,W.attribValue="",W.state=se.ATTRIB_NAME):Lt(W,"Invalid attribute name");continue;case se.ATTRIB_VALUE_UNQUOTED:if(!Ae(Je)){"&"===Je?W.state=se.ATTRIB_VALUE_ENTITY_U:W.attribValue+=Je;continue}Fi(W),">"===Je?xi(W):W.state=se.ATTRIB;continue;case se.CLOSE_TAG:if(W.tagName)">"===Je?Kt(W):ce(Cn,Je)?W.tagName+=Je:W.script?(W.script+="</"+W.tagName,W.tagName="",W.state=se.SCRIPT):(Te(Je)||Lt(W,"Invalid tagname in closing tag"),W.state=se.CLOSE_TAG_SAW_WHITE);else{if(Te(Je))continue;ut(vn,Je)?W.script?(W.script+="</"+Je,W.state=se.SCRIPT):Lt(W,"Invalid tagname in closing tag."):W.tagName=Je}continue;case se.CLOSE_TAG_SAW_WHITE:if(Te(Je))continue;">"===Je?Kt(W):Lt(W,"Invalid characters in closing tag");continue;case se.TEXT_ENTITY:case se.ATTRIB_VALUE_ENTITY_Q:case se.ATTRIB_VALUE_ENTITY_U:var Ci,Xr;switch(W.state){case se.TEXT_ENTITY:Ci=se.TEXT,Xr="textNode";break;case se.ATTRIB_VALUE_ENTITY_Q:Ci=se.ATTRIB_VALUE_QUOTED,Xr="attribValue";break;case se.ATTRIB_VALUE_ENTITY_U:Ci=se.ATTRIB_VALUE_UNQUOTED,Xr="attribValue"}if(";"===Je)if(W.opt.unparsedEntities){var Zr=To(W);W.entity="",W.state=Ci,W.write(Zr)}else W[Xr]+=To(W),W.entity="",W.state=Ci;else ce(W.entity.length?ln:st,Je)?W.entity+=Je:(Lt(W,"Invalid character in entity name"),W[Xr]+="&"+W.entity+Je,W.entity="",W.state=Ci);continue;default:throw new Error(W,"Unknown state: "+W.state)}return W.position>=W.bufferCheckPosition&&function p(ge){for(var W=Math.max(ye.MAX_BUFFER_LENGTH,10),Nt=0,Je=0,Ri=ke.length;Je<Ri;Je++){var Jn=ge[ke[Je]].length;if(Jn>W)switch(ke[Je]){case"textNode":He(ge);break;case"cdata":gt(ge,"oncdata",ge.cdata),ge.cdata="";break;case"script":gt(ge,"onscript",ge.script),ge.script="";break;default:Dt(ge,"Max buffer length exceeded: "+ke[Je])}Nt=Math.max(Nt,Jn)}ge.bufferCheckPosition=ye.MAX_BUFFER_LENGTH-Nt+ge.position}(W),W},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){!function Qe(ge){He(ge),""!==ge.cdata&&(gt(ge,"oncdata",ge.cdata),ge.cdata=""),""!==ge.script&&(gt(ge,"onscript",ge.script),ge.script="")}(this)}};try{re=We(5398).Stream}catch(ge){re=function(){}}re||(re=function(){});var Ue=ye.EVENTS.filter(function(ge){return"error"!==ge&&"end"!==ge});function bt(ge,W){if(!(this instanceof bt))return new bt(ge,W);re.apply(this),this._parser=new Ie(ge,W),this.writable=!0,this.readable=!0;var Nt=this;this._parser.onend=function(){Nt.emit("end")},this._parser.onerror=function(Je){Nt.emit("error",Je),Nt._parser.error=null},this._decoder=null,Ue.forEach(function(Je){Object.defineProperty(Nt,"on"+Je,{get:function(){return Nt._parser["on"+Je]},set:function(Ri){if(!Ri)return Nt.removeAllListeners(Je),Nt._parser["on"+Je]=Ri,Ri;Nt.on(Je,Ri)},enumerable:!0,configurable:!1})})}(bt.prototype=Object.create(re.prototype,{constructor:{value:bt}})).write=function(ge){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(ge)){if(!this._decoder){var W=We(3054).s;this._decoder=new W("utf8")}ge=this._decoder.write(ge)}return this._parser.write(ge.toString()),this.emit("data",ge),!0},bt.prototype.end=function(ge){return ge&&ge.length&&this.write(ge),this._parser.end(),!0},bt.prototype.on=function(ge,W){var Nt=this;return!Nt._parser["on"+ge]&&-1!==Ue.indexOf(ge)&&(Nt._parser["on"+ge]=function(){var Je=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);Je.splice(0,0,ge),Nt.emit.apply(Nt,Je)}),re.prototype.on.call(Nt,ge,W)};var Ge="http://www.w3.org/XML/1998/namespace",wt="http://www.w3.org/2000/xmlns/",Jt={xml:Ge,xmlns:wt},vn=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Cn=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,st=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,ln=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function Te(ge){return" "===ge||"\n"===ge||"\r"===ge||"\t"===ge}function xe(ge){return'"'===ge||"'"===ge}function Ae(ge){return">"===ge||Te(ge)}function ce(ge,W){return ge.test(W)}function ut(ge,W){return!ce(ge,W)}var ge,W,Nt,se=0;for(var be in ye.STATE={BEGIN:se++,BEGIN_WHITESPACE:se++,TEXT:se++,TEXT_ENTITY:se++,OPEN_WAKA:se++,SGML_DECL:se++,SGML_DECL_QUOTED:se++,DOCTYPE:se++,DOCTYPE_QUOTED:se++,DOCTYPE_DTD:se++,DOCTYPE_DTD_QUOTED:se++,COMMENT_STARTING:se++,COMMENT:se++,COMMENT_ENDING:se++,COMMENT_ENDED:se++,CDATA:se++,CDATA_ENDING:se++,CDATA_ENDING_2:se++,PROC_INST:se++,PROC_INST_BODY:se++,PROC_INST_ENDING:se++,OPEN_TAG:se++,OPEN_TAG_SLASH:se++,ATTRIB:se++,ATTRIB_NAME:se++,ATTRIB_NAME_SAW_WHITE:se++,ATTRIB_VALUE:se++,ATTRIB_VALUE_QUOTED:se++,ATTRIB_VALUE_CLOSED:se++,ATTRIB_VALUE_UNQUOTED:se++,ATTRIB_VALUE_ENTITY_Q:se++,ATTRIB_VALUE_ENTITY_U:se++,CLOSE_TAG:se++,CLOSE_TAG_SAW_WHITE:se++,SCRIPT:se++,SCRIPT_ENDING:se++},ye.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},ye.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(ye.ENTITIES).forEach(function(ge){var W=ye.ENTITIES[ge],Nt="number"==typeof W?String.fromCharCode(W):W;ye.ENTITIES[ge]=Nt}),ye.STATE)ye.STATE[ye.STATE[be]]=be;function lt(ge,W,Nt){ge[W]&&ge[W](Nt)}function gt(ge,W,Nt){ge.textNode&&He(ge),lt(ge,W,Nt)}function He(ge){ge.textNode=vt(ge.opt,ge.textNode),ge.textNode&&lt(ge,"ontext",ge.textNode),ge.textNode=""}function vt(ge,W){return ge.trim&&(W=W.trim()),ge.normalize&&(W=W.replace(/\s+/g," ")),W}function Dt(ge,W){return He(ge),ge.trackPosition&&(W+="\nLine: "+ge.line+"\nColumn: "+ge.column+"\nChar: "+ge.c),W=new Error(W),ge.error=W,lt(ge,"onerror",W),ge}function oi(ge){return ge.sawRoot&&!ge.closedRoot&&Lt(ge,"Unclosed root tag"),ge.state!==se.BEGIN&&ge.state!==se.BEGIN_WHITESPACE&&ge.state!==se.TEXT&&Dt(ge,"Unexpected end"),He(ge),ge.c="",ge.closed=!0,lt(ge,"onend"),Ie.call(ge,ge.strict,ge.opt),ge}function Lt(ge,W){if("object"!=typeof ge||!(ge instanceof Ie))throw new Error("bad call to strictFail");ge.strict&&Dt(ge,W)}function cn(ge){ge.strict||(ge.tagName=ge.tagName[ge.looseCase]());var W=ge.tags[ge.tags.length-1]||ge,Nt=ge.tag={name:ge.tagName,attributes:{}};ge.opt.xmlns&&(Nt.ns=W.ns),ge.attribList.length=0,gt(ge,"onopentagstart",Nt)}function qi(ge,W){var Je=ge.indexOf(":")<0?["",ge]:ge.split(":"),Ri=Je[0],Jn=Je[1];return W&&"xmlns"===ge&&(Ri="xmlns",Jn=""),{prefix:Ri,local:Jn}}function Fi(ge){if(ge.strict||(ge.attribName=ge.attribName[ge.looseCase]()),-1!==ge.attribList.indexOf(ge.attribName)||ge.tag.attributes.hasOwnProperty(ge.attribName))ge.attribName=ge.attribValue="";else{if(ge.opt.xmlns){var W=qi(ge.attribName,!0),Je=W.local;if("xmlns"===W.prefix)if("xml"===Je&&ge.attribValue!==Ge)Lt(ge,"xml: prefix must be bound to "+Ge+"\nActual: "+ge.attribValue);else if("xmlns"===Je&&ge.attribValue!==wt)Lt(ge,"xmlns: prefix must be bound to "+wt+"\nActual: "+ge.attribValue);else{var Ri=ge.tag,Jn=ge.tags[ge.tags.length-1]||ge;Ri.ns===Jn.ns&&(Ri.ns=Object.create(Jn.ns)),Ri.ns[Je]=ge.attribValue}ge.attribList.push([ge.attribName,ge.attribValue])}else ge.tag.attributes[ge.attribName]=ge.attribValue,gt(ge,"onattribute",{name:ge.attribName,value:ge.attribValue});ge.attribName=ge.attribValue=""}}function xi(ge,W){if(ge.opt.xmlns){var Nt=ge.tag,Je=qi(ge.tagName);Nt.prefix=Je.prefix,Nt.local=Je.local,Nt.uri=Nt.ns[Je.prefix]||"",Nt.prefix&&!Nt.uri&&(Lt(ge,"Unbound namespace prefix: "+JSON.stringify(ge.tagName)),Nt.uri=Je.prefix),Nt.ns&&(ge.tags[ge.tags.length-1]||ge).ns!==Nt.ns&&Object.keys(Nt.ns).forEach(function(nn){gt(ge,"onopennamespace",{prefix:nn,uri:Nt.ns[nn]})});for(var Jn=0,Ci=ge.attribList.length;Jn<Ci;Jn++){var Xr=ge.attribList[Jn],Zr=Xr[0],fe=Xr[1],V=qi(Zr,!0),q=V.prefix,Ke=""===q?"":Nt.ns[q]||"",qt={name:Zr,value:fe,prefix:q,local:V.local,uri:Ke};q&&"xmlns"!==q&&!Ke&&(Lt(ge,"Unbound namespace prefix: "+JSON.stringify(q)),qt.uri=q),ge.tag.attributes[Zr]=qt,gt(ge,"onattribute",qt)}ge.attribList.length=0}ge.tag.isSelfClosing=!!W,ge.sawRoot=!0,ge.tags.push(ge.tag),gt(ge,"onopentag",ge.tag),W||(ge.state=ge.noscript||"script"!==ge.tagName.toLowerCase()?se.TEXT:se.SCRIPT,ge.tag=null,ge.tagName=""),ge.attribName=ge.attribValue="",ge.attribList.length=0}function Kt(ge){if(!ge.tagName)return Lt(ge,"Weird empty close tag."),ge.textNode+="</>",void(ge.state=se.TEXT);if(ge.script){if("script"!==ge.tagName)return ge.script+="</"+ge.tagName+">",ge.tagName="",void(ge.state=se.SCRIPT);gt(ge,"onscript",ge.script),ge.script=""}var W=ge.tags.length,Nt=ge.tagName;ge.strict||(Nt=Nt[ge.looseCase]());for(var Je=Nt;W--&&ge.tags[W].name!==Je;)Lt(ge,"Unexpected close tag");if(W<0)return Lt(ge,"Unmatched closing tag: "+ge.tagName),ge.textNode+="</"+ge.tagName+">",void(ge.state=se.TEXT);ge.tagName=Nt;for(var Jn=ge.tags.length;Jn-- >W;){var Ci=ge.tag=ge.tags.pop();ge.tagName=ge.tag.name,gt(ge,"onclosetag",ge.tagName);var Xr={};for(var Zr in Ci.ns)Xr[Zr]=Ci.ns[Zr];ge.opt.xmlns&&Ci.ns!==(ge.tags[ge.tags.length-1]||ge).ns&&Object.keys(Ci.ns).forEach(function(V){gt(ge,"onclosenamespace",{prefix:V,uri:Ci.ns[V]})})}0===W&&(ge.closedRoot=!0),ge.tagName=ge.attribValue=ge.attribName="",ge.attribList.length=0,ge.state=se.TEXT}function To(ge){var Je,W=ge.entity,Nt=W.toLowerCase(),Ri="";return ge.ENTITIES[W]?ge.ENTITIES[W]:ge.ENTITIES[Nt]?ge.ENTITIES[Nt]:("#"===(W=Nt).charAt(0)&&("x"===W.charAt(1)?(W=W.slice(2),Ri=(Je=parseInt(W,16)).toString(16)):(W=W.slice(1),Ri=(Je=parseInt(W,10)).toString(10))),W=W.replace(/^0+/,""),isNaN(Je)||Ri.toLowerCase()!==W?(Lt(ge,"Invalid character entity"),"&"+ge.entity+";"):String.fromCodePoint(Je))}function vo(ge,W){"<"===W?(ge.state=se.OPEN_WAKA,ge.startTagPosition=ge.position):Te(W)||(Lt(ge,"Non-whitespace before first tag."),ge.textNode=W,ge.state=se.TEXT)}function ki(ge,W){var Nt="";return W<ge.length&&(Nt=ge.charAt(W)),Nt}se=ye.STATE,String.fromCodePoint||(ge=String.fromCharCode,W=Math.floor,Nt=function(){var Je=16384,Ri=[],Xr=-1,Zr=arguments.length;if(!Zr)return"";for(var fe="";++Xr<Zr;){var V=Number(arguments[Xr]);if(!isFinite(V)||V<0||V>1114111||W(V)!==V)throw RangeError("Invalid code point: "+V);V<=65535?Ri.push(V):Ri.push(55296+((V-=65536)>>10),V%1024+56320),(Xr+1===Zr||Ri.length>Je)&&(fe+=ge.apply(null,Ri),Ri.length=0)}return fe},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:Nt,configurable:!0,writable:!0}):String.fromCodePoint=Nt)}(hn)},3502:(on,hn,We)=>{var ye=We(3172),ke=ye.Buffer;function Ie(ie,Qe){for(var re in ie)Qe[re]=ie[re]}function p(ie,Qe,re){return ke(ie,Qe,re)}ke.from&&ke.alloc&&ke.allocUnsafe&&ke.allocUnsafeSlow?on.exports=ye:(Ie(ye,hn),hn.Buffer=p),p.prototype=Object.create(ke.prototype),Ie(ke,p),p.from=function(ie,Qe,re){if("number"==typeof ie)throw new TypeError("Argument must not be a number");return ke(ie,Qe,re)},p.alloc=function(ie,Qe,re){if("number"!=typeof ie)throw new TypeError("Argument must be a number");var Ue=ke(ie);return void 0!==Qe?"string"==typeof re?Ue.fill(Qe,re):Ue.fill(Qe):Ue.fill(0),Ue},p.allocUnsafe=function(ie){if("number"!=typeof ie)throw new TypeError("Argument must be a number");return ke(ie)},p.allocUnsafeSlow=function(ie){if("number"!=typeof ie)throw new TypeError("Argument must be a number");return ye.SlowBuffer(ie)}},5398:(on,hn,We)=>{var ye=We(6570);function ke(){ye.call(this)}ke.prototype=new ye,on.exports=ke,ke.Stream=ke,ke.prototype.pipe=function(Ie,p){var ie=this;function Qe(Ge){Ie.writable&&!1===Ie.write(Ge)&&ie.pause&&ie.pause()}function re(){ie.readable&&ie.resume&&ie.resume()}ie.on("data",Qe),Ie.on("drain",re),!Ie._isStdio&&(!p||!1!==p.end)&&(ie.on("end",Ye),ie.on("close",bt));var Ue=!1;function Ye(){Ue||(Ue=!0,Ie.end())}function bt(){Ue||(Ue=!0,"function"==typeof Ie.destroy&&Ie.destroy())}function Ct(Ge){if($e(),!this.hasListeners("error"))throw Ge}function $e(){ie.off("data",Qe),Ie.off("drain",re),ie.off("end",Ye),ie.off("close",bt),ie.off("error",Ct),Ie.off("error",Ct),ie.off("end",$e),ie.off("close",$e),Ie.off("end",$e),Ie.off("close",$e)}return ie.on("error",Ct),Ie.on("error",Ct),ie.on("end",$e),ie.on("close",$e),Ie.on("end",$e),Ie.on("close",$e),Ie.emit("pipe",ie),Ie}},3054:(on,hn,We)=>{"use strict";var ye=We(3502).Buffer,ke=ye.isEncoding||function(st){switch((st=""+st)&&st.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function ie(st){var ln;switch(this.encoding=function p(st){var ln=function Ie(st){if(!st)return"utf8";for(var ln;;)switch(st){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return st;default:if(ln)return;st=(""+st).toLowerCase(),ln=!0}}(st);if("string"!=typeof ln&&(ye.isEncoding===ke||!ke(st)))throw new Error("Unknown encoding: "+st);return ln||st}(st),this.encoding){case"utf16le":this.text=$e,this.end=Ge,ln=4;break;case"utf8":this.fillLast=Ye,ln=4;break;case"base64":this.text=wt,this.end=Jt,ln=3;break;default:return this.write=vn,void(this.end=Cn)}this.lastNeed=0,this.lastTotal=0,this.lastChar=ye.allocUnsafe(ln)}function Qe(st){return st<=127?0:st>>5==6?2:st>>4==14?3:st>>3==30?4:st>>6==2?-1:-2}function Ye(st){var ln=this.lastTotal-this.lastNeed,Te=function Ue(st,ln,Te){if(128!=(192&ln[0]))return st.lastNeed=0,"\ufffd";if(st.lastNeed>1&&ln.length>1){if(128!=(192&ln[1]))return st.lastNeed=1,"\ufffd";if(st.lastNeed>2&&ln.length>2&&128!=(192&ln[2]))return st.lastNeed=2,"\ufffd"}}(this,st);return void 0!==Te?Te:this.lastNeed<=st.length?(st.copy(this.lastChar,ln,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(st.copy(this.lastChar,ln,0,st.length),void(this.lastNeed-=st.length))}function $e(st,ln){if((st.length-ln)%2==0){var Te=st.toString("utf16le",ln);if(Te){var xe=Te.charCodeAt(Te.length-1);if(xe>=55296&&xe<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=st[st.length-2],this.lastChar[1]=st[st.length-1],Te.slice(0,-1)}return Te}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=st[st.length-1],st.toString("utf16le",ln,st.length-1)}function Ge(st){var ln=st&&st.length?this.write(st):"";return this.lastNeed?ln+this.lastChar.toString("utf16le",0,this.lastTotal-this.lastNeed):ln}function wt(st,ln){var Te=(st.length-ln)%3;return 0===Te?st.toString("base64",ln):(this.lastNeed=3-Te,this.lastTotal=3,1===Te?this.lastChar[0]=st[st.length-1]:(this.lastChar[0]=st[st.length-2],this.lastChar[1]=st[st.length-1]),st.toString("base64",ln,st.length-Te))}function Jt(st){var ln=st&&st.length?this.write(st):"";return this.lastNeed?ln+this.lastChar.toString("base64",0,3-this.lastNeed):ln}function vn(st){return st.toString(this.encoding)}function Cn(st){return st&&st.length?this.write(st):""}hn.s=ie,ie.prototype.write=function(st){if(0===st.length)return"";var ln,Te;if(this.lastNeed){if(void 0===(ln=this.fillLast(st)))return"";Te=this.lastNeed,this.lastNeed=0}else Te=0;return Te<st.length?ln?ln+this.text(st,Te):this.text(st,Te):ln||""},ie.prototype.end=function Ct(st){var ln=st&&st.length?this.write(st):"";return this.lastNeed?ln+"\ufffd":ln},ie.prototype.text=function bt(st,ln){var Te=function re(st,ln,Te){var xe=ln.length-1;if(xe<Te)return 0;var Ae=Qe(ln[xe]);return Ae>=0?(Ae>0&&(st.lastNeed=Ae-1),Ae):--xe<Te||-2===Ae?0:(Ae=Qe(ln[xe]))>=0?(Ae>0&&(st.lastNeed=Ae-2),Ae):--xe<Te||-2===Ae?0:(Ae=Qe(ln[xe]))>=0?(Ae>0&&(2===Ae?Ae=0:st.lastNeed=Ae-3),Ae):0}(this,st,ln);if(!this.lastNeed)return st.toString("utf8",ln);this.lastTotal=Te;var xe=st.length-(Te-this.lastNeed);return st.copy(this.lastChar,0,xe),st.toString("utf8",ln,xe)},ie.prototype.fillLast=function(st){if(this.lastNeed<=st.length)return st.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);st.copy(this.lastChar,this.lastTotal-this.lastNeed,0,st.length),this.lastNeed-=st.length}},599:function(on){(function(){on.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},2269:function(on){(function(){on.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},3452:function(on){(function(){var hn,We,ye,ke,Ie,p,ie,Qe={}.hasOwnProperty;hn=function(re,...Ue){var Ye,bt,Ct,$e;if(Ie(Object.assign))Object.assign.apply(null,arguments);else for(Ye=0,Ct=Ue.length;Ye<Ct;Ye++)if(null!=($e=Ue[Ye]))for(bt in $e)!Qe.call($e,bt)||(re[bt]=$e[bt]);return re},Ie=function(re){return!!re&&"[object Function]"===Object.prototype.toString.call(re)},p=function(re){var Ue;return!!re&&("function"==(Ue=typeof re)||"object"===Ue)},ye=function(re){return Ie(Array.isArray)?Array.isArray(re):"[object Array]"===Object.prototype.toString.call(re)},ke=function(re){var Ue;if(ye(re))return!re.length;for(Ue in re)if(Qe.call(re,Ue))return!1;return!0},ie=function(re){var Ue,Ye;return p(re)&&(Ye=Object.getPrototypeOf(re))&&(Ue=Ye.constructor)&&"function"==typeof Ue&&Ue instanceof Ue&&Function.prototype.toString.call(Ue)===Function.prototype.toString.call(Object)},We=function(re){return Ie(re.valueOf)?re.valueOf():re},on.exports.assign=hn,on.exports.isFunction=Ie,on.exports.isObject=p,on.exports.isArray=ye,on.exports.isEmpty=ke,on.exports.isPlainObject=ie,on.exports.getValue=We}).call(this)},6316:function(on){(function(){on.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},5968:function(on,hn,We){(function(){var ye;ye=We(2269),We(8563),on.exports=function(){class p{constructor(Qe,re,Ue){if(this.parent=Qe,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==re)throw new Error("Missing attribute name. "+this.debugInfo(re));this.name=this.stringify.name(re),this.value=this.stringify.attValue(Ue),this.type=ye.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(Qe){return this.options.writer.attribute(this,this.options.writer.filterOptions(Qe))}debugInfo(Qe){return null==(Qe=Qe||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+Qe+"}, parent: <"+this.parent.name+">"}isEqualNode(Qe){return!(Qe.namespaceURI!==this.namespaceURI||Qe.prefix!==this.prefix||Qe.localName!==this.localName||Qe.value!==this.value)}}return Object.defineProperty(p.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(p.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(p.prototype,"textContent",{get:function(){return this.value},set:function(ie){return this.value=ie||""}}),Object.defineProperty(p.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(p.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(p.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(p.prototype,"specified",{get:function(){return!0}}),p}.call(this)}).call(this)},1361:function(on,hn,We){(function(){var ye,Ie;ye=We(2269),Ie=We(2182),on.exports=class extends Ie{constructor(ie,Qe){if(super(ie),null==Qe)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=ye.CData,this.value=this.stringify.cdata(Qe)}clone(){return Object.create(this)}toString(ie){return this.options.writer.cdata(this,this.options.writer.filterOptions(ie))}}}).call(this)},2182:function(on,hn,We){(function(){var ke;ke=We(8563),on.exports=function(){class Ie extends ke{constructor(ie){super(ie),this.value=""}clone(){return Object.create(this)}substringData(ie,Qe){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(ie){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(ie,Qe){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(ie,Qe){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(ie,Qe,re){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(ie){return!(!super.isEqualNode(ie)||ie.data!==this.data)}}return Object.defineProperty(Ie.prototype,"data",{get:function(){return this.value},set:function(p){return this.value=p||""}}),Object.defineProperty(Ie.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(Ie.prototype,"textContent",{get:function(){return this.value},set:function(p){return this.value=p||""}}),Ie}.call(this)}).call(this)},2516:function(on,hn,We){(function(){var ye,ke;ye=We(2269),ke=We(2182),on.exports=class extends ke{constructor(ie,Qe){if(super(ie),null==Qe)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=ye.Comment,this.value=this.stringify.comment(Qe)}clone(){return Object.create(this)}toString(ie){return this.options.writer.comment(this,this.options.writer.filterOptions(ie))}}}).call(this)},5806:function(on,hn,We){(function(){var ke,Ie;ke=We(9276),Ie=We(3735),on.exports=function(){class p{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new ke,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(Qe){return this.params.hasOwnProperty(Qe)?this.params[Qe]:null}canSetParameter(Qe,re){return!0}setParameter(Qe,re){return null!=re?this.params[Qe]=re:delete this.params[Qe]}}return Object.defineProperty(p.prototype,"parameterNames",{get:function(){return new Ie(Object.keys(this.defaultParams))}}),p}.call(this)}).call(this)},9276:function(on){(function(){on.exports=class{constructor(){}handleError(ye){throw new Error(ye)}}}).call(this)},9906:function(on){(function(){on.exports=class{hasFeature(ye,ke){return!0}createDocumentType(ye,ke,Ie){throw new Error("This DOM method is not implemented.")}createDocument(ye,ke,Ie){throw new Error("This DOM method is not implemented.")}createHTMLDocument(ye){throw new Error("This DOM method is not implemented.")}getFeature(ye,ke){throw new Error("This DOM method is not implemented.")}}}).call(this)},3735:function(on){(function(){on.exports=function(){class We{constructor(ke){this.arr=ke||[]}item(ke){return this.arr[ke]||null}contains(ke){return-1!==this.arr.indexOf(ke)}}return Object.defineProperty(We.prototype,"length",{get:function(){return this.arr.length}}),We}.call(this)}).call(this)},7274:function(on,hn,We){(function(){var ye,Ie;Ie=We(8563),ye=We(2269),on.exports=class extends Ie{constructor(ie,Qe,re,Ue,Ye,bt){if(super(ie),null==Qe)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==re)throw new Error("Missing DTD attribute name. "+this.debugInfo(Qe));if(!Ue)throw new Error("Missing DTD attribute type. "+this.debugInfo(Qe));if(!Ye)throw new Error("Missing DTD attribute default. "+this.debugInfo(Qe));if(0!==Ye.indexOf("#")&&(Ye="#"+Ye),!Ye.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(Qe));if(bt&&!Ye.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(Qe));this.elementName=this.stringify.name(Qe),this.type=ye.AttributeDeclaration,this.attributeName=this.stringify.name(re),this.attributeType=this.stringify.dtdAttType(Ue),bt&&(this.defaultValue=this.stringify.dtdAttDefault(bt)),this.defaultValueType=Ye}toString(ie){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(ie))}}}).call(this)},2068:function(on,hn,We){(function(){var ye,Ie;Ie=We(8563),ye=We(2269),on.exports=class extends Ie{constructor(ie,Qe,re){if(super(ie),null==Qe)throw new Error("Missing DTD element name. "+this.debugInfo());re||(re="(#PCDATA)"),Array.isArray(re)&&(re="("+re.join(",")+")"),this.name=this.stringify.name(Qe),this.type=ye.ElementDeclaration,this.value=this.stringify.dtdElementValue(re)}toString(ie){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(ie))}}}).call(this)},8349:function(on,hn,We){(function(){var ye,Ie,p;({isObject:p}=We(3452)),Ie=We(8563),ye=We(2269),on.exports=function(){class ie extends Ie{constructor(re,Ue,Ye,bt){if(super(re),null==Ye)throw new Error("Missing DTD entity name. "+this.debugInfo(Ye));if(null==bt)throw new Error("Missing DTD entity value. "+this.debugInfo(Ye));if(this.pe=!!Ue,this.name=this.stringify.name(Ye),this.type=ye.EntityDeclaration,p(bt)){if(!bt.pubID&&!bt.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(Ye));if(bt.pubID&&!bt.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(Ye));if(this.internal=!1,null!=bt.pubID&&(this.pubID=this.stringify.dtdPubID(bt.pubID)),null!=bt.sysID&&(this.sysID=this.stringify.dtdSysID(bt.sysID)),null!=bt.nData&&(this.nData=this.stringify.dtdNData(bt.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(Ye))}else this.value=this.stringify.dtdEntityValue(bt),this.internal=!0}toString(re){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(re))}}return Object.defineProperty(ie.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(ie.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(ie.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(ie.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(ie.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(ie.prototype,"xmlVersion",{get:function(){return null}}),ie}.call(this)}).call(this)},3087:function(on,hn,We){(function(){var ye,Ie;Ie=We(8563),ye=We(2269),on.exports=function(){class p extends Ie{constructor(Qe,re,Ue){if(super(Qe),null==re)throw new Error("Missing DTD notation name. "+this.debugInfo(re));if(!Ue.pubID&&!Ue.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(re));this.name=this.stringify.name(re),this.type=ye.NotationDeclaration,null!=Ue.pubID&&(this.pubID=this.stringify.dtdPubID(Ue.pubID)),null!=Ue.sysID&&(this.sysID=this.stringify.dtdSysID(Ue.sysID))}toString(Qe){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(Qe))}}return Object.defineProperty(p.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(p.prototype,"systemId",{get:function(){return this.sysID}}),p}.call(this)}).call(this)},4789:function(on,hn,We){(function(){var ye,Ie,p;({isObject:p}=We(3452)),Ie=We(8563),ye=We(2269),on.exports=class extends Ie{constructor(Qe,re,Ue,Ye){super(Qe),p(re)&&({version:re,encoding:Ue,standalone:Ye}=re),re||(re="1.0"),this.type=ye.Declaration,this.version=this.stringify.xmlVersion(re),null!=Ue&&(this.encoding=this.stringify.xmlEncoding(Ue)),null!=Ye&&(this.standalone=this.stringify.xmlStandalone(Ye))}toString(Qe){return this.options.writer.declaration(this,this.options.writer.filterOptions(Qe))}}}).call(this)},9195:function(on,hn,We){(function(){var ye,ke,Ie,p,ie,re,Ue,Ye;({isObject:Ye}=We(3452)),Ue=We(8563),ye=We(2269),ke=We(7274),p=We(8349),Ie=We(2068),ie=We(3087),re=We(5264),on.exports=function(){class bt extends Ue{constructor($e,Ge,wt){var Jt,vn,Cn,st;if(super($e),this.type=ye.DocType,$e.children)for(vn=0,Cn=(st=$e.children).length;vn<Cn;vn++)if((Jt=st[vn]).type===ye.Element){this.name=Jt.name;break}this.documentObject=$e,Ye(Ge)&&({pubID:Ge,sysID:wt}=Ge),null==wt&&([wt,Ge]=[Ge,wt]),null!=Ge&&(this.pubID=this.stringify.dtdPubID(Ge)),null!=wt&&(this.sysID=this.stringify.dtdSysID(wt))}element($e,Ge){var wt;return wt=new Ie(this,$e,Ge),this.children.push(wt),this}attList($e,Ge,wt,Jt,vn){var Cn;return Cn=new ke(this,$e,Ge,wt,Jt,vn),this.children.push(Cn),this}entity($e,Ge){var wt;return wt=new p(this,!1,$e,Ge),this.children.push(wt),this}pEntity($e,Ge){var wt;return wt=new p(this,!0,$e,Ge),this.children.push(wt),this}notation($e,Ge){var wt;return wt=new ie(this,$e,Ge),this.children.push(wt),this}toString($e){return this.options.writer.docType(this,this.options.writer.filterOptions($e))}ele($e,Ge){return this.element($e,Ge)}att($e,Ge,wt,Jt,vn){return this.attList($e,Ge,wt,Jt,vn)}ent($e,Ge){return this.entity($e,Ge)}pent($e,Ge){return this.pEntity($e,Ge)}not($e,Ge){return this.notation($e,Ge)}up(){return this.root()||this.documentObject}isEqualNode($e){return!(!super.isEqualNode($e)||$e.name!==this.name||$e.publicId!==this.publicId||$e.systemId!==this.systemId)}}return Object.defineProperty(bt.prototype,"entities",{get:function(){var Ct,$e,Ge,wt,Jt;for(wt={},$e=0,Ge=(Jt=this.children).length;$e<Ge;$e++)(Ct=Jt[$e]).type===ye.EntityDeclaration&&!Ct.pe&&(wt[Ct.name]=Ct);return new re(wt)}}),Object.defineProperty(bt.prototype,"notations",{get:function(){var Ct,$e,Ge,wt,Jt;for(wt={},$e=0,Ge=(Jt=this.children).length;$e<Ge;$e++)(Ct=Jt[$e]).type===ye.NotationDeclaration&&(wt[Ct.name]=Ct);return new re(wt)}}),Object.defineProperty(bt.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(bt.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(bt.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),bt}.call(this)}).call(this)},519:function(on,hn,We){(function(){var ye,ke,Ie,ie,Qe,re,Ue;({isPlainObject:Ue}=We(3452)),Ie=We(9906),ke=We(5806),ie=We(8563),ye=We(2269),re=We(5041),Qe=We(4354),on.exports=function(){class Ye extends ie{constructor(Ct){super(null),this.name="#document",this.type=ye.Document,this.documentURI=null,this.domConfig=new ke,Ct||(Ct={}),Ct.writer||(Ct.writer=new Qe),this.options=Ct,this.stringify=new re(Ct)}end(Ct){var $e;return $e={},Ct?Ue(Ct)&&($e=Ct,Ct=this.options.writer):Ct=this.options.writer,Ct.document(this,Ct.filterOptions($e))}toString(Ct){return this.options.writer.document(this,this.options.writer.filterOptions(Ct))}createElement(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(Ct,$e){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(Ct,$e){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(Ct,$e){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(Ct,$e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Ct,$e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(Ct,$e,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(Ct,$e,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(Ct,$e,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(Ye.prototype,"implementation",{value:new Ie}),Object.defineProperty(Ye.prototype,"doctype",{get:function(){var bt,Ct,$e,Ge;for(Ct=0,$e=(Ge=this.children).length;Ct<$e;Ct++)if((bt=Ge[Ct]).type===ye.DocType)return bt;return null}}),Object.defineProperty(Ye.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(Ye.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(Ye.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(Ye.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===ye.Declaration?this.children[0].encoding:null}}),Object.defineProperty(Ye.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===ye.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(Ye.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===ye.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(Ye.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(Ye.prototype,"origin",{get:function(){return null}}),Object.defineProperty(Ye.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(Ye.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(Ye.prototype,"contentType",{get:function(){return null}}),Ye}.call(this)}).call(this)},1105:function(on,hn,We){(function(){var ye,ke,Ie,p,ie,Qe,re,Ue,Ye,bt,Ct,$e,wt,Jt,vn,Cn,st,ln,Te,xe,Ae,ce,ut={}.hasOwnProperty;({isObject:Ae,isFunction:xe,isPlainObject:ce,getValue:Te}=We(3452)),ye=We(2269),$e=We(519),wt=We(3352),p=We(1361),ie=We(2516),vn=We(9942),ln=We(474),Jt=We(4666),bt=We(4789),Ct=We(9195),Qe=We(7274),Ue=We(8349),re=We(2068),Ye=We(3087),Ie=We(5968),st=We(5041),Cn=We(4354),ke=We(6316),on.exports=class{constructor(be,lt,gt){var He;this.name="?xml",this.type=ye.Document,be||(be={}),He={},be.writer?ce(be.writer)&&(He=be.writer,be.writer=new Cn):be.writer=new Cn,this.options=be,this.writer=be.writer,this.writerOptions=this.writer.filterOptions(He),this.stringify=new st(be),this.onDataCallback=lt||function(){},this.onEndCallback=gt||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(be){var gt,He,vt,Dt,oi,Lt,cn;switch(be.type){case ye.CData:this.cdata(be.value);break;case ye.Comment:this.comment(be.value);break;case ye.Element:for(gt in He={},Lt=be.attribs)!ut.call(Lt,gt)||(He[gt]=Lt[gt].value);this.node(be.name,He);break;case ye.Dummy:this.dummy();break;case ye.Raw:this.raw(be.value);break;case ye.Text:this.text(be.value);break;case ye.ProcessingInstruction:this.instruction(be.target,be.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+be.constructor.name)}for(Dt=0,oi=(cn=be.children).length;Dt<oi;Dt++)this.createChildNode(vt=cn[Dt]),vt.type===ye.Element&&this.up();return this}dummy(){return this}node(be,lt,gt){if(null==be)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(be));return this.openCurrent(),be=Te(be),null==lt&&(lt={}),lt=Te(lt),Ae(lt)||([gt,lt]=[lt,gt]),this.currentNode=new wt(this,be,lt),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=gt&&this.text(gt),this}element(be,lt,gt){var He,vt,Dt,oi,Lt,cn;if(this.currentNode&&this.currentNode.type===ye.DocType)this.dtdElement(...arguments);else if(Array.isArray(be)||Ae(be)||xe(be))for(oi=this.options.noValidation,this.options.noValidation=!0,(cn=new $e(this.options).element("TEMP_ROOT")).element(be),this.options.noValidation=oi,vt=0,Dt=(Lt=cn.children).length;vt<Dt;vt++)this.createChildNode(He=Lt[vt]),He.type===ye.Element&&this.up();else this.node(be,lt,gt);return this}attribute(be,lt){var gt;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(be));if(null!=be&&(be=Te(be)),Ae(be))for(gt in be)!ut.call(be,gt)||this.attribute(gt,be[gt]);else xe(lt)&&(lt=lt.apply()),this.options.keepNullAttributes&&null==lt?this.currentNode.attribs[be]=new Ie(this,be,""):null!=lt&&(this.currentNode.attribs[be]=new Ie(this,be,lt));return this}text(be){var lt;return this.openCurrent(),lt=new ln(this,be),this.onData(this.writer.text(lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(be){var lt;return this.openCurrent(),lt=new p(this,be),this.onData(this.writer.cdata(lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(be){var lt;return this.openCurrent(),lt=new ie(this,be),this.onData(this.writer.comment(lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(be){var lt;return this.openCurrent(),lt=new vn(this,be),this.onData(this.writer.raw(lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(be,lt){var gt,He,Dt,oi;if(this.openCurrent(),null!=be&&(be=Te(be)),null!=lt&&(lt=Te(lt)),Array.isArray(be))for(gt=0,Dt=be.length;gt<Dt;gt++)this.instruction(He=be[gt]);else if(Ae(be))for(He in be)!ut.call(be,He)||this.instruction(He,be[He]);else xe(lt)&&(lt=lt.apply()),oi=new Jt(this,be,lt),this.onData(this.writer.processingInstruction(oi,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(be,lt,gt){var He;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return He=new bt(this,be,lt,gt),this.onData(this.writer.declaration(He,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(be,lt,gt){if(this.openCurrent(),null==be)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new Ct(this,lt,gt),this.currentNode.rootNodeName=be,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(be,lt){var gt;return this.openCurrent(),gt=new re(this,be,lt),this.onData(this.writer.dtdElement(gt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(be,lt,gt,He,vt){var Dt;return this.openCurrent(),Dt=new Qe(this,be,lt,gt,He,vt),this.onData(this.writer.dtdAttList(Dt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(be,lt){var gt;return this.openCurrent(),gt=new Ue(this,!1,be,lt),this.onData(this.writer.dtdEntity(gt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(be,lt){var gt;return this.openCurrent(),gt=new Ue(this,!0,be,lt),this.onData(this.writer.dtdEntity(gt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(be,lt){var gt;return this.openCurrent(),gt=new Ye(this,be,lt),this.onData(this.writer.dtdNotation(gt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){for(;this.currentLevel>=0;)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(be){var gt,He,vt;if(!be.isOpen){if(!this.root&&0===this.currentLevel&&be.type===ye.Element&&(this.root=be),gt="",be.type===ye.Element){for(He in this.writerOptions.state=ke.OpenTag,gt=this.writer.indent(be,this.writerOptions,this.currentLevel)+"<"+be.name,vt=be.attribs)!ut.call(vt,He)||(gt+=this.writer.attribute(vt[He],this.writerOptions,this.currentLevel));gt+=(be.children?">":"/>")+this.writer.endline(be,this.writerOptions,this.currentLevel),this.writerOptions.state=ke.InsideTag}else this.writerOptions.state=ke.OpenTag,gt=this.writer.indent(be,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+be.rootNodeName,be.pubID&&be.sysID?gt+=' PUBLIC "'+be.pubID+'" "'+be.sysID+'"':be.sysID&&(gt+=' SYSTEM "'+be.sysID+'"'),be.children?(gt+=" [",this.writerOptions.state=ke.InsideTag):(this.writerOptions.state=ke.CloseTag,gt+=">"),gt+=this.writer.endline(be,this.writerOptions,this.currentLevel);return this.onData(gt,this.currentLevel),be.isOpen=!0}}closeNode(be){var lt;if(!be.isClosed)return"",this.writerOptions.state=ke.CloseTag,lt=be.type===ye.Element?this.writer.indent(be,this.writerOptions,this.currentLevel)+"</"+be.name+">"+this.writer.endline(be,this.writerOptions,this.currentLevel):this.writer.indent(be,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(be,this.writerOptions,this.currentLevel),this.writerOptions.state=ke.None,this.onData(lt,this.currentLevel),be.isClosed=!0}onData(be,lt){return this.documentStarted=!0,this.onDataCallback(be,lt+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(be){return null==be?"":"node: <"+be+">"}ele(){return this.element(...arguments)}nod(be,lt,gt){return this.node(be,lt,gt)}txt(be){return this.text(be)}dat(be){return this.cdata(be)}com(be){return this.comment(be)}ins(be,lt){return this.instruction(be,lt)}dec(be,lt,gt){return this.declaration(be,lt,gt)}dtd(be,lt,gt){return this.doctype(be,lt,gt)}e(be,lt,gt){return this.element(be,lt,gt)}n(be,lt,gt){return this.node(be,lt,gt)}t(be){return this.text(be)}d(be){return this.cdata(be)}c(be){return this.comment(be)}r(be){return this.raw(be)}i(be,lt){return this.instruction(be,lt)}att(){return this.currentNode&&this.currentNode.type===ye.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===ye.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(be,lt){return this.entity(be,lt)}pent(be,lt){return this.pEntity(be,lt)}not(be,lt){return this.notation(be,lt)}}}).call(this)},4173:function(on,hn,We){(function(){var ye,Ie;Ie=We(8563),ye=We(2269),on.exports=class extends Ie{constructor(ie){super(ie),this.type=ye.Dummy}clone(){return Object.create(this)}toString(ie){return""}}}).call(this)},3352:function(on,hn,We){(function(){var ye,ke,p,ie,Qe,re,Ue,Ye={}.hasOwnProperty;({isObject:Ue,isFunction:re,getValue:Qe}=We(3452)),ie=We(8563),ye=We(2269),ke=We(5968),p=We(5264),on.exports=function(){class bt extends ie{constructor($e,Ge,wt){var Jt,vn,Cn,st;if(super($e),null==Ge)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(Ge),this.type=ye.Element,this.attribs={},this.schemaTypeInfo=null,null!=wt&&this.attribute(wt),$e.type===ye.Document&&(this.isRoot=!0,this.documentObject=$e,$e.rootObject=this,$e.children))for(vn=0,Cn=(st=$e.children).length;vn<Cn;vn++)if((Jt=st[vn]).type===ye.DocType){Jt.name=this.name;break}}clone(){var Ge,wt,Jt;for(Ge in(wt=Object.create(this)).isRoot&&(wt.documentObject=null),wt.attribs={},Jt=this.attribs)!Ye.call(Jt,Ge)||(wt.attribs[Ge]=Jt[Ge].clone());return wt.children=[],this.children.forEach(function(vn){var Cn;return(Cn=vn.clone()).parent=wt,wt.children.push(Cn)}),wt}attribute($e,Ge){var wt;if(null!=$e&&($e=Qe($e)),Ue($e))for(wt in $e)!Ye.call($e,wt)||this.attribute(wt,$e[wt]);else re(Ge)&&(Ge=Ge.apply()),this.options.keepNullAttributes&&null==Ge?this.attribs[$e]=new ke(this,$e,""):null!=Ge&&(this.attribs[$e]=new ke(this,$e,Ge));return this}removeAttribute($e){var wt,Jt;if(null==$e)throw new Error("Missing attribute name. "+this.debugInfo());if($e=Qe($e),Array.isArray($e))for(wt=0,Jt=$e.length;wt<Jt;wt++)delete this.attribs[$e[wt]];else delete this.attribs[$e];return this}toString($e){return this.options.writer.element(this,this.options.writer.filterOptions($e))}att($e,Ge){return this.attribute($e,Ge)}a($e,Ge){return this.attribute($e,Ge)}getAttribute($e){return this.attribs.hasOwnProperty($e)?this.attribs[$e].value:null}setAttribute($e,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode($e){return this.attribs.hasOwnProperty($e)?this.attribs[$e]:null}setAttributeNode($e){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode($e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName($e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS($e,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS($e,Ge,wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS($e,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS($e,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS($e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS($e,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute($e){return this.attribs.hasOwnProperty($e)}hasAttributeNS($e,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute($e,Ge){return this.attribs.hasOwnProperty($e)?this.attribs[$e].isId:Ge}setIdAttributeNS($e,Ge,wt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode($e,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName($e){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS($e,Ge){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName($e){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode($e){var Ge,wt,Jt;if(!super.isEqualNode($e)||$e.namespaceURI!==this.namespaceURI||$e.prefix!==this.prefix||$e.localName!==this.localName||$e.attribs.length!==this.attribs.length)return!1;for(Ge=wt=0,Jt=this.attribs.length-1;0<=Jt?wt<=Jt:wt>=Jt;Ge=0<=Jt?++wt:--wt)if(!this.attribs[Ge].isEqualNode($e.attribs[Ge]))return!1;return!0}}return Object.defineProperty(bt.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(bt.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(bt.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(bt.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(bt.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(bt.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(bt.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(bt.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new p(this.attribs)),this.attributeMap}}),bt}.call(this)}).call(this)},5264:function(on){(function(){on.exports=function(){class We{constructor(ke){this.nodes=ke}clone(){return this.nodes=null}getNamedItem(ke){return this.nodes[ke]}setNamedItem(ke){var Ie;return Ie=this.nodes[ke.nodeName],this.nodes[ke.nodeName]=ke,Ie||null}removeNamedItem(ke){var Ie;return Ie=this.nodes[ke],delete this.nodes[ke],Ie||null}item(ke){return this.nodes[Object.keys(this.nodes)[ke]]||null}getNamedItemNS(ke,Ie){throw new Error("This DOM method is not implemented.")}setNamedItemNS(ke){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(ke,Ie){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(We.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),We}.call(this)}).call(this)},8563:function(on,hn,We){(function(){var ye,ke,Ie,p,ie,Qe,re,Ue,Ct,$e,Ge,wt,Jt,vn,Cn,st,ln={}.hasOwnProperty,Te=[].splice;({isObject:st,isFunction:Cn,isEmpty:vn,getValue:Jt}=We(3452)),Ue=null,Ie=null,p=null,ie=null,Qe=null,Ge=null,wt=null,$e=null,re=null,ke=null,Ct=null,ye=null,on.exports=function(){class xe{constructor(ce){this.parent=ce,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,Ue||(Ue=We(3352),Ie=We(1361),p=We(2516),ie=We(4789),Qe=We(9195),Ge=We(9942),wt=We(474),$e=We(4666),re=We(4173),ke=We(2269),Ct=We(5112),We(5264),ye=We(599))}setParent(ce){var se,be,lt,gt;for(this.parent=ce,ce&&(this.options=ce.options,this.stringify=ce.stringify),gt=[],se=0,be=(lt=this.children).length;se<be;se++)gt.push(lt[se].setParent(this));return gt}element(ce,ut,se){var be,gt,He,vt,Dt,oi,Lt,cn;if(Dt=null,null===ut&&null==se&&([ut,se]=[{},null]),null==ut&&(ut={}),ut=Jt(ut),st(ut)||([se,ut]=[ut,se]),null!=ce&&(ce=Jt(ce)),Array.isArray(ce))for(gt=0,oi=ce.length;gt<oi;gt++)Dt=this.element(ce[gt]);else if(Cn(ce))Dt=this.element(ce.apply());else if(st(ce)){for(vt in ce)if(ln.call(ce,vt))if(Cn(cn=ce[vt])&&(cn=cn.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===vt.indexOf(this.stringify.convertAttKey))Dt=this.attribute(vt.substr(this.stringify.convertAttKey.length),cn);else if(!this.options.separateArrayItems&&Array.isArray(cn)&&vn(cn))Dt=this.dummy();else if(st(cn)&&vn(cn))Dt=this.element(vt);else if(this.options.keepNullNodes||null!=cn)if(!this.options.separateArrayItems&&Array.isArray(cn))for(He=0,Lt=cn.length;He<Lt;He++)(be={})[vt]=cn[He],Dt=this.element(be);else st(cn)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===vt.indexOf(this.stringify.convertTextKey)?Dt=this.element(cn):(Dt=this.element(vt)).element(cn):Dt=this.element(vt,cn);else Dt=this.dummy()}else Dt=this.options.keepNullNodes||null!==se?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===ce.indexOf(this.stringify.convertTextKey)?this.text(se):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===ce.indexOf(this.stringify.convertCDataKey)?this.cdata(se):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===ce.indexOf(this.stringify.convertCommentKey)?this.comment(se):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===ce.indexOf(this.stringify.convertRawKey)?this.raw(se):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===ce.indexOf(this.stringify.convertPIKey)?this.instruction(ce.substr(this.stringify.convertPIKey.length),se):this.node(ce,ut,se):this.dummy();if(null==Dt)throw new Error("Could not create any elements with: "+ce+". "+this.debugInfo());return Dt}insertBefore(ce,ut,se){var be,lt,gt,He,vt;if(null!=ce&&ce.type)return He=ut,(gt=ce).setParent(this),He?(lt=children.indexOf(He),vt=children.splice(lt),children.push(gt),Array.prototype.push.apply(children,vt)):children.push(gt),gt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(ce));return lt=this.parent.children.indexOf(this),vt=this.parent.children.splice(lt),be=this.parent.element(ce,ut,se),Array.prototype.push.apply(this.parent.children,vt),be}insertAfter(ce,ut,se){var be,lt,gt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(ce));return lt=this.parent.children.indexOf(this),gt=this.parent.children.splice(lt+1),be=this.parent.element(ce,ut,se),Array.prototype.push.apply(this.parent.children,gt),be}remove(){var ce;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return ce=this.parent.children.indexOf(this),Te.apply(this.parent.children,[ce,ce-ce+1].concat([])),this.parent}node(ce,ut,se){var be;return null!=ce&&(ce=Jt(ce)),ut||(ut={}),ut=Jt(ut),st(ut)||([se,ut]=[ut,se]),be=new Ue(this,ce,ut),null!=se&&be.text(se),this.children.push(be),be}text(ce){var ut;return st(ce)&&this.element(ce),ut=new wt(this,ce),this.children.push(ut),this}cdata(ce){var ut;return ut=new Ie(this,ce),this.children.push(ut),this}comment(ce){var ut;return ut=new p(this,ce),this.children.push(ut),this}commentBefore(ce){var se,be;return se=this.parent.children.indexOf(this),be=this.parent.children.splice(se),this.parent.comment(ce),Array.prototype.push.apply(this.parent.children,be),this}commentAfter(ce){var se,be;return se=this.parent.children.indexOf(this),be=this.parent.children.splice(se+1),this.parent.comment(ce),Array.prototype.push.apply(this.parent.children,be),this}raw(ce){var ut;return ut=new Ge(this,ce),this.children.push(ut),this}dummy(){return new re(this)}instruction(ce,ut){var se,lt,gt,He;if(null!=ce&&(ce=Jt(ce)),null!=ut&&(ut=Jt(ut)),Array.isArray(ce))for(gt=0,He=ce.length;gt<He;gt++)this.instruction(se=ce[gt]);else if(st(ce))for(se in ce)!ln.call(ce,se)||this.instruction(se,ce[se]);else Cn(ut)&&(ut=ut.apply()),lt=new $e(this,ce,ut),this.children.push(lt);return this}instructionBefore(ce,ut){var be,lt;return be=this.parent.children.indexOf(this),lt=this.parent.children.splice(be),this.parent.instruction(ce,ut),Array.prototype.push.apply(this.parent.children,lt),this}instructionAfter(ce,ut){var be,lt;return be=this.parent.children.indexOf(this),lt=this.parent.children.splice(be+1),this.parent.instruction(ce,ut),Array.prototype.push.apply(this.parent.children,lt),this}declaration(ce,ut,se){var be,lt;return be=this.document(),lt=new ie(be,ce,ut,se),0===be.children.length?be.children.unshift(lt):be.children[0].type===ke.Declaration?be.children[0]=lt:be.children.unshift(lt),be.root()||be}dtd(ce,ut){var be,lt,gt,He,vt,Dt,oi,Lt,cn;for(be=this.document(),lt=new Qe(be,ce,ut),gt=He=0,Dt=(Lt=be.children).length;He<Dt;gt=++He)if(Lt[gt].type===ke.DocType)return be.children[gt]=lt,lt;for(gt=vt=0,oi=(cn=be.children).length;vt<oi;gt=++vt)if(cn[gt].isRoot)return be.children.splice(gt,0,lt),lt;return be.children.push(lt),lt}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var ce;for(ce=this;ce;){if(ce.type===ke.Document)return ce.rootObject;if(ce.isRoot)return ce;ce=ce.parent}}document(){var ce;for(ce=this;ce;){if(ce.type===ke.Document)return ce;ce=ce.parent}}end(ce){return this.document().end(ce)}prev(){var ce;if((ce=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[ce-1]}next(){var ce;if(-1===(ce=this.parent.children.indexOf(this))||ce===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[ce+1]}importDocument(ce){var ut,se,be,lt,gt;if((se=ce.root().clone()).parent=this,se.isRoot=!1,this.children.push(se),this.type===ke.Document&&(se.isRoot=!0,se.documentObject=this,this.rootObject=se,this.children))for(be=0,lt=(gt=this.children).length;be<lt;be++)if((ut=gt[be]).type===ke.DocType){ut.name=se.name;break}return this}debugInfo(ce){var ut,se;return null!=(ce=ce||this.name)||null!=(ut=this.parent)&&ut.name?null==ce?"parent: <"+this.parent.name+">":null!=(se=this.parent)&&se.name?"node: <"+ce+">, parent: <"+this.parent.name+">":"node: <"+ce+">":""}ele(ce,ut,se){return this.element(ce,ut,se)}nod(ce,ut,se){return this.node(ce,ut,se)}txt(ce){return this.text(ce)}dat(ce){return this.cdata(ce)}com(ce){return this.comment(ce)}ins(ce,ut){return this.instruction(ce,ut)}doc(){return this.document()}dec(ce,ut,se){return this.declaration(ce,ut,se)}e(ce,ut,se){return this.element(ce,ut,se)}n(ce,ut,se){return this.node(ce,ut,se)}t(ce){return this.text(ce)}d(ce){return this.cdata(ce)}c(ce){return this.comment(ce)}r(ce){return this.raw(ce)}i(ce,ut){return this.instruction(ce,ut)}u(){return this.up()}importXMLBuilder(ce){return this.importDocument(ce)}attribute(ce,ut){throw new Error("attribute() applies to element nodes only.")}att(ce,ut){return this.attribute(ce,ut)}a(ce,ut){return this.attribute(ce,ut)}removeAttribute(ce){throw new Error("attribute() applies to element nodes only.")}replaceChild(ce,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(ce){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(ce){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(ce){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(ce,ut){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(ce){var se;return this===ce?0:this.document()!==ce.document()?(se=ye.Disconnected|ye.ImplementationSpecific,Math.random()<.5?se|=ye.Preceding:se|=ye.Following,se):this.isAncestor(ce)?ye.Contains|ye.Preceding:this.isDescendant(ce)?ye.Contains|ye.Following:this.isPreceding(ce)?ye.Preceding:ye.Following}isSameNode(ce){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(ce){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(ce){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(ce){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(ce){var ut,se,be;if(ce.nodeType!==this.nodeType||ce.children.length!==this.children.length)return!1;for(ut=se=0,be=this.children.length-1;0<=be?se<=be:se>=be;ut=0<=be?++se:--se)if(!this.children[ut].isEqualNode(ce.children[ut]))return!1;return!0}getFeature(ce,ut){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(ce,ut,se){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(ce){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(ce){return!!ce&&(ce===this||this.isDescendant(ce))}isDescendant(ce){var ut,be,lt,gt;for(be=0,lt=(gt=this.children).length;be<lt;be++)if(ce===(ut=gt[be])||ut.isDescendant(ce))return!0;return!1}isAncestor(ce){return ce.isDescendant(this)}isPreceding(ce){var ut,se;return ut=this.treePosition(ce),se=this.treePosition(this),-1!==ut&&-1!==se&&ut<se}isFollowing(ce){var ut,se;return ut=this.treePosition(ce),se=this.treePosition(this),-1!==ut&&-1!==se&&ut>se}treePosition(ce){var ut,se;return se=0,ut=!1,this.foreachTreeNode(this.document(),function(be){if(se++,!ut&&be===ce)return ut=!0}),ut?se:-1}foreachTreeNode(ce,ut){var se,be,lt,gt,He;for(ce||(ce=this.document()),be=0,lt=(gt=ce.children).length;be<lt;be++){if(He=ut(se=gt[be]))return He;if(He=this.foreachTreeNode(se,ut))return He}}}return Object.defineProperty(xe.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(xe.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(xe.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(xe.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(xe.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new Ct(this.children)),this.childNodeList}}),Object.defineProperty(xe.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(xe.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(xe.prototype,"previousSibling",{get:function(){var Ae;return Ae=this.parent.children.indexOf(this),this.parent.children[Ae-1]||null}}),Object.defineProperty(xe.prototype,"nextSibling",{get:function(){var Ae;return Ae=this.parent.children.indexOf(this),this.parent.children[Ae+1]||null}}),Object.defineProperty(xe.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(xe.prototype,"textContent",{get:function(){var Ae,ce,ut,se,be;if(this.nodeType===ke.Element||this.nodeType===ke.DocumentFragment){for(be="",ce=0,ut=(se=this.children).length;ce<ut;ce++)(Ae=se[ce]).textContent&&(be+=Ae.textContent);return be}return null},set:function(Ae){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),xe}.call(this)}).call(this)},5112:function(on){(function(){on.exports=function(){class We{constructor(ke){this.nodes=ke}clone(){return this.nodes=null}item(ke){return this.nodes[ke]||null}}return Object.defineProperty(We.prototype,"length",{get:function(){return this.nodes.length||0}}),We}.call(this)}).call(this)},4666:function(on,hn,We){(function(){var ye,ke;ye=We(2269),ke=We(2182),on.exports=class extends ke{constructor(ie,Qe,re){if(super(ie),null==Qe)throw new Error("Missing instruction target. "+this.debugInfo());this.type=ye.ProcessingInstruction,this.target=this.stringify.insTarget(Qe),this.name=this.target,re&&(this.value=this.stringify.insValue(re))}clone(){return Object.create(this)}toString(ie){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(ie))}isEqualNode(ie){return!(!super.isEqualNode(ie)||ie.target!==this.target)}}}).call(this)},9942:function(on,hn,We){(function(){var ye,ke;ye=We(2269),ke=We(8563),on.exports=class extends ke{constructor(ie,Qe){if(super(ie),null==Qe)throw new Error("Missing raw text. "+this.debugInfo());this.type=ye.Raw,this.value=this.stringify.raw(Qe)}clone(){return Object.create(this)}toString(ie){return this.options.writer.raw(this,this.options.writer.filterOptions(ie))}}}).call(this)},7647:function(on,hn,We){(function(){var ye,ke,p,ie={}.hasOwnProperty;ye=We(2269),p=We(3576),ke=We(6316),on.exports=class extends p{constructor(re,Ue){super(Ue),this.stream=re}endline(re,Ue,Ye){return re.isLastRootNode&&Ue.state===ke.CloseTag?"":super.endline(re,Ue,Ye)}document(re,Ue){var bt,Ct,$e,Ge,wt,Jt,vn,Cn;for(bt=Ct=0,Ge=(Jt=re.children).length;Ct<Ge;bt=++Ct)Jt[bt].isLastRootNode=bt===re.children.length-1;for(Ue=this.filterOptions(Ue),Cn=[],$e=0,wt=(vn=re.children).length;$e<wt;$e++)Cn.push(this.writeChildNode(vn[$e],Ue,0));return Cn}cdata(re,Ue,Ye){return this.stream.write(super.cdata(re,Ue,Ye))}comment(re,Ue,Ye){return this.stream.write(super.comment(re,Ue,Ye))}declaration(re,Ue,Ye){return this.stream.write(super.declaration(re,Ue,Ye))}docType(re,Ue,Ye){var Ct,$e,Ge;if(Ye||(Ye=0),this.openNode(re,Ue,Ye),Ue.state=ke.OpenTag,this.stream.write(this.indent(re,Ue,Ye)),this.stream.write("<!DOCTYPE "+re.root().name),re.pubID&&re.sysID?this.stream.write(' PUBLIC "'+re.pubID+'" "'+re.sysID+'"'):re.sysID&&this.stream.write(' SYSTEM "'+re.sysID+'"'),re.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(re,Ue,Ye)),Ue.state=ke.InsideTag,Ct=0,$e=(Ge=re.children).length;Ct<$e;Ct++)this.writeChildNode(Ge[Ct],Ue,Ye+1);Ue.state=ke.CloseTag,this.stream.write("]")}return Ue.state=ke.CloseTag,this.stream.write(Ue.spaceBeforeSlash+">"),this.stream.write(this.endline(re,Ue,Ye)),Ue.state=ke.None,this.closeNode(re,Ue,Ye)}element(re,Ue,Ye){var Ge,wt,Jt,vn,Cn,st,Te,xe,Ae,ce,ut,se;if(Ye||(Ye=0),this.openNode(re,Ue,Ye),Ue.state=ke.OpenTag,Te=this.indent(re,Ue,Ye)+"<"+re.name,Ue.pretty&&Ue.width>0)for(st in vn=Te.length,Ae=re.attribs)!ie.call(Ae,st)||(vn+(xe=this.attribute(Ae[st],Ue,Ye)).length>Ue.width?(se=this.indent(re,Ue,Ye+1)+xe,Te+=this.endline(re,Ue,Ye)+se,vn=se.length):(Te+=se=" "+xe,vn+=se.length));else for(st in ce=re.attribs)!ie.call(ce,st)||(Te+=this.attribute(ce[st],Ue,Ye));if(this.stream.write(Te),wt=0===(Ge=re.children.length)?null:re.children[0],0===Ge||re.children.every(function(be){return(be.type===ye.Text||be.type===ye.Raw||be.type===ye.CData)&&""===be.value}))Ue.allowEmpty?(this.stream.write(">"),Ue.state=ke.CloseTag,this.stream.write("</"+re.name+">")):(Ue.state=ke.CloseTag,this.stream.write(Ue.spaceBeforeSlash+"/>"));else if(!Ue.pretty||1!==Ge||wt.type!==ye.Text&&wt.type!==ye.Raw&&wt.type!==ye.CData||null==wt.value){for(this.stream.write(">"+this.endline(re,Ue,Ye)),Ue.state=ke.InsideTag,Jt=0,Cn=(ut=re.children).length;Jt<Cn;Jt++)this.writeChildNode(ut[Jt],Ue,Ye+1);Ue.state=ke.CloseTag,this.stream.write(this.indent(re,Ue,Ye)+"</"+re.name+">")}else this.stream.write(">"),Ue.state=ke.InsideTag,Ue.suppressPrettyCount++,this.writeChildNode(wt,Ue,Ye+1),Ue.suppressPrettyCount--,Ue.state=ke.CloseTag,this.stream.write("</"+re.name+">");return this.stream.write(this.endline(re,Ue,Ye)),Ue.state=ke.None,this.closeNode(re,Ue,Ye)}processingInstruction(re,Ue,Ye){return this.stream.write(super.processingInstruction(re,Ue,Ye))}raw(re,Ue,Ye){return this.stream.write(super.raw(re,Ue,Ye))}text(re,Ue,Ye){return this.stream.write(super.text(re,Ue,Ye))}dtdAttList(re,Ue,Ye){return this.stream.write(super.dtdAttList(re,Ue,Ye))}dtdElement(re,Ue,Ye){return this.stream.write(super.dtdElement(re,Ue,Ye))}dtdEntity(re,Ue,Ye){return this.stream.write(super.dtdEntity(re,Ue,Ye))}dtdNotation(re,Ue,Ye){return this.stream.write(super.dtdNotation(re,Ue,Ye))}}}).call(this)},4354:function(on,hn,We){(function(){var ke;ke=We(3576),on.exports=class extends ke{constructor(p){super(p)}document(p,ie){var re,Ue,Ye,bt;for(ie=this.filterOptions(ie),Ye="",re=0,Ue=(bt=p.children).length;re<Ue;re++)Ye+=this.writeChildNode(bt[re],ie,0);return ie.pretty&&Ye.slice(-ie.newline.length)===ie.newline&&(Ye=Ye.slice(0,-ie.newline.length)),Ye}}}).call(this)},5041:function(on){(function(){var We={}.hasOwnProperty;on.exports=function(){class ye{constructor(Ie){var p,ie;for(p in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),Ie||(Ie={}),this.options=Ie,this.options.version||(this.options.version="1.0"),ie=Ie.stringify||{})!We.call(ie,p)||(this[p]=ie[p])}name(Ie){return this.options.noValidation?Ie:this.assertLegalName(""+Ie||"")}text(Ie){return this.options.noValidation?Ie:this.assertLegalChar(this.textEscape(""+Ie||""))}cdata(Ie){return this.options.noValidation?Ie:(Ie=(Ie=""+Ie||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(Ie))}comment(Ie){if(this.options.noValidation)return Ie;if((Ie=""+Ie||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+Ie);return this.assertLegalChar(Ie)}raw(Ie){return this.options.noValidation?Ie:""+Ie||""}attValue(Ie){return this.options.noValidation?Ie:this.assertLegalChar(this.attEscape(Ie=""+Ie||""))}insTarget(Ie){return this.options.noValidation?Ie:this.assertLegalChar(""+Ie||"")}insValue(Ie){if(this.options.noValidation)return Ie;if((Ie=""+Ie||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+Ie);return this.assertLegalChar(Ie)}xmlVersion(Ie){if(this.options.noValidation)return Ie;if(!(Ie=""+Ie||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+Ie);return Ie}xmlEncoding(Ie){if(this.options.noValidation)return Ie;if(!(Ie=""+Ie||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+Ie);return this.assertLegalChar(Ie)}xmlStandalone(Ie){return this.options.noValidation?Ie:Ie?"yes":"no"}dtdPubID(Ie){return this.options.noValidation?Ie:this.assertLegalChar(""+Ie||"")}dtdSysID(Ie){return this.options.noValidation?Ie:this.assertLegalChar(""+Ie||"")}dtdElementValue(Ie){return this.options.noValidation?Ie:this.assertLegalChar(""+Ie||"")}dtdAttType(Ie){return this.options.noValidation?Ie:this.assertLegalChar(""+Ie||"")}dtdAttDefault(Ie){return this.options.noValidation?Ie:this.assertLegalChar(""+Ie||"")}dtdEntityValue(Ie){return this.options.noValidation?Ie:this.assertLegalChar(""+Ie||"")}dtdNData(Ie){return this.options.noValidation?Ie:this.assertLegalChar(""+Ie||"")}assertLegalChar(Ie){var p,ie;if(this.options.noValidation)return Ie;if("1.0"===this.options.version){if(p=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Ie=Ie.replace(p,this.options.invalidCharReplacement);else if(ie=Ie.match(p))throw new Error(`Invalid character in string: ${Ie} at index ${ie.index}`)}else if("1.1"===this.options.version)if(p=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Ie=Ie.replace(p,this.options.invalidCharReplacement);else if(ie=Ie.match(p))throw new Error(`Invalid character in string: ${Ie} at index ${ie.index}`);return Ie}assertLegalName(Ie){if(this.options.noValidation)return Ie;if(!(Ie=this.assertLegalChar(Ie)).match(/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/))throw new Error(`Invalid character in name: ${Ie}`);return Ie}textEscape(Ie){return this.options.noValidation?Ie:Ie.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}attEscape(Ie){return this.options.noValidation?Ie:Ie.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}}return ye.prototype.convertAttKey="@",ye.prototype.convertPIKey="?",ye.prototype.convertTextKey="#text",ye.prototype.convertCDataKey="#cdata",ye.prototype.convertCommentKey="#comment",ye.prototype.convertRawKey="#raw",ye}.call(this)}).call(this)},474:function(on,hn,We){(function(){var ye,ke;ye=We(2269),ke=We(2182),on.exports=function(){class p extends ke{constructor(Qe,re){if(super(Qe),null==re)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=ye.Text,this.value=this.stringify.text(re)}clone(){return Object.create(this)}toString(Qe){return this.options.writer.text(this,this.options.writer.filterOptions(Qe))}splitText(Qe){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(Qe){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(p.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(p.prototype,"wholeText",{get:function(){var ie,Qe,re;for(re="",Qe=this.previousSibling;Qe;)re=Qe.data+re,Qe=Qe.previousSibling;for(re+=this.data,ie=this.nextSibling;ie;)re+=ie.data,ie=ie.nextSibling;return re}}),p}.call(this)}).call(this)},3576:function(on,hn,We){(function(){var ye,ke,Cn,st={}.hasOwnProperty;({assign:Cn}=We(3452)),ye=We(2269),We(4789),We(9195),We(1361),We(2516),We(3352),We(9942),We(474),We(4666),We(4173),We(7274),We(2068),We(8349),We(3087),ke=We(6316),on.exports=class{constructor(Te){var xe,Ae,ce;for(xe in Te||(Te={}),this.options=Te,Ae=Te.writer||{})!st.call(Ae,xe)||(ce=Ae[xe],this["_"+xe]=this[xe],this[xe]=ce)}filterOptions(Te){var xe,Ae,ce,ut,se,be,lt,gt,He;return Te||(Te={}),Te=Cn({},this.options,Te),(xe={writer:this}).pretty=Te.pretty||!1,xe.allowEmpty=Te.allowEmpty||!1,xe.indent=null!=(Ae=Te.indent)?Ae:"  ",xe.newline=null!=(ce=Te.newline)?ce:"\n",xe.offset=null!=(ut=Te.offset)?ut:0,xe.width=null!=(se=Te.width)?se:0,xe.dontPrettyTextNodes=null!=(be=null!=(lt=Te.dontPrettyTextNodes)?lt:Te.dontprettytextnodes)?be:0,xe.spaceBeforeSlash=null!=(gt=null!=(He=Te.spaceBeforeSlash)?He:Te.spacebeforeslash)?gt:"",!0===xe.spaceBeforeSlash&&(xe.spaceBeforeSlash=" "),xe.suppressPrettyCount=0,xe.user={},xe.state=ke.None,xe}indent(Te,xe,Ae){var ce;return!xe.pretty||xe.suppressPrettyCount?"":xe.pretty&&(ce=(Ae||0)+xe.offset+1)>0?new Array(ce).join(xe.indent):""}endline(Te,xe,Ae){return!xe.pretty||xe.suppressPrettyCount?"":xe.newline}attribute(Te,xe,Ae){var ce;return this.openAttribute(Te,xe,Ae),ce=xe.pretty&&xe.width>0?Te.name+'="'+Te.value+'"':" "+Te.name+'="'+Te.value+'"',this.closeAttribute(Te,xe,Ae),ce}cdata(Te,xe,Ae){var ce;return this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,ce=this.indent(Te,xe,Ae)+"<![CDATA[",xe.state=ke.InsideTag,ce+=Te.value,xe.state=ke.CloseTag,ce+="]]>"+this.endline(Te,xe,Ae),xe.state=ke.None,this.closeNode(Te,xe,Ae),ce}comment(Te,xe,Ae){var ce;return this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,ce=this.indent(Te,xe,Ae)+"\x3c!-- ",xe.state=ke.InsideTag,ce+=Te.value,xe.state=ke.CloseTag,ce+=" --\x3e"+this.endline(Te,xe,Ae),xe.state=ke.None,this.closeNode(Te,xe,Ae),ce}declaration(Te,xe,Ae){var ce;return this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,ce=this.indent(Te,xe,Ae)+"<?xml",xe.state=ke.InsideTag,ce+=' version="'+Te.version+'"',null!=Te.encoding&&(ce+=' encoding="'+Te.encoding+'"'),null!=Te.standalone&&(ce+=' standalone="'+Te.standalone+'"'),xe.state=ke.CloseTag,ce+=xe.spaceBeforeSlash+"?>",ce+=this.endline(Te,xe,Ae),xe.state=ke.None,this.closeNode(Te,xe,Ae),ce}docType(Te,xe,Ae){var ut,se,be,lt;if(Ae||(Ae=0),this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,be=this.indent(Te,xe,Ae),be+="<!DOCTYPE "+Te.root().name,Te.pubID&&Te.sysID?be+=' PUBLIC "'+Te.pubID+'" "'+Te.sysID+'"':Te.sysID&&(be+=' SYSTEM "'+Te.sysID+'"'),Te.children.length>0){for(be+=" [",be+=this.endline(Te,xe,Ae),xe.state=ke.InsideTag,ut=0,se=(lt=Te.children).length;ut<se;ut++)be+=this.writeChildNode(lt[ut],xe,Ae+1);xe.state=ke.CloseTag,be+="]"}return xe.state=ke.CloseTag,be+=xe.spaceBeforeSlash+">",be+=this.endline(Te,xe,Ae),xe.state=ke.None,this.closeNode(Te,xe,Ae),be}element(Te,xe,Ae){var se,be,lt,gt,He,vt,Dt,oi,Lt,cn,qi,Fi,xi,Kt,To,vo,ki;if(Ae||(Ae=0),cn=!1,this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,qi=this.indent(Te,xe,Ae)+"<"+Te.name,xe.pretty&&xe.width>0)for(Lt in vt=qi.length,xi=Te.attribs)!st.call(xi,Lt)||(vt+(Fi=this.attribute(xi[Lt],xe,Ae)).length>xe.width?(ki=this.indent(Te,xe,Ae+1)+Fi,qi+=this.endline(Te,xe,Ae)+ki,vt=ki.length):(qi+=ki=" "+Fi,vt+=ki.length));else for(Lt in Kt=Te.attribs)!st.call(Kt,Lt)||(qi+=this.attribute(Kt[Lt],xe,Ae));if(lt=0===(be=Te.children.length)?null:Te.children[0],0===be||Te.children.every(function(Ii){return(Ii.type===ye.Text||Ii.type===ye.Raw||Ii.type===ye.CData)&&""===Ii.value}))xe.allowEmpty?(qi+=">",xe.state=ke.CloseTag,qi+="</"+Te.name+">"+this.endline(Te,xe,Ae)):(xe.state=ke.CloseTag,qi+=xe.spaceBeforeSlash+"/>"+this.endline(Te,xe,Ae));else if(!xe.pretty||1!==be||lt.type!==ye.Text&&lt.type!==ye.Raw&&lt.type!==ye.CData||null==lt.value){if(xe.dontPrettyTextNodes)for(gt=0,Dt=(To=Te.children).length;gt<Dt;gt++)if(((se=To[gt]).type===ye.Text||se.type===ye.Raw||se.type===ye.CData)&&null!=se.value){xe.suppressPrettyCount++,cn=!0;break}for(qi+=">"+this.endline(Te,xe,Ae),xe.state=ke.InsideTag,He=0,oi=(vo=Te.children).length;He<oi;He++)qi+=this.writeChildNode(se=vo[He],xe,Ae+1);xe.state=ke.CloseTag,qi+=this.indent(Te,xe,Ae)+"</"+Te.name+">",cn&&xe.suppressPrettyCount--,qi+=this.endline(Te,xe,Ae),xe.state=ke.None}else qi+=">",xe.state=ke.InsideTag,xe.suppressPrettyCount++,cn=!0,qi+=this.writeChildNode(lt,xe,Ae+1),xe.suppressPrettyCount--,cn=!1,xe.state=ke.CloseTag,qi+="</"+Te.name+">"+this.endline(Te,xe,Ae);return this.closeNode(Te,xe,Ae),qi}writeChildNode(Te,xe,Ae){switch(Te.type){case ye.CData:return this.cdata(Te,xe,Ae);case ye.Comment:return this.comment(Te,xe,Ae);case ye.Element:return this.element(Te,xe,Ae);case ye.Raw:return this.raw(Te,xe,Ae);case ye.Text:return this.text(Te,xe,Ae);case ye.ProcessingInstruction:return this.processingInstruction(Te,xe,Ae);case ye.Dummy:return"";case ye.Declaration:return this.declaration(Te,xe,Ae);case ye.DocType:return this.docType(Te,xe,Ae);case ye.AttributeDeclaration:return this.dtdAttList(Te,xe,Ae);case ye.ElementDeclaration:return this.dtdElement(Te,xe,Ae);case ye.EntityDeclaration:return this.dtdEntity(Te,xe,Ae);case ye.NotationDeclaration:return this.dtdNotation(Te,xe,Ae);default:throw new Error("Unknown XML node type: "+Te.constructor.name)}}processingInstruction(Te,xe,Ae){var ce;return this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,ce=this.indent(Te,xe,Ae)+"<?",xe.state=ke.InsideTag,ce+=Te.target,Te.value&&(ce+=" "+Te.value),xe.state=ke.CloseTag,ce+=xe.spaceBeforeSlash+"?>",ce+=this.endline(Te,xe,Ae),xe.state=ke.None,this.closeNode(Te,xe,Ae),ce}raw(Te,xe,Ae){var ce;return this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,ce=this.indent(Te,xe,Ae),xe.state=ke.InsideTag,ce+=Te.value,xe.state=ke.CloseTag,ce+=this.endline(Te,xe,Ae),xe.state=ke.None,this.closeNode(Te,xe,Ae),ce}text(Te,xe,Ae){var ce;return this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,ce=this.indent(Te,xe,Ae),xe.state=ke.InsideTag,ce+=Te.value,xe.state=ke.CloseTag,ce+=this.endline(Te,xe,Ae),xe.state=ke.None,this.closeNode(Te,xe,Ae),ce}dtdAttList(Te,xe,Ae){var ce;return this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,ce=this.indent(Te,xe,Ae)+"<!ATTLIST",xe.state=ke.InsideTag,ce+=" "+Te.elementName+" "+Te.attributeName+" "+Te.attributeType,"#DEFAULT"!==Te.defaultValueType&&(ce+=" "+Te.defaultValueType),Te.defaultValue&&(ce+=' "'+Te.defaultValue+'"'),xe.state=ke.CloseTag,ce+=xe.spaceBeforeSlash+">"+this.endline(Te,xe,Ae),xe.state=ke.None,this.closeNode(Te,xe,Ae),ce}dtdElement(Te,xe,Ae){var ce;return this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,ce=this.indent(Te,xe,Ae)+"<!ELEMENT",xe.state=ke.InsideTag,ce+=" "+Te.name+" "+Te.value,xe.state=ke.CloseTag,ce+=xe.spaceBeforeSlash+">"+this.endline(Te,xe,Ae),xe.state=ke.None,this.closeNode(Te,xe,Ae),ce}dtdEntity(Te,xe,Ae){var ce;return this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,ce=this.indent(Te,xe,Ae)+"<!ENTITY",xe.state=ke.InsideTag,Te.pe&&(ce+=" %"),ce+=" "+Te.name,Te.value?ce+=' "'+Te.value+'"':(Te.pubID&&Te.sysID?ce+=' PUBLIC "'+Te.pubID+'" "'+Te.sysID+'"':Te.sysID&&(ce+=' SYSTEM "'+Te.sysID+'"'),Te.nData&&(ce+=" NDATA "+Te.nData)),xe.state=ke.CloseTag,ce+=xe.spaceBeforeSlash+">"+this.endline(Te,xe,Ae),xe.state=ke.None,this.closeNode(Te,xe,Ae),ce}dtdNotation(Te,xe,Ae){var ce;return this.openNode(Te,xe,Ae),xe.state=ke.OpenTag,ce=this.indent(Te,xe,Ae)+"<!NOTATION",xe.state=ke.InsideTag,ce+=" "+Te.name,Te.pubID&&Te.sysID?ce+=' PUBLIC "'+Te.pubID+'" "'+Te.sysID+'"':Te.pubID?ce+=' PUBLIC "'+Te.pubID+'"':Te.sysID&&(ce+=' SYSTEM "'+Te.sysID+'"'),xe.state=ke.CloseTag,ce+=xe.spaceBeforeSlash+">"+this.endline(Te,xe,Ae),xe.state=ke.None,this.closeNode(Te,xe,Ae),ce}openNode(Te,xe,Ae){}closeNode(Te,xe,Ae){}openAttribute(Te,xe,Ae){}closeAttribute(Te,xe,Ae){}}}).call(this)},7904:function(on,hn,We){(function(){var ye,ke,Ie,p,ie,Qe,re,Ue,Ye;({assign:Ue,isFunction:Ye}=We(3452)),Ie=We(9906),p=We(519),ie=We(1105),re=We(4354),Qe=We(7647),ye=We(2269),ke=We(6316),on.exports.create=function(bt,Ct,$e,Ge){var wt,Jt;if(null==bt)throw new Error("Root element needs a name.");return Ge=Ue({},Ct,$e,Ge),Jt=(wt=new p(Ge)).element(bt),Ge.headless||(wt.declaration(Ge),(null!=Ge.pubID||null!=Ge.sysID)&&wt.dtd(Ge)),Jt},on.exports.begin=function(bt,Ct,$e){return Ye(bt)&&([Ct,$e]=[bt,Ct],bt={}),Ct?new ie(bt,Ct,$e):new p(bt)},on.exports.stringWriter=function(bt){return new re(bt)},on.exports.streamWriter=function(bt,Ct){return new Qe(bt,Ct)},on.exports.implementation=new Ie,on.exports.nodeType=ye,on.exports.writerState=ke}).call(this)}},on=>{on(on.s=8455)}]);