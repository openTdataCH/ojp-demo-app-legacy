(self.webpackChunkojp_demo_app=self.webpackChunkojp_demo_app||[]).push([[179],{3595:(kn,Fn,yt)=>{"use strict";function Ue(n){return"function"==typeof n}function et(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const Xe=et(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function d(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class Qe{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const a of e)a.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(Ue(i))try{i()}catch(a){t=a instanceof Xe?a.errors:[a]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const a of r)try{Tt(a)}catch(p){t=null!=t?t:[],p instanceof Xe?t=[...t,...p.errors]:t.push(p)}}if(t)throw new Xe(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Tt(t);else{if(t instanceof Qe){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&d(e,t)}remove(t){const{_finalizers:e}=this;e&&d(e,t),t instanceof Qe&&t._removeParent(this)}}Qe.EMPTY=(()=>{const n=new Qe;return n.closed=!0,n})();const xt=Qe.EMPTY;function De(n){return n instanceof Qe||n&&"closed"in n&&Ue(n.remove)&&Ue(n.add)&&Ue(n.unsubscribe)}function Tt(n){Ue(n)?n():n.unsubscribe()}const zt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},en={setTimeout(n,t,...e){const{delegate:i}=en;return null!=i&&i.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=en;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function Gt(n){en.setTimeout(()=>{const{onUnhandledError:t}=zt;if(!t)throw n;t(n)})}function it(){}const dt=Jn("C",void 0,void 0);function Jn(n,t,e){return{kind:n,value:t,error:e}}let yn=null;function Bt(n){if(zt.useDeprecatedSynchronousErrorHandling){const t=!yn;if(t&&(yn={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=yn;if(yn=null,e)throw i}}else n()}class Re extends Qe{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,De(t)&&t.add(this)):this.destination=bt}static create(t,e,i){return new at(t,e,i)}next(t){this.isStopped?Lt(function bn(n){return Jn("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Lt(function Mt(n){return Jn("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Lt(dt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const qe=Function.prototype.bind;function kt(n,t){return qe.call(n,t)}class xe{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){Be(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){Be(i)}else Be(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){Be(e)}}}class at extends Re{constructor(t,e,i){let r;if(super(),Ue(t)||!t)r={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=i?i:void 0};else{let a;this&&zt.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&kt(t.next,a),error:t.error&&kt(t.error,a),complete:t.complete&&kt(t.complete,a)}):r=t}this.destination=new xe(r)}}function Be(n){zt.useDeprecatedSynchronousErrorHandling?function Rn(n){zt.useDeprecatedSynchronousErrorHandling&&yn&&(yn.errorThrown=!0,yn.error=n)}(n):Gt(n)}function Lt(n,t){const{onStoppedNotification:e}=zt;e&&en.setTimeout(()=>e(n,t))}const bt={closed:!0,next:it,error:function Ge(n){throw n},complete:it},lt="function"==typeof Symbol&&Symbol.observable||"@@observable";function Wt(n){return n}function Dn(n){return 0===n.length?Wt:1===n.length?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}let _n=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){const a=function jn(n){return n&&n instanceof Re||function jr(n){return n&&Ue(n.next)&&Ue(n.error)&&Ue(n.complete)}(n)&&De(n)}(e)?e:new at(e,i,r);return Bt(()=>{const{operator:p,source:y}=this;a.add(p?p.call(a,y):y?this._subscribe(a):this._trySubscribe(a))}),a}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=Gn(i))((r,a)=>{const p=new at({next:y=>{try{e(y)}catch(T){a(T),p.unsubscribe()}},error:a,complete:r});this.subscribe(p)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[lt](){return this}pipe(...e){return Dn(e)(this)}toPromise(e){return new(e=Gn(e))((i,r)=>{let a;this.subscribe(p=>a=p,p=>r(p),()=>i(a))})}}return n.create=t=>new n(t),n})();function Gn(n){var t;return null!==(t=null!=n?n:zt.Promise)&&void 0!==t?t:Promise}const lr=et(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let fn=(()=>{class n extends _n{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new qo(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new lr}next(e){Bt(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){Bt(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){Bt(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:a}=this;return i||r?xt:(this.currentObservers=null,a.push(e),new Qe(()=>{this.currentObservers=null,d(a,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:a}=this;i?e.error(r):a&&e.complete()}asObservable(){const e=new _n;return e.source=this,e}}return n.create=(t,e)=>new qo(t,e),n})();class qo extends fn{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:xt}}function Fs(n){return Ue(null==n?void 0:n.lift)}function cr(n){return t=>{if(Fs(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function ur(n,t,e,i,r){return new ee(n,t,e,i,r)}class ee extends Re{constructor(t,e,i,r,a,p){super(t),this.onFinalize=a,this.shouldUnsubscribe=p,this._next=e?function(y){try{e(y)}catch(T){t.error(T)}}:super._next,this._error=r?function(y){try{r(y)}catch(T){t.error(T)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(y){t.error(y)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function ge(n,t){return cr((e,i)=>{let r=0;e.subscribe(ur(i,a=>{i.next(n.call(t,a,r++))}))})}function Ys(n){return this instanceof Ys?(this.v=n,this):new Ys(n)}function za(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(n,t||[]),a=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),y("next"),y("throw"),y("return",function p(oe){return function(fe){return Promise.resolve(fe).then(oe,H)}}),r[Symbol.asyncIterator]=function(){return this},r;function y(oe,fe){i[oe]&&(r[oe]=function(Ae){return new Promise(function(We,ot){a.push([oe,Ae,We,ot])>1||T(oe,Ae)})},fe&&(r[oe]=fe(r[oe])))}function T(oe,fe){try{!function P(oe){oe.value instanceof Ys?Promise.resolve(oe.value.v).then(z,H):J(a[0][2],oe)}(i[oe](fe))}catch(Ae){J(a[0][3],Ae)}}function z(oe){T("next",oe)}function H(oe){T("throw",oe)}function J(oe,fe){oe(fe),a.shift(),a.length&&T(a[0][0],a[0][1])}}function Tu(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function vr(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(a){e[a]=n[a]&&function(p){return new Promise(function(y,T){!function r(a,p,y,T){Promise.resolve(T).then(function(P){a({value:P,done:y})},p)}(y,T,(p=n[a](p)).done,p.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const he=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Te(n){return Ue(null==n?void 0:n.then)}function He(n){return Ue(n[lt])}function ke(n){return Symbol.asyncIterator&&Ue(null==n?void 0:n[Symbol.asyncIterator])}function Ye(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const tt=function pt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function ut(n){return Ue(null==n?void 0:n[tt])}function vt(n){return za(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:r}=yield Ys(e.read());if(r)return yield Ys(void 0);yield yield Ys(i)}}finally{e.releaseLock()}})}function wt(n){return Ue(null==n?void 0:n.getReader)}function qt(n){if(n instanceof _n)return n;if(null!=n){if(He(n))return function hn(n){return new _n(t=>{const e=n[lt]();if(Ue(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(he(n))return function En(n){return new _n(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(Te(n))return function Qn(n){return new _n(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Gt)})}(n);if(ke(n))return ai(n);if(ut(n))return function ui(n){return new _n(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(wt(n))return function ti(n){return ai(vt(n))}(n)}throw Ye(n)}function ai(n){return new _n(t=>{(function fr(n,t){var e,i,r,a;return function Et(n,t,e,i){return new(e||(e=Promise))(function(a,p){function y(z){try{P(i.next(z))}catch(H){p(H)}}function T(z){try{P(i.throw(z))}catch(H){p(H)}}function P(z){z.done?a(z.value):function r(a){return a instanceof e?a:new e(function(p){p(a)})}(z.value).then(y,T)}P((i=i.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=Tu(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(p){r={error:p}}finally{try{i&&!i.done&&(a=e.return)&&(yield a.call(e))}finally{if(r)throw r.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function ki(n,t,e,i=0,r=!1){const a=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(a),!r)return a}function Ti(n,t,e=1/0){return Ue(t)?Ti((i,r)=>ge((a,p)=>t(i,a,r,p))(qt(n(i,r))),e):("number"==typeof t&&(e=t),cr((i,r)=>function Di(n,t,e,i,r,a,p,y){const T=[];let P=0,z=0,H=!1;const J=()=>{H&&!T.length&&!P&&t.complete()},oe=Ae=>P<i?fe(Ae):T.push(Ae),fe=Ae=>{a&&t.next(Ae),P++;let We=!1;qt(e(Ae,z++)).subscribe(ur(t,ot=>{null==r||r(ot),a?oe(ot):t.next(ot)},()=>{We=!0},void 0,()=>{if(We)try{for(P--;T.length&&P<i;){const ot=T.shift();p?ki(t,p,()=>fe(ot)):fe(ot)}J()}catch(ot){t.error(ot)}}))};return n.subscribe(ur(t,oe,()=>{H=!0,J()})),()=>{null==y||y()}}(i,r,n,e)))}function xr(n=1/0){return Ti(Wt,n)}const uo=new _n(n=>n.complete());function ps(n){return n&&Ue(n.schedule)}function ql(n){return n[n.length-1]}function Cl(n){return Ue(ql(n))?n.pop():void 0}function Bc(n){return ps(ql(n))?n.pop():void 0}function Rh(n,t=0){return cr((e,i)=>{e.subscribe(ur(i,r=>ki(i,n,()=>i.next(r),t),()=>ki(i,n,()=>i.complete(),t),r=>ki(i,n,()=>i.error(r),t)))})}function vf(n,t=0){return cr((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function al(n,t){if(!n)throw new Error("Iterable cannot be null");return new _n(e=>{ki(e,t,()=>{const i=n[Symbol.asyncIterator]();ki(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function ho(n,t){return t?function xa(n,t){if(null!=n){if(He(n))return function Bm(n,t){return qt(n).pipe(vf(t),Rh(t))}(n,t);if(he(n))return function md(n,t){return new _n(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(Te(n))return function fd(n,t){return qt(n).pipe(vf(t),Rh(t))}(n,t);if(ke(n))return al(n,t);if(ut(n))return function sl(n,t){return new _n(e=>{let i;return ki(e,t,()=>{i=n[tt](),ki(e,t,()=>{let r,a;try{({value:r,done:a}=i.next())}catch(p){return void e.error(p)}a?e.complete():e.next(r)},0,!0)}),()=>Ue(null==i?void 0:i.return)&&i.return()})}(n,t);if(wt(n))return function Dl(n,t){return al(vt(n),t)}(n,t)}throw Ye(n)}(n,t):qt(n)}function yo(...n){const t=Bc(n),e=function yf(n,t){return"number"==typeof ql(n)?n.pop():t}(n,1/0),i=n;return i.length?1===i.length?qt(i[0]):xr(e)(ho(i,t)):uo}function xf(n={}){const{connector:t=(()=>new fn),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return a=>{let p,y,T,P=0,z=!1,H=!1;const J=()=>{null==y||y.unsubscribe(),y=void 0},oe=()=>{J(),p=T=void 0,z=H=!1},fe=()=>{const Ae=p;oe(),null==Ae||Ae.unsubscribe()};return cr((Ae,We)=>{P++,!H&&!z&&J();const ot=T=null!=T?T:t();We.add(()=>{P--,0===P&&!H&&!z&&(y=kh(fe,r))}),ot.subscribe(We),!p&&P>0&&(p=new at({next:tn=>ot.next(tn),error:tn=>{H=!0,J(),y=kh(oe,e,tn),ot.error(tn)},complete:()=>{z=!0,J(),y=kh(oe,i),ot.complete()}}),qt(Ae).subscribe(p))})(a)}}function kh(n,t,...e){if(!0===t)return void n();if(!1===t)return;const i=new at({next:()=>{i.unsubscribe(),n()}});return t(...e).subscribe(i)}function Er(n){for(let t in n)if(n[t]===Er)return t;throw Error("Could not find renamed property on target object.")}function gd(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function vo(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(vo).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function zm(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const wa=Er({__forward_ref__:Er});function dr(n){return n.__forward_ref__=dr,n.toString=function(){return vo(this())},n}function Pi(n){return zc(n)?n():n}function zc(n){return"function"==typeof n&&n.hasOwnProperty(wa)&&n.__forward_ref__===dr}class ln extends Error{constructor(t,e){super(function _d(n,t){return`NG0${Math.abs(n)}${t?": "+t.trim():""}`}(t,e)),this.code=t}}function Ln(n){return"string"==typeof n?n:null==n?"":String(n)}function Vc(n,t){throw new ln(-201,!1)}function Ss(n,t){null==n&&function Qi(n,t,e,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${e} ${i} ${t} <=Actual]`))}(t,n,null,"!=")}function vn(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function qn(n){return{providers:n.providers||[],imports:n.imports||[]}}function Js(n){return ea(n,Ts)||ea(n,ts)}function ea(n,t){return n.hasOwnProperty(t)?n[t]:null}function Vo(n){return n&&(n.hasOwnProperty(Ua)||n.hasOwnProperty(jm))?n[Ua]:null}const Ts=Er({\u0275prov:Er}),Ua=Er({\u0275inj:Er}),ts=Er({ngInjectableDef:Er}),jm=Er({ngInjectorDef:Er});var hi=(()=>((hi=hi||{})[hi.Default=0]="Default",hi[hi.Host=1]="Host",hi[hi.Self=2]="Self",hi[hi.SkipSelf=4]="SkipSelf",hi[hi.Optional=8]="Optional",hi))();let Uc;function Cs(n){const t=Uc;return Uc=n,t}function Fh(n,t,e){const i=Js(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&hi.Optional?null:void 0!==t?t:void Vc(vo(n))}function Gc(n){return{toString:n}.toString()}var ll=(()=>((ll=ll||{})[ll.OnPush=0]="OnPush",ll[ll.Default=1]="Default",ll))(),Sa=(()=>{return(n=Sa||(Sa={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",Sa;var n})();const To=(()=>"undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof global&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self)(),bd={},Or=[],$l=Er({\u0275cmp:Er}),Um=Er({\u0275dir:Er}),qc=Er({\u0275pipe:Er}),Hm=Er({\u0275mod:Er}),cl=Er({\u0275fac:Er}),Bs=Er({__NG_ELEMENT_ID__:Er});let Li=0;function Ut(n){return Gc(()=>{const e=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===ll.OnPush,directiveDefs:null,pipeDefs:null,standalone:e,dependencies:e&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||Or,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||Sa.Emulated,id:"c"+Li++,styles:n.styles||Or,_:null,setInput:null,schemas:n.schemas||null,tView:null},a=n.dependencies,p=n.features;return r.inputs=Tf(n.inputs,i),r.outputs=Tf(n.outputs),p&&p.forEach(y=>y(r)),r.directiveDefs=a?()=>("function"==typeof a?a():a).map(li).filter(Sf):null,r.pipeDefs=a?()=>("function"==typeof a?a():a).map(so).filter(Sf):null,r})}function li(n){return Ir(n)||ns(n)}function Sf(n){return null!==n}function $n(n){return Gc(()=>({type:n.type,bootstrap:n.bootstrap||Or,declarations:n.declarations||Or,imports:n.imports||Or,exports:n.exports||Or,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Tf(n,t){if(null==n)return bd;const e={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],a=r;Array.isArray(r)&&(a=r[1],r=r[0]),e[r]=i,t&&(t[r]=a)}return e}const cn=Ut;function ta(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function Ir(n){return n[$l]||null}function ns(n){return n[Um]||null}function so(n){return n[qc]||null}function Ds(n,t){const e=n[Hm]||null;if(!e&&!0===t)throw new Error(`Type ${vo(n)} does not have '\u0275mod' property.`);return e}function gs(n){return Array.isArray(n)&&"object"==typeof n[1]}function ha(n){return Array.isArray(n)&&!0===n[1]}function Sd(n){return 0!=(8&n.flags)}function Il(n){return 2==(2&n.flags)}function Ml(n){return 1==(1&n.flags)}function vi(n){return null!==n.template}function Td(n){return 0!=(256&n[2])}function Xc(n,t){return n.hasOwnProperty(cl)?n[cl]:null}class $_{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function xo(){return Cd}function Cd(n){return n.type.prototype.ngOnChanges&&(n.setInput=W_),$h}function $h(){const n=Mf(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===bd)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function W_(n,t,e,i){const r=Mf(n)||function Af(n,t){return n[Ta]=t}(n,{previous:bd,current:null}),a=r.current||(r.current={}),p=r.previous,y=this.declaredInputs[e],T=p[y];a[y]=new $_(T&&T.currentValue,t,p===bd),n[i]=t}xo.ngInherit=!0;const Ta="__ngSimpleChanges__";function Mf(n){return n[Ta]||null}function rs(n){for(;Array.isArray(n);)n=n[0];return n}function Wh(n,t){return rs(t[n])}function Da(n,t){return rs(t[n.index])}function kf(n,t){return n.data[t]}function Mu(n,t){return n[t]}function pa(n,t){const e=t[n];return gs(e)?e:e[0]}function Au(n){return 64==(64&n[2])}function gc(n,t){return null==t?null:n[t]}function Pf(n){n[18]=0}function Zh(n,t){n[5]+=t;let e=n,i=n[3];for(;null!==i&&(1===t&&1===e[5]||-1===t&&0===e[5]);)i[5]+=t,e=i,i=i[3]}const Hi={lFrame:zf(null),bindingsEnabled:!0};function Zm(){return Hi.bindingsEnabled}function mn(){return Hi.lFrame.lView}function Fr(){return Hi.lFrame.tView}function di(n){return Hi.lFrame.contextLView=n,n[8]}function oi(n){return Hi.lFrame.contextLView=null,n}function _s(){let n=Z_();for(;null!==n&&64===n.type;)n=n.parent;return n}function Z_(){return Hi.lFrame.currentTNode}function Zl(n,t){const e=Hi.lFrame;e.currentTNode=n,e.isParent=t}function Yh(){return Hi.lFrame.isParent}function Rd(){Hi.lFrame.isParent=!1}function Es(){const n=Hi.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function dl(){return Hi.lFrame.bindingIndex}function Kc(){return Hi.lFrame.bindingIndex++}function Yl(n){const t=Hi.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function xn(n,t){const e=Hi.lFrame;e.bindingIndex=e.bindingRootIndex=n,Jh(t)}function Jh(n){Hi.lFrame.currentDirectiveIndex=n}function bc(n){const t=Hi.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}function yc(){return Hi.lFrame.currentQueryIndex}function Pn(n){Hi.lFrame.currentQueryIndex=n}function Jm(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function Qm(n,t,e){if(e&hi.SkipSelf){let r=t,a=n;for(;!(r=r.parent,null!==r||e&hi.Host||(r=Jm(a),null===r||(a=a[15],10&r.type))););if(null===r)return!1;t=r,n=a}const i=Hi.lFrame=Lu();return i.currentTNode=t,i.lView=n,!0}function eg(n){const t=Lu(),e=n[1];Hi.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function Lu(){const n=Hi.lFrame,t=null===n?null:n.child;return null===t?zf(n):t}function zf(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function Pd(){const n=Hi.lFrame;return Hi.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const tg=Pd;function ng(){const n=Pd();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function bs(){return Hi.lFrame.selectedIndex}function Al(n){Hi.lFrame.selectedIndex=n}function gr(){const n=Hi.lFrame;return kf(n.tView,n.selectedIndex)}function Is(){Hi.lFrame.currentNamespace="svg"}function Ld(){!function rg(){Hi.lFrame.currentNamespace=null}()}function na(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const a=n.data[e].type.prototype,{ngAfterContentInit:p,ngAfterContentChecked:y,ngAfterViewInit:T,ngAfterViewChecked:P,ngOnDestroy:z}=a;p&&(n.contentHooks||(n.contentHooks=[])).push(-e,p),y&&((n.contentHooks||(n.contentHooks=[])).push(e,y),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,y)),T&&(n.viewHooks||(n.viewHooks=[])).push(-e,T),P&&((n.viewHooks||(n.viewHooks=[])).push(e,P),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,P)),null!=z&&(n.destroyHooks||(n.destroyHooks=[])).push(e,z)}}function ao(n,t,e){sg(n,t,3,e)}function Ou(n,t,e,i){(3&n[2])===e&&sg(n,t,e,i)}function ep(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function sg(n,t,e,i){const a=null!=i?i:-1,p=t.length-1;let y=0;for(let T=void 0!==i?65535&n[18]:0;T<p;T++)if("number"==typeof t[T+1]){if(y=t[T],null!=i&&y>=i)break}else t[T]<0&&(n[18]+=65536),(y<a||-1==a)&&(J_(n,e,t,T),n[18]=(4294901760&n[18])+T+2),T++}function J_(n,t,e,i){const r=e[i]<0,a=e[i+1],y=n[r?-e[i]:e[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{a.call(y)}finally{}}}else try{a.call(y)}finally{}}class tp{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function Kl(n,t,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const a=e[i++],p=e[i++],y=e[i++];n.setAttribute(t,p,y,a)}else{const a=r,p=e[++i];np(a)?n.setProperty(t,a,p):n.setAttribute(t,a,p),i++}}return i}function Vf(n){return 3===n||4===n||6===n}function np(n){return 64===n.charCodeAt(0)}function hl(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?e=r:0===e||jf(n,e,r,null,-1===e||2===e?t[++i]:null)}}return n}function jf(n,t,e,i,r){let a=0,p=n.length;if(-1===t)p=-1;else for(;a<n.length;){const y=n[a++];if("number"==typeof y){if(y===t){p=-1;break}if(y>t){p=a-1;break}}}for(;a<n.length;){const y=n[a];if("number"==typeof y)break;if(y===e){if(null===i)return void(null!==r&&(n[a+1]=r));if(i===n[a+1])return void(n[a+2]=r)}a++,null!==i&&a++,null!==r&&a++}-1!==p&&(n.splice(p,0,t),a=p+1),n.splice(a++,0,e),null!==i&&n.splice(a++,0,i),null!==r&&n.splice(a++,0,r)}function pl(n){return-1!==n}function Bd(n){return 32767&n}function Fu(n,t){let e=function av(n){return n>>16}(n),i=t;for(;e>0;)i=i[15],e--;return i}let zd=!0;function Vd(n){const t=zd;return zd=n,t}let rp=0;const qa={};function Ea(n,t){const e=Uf(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,js(i.data,n),js(t,null),js(i.blueprint,null));const r=Qc(n,t),a=n.injectorIndex;if(pl(r)){const p=Bd(r),y=Fu(r,t),T=y[1].data;for(let P=0;P<8;P++)t[a+P]=y[p+P]|T[p+P]}return t[a+8]=r,a}function js(n,t){n.push(0,0,0,0,0,0,0,0,t)}function Uf(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Qc(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;null!==r;){if(i=Hf(r),null===i)return-1;if(e++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return-1}function Mr(n,t,e){!function tb(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Bs)&&(i=e[Bs]),null==i&&(i=e[Bs]=rp++);const r=255&i;t.data[n+(r>>5)]|=1<<r}(n,t,e)}function ag(n,t,e){if(e&hi.Optional||void 0!==n)return n;Vc()}function xc(n,t,e,i){if(e&hi.Optional&&void 0===i&&(i=null),0==(e&(hi.Self|hi.Host))){const r=n[9],a=Cs(void 0);try{return r?r.get(t,i,e&hi.Optional):Fh(t,i,e&hi.Optional)}finally{Cs(a)}}return ag(i,0,e)}function op(n,t,e,i=hi.Default,r){if(null!==n){if(1024&t[2]){const p=function nu(n,t,e,i,r){let a=n,p=t;for(;null!==a&&null!==p&&1024&p[2]&&!(256&p[2]);){const y=Nu(a,p,e,i|hi.Self,qa);if(y!==qa)return y;let T=a.parent;if(!T){const P=p[21];if(P){const z=P.get(e,qa,i);if(z!==qa)return z}T=Hf(p),p=p[15]}a=T}return r}(n,t,e,i,qa);if(p!==qa)return p}const a=Nu(n,t,e,i,qa);if(a!==qa)return a}return xc(t,e,i,r)}function Nu(n,t,e,i,r){const a=function tu(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(Bs)?n[Bs]:void 0;return"number"==typeof t?t>=0?255&t:jd:t}(e);if("function"==typeof a){if(!Qm(t,n,i))return i&hi.Host?ag(r,0,i):xc(t,e,i,r);try{const p=a(i);if(null!=p||i&hi.Optional)return p;Vc()}finally{tg()}}else if("number"==typeof a){let p=null,y=Uf(n,t),T=-1,P=i&hi.Host?t[16][6]:null;for((-1===y||i&hi.SkipSelf)&&(T=-1===y?Qc(n,t):t[y+8],-1!==T&&sp(i,!1)?(p=t[1],y=Bd(T),t=Fu(T,t)):y=-1);-1!==y;){const z=t[1];if(Jl(a,y,z.data)){const H=lg(y,t,e,p,i,P);if(H!==qa)return H}T=t[y+8],-1!==T&&sp(i,t[1].data[y+8]===P)&&Jl(a,y,t)?(p=z,y=Bd(T),t=Fu(T,t)):y=-1}}return r}function lg(n,t,e,i,r,a){const p=t[1],y=p.data[n+8],z=eu(y,p,e,null==i?Il(y)&&zd:i!=p&&0!=(3&y.type),r&hi.Host&&a===y);return null!==z?$a(t,p,z,y):qa}function eu(n,t,e,i,r){const a=n.providerIndexes,p=t.data,y=1048575&a,T=n.directiveStart,z=a>>20,J=r?y+z:n.directiveEnd;for(let oe=i?y:y+z;oe<J;oe++){const fe=p[oe];if(oe<T&&e===fe||oe>=T&&fe.type===e)return oe}if(r){const oe=p[T];if(oe&&vi(oe)&&oe.type===e)return T}return null}function $a(n,t,e,i){let r=n[e];const a=t.data;if(function Od(n){return n instanceof tp}(r)){const p=r;p.resolving&&function mr(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new ln(-200,`Circular dependency in DI detected for ${n}${e}`)}(function $r(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Ln(n)}(a[e]));const y=Vd(p.canSeeViewProviders);p.resolving=!0;const T=p.injectImpl?Cs(p.injectImpl):null;Qm(n,i,hi.Default);try{r=n[e]=p.factory(void 0,a,n,i),t.firstCreatePass&&e>=i.directiveStart&&function K_(n,t,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:a}=t.type.prototype;if(i){const p=Cd(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,p),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,p)}r&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,r),a&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,a),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,a))}(e,a[e],t)}finally{null!==T&&Cs(T),Vd(y),p.resolving=!1,tg()}}return r}function Jl(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function sp(n,t){return!(n&hi.Self||n&hi.Host&&t)}class Ql{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return op(this._tNode,this._lView,t,i,e)}}function jd(){return new Ql(_s(),mn())}function wr(n){return Gc(()=>{const t=n.prototype.constructor,e=t[cl]||ap(t),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const a=r[cl]||ap(r);if(a&&a!==e)return a;r=Object.getPrototypeOf(r)}return a=>new a})}function ap(n){return zc(n)?()=>{const t=ap(Pi(n));return t&&t()}:Xc(n)}function Hf(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[6]:null}function us(n){return function nr(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const a=e[r];if(Vf(a))break;if(0===a)r+=2;else if("number"==typeof a)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(a===t)return e[r+1];r+=2}}}return null}(_s(),n)}const kl="__parameters__";function Pl(n,t,e){return Gc(()=>{const i=function lp(n){return function(...e){if(n){const i=n(...e);for(const r in i)this[r]=i[r]}}}(t);function r(...a){if(this instanceof r)return i.apply(this,a),this;const p=new r(...a);return y.annotation=p,y;function y(T,P,z){const H=T.hasOwnProperty(kl)?T[kl]:Object.defineProperty(T,kl,{value:[]})[kl];for(;H.length<=z;)H.push(null);return(H[z]=H[z]||[]).push(p),T}}return e&&(r.prototype=Object.create(e.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class Qt{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=vn({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ia(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)?(t===n&&(t=n.slice(0,e)),ia(i,t)):t!==n&&t.push(i)}return t}function ec(n,t){n.forEach(e=>Array.isArray(e)?ec(e,t):t(e))}function pg(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function up(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function Gd(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}function Wa(n,t,e){let i=Vu(n,t);return i>=0?n[1|i]=e:(i=~i,function dv(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(1===r)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;)n[r]=n[r-2],r--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function zu(n,t){const e=Vu(n,t);if(e>=0)return n[1|e]}function Vu(n,t){return function hp(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){const a=i+(r-i>>1),p=n[a<<e];if(t===p)return a<<e;p>t?r=a:i=a+1}return~(r<<e)}(n,t,1)}const mp={},Yf="__NG_DI_FLAG__",Uu="ngTempTokenPath",gp=/\n/gm,nc="__source";let fa;function Ia(n){const t=fa;return fa=n,t}function Sc(n,t=hi.Default){if(void 0===fa)throw new ln(-203,!1);return null===fa?Fh(n,void 0,t):fa.get(n,t&hi.Optional?null:void 0,t)}function mt(n,t=hi.Default){return(function Du(){return Uc}()||Sc)(Pi(n),t)}function Oo(n,t=hi.Default){return"number"!=typeof t&&(t=0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)),mt(n,t)}function gg(n){const t=[];for(let e=0;e<n.length;e++){const i=Pi(n[e]);if(Array.isArray(i)){if(0===i.length)throw new ln(900,!1);let r,a=hi.Default;for(let p=0;p<i.length;p++){const y=i[p],T=ab(y);"number"==typeof T?-1===T?r=y.token:a|=T:r=y}t.push(mt(r,a))}else t.push(mt(i))}return t}function _p(n,t){return n[Yf]=t,n.prototype[Yf]=t,n}function ab(n){return n[Yf]}const s=_p(Pl("Optional"),8),g=_p(Pl("SkipSelf"),4);var rn=(()=>((rn=rn||{})[rn.Important=1]="Important",rn[rn.DashCase=2]="DashCase",rn))();const Gi=new Map;let Hr=0;const ma="__ngContext__";function Eo(n,t){gs(t)?(n[ma]=t[20],function Ar(n){Gi.set(n[20],n)}(t)):n[ma]=t}function Xa(n,t){return undefined(n,t)}function er(n){const t=n[3];return ha(t)?t[3]:t}function ru(n){return Wd(n[13])}function bp(n){return Wd(n[4])}function Wd(n){for(;null!==n&&!ha(n);)n=n[4];return n}function ml(n,t,e,i,r){if(null!=i){let a,p=!1;ha(i)?a=i:gs(i)&&(p=!0,i=i[0]);const y=rs(i);0===n&&null!==e?null==r?bv(t,e,y):yp(t,e,y,r||null,!0):1===n&&null!==e?yp(t,e,y,r||null,!0):2===n?function Hs(n,t,e){const i=mb(n,t);i&&function VC(n,t,e,i){n.removeChild(t,e,i)}(n,i,t,e)}(t,y,p):3===n&&t.destroyNode(y),null!=a&&function wg(n,t,e,i,r){const a=e[7];a!==rs(e)&&ml(t,n,i,a,r);for(let y=10;y<e.length;y++){const T=e[y];qu(T[1],T,n,t,i,a)}}(t,n,a,e,r)}}function bg(n,t,e){return n.createElement(t,e)}function gv(n,t){const e=n[9],i=e.indexOf(t),r=t[3];512&t[2]&&(t[2]&=-513,Zh(r,-1)),e.splice(i,1)}function pb(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const r=i[17];null!==r&&r!==n&&gv(r,i),t>0&&(n[e-1][4]=i[4]);const a=up(n,10+t);!function yg(n,t){qu(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const p=a[19];null!==p&&p.detachView(a[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function Gu(n,t){if(!(128&t[2])){const e=t[11];e.destroyNode&&qu(n,t,e,3,null,null),function hb(n){let t=n[13];if(!t)return fb(n[1],n);for(;t;){let e=null;if(gs(t))e=t[13];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)gs(t)&&fb(t[1],t),t=t[3];null===t&&(t=n),gs(t)&&fb(t[1],t),e=t&&t[4]}t=e}}(t)}}function fb(n,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function a1(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const r=t[e[i]];if(!(r instanceof tp)){const a=e[i+1];if(Array.isArray(a))for(let p=0;p<a.length;p+=2){const y=r[a[p]],T=a[p+1];try{T.call(y)}finally{}}else try{a.call(r)}finally{}}}}(n,t),function _v(n,t){const e=n.cleanup,i=t[7];let r=-1;if(null!==e)for(let a=0;a<e.length-1;a+=2)if("string"==typeof e[a]){const p=e[a+1],y="function"==typeof p?p(t):rs(t[p]),T=i[r=e[a+2]],P=e[a+3];"boolean"==typeof P?y.removeEventListener(e[a],T,P):P>=0?i[r=P]():i[r=-P].unsubscribe(),a+=2}else{const p=i[r=e[a+1]];e[a].call(p)}if(null!==i){for(let a=r+1;a<i.length;a++)(0,i[a])();t[7]=null}}(n,t),1===t[1].type&&t[11].destroy();const e=t[17];if(null!==e&&ha(t[3])){e!==t[3]&&gv(e,t);const i=t[19];null!==i&&i.detachView(n)}!function Tr(n){Gi.delete(n[20])}(t)}}function l1(n,t,e){return function c1(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===Sa.None||r===Sa.Emulated)return null}return Da(i,e)}(n,t.parent,e)}function yp(n,t,e,i,r){n.insertBefore(t,e,i,r)}function bv(n,t,e){n.appendChild(t,e)}function yv(n,t,e,i,r){null!==i?yp(n,t,e,i,r):bv(n,t,e)}function mb(n,t){return n.parentNode(t)}function vv(n,t,e){return wv(n,t,e)}let yb,Sg,wv=function xv(n,t,e){return 40&n.type?Da(n,e):null};function vg(n,t,e,i){const r=l1(n,i,t),a=t[11],y=vv(i.parent||t[6],i,t);if(null!=r)if(Array.isArray(e))for(let T=0;T<e.length;T++)yv(a,r,e[T],y,!1);else yv(a,r,e,y,!1)}function xg(n,t){if(null!==t){const e=t.type;if(3&e)return Da(t,n);if(4&e)return ou(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return xg(n,i);{const r=n[t.index];return ha(r)?ou(-1,r):rs(r)}}if(32&e)return Xa(t,n)()||rs(n[t.index]);{const i=_b(n,t);return null!==i?Array.isArray(i)?i[0]:xg(er(n[16]),i):xg(n,t.next)}}return null}function _b(n,t){return null!==t?n[16][6].projection[t.projection]:null}function ou(n,t){const e=10+n+1;if(e<t.length){const i=t[e],r=i[1].firstChild;if(null!==r)return xg(i,r)}return t[7]}function bb(n,t,e,i,r,a,p){for(;null!=e;){const y=i[e.index],T=e.type;if(p&&0===t&&(y&&Eo(rs(y),i),e.flags|=4),64!=(64&e.flags))if(8&T)bb(n,t,e.child,i,r,a,!1),ml(t,n,r,y,a);else if(32&T){const P=Xa(e,i);let z;for(;z=P();)ml(t,n,r,z,a);ml(t,n,r,y,a)}else 16&T?u1(n,t,i,e,r,a):ml(t,n,r,y,a);e=p?e.projectionNext:e.next}}function qu(n,t,e,i,r,a){bb(e,i,n.firstChild,t,r,a,!1)}function u1(n,t,e,i,r,a){const p=e[16],T=p[6].projection[i.projection];if(Array.isArray(T))for(let P=0;P<T.length;P++)ml(t,n,r,T[P],a);else bb(n,t,T,p[3],r,a,!0)}function Xd(n,t,e){n.setAttribute(t,"style",e)}function vp(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function xp(n){var t;return(null===(t=function Tv(){if(void 0===yb&&(yb=null,To.trustedTypes))try{yb=To.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return yb}())||void 0===t?void 0:t.createHTML(n))||n}class su{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Dg extends su{getTypeName(){return"HTML"}}class h1 extends su{getTypeName(){return"Style"}}class p1 extends su{getTypeName(){return"Script"}}class Eg extends su{getTypeName(){return"URL"}}class Dv extends su{getTypeName(){return"ResourceURL"}}function Pa(n){return n instanceof su?n.changingThisBreaksApplicationSecurity:n}function au(n,t){const e=function Ev(n){return n instanceof su&&n.getTypeName()||null}(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}class Rv{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(xp(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class lu{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const i=this.inertDocument.createElement("body");e.appendChild(i)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=xp(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=xp(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const p=e.item(r).name;("xmlns:ns1"===p||0===p.indexOf("ns1:"))&&t.removeAttribute(p)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const XC=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;function xb(n){return(n=String(n)).match(XC)?n:"unsafe:"+n}function $u(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function Ig(...n){const t={};for(const e of n)for(const i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}const b1=$u("area,br,col,hr,img,wbr"),y1=$u("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),v1=$u("rp,rt"),wb=Ig(b1,Ig(y1,$u("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Ig(v1,$u("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Ig(v1,y1)),Mg=$u("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Ag=Ig(Mg,$u("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),$u("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),S1=$u("script,style,template");class T1{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!wb.hasOwnProperty(e))return this.sanitizedSomething=!0,!S1.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let r=0;r<i.length;r++){const a=i.item(r),p=a.name,y=p.toLowerCase();if(!Ag.hasOwnProperty(y)){this.sanitizedSomething=!0;continue}let T=a.value;Mg[y]&&(T=xb(T)),this.buf.push(" ",p,'="',Zd(T),'"')}return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();wb.hasOwnProperty(e)&&!b1.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(Zd(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const C1=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Kf=/([^\#-~ |!])/g;function Zd(n){return n.replace(/&/g,"&amp;").replace(C1,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(Kf,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Rg;function kg(n,t){let e=null;try{Rg=Rg||function Av(n){const t=new lu(n);return function _1(){try{return!!(new window.DOMParser).parseFromString(xp(""),"text/html")}catch(n){return!1}}()?new Rv(t):t}(n);let i=t?String(t):"";e=Rg.getInertBodyElement(i);let r=5,a=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=a,a=e.innerHTML,e=Rg.getInertBodyElement(i)}while(i!==a);return xp((new T1).sanitizeChildren(Sb(e)||e))}finally{if(e){const i=Sb(e)||e;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function Sb(n){return"content"in n&&function D1(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var no=(()=>((no=no||{})[no.NONE=0]="NONE",no[no.HTML=1]="HTML",no[no.STYLE=2]="STYLE",no[no.SCRIPT=3]="SCRIPT",no[no.URL=4]="URL",no[no.RESOURCE_URL=5]="RESOURCE_URL",no))();function hs(n){const t=function Sp(){const n=mn();return n&&n[12]}();return t?t.sanitize(no.URL,n)||"":au(n,"URL")?Pa(n):xb(Ln(n))}const Db=new Qt("ENVIRONMENT_INITIALIZER"),Eb=new Qt("INJECTOR",-1),R1=new Qt("INJECTOR_DEF_TYPES");class k1{get(t,e=mp){if(e===mp){const i=new Error(`NullInjectorError: No provider for ${vo(t)}!`);throw i.name="NullInjectorError",i}return e}}function tD(...n){return{\u0275providers:P1(0,n)}}function P1(n,...t){const e=[],i=new Set;let r;return ec(t,a=>{const p=a;cu(p,e,[],i)&&(r||(r=[]),r.push(p))}),void 0!==r&&Pv(r,e),e}function Pv(n,t){for(let e=0;e<n.length;e++){const{providers:r}=n[e];ec(r,a=>{t.push(a)})}}function cu(n,t,e,i){if(!(n=Pi(n)))return!1;let r=null,a=Vo(n);const p=!a&&Ir(n);if(a||p){if(p&&!p.standalone)return!1;r=n}else{const T=n.ngModule;if(a=Vo(T),!a)return!1;r=T}const y=i.has(r);if(p){if(y)return!1;if(i.add(r),p.dependencies){const T="function"==typeof p.dependencies?p.dependencies():p.dependencies;for(const P of T)cu(P,t,e,i)}}else{if(!a)return!1;{if(null!=a.imports&&!y){let P;i.add(r);try{ec(a.imports,z=>{cu(z,t,e,i)&&(P||(P=[]),P.push(z))})}finally{}void 0!==P&&Pv(P,t)}if(!y){const P=Xc(r)||(()=>new r);t.push({provide:r,useFactory:P,deps:Or},{provide:R1,useValue:r,multi:!0},{provide:Db,useValue:()=>mt(r),multi:!0})}const T=a.providers;null==T||y||ec(T,z=>{t.push(z)})}}return r!==n&&void 0!==n.providers}const Pg=Er({provide:String,useValue:Er});function Jf(n){return null!==n&&"object"==typeof n&&Pg in n}function Yd(n){return"function"==typeof n}const Mb=new Qt("Set Injector scope."),Ab={},nD={};let Rb;function Tp(){return void 0===Rb&&(Rb=new k1),Rb}class Wu{}class O1 extends Wu{constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Pb(t,p=>this.processProvider(p)),this.records.set(Eb,Cp(void 0,this)),r.has("environment")&&this.records.set(Wu,Cp(void 0,this));const a=this.records.get(Mb);null!=a&&"string"==typeof a.value&&this.scopes.add(a.value),this.injectorDefTypes=new Set(this.get(R1.multi,Or,hi.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const e=Ia(this),i=Cs(void 0);try{return t()}finally{Ia(e),Cs(i)}}get(t,e=mp,i=hi.Default){this.assertNotDestroyed();const r=Ia(this),a=Cs(void 0);try{if(!(i&hi.SkipSelf)){let y=this.records.get(t);if(void 0===y){const T=function iD(n){return"function"==typeof n||"object"==typeof n&&n instanceof Qt}(t)&&Js(t);y=T&&this.injectableDefInScope(T)?Cp(kb(t),Ab):null,this.records.set(t,y)}if(null!=y)return this.hydrate(t,y)}return(i&hi.Self?Tp():this.parent).get(t,e=i&hi.Optional&&e===mp?null:e)}catch(p){if("NullInjectorError"===p.name){if((p[Uu]=p[Uu]||[]).unshift(vo(t)),r)throw p;return function Us(n,t,e,i){const r=n[Uu];throw t[nc]&&r.unshift(t[nc]),n.message=function lb(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=vo(t);if(Array.isArray(t))r=t.map(vo).join(" -> ");else if("object"==typeof t){let a=[];for(let p in t)if(t.hasOwnProperty(p)){let y=t[p];a.push(p+":"+("string"==typeof y?JSON.stringify(y):vo(y)))}r=`{${a.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${n.replace(gp,"\n  ")}`}("\n"+n.message,r,e,i),n.ngTokenPath=r,n[Uu]=null,n}(p,t,"R3InjectorError",this.source)}throw p}finally{Cs(a),Ia(r)}}resolveInjectorInitializers(){const t=Ia(this),e=Cs(void 0);try{const i=this.get(Db.multi,Or,hi.Self);for(const r of i)r()}finally{Ia(t),Cs(e)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(vo(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ln(205,!1)}processProvider(t){let e=Yd(t=Pi(t))?t:Pi(t&&t.provide);const i=function F1(n){return Jf(n)?Cp(void 0,n.useValue):Cp(Fv(n),Ab)}(t);if(Yd(t)||!0!==t.multi)this.records.get(e);else{let r=this.records.get(e);r||(r=Cp(void 0,Ab,!0),r.factory=()=>gg(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e){return e.value===Ab&&(e.value=nD,e.value=e.factory()),"object"==typeof e.value&&e.value&&function B1(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=Pi(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function kb(n){const t=Js(n),e=null!==t?t.factory:Xc(n);if(null!==e)return e;if(n instanceof Qt)throw new ln(204,!1);if(n instanceof Function)return function Ov(n){const t=n.length;if(t>0)throw Gd(t,"?"),new ln(204,!1);const e=function B_(n){const t=n&&(n[Ts]||n[ts]);if(t){const e=function jc(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new ln(204,!1)}function Fv(n,t,e){let i;if(Yd(n)){const r=Pi(n);return Xc(r)||kb(r)}if(Jf(n))i=()=>Pi(n.useValue);else if(function Lv(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...gg(n.deps||[]));else if(function Qf(n){return!(!n||!n.useExisting)}(n))i=()=>mt(Pi(n.useExisting));else{const r=Pi(n&&(n.useClass||n.provide));if(!function N1(n){return!!n.deps}(n))return Xc(r)||kb(r);i=()=>new r(...gg(n.deps))}return i}function Cp(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function z1(n){return!!n.\u0275providers}function Pb(n,t){for(const e of n)Array.isArray(e)?Pb(e,t):z1(e)?Pb(e.\u0275providers,t):t(e)}class Nv{}class rD{resolveComponentFactory(t){throw function V1(n){const t=Error(`No component factory found for ${vo(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let Dp=(()=>{class n{}return n.NULL=new rD,n})();function oD(){return em(_s(),mn())}function em(n,t){return new ei(Da(n,t))}let ei=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=oD,n})();function U1(n){return n instanceof ei?n.nativeElement:n}class Og{}let uu=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function Bv(){const n=mn(),e=pa(_s().index,n);return(gs(e)?e:n)[11]}(),n})(),zv=(()=>{class n{}return n.\u0275prov=vn({token:n,providedIn:"root",factory:()=>null}),n})();class Kd{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const H1=new Kd("14.3.0"),Lb={};function Fb(n){return n.ngOriginalError}class Xu{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&Fb(t);for(;e&&Fb(e);)e=Fb(e);return e||null}}function Zu(n){return n instanceof Function?n():n}function Ms(n,t,e){let i=n.length;for(;;){const r=n.indexOf(t,e);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const a=t.length;if(r+a===i||n.charCodeAt(r+a)<=32)return r}e=r+1}}const Nb="ng-template";function Bb(n,t,e){let i=0;for(;i<n.length;){let r=n[i++];if(e&&"class"===r){if(r=n[i],-1!==Ms(r.toLowerCase(),t,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===t)return!0;return!1}}return!1}function Ep(n){return 4===n.type&&n.value!==Nb}function uD(n,t,e){return t===(4!==n.type||e?n.value:Nb)}function dD(n,t,e){let i=4;const r=n.attrs||[],a=function Uv(n){for(let t=0;t<n.length;t++)if(Vf(n[t]))return t;return n.length}(r);let p=!1;for(let y=0;y<t.length;y++){const T=t[y];if("number"!=typeof T){if(!p)if(4&i){if(i=2|1&i,""!==T&&!uD(n,T,e)||""===T&&1===t.length){if(Za(i))return!1;p=!0}}else{const P=8&i?T:t[++y];if(8&i&&null!==n.attrs){if(!Bb(n.attrs,P,e)){if(Za(i))return!1;p=!0}continue}const H=hD(8&i?"class":T,r,Ep(n),e);if(-1===H){if(Za(i))return!1;p=!0;continue}if(""!==P){let J;J=H>a?"":r[H+1].toLowerCase();const oe=8&i?J:null;if(oe&&-1!==Ms(oe,P,0)||2&i&&P!==J){if(Za(i))return!1;p=!0}}}}else{if(!p&&!Za(i)&&!Za(T))return!1;if(p&&Za(T))continue;p=!1,i=T|1&i}}return Za(i)||p}function Za(n){return 0==(1&n)}function hD(n,t,e,i){if(null===t)return-1;let r=0;if(i||!e){let a=!1;for(;r<t.length;){const p=t[r];if(p===n)return r;if(3===p||6===p)a=!0;else{if(1===p||2===p){let y=t[++r];for(;"string"==typeof y;)y=t[++r];continue}if(4===p)break;if(0===p){r+=4;continue}}r+=a?1:2}return-1}return function Y1(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function X1(n,t,e=!1){for(let i=0;i<t.length;i++)if(dD(n,t[i],e))return!0;return!1}function Hv(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function K1(n,t){return n?":not("+t.trim()+")":t}function J1(n){let t=n[0],e=1,i=2,r="",a=!1;for(;e<n.length;){let p=n[e];if("string"==typeof p)if(2&i){const y=n[++e];r+="["+p+(y.length>0?'="'+y+'"':"")+"]"}else 8&i?r+="."+p:4&i&&(r+=" "+p);else""!==r&&!Za(p)&&(t+=K1(a,r),r=""),i=p,a=a||!Za(i);e++}return""!==r&&(t+=K1(a,r)),t}const sr={};function _e(n){Q1(Fr(),mn(),bs()+n,!1)}function Q1(n,t,e,i){if(!i)if(3==(3&t[2])){const a=n.preOrderCheckHooks;null!==a&&ao(t,a,e)}else{const a=n.preOrderHooks;null!==a&&Ou(t,a,0,e)}Al(e)}function tw(n,t=null,e=null,i){const r=Wv(n,t,e,i);return r.resolveInjectorInitializers(),r}function Wv(n,t=null,e=null,i,r=new Set){const a=[e||Or,tD(n)];return i=i||("object"==typeof n?void 0:vo(n)),new O1(a,t||Tp(),i||null,r)}let jo=(()=>{class n{static create(e,i){var r;if(Array.isArray(e))return tw({name:""},i,e,"");{const a=null!==(r=e.name)&&void 0!==r?r:"";return tw({name:a},e.parent,e.providers,a)}}}return n.THROW_IF_NOT_FOUND=mp,n.NULL=new k1,n.\u0275prov=vn({token:n,providedIn:"any",factory:()=>mt(Eb)}),n.__NG_ELEMENT_ID__=-1,n})();function le(n,t=hi.Default){const e=mn();return null===e?mt(n,t):op(_s(),e,Pi(n),t)}function Cc(){throw new Error("invalid")}function Hb(n,t){return n<<17|t<<2}function rc(n){return n>>17&32767}function Rp(n){return 2|n}function La(n){return(131068&n)>>2}function qb(n,t){return-131069&n|t<<2}function im(n){return 1|n}function _0(n,t){const e=n.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const r=e[i],a=e[i+1];if(-1!==a){const p=n.data[a];Pn(r),p.contentQueries(2,t[a],a)}}}function sm(n,t,e,i,r,a,p,y,T,P,z){const H=t.blueprint.slice();return H[0]=r,H[2]=76|i,(null!==z||n&&1024&n[2])&&(H[2]|=1024),Pf(H),H[3]=H[15]=n,H[8]=e,H[10]=p||n&&n[10],H[11]=y||n&&n[11],H[12]=T||n&&n[12]||null,H[9]=P||n&&n[9]||null,H[6]=a,H[20]=function rr(){return Hr++}(),H[21]=z,H[16]=2==t.type?n[16]:H,H}function nh(n,t,e,i,r){let a=n.data[t];if(null===a)a=function qg(n,t,e,i,r){const a=Z_(),p=Yh(),T=n.data[t]=function _w(n,t,e,i,r,a){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:a,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,p?a:a&&a.parent,e,t,i,r);return null===n.firstChild&&(n.firstChild=T),null!==a&&(p?null==a.child&&null!==T.parent&&(a.child=T):null===a.next&&(a.next=T)),T}(n,t,e,i,r),function Pu(){return Hi.lFrame.inI18n}()&&(a.flags|=64);else if(64&a.type){a.type=e,a.value=i,a.attrs=r;const p=function ku(){const n=Hi.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();a.injectorIndex=null===p?-1:p.injectorIndex}return Zl(a,!0),a}function ih(n,t,e,i){if(0===e)return-1;const r=t.length;for(let a=0;a<e;a++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function am(n,t,e){eg(t);try{const i=n.viewQuery;null!==i&&Ju(1,i,e);const r=n.template;null!==r&&b0(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&_0(n,t),n.staticViewQueries&&Ju(2,n.viewQuery,e);const a=n.components;null!==a&&function fw(n,t){for(let e=0;e<t.length;e++)AD(n,t[e])}(t,a)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,ng()}}function kp(n,t,e,i){const r=t[2];if(128!=(128&r)){eg(t);try{Pf(t),function Nf(n){return Hi.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&b0(n,t,e,2,i);const p=3==(3&r);if(p){const P=n.preOrderCheckHooks;null!==P&&ao(t,P,null)}else{const P=n.preOrderHooks;null!==P&&Ou(t,P,0,null),ep(t,0)}if(function lm(n){for(let t=ru(n);null!==t;t=bp(t)){if(!t[2])continue;const e=t[9];for(let i=0;i<e.length;i++){const r=e[i],a=r[3];0==(512&r[2])&&Zh(a,1),r[2]|=512}}}(t),function Pp(n){for(let t=ru(n);null!==t;t=bp(t))for(let e=10;e<t.length;e++){const i=t[e],r=i[1];Au(i)&&kp(r,i,r.template,i[8])}}(t),null!==n.contentQueries&&_0(n,t),p){const P=n.contentCheckHooks;null!==P&&ao(t,P)}else{const P=n.contentHooks;null!==P&&Ou(t,P,1),ep(t,1)}!function hw(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)Al(~r);else{const a=r,p=e[++i],y=e[++i];xn(p,a),y(2,t[a])}}}finally{Al(-1)}}(n,t);const y=n.components;null!==y&&function pw(n,t){for(let e=0;e<t.length;e++)Ew(n,t[e])}(t,y);const T=n.viewQuery;if(null!==T&&Ju(2,T,i),p){const P=n.viewCheckHooks;null!==P&&ao(t,P)}else{const P=n.viewHooks;null!==P&&Ou(t,P,2),ep(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,Zh(t[3],-1))}finally{ng()}}}function b0(n,t,e,i,r){const a=bs(),p=2&i;try{Al(-1),p&&t.length>22&&Q1(n,t,22,!1),e(i,r)}finally{Al(a)}}function $g(n,t,e){if(Sd(t)){const r=t.directiveEnd;for(let a=t.directiveStart;a<r;a++){const p=n.data[a];p.contentQueries&&p.contentQueries(1,e[a],a)}}}function Jb(n,t,e){!Zm()||(function ww(n,t,e,i){const r=e.directiveStart,a=e.directiveEnd;n.firstCreatePass||Ea(e,t),Eo(i,t);const p=e.initialInputs;for(let y=r;y<a;y++){const T=n.data[y],P=vi(T);P&&ny(t,e,T);const z=$a(t,n,y,e);Eo(z,t),null!==p&&Dw(0,y-r,z,T,0,p),P&&(pa(e.index,t)[8]=z)}}(n,t,e,Da(e,t)),128==(128&e.flags)&&function CD(n,t,e){const i=e.directiveStart,r=e.directiveEnd,a=e.index,p=function Bf(){return Hi.lFrame.currentDirectiveIndex}();try{Al(a);for(let y=i;y<r;y++){const T=n.data[y],P=t[y];Jh(y),(null!==T.hostBindings||0!==T.hostVars||null!==T.hostAttrs)&&Sw(T,P)}}finally{Al(-1),Jh(p)}}(n,t,e))}function y0(n,t,e=Da){const i=t.localNames;if(null!==i){let r=t.index+1;for(let a=0;a<i.length;a+=2){const p=i[a+1],y=-1===p?e(t,n):n[p];n[r++]=y}}}function v0(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=Qb(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function Qb(n,t,e,i,r,a,p,y,T,P){const z=22+i,H=z+r,J=function mw(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:sr);return e}(z,H),oe="function"==typeof P?P():P;return J[1]={type:n,blueprint:J,template:e,queries:null,viewQuery:y,declTNode:t,data:J.slice().fill(null,z),bindingStartIndex:z,expandoStartIndex:H,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof a?a():a,pipeRegistry:"function"==typeof p?p():p,firstChild:null,schemas:T,consts:oe,incompleteFirstPass:!1}}function x0(n,t,e,i){const r=E0(t);null===e?r.push(i):(r.push(e),n.firstCreatePass&&I0(n).push(i,r.length-1))}function bw(n,t,e){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(t,r):e[i]=[t,r]}return e}function ey(n,t){const i=t.directiveEnd,r=n.data,a=t.attrs,p=[];let y=null,T=null;for(let P=t.directiveStart;P<i;P++){const z=r[P],H=z.inputs,J=null===a||Ep(t)?null:T0(H,a);p.push(J),y=bw(H,P,y),T=bw(z.outputs,P,T)}null!==y&&(y.hasOwnProperty("class")&&(t.flags|=16),y.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=p,t.inputs=y,t.outputs=T}function gl(n,t,e,i,r,a,p,y){const T=Da(t,e);let z,P=t.inputs;!y&&null!=P&&(z=P[i])?(Fp(n,e,z,i,r),Il(t)&&Wg(e,t.index)):3&t.type&&(i=function yw(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=p?p(r,t.value||"",i):r,a.setProperty(T,i,r))}function Wg(n,t){const e=pa(t,n);16&e[2]||(e[2]|=32)}function ty(n,t,e,i){let r=!1;if(Zm()){const a=function DD(n,t,e){const i=n.directiveRegistry;let r=null;if(i)for(let a=0;a<i.length;a++){const p=i[a];X1(e,p.selectors,!1)&&(r||(r=[]),Mr(Ea(e,t),n,p.type),vi(p)?(Tw(n,e),r.unshift(p)):r.push(p))}return r}(n,t,e),p=null===i?null:{"":-1};if(null!==a){r=!0,Cw(e,n.data.length,a.length);for(let z=0;z<a.length;z++){const H=a[z];H.providersResolver&&H.providersResolver(H)}let y=!1,T=!1,P=ih(n,t,a.length,null);for(let z=0;z<a.length;z++){const H=a[z];e.mergedAttrs=hl(e.mergedAttrs,H.hostAttrs),S0(n,e,t,P,H),ID(P,H,p),null!==H.contentQueries&&(e.flags|=8),(null!==H.hostBindings||null!==H.hostAttrs||0!==H.hostVars)&&(e.flags|=128);const J=H.type.prototype;!y&&(J.ngOnChanges||J.ngOnInit||J.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),y=!0),!T&&(J.ngOnChanges||J.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),T=!0),P++}ey(n,e)}p&&function ED(n,t,e){if(t){const i=n.localNames=[];for(let r=0;r<t.length;r+=2){const a=e[t[r+1]];if(null==a)throw new ln(-301,!1);i.push(t[r],a)}}}(e,i,p)}return e.mergedAttrs=hl(e.mergedAttrs,e.attrs),r}function Xg(n,t,e,i,r,a){const p=a.hostBindings;if(p){let y=n.hostBindingOpCodes;null===y&&(y=n.hostBindingOpCodes=[]);const T=~t.index;(function w0(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(y)!=T&&y.push(T),y.push(i,r,p)}}function Sw(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function Tw(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function ID(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;vi(t)&&(e[""]=n)}}function Cw(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function S0(n,t,e,i,r){n.data[i]=r;const a=r.factory||(r.factory=Xc(r.type)),p=new tp(a,vi(r),le);n.blueprint[i]=p,e[i]=p,Xg(n,t,0,i,ih(n,e,r.hostVars,sr),r)}function ny(n,t,e){const i=Da(t,n),r=v0(e),a=n[10],p=Op(n,sm(n,r,null,e.onPush?32:16,i,t,a,a.createRenderer(i,e),null,null,null));n[t.index]=p}function Ec(n,t,e,i,r,a){const p=Da(n,t);!function iy(n,t,e,i,r,a,p){if(null==a)n.removeAttribute(t,r,e);else{const y=null==p?Ln(a):p(a,i||"",r);n.setAttribute(t,r,y,e)}}(t[11],p,a,n.value,e,i,r)}function Dw(n,t,e,i,r,a){const p=a[t];if(null!==p){const y=i.setInput;for(let T=0;T<p.length;){const P=p[T++],z=p[T++],H=p[T++];null!==y?i.setInput(e,H,P,z):e[z]=H}}}function T0(n,t){let e=null,i=0;for(;i<t.length;){const r=t[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===e&&(e=[]),e.push(r,n[r],t[i+1])),i+=2}else i+=2;else i+=4}return e}function C0(n,t,e,i){return new Array(n,!0,!1,t,null,0,i,e,null,null)}function Ew(n,t){const e=pa(t,n);if(Au(e)){const i=e[1];48&e[2]?kp(i,e,i.template,e[8]):e[5]>0&&Lp(e)}}function Lp(n){for(let i=ru(n);null!==i;i=bp(i))for(let r=10;r<i.length;r++){const a=i[r];if(Au(a))if(512&a[2]){const p=a[1];kp(p,a,p.template,a[8])}else a[5]>0&&Lp(a)}const e=n[1].components;if(null!==e)for(let i=0;i<e.length;i++){const r=pa(e[i],n);Au(r)&&r[5]>0&&Lp(r)}}function AD(n,t){const e=pa(t,n),i=e[1];(function D0(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(i,e),am(i,e,e[8])}function Op(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function Zg(n){for(;n;){n[2]|=32;const t=er(n);if(Td(n)&&!t)return n;n=t}return null}function Ku(n,t,e,i=!0){const r=t[10];r.begin&&r.begin();try{kp(n,t,n.template,e)}catch(p){throw i&&Yg(t,p),p}finally{r.end&&r.end()}}function Ju(n,t,e){Pn(0),t(n,e)}function E0(n){return n[7]||(n[7]=[])}function I0(n){return n.cleanup||(n.cleanup=[])}function M0(n,t,e){return(null===n||vi(n))&&(e=function Id(n){for(;Array.isArray(n);){if("object"==typeof n[1])return n;n=n[0]}return null}(e[t.index])),e[11]}function Yg(n,t){const e=n[9],i=e?e.get(Xu,null):null;i&&i.handleError(t)}function Fp(n,t,e,i,r){for(let a=0;a<e.length;){const p=e[a++],y=e[a++],T=t[p],P=n.data[p];null!==P.setInput?P.setInput(T,r,i,y):T[y]=r}}function Qu(n,t,e){const i=Wh(t,n);!function pv(n,t,e){n.setValue(t,e)}(n[11],i,e)}function ry(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,a=0;if(null!==t)for(let p=0;p<t.length;p++){const y=t[p];"number"==typeof y?a=y:1==a?r=zm(r,y):2==a&&(i=zm(i,y+": "+t[++p]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function oy(n,t,e,i,r=!1){for(;null!==e;){const a=t[e.index];if(null!==a&&i.push(rs(a)),ha(a))for(let y=10;y<a.length;y++){const T=a[y],P=T[1].firstChild;null!==P&&oy(T[1],T,P,i)}const p=e.type;if(8&p)oy(n,t,e.child,i);else if(32&p){const y=Xa(e,t);let T;for(;T=y();)i.push(T)}else if(16&p){const y=_b(t,e);if(Array.isArray(y))i.push(...y);else{const T=er(t[16]);oy(T[1],T,y,i,!0)}}e=r?e.projectionNext:e.next}return i}class ed{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return oy(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(ha(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(pb(t,i),up(e,i))}this._attachedToViewContainer=!1}Gu(this._lView[1],this._lView)}onDestroy(t){x0(this._lView[1],this._lView,null,t)}markForCheck(){Zg(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){Ku(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ln(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function s1(n,t){qu(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new ln(902,!1);this._appRef=t}}class Mw extends ed{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;Ku(t[1],t,t[8],!1)}checkNoChanges(){}get context(){return null}}class A0 extends Dp{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=Ir(t);return new Np(e,this.ngModule)}}function Aw(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}class Rw{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){const r=this.injector.get(t,Lb,i);return r!==Lb||e===Lb?r:this.parentInjector.get(t,e,i)}}class Np extends Nv{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function zb(n){return n.map(J1).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return Aw(this.componentDef.inputs)}get outputs(){return Aw(this.componentDef.outputs)}create(t,e,i,r){let a=(r=r||this.ngModule)instanceof Wu?r:null==r?void 0:r.injector;a&&null!==this.componentDef.getStandaloneInjector&&(a=this.componentDef.getStandaloneInjector(a)||a);const p=a?new Rw(t,a):t,y=p.get(Og,null);if(null===y)throw new ln(407,!1);const T=p.get(zv,null),P=y.createRenderer(null,this.componentDef),z=this.componentDef.selectors[0][0]||"div",H=i?function gw(n,t,e){return n.selectRootElement(t,e===Sa.ShadowDom)}(P,i,this.componentDef.encapsulation):bg(P,z,function kD(n){const t=n.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(z)),J=this.componentDef.onPush?288:272,oe=Qb(0,null,null,1,0,null,null,null,null,null),fe=sm(null,oe,null,J,null,null,y,P,T,p,null);let Ae,We;eg(fe);try{const ot=function Lw(n,t,e,i,r,a){const p=e[1];e[22]=n;const T=nh(p,22,2,"#host",null),P=T.mergedAttrs=t.hostAttrs;null!==P&&(ry(T,P,!0),null!==n&&(Kl(r,n,P),null!==T.classes&&vp(r,n,T.classes),null!==T.styles&&Xd(r,n,T.styles)));const z=i.createRenderer(n,t),H=sm(e,v0(t),null,t.onPush?32:16,e[22],T,i,z,a||null,null,null);return p.firstCreatePass&&(Mr(Ea(T,e),p,t.type),Tw(p,T),Cw(T,e.length,1)),Op(e,H),e[22]=H}(H,this.componentDef,fe,y,P);if(H)if(i)Kl(P,H,["ng-version",H1.full]);else{const{attrs:tn,classes:Nt}=function Gv(n){const t=[],e=[];let i=1,r=2;for(;i<n.length;){let a=n[i];if("string"==typeof a)2===r?""!==a&&t.push(a,n[++i]):8===r&&e.push(a);else{if(!Za(r))break;r=a}i++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);tn&&Kl(P,H,tn),Nt&&Nt.length>0&&vp(P,H,Nt.join(" "))}if(We=kf(oe,22),void 0!==e){const tn=We.projection=[];for(let Nt=0;Nt<this.ngContentSelectors.length;Nt++){const un=e[Nt];tn.push(null!=un?Array.from(un):null)}}Ae=function Ow(n,t,e,i){const r=e[1],a=function xw(n,t,e){const i=_s();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),S0(n,i,t,ih(n,t,1,null),e),ey(n,i));const r=$a(t,n,i.directiveStart,i);Eo(r,t);const a=Da(i,t);return a&&Eo(a,t),r}(r,e,t);if(n[8]=e[8]=a,null!==i)for(const y of i)y(a,t);if(t.contentQueries){const y=_s();t.contentQueries(1,a,y.directiveStart)}const p=_s();return!r.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(Al(p.index),Xg(e[1],p,0,p.directiveStart,p.directiveEnd,t),Sw(t,a)),a}(ot,this.componentDef,fe,[Fw]),am(oe,fe,null)}finally{ng()}return new Pw(this.componentType,Ae,em(We,fe),fe,We)}}class Pw extends class Lg{}{constructor(t,e,i,r,a){super(),this.location=i,this._rootLView=r,this._tNode=a,this.instance=e,this.hostView=this.changeDetectorRef=new Mw(r),this.componentType=t}setInput(t,e){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[t])){const a=this._rootLView;Fp(a[1],a,r,t,e),Wg(a,this._tNode.index)}}get injector(){return new Ql(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function Fw(){const n=_s();na(mn()[1],n)}function zn(n){let t=function td(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let r;if(vi(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new ln(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);const p=n;p.inputs=R0(n.inputs),p.declaredInputs=R0(n.declaredInputs),p.outputs=R0(n.outputs);const y=r.hostBindings;y&&ND(n,y);const T=r.viewQuery,P=r.contentQueries;if(T&&sy(n,T),P&&FD(n,P),gd(n.inputs,r.inputs),gd(n.declaredInputs,r.declaredInputs),gd(n.outputs,r.outputs),vi(r)&&r.data.animation){const z=n.data;z.animation=(z.animation||[]).concat(r.data.animation)}}const a=r.features;if(a)for(let p=0;p<a.length;p++){const y=a[p];y&&y.ngInherit&&y(n),y===zn&&(e=!1)}}t=Object.getPrototypeOf(t)}!function OD(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=hl(r.hostAttrs,e=hl(e,r.hostAttrs))}}(i)}function R0(n){return n===bd?{}:n===Or?[]:n}function sy(n,t){const e=n.viewQuery;n.viewQuery=e?(i,r)=>{t(i,r),e(i,r)}:t}function FD(n,t){const e=n.contentQueries;n.contentQueries=e?(i,r,a)=>{t(i,r,a),e(i,r,a)}:t}function ND(n,t){const e=n.hostBindings;n.hostBindings=e?(i,r)=>{t(i,r),e(i,r)}:t}let ay=null;function Bp(){if(!ay){const n=To.Symbol;if(n&&n.iterator)ay=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(ay=i)}}}return ay}function Kg(n){return!!k0(n)&&(Array.isArray(n)||!(n instanceof Map)&&Bp()in n)}function k0(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function _l(n,t,e){return n[t]=e}function ga(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function oh(n,t,e,i){const r=ga(n,t,e);return ga(n,t+1,i)||r}function Yn(n,t,e,i){const r=mn();return ga(r,Kc(),t)&&(Fr(),Ec(gr(),r,n,t,e,i)),Yn}function cm(n,t,e,i){return ga(n,Kc(),e)?t+Ln(e)+i:sr}function Ic(n,t,e,i,r,a,p,y,T,P,z,H){const J=dl();let oe=function Nl(n,t,e,i,r,a){const p=oh(n,t,e,i);return oh(n,t+2,r,a)||p}(n,J,e,r,p,T);return oe=ga(n,J+4,z)||oe,Yl(5),oe?t+Ln(e)+i+Ln(r)+a+Ln(p)+y+Ln(T)+P+Ln(z)+H:sr}function Ct(n,t,e,i,r,a,p,y){const T=mn(),P=Fr(),z=n+22,H=P.firstCreatePass?function ac(n,t,e,i,r,a,p,y,T){const P=t.consts,z=nh(t,n,4,p||null,gc(P,y));ty(t,e,z,gc(P,T)),na(t,z);const H=z.tViews=Qb(2,z,i,r,a,t.directiveRegistry,t.pipeRegistry,null,t.schemas,P);return null!==t.queries&&(t.queries.template(t,z),H.queries=t.queries.embeddedTView(z)),z}(z,P,T,t,e,i,r,a,p):P.data[z];Zl(H,!1);const J=T[11].createComment("");vg(P,T,J,H),Eo(J,T),Op(T,T[z]=C0(J,T,J,H)),Ml(H)&&Jb(P,T,H),null!=p&&y0(T,H,y)}function Oa(n){return Mu(function Of(){return Hi.lFrame.contextLView}(),22+n)}function Ve(n,t,e){const i=mn();return ga(i,Kc(),t)&&gl(Fr(),gr(),i,n,t,i[11],e,!1),Ve}function Qg(n,t,e,i,r){const p=r?"class":"style";Fp(n,e,t.inputs[p],p,i)}function ae(n,t,e,i){const r=mn(),a=Fr(),p=22+n,y=r[11],T=r[p]=bg(y,t,function og(){return Hi.lFrame.currentNamespace}()),P=a.firstCreatePass?function GD(n,t,e,i,r,a,p){const y=t.consts,P=nh(t,n,2,r,gc(y,a));return ty(t,e,P,gc(y,p)),null!==P.attrs&&ry(P,P.attrs,!1),null!==P.mergedAttrs&&ry(P,P.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,P),P}(p,a,r,0,t,e,i):a.data[p];Zl(P,!0);const z=P.mergedAttrs;null!==z&&Kl(y,T,z);const H=P.classes;null!==H&&vp(y,T,H);const J=P.styles;return null!==J&&Xd(y,T,J),64!=(64&P.flags)&&vg(a,r,T,P),0===function _c(){return Hi.lFrame.elementDepthCount}()&&Eo(T,r),function Lf(){Hi.lFrame.elementDepthCount++}(),Ml(P)&&(Jb(a,r,P),$g(a,P,r)),null!==i&&y0(r,P),ae}function de(){let n=_s();Yh()?Rd():(n=n.parent,Zl(n,!1));const t=n;!function Ru(){Hi.lFrame.elementDepthCount--}();const e=Fr();return e.firstCreatePass&&(na(e,n),Sd(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function Nd(n){return 0!=(16&n.flags)}(t)&&Qg(e,t,mn(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Wr(n){return 0!=(32&n.flags)}(t)&&Qg(e,t,mn(),t.stylesWithoutHost,!1),de}function dn(n,t,e,i){return ae(n,t,e,i),de(),dn}function Uo(n,t,e){const i=mn(),r=Fr(),a=n+22,p=r.firstCreatePass?function e_(n,t,e,i,r){const a=t.consts,p=gc(a,i),y=nh(t,n,8,"ng-container",p);return null!==p&&ry(y,p,!0),ty(t,e,y,gc(a,r)),null!==t.queries&&t.queries.elementStart(t,y),y}(a,r,i,t,e):r.data[a];Zl(p,!0);const y=i[a]=i[11].createComment("");return vg(r,i,y,p),Eo(y,i),Ml(p)&&(Jb(r,i,p),$g(r,p,i)),null!=e&&y0(i,p),Uo}function Zo(){let n=_s();const t=Fr();return Yh()?Rd():(n=n.parent,Zl(n,!1)),t.firstCreatePass&&(na(t,n),Sd(n)&&t.queries.elementEnd(n)),Zo}function ys(n,t,e){return Uo(n,t,e),Zo(),ys}function Zr(){return mn()}function Ya(n){return!!n&&"function"==typeof n.then}function Up(n){return!!n&&"function"==typeof n.subscribe}const t_=Up;function Zt(n,t,e,i){const r=mn(),a=Fr(),p=_s();return n_(a,r,r[11],p,n,t,0,i),Zt}function dm(n,t){const e=_s(),i=mn(),r=Fr();return n_(r,i,M0(bc(r.data),e,i),e,n,t),dm}function n_(n,t,e,i,r,a,p,y){const T=Ml(i),z=n.firstCreatePass&&I0(n),H=t[8],J=E0(t);let oe=!0;if(3&i.type||y){const We=Da(i,t),ot=y?y(We):We,tn=J.length,Nt=y?Zn=>y(rs(Zn[i.index])):i.index;let un=null;if(!y&&T&&(un=function Hw(n,t,e,i){const r=n.cleanup;if(null!=r)for(let a=0;a<r.length-1;a+=2){const p=r[a];if(p===e&&r[a+1]===i){const y=t[7],T=r[a+2];return y.length>T?y[T]:null}"string"==typeof p&&(a+=2)}return null}(n,t,r,i.index)),null!==un)(un.__ngLastListenerFn__||un).__ngNextListenerFn__=a,un.__ngLastListenerFn__=a,oe=!1;else{a=hm(i,t,H,a,!1);const Zn=e.listen(ot,r,a);J.push(a,Zn),z&&z.push(r,Nt,tn,tn+1)}}else a=hm(i,t,H,a,!1);const fe=i.outputs;let Ae;if(oe&&null!==fe&&(Ae=fe[r])){const We=Ae.length;if(We)for(let ot=0;ot<We;ot+=2){const ci=t[Ae[ot]][Ae[ot+1]].subscribe(a),Fi=J.length;J.push(a,ci),z&&z.push(r,i.index,Fi,-(Fi+1))}}}function Gw(n,t,e,i){try{return!1!==e(i)}catch(r){return Yg(n,r),!1}}function hm(n,t,e,i,r){return function a(p){if(p===Function)return i;Zg(2&n.flags?pa(n.index,t):t);let T=Gw(t,0,i,p),P=a.__ngNextListenerFn__;for(;P;)T=Gw(t,0,P,p)&&T,P=P.__ngNextListenerFn__;return r&&!1===T&&(p.preventDefault(),p.returnValue=!1),T}}function Ot(n=1){return function ig(n){return(Hi.lFrame.contextLView=function Qh(n,t){for(;n>0;)t=t[15],n--;return t}(n,Hi.lFrame.contextLView))[8]}(n)}function P0(n,t){let e=null;const i=function Z1(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(n);for(let r=0;r<t.length;r++){const a=t[r];if("*"!==a){if(null===i?X1(n,a,!0):Hv(i,a))return r}else e=r}return e}function ss(n){const t=mn()[16][6];if(!t.projection){const i=t.projection=Gd(n?n.length:1,null),r=i.slice();let a=t.child;for(;null!==a;){const p=n?P0(a,n):0;null!==p&&(r[p]?r[p].projectionNext=a:i[p]=a,r[p]=a),a=a.next}}}function Yr(n,t=0,e){const i=mn(),r=Fr(),a=nh(r,22+n,16,null,e||null);null===a.projection&&(a.projection=t),Rd(),64!=(64&a.flags)&&function HC(n,t,e){u1(t[11],0,t,e,l1(n,e,t),vv(e.parent||t[6],e,t))}(r,i,a)}function Qo(n,t,e){return dy(n,"",t,"",e),Qo}function dy(n,t,e,i,r){const a=mn(),p=cm(a,t,e,i);return p!==sr&&gl(Fr(),gr(),a,n,p,a[11],r,!1),dy}function Xw(n,t,e,i,r){const a=n[e+1],p=null===t;let y=i?rc(a):La(a),T=!1;for(;0!==y&&(!1===T||p);){const z=n[y+1];$D(n[y],t)&&(T=!0,n[y+1]=i?im(z):Rp(z)),y=i?rc(z):La(z)}T&&(n[e+1]=i?Rp(a):im(a))}function $D(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&Vu(n,t)>=0}function o(n,t,e){return S(n,t,e,!1),o}function l(n,t){return S(n,t,null,!0),l}function S(n,t,e,i){const r=mn(),a=Fr(),p=Yl(2);a.firstUpdatePass&&function x(n,t,e,i){const r=n.data;if(null===r[e+1]){const a=r[bs()],p=function R(n,t){return t>=n.expandoStartIndex}(n,e);(function ve(n,t){return 0!=(n.flags&(t?16:32))})(a,i)&&null===t&&!p&&(t=!1),t=function I(n,t,e,i){const r=bc(n);let a=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(e=N(e=L(null,n,t,e,i),t.attrs,i),a=null);else{const p=t.directiveStylingLast;if(-1===p||n[p]!==r)if(e=L(r,n,t,e,i),null===a){let T=function A(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==La(i))return n[rc(i)]}(n,t,i);void 0!==T&&Array.isArray(T)&&(T=L(null,n,t,T[1],i),T=N(T,t.attrs,i),function D(n,t,e,i){n[rc(e?t.classBindings:t.styleBindings)]=i}(n,t,i,T))}else a=function M(n,t,e){let i;const r=t.directiveEnd;for(let a=1+t.directiveStylingLast;a<r;a++)i=N(i,n[a].hostAttrs,e);return N(i,t.attrs,e)}(n,t,i)}return void 0!==a&&(i?t.residualClasses=a:t.residualStyles=a),e}(r,a,t,i),function Ww(n,t,e,i,r,a){let p=a?t.classBindings:t.styleBindings,y=rc(p),T=La(p);n[i]=e;let z,P=!1;if(Array.isArray(e)){const H=e;z=H[1],(null===z||Vu(H,z)>0)&&(P=!0)}else z=e;if(r)if(0!==T){const J=rc(n[y+1]);n[i+1]=Hb(J,y),0!==J&&(n[J+1]=qb(n[J+1],i)),n[y+1]=function yD(n,t){return 131071&n|t<<17}(n[y+1],i)}else n[i+1]=Hb(y,0),0!==y&&(n[y+1]=qb(n[y+1],i)),y=i;else n[i+1]=Hb(T,0),0===y?y=i:n[T+1]=qb(n[T+1],i),T=i;P&&(n[i+1]=Rp(n[i+1])),Xw(n,z,i,!0),Xw(n,z,i,!1),function qD(n,t,e,i,r){const a=r?n.residualClasses:n.residualStyles;null!=a&&"string"==typeof t&&Vu(a,t)>=0&&(e[i+1]=im(e[i+1]))}(t,z,n,i,a),p=Hb(y,T),a?t.classBindings=p:t.styleBindings=p}(r,a,t,e,p,i)}}(a,n,p,i),t!==sr&&ga(r,p,t)&&function U(n,t,e,i,r,a,p,y){if(!(3&t.type))return;const T=n.data,P=T[y+1];Y(function r0(n){return 1==(1&n)}(P)?Z(T,t,e,r,La(P),p):void 0)||(Y(a)||function Gb(n){return 2==(2&n)}(P)&&(a=Z(T,null,e,r,y,p)),function d1(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let a=-1===i.indexOf("-")?void 0:rn.DashCase;null==r?n.removeStyle(e,i,a):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),a|=rn.Important),n.setStyle(e,i,r,a))}}(i,p,Wh(bs(),e),r,a))}(a,a.data[bs()],r,r[11],n,r[p+1]=function se(n,t){return null==n||("string"==typeof t?n+=t:"object"==typeof n&&(n=vo(Pa(n)))),n}(t,e),i,p)}function L(n,t,e,i,r){let a=null;const p=e.directiveEnd;let y=e.directiveStylingLast;for(-1===y?y=e.directiveStart:y++;y<p&&(a=t[y],i=N(i,a.hostAttrs,r),a!==n);)y++;return null!==n&&(e.directiveStylingLast=y),i}function N(n,t,e){const i=e?1:2;let r=-1;if(null!==t)for(let a=0;a<t.length;a++){const p=t[a];"number"==typeof p?r=p:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Wa(n,p,!!e||t[++a]))}return void 0===n?null:n}function Z(n,t,e,i,r,a){const p=null===t;let y;for(;r>0;){const T=n[r],P=Array.isArray(T),z=P?T[1]:T,H=null===z;let J=e[r+1];J===sr&&(J=H?Or:void 0);let oe=H?zu(J,i):z===i?J:void 0;if(P&&!Y(oe)&&(oe=zu(T,i)),Y(oe)&&(y=oe,p))return y;const fe=n[r+1];r=p?rc(fe):La(fe)}if(null!==t){let T=a?t.residualClasses:t.residualStyles;null!=T&&(y=zu(T,i))}return y}function Y(n){return void 0!==n}function W(n,t=""){const e=mn(),i=Fr(),r=n+22,a=i.firstCreatePass?nh(i,r,1,t,null):i.data[r],p=e[r]=function cb(n,t){return n.createText(t)}(e[11],t);vg(i,e,p,a),Zl(a,!1)}function ce(n){return Se("",n,""),ce}function Se(n,t,e){const i=mn(),r=cm(i,n,t,e);return r!==sr&&Qu(i,bs(),r),Se}function me(n,t,e,i,r){const a=mn(),p=function um(n,t,e,i,r,a){const y=oh(n,dl(),e,r);return Yl(2),y?t+Ln(e)+i+Ln(r)+a:sr}(a,n,t,e,i,r);return p!==sr&&Qu(a,bs(),p),me}function ze(n,t,e,i,r,a,p,y,T,P,z){const H=mn(),J=Ic(H,n,t,e,i,r,a,p,y,T,P,z);return J!==sr&&Qu(H,bs(),J),ze}function Jr(n,t,e){const i=mn();return ga(i,Kc(),t)&&gl(Fr(),gr(),i,n,t,i[11],e,!0),Jr}function as(n,t,e){const i=mn();if(ga(i,Kc(),t)){const a=Fr(),p=gr();gl(a,p,i,n,t,M0(bc(a.data),p,i),e,!0)}return as}const _r=void 0;var Mc=["en",[["a","p"],["AM","PM"],_r],[["AM","PM"],_r,_r],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],_r,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],_r,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",_r,"{1} 'at' {0}",_r],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Ka(n){const e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let _a={};function vs(n){const t=function eS(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=fm(t);if(e)return e;const i=t.split("-")[0];if(e=fm(i),e)return e;if("en"===i)return Mc;throw new ln(701,!1)}function fm(n){return n in _a||(_a[n]=To.ng&&To.ng.common&&To.ng.common.locales&&To.ng.common.locales[n]),_a[n]}var Kn=(()=>((Kn=Kn||{})[Kn.LocaleId=0]="LocaleId",Kn[Kn.DayPeriodsFormat=1]="DayPeriodsFormat",Kn[Kn.DayPeriodsStandalone=2]="DayPeriodsStandalone",Kn[Kn.DaysFormat=3]="DaysFormat",Kn[Kn.DaysStandalone=4]="DaysStandalone",Kn[Kn.MonthsFormat=5]="MonthsFormat",Kn[Kn.MonthsStandalone=6]="MonthsStandalone",Kn[Kn.Eras=7]="Eras",Kn[Kn.FirstDayOfWeek=8]="FirstDayOfWeek",Kn[Kn.WeekendRange=9]="WeekendRange",Kn[Kn.DateFormat=10]="DateFormat",Kn[Kn.TimeFormat=11]="TimeFormat",Kn[Kn.DateTimeFormat=12]="DateTimeFormat",Kn[Kn.NumberSymbols=13]="NumberSymbols",Kn[Kn.NumberFormats=14]="NumberFormats",Kn[Kn.CurrencyCode=15]="CurrencyCode",Kn[Kn.CurrencySymbol=16]="CurrencySymbol",Kn[Kn.CurrencyName=17]="CurrencyName",Kn[Kn.Currencies=18]="Currencies",Kn[Kn.Directionality=19]="Directionality",Kn[Kn.PluralCase=20]="PluralCase",Kn[Kn.ExtraData=21]="ExtraData",Kn))();const Gp="en-US";let py=Gp;function KD(n,t,e,i,r){if(n=Pi(n),Array.isArray(n))for(let a=0;a<n.length;a++)KD(n[a],t,e,i,r);else{const a=Fr(),p=mn();let y=Yd(n)?n:Pi(n.provide),T=Fv(n);const P=_s(),z=1048575&P.providerIndexes,H=P.directiveStart,J=P.providerIndexes>>20;if(Yd(n)||!n.multi){const oe=new tp(T,r,le),fe=QD(y,t,r?z:z+J,H);-1===fe?(Mr(Ea(P,p),a,y),JD(a,n,t.length),t.push(y),P.directiveStart++,P.directiveEnd++,r&&(P.providerIndexes+=1048576),e.push(oe),p.push(oe)):(e[fe]=oe,p[fe]=oe)}else{const oe=QD(y,t,z+J,H),fe=QD(y,t,z,z+J),Ae=oe>=0&&e[oe],We=fe>=0&&e[fe];if(r&&!We||!r&&!Ae){Mr(Ea(P,p),a,y);const ot=function xz(n,t,e,i,r){const a=new tp(n,e,le);return a.multi=[],a.index=t,a.componentProviders=0,VR(a,r,i&&!e),a}(r?vz:yz,e.length,r,i,T);!r&&We&&(e[fe].providerFactory=ot),JD(a,n,t.length,0),t.push(y),P.directiveStart++,P.directiveEnd++,r&&(P.providerIndexes+=1048576),e.push(ot),p.push(ot)}else JD(a,n,oe>-1?oe:fe,VR(e[r?fe:oe],T,!r&&i));!r&&i&&We&&e[fe].componentProviders++}}}function JD(n,t,e,i){const r=Yd(t),a=function L1(n){return!!n.useClass}(t);if(r||a){const T=(a?Pi(t.useClass):t).prototype.ngOnDestroy;if(T){const P=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){const z=P.indexOf(e);-1===z?P.push(e,[i,T]):P[z+1].push(i,T)}else P.push(e,T)}}}function VR(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function QD(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function yz(n,t,e,i){return eE(this.multi,[])}function vz(n,t,e,i){const r=this.multi;let a;if(this.providerFactory){const p=this.providerFactory.componentProviders,y=$a(e,e[1],this.providerFactory.index,i);a=y.slice(0,p),eE(r,a);for(let T=p;T<y.length;T++)a.push(y[T])}else a=[],eE(r,a);return a}function eE(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function wi(n,t=[]){return e=>{e.providersResolver=(i,r)=>function bz(n,t,e){const i=Fr();if(i.firstCreatePass){const r=vi(n);KD(e,i.data,i.blueprint,r,!0),KD(t,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,t)}}class i_{}class jR{}class UR extends i_{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new A0(this);const i=Ds(t);this._bootstrapComponents=Zu(i.bootstrap),this._r3Injector=Wv(t,e,[{provide:i_,useValue:this},{provide:Dp,useValue:this.componentFactoryResolver}],vo(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class tE extends jR{constructor(t){super(),this.moduleType=t}create(t){return new UR(this.moduleType,t)}}class Sz extends i_{constructor(t,e,i){super(),this.componentFactoryResolver=new A0(this),this.instance=null;const r=new O1([...t,{provide:i_,useValue:this},{provide:Dp,useValue:this.componentFactoryResolver}],e||Tp(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function aS(n,t,e=null){return new Sz(n,t,e).injector}let Tz=(()=>{class n{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e.id)){const i=P1(0,e.type),r=i.length>0?aS([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e.id,r)}return this.cachedInjectors.get(e.id)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=vn({token:n,providedIn:"environment",factory:()=>new n(mt(Wu))}),n})();function HR(n){n.getStandaloneInjector=t=>t.get(Tz).getOrCreateStandaloneInjector(n)}function lS(n,t,e,i){return KR(mn(),Es(),n,t,e,i)}function YR(n,t,e,i,r){return function JR(n,t,e,i,r,a,p){const y=t+e;return oh(n,y,r,a)?_l(n,y+2,p?i.call(p,r,a):i(r,a)):Z0(n,y+2)}(mn(),Es(),n,t,e,i,r)}function Z0(n,t){const e=n[t];return e===sr?void 0:e}function KR(n,t,e,i,r,a){const p=t+e;return ga(n,p,r)?_l(n,p+1,a?i.call(a,r):i(r)):Z0(n,p+1)}function gy(n,t){const e=Fr();let i;const r=n+22;e.firstCreatePass?(i=function jz(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(r,i.onDestroy)):i=e.data[r];const a=i.factory||(i.factory=Xc(i.type)),p=Cs(le);try{const y=Vd(!1),T=a();return Vd(y),function Uw(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,mn(),r,T),T}finally{Cs(p)}}function _y(n,t,e){const i=n+22,r=mn(),a=Mu(r,i);return function Y0(n,t){return n[1].data[t].pure}(r,i)?KR(r,Es(),t,a.transform,e,a):a.transform(e)}function iE(n){return t=>{setTimeout(n,void 0,t)}}const Cn=class $z extends fn{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var r,a,p;let y=t,T=e||(()=>null),P=i;if(t&&"object"==typeof t){const H=t;y=null===(r=H.next)||void 0===r?void 0:r.bind(H),T=null===(a=H.error)||void 0===a?void 0:a.bind(H),P=null===(p=H.complete)||void 0===p?void 0:p.bind(H)}this.__isAsync&&(T=iE(T),y&&(y=iE(y)),P&&(P=iE(P)));const z=super.subscribe({next:y,error:T,complete:P});return t instanceof Qe&&t.add(z),z}};function Wz(){return this._results[Bp()]()}class r_{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Bp(),i=r_.prototype;i[e]||(i[e]=Wz)}get changes(){return this._changes||(this._changes=new Cn)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const r=ia(t);(this._changesDetected=!function rb(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],a=t[i];if(e&&(r=e(r),a=e(a)),a!==r)return!1}return!0}(i._results,r,e))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Yo=(()=>{class n{}return n.__NG_ELEMENT_ID__=Yz,n})();const Xz=Yo,Zz=class extends Xz{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t,e){const i=this._declarationTContainer.tViews,r=sm(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,e||null);r[17]=this._declarationLView[this._declarationTContainer.index];const p=this._declarationLView[19];return null!==p&&(r[19]=p.createEmbeddedView(i)),am(i,r,t),new ed(r)}};function Yz(){return cS(_s(),mn())}function cS(n,t){return 4&n.type?new Zz(t,n,em(n,t)):null}let Rs=(()=>{class n{}return n.__NG_ELEMENT_ID__=Kz,n})();function Kz(){return o2(_s(),mn())}const Jz=Rs,n2=class extends Jz{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return em(this._hostTNode,this._hostLView)}get injector(){return new Ql(this._hostTNode,this._hostLView)}get parentInjector(){const t=Qc(this._hostTNode,this._hostLView);if(pl(t)){const e=Fu(t,this._hostLView),i=Bd(t);return new Ql(e[1].data[i+8],e)}return new Ql(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=r2(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){let r,a;"number"==typeof i?r=i:null!=i&&(r=i.index,a=i.injector);const p=t.createEmbeddedView(e||{},a);return this.insert(p,r),p}createComponent(t,e,i,r,a){const p=t&&!function Hd(n){return"function"==typeof n}(t);let y;if(p)y=e;else{const H=e||{};y=H.index,i=H.injector,r=H.projectableNodes,a=H.environmentInjector||H.ngModuleRef}const T=p?t:new Np(Ir(t)),P=i||this.parentInjector;if(!a&&null==T.ngModule){const J=(p?P:this.parentInjector).get(Wu,null);J&&(a=J)}const z=T.create(P,r,void 0,a);return this.insert(z.hostView,y),z}insert(t,e){const i=t._lView,r=i[1];if(function Ad(n){return ha(n[3])}(i)){const z=this.indexOf(t);if(-1!==z)this.detach(z);else{const H=i[3],J=new n2(H,H[6],H[3]);J.detach(J.indexOf(t))}}const a=this._adjustIndex(e),p=this._lContainer;!function fv(n,t,e,i){const r=10+i,a=e.length;i>0&&(e[r-1][4]=t),i<a-10?(t[4]=e[r],pg(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const p=t[17];null!==p&&e!==p&&function mv(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(p,t);const y=t[19];null!==y&&y.insertView(n),t[2]|=64}(r,i,p,a);const y=ou(a,p),T=i[11],P=mb(T,p[7]);return null!==P&&function db(n,t,e,i,r,a){i[0]=r,i[6]=t,qu(n,i,e,1,r,a)}(r,p[6],T,i,P,y),t.attachToViewContainerRef(),pg(rE(p),a,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=r2(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=pb(this._lContainer,e);i&&(up(rE(this._lContainer),e),Gu(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=pb(this._lContainer,e);return i&&null!=up(rE(this._lContainer),e)?new ed(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function r2(n){return n[8]}function rE(n){return n[8]||(n[8]=[])}function o2(n,t){let e;const i=t[n.index];if(ha(i))e=i;else{let r;if(8&n.type)r=rs(i);else{const a=t[11];r=a.createComment("");const p=Da(n,t);yp(a,mb(a,p),r,function UC(n,t){return n.nextSibling(t)}(a,p),!1)}t[n.index]=e=C0(i,t,r,n),Op(t,e)}return new n2(e,n,t)}class oE{constructor(t){this.queryList=t,this.matches=null}clone(){return new oE(this.queryList)}setDirty(){this.queryList.setDirty()}}class sE{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let a=0;a<i;a++){const p=e.getByIndex(a);r.push(this.queries[p.indexInDeclarationView].clone())}return new sE(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==u2(t,e).matches&&this.queries[e].setDirty()}}class s2{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class aE{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,a=this.getByIndex(i).embeddedTView(t,r);a&&(a.indexInDeclarationView=i,null!==e?e.push(a):e=[a])}return null!==e?new aE(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class lE{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new lE(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const a=i[r];this.matchTNodeWithReadOption(t,e,t4(e,a)),this.matchTNodeWithReadOption(t,e,eu(e,t,a,!1,!1))}else i===Yo?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,eu(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===ei||r===Rs||r===Yo&&4&e.type)this.addMatch(e.index,-2);else{const a=eu(e,t,r,!1,!1);null!==a&&this.addMatch(e.index,a)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function t4(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function r4(n,t,e,i){return-1===e?function n4(n,t){return 11&n.type?em(n,t):4&n.type?cS(n,t):null}(t,n):-2===e?function o4(n,t,e){return e===ei?em(t,n):e===Yo?cS(t,n):e===Rs?o2(t,n):void 0}(n,t,i):$a(n,n[1],e,t)}function a2(n,t,e,i){const r=t[19].queries[i];if(null===r.matches){const a=n.data,p=e.matches,y=[];for(let T=0;T<p.length;T+=2){const P=p[T];y.push(P<0?null:r4(t,a[P],p[T+1],e.metadata.read))}r.matches=y}return r.matches}function cE(n,t,e,i){const r=n.queries.getByIndex(e),a=r.matches;if(null!==a){const p=a2(n,t,r,e);for(let y=0;y<a.length;y+=2){const T=a[y];if(T>0)i.push(p[y/2]);else{const P=a[y+1],z=t[-T];for(let H=10;H<z.length;H++){const J=z[H];J[17]===J[3]&&cE(J[1],J,P,i)}if(null!==z[9]){const H=z[9];for(let J=0;J<H.length;J++){const oe=H[J];cE(oe[1],oe,P,i)}}}}}return i}function _i(n){const t=mn(),e=Fr(),i=yc();Pn(i+1);const r=u2(e,i);if(n.dirty&&function Xh(n){return 4==(4&n[2])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const a=r.crossesNgTemplate?cE(e,t,i,[]):a2(e,t,r,i);n.reset(a,U1),n.notifyOnChanges()}return!0}return!1}function io(n,t,e){const i=Fr();i.firstCreatePass&&(c2(i,new s2(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),l2(i,mn(),t)}function Ro(n,t,e,i){const r=Fr();if(r.firstCreatePass){const a=_s();c2(r,new s2(t,e,i),a.index),function a4(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(r,n),2==(2&e)&&(r.staticContentQueries=!0)}l2(r,mn(),e)}function bi(){return function s4(n,t){return n[19].queries[t].queryList}(mn(),yc())}function l2(n,t,e){const i=new r_(4==(4&e));x0(n,t,i,i.destroy),null===t[19]&&(t[19]=new sE),t[19].queries.push(new oE(i))}function c2(n,t,e){null===n.queries&&(n.queries=new aE),n.queries.track(new lE(t,e))}function u2(n,t){return n.queries.getByIndex(t)}function qp(n,t){return cS(n,t)}function dS(...n){}const hS=new Qt("Application Initializer");let pS=(()=>{class n{constructor(e){this.appInits=e,this.resolve=dS,this.reject=dS,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const a=this.appInits[r]();if(Ya(a))e.push(a);else if(t_(a)){const p=new Promise((y,T)=>{a.subscribe({complete:y,error:T})});e.push(p)}}Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(mt(hS,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const vy=new Qt("AppId",{providedIn:"root",factory:function M2(){return`${fE()}${fE()}${fE()}`}});function fE(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const A2=new Qt("Platform Initializer"),fS=new Qt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),R2=new Qt("appBootstrapListener"),ch=new Qt("AnimationModuleType");let E4=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const kc=new Qt("LocaleId",{providedIn:"root",factory:()=>Oo(kc,hi.Optional|hi.SkipSelf)||function I4(){return"undefined"!=typeof $localize&&$localize.locale||Gp}()});class A4{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let mE=(()=>{class n{compileModuleSync(e){return new tE(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),a=Zu(Ds(e).declarations).reduce((p,y)=>{const T=Ir(y);return T&&p.push(new Np(T)),p},[]);return new A4(i,a)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const P4=(()=>Promise.resolve(0))();function gE(n){"undefined"==typeof Zone?P4.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Oi{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Cn(!1),this.onMicrotaskEmpty=new Cn(!1),this.onStable=new Cn(!1),this.onError=new Cn(!1),"undefined"==typeof Zone)throw new ln(908,!1);Zone.assertZonePatched();const r=this;if(r._nesting=0,r._outer=r._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const a=Zone.AsyncStackTaggingZoneSpec;r._inner=r._inner.fork(new a("Angular"))}Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&e,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function L4(){let n=To.requestAnimationFrame,t=To.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function N4(n){const t=()=>{!function F4(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(To,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,bE(n),n.isCheckStableRunning=!0,_E(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),bE(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,r,a,p,y)=>{try{return L2(n),e.invokeTask(r,a,p,y)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===a.type||n.shouldCoalesceRunChangeDetection)&&t(),O2(n)}},onInvoke:(e,i,r,a,p,y,T)=>{try{return L2(n),e.invoke(r,a,p,y,T)}finally{n.shouldCoalesceRunChangeDetection&&t(),O2(n)}},onHasTask:(e,i,r,a)=>{e.hasTask(r,a),i===r&&("microTask"==a.change?(n._hasPendingMicrotasks=a.microTask,bE(n),_E(n)):"macroTask"==a.change&&(n.hasPendingMacrotasks=a.macroTask))},onHandleError:(e,i,r,a)=>(e.handleError(r,a),n.runOutsideAngular(()=>n.onError.emit(a)),!1)})}(r)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Oi.isInAngularZone())throw new ln(909,!1)}static assertNotInAngularZone(){if(Oi.isInAngularZone())throw new ln(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){const a=this._inner,p=a.scheduleEventTask("NgZoneEvent: "+r,t,O4,dS,dS);try{return a.runTask(p,e,i)}finally{a.cancelTask(p)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const O4={};function _E(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function bE(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function L2(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function O2(n){n._nesting--,_E(n)}class B4{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Cn,this.onMicrotaskEmpty=new Cn,this.onStable=new Cn,this.onError=new Cn}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}}const F2=new Qt(""),mS=new Qt("");let J0,yE=(()=>{class n{constructor(e,i,r){this._ngZone=e,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,J0||(function z4(n){J0=n}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Oi.assertNotInAngularZone(),gE(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())gE(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let a=-1;i&&i>0&&(a=setTimeout(()=>{this._callbacks=this._callbacks.filter(p=>p.timeoutId!==a),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:a,updateCb:r})}whenStable(e,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}}return n.\u0275fac=function(e){return new(e||n)(mt(Oi),mt(vE),mt(mS))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),vE=(()=>{class n{constructor(){this._applications=new Map}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){var r;return null!==(r=null==J0?void 0:J0.findTestabilityInTree(this,e,i))&&void 0!==r?r:null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),uh=null;const N2=new Qt("AllowMultipleToken"),xE=new Qt("PlatformDestroyListeners");class B2{constructor(t,e){this.name=t,this.token=e}}function V2(n,t,e=[]){const i=`Platform: ${t}`,r=new Qt(i);return(a=[])=>{let p=wE();if(!p||p.injector.get(N2,!1)){const y=[...e,...a,{provide:r,useValue:!0}];n?n(y):function U4(n){if(uh&&!uh.get(N2,!1))throw new ln(400,!1);uh=n;const t=n.get(U2);(function z2(n){const t=n.get(A2,null);t&&t.forEach(e=>e())})(n)}(function j2(n=[],t){return jo.create({name:t,providers:[{provide:Mb,useValue:"platform"},{provide:xE,useValue:new Set([()=>uh=null])},...n]})}(y,i))}return function G4(n){const t=wE();if(!t)throw new ln(401,!1);return t}()}}function wE(){var n;return null!==(n=null==uh?void 0:uh.get(U2))&&void 0!==n?n:null}let U2=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const r=function G2(n,t){let e;return e="noop"===n?new B4:("zone.js"===n?void 0:n)||new Oi(t),e}(null==i?void 0:i.ngZone,function H2(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),a=[{provide:Oi,useValue:r}];return r.run(()=>{const p=jo.create({providers:a,parent:this.injector,name:e.moduleType.name}),y=e.create(p),T=y.injector.get(Xu,null);if(!T)throw new ln(402,!1);return r.runOutsideAngular(()=>{const P=r.onError.subscribe({next:z=>{T.handleError(z)}});y.onDestroy(()=>{gS(this._modules,y),P.unsubscribe()})}),function q2(n,t,e){try{const i=e();return Ya(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(T,r,()=>{const P=y.injector.get(pS);return P.runInitializers(),P.donePromise.then(()=>(function fy(n){Ss(n,"Expected localeId to be defined"),"string"==typeof n&&(py=n.toLowerCase().replace(/_/g,"-"))}(y.injector.get(kc,Gp)||Gp),this._moduleDoBootstrap(y),y))})})}bootstrapModule(e,i=[]){const r=$2({},i);return function V4(n,t,e){const i=new tE(e);return Promise.resolve(i)}(0,0,e).then(a=>this.bootstrapModuleFactory(a,r))}_moduleDoBootstrap(e){const i=e.injector.get(xy);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!e.instance.ngDoBootstrap)throw new ln(403,!1);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ln(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(xE,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(mt(jo))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function $2(n,t){return Array.isArray(t)?t.reduce($2,n):Object.assign(Object.assign({},n),t)}let xy=(()=>{class n{constructor(e,i,r){this._zone=e,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const a=new _n(y=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{y.next(this._stable),y.complete()})}),p=new _n(y=>{let T;this._zone.runOutsideAngular(()=>{T=this._zone.onStable.subscribe(()=>{Oi.assertNotInAngularZone(),gE(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,y.next(!0))})})});const P=this._zone.onUnstable.subscribe(()=>{Oi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{y.next(!1)}))});return()=>{T.unsubscribe(),P.unsubscribe()}});this.isStable=yo(a,p.pipe(xf()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const r=e instanceof Nv;if(!this._injector.get(pS).done)throw!r&&function hc(n){const t=Ir(n)||ns(n)||so(n);return null!==t&&t.standalone}(e),new ln(405,false);let p;p=r?e:this._injector.get(Dp).resolveComponentFactory(e),this.componentTypes.push(p.componentType);const y=function j4(n){return n.isBoundToModule}(p)?void 0:this._injector.get(i_),P=p.create(jo.NULL,[],i||p.selector,y),z=P.location.nativeElement,H=P.injector.get(F2,null);return null==H||H.registerApplication(z),P.onDestroy(()=>{this.detachView(P.hostView),gS(this.components,P),null==H||H.unregisterApplication(z)}),this._loadComponent(P),P}tick(){if(this._runningTick)throw new ln(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;gS(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(R2,[]).concat(this._bootstrapListeners).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>gS(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new ln(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(e){return new(e||n)(mt(Oi),mt(Wu),mt(Xu))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function gS(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let X2=!0,lo=(()=>{class n{}return n.__NG_ELEMENT_ID__=W4,n})();function W4(n){return function X4(n,t,e){if(Il(n)&&!e){const i=pa(n.index,t);return new ed(i,i)}return 47&n.type?new ed(t[16],t):null}(_s(),mn(),16==(16&n))}class Q2{constructor(){}supports(t){return Kg(t)}create(t){return new eV(t)}}const Q4=(n,t)=>t;class eV{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Q4}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,a=null;for(;e||i;){const p=!i||e&&e.currentIndex<tk(i,r,a)?e:i,y=tk(p,r,a),T=p.currentIndex;if(p===i)r--,i=i._nextRemoved;else if(e=e._next,null==p.previousIndex)r++;else{a||(a=[]);const P=y-r,z=T-r;if(P!=z){for(let J=0;J<P;J++){const oe=J<a.length?a[J]:a[J]=0,fe=oe+J;z<=fe&&fe<P&&(a[J]=oe+1)}a[p.previousIndex]=z-P}}y!==T&&t(p,y,T)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!Kg(t))throw new ln(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,a,p,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let y=0;y<this.length;y++)a=t[y],p=this._trackByFn(y,a),null!==e&&Object.is(e.trackById,p)?(i&&(e=this._verifyReinsertion(e,a,p,y)),Object.is(e.item,a)||this._addIdentityChange(e,a)):(e=this._mismatch(e,a,p,y),i=!0),e=e._next}else r=0,function UD(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Bp()]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,y=>{p=this._trackByFn(r,y),null!==e&&Object.is(e.trackById,p)?(i&&(e=this._verifyReinsertion(e,y,p,r)),Object.is(e.item,y)||this._addIdentityChange(e,y)):(e=this._mismatch(e,y,p,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let a;return null===t?a=this._itTail:(a=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,a,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,a,r)):t=this._addAfter(new tV(e,i),a,r),t}_verifyReinsertion(t,e,i,r){let a=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==a?t=this._reinsertAfter(a,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,a=t._nextRemoved;return null===r?this._removalsHead=a:r._nextRemoved=a,null===a?this._removalsTail=r:a._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new ek),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new ek),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class tV{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class nV{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class ek{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new nV,this.map.set(e,i)),i.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function tk(n,t,e){const i=n.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}class nk{constructor(){}supports(t){return t instanceof Map||k0(t)}create(){return new iV}}class iV{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||k0(t)))throw new ln(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const a=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,a)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const a=r._prev,p=r._next;return a&&(a._next=p),p&&(p._prev=a),r._next=null,r._prev=null,r}const i=new rV(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class rV{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function ik(){return new dh([new Q2])}let dh=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||ik()),deps:[[n,new g,new s]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new ln(901,!1)}}return n.\u0275prov=vn({token:n,providedIn:"root",factory:ik}),n})();function rk(){return new Q0([new nk])}let Q0=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||rk()),deps:[[n,new g,new s]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(i)return i;throw new ln(901,!1)}}return n.\u0275prov=vn({token:n,providedIn:"root",factory:rk}),n})();const aV=V2(null,"core",[]);let lV=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(mt(xy))},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({}),n})();function Wp(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let yS=null;function hh(){return yS}const Mi=new Qt("DocumentToken");let EE=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:function(){return function hV(){return mt(ok)}()},providedIn:"platform"}),n})();const pV=new Qt("Location Initialized");let ok=(()=>{class n extends EE{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return hh().getBaseHref(this._doc)}onPopState(e){const i=hh().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=hh().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,r){sk()?this._history.pushState(e,i,r):this.location.hash=r}replaceState(e,i,r){sk()?this._history.replaceState(e,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi))},n.\u0275prov=vn({token:n,factory:function(){return function fV(){return new ok(mt(Mi))}()},providedIn:"platform"}),n})();function sk(){return!!window.history.pushState}function IE(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function ak(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function Xp(n){return n&&"?"!==n[0]?"?"+n:n}let s_=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:function(){return Oo(ck)},providedIn:"root"}),n})();const lk=new Qt("appBaseHref");let ck=(()=>{class n extends s_{constructor(e,i){var r,a,p;super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=null!==(p=null!==(r=null!=i?i:this._platformLocation.getBaseHrefFromDOM())&&void 0!==r?r:null===(a=Oo(Mi).location)||void 0===a?void 0:a.origin)&&void 0!==p?p:""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return IE(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+Xp(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,a){const p=this.prepareExternalUrl(r+Xp(a));this._platformLocation.pushState(e,i,p)}replaceState(e,i,r,a){const p=this.prepareExternalUrl(r+Xp(a));this._platformLocation.replaceState(e,i,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(mt(EE),mt(lk,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),mV=(()=>{class n extends s_{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=IE(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,a){let p=this.prepareExternalUrl(r+Xp(a));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.pushState(e,i,p)}replaceState(e,i,r,a){let p=this.prepareExternalUrl(r+Xp(a));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(mt(EE),mt(lk,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),vS=(()=>{class n{constructor(e){this._subject=new Cn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._baseHref=ak(uk(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){var e;null===(e=this._urlChangeSubscription)||void 0===e||e.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+Xp(i))}normalize(e){return n.stripTrailingSlash(function _V(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,uk(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Xp(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Xp(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){var i,r;null===(r=(i=this._locationStrategy).historyGo)||void 0===r||r.call(i,e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{var i;const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(null===(i=this._urlChangeSubscription)||void 0===i||i.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i,complete:r})}}return n.normalizeQueryParams=Xp,n.joinWithSlash=IE,n.stripTrailingSlash=ak,n.\u0275fac=function(e){return new(e||n)(mt(s_))},n.\u0275prov=vn({token:n,factory:function(){return function gV(){return new vS(mt(s_))}()},providedIn:"root"}),n})();function uk(n){return n.replace(/\/index.html$/,"")}var Gs=(()=>((Gs=Gs||{})[Gs.Format=0]="Format",Gs[Gs.Standalone=1]="Standalone",Gs))(),Qr=(()=>((Qr=Qr||{})[Qr.Narrow=0]="Narrow",Qr[Qr.Abbreviated=1]="Abbreviated",Qr[Qr.Wide=2]="Wide",Qr[Qr.Short=3]="Short",Qr))(),xs=(()=>((xs=xs||{})[xs.Short=0]="Short",xs[xs.Medium=1]="Medium",xs[xs.Long=2]="Long",xs[xs.Full=3]="Full",xs))(),$i=(()=>(($i=$i||{})[$i.Decimal=0]="Decimal",$i[$i.Group=1]="Group",$i[$i.List=2]="List",$i[$i.PercentSign=3]="PercentSign",$i[$i.PlusSign=4]="PlusSign",$i[$i.MinusSign=5]="MinusSign",$i[$i.Exponential=6]="Exponential",$i[$i.SuperscriptingExponent=7]="SuperscriptingExponent",$i[$i.PerMille=8]="PerMille",$i[$i.Infinity=9]="Infinity",$i[$i.NaN=10]="NaN",$i[$i.TimeSeparator=11]="TimeSeparator",$i[$i.CurrencyDecimal=12]="CurrencyDecimal",$i[$i.CurrencyGroup=13]="CurrencyGroup",$i))();function xS(n,t){return gu(vs(n)[Kn.DateFormat],t)}function wS(n,t){return gu(vs(n)[Kn.TimeFormat],t)}function SS(n,t){return gu(vs(n)[Kn.DateTimeFormat],t)}function mu(n,t){const e=vs(n),i=e[Kn.NumberSymbols][t];if(void 0===i){if(t===$i.CurrencyDecimal)return e[Kn.NumberSymbols][$i.Decimal];if(t===$i.CurrencyGroup)return e[Kn.NumberSymbols][$i.Group]}return i}function hk(n){if(!n[Kn.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[Kn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function gu(n,t){for(let e=t;e>-1;e--)if(void 0!==n[e])return n[e];throw new Error("Locale data API: locale data undefined")}function AE(n){const[t,e]=n.split(":");return{hours:+t,minutes:+e}}const AV=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,ex={},RV=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var ba=(()=>((ba=ba||{})[ba.Short=0]="Short",ba[ba.ShortGMT=1]="ShortGMT",ba[ba.Long=2]="Long",ba[ba.Extended=3]="Extended",ba))(),Ki=(()=>((Ki=Ki||{})[Ki.FullYear=0]="FullYear",Ki[Ki.Month=1]="Month",Ki[Ki.Date=2]="Date",Ki[Ki.Hours=3]="Hours",Ki[Ki.Minutes=4]="Minutes",Ki[Ki.Seconds=5]="Seconds",Ki[Ki.FractionalSeconds=6]="FractionalSeconds",Ki[Ki.Day=7]="Day",Ki))(),Dr=(()=>((Dr=Dr||{})[Dr.DayPeriods=0]="DayPeriods",Dr[Dr.Days=1]="Days",Dr[Dr.Months=2]="Months",Dr[Dr.Eras=3]="Eras",Dr))();function kV(n,t,e,i){let r=function jV(n){if(mk(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,a=1,p=1]=n.split("-").map(y=>+y);return TS(r,a-1,p)}const e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(AV))return function UV(n){const t=new Date(0);let e=0,i=0;const r=n[8]?t.setUTCFullYear:t.setFullYear,a=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));const p=Number(n[4]||0)-e,y=Number(n[5]||0)-i,T=Number(n[6]||0),P=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return a.call(t,p,y,T,P),t}(i)}const t=new Date(n);if(!mk(t))throw new Error(`Unable to convert "${n}" into a date`);return t}(n);t=Zp(e,t)||t;let y,p=[];for(;t;){if(y=RV.exec(t),!y){p.push(t);break}{p=p.concat(y.slice(1));const z=p.pop();if(!z)break;t=z}}let T=r.getTimezoneOffset();i&&(T=fk(i,T),r=function VV(n,t,e){const i=e?-1:1,r=n.getTimezoneOffset();return function zV(n,t){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+t),n}(n,i*(fk(t,r)-r))}(r,i,!0));let P="";return p.forEach(z=>{const H=function BV(n){if(kE[n])return kE[n];let t;switch(n){case"G":case"GG":case"GGG":t=es(Dr.Eras,Qr.Abbreviated);break;case"GGGG":t=es(Dr.Eras,Qr.Wide);break;case"GGGGG":t=es(Dr.Eras,Qr.Narrow);break;case"y":t=oa(Ki.FullYear,1,0,!1,!0);break;case"yy":t=oa(Ki.FullYear,2,0,!0,!0);break;case"yyy":t=oa(Ki.FullYear,3,0,!1,!0);break;case"yyyy":t=oa(Ki.FullYear,4,0,!1,!0);break;case"Y":t=IS(1);break;case"YY":t=IS(2,!0);break;case"YYY":t=IS(3);break;case"YYYY":t=IS(4);break;case"M":case"L":t=oa(Ki.Month,1,1);break;case"MM":case"LL":t=oa(Ki.Month,2,1);break;case"MMM":t=es(Dr.Months,Qr.Abbreviated);break;case"MMMM":t=es(Dr.Months,Qr.Wide);break;case"MMMMM":t=es(Dr.Months,Qr.Narrow);break;case"LLL":t=es(Dr.Months,Qr.Abbreviated,Gs.Standalone);break;case"LLLL":t=es(Dr.Months,Qr.Wide,Gs.Standalone);break;case"LLLLL":t=es(Dr.Months,Qr.Narrow,Gs.Standalone);break;case"w":t=RE(1);break;case"ww":t=RE(2);break;case"W":t=RE(1,!0);break;case"d":t=oa(Ki.Date,1);break;case"dd":t=oa(Ki.Date,2);break;case"c":case"cc":t=oa(Ki.Day,1);break;case"ccc":t=es(Dr.Days,Qr.Abbreviated,Gs.Standalone);break;case"cccc":t=es(Dr.Days,Qr.Wide,Gs.Standalone);break;case"ccccc":t=es(Dr.Days,Qr.Narrow,Gs.Standalone);break;case"cccccc":t=es(Dr.Days,Qr.Short,Gs.Standalone);break;case"E":case"EE":case"EEE":t=es(Dr.Days,Qr.Abbreviated);break;case"EEEE":t=es(Dr.Days,Qr.Wide);break;case"EEEEE":t=es(Dr.Days,Qr.Narrow);break;case"EEEEEE":t=es(Dr.Days,Qr.Short);break;case"a":case"aa":case"aaa":t=es(Dr.DayPeriods,Qr.Abbreviated);break;case"aaaa":t=es(Dr.DayPeriods,Qr.Wide);break;case"aaaaa":t=es(Dr.DayPeriods,Qr.Narrow);break;case"b":case"bb":case"bbb":t=es(Dr.DayPeriods,Qr.Abbreviated,Gs.Standalone,!0);break;case"bbbb":t=es(Dr.DayPeriods,Qr.Wide,Gs.Standalone,!0);break;case"bbbbb":t=es(Dr.DayPeriods,Qr.Narrow,Gs.Standalone,!0);break;case"B":case"BB":case"BBB":t=es(Dr.DayPeriods,Qr.Abbreviated,Gs.Format,!0);break;case"BBBB":t=es(Dr.DayPeriods,Qr.Wide,Gs.Format,!0);break;case"BBBBB":t=es(Dr.DayPeriods,Qr.Narrow,Gs.Format,!0);break;case"h":t=oa(Ki.Hours,1,-12);break;case"hh":t=oa(Ki.Hours,2,-12);break;case"H":t=oa(Ki.Hours,1);break;case"HH":t=oa(Ki.Hours,2);break;case"m":t=oa(Ki.Minutes,1);break;case"mm":t=oa(Ki.Minutes,2);break;case"s":t=oa(Ki.Seconds,1);break;case"ss":t=oa(Ki.Seconds,2);break;case"S":t=oa(Ki.FractionalSeconds,1);break;case"SS":t=oa(Ki.FractionalSeconds,2);break;case"SSS":t=oa(Ki.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=DS(ba.Short);break;case"ZZZZZ":t=DS(ba.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=DS(ba.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=DS(ba.Long);break;default:return null}return kE[n]=t,t}(z);P+=H?H(r,e,T):"''"===z?"'":z.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),P}function TS(n,t,e){const i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function Zp(n,t){const e=function bV(n){return vs(n)[Kn.LocaleId]}(n);if(ex[e]=ex[e]||{},ex[e][t])return ex[e][t];let i="";switch(t){case"shortDate":i=xS(n,xs.Short);break;case"mediumDate":i=xS(n,xs.Medium);break;case"longDate":i=xS(n,xs.Long);break;case"fullDate":i=xS(n,xs.Full);break;case"shortTime":i=wS(n,xs.Short);break;case"mediumTime":i=wS(n,xs.Medium);break;case"longTime":i=wS(n,xs.Long);break;case"fullTime":i=wS(n,xs.Full);break;case"short":const r=Zp(n,"shortTime"),a=Zp(n,"shortDate");i=CS(SS(n,xs.Short),[r,a]);break;case"medium":const p=Zp(n,"mediumTime"),y=Zp(n,"mediumDate");i=CS(SS(n,xs.Medium),[p,y]);break;case"long":const T=Zp(n,"longTime"),P=Zp(n,"longDate");i=CS(SS(n,xs.Long),[T,P]);break;case"full":const z=Zp(n,"fullTime"),H=Zp(n,"fullDate");i=CS(SS(n,xs.Full),[z,H])}return i&&(ex[e][t]=i),i}function CS(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return null!=t&&i in t?t[i]:e})),n}function rd(n,t,e="-",i,r){let a="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,a=e));let p=String(n);for(;p.length<t;)p="0"+p;return i&&(p=p.slice(p.length-t)),a+p}function oa(n,t,e=0,i=!1,r=!1){return function(a,p){let y=function LV(n,t){switch(n){case Ki.FullYear:return t.getFullYear();case Ki.Month:return t.getMonth();case Ki.Date:return t.getDate();case Ki.Hours:return t.getHours();case Ki.Minutes:return t.getMinutes();case Ki.Seconds:return t.getSeconds();case Ki.FractionalSeconds:return t.getMilliseconds();case Ki.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,a);if((e>0||y>-e)&&(y+=e),n===Ki.Hours)0===y&&-12===e&&(y=12);else if(n===Ki.FractionalSeconds)return function PV(n,t){return rd(n,3).substring(0,t)}(y,t);const T=mu(p,$i.MinusSign);return rd(y,t,T,i,r)}}function es(n,t,e=Gs.Format,i=!1){return function(r,a){return function OV(n,t,e,i,r,a){switch(e){case Dr.Months:return function xV(n,t,e){const i=vs(n),a=gu([i[Kn.MonthsFormat],i[Kn.MonthsStandalone]],t);return gu(a,e)}(t,r,i)[n.getMonth()];case Dr.Days:return function vV(n,t,e){const i=vs(n),a=gu([i[Kn.DaysFormat],i[Kn.DaysStandalone]],t);return gu(a,e)}(t,r,i)[n.getDay()];case Dr.DayPeriods:const p=n.getHours(),y=n.getMinutes();if(a){const P=function CV(n){const t=vs(n);return hk(t),(t[Kn.ExtraData][2]||[]).map(i=>"string"==typeof i?AE(i):[AE(i[0]),AE(i[1])])}(t),z=function DV(n,t,e){const i=vs(n);hk(i);const a=gu([i[Kn.ExtraData][0],i[Kn.ExtraData][1]],t)||[];return gu(a,e)||[]}(t,r,i),H=P.findIndex(J=>{if(Array.isArray(J)){const[oe,fe]=J,Ae=p>=oe.hours&&y>=oe.minutes,We=p<fe.hours||p===fe.hours&&y<fe.minutes;if(oe.hours<fe.hours){if(Ae&&We)return!0}else if(Ae||We)return!0}else if(J.hours===p&&J.minutes===y)return!0;return!1});if(-1!==H)return z[H]}return function yV(n,t,e){const i=vs(n),a=gu([i[Kn.DayPeriodsFormat],i[Kn.DayPeriodsStandalone]],t);return gu(a,e)}(t,r,i)[p<12?0:1];case Dr.Eras:return function wV(n,t){return gu(vs(n)[Kn.Eras],t)}(t,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,a,n,t,e,i)}}function DS(n){return function(t,e,i){const r=-1*i,a=mu(e,$i.MinusSign),p=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case ba.Short:return(r>=0?"+":"")+rd(p,2,a)+rd(Math.abs(r%60),2,a);case ba.ShortGMT:return"GMT"+(r>=0?"+":"")+rd(p,1,a);case ba.Long:return"GMT"+(r>=0?"+":"")+rd(p,2,a)+":"+rd(Math.abs(r%60),2,a);case ba.Extended:return 0===i?"Z":(r>=0?"+":"")+rd(p,2,a)+":"+rd(Math.abs(r%60),2,a);default:throw new Error(`Unknown zone width "${n}"`)}}}function pk(n){return TS(n.getFullYear(),n.getMonth(),n.getDate()+(4-n.getDay()))}function RE(n,t=!1){return function(e,i){let r;if(t){const a=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,p=e.getDate();r=1+Math.floor((p+a)/7)}else{const a=pk(e),p=function NV(n){const t=TS(n,0,1).getDay();return TS(n,0,1+(t<=4?4:11)-t)}(a.getFullYear()),y=a.getTime()-p.getTime();r=1+Math.round(y/6048e5)}return rd(r,n,mu(i,$i.MinusSign))}}function IS(n,t=!1){return function(e,i){return rd(pk(e).getFullYear(),n,mu(i,$i.MinusSign),t)}}const kE={};function fk(n,t){n=n.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function mk(n){return n instanceof Date&&!isNaN(n.valueOf())}function yk(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[r,a]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(a)}return null}let bm=(()=>{class n{constructor(e,i,r,a){this._iterableDiffers=e,this._keyValueDiffers=i,this._ngEl=r,this._renderer=a,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Kg(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${vo(i.item)}`);this._toggleClass(i.item,!0)}),e.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!0)):Object.keys(e).forEach(i=>this._toggleClass(i,!!e[i])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!1)):Object.keys(e).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(e,i){(e=e.trim())&&e.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(e){return new(e||n)(le(dh),le(Q0),le(ei),le(uu))},n.\u0275dir=cn({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),n})();class t6{constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let cc=(()=>{class n{constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,a,p)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new t6(r.item,this._ngForOf,-1,-1),null===p?void 0:p);else if(null==p)i.remove(null===a?void 0:a);else if(null!==a){const y=i.get(a);i.move(y,p),wk(y,r)}});for(let r=0,a=i.length;r<a;r++){const y=i.get(r).context;y.index=r,y.count=a,y.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{wk(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(le(Rs),le(Yo),le(dh))},n.\u0275dir=cn({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function wk(n,t){n.context.$implicit=t.item}let Go=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new i6,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){Sk("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){Sk("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(le(Rs),le(Yo))},n.\u0275dir=cn({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class i6{constructor(){this.$implicit=null,this.ngIf=null}}function Sk(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${vo(t)}'.`)}class BE{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let wy=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const i=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(e)}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),n})(),AS=(()=>{class n{constructor(e,i,r){this.ngSwitch=r,r._addCase(),this._view=new BE(e,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(e){return new(e||n)(le(Rs),le(Yo),le(wy,9))},n.\u0275dir=cn({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),n})(),Ck=(()=>{class n{constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[r,a]=e.split("."),p=-1===r.indexOf("-")?void 0:rn.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,a?`${i}${a}`:i,p):this._renderer.removeStyle(this._ngEl.nativeElement,r,p)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(Q0),le(uu))},n.\u0275dir=cn({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),n})(),nx=(()=>{class n{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:a,ngTemplateOutletInjector:p}=this;this._viewRef=i.createEmbeddedView(r,a,p?{injector:p}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(e){return new(e||n)(le(Rs))},n.\u0275dir=cn({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[xo]}),n})();function od(n,t){return new ln(2100,!1)}class s6{createSubscription(t,e){return t.subscribe({next:e,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class a6{createSubscription(t,e){return t.then(e,i=>{throw i})}dispose(t){}}const l6=new a6,c6=new s6;let ix=(()=>{class n{constructor(e){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,i=>this._updateLatestValue(e,i))}_selectStrategy(e){if(Ya(e))return l6;if(Up(e))return c6;throw od()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,i){e===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(le(lo,16))},n.\u0275pipe=ta({name:"async",type:n,pure:!1,standalone:!0}),n})();const d6=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let Dk=(()=>{class n{transform(e){if(null==e)return null;if("string"!=typeof e)throw od();return e.replace(d6,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=ta({name:"titlecase",type:n,pure:!0,standalone:!0}),n})();const p6=new Qt("DATE_PIPE_DEFAULT_TIMEZONE");let Ek=(()=>{class n{constructor(e,i){this.locale=e,this.defaultTimezone=i}transform(e,i="mediumDate",r,a){var p;if(null==e||""===e||e!=e)return null;try{return kV(e,i,a||this.locale,null!==(p=null!=r?r:this.defaultTimezone)&&void 0!==p?p:void 0)}catch(y){throw od()}}}return n.\u0275fac=function(e){return new(e||n)(le(kc,16),le(p6,24))},n.\u0275pipe=ta({name:"date",type:n,pure:!0,standalone:!0}),n})(),ro=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({}),n})();const Mk="browser";let I6=(()=>{class n{}return n.\u0275prov=vn({token:n,providedIn:"root",factory:()=>new M6(mt(Mi),window)}),n})();class M6{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function A6(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const a=r.shadowRoot;if(a){const p=a.getElementById(t)||a.querySelector(`[name="${t}"]`);if(p)return p}r=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,a=this.offset();this.window.scrollTo(i-a[0],r-a[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=Ak(this.window.history)||Ak(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function Ak(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class Rk{}class HE extends class r5 extends class dV{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function uV(n){yS||(yS=n)}(new HE)}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function o5(){return ox=ox||document.querySelector("base"),ox?ox.getAttribute("href"):null}();return null==e?null:function s5(n){PS=PS||document.createElement("a"),PS.setAttribute("href",n);const t=PS.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){ox=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return yk(document.cookie,t)}}let PS,ox=null;const Fk=new Qt("TRANSITION_ID"),l5=[{provide:hS,useFactory:function a5(n,t,e){return()=>{e.get(pS).donePromise.then(()=>{const i=hh(),r=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let a=0;a<r.length;a++)i.remove(r[a])})}},deps:[Fk,Mi,jo],multi:!0}];let u5=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();const LS=new Qt("EventManagerPlugins");let OS=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(r=>r.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,r){return this._findPluginFor(i).addEventListener(e,i,r)}addGlobalEventListener(e,i,r){return this._findPluginFor(i).addGlobalEventListener(e,i,r)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const r=this._plugins;for(let a=0;a<r.length;a++){const p=r[a];if(p.supports(e))return this._eventNameToPlugin.set(e,p),p}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(mt(LS),mt(Oi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();class Nk{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const r=hh().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,i)}}let Bk=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),sx=(()=>{class n extends Bk{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,r){e.forEach(a=>{const p=this._doc.createElement("style");p.textContent=a,r.push(i.appendChild(p))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(zk),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(e,r,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(zk))}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();function zk(n){hh().remove(n)}const GE={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},qE=/%COMP%/g;function FS(n,t,e){for(let i=0;i<t.length;i++){let r=t[i];Array.isArray(r)?FS(n,r,e):(r=r.replace(qE,n),e.push(r))}return e}function Uk(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let NS=(()=>{class n{constructor(e,i,r){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new $E(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case Sa.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new g5(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(e),r}case 1:case Sa.ShadowDom:return new _5(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const r=FS(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(mt(OS),mt(sx),mt(vy))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();class $E{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(GE[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(Gk(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(Gk(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;const a=GE[r];a?t.setAttributeNS(a,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const r=GE[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(rn.DashCase|rn.Important)?t.style.setProperty(e,i,r&rn.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&rn.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,Uk(i)):this.eventManager.addEventListener(t,e,Uk(i))}}function Gk(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class g5 extends $E{constructor(t,e,i,r){super(t),this.component=i;const a=FS(r+"-"+i.id,i.styles,[]);e.addStyles(a),this.contentAttr=function p5(n){return"_ngcontent-%COMP%".replace(qE,n)}(r+"-"+i.id),this.hostAttr=function f5(n){return"_nghost-%COMP%".replace(qE,n)}(r+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class _5 extends $E{constructor(t,e,i,r){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const a=FS(r.id,r.styles,[]);for(let p=0;p<a.length;p++){const y=document.createElement("style");y.textContent=a[p],this.shadowRoot.appendChild(y)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let b5=(()=>{class n extends Nk{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r){return e.addEventListener(i,r,!1),()=>this.removeEventListener(e,i,r)}removeEventListener(e,i,r){return e.removeEventListener(i,r)}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();const qk=["alt","control","meta","shift"],y5={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},v5={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let x5=(()=>{class n extends Nk{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,r){const a=n.parseEventName(i),p=n.eventCallback(a.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>hh().onAndCancel(e,a.domEventName,p))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const a=n._normalizeKey(i.pop());let p="",y=i.indexOf("code");if(y>-1&&(i.splice(y,1),p="code."),qk.forEach(P=>{const z=i.indexOf(P);z>-1&&(i.splice(z,1),p+=P+".")}),p+=a,0!=i.length||0===a.length)return null;const T={};return T.domEventName=r,T.fullKey=p,T}static matchEventFullKeyCode(e,i){let r=y5[e.key]||e.key,a="";return i.indexOf("code.")>-1&&(r=e.code,a="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),qk.forEach(p=>{p!==r&&(0,v5[p])(e)&&(a+=p+".")}),a+=r,a===i)}static eventCallback(e,i,r){return a=>{n.matchEventFullKeyCode(a,e)&&r.runGuarded(()=>i(a))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();const C5=V2(aV,"browser",[{provide:fS,useValue:Mk},{provide:A2,useValue:function w5(){HE.makeCurrent()},multi:!0},{provide:Mi,useFactory:function T5(){return function WC(n){Sg=n}(document),document},deps:[]}]),Xk=new Qt(""),Zk=[{provide:mS,useClass:class c5{addToWindow(t){To.getAngularTestability=(i,r=!0)=>{const a=t.findTestabilityInTree(i,r);if(null==a)throw new Error("Could not find testability for element.");return a},To.getAllAngularTestabilities=()=>t.getAllTestabilities(),To.getAllAngularRootElements=()=>t.getAllRootElements(),To.frameworkStabilizers||(To.frameworkStabilizers=[]),To.frameworkStabilizers.push(i=>{const r=To.getAllAngularTestabilities();let a=r.length,p=!1;const y=function(T){p=p||T,a--,0==a&&i(p)};r.forEach(function(T){T.whenStable(y)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:i?hh().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}},deps:[]},{provide:F2,useClass:yE,deps:[Oi,vE,mS]},{provide:yE,useClass:yE,deps:[Oi,vE,mS]}],Yk=[{provide:Mb,useValue:"root"},{provide:Xu,useFactory:function S5(){return new Xu},deps:[]},{provide:LS,useClass:b5,multi:!0,deps:[Mi,Oi,fS]},{provide:LS,useClass:x5,multi:!0,deps:[Mi]},{provide:NS,useClass:NS,deps:[OS,sx,vy]},{provide:Og,useExisting:NS},{provide:Bk,useExisting:sx},{provide:sx,useClass:sx,deps:[Mi]},{provide:OS,useClass:OS,deps:[LS,Oi]},{provide:Rk,useClass:u5,deps:[]},[]];let Kk=(()=>{class n{constructor(e){}static withServerTransition(e){return{ngModule:n,providers:[{provide:vy,useValue:e.appId},{provide:Fk,useExisting:vy},l5]}}}return n.\u0275fac=function(e){return new(e||n)(mt(Xk,12))},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[...Yk,...Zk],imports:[ro,lV]}),n})(),Jk=(()=>{class n{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi))},n.\u0275prov=vn({token:n,factory:function(e){let i=null;return i=e?new e:function E5(){return new Jk(mt(Mi))}(),i},providedIn:"root"}),n})();"undefined"!=typeof window&&window;let tP=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:function(e){let i=null;return i=e?new(e||n):mt(nP),i},providedIn:"root"}),n})(),nP=(()=>{class n extends tP{constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case no.NONE:return i;case no.HTML:return au(i,"HTML")?Pa(i):kg(this._doc,String(i)).toString();case no.STYLE:return au(i,"Style")?Pa(i):i;case no.SCRIPT:if(au(i,"Script"))return Pa(i);throw new Error("unsafe value used in a script context");case no.URL:return au(i,"URL")?Pa(i):xb(String(i));case no.RESOURCE_URL:if(au(i,"ResourceURL"))return Pa(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function Iv(n){return new Dg(n)}(e)}bypassSecurityTrustStyle(e){return function Mv(n){return new h1(n)}(e)}bypassSecurityTrustScript(e){return function f1(n){return new p1(n)}(e)}bypassSecurityTrustUrl(e){return function m1(n){return new Eg(n)}(e)}bypassSecurityTrustResourceUrl(e){return function g1(n){return new Dv(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi))},n.\u0275prov=vn({token:n,factory:function(e){let i=null;return i=e?new e:function L5(n){return new nP(n.get(Mi))}(mt(jo)),i},providedIn:"root"}),n})();class iP{}const Yp="*";function ya(n,t){return{type:7,name:n,definitions:t,options:{}}}function zr(n,t=null){return{type:4,styles:t,timings:n}}function rP(n,t=null){return{type:3,steps:n,options:t}}function oP(n,t=null){return{type:2,steps:n,options:t}}function mi(n){return{type:6,styles:n,offset:null}}function oo(n,t,e){return{type:0,name:n,styles:t,options:e}}function ax(n){return{type:5,steps:n}}function kr(n,t,e=null){return{type:1,expr:n,animation:t,options:e}}function ZE(n=null){return{type:9,options:n}}function YE(n,t,e=null){return{type:11,selector:n,animation:t,options:e}}function sP(n){Promise.resolve().then(n)}class lx{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){sP(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class aP{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,r=0;const a=this.players.length;0==a?sP(()=>this._onFinish()):this.players.forEach(p=>{p.onDone(()=>{++e==a&&this._onFinish()}),p.onDestroy(()=>{++i==a&&this._onDestroy()}),p.onStart(()=>{++r==a&&this._onStart()})}),this.totalTime=this.players.reduce((p,y)=>Math.max(p,y.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function lP(n){return new ln(3e3,!1)}function gj(){return"undefined"!=typeof window&&void 0!==window.document}function JE(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function vm(n){switch(n.length){case 0:return new lx;case 1:return n[0];default:return new aP(n)}}function cP(n,t,e,i,r=new Map,a=new Map){const p=[],y=[];let T=-1,P=null;if(i.forEach(z=>{const H=z.get("offset"),J=H==T,oe=J&&P||new Map;z.forEach((fe,Ae)=>{let We=Ae,ot=fe;if("offset"!==Ae)switch(We=t.normalizePropertyName(We,p),ot){case"!":ot=r.get(Ae);break;case Yp:ot=a.get(Ae);break;default:ot=t.normalizeStyleValue(Ae,We,ot,p)}oe.set(We,ot)}),J||y.push(oe),P=oe,T=H}),p.length)throw function rj(n){return new ln(3502,!1)}();return y}function QE(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&eI(e,"start",n)));break;case"done":n.onDone(()=>i(e&&eI(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&eI(e,"destroy",n)))}}function eI(n,t,e){const i=e.totalTime,a=tI(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==i?n.totalTime:i,!!e.disabled),p=n._data;return null!=p&&(a._data=p),a}function tI(n,t,e,i,r="",a=0,p){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:r,totalTime:a,disabled:!!p}}function Pc(n,t,e){let i=n.get(t);return i||n.set(t,i=e),i}function uP(n){const t=n.indexOf(":");return[n.substring(1,t),n.slice(t+1)]}let nI=(n,t)=>!1,dP=(n,t,e)=>[],hP=null;function iI(n){const t=n.parentNode||n.host;return t===hP?null:t}(JE()||"undefined"!=typeof Element)&&(gj()?(hP=(()=>document.documentElement)(),nI=(n,t)=>{for(;t;){if(t===n)return!0;t=iI(t)}return!1}):nI=(n,t)=>n.contains(t),dP=(n,t,e)=>{if(e)return Array.from(n.querySelectorAll(t));const i=n.querySelector(t);return i?[i]:[]});let a_=null,pP=!1;const fP=nI,mP=dP;let gP=(()=>{class n{validateStyleProperty(e){return function bj(n){a_||(a_=function yj(){return"undefined"!=typeof document?document.body:null}()||{},pP=!!a_.style&&"WebkitAppearance"in a_.style);let t=!0;return a_.style&&!function _j(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in a_.style,!t&&pP&&(t="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in a_.style)),t}(e)}matchesElement(e,i){return!1}containsElement(e,i){return fP(e,i)}getParentElement(e){return iI(e)}query(e,i,r){return mP(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,a,p,y=[],T){return new lx(r,a)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),rI=(()=>{class n{}return n.NOOP=new gP,n})();const oI="ng-enter",BS="ng-leave",zS="ng-trigger",VS=".ng-trigger",bP="ng-animating",sI=".ng-animating";function Kp(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:aI(parseFloat(t[1]),t[2])}function aI(n,t){return"s"===t?1e3*n:n}function jS(n,t,e){return n.hasOwnProperty("duration")?n:function wj(n,t,e){let r,a=0,p="";if("string"==typeof n){const y=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===y)return t.push(lP()),{duration:0,delay:0,easing:""};r=aI(parseFloat(y[1]),y[2]);const T=y[3];null!=T&&(a=aI(parseFloat(T),y[4]));const P=y[5];P&&(p=P)}else r=n;if(!e){let y=!1,T=t.length;r<0&&(t.push(function F5(){return new ln(3100,!1)}()),y=!0),a<0&&(t.push(function N5(){return new ln(3101,!1)}()),y=!0),y&&t.splice(T,0,lP())}return{duration:r,delay:a,easing:p}}(n,t,e)}function cx(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function yP(n){const t=new Map;return Object.keys(n).forEach(e=>{t.set(e,n[e])}),t}function xm(n,t=new Map,e){if(e)for(let[i,r]of e)t.set(i,r);for(let[i,r]of n)t.set(i,r);return t}function xP(n,t,e){return e?t+":"+e+";":""}function wP(n){let t="";for(let e=0;e<n.style.length;e++){const i=n.style.item(e);t+=xP(0,i,n.style.getPropertyValue(i))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=xP(0,Dj(e),n.style[e]));n.setAttribute("style",t)}function ph(n,t,e){n.style&&(t.forEach((i,r)=>{const a=cI(r);e&&!e.has(r)&&e.set(r,n.style[a]),n.style[a]=i}),JE()&&wP(n))}function l_(n,t){n.style&&(t.forEach((e,i)=>{const r=cI(i);n.style[r]=""}),JE()&&wP(n))}function ux(n){return Array.isArray(n)?1==n.length?n[0]:oP(n):n}const lI=new RegExp("{{\\s*(.+?)\\s*}}","g");function SP(n){let t=[];if("string"==typeof n){let e;for(;e=lI.exec(n);)t.push(e[1]);lI.lastIndex=0}return t}function dx(n,t,e){const i=n.toString(),r=i.replace(lI,(a,p)=>{let y=t[p];return null==y&&(e.push(function z5(n){return new ln(3003,!1)}()),y=""),y.toString()});return r==i?n:r}function US(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const Cj=/-+([a-z0-9])/g;function cI(n){return n.replace(Cj,(...t)=>t[1].toUpperCase())}function Dj(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Lc(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw function V5(n){return new ln(3004,!1)}()}}function TP(n,t){return window.getComputedStyle(n)[t]}function kj(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function Pj(n,t,e){if(":"==n[0]){const T=function Lj(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(function ej(n){return new ln(3016,!1)}()),"* => *"}}(n,e);if("function"==typeof T)return void t.push(T);n=T}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(function Q5(n){return new ln(3015,!1)}()),t;const r=i[1],a=i[2],p=i[3];t.push(CP(r,p));"<"==a[0]&&!("*"==r&&"*"==p)&&t.push(CP(p,r))}(i,e,t)):e.push(n),e}const $S=new Set(["true","1"]),WS=new Set(["false","0"]);function CP(n,t){const e=$S.has(n)||WS.has(n),i=$S.has(t)||WS.has(t);return(r,a)=>{let p="*"==n||n==r,y="*"==t||t==a;return!p&&e&&"boolean"==typeof r&&(p=r?$S.has(n):WS.has(n)),!y&&i&&"boolean"==typeof a&&(y=a?$S.has(t):WS.has(t)),p&&y}}const Oj=new RegExp("s*:selfs*,?","g");function uI(n,t,e,i){return new Fj(n).build(t,e,i)}class Fj{constructor(t){this._driver=t}build(t,e,i){const r=new zj(e);return this._resetContextStyleTimingState(r),Lc(this,ux(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,r=e.depCount=0;const a=[],p=[];return"@"==t.name.charAt(0)&&e.errors.push(function U5(){return new ln(3006,!1)}()),t.definitions.forEach(y=>{if(this._resetContextStyleTimingState(e),0==y.type){const T=y,P=T.name;P.toString().split(/\s*,\s*/).forEach(z=>{T.name=z,a.push(this.visitState(T,e))}),T.name=P}else if(1==y.type){const T=this.visitTransition(y,e);i+=T.queryCount,r+=T.depCount,p.push(T)}else e.errors.push(function H5(){return new ln(3007,!1)}())}),{type:7,name:t.name,states:a,transitions:p,queryCount:i,depCount:r,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const a=new Set,p=r||{};i.styles.forEach(y=>{y instanceof Map&&y.forEach(T=>{SP(T).forEach(P=>{p.hasOwnProperty(P)||a.add(P)})})}),a.size&&(US(a.values()),e.errors.push(function G5(n,t){return new ln(3008,!1)}()))}return{type:0,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=Lc(this,ux(t.animation),e);return{type:1,matchers:kj(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:c_(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(i=>Lc(this,i,e)),options:c_(t.options)}}visitGroup(t,e){const i=e.currentTime;let r=0;const a=t.steps.map(p=>{e.currentTime=i;const y=Lc(this,p,e);return r=Math.max(r,e.currentTime),y});return e.currentTime=r,{type:3,steps:a,options:c_(t.options)}}visitAnimate(t,e){const i=function jj(n,t){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return dI(jS(n,t).duration,0,"");const e=n;if(e.split(/\s+/).some(a=>"{"==a.charAt(0)&&"{"==a.charAt(1))){const a=dI(0,0,"");return a.dynamic=!0,a.strValue=e,a}const r=jS(e,t);return dI(r.duration,r.delay,r.easing)}(t.timings,e.errors);e.currentAnimateTimings=i;let r,a=t.styles?t.styles:mi({});if(5==a.type)r=this.visitKeyframes(a,e);else{let p=t.styles,y=!1;if(!p){y=!0;const P={};i.easing&&(P.easing=i.easing),p=mi(P)}e.currentTime+=i.duration+i.delay;const T=this.visitStyle(p,e);T.isEmptyStep=y,r=T}return e.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let y of r)"string"==typeof y?y===Yp?i.push(y):e.errors.push(new ln(3002,!1)):i.push(yP(y));let a=!1,p=null;return i.forEach(y=>{if(y instanceof Map&&(y.has("easing")&&(p=y.get("easing"),y.delete("easing")),!a))for(let T of y.values())if(T.toString().indexOf("{{")>=0){a=!0;break}}),{type:6,styles:i,easing:p,offset:t.offset,containsDynamicStyles:a,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let r=e.currentTime,a=e.currentTime;i&&a>0&&(a-=i.duration+i.delay),t.styles.forEach(p=>{"string"!=typeof p&&p.forEach((y,T)=>{const P=e.collectedStyles.get(e.currentQuerySelector),z=P.get(T);let H=!0;z&&(a!=r&&a>=z.startTime&&r<=z.endTime&&(e.errors.push(function $5(n,t,e,i,r){return new ln(3010,!1)}()),H=!1),a=z.startTime),H&&P.set(T,{startTime:a,endTime:r}),e.options&&function Tj(n,t,e){const i=t.params||{},r=SP(n);r.length&&r.forEach(a=>{i.hasOwnProperty(a)||e.push(function B5(n){return new ln(3001,!1)}())})}(y,e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function W5(){return new ln(3011,!1)}()),i;let a=0;const p=[];let y=!1,T=!1,P=0;const z=t.steps.map(ot=>{const tn=this._makeStyleAst(ot,e);let Nt=null!=tn.offset?tn.offset:function Vj(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const e=n;t=parseFloat(e.get("offset")),e.delete("offset")}return t}(tn.styles),un=0;return null!=Nt&&(a++,un=tn.offset=Nt),T=T||un<0||un>1,y=y||un<P,P=un,p.push(un),tn});T&&e.errors.push(function X5(){return new ln(3012,!1)}()),y&&e.errors.push(function Z5(){return new ln(3200,!1)}());const H=t.steps.length;let J=0;a>0&&a<H?e.errors.push(function Y5(){return new ln(3202,!1)}()):0==a&&(J=1/(H-1));const oe=H-1,fe=e.currentTime,Ae=e.currentAnimateTimings,We=Ae.duration;return z.forEach((ot,tn)=>{const Nt=J>0?tn==oe?1:J*tn:p[tn],un=Nt*We;e.currentTime=fe+Ae.delay+un,Ae.duration=un,this._validateStyleAst(ot,e),ot.offset=Nt,i.styles.push(ot)}),i}visitReference(t,e){return{type:8,animation:Lc(this,ux(t.animation),e),options:c_(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:c_(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:c_(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;const[a,p]=function Nj(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(Oj,"")),n=n.replace(/@\*/g,VS).replace(/@\w+/g,e=>VS+"-"+e.slice(1)).replace(/:animating/g,sI),[n,t]}(t.selector);e.currentQuerySelector=i.length?i+" "+a:a,Pc(e.collectedStyles,e.currentQuerySelector,new Map);const y=Lc(this,ux(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:a,limit:r.limit||0,optional:!!r.optional,includeSelf:p,animation:y,originalSelector:t.selector,options:c_(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(function K5(){return new ln(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:jS(t.timings,e.errors,!0);return{type:12,animation:Lc(this,ux(t.animation),e),timings:i,options:null}}}class zj{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function c_(n){return n?(n=cx(n)).params&&(n.params=function Bj(n){return n?cx(n):null}(n.params)):n={},n}function dI(n,t,e){return{duration:n,delay:t,easing:e}}function hI(n,t,e,i,r,a,p=null,y=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:r,delay:a,totalTime:r+a,easing:p,subTimeline:y}}class XS{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const Gj=new RegExp(":enter","g"),$j=new RegExp(":leave","g");function pI(n,t,e,i,r,a=new Map,p=new Map,y,T,P=[]){return(new Wj).buildKeyframes(n,t,e,i,r,a,p,y,T,P)}class Wj{buildKeyframes(t,e,i,r,a,p,y,T,P,z=[]){P=P||new XS;const H=new fI(t,e,P,r,a,z,[]);H.options=T;const J=T.delay?Kp(T.delay):0;H.currentTimeline.delayNextStep(J),H.currentTimeline.setStyles([p],null,H.errors,T),Lc(this,i,H);const oe=H.timelines.filter(fe=>fe.containsAnimation());if(oe.length&&y.size){let fe;for(let Ae=oe.length-1;Ae>=0;Ae--){const We=oe[Ae];if(We.element===e){fe=We;break}}fe&&!fe.allowOnlyTimelineStyles()&&fe.setStyles([y],null,H.errors,T)}return oe.length?oe.map(fe=>fe.buildKeyframes()):[hI(e,[],[],[],0,J,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.get(e.element);if(i){const r=e.createSubContext(t.options),a=e.currentTimeline.currentTime,p=this._visitSubInstructions(i,r,r.options);a!=p&&e.transformIntoNewTimeline(p)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,i),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,i){var r;for(const a of t){const p=null==a?void 0:a.delay;if(p){const y="number"==typeof p?p:Kp(dx(p,null!==(r=null==a?void 0:a.params)&&void 0!==r?r:{},e.errors));i.delayNextStep(y)}}}_visitSubInstructions(t,e,i){let a=e.currentTimeline.currentTime;const p=null!=i.duration?Kp(i.duration):null,y=null!=i.delay?Kp(i.delay):null;return 0!==p&&t.forEach(T=>{const P=e.appendInstructionToTimeline(T,p,y);a=Math.max(a,P.duration+P.delay)}),a}visitReference(t,e){e.updateOptions(t.options,!0),Lc(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let r=e;const a=t.options;if(a&&(a.params||a.delay)&&(r=e.createSubContext(a),r.transformIntoNewTimeline(),null!=a.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=ZS);const p=Kp(a.delay);r.delayNextStep(p)}t.steps.length&&(t.steps.forEach(p=>Lc(this,p,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let r=e.currentTimeline.currentTime;const a=t.options&&t.options.delay?Kp(t.options.delay):0;t.steps.forEach(p=>{const y=e.createSubContext(t.options);a&&y.delayNextStep(a),Lc(this,p,y),r=Math.max(r,y.currentTimeline.currentTime),i.push(y.currentTimeline)}),i.forEach(p=>e.currentTimeline.mergeTimelineCollectedStyles(p)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return jS(e.params?dx(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());const a=t.style;5==a.type?this.visitKeyframes(a,e):(e.incrementTime(i.duration),this.visitStyle(a,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const a=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(a):i.setStyles(t.styles,a,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,r=e.currentTimeline.duration,a=i.duration,y=e.createSubContext().currentTimeline;y.easing=i.easing,t.styles.forEach(T=>{y.forwardTime((T.offset||0)*a),y.setStyles(T.styles,T.easing,e.errors,e.options),y.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(y),e.transformIntoNewTimeline(r+a),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,r=t.options||{},a=r.delay?Kp(r.delay):0;a&&(6===e.previousNode.type||0==i&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=ZS);let p=i;const y=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=y.length;let T=null;y.forEach((P,z)=>{e.currentQueryIndex=z;const H=e.createSubContext(t.options,P);a&&H.delayNextStep(a),P===e.element&&(T=H.currentTimeline),Lc(this,t.animation,H),H.currentTimeline.applyStylesToKeyframe(),p=Math.max(p,H.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(p),T&&(e.currentTimeline.mergeTimelineCollectedStyles(T),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,r=e.currentTimeline,a=t.timings,p=Math.abs(a.duration),y=p*(e.currentQueryTotal-1);let T=p*e.currentQueryIndex;switch(a.duration<0?"reverse":a.easing){case"reverse":T=y-T;break;case"full":T=i.currentStaggerTime}const z=e.currentTimeline;T&&z.delayNextStep(T);const H=z.currentTime;Lc(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=r.currentTime-H+(r.startTime-i.currentTimeline.startTime)}}const ZS={};class fI{constructor(t,e,i,r,a,p,y,T){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=a,this.errors=p,this.timelines=y,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=ZS,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=T||new YS(this._driver,e,0),y.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=Kp(i.duration)),null!=i.delay&&(r.delay=Kp(i.delay));const a=i.params;if(a){let p=r.params;p||(p=this.options.params={}),Object.keys(a).forEach(y=>{(!e||!p.hasOwnProperty(y))&&(p[y]=dx(a[y],p,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return t}createSubContext(t=null,e,i){const r=e||this.element,a=new fI(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return a.previousNode=this.previousNode,a.currentAnimateTimings=this.currentAnimateTimings,a.options=this._copyOptions(),a.updateOptions(t),a.currentQueryIndex=this.currentQueryIndex,a.currentQueryTotal=this.currentQueryTotal,a.parentContext=this,this.subContextCount++,a}transformIntoNewTimeline(t){return this.previousNode=ZS,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const r={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},a=new Xj(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(a),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,r,a,p){let y=[];if(r&&y.push(this.element),t.length>0){t=(t=t.replace(Gj,"."+this._enterClassName)).replace($j,"."+this._leaveClassName);let P=this._driver.query(this.element,t,1!=i);0!==i&&(P=i<0?P.slice(P.length+i,P.length):P.slice(0,i)),y.push(...P)}return!a&&0==y.length&&p.push(function J5(n){return new ln(3014,!1)}()),y}}class YS{constructor(t,e,i,r){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new YS(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||Yp),this._currentKeyframe.set(e,Yp);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,r){var a;e&&this._previousKeyframe.set("easing",e);const p=r&&r.params||{},y=function Zj(n,t){const e=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||t.keys();for(let a of i)e.set(a,Yp)}else xm(r,e)}),e}(t,this._globalTimelineStyles);for(let[T,P]of y){const z=dx(P,p,i);this._pendingStyles.set(T,z),this._localTimelineStyles.has(T)||this._backFill.set(T,null!==(a=this._globalTimelineStyles.get(T))&&void 0!==a?a:Yp),this._updateStyle(T,z)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{const r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((y,T)=>{const P=xm(y,new Map,this._backFill);P.forEach((z,H)=>{"!"===z?t.add(H):z===Yp&&e.add(H)}),i||P.set("offset",T/this.duration),r.push(P)});const a=t.size?US(t.values()):[],p=e.size?US(e.values()):[];if(i){const y=r[0],T=new Map(y);y.set("offset",0),T.set("offset",1),r=[y,T]}return hI(this.element,r,a,p,this.duration,this.startTime,this.easing,!1)}}class Xj extends YS{constructor(t,e,i,r,a,p,y=!1){super(t,e,p.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=a,this._stretchStartingKeyframe=y,this.timings={duration:p.duration,delay:p.delay,easing:p.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const a=[],p=i+e,y=e/p,T=xm(t[0]);T.set("offset",0),a.push(T);const P=xm(t[0]);P.set("offset",IP(y)),a.push(P);const z=t.length-1;for(let H=1;H<=z;H++){let J=xm(t[H]);const oe=J.get("offset");J.set("offset",IP((e+oe*i)/p)),a.push(J)}i=p,e=0,r="",t=a}return hI(this.element,t,this.preStyleProps,this.postStyleProps,i,e,r,!0)}}function IP(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class mI{}const Yj=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Kj extends mI{normalizePropertyName(t,e){return cI(t)}normalizeStyleValue(t,e,i,r){let a="";const p=i.toString().trim();if(Yj.has(e)&&0!==i&&"0"!==i)if("number"==typeof i)a="px";else{const y=i.match(/^[+-]?[\d\.]+([a-z]*)$/);y&&0==y[1].length&&r.push(function j5(n,t){return new ln(3005,!1)}())}return p+a}}function MP(n,t,e,i,r,a,p,y,T,P,z,H,J){return{type:0,element:n,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:a,toState:i,toStyles:p,timelines:y,queriedElements:T,preStyleProps:P,postStyleProps:z,totalTime:H,errors:J}}const gI={};class AP{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,r){return function Jj(n,t,e,i,r){return n.some(a=>a(t,e,i,r))}(this.ast.matchers,t,e,i,r)}buildStyles(t,e,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(null==t?void 0:t.toString())||r),r?r.buildStyles(e,i):new Map}build(t,e,i,r,a,p,y,T,P,z){var H;const J=[],oe=this.ast.options&&this.ast.options.params||gI,Ae=this.buildStyles(i,y&&y.params||gI,J),We=T&&T.params||gI,ot=this.buildStyles(r,We,J),tn=new Set,Nt=new Map,un=new Map,Zn="void"===r,ci={params:Qj(We,oe),delay:null===(H=this.ast.options)||void 0===H?void 0:H.delay},Fi=z?[]:pI(t,e,this.ast.animation,a,p,Ae,ot,ci,P,J);let Ui=0;if(Fi.forEach(pr=>{Ui=Math.max(pr.duration+pr.delay,Ui)}),J.length)return MP(e,this._triggerName,i,r,Zn,Ae,ot,[],[],Nt,un,Ui,J);Fi.forEach(pr=>{const Zs=pr.element,Sl=Pc(Nt,Zs,new Set);pr.preStyleProps.forEach(Ch=>Sl.add(Ch));const _f=Pc(un,Zs,new Set);pr.postStyleProps.forEach(Ch=>_f.add(Ch)),Zs!==e&&tn.add(Zs)});const Lr=US(tn.values());return MP(e,this._triggerName,i,r,Zn,Ae,ot,Fi,Lr,Nt,un,Ui)}}function Qj(n,t){const e=cx(t);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(e[i]=n[i]);return e}class eU{constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){const i=new Map,r=cx(this.defaultParams);return Object.keys(t).forEach(a=>{const p=t[a];null!==p&&(r[a]=p)}),this.styles.styles.forEach(a=>{"string"!=typeof a&&a.forEach((p,y)=>{p&&(p=dx(p,r,e));const T=this.normalizer.normalizePropertyName(y,e);p=this.normalizer.normalizeStyleValue(y,T,p,e),i.set(T,p)})}),i}}class nU{constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states=new Map,e.states.forEach(r=>{this.states.set(r.name,new eU(r.style,r.options&&r.options.params||{},i))}),RP(this.states,"true","1"),RP(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new AP(t,r,this.states))}),this.fallbackTransition=function iU(n,t,e){return new AP(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(p,y)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,r){return this.transitionFactories.find(p=>p.match(t,e,i,r))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function RP(n,t,e){n.has(t)?n.has(e)||n.set(e,n.get(t)):n.has(e)&&n.set(t,n.get(e))}const rU=new XS;class oU{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,e){const i=[],a=uI(this._driver,e,i,[]);if(i.length)throw function oj(n){return new ln(3503,!1)}();this._animations.set(t,a)}_buildPlayer(t,e,i){const r=t.element,a=cP(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(r,a,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const r=[],a=this._animations.get(t);let p;const y=new Map;if(a?(p=pI(this._driver,e,a,oI,BS,new Map,new Map,i,rU,r),p.forEach(z=>{const H=Pc(y,z.element,new Map);z.postStyleProps.forEach(J=>H.set(J,null))})):(r.push(function sj(){return new ln(3300,!1)}()),p=[]),r.length)throw function aj(n){return new ln(3504,!1)}();y.forEach((z,H)=>{z.forEach((J,oe)=>{z.set(oe,this._driver.computeStyle(H,oe,Yp))})});const P=vm(p.map(z=>{const H=y.get(z.element);return this._buildPlayer(z,new Map,H)}));return this._playersById.set(t,P),P.onDestroy(()=>this.destroy(t)),this.players.push(P),P}destroy(t){const e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById.get(t);if(!e)throw function lj(n){return new ln(3301,!1)}();return e}listen(t,e,i,r){const a=tI(e,"","","");return QE(this._getPlayer(t),i,a,r),()=>{}}command(t,e,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,e,r[0]||{});const a=this._getPlayer(t);switch(i){case"play":a.play();break;case"pause":a.pause();break;case"reset":a.reset();break;case"restart":a.restart();break;case"finish":a.finish();break;case"init":a.init();break;case"setPosition":a.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const kP="ng-animate-queued",_I="ng-animate-disabled",uU=[],PP={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},dU={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},_u="__ng_removed";class bI{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=function mU(n){return null!=n?n:null}(i?t.value:t),i){const a=cx(t);delete a.value,this.options=a}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const i=this.options.params;Object.keys(e).forEach(r=>{null==i[r]&&(i[r]=e[r])})}}}const hx="void",yI=new bI(hx);class hU{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,bu(e,this._hostClassName)}listen(t,e,i,r){if(!this._triggers.has(e))throw function cj(n,t){return new ln(3302,!1)}();if(null==i||0==i.length)throw function uj(n){return new ln(3303,!1)}();if(!function gU(n){return"start"==n||"done"==n}(i))throw function dj(n,t){return new ln(3400,!1)}();const a=Pc(this._elementListeners,t,[]),p={name:e,phase:i,callback:r};a.push(p);const y=Pc(this._engine.statesByElement,t,new Map);return y.has(e)||(bu(t,zS),bu(t,zS+"-"+e),y.set(e,yI)),()=>{this._engine.afterFlush(()=>{const T=a.indexOf(p);T>=0&&a.splice(T,1),this._triggers.has(e)||y.delete(e)})}}register(t,e){return!this._triggers.has(t)&&(this._triggers.set(t,e),!0)}_getTrigger(t){const e=this._triggers.get(t);if(!e)throw function hj(n){return new ln(3401,!1)}();return e}trigger(t,e,i,r=!0){const a=this._getTrigger(e),p=new vI(this.id,e,t);let y=this._engine.statesByElement.get(t);y||(bu(t,zS),bu(t,zS+"-"+e),this._engine.statesByElement.set(t,y=new Map));let T=y.get(e);const P=new bI(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&T&&P.absorbOptions(T.options),y.set(e,P),T||(T=yI),P.value!==hx&&T.value===P.value){if(!function yU(n,t){const e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){const a=e[r];if(!t.hasOwnProperty(a)||n[a]!==t[a])return!1}return!0}(T.params,P.params)){const Ae=[],We=a.matchStyles(T.value,T.params,Ae),ot=a.matchStyles(P.value,P.params,Ae);Ae.length?this._engine.reportError(Ae):this._engine.afterFlush(()=>{l_(t,We),ph(t,ot)})}return}const J=Pc(this._engine.playersByElement,t,[]);J.forEach(Ae=>{Ae.namespaceId==this.id&&Ae.triggerName==e&&Ae.queued&&Ae.destroy()});let oe=a.matchTransition(T.value,P.value,t,P.params),fe=!1;if(!oe){if(!r)return;oe=a.fallbackTransition,fe=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:oe,fromState:T,toState:P,player:p,isFallbackTransition:fe}),fe||(bu(t,kP),p.onStart(()=>{Sy(t,kP)})),p.onDone(()=>{let Ae=this.players.indexOf(p);Ae>=0&&this.players.splice(Ae,1);const We=this._engine.playersByElement.get(t);if(We){let ot=We.indexOf(p);ot>=0&&We.splice(ot,1)}}),this.players.push(p),J.push(p),p}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,VS,!0);i.forEach(r=>{if(r[_u])return;const a=this._engine.fetchNamespacesByElement(r);a.size?a.forEach(p=>p.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,i,r){const a=this._engine.statesByElement.get(t),p=new Map;if(a){const y=[];if(a.forEach((T,P)=>{if(p.set(P,T.value),this._triggers.has(P)){const z=this.trigger(t,P,hx,r);z&&y.push(z)}}),y.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,p),i&&vm(y).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const r=new Set;e.forEach(a=>{const p=a.name;if(r.has(p))return;r.add(p);const T=this._triggers.get(p).fallbackTransition,P=i.get(p)||yI,z=new bI(hx),H=new vI(this.id,p,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:p,transition:T,fromState:P,toState:z,player:H,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(i.totalAnimations){const a=i.players.length?i.playersByQueriedElement.get(t):[];if(a&&a.length)r=!0;else{let p=t;for(;p=p.parentNode;)if(i.statesByElement.get(p)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,e);else{const a=t[_u];(!a||a===PP)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){bu(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const a=i.element,p=this._elementListeners.get(a);p&&p.forEach(y=>{if(y.name==i.triggerName){const T=tI(a,i.triggerName,i.fromState.value,i.toState.value);T._data=t,QE(i.player,y.phase,T,y.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{const a=i.transition.ast.depCount,p=r.transition.ast.depCount;return 0==a||0==p?a-p:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(i=>i.element===t)||e,e}}class pU{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,a)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){const i=new hU(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let p=!1,y=this.driver.getParentElement(e);for(;y;){const T=r.get(y);if(T){const P=i.indexOf(T);i.splice(P+1,0,t),p=!0;break}y=this.driver.getParentElement(y)}p||i.unshift(t)}else i.push(t);return r.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let r=this._namespaceLookup[t];r&&r.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const a=this._fetchNamespace(r.namespaceId);a&&e.add(a)}return e}trigger(t,e,i,r){if(KS(e)){const a=this._fetchNamespace(t);if(a)return a.trigger(e,i,r),!0}return!1}insertNode(t,e,i,r){if(!KS(e))return;const a=e[_u];if(a&&a.setForRemoval){a.setForRemoval=!1,a.setForMove=!0;const p=this.collectedLeaveElements.indexOf(e);p>=0&&this.collectedLeaveElements.splice(p,1)}if(t){const p=this._fetchNamespace(t);p&&p.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),bu(t,_I)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Sy(t,_I))}removeNode(t,e,i,r){if(KS(e)){const a=t?this._fetchNamespace(t):null;if(a?a.removeNode(e,r):this.markElementAsRemoved(t,e,!1,r),i){const p=this.namespacesByHostElement.get(e);p&&p.id!==t&&p.removeNode(e,r)}}else this._onRemovalComplete(e,r)}markElementAsRemoved(t,e,i,r,a){this.collectedLeaveElements.push(e),e[_u]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:a}}listen(t,e,i,r,a){return KS(e)?this._fetchNamespace(t).listen(e,i,r,a):()=>{}}_buildInstruction(t,e,i,r,a){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,e,a)}destroyInnerAnimations(t){let e=this.driver.query(t,VS,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,sI,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return vm(this.players).onDone(()=>t());t()})}processLeaveNode(t){var e;const i=t[_u];if(i&&i.setForRemoval){if(t[_u]=PP,i.namespaceId){this.destroyInnerAnimations(t);const r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}!(null===(e=t.classList)||void 0===e)&&e.contains(_I)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)bu(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?vm(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function pj(n){return new ln(3402,!1)}()}_flushAnimations(t,e){const i=new XS,r=[],a=new Map,p=[],y=new Map,T=new Map,P=new Map,z=new Set;this.disabledNodes.forEach(gi=>{z.add(gi);const Ni=this.driver.query(gi,".ng-animate-queued",!0);for(let Wi=0;Wi<Ni.length;Wi++)z.add(Ni[Wi])});const H=this.bodyNode,J=Array.from(this.statesByElement.keys()),oe=FP(J,this.collectedEnterElements),fe=new Map;let Ae=0;oe.forEach((gi,Ni)=>{const Wi=oI+Ae++;fe.set(Ni,Wi),gi.forEach(eo=>bu(eo,Wi))});const We=[],ot=new Set,tn=new Set;for(let gi=0;gi<this.collectedLeaveElements.length;gi++){const Ni=this.collectedLeaveElements[gi],Wi=Ni[_u];Wi&&Wi.setForRemoval&&(We.push(Ni),ot.add(Ni),Wi.hasAnimation?this.driver.query(Ni,".ng-star-inserted",!0).forEach(eo=>ot.add(eo)):tn.add(Ni))}const Nt=new Map,un=FP(J,Array.from(ot));un.forEach((gi,Ni)=>{const Wi=BS+Ae++;Nt.set(Ni,Wi),gi.forEach(eo=>bu(eo,Wi))}),t.push(()=>{oe.forEach((gi,Ni)=>{const Wi=fe.get(Ni);gi.forEach(eo=>Sy(eo,Wi))}),un.forEach((gi,Ni)=>{const Wi=Nt.get(Ni);gi.forEach(eo=>Sy(eo,Wi))}),We.forEach(gi=>{this.processLeaveNode(gi)})});const Zn=[],ci=[];for(let gi=this._namespaceList.length-1;gi>=0;gi--)this._namespaceList[gi].drainQueuedTransitions(e).forEach(Wi=>{const eo=Wi.player,Os=Wi.element;if(Zn.push(eo),this.collectedEnterElements.length){const Tl=Os[_u];if(Tl&&Tl.setForMove){if(Tl.previousTriggersValues&&Tl.previousTriggersValues.has(Wi.triggerName)){const F_=Tl.previousTriggersValues.get(Wi.triggerName),wu=this.statesByElement.get(Wi.element);if(wu&&wu.has(Wi.triggerName)){const zC=wu.get(Wi.triggerName);zC.value=F_,wu.set(Wi.triggerName,zC)}}return void eo.destroy()}}const Dh=!H||!this.driver.containsElement(H,Os),Nc=Nt.get(Os),Nm=fe.get(Os),ws=this._buildInstruction(Wi,i,Nm,Nc,Dh);if(ws.errors&&ws.errors.length)return void ci.push(ws);if(Dh)return eo.onStart(()=>l_(Os,ws.fromStyles)),eo.onDestroy(()=>ph(Os,ws.toStyles)),void r.push(eo);if(Wi.isFallbackTransition)return eo.onStart(()=>l_(Os,ws.fromStyles)),eo.onDestroy(()=>ph(Os,ws.toStyles)),void r.push(eo);const AB=[];ws.timelines.forEach(Tl=>{Tl.stretchStartingKeyframe=!0,this.disabledNodes.has(Tl.element)||AB.push(Tl)}),ws.timelines=AB,i.append(Os,ws.timelines),p.push({instruction:ws,player:eo,element:Os}),ws.queriedElements.forEach(Tl=>Pc(y,Tl,[]).push(eo)),ws.preStyleProps.forEach((Tl,F_)=>{if(Tl.size){let wu=T.get(F_);wu||T.set(F_,wu=new Set),Tl.forEach((zC,oR)=>wu.add(oR))}}),ws.postStyleProps.forEach((Tl,F_)=>{let wu=P.get(F_);wu||P.set(F_,wu=new Set),Tl.forEach((zC,oR)=>wu.add(oR))})});if(ci.length){const gi=[];ci.forEach(Ni=>{gi.push(function fj(n,t){return new ln(3505,!1)}())}),Zn.forEach(Ni=>Ni.destroy()),this.reportError(gi)}const Fi=new Map,Ui=new Map;p.forEach(gi=>{const Ni=gi.element;i.has(Ni)&&(Ui.set(Ni,Ni),this._beforeAnimationBuild(gi.player.namespaceId,gi.instruction,Fi))}),r.forEach(gi=>{const Ni=gi.element;this._getPreviousPlayers(Ni,!1,gi.namespaceId,gi.triggerName,null).forEach(eo=>{Pc(Fi,Ni,[]).push(eo),eo.destroy()})});const Lr=We.filter(gi=>BP(gi,T,P)),pr=new Map;OP(pr,this.driver,tn,P,Yp).forEach(gi=>{BP(gi,T,P)&&Lr.push(gi)});const Sl=new Map;oe.forEach((gi,Ni)=>{OP(Sl,this.driver,new Set(gi),T,"!")}),Lr.forEach(gi=>{var Ni,Wi;const eo=pr.get(gi),Os=Sl.get(gi);pr.set(gi,new Map([...Array.from(null!==(Ni=null==eo?void 0:eo.entries())&&void 0!==Ni?Ni:[]),...Array.from(null!==(Wi=null==Os?void 0:Os.entries())&&void 0!==Wi?Wi:[])]))});const _f=[],Ch=[],Qy={};p.forEach(gi=>{const{element:Ni,player:Wi,instruction:eo}=gi;if(i.has(Ni)){if(z.has(Ni))return Wi.onDestroy(()=>ph(Ni,eo.toStyles)),Wi.disabled=!0,Wi.overrideTotalTime(eo.totalTime),void r.push(Wi);let Os=Qy;if(Ui.size>1){let Nc=Ni;const Nm=[];for(;Nc=Nc.parentNode;){const ws=Ui.get(Nc);if(ws){Os=ws;break}Nm.push(Nc)}Nm.forEach(ws=>Ui.set(ws,Os))}const Dh=this._buildAnimation(Wi.namespaceId,eo,Fi,a,Sl,pr);if(Wi.setRealPlayer(Dh),Os===Qy)_f.push(Wi);else{const Nc=this.playersByElement.get(Os);Nc&&Nc.length&&(Wi.parentPlayer=vm(Nc)),r.push(Wi)}}else l_(Ni,eo.fromStyles),Wi.onDestroy(()=>ph(Ni,eo.toStyles)),Ch.push(Wi),z.has(Ni)&&r.push(Wi)}),Ch.forEach(gi=>{const Ni=a.get(gi.element);if(Ni&&Ni.length){const Wi=vm(Ni);gi.setRealPlayer(Wi)}}),r.forEach(gi=>{gi.parentPlayer?gi.syncPlayerEvents(gi.parentPlayer):gi.destroy()});for(let gi=0;gi<We.length;gi++){const Ni=We[gi],Wi=Ni[_u];if(Sy(Ni,BS),Wi&&Wi.hasAnimation)continue;let eo=[];if(y.size){let Dh=y.get(Ni);Dh&&Dh.length&&eo.push(...Dh);let Nc=this.driver.query(Ni,sI,!0);for(let Nm=0;Nm<Nc.length;Nm++){let ws=y.get(Nc[Nm]);ws&&ws.length&&eo.push(...ws)}}const Os=eo.filter(Dh=>!Dh.destroyed);Os.length?_U(this,Ni,Os):this.processLeaveNode(Ni)}return We.length=0,_f.forEach(gi=>{this.players.push(gi),gi.onDone(()=>{gi.destroy();const Ni=this.players.indexOf(gi);this.players.splice(Ni,1)}),gi.play()}),_f}elementContainsData(t,e){let i=!1;const r=e[_u];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,r,a){let p=[];if(e){const y=this.playersByQueriedElement.get(t);y&&(p=y)}else{const y=this.playersByElement.get(t);if(y){const T=!a||a==hx;y.forEach(P=>{P.queued||!T&&P.triggerName!=r||p.push(P)})}}return(i||r)&&(p=p.filter(y=>!(i&&i!=y.namespaceId||r&&r!=y.triggerName))),p}_beforeAnimationBuild(t,e,i){const a=e.element,p=e.isRemovalTransition?void 0:t,y=e.isRemovalTransition?void 0:e.triggerName;for(const T of e.timelines){const P=T.element,z=P!==a,H=Pc(i,P,[]);this._getPreviousPlayers(P,z,p,y,e.toState).forEach(oe=>{const fe=oe.getRealPlayer();fe.beforeDestroy&&fe.beforeDestroy(),oe.destroy(),H.push(oe)})}l_(a,e.fromStyles)}_buildAnimation(t,e,i,r,a,p){const y=e.triggerName,T=e.element,P=[],z=new Set,H=new Set,J=e.timelines.map(fe=>{const Ae=fe.element;z.add(Ae);const We=Ae[_u];if(We&&We.removedBeforeQueried)return new lx(fe.duration,fe.delay);const ot=Ae!==T,tn=function bU(n){const t=[];return NP(n,t),t}((i.get(Ae)||uU).map(Fi=>Fi.getRealPlayer())).filter(Fi=>!!Fi.element&&Fi.element===Ae),Nt=a.get(Ae),un=p.get(Ae),Zn=cP(0,this._normalizer,0,fe.keyframes,Nt,un),ci=this._buildPlayer(fe,Zn,tn);if(fe.subTimeline&&r&&H.add(Ae),ot){const Fi=new vI(t,y,Ae);Fi.setRealPlayer(ci),P.push(Fi)}return ci});P.forEach(fe=>{Pc(this.playersByQueriedElement,fe.element,[]).push(fe),fe.onDone(()=>function fU(n,t,e){let i=n.get(t);if(i){if(i.length){const r=i.indexOf(e);i.splice(r,1)}0==i.length&&n.delete(t)}return i}(this.playersByQueriedElement,fe.element,fe))}),z.forEach(fe=>bu(fe,bP));const oe=vm(J);return oe.onDestroy(()=>{z.forEach(fe=>Sy(fe,bP)),ph(T,e.toStyles)}),H.forEach(fe=>{Pc(r,fe,[]).push(oe)}),oe}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new lx(t.duration,t.delay)}}class vI{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new lx,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>QE(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){Pc(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function KS(n){return n&&1===n.nodeType}function LP(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function OP(n,t,e,i,r){const a=[];e.forEach(T=>a.push(LP(T)));const p=[];i.forEach((T,P)=>{const z=new Map;T.forEach(H=>{const J=t.computeStyle(P,H,r);z.set(H,J),(!J||0==J.length)&&(P[_u]=dU,p.push(P))}),n.set(P,z)});let y=0;return e.forEach(T=>LP(T,a[y++])),p}function FP(n,t){const e=new Map;if(n.forEach(y=>e.set(y,[])),0==t.length)return e;const r=new Set(t),a=new Map;function p(y){if(!y)return 1;let T=a.get(y);if(T)return T;const P=y.parentNode;return T=e.has(P)?P:r.has(P)?1:p(P),a.set(y,T),T}return t.forEach(y=>{const T=p(y);1!==T&&e.get(T).push(y)}),e}function bu(n,t){var e;null===(e=n.classList)||void 0===e||e.add(t)}function Sy(n,t){var e;null===(e=n.classList)||void 0===e||e.remove(t)}function _U(n,t,e){vm(e).onDone(()=>n.processLeaveNode(t))}function NP(n,t){for(let e=0;e<n.length;e++){const i=n[e];i instanceof aP?NP(i.players,t):t.push(i)}}function BP(n,t,e){const i=e.get(n);if(!i)return!1;let r=t.get(n);return r?i.forEach(a=>r.add(a)):t.set(n,i),e.delete(n),!0}class JS{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,a)=>{},this._transitionEngine=new pU(t,e,i),this._timelineEngine=new oU(t,e,i),this._transitionEngine.onRemovalComplete=(r,a)=>this.onRemovalComplete(r,a)}registerTrigger(t,e,i,r,a){const p=t+"-"+r;let y=this._triggerCache[p];if(!y){const T=[],z=uI(this._driver,a,T,[]);if(T.length)throw function ij(n,t){return new ln(3404,!1)}();y=function tU(n,t,e){return new nU(n,t,e)}(r,z,this._normalizer),this._triggerCache[p]=y}this._transitionEngine.registerTrigger(e,r,y)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,r){this._transitionEngine.insertNode(t,e,i,r)}onRemove(t,e,i,r){this._transitionEngine.removeNode(t,e,r||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,r){if("@"==i.charAt(0)){const[a,p]=uP(i);this._timelineEngine.command(a,e,p,r)}else this._transitionEngine.trigger(t,e,i,r)}listen(t,e,i,r,a){if("@"==i.charAt(0)){const[p,y]=uP(i);return this._timelineEngine.listen(p,e,y,a)}return this._transitionEngine.listen(t,e,i,r,a)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let xU=(()=>{class n{constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r,this._state=0;let a=n.initialStylesByElement.get(e);a||n.initialStylesByElement.set(e,a=new Map),this._initialStyles=a}start(){this._state<1&&(this._startStyles&&ph(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ph(this._element,this._initialStyles),this._endStyles&&(ph(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(l_(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(l_(this._element,this._endStyles),this._endStyles=null),ph(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function xI(n){let t=null;return n.forEach((e,i)=>{(function wU(n){return"display"===n||"position"===n})(i)&&(t=t||new Map,t.set(i,e))}),t}class zP{constructor(t,e,i,r){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){return t.animate(this._convertKeyframesToObject(e),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:TP(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const e="start"===t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class SU{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,e){return!1}containsElement(t,e){return fP(t,e)}getParentElement(t){return iI(t)}query(t,e,i){return mP(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}animate(t,e,i,r,a,p=[]){const T={duration:i,delay:r,fill:0==r?"both":"forwards"};a&&(T.easing=a);const P=new Map,z=p.filter(oe=>oe instanceof zP);(function Ej(n,t){return 0===n||0===t})(i,r)&&z.forEach(oe=>{oe.currentSnapshot.forEach((fe,Ae)=>P.set(Ae,fe))});let H=function Sj(n){return n.length?n[0]instanceof Map?n:n.map(t=>yP(t)):[]}(e).map(oe=>xm(oe));H=function Ij(n,t,e){if(e.size&&t.length){let i=t[0],r=[];if(e.forEach((a,p)=>{i.has(p)||r.push(p),i.set(p,a)}),r.length)for(let a=1;a<t.length;a++){let p=t[a];r.forEach(y=>p.set(y,TP(n,y)))}}return t}(t,H,P);const J=function vU(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=xI(t[0]),t.length>1&&(i=xI(t[t.length-1]))):t instanceof Map&&(e=xI(t)),e||i?new xU(n,e,i):null}(t,H);return new zP(t,H,T,J)}}let TU=(()=>{class n extends iP{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:Sa.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(e)?oP(e):e;return VP(this._renderer,null,i,"register",[r]),new CU(i,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(mt(Og),mt(Mi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();class CU extends class O5{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new DU(this._id,t,e||{},this._renderer)}}class DU{constructor(t,e,i,r){this.id=t,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return VP(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function VP(n,t,e,i,r){return n.setProperty(t,`@@${e}:${i}`,r)}const jP="@.disabled";let EU=(()=>{class n{constructor(e,i,r){this.delegate=e,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(a,p)=>{const y=null==p?void 0:p.parentNode(a);y&&p.removeChild(y,a)}}createRenderer(e,i){const a=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let z=this._rendererCache.get(a);return z||(z=new UP("",a,this.engine,()=>this._rendererCache.delete(a)),this._rendererCache.set(a,z)),z}const p=i.id,y=i.id+"-"+this._currentId;this._currentId++,this.engine.register(y,e);const T=z=>{Array.isArray(z)?z.forEach(T):this.engine.registerTrigger(p,y,e,z.name,z)};return i.data.animation.forEach(T),new IU(this,y,a,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,r){e>=0&&e<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(a=>{const[p,y]=a;p(y)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(mt(Og),mt(JS),mt(Oi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();class UP{constructor(t,e,i,r){this.namespaceId=t,this.delegate=e,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?a=>e.destroyNode(a):null}get data(){return this.delegate.data}destroy(){var t;this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),null===(t=this._onDestroy)||void 0===t||t.call(this)}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,r=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,r){this.delegate.setAttribute(t,e,i,r)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,r){this.delegate.setStyle(t,e,i,r)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){"@"==e.charAt(0)&&e==jP?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class IU extends UP{constructor(t,e,i,r,a){super(e,i,r,a),this.factory=t,this.namespaceId=e}setProperty(t,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==jP?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if("@"==e.charAt(0)){const r=function MU(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let a=e.slice(1),p="";return"@"!=a.charAt(0)&&([a,p]=function AU(n){const t=n.indexOf(".");return[n.substring(0,t),n.slice(t+1)]}(a)),this.engine.listen(this.namespaceId,r,a,p,y=>{this.factory.scheduleListenerCallback(y._data||-1,i,y)})}return this.delegate.listen(t,e,i)}}const HP=[{provide:iP,useClass:TU},{provide:mI,useFactory:function kU(){return new Kj}},{provide:JS,useClass:(()=>{class n extends JS{constructor(e,i,r,a){super(e.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi),mt(rI),mt(mI),mt(xy))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})()},{provide:Og,useFactory:function PU(n,t,e){return new EU(n,t,e)},deps:[NS,JS,Oi]}],wI=[{provide:rI,useFactory:()=>new SU},{provide:ch,useValue:"BrowserAnimations"},...HP],GP=[{provide:rI,useClass:gP},{provide:ch,useValue:"NoopAnimations"},...HP];let LU=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?GP:wI}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:wI,imports:[Kk]}),n})();function si(...n){return ho(n,Bc(n))}function wm(n,t){return Ue(t)?Ti(n,t,1):Ti(n,1)}function go(n,t){return cr((e,i)=>{let r=0;e.subscribe(ur(i,a=>n.call(t,a,r++)&&i.next(a)))})}class qP{}class $P{}class Jp{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),a=r.toLowerCase(),p=e.slice(i+1).trim();this.maybeSetNormalizedName(r,a),this.headers.has(a)?this.headers.get(a).push(p):this.headers.set(a,[p])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const r=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof Jp?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new Jp;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Jp?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const a=t.value;if(a){let p=this.headers.get(e);if(!p)return;p=p.filter(y=>-1===a.indexOf(y)),0===p.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,p)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class OU{encodeKey(t){return WP(t)}encodeValue(t){return WP(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const NU=/%(\d[a-f0-9])/gi,BU={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function WP(n){return encodeURIComponent(n).replace(NU,(t,e)=>{var i;return null!==(i=BU[e])&&void 0!==i?i:t})}function eT(n){return`${n}`}class Sm{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new OU,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function FU(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const a=r.indexOf("="),[p,y]=-1==a?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,a)),t.decodeValue(r.slice(a+1))],T=e.get(p)||[];T.push(y),e.set(p,T)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],r=Array.isArray(i)?i.map(eT):[eT(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(a=>{e.push({param:i,value:a,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new Sm({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(eT(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(eT(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class zU{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function XP(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function ZP(n){return"undefined"!=typeof Blob&&n instanceof Blob}function YP(n){return"undefined"!=typeof FormData&&n instanceof FormData}class px{constructor(t,e,i,r){let a;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function VU(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,a=r):a=i,a&&(this.reportProgress=!!a.reportProgress,this.withCredentials=!!a.withCredentials,a.responseType&&(this.responseType=a.responseType),a.headers&&(this.headers=a.headers),a.context&&(this.context=a.context),a.params&&(this.params=a.params)),this.headers||(this.headers=new Jp),this.context||(this.context=new zU),this.params){const p=this.params.toString();if(0===p.length)this.urlWithParams=e;else{const y=e.indexOf("?");this.urlWithParams=e+(-1===y?"?":y<e.length-1?"&":"")+p}}else this.params=new Sm,this.urlWithParams=e}serializeBody(){return null===this.body?null:XP(this.body)||ZP(this.body)||YP(this.body)||function jU(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Sm?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||YP(this.body)?null:ZP(this.body)?this.body.type||null:XP(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Sm?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const i=t.method||this.method,r=t.url||this.url,a=t.responseType||this.responseType,p=void 0!==t.body?t.body:this.body,y=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,T=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let P=t.headers||this.headers,z=t.params||this.params;const H=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(P=Object.keys(t.setHeaders).reduce((J,oe)=>J.set(oe,t.setHeaders[oe]),P)),t.setParams&&(z=Object.keys(t.setParams).reduce((J,oe)=>J.set(oe,t.setParams[oe]),z)),new px(i,r,p,{params:z,headers:P,context:H,reportProgress:T,responseType:a,withCredentials:y})}}var sa=(()=>((sa=sa||{})[sa.Sent=0]="Sent",sa[sa.UploadProgress=1]="UploadProgress",sa[sa.ResponseHeader=2]="ResponseHeader",sa[sa.DownloadProgress=3]="DownloadProgress",sa[sa.Response=4]="Response",sa[sa.User=5]="User",sa))();class SI{constructor(t,e=200,i="OK"){this.headers=t.headers||new Jp,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class TI extends SI{constructor(t={}){super(t),this.type=sa.ResponseHeader}clone(t={}){return new TI({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class tT extends SI{constructor(t={}){super(t),this.type=sa.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new tT({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class KP extends SI{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function CI(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let JP=(()=>{class n{constructor(e){this.handler=e}request(e,i,r={}){let a;if(e instanceof px)a=e;else{let T,P;T=r.headers instanceof Jp?r.headers:new Jp(r.headers),r.params&&(P=r.params instanceof Sm?r.params:new Sm({fromObject:r.params})),a=new px(e,i,void 0!==r.body?r.body:null,{headers:T,context:r.context,params:P,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const p=si(a).pipe(wm(T=>this.handler.handle(T)));if(e instanceof px||"events"===r.observe)return p;const y=p.pipe(go(T=>T instanceof tT));switch(r.observe||"body"){case"body":switch(a.responseType){case"arraybuffer":return y.pipe(ge(T=>{if(null!==T.body&&!(T.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return T.body}));case"blob":return y.pipe(ge(T=>{if(null!==T.body&&!(T.body instanceof Blob))throw new Error("Response is not a Blob.");return T.body}));case"text":return y.pipe(ge(T=>{if(null!==T.body&&"string"!=typeof T.body)throw new Error("Response is not a string.");return T.body}));default:return y.pipe(ge(T=>T.body))}case"response":return y;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new Sm).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,CI(r,i))}post(e,i,r={}){return this.request("POST",e,CI(r,i))}put(e,i,r={}){return this.request("PUT",e,CI(r,i))}}return n.\u0275fac=function(e){return new(e||n)(mt(qP))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();class QP{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const eL=new Qt("HTTP_INTERCEPTORS");let UU=(()=>{class n{intercept(e,i){return i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();const HU=/^\)\]\}',?\n/;let tL=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new _n(i=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((oe,fe)=>r.setRequestHeader(oe,fe.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const oe=e.detectContentTypeHeader();null!==oe&&r.setRequestHeader("Content-Type",oe)}if(e.responseType){const oe=e.responseType.toLowerCase();r.responseType="json"!==oe?oe:"text"}const a=e.serializeBody();let p=null;const y=()=>{if(null!==p)return p;const oe=r.statusText||"OK",fe=new Jp(r.getAllResponseHeaders()),Ae=function GU(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||e.url;return p=new TI({headers:fe,status:r.status,statusText:oe,url:Ae}),p},T=()=>{let{headers:oe,status:fe,statusText:Ae,url:We}=y(),ot=null;204!==fe&&(ot=void 0===r.response?r.responseText:r.response),0===fe&&(fe=ot?200:0);let tn=fe>=200&&fe<300;if("json"===e.responseType&&"string"==typeof ot){const Nt=ot;ot=ot.replace(HU,"");try{ot=""!==ot?JSON.parse(ot):null}catch(un){ot=Nt,tn&&(tn=!1,ot={error:un,text:ot})}}tn?(i.next(new tT({body:ot,headers:oe,status:fe,statusText:Ae,url:We||void 0})),i.complete()):i.error(new KP({error:ot,headers:oe,status:fe,statusText:Ae,url:We||void 0}))},P=oe=>{const{url:fe}=y(),Ae=new KP({error:oe,status:r.status||0,statusText:r.statusText||"Unknown Error",url:fe||void 0});i.error(Ae)};let z=!1;const H=oe=>{z||(i.next(y()),z=!0);let fe={type:sa.DownloadProgress,loaded:oe.loaded};oe.lengthComputable&&(fe.total=oe.total),"text"===e.responseType&&!!r.responseText&&(fe.partialText=r.responseText),i.next(fe)},J=oe=>{let fe={type:sa.UploadProgress,loaded:oe.loaded};oe.lengthComputable&&(fe.total=oe.total),i.next(fe)};return r.addEventListener("load",T),r.addEventListener("error",P),r.addEventListener("timeout",P),r.addEventListener("abort",P),e.reportProgress&&(r.addEventListener("progress",H),null!==a&&r.upload&&r.upload.addEventListener("progress",J)),r.send(a),i.next({type:sa.Sent}),()=>{r.removeEventListener("error",P),r.removeEventListener("abort",P),r.removeEventListener("load",T),r.removeEventListener("timeout",P),e.reportProgress&&(r.removeEventListener("progress",H),null!==a&&r.upload&&r.upload.removeEventListener("progress",J)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(mt(Rk))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();const DI=new Qt("XSRF_COOKIE_NAME"),EI=new Qt("XSRF_HEADER_NAME");class nL{}let qU=(()=>{class n{constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=yk(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi),mt(fS),mt(DI))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),II=(()=>{class n{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(e);const a=this.tokenService.getToken();return null!==a&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,a)})),i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(mt(nL),mt(EI))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),$U=(()=>{class n{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(eL,[]);this.chain=i.reduceRight((r,a)=>new QP(r,a),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(mt($P),mt(jo))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),WU=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:II,useClass:UU}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:DI,useValue:e.cookieName}:[],e.headerName?{provide:EI,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[II,{provide:eL,useExisting:II,multi:!0},{provide:nL,useClass:qU},{provide:DI,useValue:"XSRF-TOKEN"},{provide:EI,useValue:"X-XSRF-TOKEN"}]}),n})(),XU=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[JP,{provide:qP,useClass:$U},tL,{provide:$P,useExisting:tL}],imports:[WU.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})();const{isArray:ZU}=Array,{getPrototypeOf:YU,prototype:KU,keys:JU}=Object;function iL(n){if(1===n.length){const t=n[0];if(ZU(t))return{args:t,keys:null};if(function QU(n){return n&&"object"==typeof n&&YU(n)===KU}(t)){const e=JU(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:eH}=Array;function MI(n){return ge(t=>function tH(n,t){return eH(t)?n(...t):n(t)}(n,t))}function rL(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function oL(...n){const t=Cl(n),{args:e,keys:i}=iL(n),r=new _n(a=>{const{length:p}=e;if(!p)return void a.complete();const y=new Array(p);let T=p,P=p;for(let z=0;z<p;z++){let H=!1;qt(e[z]).subscribe(ur(a,J=>{H||(H=!0,P--),y[z]=J},()=>T--,void 0,()=>{(!T||!H)&&(P||a.next(i?rL(i,y):y),a.complete())}))}});return t?r.pipe(MI(t)):r}let sL=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return n.\u0275fac=function(e){return new(e||n)(le(uu),le(ei))},n.\u0275dir=cn({type:n}),n})(),u_=(()=>{class n extends sL{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,features:[zn]}),n})();const Vl=new Qt("NgValueAccessor"),iH={provide:Vl,useExisting:dr(()=>yu),multi:!0},oH=new Qt("CompositionEventMode");let yu=(()=>{class n extends sL{constructor(e,i,r){super(e,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function rH(){const n=hh()?hh().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return n.\u0275fac=function(e){return new(e||n)(le(uu),le(ei),le(oH,8))},n.\u0275dir=cn({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,i){1&e&&Zt("input",function(a){return i._handleInput(a.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(a){return i._compositionEnd(a.target.value)})},features:[wi([iH]),zn]}),n})();function Tm(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function lL(n){return null!=n&&"number"==typeof n.length}const Fa=new Qt("NgValidators"),Cm=new Qt("NgAsyncValidators"),aH=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class AI{static min(t){return function cL(n){return t=>{if(Tm(t.value)||Tm(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}(t)}static max(t){return function uL(n){return t=>{if(Tm(t.value)||Tm(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}(t)}static required(t){return dL(t)}static requiredTrue(t){return hL(t)}static email(t){return function pL(n){return Tm(n.value)||aH.test(n.value)?null:{email:!0}}(t)}static minLength(t){return function fL(n){return t=>Tm(t.value)||!lL(t.value)?null:t.value.length<n?{minlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function mL(n){return t=>lL(t.value)&&t.value.length>n?{maxlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static pattern(t){return function gL(n){if(!n)return nT;let t,e;return"string"==typeof n?(e="","^"!==n.charAt(0)&&(e+="^"),e+=n,"$"!==n.charAt(n.length-1)&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(Tm(i.value))return null;const r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(t)}static nullValidator(t){return null}static compose(t){return wL(t)}static composeAsync(t){return SL(t)}}function dL(n){return Tm(n.value)?{required:!0}:null}function hL(n){return!0===n.value?null:{required:!0}}function nT(n){return null}function _L(n){return null!=n}function bL(n){return Ya(n)?ho(n):n}function yL(n){let t={};return n.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function vL(n,t){return t.map(e=>e(n))}function xL(n){return n.map(t=>function lH(n){return!n.validate}(t)?t:e=>t.validate(e))}function wL(n){if(!n)return null;const t=n.filter(_L);return 0==t.length?null:function(e){return yL(vL(e,t))}}function RI(n){return null!=n?wL(xL(n)):null}function SL(n){if(!n)return null;const t=n.filter(_L);return 0==t.length?null:function(e){return oL(vL(e,t).map(bL)).pipe(ge(yL))}}function kI(n){return null!=n?SL(xL(n)):null}function TL(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function CL(n){return n._rawValidators}function DL(n){return n._rawAsyncValidators}function PI(n){return n?Array.isArray(n)?n:[n]:[]}function iT(n,t){return Array.isArray(n)?n.includes(t):n===t}function EL(n,t){const e=PI(t);return PI(n).forEach(r=>{iT(e,r)||e.push(r)}),e}function IL(n,t){return PI(t).filter(e=>!iT(n,e))}class ML{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=RI(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=kI(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class Oc extends ML{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class jl extends ML{get formDirective(){return null}get path(){return null}}let sd=(()=>{class n extends class AL{constructor(t){this._cd=t}get isTouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.touched)}get isUntouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.untouched)}get isPristine(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pristine)}get isDirty(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.dirty)}get isValid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.valid)}get isInvalid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.invalid)}get isPending(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pending)}get isSubmitted(){var t;return!(null===(t=this._cd)||void 0===t||!t.submitted)}}{constructor(e){super(e)}}return n.\u0275fac=function(e){return new(e||n)(le(Oc,2))},n.\u0275dir=cn({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,i){2&e&&l("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[zn]}),n})();const fx="VALID",oT="INVALID",Ty="PENDING",mx="DISABLED";function NI(n){return(sT(n)?n.validators:n)||null}function kL(n){return Array.isArray(n)?RI(n):n||null}function BI(n,t){return(sT(t)?t.asyncValidators:n)||null}function PL(n){return Array.isArray(n)?kI(n):n||null}function sT(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class FL{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=kL(this._rawValidators),this._composedAsyncValidatorFn=PL(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===fx}get invalid(){return this.status===oT}get pending(){return this.status==Ty}get disabled(){return this.status===mx}get enabled(){return this.status!==mx}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=kL(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=PL(t)}addValidators(t){this.setValidators(EL(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(EL(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(IL(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(IL(t,this._rawAsyncValidators))}hasValidator(t){return iT(this._rawValidators,t)}hasAsyncValidator(t){return iT(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Ty,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=mx,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=fx,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===fx||this.status===Ty)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?mx:fx}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Ty,this._hasOwnPendingAsyncValidator=!0;const e=bL(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Cn,this.statusChanges=new Cn}_calculateStatus(){return this._allControlsDisabled()?mx:this.errors?oT:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ty)?Ty:this._anyControlsHaveStatus(oT)?oT:fx}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){sT(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}class zI extends FL{constructor(t,e,i){super(NI(e),BI(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){(function OL(n,t,e){n._forEachChild((i,r)=>{if(void 0===e[r])throw new ln(1002,"")})})(this,0,t),Object.keys(t).forEach(i=>{(function LL(n,t,e){const i=n.controls;if(!(t?Object.keys(i):i).length)throw new ln(1e3,"");if(!i[e])throw new ln(1001,"")})(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(i=>{const r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,a)=>{i=e(i,r,a)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}function gx(n,t){var e,i;VI(n,t),t.valueAccessor.writeValue(n.value),n.disabled&&(null===(i=(e=t.valueAccessor).setDisabledState)||void 0===i||i.call(e,!0)),function bH(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&NL(n,t)})}(n,t),function vH(n,t){const e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function yH(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&NL(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function _H(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function lT(n,t,e=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),uT(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function cT(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function VI(n,t){const e=CL(n);null!==t.validator?n.setValidators(TL(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=DL(n);null!==t.asyncValidator?n.setAsyncValidators(TL(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();cT(t._rawValidators,r),cT(t._rawAsyncValidators,r)}function uT(n,t){let e=!1;if(null!==n){if(null!==t.validator){const r=CL(n);if(Array.isArray(r)&&r.length>0){const a=r.filter(p=>p!==t.validator);a.length!==r.length&&(e=!0,n.setValidators(a))}}if(null!==t.asyncValidator){const r=DL(n);if(Array.isArray(r)&&r.length>0){const a=r.filter(p=>p!==t.asyncValidator);a.length!==r.length&&(e=!0,n.setAsyncValidators(a))}}}const i=()=>{};return cT(t._rawValidators,i),cT(t._rawAsyncValidators,i),e}function NL(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function BL(n,t){VI(n,t)}function jI(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}function VL(n,t){n._syncPendingControls(),t.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function UI(n,t){if(!t)return null;let e,i,r;return Array.isArray(t),t.forEach(a=>{a.constructor===yu?e=a:function SH(n){return Object.getPrototypeOf(n.constructor)===u_}(a)?i=a:r=a}),r||i||e||null}const CH={provide:jl,useExisting:dr(()=>Cy)},_x=(()=>Promise.resolve())();let Cy=(()=>{class n extends jl{constructor(e,i){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new Cn,this.form=new zI({},RI(e),kI(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){_x.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),gx(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){_x.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){_x.then(()=>{const i=this._findContainer(e.path),r=new zI({});BL(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){_x.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){_x.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){var i;return this.submitted=!0,VL(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return n.\u0275fac=function(e){return new(e||n)(le(Fa,10),le(Cm,10))},n.\u0275dir=cn({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,i){1&e&&Zt("submit",function(a){return i.onSubmit(a)})("reset",function(){return i.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[wi([CH]),zn]}),n})();function jL(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function UL(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const Qp=class extends FL{constructor(t=null,e,i){super(NI(e),BI(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),sT(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=UL(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){jL(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){jL(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){UL(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},IH={provide:Oc,useExisting:dr(()=>fh)},qL=(()=>Promise.resolve())();let fh=(()=>{class n extends Oc{constructor(e,i,r,a,p){super(),this._changeDetectorRef=p,this.control=new Qp,this._registered=!1,this.update=new Cn,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=UI(0,a)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),jI(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){gx(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){qL.then(()=>{var i;this.control.setValue(e,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&Wp(i);qL.then(()=>{var a;r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),null===(a=this._changeDetectorRef)||void 0===a||a.markForCheck()})}_getPath(e){return this._parent?function aT(n,t){return[...t.path,n]}(e,this._parent):[e]}}return n.\u0275fac=function(e){return new(e||n)(le(jl,9),le(Fa,10),le(Cm,10),le(Vl,10),le(lo,8))},n.\u0275dir=cn({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[wi([IH]),zn,xo]}),n})(),WL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({}),n})();const HI=new Qt("NgModelWithFormControlWarning"),LH={provide:Oc,useExisting:dr(()=>Dy)};let Dy=(()=>{class n extends Oc{constructor(e,i,r,a){super(),this._ngModelWarningConfig=a,this.update=new Cn,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=UI(0,r)}set isDisabled(e){}ngOnChanges(e){if(this._isControlChanged(e)){const i=e.form.previousValue;i&&lT(i,this,!1),gx(this.form,this),this.form.updateValueAndValidity({emitEvent:!1})}jI(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&lT(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)(le(Fa,10),le(Cm,10),le(Vl,10),le(HI,8))},n.\u0275dir=cn({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[wi([LH]),zn,xo]}),n})();const OH={provide:jl,useExisting:dr(()=>Ey)};let Ey=(()=>{class n extends jl{constructor(e,i){super(),this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Cn,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(uT(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return gx(i,e),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){lT(e.control||null,e,!1),function TH(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){var i;return this.submitted=!0,VL(this.form,this.directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(lT(i||null,e),(n=>n instanceof Qp)(r)&&(gx(r,e),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);BL(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function xH(n,t){return uT(n,t)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){VI(this.form,this),this._oldForm&&uT(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(e){return new(e||n)(le(Fa,10),le(Cm,10))},n.\u0275dir=cn({type:n,selectors:[["","formGroup",""]],hostBindings:function(e,i){1&e&&Zt("submit",function(a){return i.onSubmit(a)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[wi([OH]),zn,xo]}),n})(),d_=(()=>{class n{constructor(){this._validator=nT}ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):nT,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,features:[xo]}),n})();const WH={provide:Fa,useExisting:dr(()=>XI),multi:!0},XH={provide:Fa,useExisting:dr(()=>ZI),multi:!0};let XI=(()=>{class n extends d_{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Wp,this.createValidator=e=>dL}enabled(e){return e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,i){2&e&&Yn("required",i._enabled?"":null)},inputs:{required:"required"},features:[wi([WH]),zn]}),n})(),ZI=(()=>{class n extends XI{constructor(){super(...arguments),this.createValidator=e=>hL}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(e,i){2&e&&Yn("required",i._enabled?"":null)},features:[wi([XH]),zn]}),n})(),lO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[WL]}),n})(),QH=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[lO]}),n})(),e8=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:HI,useValue:e.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[lO]}),n})();class Qa extends fn{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}const dT=et(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function h_(...n){const t=Bc(n),e=Cl(n),{args:i,keys:r}=iL(n);if(0===i.length)return ho([],t);const a=new _n(function n8(n,t,e=Wt){return i=>{cO(t,()=>{const{length:r}=n,a=new Array(r);let p=r,y=r;for(let T=0;T<r;T++)cO(t,()=>{const P=ho(n[T],t);let z=!1;P.subscribe(ur(i,H=>{a[T]=H,z||(z=!0,y--),y||i.next(e(a.slice()))},()=>{--p||i.complete()}))},i)},i)}}(i,t,r?p=>rL(r,p):Wt));return e?a.pipe(MI(e)):a}function cO(n,t,e){n?ki(e,n,t):t()}function bx(...n){return function i8(){return xr(1)}()(ho(n,Bc(n)))}function p_(n){return new _n(t=>{qt(n()).subscribe(t)})}function Iy(n,t){const e=Ue(n)?n:()=>n,i=r=>r.error(e());return new _n(t?r=>t.schedule(i,0,r):i)}function YI(){return cr((n,t)=>{let e=null;n._refCount++;const i=ur(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const r=n._connection,a=e;e=null,r&&(!a||r===a)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class KI extends _n{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Fs(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Qe;const e=this.getSubject();t.add(this.source.subscribe(ur(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Qe.EMPTY)}return t}refCount(){return YI()(this)}}function el(n,t){return cr((e,i)=>{let r=null,a=0,p=!1;const y=()=>p&&!r&&i.complete();e.subscribe(ur(i,T=>{null==r||r.unsubscribe();let P=0;const z=a++;qt(n(T,z)).subscribe(r=ur(i,H=>i.next(t?t(T,H,z,P++):H),()=>{r=null,y()}))},()=>{p=!0,y()}))})}function ko(n){return n<=0?()=>uo:cr((t,e)=>{let i=0;t.subscribe(ur(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function va(...n){const t=Bc(n);return cr((e,i)=>{(t?bx(n,e,t):bx(n,e)).subscribe(i)})}function hT(n){return cr((t,e)=>{let i=!1;t.subscribe(ur(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function uO(n=r8){return cr((t,e)=>{let i=!1;t.subscribe(ur(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function r8(){return new dT}function Dm(n,t){const e=arguments.length>=2;return i=>i.pipe(n?go((r,a)=>n(r,a,i)):Wt,ko(1),e?hT(t):uO(()=>new dT))}function ks(n,t,e){const i=Ue(n)||t||e?{next:n,error:t,complete:e}:n;return i?cr((r,a)=>{var p;null===(p=i.subscribe)||void 0===p||p.call(i);let y=!0;r.subscribe(ur(a,T=>{var P;null===(P=i.next)||void 0===P||P.call(i,T),a.next(T)},()=>{var T;y=!1,null===(T=i.complete)||void 0===T||T.call(i),a.complete()},T=>{var P;y=!1,null===(P=i.error)||void 0===P||P.call(i,T),a.error(T)},()=>{var T,P;y&&(null===(T=i.unsubscribe)||void 0===T||T.call(i)),null===(P=i.finalize)||void 0===P||P.call(i)}))}):Wt}function ef(n){return cr((t,e)=>{let a,i=null,r=!1;i=t.subscribe(ur(e,void 0,void 0,p=>{a=qt(n(p,ef(n)(t))),i?(i.unsubscribe(),i=null,a.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,a.subscribe(e))})}function o8(n,t,e,i,r){return(a,p)=>{let y=e,T=t,P=0;a.subscribe(ur(p,z=>{const H=P++;T=y?n(T,z,H):(y=!0,z),i&&p.next(T)},r&&(()=>{y&&p.next(T),p.complete()})))}}function dO(n,t){return cr(o8(n,t,arguments.length>=2,!0))}function JI(n){return n<=0?()=>uo:cr((t,e)=>{let i=[];t.subscribe(ur(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function hO(n,t){const e=arguments.length>=2;return i=>i.pipe(n?go((r,a)=>n(r,a,i)):Wt,JI(1),e?hT(t):uO(()=>new dT))}function pO(n,t=!1){return cr((e,i)=>{let r=0;e.subscribe(ur(i,a=>{const p=n(a,r++);(p||t)&&i.next(a),!p&&i.complete()}))})}function yx(n){return ge(()=>n)}function pT(n){return cr((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}const Vr="primary",vx=Symbol("RouteTitle");class s8{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function My(n){return new s8(n)}function a8(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const r={};for(let a=0;a<i.length;a++){const p=i[a],y=n[a];if(p.startsWith(":"))r[p.substring(1)]=y;else if(p!==y.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function mh(n,t){const e=n?Object.keys(n):void 0,i=t?Object.keys(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let a=0;a<e.length;a++)if(r=e[a],!fO(n[r],t[r]))return!1;return!0}function fO(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((r,a)=>i[a]===r)}return n===t}function mO(n){return Array.prototype.concat.apply([],n)}function gO(n){return n.length>0?n[n.length-1]:null}function tl(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function Em(n){return t_(n)?n:Ya(n)?ho(Promise.resolve(n)):si(n)}const u8={exact:function yO(n,t,e){if(!m_(n.segments,t.segments)||!fT(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!yO(n.children[i],t.children[i],e))return!1;return!0},subset:vO},_O={exact:function d8(n,t){return mh(n,t)},subset:function h8(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>fO(n[e],t[e]))},ignored:()=>!0};function bO(n,t,e){return u8[e.paths](n.root,t.root,e.matrixParams)&&_O[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function vO(n,t,e){return xO(n,t,t.segments,e)}function xO(n,t,e,i){if(n.segments.length>e.length){const r=n.segments.slice(0,e.length);return!(!m_(r,e)||t.hasChildren()||!fT(r,e,i))}if(n.segments.length===e.length){if(!m_(n.segments,e)||!fT(n.segments,e,i))return!1;for(const r in t.children)if(!n.children[r]||!vO(n.children[r],t.children[r],i))return!1;return!0}{const r=e.slice(0,n.segments.length),a=e.slice(n.segments.length);return!!(m_(n.segments,r)&&fT(n.segments,r,i)&&n.children[Vr])&&xO(n.children[Vr],t,a,i)}}function fT(n,t,e){return t.every((i,r)=>_O[e](n[r].parameters,i.parameters))}class f_{constructor(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=My(this.queryParams)),this._queryParamMap}toString(){return m8.serialize(this)}}class qr{constructor(t,e){this.segments=t,this.children=e,this.parent=null,tl(e,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return mT(this)}}class xx{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=My(this.parameters)),this._parameterMap}toString(){return CO(this)}}function m_(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}let wO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:function(){return new eM},providedIn:"root"}),n})();class eM{parse(t){const e=new T8(t);return new f_(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${wx(t.root,!0)}`,i=function b8(n){const t=Object.keys(n).map(e=>{const i=n[e];return Array.isArray(i)?i.map(r=>`${gT(e)}=${gT(r)}`).join("&"):`${gT(e)}=${gT(i)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function g8(n){return encodeURI(n)}(t.fragment)}`:""}`}}const m8=new eM;function mT(n){return n.segments.map(t=>CO(t)).join("/")}function wx(n,t){if(!n.hasChildren())return mT(n);if(t){const e=n.children[Vr]?wx(n.children[Vr],!1):"",i=[];return tl(n.children,(r,a)=>{a!==Vr&&i.push(`${a}:${wx(r,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function f8(n,t){let e=[];return tl(n.children,(i,r)=>{r===Vr&&(e=e.concat(t(i,r)))}),tl(n.children,(i,r)=>{r!==Vr&&(e=e.concat(t(i,r)))}),e}(n,(i,r)=>r===Vr?[wx(n.children[Vr],!1)]:[`${r}:${wx(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Vr]?`${mT(n)}/${e[0]}`:`${mT(n)}/(${e.join("//")})`}}function SO(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function gT(n){return SO(n).replace(/%3B/gi,";")}function tM(n){return SO(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function _T(n){return decodeURIComponent(n)}function TO(n){return _T(n.replace(/\+/g,"%20"))}function CO(n){return`${tM(n.path)}${function _8(n){return Object.keys(n).map(t=>`;${tM(t)}=${tM(n[t])}`).join("")}(n.parameters)}`}const y8=/^[^\/()?;=#]+/;function bT(n){const t=n.match(y8);return t?t[0]:""}const v8=/^[^=?&#]+/,w8=/^[^&#]+/;class T8{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new qr([],{}):new qr([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[Vr]=new qr(t,e)),i}parseSegment(){const t=bT(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new ln(4009,!1);return this.capture(t),new xx(_T(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=bT(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=bT(this.remaining);r&&(i=r,this.capture(i))}t[_T(e)]=_T(i)}parseQueryParam(t){const e=function x8(n){const t=n.match(v8);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const p=function S8(n){const t=n.match(w8);return t?t[0]:""}(this.remaining);p&&(i=p,this.capture(i))}const r=TO(e),a=TO(i);if(t.hasOwnProperty(r)){let p=t[r];Array.isArray(p)||(p=[p],t[r]=p),p.push(a)}else t[r]=a}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=bT(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new ln(4010,!1);let a;i.indexOf(":")>-1?(a=i.slice(0,i.indexOf(":")),this.capture(a),this.capture(":")):t&&(a=Vr);const p=this.parseChildren();e[a]=1===Object.keys(p).length?p[Vr]:new qr([],p),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new ln(4011,!1)}}function nM(n){return n.segments.length>0?new qr([],{[Vr]:n}):n}function yT(n){const t={};for(const i of Object.keys(n.children)){const a=yT(n.children[i]);(a.segments.length>0||a.hasChildren())&&(t[i]=a)}return function C8(n){if(1===n.numberOfChildren&&n.children[Vr]){const t=n.children[Vr];return new qr(n.segments.concat(t.segments),t.children)}return n}(new qr(n.segments,t))}function g_(n){return n instanceof f_}function I8(n,t,e,i,r){var a;if(0===e.length)return Ay(t.root,t.root,t.root,i,r);const y=function IO(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new EO(!0,0,n);let t=0,e=!1;const i=n.reduce((r,a,p)=>{if("object"==typeof a&&null!=a){if(a.outlets){const y={};return tl(a.outlets,(T,P)=>{y[P]="string"==typeof T?T.split("/"):T}),[...r,{outlets:y}]}if(a.segmentPath)return[...r,a.segmentPath]}return"string"!=typeof a?[...r,a]:0===p?(a.split("/").forEach((y,T)=>{0==T&&"."===y||(0==T&&""===y?e=!0:".."===y?t++:""!=y&&r.push(y))}),r):[...r,a]},[]);return new EO(e,t,i)}(e);return y.toRoot()?Ay(t.root,t.root,new qr([],{}),i,r):function T(z){var H;const J=function A8(n,t,e,i){if(n.isAbsolute)return new Ry(t.root,!0,0);if(-1===i)return new Ry(e,e===t.root,0);return function MO(n,t,e){let i=n,r=t,a=e;for(;a>r;){if(a-=r,i=i.parent,!i)throw new ln(4005,!1);r=i.segments.length}return new Ry(i,!1,r-a)}(e,i+(Sx(n.commands[0])?0:1),n.numberOfDoubleDots)}(y,t,null===(H=n.snapshot)||void 0===H?void 0:H._urlSegment,z),oe=J.processChildren?Cx(J.segmentGroup,J.index,y.commands):rM(J.segmentGroup,J.index,y.commands);return Ay(t.root,J.segmentGroup,oe,i,r)}(null===(a=n.snapshot)||void 0===a?void 0:a._lastPathIndex)}function Sx(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Tx(n){return"object"==typeof n&&null!=n&&n.outlets}function Ay(n,t,e,i,r){let p,a={};i&&tl(i,(T,P)=>{a[P]=Array.isArray(T)?T.map(z=>`${z}`):`${T}`}),p=n===t?e:DO(n,t,e);const y=nM(yT(p));return new f_(y,a,r)}function DO(n,t,e){const i={};return tl(n.children,(r,a)=>{i[a]=r===t?e:DO(r,t,e)}),new qr(n.segments,i)}class EO{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&Sx(i[0]))throw new ln(4003,!1);const r=i.find(Tx);if(r&&r!==gO(i))throw new ln(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Ry{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function rM(n,t,e){if(n||(n=new qr([],{})),0===n.segments.length&&n.hasChildren())return Cx(n,t,e);const i=function k8(n,t,e){let i=0,r=t;const a={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return a;const p=n.segments[r],y=e[i];if(Tx(y))break;const T=`${y}`,P=i<e.length-1?e[i+1]:null;if(r>0&&void 0===T)break;if(T&&P&&"object"==typeof P&&void 0===P.outlets){if(!RO(T,P,p))return a;i+=2}else{if(!RO(T,{},p))return a;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const a=new qr(n.segments.slice(0,i.pathIndex),{});return a.children[Vr]=new qr(n.segments.slice(i.pathIndex),n.children),Cx(a,0,r)}return i.match&&0===r.length?new qr(n.segments,{}):i.match&&!n.hasChildren()?oM(n,t,e):i.match?Cx(n,0,r):oM(n,t,e)}function Cx(n,t,e){if(0===e.length)return new qr(n.segments,{});{const i=function R8(n){return Tx(n[0])?n[0].outlets:{[Vr]:n}}(e),r={};return tl(i,(a,p)=>{"string"==typeof a&&(a=[a]),null!==a&&(r[p]=rM(n.children[p],t,a))}),tl(n.children,(a,p)=>{void 0===i[p]&&(r[p]=a)}),new qr(n.segments,r)}}function oM(n,t,e){const i=n.segments.slice(0,t);let r=0;for(;r<e.length;){const a=e[r];if(Tx(a)){const T=P8(a.outlets);return new qr(i,T)}if(0===r&&Sx(e[0])){i.push(new xx(n.segments[t].path,AO(e[0]))),r++;continue}const p=Tx(a)?a.outlets[Vr]:`${a}`,y=r<e.length-1?e[r+1]:null;p&&y&&Sx(y)?(i.push(new xx(p,AO(y))),r+=2):(i.push(new xx(p,{})),r++)}return new qr(i,{})}function P8(n){const t={};return tl(n,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[i]=oM(new qr([],{}),0,e))}),t}function AO(n){const t={};return tl(n,(e,i)=>t[i]=`${e}`),t}function RO(n,t,e){return n==e.path&&mh(t,e.parameters)}class tf{constructor(t,e){this.id=t,this.url=e}}class sM extends tf{constructor(t,e,i="imperative",r=null){super(t,e),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class __ extends tf{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class vT extends tf{constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class kO extends tf{constructor(t,e,i,r){super(t,e),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class L8 extends tf{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class O8 extends tf{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class F8 extends tf{constructor(t,e,i,r,a){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=a,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class N8 extends tf{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class B8 extends tf{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class z8{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class V8{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class j8{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class U8{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class H8{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class G8{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class PO{constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class LO{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=aM(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=aM(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=lM(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return lM(t,this._root).map(e=>e.value)}}function aM(n,t){if(n===t.value)return t;for(const e of t.children){const i=aM(n,e);if(i)return i}return null}function lM(n,t){if(n===t.value)return[t];for(const e of t.children){const i=lM(n,e);if(i.length)return i.unshift(t),i}return[]}class nf{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function ky(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class OO extends LO{constructor(t,e){super(t),this.snapshot=e,cM(this,t)}toString(){return this.snapshot.toString()}}function FO(n,t){const e=function $8(n,t){const p=new xT([],{},{},"",{},Vr,t,null,n.root,-1,{});return new BO("",new nf(p,[]))}(n,t),i=new Qa([new xx("",{})]),r=new Qa({}),a=new Qa({}),p=new Qa({}),y=new Qa(""),T=new b_(i,r,p,y,a,Vr,t,e.root);return T.snapshot=e.root,new OO(new nf(T,[]),e)}class b_{constructor(t,e,i,r,a,p,y,T){var P,z;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=a,this.outlet=p,this.component=y,this.title=null!==(z=null===(P=this.data)||void 0===P?void 0:P.pipe(ge(H=>H[vx])))&&void 0!==z?z:si(void 0),this._futureSnapshot=T}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(ge(t=>My(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(ge(t=>My(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function NO(n,t="emptyOnly"){const e=n.pathFromRoot;let i=0;if("always"!==t)for(i=e.length-1;i>=1;){const r=e[i],a=e[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(a.component)break;i--}}return function W8(n){return n.reduce((t,e)=>{var i;return{params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign(Object.assign(Object.assign({},e.data),t.resolve),null===(i=e.routeConfig)||void 0===i?void 0:i.data),e._resolvedData)}},{params:{},data:{},resolve:{}})}(e.slice(i))}class xT{constructor(t,e,i,r,a,p,y,T,P,z,H,J){var oe;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=a,this.outlet=p,this.component=y,this.title=null===(oe=this.data)||void 0===oe?void 0:oe[vx],this.routeConfig=T,this._urlSegment=P,this._lastPathIndex=z,this._correctedLastPathIndex=null!=J?J:z,this._resolve=H}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=My(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=My(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class BO extends LO{constructor(t,e){super(e),this.url=t,cM(this,e)}toString(){return zO(this._root)}}function cM(n,t){t.value._routerState=n,t.children.forEach(e=>cM(n,e))}function zO(n){const t=n.children.length>0?` { ${n.children.map(zO).join(", ")} } `:"";return`${n.value}${t}`}function uM(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,mh(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),mh(t.params,e.params)||n.params.next(e.params),function l8(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!mh(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),mh(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function dM(n,t){const e=mh(n.params,t.params)&&function p8(n,t){return m_(n,t)&&n.every((e,i)=>mh(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||dM(n.parent,t.parent))}function Dx(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const r=function Z8(n,t,e){return t.children.map(i=>{for(const r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return Dx(n,i,r);return Dx(n,i)})}(n,t,e);return new nf(i,r)}{if(n.shouldAttach(t.value)){const a=n.retrieve(t.value);if(null!==a){const p=a.route;return p.value._futureSnapshot=t.value,p.children=t.children.map(y=>Dx(n,y)),p}}const i=function Y8(n){return new b_(new Qa(n.url),new Qa(n.params),new Qa(n.queryParams),new Qa(n.fragment),new Qa(n.data),n.outlet,n.component,n)}(t.value),r=t.children.map(a=>Dx(n,a));return new nf(i,r)}}const hM="ngNavigationCancelingError";function VO(n,t){const{redirectTo:e,navigationBehaviorOptions:i}=g_(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=jO(!1,0,t);return r.url=e,r.navigationBehaviorOptions=i,r}function jO(n,t,e){const i=new Error("NavigationCancelingError: "+(n||""));return i[hM]=!0,i.cancellationCode=t,e&&(i.url=e),i}function UO(n){return HO(n)&&g_(n.url)}function HO(n){return n&&n[hM]}class K8{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Ex,this.attachRef=null}}let Ex=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(e,i){const r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){const i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new K8,this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const wT=!1;let pM=(()=>{class n{constructor(e,i,r,a,p){this.parentContexts=e,this.location=i,this.changeDetector=a,this.environmentInjector=p,this.activated=null,this._activatedRoute=null,this.activateEvents=new Cn,this.deactivateEvents=new Cn,this.attachEvents=new Cn,this.detachEvents=new Cn,this.name=r||Vr,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){var e;(null===(e=this.parentContexts.getContext(this.name))||void 0===e?void 0:e.outlet)===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ln(4012,wT);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ln(4012,wT);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ln(4012,wT);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new ln(4013,wT);this._activatedRoute=e;const r=this.location,p=e._futureSnapshot.component,y=this.parentContexts.getOrCreateContext(this.name).children,T=new J8(e,y,r.injector);if(i&&function Q8(n){return!!n.resolveComponentFactory}(i)){const P=i.resolveComponentFactory(p);this.activated=r.createComponent(P,r.length,T)}else this.activated=r.createComponent(p,{index:r.length,injector:T,environmentInjector:null!=i?i:this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)(le(Ex),le(Rs),us("name"),le(lo),le(Wu))},n.\u0275dir=cn({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),n})();class J8{constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===b_?this.route:t===Ex?this.childContexts:this.parent.get(t,e)}}let fM=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["ng-component"]],standalone:!0,features:[HR],decls:1,vars:0,template:function(e,i){1&e&&dn(0,"router-outlet")},dependencies:[pM],encapsulation:2}),n})();function GO(n,t){var e;return n.providers&&!n._injector&&(n._injector=aS(n.providers,t,`Route: ${n.path}`)),null!==(e=n._injector)&&void 0!==e?e:t}function gM(n){const t=n.children&&n.children.map(gM),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==Vr&&(e.component=fM),e}function vu(n){return n.outlet||Vr}function qO(n,t){const e=n.filter(i=>vu(i)===t);return e.push(...n.filter(i=>vu(i)!==t)),e}function Ix(n){var t;if(!n)return null;if(null!==(t=n.routeConfig)&&void 0!==t&&t._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const i=e.routeConfig;if(null!=i&&i._loadedInjector)return i._loadedInjector;if(null!=i&&i._injector)return i._injector}return null}class rG{constructor(t,e,i,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),uM(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const r=ky(e);t.children.forEach(a=>{const p=a.value.outlet;this.deactivateRoutes(a,r[p],i),delete r[p]}),tl(r,(a,p)=>{this.deactivateRouteAndItsChildren(a,i)})}deactivateRoutes(t,e,i){const r=t.value,a=e?e.value:null;if(r===a)if(r.component){const p=i.getContext(r.outlet);p&&this.deactivateChildRoutes(t,e,p.children)}else this.deactivateChildRoutes(t,e,i);else a&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,a=ky(t);for(const p of Object.keys(a))this.deactivateRouteAndItsChildren(a[p],r);if(i&&i.outlet){const p=i.outlet.detach(),y=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:p,route:t,contexts:y})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,a=ky(t);for(const p of Object.keys(a))this.deactivateRouteAndItsChildren(a[p],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,e,i){const r=ky(e);t.children.forEach(a=>{this.activateRoutes(a,r[a.value.outlet],i),this.forwardEvent(new G8(a.value.snapshot))}),t.children.length&&this.forwardEvent(new U8(t.value.snapshot))}activateRoutes(t,e,i){var r;const a=t.value,p=e?e.value:null;if(uM(a),a===p)if(a.component){const y=i.getOrCreateContext(a.outlet);this.activateChildRoutes(t,e,y.children)}else this.activateChildRoutes(t,e,i);else if(a.component){const y=i.getOrCreateContext(a.outlet);if(this.routeReuseStrategy.shouldAttach(a.snapshot)){const T=this.routeReuseStrategy.retrieve(a.snapshot);this.routeReuseStrategy.store(a.snapshot,null),y.children.onOutletReAttached(T.contexts),y.attachRef=T.componentRef,y.route=T.route.value,y.outlet&&y.outlet.attach(T.componentRef,T.route.value),uM(T.route.value),this.activateChildRoutes(t,null,y.children)}else{const T=Ix(a.snapshot),P=null!==(r=null==T?void 0:T.get(Dp))&&void 0!==r?r:null;y.attachRef=null,y.route=a,y.resolver=P,y.injector=T,y.outlet&&y.outlet.activateWith(a,y.injector),this.activateChildRoutes(t,null,y.children)}}else this.activateChildRoutes(t,null,i)}}class $O{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class ST{constructor(t,e){this.component=t,this.route=e}}function oG(n,t,e){const i=n._root;return Mx(i,t?t._root:null,e,[i.value])}function Py(n,t){const e=Symbol(),i=t.get(n,e);return i===e?"function"!=typeof n||function Qs(n){return null!==Js(n)}(n)?t.get(n):n:i}function Mx(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const a=ky(t);return n.children.forEach(p=>{(function aG(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const a=n.value,p=t?t.value:null,y=e?e.getContext(n.value.outlet):null;if(p&&a.routeConfig===p.routeConfig){const T=function lG(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!m_(n.url,t.url);case"pathParamsOrQueryParamsChange":return!m_(n.url,t.url)||!mh(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!dM(n,t)||!mh(n.queryParams,t.queryParams);default:return!dM(n,t)}}(p,a,a.routeConfig.runGuardsAndResolvers);T?r.canActivateChecks.push(new $O(i)):(a.data=p.data,a._resolvedData=p._resolvedData),Mx(n,t,a.component?y?y.children:null:e,i,r),T&&y&&y.outlet&&y.outlet.isActivated&&r.canDeactivateChecks.push(new ST(y.outlet.component,p))}else p&&Ax(t,y,r),r.canActivateChecks.push(new $O(i)),Mx(n,null,a.component?y?y.children:null:e,i,r)})(p,a[p.value.outlet],e,i.concat([p.value]),r),delete a[p.value.outlet]}),tl(a,(p,y)=>Ax(p,e.getContext(y),r)),r}function Ax(n,t,e){const i=ky(n),r=n.value;tl(i,(a,p)=>{Ax(a,r.component?t?t.children.getContext(p):null:t,e)}),e.canDeactivateChecks.push(new ST(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function Rx(n){return"function"==typeof n}function _M(n){return n instanceof dT||"EmptyError"===(null==n?void 0:n.name)}const TT=Symbol("INITIAL_VALUE");function Ly(){return el(n=>h_(n.map(t=>t.pipe(ko(1),va(TT)))).pipe(ge(t=>{for(const e of t)if(!0!==e){if(e===TT)return TT;if(!1===e||e instanceof f_)return e}return!0}),go(t=>t!==TT),ko(1)))}function WO(n){return function Mn(...n){return Dn(n)}(ks(t=>{if(g_(t))throw VO(0,t)}),ge(t=>!0===t))}const bM={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function XO(n,t,e,i,r){const a=yM(n,t,e);return a.matched?function CG(n,t,e,i){const r=t.canMatch;return r&&0!==r.length?si(r.map(p=>{const y=Py(p,n);return Em(function fG(n){return n&&Rx(n.canMatch)}(y)?y.canMatch(t,e):n.runInContext(()=>y(t,e)))})).pipe(Ly(),WO()):si(!0)}(i=GO(t,i),t,e).pipe(ge(p=>!0===p?a:Object.assign({},bM))):si(a)}function yM(n,t,e){var i;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},bM):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const a=(t.matcher||a8)(e,n,t);if(!a)return Object.assign({},bM);const p={};tl(a.posParams,(T,P)=>{p[P]=T.path});const y=a.consumed.length>0?Object.assign(Object.assign({},p),a.consumed[a.consumed.length-1].parameters):p;return{matched:!0,consumedSegments:a.consumed,remainingSegments:e.slice(a.consumed.length),parameters:y,positionalParamSegments:null!==(i=a.posParams)&&void 0!==i?i:{}}}function CT(n,t,e,i,r="corrected"){if(e.length>0&&function IG(n,t,e){return e.some(i=>DT(n,t,i)&&vu(i)!==Vr)}(n,e,i)){const p=new qr(t,function EG(n,t,e,i){const r={};r[Vr]=i,i._sourceSegment=n,i._segmentIndexShift=t.length;for(const a of e)if(""===a.path&&vu(a)!==Vr){const p=new qr([],{});p._sourceSegment=n,p._segmentIndexShift=t.length,r[vu(a)]=p}return r}(n,t,i,new qr(e,n.children)));return p._sourceSegment=n,p._segmentIndexShift=t.length,{segmentGroup:p,slicedSegments:[]}}if(0===e.length&&function MG(n,t,e){return e.some(i=>DT(n,t,i))}(n,e,i)){const p=new qr(n.segments,function DG(n,t,e,i,r,a){const p={};for(const y of i)if(DT(n,e,y)&&!r[vu(y)]){const T=new qr([],{});T._sourceSegment=n,T._segmentIndexShift="legacy"===a?n.segments.length:t.length,p[vu(y)]=T}return Object.assign(Object.assign({},r),p)}(n,t,e,i,n.children,r));return p._sourceSegment=n,p._segmentIndexShift=t.length,{segmentGroup:p,slicedSegments:e}}const a=new qr(n.segments,n.children);return a._sourceSegment=n,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:e}}function DT(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function ZO(n,t,e,i){return!!(vu(n)===i||i!==Vr&&DT(t,e,n))&&("**"===n.path||yM(t,n,e).matched)}function YO(n,t,e){return 0===t.length&&!n.children[e]}const ET=!1;class IT{constructor(t){this.segmentGroup=t||null}}class KO{constructor(t){this.urlTree=t}}function kx(n){return Iy(new IT(n))}function JO(n){return Iy(new KO(n))}class PG{constructor(t,e,i,r,a){this.injector=t,this.configLoader=e,this.urlSerializer=i,this.urlTree=r,this.config=a,this.allowRedirects=!0}apply(){const t=CT(this.urlTree.root,[],[],this.config).segmentGroup,e=new qr(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,e,Vr).pipe(ge(a=>this.createUrlTree(yT(a),this.urlTree.queryParams,this.urlTree.fragment))).pipe(ef(a=>{if(a instanceof KO)return this.allowRedirects=!1,this.match(a.urlTree);throw a instanceof IT?this.noMatchError(a):a}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,Vr).pipe(ge(r=>this.createUrlTree(yT(r),t.queryParams,t.fragment))).pipe(ef(r=>{throw r instanceof IT?this.noMatchError(r):r}))}noMatchError(t){return new ln(4002,ET)}createUrlTree(t,e,i){const r=nM(t);return new f_(r,e,i)}expandSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,e,i).pipe(ge(a=>new qr([],a))):this.expandSegment(t,i,e,i.segments,r,!0)}expandChildren(t,e,i){const r=[];for(const a of Object.keys(i.children))"primary"===a?r.unshift(a):r.push(a);return ho(r).pipe(wm(a=>{const p=i.children[a],y=qO(e,a);return this.expandSegmentGroup(t,y,p,a).pipe(ge(T=>({segment:T,outlet:a})))}),dO((a,p)=>(a[p.outlet]=p.segment,a),{}),hO())}expandSegment(t,e,i,r,a,p){return ho(i).pipe(wm(y=>this.expandSegmentAgainstRoute(t,e,i,y,r,a,p).pipe(ef(P=>{if(P instanceof IT)return si(null);throw P}))),Dm(y=>!!y),ef((y,T)=>{if(_M(y))return YO(e,r,a)?si(new qr([],{})):kx(e);throw y}))}expandSegmentAgainstRoute(t,e,i,r,a,p,y){return ZO(r,e,a,p)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,a,p):y&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,r,a,p):kx(e):kx(e)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,a,p){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,r,p):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,a,p)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,i,r){const a=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?JO(a):this.lineralizeSegments(i,a).pipe(Ti(p=>{const y=new qr(p,{});return this.expandSegment(t,y,e,p,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,a,p){const{matched:y,consumedSegments:T,remainingSegments:P,positionalParamSegments:z}=yM(e,r,a);if(!y)return kx(e);const H=this.applyRedirectCommands(T,r.redirectTo,z);return r.redirectTo.startsWith("/")?JO(H):this.lineralizeSegments(r,H).pipe(Ti(J=>this.expandSegment(t,e,i,J.concat(P),p,!1)))}matchSegmentAgainstRoute(t,e,i,r,a){return"**"===i.path?(t=GO(i,t),i.loadChildren?(i._loadedRoutes?si({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe(ge(y=>(i._loadedRoutes=y.routes,i._loadedInjector=y.injector,new qr(r,{})))):si(new qr(r,{}))):XO(e,i,r,t).pipe(el(({matched:p,consumedSegments:y,remainingSegments:T})=>{var P;return p?(t=null!==(P=i._injector)&&void 0!==P?P:t,this.getChildConfig(t,i,r).pipe(Ti(H=>{var J;const oe=null!==(J=H.injector)&&void 0!==J?J:t,fe=H.routes,{segmentGroup:Ae,slicedSegments:We}=CT(e,y,T,fe),ot=new qr(Ae.segments,Ae.children);if(0===We.length&&ot.hasChildren())return this.expandChildren(oe,fe,ot).pipe(ge(Zn=>new qr(y,Zn)));if(0===fe.length&&0===We.length)return si(new qr(y,{}));const tn=vu(i)===a;return this.expandSegment(oe,ot,fe,We,tn?Vr:a,!0).pipe(ge(un=>new qr(y.concat(un.segments),un.children)))}))):kx(e)}))}getChildConfig(t,e,i){return e.children?si({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?si({routes:e._loadedRoutes,injector:e._loadedInjector}):function TG(n,t,e,i){const r=t.canLoad;return void 0===r||0===r.length?si(!0):si(r.map(p=>{const y=Py(p,n);return Em(function uG(n){return n&&Rx(n.canLoad)}(y)?y.canLoad(t,e):n.runInContext(()=>y(t,e)))})).pipe(Ly(),WO())}(t,e,i).pipe(Ti(r=>r?this.configLoader.loadChildren(t,e).pipe(ks(a=>{e._loadedRoutes=a.routes,e._loadedInjector=a.injector})):function RG(n){return Iy(jO(ET,3))}())):si({routes:[],injector:t})}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return si(i);if(r.numberOfChildren>1||!r.children[Vr])return Iy(new ln(4e3,ET));r=r.children[Vr]}}applyRedirectCommands(t,e,i){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,i)}applyRedirectCreateUrlTree(t,e,i,r){const a=this.createSegmentGroup(t,e.root,i,r);return new f_(a,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return tl(t,(r,a)=>{if("string"==typeof r&&r.startsWith(":")){const y=r.substring(1);i[a]=e[y]}else i[a]=r}),i}createSegmentGroup(t,e,i,r){const a=this.createSegments(t,e.segments,i,r);let p={};return tl(e.children,(y,T)=>{p[T]=this.createSegmentGroup(t,y,i,r)}),new qr(a,p)}createSegments(t,e,i,r){return e.map(a=>a.path.startsWith(":")?this.findPosParam(t,a,r):this.findOrReturn(a,i))}findPosParam(t,e,i){const r=i[e.path.substring(1)];if(!r)throw new ln(4001,ET);return r}findOrReturn(t,e){let i=0;for(const r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}}class OG{}class BG{constructor(t,e,i,r,a,p,y,T){this.injector=t,this.rootComponentType=e,this.config=i,this.urlTree=r,this.url=a,this.paramsInheritanceStrategy=p,this.relativeLinkResolution=y,this.urlSerializer=T}recognize(){const t=CT(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,Vr).pipe(ge(e=>{if(null===e)return null;const i=new xT([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Vr,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new nf(i,e),a=new BO(this.url,r);return this.inheritParamsAndData(a._root),a}))}inheritParamsAndData(t){const e=t.value,i=NO(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,e,i):this.processSegment(t,e,i,i.segments,r)}processChildren(t,e,i){return ho(Object.keys(i.children)).pipe(wm(r=>{const a=i.children[r],p=qO(e,r);return this.processSegmentGroup(t,p,a,r)}),dO((r,a)=>r&&a?(r.push(...a),r):null),pO(r=>null!==r),hT(null),hO(),ge(r=>{if(null===r)return null;const a=QO(r);return function zG(n){n.sort((t,e)=>t.value.outlet===Vr?-1:e.value.outlet===Vr?1:t.value.outlet.localeCompare(e.value.outlet))}(a),a}))}processSegment(t,e,i,r,a){return ho(e).pipe(wm(p=>{var y;return this.processSegmentAgainstRoute(null!==(y=p._injector)&&void 0!==y?y:t,p,i,r,a)}),Dm(p=>!!p),ef(p=>{if(_M(p))return YO(i,r,a)?si([]):si(null);throw p}))}processSegmentAgainstRoute(t,e,i,r,a){var p,y;if(e.redirectTo||!ZO(e,i,r,a))return si(null);let T;if("**"===e.path){const P=r.length>0?gO(r).parameters:{},z=tF(i)+r.length;T=si({snapshot:new xT(r,P,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,iF(e),vu(e),null!==(y=null!==(p=e.component)&&void 0!==p?p:e._loadedComponent)&&void 0!==y?y:null,e,eF(i),z,rF(e),z),consumedSegments:[],remainingSegments:[]})}else T=XO(i,e,r,t).pipe(ge(({matched:P,consumedSegments:z,remainingSegments:H,parameters:J})=>{var oe,fe;if(!P)return null;const Ae=tF(i)+z.length;return{snapshot:new xT(z,J,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,iF(e),vu(e),null!==(fe=null!==(oe=e.component)&&void 0!==oe?oe:e._loadedComponent)&&void 0!==fe?fe:null,e,eF(i),Ae,rF(e),Ae),consumedSegments:z,remainingSegments:H}}));return T.pipe(el(P=>{var z,H;if(null===P)return si(null);const{snapshot:J,consumedSegments:oe,remainingSegments:fe}=P;t=null!==(z=e._injector)&&void 0!==z?z:t;const Ae=null!==(H=e._loadedInjector)&&void 0!==H?H:t,We=function VG(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(e),{segmentGroup:ot,slicedSegments:tn}=CT(i,oe,fe,We.filter(un=>void 0===un.redirectTo),this.relativeLinkResolution);if(0===tn.length&&ot.hasChildren())return this.processChildren(Ae,We,ot).pipe(ge(un=>null===un?null:[new nf(J,un)]));if(0===We.length&&0===tn.length)return si([new nf(J,[])]);const Nt=vu(e)===a;return this.processSegment(Ae,We,ot,tn,Nt?Vr:a).pipe(ge(un=>null===un?null:[new nf(J,un)]))}))}}function jG(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function QO(n){const t=[],e=new Set;for(const i of n){if(!jG(i)){t.push(i);continue}const r=t.find(a=>i.value.routeConfig===a.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):t.push(i)}for(const i of e){const r=QO(i.children);t.push(new nf(i.value,r))}return t.filter(i=>!e.has(i))}function eF(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function tF(n){var t,e;let i=n,r=null!==(t=i._segmentIndexShift)&&void 0!==t?t:0;for(;i._sourceSegment;)i=i._sourceSegment,r+=null!==(e=i._segmentIndexShift)&&void 0!==e?e:0;return r-1}function iF(n){return n.data||{}}function rF(n){return n.resolve||{}}function oF(n){return"string"==typeof n.title||null===n.title}function vM(n){return el(t=>{const e=n(t);return e?ho(e).pipe(ge(()=>t)):si(t)})}let sF=(()=>{class n{buildTitle(e){var i;let r,a=e.root;for(;void 0!==a;)r=null!==(i=this.getResolvedTitleForRoute(a))&&void 0!==i?i:r,a=a.children.find(p=>p.outlet===Vr);return r}getResolvedTitleForRoute(e){return e.data[vx]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:function(){return Oo(aF)},providedIn:"root"}),n})(),aF=(()=>{class n extends sF{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(e){return new(e||n)(mt(Jk))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class ZG{}class KG extends class YG{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const AT=new Qt("",{providedIn:"root",factory:()=>({})}),xM=new Qt("ROUTES");let wM=(()=>{class n{constructor(e,i){this.injector=e,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return si(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=Em(e.loadComponent()).pipe(ks(a=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=a}),pT(()=>{this.componentLoaders.delete(e)})),r=new KI(i,()=>new fn).pipe(YI());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return si({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const a=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(ge(y=>{this.onLoadEndListener&&this.onLoadEndListener(i);let T,P,z=!1;Array.isArray(y)?P=y:(T=y.create(e).injector,P=mO(T.get(xM,[],hi.Self|hi.Optional)));return{routes:P.map(gM),injector:T}}),pT(()=>{this.childrenLoaders.delete(i)})),p=new KI(a,()=>new fn).pipe(YI());return this.childrenLoaders.set(i,p),p}loadModuleFactoryOrRoutes(e){return Em(e()).pipe(Ti(i=>i instanceof jR||Array.isArray(i)?si(i):ho(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(e){return new(e||n)(mt(jo),mt(mE))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class QG{}class eq{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function tq(n){throw n}function nq(n,t,e){return t.parse("/")}const iq={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},rq={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function cF(){var n,t;const e=Oo(wO),i=Oo(Ex),r=Oo(vS),a=Oo(jo),p=Oo(mE),y=null!==(n=Oo(xM,{optional:!0}))&&void 0!==n?n:[],T=null!==(t=Oo(AT,{optional:!0}))&&void 0!==t?t:{},P=Oo(aF),z=Oo(sF,{optional:!0}),H=Oo(QG,{optional:!0}),J=Oo(ZG,{optional:!0}),oe=new aa(null,e,i,r,a,p,mO(y));return H&&(oe.urlHandlingStrategy=H),J&&(oe.routeReuseStrategy=J),oe.titleStrategy=null!=z?z:P,function oq(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(t.canceledNavigationResolution=n.canceledNavigationResolution)}(T,oe),oe}let aa=(()=>{class n{constructor(e,i,r,a,p,y,T){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=r,this.location=a,this.config=T,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new fn,this.errorHandler=tq,this.malformedUriErrorHandler=nq,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>si(void 0),this.urlHandlingStrategy=new eq,this.routeReuseStrategy=new KG,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=p.get(wM),this.configLoader.onLoadEndListener=J=>this.triggerEvent(new V8(J)),this.configLoader.onLoadStartListener=J=>this.triggerEvent(new z8(J)),this.ngModule=p.get(i_),this.console=p.get(E4);const H=p.get(Oi);this.isNgZoneEnabled=H instanceof Oi&&Oi.isInAngularZone(),this.resetConfig(T),this.currentUrlTree=function c8(){return new f_(new qr([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=FO(this.currentUrlTree,this.rootComponentType),this.transitions=new Qa({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(go(r=>0!==r.id),ge(r=>Object.assign(Object.assign({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),el(r=>{let a=!1,p=!1;return si(r).pipe(ks(y=>{this.currentNavigation={id:y.id,initialUrl:y.rawUrl,extractedUrl:y.extractedUrl,trigger:y.source,extras:y.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),el(y=>{const T=this.browserUrlTree.toString(),P=!this.navigated||y.extractedUrl.toString()!==T||T!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||P)&&this.urlHandlingStrategy.shouldProcessUrl(y.rawUrl))return uF(y.source)&&(this.browserUrlTree=y.extractedUrl),si(y).pipe(el(H=>{const J=this.transitions.getValue();return i.next(new sM(H.id,this.serializeUrl(H.extractedUrl),H.source,H.restoredState)),J!==this.transitions.getValue()?uo:Promise.resolve(H)}),function LG(n,t,e,i){return el(r=>function kG(n,t,e,i,r){return new PG(n,t,e,i,r).apply()}(n,t,e,r.extractedUrl,i).pipe(ge(a=>Object.assign(Object.assign({},r),{urlAfterRedirects:a}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),ks(H=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:H.urlAfterRedirects}),r.urlAfterRedirects=H.urlAfterRedirects}),function HG(n,t,e,i,r,a){return Ti(p=>function NG(n,t,e,i,r,a,p="emptyOnly",y="legacy"){return new BG(n,t,e,i,r,p,y,a).recognize().pipe(el(T=>null===T?function FG(n){return new _n(t=>t.error(n))}(new OG):si(T)))}(n,t,e,p.urlAfterRedirects,i.serialize(p.urlAfterRedirects),i,r,a).pipe(ge(y=>Object.assign(Object.assign({},p),{targetSnapshot:y}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),ks(H=>{if(r.targetSnapshot=H.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!H.extras.skipLocationChange){const oe=this.urlHandlingStrategy.merge(H.urlAfterRedirects,H.rawUrl);this.setBrowserUrl(oe,H)}this.browserUrlTree=H.urlAfterRedirects}const J=new L8(H.id,this.serializeUrl(H.extractedUrl),this.serializeUrl(H.urlAfterRedirects),H.targetSnapshot);i.next(J)}));if(P&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:J,extractedUrl:oe,source:fe,restoredState:Ae,extras:We}=y,ot=new sM(J,this.serializeUrl(oe),fe,Ae);i.next(ot);const tn=FO(oe,this.rootComponentType).snapshot;return si(r=Object.assign(Object.assign({},y),{targetSnapshot:tn,urlAfterRedirects:oe,extras:Object.assign(Object.assign({},We),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=y.rawUrl,y.resolve(null),uo}),ks(y=>{const T=new O8(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(T)}),ge(y=>r=Object.assign(Object.assign({},y),{guards:oG(y.targetSnapshot,y.currentSnapshot,this.rootContexts)})),function gG(n,t){return Ti(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:a,canDeactivateChecks:p}}=e;return 0===p.length&&0===a.length?si(Object.assign(Object.assign({},e),{guardsResult:!0})):function _G(n,t,e,i){return ho(n).pipe(Ti(r=>function SG(n,t,e,i,r){const a=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return a&&0!==a.length?si(a.map(y=>{var T;const P=null!==(T=Ix(t))&&void 0!==T?T:r,z=Py(y,P);return Em(function pG(n){return n&&Rx(n.canDeactivate)}(z)?z.canDeactivate(n,t,e,i):P.runInContext(()=>z(n,t,e,i))).pipe(Dm())})).pipe(Ly()):si(!0)}(r.component,r.route,e,t,i)),Dm(r=>!0!==r,!0))}(p,i,r,n).pipe(Ti(y=>y&&function cG(n){return"boolean"==typeof n}(y)?function bG(n,t,e,i){return ho(t).pipe(wm(r=>bx(function vG(n,t){return null!==n&&t&&t(new j8(n)),si(!0)}(r.route.parent,i),function yG(n,t){return null!==n&&t&&t(new H8(n)),si(!0)}(r.route,i),function wG(n,t,e){const i=t[t.length-1],a=t.slice(0,t.length-1).reverse().map(p=>function sG(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(p)).filter(p=>null!==p).map(p=>p_(()=>si(p.guards.map(T=>{var P;const z=null!==(P=Ix(p.node))&&void 0!==P?P:e,H=Py(T,z);return Em(function hG(n){return n&&Rx(n.canActivateChild)}(H)?H.canActivateChild(i,n):z.runInContext(()=>H(i,n))).pipe(Dm())})).pipe(Ly())));return si(a).pipe(Ly())}(n,r.path,e),function xG(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return si(!0);const r=i.map(a=>p_(()=>{var p;const y=null!==(p=Ix(t))&&void 0!==p?p:e,T=Py(a,y);return Em(function dG(n){return n&&Rx(n.canActivate)}(T)?T.canActivate(t,n):y.runInContext(()=>T(t,n))).pipe(Dm())}));return si(r).pipe(Ly())}(n,r.route,e))),Dm(r=>!0!==r,!0))}(i,a,n,t):si(y)),ge(y=>Object.assign(Object.assign({},e),{guardsResult:y})))})}(this.ngModule.injector,y=>this.triggerEvent(y)),ks(y=>{if(r.guardsResult=y.guardsResult,g_(y.guardsResult))throw VO(0,y.guardsResult);const T=new F8(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot,!!y.guardsResult);this.triggerEvent(T)}),go(y=>!!y.guardsResult||(this.restoreHistory(y),this.cancelNavigationTransition(y,"",3),!1)),vM(y=>{if(y.guards.canActivateChecks.length)return si(y).pipe(ks(T=>{const P=new N8(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot);this.triggerEvent(P)}),el(T=>{let P=!1;return si(T).pipe(function GG(n,t){return Ti(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return si(e);let a=0;return ho(r).pipe(wm(p=>function qG(n,t,e,i){const r=n.routeConfig,a=n._resolve;return void 0!==(null==r?void 0:r.title)&&!oF(r)&&(a[vx]=r.title),function $G(n,t,e,i){const r=function WG(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return si({});const a={};return ho(r).pipe(Ti(p=>function XG(n,t,e,i){var r;const a=null!==(r=Ix(t))&&void 0!==r?r:i,p=Py(n,a);return Em(p.resolve?p.resolve(t,e):a.runInContext(()=>p(t,e)))}(n[p],t,e,i).pipe(Dm(),ks(y=>{a[p]=y}))),JI(1),yx(a),ef(p=>_M(p)?uo:Iy(p)))}(a,n,t,i).pipe(ge(p=>(n._resolvedData=p,n.data=NO(n,e).resolve,r&&oF(r)&&(n.data[vx]=r.title),null)))}(p.route,i,n,t)),ks(()=>a++),JI(1),Ti(p=>a===r.length?si(e):uo))})}(this.paramsInheritanceStrategy,this.ngModule.injector),ks({next:()=>P=!0,complete:()=>{P||(this.restoreHistory(T),this.cancelNavigationTransition(T,"",2))}}))}),ks(T=>{const P=new B8(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot);this.triggerEvent(P)}))}),vM(y=>{const T=P=>{var z;const H=[];(null===(z=P.routeConfig)||void 0===z?void 0:z.loadComponent)&&!P.routeConfig._loadedComponent&&H.push(this.configLoader.loadComponent(P.routeConfig).pipe(ks(J=>{P.component=J}),ge(()=>{})));for(const J of P.children)H.push(...T(J));return H};return h_(T(y.targetSnapshot.root)).pipe(hT(),ko(1))}),vM(()=>this.afterPreactivation()),ge(y=>{const T=function X8(n,t,e){const i=Dx(n,t._root,e?e._root:void 0);return new OO(i,t)}(this.routeReuseStrategy,y.targetSnapshot,y.currentRouterState);return r=Object.assign(Object.assign({},y),{targetRouterState:T})}),ks(y=>{this.currentUrlTree=y.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(y.urlAfterRedirects,y.rawUrl),this.routerState=y.targetRouterState,"deferred"===this.urlUpdateStrategy&&(y.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,y),this.browserUrlTree=y.urlAfterRedirects)}),((n,t,e)=>ge(i=>(new rG(t,i.targetRouterState,i.currentRouterState,e).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,y=>this.triggerEvent(y)),ks({next(){a=!0},complete(){a=!0}}),pT(()=>{var y;a||p||this.cancelNavigationTransition(r,"",1),(null===(y=this.currentNavigation)||void 0===y?void 0:y.id)===r.id&&(this.currentNavigation=null)}),ef(y=>{var T;if(p=!0,HO(y)){UO(y)||(this.navigated=!0,this.restoreHistory(r,!0));const P=new vT(r.id,this.serializeUrl(r.extractedUrl),y.message,y.cancellationCode);if(i.next(P),UO(y)){const z=this.urlHandlingStrategy.merge(y.url,this.rawUrlTree),H={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||uF(r.source)};this.scheduleNavigation(z,"imperative",null,H,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{this.restoreHistory(r,!0);const P=new kO(r.id,this.serializeUrl(r.extractedUrl),y,null!==(T=r.targetSnapshot)&&void 0!==T?T:void 0);i.next(P);try{r.resolve(this.errorHandler(y))}catch(z){r.reject(z)}}return uo}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var r;const a={replaceUrl:!0},p=null!==(r=e.state)&&void 0!==r&&r.navigationId?e.state:null;if(p){const T=Object.assign({},p);delete T.navigationId,delete T.\u0275routerPageId,0!==Object.keys(T).length&&(a.state=T)}const y=this.parseUrl(e.url);this.scheduleNavigation(y,i,p,a)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){this.config=e.map(gM),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:r,queryParams:a,fragment:p,queryParamsHandling:y,preserveFragment:T}=i,P=r||this.routerState.root,z=T?this.currentUrlTree.fragment:p;let H=null;switch(y){case"merge":H=Object.assign(Object.assign({},this.currentUrlTree.queryParams),a);break;case"preserve":H=this.currentUrlTree.queryParams;break;default:H=a||null}return null!==H&&(H=this.removeEmptyProps(H)),I8(P,this.currentUrlTree,e,H,null!=z?z:null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=g_(e)?e:this.parseUrl(e),a=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(a,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function sq(n){for(let t=0;t<n.length;t++){if(null==n[t])throw new ln(4008,false)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,e)}return i}isActive(e,i){let r;if(r=!0===i?Object.assign({},iq):!1===i?Object.assign({},rq):i,g_(e))return bO(this.currentUrlTree,e,r);const a=this.parseUrl(e);return bO(this.currentUrlTree,a,r)}removeEmptyProps(e){return Object.keys(e).reduce((i,r)=>{const a=e[r];return null!=a&&(i[r]=a),i},{})}processNavigations(){this.navigations.subscribe(e=>{var i;this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new __(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,null===(i=this.titleStrategy)||void 0===i||i.updateTitle(this.routerState.snapshot),e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,r,a,p){var y,T;if(this.disposed)return Promise.resolve(!1);let P,z,H;p?(P=p.resolve,z=p.reject,H=p.promise):H=new Promise((fe,Ae)=>{P=fe,z=Ae});const J=++this.navigationId;let oe;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),oe=r&&r.\u0275routerPageId?r.\u0275routerPageId:a.replaceUrl||a.skipLocationChange?null!==(y=this.browserPageId)&&void 0!==y?y:0:(null!==(T=this.browserPageId)&&void 0!==T?T:0)+1):oe=0,this.setTransition({id:J,targetPageId:oe,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:a,resolve:P,reject:z,promise:H,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),H.catch(fe=>Promise.reject(fe))}setBrowserUrl(e,i){const r=this.urlSerializer.serialize(e),a=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",a):this.location.go(r,"",a)}restoreHistory(e,i=!1){var r,a;if("computed"===this.canceledNavigationResolution){const p=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)||0===p?this.currentUrlTree===(null===(a=this.currentNavigation)||void 0===a?void 0:a.finalUrl)&&0===p&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(p)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i,r){const a=new vT(e.id,this.serializeUrl(e.extractedUrl),i,r);this.triggerEvent(a),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return n.\u0275fac=function(e){Cc()},n.\u0275prov=vn({token:n,factory:function(){return cF()},providedIn:"root"}),n})();function uF(n){return"imperative"!==n}let y_=(()=>{class n{constructor(e,i,r){this.router=e,this.route=i,this.locationStrategy=r,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.href=null,this.onChanges=new fn,this.subscription=e.events.subscribe(a=>{a instanceof __&&this.updateTargetUrlAndHref()})}set preserveFragment(e){this._preserveFragment=Wp(e)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(e){this._skipLocationChange=Wp(e)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(e){this._replaceUrl=Wp(e)}get replaceUrl(){return this._replaceUrl}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:null}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,i,r,a,p){return!!(0!==e||i||r||a||p||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!1)}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return n.\u0275fac=function(e){return new(e||n)(le(aa),le(b_),le(s_))},n.\u0275dir=cn({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,i){1&e&&Zt("click",function(a){return i.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),2&e&&Yn("target",i.target)("href",i.href,hs)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[xo]}),n})();class dF{}let cq=(()=>{class n{constructor(e,i,r,a,p){this.router=e,this.injector=r,this.preloadingStrategy=a,this.loader=p}setUpPreloading(){this.subscription=this.router.events.pipe(go(e=>e instanceof __),wm(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){var r,a,p;const y=[];for(const T of i){T.providers&&!T._injector&&(T._injector=aS(T.providers,e,`Route: ${T.path}`));const P=null!==(r=T._injector)&&void 0!==r?r:e,z=null!==(a=T._loadedInjector)&&void 0!==a?a:P;T.loadChildren&&!T._loadedRoutes&&void 0===T.canLoad||T.loadComponent&&!T._loadedComponent?y.push(this.preloadConfig(P,T)):(T.children||T._loadedRoutes)&&y.push(this.processRoutes(z,null!==(p=T.children)&&void 0!==p?p:T._loadedRoutes))}return ho(y).pipe(xr())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):si(null);const a=r.pipe(Ti(p=>{var y;return null===p?si(void 0):(i._loadedRoutes=p.routes,i._loadedInjector=p.injector,this.processRoutes(null!==(y=p.injector)&&void 0!==y?y:e,p.routes))}));return i.loadComponent&&!i._loadedComponent?ho([a,this.loader.loadComponent(i)]).pipe(xr()):a})}}return n.\u0275fac=function(e){return new(e||n)(mt(aa),mt(mE),mt(Wu),mt(dF),mt(wM))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const TM=new Qt("");let hF=(()=>{class n{constructor(e,i,r={}){this.router=e,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof sM?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof __&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof PO&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new PO(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){Cc()},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();function Oy(n,t){return{\u0275kind:n,\u0275providers:t}}function CM(n){return[{provide:xM,multi:!0,useValue:n}]}function fF(){const n=Oo(jo);return t=>{var e,i;const r=n.get(xy);if(t!==r.components[0])return;const a=n.get(aa),p=n.get(mF);1===n.get(DM)&&a.initialNavigation(),null===(e=n.get(gF,null,hi.Optional))||void 0===e||e.setUpPreloading(),null===(i=n.get(TM,null,hi.Optional))||void 0===i||i.init(),a.resetRootComponentType(r.componentTypes[0]),p.closed||(p.next(),p.unsubscribe())}}const mF=new Qt("",{factory:()=>new fn}),DM=new Qt("",{providedIn:"root",factory:()=>1});const gF=new Qt("");function pq(n){return Oy(0,[{provide:gF,useExisting:cq},{provide:dF,useExisting:n}])}const _F=new Qt("ROUTER_FORROOT_GUARD"),fq=[vS,{provide:wO,useClass:eM},{provide:aa,useFactory:cF},Ex,{provide:b_,useFactory:function pF(n){return n.routerState.root},deps:[aa]},wM];function mq(){return new B2("Router",aa)}let LT=(()=>{class n{constructor(e){}static forRoot(e,i){return{ngModule:n,providers:[fq,[],CM(e),{provide:_F,useFactory:yq,deps:[[aa,new s,new g]]},{provide:AT,useValue:i||{}},null!=i&&i.useHash?{provide:s_,useClass:mV}:{provide:s_,useClass:ck},{provide:TM,useFactory:()=>{const n=Oo(aa),t=Oo(I6),e=Oo(AT);return e.scrollOffset&&t.setOffset(e.scrollOffset),new hF(n,t,e)}},null!=i&&i.preloadingStrategy?pq(i.preloadingStrategy).\u0275providers:[],{provide:B2,multi:!0,useFactory:mq},null!=i&&i.initialNavigation?vq(i):[],[{provide:bF,useFactory:fF},{provide:R2,multi:!0,useExisting:bF}]]}}static forChild(e){return{ngModule:n,providers:[CM(e)]}}}return n.\u0275fac=function(e){return new(e||n)(mt(_F,8))},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[fM]}),n})();function yq(n){return"guarded"}function vq(n){return["disabled"===n.initialNavigation?Oy(3,[{provide:hS,multi:!0,useFactory:()=>{const t=Oo(aa);return()=>{t.setUpLocationChangeListener()}}},{provide:DM,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?Oy(2,[{provide:DM,useValue:0},{provide:hS,multi:!0,deps:[jo],useFactory:t=>{const e=t.get(pV,Promise.resolve());let i=!1;return()=>e.then(()=>new Promise(a=>{const p=t.get(aa),y=t.get(mF);(function r(a){t.get(aa).events.pipe(go(y=>y instanceof __||y instanceof vT||y instanceof kO),ge(y=>y instanceof __||y instanceof vT&&(0===y.code||1===y.code)&&null),go(y=>null!==y),ko(1)).subscribe(()=>{a()})})(()=>{a(!0),i=!0}),p.afterPreactivation=()=>(a(!0),i||y.closed?si(void 0):y),p.initialNavigation()}))}}]).\u0275providers:[]]}const bF=new Qt("");let EM;try{EM="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){EM=!1}let Fy,la=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function E6(n){return n===Mk}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!EM)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(mt(fS))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const yF=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function vF(){if(Fy)return Fy;if("object"!=typeof document||!document)return Fy=new Set(yF),Fy;let n=document.createElement("input");return Fy=new Set(yF.filter(t=>(n.setAttribute("type",t),n.type===t))),Fy}let Px,v_,IM;function Im(n){return function wq(){if(null==Px&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Px=!0}))}finally{Px=Px||!1}return Px}()?n:!!n.capture}function Sq(){if(null==v_){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return v_=!1,v_;if("scrollBehavior"in document.documentElement.style)v_=!0;else{const n=Element.prototype.scrollTo;v_=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return v_}function ad(){let n="undefined"!=typeof document&&document?document.activeElement:null;for(;n&&n.shadowRoot;){const t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function Mm(n){return n.composedPath?n.composedPath()[0]:n.target}function MM(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function nl(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}class Nq extends Qe{constructor(t,e){super()}schedule(t,e=0){return this}}const FT={setInterval(n,t,...e){const{delegate:i}=FT;return null!=i&&i.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){const{delegate:t}=FT;return((null==t?void 0:t.clearInterval)||clearInterval)(n)},delegate:void 0};class LM extends Nq{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){var i;if(this.closed)return this;this.state=t;const r=this.id,a=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(a,r,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(a,this.id,e),this}requestAsyncId(t,e,i=0){return FT.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&FT.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,i=!1;try{this.work(t)}catch(a){i=!0,r=a||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,d(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}const TF={now:()=>(TF.delegate||Date).now(),delegate:void 0};class Lx{constructor(t,e=Lx.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}Lx.now=TF.now;class OM extends Lx{constructor(t,e=Lx.now){super(t,e),this.actions=[],this._active=!1}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const NT=new OM(LM),Bq=NT;function gh(n,t=NT){return cr((e,i)=>{let r=null,a=null,p=null;const y=()=>{if(r){r.unsubscribe(),r=null;const P=a;a=null,i.next(P)}};function T(){const P=p+n,z=t.now();if(z<P)return r=this.schedule(void 0,P-z),void i.add(r);y()}e.subscribe(ur(i,P=>{a=P,p=t.now(),r||(r=t.schedule(T,n),i.add(r))},()=>{y(),i.complete()},void 0,()=>{a=r=null}))})}function CF(n){return go((t,e)=>n<=e)}function Am(n,t=Wt){return n=null!=n?n:zq,cr((e,i)=>{let r,a=!0;e.subscribe(ur(i,p=>{const y=t(p);(a||!n(r,y))&&(a=!1,r=y,i.next(p))}))})}function zq(n,t){return n===t}function br(n){return cr((t,e)=>{qt(n).subscribe(ur(e,()=>e.complete(),it)),!e.closed&&t.subscribe(e)})}function Si(n){return null!=n&&"false"!=`${n}`}function af(n,t=0){return function Vq(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):t}function BT(n){return Array.isArray(n)?n:[n]}function ca(n){return null==n?"":"string"==typeof n?n:`${n}px`}function S_(n){return n instanceof ei?n.nativeElement:n}function FM(n,t=/\s+/){const e=[];if(null!=n){const i=Array.isArray(n)?n:`${n}`.split(t);for(const r of i){const a=`${r}`.trim();a&&e.push(a)}}return e}let DF=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),EF=(()=>{class n{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,i)=>this._cleanupObserver(i))}observe(e){const i=S_(e);return new _n(r=>{const p=this._observeElement(i).subscribe(r);return()=>{p.unsubscribe(),this._unobserveElement(i)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const i=new fn,r=this._mutationObserverFactory.create(a=>i.next(a));r&&r.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:r,stream:i,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:i,stream:r}=this._observedElements.get(e);i&&i.disconnect(),r.complete(),this._observedElements.delete(e)}}}return n.\u0275fac=function(e){return new(e||n)(mt(DF))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),IF=(()=>{class n{constructor(e,i,r){this._contentObserver=e,this._elementRef=i,this._ngZone=r,this.event=new Cn,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(e){this._disabled=Si(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=af(e),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(gh(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){var e;null===(e=this._currentSubscription)||void 0===e||e.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(le(EF),le(ei),le(Oi))},n.\u0275dir=cn({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),zT=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[DF]}),n})();const MF=new Set;let By,jq=(()=>{class n{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Hq}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function Uq(n){if(!MF.has(n))try{By||(By=document.createElement("style"),By.setAttribute("type","text/css"),document.head.appendChild(By)),By.sheet&&(By.sheet.insertRule(`@media ${n} {body{ }}`,0),MF.add(n))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}return n.\u0275fac=function(e){return new(e||n)(mt(la))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function Hq(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let NM=(()=>{class n{constructor(e,i){this._mediaMatcher=e,this._zone=i,this._queries=new Map,this._destroySubject=new fn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return AF(BT(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let a=h_(AF(BT(e)).map(p=>this._registerQuery(p).observable));return a=bx(a.pipe(ko(1)),a.pipe(CF(1),gh(0))),a.pipe(ge(p=>{const y={matches:!1,breakpoints:{}};return p.forEach(({matches:T,query:P})=>{y.matches=y.matches||T,y.breakpoints[P]=T}),y}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),a={observable:new _n(p=>{const y=T=>this._zone.run(()=>p.next(T));return i.addListener(y),()=>{i.removeListener(y)}}).pipe(va(i),ge(({matches:p})=>({query:e,matches:p})),br(this._destroySubject)),mql:i};return this._queries.set(e,a),a}}return n.\u0275fac=function(e){return new(e||n)(mt(jq),mt(Oi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function AF(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function VT(n,t){return(n.getAttribute(t)||"").match(/\S+/g)||[]}const kF="cdk-describedby-message",jT="cdk-describedby-host";let BM=0,PF=(()=>{class n{constructor(e,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+BM++,this._document=e,this._id=Oo(vy)+"-"+BM++}describe(e,i,r){if(!this._canBeDescribed(e,i))return;const a=zM(i,r);"string"!=typeof i?(LF(i,this._id),this._messageRegistry.set(a,{messageElement:i,referenceCount:0})):this._messageRegistry.has(a)||this._createMessageElement(i,r),this._isElementDescribedByMessage(e,a)||this._addMessageReference(e,a)}removeDescription(e,i,r){var a;if(!i||!this._isElementNode(e))return;const p=zM(i,r);if(this._isElementDescribedByMessage(e,p)&&this._removeMessageReference(e,p),"string"==typeof i){const y=this._messageRegistry.get(p);y&&0===y.referenceCount&&this._deleteMessageElement(p)}0===(null===(a=this._messagesContainer)||void 0===a?void 0:a.childNodes.length)&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){var e;const i=this._document.querySelectorAll(`[${jT}="${this._id}"]`);for(let r=0;r<i.length;r++)this._removeCdkDescribedByReferenceIds(i[r]),i[r].removeAttribute(jT);null===(e=this._messagesContainer)||void 0===e||e.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,i){const r=this._document.createElement("div");LF(r,this._id),r.textContent=e,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(zM(e,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(e){var i,r;null===(r=null===(i=this._messageRegistry.get(e))||void 0===i?void 0:i.messageElement)||void 0===r||r.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let a=0;a<i.length;a++)i[a].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(e),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(e){const i=VT(e,"aria-describedby").filter(r=>0!=r.indexOf(kF));e.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(e,i){const r=this._messageRegistry.get(i);(function Gq(n,t,e){const i=VT(n,t);i.some(r=>r.trim()==e.trim())||(i.push(e.trim()),n.setAttribute(t,i.join(" ")))})(e,"aria-describedby",r.messageElement.id),e.setAttribute(jT,this._id),r.referenceCount++}_removeMessageReference(e,i){const r=this._messageRegistry.get(i);r.referenceCount--,function qq(n,t,e){const r=VT(n,t).filter(a=>a!=e.trim());r.length?n.setAttribute(t,r.join(" ")):n.removeAttribute(t)}(e,"aria-describedby",r.messageElement.id),e.removeAttribute(jT)}_isElementDescribedByMessage(e,i){const r=VT(e,"aria-describedby"),a=this._messageRegistry.get(i),p=a&&a.messageElement.id;return!!p&&-1!=r.indexOf(p)}_canBeDescribed(e,i){if(!this._isElementNode(e))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),a=e.getAttribute("aria-label");return!(!r||a&&a.trim()===r)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi),mt(la))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function zM(n,t){return"string"==typeof n?`${t||""}/${n}`:n}function LF(n,t){n.id||(n.id=`${kF}-${t}-${BM++}`)}class OF{constructor(t){this._items=t,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new fn,this._typeaheadSubscription=Qe.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new fn,this.change=new fn,t instanceof r_&&t.changes.subscribe(e=>{if(this._activeItem){const r=e.toArray().indexOf(this._activeItem);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r)}})}skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(ks(e=>this._pressedLetters.push(e)),gh(t),go(()=>this._pressedLetters.length>0),ge(()=>this._pressedLetters.join(""))).subscribe(e=>{const i=this._getItemsArray();for(let r=1;r<i.length+1;r++){const a=(this._activeItemIndex+r)%i.length,p=i[a];if(!this._skipPredicateFn(p)&&0===p.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(a);break}}this._pressedLetters=[]}),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}setActiveItem(t){const e=this._activeItem;this.updateActiveItem(t),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(t){const e=t.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(a=>!t[a]||this._allowedModifierKeys.indexOf(a)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;default:return void((r||nl(t,"shiftKey"))&&(t.key&&1===t.key.length?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){const e=this._getItemsArray(),i="number"==typeof t?t:e.indexOf(t),r=e[i];this._activeItem=null==r?null:r,this._activeItemIndex=i}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const r=(this._activeItemIndex+t*i+e.length)%e.length;if(!this._skipPredicateFn(e[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,e){const i=this._getItemsArray();if(i[t]){for(;this._skipPredicateFn(i[t]);)if(!i[t+=e])return;this.setActiveItem(t)}}_getItemsArray(){return this._items instanceof r_?this._items.toArray():this._items}}class FF extends OF{setActiveItem(t){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(t),this.activeItem&&this.activeItem.setActiveStyles()}}class VM extends OF{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}}let T_=(()=>{class n{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function Wq(n){return!!(n.offsetWidth||n.offsetHeight||"function"==typeof n.getClientRects&&n.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function $q(n){try{return n.frameElement}catch(t){return null}}(function t$(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}(e));if(i&&(-1===BF(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),a=BF(e);return e.hasAttribute("contenteditable")?-1!==a:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function Qq(n){let t=n.nodeName.toLowerCase(),e="input"===t&&n.type;return"text"===e||"password"===e||"select"===t||"textarea"===t}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==a:"video"===r?-1!==a&&(null!==a||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function e$(n){return!function Zq(n){return function Kq(n){return"input"==n.nodeName.toLowerCase()}(n)&&"hidden"==n.type}(n)&&(function Xq(n){let t=n.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(n)||function Yq(n){return function Jq(n){return"a"==n.nodeName.toLowerCase()}(n)&&n.hasAttribute("href")}(n)||n.hasAttribute("contenteditable")||NF(n))}(e)&&!this.isDisabled(e)&&((null==i?void 0:i.ignoreVisibility)||this.isVisible(e))}}return n.\u0275fac=function(e){return new(e||n)(mt(la))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function NF(n){if(!n.hasAttribute("tabindex")||void 0===n.tabIndex)return!1;let t=n.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function BF(n){if(!NF(n))return null;const t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class zF{constructor(t,e,i,r,a=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,a||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(ko(1)).subscribe(t)}}let zy=(()=>{class n{constructor(e,i,r){this._checker=e,this._ngZone=i,this._document=r}create(e,i=!1){return new zF(e,this._checker,this._ngZone,this._document,i)}}return n.\u0275fac=function(e){return new(e||n)(mt(T_),mt(Oi),mt(Mi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),n$=(()=>{class n{constructor(e,i,r){this._elementRef=e,this._focusTrapFactory=i,this._previouslyFocusedElement=null,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(e){this.focusTrap.enabled=Si(e)}get autoCapture(){return this._autoCapture}set autoCapture(e){this._autoCapture=Si(e)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}ngOnChanges(e){const i=e.autoCapture;i&&!i.firstChange&&this.autoCapture&&this.focusTrap.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=ad(),this.focusTrap.focusInitialElementWhenReady()}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(zy),le(Mi))},n.\u0275dir=cn({type:n,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:["cdkTrapFocus","enabled"],autoCapture:["cdkTrapFocusAutoCapture","autoCapture"]},exportAs:["cdkTrapFocus"],features:[xo]}),n})();class i$ extends zF{constructor(t,e,i,r,a,p,y){super(t,e,i,r,y.defer),this._focusTrapManager=a,this._inertStrategy=p,this._focusTrapManager.register(this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const r$=new Qt("FOCUS_TRAP_INERT_STRATEGY");class o${constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=e=>this._trapFocus(t,e),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){!this._listener||(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,e){var i;const r=e.target,a=t._element;r&&!a.contains(r)&&(null===(i=r.closest)||void 0===i||!i.call(r,"div.cdk-overlay-pane"))&&setTimeout(()=>{t.enabled&&!a.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let s$=(()=>{class n{constructor(){this._focusTrapStack=[]}register(e){this._focusTrapStack=this._focusTrapStack.filter(r=>r!==e);let i=this._focusTrapStack;i.length&&i[i.length-1]._disable(),i.push(e),e._enable()}deregister(e){e._disable();const i=this._focusTrapStack,r=i.indexOf(e);-1!==r&&(i.splice(r,1),i.length&&i[i.length-1]._enable())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),VF=(()=>{class n{constructor(e,i,r,a,p){this._checker=e,this._ngZone=i,this._focusTrapManager=r,this._document=a,this._inertStrategy=p||new o$}create(e,i={defer:!1}){let r;return r="boolean"==typeof i?{defer:i}:i,new i$(e,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,r)}}return n.\u0275fac=function(e){return new(e||n)(mt(T_),mt(Oi),mt(s$),mt(Mi),mt(r$,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const c$=new Qt("cdk-input-modality-detector-options"),u$={ignoreKeys:[18,17,224,91,16]},Vy=Im({passive:!0,capture:!0});let d$=(()=>{class n{constructor(e,i,r,a){this._platform=e,this._mostRecentTarget=null,this._modality=new Qa(null),this._lastTouchMs=0,this._onKeydown=p=>{var y,T;null!==(T=null===(y=this._options)||void 0===y?void 0:y.ignoreKeys)&&void 0!==T&&T.some(P=>P===p.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Mm(p))},this._onMousedown=p=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function a$(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(p)?"keyboard":"mouse"),this._mostRecentTarget=Mm(p))},this._onTouchstart=p=>{!function l$(n){const t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(p)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Mm(p)):this._modality.next("keyboard")},this._options=Object.assign(Object.assign({},u$),a),this.modalityDetected=this._modality.pipe(CF(1)),this.modalityChanged=this.modalityDetected.pipe(Am()),e.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,Vy),r.addEventListener("mousedown",this._onMousedown,Vy),r.addEventListener("touchstart",this._onTouchstart,Vy)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Vy),document.removeEventListener("mousedown",this._onMousedown,Vy),document.removeEventListener("touchstart",this._onTouchstart,Vy))}}return n.\u0275fac=function(e){return new(e||n)(mt(la),mt(Oi),mt(Mi),mt(c$,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const h$=new Qt("liveAnnouncerElement",{providedIn:"root",factory:function p$(){return null}}),f$=new Qt("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let UF=(()=>{class n{constructor(e,i,r,a){this._ngZone=i,this._defaultOptions=a,this._document=r,this._liveElement=e||this._createLiveElement()}announce(e,...i){const r=this._defaultOptions;let a,p;return 1===i.length&&"number"==typeof i[0]?p=i[0]:[a,p]=i,this.clear(),clearTimeout(this._previousTimeout),a||(a=r&&r.politeness?r.politeness:"polite"),null==p&&r&&(p=r.duration),this._liveElement.setAttribute("aria-live",a),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(y=>this._currentResolve=y)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,"number"==typeof p&&(this._previousTimeout=setTimeout(()=>this.clear(),p)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){var e,i;clearTimeout(this._previousTimeout),null===(e=this._liveElement)||void 0===e||e.remove(),this._liveElement=null,null===(i=this._currentResolve)||void 0===i||i.call(this),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let a=0;a<i.length;a++)i[a].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),this._document.body.appendChild(r),r}}return n.\u0275fac=function(e){return new(e||n)(mt(h$,8),mt(Oi),mt(Mi),mt(f$,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const m$=new Qt("cdk-focus-monitor-default-options"),UT=Im({passive:!0,capture:!0});let yl=(()=>{class n{constructor(e,i,r,a,p){this._ngZone=e,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new fn,this._rootNodeFocusAndBlurListener=y=>{for(let P=Mm(y);P;P=P.parentElement)"focus"===y.type?this._onFocus(y,P):this._onBlur(y,P)},this._document=a,this._detectionMode=(null==p?void 0:p.detectionMode)||0}monitor(e,i=!1){const r=S_(e);if(!this._platform.isBrowser||1!==r.nodeType)return si(null);const a=function Cq(n){if(function Tq(){if(null==IM){const n="undefined"!=typeof document?document.head:null;IM=!(!n||!n.createShadowRoot&&!n.attachShadow)}return IM}()){const t=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),p=this._elementInfo.get(r);if(p)return i&&(p.checkChildren=!0),p.subject;const y={checkChildren:i,subject:new fn,rootNode:a};return this._elementInfo.set(r,y),this._registerGlobalListeners(y),y.subject}stopMonitoring(e){const i=S_(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const a=S_(e);a===this._getDocument().activeElement?this._getClosestElementsInfo(a).forEach(([y,T])=>this._originChanged(y,i,T)):(this._setOrigin(i),"function"==typeof a.focus&&a.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!(null==e||!e.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),a=Mm(e);!r||!r.checkChildren&&i!==a||this._originChanged(i,this._getFocusOrigin(a),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,UT),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,UT)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(br(this._stopInputModalityDetector)).subscribe(a=>{this._setOrigin(a,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,UT),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,UT),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,a)=>{(a===e||r.checkChildren&&a.contains(e))&&i.push([a,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const a=e.labels;if(a)for(let p=0;p<a.length;p++)if(a[p].contains(i))return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(mt(Oi),mt(la),mt(d$),mt(Mi,8),mt(m$,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),g$=(()=>{class n{constructor(e,i){this._elementRef=e,this._focusMonitor=i,this._focusOrigin=null,this.cdkFocusChange=new Cn}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){const e=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(e,1===e.nodeType&&e.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>{this._focusOrigin=i,this.cdkFocusChange.emit(i)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(yl))},n.\u0275dir=cn({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"]}),n})();const HF="cdk-high-contrast-black-on-white",GF="cdk-high-contrast-white-on-black",jM="cdk-high-contrast-active";let qF=(()=>{class n{constructor(e,i){this._platform=e,this._document=i,this._breakpointSubscription=Oo(NM).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,a=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),a){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(jM,HF,GF),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?e.add(jM,HF):2===i&&e.add(jM,GF)}}}return n.\u0275fac=function(e){return new(e||n)(mt(la),mt(Mi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),C_=(()=>{class n{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(e){return new(e||n)(mt(qF))},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[zT]}),n})();class UM{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class _h extends UM{constructor(t,e,i,r){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=r}}class D_ extends UM{constructor(t,e,i,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class _$ extends UM{constructor(t){super(),this.element=t instanceof ei?t.nativeElement:t}}class Ox{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof _h?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof D_?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof _$?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class b$ extends Ox{constructor(t,e,i,r,a){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=p=>{const y=p.element,T=this._document.createComment("dom-portal");y.parentNode.insertBefore(T,y),this.outletElement.appendChild(y),this._attachedPortal=p,super.setDisposeFn(()=>{T.parentNode&&T.parentNode.replaceChild(y,T)})},this._document=a}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||jo.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let bh=(()=>{class n extends Ox{constructor(e,i,r){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new Cn,this.attachDomPortal=a=>{const p=a.element,y=this._document.createComment("dom-portal");a.setAttachedHost(this),p.parentNode.insertBefore(y,p),this._getRootNode().appendChild(p),this._attachedPortal=a,super.setDisposeFn(()=>{y.parentNode&&y.parentNode.replaceChild(p,y)})},this._document=r}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,a=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),p=i.createComponent(a,i.length,e.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(p.hostView.rootNodes[0]),super.setDisposeFn(()=>p.destroy()),this._attachedPortal=e,this._attachedRef=p,this.attached.emit(p),p}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return n.\u0275fac=function(e){return new(e||n)(le(Dp),le(Rs),le(Mi))},n.\u0275dir=cn({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[zn]}),n})(),il=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({}),n})();class $F{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const i=this._customTokens.get(t);return void 0!==i?i:this._parentInjector.get(t,e)}}const y$=["addListener","removeListener"],v$=["addEventListener","removeEventListener"],x$=["on","off"];function ld(n,t,e,i){if(Ue(e)&&(i=e,e=void 0),i)return ld(n,t,e).pipe(MI(i));const[r,a]=function T$(n){return Ue(n.addEventListener)&&Ue(n.removeEventListener)}(n)?v$.map(p=>y=>n[p](t,y,e)):function w$(n){return Ue(n.addListener)&&Ue(n.removeListener)}(n)?y$.map(WF(n,t)):function S$(n){return Ue(n.on)&&Ue(n.off)}(n)?x$.map(WF(n,t)):[];if(!r&&he(n))return Ti(p=>ld(p,t,e))(qt(n));if(!r)throw new TypeError("Invalid event target");return new _n(p=>{const y=(...T)=>p.next(1<T.length?T:T[0]);return r(y),()=>a(y)})}function WF(n,t){return e=>i=>n[e](t,i)}const Fx={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=Fx;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=t(a=>{e=void 0,n(a)});return new Qe(()=>null==e?void 0:e(r))},requestAnimationFrame(...n){const{delegate:t}=Fx;return((null==t?void 0:t.requestAnimationFrame)||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=Fx;return((null==t?void 0:t.cancelAnimationFrame)||cancelAnimationFrame)(...n)},delegate:void 0};new class D$ extends OM{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class C$ extends LM{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Fx.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:a}=t;null!=e&&(null===(r=a[a.length-1])||void 0===r?void 0:r.id)!==e&&(Fx.cancelAnimationFrame(e),t._scheduled=void 0)}});let HM,I$=1;const HT={};function XF(n){return n in HT&&(delete HT[n],!0)}const M$={setImmediate(n){const t=I$++;return HT[t]=!0,HM||(HM=Promise.resolve()),HM.then(()=>XF(t)&&n()),t},clearImmediate(n){XF(n)}},{setImmediate:A$,clearImmediate:R$}=M$,GT={setImmediate(...n){const{delegate:t}=GT;return((null==t?void 0:t.setImmediate)||A$)(...n)},clearImmediate(n){const{delegate:t}=GT;return((null==t?void 0:t.clearImmediate)||R$)(n)},delegate:void 0};new class P$ extends OM{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class k$ extends LM{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=GT.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:a}=t;null!=e&&(null===(r=a[a.length-1])||void 0===r?void 0:r.id)!==e&&(GT.clearImmediate(e),t._scheduled=void 0)}});function GM(n=0,t,e=Bq){let i=-1;return null!=t&&(ps(t)?e=t:i=t),new _n(r=>{let a=function F$(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;a<0&&(a=0);let p=0;return e.schedule(function(){r.closed||(r.next(p++),0<=i?this.schedule(void 0,i):r.complete())},a)})}function ZF(n,t=NT){return function O$(n){return cr((t,e)=>{let i=!1,r=null,a=null,p=!1;const y=()=>{if(null==a||a.unsubscribe(),a=null,i){i=!1;const P=r;r=null,e.next(P)}p&&e.complete()},T=()=>{a=null,p&&e.complete()};t.subscribe(ur(e,P=>{i=!0,r=P,a||qt(n(P)).subscribe(a=ur(e,y,T))},()=>{p=!0,(!i||!a||a.closed)&&e.complete()}))})}(()=>GM(n,t))}const N$=new Qt("cdk-dir-doc",{providedIn:"root",factory:function B$(){return Oo(Mi)}}),z$=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Rm=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new Cn,e){const r=e.documentElement?e.documentElement.dir:null;this.value=function V$(n){const t=(null==n?void 0:n.toLowerCase())||"";return"auto"===t&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?z$.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(mt(N$,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),qT=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({}),n})(),YF=(()=>{class n{constructor(e,i,r){this._ngZone=e,this._platform=i,this._scrolled=new fn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new _n(i=>{this._globalSubscription||this._addGlobalListener();const r=e>0?this._scrolled.pipe(ZF(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):si()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(go(a=>!a||r.indexOf(a)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,a)=>{this._scrollableContainsElement(a,e)&&i.push(a)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let r=S_(i),a=e.getElementRef().nativeElement;do{if(r==a)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>ld(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(mt(Oi),mt(la),mt(Mi,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),cd=(()=>{class n{constructor(e,i,r){this._platform=e,this._change=new fn,this._changeListener=a=>{this._change.next(a)},this._document=r,i.runOutsideAngular(()=>{if(e.isBrowser){const a=this._getWindow();a.addEventListener("resize",this._changeListener),a.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,a=r.getBoundingClientRect();return{top:-a.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-a.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(ZF(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(mt(la),mt(Oi),mt(Mi,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),E_=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({}),n})(),qM=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[qT,E_,qT,E_]}),n})();const H$=["*",[["sbb-option"],["ng-container"],["sbb-option-hint"],["sbb-autocomplete-hint"]]],G$=["*","sbb-option, ng-container, sbb-option-hint, sbb-autocomplete-hint"];function q$(n,t){if(1&n&&dn(0,"sbb-pseudo-checkbox",2),2&n){const e=Ot();Ve("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function $$(n,t){if(1&n&&(ae(0,"span",3),W(1),de()),2&n){const e=Ot();_e(1),Se("(",e.group.label,")")}}const W$=["*"],X$=(new Kd("14.1.7"),"undefined"!=typeof globalThis&&globalThis),Z$="undefined"!=typeof window&&window,Y$="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,$M=X$||"undefined"!=typeof global&&global||Z$||Y$,WM=function(n,...t){if(WM.translate){const i=WM.translate(n,t);n=i[0],t=i[1]}let e=e3(n[0],n.raw[0]);for(let i=1;i<n.length;i++)e+=t[i-1]+e3(n[i],n.raw[i]);return e};function e3(n,t){return":"===t.charAt(0)?n.substring(function K$(n,t){for(let e=1,i=1;e<n.length;e++,i++)if("\\"===t[i])i++;else if(":"===n[e])return e;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(n,t)+1):n}const XM=new Qa("standard");function I_(n){return class extends n{constructor(...t){super(...t),this.variant=XM}get variantSnapshot(){return XM.value}}}const Q$=new Qt("sbb-sanity-checks",{providedIn:"root",factory:function J$(){return!0}});let Pr=(()=>{class n{constructor(e,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,XM.next(this._document.documentElement.classList.contains("sbb-lean")?"lean":"standard"),e._applyBodyHighContrastModeCssClasses(),function eW(){"function"!=typeof $M.$localize&&($M.$localize=Object.assign(WM,$M.$localize))}(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!MM()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return n.\u0275fac=function(e){return new(e||n)(mt(qF),mt(Q$,8),mt(Mi))},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({}),n})();function Ul(n){return class extends n{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=Si(t)}}}function $T(n){return class extends n{constructor(...t){super(...t),this.errorState=!1}updateErrorState(){const t=this.errorState,a=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);a!==t&&(this.errorState=a,this.stateChanges.next())}}}function t3(n){return class extends n{constructor(...t){super(...t),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new _n(e=>{this._isInitialized?this._notifySubscriber(e):this._pendingSubscribers.push(e)})}_markInitialized(){this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(t){t.next(),t.complete()}}}function jy(n,t=0){return class extends n{constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?af(e):this.defaultTabIndex}}}class km{deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this._locale=t}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){const i=this.isValid(t),r=this.isValid(e);return i&&r?!this.compareDate(t,e):i===r}return t===e}clampDate(t,e,i){return e&&this.compareDate(t,e)<0?e:i&&this.compareDate(t,i)>0?i:t}}const WT=new Qt("sbb-date-formats"),tW={dateInput:"EEEEEE, dd.MM.yyyy",dateInputPure:"dd.MM.yyyy",dateA11yLabel:"dd MM yyyy"},n3=new Qt("SBB_DATEPICKER_2DIGIT_YEAR_PIVOT"),nW=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function ZM(n,t){const e=Array(n);for(let i=0;i<n;i++)e[i]=t(i);return e}let r3=(()=>{class n extends km{constructor(e,i){super(),this._locale=e,this._titleCasePipe=new Dk,this._datePipe=new Ek(e),this._yearPivot="number"==typeof i?i:(new Date).getFullYear()-1975}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthName(e){return this._datePipe.transform(e,"LLLL")}getMonthNames(e){let i;switch(e){case"long":i="LLLL";break;case"narrow":i="LLLLL";break;default:i="LLL"}return ZM(12,r=>this._datePipe.transform(new Date(2017,r,1),i))}getDateNames(){return ZM(31,e=>this._datePipe.transform(new Date(2017,0,e+1),"d"))}getDayOfWeekNames(e){let i;switch(e){case"long":i="EEEE";break;case"narrow":i="EEEEE";break;default:i="EEE"}return ZM(7,r=>this._datePipe.transform(new Date(2017,0,r+1),i))}getYearName(e){return this._datePipe.transform(e,"yyyy")}getFirstDayOfWeek(){return 1}getNumDaysInMonth(e){const i=new Date(0);return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.setHours(0,0,0,0),i.getDate()}clone(e){return new Date(e.valueOf())}createDate(e,i,r){if(i<0||i>11)throw Error(`Invalid month index "${i}". Month index has to be between 0 and 11.`);if(r<1)throw Error(`Invalid date "${r}". Date has to be greater than 0.`);const a=this._createDateWithOverflow(e,i,r);if(a.getMonth()!==i)throw Error(`Invalid date "${r}" for month with index "${i}".`);return a}today(){const e=new Date;return e.setHours(0,0,0,0),e}parse(e){return"number"==typeof e?new Date(e):"string"==typeof e?this._parseStringDate(e):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");return this._titleCasePipe.transform(this._datePipe.transform(e,i))}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){const r=e.getMonth()+i,a=new Date(0);a.setFullYear(e.getFullYear(),r,1),a.setHours(0,0,0,0);const p=this.getNumDaysInMonth(a),y=this.clone(e);return y.setMonth(r,Math.min(p,e.getDate())),y}addCalendarDays(e,i){const r=this.clone(e);return r.setDate(r.getDate()+i),r}toIso8601(e){return this._datePipe.transform(e,"yyyy-MM-dd")}deserialize(e){if("string"==typeof e){if(!e)return null;if(nW.test(e)){const i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.valueOf())}invalid(){return new Date(NaN)}_parseStringDate(e){const i=/^(\w+,[ ]?)?(\d+)\.(\d+)\.(\d+)$/.exec(e);if(!i)return null;const r=this._createDateWithOverflow(+i[4],+i[3]-1,+i[2]);return this._normalizeYear(r)}_normalizeYear(e){if(e.getFullYear()<0||e.getFullYear()>=100)return e;const i=e.getFullYear()<=this._yearPivot?2e3:1900;return new Date(e.getFullYear()+i,e.getMonth(),e.getDate())}_createDateWithOverflow(e,i,r){const a=new Date(e,i,r);return e>=0&&e<100&&a.setFullYear(this.getYear(a)-1900),a}}return n.\u0275fac=function(e){return new(e||n)(mt(kc),mt(n3,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),YM=(()=>{class n{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const XT=new Qt("SBB_OPTION_PARENT_COMPONENT"),iW=Ul(class{});let rW=0;const o3=new Qt("SbbOptgroup");let KM=(()=>{class n extends iW{constructor(e){var i;super(),this._labelId="sbb-optgroup-label-"+rW++,this._inert=null!==(i=null==e?void 0:e.inertGroups)&&void 0!==i&&i}}return n.\u0275fac=function(e){return new(e||n)(le(XT,8))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-optgroup"]],hostAttrs:[1,"sbb-optgroup","sbb-menu-group"],hostVars:5,hostBindings:function(e,i){2&e&&(Yn("role",i._inert?null:"group")("aria-disabled",i._inert?null:i.disabled.toString())("aria-labelledby",i._inert?null:i._labelId),l("sbb-disabled",i.disabled))},inputs:{disabled:"disabled",label:"label"},exportAs:["sbbOptgroup"],features:[wi([{provide:o3,useExisting:n}]),zn],ngContentSelectors:G$,decls:4,vars:2,consts:[[1,"sbb-label","sbb-optgroup-label",3,"id"]],template:function(e,i){1&e&&(ss(H$),ae(0,"label",0),W(1),Yr(2),de(),Yr(3,1)),2&e&&(Ve("id",i._labelId),_e(1),Se("",i.label," "))},encapsulation:2,changeDetection:0}),n})(),oW=(()=>{class n{constructor(){this.state="unchecked",this.disabled=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["sbb-pseudo-checkbox"]],hostAttrs:[1,"sbb-pseudo-checkbox"],hostVars:6,hostBindings:function(e,i){2&e&&l("sbb-selection-disabled",i.disabled)("sbb-selection-checked","checked"===i.state)("sbb-selection-indeterminate","indeterminate"===i.state)},inputs:{state:"state",disabled:"disabled"},decls:4,vars:0,consts:[[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"]],template:function(e,i){1&e&&(ae(0,"div",0)(1,"span",1),Is(),ae(2,"svg",2),dn(3,"polyline",3),de()()())},encapsulation:2,changeDetection:0}),n})(),sW=0;class s3{constructor(t,e=!1){this.source=t,this.isUserInput=e}}let Nx=(()=>{class n{constructor(e,i,r,a,p){this._element=e,this._document=i,this._changeDetectorRef=r,this._parent=a,this.group=p,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this._highlighted=!1,this.id="sbb-option-"+sW++,this.onSelectionChange=new Cn,this._stateChanges=new fn}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=Si(e),this._changeDetectorRef.markForCheck()}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this.selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this.active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this.active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!nl(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this.selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_highlight(e,i){if(void 0===this._originalInnerHtml)this._originalInnerHtml=this._element.nativeElement.innerHTML;else{if(e===this._highlightValue)return;this._highlighted&&(this._element.nativeElement.innerHTML=this._originalInnerHtml,this._highlighted=!1)}if(this._highlightValue=e,e&&this._originalInnerHtml){const r=i||(T=>T),a=(e=r(e)).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),p=new RegExp(`${a}+`,"i"),y=this._findAllTextNodesWithMatch(p,r);y.forEach(T=>this._highlightNode(T,p,r)),this._highlighted=!!y.length}}_findAllTextNodesWithMatch(e,i,r=this._element.nativeElement){const a=[],p=r.childNodes;for(let y=0;y<p.length;y++){const T=p[y];3===T.nodeType&&e.test(i(T.textContent||""))?a.push(T):T.childNodes.length&&a.push(...this._findAllTextNodesWithMatch(e,i,T))}return a}_highlightNode(e,i,r){const a=[],p=this._document;i.lastIndex=0;let T,y=e.textContent||"";do{if(T=r(y).match(i),!T){a.push(p.createTextNode(y));continue}T.index&&(a.push(p.createTextNode(y.substring(0,T.index))),y=y.substring(T.index));const z=p.createElement("strong");z.textContent=y.substring(0,T[0].length),a.push(z),y=y.substring(T[0].length)}while(T);const P=e.parentNode;a.forEach(z=>P.insertBefore(z,e)),P.removeChild(e)}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new s3(this,e))}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(Mi),le(lo),le(XT,8),le(o3,8))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-option"]],hostAttrs:["role","option",1,"sbb-option","sbb-menu-item","sbb-link-reset"],hostVars:12,hostBindings:function(e,i){1&e&&Zt("keydown",function(a){return i._handleKeydown(a)})("click",function(){return i._selectViaInteraction()}),2&e&&(Jr("id",i.id),Yn("tabindex",i._getTabIndex())("aria-selected",i._getAriaSelected())("aria-disabled",i.disabled.toString()),l("sbb-selected",i.selected)("sbb-option-multiple",i.multiple)("sbb-focused",i.active)("sbb-disabled",i.disabled))},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["sbbOption"],ngContentSelectors:W$,decls:3,vars:2,consts:[[3,"disabled","state",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],[3,"disabled","state"],[1,"cdk-visually-hidden"]],template:function(e,i){1&e&&(ss(),Ct(0,q$,1,2,"sbb-pseudo-checkbox",0),Yr(1),Ct(2,$$,2,1,"span",1)),2&e&&(Ve("ngIf",i.multiple),_e(2),Ve("ngIf",i.group&&i.group._inert))},dependencies:[Go,oW],styles:[".sbb-option.sbb-menu-item{cursor:default}.sbb-pseudo-checkbox{display:inline-block;margin-right:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-bottom:calc(-0.3rem * var(--sbb-scaling-factor));overflow:hidden;line-height:0}.sbb-pseudo-checkbox .sbb-selection-container{margin:0}"],encapsulation:2,changeDetection:0}),n})();function a3(n,t,e,i){return n<e?n:n+t>e+i?Math.max(0,n-i+t):e}let lW=0,cW=(()=>{class n{constructor(){this.id="sbb-option-hint-"+lW++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["sbb-option-hint"]],hostAttrs:[1,"sbb-option-hint","sbb-label"],hostVars:1,hostBindings:function(e,i){2&e&&Yn("id",i.id)}}),n})(),ZT=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr]}),n})();const uW=["*"];let YT;function Bx(n){var t;return(null===(t=function dW(){if(void 0===YT&&(YT=null,"undefined"!=typeof window)){const n=window;void 0!==n.trustedTypes&&(YT=n.trustedTypes.createPolicy("sbb-esta#angular",{createHTML:t=>t}))}return YT}())||void 0===t?void 0:t.createHTML(n))||n}function l3(n){return Error(`Unable to find icon with the name "${n}"`)}function c3(n){return Error(`The URL provided to SbbIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function u3(n){return Error(`The literal provided to SbbIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class Pm{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let pW=(()=>{class n{constructor(e,i,r,a){this._httpClient=e,this._sanitizer=i,this._errorHandler=a,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["sbb-icons"],this._sbbCdnSupportedNamespaces=["kom","fpl"],this._document=r}addSvgIcon(e,i,r){return this.addSvgIconInNamespace("",e,i,r)}addSvgIconLiteral(e,i,r){return this.addSvgIconLiteralInNamespace("",e,i,r)}addSvgIconInNamespace(e,i,r,a){return this._addSvgIconConfig(e,i,new Pm(r,null,a))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,r,a){const p=this._sanitizer.sanitize(no.HTML,r);if(!p)throw u3(r);const y=Bx(p);return this._addSvgIconConfig(e,i,new Pm("",y,a))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,r){return this._addSvgIconSetConfig(e,new Pm(i,null,r))}addSvgIconSetLiteralInNamespace(e,i,r){const a=this._sanitizer.sanitize(no.HTML,i);if(!a)throw u3(i);const p=Bx(a);return this._addSvgIconSetConfig(e,new Pm("",p,r))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(no.RESOURCE_URL,e);if(!i)throw c3(e);const r=this._cachedIconsByUrl.get(i);return r?si(KT(r)):this._loadSvgIconFromConfig(new Pm(e,null)).pipe(ks(a=>this._cachedIconsByUrl.set(i,a)),ge(a=>KT(a)))}getNamedSvgIcon(e,i=""){const r=d3(i,e);let a=this._svgIconConfigs.get(r);if(a)return this._getSvgFromConfig(a);if(a=this._getIconConfigFromResolvers(i,e),a)return this._svgIconConfigs.set(r,a),this._getSvgFromConfig(a);const p=this._iconSetConfigs.get(i);return p?this._getSvgFromIconSetConfigs(e,p):Iy(l3(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?si(KT(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(ge(i=>KT(i)))}_getSvgFromIconSetConfigs(e,i){const r=this._extractIconWithNameFromAnySet(e,i);return r?si(r):oL(i.filter(p=>!p.svgText).map(p=>this._loadSvgIconSetFromConfig(p).pipe(ef(y=>{const P=`Loading icon set URL: ${this._sanitizer.sanitize(no.RESOURCE_URL,p.url)} failed: ${y.message}`;return this._errorHandler.handleError(new Error(P)),si(null)})))).pipe(ge(()=>{const p=this._extractIconWithNameFromAnySet(e,i);if(!p)throw l3(e);return p}))}_extractIconWithNameFromAnySet(e,i){for(let r=i.length-1;r>=0;r--){const a=i[r];if(a.svgText&&a.svgText.toString().indexOf(e)>-1){const p=this._svgElementFromConfig(a),y=this._extractSvgIconFromSet(p,e,a.options);if(y)return y}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(ks(i=>e.svgText=i),ge(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?si(null):this._fetchIcon(e).pipe(ks(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,r){const a=e.querySelector(`[id="${i}"]`);if(!a)return null;const p=a.cloneNode(!0);if(p.removeAttribute("id"),"svg"===p.nodeName.toLowerCase())return this._setSvgAttributes(p,r);if("symbol"===p.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(p),r);const y=this._svgElementFromString(Bx("<svg></svg>"));return y.appendChild(p),this._setSvgAttributes(y,r)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(e){const i=this._svgElementFromString(Bx("<svg></svg>")),r=e.attributes;for(let a=0;a<r.length;a++){const{name:p,value:y}=r[a];"id"!==p&&i.setAttribute(p,y)}for(let a=0;a<e.childNodes.length;a++)e.childNodes[a].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[a].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){var i;const{url:r,options:a}=e,p=null!==(i=null==a?void 0:a.withCredentials)&&void 0!==i&&i;if(!this._httpClient)throw function hW(){return Error("Could not find HttpClient provider for use with Sbb Angular icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==r)throw Error(`Cannot fetch icon from URL "${r}".`);const y=this._sanitizer.sanitize(no.RESOURCE_URL,r);if(!y)throw c3(r);const T=this._inProgressUrlFetches.get(y);if(T)return T;const P=this._httpClient.get(y,{responseType:"text",withCredentials:p}).pipe(ge(z=>Bx(z)),pT(()=>this._inProgressUrlFetches.delete(y)),xf());return this._inProgressUrlFetches.set(y,P),P}_addSvgIconConfig(e,i,r){return this._svgIconConfigs.set(d3(e,i),r),this}_addSvgIconSetConfig(e,i){const r=this._iconSetConfigs.get(e);return r?r.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let r=0;r<this._resolvers.length;r++){const a=this._resolvers[r](i,e);if(a)return fW(a)?new Pm(a.url,null,a.options):new Pm(a,null)}if(-1!==this._sbbCdnSupportedNamespaces.indexOf(e)){const r=this._sanitizer.bypassSecurityTrustResourceUrl(`https://icons.app.sbb.ch/${e}/${i}.svg`);return new Pm(r,null)}}}return n.\u0275fac=function(e){return new(e||n)(mt(JP,8),mt(tP),mt(Mi,8),mt(Xu))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function KT(n){return n.cloneNode(!0)}function d3(n,t){return n+":"+t}function fW(n){return!(!n.url||!n.options)}const mW=new Qt("sbb-icon-location",{providedIn:"root",factory:function gW(){const n=Oo(Mi),t=n?n.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),h3=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],_W=h3.map(n=>`[${n}]`).join(", "),bW=/^url\(['"]?#(.*?)['"]?\)$/;let vl=(()=>{class n{constructor(e,i,r,a,p){this._elementRef=e,this._iconRegistry=i,this._location=a,this._errorHandler=p,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=Qe.EMPTY,r||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=Si(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=e.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=(this.fontSet?[this._iconRegistry.classNameForFontAlias(this.fontSet)]:this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>e.classList.remove(r)),i.forEach(r=>e.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((r,a)=>{r.forEach(p=>{a.setAttribute(p.name,`url('${e}#${p.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(_W),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let a=0;a<i.length;a++)h3.forEach(p=>{const y=i[a],T=y.getAttribute(p),P=T?T.match(bW):null;if(P){let z=r.get(y);z||(z=[],r.set(y,z)),z.push({name:p,value:P[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,r]=this._splitIconName(e);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(ko(1)).subscribe(a=>this._setSvgElement(a),a=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${a.message}`))})}}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(pW),us("aria-hidden"),le(mW),le(Xu))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-icon"]],hostAttrs:["role","img",1,"sbb-icon","notranslate"],hostVars:5,hostBindings:function(e,i){2&e&&(Yn("data-sbb-icon-type",i._usingFontIcon()?"font":"svg")("data-sbb-icon-name",i._svgName||i.fontIcon)("data-sbb-icon-namespace",i._svgNamespace||i.fontSet),l("sbb-icon-inline",i.inline))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["sbbIcon"],ngContentSelectors:uW,decls:1,vars:0,template:function(e,i){1&e&&(ss(),Yr(0))},styles:[".sbb-icon{background-repeat:no-repeat;display:inline-block;line-height:0;overflow:hidden}.sbb-icon svg:not(.color-immutable) [fill]:not([fill=none]){fill:currentColor}.sbb-icon svg:not(.color-immutable) [stroke]:not([stroke=none]){stroke:currentColor}.sbb-icon svg:not(.color-immutable)>:where(path,polygon,polyline):where(:not([stroke]):not([fill])),.sbb-icon svg:not(.color-immutable) :where(:not([stroke]):not([fill])) :where(path,polygon,polyline):where(:not([stroke]):not([fill])){fill:currentColor}.sbb-icon.sbb-icon-inline{vertical-align:middle;margin-block-start:calc(-.2666666667rem*var(--sbb-scaling-factor));margin-block-end:calc(-.1333333333rem*var(--sbb-scaling-factor))}:where(.sbb-icon-fit) .sbb-icon,.sbb-icon:where(.sbb-icon-fit),:where(.sbb-icon-fit,.sbb-icon-scaled) .sbb-icon svg,.sbb-icon:where(.sbb-icon-fit,.sbb-icon-scaled) svg{width:100%;height:100%}:where(.sbb-icon-scaled) .sbb-icon,.sbb-icon:where(.sbb-icon-scaled){width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default)}"],encapsulation:2,changeDetection:0}),n})(),cs=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[Pr]}),n})();const p3=["*"],yW=["tabListContainer"],vW=["tabList"],xW=["tabListInner"],wW=["nextPaginator"],SW=["previousPaginator"],EW=["sbb-tab-nav-bar",""];new Qt("SbbTabContent"),new Qt("SbbTabLabel"),new Qt("SBB_TAB"),Ul(class{}),new Qt("SBB_TAB_GROUP"),ya("translateTab",[oo("hidden",mi({visibility:"hidden"})),kr("* => void, * => hidden",[mi({opacity:1}),zr("{{animationDurationHide}} ease",mi({opacity:0}))]),kr("hidden => show",[mi({opacity:0,visibility:"visible"}),zr("{{animationDuration}} ease",mi({opacity:1}))]),kr("void => show",zr("0s"))]),new Qt("SBB_TABS_CONFIG"),Ul(class{});const JM=Im({passive:!0}),AW=I_(class{});let RW=(()=>{class n extends AW{constructor(e,i,r,a,p,y){super(),this._elementRef=e,this._changeDetectorRef=i,this._viewportRuler=r,this._ngZone=a,this._platform=p,this._animationMode=y,this._scrollShadowTrigger=new fn,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new fn,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new fn,this._disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new Cn,this.indexFocused=new Cn,a.runOutsideAngular(()=>{ld(e.nativeElement,"mouseleave").pipe(br(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get disablePagination(){return this._disablePagination}set disablePagination(e){this._disablePagination=Si(e)}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){e=af(e),this._selectedIndex!==e&&(this._selectedIndexChanged=!0,this._selectedIndex=e,this._keyManager&&this._keyManager.updateActiveItem(e))}ngAfterViewInit(){ld(this._previousPaginator.nativeElement,"touchstart",JM).pipe(br(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),ld(this._nextPaginator.nativeElement,"touchstart",JM).pipe(br(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){const e=this._viewportRuler.change(150),i=()=>this.updatePagination();this._keyManager=new VM(this._items).withHorizontalOrientation("ltr").withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(ko(1)).subscribe(i),yo(e,this._items.changes,this.variant).pipe(br(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),i()})})}),this._keyManager.change.pipe(br(this._destroyed)).subscribe(r=>{this.indexFocused.emit(r),this._setTabFocus(r)}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(go(r=>"standard"===r),el(()=>yo(ld(this._tabListContainer.nativeElement,"scroll",JM),this._scrollShadowTrigger,e)),va(null),ge(()=>this._calculateScrollState()),Am(),br(this._destroyed)).subscribe(r=>this._applyScrollShadows(r))}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(br(this._destroyed)).subscribe(r=>{"lean"===r?this._tabListContainer.nativeElement.scrollLeft=0:this._tabList.nativeElement.style.removeProperty("transform")})})}ngAfterContentChecked(){this._tabLabelCount!==this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(e){if(!nl(e))switch(e.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(e));break;default:this._keyManager.onKeydown(e)}}_onContentChanges(){const e=this._elementRef.nativeElement.textContent;e!==this._currentTextContent&&(this._currentTextContent=e||"",this._ngZone.run(()=>{this.updatePagination(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(e){!this._isValidIndex(e)||this.focusIndex===e||!this._keyManager||this._keyManager.setActiveItem(e)}_isValidIndex(e){if(!this._items)return!0;const i=this._items?this._items.toArray()[e]:null;return!!i&&!i.disabled}_setTabFocus(e){this._showPaginationControls&&this._scrollToLabel(e),this._items&&this._items.length&&(this._items.toArray()[e].focus(),this._tabListContainer.nativeElement.scrollLeft=0)}_updateTabScrollPosition(){this.disablePagination||"standard"===this.variantSnapshot||(this._tabList.nativeElement.style.transform=`translateX(${Math.round(-this.scrollDistance)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0))}get scrollDistance(){return this._scrollDistance}set scrollDistance(e){this._scrollTo(e)}_scrollHeader(e){return this._scrollTo(this._scrollDistance+("before"===e?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(e){this._stopInterval(),this._scrollHeader(e)}_scrollToLabel(e){if(this.disablePagination||"standard"===this.variantSnapshot)return;const i=this._items?this._items.toArray()[e]:null;if(!i)return;const r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:a,offsetWidth:p}=i.elementRef.nativeElement,T=a+p,P=this.scrollDistance,z=this.scrollDistance+r;a<P?this.scrollDistance-=P-a+60:T>z&&(this.scrollDistance+=T-z+60)}_checkPaginationEnabled(){if(this.disablePagination||"standard"===this.variantSnapshot)this._showPaginationControls=!1;else{const e=this._tabListInner.nativeElement.scrollWidth-this._elementRef.nativeElement.offsetWidth>1;e||(this.scrollDistance=0),e!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=e}}_checkScrollingControls(){this.disablePagination||"standard"===this.variantSnapshot?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0===this.scrollDistance,this._disableScrollAfter=this.scrollDistance===this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabListInner.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(e,i){i&&null!=i.button&&0!==i.button||(this._stopInterval(),GM(650,100).pipe(br(yo(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:r,distance:a}=this._scrollHeader(e);(0===a||a>=r)&&this._stopInterval()}))}_scrollTo(e){if(this.disablePagination||"standard"===this.variantSnapshot)return{maxScrollDistance:0,distance:0};const i=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(i,e)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:i,distance:this._scrollDistance}}_calculateScrollState(){const e=this._tabListContainer.nativeElement;if(e.scrollWidth===e.offsetWidth)return"hidden";const i=0===e.scrollLeft;return i||e.scrollWidth-e.scrollLeft-e.offsetWidth<=1?i?"left":"right":"middle"}_applyScrollShadows(e){const i=this._elementRef.nativeElement;"hidden"===e||"left"===e?i.classList.remove("sbb-tab-header-left-shadow"):i.classList.add("sbb-tab-header-left-shadow"),"hidden"===e||"right"===e?i.classList.remove("sbb-tab-header-right-shadow"):i.classList.add("sbb-tab-header-right-shadow")}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(lo),le(cd),le(Oi),le(la),le(ch,8))},n.\u0275dir=cn({type:n,inputs:{disablePagination:"disablePagination"},features:[zn]}),n})(),m3=0,g3=(()=>{class n extends RW{constructor(e,i,r,a,p,y){super(e,r,a,i,p,y)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(va(null),br(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const e=this._items.toArray();for(let i=0;i<e.length;i++)if(e[i].active)return this.selectedIndex=i,this._changeDetectorRef.markForCheck(),void(this.tabPanel&&(this.tabPanel._activeTabId=e[i].id));this.selectedIndex=-1}_getRole(){return this.tabPanel?"tablist":this._elementRef.nativeElement.getAttribute("role")}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(Oi),le(lo),le(cd),le(la),le(ch,8))},n.\u0275dir=cn({type:n,inputs:{tabPanel:"tabPanel"},features:[zn]}),n})(),JT=(()=>{class n extends g3{constructor(e,i,r,a,p,y){super(e,i,r,a,p,y)}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(Oi),le(lo),le(cd),le(la),le(ch,8))},n.\u0275cmp=Ut({type:n,selectors:[["","sbb-tab-nav-bar",""]],contentQueries:function(e,i,r){if(1&e&&Ro(r,QT,5),2&e){let a;_i(a=bi())&&(i._items=a)}},viewQuery:function(e,i){if(1&e&&(io(yW,7),io(vW,7),io(xW,7),io(wW,5),io(SW,5)),2&e){let r;_i(r=bi())&&(i._tabListContainer=r.first),_i(r=bi())&&(i._tabList=r.first),_i(r=bi())&&(i._tabListInner=r.first),_i(r=bi())&&(i._nextPaginator=r.first),_i(r=bi())&&(i._previousPaginator=r.first)}},hostAttrs:[1,"sbb-tab-nav-bar","sbb-tab-header"],hostVars:3,hostBindings:function(e,i){2&e&&(Yn("role",i._getRole()),l("sbb-tab-header-pagination-controls-enabled",i._showPaginationControls&&"lean"===i.variantSnapshot))},exportAs:["sbbTabNavBar","sbbTabNav"],features:[zn],attrs:EW,ngContentSelectors:p3,decls:13,vars:8,consts:[["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-before","sbb-button-reset-frameless",3,"disabled","click","mousedown","touchend"],["previousPaginator",""],["svgIcon","kom:chevron-left-small",1,"sbb-tab-header-pagination-chevron"],[1,"sbb-tab-link-container","sbb-scrollbar",3,"keydown"],["tabListContainer",""],[1,"sbb-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"sbb-tab-links"],["tabListInner",""],["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-after","sbb-button-reset-frameless",3,"disabled","mousedown","click","touchend"],["nextPaginator",""],["svgIcon","kom:chevron-right-small",1,"sbb-tab-header-pagination-chevron"]],template:function(e,i){1&e&&(ss(),ae(0,"button",0,1),Zt("click",function(){return i._handlePaginatorClick("before")})("mousedown",function(a){return i._handlePaginatorPress("before",a)})("touchend",function(){return i._stopInterval()}),dn(2,"sbb-icon",2),de(),ae(3,"div",3,4),Zt("keydown",function(a){return i._handleKeydown(a)}),ae(5,"div",5,6),Zt("cdkObserveContent",function(){return i._onContentChanges()}),ae(7,"div",7,8),Yr(9),de()()(),ae(10,"button",9,10),Zt("mousedown",function(a){return i._handlePaginatorPress("after",a)})("click",function(){return i._handlePaginatorClick("after")})("touchend",function(){return i._stopInterval()}),dn(12,"sbb-icon",11),de()),2&e&&(l("sbb-tab-header-pagination-disabled",i._disableScrollBefore),Ve("disabled",i._disableScrollBefore||null),_e(5),l("_sbb-animation-noopable","NoopAnimations"===i._animationMode),_e(5),l("sbb-tab-header-pagination-disabled",i._disableScrollAfter),Ve("disabled",i._disableScrollAfter||null))},dependencies:[IF,vl],styles:['.sbb-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.sbb-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:2.1333333333rem;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;color:var(--sbb-color-granite);box-shadow:0 .1333333333rem .2666666667rem -.0666666667rem rgba(0,0,0,.2),0 .2666666667rem .3333333333rem rgba(0,0,0,.1411764706),0 .0666666667rem .6666666667rem rgba(0,0,0,.1215686275)}.sbb-tab-header-pagination::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-header-pagination::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-header-pagination::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}.sbb-tab-header-pagination-controls-enabled .sbb-tab-header-pagination{display:flex}.sbb-tab-header-pagination:hover:not(.sbb-tab-header-pagination-disabled){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-header-pagination::after{right:0;left:0}.sbb-tab-header-pagination.sbb-tab-header-pagination-after.sbb-tab-header-pagination-disabled::after{left:-.0666666667rem}.sbb-tab-header-pagination-disabled .sbb-tab-header-pagination-chevron{opacity:.4}.sbb-tab-header-pagination-disabled{box-shadow:none;cursor:default}.sbb-tab-list{flex-grow:1;position:relative;transition:transform var(--sbb-transition-duration-slow) var(--sbb-transition-timing-fast-start);will-change:transform}.sbb-tab-header{position:relative}:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{position:absolute;top:0;content:"";z-index:2;width:.8rem;height:calc(100% - .5rem);transition:transform var(--sbb-transition-duration-fast) var(--sbb-transition-timing-default);pointer-events:none}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{width:calc(1.6rem * var(--sbb-scaling-factor))}}:where(html:not(.sbb-lean)) .sbb-tab-header::before{left:0;transform:translateX(-100%);background:linear-gradient(270deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-left-shadow::before{transform:translateX(0)}:where(html:not(.sbb-lean)) .sbb-tab-header::after{right:0;transform:translateX(100%);background:linear-gradient(90deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-right-shadow::after{transform:translateX(0)}.sbb-tab-links{display:flex;padding-top:calc(0.1333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tab-links{padding-top:0}:where(html.sbb-lean) .sbb-tab-links::after{content:"";width:100%;flex-grow:1;flex-shrink:1;border-bottom:var(--sbb-border-width) solid var(--sbb-color-graphite)}.sbb-tab-link-container{display:flex;position:relative;flex-grow:1;overflow-x:auto;z-index:1;padding-bottom:1.3333333333rem}:where(html.sbb-lean) .sbb-tab-link-container{overflow:hidden;padding-bottom:0}.sbb-tab-link{margin-right:2.1333333333rem;cursor:pointer;box-sizing:border-box;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;font-family:var(--sbb-font-light);font-size:1.3333333333rem;color:var(--sbb-color-text);line-height:1em;padding-bottom:1.3333333333rem;outline:none;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0)}.sbb-tab-link::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-link::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-link::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-link{margin-right:calc(2.8rem * var(--sbb-scaling-factor));font-size:calc(1.7333333333rem * var(--sbb-scaling-factor))}}:where(html.sbb-lean) .sbb-tab-link{font-size:var(--sbb-font-size);line-height:1.3333333333rem;padding:.4rem 1rem .6rem;background-color:var(--sbb-color-background);margin-right:0;border:var(--sbb-border-width) solid rgba(0,0,0,0);border-bottom:none;border-radius:var(--sbb-border-radius) var(--sbb-border-radius) 0 0}.sbb-tab-link:last-child{margin-right:0 !important}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-label-active::after{width:100%}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active{border-color:var(--sbb-color-graphite)}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active::after{display:none}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{border-bottom-color:var(--sbb-color-call-to-action-hover)}:where(html:not(.sbb-lean)) .sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{width:100%}.sbb-tab-link.sbb-tab-label-active:is(:hover,:focus){color:currentColor;cursor:default}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active:focus-visible{outline:var(--sbb-border-width) solid var(--sbb-color-black);outline-offset:calc(-1*var(--sbb-border-width))}.sbb-tab-link.sbb-tab-disabled{color:var(--sbb-color-storm)}.sbb-tab-link.sbb-tab-disabled:is(:hover,:focus){cursor:default}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-disabled::after{width:0 !important}.sbb-tab-link .sbb-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}:where(html.sbb-lean) .sbb-tab-link .sbb-badge:not(.sbb-badge-hidden){padding-right:.7333333333rem}:where(html.sbb-lean) .sbb-tab-link .sbb-badge-content{transform:scale(0.8)}[sbb-stretch-tabs] .sbb-tab-link{flex-basis:0;flex-grow:1}:where(html.sbb-lean) .sbb-tab-link{overflow:unset}.sbb-tab-link.sbb-tab-disabled{pointer-events:none}:is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){display:block;position:relative;overflow:hidden;transition:height var(--sbb-transition-duration-slow)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){border:var(--sbb-border-width) solid var(--sbb-color-graphite);border-top:none;background-color:var(--sbb-color-background)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){padding:1rem}'],encapsulation:2}),n})();const kW=jy(Ul(class{}));let PW=(()=>{class n extends kW{constructor(e,i,r,a){super(),this._tabNavBar=e,this.elementRef=i,this._focusMonitor=a,this._isActive=!1,this.id="sbb-tab-link-"+m3++,this.tabIndex=parseInt(r,10)||0}get active(){return this._isActive}set active(e){const i=Si(e);i!==this._isActive&&(this._isActive=i,this._tabNavBar.updateActiveLink())}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}_handleKeydown(e){this._tabNavBar.tabPanel&&32===e.keyCode&&this.elementRef.nativeElement.click()}_getAriaControls(){var e;return this._tabNavBar.tabPanel?null===(e=this._tabNavBar.tabPanel)||void 0===e?void 0:e.id:this.elementRef.nativeElement.getAttribute("aria-controls")}_getAriaSelected(){return this._tabNavBar.tabPanel?this.active?"true":"false":this.elementRef.nativeElement.getAttribute("aria-selected")}_getAriaCurrent(){return this.active&&!this._tabNavBar.tabPanel?"page":null}_getRole(){return this._tabNavBar.tabPanel?"tab":this.elementRef.nativeElement.getAttribute("role")}_getTabIndex(){return this._tabNavBar.tabPanel?this._isActive?0:-1:this.tabIndex}}return n.\u0275fac=function(e){return new(e||n)(le(g3),le(ei),us("tabindex"),le(yl))},n.\u0275dir=cn({type:n,inputs:{active:"active",id:"id"},features:[zn]}),n})(),QT=(()=>{class n extends PW{constructor(e,i,r,a){super(e,i,r,a)}}return n.\u0275fac=function(e){return new(e||n)(le(JT),le(ei),us("tabindex"),le(yl))},n.\u0275dir=cn({type:n,selectors:[["","sbb-tab-link",""],["","sbbTabLink",""]],hostAttrs:[1,"sbb-tab-link","sbb-link-reset"],hostVars:11,hostBindings:function(e,i){1&e&&Zt("focus",function(){return i._handleFocus()})("keydown",function(a){return i._handleKeydown(a)}),2&e&&(Yn("aria-controls",i._getAriaControls())("aria-current",i._getAriaCurrent())("aria-disabled",i.disabled)("aria-selected",i._getAriaSelected())("id",i.id)("tabIndex",i._getTabIndex())("role",i._getRole()),l("sbb-tab-disabled",i.disabled)("sbb-tab-label-active",i.active))},inputs:{disabled:"disabled",tabIndex:"tabIndex"},exportAs:["sbbTabLink"],features:[zn]}),n})(),QM=(()=>{class n{constructor(){this.id="sbb-tab-nav-panel-"+m3++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["sbb-tab-nav-panel"]],hostAttrs:["role","tabpanel",1,"sbb-tab-nav-panel"],hostVars:2,hostBindings:function(e,i){2&e&&Yn("aria-labelledby",i._activeTabId)("id",i.id)},inputs:{id:"id"},exportAs:["sbbTabNavPanel"],ngContentSelectors:p3,decls:1,vars:0,template:function(e,i){1&e&&(ss(),Yr(0))},encapsulation:2,changeDetection:0}),n})(),_3=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,il,zT,C_,E_,Pr,cs]}),n})();const ud="undefined"==typeof window||void 0===window.document||window.location.hostname.includes("github.io")?"PROD":"DEBUG",eA="0.16.2",LW="undefined"!=typeof process&&process.versions&&process.versions.node;"DEBUG"===ud&&(console.log("OJP version        : 1.0"),console.log("OJP-JS SDK version : "+eA),console.log("OJP-SDK            : DEBUG features are enabled"));var b3=yt(7904),OW=yt(9611);class tA{constructor(t,e,i,r,a){this.name=t,this.parentName=e,this.attributes=i,this.children=r,this.text=a}findTextFromChildNamed(t){var e;const i=t.split("/");let r=this;return i.forEach((p,y)=>{r&&(r=r.findChildNamed(p))}),null!==(e=null==r?void 0:r.text)&&void 0!==e?e:null}findChildNamed(t){const e=t.split("/");let i=this;return e.forEach((r,a)=>{var p;i=null!==(p=null==i?void 0:i.children.find(T=>T.name===r))&&void 0!==p?p:null}),i}findChildrenNamed(t){t.includes("/")&&(console.error("ERROR - do you want to use more than one level for findChildrenNamed? Use findTextFromChildNamed."),console.log(t));const e=[];return this.children.forEach(i=>{i.name===t&&e.push(i)}),e}computeText(){const t=[];if(null===this.text){if(0===this.children.length)return null;this.children.forEach(e=>{const i=e.computeText();i&&t.push(i)})}else t.push(this.text);return t.join(" ")}}class zx{constructor(){this.mapUriNS={"http://www.vdv.de/ojp":"","http://www.siri.org.uk/siri":"siri"},this.rootNode=new tA("root",null,{},[],null),this.currentNode=this.rootNode,this.stack=[]}resetNodes(){this.rootNode=new tA("root",null,{},[],null),this.currentNode=this.rootNode,this.stack=[]}parseXML(t){if(LW)Promise.resolve().then(yt.t.bind(yt,9611,19)).then(e=>{const i=e.default.createStream(!0,{trim:!0,xmlns:!0});this._parseXML(t,i)});else{const e=OW.createStream(!0,{trim:!0,xmlns:!0});this._parseXML(t,e)}}_parseXML(t,e){this.resetNodes(),e.on("opentag",i=>{this.onOpenTag(i)}),e.on("text",i=>{this.onText(i)}),e.on("closetag",i=>{this.onSaxCloseTag(i)}),e.on("error",i=>{this.onError(i)}),e.on("end",()=>{this.onEnd()}),e.write(t),e.end()}onOpenTag(t){const e=(()=>{var r;const a=[],p=null!==(r=this.mapUriNS[t.uri])&&void 0!==r?r:"";return""!==p&&a.push(p),a.push(t.local),a.join(":")})(),i=new tA(e,this.currentNode.name,t.attributes,[],null);this.currentNode.children.push(i),this.stack.push(i),this.currentNode=i}onText(t){this.currentNode.text=t}onSaxCloseTag(t){this.stack.pop(),this.onCloseTag(this.currentNode.name),this.currentNode=this.stack[this.stack.length-1]}onCloseTag(t){}onError(t){}onEnd(){}}class nA{constructor(t,e,i,r,a){this.fareProductId=t,this.fareProductName=e,this.fareAuthorityRef=i,this.price=r,this.travelClass=a}static initFromFareProductNode(t){const e=t.findTextFromChildNamed("FareProductId"),i=t.findTextFromChildNamed("FareProductName"),r=t.findTextFromChildNamed("FareAuthorityRef"),a=t.findTextFromChildNamed("Price"),p=t.findTextFromChildNamed("TravelClass");if(null===e||null===i||null===r||null===a||null===p)return null;const y=parseFloat(a);return new nA(e,i,r,y,p)}}class iA{constructor(t,e){this.tripId=t,this.tripFareResults=e}static initWithFareResultTreeNode(t){const e=t.findTextFromChildNamed("ResultId");if(null===e)return null;const i=t.findChildrenNamed("TripFareResult"),r=[];return i.forEach(p=>{const y=p.findTextFromChildNamed("FromTripLegIdRef"),T=p.findTextFromChildNamed("ToTripLegIdRef");if(null===y||null===T)return;const P=parseInt(y,10),z=parseInt(T,10),H=p.findChildNamed("FareProduct");if(null===H)return;const J=nA.initFromFareProductNode(H);null!==J&&r.push({fromTripLegIdRef:P,toTripLegIdRef:z,fareProduct:J})}),0===r.length?null:new iA(e,r)}}class FW extends zx{constructor(){super(),this.callback=null,this.fareResults=[]}parseXML(t){this.fareResults=[],super.parseXML(t)}onCloseTag(t){if("FareResult"===t){const e=iA.initWithFareResultTreeNode(this.currentNode);e&&this.fareResults.push(e)}}onError(t){console.error("ERROR: SAX parser"),console.log(t),this.callback&&this.callback({fareResults:this.fareResults,message:"ERROR"})}onEnd(){this.callback&&this.callback({fareResults:this.fareResults,message:"NovaFares.DONE"})}}class lf{constructor(t){this.language=t,this.serviceRequestNode=this.computeBaseServiceRequestNode()}computeBaseServiceRequestNode(){const t=b3.create("OJP",{version:"1.0",encoding:"utf-8"});t.att("xmlns:ojp","http://www.vdv.de/ojp"),t.att("xmlns","http://www.siri.org.uk/siri"),t.att("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),t.att("xmlns:xsd","http://www.w3.org/2001/XMLSchema"),t.att("xsi:schemaLocation","http://www.vdv.de/ojp"),t.att("version","1.0");const e=t.ele("OJPRequest").ele("ServiceRequest");return e.ele("ServiceRequestContext").ele("Language",this.language),e}static buildRequestorRef(){return"OJP_JS_SDK_v"+eA}buildRequestNode(){this.serviceRequestNode=this.computeBaseServiceRequestNode()}buildRequestXML(){return this.buildRequestNode(),this.serviceRequestNode.end({pretty:!0})}}class NW{constructor(t){this.stageConfig=t,this.requestInfo={requestDateTime:null,requestXML:null,responseDateTime:null,responseXML:null,parseDateTime:null,error:null}}fetchResponseForTrips(t){const e=new Date,i=this.buildServiceRequestNode(e);return t.forEach(r=>{this.addTripToServiceRequestNode(i,r,e)}),this.fetchResponse(i)}buildServiceRequestNode(t){const e=b3.create("OJP",{version:"1.0",encoding:"utf-8"});e.att("xmlns","http://www.siri.org.uk/siri"),e.att("xmlns:ojp","http://www.vdv.de/ojp"),e.att("version","1.0");const i=e.ele("OJPRequest").ele("ServiceRequest"),r=t.toISOString();i.ele("RequestTimestamp",r);const a=lf.buildRequestorRef();return i.ele("RequestorRef",a),i}addTripToServiceRequestNode(t,e,i){const r=t.ele("ojp:OJPFareRequest"),a=i.toISOString();r.ele("RequestTimestamp",a);const p=r.ele("ojp:TripFareRequest");e.addToXMLNode(p);const y=r.ele("ojp:Params");y.ele("ojp:FareAuthorityFilter","ch:1:NOVA"),y.ele("ojp:PassengerCategory","Adult"),y.ele("ojp:TravelClass","second");const T=y.ele("ojp:Traveller");T.ele("ojp:Age","25"),T.ele("ojp:PassengerCategory","Adult"),T.ele("ojp:Age","25"),T.ele("ojp:Age","25");const P=T.ele("ojp:EntitlementProducts").ele("ojp:EntitlementProduct");P.ele("ojp:FareAuthorityRef","ch:1:NOVA"),P.ele("ojp:EntitlementProductRef","HTA"),P.ele("ojp:EntitlementProductName","Halbtax-Abonnement")}fetchResponse(t){this.requestInfo.requestXML=t.end({pretty:!0});const e={"Content-Type":"text/xml"};this.stageConfig.authToken&&(e.Authorization="Bearer "+this.stageConfig.authToken);const i={method:"POST",body:this.requestInfo.requestXML,headers:e},r=this.stageConfig.url;return new Promise(p=>{const y={fareResults:[],message:"ERROR"};fetch(r,i).then(T=>T.ok?T.text():(this.requestInfo.error={error:"FetchError",message:"HTTP ERROR - Status:"+T.status+" - URL:"+r},p(y),null)).then(T=>{if(null===T)return this.requestInfo.error={error:"FetchError",message:"Invalid NOVA Response"},void p(y);this.requestInfo.responseXML=T,this.requestInfo.responseDateTime=new Date;const P=new FW;P.callback=z=>{if(this.requestInfo.parseDateTime=new Date,this.requestInfo.responseXML=T,"ERROR"===z.message)return this.requestInfo.error={error:"ParseXMLError",message:"error parsing XML"},void p(y);p(z)},P.parseXML(T)}).catch(T=>{this.requestInfo.error={error:"FetchError",message:T},p(y)})})}}class Ps{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t){return Ps.formatDate(t).substring(11,16)}static formatDistance(t){return t>1e3?(t/1e3).toFixed(1)+"km":t+"m"}}class Bo{constructor(t,e){this.longitude=parseFloat(t.toFixed(6)),this.latitude=parseFloat(e.toFixed(6)),this.properties=null}static initWithStringCoords(t,e){if(null===t||null===e)return null;const i=parseFloat(t),r=parseFloat(e);return 0===i||0===r?null:new Bo(i,r)}static initWithLocationTreeNode(t){const e=t.findTextFromChildNamed("GeoPosition/siri:Longitude"),i=t.findTextFromChildNamed("GeoPosition/siri:Latitude");return Bo.initWithStringCoords(e,i)}static initWithFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates,a=new Bo(e[0],e[1]);return a.properties=t.properties,a}asLngLat(){return[this.longitude,this.latitude]}asLatLngString(t=!0){let e="";return e=t?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,e}asPosition(){return[this.longitude,this.latitude]}distanceFrom(t){const i=(t.latitude-this.latitude)*Math.PI/180,r=(t.longitude-this.longitude)*Math.PI/180,a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),p=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return Math.round(6371*p*1e3)}}class cf{constructor(t,e,i,r="StopPlace"){this.stopPlaceRef=t,this.stopPlaceName=e,this.topographicPlaceRef=i,this.stopType=r}static initWithLocationTreeNode(t){let e="StopPlace",i=t.findTextFromChildNamed("StopPlace/StopPlaceRef"),r=t.findTextFromChildNamed("StopPlace/StopPlaceName/Text"),a=t.findTextFromChildNamed("StopPlace/TopographicPlaceRef");return null===i&&(e="StopPoint",i=t.findTextFromChildNamed("StopPoint/siri:StopPointRef"),r=t.findTextFromChildNamed("StopPoint/StopPointName/Text"),a=t.findTextFromChildNamed("StopPoint/TopographicPlaceRef")),null===i&&(e="StopPoint",i=t.findTextFromChildNamed("siri:StopPointRef")),null===i?null:new cf(i,r,a,e)}static initWithServiceTreeNode(t,e){const i=t.findTextFromChildNamed(e+"StopPointRef"),r=t.findTextFromChildNamed(e+"Text/Text");return i&&r?new cf(i,r,null,"StopPlace"):null}}class eC{constructor(t){this.addressCode=t,this.addressName=null,this.topographicPlaceRef=null,this.topographicPlaceName=null,this.street=null,this.houseNumber=null,this.postCode=null}static initWithLocationTreeNode(t){const e=t.findChildNamed("Address");if(null===e)return null;const i=e.findTextFromChildNamed("AddressCode");if(null===i)return null;const r=new eC(i);return r.addressName=e.findTextFromChildNamed("AddressName/Text"),r.topographicPlaceRef=e.findTextFromChildNamed("TopographicPlaceRef"),r.topographicPlaceName=e.findTextFromChildNamed("TopographicPlaceName"),r.street=e.findTextFromChildNamed("Street"),r.houseNumber=e.findTextFromChildNamed("HouseNumber"),r.postCode=e.findTextFromChildNamed("PostCode"),r}}const rA={service:["atm","hairdresser"],shopping:["all","clothes","optician"],catering:["all"],accommodation:["all"]};class oA{constructor(t,e,i,r,a){this.code=t,this.name=e,this.category=i,this.subCategory=r,this.categoryTags=a}static initWithLocationTreeNode(t){const e=t.findChildNamed("PointOfInterest");if(null===e)return null;const i=e.findTextFromChildNamed("PointOfInterestCode"),r=e.findTextFromChildNamed("PointOfInterestName/Text");if(!i||!r)return null;const a=[];let p=null,y=null;return e.findChildrenNamed("PointOfInterestCategory").forEach(z=>{const H=z.findTextFromChildNamed("OsmTag/Value");H&&a.push(H);const J=z.findTextFromChildNamed("OsmTag/Tag");("POI_0"===J||"amenity"===J)&&(p=H),"POI_1"===J&&(y=H)}),null===p&&(console.error("PointOfInterest.initWithLocationTreeNode error - no category"),p="none"),new oA(i,r,p,y,a)}computePoiMapIcon(){const t="poi-unknown";return this.category in rA?this.subCategory&&rA[this.category].indexOf(this.subCategory)>-1?"poi-"+this.category+"-"+this.subCategory:rA[this.category].indexOf("all")>-1?"poi-"+this.category+"-all":t:t}}class sA{constructor(t,e){this.code=t,this.name=e}static initWithLocationTreeNode(t){const e=t.findTextFromChildNamed("TopographicPlace/TopographicPlaceCode"),i=t.findTextFromChildNamed("TopographicPlace/TopographicPlaceName/Text");return e&&i?new sA(e,i):null}}const BW=/^([0-9\.]+?),([0-9\.]+?)$/;class Ko{constructor(){this.address=null,this.locationName=null,this.stopPlace=null,this.geoPosition=null,this.poi=null,this.topographicPlace=null,this.attributes={},this.probability=null,this.originSystem=null}static initWithTreeNode(t){const e=new Ko;return e.address=eC.initWithLocationTreeNode(t),e.geoPosition=Bo.initWithLocationTreeNode(t),e.locationName=t.findTextFromChildNamed("LocationName/Text"),e.poi=oA.initWithLocationTreeNode(t),e.stopPlace=cf.initWithLocationTreeNode(t),e.topographicPlace=sA.initWithLocationTreeNode(t),e.attributes=Ko.computeAttributes(t),e}static initWithLocationResultTreeNode(t){const e=t.findChildNamed("Location");if(null===e)return null;const i=Ko.initWithTreeNode(e),r=t.findTextFromChildNamed("Probability");return r&&(i.probability=parseFloat(r)),i.originSystem=t.findTextFromChildNamed("OriginSystem"),i}static initWithStopPlaceRef(t,e=""){const i=new Ko;return i.stopPlace=new cf(t,e,null),i}static initWithLngLat(t,e){const i=new Ko;return i.geoPosition=new Bo(t,e),i}static computeAttributes(t){const e={},i=t.findChildNamed("Attribute");i&&i.children.forEach(a=>{const p=a.name.split(":"),y=1===p.length?p[0]:p[1],T=a.computeText();null!==T&&(e[y]=T)});const r=t.findChildNamed("Extension/LocationExtensionStructure");return r&&r.children.forEach(a=>{e[a.name]=a.text}),e}static initWithFeature(t){var e,i,r,a;const p=Bo.initWithFeature(t);if(null===p)return null;const y=t.properties;if(null===y)return null;const T=new Ko;T.geoPosition=p,T.locationName=null!==(e=y.locationName)&&void 0!==e?e:null;const P=y["stopPlace.stopPlaceRef"];if(P){const H=null!==(i=y["stopPlace.stopPlaceName"])&&void 0!==i?i:null;T.stopPlace=new cf(P,H,null)}const z=y.addressCode;if(z){const H=new eC(z);H.addressName=null!==(r=y.addressName)&&void 0!==r?r:null,H.topographicPlaceRef=null!==(a=y.topographicPlaceRef)&&void 0!==a?a:null}return T}static initFromLiteralCoords(t){let e=t.trim();e=e.replace(/\(.+?\)/g,""),e=e.replace(/[^0-9\.,]/g,"");const i=e.match(BW);if(null===i)return null;let r=parseFloat(i[1]),a=parseFloat(i[2]);r>a&&(r=parseFloat(i[2]),a=parseFloat(i[1]));const p=Ko.initWithLngLat(r,a),y=t.trim().match(/\(([^\)]*)\)?/);return null!==y&&(p.locationName=y[1]),p}asGeoJSONFeature(){var t,e,i,r,a,p,y,T,P,z,H,J,oe,fe,Ae;if(null===this.geoPosition)return null;const We={};(null!==(e=null===(t=this.stopPlace)||void 0===t?void 0:t.stopPlaceRef)&&void 0!==e?e:null)&&(We["stopPlace.stopPlaceRef"]=null!==(r=null===(i=this.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"",We["stopPlace.stopPlaceName"]=null!==(p=null===(a=this.stopPlace)||void 0===a?void 0:a.stopPlaceName)&&void 0!==p?p:"",We["stopPlace.topographicPlaceRef"]=null!==(T=null===(y=this.stopPlace)||void 0===y?void 0:y.topographicPlaceRef)&&void 0!==T?T:""),this.address&&(We.addressCode=null!==(z=null===(P=this.address)||void 0===P?void 0:P.addressCode)&&void 0!==z?z:"",We.addressName=null!==(J=null===(H=this.address)||void 0===H?void 0:H.addressName)&&void 0!==J?J:"",We.topographicPlaceRef=null!==(fe=null===(oe=this.address)||void 0===oe?void 0:oe.topographicPlaceRef)&&void 0!==fe?fe:""),this.poi&&(We["poi.name"]=this.poi.name,We["poi.code"]=this.poi.code,We["poi.category"]=this.poi.category,We["poi.subcategory"]=this.poi.subCategory,We["poi.osm.tags"]=this.poi.categoryTags.join(",")),We.locationName=null!==(Ae=this.locationName)&&void 0!==Ae?Ae:"";for(let Nt in this.attributes)We["OJP.Attr."+Nt]=this.attributes[Nt];return{type:"Feature",properties:We,geometry:{type:"Point",coordinates:[this.geoPosition.longitude,this.geoPosition.latitude]}}}computeLocationName(t=!0){var e,i;return null!==(e=this.stopPlace)&&void 0!==e&&e.stopPlaceName?this.stopPlace.stopPlaceName:null!==(i=this.topographicPlace)&&void 0!==i&&i.name?this.topographicPlace.name:this.poi&&this.poi.name?this.poi.name:this.locationName?this.locationName:t&&this.geoPosition?this.geoPosition.asLatLngString():null}findClosestLocation(t){const e=this.geoPosition;if(null===e)return null;let i=null;return t.forEach(r=>{const a=r.geoPosition;if(null===a)return;const p=e.distanceFrom(a);(null===i||p<i.distance)&&(i={location:r,distance:p})}),i}getLocationType(){return this.stopPlace?"stop":this.poi?"poi":this.address?"address":this.topographicPlace?"topographicPlace":null}patchWithAnotherLocation(t){this.locationName=t.locationName,this.stopPlace=t.stopPlace,this.geoPosition=t.geoPosition}}class yh{constructor(t){Array.isArray(t)||(t=[t]),this.minLongitude=Math.min.apply(null,t.map(r=>r.longitude)),this.minLatitude=Math.min.apply(null,t.map(r=>r.latitude)),this.maxLongitude=Math.max.apply(null,t.map(r=>r.longitude)),this.maxLatitude=Math.max.apply(null,t.map(r=>r.latitude)),this.southWest=new Bo(this.minLongitude,this.minLatitude),this.northEast=new Bo(this.maxLongitude,this.maxLatitude),this.center=new Bo((this.southWest.longitude+this.northEast.longitude)/2,(this.southWest.latitude+this.northEast.latitude)/2)}static initFromGeoPosition(t,e,i){const r=.1*e/7612,a=.1*i/11119,p=new Bo(t.longitude-r/2,t.latitude-a/2),y=new Bo(t.longitude+r/2,t.latitude+a/2);return new yh([p,y])}static initFromGeoJSONFeatures(t){const e=new yh([]);return t.forEach(i=>{var r;const a=null!==(r=i.bbox)&&void 0!==r?r:null;if(a){const p=new Bo(a[0],a[1]);e.extend(p);const y=new Bo(a[2],a[3]);e.extend(y)}else"LineString"===i.geometry.type&&i.geometry.coordinates.forEach(y=>{const T=new Bo(y[0],y[1]);e.extend(T)})}),e}extend(t){Array.isArray(t)||(t=[t]),t.forEach(r=>{const a=Math.min(this.southWest.longitude,r.longitude),p=Math.min(this.southWest.latitude,r.latitude),y=Math.max(this.northEast.longitude,r.longitude),T=Math.max(this.northEast.latitude,r.latitude);this.southWest=new Bo(a,p),this.northEast=new Bo(y,T)}),this.center=new Bo((this.southWest.longitude+this.northEast.longitude)/2,(this.southWest.latitude+this.northEast.latitude)/2),this.minLongitude=this.southWest.longitude,this.minLatitude=this.southWest.latitude,this.maxLongitude=this.northEast.longitude,this.maxLatitude=this.northEast.latitude}asFeatureBBOX(){return[this.southWest.longitude,this.southWest.latitude,this.northEast.longitude,this.northEast.latitude]}isValid(){return this.southWest.longitude!==1/0}containsGeoPosition(t){return!(t.longitude<this.southWest.longitude||t.latitude<this.southWest.latitude||t.longitude>this.northEast.longitude||t.latitude>this.northEast.latitude)}computeWidth(){const t=new Bo(this.southWest.longitude,this.northEast.latitude);return(new Bo(this.northEast.longitude,this.southWest.latitude).distanceFrom(this.southWest)+this.northEast.distanceFrom(t))/2}computeHeight(){const t=new Bo(this.southWest.longitude,this.northEast.latitude);return(new Bo(this.northEast.longitude,this.southWest.latitude).distanceFrom(this.northEast)+this.southWest.distanceFrom(t))/2}asPolygon(){const t=this.southWest,e=new Bo(this.southWest.longitude,this.northEast.latitude),i=this.northEast,r=new Bo(this.northEast.longitude,this.southWest.latitude);return{type:"Polygon",coordinates:[[t.asPosition(),e.asPosition(),i.asPosition(),r.asPosition(),t.asPosition()]]}}}class aA{static convertStopPointToStopPlace(t){if(!t.includes(":sloid:"))return t;const e=t.match(/^([^:]+?):([^:]+?):sloid:([^:]+?):([^:]+?):([^:]+?)$/);return null===e?t:"ch"===e[1]?"85"+e[3].padStart(5,"0").slice(-5):(console.log("convertStopPointToStopPlace: unhandled countryRef for "+t),console.log(e),t)}}class Vx{constructor(t,e){if(this.timetableTime=t,this.estimatedTime=e,e){const i=(e.getTime()-t.getTime())/1e3;this.delayMinutes=Math.floor(i/60)}else this.delayMinutes=null}static initWithParentTreeNode(t,e){const i=t.findChildNamed(e);return null===i?null:Vx.initWithContextTreeNode(i)}static initWithContextTreeNode(t){const e=t.findTextFromChildNamed("TimetabledTime");if(null===e)return null;const i=new Date(Date.parse(e));let r=null;const a=t.findTextFromChildNamed("EstimatedTime");return a&&(r=new Date(Date.parse(a))),new Vx(i,r)}}class uf{constructor(t,e,i,r,a,p){this.stopPointType=t,this.location=e,this.arrivalData=i,this.departureData=r,this.plannedPlatform=a,this.actualPlatform=null,this.sequenceOrder=p,this.isNotServicedStop=null,this.siriSituationIds=[],this.siriSituations=[],this.vehicleAccessType=null}static initWithTreeNode(t,e){const i=t.findTextFromChildNamed("siri:StopPointRef"),r=t.findTextFromChildNamed("StopPointName/Text");if(!i||!r)return null;const a=new Ko;a.stopPlace=new cf(i,r,null);const p=Vx.initWithParentTreeNode(t,"ServiceArrival"),y=Vx.initWithParentTreeNode(t,"ServiceDeparture"),T=t.findTextFromChildNamed("PlannedQuay/Text"),P=t.findTextFromChildNamed("Order"),z=null===P?null:parseInt(P,10),H=new uf(e,a,p,y,T,z);H.actualPlatform=t.findTextFromChildNamed("EstimatedQuay/Text");const J=t.findChildNamed("NotServicedStop");return J&&(H.isNotServicedStop="true"===J.text),H.siriSituationIds=[],t.findChildrenNamed("SituationFullRef").forEach(fe=>{const Ae=fe.findTextFromChildNamed("siri:SituationNumber");Ae&&H.siriSituationIds.push(Ae)}),H.vehicleAccessType=uf.computePlatformAssistance(t),H}static computePlatformAssistance(t){const e=t.findTextFromChildNamed("NameSuffix/Text");return null===e?null:"PLATFORM_ACCESS_WITH_ASSISTANCE"===e?"PLATFORM_ACCESS_WITH_ASSISTANCE":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===e?"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===e?"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE":"PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===e?"PLATFORM_ACCESS_WITHOUT_ASSISTANCE":"NO_DATA"===e?"NO_DATA":"ALTERNATIVE_TRANSPORT"===e?"ALTERNATIVE_TRANSPORT":("DEBUG"===ud&&console.log("StopPoint.computePlatformAssistance - cant compute platform from text:--"+e+"--"),null)}}class lA{constructor(t,e,i,r){this.ptMode=t,this.subMode=e,this.name=i,this.shortName=r,this.isDemandMode=!1}static initWithServiceTreeNode(t){var e,i;const r=t.findChildNamed("Mode");if(null===r)return null;const a=r.findTextFromChildNamed("PtMode");if(null===a)return null;let p=null;const y=null!==(e=r.children.find(J=>J.name.toLowerCase().endsWith("submode")))&&void 0!==e?e:null;null!==y&&(p={key:y.name.replace("siri:",""),value:null!==(i=y.text)&&void 0!==i?i:"subMode text n/a"});const T=t.findTextFromChildNamed("Mode/Name/Text"),P=t.findTextFromChildNamed("Mode/ShortName/Text"),z=new lA(a,p,T,P),H=t.findTextFromChildNamed("Mode/siri:BusSubmode");return z.isDemandMode="demandAndResponseBus"===H||"unknown"===H,z}isRail(){return"rail"===this.ptMode}hasPrecisePolyline(){return!!this.isDemandMode||-1===["bus","tram"].indexOf(this.ptMode)}addToXMLNode(t){const e=t.ele("ojp:Mode");e.ele("ojp:PtMode",this.ptMode),this.name&&e.ele("ojp:Name").ele("ojp:Text",this.name),this.shortName&&e.ele("ojp:ShortName").ele("ojp:Text",this.shortName)}}class jx{constructor(t,e,i){this.journeyRef=t,this.lineRef=null,this.operatingDayRef=null,this.directionRef=null,this.ptMode=e,this.agencyID=i,this.originStopPlace=null,this.destinationStopPlace=null,this.serviceLineNumber=null,this.journeyNumber=null,this.siriSituationIds=[],this.siriSituations=[],this.serviceAttributes={},this.hasCancellation=null,this.hasDeviation=null,this.isUnplanned=null}static initWithTreeNode(t){const e=t.findChildNamed("Service");if(null===e)return null;const i=e.findTextFromChildNamed("JourneyRef"),r=lA.initWithServiceTreeNode(e),a=(()=>{const H=e.findTextFromChildNamed("OperatorRef");return null===H?"n/a OperatorRef":H.replace("ojp:","")})();if(!i||!r)return null;const p=new jx(i,r,a);p.lineRef=e.findTextFromChildNamed("siri:LineRef"),p.directionRef=e.findTextFromChildNamed("siri:DirectionRef"),p.operatingDayRef=e.findTextFromChildNamed("OperatingDayRef"),p.originStopPlace=cf.initWithServiceTreeNode(e,"Origin"),p.destinationStopPlace=cf.initWithServiceTreeNode(e,"Destination"),p.serviceLineNumber=e.findTextFromChildNamed("PublishedLineName/Text"),p.journeyNumber=t.findTextFromChildNamed("Extension/PublishedJourneyNumber/Text"),p.siriSituationIds=[],e.findChildrenNamed("SituationFullRef").forEach(H=>{const J=H.findTextFromChildNamed("siri:SituationNumber");J&&p.siriSituationIds.push(J)}),p.serviceAttributes={},e.findChildrenNamed("Attribute").forEach(H=>{let J=H.findTextFromChildNamed("Code");if(null===J)return console.error("ERROR - cant find code for Attribute"),void console.log(H);J.startsWith("A_")&&(J=J.replace(/A_*/,""));const oe=H.findTextFromChildNamed("Text/Text");if(null===oe)return console.error("ERROR - cant find code/text for Attribute"),void console.log(H);const fe={code:J,text:oe,extra:{}};H.children.forEach(Ae=>{if(Ae.name.startsWith("siri:")){const We=Ae.name.split("siri:");if(2!==We.length)return;const tn=Ae.text;if(null===tn)return;fe.extra[We[1]]=tn}}),p.serviceAttributes[J]=fe});const T=e.findChildNamed("Cancelled");T&&(p.hasCancellation="true"===T.text);const P=e.findChildNamed("Deviation");P&&(p.hasDeviation="true"===P.text);const z=e.findChildNamed("Unplanned");return z&&(p.isUnplanned="true"===z.text),p}formatServiceName(){var t,e,i,r;if(this.ptMode.isDemandMode)return null!==(t=this.serviceLineNumber)&&void 0!==t?t:"OnDemand";const a=[];return this.serviceLineNumber?(this.ptMode.isRail()||a.push(null!==(e=this.ptMode.shortName)&&void 0!==e?e:this.ptMode.ptMode),a.push(this.serviceLineNumber),a.push(null!==(i=this.journeyNumber)&&void 0!==i?i:"")):a.push(null!==(r=this.ptMode.shortName)&&void 0!==r?r:this.ptMode.ptMode),a.push("("+this.agencyID+")"),a.join(" ")}addToXMLNode(t){const e=t.ele("ojp:Service");e.ele("ojp:JourneyRef",this.journeyRef),this.lineRef&&e.ele("LineRef",this.lineRef),this.directionRef&&e.ele("DirectionRef",this.directionRef),this.ptMode.addToXMLNode(e),this.serviceLineNumber&&e.ele("ojp:PublishedLineName").ele("ojp:Text",this.serviceLineNumber);let i=this.agencyID;i.startsWith("ojp:")||(i="ojp:"+i),e.ele("ojp:OperatorRef",i)}}class cA{constructor(t,e){this.stopPoint=t,this.journeyService=e,this.prevStopPoints=[],this.nextStopPoints=[]}static initWithTreeNode(t){const e=t.findChildNamed("StopEvent");if(null===e)return null;const i=e.findChildNamed("ThisCall/CallAtStop");if(null===i)return null;const r=uf.initWithTreeNode(i,"Intermediate");if(null===r)return null;const a=jx.initWithTreeNode(e);if(null===a)return null;const p=new cA(r,a);return["PreviousCall","OnwardCall"].forEach(T=>{const z="PreviousCall"===T?p.prevStopPoints:p.nextStopPoints;e.findChildrenNamed(T).forEach(J=>{const oe=J.findChildNamed("CallAtStop");if(null===oe)return;const fe=uf.initWithTreeNode(oe,"Intermediate");fe&&z.push(fe)})}),p}patchStopEventLocations(t){let e=[this.stopPoint];["prev","next"].forEach(r=>{e=e.concat("prev"===r?this.prevStopPoints:this.nextStopPoints)}),e.forEach(r=>{var a,p;let y=null!==(p=null===(a=r.location.stopPlace)||void 0===a?void 0:a.stopPlaceRef)&&void 0!==p?p:null;null!==y?(y in t||(y=aA.convertStopPointToStopPlace(y)),y in t?r.location.patchWithAnotherLocation(t[y]):"DEBUG"===ud&&(console.error("StopEvent.patchLocation - no stopPlaceRef found in mapContextLocations"),console.log(r),console.log("location.stopPlace?.stopPlaceRef :"+y),console.log(t))):"DEBUG"===ud&&(console.error("StopEvent.patchStopEventLocations - no stopPlaceRef found in location"),console.log(r))})}patchSituations(t){this.stopPoint.siriSituations=[],this.stopPoint.siriSituationIds.concat(this.journeyService.siriSituationIds).forEach(i=>{var r;const a=null!==(r=t[i])&&void 0!==r?r:null;a&&this.stopPoint.siriSituations.push(a)})}}function y3(n,t,e,i,r,a,p){try{var y=n[a](p),T=y.value}catch(P){return void e(P)}y.done?t(T):Promise.resolve(T).then(i,r)}function ua(n){return function(){var t=this,e=arguments;return new Promise(function(i,r){var a=n.apply(t,e);function p(T){y3(a,i,r,p,y,"next",T)}function y(T){y3(a,i,r,p,y,"throw",T)}p(void 0)})}}const df={url:"n/a",authToken:null};var zW=yt(8472);class tC{constructor(t){this.stageConfig=t,this.requestInfo={requestDateTime:null,requestXML:null,responseDateTime:null,responseXML:null,parseDateTime:null,error:null},this.logRequests=!1,this.mockRequestXML=null,this.mockResponseXML=null}buildRequestXML(){return"<override/>"}fetchOJPResponse(){this.requestInfo.requestDateTime=new Date,this.requestInfo.requestXML=this.mockRequestXML?this.mockRequestXML:this.buildRequestXML();const t=this.stageConfig.url;this.logRequests&&(console.log("OJP Request: /POST - "+t),console.log(this.requestInfo.requestXML));const e={"Content-Type":"text/xml"};this.stageConfig.authToken&&(e.Authorization="Bearer "+this.stageConfig.authToken);const i={method:"POST",body:this.requestInfo.requestXML,headers:e};return new Promise(a=>{if(this.mockResponseXML)return this.requestInfo.responseXML=this.mockResponseXML,this.requestInfo.responseDateTime=new Date,void a(this.requestInfo);zW(t,i).then(p=>p.ok?p.text():(this.requestInfo.error={error:"FetchError",message:"HTTP ERROR - Status:"+p.status+" - URL:"+t},null)).then(p=>{null!==p&&(this.requestInfo.responseXML=p,this.requestInfo.responseDateTime=new Date),a(this.requestInfo)}).catch(p=>{this.requestInfo.error={error:"FetchError",message:p},a(this.requestInfo)})})}}class VW extends zx{constructor(){super(),this.callback=null,this.locations=[]}parseXML(t){this.locations=[],super.parseXML(t)}onCloseTag(t){if("Location"===t&&"OJPLocationInformationDelivery"===this.currentNode.parentName){const e=Ko.initWithLocationResultTreeNode(this.currentNode);e&&this.locations.push(e)}}onError(t){console.error("ERROR: SAX parser"),console.log(t),this.callback&&this.callback({locations:this.locations,message:"ERROR"})}onEnd(){this.callback&&this.callback({locations:this.locations,message:"LocationInformation.DONE"})}}class dd extends lf{constructor(t){super(t),this.locationName=null,this.stopPlaceRef=null,this.restrictionTypes=[],this.poiRestriction=null,this.numberOfResults=null,this.bboxWest=null,this.bboxNorth=null,this.bboxEast=null,this.bboxSouth=null,this.circleCenter=null,this.circleRadius=null}static initWithLocationName(t,e,i=null,r=10){const a=new dd(t);return a.locationName=e,a.numberOfResults=r,null!==i&&(a.restrictionTypes=i),a}static initWithStopPlaceRef(t,e){const i=new dd(t);return i.stopPlaceRef=e,i}static initWithBBOXAndType(t,e,i,r,a,p,y=1e3,T=null){const P=new dd(t);return P.bboxWest=e,P.bboxNorth=i,P.bboxEast=r,P.bboxSouth=a,P.numberOfResults=y,P.restrictionTypes=p,P.poiRestriction=T,P}static initWithCircleLngLatRadius(t,e,i,r,a=[],p=1e3){const y=new dd(t);return y.circleCenter=new Bo(e,i),y.circleRadius=r,y.restrictionTypes=a,y.numberOfResults=p,y}buildRequestNode(){var t,e,i,r,a,p,y;super.buildRequestNode();const P=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",P),this.serviceRequestNode.ele("RequestorRef",lf.buildRequestorRef());const z=this.serviceRequestNode.ele("ojp:OJPLocationInformationRequest");z.ele("RequestTimestamp",P);const H=null!==(t=this.locationName)&&void 0!==t?t:null;null!==H&&z.ele("ojp:InitialInput").ele("ojp:LocationName",H);const J=null!==(e=this.stopPlaceRef)&&void 0!==e?e:null;if(J){const un=z.ele("ojp:PlaceRef");un.ele("ojp:StopPlaceRef",J),un.ele("ojp:LocationName").ele("Text","n/a")}const oe=null!==(i=this.bboxWest)&&void 0!==i?i:null,fe=null!==(r=this.bboxNorth)&&void 0!==r?r:null,Ae=null!==(a=this.bboxEast)&&void 0!==a?a:null,We=null!==(p=this.bboxSouth)&&void 0!==p?p:null;if(oe&&fe&&Ae&&We){const un=z.ele("ojp:InitialInput").ele("ojp:GeoRestriction").ele("ojp:Rectangle"),Zn=un.ele("ojp:UpperLeft");Zn.ele("Longitude",oe.toFixed(6)),Zn.ele("Latitude",fe.toFixed(6));const ci=un.ele("LowerRight");ci.ele("Longitude",Ae.toFixed(6)),ci.ele("Latitude",We.toFixed(6))}if(null!==this.circleCenter&&null!==this.circleRadius){const un=z.ele("ojp:InitialInput").ele("ojp:GeoRestriction").ele("ojp:Circle"),Zn=un.ele("ojp:Center");Zn.ele("Longitude",this.circleCenter.longitude.toFixed(6)),Zn.ele("Latitude",this.circleCenter.latitude.toFixed(6)),un.ele("Radius",this.circleRadius)}const ot=z.ele("ojp:Restrictions");this.restrictionTypes.forEach(un=>{if(ot.ele("ojp:Type",un),"poi"===un&&this.poiRestriction){const ci=ot.ele("ojp:PointOfInterestFilter").ele("PointOfInterestCategory"),Ui="shared_mobility"===this.poiRestriction.poiType?"amenity":"POI";this.poiRestriction.tags.forEach(Lr=>{const pr=ci.ele("OsmTag");pr.ele("ojp:Tag",Ui),pr.ele("ojp:Value",Lr)})}});const tn=null!==(y=this.numberOfResults)&&void 0!==y?y:10;ot.ele("ojp:NumberOfResults",tn),z.ele("Extensions").ele("ojp:ParamsExtension").ele("ojp:PrivateModeFilter").ele("ojp:Exclude","false")}}class rl extends tC{constructor(t,e){super(t),this.requestParams=e,this.requestInfo.requestXML=this.buildRequestXML()}static initWithResponseMock(t){const e=new dd("en"),i=new rl(df,e);return i.mockResponseXML=t,i}static initWithRequestMock(t,e=df){const i=new dd("en"),r=new rl(e,i);return r.mockRequestXML=t,r}static initWithLocationName(t,e,i,r,a=10){const p=dd.initWithLocationName(e,i,r,a);return new rl(t,p)}static initWithStopPlaceRef(t,e,i){const r=dd.initWithStopPlaceRef(e,i);return new rl(t,r)}static initWithCircleLngLatRadius(t,e,i,r,a,p=[],y=1e3){const T=dd.initWithCircleLngLatRadius(e,i,r,a,p,y);return new rl(t,T)}static initWithBBOXAndType(t,e,i,r,a,p,y,T=1e3,P=null){const z=dd.initWithBBOXAndType(e,i,r,a,p,y,T,P);return new rl(t,z)}buildRequestXML(){return this.requestParams.buildRequestXML()}fetchResponse(){var t=this;return ua(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{const r={locations:[],message:null};if(null!==t.requestInfo.error||null===t.requestInfo.responseXML)return r.message="ERROR",void i(r);const a=new VW;a.callback=({locations:p,message:y})=>{r.locations=p,r.message=y,"LocationInformation.DONE"===y&&(t.requestInfo.parseDateTime=new Date),i(r)},a.parseXML(t.requestInfo.responseXML)})})()}fetchLocations(){var t=this;return ua(function*(){const e=yield t.fetchResponse();return new Promise(r=>{"LocationInformation.DONE"===e.message&&r(e.locations)})})()}}class nC extends lf{constructor(t,e,i,r,a){super(t),this.stopPlaceRef=e,this.geoPosition=i,this.depArrTime=a,this.numberOfResults=10,this.stopEventType=r,this.includePreviousCalls=!1,this.includeOnwardCalls=!1,this.includeRealtimeData=!0}static Empty(){return new nC("en",null,null,"departure",new Date)}buildRequestNode(){super.buildRequestNode();const t=(new Date).toISOString(),e=this.depArrTime.toISOString();this.serviceRequestNode.ele("RequestTimestamp",t),this.serviceRequestNode.ele("RequestorRef",lf.buildRequestorRef());const i=this.serviceRequestNode.ele("ojp:OJPStopEventRequest");i.ele("RequestTimestamp",t);const r=i.ele("ojp:Location");if(this.stopPlaceRef){const y=r.ele("ojp:PlaceRef");y.ele("ojp:StopPlaceRef",this.stopPlaceRef),y.ele("ojp:LocationName").ele("Text","")}r.ele("ojp:DepArrTime",e);const a=i.ele("ojp:Params");a.ele("ojp:NumberOfResults",this.numberOfResults),a.ele("ojp:StopEventType",this.stopEventType),a.ele("ojp:IncludePreviousCalls",this.includePreviousCalls),a.ele("ojp:IncludeOnwardCalls",this.includeOnwardCalls),a.ele("ojp:IncludeRealtimeData",this.includeRealtimeData),i.ele("Extensions").ele("ojp:ParamsExtension").ele("ojp:PrivateModeFilter").ele("ojp:Exclude","false")}}class uA{constructor(t){this.sourceType=t,this.countryRef=null,this.name=null,this.externalCode=null}static initWithSituationTreeNode(t){const e=t.findTextFromChildNamed("siri:Source/siri:SourceType");if(null===e)return console.log("ERROR - cant PtSituationSource.initFromSituationNode"),console.log(t),null;const i=new uA(e);return i.countryRef=t.findTextFromChildNamed("siri:Source/siri:CountryRef"),i.name=t.findTextFromChildNamed("siri:Source/siri:Name"),i.externalCode=t.findTextFromChildNamed("siri:Source/siri:ExternalCode"),i}}class Fc{constructor(t,e,i,r,a,p,y,T,P,z,H,J,oe){this.situationNumber=t,this.creationTime=e,this.countryRef=i,this.participantRef=r,this.version=a,this.source=p,this.progress=y,this.validityPeriods=T,this.alertCause=P,this.priority=z,this.scopeType=H,this.publishingActions=J,this.isPlanned=oe,this.situationContent=null,this.treeNode=null}static initWithSituationTreeNode(t){var e,i,r,a;const p=t.findTextFromChildNamed("siri:SituationNumber"),y=t.findTextFromChildNamed("siri:CreationTime");if(null===y)return console.error("ERROR - creationTimeS is null","PtSituationElement.initFromSituationNode"),console.log(t),null;const T=new Date(y),P=null!==(e=t.findTextFromChildNamed("siri:CountryRef"))&&void 0!==e?e:"n/a CountryRef",z=null!==(i=t.findTextFromChildNamed("siri:ParticipantRef"))&&void 0!==i?i:"n/a ParticipantRef",H=t.findTextFromChildNamed("siri:Version");if(null===H)return console.error("ERROR - Version is NULL","PtSituationElement.initFromSituationNode"),console.log(t),null;const J=parseInt(H),oe=uA.initWithSituationTreeNode(t),fe=null!==(r=t.findTextFromChildNamed("siri:Progress"))&&void 0!==r?r:"n/a Progress",Ae=[];if(t.findChildrenNamed("siri:ValidityPeriod").forEach(Lr=>{const pr=Lr.findTextFromChildNamed("siri:StartTime"),Zs=Lr.findTextFromChildNamed("siri:EndTime");if(!pr||!Zs)return;const Sl={startDate:new Date(pr),endDate:new Date(Zs)};Ae.push(Sl)}),0===Ae.length)return console.error("initFromSituationNode: EMPTY <ValidityPeriod>"),console.log(p),console.log(t),null;const ot=null!==(a=t.findTextFromChildNamed("siri:AlertCause"))&&void 0!==a?a:"n/a AlertCause",tn=t.findTextFromChildNamed("siri:Priority");if(null===tn)return console.error("ERROR - Priority is NULL","PtSituationElement.initFromSituationNode"),console.log(t),null;const Nt=parseInt(tn),un=(()=>{const Lr=t.findTextFromChildNamed("siri:ScopeType");return"line"===Lr||"route"===Lr?"line":"stopPlace"===Lr||"stopPoint"===Lr?"stopPlace":"vehicleJourney"===Lr?"vehicleJourney":"unknown"})();if(!p||!oe)return console.error("ERROR - cant init","PtSituationElement.initFromSituationNode"),console.log(t),null;const ci="true"===t.findTextFromChildNamed("siri:Planned"),Fi=Fc.computePublishingActionsFromSituationNode(p,un,t),Ui=new Fc(p,T,P,z,J,oe,fe,Ae,ot,Nt,un,Fi,ci);return Ui.treeNode=t,Ui.situationContent=this.computeSituationContent(t),0===Ui.publishingActions.length&&null===Ui.situationContent&&console.error("PtSituationElement.initFromSituationNode: NO publishing action found and also situationContent is null"),Ui}static computePublishingActionsFromSituationNode(t,e,i){const r=[],a=i.findChildNamed("siri:PublishingActions");return null===a||a.findChildrenNamed("siri:PublishingAction").forEach(y=>{const T=Fc.computePublishingAction(t,e,y);if(null===T)return console.error("ERROR - cant compute PublishingAction","PtSituationElement.initFromSituationNode"),void console.log(y);r.push(T)}),r}static computePublishingAction(t,e,i){const r=i.findChildNamed("siri:PassengerInformationAction");if(null===r)return console.error("computePublishingAction: NO <PassengerInformationAction>"),console.log(t),console.log(i),null;const a=r.findTextFromChildNamed("siri:ActionRef"),p=r.findTextFromChildNamed("siri:OwnerRef"),y=[];r.findChildrenNamed("siri:Perspective").forEach(oe=>{const fe=oe.text;fe&&y.push(fe)});const P=i.findChildNamed("siri:PassengerInformationAction/siri:TextualContent");let z={};return P&&(z={},P.children.forEach(oe=>{const fe=oe.name.replace("siri:","").replace("Content","");if(fe in z||(z[fe]=[]),oe.children.length>0){const Ae=oe.children[0].text;null!==Ae&&z[fe].push(Ae.trim())}})),{affects:Fc.computeAffects(t,e,i),passengerInformation:{actionRef:a,ownerRef:p,perspectives:y,mapTextualContent:z}}}static computeAffects(t,e,i){const r=[],a=i.findChildNamed("siri:PublishAtScope/siri:Affects/siri:Networks/siri:AffectedNetwork");if(a&&a.findChildrenNamed("siri:AffectedLine").forEach(y=>{var T;const P=Fc.computeLineNetwork(y);if(null!==P&&("line"===e&&r.push({type:"entire-line",affect:P}),"stopPlace"===e)){const z=null!==(T=y.findTextFromChildNamed("siri:Direction/siri:DirectionRef"))&&void 0!==T?T:"n/a",H=y.findChildrenNamed("siri:StopPlaces/siri:AffectedStopPlace"),J=Fc.computeAffectedStopPlaces(H);r.push({type:"partial-line",affect:{lineNetwork:P,directionRef:z,stopPlaces:J}})}}),"stopPlace"===e){const p=i.findChildNamed("siri:PublishAtScope/siri:Affects/siri:StopPlaces");if(p){const y=p.findChildrenNamed("siri:AffectedStopPlace");Fc.computeAffectedStopPlaces(y).forEach(P=>{r.push({type:"stop",affect:P})})}}return"vehicleJourney"===e&&Fc.computeAffectedJourneys(t,i).forEach(y=>{r.push({type:"vehicle-journey",affect:y})}),r}static computeLineNetwork(t){const e=t.findTextFromChildNamed("siri:AffectedOperator/siri:OperatorRef"),i=t.findTextFromChildNamed("siri:LineRef"),r=t.findTextFromChildNamed("siri:PublishedLineName");if(null===e||null===i||null===r)return console.log("ERROR: LineNetwork cant init"),console.log(t),null;const a=t.findChildrenNamed("siri:StopPlaces/siri:AffectedStopPlace");return{operator:{operatorRef:e},lineRef:i,publishedLineName:r,stopPlaces:Fc.computeAffectedStopPlaces(a)}}static computeAffectedStopPlaces(t){const e=[];return t.forEach(i=>{const r=i.findTextFromChildNamed("siri:StopPlaceRef"),a=i.findTextFromChildNamed("siri:PlaceName");if(null===r||null===a)return console.log("ERROR: StopPlace cant init"),console.log(i),null;e.push({stopPlaceRef:r,placeName:a})}),e}static computeAffectedJourneys(t,e){const i=[];return e.findChildrenNamed("siri:PublishAtScope/siri:Affects/siri:VehicleJourneys/siri:AffectedVehicleJourney").forEach((a,p)=>{const y=a.findChildNamed("siri:FramedVehicleJourneyRef");if(null===y)return console.error("computeAffectedJourneys - NULL FramedVehicleJourneyRef"),console.log(t),void console.log(a);const T=y.findTextFromChildNamed("siri:DataFrameRef"),P=y.findTextFromChildNamed("siri:DatedVehicleJourneyRef");if(null===T||null===P)return console.error("computeAffectedJourneys - NULL FramedVehicleJourneyRef members"),console.log(t),void console.log(y);const z={dataFrameRef:T,datedVehicleJourneyRef:P},H=a.findTextFromChildNamed("siri:Operator/siri:OperatorRef");if(null===H)return console.error("computeAffectedJourneys - NULL operatorRef"),console.log(t),void console.log(a);let J=null;const oe=a.findTextFromChildNamed("siri:Origins/siri:StopPlaceRef");null!==oe&&(J={stopPlaceRef:oe,placeName:a.findTextFromChildNamed("siri:Origins/siri:PlaceName")});let fe=null;const Ae=a.findTextFromChildNamed("siri:Destinations/siri:StopPlaceRef");null!==Ae&&(fe={stopPlaceRef:Ae,placeName:a.findTextFromChildNamed("siri:Destinations/siri:PlaceName")});const We=a.findChildrenNamed("siri:Calls/siri:Call"),ot=[];We.forEach(Zn=>{const ci=Zn.findTextFromChildNamed("siri:StopPlaceRef");null!==ci&&ot.push(ci)});const tn=a.findTextFromChildNamed("siri:LineRef"),Nt=a.findTextFromChildNamed("siri:PublishedLineName");i.push({framedVehicleJourneyRef:z,operator:{operatorRef:H},origin:J,destination:fe,callStopsRef:ot,lineRef:tn,publishedLineName:Nt})}),i}isActive(t=new Date){var e;return null!==(null!==(e=this.validityPeriods.find(r=>r.startDate<t&&r.endDate>t))&&void 0!==e?e:null)}static computeSituationContent(t){const e=t.findTextFromChildNamed("siri:Summary");if(null===e)return null;const i=[];t.findChildrenNamed("siri:Description").forEach(T=>{const P=T.text;P&&i.push(P)});const a=[];return t.findChildrenNamed("siri:Detail").forEach(T=>{const P=T.text;P&&a.push(P)}),{summary:e,descriptions:i,details:a}}}class jW extends zx{constructor(){super(),this.callback=null,this.stopEvents=[],this.mapContextLocations={},this.mapContextSituations={}}reset(){this.stopEvents=[],this.mapContextLocations={},this.mapContextSituations={}}parseXML(t){this.reset(),super.parseXML(t)}onCloseTag(t){if("StopEventResult"===t){const e=cA.initWithTreeNode(this.currentNode);e&&(e.patchStopEventLocations(this.mapContextLocations),e.patchSituations(this.mapContextSituations),this.stopEvents.push(e))}if("StopEventResponseContext"===t){const e=this.currentNode.findChildNamed("Places");e&&(this.mapContextLocations={},e.findChildrenNamed("Location").forEach(a=>{var p,y;const T=Ko.initWithTreeNode(a),P=null!==(y=null===(p=T.stopPlace)||void 0===p?void 0:p.stopPlaceRef)&&void 0!==y?y:null;null!==P&&(this.mapContextLocations[P]=T)}));const i=this.currentNode.findChildNamed("Situations");i&&(this.mapContextSituations={},i.findChildrenNamed("PtSituation").forEach(a=>{const p=Fc.initWithSituationTreeNode(a);p&&(this.mapContextSituations[p.situationNumber]=p)}))}}onEnd(){"DEBUG"===ud&&this.validateSituations(),this.callback&&this.callback({stopEvents:this.stopEvents,message:"StopEvent.DONE"})}validateSituations(){const t=Object.values(this.mapContextSituations);if(0===t.length)return;const e={};t.forEach(i=>{e[i.situationNumber]=!1}),this.stopEvents.forEach(i=>{i.stopPoint.siriSituations.forEach(r=>{r.situationNumber in e?e[r.situationNumber]=!0:(console.error("StopPoint has situation which can be found in context"),console.log(r.situationNumber),console.log(this.mapContextSituations),console.log("======================================================================"))})});for(const i in e)!1===e[i]&&(console.error("Situation "+i+" cant be map to any of the stop events"),console.log(this.mapContextSituations[i]),console.log(this.stopEvents),console.log("======================================================================"));this.stopEvents.forEach(i=>{i.stopPoint.siriSituationIds.forEach(r=>{r in e||(console.error("Situation "+r+" is in the stopEvent but cant be found in the context"),console.log(this.mapContextSituations),console.log(i.stopPoint),console.log("======================================================================"))})})}}class hf extends tC{constructor(t,e){e.includePreviousCalls=!0,e.includeOnwardCalls=!0,super(t),this.requestParams=e,this.requestInfo.requestXML=this.buildRequestXML()}static Empty(t=df){const e=nC.Empty();return new hf(t,e)}static initWithMock(t){const e=hf.Empty();return e.mockResponseXML=t,e}static initWithRequestMock(t,e=df){const i=hf.Empty(e);return i.mockRequestXML=t,i}static initWithStopPlaceRef(t,e,i,r,a){const p=new nC(e,i,null,r,a);return new hf(t,p)}buildRequestXML(){return this.requestParams.buildRequestXML()}fetchResponse(){var t=this;return ua(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{const r={stopEvents:[],message:null};if(null!==t.requestInfo.error||null===t.requestInfo.responseXML)return r.message="ERROR",void i(r);const a=new jW;a.callback=({stopEvents:p,message:y})=>{r.stopEvents=p,r.message=y,"StopEvent.DONE"===y&&(t.requestInfo.parseDateTime=new Date,i(r))},a.parseXML(t.requestInfo.responseXML)})})()}}class iC extends lf{constructor(t,e,i){super(t),this.journeyRef=e,this.operatingDayRef=i}static Empty(){return new iC("en","n/a","n/a")}buildRequestNode(){super.buildRequestNode();const t=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",t),this.serviceRequestNode.ele("RequestorRef",lf.buildRequestorRef());const e=this.serviceRequestNode.ele("ojp:OJPTripInfoRequest");e.ele("RequestTimestamp",t),e.ele("ojp:JourneyRef",this.journeyRef),e.ele("ojp:OperatingDayRef",this.operatingDayRef);const i=e.ele("ojp:Params");i.ele("ojp:IncludeCalls",!0),i.ele("ojp:IncludeService",!0)}}class dA{constructor(t,e,i){this.stopPoints=t,this.service=e,this.metadata=i}static initFromTreeNode(t){var e,i,r;const a=t.findChildNamed("Service");if(null===a)return console.error("TripInfoResult.initFromTreeNode: no service node found"),console.log(t),null;const p=jx.initWithTreeNode(t);if(null===p)return console.error("JourneyService.initFromTreeNode: cant init service"),console.log(a),null;const y=t.findChildrenNamed("PreviousCall"),T=t.findChildrenNamed("OnwardCall"),P=y.concat(T),z=[];if(P.forEach(oe=>{const fe=uf.initWithTreeNode(oe,"Intermediate");null!==fe&&z.push(fe)}),z.length<2)return console.error("TripInfoResult.initFromTreeNode: expected minimum 2 stops"),console.log(t),null;const H={transportTypeName:null!==(e=t.findTextFromChildNamed("Extension/TransportTypeName/Text"))&&void 0!==e?e:"TransportTypeName n/a",publishedJourneyNumber:null!==(i=t.findTextFromChildNamed("Extension/PublishedJourneyNumber/Text"))&&void 0!==i?i:"PublishedJourneyNumber n/a",operatorName:null!==(r=t.findTextFromChildNamed("Extension/OperatorName/Text"))&&void 0!==r?r:"OperatorName n/a"};return new dA(z,p,H)}patchLocations(t){this.stopPoints.forEach(e=>{var i,r;let a=null!==(r=null===(i=e.location.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null!==a?(a in t||(a=aA.convertStopPointToStopPlace(a)),a in t?e.location.patchWithAnotherLocation(t[a]):"DEBUG"===ud&&(console.error("TripInfoResult.patchLocations - no stopPlaceRef found in mapContextLocations"),console.log("stopPoint:"),console.log(e),console.log("mapContextLocations:"),console.log(t))):"DEBUG"===ud&&(console.error("TripInfoResult.patchLocations - no stopPlaceRef found in location"),console.log(e))})}}class UW extends zx{constructor(){super(),this.callback=null,this.tripInfoResult=null,this.mapContextLocations={},this.mapContextSituations={}}reset(){this.tripInfoResult=null,this.mapContextLocations={},this.mapContextSituations={}}parseXML(t){this.reset(),super.parseXML(t)}onCloseTag(t){if("TripInfoResult"===t){const e=dA.initFromTreeNode(this.currentNode);e&&e.patchLocations(this.mapContextLocations),this.tripInfoResult=e}if("TripInfoResponseContext"===t){const e=this.currentNode.findChildNamed("Places");e&&(this.mapContextLocations={},e.findChildrenNamed("Location").forEach(a=>{var p,y;const T=Ko.initWithTreeNode(a),P=null!==(y=null===(p=T.stopPlace)||void 0===p?void 0:p.stopPlaceRef)&&void 0!==y?y:null;null!==P&&(this.mapContextLocations[P]=T)}));const i=this.currentNode.findChildNamed("Situations");i&&(this.mapContextSituations={},i.findChildrenNamed("PtSituation").forEach(a=>{const p=Fc.initWithSituationTreeNode(a);p&&(this.mapContextSituations[p.situationNumber]=p)}))}}onEnd(){this.callback&&this.callback({tripInfoResult:this.tripInfoResult,message:"TripInfoRequest.DONE"})}}class vh extends tC{constructor(t,e){super(t),this.requestParams=e,this.requestInfo.requestXML=this.buildRequestXML()}static Empty(t=df){const e=iC.Empty();return new vh(t,e)}static initWithMock(t){const e=vh.Empty();return e.mockResponseXML=t,e}static initWithRequestMock(t,e=df){const i=vh.Empty(e);return i.mockRequestXML=t,i}static initWithJourneyRef(t,e,i,r=null){null===r&&(r=(new Date).toISOString().substring(0,10));const a=new iC(e,i,r);return new vh(t,a)}buildRequestXML(){return this.requestParams.buildRequestXML()}fetchResponse(){var t=this;return ua(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{const r={tripInfoResult:null,message:null};if(null!==t.requestInfo.error||null===t.requestInfo.responseXML)return r.message="ERROR",void i(r);const a=new UW;a.callback=({tripInfoResult:p,message:y})=>{r.tripInfoResult=p,r.message=y,"TripInfoRequest.DONE"===y&&(t.requestInfo.parseDateTime=new Date,i(r))},a.parseXML(t.requestInfo.responseXML)})})()}}class v3{constructor(t,e,i,r){this.legType=t,this.legID=e,this.fromLocation=i,this.toLocation=r,this.legTrack=null,this.legDuration=null}patchLocations(t){[this.fromLocation,this.toLocation].forEach(e=>{var i;this.patchLocation(e,t),!e.geoPosition&&null!==(i=this.legTrack)&&void 0!==i&&i.hasGeoData&&(e===this.fromLocation?this.fromLocation.geoPosition=this.legTrack.fromGeoPosition():this.toLocation.geoPosition=this.legTrack.toGeoPosition())})}patchSituations(t){}patchLocation(t,e){var i,r;if(t.geoPosition)return;let a=null!==(r=null===(i=t.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null!==a?(a in e||(a=aA.convertStopPointToStopPlace(a)),a in e?t.patchWithAnotherLocation(e[a]):"DEBUG"===ud&&(console.error("TripLeg.patchLocation - no stopPlaceRef found in mapContextLocations"),console.log(t),console.log("location.stopPlace?.stopPlaceRef :"+a),console.log(e))):"DEBUG"===ud&&(console.error("TripLeg.patchLocation - no stopPlaceRef found in location"),console.log(t))}addToXMLNode(t){}}class rC{constructor(t,e){this.coordinates=t,this.bbox=e}static initWithTreeNode(t){const e=t.findChildNamed("LinkProjection");if(null===e)return null;const i=[];if(e.findChildrenNamed("Position").forEach(y=>{const T=y.findTextFromChildNamed("siri:Longitude"),P=y.findTextFromChildNamed("siri:Latitude");if(T&&P){const z=new Bo(parseFloat(T),parseFloat(P));i.push(z)}}),i.length<2)return null;const a=new yh(i);return new rC(i,a)}computeLength(){let t=0;return this.coordinates.forEach((e,i)=>{0!==i&&(t+=e.distanceFrom(this.coordinates[i-1]))}),t}asGeoJSONFeature(){const t={type:"Feature",bbox:this.bbox.asFeatureBBOX(),properties:{},geometry:{type:"LineString",coordinates:[]}};return this.coordinates.forEach(e=>{t.geometry.coordinates.push([e.longitude,e.latitude])}),t}}class hA{constructor(t){this.sections=t}static initWithTreeNode(t){const e=t.findChildNamed("PathGuidance");if(null===e)return null;let i=[];return e.findChildrenNamed("PathGuidanceSection").forEach(p=>{const y=pA.initWithSectionTreeNode(p);y&&i.push(y)}),new hA(i)}}class pA{constructor(){this.trackSection=null,this.guidanceAdvice=null,this.turnAction=null}static initWithSectionTreeNode(t){const e=new pA,i=t.findChildNamed("TrackSection");return i&&(e.trackSection=fA.initWithTrackSectionTreeNode(i)),e.guidanceAdvice=t.findTextFromChildNamed("GuidanceAdvice"),e.turnAction=t.findTextFromChildNamed("TurnAction"),e}}class fA{constructor(){this.linkProjection=null,this.roadName=null,this.duration=null,this.length=null}static initWithTrackSectionTreeNode(t){const e=new fA;e.linkProjection=rC.initWithTreeNode(t),e.roadName=t.findTextFromChildNamed("RoadName"),e.duration=t.findTextFromChildNamed("Duration");const i=t.findTextFromChildNamed("Length");return null!==i&&(e.length=parseInt(i,10)),e}}class xh{constructor(t,e){this.hours=t,this.minutes=e,this.totalMinutes=60*t+e}static initWithTreeNode(t,e="Duration"){const i=t.findTextFromChildNamed(e);return null===i?null:xh.initFromDurationText(i)}static initFromDurationText(t){if(null===t)return null;let e=0;const i=(t=t.replace("PT","")).match(/([0-9]+?)H/);i&&(e=parseInt(i[1]));let r=0;const a=t.match(/([0-9]+?)M/);return a&&(r=parseInt(a[1])),new xh(e,r)}static initFromTotalMinutes(t){const e=Math.floor(t/60);return new xh(e,t-60*e)}formatDuration(){const t=[];return this.hours>0&&t.push(this.hours+"h "),t.push(this.minutes+"min"),t.join("")}plus(t){return xh.initFromTotalMinutes(this.totalMinutes+t.totalMinutes)}asOJPFormattedText(){const t=[];return t.push("PT"),t.push(this.hours+"H"),t.push(this.minutes+"M"),t.join("")}}class oC{constructor(t){this.trackSections=t;let e=0;this.hasGeoData=!1,t.forEach(i=>{i.linkProjection&&(this.hasGeoData=!0),i.duration&&(e+=i.duration.totalMinutes)}),this.duration=null,e>0&&(this.duration=xh.initFromTotalMinutes(e))}plus(t){return null!==this.duration&&null!==t.duration&&(this.duration=this.duration.plus(t.duration)),this.trackSections=this.trackSections.concat(t.trackSections),this}static initWithLegTreeNode(t){const e=t.findChildNamed("LegTrack");if(null===e)return null;const i=[];return e.findChildrenNamed("TrackSection").forEach(p=>{const y=mA.initWithTreeNode(p);y&&i.push(y)}),new oC(i)}fromGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[0].linkProjection;return null===e?null:e.coordinates[0]}toGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[this.trackSections.length-1].linkProjection;return null===e?null:e.coordinates[e.coordinates.length-1]}}class mA{constructor(t,e){this.fromLocation=t,this.toLocation=e,this.duration=null,this.length=null,this.linkProjection=null}static initWithTreeNode(t){const e=t.findChildNamed("TrackStart"),i=t.findChildNamed("TrackEnd");if(!e||!i)return null;const r=Ko.initWithTreeNode(e),a=Ko.initWithTreeNode(i);if(!r||!a)return console.error("CANT instantiate TrackSection.initWithTreeNode"),console.log(t),null;const p=new mA(r,a);p.duration=xh.initWithTreeNode(t);const y=rC.initWithTreeNode(t);p.linkProjection=y;const T=t.findTextFromChildNamed("Length");return null===T?y&&(p.length=y.computeLength()):p.length=parseInt(T,10),p}}class sC{constructor(t){this.bookingArrangements=t}static initWithLegTreeNode(t){const e=t.findChildNamed("Service/BookingArrangements");if(null===e)return null;const i=e.findChildrenNamed("BookingArrangement");if(0===i.length)return console.error("ERROR - no BookingArrangements nodes found"),null;const r=[];return i.forEach(p=>{const y=p.findTextFromChildNamed("BookingAgencyName/Text");let T=p.findTextFromChildNamed("InfoUrl");if(null===y||null===T||(T=T.trim(),T.length<2))return;"<"===T[0]&&(T=T.substring(1,T.length-1));var P=document.createElement("textarea");P.innerHTML=T.trim(),T=P.innerText;const z={agencyCode:y.trim(),agencyName:sC.computeAgencyName(y),infoURL:T};r.push(z)}),new sC(r)}static computeAgencyName(t){return(t=t.trim()).endsWith("_local.ch")?"local.ch":t.endsWith("_maps.google.ch")?"maps.google.com":t.endsWith("_openstreetmap.org")?"openstreetmap.org":"n/a catalog: "+t}}class aC extends v3{constructor(t,e,i,r,a){super(t,e,r,a),this.legTransportMode=null,this.legDistance=i,this.pathGuidance=null,this.walkDuration=null,this.serviceBooking=null,this.transferMode=null}static initWithTreeNode(t,e,i){var r;const a=e.findChildNamed("LegStart"),p=e.findChildNamed("LegEnd");if(null===a||null===p)return null;const y=Ko.initWithTreeNode(a),T=Ko.initWithTreeNode(p);if(null===y||null===T)return null;let P=null!==(r=e.findTextFromChildNamed("Length"))&&void 0!==r?r:"0";const z=parseInt(P),H=new aC(i,t,z,y,T);return H.legDuration=xh.initWithTreeNode(e),H.pathGuidance=hA.initWithTreeNode(e),H.legTransportMode=H.computeLegTransportModeFromTreeNode(e,i),H.transferMode=H.computeLegTransferModeFromTreeNode(e),("taxi"===H.legTransportMode||"others-drive-car"===H.legTransportMode)&&(H.serviceBooking=sC.initWithLegTreeNode(e)),H.legTrack=oC.initWithLegTreeNode(e),"TransferLeg"===i&&(H.walkDuration=xh.initWithTreeNode(e,"WalkDuration")),H}computeLegTransportModeFromTreeNode(t,e){let i=null;if("TransferLeg"===e)return null;if(("TimedLeg"===e||"ContinousLeg"===e)&&(i=t.findTextFromChildNamed("Service/IndividualMode"),null===i)){const p=[];["Service/PersonalMode","Service/PersonalModeOfOperation","Service/Mode/PtMode","Service/Mode/siri:RailSubmode","Service/Mode/siri:WaterSubmode"].forEach(T=>{const P=t.findTextFromChildNamed(T);null!==P&&p.push(P)}),i=p.join(".")}const r=t.findTextFromChildNamed("Service/BookingArrangements/BookingArrangement/BookingAgencyName/Text"),a=this.computeLegTransportModeFromString(i,r);return null===a&&(console.error("ERROR computeLegTransportModeFromString"),console.log("=> CANT handle mode --"+i+"--"),console.log(t)),a}computeLegTransferModeFromTreeNode(t){const e=t.findTextFromChildNamed("TransferMode");return null===e?null:"walk"===e?"walk":"remainInVehicle"===e?"remainInVehicle":(console.error("CANT map TransferMode from =="+e+"=="),null)}computeLegTransportModeFromString(t,e=null){return null===t?null:"walk"===t?"walk":"self-drive-car"===t?"self-drive-car":"cycle"===t?"cycle":"taxi"===t?-1!==(null==e?void 0:e.indexOf("_limousine_"))?"others-drive-car":"taxi":"car.own"===t?"self-drive-car":"car.own.rail.vehicleTunnelTransportRailService"===t?"car-shuttle-train":"car.own.water.localCarFerry"===t?"car-ferry":null}isDriveCarLeg(){return"self-drive-car"===this.legTransportMode}isSharedMobility(){return null!==this.legTransportMode&&-1!==["cycle","bicycle_rental","car_sharing","escooter_rental"].indexOf(this.legTransportMode)}isWalking(){return"walk"===this.legTransportMode}isTaxi(){return"taxi"===this.legTransportMode||"others-drive-car"===this.legTransportMode}formatDistance(){return this.legDistance>1e3?(this.legDistance/1e3).toFixed(1)+" km":this.legDistance+" m"}addToXMLNode(t){const e=t.ele("ojp:TripLeg");e.ele("ojp:LegId",this.legID),e.ele("ojp:"+this.legType)}}class Hy extends v3{constructor(t,e,i,r,a=[]){super("TimedLeg",t,i.location,r.location),this.service=e,this.fromStopPoint=i,this.toStopPoint=r,this.intermediateStopPoints=a}static initWithTreeNode(t,e){const i=jx.initWithTreeNode(e);if(null===i)return null;const r=e.findChildNamed("LegBoard"),a=e.findChildNamed("LegAlight");if(null===r||null===a)return null;const p=uf.initWithTreeNode(r,"From"),y=uf.initWithTreeNode(a,"To");if(null===p||null===y)return null;const T=[];e.findChildrenNamed("LegIntermediates").forEach(H=>{const J=uf.initWithTreeNode(H,"Intermediate");J&&T.push(J)});const z=new Hy(t,i,p,y,T);return z.legTrack=oC.initWithLegTreeNode(e),z.legTrack&&null===z.legDuration&&(z.legDuration=z.legTrack.duration),z}patchLocations(t){super.patchLocations(t),this.intermediateStopPoints.forEach(e=>{this.patchLocation(e.location,t)})}computeDepartureTime(){return this.computeStopPointTime(this.fromStopPoint.departureData)}computeArrivalTime(){return this.computeStopPointTime(this.toStopPoint.arrivalData)}computeStopPointTime(t){var e;return null===t?null:null!==(e=t.estimatedTime)&&void 0!==e?e:t.timetableTime}patchSituations(t){this.service.siriSituations=[],this.service.siriSituationIds.forEach(e=>{var i;const r=null!==(i=t[e])&&void 0!==i?i:null;r&&this.service.siriSituations.push(r)})}addToXMLNode(t){const e=t.ele("ojp:TripLeg");e.ele("ojp:LegId",this.legID);const i=e.ele("ojp:TimedLeg"),r=["Arr","Dep"],a=(p,y)=>{var T;const z=i.ele("From"===y?"ojp:LegBoard":"To"===y?"ojp:LegAlight":"ojp:LegIntermediates"),H=p.location.stopPlace;H&&(z.ele("StopPointRef",H.stopPlaceRef),z.ele("ojp:StopPointName").ele("ojp:Text",null!==(T=H.stopPlaceName)&&void 0!==T?T:"n/a")),r.forEach(J=>{const oe="Arr"===J,fe=oe?p.arrivalData:p.departureData;fe&&z.ele(oe?"ojp:ServiceArrival":"ojp:ServiceDeparture").ele("ojp:TimetabledTime",fe.timetableTime.toISOString())})};a(this.fromStopPoint,"From"),this.intermediateStopPoints.forEach(p=>{a(p,"Intermediate")}),a(this.toStopPoint,"To"),this.service.addToXMLNode(i)}}class xl{constructor(t){this.location=t,this.minDuration=null,this.maxDuration=null,this.minDistance=null,this.maxDistance=null,this.customTransportMode=null,this.dwellTimeMinutes=null}static Empty(){const t=new Ko;return new xl(t)}}class gA{constructor(t,e,i){this.id=t,this.legs=e,this.stats=i,this.tripFareResults=[]}static initFromTreeNode(t){let e=t.findTextFromChildNamed("TripId");null===e&&(e="RandomTripId","DEBUG"===ud&&(console.error("Trip.initFromTreeNode: No Id node found for trip, assigning a random one"),console.log(t),console.log("=======================================")));const i=xh.initFromDurationText(t.findTextFromChildNamed("Duration"));if(null===i)return null;const r=t.findTextFromChildNamed("Transfers");if(null===r)return null;const a=t.findTextFromChildNamed("StartTime"),p=t.findTextFromChildNamed("EndTime");if(null===a||null===p)return null;const y=new Date(Date.parse(a)),T=new Date(Date.parse(p)),P=[];let z=0;if(t.findChildrenNamed("TripLeg").forEach(un=>{var Zn,ci;const Fi=class HW{static initWithTreeNode(t){const e=t.findTextFromChildNamed("LegId");if(null===e)return null;const i=parseInt(e,10),r=t.findChildNamed("TransferLeg");if(r){const y=aC.initWithTreeNode(i,r,"TransferLeg");if(y)return y}const a=t.findChildNamed("TimedLeg");if(a){const y=Hy.initWithTreeNode(i,a);if(y)return y}const p=t.findChildNamed("ContinuousLeg");if(p){const y=aC.initWithTreeNode(i,p,"ContinousLeg");if(y)return y}return null}}.initWithTreeNode(un);null!==Fi&&((null!==(ci=null===(Zn=Fi.legTrack)||void 0===Zn?void 0:Zn.trackSections)&&void 0!==ci?ci:[]).forEach(Lr=>{var pr;z+=null!==(pr=Lr.length)&&void 0!==pr?pr:0}),P.push(Fi))}),0===P.length)return console.error("Trip.initFromTreeNode no legs found ?"),console.log(t),null;let J=0,oe="trip";const fe=t.findTextFromChildNamed("Distance");null===fe?(oe="legs-sum",J=z):J=parseInt(fe);const Ae={duration:i,distanceMeters:J,distanceSource:oe,transferNo:parseInt(r),startDatetime:y,endDatetime:T,isCancelled:null,isInfeasable:null,isUnplanned:null},We=t.findChildNamed("Cancelled");We&&(Ae.isCancelled="true"===We.text);const ot=t.findChildNamed("Infeasible");ot&&(Ae.isInfeasable="true"===ot.text);const tn=t.findChildNamed("Unplanned");return tn&&(Ae.isUnplanned="true"===tn.text),new gA(e,P,Ae)}computeDepartureTime(){var t;const e=this.legs.filter(p=>p instanceof Hy);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),null;const r=e[0].fromStopPoint.departureData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeArrivalTime(){var t;const e=this.legs.filter(p=>p instanceof Hy);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),new Date;const r=e[e.length-1].toStopPoint.arrivalData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}addToXMLNode(t){const e=t.ele("ojp:Trip");e.ele("ojp:TripId",this.id),e.ele("ojp:Duration",this.stats.duration.asOJPFormattedText()),e.ele("ojp:StartTime",this.stats.startDatetime.toISOString()),e.ele("ojp:EndTime",this.stats.endDatetime.toISOString()),e.ele("ojp:Transfers",this.stats.transferNo),e.ele("ojp:Distance",this.stats.distanceMeters),this.legs.forEach(i=>{i.addToXMLNode(e)})}}class pf extends lf{constructor(t,e,i,r=new Date,a="Dep",p=null,y=null,T=null,P=[]){super(t),this.fromTripLocation=e,this.toTripLocation=i,this.departureDate=r,this.tripRequestBoardingType=a,this.numberOfResults=p,this.numberOfResultsBefore=y,this.numberOfResultsAfter=T,this.publicTransportModes=P,this.modeType="monomodal",this.transportMode="public_transport",this.includeLegProjection=!0,this.viaLocations=[]}static Empty(){const t=xl.Empty();return new pf("en",t,t,new Date,"Dep")}static initWithLocationsAndDate(t,e,i,r=new Date,a="Dep",p=!1,y="monomodal",T="public_transport",P=[],z=null,H=null,J=null,oe=[]){if(null===e||null===i)return null;const fe=new xl(e),Ae=new xl(i);return pf.initWithTripLocationsAndDate(t,fe,Ae,r,a,p,y,T,P,z,H,J,oe)}static initWithTripLocationsAndDate(t,e,i,r=new Date,a="Dep",p=!1,y="monomodal",T="public_transport",P=[],z=null,H=null,J=null,oe=[]){if(null===e||null===i||!e.location.geoPosition&&!e.location.stopPlace||!i.location.geoPosition&&!i.location.stopPlace)return null;const fe=new pf(t,e,i,r,a,z,H,J,oe);return fe.includeLegProjection=p,fe.modeType=y,fe.transportMode=T,fe.viaLocations=P,fe}buildRequestNode(){super.buildRequestNode();const e=(new Date).toISOString();this.serviceRequestNode.ele("RequestTimestamp",e),this.serviceRequestNode.ele("RequestorRef",lf.buildRequestorRef());const i=this.serviceRequestNode.ele("ojp:OJPTripRequest");i.ele("RequestTimestamp",e);const r=this.modeType,a="monomodal"===r,p=this.transportMode,y=["From","To"];y.forEach(J=>{var oe,fe,Ae,We;const ot="From"===J,tn=ot?this.fromTripLocation:this.toTripLocation,Nt=tn.location,Zn=i.ele(ot?"ojp:Origin":"ojp:Destination"),ci=Zn.ele("ojp:PlaceRef");if(null!==(oe=Nt.stopPlace)&&void 0!==oe&&oe.stopPlaceRef){const Ui=null!==(fe=Nt.locationName)&&void 0!==fe?fe:"n/a";let Lr=null!==(We=null===(Ae=Nt.stopPlace)||void 0===Ae?void 0:Ae.stopPlaceRef)&&void 0!==We?We:"";ci.ele("ojp:StopPlaceRef",Lr),ci.ele("ojp:LocationName").ele("ojp:Text",Ui)}else if(Nt.geoPosition){const Ui=ci.ele("ojp:GeoPosition");Ui.ele("Longitude",Nt.geoPosition.longitude),Ui.ele("Latitude",Nt.geoPosition.latitude);const Lr=Nt.geoPosition.asLatLngString();ci.ele("ojp:LocationName").ele("ojp:Text",Lr)}const Fi=this.departureDate.toISOString();ot?"Dep"===this.tripRequestBoardingType&&Zn.ele("ojp:DepArrTime",Fi):"Arr"===this.tripRequestBoardingType&&Zn.ele("ojp:DepArrTime",Fi),a||"cycle"===p&&(()=>{if("mode_at_start"===r&&!ot||"mode_at_end"===r&&ot)return;const Lr=Zn.ele("ojp:IndividualTransportOptions");this.addAdditionalRestrictions(Lr,tn)})()}),this.viaLocations.forEach(J=>{var oe,fe,Ae;const We=i.ele("ojp:Via"),ot=We.ele("ojp:ViaPoint"),tn=J.location.stopPlace;if(null===tn){const Nt=J.location.geoPosition;if(null!==Nt){const un=ot.ele("ojp:GeoPosition");un.ele("Longitude",Nt.longitude),un.ele("Latitude",Nt.latitude),ot.ele("ojp:Name").ele("ojp:Text",null!==(oe=J.location.computeLocationName())&&void 0!==oe?oe:"n/a")}}else ot.ele("ojp:StopPlaceRef",tn.stopPlaceRef),ot.ele("ojp:LocationName").ele("ojp:Text",null!==(fe=tn.stopPlaceName)&&void 0!==fe?fe:null!==(Ae=J.location.computeLocationName())&&void 0!==Ae?Ae:"n/a");null!==J.dwellTimeMinutes&&We.ele("ojp:DwellTime","PT"+J.dwellTimeMinutes.toString()+"M")});const T=i.ele("Params");if("public_transport"===this.transportMode&&this.publicTransportModes.length>0){const J=T.ele("PtModeFilter");J.ele("ojp:Exclude","false"),this.publicTransportModes.forEach(oe=>{J.ele("ojp:PtMode",oe)})}T.ele("ojp:PrivateModeFilter").ele("ojp:Exclude","false"),null!==this.numberOfResults&&T.ele("ojp:NumberOfResults",this.numberOfResults),null!==this.numberOfResultsBefore&&T.ele("ojp:NumberOfResultsBefore",this.numberOfResultsBefore),null!==this.numberOfResultsAfter&&T.ele("ojp:NumberOfResultsAfter",this.numberOfResultsAfter),T.ele("ojp:IncludeTrackSections",!0),T.ele("ojp:IncludeLegProjection",this.includeLegProjection),T.ele("ojp:IncludeTurnDescription",!0),"public_transport"===this.transportMode&&T.ele("ojp:IncludeIntermediateStops",!0);const H=-1!==["bicycle_rental","car_sharing","escooter_rental"].indexOf(p);if(a)-1!==["foot","walk","self-drive-car","cycle","taxi","others-drive-car"].indexOf(p)&&T.ele("ojp:ItModesToCover",p),H&&T.ele("ojp:Extension").ele("ojp:ItModesToCover",p);else if(H){const J=T.ele("ojp:Extension");y.forEach(oe=>{const fe="From"===oe;if(fe&&"mode_at_end"===this.modeType||!fe&&"mode_at_start"===this.modeType)return;const Ae=fe?this.fromTripLocation:this.toTripLocation,ot=J.ele(fe?"ojp:Origin":"ojp:Destination");this.addAdditionalRestrictions(ot,Ae)})}T.ele("ojp:UseRealtimeData","explanatory")}addAdditionalRestrictions(t,e){(null!==e.minDuration||null!==e.maxDuration||null!==e.minDistance||null!==e.maxDistance)&&(e.customTransportMode&&t.ele("ojp:Mode",e.customTransportMode),null!==e.minDuration&&t.ele("ojp:MinDuration","PT"+e.minDuration+"M"),null!==e.maxDuration&&t.ele("ojp:MaxDuration","PT"+e.maxDuration+"M"),null!==e.minDistance&&t.ele("ojp:MinDistance",e.minDistance),null!==e.maxDistance&&t.ele("ojp:MaxDistance",e.maxDistance))}}class GW extends zx{constructor(){super(),this.callback=null,this.trips=[],this.tripsNo=0,this.mapContextLocations={},this.mapContextSituations={}}reset(){this.trips=[],this.tripsNo=0,this.mapContextLocations={},this.mapContextSituations={}}parseXML(t){this.reset(),this.tripsNo=t.split("<TripResult>").length-1,0===this.tripsNo&&(this.tripsNo=t.split("<ojp:TripResult>").length-1),this.callback&&this.callback({trips:this.trips,tripsNo:this.tripsNo,message:"TripRequest.TripsNo"}),super.parseXML(t)}onCloseTag(t){if("Trip"===t&&"TripResult"===this.currentNode.parentName){const e=gA.initFromTreeNode(this.currentNode);e&&(e.legs.forEach(i=>{i.patchLocations(this.mapContextLocations),i.patchSituations(this.mapContextSituations)}),this.trips.push(e),this.callback&&this.callback({tripsNo:this.tripsNo,trips:this.trips,message:"TripRequest.Trip"}))}if("TripResponseContext"===t){const e=this.currentNode.findChildNamed("Places");e&&(this.mapContextLocations={},e.findChildrenNamed("Location").forEach(a=>{var p,y;const T=Ko.initWithTreeNode(a),P=null!==(y=null===(p=T.stopPlace)||void 0===p?void 0:p.stopPlaceRef)&&void 0!==y?y:null;null!==P&&(this.mapContextLocations[P]=T)}));const i=this.currentNode.findChildNamed("Situations");i&&(this.mapContextSituations={},i.findChildrenNamed("PtSituation").forEach(a=>{const p=Fc.initWithSituationTreeNode(a);p&&(this.mapContextSituations[p.situationNumber]=p)}))}}onEnd(){"DEBUG"===ud&&this.validateSituations(),this.callback&&this.callback({tripsNo:this.tripsNo,trips:this.trips,message:"TripRequest.DONE"})}validateSituations(){const t=Object.values(this.mapContextSituations);if(0===t.length)return;const e={};t.forEach(i=>{e[i.situationNumber]=!1}),this.trips.forEach(i=>{i.legs.forEach(r=>{"TimedLeg"===r.legType&&r.service.siriSituations.forEach(p=>{p.situationNumber in e?e[p.situationNumber]=!0:(console.error("TimedLeg has situation which can be found in context"),console.log(p.situationNumber),console.log(this.mapContextSituations),console.log("======================================================================"))})})});for(const i in e)!1===e[i]&&(console.error("Situation "+i+" cant be map to any of the trips"),console.log(this.mapContextSituations[i]),console.log(this.trips),console.log("======================================================================"));this.trips.forEach(i=>{i.legs.forEach(r=>{if("TimedLeg"!==r.legType)return;const a=r;a.service.siriSituationIds.forEach(p=>{p in e||(console.error("Situation "+p+" is in the <Trip> but cant be found in the context"),console.log(this.mapContextSituations),console.log(i),console.log(a),console.log("======================================================================"))})})})}}class hd extends tC{constructor(t,e){super(t),this.requestParams=e,this.response=null,this.requestInfo.requestXML=this.buildRequestXML()}static initWithResponseMock(t){const e=pf.Empty(),i=new hd(df,e);return i.mockResponseXML=t,i}static initWithRequestMock(t,e=df){const i=pf.Empty(),r=new hd(e,i);return r.mockRequestXML=t,r}static initWithStopRefs(t,e,i,r,a=new Date,p="Dep"){const y=Ko.initWithStopPlaceRef(i),T=Ko.initWithStopPlaceRef(r),P=pf.initWithLocationsAndDate(e,y,T,a,p);return null===P?null:new hd(t,P)}static initWithLocationsAndDate(t,e,i,r,a,p="Dep"){const y=pf.initWithLocationsAndDate(e,i,r,a,p);return null===y?null:new hd(t,y)}static initWithTripLocationsAndDate(t,e,i,r,a,p="Dep",y=!1,T="monomodal",P="public_transport",z=[],H=null,J=null,oe=null,fe=[]){const Ae=pf.initWithTripLocationsAndDate(e,i,r,a,p,y,T,P,z,H,J,oe,fe);return null===Ae?null:new hd(t,Ae)}buildRequestXML(){return this.requestParams.buildRequestXML()}fetchResponse(){var t=this;return ua(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{t.parseTripRequestResponse(i)})})()}fetchResponseWithCallback(t){this.fetchOJPResponse().then(e=>{this.requestInfo=e,this.parseTripRequestResponse(t)})}parseTripRequestResponse(t){if(this.response=null,null!==this.requestInfo.error||null===this.requestInfo.responseXML){return void t({tripsNo:0,trips:[],message:"ERROR"})}const e=new GW;e.callback=i=>{"TripRequest.Trip"===i.message&&1===i.trips.length&&(this.requestInfo.parseDateTime=new Date),this.response=i,t(i)},e.parseXML(this.requestInfo.responseXML)}}var qW=yt(9898),da=yt.n(qW);const x3={stages:{PROD:{url:"https://api.opentransportdata.swiss/ojp2020",authToken:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6Ijk0YTFhNjExYjM5ZjQ4MWNiMGI5MjFiNTgyNmM1ZGFjIiwiaCI6Im11cm11cjEyOCJ9"},INT:{url:"https://odpch-api.clients.liip.ch/ojp-passiv-int",authToken:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImJkOTNmYzA1ZGMwYzQwM2Q4MWYzMmFhNWMxNWZjMjU2IiwiaCI6Im11cm11cjEyOCJ9"},TEST:{url:"https://odpch-api.clients.liip.ch/ojp-test",authToken:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImZlYWJiMjEzZDcyZTRhYmM5N2RhYWJiZDM5YWZmZWIwIiwiaCI6Im11cm11cjEyOCJ9"},"V2-PROD":{url:"https://api.opentransportdata.swiss/ojp20",authToken:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6Ijk0YTFhNjExYjM5ZjQ4MWNiMGI5MjFiNTgyNmM1ZGFjIiwiaCI6Im11cm11cjEyOCJ9"},"V2-INT":{url:"https://odpch-api.clients.liip.ch/ojp20-beta",authToken:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6IjUzYzAyNWI2ZTRhNjQyOTM4NzMxMDRjNTg2ODEzNTYyIiwiaCI6Im11cm11cjEyOCJ9"},"V2-TEST":{url:"https://odpch-api.clients.liip.ch/ojp20-test",authToken:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6IjUzYzAyNWI2ZTRhNjQyOTM4NzMxMDRjNTg2ODEzNTYyIiwiaCI6Im11cm11cjEyOCJ9"},"PROD-LB":{url:"https://tools.odpch.ch/tmp/cors-proxy?url=https://ojp.lb.prod.ojp.odpch.ch/ojp/ojp",authToken:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6Ijk0YTFhNjExYjM5ZjQ4MWNiMGI5MjFiNTgyNmM1ZGFjIiwiaCI6Im11cm11cjEyOCJ9"},"LA Beta":{url:"https://api.opentransportdata.swiss/ojp-la-aktiv",authToken:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6ImE5ZDFkYmI4YWVjMDRiYjFiZjA2ZmUyNmZmZTk2YTY2IiwiaCI6Im11cm11cjEyOCJ9"},EFA11:{url:"https://odpch-api.clients.liip.ch/ojp-efa11-test",authToken:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6IjljMTAzNjVkN2VlZjRiZjc4MWMwMTQ5MzdlMjk3NWI5IiwiaCI6Im11cm11cjEyOCJ9"},"V2-EFA11":{url:"https://odpch-api.clients.liip.ch/ojp20-efa11-test",authToken:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6IjljMTAzNjVkN2VlZjRiZjc4MWMwMTQ5MzdlMjk3NWI5IiwiaCI6Im11cm11cjEyOCJ9"},"OJP-SI":{url:"https://dev.simo.si/OpenAPI/LinkingAlpsBetaPhase/OJP",authToken:null},"GR TEST":{url:"https://tools.odpch.ch/ojp-gr-api",authToken:null},"NOVA-INT":{url:"https://api.opentransportdata.swiss/ojpfare",authToken:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6ImU2ZDUyMmU0ODM1NDQ0YmM5OWM3ZjQ4MzI2ZWYxNzI3IiwiaCI6Im11cm11cjEyOCJ9"}}},Na="undefined"==typeof window||void 0===window.document||window.location.hostname.includes("github.io")?"PROD":"DEBUG",lC="PROD",_A=(()=>{let n=[];return n=["PROD","INT","TEST","LA Beta"],"DEBUG"===Na&&(n.push("EFA11"),n.push("OJP-SI")),n})(),Gy={stops:{LIR_Restriction_Type:"stop",minZoom:13,layer_ids:["stops-circle","stops-label"],click_layer_ids:"SAME_AS_LAYER_IDS"},addresses:{LIR_Restriction_Type:"address",minZoom:17,layer_ids:["address-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},topographic_places:{LIR_Restriction_Type:"topographicPlace",minZoom:12,layer_ids:["topographic-place-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_cars:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["car_sharing"]},minZoom:12,layer_ids:["car-rental-icon","car-rental-text-number","car-rental-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_bicycles:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["bicycle_rental"]},minZoom:14,layer_ids:["bike-icon","bike-text-number","bike-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_scooters:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["escooter_rental"]},minZoom:14,layer_ids:["scooter-icon","scooter-text-number","scooter-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},charging_stations:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["charging_station"]},minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sbb_services:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["sbb_services"]},minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},pois_other:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["other"]},minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},"pois-ALL":{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"poi",tags:["service","shopping","leisure","catering","public","parkride","accommodation"]},minZoom:16,layer_ids:["poi-all"],click_layer_ids:"SAME_AS_LAYER_IDS"}};class wh{static formatMapboxLngLatAsLatLng(t){return t.lat.toFixed(6)+","+t.lng.toFixed(6)}static computePointLngLatFromFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates;return da().LngLat.convert(e)}static bboxPxFromLngLatWidthPx(t,e,i,r=null){null===r&&(r=i);const a=t.project(e);return[[a.x-i/2,a.y+r/2],[a.x+i/2,a.y-r/2]]}static areBoundsInsideOtherBounds(t,e){return!(t.getWest()<e.getWest()||t.getNorth()>e.getNorth()||t.getEast()>e.getEast()||t.getSouth()<e.getSouth())}static queryNearbyFeaturesByLayerIDs(t,e,i){const r=wh.bboxPxFromLngLatWidthPx(t,e,30),a=t.queryRenderedFeatures(r,{layers:i});let p=[],y=null;return a.forEach(T=>{const P=wh.computePointLngLatFromFeature(T);if(null===P)return;const z=Math.round(e.distanceTo(P));null!==y&&z>y||(y=z,p.push({feature:T,distance:z}))}),p.sort((T,P)=>T.distance-P.distance),wh.highlightBBOXPxOnMap(r,t),wh.highlightLngLatOnMap(e,t),p}static highlightBBOXPxOnMap(t,e){const i=e.unproject(t[0]),r=e.unproject(t[1]),a=new(da().LngLatBounds)(i,r),y={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[a.getSouthWest().toArray(),a.getSouthEast().toArray(),a.getNorthEast().toArray(),a.getNorthWest().toArray(),a.getSouthWest().toArray()]}},T="debug-highlight";e.getSource(T)||e.addSource(T,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const P=T+"-bbox";e.getLayer(P)||e.addLayer({id:P,type:"line",source:T,paint:{"line-color":"#630000","line-width":2}});const z=e.getSource(T);z.setData({type:"FeatureCollection",features:[y]}),setTimeout(()=>{z.setData({type:"FeatureCollection",features:[]})},500)}static highlightLngLatOnMap(t,e){const i={type:"Feature",properties:{},geometry:{type:"Point",coordinates:t.toArray()}},r="debug-highlight-layer-coord";e.getSource(r)||e.addSource(r,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const a=r+"-coords";e.getLayer(a)||e.addLayer({id:a,type:"circle",source:r,paint:{"circle-color":"#630000","circle-radius":4}});const p=e.getSource(r);p.setData({type:"FeatureCollection",features:[i]}),setTimeout(()=>{p.setData({type:"FeatureCollection",features:[]})},500)}}class bA{constructor(t){this.map=t,this.container=null,this.debugCenterEl=null,this.debugZoomEl=null}onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",this.container.innerHTML=document.getElementById("map-debug-control").innerHTML,t.on("move",()=>{this.updateDebugCenter()}),t.on("zoom",()=>{this.updateDebugZoom()}),setTimeout(()=>{this.debugCenterEl=document.getElementById("map_debug_center"),this.debugZoomEl=document.getElementById("map_debug_zoom"),this.updateDebugZoom(),this.updateDebugCenter()},200),this.container}onRemove(){this.map=null,this.container=null}updateDebugZoom(){!this.map||!this.debugZoomEl||(this.debugZoomEl.innerText=this.map.getZoom().toFixed(2).toString())}updateDebugCenter(){if(!this.map||!this.debugCenterEl)return;const t=this.map.getCenter().toArray().map(e=>e.toFixed(6));this.debugCenterEl.innerText=t.join(",")}}class w3{static prettyPrintXML(t){const e=new DOMParser,i=e.parseFromString(t,"application/xml"),a=e.parseFromString('\n      <xsl:stylesheet version="2.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">\n        <xsl:strip-space elements="*"/>\n        <xsl:output indent="yes"/>\n        \n        \x3c!-- change to just text() to strip space in text nodes --\x3e\n        <xsl:template match="para[content-style][not(text())]">\n          <xsl:value-of select="normalize-space(.)"/>\n        </xsl:template>\n        <xsl:template match="node()|@*">\n          <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>\n        </xsl:template>\n      </xsl:stylesheet>\n    ',"application/xml");var p=new XSLTProcessor;p.importStylesheet(a);const y=p.transformToDocument(i);return(new XMLSerializer).serializeToString(y)}}class $W{constructor(t,e){this._document=e;const i=this._textarea=this._document.createElement("textarea"),r=i.style;r.position="fixed",r.top=r.opacity="0",r.left="-999em",i.setAttribute("aria-hidden","true"),i.value=t,i.readOnly=!0,this._document.body.appendChild(i)}copy(){const t=this._textarea;let e=!1;try{if(t){const i=this._document.activeElement;t.select(),t.setSelectionRange(0,t.value.length),e=this._document.execCommand("copy"),i&&i.focus()}}catch(i){}return e}destroy(){const t=this._textarea;t&&(t.remove(),this._textarea=void 0)}}let WW=(()=>{class n{constructor(e){this._document=e}copy(e){const i=this.beginCopy(e),r=i.copy();return i.destroy(),r}beginCopy(e){return new $W(e,this._document)}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const S3=Sq();class XW{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=ca(-this._previousScrollPosition.left),t.style.top=ca(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,a=i.scrollBehavior||"",p=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),S3&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),S3&&(i.scrollBehavior=a,r.scrollBehavior=p)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class ZW{constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class T3{enable(){}disable(){}attach(){}}function yA(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function C3(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class YW{constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();yA(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let KW=(()=>{class n{constructor(e,i,r,a){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new T3,this.close=p=>new ZW(this._scrollDispatcher,this._ngZone,this._viewportRuler,p),this.block=()=>new XW(this._viewportRuler,this._document),this.reposition=p=>new YW(this._scrollDispatcher,this._viewportRuler,this._ngZone,p),this._document=a}}return n.\u0275fac=function(e){return new(e||n)(mt(YF),mt(cd),mt(Oi),mt(Mi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class M_{constructor(t){if(this.scrollStrategy=new T3,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class JW{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}class Lm{constructor(t,e,i,r,a,p,y,T,P,z=!1){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=a,this._keyboardDispatcher=p,this._document=y,this._location=T,this._outsideClickDispatcher=P,this._animationsDisabled=z,this._backdropElement=null,this._backdropClick=new fn,this._attachments=new fn,this._detachments=new fn,this._locationChanges=Qe.EMPTY,this._backdropClickHandler=H=>this._backdropClick.next(H),this._backdropTransitionendHandler=H=>{this._disposeBackdrop(H.target)},this._keydownEvents=new fn,this._outsidePointerEvents=new fn,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(ko(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof(null==e?void 0:e.onDestroy)&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){var t;const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(t=this._host)||void 0===t||t.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=ca(this._config.width),t.height=ca(this._config.height),t.minWidth=ca(this._config.minWidth),t.minHeight=ca(this._config.minHeight),t.maxWidth=ca(this._config.maxWidth),t.maxHeight=ca(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),this._animationsDisabled||"undefined"==typeof requestAnimationFrame?this._backdropElement.classList.add(t):this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})})}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,i){const r=BT(e||[]).filter(a=>!!a);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(br(yo(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let qy=(()=>{class n{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){var e;null===(e=this._containerElement)||void 0===e||e.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||MM()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let a=0;a<r.length;a++)r[a].remove()}const i=this._document.createElement("div");i.classList.add(e),MM()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi),mt(la))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const D3="cdk-overlay-connected-position-bounding-box",QW=/([A-Za-z%]+)$/;class e7{constructor(t,e,i,r,a){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=a,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new fn,this._resizeSubscription=Qe.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(D3),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,a=[];let p;for(let y of this._preferredPositions){let T=this._getOriginPoint(t,r,y),P=this._getOverlayPoint(T,e,y),z=this._getOverlayFit(P,e,i,y);if(z.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(y,T);this._canFitWithFlexibleDimensions(z,P,i)?a.push({position:y,origin:T,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(T,y)}):(!p||p.overlayFit.visibleArea<z.visibleArea)&&(p={overlayFit:z,overlayPoint:P,originPoint:T,position:y,overlayRect:e})}if(a.length){let y=null,T=-1;for(const P of a){const z=P.boundingBoxRect.width*P.boundingBoxRect.height*(P.position.weight||1);z>T&&(T=z,y=P)}return this._isPushed=!1,void this._applyPosition(y.position,y.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(p.position,p.originPoint);this._applyPosition(p.position,p.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&A_(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(D3),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let r,a;if("center"==i.originX)r=t.left+t.width/2;else{const p=this._isRtl()?t.right:t.left,y=this._isRtl()?t.left:t.right;r="start"==i.originX?p:y}return e.left<0&&(r-=e.left),a="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,e.top<0&&(a-=e.top),{x:r,y:a}}_getOverlayPoint(t,e,i){let r,a;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,a="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+r,y:t.y+a}}_getOverlayFit(t,e,i,r){const a=I3(e);let{x:p,y}=t,T=this._getOffset(r,"x"),P=this._getOffset(r,"y");T&&(p+=T),P&&(y+=P);let J=0-y,oe=y+a.height-i.height,fe=this._subtractOverflows(a.width,0-p,p+a.width-i.width),Ae=this._subtractOverflows(a.height,J,oe),We=fe*Ae;return{visibleArea:We,isCompletelyWithinViewport:a.width*a.height===We,fitsInViewportVertically:Ae===a.height,fitsInViewportHorizontally:fe==a.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,a=i.right-e.x,p=E3(this._overlayRef.getConfig().minHeight),y=E3(this._overlayRef.getConfig().minWidth),P=t.fitsInViewportHorizontally||null!=y&&y<=a;return(t.fitsInViewportVertically||null!=p&&p<=r)&&P}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=I3(e),a=this._viewportRect,p=Math.max(t.x+r.width-a.width,0),y=Math.max(t.y+r.height-a.height,0),T=Math.max(a.top-i.top-t.y,0),P=Math.max(a.left-i.left-t.x,0);let z=0,H=0;return z=r.width<=a.width?P||-p:t.x<this._viewportMargin?a.left-i.left-t.x:0,H=r.height<=a.height?T||-y:t.y<this._viewportMargin?a.top-i.top-t.y:0,this._previousPushAmount={x:z,y:H},{x:t.x+z,y:t.y+H}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new JW(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let a=0;a<e.length;a++)e[a].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,r=this._isRtl();let a,p,y,z,H,J;if("top"===e.overlayY)p=t.y,a=i.height-p+this._viewportMargin;else if("bottom"===e.overlayY)y=i.height-t.y+2*this._viewportMargin,a=i.height-y+this._viewportMargin;else{const oe=Math.min(i.bottom-t.y+i.top,t.y),fe=this._lastBoundingBoxSize.height;a=2*oe,p=t.y-oe,a>fe&&!this._isInitialRender&&!this._growAfterOpen&&(p=t.y-fe/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)J=i.width-t.x+this._viewportMargin,z=t.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)H=t.x,z=i.right-t.x;else{const oe=Math.min(i.right-t.x+i.left,t.x),fe=this._lastBoundingBoxSize.width;z=2*oe,H=t.x-oe,z>fe&&!this._isInitialRender&&!this._growAfterOpen&&(H=t.x-fe/2)}return{top:p,left:H,bottom:y,right:J,width:z,height:a}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const a=this._overlayRef.getConfig().maxHeight,p=this._overlayRef.getConfig().maxWidth;r.height=ca(i.height),r.top=ca(i.top),r.bottom=ca(i.bottom),r.width=ca(i.width),r.left=ca(i.left),r.right=ca(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",a&&(r.maxHeight=ca(a)),p&&(r.maxWidth=ca(p))}this._lastBoundingBoxSize=i,A_(this._boundingBox.style,r)}_resetBoundingBoxStyles(){A_(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){A_(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},r=this._hasExactPosition(),a=this._hasFlexibleDimensions,p=this._overlayRef.getConfig();if(r){const z=this._viewportRuler.getViewportScrollPosition();A_(i,this._getExactOverlayY(e,t,z)),A_(i,this._getExactOverlayX(e,t,z))}else i.position="static";let y="",T=this._getOffset(e,"x"),P=this._getOffset(e,"y");T&&(y+=`translateX(${T}px) `),P&&(y+=`translateY(${P}px)`),i.transform=y.trim(),p.maxHeight&&(r?i.maxHeight=ca(p.maxHeight):a&&(i.maxHeight="")),p.maxWidth&&(r?i.maxWidth=ca(p.maxWidth):a&&(i.maxWidth="")),A_(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},a=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(a=this._pushOverlayOnScreen(a,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(a.y+this._overlayRect.height)+"px":r.top=ca(a.y),r}_getExactOverlayX(t,e,i){let p,r={left:"",right:""},a=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(a=this._pushOverlayOnScreen(a,this._overlayRect,i)),p=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===p?r.right=this._document.documentElement.clientWidth-(a.x+this._overlayRect.width)+"px":r.left=ca(a.x),r}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:C3(t,i),isOriginOutsideView:yA(t,i),isOverlayClipped:C3(e,i),isOverlayOutsideView:yA(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&BT(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof ei)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function A_(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function E3(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split(QW);return e&&"px"!==e?null:parseFloat(t)}return n||null}function I3(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const M3="cdk-global-overlay-wrapper";class t7{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(M3),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:a,maxWidth:p,maxHeight:y}=i,T=!("100%"!==r&&"100vw"!==r||p&&"100%"!==p&&"100vw"!==p),P=!("100%"!==a&&"100vh"!==a||y&&"100%"!==y&&"100vh"!==y),z=this._xPosition,H=this._xOffset,J="rtl"===this._overlayRef.getConfig().direction;let oe="",fe="",Ae="";T?Ae="flex-start":"center"===z?(Ae="center",J?fe=H:oe=H):J?"left"===z||"end"===z?(Ae="flex-end",oe=H):("right"===z||"start"===z)&&(Ae="flex-start",fe=H):"left"===z||"start"===z?(Ae="flex-start",oe=H):("right"===z||"end"===z)&&(Ae="flex-end",fe=H),t.position=this._cssPosition,t.marginLeft=T?"0":oe,t.marginTop=P?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=T?"0":fe,e.justifyContent=Ae,e.alignItems=P?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(M3),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let n7=(()=>{class n{constructor(e,i,r,a){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=a}global(){return new t7}flexibleConnectedTo(e){return new e7(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(mt(cd),mt(Mi),mt(la),mt(qy))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),A3=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),i7=(()=>{class n extends A3{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=r=>{const a=this._attachedOverlays;for(let p=a.length-1;p>-1;p--)if(a[p]._keydownEvents.observers.length>0){const y=a[p]._keydownEvents;this._ngZone?this._ngZone.run(()=>y.next(r)):y.next(r);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi),mt(Oi,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),r7=(()=>{class n extends A3{constructor(e,i,r){super(e),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=a=>{this._pointerDownEventTarget=Mm(a)},this._clickListener=a=>{const p=Mm(a),y="click"===a.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:p;this._pointerDownEventTarget=null;const T=this._attachedOverlays.slice();for(let P=T.length-1;P>-1;P--){const z=T[P];if(z._outsidePointerEvents.observers.length<1||!z.hasAttached())continue;if(z.overlayElement.contains(p)||z.overlayElement.contains(y))break;const H=z._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>H.next(a)):H.next(a)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(e){return new(e||n)(mt(Mi),mt(la),mt(Oi,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),o7=0,Ls=(()=>{class n{constructor(e,i,r,a,p,y,T,P,z,H,J,oe){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=a,this._keyboardDispatcher=p,this._injector=y,this._ngZone=T,this._document=P,this._directionality=z,this._location=H,this._outsideClickDispatcher=J,this._animationsModuleType=oe}create(e){const i=this._createHostElement(),r=this._createPaneElement(i),a=this._createPortalOutlet(r),p=new M_(e);return p.direction=p.direction||this._directionality.value,new Lm(a,i,r,p,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+o7++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(xy)),new b$(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(mt(KW),mt(qy),mt(Dp),mt(n7),mt(i7),mt(jo),mt(Oi),mt(Mi),mt(Rm),mt(vS),mt(r7),mt(ch,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();const s7=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],R3=new Qt("cdk-connected-overlay-scroll-strategy");let k3=(()=>{class n{constructor(e){this.elementRef=e}}return n.\u0275fac=function(e){return new(e||n)(le(ei))},n.\u0275dir=cn({type:n,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),n})(),P3=(()=>{class n{constructor(e,i,r,a,p){this._overlay=e,this._dir=p,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=Qe.EMPTY,this._attachSubscription=Qe.EMPTY,this._detachSubscription=Qe.EMPTY,this._positionSubscription=Qe.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new Cn,this.positionChange=new Cn,this.attach=new Cn,this.detach=new Cn,this.overlayKeydown=new Cn,this.overlayOutsideClick=new Cn,this._templatePortal=new D_(i,r),this._scrollStrategyFactory=a,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=Si(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=Si(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=Si(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=Si(e)}get push(){return this._push}set push(e){this._push=Si(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=s7);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!nl(i)&&(i.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{this.overlayOutsideClick.next(i)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),i=new M_({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(e){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return e.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(e),e}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof k3?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(pO(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(le(Ls),le(Yo),le(Rs),le(R3),le(Rm,8))},n.\u0275dir=cn({type:n,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[xo]}),n})();const l7={provide:R3,deps:[Ls],useFactory:function a7(n){return()=>n.scrollStrategies.reposition()}};let uc=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[Ls,l7],imports:[qT,il,qM,qM]}),n})();function c7(n,t){}function u7(n,t){}function d7(n,t){1&n&&(ae(0,"button",1),dn(1,"sbb-icon",2),de()),2&n&&Ve("aria-label",Ot().closeAriaLabel)}const h7=["*"];class cC{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let L3=(()=>{class n extends Ox{constructor(e,i,r,a,p,y,T,P){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=a,this._interactivityChecker=p,this._ngZone=y,this._overlayRef=T,this._focusMonitor=P,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=z=>{this._portalOutlet.hasAttached();const H=this._portalOutlet.attachDomPortal(z);return this._contentAttached(),H},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=ad(),a=this._elementRef.nativeElement;(!r||r===this._document.body||r===a||a.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=ad();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=ad())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(zy),le(Mi,8),le(cC),le(T_),le(Oi),le(Lm),le(yl))},n.\u0275cmp=Ut({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&io(bh,7),2&e){let r;_i(r=bi())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&Yn("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[zn],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&Ct(0,c7,0,0,"ng-template",0)},dependencies:[bh],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class vA{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new fn,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!nl(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const O3=new Qt("DialogScrollStrategy"),p7=new Qt("DialogData"),f7=new Qt("DefaultDialogConfig"),g7={provide:O3,deps:[Ls],useFactory:function m7(n){return()=>n.scrollStrategies.block()}};let _7=0,F3=(()=>{class n{constructor(e,i,r,a,p,y){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=a,this._overlayContainer=p,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new fn,this._afterOpenedAtThisLevel=new fn,this._ariaHiddenElements=new Map,this.afterAllClosed=p_(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(va(void 0))),this._scrollStrategy=y}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new cC;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+_7++,i.id&&this.getDialogById(i.id);const a=this._getOverlayConfig(i),p=this._overlay.create(a),y=new vA(p,i),T=this._attachContainer(p,y,i);return y.containerInstance=T,this._attachDialogContent(e,y,T,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(y),y.closed.subscribe(()=>this._removeOpenDialog(y,!0)),this.afterOpened.next(y),y}closeAll(){xA(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){xA(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),xA(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new M_({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var a;const p=r.injector||(null===(a=r.viewContainerRef)||void 0===a?void 0:a.injector),y=[{provide:cC,useValue:r},{provide:vA,useValue:i},{provide:Lm,useValue:e}];let T;r.container?"function"==typeof r.container?T=r.container:(T=r.container.type,y.push(...r.container.providers(r))):T=L3;const P=new _h(T,r.viewContainerRef,jo.create({parent:p||this._injector,providers:y}),r.componentFactoryResolver);return e.attach(P).instance}_attachDialogContent(e,i,r,a){if(e instanceof Yo){const p=this._createInjector(a,i,r,void 0);let y={$implicit:a.data,dialogRef:i};a.templateContext&&(y=Object.assign(Object.assign({},y),"function"==typeof a.templateContext?a.templateContext():a.templateContext)),r.attachTemplatePortal(new D_(e,null,y,p))}else{const p=this._createInjector(a,i,r,this._injector),y=r.attachComponentPortal(new _h(e,a.viewContainerRef,p,a.componentFactoryResolver));i.componentInstance=y.instance}}_createInjector(e,i,r,a){var p;const y=e.injector||(null===(p=e.viewContainerRef)||void 0===p?void 0:p.injector),T=[{provide:p7,useValue:e.data},{provide:vA,useValue:i}];return e.providers&&("function"==typeof e.providers?T.push(...e.providers(i,e,r)):T.push(...e.providers)),e.direction&&(!y||!y.get(Rm,null,hi.Optional))&&T.push({provide:Rm,useValue:{value:e.direction,change:si()}}),jo.create({parent:y||a,providers:T})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((a,p)=>{a?p.setAttribute("aria-hidden",a):p.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const a=i[r];a!==e&&"SCRIPT"!==a.nodeName&&"STYLE"!==a.nodeName&&!a.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(a,a.getAttribute("aria-hidden")),a.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(mt(Ls),mt(jo),mt(f7,8),mt(n,12),mt(qy),mt(O3))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();function xA(n,t){let e=n.length;for(;e--;)t(n[e])}let b7=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[F3,g7],imports:[uc,il,C_,il]}),n})();const $y={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},y7={dialogContainer:ya("dialogContainer",[oo("void, exit",mi({opacity:0,transform:"scale(0.7)"})),oo("enter",mi({transform:"none"})),kr("* => enter",rP([zr("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",mi({transform:"none",opacity:1})),YE("@*",ZE(),{optional:!0})]),$y),kr("* => void, * => exit",rP([zr("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",mi({opacity:0})),YE("@*",ZE(),{optional:!0})]),$y)])};class Hx{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.maxHeight="96vh",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.delayFocusTrap=!1,this.closeOnNavigation=!0,this.enterAnimationDuration=$y.params.enterAnimationDuration,this.exitAnimationDuration=$y.params.exitAnimationDuration}}let N3=(()=>{class n extends L3{constructor(e,i,r,a,p,y,T,P){super(e,i,r,a,p,y,T,P),this._animationStateChanged=new Cn,this._state="enter"}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_getAnimationState(){return{value:this._state,params:{enterAnimationDuration:this._config.enterAnimationDuration||$y.params.enterAnimationDuration,exitAnimationDuration:this._config.exitAnimationDuration||$y.params.exitAnimationDuration}}}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(zy),le(Mi,8),le(Hx),le(T_),le(Oi),le(Lm),le(yl))},n.\u0275cmp=Ut({type:n,selectors:[["ng-component"]],features:[zn],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),v7=(()=>{class n extends N3{constructor(e,i,r,a,p,y,T,P,z){super(e,i,r,a,p,y,T,z),this._changeDetectorRef=P}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?this._openAnimationDone(i):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(zy),le(Mi,8),le(Hx),le(T_),le(Oi),le(Lm),le(lo),le(yl))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&dm("@dialogContainer.done",function(a){return i._onAnimationDone(a)})("@dialogContainer.start",function(a){return i._onAnimationStart(a)}),2&e&&(Jr("id",i._config.id),Yn("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),as("@dialogContainer",i._getAnimationState()))},features:[zn],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&Ct(0,u7,0,0,"ng-template",0)},dependencies:[bh],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-dialog-container{display:flex;flex-direction:column;border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);box-shadow:var(--sbb-box-shadow-below);width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .sbb-dialog-container{outline:solid .0666666667rem}.sbb-dialog-container>*:only-child:not(.sbb-dialog-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-dialog-content{display:block;padding:var(--sbb-dialog-padding);flex:1 1 auto;max-height:80vh;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-dialog-content>*:first-child{margin-top:0}.sbb-dialog-title{font-size:var(--sbb-font-size);padding:calc(1rem * var(--sbb-scaling-factor)) calc(2.6666666667rem * var(--sbb-scaling-factor)) calc(1rem * var(--sbb-scaling-factor)) var(--sbb-dialog-padding);flex:0 0 auto;display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(3.5333333333rem * var(--sbb-scaling-factor))}.sbb-dialog-title-close-button{position:absolute;right:calc(1.0666666667rem * var(--sbb-scaling-factor));cursor:pointer;line-height:0}.sbb-dialog-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}.sbb-dialog-actions{padding:calc(0.4666666667rem * var(--sbb-scaling-factor)) calc(1.0666666667rem * var(--sbb-scaling-factor));display:flex;flex:0 0 auto;flex-wrap:wrap;gap:var(--sbb-button-gap);align-items:center;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}.sbb-dialog-actions.sbb-dialog-actions-align-start,.sbb-dialog-actions[align=start],.sbb-dialog-actions[align=left]{justify-content:flex-start}.sbb-dialog-actions.sbb-dialog-actions-align-center,.sbb-dialog-actions[align=center]{justify-content:center}.sbb-dialog-actions.sbb-dialog-actions-align-end,.sbb-dialog-actions[align=end]{justify-content:flex-end}"],encapsulation:2,data:{animation:[y7.dialogContainer]}}),n})();class uC{constructor(t,e,i){this.ref=t,this._containerInstance=i,this._afterOpened=new fn,this._beforeClosed=new fn,this._state=0,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe(go(r=>"opened"===r.state),ko(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(go(r=>"closed"===r.state),ko(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),yo(this.backdropClick(),this.keydownEvents().pipe(go(r=>27===r.keyCode&&!this.disableClose&&!nl(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),B3(this,"keydown"===r.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(go(e=>"closing"===e.state),ko(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this.ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this.ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this.ref.backdropClick}keydownEvents(){return this.ref.keydownEvents}updatePosition(t){const e=this.ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this.ref.updatePosition(),this}updateSize(t="",e=""){return this.ref.updateSize(t,e),this}addPanelClass(t){return this.ref.addPanelClass(t),this}removePanelClass(t){return this.ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this.ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function B3(n,t,e){return n._closeInteractionType=t,n.close(e)}const x7=new Qt("SbbDialogData"),w7=new Qt("sbb-dialog-default-options"),z3=new Qt("sbb-dialog-scroll-strategy"),T7={provide:z3,deps:[Ls],useFactory:function S7(n){return()=>n.scrollStrategies.block()}};let C7=0,V3=(()=>{class n{constructor(e,i,r,a,p,y,T,P,z){this._overlay=e,this._defaultOptions=r,this._parentDialog=a,this._dialogRefConstructor=T,this._dialogContainerType=P,this._dialogDataToken=z,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new fn,this._afterOpenedAtThisLevel=new fn,this._idPrefix="sbb-dialog-",this.afterAllClosed=p_(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(va(void 0))),this._scrollStrategy=y,this._dialog=i.get(F3)}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){let r;(i=Object.assign(Object.assign({},this._defaultOptions||new Hx),i)).id=i.id||`${this._idPrefix}${C7++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy(),i.backdropClass=i.backdropClass||"sbb-overlay-background";const a=this._dialog.open(e,Object.assign(Object.assign({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:Hx,useValue:i},{provide:cC,useValue:i}]},templateContext:()=>({dialogRef:r,lightboxRef:r}),providers:(p,y,T)=>(r=new this._dialogRefConstructor(p,i,T),r.updatePosition(null==i?void 0:i.position),[{provide:this._dialogContainerType,useValue:T},{provide:this._dialogDataToken,useValue:y.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentInstance=a.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const p=this.openDialogs.indexOf(r);p>-1&&(this.openDialogs.splice(p,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){Cc()},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),wl=(()=>{class n extends V3{constructor(e,i,r,a,p,y){super(e,i,r,p,y,a,uC,v7,x7)}}return n.\u0275fac=function(e){return new(e||n)(mt(Ls),mt(jo),mt(w7,8),mt(z3),mt(n,12),mt(qy))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),D7=0,Om=(()=>{class n{constructor(e,i,r){this._dialogRef=e,this._elementRef=i,this._dialog=r,this.ariaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this.type="button",this._canCloseInterceptor=()=>!0}ngOnInit(){this._dialogRef||(this._dialogRef=j3(this._elementRef,this._dialog.openDialogs))}ngOnChanges(e){const i=e._sbbDialogClose||e._sbbDialogCloseResult;i&&(this.dialogResult=i.currentValue)}_onButtonClick(e){!this._canCloseInterceptor()||B3(this._dialogRef,0===e.screenX&&0===e.screenY?"keyboard":"mouse",this.dialogResult)}}return n.\u0275fac=function(e){return new(e||n)(le(uC,8),le(ei),le(wl))},n.\u0275dir=cn({type:n,selectors:[["","sbb-dialog-close",""],["","sbbDialogClose",""]],hostVars:2,hostBindings:function(e,i){1&e&&Zt("click",function(a){return i._onButtonClick(a)}),2&e&&Yn("aria-label",i.ariaLabel||null)("type",i.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["sbb-dialog-close","dialogResult"],_sbbDialogClose:["sbbDialogClose","_sbbDialogClose"]},exportAs:["sbbDialogClose"],features:[xo]}),n})(),E7=(()=>{class n{constructor(e,i,r,a){this._dialogRef=e,this._elementRef=i,this._dialog=r,this._changeDetectorRef=a,this.id="sbb-dialog-title-"+D7++,this.closeAriaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this._closeEnabled=!0}ngOnInit(){this._dialogRef||(this._dialogRef=j3(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const e=this._dialogRef._containerInstance;!e||(e._config.disableClose&&(this._closeEnabled=!1,this._changeDetectorRef.markForCheck()),e._ariaLabelledBy||(e._ariaLabelledBy=this.id))})}}return n.\u0275fac=function(e){return new(e||n)(le(uC,8),le(ei),le(wl),le(lo))},n.\u0275dir=cn({type:n,inputs:{id:"id",closeAriaLabel:"closeAriaLabel"}}),n})(),R_=(()=>{class n extends E7{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wr(n)))(i||n)}}(),n.\u0275cmp=Ut({type:n,selectors:[["sbb-dialog-title"],["","sbb-dialog-title",""],["","sbbDialogTitle",""]],hostAttrs:[1,"sbb-dialog-title"],hostVars:1,hostBindings:function(e,i){2&e&&Jr("id",i.id)},exportAs:["sbbDialogTitle"],features:[zn],ngContentSelectors:h7,decls:2,vars:1,consts:[["sbb-dialog-close","","class","sbb-dialog-title-close-button sbb-button-reset-frameless",3,"aria-label",4,"ngIf"],["sbb-dialog-close","",1,"sbb-dialog-title-close-button","sbb-button-reset-frameless",3,"aria-label"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(ss(),Yr(0),Ct(1,d7,2,1,"button",0)),2&e&&(_e(1),Ve("ngIf",i._closeEnabled))},dependencies:[Go,vl,Om],encapsulation:2,changeDetection:0}),n})(),k_=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["","sbb-dialog-content",""],["sbb-dialog-content"],["","sbbDialogContent",""]],hostAttrs:[1,"sbb-dialog-content","sbb-scrollbar"]}),n})(),P_=(()=>{class n{constructor(){this.align="end"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["","sbb-dialog-actions",""],["sbb-dialog-actions"],["","sbbDialogActions",""]],hostAttrs:[1,"sbb-dialog-actions"],hostVars:6,hostBindings:function(e,i){2&e&&l("sbb-dialog-actions-align-start","start"===i.align)("sbb-dialog-actions-align-center","center"===i.align)("sbb-dialog-actions-align-end","end"===i.align)},inputs:{align:"align"}}),n})();function j3(n,t){let e=n.nativeElement.parentElement;for(;e&&!e.classList.contains("sbb-dialog-container")&&!e.classList.contains("sbb-lightbox-container");)e=e.parentElement;return e?t.find(i=>i.id===e.id):null}let wA=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[wl,T7],imports:[ro,b7,uc,il,Pr,cs]}),n})();function I7(n,t){if(1&n){const e=Zr();ae(0,"div",13)(1,"div")(2,"input",14),Zt("change",function(){return di(e),oi(Ot().toggleStripTags())}),de()(),ae(3,"div")(4,"label",15),W(5,"Remove "),ae(6,"mark"),W(7,"<LinkProjection>"),de()()()()}}let dC=(()=>{class n{constructor(e){this.clipboard=e,this.responseXML="loading TR...",this.isTripRequest=!1,this.requestXML="n/a",this.responseXML_Original="n/a",this.responseXML_Stripped="n/a",this.isStrippingTagsEnabled=!0}updateRequestData(e){if(this.requestXML=e.requestXML?w3.prettyPrintXML(e.requestXML):"n/a (error getting request XML)",e.responseXML){if(this.responseXML_Original=w3.prettyPrintXML(e.responseXML),this.isTripRequest){let i=this.responseXML_Original.replace(/<LinkProjection>.+?<\/LinkProjection>/gms,"");i=i.replace(/<ojp:LinkProjection>.+?<\/ojp:LinkProjection>/gms,""),this.responseXML_Stripped=i}this.updateResponseXML()}else this.responseXML="loading TR ... or TR is not fetched yet"}toggleStripTags(){this.isStrippingTagsEnabled=!this.isStrippingTagsEnabled,this.updateResponseXML()}updateResponseXML(){this.responseXML=this.isTripRequest&&this.isStrippingTagsEnabled?this.responseXML_Stripped:this.responseXML_Original}copyTextToClipboard(){this.clipboard.copy(this.responseXML)}}return n.\u0275fac=function(e){return new(e||n)(le(WW))},n.\u0275cmp=Ut({type:n,selectors:[["debug-xml-popover"]],decls:26,vars:3,consts:[["sbbDialogTitle",""],["sbbDialogContent","",1,"d-flex","flex-column","h-100"],[1,"flex-fill"],[1,"d-flex","flex-column","h-100"],[1,"mb-2"],[1,"flex-grow-1"],[1,"w-100","h-100"],[1,"mt-2","mb-2"],[1,"mt-2","mb-2","d-flex","gap-2","align-items-center"],[1,"btn","btn-primary","btn-sm",3,"click"],["class","d-flex gap-1",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],[1,"d-flex","gap-1"],["type","checkbox","checked","","id","stripTagsInput",1,"form-check-input",3,"change"],["for","stripTagsInput"]],template:function(e,i){1&e&&(ae(0,"div",0)(1,"strong"),W(2,"Current Response XML"),de()(),ae(3,"div",1)(4,"div",2)(5,"div",3)(6,"div",4),W(7,"Request XML"),de(),ae(8,"div",5)(9,"textarea",6),W(10),de()()()(),ae(11,"div",2)(12,"div",3)(13,"div",7),W(14,"Response XML"),de(),ae(15,"div",5)(16,"textarea",6),W(17),de()(),ae(18,"div",8)(19,"div")(20,"button",9),Zt("click",function(){return i.copyTextToClipboard()}),W(21,"Copy to Clipboard"),de()(),Ct(22,I7,8,0,"div",10),de()()(),ae(23,"div",11)(24,"button",12),W(25," Close "),de()()()),2&e&&(_e(10),ce(i.requestXML),_e(7),ce(i.responseXML),_e(5),Ve("ngIf",!0===i.isTripRequest))},dependencies:[Go,Om,R_,k_,P_],encapsulation:2}),n})();const M7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#0000FF","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),A7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"{stopPlace.stopPlaceName} \\n {stopPlace.stopPlaceRefLabel}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.2,0.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),R7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#eb0000","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),k7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#834333","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),P7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-charging-station","icon-allow-overlap":true,"icon-size":0.5}}'),L7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"car-15","icon-allow-overlap":true,"icon-size":1.4}}'),O7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"bicycle-15","icon-allow-overlap":true,"icon-size":1.4}}'),F7=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-scooter","icon-allow-overlap":true,"icon-size":0.4}}'),hC=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","layout":{"text-field":"{sharedVehicle.itemsNo}","text-allow-overlap":true,"text-size":12,"text-offset":[0.7,-1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-color":["case",["==",["get","sharedVehicle.itemsNo"],0],"red","#006400"],"text-halo-width":1}}'),pC=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":15,"layout":{"text-field":"{sharedVehicle.provider}","text-allow-overlap":true,"text-size":12,"text-offset":[0,1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),U3={"stops-circle":M7,"stops-label":A7,"address-circle":R7,"topographic-place-circle":k7,"charging-station-icon":P7,"charging-station-text-number":hC,"charging-station-text-provider":pC,"car-rental-icon":L7,"car-rental-text-number":hC,"car-rental-text-provider":pC,"bike-icon":O7,"bike-text-number":hC,"bike-text-provider":pC,"scooter-icon":F7,"scooter-text-number":hC,"scooter-text-provider":pC,"poi-all":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":["get","style.icon-image"],"icon-allow-overlap":true,"icon-size":0.4}}')};class Gx{constructor(t,e,i,r,a){this.language=t,this.layerKey=e,this.map=i,this.restrictionType=r.LIR_Restriction_Type,this.restrictionPOI=r.LIR_POI_Type?r.LIR_POI_Type:null,this.minZoom=r.minZoom,this.features=[],this.mapSourceID=e+"-map-src",this.userTripService=a,this.isEnabled=!1,this.lastOJPRequest=null,this.addMapSourceAndLayers(),this.currentLocations=[]}addMapSourceAndLayers(){var t;this.map.addSource(this.mapSourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.layerKey in Gy?(null!==(t=Gy[this.layerKey].layer_ids)&&void 0!==t?t:[this.layerKey]).forEach(r=>{if(!(r in U3))return void console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layer def for "+r);const p=JSON.parse(JSON.stringify(U3[r]));p.id=r,p.source=this.mapSourceID,this.map.addLayer(p)}):console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layers defined for "+this.layerKey)}shouldLoadNewFeatures(){return!(!this.isEnabled||this.map.getZoom()<this.minZoom)}refreshFeatures(){var t=this;return ua(function*(){var e;if(!t.shouldLoadNewFeatures())return void t.removeAllFeatures();const r="poi"===t.restrictionType&&"poi"===(null===(e=t.restrictionPOI)||void 0===e?void 0:e.poiType)?1e3:300,a=t.map.getBounds();if(null===a)return;const p=rl.initWithBBOXAndType(t.userTripService.getStageConfig(),t.language,a.getWest(),a.getNorth(),a.getEast(),a.getSouth(),[t.restrictionType],r,t.restrictionPOI);t.lastOJPRequest=p;const y=Gy[t.layerKey],T=yield p.fetchResponse();if("ERROR"===T.message)return console.log("AppMapLayer: "+t.layerKey+" backend ERROR"),void console.log(T);const P=[],z={};T.locations.forEach((J,oe)=>{var fe,Ae,We,ot,tn;if(null===J.geoPosition)return;if("poi"===t.restrictionType&&"shared_mobility"===(null===(fe=t.restrictionPOI)||void 0===fe?void 0:fe.poiType)){const Fi=null!==(Ae=y.LIR_POI_Type)&&void 0!==Ae?Ae:null;if(null===Fi)return void P.push(J);const Ui=null!==(ot=null===(We=J.poi)||void 0===We?void 0:We.category)&&void 0!==ot?ot:null;if(null===Ui)return void P.push(J);if(!Fi.tags.includes(Ui))return void P.push(J)}const un=J.geoPosition.asLatLngString();if(!(un in z)){const Fi={type:"Feature",properties:{locations_idx:[]},geometry:{type:"Point",coordinates:J.geoPosition.asPosition()}};z[un]=Fi}const Zn=null!==(tn=z[un])&&void 0!==tn?tn:null;null!==Zn&&null!==Zn.properties&&Zn.properties.locations_idx.push(oe)}),"DEBUG"===Na&&P.length>0&&(console.log("AppMapLayer.refreshFeatures -- discarded locations"),console.log(P),console.log("layer config"),console.log(y)),t.currentLocations=T.locations;const H=Object.values(z);H.forEach(J=>{if(null===J.properties)return;const oe=J.properties.locations_idx,fe=[];oe.forEach(Ae=>{var We;const ot=null!==(We=T.locations[Ae])&&void 0!==We?We:null;ot&&fe.push(ot)}),J.properties.locations_idx=oe.join(","),t.annotateFeatureFromLocations(J,fe)}),t.setSourceFeatures(H)})()}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceID).setData({type:"FeatureCollection",features:t})}annotateFeatureFromLocations(t,e){}handleMapClick(t){var e,i,r;if(!this.shouldLoadNewFeatures())return!1;const a=Gy[this.layerKey];let p=null!==(e=a.click_layer_ids)&&void 0!==e?e:[];if(0===p.length)return!1;"SAME_AS_LAYER_IDS"===p&&(p=null!==(i=a.layer_ids)&&void 0!==i?i:[this.layerKey]);const y=wh.queryNearbyFeaturesByLayerIDs(this.map,t.lngLat,p);if(0===y.length)return!1;const T=y[0];if(null===T.feature.properties)return!1;let P=null!==(r=T.feature.properties.locations_idx)&&void 0!==r?r:"";if(P=P.trim(),""===P)return!1;const z=[];P.split(",").forEach(oe=>{var fe;const Ae=parseInt(oe,10),We=null!==(fe=this.currentLocations[Ae])&&void 0!==fe?fe:null;We&&!(Ae in z)&&(z[Ae]=We)});const J=Object.values(z);return 0!==J.length&&(this.showPopup(J),!0)}showPopup(t){var e,i;const r=t[0],a=null!==(i=null===(e=r.geoPosition)||void 0===e?void 0:e.asLngLat())&&void 0!==i?i:null;if(null===a)return;const p=this.computePopupHTML(t);if(null===p)return;const y=document.createElement("div");y.innerHTML=p;const T=new(da().Popup)({focusAfterOpen:!1,maxWidth:"400px"});y.addEventListener("click",P=>{const H=P.target.getAttribute("data-endpoint-type");null!==H&&(this.userTripService.updateTripEndpoint(r,H,"MapPopupClick"),T.remove())}),T.setLngLat(a).setDOMContent(y).addTo(this.map)}computePopupHTML(t){var e,i,r,a;if(0===t.length)return null;const p=t[0],y=document.getElementById("map-endpoint-picker-popup");if(null===y)return null;let T=y.innerHTML;T=T.replace("[GEO_RESTRICTION_TYPE]",this.restrictionType);const P=null!==(a=null!==(i=null===(e=p.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null===(r=p.asGeoJSONFeature())||void 0===r?void 0:r.properties)&&void 0!==a?a:null;if(null==P)return T=T.replace("[GEOJSON_PROPERTIES_TABLE]","ERROR: cant read GeoJSON properties"),T;const z=[];for(let J in P){let oe=P[J];if("string"==typeof oe){const Ae=new String(oe);Ae.startsWith("http")&&(oe='<a href="'+Ae+'" target="_blank">'+Ae+"</a>")}z.push("<tr><td>"+J+"</td><td>"+oe+"</td></tr>")}const H='<table class="table">'+z.join("")+"</table>";return T=T.replace("[GEOJSON_PROPERTIES_TABLE]",H),T}}class B7 extends Gx{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=0;e.forEach((r,a)=>{"available"===this.computeLocationStatus(r)&&(i+=1)}),t.properties["sharedVehicle.itemsNo"]=i}computeLocationStatus(t){var e;const i=null!==(e=t.attributes.locationStatus)&&void 0!==e?e:null;if(null===i)return null;const r=i.toUpperCase();return"AVAILABALE"===r?"available":"OCCUPIED"===r?"occupied":"UNKNOWN"===r?"unknown":null}computePopupHTML(t){var e;const i=document.getElementById("map-poi-picker-popup");if(null===i||0===t.length)return null;const r=t[0];if(null===r.poi||"charging_station"!==r.poi.category)return null;const a=[];a.push('<tr><td style="width:50px;">Name</td><td>'+r.poi.name+" - "+r.locationName+"</td></tr>");let p=r.poi.code;p=p.replace(r.poi.name,""),p=p.replace(null!==(e=r.locationName)&&void 0!==e?e:"n/a",""),a.push("<tr><td>Code</td><td>"+p+"</td></tr>");const y=[];t.forEach((z,H)=>{var J;if(null===z.poi)return;const oe=this.computeLocationStatus(z);if(null===oe)return;const fe=(()=>{let ot="bg-success";return"occupied"===oe&&(ot="bg-danger"),"unknown"===oe&&(ot="bg-secondary"),'<span class="badge rounded-pill '+ot+'">'+oe.toUpperCase()+"</span>"})(),Ae=null!==(J=z.attributes.Code)&&void 0!==J?J:null;y.push("<li>"+fe+" "+Ae+"</li>")}),a.push('<tr><td colspan="2"><p>Chargers ('+t.length+")</p><ul>"+y.join("")+"</ul></td></tr>");let T=i.innerHTML;T=T.replace("[POI_NAME]","Charging Station");const P='<table class="table popup-charging-station">'+a.join("")+"</table>";return T=T.replace("[GEOJSON_PROPERTIES_TABLE]",P),T}}class z7 extends Gx{annotateFeatureFromLocations(t,e){null!==t.properties&&(0===e.length||null===e[0].poi||(t.properties["style.icon-image"]=e[0].poi.computePoiMapIcon()))}computePopupHTML(t){if(0===t.length)return null;const e=t[0];if(null===e.poi)return null;const i=document.getElementById("map-poi-picker-popup");if(null===i)return null;let r=i.innerHTML;r=r.replace("[POI_NAME]",e.poi.name);const a=[];a.push("<tr><td>Code</td><td>"+e.poi.code.substring(0,20)+"...</td></tr>"),a.push("<tr><td>Category</td><td>"+e.poi.category+"</td></tr>"),a.push("<tr><td>SubCategory</td><td>"+e.poi.subCategory+"</td></tr>");const p='<table class="table">'+a.join("")+"</table>";return r=r.replace("[GEOJSON_PROPERTIES_TABLE]",p),r}}class qx{constructor(t,e,i,r,a){this.poiType=t,this.vehicleType=e,this.provider=i,this.code=r,this.name=a,this.hireFacility=null,this.isFixedStation=!1,this.docksNo=null,this.vehiclesNo=null,this.vehicleName=null}static initFromLocation(t){var e,i,r;if(null===t.poi)return null;const a=t.poi.category,p=(()=>{var fe;const Ae=null!==(fe=t.attributes.Code)&&void 0!==fe?fe:null;return null!==Ae?Ae:t.poi.code})(),y=(()=>{if("bicycle_rental"===a){if("Publibike"===t.locationName)return["PubliBike","Bike"];if("Publiebike"===t.locationName)return["PubliBike","E-Bike"];if("Nextbike"===t.locationName)return["Nextbike","Bike"]}return p.startsWith("2em_cars")?["2EM Car Sharing","Car"]:p.startsWith("2em_cars_e")?["2EM Car Sharing","E-Car"]:p.startsWith("bird-")?["Bird","E-Scooter"]:p.startsWith("bolt_")?["Bolt","E-Scooter"]:p.startsWith("carvelo2go")?["Carvelo2go","E-CargoBike"]:p.startsWith("donkey_kreuzlingen")?["Regivelo.ch","Bike"]:p.startsWith("donkey_")?["Donkey Republic","Bike"]:p.startsWith("edrivecarsharing")?["E-drive Car Sharing","E-Car"]:p.startsWith("bird-platform-partner-jmfleetswl-")?["JM Fleets","E-Scooter"]:p.startsWith("liemobil_liechtenstein_ebike")?["LIEmobil","E-Bike"]:p.startsWith("lime_")?p.includes("_escooter")?["Lime","E-Scooter"]:["Lime","E-Bike"]:p.startsWith("mobility")?["Mobility","Car"]:p.startsWith("emobility")?["Mobility","E-Car"]:p.startsWith("nextbike_ch")?["Nextbike","Bike"]:p.startsWith("pickebike_")?p.includes("_emoped")?["Pick-e-Bike","E-Moped"]:["Pick-e-Bike","E-Bike"]:p.startsWith("share_birrer_ch")?["Share Birrer","E-Car"]:p.startsWith("sponticar")?["Sponti-Car","E-Car"]:p.startsWith("tier")?["TIER","E-Scooter"]:p.startsWith("tier_ebike")?["TIER","E-Bike"]:p.startsWith("voiscooters.com")?["VOI","E-Scooter"]:[null,"E-Scooter"]})(),T=y[0],P=y[1];if(null===T)return console.error("CANT DETECT provider"),console.log(t),null;const z="escooter_rental"===a?null!==(fe=t.attributes.Text)&&void 0!==fe?fe:null:"2EM Car Sharing"===T?T:"bicycle_rental"===a||"car_sharing"===a?t.poi.name:null;var fe;if(null===z)return console.error("CANT find name"),console.log(t),null;const H=new qx(a,P,T,p,z),J=null!==(e=t.attributes.num_docks_available)&&void 0!==e?e:null;null!==J&&(H.docksNo=parseInt(J,10));const oe=null!==(i=t.attributes.num_vehicles_available)&&void 0!==i?i:null;return null!==oe&&(H.isFixedStation=!0,H.vehiclesNo=parseInt(oe,10)),H.hireFacility=null!==(r=t.attributes.HireFacility)&&void 0!==r?r:null,"2EM Car Sharing"===T&&(H.vehicleName=t.poi.name),H}computeProviderLabel(){return"2EM Car Sharing"===this.provider?"2EM Car":"Carvelo2go"===this.provider?"Carvelo":"E-drive Car Sharing"===this.provider?"E-drive":"Donkey Republic"===this.provider?"Donkey Rep.":this.provider}}class V7 extends Gx{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=null;e.forEach(a=>{const p=qx.initFromLocation(a);null!==p&&null!==p.vehiclesNo&&(null===i&&(i=0),i+=p.vehiclesNo)}),null!==i&&(t.properties["sharedVehicle.itemsNo"]=i);const r=qx.initFromLocation(e[0]);r&&(t.properties["sharedVehicle.provider"]=r.computeProviderLabel())}computePopupHTML(t){if(0===t.length)return null;const e=document.getElementById("map-poi-picker-popup");if(null===e)return null;let i=e.innerHTML;const r=[];if(t.forEach(z=>{const H=qx.initFromLocation(z);H&&r.push(H)}),0===r.length){const z=t[0];i=i.replace("[POI_NAME]","GENERIC SHARED MOBILITY");const H=[];for(let oe in z.attributes){let fe=z.attributes[oe];if("string"==typeof fe){const We=new String(fe);We.startsWith("http")&&(fe='<a href="'+We+'" target="_blank">'+We+"</a>")}H.push("<tr><td>"+oe+"</td><td>"+fe+"</td></tr>")}const J='<table class="table">'+H.join("")+"</table>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",J),null}const a=r[0];i=i.replace("[POI_NAME]",a.provider);const y=[];if(y.push('<tr><td style="width:75px;">Name</td><td>'+a.name+"</td></tr>"),y.push("<tr><td>Code</td><td>"+a.code+"</td></tr>"),a.isFixedStation){const z=[];r.forEach(H=>{let oe=H.vehiclesNo+" "+H.vehicleType+(1===H.vehiclesNo?"":"s");null!==H.vehicleName&&(oe+=" - "+H.vehicleName),z.push("<li>"+oe+"</li>")}),y.push('<tr><td class="align-middle">Vehicles</td><td><ul>'+z.join("")+"</ul></td></tr>")}const P='<div class="popup-shared-mobility">'+['<table class="table">'+y.join("")+"</table>"].join("")+"</div>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",P),i}}class j7 extends Gx{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;const i=e[0];if(null===i.stopPlace)return;const r=i.stopPlace.stopPlaceRef;t.properties["stopPlace.stopPlaceRef"]=r,t.properties["stopPlace.stopPlaceName"]=i.stopPlace.stopPlaceName;let a=r.slice();a.length>32&&(a=r.substring(0,32)+"..."),t.properties["stopPlace.stopPlaceRefLabel"]=a}computePopupHTML(t){var e,i;if(0===t.length)return null;const r=document.getElementById("map-endpoint-stop-picker-popup");if(null===r)return null;const a=t[0],p=a.computeLocationName(),y=null!==(i=null===(e=a.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&void 0!==i?i:null;if(null===p||null===y)return null;let T=r.innerHTML;return T=T.replace("[STOP_NAME]",p),T=T.replace("[STOP_ID]",y),T}}class H3{static init(t,e,i,r,a){var p,y,T;return"stop"===r.LIR_Restriction_Type?new j7(t,e,i,r,a):(null===(p=r.LIR_POI_Type)||void 0===p?void 0:p.tags.includes("charging_station"))?new B7(t,e,i,r,a):"shared_mobility"===(null===(y=r.LIR_POI_Type)||void 0===y?void 0:y.poiType)?new V7(t,e,i,r,a):"poi"===(null===(T=r.LIR_POI_Type)||void 0===T?void 0:T.poiType)?new z7(t,e,i,r,a):new Gx(t,e,i,r,a)}}class SA{constructor(t,e,i,r){this.debugXmlPopover=e,this.prevMapBoundsHash="",this.map=t,this.layersData=[],this.userTripService=i,this.languageService=r}onAdd(t){this.map=t;const e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",e.innerHTML=document.getElementById("map-layers-legend-control").innerHTML,this.addLayers(e,t),this.addPOICompositeLayers(e,t),t.on("zoom",i=>{this.onZoomChanged(t)}),this.onZoomChanged(t),t.on("idle",i=>{this.handleMapIdleEvents(t)}),t.on("click",i=>{this.handleMapClickEvents(i,t)}),e}onRemove(){this.map=null}addLayers(t,e){t.querySelectorAll(".map-layer-data").forEach(i=>{var r;const a=i.getAttribute("data-map-layer-key");if(null===a)return;const p=i.querySelector(".map-layer-checkbox");if(null===p)return;const y=i.querySelector(".layer-xml-info"),T=null!==(r=Gy[a])&&void 0!==r?r:null;if(null===T)return console.error("ERROR - MapLayersLegendControl - cant find layerKey "+a+" in APP_CONFIG"),p.disabled=!0,i.insertAdjacentHTML("beforeend",'<span class="badge bg-danger text-white">ERROR</span>'),void(y&&y.classList.add("d-none"));const P=H3.init(this.languageService.language,a,e,T,this.userTripService);P.isEnabled=p.checked,y&&this.addLayerInfoClickHandler(y,P),p.addEventListener("change",H=>{P.isEnabled=p.checked,p.checked?P.refreshFeatures():P.removeAllFeatures()}),this.layersData.push({inputEls:[p],xmlInfoEl:y,layer:P})})}addLayerInfoClickHandler(t,e){t.addEventListener("click",i=>{const r=e.lastOJPRequest;if(r){const a=this.debugXmlPopover.open(dC,{position:{top:"20px"},width:"50vw",height:"90vh"});a.afterOpened().subscribe(()=>{a.componentInstance.updateRequestData(r.requestInfo)})}})}addPOICompositeLayers(t,e){t.querySelectorAll(".map-composite-pois").forEach(i=>{this.addPOICompositeLayer(i,e)})}addPOICompositeLayer(t,e){const i="pois-ALL",r=JSON.parse(JSON.stringify(Gy[i])),a=[],p=[];t.querySelectorAll(".map-layer-poi").forEach(z=>{const H=z,J=H.getAttribute("data-osm-tag");null!==J&&(p.push(H),H.checked&&a.push(J),H.addEventListener("change",oe=>{const fe=[];p.forEach(Ae=>{const We=Ae.getAttribute("data-osm-tag");Ae.checked&&We&&fe.push(We)}),y.restrictionPOI&&(y.restrictionPOI.tags=fe),y.isEnabled=fe.length>0,y.refreshFeatures(),P.xmlInfoEl&&(y.isEnabled?P.xmlInfoEl.classList.remove("d-none"):P.xmlInfoEl.classList.add("d-none"))}))}),r.LIR_POI_Type={poiType:"poi",tags:a};const y=H3.init(this.languageService.language,i,e,r,this.userTripService);y.isEnabled=a.length>0;const T=t.querySelector(".layer-xml-info");this.addLayerInfoClickHandler(T,y);const P={layer:y,inputEls:p,xmlInfoEl:T};this.layersData.push(P)}handleMapIdleEvents(t){const e=t.getBounds();if(null===e)return;const i=e.toString();this.prevMapBoundsHash!==i&&(this.prevMapBoundsHash=i,this.layersData.forEach(a=>{a.layer.refreshFeatures()}))}onZoomChanged(t){this.layersData.forEach(e=>{var i;const r=e.layer.minZoom,a=t.getZoom()<r;null===(i=e.inputEls)||void 0===i||i.forEach(p=>{p.disabled=a}),e.xmlInfoEl&&(a?e.xmlInfoEl.classList.add("d-none"):e.xmlInfoEl.classList.remove("d-none"))})}handleMapClickEvents(t,e){let i=!1;this.layersData.forEach(r=>{i||r.layer.handleMapClick(t)&&(i=!0)})}}class TA{static computeTimedLegColor(t){return"801"===t.service.agencyID?"PostAuto":t.service.ptMode.isRail()?"LongDistanceRail":t.service.ptMode.isDemandMode?"OnDemand":"Bus"}}var $s=(()=>{return(n=$s||($s={})).LegType="leg.type",n.DrawType="draw.type",n.PointType="point.type",n.LineType="line.type",$s;var n})();class U7{constructor(t){this.trip=t}computeBBOX(){var t,e;const i=new yh([]),r=null===(t=this.computeFromLocation())||void 0===t?void 0:t.geoPosition;r?i.extend(r):(console.error("Trip.computeBBOX - cant computeFromLocation"),console.log(this));const a=null===(e=this.computeToLocation())||void 0===e?void 0:e.geoPosition;return a?i.extend(a):(console.error("Trip.computeBBOX - cant computeToLocation"),console.log(this)),this.trip.legs.forEach(p=>{new $x(p).computeGeoJSONFeatures().forEach(P=>{var z;const H=null!==(z=P.bbox)&&void 0!==z?z:null;null!==H&&(i.extend(new Bo(H[0],H[1])),i.extend(new Bo(H[2],H[3])))})}),i}computeFromLocation(){return 0===this.trip.legs.length?null:this.trip.legs[0].fromLocation}computeToLocation(){return 0===this.trip.legs.length?null:this.trip.legs[this.trip.legs.length-1].toLocation}}class $x{constructor(t,e=0){this.leg=t,this.legIDx=e,this.useBeeLine=$x.shouldUseBeeline(t)}computeGeoJSONFeatures(){let t=[];if(this.useBeeLine){const i=this.computeBeelineFeature();i&&t.push(i)}const e=this.computeLinePointFeatures();return t=t.concat(e),t=t.concat(this.computeLegGeoJSONFeatures()),t.forEach(i=>{i.properties&&(i.properties["leg.idx"]=this.legIDx-1,i.properties[$s.LegType]=this.leg.legType)}),t}static shouldUseBeeline(t){const e=!(t.legTrack&&t.legTrack.hasGeoData);if("ContinousLeg"===t.legType)return e;if("TransferLeg"===t.legType){if(null===t.pathGuidance)return e;let r=!1;return t.pathGuidance.sections.forEach(a=>{var p;null!==(p=a.trackSection)&&void 0!==p&&p.linkProjection&&(r=!0)}),!1===r}return"TimedLeg"===t.legType?!t.service.ptMode.hasPrecisePolyline():e}computeBeelineFeature(){const t=this.computeBeelineGeoPositions();if(t.length<2)return null;const e=[];t.forEach(T=>{e.push(T.asPosition())});const i={};i[$s.DrawType]="Beeline";const a=this.computeLegLineType();i[$s.LineType]=a;const p=new yh(t);return{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e},bbox:p.asFeatureBBOX()}}computeBeelineGeoPositions(){const t=[];return this.leg.fromLocation.geoPosition&&t.push(this.leg.fromLocation.geoPosition),"TimedLeg"===this.leg.legType&&this.leg.intermediateStopPoints.forEach(i=>{i.location.geoPosition&&t.push(i.location.geoPosition)}),this.leg.toLocation.geoPosition&&t.push(this.leg.toLocation.geoPosition),t}computeLegLineType(){if("ContinousLeg"===this.leg.legType||"TransferLeg"===this.leg.legType){const e=this.leg;return e.isDriveCarLeg()?"Self-Drive Car":e.isSharedMobility()?"Shared Mobility":e.isTaxi()?"OnDemand":"TransferLeg"===this.leg.legType?"Transfer":"car-ferry"===e.legTransportMode?"Water":"Walk"}return"TimedLeg"===this.leg.legType?TA.computeTimedLegColor(this.leg):"Unknown"}computeLinePointFeatures(){const t=[],e=this.computeLegLineType();return this.computeLinePointsData().forEach(r=>{const p=r.feature;null!==p.properties&&(p.properties[$s.PointType]=r.type,p.properties[$s.DrawType]="LegPoint",p.properties[$s.LineType]=e,p.bbox=[p.geometry.coordinates[0],p.geometry.coordinates[1],p.geometry.coordinates[0],p.geometry.coordinates[1]],t.push(p))}),t}computeLinePointsData(){const t=[];return"TransferLeg"===this.leg.legType||([this.leg.fromLocation,this.leg.toLocation].forEach(i=>{var r,a;const p=i.asGeoJSONFeature();if(null!=p&&p.properties){const y=i===this.leg.fromLocation,T=y?"From":"To",P=y?null===(r=this.leg.legTrack)||void 0===r?void 0:r.fromGeoPosition():null===(a=this.leg.legTrack)||void 0===a?void 0:a.toGeoPosition();P&&(p.geometry.coordinates=P.asPosition()),t.push({type:T,feature:p})}}),"TimedLeg"===this.leg.legType&&this.leg.intermediateStopPoints.forEach(r=>{const a=r.location.asGeoJSONFeature();null==a||!a.properties||t.push({type:"Intermediate",feature:a})})),t}computeLegGeoJSONFeatures(){return"ContinousLeg"===this.leg.legType||"TransferLeg"===this.leg.legType?this.computeContinousLegGeoJSONFeatures(this.leg):"TimedLeg"===this.leg.legType?this.computeTimedLegGeoJSONFeatures(this.leg):[]}computeContinousLegGeoJSONFeatures(t){var e,i;const r=[];return null===(e=t.pathGuidance)||void 0===e||e.sections.forEach((a,p)=>{var y,T,P,z,H,J,oe,fe,Ae,We;const ot=null===(T=null===(y=a.trackSection)||void 0===y?void 0:y.linkProjection)||void 0===T?void 0:T.asGeoJSONFeature();null!=ot&&ot.properties&&(ot.properties[$s.DrawType]="LegLine",ot.properties[$s.LineType]="Guidance",ot.properties["PathGuidanceSection.idx"]=p,ot.properties["PathGuidanceSection.TrackSection.RoadName"]=null!==(z=null===(P=a.trackSection)||void 0===P?void 0:P.roadName)&&void 0!==z?z:"",ot.properties["PathGuidanceSection.TrackSection.Duration"]=null!==(J=null===(H=a.trackSection)||void 0===H?void 0:H.duration)&&void 0!==J?J:"",ot.properties["PathGuidanceSection.TrackSection.Length"]=null!==(fe=null===(oe=a.trackSection)||void 0===oe?void 0:oe.length)&&void 0!==fe?fe:"",ot.properties["PathGuidanceSection.GuidanceAdvice"]=null!==(Ae=a.guidanceAdvice)&&void 0!==Ae?Ae:"",ot.properties["PathGuidanceSection.TurnAction"]=null!==(We=a.turnAction)&&void 0!==We?We:"",r.push(ot))}),null===(i=t.legTrack)||void 0===i||i.trackSections.forEach(a=>{var p;const y=null===(p=a.linkProjection)||void 0===p?void 0:p.asGeoJSONFeature();null!=y&&y.properties&&(y.properties[$s.DrawType]="LegLine",y.properties[$s.LineType]=this.computeLegLineType(),r.push(y))}),r}computeTimedLegGeoJSONFeatures(t){var e;let i=[];const r=TA.computeTimedLegColor(t);return!this.useBeeLine&&(null===(e=t.legTrack)||void 0===e||e.trackSections.forEach(p=>{var y;const T=null===(y=p.linkProjection)||void 0===y?void 0:y.asGeoJSONFeature();null!=T&&T.properties&&(T.properties[$s.DrawType]="LegLine",T.properties[$s.LineType]=r,i.push(T))})),i}}let Sh=(()=>{class n{constructor(){this.newMapBoundsRequested=new Cn,this.newMapCenterAndZoomRequested=new Cn,this.initialMapCenter=null,this.initialMapZoom=null}tryToCenterAndZoomToLocation(e,i=16){var r,a;if(null===e)return;const p=null!==(a=null===(r=e.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==a?a:null;null!==p&&this.newMapCenterAndZoomRequested.emit({lnglat:p,zoom:i})}createMap(e){const i=new(da().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),r=new(da().Map)({container:e,style:"mapbox://styles/mapbox/light-v10",bounds:i,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});return this.initialMapCenter?(r.setCenter(this.initialMapCenter),this.initialMapZoom&&r.setZoom(this.initialMapZoom)):r.fitBounds(i,{padding:50,duration:0}),r}zoomToTrip(e){const r=new U7(e).computeBBOX();if(!1===r.isValid())return;const p={bounds:new(da().LngLatBounds)(r.asFeatureBBOX())};this.newMapBoundsRequested.emit(p)}zoomToBounds(e,i){var r,a;const p=i.bounds;if(p.getSouthWest().distanceTo(p.getNorthEast())<20)return void e.jumpTo({center:p.getCenter(),zoom:16});const P=null!==(r=i.padding)&&void 0!==r?r:{left:50,top:170,right:50,bottom:100},z=null!==(a=i.onlyIfOutside)&&void 0!==a&&a,H=e.getBounds();if(z&&H&&wh.areBoundsInsideOtherBounds(p,H))return;const J=[p.getWest(),p.getSouth(),p.getEast(),p.getNorth()];e.fitBounds(J,{padding:P})}zoomToLocation(e,i){e.flyTo({center:i.lnglat,zoom:i.zoom})}addControls(e,i,r,a){const p=new(da().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(p,"bottom-right");const y=new(da().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(y);const T=new bA(e);e.addControl(T,"top-left");const P=new SA(e,i,r,a);e.addControl(P,"top-right")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Ba=(()=>{class n{constructor(e){this.mapService=e,this.publicTransportModesFilter=[],this.embedQueryParams=new URLSearchParams,this.defaultsInited=new Cn,this.searchFormAfterDefaultsInited=new Cn,this.locationsUpdated=new Cn,this.geoLocationsUpdated=new Cn,this.tripsUpdated=new Cn,this.tripFaresUpdated=new Cn,this.activeTripSelected=new Cn,this.tripRequestFinished=new Cn,this.searchParamsReset=new Cn,this.queryParams=new URLSearchParams(document.location.search),this.fromTripLocation=null,this.toTripLocation=null,this.viaTripLocations=[],this.numberOfResults=5,this.numberOfResultsBefore=null,this.numberOfResultsAfter=null,this.publicTransportModesFilter=[],this.isViaEnabled=!1,this.currentBoardingType="Dep",this.tripModeType="monomodal",this.tripTransportMode="public_transport",this.journeyTripRequests=[],this.departureDate=this.computeInitialDate(),this.currentAppStage=lC,this.permalinkRelativeURL=null,this.prodURL=null,this.betaURL=null,this.betaV2URL=null,this.sbbURL=null}initDefaults(e){var i,r,a,p,y;let T=this.queryParams.get("stage");T&&(this.currentAppStage=this.computeAppStageFromString(T));const P={Bern:"8507000",Geneva:"8501008",Gurten:"8507099","St. Gallen":"8506302",Uetliberg:"8503057",Zurich:"8503000",_DemandLegFrom:"46.674360,6.460966",_DemandLegTo:"46.310963,7.977509"},z="Bern",H="Zurich",J=null!==(i=this.queryParams.get("from"))&&void 0!==i?i:P[z],oe=null!==(r=this.queryParams.get("to"))&&void 0!==r?r:P[H],fe=[],Ae=this.getStageConfig();null===Ae.authToken&&(console.error("WARNING: authorization not set for stage="+this.currentAppStage),console.log(Ae));const We=["From","To"];We.forEach(ci=>{const Fi="From"===ci;let Ui=Fi?J:oe;if("OJP-SI"===this.currentAppStage&&(Ui=Fi?z:H),"LA Beta"===this.currentAppStage){const pr=Ui.match(/^[^\|]+?\|(.+?)$/);pr?Ui=pr[1]:console.error("ERROR LA Beta - CANT match stopPlaceRef")}const Lr=Ko.initFromLiteralCoords(Ui);if(Lr){const pr=new Promise(Zs=>{Zs([Lr])});fe.push(pr)}else{let pr=rl.initWithStopPlaceRef(Ae,e,Ui);"string"==typeof Ui&&/^[A-Z]/.test(Ui)&&(pr=rl.initWithLocationName(Ae,e,Ui,[]));const Zs=pr.fetchLocations();fe.push(Zs)}});const ot=new yh([]),tn=null!==(a=this.queryParams.get("via"))&&void 0!==a?a:null;(null===tn?[]:tn.split(";")).forEach(ci=>{const Fi=Ko.initFromLiteralCoords(ci);if(Fi){const Ui=new xl(Fi);this.viaTripLocations.push(Ui),Fi.geoPosition&&ot.extend(Fi.geoPosition)}else{const Lr=rl.initWithStopPlaceRef(Ae,e,ci).fetchLocations();fe.push(Lr)}}),this.tripModeType="monomodal";const un=null!==(p=this.queryParams.get("mode_types"))&&void 0!==p?p:null;null!==un&&(this.tripModeType=un.split(";")[0]),this.tripTransportMode="public_transport";const Zn=null!==(y=this.queryParams.get("transport_modes"))&&void 0!==y?y:null;null!==Zn&&(this.tripTransportMode=Zn.split(";")[0]),this.publicTransportModesFilter=(()=>{var ci;const Fi=[],Ui=null!==(ci=this.queryParams.get("public_transport_modes"))&&void 0!==ci?ci:null;return null===Ui||Ui.split(",").map(pr=>pr.toLowerCase().trim()).forEach(pr=>{"bus"===pr&&Fi.push("bus"),["ship","water"].includes(pr)&&Fi.push("water"),["rail","train"].includes(pr)&&Fi.push("rail")}),Fi})(),Promise.all(fe).then(ci=>{var Fi;We.forEach(Lr=>{const pr="From"===Lr,Zs=pr?ci[0]:ci[1];if(0===Zs.length)return;const Sl=Zs[0];pr?this.fromTripLocation=new xl(Sl):this.toTripLocation=new xl(Sl),Sl.geoPosition&&ot.extend(Sl.geoPosition)});const Ui=null!==(Fi=ci[2])&&void 0!==Fi?Fi:null;if(null!==Ui){this.isViaEnabled=!0;const Lr=Ui[0],pr=new xl(Lr);this.viaTripLocations=[pr],Lr.geoPosition&&ot.extend(Lr.geoPosition)}if(this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.updateURLs(),ot.isValid()&&(this.queryParams.has("from")||this.queryParams.has("to"))&&!this.mapService.initialMapCenter){const Zs={bounds:new(da().LngLatBounds)(ot.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(Zs)}this.defaultsInited.emit()})}refetchEndpointsByName(e){const i=[],r=new Promise((p,y)=>{p(null)}),a=["From","To"];a.forEach(p=>{const P="From"===p?this.fromTripLocation:this.toTripLocation;if(null===P)return void i.push(r);const z=P.location.geoPosition;if(null===z)return void i.push(r);const H=yh.initFromGeoPosition(z,200,200),J=this.getStageConfig(),fe=(()=>{var Ae;if("OJP-SI"===this.currentAppStage){const ot=null!==(Ae=P.location.computeLocationName())&&void 0!==Ae?Ae:"n/a";return rl.initWithLocationName(J,e,ot,[])}return rl.initWithBBOXAndType(J,e,H.southWest.longitude,H.northEast.latitude,H.northEast.longitude,H.southWest.latitude,["stop"],300)})().fetchLocations();i.push(fe)}),Promise.all(i).then(p=>{a.forEach(y=>{const T="From"===y,P=T?p[0]:p[1];if(null===P)return;const z=T?this.fromTripLocation:this.toTripLocation;if(null===z)return void i.push(r);const H=z.location.findClosestLocation(P);null!==H&&(T?this.fromTripLocation=new xl(H.location):this.toTripLocation=new xl(H.location),this.updateURLs(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit())})})}switchEndpoints(){const e=Object.assign({},this.fromTripLocation);this.fromTripLocation=Object.assign({},this.toTripLocation),this.toTripLocation=Object.assign({},e),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updateURLs()}updateVia(){this.isViaEnabled=!this.isViaEnabled,this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updateURLs()}computeAppStageFromString(e){const i=Object.keys(x3.stages),r=i.map(y=>y.toLowerCase()),a=e.trim(),p=r.indexOf(a.toLowerCase());return-1!==p?i[p]:"PROD"}updateTripEndpoint(e,i,r){if("From"===i&&(this.fromTripLocation=e?new xl(e):null),"To"===i&&(this.toTripLocation=e?new xl(e):null),e&&"Via"===i){const a=new xl(e);this.viaTripLocations=[a],this.isViaEnabled=!0}this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updateURLs()}updateViaPoint(e,i){this.viaTripLocations[i].location=e,this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updateURLs()}updateTrips(e){this.massageTrips(e),this.tripsUpdated.emit(e)}selectActiveTrip(e){this.activeTripSelected.emit(e)}updateFares(e){this.tripFaresUpdated.emit(e)}updateURLs(){const e=new URLSearchParams;["From","To"].forEach(P=>{var z,H,J,oe;const fe="From"===P?this.fromTripLocation:this.toTripLocation,Ae=P.toLowerCase(),We=null!==(H=null===(z=null==fe?void 0:fe.location.stopPlace)||void 0===z?void 0:z.stopPlaceRef)&&void 0!==H?H:null;if(We)e.append(Ae,We);else{let ot=null!==(oe=null===(J=null==fe?void 0:fe.location.geoPosition)||void 0===J?void 0:J.asLatLngString(!0))&&void 0!==oe?oe:null;if(ot){const Nt=null==fe?void 0:fe.location.computeLocationName(!1);Nt&&(ot=ot+"("+Nt+")"),e.append(Ae,ot)}}});const r=[];this.viaTripLocations.forEach(P=>{var z,H;const J=P.location;if(J.stopPlace)r.push(J.stopPlace.stopPlaceRef);else{const oe=null!==(H=null===(z=null==J?void 0:J.geoPosition)||void 0===z?void 0:z.asLatLngString(!0))&&void 0!==H?H:null;oe&&r.push(oe)}}),r.length>0&&e.append("via",r.join(";")),"monomodal"!==this.tripModeType&&e.append("mode_types",this.tripModeType),"public_transport"!==this.tripTransportMode&&e.append("transport_modes",this.tripTransportMode),this.publicTransportModesFilter.length>0&&e.append("public_transport_modes",this.publicTransportModesFilter.join(","));const a=new Date;if(Math.abs((a.getTime()-this.departureDate.getTime())/1e3/60)>5){const P=Ps.formatDate(this.departureDate);e.append("trip_datetime",P.substring(0,16))}if(this.currentAppStage!==lC){const P=this.currentAppStage.toLowerCase();e.append("stage",P)}this.permalinkRelativeURL=document.location.pathname.replace("/embed","")+"?"+e.toString(),this.updateLinkedURLs(e);const y=new URLSearchParams;["from","to"].forEach(P=>{const z=e.get(P);null!==z&&y.append(P,z)}),this.embedQueryParams=y}updateLinkedURLs(e){this.prodURL="https://opentdatach.github.io/ojp-demo-app/search?"+e.toString();const i=new URLSearchParams(e);this.betaURL="https://tools.odpch.ch/beta-ojp-demo/search?"+i.toString(),i.set("stage","v2-prod"),this.betaV2URL="https://tools.odpch.ch/ojp-demo-v2/search?"+i.toString();const r=[];["from","to"].forEach(y=>{const T=e.get(y);if(null===T)return;const P=(()=>{var H;const J=y.charAt(0).toUpperCase()+y.slice(1)+" placeholder",fe="from"===y?this.fromTripLocation:this.toTripLocation;return null===fe?J:(null!==(H=fe.location.computeLocationName())&&void 0!==H?H:J)+" (OJP Demo)"})();r.push({value:T,type:"ID",label:P})});const p=new URLSearchParams;p.set("stops",JSON.stringify(r)),p.set("ref","OJP Demo"),this.sbbURL="https://www.sbb.ch/en?"+p.toString()}computeInitialDate(){var e;const i=new Date,r=null!==(e=this.queryParams.get("trip_datetime"))&&void 0!==e?e:null;return null===r?i:new Date(Date.parse(r))}getStageConfig(e=this.currentAppStage){var i;const r=null!==(i=x3.stages[e])&&void 0!==i?i:null;return null===r?(console.error("ERROR - cant find stage"+e+" using PROD"),df):r}updateAppStage(e){this.currentAppStage=e,this.updateURLs()}updateDepartureDateTime(e){this.departureDate=e,this.updateURLs()}updateTripMode(){this.updateURLs()}computeTripLocationsToUpdate(){const e=[];return["From","To"].forEach(r=>{const a="From"===r,p=a?this.fromTripLocation:this.toTripLocation;null!==p&&("mode_at_end"===this.tripModeType&&a||"mode_at_start"===this.tripModeType&&!a||e.push(p))}),e}updateTripLocationRestrictions(e,i,r,a){this.computeTripLocationsToUpdate().forEach(y=>{y.minDuration=e,y.maxDuration=i,y.minDistance=r,y.maxDistance=a})}updateTripLocationCustomMode(){this.computeTripLocationsToUpdate().forEach(i=>{i.customTransportMode="public_transport"===this.tripTransportMode?null:this.tripTransportMode})}updateParamsFromTrip(e){if(!(e.legs.length>0))return;const a=e.legs[e.legs.length-1];this.fromTripLocation=new xl(e.legs[0].fromLocation),this.toTripLocation=new xl(a.toLocation),this.viaTripLocations=[],this.tripModeType="monomodal",this.tripTransportMode="public_transport",this.geoLocationsUpdated.emit(),this.updateURLs()}massageTrips(e){this.sortTrips(e),this.patchTripLegEndpointCoords(e),this.mergeTripLegs(e)}sortTrips(e){var i;if("monomodal"!==this.tripModeType||"public_transport"===this.tripTransportMode)return;const r=null!==(i=e.find(a=>{var p;return null!==(null!==(p=a.legs.find(T=>"ContinousLeg"===T.legType&&a.legs[0].legTransportMode===this.tripTransportMode))&&void 0!==p?p:null)}))&&void 0!==i?i:null;if(r){const a=e.indexOf(r);e.splice(a,1),e.unshift(r),"DEBUG"===Na&&console.log("SDK HACK - sortTrips - trips were re-sorted to promote the index-"+a+" trip first")}}patchTripLegEndpointCoords(e){e.forEach(i=>{i.legs.forEach((r,a)=>{var p,y,T,P;if("TimedLeg"!==r.legType)return;const z=r,H=null!==(y=null===(p=z.legTrack)||void 0===p?void 0:p.fromGeoPosition())&&void 0!==y?y:null;if(a>0&&null!==H){const oe=i.legs[a-1];null===oe.toLocation.geoPosition&&("DEBUG"===Na&&console.log("SDK HACK - patchLegEndpointCoords - use legTrack.fromGeoPosition for prevLeg.toLocation.geoPosition"),oe.toLocation.geoPosition=H)}const J=null!==(P=null===(T=z.legTrack)||void 0===T?void 0:T.toGeoPosition())&&void 0!==P?P:null;if(a<i.legs.length-1&&null!==J){const oe=i.legs[a+1];null===oe.fromLocation.geoPosition&&("DEBUG"===Na&&console.log("SDK HACK - patchLegEndpointCoords - use legTrack.toGeoPosition for nextLeg.fromLocation.geoPosition"),oe.fromLocation.geoPosition=J)}})})}mergeTripLegs(e){e.forEach(i=>{const r=[];let a=-1;i.legs.forEach((p,y)=>{if(y<=a)return;const T=y+1,P=y+2;if(P>=i.legs.length)return void r.push(p);let z=!1;const H=i.legs[T],J=i.legs[P];if("TimedLeg"===p.legType&&"TransferLeg"===H.legType&&"TimedLeg"===J.legType&&"remainInVehicle"===H.transferMode&&(z=!0,a=P),z){const oe=this.mergeTimedLegs(p,J);r.push(oe)}else r.push(p)}),i.legs.length>0&&i.legs.length!==r.length&&("DEBUG"===Na&&console.log("SDK HACK - mergeTripLegs - remainInVehicle usecase, before: "+i.legs.length+", after: "+r.length+" legs"),i.legs=r)})}mergeTimedLegs(e,i){let r=e.intermediateStopPoints.slice();e.toStopPoint.stopPointType="Intermediate",r.push(e.toStopPoint),r=r.concat(i.intermediateStopPoints.slice());const a=new Hy(e.legID,e.service,e.fromStopPoint,i.toStopPoint,r);return null!==e.legDuration&&null!==i.legDuration&&(a.legDuration=e.legDuration.plus(i.legDuration)),null!==e.legTrack&&null!==i.legTrack&&(a.legTrack=e.legTrack.plus(i.legTrack)),a}fetchFares(){var e=this;return ua(function*(){var i;if(0===e.journeyTripRequests.length)return;const r=e.journeyTripRequests[0].response;if(null===r)return;const a=e.getStageConfig("NOVA-INT");if(null!==(i=a.authToken)&&void 0!==i&&i.startsWith("PLACEHOLDER"))return console.error("fetchFares: OJP Service AuthKey not configured"),void console.log(a);const p=new NW(a),y=yield p.fetchResponseForTrips(r.trips);"NovaFares.DONE"===y.message?e.updateFares(y.fareResults):(console.error("NOVA ERROR"),console.log(p.requestInfo))})()}hasPublicTransport(){return"public_transport"===this.tripTransportMode}}return n.\u0275fac=function(e){return new(e||n)(mt(Sh))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Th=(()=>{class n{constructor(){this.language=this.guessLanguage()}guessLanguage(){let i=new URLSearchParams(document.location.search).get("lang");if(null!==i){if(i=i.trim().toLowerCase(),"de"===i)return"de";if("en"===i)return"en";if("fr"===i)return"fr";if("it"===i)return"it"}const r={de:"de","de-DE":"de","de-AT":"de","de-CH":"de",en:"en","en-US":"en","en-GB":"en","en-AU":"en","en-CA":"en",fr:"fr","fr-FR":"fr","fr-CA":"fr","fr-BE":"fr","fr-CH":"fr",it:"it","it-IT":"it","it-CH":"it"},a=navigator.languages?navigator.languages:[navigator.language];for(const p of a){const y=p.split("-")[0];if(r[p])return r[p];if(r[y])return r[y]}return"en"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class H7{constructor(t=!1,e,i=!0,r){this._multiple=t,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new fn,e&&e.length&&(t?e.forEach(a=>this._markSelected(a)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...t){this._verifyValueAssignment(t),t.forEach(i=>this._markSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...t){this._verifyValueAssignment(t),t.forEach(i=>this._unmarkSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...t){this._verifyValueAssignment(t);const e=this.selected,i=new Set(t);t.forEach(a=>this._markSelected(a)),e.filter(a=>!i.has(a)).forEach(a=>this._unmarkSelected(a));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();const e=this._hasQueuedChanges();return t&&this._emitChangeEvent(),e}isSelected(t){if(this.compareWith){for(const e of this._selection)if(this.compareWith(e,t))return!0;return!1}return this._selection.has(t)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}}let DA=(()=>{class n{constructor(){this._listeners=[]}notify(e,i){for(let r of this._listeners)r(e,i)}listen(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(i=>e!==i)}}ngOnDestroy(){this._listeners=[]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),G7=0;const EA=new Qt("CdkAccordion");let q7=(()=>{class n{constructor(){this._stateChanges=new fn,this._openCloseAllActions=new fn,this.id="cdk-accordion-"+G7++,this._multi=!1}get multi(){return this._multi}set multi(e){this._multi=Si(e)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(e){this._stateChanges.next(e)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[wi([{provide:EA,useExisting:n}]),xo]}),n})(),$7=0,W7=(()=>{class n{constructor(e,i,r){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=r,this._openCloseAllSubscription=Qe.EMPTY,this.closed=new Cn,this.opened=new Cn,this.destroyed=new Cn,this.expandedChange=new Cn,this.id="cdk-accordion-child-"+$7++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((a,p)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===p&&this.id!==a&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(e){e=Si(e),this._expanded!==e&&(this._expanded=e,this.expandedChange.emit(e),e?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){this._disabled=Si(e)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}}return n.\u0275fac=function(e){return new(e||n)(le(EA,12),le(lo),le(DA))},n.\u0275dir=cn({type:n,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[wi([{provide:EA,useValue:void 0}])]}),n})(),X7=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({}),n})();const Z7=["body"];function Y7(n,t){}const K7=[[["sbb-expansion-panel-header"]],"*"],J7=["sbb-expansion-panel-header","*"];function Q7(n,t){1&n&&dn(0,"sbb-icon",5),2&n&&Ve("@indicatorRotate",Ot(2)._getExpandedState())}function e9(n,t){1&n&&dn(0,"sbb-icon",9)}function t9(n,t){1&n&&dn(0,"sbb-icon",10)}function n9(n,t){1&n&&(Uo(0,6),Ct(1,e9,1,0,"sbb-icon",7),Ct(2,t9,1,0,"sbb-icon",8),Zo()),2&n&&(Ve("ngSwitch",Ot(2)._isExpanded()),_e(1),Ve("ngSwitchCase",!1),_e(1),Ve("ngSwitchCase",!0))}function i9(n,t){1&n&&(ae(0,"span",2),gy(1,"async"),Ct(2,Q7,1,1,"sbb-icon",3),Ct(3,n9,3,3,"ng-container",4),de()),2&n&&(Ve("ngSwitch",_y(1,3,Ot().panel.variant)),_e(2),Ve("ngSwitchCase","lean"),_e(1),Ve("ngSwitchCase","standard"))}const r9=["*"],IA=new Qt("SBB_ACCORDION"),$3="225ms cubic-bezier(0.4,0.0,0.2,1)",W3={indicatorRotate:ya("indicatorRotate",[oo("collapsed, void",mi({transform:"rotate(90deg)"})),oo("expanded",mi({transform:"rotate(-90deg)"})),kr("expanded <=> collapsed, void => collapsed",zr($3))]),bodyExpansion:ya("bodyExpansion",[oo("collapsed, void",mi({height:"0px",visibility:"hidden"})),oo("expanded",mi({height:"*",visibility:"visible"})),kr("expanded <=> collapsed, void => collapsed",zr($3))])},X3=new Qt("SBB_EXPANSION_PANEL");let o9=(()=>{class n{constructor(e,i){this._template=e,this._expansionPanel=i}}return n.\u0275fac=function(e){return new(e||n)(le(Yo),le(X3,8))},n.\u0275dir=cn({type:n,selectors:[["ng-template","sbbExpansionPanelContent",""]]}),n})();const s9=I_(W7);let a9=0,ff=(()=>{class n extends s9{constructor(e,i,r,a,p){super(i,r,a),this._viewContainerRef=e,this._hideToggle=!1,this.afterExpand=new Cn,this.afterCollapse=new Cn,this._inputChanges=new fn,this._headerId="sbb-expansion-panel-header-"+a9++,this._bodyAnimationDone=new fn,this.accordion=i,this._document=p,this._bodyAnimationDone.pipe(Am((y,T)=>y.fromState===T.fromState&&y.toState===T.toState)).subscribe(y=>{"void"!==y.fromState&&("expanded"===y.toState?this.afterExpand.emit():"collapsed"===y.toState&&this.afterCollapse.emit())})}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=Si(e)}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(va(null),go(()=>this.expanded&&!this._portal),ko(1)).subscribe(()=>{this._portal=new D_(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}}return n.\u0275fac=function(e){return new(e||n)(le(Rs),le(IA,12),le(lo),le(DA),le(Mi))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-expansion-panel"]],contentQueries:function(e,i,r){if(1&e&&Ro(r,o9,5),2&e){let a;_i(a=bi())&&(i._lazyContent=a.first)}},viewQuery:function(e,i){if(1&e&&io(Z7,5),2&e){let r;_i(r=bi())&&(i._body=r.first)}},hostAttrs:[1,"sbb-expansion-panel"],hostVars:2,hostBindings:function(e,i){2&e&&l("sbb-expanded",i.expanded)},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["sbbExpansionPanel"],features:[wi([{provide:IA,useValue:void 0},{provide:X3,useExisting:n}]),zn,xo],ngContentSelectors:J7,decls:6,vars:4,consts:[["role","region",1,"sbb-expansion-panel-content",3,"id"],["body",""],[1,"sbb-expansion-panel-body","sbb-expansion-panel-horizontal-padding"],[3,"cdkPortalOutlet"]],template:function(e,i){1&e&&(ss(K7),Yr(0),ae(1,"div",0,1),Zt("@bodyExpansion.done",function(a){return i._bodyAnimationDone.next(a)}),ae(3,"div",2),Yr(4,1),Ct(5,Y7,0,0,"ng-template",3),de()()),2&e&&(_e(1),Ve("@bodyExpansion",i._getExpandedState())("id",i.id),Yn("aria-labelledby",i._headerId),_e(4),Ve("cdkPortalOutlet",i._portal))},dependencies:[bh],styles:['.sbb-expansion-panel{box-sizing:content-box;display:block;margin:0;transition:border-color var(--sbb-transition-fast-start);border:var(--sbb-border-width-thin) solid var(--sbb-color-milk)}.sbb-expansion-panel+.sbb-expansion-panel{margin-top:calc(var(--sbb-border-width-thin)*2)}.sbb-expansion-panel.sbb-expanded{border-color:var(--sbb-color-cloud)}.sbb-expansion-panel.sbb-expanded.sbb-expansion-panel-full-width{border-left-color:rgba(0,0,0,0);border-right-color:rgba(0,0,0,0);border-left-width:0;border-right-width:0;padding-left:var(--sbb-border-width-thin);padding-right:var(--sbb-border-width-thin)}.sbb-expansion-panel-horizontal-padding{padding-left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));padding-right:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin))}.sbb-expansion-panel-header{cursor:pointer;display:flex;align-items:center;position:relative;background-color:var(--sbb-color-milk);outline:none;padding-top:var(--sbb-expansion-panel-header-padding-top);padding-bottom:var(--sbb-expansion-panel-header-padding-bottom)}:where(html.sbb-lean) .sbb-expansion-panel-header{padding-bottom:calc(0.8rem - var(--sbb-border-width-thin))}.sbb-expansion-panel-header.sbb-expanded::after{content:"";display:block;position:absolute;height:0;bottom:0;width:calc(100% - var(--sbb-expansion-panel-padding-horizontal)*2 + var(--sbb-border-width-thin)*2);left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-cloud)}.sbb-expansion-panel-header:is(.sbb-expanded,.sbb-expanded:is(:focus,:hover)){background:inherit}.sbb-expansion-panel-header.sbb-disabled{cursor:default;opacity:.75}.sbb-expansion-panel-header-indicator{flex:0 0 auto;line-height:0;height:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);margin-left:1.6rem;color:var(--sbb-color-black);margin-top:-0.5em;margin-bottom:-0.5em}:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%;padding:calc(0.2666666667rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin))}@media all and (min-width: 40.1875em)and (max-width: 64.0525em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.6666666667rem}}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{height:calc(2.1333333333rem * var(--sbb-scaling-factor));width:calc(2.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.4rem}}@media all and (min-width: 240.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.9333333333rem}}.sbb-expansion-panel-header-content{display:flex;flex:1;overflow:hidden;font-family:var(--sbb-font-light);font-size:var(--sbb-font-size-large);line-height:var(--sbb-expansion-panel-line-height)}.sbb-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.sbb-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.sbb-expansion-panel-content.ng-animating,.sbb-expansion-panel:not(.sbb-expanded) .sbb-expansion-panel-content{overflow:hidden}.sbb-expansion-panel-body{font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:var(--sbb-divider-medium);padding-bottom:var(--sbb-divider-medium)}.sbb-expansion-panel-body>*:first-child{margin-top:0}'],encapsulation:2,data:{animation:[W3.bodyExpansion]},changeDetection:0}),n})();const c9=jy(class l9{});let Wx=(()=>{class n extends c9{constructor(e,i,r,a,p,y){super(),this.panel=e,this._element=i,this._focusMonitor=r,this._changeDetectorRef=a,this._document=p,this._parentChangeSubscription=Qe.EMPTY;const T=e.accordion?e.accordion._stateChanges.pipe(go(P=>!!P.hideToggle)):uo;this.tabIndex=parseInt(y||"",10)||0,this._parentChangeSubscription=yo(e.opened,e.closed,T,e._inputChanges.pipe(go(P=>!(!P.hideToggle&&!P.disabled)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe(go(()=>e._containsFocus())).subscribe(()=>r.focusVia(i,"program"))}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_keydown(e){switch(e.keyCode){case 32:case 13:!nl(e)&&this._isFocused()&&(e.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e))}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}_isFocused(){var e;return(null===(e=this._document)||void 0===e?void 0:e.activeElement)===this._element.nativeElement}}return n.\u0275fac=function(e){return new(e||n)(le(ff,1),le(ei),le(yl),le(lo),le(Mi),us("tabindex"))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-expansion-panel-header"]],hostAttrs:["role","button",1,"sbb-expansion-panel-header","sbb-expansion-panel-horizontal-padding"],hostVars:9,hostBindings:function(e,i){1&e&&Zt("click",function(){return i._toggle()})("keydown",function(a){return i._keydown(a)}),2&e&&(Yn("id",i.panel._headerId)("tabindex",i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.disabled),l("sbb-expanded",i._isExpanded())("sbb-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},features:[zn],ngContentSelectors:r9,decls:3,vars:1,consts:[[1,"sbb-expansion-panel-header-content"],["class","sbb-expansion-panel-header-indicator sbb-icon-fit",3,"ngSwitch",4,"ngIf"],[1,"sbb-expansion-panel-header-indicator","sbb-icon-fit",3,"ngSwitch"],["svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchCase"],["svgIcon","kom:chevron-right-small"],[3,"ngSwitch"],["svgIcon","kom:plus-small",4,"ngSwitchCase"],["svgIcon","kom:minus-small",4,"ngSwitchCase"],["svgIcon","kom:plus-small"],["svgIcon","kom:minus-small"]],template:function(e,i){1&e&&(ss(),ae(0,"span",0),Yr(1),de(),Ct(2,i9,4,5,"span",1)),2&e&&(_e(2),Ve("ngIf",i._showToggle()))},dependencies:[Go,wy,AS,vl,ix],encapsulation:2,data:{animation:[W3.indicatorRotate]},changeDetection:0}),n})(),fC=(()=>{class n extends q7{constructor(){super(...arguments),this._ownHeaders=new r_,this._hideToggle=!1}get hideToggle(){return this._hideToggle}set hideToggle(e){this._hideToggle=Si(e)}ngAfterContentInit(){this._headers.changes.pipe(va(this._headers)).subscribe(e=>{this._ownHeaders.reset(e.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new VM(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(e){this._keyManager.onKeydown(e)}_handleHeaderFocus(e){this._keyManager.updateActiveItem(e)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["sbb-accordion"]],contentQueries:function(e,i,r){if(1&e&&Ro(r,Wx,5),2&e){let a;_i(a=bi())&&(i._headers=a)}},hostAttrs:[1,"sbb-accordion"],inputs:{hideToggle:"hideToggle"},exportAs:["sbbAccordion"],features:[wi([{provide:IA,useExisting:n}]),zn]}),n})(),Z3=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,X7,il,Pr,cs]}),n})();const Y3={ContinousLeg:"#009933",TransferLeg:"#0000ff",TimedLeg:"#D04D44"},u9=["ContinousLeg","TimedLeg","TransferLeg"],Fm={Unknown:"#ffafcc",LongDistanceRail:"#D04D44",SBahn:"#0d6efd",Bus:"#0d6efd",PostAuto:"#EBBE24",OnDemand:"#D77D00",Aerial:"#8B4513",Funicular:"#006400",Walk:"#009933","Self-Drive Car":"#ff004f","Shared Mobility":"#32CD32",Guidance:"#6f0000",Transfer:"#088F8F",Water:"#005AB3"},d9=["LongDistanceRail","SBahn","Bus","PostAuto","OnDemand","Aerial","Walk","Guidance","Transfer","Self-Drive Car","Shared Mobility","Water"];class Ws{static computeIconFilenameForService(t){return Ws.computePublicTransportPictogram(t.ptMode)}static computePublicTransportPictogram(t){return"bus"===t.ptMode?"picto-bus":"ATZ"===t.shortName?"autozug":t.isRail()?"picto-railway":"tram"===t.ptMode?"picto-tram":"CC"===t.shortName?"picto-rack-railway":"FUN"===t.shortName?"picto-funicular":"PB"===t.shortName?"picto-cablecar":"GB"===t.shortName?"picto-gondola":"SL"===t.shortName?"picto-chairlift":"water"===t.ptMode?"picto-boat":t.isDemandMode?"car-sharing":"picto-bus-fallback"}static computeIconFilenameForLeg(t){if("TransferLeg"===t.legType)return"picto-walk";if("TimedLeg"===t.legType)return Ws.computeIconFilenameForService(t.service);if("ContinousLeg"===t.legType){const e=t;return e.isDriveCarLeg()?"car-sharing":e.isSharedMobility()?"velo-scooter-sharing":e.isTaxi()?"taxi":"car-shuttle-train"===e.legTransportMode?"autozug":"car-ferry"===e.legTransportMode?"ferry":"picto-walk"}return"picto-bus-fallback"}static updateLocationDataWithTime(t,e,i=!1){["Arr","Dep"].forEach(a=>{const p="Arr"===a,y=p?e.arrivalData:e.departureData;if(null===y)return;const T=Ps.formatTimeHHMM(y.timetableTime);p?t.arrText=T:t.depText=T;const P=Ws.computeStopPointDelayText(a,e);null!==P&&(p?t.arrDelayText=P:t.depDelayText=P)}),t.platformText=e.plannedPlatform,t.actualPlatformText=e.actualPlatform,null!==t.actualPlatformText&&t.platformText===t.actualPlatformText&&(t.actualPlatformText=null),t.geoPosition=e.location.geoPosition,t.isNotServicedStop=!0===e.isNotServicedStop}static computeStopPointDelayText(t,e){const r="Arr"===t?e.arrivalData:e.departureData;if(null===r||null===r.estimatedTime)return null;const a=(r.estimatedTime.getTime()-r.timetableTime.getTime())/1e3;if(Math.abs(a)<.1)return null;const p=[];p.push(" "),p.push(a>0?"+":"-");const y=Math.abs(a);if("DEBUG"===Na){const P=Math.floor(y/60);P&&(p.push(""+P),p.push("'")),p.push(""+(y-60*P)),p.push('"')}else{const P=r.delayMinutes;if(0===P)return null;p.push(""+P),p.push("'")}return p.join("")}static computeSituationsData(t){const e=[];return t.forEach(i=>{null!==i.situationContent&&e.push(i.situationContent),i.publishingActions.forEach(r=>{const a=r.passengerInformation.mapTextualContent,p={};p.summary="Summary"in a?a.Summary.join(". "):"Summary n/a",p.descriptions=[],"Description"in a&&(p.descriptions=a.Description),p.details=[],["Consequence","Duration","Reason","Recommendation","Remark"].forEach(T=>{T in a&&(p.details=p.details.concat(a[T]))}),e.push(p)})}),e}static fetchGist(t){return ua(function*(){const e=t.match(/https:\/\/gist.github.com\/[^\/]+?\/([0-9a-z]*)/);null!==e&&(t=e[1]);const i="https://api.github.com/gists/"+t,a=(yield(yield fetch(i)).json()).files;for(const p in a){const y=a[p];if("XML"!==y.language)continue;let T=y.content;if(!0===y.truncated){const P=y.raw_url;console.log("GIST response truncated, fetching content from raw_url: "+P),T=yield(yield fetch(P)).text()}return T}return null})()}static formatServiceName(t){var e,i,r;const a=[];return t.serviceLineNumber?(t.ptMode.isRail()||a.push(null!==(e=t.ptMode.shortName)&&void 0!==e?e:t.ptMode.ptMode),a.push(t.serviceLineNumber),a.push(null!==(i=t.journeyNumber)&&void 0!==i?i:"")):a.push(null!==(r=t.ptMode.shortName)&&void 0!==r?r:t.ptMode.ptMode),a.push("("+t.agencyID+")"),a.join(" ")}static computePlatformAssistanceIconPath(t){const e="PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===t.vehicleAccessType?"platform_independent":"PLATFORM_ACCESS_WITH_ASSISTANCE"===t.vehicleAccessType?"platform_help_driver":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===t.vehicleAccessType?"platform_advance_notice":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===t.vehicleAccessType?"platform_not_possible":"NO_DATA"===t.vehicleAccessType?"platform_no_information":"ALTERNATIVE_TRANSPORT"===t.vehicleAccessType?"platform_alternative_transport":null;return null===e?null:"assets/platform-assistance/"+e+".jpg"}static computePlatformAssistanceTooltip(t){return"PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===t.vehicleAccessType?"Step-free access; level entry/exit.":"PLATFORM_ACCESS_WITH_ASSISTANCE"===t.vehicleAccessType?"Step-free access; entry/exit through staff assistance, no prior registration necessary.":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===t.vehicleAccessType?"Step-free access; entry/exit through staff assistance, advance registration required.":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===t.vehicleAccessType?"Not usable for wheelchairs.":"ALTERNATIVE_TRANSPORT"===t.vehicleAccessType?"By shuttle from/to the accessible stop, register in advance.":"No available information about vehicle access."}}let mC=(()=>{class n{constructor(){this.tripInfoResultUpdated=new Cn,this.locationSelected=new Cn}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const h9=["tooltip"];function p9(n,t){1&n&&ys(0)}function f9(n,t){if(1&n&&(Uo(0),Ct(1,p9,1,0,"ng-container",7),Zo()),2&n){const e=t.ngIf;_e(1),Ve("ngTemplateOutlet",e)}}function m9(n,t){1&n&&W(0),2&n&&ce(Ot().message)}function g9(n,t){if(1&n){const e=Zr();ae(0,"button",8),Zt("click",function(){return di(e),oi(Ot().hide(0))}),dn(1,"sbb-icon",9),de()}}function _9(n,t){1&n&&Yr(0)}const b9=["*"],MA="tooltip-panel",K3=Im({passive:!0}),J3=new Qt("sbb-tooltip-scroll-strategy"),w9={provide:J3,deps:[Ls],useFactory:function x9(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},S9=new Qt("sbb-tooltip-default-options",{providedIn:"root",factory:function T9(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500,autoFocus:!0,restoreFocus:!0}}});class Q3{constructor(t){this.instance=t}}let C9=(()=>{class n{constructor(e,i,r,a,p,y,T,P,z,H,J){this._overlay=e,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=a,this._ngZone=p,this._platform=y,this._ariaDescriber=T,this._focusMonitor=P,this._defaultOptions=H,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="sbb",this.trigger="hover",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this.tooltipPanelClass="",this._passiveListeners=[],this._destroyed=new fn,this.opened=new Cn,this.dismissed=new Cn,this._scrollStrategy=z,this._document=J,null!=H&&H.touchGestures&&(this.touchGestures=H.touchGestures)}get disabled(){return this._disabled}set disabled(e){this._disabled=Si(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=af(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=af(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){"string"==typeof this._message&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=e instanceof Yo?e:null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),"string"==typeof this._message&&this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this._message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_preventClickBubbling(e){!this.disabled&&"click"===this.trigger&&e.stopPropagation()}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(go(()=>"hover"===this.trigger),br(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{e.removeEventListener(i,r,K3)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),"string"==typeof this._message&&this._ariaDescriber.removeDescription(e,this._message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay){var i,r;if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const a=this._createOverlay();this._detach(),this._portal=this._portal||new _h(this._tooltipComponent,this._viewContainerRef),this._tooltipInstance=a.attach(this._portal).instance,this._tooltipInstance._triggerElement=this._elementRef.nativeElement,this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay,this.message instanceof Yo&&this._ariaDescriber.describe(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._tooltipInstance.afterShown().pipe(br(this._destroyed)).subscribe(()=>this.opened.emit(new Q3(this))),this._tooltipInstance.afterHidden().pipe(br(this._destroyed)).subscribe(()=>{this.dismissed.emit(new Q3(this)),this._detach()}),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),"click"===this.trigger?(this._tooltipInstance._config={autoFocus:null===(i=this._defaultOptions.autoFocus)||void 0===i||i,restoreFocus:null===(r=this._defaultOptions.restoreFocus)||void 0===r||r},this._tooltipInstance._initializeWithAttachedContent(),this._tooltipInstance._triggeredByClick=!0):(this._tooltipInstance._config=void 0,this._tooltipInstance._triggeredByClick=!1),this._tooltipInstance.show(e)}hide(e=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(e)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){var e;if(this._overlayRef)return this._overlayRef;const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=`${this._cssClassPrefix}-${MA}-`,a=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i).withPositions([{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:2},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top",offsetX:5,offsetY:2,panelClass:`${r}left`},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetX:-5,offsetY:2,panelClass:`${r}right`},{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-2},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",offsetX:5,offsetY:-2,panelClass:`${r}left`},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetX:-5,offsetY:-2,panelClass:`${r}right`}]);return a.positionChanges.pipe(br(this._destroyed)).subscribe(p=>{this._updateCurrentPositionClass(p.connectionPair),this._tooltipInstance&&p.scrollableViewProperties.isOriginOutsideView&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({positionStrategy:a,panelClass:FM(this.tooltipPanelClass).concat(`${this._cssClassPrefix}-${MA}`),scrollStrategy:this._scrollStrategy()}),this._overlayRef.detachments().pipe(br(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.keydownEvents().pipe(br(this._destroyed)).subscribe(p=>{this._isTooltipVisible()&&27===p.keyCode&&!nl(p)&&(p.preventDefault(),p.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._overlayRef.outsidePointerEvents().pipe(br(this._destroyed)).subscribe(()=>{var p;return null===(p=this._tooltipInstance)||void 0===p?void 0:p._handleBodyInteraction()}),!(null===(e=this._defaultOptions)||void 0===e)&&e.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&(this.message instanceof Yo&&this._tooltipInstance&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._overlayRef.detach()),this._tooltipInstance=null}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(ko(1),br(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_updateCurrentPositionClass(e){const{overlayY:i,originX:r,originY:a}=e;let p;if(p="center"===i?"start"===r?"left":"right":"bottom"===i&&"top"===a?"above":"below",p!==this._currentPosition){const y=this._overlayRef;if(y){const T=`${this._cssClassPrefix}-${MA}-`;y.removePanelClass(T+this._currentPosition),y.addPanelClass(T+p)}this._currentPosition=p}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||("click"===this.trigger?this._passiveListeners.push(["click",()=>this.show(0)]):this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{var r;const a=i.relatedTarget;(!a||null===(r=this._overlayRef)||void 0===r||!r.overlayElement.contains(a))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,K3)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(e.clientX,e.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const i=this._elementRef.nativeElement,r=i.style;("on"===e||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===e||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(e){Cc()},n.\u0275dir=cn({type:n,hostBindings:function(e,i){1&e&&Zt("click",function(a){return i._preventClickBubbling(a)})},inputs:{trigger:["sbbTooltipTrigger","trigger"],disabled:["sbbTooltipDisabled","disabled"],showDelay:["sbbTooltipShowDelay","showDelay"],hideDelay:["sbbTooltipHideDelay","hideDelay"],touchGestures:["sbbTooltipTouchGestures","touchGestures"],message:["sbbTooltip","message"],tooltipClass:["sbbTooltipClass","tooltipClass"],tooltipPanelClass:["sbbTooltipPanelClass","tooltipPanelClass"]},outputs:{opened:"opened",dismissed:"dismissed"}}),n})(),gC=(()=>{class n extends C9{constructor(e,i,r,a,p,y,T,P,z,H,J){super(e,i,r,a,p,y,T,P,z,H,J),this._tooltipComponent=E9}}return n.\u0275fac=function(e){return new(e||n)(le(Ls),le(ei),le(YF),le(Rs),le(Oi),le(la),le(PF),le(yl),le(J3),le(S9,8),le(Mi))},n.\u0275dir=cn({type:n,selectors:[["","sbbTooltip",""]],hostVars:3,hostBindings:function(e,i){2&e&&(Yn("aria-expanded","click"===i.trigger?i._isTooltipVisible():null),l("sbb-tooltip-trigger","click"===i.trigger))},exportAs:["sbbTooltip"],features:[zn]}),n})(),D9=(()=>{class n{constructor(e,i,r,a,p,y){this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=r,this._focusMonitor=a,this._visibility="initial",this._closeInteractionType=null,this._config={},this._closeOnInteraction=!1,this._elementFocusedBeforeDialogWasOpened=null,this._isVisible=!1,this._onShow=new fn,this._onHide=new fn,this._triggeredByClick=!1,this._animationsDisabled="NoopAnimations"===y,this._document=p}show(e){clearTimeout(this._hideTimeoutId),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._showTimeoutId=void 0,this._toggleVisibility(!0)},e)}hide(e){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0,this._markForCheck()},e)}afterShown(){return this._onShow}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onShow.complete(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){!this._triggeredByClick&&(!e||!this._triggerElement.contains(e))&&this.hide(this._mouseLeaveHideDelay)}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next(),e&&this.isVisible()&&this._config&&this._trapFocus(),!e&&!this.isVisible()&&this._restoreFocus()}_toggleVisibility(e){const i=this._tooltip.nativeElement,r=this._showAnimation,a=this._hideAnimation;if(i.classList.remove(e?a:r),i.classList.add(e?r:a),this._isVisible=e,e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const p=getComputedStyle(i);("0s"===p.getPropertyValue("animation-duration")||"none"===p.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow.next(),this._animationsDisabled&&(i.classList.add("_sbb-animation-noopable"),this._finalizeAnimation(e))}_trapFocus(){var e;null!==(e=this._config)&&void 0!==e&&e.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){var e;const i=this._elementFocusedBeforeDialogWasOpened;if((null===(e=this._config)||void 0===e?void 0:e.restoreFocus)&&i&&"function"==typeof i.focus){const r=ad(),a=this._elementRef.nativeElement;(!r||r===this._document.body||r===a||a.contains(r))&&(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null)}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=ad())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=ad();return e===i||e.contains(i)}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(VF),le(lo),le(yl),le(Mi,8),le(ch,8))},n.\u0275dir=cn({type:n}),n})(),E9=(()=>{class n extends D9{constructor(e,i,r,a,p,y,T){super(e,i,r,a,p,T),this._breakpointObserver=y,this._isHandset=this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait), (max-width: 1024.99px) and (orientation: landscape)"),this._showAnimation="sbb-tooltip-container-show",this._hideAnimation="sbb-tooltip-container-hide"}get _templateRef(){return this.message instanceof Yo?this.message:null}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(VF),le(lo),le(yl),le(Mi,8),le(NM),le(ch,8))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-tooltip-component"]],viewQuery:function(e,i){if(1&e&&io(h9,7),2&e){let r;_i(r=bi())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true",1,"sbb-tooltip-component"],hostVars:2,hostBindings:function(e,i){1&e&&Zt("mouseleave",function(a){return i._handleMouseLeave(a)}),2&e&&o("zoom",i.isVisible()?1:null)},features:[zn],decls:9,vars:10,consts:[[1,"sbb-tooltip-container",3,"animationend"],["tooltip",""],[1,"sbb-tooltip",3,"ngClass"],[1,"sbb-tooltip-content"],[4,"ngIf","ngIfElse"],["stringMessage",""],["type","button","class","sbb-tooltip-icon sbb-tooltip-close-button sbb-icon-fit sbb-button-reset-frameless",3,"click",4,"ngIf"],[4,"ngTemplateOutlet"],["type","button",1,"sbb-tooltip-icon","sbb-tooltip-close-button","sbb-icon-fit","sbb-button-reset-frameless",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){if(1&e&&(ae(0,"div",0,1),Zt("animationend",function(a){return i._handleAnimationEnd(a)}),gy(2,"async"),ae(3,"div",2)(4,"div",3),Ct(5,f9,2,1,"ng-container",4),Ct(6,m9,1,1,"ng-template",null,5,qp),de(),Ct(8,g9,2,0,"button",6),de()()),2&e){const r=Oa(7);let a;l("sbb-tooltip-handset",null==(a=_y(2,8,i._isHandset))?null:a.matches),_e(3),l("sbb-tooltip-has-close-button",i._triggeredByClick),Ve("ngClass",i.tooltipClass),_e(2),Ve("ngIf",i._templateRef)("ngIfElse",r),_e(3),Ve("ngIf",i._triggeredByClick)}},dependencies:[bm,Go,nx,vl,ix],styles:['.sbb-tooltip-component{display:block;filter:drop-shadow(0 var(--sbb-box-shadow-width) 0 var(--sbb-box-shadow-color))}.sbb-tooltip-container{height:100%;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);opacity:0}.sbb-tooltip-container._sbb-animation-noopable{animation:none;opacity:1}.sbb-tooltip-container::after,.sbb-tooltip-container::before{top:calc(.5*var(--sbb-border-width));left:0;right:0;margin-left:auto;margin-right:auto;content:"";height:var(--sbb-tooltip-content-arrow-size);width:var(--sbb-tooltip-content-arrow-size);position:absolute;pointer-events:none;transform:rotate(45deg);border:var(--sbb-border-width) solid rgba(0,0,0,0)}.sbb-tooltip-panel-above .sbb-tooltip-container::after,.sbb-tooltip-panel-above .sbb-tooltip-container::before{top:auto;bottom:calc(.5*var(--sbb-tooltip-shadow-arrow-size));transform:rotate(225deg)}.sbb-tooltip-panel-left .sbb-tooltip-container::after,.sbb-tooltip-panel-left .sbb-tooltip-container::before{margin-right:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-panel-right .sbb-tooltip-container::after,.sbb-tooltip-panel-right .sbb-tooltip-container::before{margin-left:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-container::before{border-color:var(--sbb-color-weak-accent);z-index:1}.sbb-tooltip-container::after{background-color:var(--sbb-tooltip-background-color);background-clip:padding-box;z-index:2;--sbb-tooltip-arrow-padding-offset: 0rem;clip-path:polygon(0 0, calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)) 0, 0 calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)))}html.sbb-lean .sbb-tooltip-container::after{--sbb-tooltip-arrow-padding-offset: 0.0666666667rem}.sbb-tooltip-panel-above .sbb-tooltip-container{margin-bottom:calc(0.8rem * var(--sbb-scaling-factor))}@keyframes sbb-tooltip-container-show{0%{opacity:0}100%{opacity:1}}@keyframes sbb-tooltip-container-hide{0%{opacity:1}100%{opacity:0}}.sbb-tooltip-container-show{animation:sbb-tooltip-container-show var(--sbb-transition-duration-fast) cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip-container-hide{animation:sbb-tooltip-container-hide 75ms cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip{max-width:calc(30.6666666667rem * var(--sbb-scaling-factor));padding:var(--sbb-tooltip-padding);position:relative;overflow:hidden;color:var(--sbb-color-granite);text-overflow:ellipsis;background-color:var(--sbb-tooltip-background-color);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);z-index:2}.cdk-high-contrast-active .sbb-tooltip{outline:solid 1px}.sbb-tooltip-panel-below .sbb-tooltip{margin-top:var(--sbb-tooltip-arrow-offset)}:where(html.sbb-lean) .sbb-tooltip{color:var(--sbb-color-text)}.sbb-tooltip-zero-padding{--sbb-tooltip-padding: 0}.sbb-tooltip-has-close-button{padding-right:calc(4.7333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tooltip-has-close-button{padding-right:3.2rem}.sbb-tooltip-zero-padding .sbb-tooltip-has-close-button{padding-right:0}.sbb-tooltip-close-button{color:var(--sbb-color-weak-accent);position:absolute;width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);top:var(--sbb-tooltip-padding);right:var(--sbb-tooltip-padding);line-height:0}:where(html:not(.sbb-lean)) .sbb-tooltip-close-button{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%}.sbb-tooltip-panel-non-interactive{pointer-events:none}'],encapsulation:2,changeDetection:0}),n})();const I9=Ul(class{});let M9=1,eN=(()=>{class n extends I9{constructor(){super(...arguments),this.id="sbb-tooltip-id-"+M9++,this.trigger="click",this._destroyed=new fn,this.svgIcon="kom:circle-question-mark-small",this.opened=new Cn,this.dismissed=new Cn}get hoverShowDelay(){return this._hoverShowDelay}set hoverShowDelay(e){this._hoverShowDelay=af(e,0)}get hoverHideDelay(){return this._hoverHideDelay}set hoverHideDelay(e){this._hoverHideDelay=af(e,0)}ngOnInit(){this._tooltip.opened.pipe(br(this._destroyed)).subscribe(e=>this.opened.emit(e)),this._tooltip.dismissed.pipe(br(this._destroyed)).subscribe(e=>this.dismissed.emit(e))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}show(){this._tooltip.show(0)}hide(){this._tooltip.hide(0)}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wr(n)))(i||n)}}(),n.\u0275cmp=Ut({type:n,selectors:[["sbb-tooltip"]],viewQuery:function(e,i){if(1&e&&io(gC,7),2&e){let r;_i(r=bi())&&(i._tooltip=r.first)}},hostAttrs:[1,"sbb-tooltip-wrapper"],hostVars:2,hostBindings:function(e,i){2&e&&Yn("id",i.id)("aria-expanded",i._tooltip._isTooltipVisible())},inputs:{disabled:"disabled",id:"id",trigger:"trigger",hoverShowDelay:"hoverShowDelay",hoverHideDelay:"hoverHideDelay",svgIcon:"svgIcon",sbbTooltipClass:"sbbTooltipClass",sbbTooltipPanelClass:"sbbTooltipPanelClass"},outputs:{opened:"opened",dismissed:"dismissed"},features:[zn],ngContentSelectors:b9,decls:5,vars:9,consts:[["type","button",1,"sbb-tooltip-icon","sbb-tooltip-trigger","sbb-icon-scaled","sbb-button-reset-frameless",3,"sbbTooltip","sbbTooltipTrigger","sbbTooltipShowDelay","sbbTooltipHideDelay","sbbTooltipClass","sbbTooltipPanelClass","click"],["tooltip","sbbTooltip"],[3,"svgIcon"],["tooltipTemplate",""]],template:function(e,i){if(1&e){const r=Zr();ss(),ae(0,"button",0,1),Zt("click",function(){return di(r),oi(Oa(1).show(0))}),dn(2,"sbb-icon",2),de(),Ct(3,_9,1,0,"ng-template",null,3,qp)}if(2&e){const r=Oa(1),a=Oa(4);l("sbb-tooltip-trigger-active",r._isTooltipVisible()),Ve("sbbTooltip",a)("sbbTooltipTrigger",i.trigger)("sbbTooltipShowDelay",i.hoverShowDelay)("sbbTooltipHideDelay",i.hoverHideDelay)("sbbTooltipClass",i.sbbTooltipClass)("sbbTooltipPanelClass",i.sbbTooltipPanelClass),_e(2),Ve("svgIcon",i.svgIcon)}},dependencies:[vl,gC],encapsulation:2,changeDetection:0}),n})(),tN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[w9],imports:[C_,ro,uc,il,Pr,cs,E_]}),n})();function A9(n,t){1&n&&ys(0)}function R9(n,t){if(1&n&&(ae(0,"div")(1,"span")(2,"del"),W(3),de()(),ae(4,"span",14)(5,"del"),W(6),de()()()),2&n){const e=Ot().$implicit;_e(3),ce(e.arrText),_e(3),ce(e.arrDelayText)}}function k9(n,t){if(1&n&&(ae(0,"div")(1,"span"),W(2),de(),ae(3,"span",14),W(4),de()()),2&n){const e=Ot().$implicit;_e(2),ce(e.arrText),_e(2),ce(e.arrDelayText)}}function P9(n,t){if(1&n&&(ae(0,"div")(1,"span")(2,"del"),W(3),de()(),ae(4,"span",14)(5,"del"),W(6),de()()()),2&n){const e=Ot().$implicit;_e(3),ce(e.depText),_e(3),ce(e.depDelayText)}}function L9(n,t){if(1&n&&(ae(0,"div")(1,"span"),W(2),de(),ae(3,"span",14),W(4),de()()),2&n){const e=Ot().$implicit;_e(2),ce(e.depText),_e(2),ce(e.depDelayText)}}function O9(n,t){1&n&&(ae(0,"span",15),W(1,"not serviced"),de())}function F9(n,t){if(1&n&&(ae(0,"div")(1,"div"),W(2),de()()),2&n){const e=Ot(2).$implicit;_e(2),Se("Pl. ",e.platformText,"")}}function N9(n,t){if(1&n&&(ae(0,"div")(1,"div"),W(2,"Pl. "),ae(3,"del"),W(4),de(),ae(5,"span",14),W(6),de()()()),2&n){const e=Ot(2).$implicit;_e(4),Se(" ",e.platformText,""),_e(2),Se(" ",e.actualPlatformText,"")}}function B9(n,t){if(1&n&&(ae(0,"div",16),Ct(1,F9,3,1,"div",7),Ct(2,N9,7,2,"div",7),de()),2&n){const e=Ot().$implicit;_e(1),Ve("ngIf",null===e.actualPlatformText),_e(1),Ve("ngIf",null!==e.actualPlatformText)}}function z9(n,t){if(1&n&&(ae(0,"div"),dn(1,"img",17),de()),2&n){const e=Ot().$implicit;_e(1),Qo("src",e.platformAssistanceIconPath,hs),Qo("sbbTooltip",e.platformAssistanceTooltip)}}function V9(n,t){if(1&n){const e=Zr();ae(0,"tr",5),Zt("click",function(){const a=di(e).$implicit;return oi(Ot(2).zoomToLocation(a))}),ae(1,"td",6),Ct(2,R9,7,2,"div",7),Ct(3,k9,5,2,"div",7),de(),ae(4,"td",6),Ct(5,P9,7,2,"div",7),Ct(6,L9,5,2,"div",7),de(),ae(7,"td",8)(8,"div",9),W(9),Ct(10,O9,2,0,"span",10),de(),Ct(11,B9,3,2,"div",11),Ct(12,z9,2,2,"div",7),de(),ae(13,"td",12)(14,"input",13),Zt("change",function(){const a=di(e).index;return oi(Ot(2).onRouteEndPointSelected(a))}),de()()()}if(2&n){const e=t.$implicit,i=t.index,r=Ot(2);_e(2),Ve("ngIf",e.isNotServicedStop),_e(1),Ve("ngIf",!e.isNotServicedStop),_e(2),Ve("ngIf",e.isNotServicedStop),_e(1),Ve("ngIf",!e.isNotServicedStop),_e(3),Se("",e.locationText," "),_e(1),Ve("ngIf",e.isNotServicedStop),_e(1),Ve("ngIf",null!==e.platformText),_e(1),Ve("ngIf",null!==e.platformAssistanceIconPath),_e(2),Ve("checked",r.selectedEndpointsIDx.includes(i))}}function j9(n,t){if(1&n&&(ae(0,"table",2)(1,"thead")(2,"tr")(3,"th",3),W(4,"Arr"),de(),ae(5,"th",3),W(6,"Dep"),de(),ae(7,"th",3),W(8,"Stop"),de(),ae(9,"th",3),W(10,"Route"),de()()(),ae(11,"tbody"),Ct(12,V9,15,9,"tr",4),de()()),2&n){const e=Ot();_e(12),Ve("ngForOf",e.stopPointsData)}}let U9=(()=>{class n{constructor(){this.stopPointsData=[],this.locationSelected=new Cn,this.onExampleTripLocationsUpdated=new Cn,this.selectedEndpointsIDx=[]}ngOnInit(){this.selectedEndpointsIDx=[0,this.stopPointsData.length-1]}ngAfterViewInit(){this.emitSelectedEndpoints()}zoomToLocation(e){this.locationSelected.emit(e)}emitSelectedEndpoints(){this.onExampleTripLocationsUpdated.emit(this.selectedEndpointsIDx)}onRouteEndPointSelected(e){2==this.selectedEndpointsIDx.length&&(this.selectedEndpointsIDx.push(e),this.selectedEndpointsIDx=this.selectedEndpointsIDx.slice(-2),this.emitSelectedEndpoints())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["service-stops"]],inputs:{stopPointsData:"stopPointsData"},outputs:{locationSelected:"locationSelected",onExampleTripLocationsUpdated:"onExampleTripLocationsUpdated"},decls:3,vars:1,consts:[[4,"ngTemplateOutlet"],["variant2",""],[1,"table","table-hover","mb-0"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"fit","stop-time","align-middle"],[4,"ngIf"],[1,"stop-info","d-flex","gap-2","align-items-center"],[1,"flex-grow-1"],["class","badge rounded-pill bg-danger fw-bolder",4,"ngIf"],["class","d-flex gap-2",4,"ngIf"],[1,"text-center"],["type","radio",1,"form-check-input",3,"checked","change"],[1,"time-delay"],[1,"badge","rounded-pill","bg-danger","fw-bolder"],[1,"d-flex","gap-2"],[1,"leg-platform-assistance",3,"src","sbbTooltip"]],template:function(e,i){1&e&&(Ct(0,A9,1,0,"ng-container",0),Ct(1,j9,13,1,"ng-template",null,1,qp)),2&e&&Ve("ngTemplateOutlet",Oa(2))},dependencies:[cc,Go,nx,gC],styles:[".table[_ngcontent-%COMP%]   td.fit[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th.fit[_ngcontent-%COMP%]{white-space:nowrap;width:1%}.time-departure[_ngcontent-%COMP%]{font-weight:700;font-size:16px}.stop-info[_ngcontent-%COMP%]{font-size:16px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}.leg-platform-assistance[_ngcontent-%COMP%]{width:30px}"]}),n})();function H9(n,t){if(1&n){const e=Zr();ae(0,"div")(1,"div",1)(2,"div",2)(3,"div"),dn(4,"img",3),de(),ae(5,"div",4),W(6),de(),ae(7,"div",5),W(8),de(),ae(9,"div",6),W(10),de()(),ae(11,"h2",7),W(12),de(),ae(13,"div"),W(14),de(),ae(15,"div",8),W(16,"Example Trip: "),ae(17,"a",9),W(18),de()(),ae(19,"div",10)(20,"service-stops",11),Zt("locationSelected",function(r){return di(e),oi(Ot().onLocationSelected(r))})("onExampleTripLocationsUpdated",function(r){return di(e),oi(Ot().onExampleTripLocationsUpdated(r))}),de()(),ae(21,"div",8),W(22,"Permalink: "),ae(23,"a",9),W(24),de()()()()}if(2&n){const e=Ot();_e(4),Qo("src",e.model.serviceIconPath,hs),_e(2),ce(e.model.serviceLineText),_e(2),ce(e.model.serviceTripId),_e(2),Se("(",e.model.serviceOperator,")"),_e(2),me("",e.model.serviceFromText," \u2192 ",e.model.serviceToText,""),_e(2),Se("Day: ",e.model.operatingDayRef,""),_e(3),Ve("href",e.model.journeyExampleURL,hs),_e(1),ce(e.model.journeyExampleCaption),_e(2),Ve("stopPointsData",e.model.stopPointsData),_e(3),Ve("href","./trip?ref="+e.model.journeyRef,hs),_e(1),ce(e.model.journeyRef)}}let nN=(()=>{class n{constructor(e,i,r){this.tripInfoService=e,this.userTripService=i,this.cdr=r,this.model={},this.model.tripInfoResult=null,this.model.stopPointsData=[]}ngOnInit(){this.tripInfoService.tripInfoResultUpdated.subscribe(e=>{this.updatePageModel(e)})}ngAfterViewInit(){}updatePageModel(e){var i,r,a,p,y,T,P;if(this.model.tripInfoResult=e,null===e)return;const z=null!==(i=e.service)&&void 0!==i?i:null;if(null===z||e.stopPoints.length<2)return;this.model.journeyRef=z.journeyRef,this.model.operatingDayRef=null!==(r=z.operatingDayRef)&&void 0!==r?r:"n/a (serviceDay)",this.model.serviceFromText=null!==(a=e.stopPoints[0].location.computeLocationName())&&void 0!==a?a:"n/a (from)",this.model.serviceToText=null!==(p=e.stopPoints[e.stopPoints.length-1].location.computeLocationName())&&void 0!==p?p:"n/a (from)",this.model.serviceLineText=null!==(y=z.serviceLineNumber)&&void 0!==y?y:"n/a (serviceLineNumber)",this.model.serviceTripId=null!==(T=z.journeyNumber)&&void 0!==T?T:"n/a (journeyNumber)",this.model.serviceOperator=null!==(P=z.agencyID)&&void 0!==P?P:"n/a (agencyID)";const oe=Ws.computeIconFilenameForService(z);this.model.serviceIconPath="assets/pictograms/"+oe+".png",this.model.stopPointsData=(()=>{const fe=[];return e.stopPoints.forEach(Ae=>{var We;const ot={locationText:null!==(We=Ae.location.computeLocationName())&&void 0!==We?We:"n/a"};Ws.updateLocationDataWithTime(ot,Ae),ot.platformAssistanceIconPath=Ws.computePlatformAssistanceIconPath(Ae),ot.platformAssistanceTooltip=Ws.computePlatformAssistanceTooltip(Ae),fe.push(ot)}),fe})()}onLocationSelected(e){this.tripInfoService.locationSelected.emit(e)}onExampleTripLocationsUpdated(e){var i,r,a,p;if(null===this.model.tripInfoResult)return;if(2!=e.length)return console.error("ERROR: expected 2 items only"),void console.log(e);(e=e.slice()).sort((Ae,We)=>Ae-We);const y=this.model.tripInfoResult.stopPoints,T=y[e[0]].location,P=y[e[1]].location,z=new URLSearchParams,H=null!==(r=null===(i=T.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null,J=null!==(p=null===(a=P.stopPlace)||void 0===a?void 0:a.stopPlaceRef)&&void 0!==p?p:null;if(null===H||null===J)return;z.set("from",H),z.set("to",J),this.userTripService.currentAppStage!==lC&&z.set("stage",this.userTripService.currentAppStage);const fe=Ps.formatDate(new Date).substring(0,10);this.model.operatingDayRef!==fe&&z.set("day",this.model.operatingDayRef),z.set("do_search","yes"),this.model.journeyExampleURL="./search?"+z.toString(),this.model.journeyExampleCaption=T.computeLocationName()+" -> "+P.computeLocationName(),this.cdr.detectChanges()}}return n.\u0275fac=function(e){return new(e||n)(le(mC),le(Ba),le(lo))},n.\u0275cmp=Ut({type:n,selectors:[["trip-info-result"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"px-3"],[1,"d-flex","align-items-center","gap-2","mt-3"],[1,"leg-icon",3,"src"],[1,"service-line-number"],[1,"service-trip-id"],[1,"service-operator"],[1,"mt-3"],[1,"mt-3","mb-2"],["target","_blank",3,"href"],[1,"p-1"],[3,"stopPointsData","locationSelected","onExampleTripLocationsUpdated"]],template:function(e,i){1&e&&Ct(0,H9,25,12,"div",0),2&e&&Ve("ngIf",null!==i.model.tripInfoResult)},dependencies:[Go,U9],styles:[".leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.service-line-number[_ngcontent-%COMP%]{font-size:20px;font-weight:700}"]}),n})();function G9(n,t){1&n&&(ae(0,"div",6)(1,"div",7)(2,"span",8),W(3,"Loading..."),de()(),ae(4,"div"),W(5,"fetching OJP TripInfoRequest ..."),de()())}function q9(n,t){if(1&n&&(ae(0,"div",9),W(1),de()),2&n){const e=Ot();_e(1),Se(" ",e.model.errorMessage," ")}}let iN=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.tripInfoService=i,this.languageService=r,this.model={},this.model.title="TripInfoResult",this.model.errorMessage=null,this.model.isFetching=!1}fetchJourneyRef(e,i){var r=this;return ua(function*(){r.model.title="JourneyRef: "+e;const a=r.userTripService.getStageConfig(),p=vh.initWithJourneyRef(a,r.languageService.language,e,i);r.model.isFetching=!0;const y=yield p.fetchResponse();if(r.model.isFetching=!1,null===y.tripInfoResult)return console.error("fetchJourneyRef - error"),console.log(e),void(r.model.errorMessage="ERROR while fetching the TripInfoRequest, check console for more details.");r.tripInfoService.tripInfoResultUpdated.emit(y.tripInfoResult)})()}}return n.\u0275fac=function(e){return new(e||n)(le(Ba),le(mC),le(Th))},n.\u0275cmp=Ut({type:n,selectors:[["trip-info-result-popover"]],decls:10,vars:3,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],["class","p-2 d-flex gap-2",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],[1,"p-2","d-flex","gap-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"],["role","alert",1,"alert","alert-danger"]],template:function(e,i){1&e&&(ae(0,"div",0),W(1),de(),ae(2,"div",1)(3,"div"),Ct(4,G9,6,0,"div",2),Ct(5,q9,2,1,"div",3),dn(6,"trip-info-result"),de()(),ae(7,"div",4)(8,"button",5),W(9," Close "),de()()),2&e&&(_e(1),ce(i.model.title),_e(3),Ve("ngIf",i.model.isFetching),_e(1),Ve("ngIf",i.model.errorMessage))},dependencies:[Go,Om,R_,k_,P_,nN],encapsulation:2}),n})();function $9(n,t){1&n&&(ae(0,"div")(1,"span",17),W(2,"Cancelled"),de()())}function W9(n,t){1&n&&(ae(0,"div")(1,"span",18),W(2,"Deviation"),de()())}function X9(n,t){1&n&&(ae(0,"div")(1,"span",18),W(2,"Unplanned"),de()())}function Z9(n,t){if(1&n){const e=Zr();ae(0,"div",19)(1,"div",20),Zt("click",function(){return di(e),oi(Ot().handleTapOnLegHeading())}),W(2,"MAP"),de()()}}function Y9(n,t){1&n&&ys(0)}function K9(n,t){1&n&&ys(0)}function J9(n,t){1&n&&ys(0)}function Q9(n,t){if(1&n&&(ae(0,"div")(1,"div"),W(2),de()()),2&n){const e=Ot(3);_e(2),Se(", Pl. ",e.legInfoDataModel.fromLocationData.platformText,"")}}function eX(n,t){if(1&n&&(ae(0,"div")(1,"div"),W(2,", Pl. "),ae(3,"del"),W(4),de(),ae(5,"span",27),W(6),de()()()),2&n){const e=Ot(3);_e(4),Se(" ",e.legInfoDataModel.fromLocationData.platformText,""),_e(2),Se(" ",e.legInfoDataModel.fromLocationData.actualPlatformText,"")}}function tX(n,t){if(1&n&&(ae(0,"div"),Ct(1,Q9,3,1,"div",2),Ct(2,eX,7,2,"div",2),de()),2&n){const e=Ot(2);_e(1),Ve("ngIf",!e.legInfoDataModel.fromLocationData.actualPlatformText),_e(1),Ve("ngIf",e.legInfoDataModel.fromLocationData.actualPlatformText)}}function nX(n,t){1&n&&(ae(0,"div")(1,"span",17),W(2,"not serviced"),de()())}function iX(n,t){if(1&n&&dn(0,"img",32),2&n){const e=Ot(2);Qo("src",e.legInfoDataModel.fromLocationData.platformAssistanceIconPath,hs),Qo("sbbTooltip",e.legInfoDataModel.fromLocationData.platformAssistanceTooltip)}}function rX(n,t){if(1&n&&(ae(0,"div"),W(1),de()),2&n){const e=Ot(2);_e(1),ce(e.legInfoDataModel.fromLocationData.depText)}}function oX(n,t){if(1&n&&(ae(0,"div")(1,"del"),W(2),de()()),2&n){const e=Ot(2);_e(2),ce(e.legInfoDataModel.fromLocationData.depText)}}function sX(n,t){1&n&&ys(0)}function aX(n,t){if(1&n&&(ae(0,"div")(1,"div"),W(2),de()()),2&n){const e=Ot(3);_e(2),Se(", Pl. ",e.legInfoDataModel.toLocationData.platformText,"")}}function lX(n,t){if(1&n&&(ae(0,"div")(1,"div"),W(2,", Pl. "),ae(3,"del"),W(4),de(),ae(5,"span",27),W(6),de()()()),2&n){const e=Ot(3);_e(4),Se(" ",e.legInfoDataModel.toLocationData.platformText,""),_e(2),Se(" ",e.legInfoDataModel.toLocationData.actualPlatformText,"")}}function cX(n,t){if(1&n&&(ae(0,"div"),Ct(1,aX,3,1,"div",2),Ct(2,lX,7,2,"div",2),de()),2&n){const e=Ot(2);_e(1),Ve("ngIf",!e.legInfoDataModel.toLocationData.actualPlatformText),_e(1),Ve("ngIf",e.legInfoDataModel.toLocationData.actualPlatformText)}}function uX(n,t){1&n&&(ae(0,"div")(1,"span",17),W(2,"not serviced"),de()())}function dX(n,t){if(1&n&&dn(0,"img",32),2&n){const e=Ot(2);Qo("src",e.legInfoDataModel.toLocationData.platformAssistanceIconPath,hs),Qo("sbbTooltip",e.legInfoDataModel.toLocationData.platformAssistanceTooltip)}}function hX(n,t){if(1&n&&(ae(0,"div"),W(1),de()),2&n){const e=Ot(2);_e(1),ce(e.legInfoDataModel.toLocationData.arrText)}}function pX(n,t){if(1&n&&(ae(0,"div")(1,"del"),W(2),de()()),2&n){const e=Ot(2);_e(2),ce(e.legInfoDataModel.toLocationData.arrText)}}function fX(n,t){if(1&n){const e=Zr();ae(0,"div",21)(1,"div",22),Zt("click",function(){return di(e),oi(Ot().handleClickOnLocation("From"))}),ae(2,"div",23)(3,"div"),W(4),de(),Ct(5,tX,3,2,"div",2),de(),Ct(6,nX,3,0,"div",2),de(),ae(7,"div",24)(8,"div",25),Ct(9,iX,1,2,"img",26),Ct(10,rX,2,1,"div",2),Ct(11,oX,3,1,"div",2),ae(12,"div",27),W(13),de()()()(),ae(14,"div",28)(15,"div",29),dn(16,"div",30),de(),Ct(17,sX,1,0,"ng-container",31),ae(18,"div",29),dn(19,"div",30),de()(),ae(20,"div",21)(21,"div",22),Zt("click",function(){return di(e),oi(Ot().handleClickOnLocation("To"))}),ae(22,"div",23)(23,"div"),W(24),de(),Ct(25,cX,3,2,"div",2),de(),Ct(26,uX,3,0,"div",2),de(),ae(27,"div",24)(28,"div",25),Ct(29,dX,1,2,"img",26),Ct(30,hX,2,1,"div",2),Ct(31,pX,3,1,"div",2),ae(32,"div",27),W(33),de()()()()}if(2&n){const e=Ot(),i=Oa(29);_e(4),ce(e.legInfoDataModel.fromLocationData.locationText),_e(1),Ve("ngIf",e.legInfoDataModel.fromLocationData.platformText),_e(1),Ve("ngIf",e.legInfoDataModel.fromLocationData.isNotServicedStop),_e(3),Ve("ngIf",null!==e.legInfoDataModel.fromLocationData.platformAssistanceIconPath),_e(1),Ve("ngIf",!e.legInfoDataModel.fromLocationData.isNotServicedStop),_e(1),Ve("ngIf",e.legInfoDataModel.fromLocationData.isNotServicedStop),_e(2),ce(e.legInfoDataModel.fromLocationData.depDelayText),_e(4),Ve("ngTemplateOutlet",i),_e(7),ce(e.legInfoDataModel.toLocationData.locationText),_e(1),Ve("ngIf",e.legInfoDataModel.toLocationData.platformText),_e(1),Ve("ngIf",e.legInfoDataModel.toLocationData.isNotServicedStop),_e(3),Ve("ngIf",null!==e.legInfoDataModel.toLocationData.platformAssistanceIconPath),_e(1),Ve("ngIf",!e.legInfoDataModel.toLocationData.isNotServicedStop),_e(1),Ve("ngIf",e.legInfoDataModel.toLocationData.isNotServicedStop),_e(2),ce(e.legInfoDataModel.toLocationData.arrDelayText)}}function mX(n,t){if(1&n&&(ae(0,"li"),W(1),de()),2&n){const e=t.$implicit;_e(1),Se(" ",e," ")}}function gX(n,t){if(1&n&&(ae(0,"sbb-tooltip",37)(1,"ul",38),Ct(2,mX,2,1,"li",39),de()()),2&n){const e=Ot(2);_e(2),Ve("ngForOf",e.legInfoDataModel.guidanceTextLines)}}function _X(n,t){1&n&&(ae(0,"div"),dn(1,"div",40),de())}function bX(n,t){if(1&n){const e=Zr();ae(0,"div",21)(1,"div",33)(2,"div",34)(3,"div",35),Zt("click",function(){return di(e),oi(Ot().handleClickOnLocation("From"))}),W(4),de(),Ct(5,gX,3,1,"sbb-tooltip",36),Ct(6,_X,2,0,"div",2),ae(7,"div",35),Zt("click",function(){return di(e),oi(Ot().handleClickOnLocation("To"))}),W(8),de()()(),ae(9,"div",24)(10,"div"),W(11),de()()()}if(2&n){const e=Ot();_e(4),ce(e.legInfoDataModel.fromLocationData.locationText),_e(1),Ve("ngIf",e.legInfoDataModel.hasGuidance),_e(1),Ve("ngIf",0==e.legInfoDataModel.hasGuidance),_e(2),ce(e.legInfoDataModel.toLocationData.locationText),_e(3),ce(e.legInfoDataModel.durationText)}}function yX(n,t){if(1&n&&(ae(0,"li"),W(1," Book on "),ae(2,"a",42),W(3),de()()),2&n){const e=t.$implicit;_e(2),Qo("href",e.infoURL,hs),_e(1),ce(e.agencyName)}}function vX(n,t){if(1&n){const e=Zr();ae(0,"div",21)(1,"div",33)(2,"div",34)(3,"div",35),Zt("click",function(){return di(e),oi(Ot().handleClickOnLocation("From"))}),W(4),de(),ae(5,"ul",41),Ct(6,yX,4,2,"li",39),de(),ae(7,"div",35),Zt("click",function(){return di(e),oi(Ot().handleClickOnLocation("To"))}),W(8),de()()(),ae(9,"div",24)(10,"div"),W(11),de()()()}if(2&n){const e=Ot();_e(4),ce(e.legInfoDataModel.fromLocationData.locationText),_e(2),Ve("ngForOf",e.legInfoDataModel.bookingArrangements),_e(2),ce(e.legInfoDataModel.toLocationData.locationText),_e(3),ce(e.legInfoDataModel.durationText)}}function xX(n,t){if(1&n&&(Uo(0),ae(1,"div"),W(2),de(),ae(3,"span",53),W(4),de(),Zo()),2&n){const e=Ot(3);_e(2),Se("",null==e.legInfoDataModel.servicePtMode||null==e.legInfoDataModel.servicePtMode.subMode?null:e.legInfoDataModel.servicePtMode.subMode.key," = "),_e(2),ce(null==e.legInfoDataModel.servicePtMode||null==e.legInfoDataModel.servicePtMode.subMode?null:e.legInfoDataModel.servicePtMode.subMode.value)}}function wX(n,t){if(1&n&&(ae(0,"div",52)(1,"span",53),W(2),de(),Ct(3,xX,5,2,"ng-container",2),de()),2&n){const e=Ot(2);_e(2),ce(null==e.legInfoDataModel.servicePtMode?null:e.legInfoDataModel.servicePtMode.ptMode),_e(1),Ve("ngIf",null!==(null==e.legInfoDataModel.servicePtMode?null:e.legInfoDataModel.servicePtMode.subMode))}}function SX(n,t){if(1&n&&(ae(0,"div")(1,"button",54),W(2),dn(3,"i",55)(4,"i",56),de()()),2&n){const e=Ot(2);_e(1),Yn("data-bs-target","#"+e.legElementId)("aria-controls",e.legElementId),_e(1),Se(" ",e.legInfoDataModel.serviceIntermediaryStopsText," ")}}function TX(n,t){if(1&n&&(ae(0,"div",57)(1,"sbb-tooltip",58)(2,"div"),W(3),de()()()),2&n){const e=t.$implicit;_e(1),Qo("svgIcon",e.icon),_e(2),Se(" ",e.caption," ")}}function CX(n,t){if(1&n&&(Uo(0),ae(1,"div"),W(2),de(),Zo()),2&n){const e=Ot().$implicit;_e(2),Se(" ",e.descriptions[0]," ")}}function DX(n,t){if(1&n&&(ae(0,"li"),W(1),de()),2&n){const e=t.$implicit;_e(1),Se(" ",e," ")}}function EX(n,t){if(1&n&&(Uo(0),ae(1,"ul",38),Ct(2,DX,2,1,"li",39),de(),ae(3,"h6"),W(4,"Detail"),de(),Zo()),2&n){const e=Ot().$implicit;_e(2),Ve("ngForOf",e.descriptions)}}function IX(n,t){if(1&n&&(ae(0,"li"),W(1),de()),2&n){const e=t.$implicit;_e(1),Se(" ",e," ")}}function MX(n,t){if(1&n&&(ae(0,"div")(1,"sbb-tooltip",61)(2,"p")(3,"strong"),W(4),de()(),Ct(5,CX,3,1,"ng-container",2),Ct(6,EX,5,1,"ng-container",2),ae(7,"ul",38),Ct(8,IX,2,1,"li",39),de()()()),2&n){const e=t.$implicit;_e(4),ce(e.summary),_e(1),Ve("ngIf",1===e.descriptions.length),_e(1),Ve("ngIf",e.descriptions.length>1),_e(2),Ve("ngForOf",e.details)}}function AX(n,t){if(1&n&&(ae(0,"div",59)(1,"div",60),Ct(2,MX,9,4,"div",39),de()()),2&n){const e=Ot(2);_e(2),Ve("ngForOf",e.legInfoDataModel.situations)}}function RX(n,t){1&n&&(ae(0,"div")(1,"span",17),W(2,"not serviced"),de()())}function kX(n,t){if(1&n&&(ae(0,"div"),W(1),ae(2,"span",27),W(3),de()()),2&n){const e=Ot().$implicit;let i;_e(1),Se("",null!==(i=e.arrText)&&void 0!==i?i:"\u2000"," "),_e(2),ce(e.arrDelayText)}}function PX(n,t){if(1&n&&(ae(0,"div")(1,"del"),W(2),de(),ae(3,"span",27),W(4),de()()),2&n){const e=Ot().$implicit;let i;_e(2),ce(null!==(i=e.arrText)&&void 0!==i?i:"\u2000"),_e(2),ce(e.arrDelayText)}}function LX(n,t){if(1&n&&(ae(0,"div"),W(1),ae(2,"span",27),W(3),de()()),2&n){const e=Ot().$implicit;_e(1),Se("",e.depText," "),_e(2),ce(e.depDelayText)}}function OX(n,t){if(1&n&&(ae(0,"div")(1,"del"),W(2),de(),ae(3,"span",27),W(4),de()()),2&n){const e=Ot().$implicit;_e(2),ce(e.depText),_e(2),ce(e.depDelayText)}}function FX(n,t){if(1&n&&(ae(0,"tr")(1,"td")(2,"div",60)(3,"div"),W(4),de(),Ct(5,RX,3,0,"div",2),de()(),ae(6,"td",62),Ct(7,kX,4,2,"div",2),Ct(8,PX,5,2,"div",2),de(),ae(9,"td",63),Ct(10,LX,4,2,"div",2),Ct(11,OX,5,2,"div",2),de()()),2&n){const e=t.$implicit;_e(4),ce(e.locationText),_e(1),Ve("ngIf",e.isNotServicedStop),_e(2),Ve("ngIf",!e.isNotServicedStop),_e(1),Ve("ngIf",e.isNotServicedStop),_e(2),Ve("ngIf",!e.isNotServicedStop),_e(1),Ve("ngIf",e.isNotServicedStop)}}function NX(n,t){if(1&n){const e=Zr();ae(0,"div",43)(1,"div")(2,"button",44),Zt("click",function(){return di(e),oi(Ot().loadTripInfoResultPopover())}),W(3),de()(),ae(4,"div"),W(5),de()(),Ct(6,wX,4,2,"div",45),ae(7,"div",46),Ct(8,SX,5,3,"div",2),ae(9,"div",47)(10,"div",25),Ct(11,TX,4,2,"div",48),de()(),Ct(12,AX,3,1,"div",49),de(),ae(13,"div",50)(14,"table",51)(15,"tbody"),Ct(16,FX,12,6,"tr",39),de()()()}if(2&n){const e=Ot();_e(3),ce(e.legInfoDataModel.serviceInfo),_e(2),Se(" to ",e.legInfoDataModel.serviceDestinationText,""),_e(1),Ve("ngIf",e.legInfoDataModel.debugServicePtMode),_e(2),Ve("ngIf",null!==e.legInfoDataModel.serviceIntermediaryStopsText),_e(3),Ve("ngForOf",e.legInfoDataModel.serviceAttributes),_e(1),Ve("ngIf",e.legInfoDataModel.hasSituations),_e(1),Ve("id",e.legElementId),_e(3),Ve("ngForOf",e.legInfoDataModel.intermediaryLocationsData)}}const BX=function(n,t){return{"background-color":n,"border-color":t}};let zX=(()=>{class n{constructor(e,i,r,a){this.mapService=e,this.router=i,this.tripInfoResultPopover=r,this.userTripService=a,this.isLastLeg=!1,this.legElementId="n/a",this.legInfoDataModel={},this.isEmbed=-1!==this.router.url.indexOf("/embed/")}ngOnInit(){void 0===this.leg||void 0===this.legIdx||(this.legElementId="leg_"+this.legId,this.initLegInfo())}computeLegLeadingText(){if(void 0===this.leg||void 0===this.legIdx)return"n/a";const e=this.legIdx+1+". ";if("TransferLeg"===this.leg.legType){const i="Transfer",r=this.leg;let a="";return r.walkDuration&&(a=" "+r.walkDuration.formatDuration()),e+i+a}if("ContinousLeg"===this.leg.legType){const r=this.computeLegLeadingTextContinousLeg(this.leg);let a="";return this.leg.legDuration&&(a=" "+this.leg.legDuration.formatDuration()),e+r+" - "+a}if("TimedLeg"===this.leg.legType){const i=this.leg;let r=i.service.ptMode.name;null===r&&(r=i.service.ptMode.ptMode),i.service.ptMode.isDemandMode&&(r="OnDemand "+r);let a="";return this.leg.legDuration&&(a=" "+this.leg.legDuration.formatDuration()),e+r+" - "+a}return e+this.leg.legType}computeLegLeadingTextContinousLeg(e){return"walk"===e.legTransportMode?"Walk":e.isDriveCarLeg()?"Drive":e.isSharedMobility()?"Ride":e.isTaxi()?"others-drive-car"===e.legTransportMode?"Limo":"Taxi":"car-shuttle-train"===e.legTransportMode?"Ride Autoverladezug":"car-ferry"===e.legTransportMode?"Use Ferry":"PLACEHOLDER - NEW MOT?"}computeLegPillClassName(){return this.leg?"ContinousLeg"===this.leg.legType?"continous-leg-pill":"TimedLeg"===this.leg.legType?"timed-leg-pill":"TransferLeg"===this.leg.legType?"transfer-leg-pill":"":""}handleTapOnLegHeading(){if(!this.leg)return;const i=new $x(this.leg).computeGeoJSONFeatures(),r=yh.initFromGeoJSONFeatures(i);if(!r.isValid())return console.error("Invalid BBOX for leg"),void console.log(this.leg);const p={bounds:new(da().LngLatBounds)(r.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(p)}computeLegColor(){const e=Fm.Unknown;if(!this.leg)return e;const i=this.leg.legType;return"ContinousLeg"===i||"TransferLeg"===i?this.computeContinousLegColor(this.leg):"TimedLeg"===i?TA.computeTimedLegColor(this.leg):e}computeContinousLegColor(e){return e.isDriveCarLeg()?Fm["Self-Drive Car"]:e.isSharedMobility()?Fm["Shared Mobility"]:"TransferLeg"===e.legType?Fm.Transfer:e.isTaxi()?Fm.OnDemand:"car-ferry"===e.legTransportMode?Fm.Water:Fm.Walk}initLegInfo(){var e,i,r,a;if(void 0===this.leg)return;const p=this.leg;this.legInfoDataModel.legColor=this.computeLegColor(),this.legInfoDataModel.leadingText=this.computeLegLeadingText();const y="TransferLeg"===p.legType;this.legInfoDataModel.guidanceTextLines=[],y&&(null!==(i=null===(e=p.pathGuidance)||void 0===e?void 0:e.sections)&&void 0!==i?i:[]).forEach(oe=>{var fe,Ae,We,ot,tn,Nt;if(null===oe.guidanceAdvice)return;const un=[null!==(fe=oe.guidanceAdvice)&&void 0!==fe?fe:"","(",null!==(Ae=oe.turnAction)&&void 0!==Ae?Ae:"",") - ",null!==(ot=null===(We=oe.trackSection)||void 0===We?void 0:We.roadName)&&void 0!==ot?ot:""],Zn=null!==(Nt=null===(tn=oe.trackSection)||void 0===tn?void 0:tn.length)&&void 0!==Nt?Nt:0;Zn>0&&(un.push(" ("),un.push(""+Zn),un.push("m)"));const ci=un.join("");this.legInfoDataModel.guidanceTextLines.push(ci)});let T="TransferLeg"===p.legType;const P="ContinousLeg"===p.legType;if(P){const H=p;T=H.isWalking(),T&&(this.legInfoDataModel.distanceText=H.formatDistance())}this.legInfoDataModel.isWalking=T,this.legInfoDataModel.legTemplate=P&&p.isTaxi()?"taxi":"TimedLeg"===p.legType?"timed":"walk",this.legInfoDataModel.bookingArrangements=P?null===p.serviceBooking?[]:p.serviceBooking.bookingArrangements:[],this.legInfoDataModel.durationText=null!==(a=null===(r=p.legDuration)||void 0===r?void 0:r.formatDuration())&&void 0!==a?a:"",this.legInfoDataModel.hasGuidance=this.legInfoDataModel.guidanceTextLines.length>0;const z=Ws.computeIconFilenameForLeg(p);if(this.legInfoDataModel.legIconPath="assets/pictograms/"+z+".png",this.legInfoDataModel.isTimed="TimedLeg"===p.legType,this.legInfoDataModel.fromLocationData=this.computeLocationData(p,"From"),this.legInfoDataModel.toLocationData=this.computeLocationData(p,"To"),this.legInfoDataModel.intermediaryLocationsData=(()=>{const H=[];return"TimedLeg"!==p.legType||p.intermediateStopPoints.forEach(oe=>{var fe;const Ae={locationText:null!==(fe=oe.location.computeLocationName())&&void 0!==fe?fe:"n/a"};Ws.updateLocationDataWithTime(Ae,oe),H.push(Ae)}),H})(),this.legInfoDataModel.situations=(()=>{if("TimedLeg"!==p.legType)return[];const J=p.service.siriSituations,oe=Ws.computeSituationsData(J);return"DEBUG"===Na&&J.length>0&&0===oe.length&&(console.error("ResultTripLegComponent.initLegInfo ERROR - have situations but cant extract data from them"),console.log(J),console.log("========================================================")),oe})(),this.legInfoDataModel.hasSituations=this.legInfoDataModel.situations.length>0,"TimedLeg"===p.legType){const H=p;this.legInfoDataModel.fromLocationData.platformAssistanceIconPath=Ws.computePlatformAssistanceIconPath(H.fromStopPoint),this.legInfoDataModel.fromLocationData.platformAssistanceTooltip=Ws.computePlatformAssistanceTooltip(H.fromStopPoint),this.legInfoDataModel.toLocationData.platformAssistanceIconPath=Ws.computePlatformAssistanceIconPath(H.toStopPoint),this.legInfoDataModel.toLocationData.platformAssistanceTooltip=Ws.computePlatformAssistanceTooltip(H.toStopPoint)}var H,J;this.legInfoDataModel.serviceAttributes=this.computeServiceAttributeModel(p),this.legInfoDataModel.serviceDestinationText="TimedLeg"!==p.legType?null:null!==(J=null===(H=p.service.destinationStopPlace)||void 0===H?void 0:H.stopPlaceName)&&void 0!==J?J:"n/a",this.legInfoDataModel.serviceInfo=(()=>"TimedLeg"!==p.legType?null:this.formatServiceName(p))(),this.legInfoDataModel.serviceIntermediaryStopsText=(()=>{if("TimedLeg"!==p.legType)return null;const J=p.intermediateStopPoints.length;return 0===J?null:1===J?"1 stop":J+" stops"})(),this.legInfoDataModel.serviceInfo=(()=>"TimedLeg"!==p.legType?null:this.formatServiceName(p))(),this.legInfoDataModel.serviceJourneyRef="TimedLeg"!==p.legType?null:p.service.journeyRef,this.legInfoDataModel.debugServicePtMode="DEBUG"===Na,this.legInfoDataModel.servicePtMode="TimedLeg"!==p.legType?null:p.service.ptMode,this.legInfoDataModel.isCancelled="TimedLeg"===p.legType&&!0===p.service.hasCancellation,this.legInfoDataModel.hasDeviation="TimedLeg"===p.legType&&!0===p.service.hasDeviation,this.legInfoDataModel.isUnplanned="TimedLeg"===p.legType&&!0===p.service.isUnplanned}formatServiceName(e){return Ws.formatServiceName(e.service)}computeServiceAttributeModel(e){const i=[];if("TimedLeg"!==e.legType)return i;const r=e;for(const[a,p]of Object.entries(r.service.serviceAttributes)){const y=a.startsWith("ojp")?null:"gf"===a.toLowerCase()?"kom:freight-wagon-container-small":a.toLowerCase().startsWith("i_")||["sa-ba","ba","sa-hl","hl","bu"].includes(a.toLowerCase())?"kom:circle-information-large":"fpl:sa-"+a.toLowerCase();null!==y&&i.push({icon:y,caption:p.text})}return i}computeLocationData(e,i){var r;const a="From"===i,y={locationText:null!==(r=(a?e.fromLocation:e.toLocation).computeLocationName())&&void 0!==r?r:"",platformText:null,arrText:null,arrDelayText:null,depText:null,depDelayText:null};if("TimedLeg"===e.legType){const T=e;Ws.updateLocationDataWithTime(y,a?T.fromStopPoint:T.toStopPoint)}return y}handleClickOnLocation(e){this.leg&&this.mapService.tryToCenterAndZoomToLocation("From"===e?this.leg.fromLocation:this.leg.toLocation)}loadTripInfoResultPopover(){const e=this.legInfoDataModel.serviceJourneyRef,i=Ps.formatDate(this.userTripService.departureDate).substring(0,10);if(null===e)return void console.error("loadTripInfoResultPopover: cant fetch empty journeyRef");const r=this.tripInfoResultPopover.open(iN,{position:{top:"20px"}});r.afterOpened().subscribe(()=>{r.componentInstance.fetchJourneyRef(e,i)})}}return n.\u0275fac=function(e){return new(e||n)(le(Sh),le(aa),le(wl),le(Ba))},n.\u0275cmp=Ut({type:n,selectors:[["result-trip-leg"]],inputs:{leg:"leg",legId:"legId",legIdx:"legIdx",isLastLeg:"isLastLeg"},decls:30,vars:17,consts:[[1,"mb-2","d-flex","flex-row","gap-2"],["type","button",1,"btn","btn-primary","btn-sm","font-weight-bold",3,"ngStyle","click"],[4,"ngIf"],["class","ms-auto",4,"ngIf"],[1,"mb-2","d-flex","flex-row","align-items-center"],[1,"flex-grow-0","leg-left-side"],[1,"d-flex","flex-column","leg-icon-wrapper"],[1,"text-center"],[1,"leg-icon",3,"src"],[1,"flex-grow-1"],[4,"ngIf","ngIfThen"],[1,"mb-2"],[1,"border-bottom",2,"height","8px"],["timedLegTemplate",""],["walkingLegTemplate",""],["taxiLegTemplate",""],["timedLegTemplateVariant2",""],[1,"badge","rounded-pill","bg-danger","fw-bolder"],[1,"badge","rounded-pill","bg-warning","fw-bolder"],[1,"ms-auto"],[1,"badge","leg-pill","pill-hover","bg-primary",3,"click"],[1,"d-flex","flex-row","align-items-center"],[1,"flex-grow-1","leg-location","location-hover",3,"click"],[1,"d-flex"],[1,"flex-grow-0","leg-time","leg-right-side"],[1,"d-flex","gap-1","align-items-center"],["class","leg-platform-assistance",3,"src","sbbTooltip",4,"ngIf"],[1,"time-delay"],[1,"px-2"],[1,"d-flex","flex-row","align-items-center",2,"height","16px"],[1,"separator"],[4,"ngTemplateOutlet"],[1,"leg-platform-assistance",3,"src","sbbTooltip"],[1,"flex-grow-1","leg-location"],[1,"d-flex","flex-column","leg-location"],[1,"location-hover",3,"click"],["trigger","hover","svgIcon","kom:arrow-change-horizontal-medium",4,"ngIf"],["trigger","hover","svgIcon","kom:arrow-change-horizontal-medium"],[1,"tooltip-list"],[4,"ngFor","ngForOf"],[1,"border-bottom",2,"height","8px","margin-left","4px","margin-right","8px"],[1,"booking-arrangement"],["target","_blank",3,"href"],[1,"mb-2","d-flex","gap-1","align-items-center"],[1,"btn","btn-primary","btn-sm",3,"click"],["class","mb-2 ms-2 d-flex gap-1 service-pt-mode align-items-center",4,"ngIf"],[1,"ms-2","d-flex","gap-2","align-items-center"],[1,"service-attributes"],["class","service-attribute",4,"ngFor","ngForOf"],["class","mt-2",4,"ngIf"],[1,"py-2","collapse",3,"id"],[1,"table","table-hover","table-stops","mb-0","align-middle"],[1,"mb-2","ms-2","d-flex","gap-1","service-pt-mode","align-items-center"],[1,"badge","rounded-pill","text-bg-secondary"],["type","button","data-bs-toggle","collapse","aria-expanded","false",1,"btn","btn-primary","btn-sm","btn-collapse","collapsed"],[1,"bi","bi-chevron-down"],[1,"bi","bi-chevron-up"],[1,"service-attribute"],["trigger","hover",1,"sbb-icon-fit",3,"svgIcon"],[1,"mt-2"],[1,"d-flex","gap-2"],["trigger","hover","svgIcon","fpl:info"],[1,"fit"],[1,"fit","stop-time"]],template:function(e,i){if(1&e&&(ae(0,"div")(1,"div",0)(2,"div")(3,"button",1),Zt("click",function(){return i.handleTapOnLegHeading()}),W(4),de()(),Ct(5,$9,3,0,"div",2),Ct(6,W9,3,0,"div",2),Ct(7,X9,3,0,"div",2),Ct(8,Z9,3,0,"div",3),de(),ae(9,"div",4)(10,"div",5)(11,"div",6)(12,"div",7),dn(13,"img",8),de(),ae(14,"div",7),W(15),de()()(),ae(16,"div",9),Ct(17,Y9,1,0,"ng-container",10),Ct(18,K9,1,0,"ng-container",10),Ct(19,J9,1,0,"ng-container",10),de()(),ae(20,"div",11),dn(21,"div",12),de()(),Ct(22,fX,34,15,"ng-template",null,13,qp),Ct(24,bX,12,5,"ng-template",null,14,qp),Ct(26,vX,12,4,"ng-template",null,15,qp),Ct(28,NX,17,8,"ng-template",null,16,qp)),2&e){const r=Oa(23),a=Oa(25),p=Oa(27);_e(3),Ve("ngStyle",YR(14,BX,i.legInfoDataModel.legColor,i.legInfoDataModel.legColor)),_e(1),ce(i.legInfoDataModel.leadingText),_e(1),Ve("ngIf",!0===i.legInfoDataModel.isCancelled),_e(1),Ve("ngIf",!0===i.legInfoDataModel.hasDeviation),_e(1),Ve("ngIf",!0===i.legInfoDataModel.isUnplanned),_e(1),Ve("ngIf",!1===i.isEmbed),_e(5),Qo("src",i.legInfoDataModel.legIconPath,hs),_e(2),ce(i.legInfoDataModel.distanceText),_e(2),Ve("ngIf","walk"==i.legInfoDataModel.legTemplate)("ngIfThen",a),_e(1),Ve("ngIf","timed"==i.legInfoDataModel.legTemplate)("ngIfThen",r),_e(1),Ve("ngIf","taxi"==i.legInfoDataModel.legTemplate)("ngIfThen",p)}},dependencies:[cc,Go,nx,Ck,gC,eN],styles:[".font-weight-bold[_ngcontent-%COMP%]{font-weight:700}.pill-hover[_ngcontent-%COMP%]:hover, .location-hover[_ngcontent-%COMP%]:hover{cursor:pointer}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}.leg-left-side[_ngcontent-%COMP%]{width:50px}.leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.leg-location[_ngcontent-%COMP%]{background-color:transparent;margin-left:4px}.leg-time-wrapper[_ngcontent-%COMP%]{background-color:transparent}.leg-time[_ngcontent-%COMP%]{font-size:15px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}.booking-arrangement[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:4px}.booking-arrangement[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:0;padding-left:0}.leg-platform-assistance[_ngcontent-%COMP%]{width:30px}.separator[_ngcontent-%COMP%]{width:100%;height:1px;background-color:#dee2e6}.btn-collapse.collapsed[_ngcontent-%COMP%]   .bi-chevron-down[_ngcontent-%COMP%]{display:inline}.btn-collapse[_ngcontent-%COMP%]   .bi-chevron-down[_ngcontent-%COMP%], .btn-collapse.collapsed[_ngcontent-%COMP%]   .bi-chevron-up[_ngcontent-%COMP%]{display:none}.btn-collapse[_ngcontent-%COMP%]   .bi-chevron-up[_ngcontent-%COMP%]{display:inline}.intermediary-stops[_ngcontent-%COMP%]{font-size:14px}.table-stops[_ngcontent-%COMP%]{font-size:13px}.table-stops[_ngcontent-%COMP%]   td.fit[_ngcontent-%COMP%], .table-stops[_ngcontent-%COMP%]   th.fit[_ngcontent-%COMP%]{white-space:nowrap;width:1%}"]}),n})();function VX(n,t){1&n&&(ae(0,"div")(1,"span",8),W(2,"Cancelled"),de()())}function jX(n,t){1&n&&(ae(0,"div")(1,"span",9),W(2,"Infeasable"),de()())}function UX(n,t){1&n&&(ae(0,"div")(1,"span",9),W(2,"Unplanned"),de()())}function HX(n,t){if(1&n&&dn(0,"result-trip-leg",10),2&n){const e=t.$implicit,i=t.index,r=Ot();let a;Ve("leg",e)("legId",r.idx+"_"+i)("legIdx",i)("isLastLeg",r.idx===(null!==(a=null==r.trip||null==r.trip.legs?null:r.trip.legs.length)&&void 0!==a?a:1)-1)}}function GX(n,t){if(1&n&&(ae(0,"li"),W(1),de()),2&n){const e=t.$implicit;_e(1),ze(" Legs ",e.fromTripLegIdRef,"-",e.toTripLegIdRef," : ",e.fareProduct.price," CHF (",e.fareProduct.fareProductName,", ",e.fareProduct.travelClass," class) ")}}let qX=(()=>{class n{constructor(e,i){this.userTripService=e,this.mapService=i,this.tripHeaderStats={}}ngOnInit(){var e;this.trip&&this.initTripHeaderStats(this.trip),this.tripPanel&&0===this.idx&&this.tripPanel.open(),null===(e=this.tripPanel)||void 0===e||e.afterExpand.subscribe(r=>{this.trip&&(this.userTripService.selectActiveTrip(this.trip),this.mapService.zoomToTrip(this.trip))})}initTripHeaderStats(e){var i;this.tripHeaderStats.title="Trip "+((null!==(i=this.idx)&&void 0!==i?i:0)+1),this.tripHeaderStats.isCancelled=!0===e.stats.isCancelled,this.tripHeaderStats.isInfeasable=!0===e.stats.isInfeasable,this.tripHeaderStats.isUnplanned=!0===e.stats.isUnplanned,this.tripHeaderStats.tripChangesInfo=0===e.stats.transferNo?"direct":1===e.stats.transferNo?e.stats.transferNo+" transfer":e.stats.transferNo+" transfers",this.tripHeaderStats.tripFromTime=Ps.formatTimeHHMM(e.stats.startDatetime),this.tripHeaderStats.tripToTime=Ps.formatTimeHHMM(e.stats.endDatetime);const r=n.getDayOffset(e.stats.endDatetime,e.stats.startDatetime);r>0&&(this.tripHeaderStats.tripToTime="(+"+r+"d) "+this.tripHeaderStats.tripToTime),this.tripHeaderStats.tripDurationS=e.stats.duration.formatDuration(),this.tripHeaderStats.tripDistanceS=(()=>{if("DEBUG"!==Na)return Ps.formatDistance(e.stats.distanceMeters);const a="trip"===e.stats.distanceSource?"\u0394":"\u03a3";return Ps.formatDistance(e.stats.distanceMeters)+" "+a})()}static getDayOffset(e,i){return Math.ceil(Math.abs(new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate())).valueOf()-new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())).valueOf())/864e5)}}return n.\u0275fac=function(e){return new(e||n)(le(Ba),le(Sh))},n.\u0275cmp=Ut({type:n,selectors:[["journey-result-row"]],viewQuery:function(e,i){if(1&e&&io(ff,7),2&e){let r;_i(r=bi())&&(i.tripPanel=r.first)}},inputs:{trip:"trip",idx:"idx"},decls:26,vars:12,consts:[[3,"hideToggle"],[1,"d-flex","justify-content-between","w-100","trip-info"],[1,"trip-info-header","d-flex","gap-1"],[4,"ngIf"],[1,"trip-info-header"],[3,"leg","legId","legIdx","isLastLeg",4,"ngFor","ngForOf"],[1,"trip-fares"],[4,"ngFor","ngForOf"],[1,"badge","rounded-pill","bg-danger","fw-bolder"],[1,"badge","rounded-pill","bg-warning","fw-bolder","text-dark"],[3,"leg","legId","legIdx","isLastLeg"]],template:function(e,i){1&e&&(ae(0,"sbb-expansion-panel",0)(1,"sbb-expansion-panel-header")(2,"div",1)(3,"div")(4,"div",2)(5,"div"),W(6),de(),Ct(7,VX,3,0,"div",3),Ct(8,jX,3,0,"div",3),Ct(9,UX,3,0,"div",3),ae(10,"div")(11,"span"),W(12),de()()(),ae(13,"div"),W(14),de()(),ae(15,"div",4)(16,"div"),W(17),de(),ae(18,"div"),W(19),de()()()(),ae(20,"div"),Ct(21,HX,1,4,"result-trip-leg",5),de(),ae(22,"div"),W(23,"Price: "),ae(24,"ul",6),Ct(25,GX,2,5,"li",7),de()()()),2&e&&(Ve("hideToggle",!0),_e(6),ce(i.tripHeaderStats.title),_e(1),Ve("ngIf",!0===i.tripHeaderStats.isCancelled),_e(1),Ve("ngIf",!0===i.tripHeaderStats.isInfeasable),_e(1),Ve("ngIf",!0===i.tripHeaderStats.isUnplanned),_e(3),Se(" - ",i.tripHeaderStats.tripChangesInfo,""),_e(2),me("",i.tripHeaderStats.tripDurationS," - ",i.tripHeaderStats.tripDistanceS,""),_e(3),ce(i.tripHeaderStats.tripFromTime),_e(2),ce(i.tripHeaderStats.tripToTime),_e(2),Ve("ngForOf",null==i.trip?null:i.trip.legs),_e(4),Ve("ngForOf",null==i.trip?null:i.trip.tripFareResults))},dependencies:[cc,Go,ff,Wx,zX],styles:[".trip-info[_ngcontent-%COMP%]{font-size:14px}.trip-info-header[_ngcontent-%COMP%]{font-size:16px}.trip-fares[_ngcontent-%COMP%]{margin-top:2px;margin-bottom:2px}"]}),n})();function $X(n,t){1&n&&dn(0,"span",6)}function WX(n,t){if(1&n){const e=Zr();ae(0,"div",2)(1,"div",3)(2,"button",4),Zt("click",function(){return di(e),oi(Ot().loadPreviousTrips())}),Ct(3,$X,1,0,"span",5),W(4," Earlier connections "),de()()()}if(2&n){const e=Ot();_e(2),Ve("disabled",e.model.isFetchingPrevTrips),_e(1),Ve("ngIf",e.model.isFetchingPrevTrips)}}function XX(n,t){if(1&n&&dn(0,"journey-result-row",7),2&n){const i=t.index;Ve("trip",t.$implicit)("idx",i)}}function ZX(n,t){1&n&&dn(0,"span",6)}function YX(n,t){if(1&n){const e=Zr();ae(0,"div",2)(1,"div",3)(2,"button",4),Zt("click",function(){return di(e),oi(Ot().loadNextTrips())}),Ct(3,ZX,1,0,"span",5),W(4," Later connections "),de()()()}if(2&n){const e=Ot();_e(2),Ve("disabled",e.model.isFetchingNextTrips),_e(1),Ve("ngIf",e.model.isFetchingNextTrips)}}let rN=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.languageService=r,this.model={trips:[],hasPagination:!1,isFetchingPrevTrips:!1,isFetchingNextTrips:!1},this.model.hasPagination=this.computeHasPagination(0)}computeHasPagination(e){return 0!==e&&this.userTripService.hasPublicTransport()}ngOnInit(){this.userTripService.tripsUpdated.subscribe(e=>{this.updatePageModel(e)}),this.userTripService.searchParamsReset.subscribe(()=>{this.updatePageModel([])}),this.userTripService.tripFaresUpdated.subscribe(e=>{this.model.trips.forEach(i=>{i.tripFareResults=[]}),e.forEach(i=>{var r;const a=null!==(r=this.model.trips.find(p=>p.id===i.tripId))&&void 0!==r?r:null;if(null===a)return console.error("ERROR - cant find fare for trip "+i.tripId),console.log(this.model.trips),void console.log(i);a.tripFareResults=i.tripFareResults})})}loadPreviousTrips(){if(0===this.model.trips.length)return;const e=this.model.trips[0].computeDepartureTime();null!==e&&(this.model.isFetchingPrevTrips=!0,this.loadTrips("NumberOfResultsBefore",e))}loadNextTrips(){if(0===this.model.trips.length)return;const i=this.model.trips[this.model.trips.length-1].computeDepartureTime();null!==i&&(this.model.isFetchingNextTrips=!0,this.loadTrips("NumberOfResultsAfter",i))}loadTrips(e,i){const r=this.userTripService.isViaEnabled?this.userTripService.viaTripLocations:[],a=(()=>this.userTripService.hasPublicTransport()?this.userTripService.numberOfResults:null)();let p=null;"NumberOfResultsBefore"===e&&(p=a);let y=null;"NumberOfResultsAfter"===e&&(y=a);const T=this.userTripService.getStageConfig(),P=hd.initWithTripLocationsAndDate(T,this.languageService.language,this.userTripService.fromTripLocation,this.userTripService.toTripLocation,i,this.userTripService.currentBoardingType,!0,this.userTripService.tripModeType,this.userTripService.tripTransportMode,r,null,p,y,this.userTripService.publicTransportModesFilter);null!==P&&(this.userTripService.journeyTripRequests=[P],P.fetchResponse().then(z=>{const H=z.trips;if(this.userTripService.updateTrips(H),this.userTripService.tripRequestFinished.emit(P.requestInfo),H.length>0){const oe=H[0];this.userTripService.selectActiveTrip(oe),this.mapService.zoomToTrip(oe),this.userTripService.fetchFares()}else this.userTripService.selectActiveTrip(null)}))}updatePageModel(e){this.model.trips=e,this.model.hasPagination=this.computeHasPagination(e.length),this.model.isFetchingPrevTrips=!1,this.model.isFetchingNextTrips=!1}}return n.\u0275fac=function(e){return new(e||n)(le(Ba),le(Sh),le(Th))},n.\u0275cmp=Ut({type:n,selectors:[["journey-results"]],decls:4,vars:3,consts:[["class","row",4,"ngIf"],[3,"trip","idx",4,"ngFor","ngForOf"],[1,"row"],[1,"col","text-center","link-connection"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[3,"trip","idx"]],template:function(e,i){1&e&&(Ct(0,WX,5,2,"div",0),ae(1,"sbb-accordion"),Ct(2,XX,1,2,"journey-result-row",1),de(),Ct(3,YX,5,2,"div",0)),2&e&&(Ve("ngIf",i.model.hasPagination),_e(2),Ve("ngForOf",i.model.trips),_e(1),Ve("ngIf",i.model.hasPagination))},dependencies:[cc,Go,fC,qX],styles:[".link-connection[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}"]}),n})();class xu{static FilterBeelines(){return this.FilterByDrawType("Beeline")}static FilterWalkingLegs(){return["all",this.FilterByDrawType("LegLine"),this.FilterByLineType("Walk")]}static FilterLegPoints(){return this.FilterByDrawType("LegPoint")}static ColorCaseByLegLineType(){const t=["case"];return d9.forEach(e=>{t.push(["==",["get",$s.LineType],e]),t.push(Fm[e])}),t.push("#FF1493"),t}static FilterByDrawType(t){return["==",["get",$s.DrawType],t]}static FilterByPointType(t){return["==",["get",$s.PointType],t]}static FilterByLineType(t){return["==",["get",$s.LineType],t]}static FilterTimedLegTracks(){return["all",this.FilterByDrawType("LegLine")]}static ColorCaseByLegType(){const t=["case"];return u9.forEach(e=>{t.push(["==",["get",$s.LegType],e]),t.push(Y3[e])}),t.push("#FF1493"),t}}const KX=JSON.parse('{"id":"ojp-trip-leg-beeline","type":"line","source":"[SOURCE]","filter":["[CASE_FILTER_BY_DRAW_TYPE]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":0.4,"line-color":["[CASE_COLOR_BY_LEG_TYPE]"]}}'),JX=JSON.parse('{"id":"ojp-trip-timed-leg-point-circle","type":"circle","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegPoint]"],"layout":{},"paint":{"circle-radius":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",8,"OTHERWISE",2],"circle-color":["IF POINT_TYPE: TO","COLOR BY TIMED_LEG","OTHERWISE","#FFF"],"circle-stroke-color":["IF POINT_TYPE: TO","#FFF","OTHERWISE","COLOR BY TIMED_LEG"],"circle-stroke-width":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",1,"OTHERWISE",3]}}'),QX=JSON.parse('{"id":"ojp-trip-timed-leg-track","type":"line","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegLine]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":1,"line-color":["[CASE COLOR BY TIMED_LEG"]}}'),eZ=JSON.parse('{"id":"ojp-trip-walking-leg-line","type":"line","source":"[SOURCE]","filter":["all","[FILTER BY DRAW_TYPE == ContinousLegLine]","[FILTER BY LINE_TYPE == Walk]"],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#009933","line-width":4,"line-dasharray":[0.2,2]}}');class tZ{constructor(t){this.mapSourceId="trip-data",this.features=[],this.map=t,this.addMapSourceAndLayers()}renderTrip(t){if(t){const e=this.computeGeoJSON(t);this.setSourceFeatures(e.features)}else this.removeAllFeatures()}addMapSourceAndLayers(){this.map.addSource(this.mapSourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const t=KX;t.filter=xu.FilterBeelines(),t.paint&&(t.paint["line-color"]=xu.ColorCaseByLegLineType());const e=xu.ColorCaseByLegLineType(),i=JX;if(i.filter=xu.FilterLegPoints(),i.paint){const y=["case",xu.FilterByPointType("From"),4,xu.FilterByPointType("To"),8,2];i.paint["circle-radius"]=y;const T=["case",xu.FilterByPointType("To"),e,"#FFF"];i.paint["circle-color"]=T;const P=["case",xu.FilterByPointType("To"),"#FFF",e];i.paint["circle-stroke-color"]=P;const z=["case",xu.FilterByPointType("From"),4,xu.FilterByPointType("To"),1,3];i.paint["circle-stroke-width"]=z}const r=QX;r.filter=xu.FilterTimedLegTracks(),r.paint&&(r.paint["line-color"]=e);const a=eZ;a.filter=xu.FilterWalkingLegs(),a.paint&&(a.paint["line-color"]=Y3.ContinousLeg),[t,r,a,i].forEach(y=>{const T=y;T.source=this.mapSourceId,this.map.addLayer(T)})}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceId).setData({type:"FeatureCollection",features:t})}computeGeoJSON(t){let e=[];return t.legs.forEach((r,a)=>{const y=new $x(r,a).computeGeoJSONFeatures();e=e.concat(y)}),{type:"FeatureCollection",features:e}}}let nZ=(()=>{class n{constructor(e,i,r,a){this.userTripService=e,this.languageService=i,this.mapService=r,this.debugXmlPopover=a,this.fromMarker=new(da().Marker),this.toMarker=new(da().Marker),["From","To"].forEach(y=>{var T=document.createElement("div");T.className="marker-journey-endpoint marker-journey-endpoint-"+y;const P=new(da().Marker)({element:T,draggable:!0,anchor:"bottom"});P.on("dragend",z=>{this.handleMarkerDrag(P,y)}),"From"===y&&(this.fromMarker=P),"To"===y&&(this.toMarker=P)}),this.viaMarkers=[],this.mapLoadingPromise=null,this.popupContextMenu=new(da().Popup)({focusAfterOpen:!1}),this.tripRenderController=null}ngOnInit(){this.userTripService.geoLocationsUpdated.subscribe(e=>{this.updateMarkers()}),this.userTripService.activeTripSelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var a;null===(a=this.tripRenderController)||void 0===a||a.renderTrip(e)})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToBounds(r,e)})}),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToLocation(r,e)})}),this.initMap()}ngAfterViewInit(){var e;null===(e=this.mapLoadingPromise)||void 0===e||e.then(i=>{i.resize()})}initMap(){const e=this.mapService.createMap("map_canvas");this.mapLoadingPromise=new Promise((i,r)=>{e.on("load",a=>{i(e),this.onMapLoad(e)})})}updateMarkers(){["From","To"].forEach(i=>{var r;const a="From"===i,p=a?this.userTripService.fromTripLocation:this.userTripService.toTripLocation;this.updateMarkerLocation(a?this.fromMarker:this.toMarker,null!==(r=null==p?void 0:p.location)&&void 0!==r?r:null)}),this.userTripService.isViaEnabled?this.userTripService.viaTripLocations.forEach((i,r)=>{var a;let p=null!==(a=this.viaMarkers[r])&&void 0!==a?a:null;null===p&&(p=this.createViaMarker(i.location,r),this.viaMarkers.push(p)),this.updateMarkerLocation(p,i.location)}):(this.viaMarkers.forEach(i=>{i.remove()}),this.viaMarkers=[])}handleMarkerDrag(e,i){const r=e.getLngLat();let a=Ko.initWithLngLat(r.lng,r.lat);this.userTripService.updateTripEndpoint(a,i,"MapDragend")}onMapLoad(e){this.mapService.addControls(e,this.debugXmlPopover,this.userTripService,this.languageService),e.on("contextmenu",i=>{this.showPickupPopup(e,i.lngLat)}),e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(a,p)=>{a?console.error(a):!e.hasImage(i.id)&&p&&e.addImage(i.id,p)})}),this.tripRenderController=new tZ(e)}showPickupPopup(e,i){let r=document.getElementById("map-endpoint-coords-picker-popup").innerHTML;const a=wh.formatMapboxLngLatAsLatLng(i);r=r.replace("[PICKER_COORDS]",a);const p=document.createElement("div");p.innerHTML=r,p.addEventListener("click",y=>{const P=y.target.getAttribute("data-endpoint-type");if(null===P)return;const z=Ko.initWithLngLat(i.lng,i.lat);this.userTripService.updateTripEndpoint(z,P,"MapPopupClick"),this.popupContextMenu.remove()}),this.popupContextMenu.setLngLat(i).setDOMContent(p).addTo(e)}updateMarkerLocation(e,i){var r,a,p;const y=null!==(a=null===(r=null==i?void 0:i.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==a?a:null;if(null===y)return void e.remove();const T=void 0===e.getLngLat();e.setLngLat(y),T&&(null===(p=this.mapLoadingPromise)||void 0===p||p.then(P=>{e.addTo(P)}))}createViaMarker(e,i){var r;const a=document.createElement("div");a.className="marker-journey-endpoint marker-journey-endpoint-Via";let p=!1;null===(null===(r=e.geoPosition)||void 0===r?void 0:r.properties)&&(p=!0);const y=new(da().Marker)({element:a,anchor:"bottom",draggable:p});return y.on("dragend",T=>{const P=y.getLngLat();let z=Ko.initWithLngLat(P.lng,P.lat);this.userTripService.updateViaPoint(z,i)}),y}}return n.\u0275fac=function(e){return new(e||n)(le(Ba),le(Th),le(Sh),le(wl))},n.\u0275cmp=Ut({type:n,selectors:[["app-map"]],decls:48,vars:0,consts:[["id","map_canvas",1,"map_wrapper"],[1,"d-none"],["id","map-endpoint-coords-picker-popup"],[1,"popup-picker","p-2"],[1,"popup-picker-header","mb-2"],[1,"popup-picker-body"],["type","button","data-endpoint-type","From",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","To",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","Via",1,"btn","btn-primary","btn-sm"],["id","map-endpoint-stop-picker-popup"],["id","map-endpoint-picker-popup"],["id","map-poi-picker-popup"]],template:function(e,i){1&e&&(dn(0,"div",0),ae(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),W(5," Coords: [PICKER_COORDS] "),de(),ae(6,"div",5)(7,"button",6),W(8,"From"),de(),ae(9,"button",7),W(10,"To"),de(),ae(11,"button",8),W(12,"Via"),de()()()(),ae(13,"div",9)(14,"div",3)(15,"div",4),W(16," [STOP_NAME] ([STOP_ID]) "),de(),ae(17,"div",5)(18,"button",6),W(19,"From"),de(),ae(20,"button",7),W(21,"To"),de(),ae(22,"button",8),W(23,"Via"),de()()()(),ae(24,"div",10)(25,"div",3)(26,"div",4),W(27," TYPE: [GEO_RESTRICTION_TYPE] "),de(),ae(28,"div",5),W(29," [GEOJSON_PROPERTIES_TABLE] "),ae(30,"button",6),W(31,"From"),de(),ae(32,"button",7),W(33,"To"),de(),ae(34,"button",8),W(35,"Via"),de()()()(),ae(36,"div",11)(37,"div",3)(38,"div",4),W(39," [POI_NAME] "),de(),ae(40,"div",5),W(41," [GEOJSON_PROPERTIES_TABLE] "),ae(42,"button",6),W(43,"From"),de(),ae(44,"button",7),W(45,"To"),de(),ae(46,"button",8),W(47,"Via"),de()()()()())},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}.popup-picker-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"]}),n})();class oN{static computeExecutionTime(t,e){return null===t||null===e?0:(e.getTime()-t.getTime())/1e3}}function iZ(n,t){1&n&&dn(0,"span",10)}let rZ=(()=>{class n{constructor(e){this.userTripService=e,this.tripCustomRequestSaved=new Cn,this.tripCustomResponseSaved=new Cn,this.inputTripRequestXML="... loading",this.inputTripRequestResponseXML="Paste custom OJP TripRequest Response XML here...",this.isRunningTripRequest=!1}parseCustomRequestXML(){this.isRunningTripRequest=!0;const e=this.userTripService.getStageConfig(),i=hd.initWithRequestMock(this.inputTripRequestXML,e);i.fetchResponse().then(r=>{if("ERROR"===r.message)return console.error("ERROR fetching OJP response"),void console.log(r);const a=i.requestInfo.responseXML;if(null===a)return console.error("ERROR parsing OJP response"),void console.log(i);this.tripCustomRequestSaved.emit(a)})}parseCustomResponseXML(){this.tripCustomResponseSaved.emit(this.inputTripRequestResponseXML)}}return n.\u0275fac=function(e){return new(e||n)(le(Ba))},n.\u0275cmp=Ut({type:n,selectors:[["input-xml-popover"]],outputs:{tripCustomRequestSaved:"tripCustomRequestSaved",tripCustomResponseSaved:"tripCustomResponseSaved"},decls:26,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptriprequest/"],["rows","10",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(ae(0,"div",0),W(1,"Custom Trip Request / Response XML"),de(),ae(2,"div",1)(3,"div")(4,"div",2)(5,"div"),W(6,"Trip Request XML"),de(),ae(7,"div")(8,"a",3),W(9,"Cookbook opentransportdata.swiss"),de()()(),ae(10,"textarea",4),Zt("ngModelChange",function(a){return i.inputTripRequestXML=a}),de(),ae(11,"div",5)(12,"button",6),Zt("click",function(){return i.parseCustomRequestXML()}),Ct(13,iZ,1,0,"span",7),W(14," Execute OJPTripRequest "),de()(),dn(15,"hr"),ae(16,"div",2)(17,"div"),W(18,"Trip Request Response XML"),de()(),ae(19,"textarea",4),Zt("ngModelChange",function(a){return i.inputTripRequestResponseXML=a}),de(),ae(20,"div",5)(21,"button",6),Zt("click",function(){return i.parseCustomResponseXML()}),W(22," Display Trips "),de()()()(),ae(23,"div",8)(24,"button",9),W(25," Close "),de()()),2&e&&(_e(10),Ve("ngModel",i.inputTripRequestXML),_e(2),Ve("disabled",i.isRunningTripRequest),_e(1),Ve("ngIf",i.isRunningTripRequest),_e(6),Ve("ngModel",i.inputTripRequestResponseXML),_e(2),Ve("disabled",i.isRunningTripRequest))},dependencies:[Go,yu,sd,fh,Om,R_,k_,P_],encapsulation:2}),n})();const oZ=["input"],sZ=["*"],aZ=new Qt("sbb-checkbox-default-options",{providedIn:"root",factory:function sN(){return{clickAction:"check-indeterminate"}}});const lZ={provide:Fa,useExisting:dr(()=>cZ),multi:!0};let cZ=(()=>{class n extends ZI{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["sbb-checkbox","required","","formControlName",""],["sbb-checkbox","required","","formControl",""],["sbb-checkbox","required","","ngModel",""]],features:[wi([lZ]),zn]}),n})(),uZ=0;const dZ={clickAction:"check-indeterminate"},hZ={provide:Vl,useExisting:dr(()=>AA),multi:!0};class pZ{}const fZ=jy(Ul(class{}));let aN=(()=>{class n extends fZ{constructor(e,i,r,a,p){super(),this._elementRef=e,this._changeDetectorRef=i,this._focusMonitor=r,this._options=p,this.ariaLabel="",this.ariaLabelledby=null,this._uniqueId="sbb-checkbox-"+ ++uZ,this.id=this._uniqueId,this.labelPosition="after",this.name=null,this.change=new Cn,this.indeterminateChange=new Cn,this._onTouched=()=>{},this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||dZ,this.tabIndex=parseInt(a,10)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(e){this._required=Si(e)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{e||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(e){const i=Si(e);i!==this.checked&&(this._checked=i,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){const i=Si(e);i!==this.disabled&&(this._disabled=i,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(e){const i=e!==this._indeterminate;this._indeterminate=Si(e),i&&this.indeterminateChange.emit(this._indeterminate),this._syncIndeterminate(this._indeterminate)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(e){this.checked=!!e}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_getAriaChecked(){return this.checked?"true":this.indeterminate?"mixed":"false"}_emitChangeEvent(){const e=new pZ;e.source=this,e.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(e)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_onInputClick(e){var i;const r=null===(i=this._options)||void 0===i?void 0:i.clickAction;e.stopPropagation(),this.disabled||"noop"===r?!this.disabled&&"noop"===r&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==r&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._emitChangeEvent())}focus(e,i){e?this._focusMonitor.focusVia(this._inputElement,e,i):this._inputElement.nativeElement.focus(i)}_onInteractionEvent(e){e.stopPropagation()}_syncIndeterminate(e){const i=this._inputElement;i&&(i.nativeElement.indeterminate=e)}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(lo),le(yl),us("tabindex"),le(aZ,8))},n.\u0275dir=cn({type:n,viewQuery:function(e,i){if(1&e&&io(oZ,5),2&e){let r;_i(r=bi())&&(i._inputElement=r.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},features:[zn]}),n})(),AA=(()=>{class n extends aN{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wr(n)))(i||n)}}(),n.\u0275cmp=Ut({type:n,selectors:[["sbb-checkbox"]],hostAttrs:[1,"sbb-checkbox","sbb-selection-item"],hostVars:10,hostBindings:function(e,i){2&e&&(Jr("id",i.id),Yn("tabindex",null)("aria-label",null)("aria-labelledby",null),l("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckbox"],features:[wi([hZ]),zn],ngContentSelectors:sZ,decls:11,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content",3,"cdkObserveContent"],[2,"display","none"]],template:function(e,i){1&e&&(ss(),ae(0,"label",0)(1,"input",1,2),Zt("change",function(a){return i._onInteractionEvent(a)})("click",function(a){return i._onInputClick(a)}),de(),ae(3,"div",3)(4,"span",4),Is(),ae(5,"svg",5),dn(6,"polyline",6),de()()(),Ld(),ae(7,"div",7),Zt("cdkObserveContent",function(){return i._onLabelTextChange()}),ae(8,"span",8),W(9,"\xa0"),de(),Yr(10),de()()),2&e&&(Yn("for",i.inputId),_e(1),Ve("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),Yn("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},dependencies:[IF],encapsulation:2,changeDetection:0}),n})(),lN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[zT,Pr]}),n})(),mZ=(()=>{class n{constructor(e){var i,r;this.userTripService=e,this.embedHTMLs="n/a",this.fromLocationText="",this.toLocationText="",this.fromLocationChecked=!1,this.toLocationChecked=!0,this.fromLocationText=n.computeLocationText(null===(i=e.fromTripLocation)||void 0===i?void 0:i.location),this.toLocationText=n.computeLocationText(null===(r=e.toTripLocation)||void 0===r?void 0:r.location),this.updateEmbedHTML()}static computeLocationText(e){var i,r,a,p,y;if(!e)return"";const T=e.getLocationType();if("stop"===T)return e.computeLocationName()+"(stopRef "+(null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"")+")";const P=e.geoPosition;return P?(null!==(a=e.computeLocationName())&&void 0!==a?a:"")+"(coords "+(null!==(p=P.asLatLngString(!0))&&void 0!==p?p:"")+")":T+" - "+(null!==(y=e.computeLocationName())&&void 0!==y?y:"")}updateEmbedHTML(){const e=new URLSearchParams;["from","to"].forEach(a=>{const p=(()=>{if("from"===a?this.fromLocationChecked:this.toLocationChecked){const T=this.userTripService.embedQueryParams.get(a);if(null!==T)return T}return""})();e.append(a,p)});const i=document.location.pathname.replace("/search","/embed/search")+"?"+e.toString(),r=document.location.protocol+"//"+document.location.host+i;this.embedHTMLs='<iframe src="'+r+'" width="100%" height="100%" frameBorder="0"></iframe>'}}return n.\u0275fac=function(e){return new(e||n)(le(Ba))},n.\u0275cmp=Ut({type:n,selectors:[["embed-search-popover"]],decls:20,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[3,"ngModel","ngModelChange","change"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(ae(0,"div",0),W(1,"Embed journey in another website"),de(),ae(2,"div",1)(3,"div",2)(4,"p"),W(5,"Select which journey endpoints should be prefilled:"),de(),ae(6,"div")(7,"div")(8,"sbb-checkbox",3),Zt("ngModelChange",function(a){return i.fromLocationChecked=a})("change",function(){return i.updateEmbedHTML()}),W(9),de()(),ae(10,"div")(11,"sbb-checkbox",3),Zt("ngModelChange",function(a){return i.toLocationChecked=a})("change",function(){return i.updateEmbedHTML()}),W(12),de()()(),ae(13,"p"),W(14,"Copy the following code in the target webpage"),de(),ae(15,"textarea",4),W(16),de()()(),ae(17,"div",5)(18,"button",6),W(19," Close "),de()()),2&e&&(_e(8),Ve("ngModel",i.fromLocationChecked),_e(1),Se("(From) ",i.fromLocationText,""),_e(2),Ve("ngModel",i.toLocationChecked),_e(1),Se("(To) ",i.toLocationText,""),_e(4),ce(i.embedHTMLs))},dependencies:[sd,fh,AA,Om,R_,k_,P_],encapsulation:2}),n})();function gZ(n,t){}const cN=new Qt("SbbNotificationToastData");class _C{constructor(){this.politeness="assertive",this.duration=0,this.data=null,this.verticalPosition="bottom",this.type="success"}}const _Z={notificationState:ya("state",[oo("void, hidden",mi({transform:"scale(0.8)",opacity:0})),oo("visible",mi({transform:"scale(1)",opacity:1})),kr("* => visible",zr("150ms cubic-bezier(0, 0, 0.2, 1)")),kr("* => void, * => hidden",zr("75ms cubic-bezier(0.4, 0.0, 1, 1)",mi({opacity:0})))])};let bZ=(()=>{class n extends Ox{constructor(e,i,r,a){super(),this._ngZone=e,this._elementRef=i,this._changeDetectorRef=r,this.config=a,this._destroyed=!1,this._onExit=new fn,this._onEnter=new fn,this._animationState="void",this.attachDomPortal=p=>{this._assertNotAttached();const y=this._portalOutlet.attachDomPortal(p);return this._afterPortalAttached(),y},this._role="assertive"!==a.politeness||a.announcementMessage?"off"===a.politeness?null:"status":"alert"}get _svgIcon(){switch(this.config.type){case"success":return"kom:tick-small";case"error":case"warn":return"kom:sign-exclamation-point-small";default:return"kom:circle-information-small"}}attachComponentPortal(e){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}onAnimationEnd(e){const{fromState:i,toState:r}=e;if(("void"===r&&"void"!==i||"hidden"===r)&&this._completeExit(),"visible"===r){const a=this._onEnter;this._ngZone.run(()=>{a.next(),a.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("sbb-exit",""),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(ko(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){const e=this._elementRef.nativeElement,i=this.config.panelClass;i&&(Array.isArray(i)?i.forEach(r=>e.classList.add(r)):e.classList.add(i)),e.classList.add("sbb-notification-toast-center")}_assertNotAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach notification content after content is already attached")}}return n.\u0275fac=function(e){return new(e||n)(le(Oi),le(ei),le(lo),le(_C))},n.\u0275dir=cn({type:n,viewQuery:function(e,i){if(1&e&&io(bh,7),2&e){let r;_i(r=bi())&&(i._portalOutlet=r.first)}},features:[zn]}),n})(),yZ=(()=>{class n extends bZ{_afterPortalAttached(){super._afterPortalAttached(),"top"===this.config.verticalPosition&&this._elementRef.nativeElement.classList.add("sbb-notification-toast-top")}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wr(n)))(i||n)}}(),n.\u0275cmp=Ut({type:n,selectors:[["sbb-notification-toast-container"]],hostAttrs:[1,"sbb-notification-toast"],hostVars:10,hostBindings:function(e,i){1&e&&dm("@state.done",function(a){return i.onAnimationEnd(a)}),2&e&&(Yn("role",i._role),as("@state",i._animationState),l("sbb-notification-toast-success","success"===i.config.type)("sbb-notification-toast-info","info"===i.config.type)("sbb-notification-toast-warn","warn"===i.config.type)("sbb-notification-toast-error","error"===i.config.type))},features:[zn],decls:6,vars:1,consts:[[1,"sbb-notification-toast-icon-wrapper","sbb-icon-fit"],[3,"svgIcon"],[1,"sbb-notification-toast-content"],["cdkPortalOutlet",""],["type","button",1,"sbb-notification-toast-icon-wrapper","sbb-notification-toast-icon-close-wrapper","sbb-icon-fit",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(ae(0,"span",0),dn(1,"sbb-icon",1),de(),ae(2,"div",2),Ct(3,gZ,0,0,"ng-template",3),de(),ae(4,"button",4),Zt("click",function(){return i.exit()}),dn(5,"sbb-icon",5),de()),2&e&&(_e(1),Ve("svgIcon",i._svgIcon))},dependencies:[bh,vl],styles:[".sbb-notification-toast{display:flex;min-height:calc(3.2rem * var(--sbb-scaling-factor));border-radius:var(--sbb-border-radius);color:var(--sbb-color-white);background-color:var(--sbb-color-background);font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:calc(0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin));padding-bottom:calc(\n    0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin) - var(\n        --sbb-line-height\n      ) + var(--sbb-icon-size-default)\n  );margin:calc(1.3333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-notification-toast{padding-bottom:calc(\n      0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin)\n    )}.sbb-notification-toast-mobile .sbb-notification-toast{margin:calc(0.5333333333rem * var(--sbb-scaling-factor));max-width:100%;min-width:0;width:100%}.sbb-notification-toast-mobile{width:100%}.sbb-notification-toast-error{background-color:var(--sbb-color-error)}:is(.sbb-notification-toast-error,.sbb-notification-toast-error :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-success{border:var(--sbb-border-width-thin) solid var(--sbb-color-green)}:is(.sbb-notification-toast-success,.sbb-notification-toast-success :is(a,button)){color:var(--sbb-color-green)}.sbb-notification-toast-info{border:var(--sbb-border-width-thin) solid var(--sbb-color-granite)}:is(.sbb-notification-toast-info,.sbb-notification-toast-info :is(a,button)){color:var(--sbb-color-granite)}.sbb-notification-toast-warn{background-color:var(--sbb-color-orange)}:is(.sbb-notification-toast-warn,.sbb-notification-toast-warn :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-content{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-right:calc(1.6rem * var(--sbb-scaling-factor))}.sbb-notification-toast-icon-wrapper{min-width:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);margin-left:calc(1.0666666667rem * var(--sbb-scaling-factor));border:none;background:none;padding:0;align-self:flex-start}.sbb-notification-toast-icon-close-wrapper{cursor:pointer;margin-left:auto;margin-right:calc(1.4666666667rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[_Z.notificationState]}}),n})();const vZ=Math.pow(2,31)-1;class RA{constructor(t,e){this._overlayRef=e,this._afterDismissed=new fn,this._afterOpened=new fn,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,vZ))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._afterDismissed.next(null),this._afterDismissed.complete()}afterDismissed(){return this._afterDismissed.asObservable()}afterOpened(){return this.containerInstance._onEnter}}let xZ=(()=>{class n{constructor(e,i){this.notificationToastRef=e,this.data=i}dismiss(){this.notificationToastRef.dismiss()}}return n.\u0275fac=function(e){return new(e||n)(le(RA),le(cN))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-simple-notification"]],decls:2,vars:1,template:function(e,i){1&e&&(ae(0,"span"),W(1),de()),2&e&&(_e(1),ce(i.data.message))},encapsulation:2,changeDetection:0}),n})(),kA=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,il,uc,Pr,cs]}),n})();const wZ=new Qt("notification-default-options",{providedIn:"root",factory:function SZ(){return new _C}});let PA=(()=>{class n{constructor(e,i,r,a,p,y){this._overlay=e,this._injector=i,this._live=r,this._breakpointObserver=a,this._parentNotification=p,this._defaultConfig=y,this._notificationRefAtThisLevel=null,this._simpleNotificationToastComponent=xZ,this._notificationToastContainerComponent=yZ,this._mobileDeviceCssClass="sbb-notification-toast-mobile"}get _openedNotificationRef(){const e=this._parentNotification;return e?e._openedNotificationRef:this._notificationRefAtThisLevel}set _openedNotificationRef(e){this._parentNotification?this._parentNotification._openedNotificationRef=e:this._notificationRefAtThisLevel=e}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i){const r=Object.assign(Object.assign({},this._defaultConfig),i);return r.data={message:e},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this._simpleNotificationToastComponent,r)}dismiss(){this._openedNotificationRef&&this._openedNotificationRef.dismiss()}ngOnDestroy(){this._notificationRefAtThisLevel&&this._notificationRefAtThisLevel.dismiss()}_attachNotificationToastContainer(e,i){var r;const a=null===(r=null==i?void 0:i.viewContainerRef)||void 0===r?void 0:r.injector,p=new $F(a||this._injector,new WeakMap([[_C,i]])),y=new _h(this._notificationToastContainerComponent,i.viewContainerRef,p),T=e.attach(y);return T.instance.config=i,T.instance}_attach(e,i){const r=Object.assign(Object.assign(Object.assign({},new _C),this._defaultConfig),i),a=this._createOverlay(r),p=this._attachNotificationToastContainer(a,r),y=new RA(p,a);if(e instanceof Yo){const T=new D_(e,null,{$implicit:r.data,notificationRef:y});y.instance=p.attachTemplatePortal(T)}else{const T=this._createInjector(r,y),P=new _h(e,void 0,T),z=p.attachComponentPortal(P);y.instance=z.instance}return this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait)").pipe(br(a.detachments())).subscribe(T=>{const P=a.overlayElement.classList;T.matches?P.add(this._mobileDeviceCssClass):P.remove(this._mobileDeviceCssClass)}),this._animateNotification(y,r),this._openedNotificationRef=y,this._openedNotificationRef}_animateNotification(e,i){e.afterDismissed().subscribe(()=>{this._openedNotificationRef===e&&(this._openedNotificationRef=null),i.announcementMessage&&this._live.clear()}),this._openedNotificationRef?(this._openedNotificationRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedNotificationRef.dismiss()):e.containerInstance.enter(),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),i.announcementMessage&&this._live.announce(i.announcementMessage,i.politeness)}_createOverlay(e){const i=new M_,r=this._overlay.position().global();return r.centerHorizontally(),"top"===e.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(e,i){var r;const a=null===(r=null==e?void 0:e.viewContainerRef)||void 0===r?void 0:r.injector;return new $F(a||this._injector,new WeakMap([[RA,i],[cN,e.data]]))}}return n.\u0275fac=function(e){return new(e||n)(mt(Ls),mt(jo),mt(UF),mt(NM),mt(n,12),mt(wZ))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:kA}),n})();const TZ=["sbb-button",""];function CZ(n,t){1&n&&dn(0,"sbb-icon",2),2&n&&Ve("svgIcon",Ot().svgIcon)}function DZ(n,t){1&n&&dn(0,"sbb-icon",3),2&n&&Ve("svgIcon",Ot().svgIcon)}const EZ=["*"],IZ=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button","sbb-frameless-button","sbb-link"],MZ=["sbb-button","sbb-secondary-button","sbb-frameless-button","sbb-link"],AZ=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button"],uN={"sbb-button":"kom:arrow-right-small","sbb-secondary-button":"kom:arrow-right-small","sbb-frameless-button":"kom:plus-small","sbb-link":"kom:arrow-right-small"},RZ=Ul(I_(class{constructor(n){this._elementRef=n}}));let LA=(()=>{class n extends RZ{constructor(e,i,r,a){super(e),this._focusMonitor=i,this._animationMode=r,this._contentObserver=a,this._hasIconIndicator=this._hasHostAttributes(...MZ),this._hasIconButtonClass=!1,this._iconRefs=new r_;for(const p of IZ)this._hasHostAttributes(p)&&(this._getHostElement().classList.add(p),p in uN&&(this.svgIcon=uN[p]));e.nativeElement.classList.add("sbb-button-base")}ngAfterContentInit(){var e,i;const r=null!==(i=null===(e=this._contentObserver)||void 0===e?void 0:e.observe(this._elementRef))&&void 0!==i?i:this._iconRefs.changes;this._isIconButton=null==r?void 0:r.pipe(va([]),ge(()=>this._hasHostAttributes(...AZ)&&""===this._elementRef.nativeElement.textContent.trim()&&1===this._iconRefs.length)),this._isIconButton.subscribe(a=>this._hasIconButtonClass=a),this._leftIconVisible=h_([this.variant,this._isIconButton]).pipe(ge(([a,p])=>!p&&"standard"===a&&this._hasIconIndicator)),this._rightIconVisible=h_([this.variant,this._isIconButton]).pipe(ge(([a,p])=>!p&&("standard"===a&&this._hasIconIndicator||"lean"===a&&this._hasHostAttributes("sbb-link"))))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,i){e?this._focusMonitor.focusVia(this._getHostElement(),e,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_hasHostAttributes(...e){return e.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(yl),le(ch,8),le(EF,8))},n.\u0275cmp=Ut({type:n,selectors:[["button","sbb-button",""],["button","sbb-alt-button",""],["button","sbb-secondary-button",""],["button","sbb-ghost-button",""],["button","sbb-frameless-button",""],["button","sbb-link",""]],contentQueries:function(e,i,r){if(1&e&&Ro(r,vl,4,ei),2&e){let a;_i(a=bi())&&(i._iconRefs=a)}},hostVars:7,hostBindings:function(e,i){2&e&&(Yn("disabled",i.disabled||null),l("_sbb-animation-noopable","NoopAnimations"===i._animationMode)("sbb-disabled",i.disabled)("sbb-icon-button",i._hasIconButtonClass))},inputs:{disabled:"disabled",svgIcon:"svgIcon"},exportAs:["sbbButton"],features:[zn],attrs:TZ,ngContentSelectors:EZ,decls:5,vars:6,consts:[["class","sbb-button-indicator-icon sbb-button-left-icon",3,"svgIcon",4,"ngIf"],["class","sbb-button-indicator-icon sbb-button-right-icon",3,"svgIcon",4,"ngIf"],[1,"sbb-button-indicator-icon","sbb-button-left-icon",3,"svgIcon"],[1,"sbb-button-indicator-icon","sbb-button-right-icon",3,"svgIcon"]],template:function(e,i){1&e&&(ss(),Ct(0,CZ,1,1,"sbb-icon",0),gy(1,"async"),Yr(2),Ct(3,DZ,1,1,"sbb-icon",1),gy(4,"async")),2&e&&(Ve("ngIf",_y(1,2,i._leftIconVisible)&&i.svgIcon),_e(3),Ve("ngIf",_y(4,4,i._rightIconVisible)&&i.svgIcon))},dependencies:[Go,vl,ix],encapsulation:2,changeDetection:0}),n})(),OA=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr,cs]}),n})();const PZ=["connectionContainer"];function LZ(n,t){if(1&n&&(Uo(0),ae(1,"span"),W(2),de(),Zo()),2&n){const e=Ot();_e(2),ce(e.label)}}function OZ(n,t){1&n&&Yr(0,1,["*ngSwitchCase","true"])}function FZ(n,t){1&n&&Yr(0,2,["*ngIf","_hasErrors()"])}const NZ=["*",[["sbb-label"]],[["sbb-error"],["","sbbError",""]]],BZ=["*","sbb-label","sbb-error,[sbbError]"];let zZ=0;const dN=new Qt("SbbError");let VZ=(()=>{class n{constructor(e,i){this.id="sbb-error-"+zZ++,e||i.nativeElement.setAttribute("aria-live","polite")}}return n.\u0275fac=function(e){return new(e||n)(us("aria-live"),le(ei))},n.\u0275dir=cn({type:n,selectors:[["sbb-error"],["","sbbError",""]],hostAttrs:["aria-atomic","true",1,"sbb-error"],hostVars:1,hostBindings:function(e,i){2&e&&Yn("id",i.id)},inputs:{id:"id"},features:[wi([{provide:dN,useExisting:n}])]}),n})();class Xx{}let Zx=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["sbb-label"]],hostAttrs:[1,"sbb-label"]}),n})(),jZ=0;const bC=new Qt("SBB_FORM_FIELD");let Xy=(()=>{class n{constructor(e,i){this._elementRef=e,this._changeDetectorRef=i,this._destroyed=new fn,this._labelId="sbb-form-field-label-"+jZ++}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(e){this._explicitFormFieldControl=e}getLabelId(){return this._hasLabel()||this.label?this._labelId:null}ngAfterContentInit(){this._validateControlChild();const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`sbb-form-field-type-${e.controlType}`),e.stateChanges.pipe(va(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(br(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._errorChildren.changes.pipe(va(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()})}ngAfterContentChecked(){this._validateControlChild()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(e){const i=this._control?this._control.ngControl:null;return i&&i[e]}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_hasErrors(){return!!(this._errorChildren&&this._errorChildren.length&&this._control.errorState)}_syncDescribedByIds(){if(this._control){const e=[];this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),this._errorChildren&&e.push(...this._errorChildren.map(i=>i.id)),this._control.setDescribedByIds(e)}}_validateControlChild(){}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(lo))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-form-field"]],contentQueries:function(e,i,r){if(1&e&&(Ro(r,Xx,5),Ro(r,Xx,7),Ro(r,Zx,5),Ro(r,Zx,7),Ro(r,dN,5)),2&e){let a;_i(a=bi())&&(i._controlNonStatic=a.first),_i(a=bi())&&(i._controlStatic=a.first),_i(a=bi())&&(i._labelChildNonStatic=a.first),_i(a=bi())&&(i._labelChildStatic=a.first),_i(a=bi())&&(i._errorChildren=a)}},viewQuery:function(e,i){if(1&e&&io(PZ,7),2&e){let r;_i(r=bi())&&(i._connectionContainerRef=r.first)}},hostAttrs:[1,"sbb-form-field"],hostVars:20,hostBindings:function(e,i){2&e&&l("sbb-form-field-invalid",null==i._control?null:i._control.errorState)("sbb-form-field-disabled",null==i._control?null:i._control.disabled)("sbb-focused",null==i._control?null:i._control.focused)("ng-untouched",i._shouldForward("untouched"))("ng-touched",i._shouldForward("touched"))("ng-pristine",i._shouldForward("pristine"))("ng-dirty",i._shouldForward("dirty"))("ng-valid",i._shouldForward("valid"))("ng-invalid",i._shouldForward("invalid"))("ng-pending",i._shouldForward("pending"))},inputs:{label:"label"},exportAs:["sbbFormField"],features:[wi([{provide:bC,useExisting:n}])],ngContentSelectors:BZ,decls:10,vars:9,consts:[[1,"sbb-form-field-wrapper"],[1,"sbb-form-field-label-wrapper",3,"click"],[1,"sbb-label","sbb-form-field-label",3,"id","ngSwitch"],[4,"ngSwitchCase"],[1,"sbb-form-field-input-wrapper"],["connectionContainer",""],[1,"sbb-form-field-error-wrapper"],[4,"ngIf"]],template:function(e,i){1&e&&(ss(NZ),ae(0,"div",0)(1,"div",1),Zt("click",function(a){return i._control.onContainerClick&&i._control.onContainerClick(a)}),ae(2,"label",2),Ct(3,LZ,3,1,"ng-container",3),Ct(4,OZ,1,0,"ng-content",3),de()(),ae(5,"div",4,5),Yr(7),de(),ae(8,"div",6),Ct(9,FZ,1,0,"ng-content",7),de()()),2&e&&(_e(2),l("sbb-form-field-empty",i._control.empty),Ve("id",i._labelId)("ngSwitch",i._hasLabel()),Yn("for",i._control.id)("aria-owns",i._control.id),_e(1),Ve("ngSwitchCase",!1),_e(1),Ve("ngSwitchCase",!0),_e(5),Ve("ngIf",i._hasErrors()))},dependencies:[Go,wy,AS],styles:[".sbb-form-field{display:inline-block;position:relative;width:var(--sbb-form-field-width)}.sbb-form-field-short{width:33.333%}@media all and (min-width: 26.3125em){.sbb-form-field-short{width:25%}}@media all and (min-width: 64.0625em){.sbb-form-field-short{width:16.66666%}}.sbb-form-field-medium{width:100%}@media all and (min-width: 40.1875em){.sbb-form-field-medium{width:50%}}.sbb-form-field-long{width:100%}.sbb-form-field-wrapper{padding-bottom:calc(1.5333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-form-field-wrapper{padding-bottom:1.0666666667rem}.sbb-form-field-flexible-errors .sbb-form-field-wrapper{padding-bottom:0}.sbb-form-field-label-wrapper{margin-bottom:var(--sbb-form-label-wrapper-margin-bottom);padding-left:var(--sbb-form-label-wrapper-padding-left)}.sbb-form-field .sbb-input-element{width:100%;max-width:100%}.sbb-form-field textarea.sbb-input-element{resize:vertical;overflow:auto}.sbb-form-field textarea.sbb-input-element.cdk-textarea-autosize{resize:none}.sbb-form-field-error-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.sbb-form-field-flexible-errors .sbb-form-field-error-wrapper{position:relative}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) :is(.sbb-icon,.sbb-tooltip-icon),:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-icon svg{vertical-align:bottom;width:calc(1.0666666667rem * var(--sbb-scaling-factor));height:calc(1.0666666667rem * var(--sbb-scaling-factor))}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-icon:not(:hover):not(:focus){color:inherit}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-trigger{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor))}.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap,.sbb-form-group-vertical{display:flex;gap:var(--sbb-divider-thin)}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap){align-items:flex-start}.sbb-form-group-wrap{flex-wrap:wrap}.sbb-form-group-center{justify-content:center}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap):where(:not(.sbb-form-group-vertical)) :is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){margin-top:calc(var(--sbb-form-label-line-height) + var(--sbb-form-label-wrapper-margin-bottom))}.sbb-form-group-vertical{flex-direction:column}.sbb-form-group-vertical.sbb-form-group-center{justify-content:inherit;align-items:center}.sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){width:var(--sbb-form-field-width)}:where(html:not(.sbb-lean)) .sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button) .sbb-button-right-icon{right:unset !important}"],encapsulation:2,changeDetection:0}),n})(),yC=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr]}),n})();const hN=Im({passive:!0});let UZ=(()=>{class n{constructor(e,i){this._platform=e,this._ngZone=i,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return uo;const i=S_(e),r=this._monitoredElements.get(i);if(r)return r.subject;const a=new fn,p="cdk-text-field-autofilled",y=T=>{"cdk-text-field-autofill-start"!==T.animationName||i.classList.contains(p)?"cdk-text-field-autofill-end"===T.animationName&&i.classList.contains(p)&&(i.classList.remove(p),this._ngZone.run(()=>a.next({target:T.target,isAutofilled:!1}))):(i.classList.add(p),this._ngZone.run(()=>a.next({target:T.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{i.addEventListener("animationstart",y,hN),i.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(i,{subject:a,unlisten:()=>{i.removeEventListener("animationstart",y,hN)}}),a}stopMonitoring(e){const i=S_(e),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}}return n.\u0275fac=function(e){return new(e||n)(mt(la),mt(Oi))},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),FA=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({}),n})();const pN=new Qt("SBB_INPUT_VALUE_ACCESSOR");let HZ=0;const GZ=["button","checkbox","file","hidden","image","radio","range","reset","submit"],qZ=$T(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new fn}});let L_=(()=>{class n extends qZ{constructor(e,i,r,a,p,y,T,P,z){super(y,a,p,r),this._elementRef=e,this._platform=i,this.ngControl=r,this._autofillMonitor=P,this.focused=!1,this.controlType="sbb-input",this.autofilled=!1,this._disabled=!1,this.id="sbb-native-input-"+HZ++,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(oe=>vF().has(oe)),this._iOSKeyupListener=oe=>{const fe=oe.target;!fe.value&&0===fe.selectionStart&&0===fe.selectionEnd&&(fe.setSelectionRange(1,1),fe.setSelectionRange(0,0))};const H=this._elementRef.nativeElement,J=H.nodeName.toLowerCase();this._inputValueAccessor=T||H,this._previousNativeValue=this.value,i.IOS&&z.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isNativeSelect="select"===J,this._isTextarea="textarea"===J,this._isNativeSelect&&(this.controlType=H.multiple?"sbb-native-select-multiple":"sbb-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(e){this._disabled=Si(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get required(){return this._required}set required(e){this._required=Si(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&vF().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=Si(e)}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()}),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_validateType(){GZ.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){const e=this._elementRef.nativeElement.validity;return e&&e.badInput}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(la),le(Oc,10),le(Cy,8),le(Ey,8),le(YM),le(pN,10),le(UZ),le(Oi))},n.\u0275dir=cn({type:n,selectors:[["input","sbbInput",""],["select","sbbInput",""],["textarea","sbbInput",""]],hostAttrs:[1,"sbb-input-element"],hostVars:9,hostBindings:function(e,i){1&e&&Zt("focus",function(){return i._focusChanged(!0)})("blur",function(){return i._focusChanged(!1)}),2&e&&(Jr("disabled",i.disabled)("required",i.required),Yn("id",i.id)("name",i.name||null)("readonly",i.readonly&&!i._isNativeSelect||null)("aria-invalid",i.empty&&i.required?null:i.errorState)("aria-required",i.required)("placeholder",i.readonly?"-":i.placeholder||null)("tabindex",i.empty&&i.readonly?-1:null))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["sbbInput"],features:[wi([{provide:Xx,useExisting:n}]),zn,xo]}),n})(),fN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[FA,Pr,yC,FA,yC]}),n})();const $Z=["sbb-calendar-body",""];function WZ(n,t){1&n&&dn(0,"td",4),2&n&&Yn("colspan",Ot(2).firstRowOffset)}function XZ(n,t){if(1&n){const e=Zr();ae(0,"td",5)(1,"button",6),Zt("click",function(){const a=di(e).$implicit;return oi(Ot(2).cellClicked(a))})("focus",function(r){const p=di(e).$implicit;return oi(Ot(2)._emitActiveDateChange(p,r))}),ae(2,"div",7),W(3),de()()()}if(2&n){const e=t.$implicit,i=t.index,r=Ot().index,a=Ot();o("width",100/a.numCols,"%"),Yn("data-sbb-row",r)("data-sbb-col",i),_e(1),l("sbb-calendar-body-disabled",!e.enabled)("sbb-calendar-body-active",a.isActiveCell(r,i))("sbb-calendar-body-range-background","range"===e.rangeBackground)("sbb-calendar-body-range-background-offset-start",null!==e.rangeBackground&&0===r&&a.firstRowOffset&&0===i)("sbb-calendar-body-selected-begin","begin"===e.rangeBackground)("sbb-calendar-body-selected-end","end"===e.rangeBackground)("sbb-calendar-body-selected",a.selectedValue===e.value)("sbb-calendar-body-today",a.todayValue===e.value),Ve("tabindex",a.isActiveCell(r,i)?0:-1),Yn("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",a.selectedValue===e.value)("aria-current",a.todayValue===e.value?"date":null),_e(2),ce(e.displayValue)}}function ZZ(n,t){if(1&n&&(ae(0,"tr",1),Ct(1,WZ,1,1,"td",2),Ct(2,XZ,4,26,"td",3),de()),2&n){const e=t.$implicit,i=t.index,r=Ot();_e(1),Ve("ngIf",0===i&&r.firstRowOffset),_e(1),Ve("ngForOf",e)}}function YZ(n,t){if(1&n&&(ae(0,"th")(1,"span",5),W(2),de(),ae(3,"span",6),W(4),de()()),2&n){const e=t.$implicit;_e(2),ce(e.long),_e(2),ce(e.narrow)}}function KZ(n,t){}function JZ(n,t){if(1&n){const e=Zr();ae(0,"button",3),Zt("click",function(){return di(e),oi(Ot().prevDay())}),dn(1,"sbb-icon",4),de()}if(2&n){const e=Ot();Ve("disabled",e.disabled),Yn("aria-label",e.prevDayAriaLabel)}}function QZ(n,t){1&n&&dn(0,"sbb-datepicker-toggle")}function eY(n,t){if(1&n){const e=Zr();ae(0,"button",5),Zt("click",function(){return di(e),oi(Ot().nextDay())}),dn(1,"sbb-icon",6),de()}if(2&n){const e=Ot();Ve("disabled",e.disabled),Yn("aria-label",e.nextDayAriaLabel)}}const tY=["*"];class nY{constructor(t,e,i,r,a){this.value=t,this.displayValue=e,this.ariaLabel=i,this.enabled=r,this.rangeBackground=a}}let mN=(()=>{class n{constructor(e,i){this._elementRef=e,this._ngZone=i,this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.selectedValueChange=new Cn,this.activeDateChange=new Cn}ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this.focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}cellClicked(e){!this.allowDisabledSelection&&!e.enabled||this.selectedValueChange.emit(e.value)}_emitActiveDateChange(e,i){e.enabled&&this.activeDateChange.emit(e.value)}get firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}isActiveCell(e,i){let r=e*this.numCols+i;return e&&(r-=this.firstRowOffset),r===this.activeCell}focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(ko(1)).subscribe(()=>{setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector(".sbb-calendar-body-active");e&&e.focus()})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(Oi))},n.\u0275cmp=Ut({type:n,selectors:[["","sbb-calendar-body",""]],hostAttrs:["role","grid",1,"sbb-calendar-body"],hostVars:1,hostBindings:function(e,i){2&e&&Yn("aria-readonly",!0)},inputs:{label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell"},outputs:{selectedValueChange:"selectedValueChange",activeDateChange:"activeDateChange"},exportAs:["sbbCalendarBody"],attrs:$Z,decls:1,vars:1,consts:[["role","row",4,"ngFor","ngForOf"],["role","row"],["class","sbb-calendar-body-label",4,"ngIf"],["role","gridcell","class","sbb-calendar-body-cell-container",3,"width",4,"ngFor","ngForOf"],[1,"sbb-calendar-body-label"],["role","gridcell",1,"sbb-calendar-body-cell-container"],["type","button",1,"sbb-calendar-body-cell","sbb-button-reset-frameless",3,"tabindex","click","focus"],[1,"sbb-calendar-body-cell-content"]],template:function(e,i){1&e&&Ct(0,ZZ,3,2,"tr",0),2&e&&Ve("ngForOf",i.rows)},dependencies:[cc,Go],encapsulation:2,changeDetection:0}),n})();function O_(n){return Error(`SbbDatepicker: No provider found for ${n}.`)}class gN{constructor(t,e){this.start=t,this.end=e}}const NA=new Qt("SBB_DATEPICKER");let _N=(()=>{class n{constructor(e,i,r,a,p){if(this._dateAdapter=e,this.locale=i,this._changeDetectorRef=r,this._dateFormats=a,this.selectedChange=new Cn,this.userSelection=new Cn,this.activeDateChange=new Cn,this.dateRange=null,!this._dateAdapter)throw O_("DateAdapter");if(!this._dateFormats)throw O_("SBB_DATE_FORMATS");p&&p.connected&&p.datepickerInput.value&&p.connected.datepickerInput.value?this.dateRange=new gN(p.datepickerInput.value,p.connected.datepickerInput.value):p&&p.main&&p.datepickerInput.value&&p.main.datepickerInput.value&&(this.dateRange=new gN(p.main.datepickerInput.value,p.datepickerInput.value));const y=this._dateAdapter.getFirstDayOfWeek(),T=this._dateAdapter.getDayOfWeekNames("narrow"),z=this._dateAdapter.getDayOfWeekNames("long").map((H,J)=>({long:H,narrow:T[J]}));this.weekdays=z.slice(y).concat(z.slice(0,y)),this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(e){const i=this._activeDate,r=this._getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this.init()}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this.selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}ngAfterContentInit(){this.init()}dateSelected(e){if(this.selectedDate!==e){const i=this._getDateFromDayOfMonth(e);this.selectedChange.emit(i)}this.userSelection.emit()}_updateActiveDate(e){const i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(e),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}handleCalendarBodyKeydown(e){const i=this._activeDate;switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:return void((!this.dateFilter||this.dateFilter(this._activeDate))&&(this.dateSelected(this._dateAdapter.getDate(this._activeDate)),this.userSelection.emit(),e.preventDefault()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}init(){this.selectedDate=this._getDateInCurrentMonth(this.selected),this.todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this.monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();const e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this.firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(e)-this._dateAdapter.getFirstDayOfWeek())%7,this._createWeekCells(),this._changeDetectorRef.markForCheck()}focusActiveCell(){this.sbbCalendarBody.focusActiveCell()}_focusActiveCellAfterViewChecked(){this.sbbCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromDayOfMonth(e){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),e)}_createWeekCells(){const e=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this.weeks=[[]];for(let r=0,a=this.firstWeekOffset;r<e;r++,a++){7===a&&(this.weeks.push([]),a=0);const p=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),y=this._shouldEnableDate(p),T=this._dateAdapter.format(p,this._dateFormats.dateA11yLabel),P=this._shouldApplyRangeBackground(p);this.weeks[this.weeks.length-1].push(new nY(r+1,i[r],T,y,P))}}_shouldApplyRangeBackground(e){return this.dateRange&&this.dateRange.start&&this.dateRange.end&&!this._dateAdapter.sameDate(this.dateRange.start,this.dateRange.end)?this._dateAdapter.compareDate(e,this.dateRange.start)>0&&this._dateAdapter.compareDate(e,this.dateRange.end)<0?"range":this._isRangeLimit(e):null}_isRangeLimit(e){return 0===this._dateAdapter.compareDate(e,this.dateRange.start)?"begin":0===this._dateAdapter.compareDate(e,this.dateRange.end)?"end":null}_shouldEnableDate(e){return!!e&&(!this.dateFilter||this.dateFilter(e))&&(!this.minDate||this._dateAdapter.compareDate(e,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(e,this.maxDate)<=0)}_getDateInCurrentMonth(e){return e&&this._hasSameMonthAndYear(e,this.activeDate)?this._dateAdapter.getDate(e):null}_hasSameMonthAndYear(e,i){return!(!e||!i||this._dateAdapter.getMonth(e)!==this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(e)!==this._dateAdapter.getYear(i))}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(le(km,8),le(kc),le(lo),le(WT,8),le(NA,8))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-month-view"]],viewQuery:function(e,i){if(1&e&&io(mN,7),2&e){let r;_i(r=bi())&&(i.sbbCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection",activeDateChange:"activeDateChange"},exportAs:["sbbMonthView"],decls:7,vars:7,consts:[[1,"sbb-calendar-table"],[1,"sbb-calendar-table-header"],[4,"ngFor","ngForOf"],["colspan","7","aria-hidden","true",1,"sbb-calendar-table-header-divider"],["sbb-calendar-body","",3,"label","rows","todayValue","selectedValue","labelMinRequiredCells","activeCell","selectedValueChange","activeDateChange","keydown"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(e,i){1&e&&(ae(0,"table",0)(1,"thead",1)(2,"tr"),Ct(3,YZ,5,2,"th",2),de(),ae(4,"tr"),dn(5,"th",3),de()(),ae(6,"tbody",4),Zt("selectedValueChange",function(a){return i.dateSelected(a)})("activeDateChange",function(a){return i._updateActiveDate(a)})("keydown",function(a){return i.handleCalendarBodyKeydown(a)}),de()()),2&e&&(_e(3),Ve("ngForOf",i.weekdays),_e(3),Qo("label",i.monthLabel),Ve("rows",i.weeks)("todayValue",i.todayDate)("selectedValue",i.selectedDate)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1))},dependencies:[cc,mN],encapsulation:2,changeDetection:0}),n})(),iY=(()=>{class n{constructor(e,i,r){this._dateAdapter=e,this._labelSwitchToPreviousMonth=$localize`:Button label to switch to the previous month@@sbbDatepickerSwitchToPreviousMonth:Change to the previous month`,this._labelSwitchToNextMonth=$localize`:Button label to switch to the next month@@sbbDatepickerSwitchToNextMonth:Change to the next month`,this._labelSwitchToPreviousYear=$localize`:Button label to switch to the previous year@@sbbDatepickerSwitchToPreviousYear:Change to the previous year`,this._labelSwitchToNextYear=$localize`:Button label to switch to the next year@@sbbDatepickerSwitchToNextYear:Change to the next year`,this.calendar=i,this.calendar.stateChanges.subscribe(()=>r.markForCheck())}get monthText(){return this._dateAdapter.getMonthName(this.calendar.activeDate)}get yearText(){return this._dateAdapter.getYearName(this.calendar.activeDate)}previousMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1);this._assignActiveDate(e)}previousMonthEnabled(){return!this.calendar.minDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.minDate)}nextMonthEnabled(){return!this.calendar.maxDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.maxDate)}_isSameMonthView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(e)===this._dateAdapter.getMonth(i)}previousYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,1);this._assignActiveDate(e)}previousYearEnabled(){return!this.calendar.minDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.minDate)}nextYearEnabled(){return!this.calendar.maxDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.maxDate)}_isSameYearView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)}_assignActiveDate(e){this.calendar.activeDate=this.calendar.minDate&&this._dateAdapter.compareDate(this.calendar.minDate,e)>0?this.calendar.minDate:this.calendar.maxDate&&this._dateAdapter.compareDate(this.calendar.maxDate,e)<0?this.calendar.maxDate:e}}return n.\u0275fac=function(e){return new(e||n)(le(km,8),le(dr(()=>zA)),le(lo))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-calendar-header"]],hostAttrs:[1,"sbb-calendar-header","sbb-icon-scaled"],exportAs:["sbbCalendarHeader"],decls:15,vars:12,consts:[[1,"sbb-calendar-controls"],[1,"sbb-calendar-controls-months"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-previous",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["aria-live","polite",1,"sbb-calendar-controls-label"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-next",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"],[1,"sbb-calendar-controls-years"]],template:function(e,i){1&e&&(ae(0,"div",0)(1,"div",1)(2,"button",2),Zt("click",function(){return i.previousMonthClicked()}),dn(3,"sbb-icon",3),de(),ae(4,"span",4),W(5),de(),ae(6,"button",5),Zt("click",function(){return i.nextMonthClicked()}),dn(7,"sbb-icon",6),de()(),ae(8,"div",7)(9,"button",2),Zt("click",function(){return i.previousYearClicked()}),dn(10,"sbb-icon",3),de(),ae(11,"span",4),W(12),de(),ae(13,"button",5),Zt("click",function(){return i.nextYearClicked()}),dn(14,"sbb-icon",6),de()()()),2&e&&(_e(2),Ve("disabled",!i.previousMonthEnabled()),Yn("aria-label",i._labelSwitchToPreviousMonth),_e(2),Yn("aria-label",i.monthText),_e(1),ce(i.monthText),_e(1),Ve("disabled",!i.nextMonthEnabled()),Yn("aria-label",i._labelSwitchToNextMonth),_e(3),Ve("disabled",!i.previousYearEnabled()),Yn("aria-label",i._labelSwitchToPreviousYear),_e(2),Yn("aria-label",i.yearText),_e(1),ce(i.yearText),_e(1),Ve("disabled",!i.nextYearEnabled()),Yn("aria-label",i._labelSwitchToNextYear))},dependencies:[vl],encapsulation:2,changeDetection:0}),n})(),zA=(()=>{class n{constructor(e,i,r){if(this._dateAdapter=e,this._dateFormats=i,this._changeDetectorRef=r,this._moveFocusOnNextTick=!1,this.selectedChange=new Cn,this.userSelection=new Cn,this.stateChanges=new fn,!this._dateAdapter)throw O_("DateAdapter");if(!this._dateFormats)throw O_("SBB_DATE_FORMATS")}get startAt(){return this._startAt}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get activeDate(){return this._clampedActiveDate}set activeDate(e){this._clampedActiveDate=this._dateAdapter.clampDate(e,this.minDate,this.maxDate),this.stateChanges.next()}ngAfterContentInit(){this.calendarHeaderPortal=new _h(this.headerComponent||iY),this.activeDate=this.startAt||this._dateAdapter.today()}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this.stateChanges.complete()}ngOnChanges(e){const i=e.minDate&&!this._dateAdapter.sameDate(e.minDate.previousValue,e.minDate.currentValue)?e.minDate:void 0,r=e.maxDate&&!this._dateAdapter.sameDate(e.maxDate.previousValue,e.maxDate.currentValue)?e.maxDate:void 0,a=i||r||e.dateFilter;if(a&&!a.firstChange){const p=this._getCurrentViewComponent();p&&(this._changeDetectorRef.detectChanges(),p.init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent().focusActiveCell()}dateSelected(e){e&&!this._dateAdapter.sameDate(e,this.selected)&&this.selectedChange.emit(e)}userSelected(){this.userSelection.emit()}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}_getCurrentViewComponent(){return this.monthView}}return n.\u0275fac=function(e){return new(e||n)(le(km,8),le(WT,8),le(lo))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-calendar"]],viewQuery:function(e,i){if(1&e&&io(_N,7),2&e){let r;_i(r=bi())&&(i.monthView=r.first)}},hostAttrs:[1,"sbb-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection"},exportAs:["sbbCalendar"],features:[xo],decls:3,vars:6,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"sbb-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","activeDateChange","selectedChange","userSelection"]],template:function(e,i){1&e&&(Ct(0,KZ,0,0,"ng-template",0),ae(1,"div",1)(2,"sbb-month-view",2),Zt("activeDateChange",function(a){return i.activeDate=a})("selectedChange",function(a){return i.dateSelected(a)})("userSelection",function(){return i.userSelected()}),de()()),2&e&&(Ve("cdkPortalOutlet",i.calendarHeaderPortal),_e(2),Ve("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate))},dependencies:[bh,g$,_N],encapsulation:2,changeDetection:0}),n})(),rY=(()=>{class n{ngAfterViewInit(){this.calendar.focusActiveCell()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["sbb-datepicker-content"]],viewQuery:function(e,i){if(1&e&&io(zA,7),2&e){let r;_i(r=bi())&&(i.calendar=r.first)}},hostAttrs:[1,"sbb-datepicker-content"],exportAs:["sbbDatepickerContent"],decls:1,vars:10,consts:[["cdkTrapFocus","","role","dialog",1,"sbb-datepicker-content-container",3,"id","ngClass","startAt","minDate","maxDate","dateFilter","headerComponent","selected","selectedChange","userSelection"]],template:function(e,i){if(1&e&&(ae(0,"sbb-calendar",0),Zt("selectedChange",function(a){return i.datepicker.select(a)})("userSelection",function(){return i.datepicker.close()}),de()),2&e){let r;Ve("id",i.datepicker.id)("ngClass",i.datepicker.panelClass)("startAt",i.datepicker.startAt)("minDate",i.datepicker.minDate)("maxDate",i.datepicker.maxDate)("dateFilter",i.datepicker.dateFilter)("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i.datepicker.selected),Yn("aria-modal",!0)("aria-labelledby",null!==(r=i._dialogLabelId)&&void 0!==r?r:void 0)}},dependencies:[bm,n$,zA],styles:['.sbb-datepicker-content{position:relative;top:var(--sbb-datepicker-content-offset);font-size:var(--sbb-font-size)}.sbb-datepicker-panel-above .sbb-datepicker-content{top:auto;bottom:var(--sbb-datepicker-content-offset)}.sbb-datepicker-content::after{top:var(--sbb-datepicker-calendar-arrow-offset);left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width));content:"";height:var(--sbb-datepicker-calendar-arrow-width);width:var(--sbb-datepicker-calendar-arrow-width);position:absolute;pointer-events:none;transform:rotate(-135deg);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid rgba(0,0,0,0);border-right-color:var(--sbb-color-weak-accent);border-bottom-color:var(--sbb-color-weak-accent);clip-path:polygon(-0.4px 100%, 100% -0.4px, 100% 100%)}.sbb-datepicker-with-arrows .sbb-datepicker-content::after{left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width) + var(--sbb-icon-size-default) + var(--sbb-datepicker-button-gap))}.sbb-datepicker-panel-above .sbb-datepicker-content::after{top:auto;bottom:var(--sbb-datepicker-calendar-arrow-offset);transform:rotate(45deg);clip-path:var(--sbb-box-shadow-arrow-clip-path);box-shadow:var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-arrow-width) 0 var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-color)}.sbb-calendar{display:block;max-width:100%;width:var(--sbb-datepicker-calendar-width);height:var(--sbb-datepicker-calendar-height);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);box-shadow:var(--sbb-box-shadow-below)}.sbb-calendar-header{display:block;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls{display:flex;height:var(--sbb-datepicker-calendar-header-height);align-items:center}.sbb-calendar-controls-months,.sbb-calendar-controls-years{display:flex;height:var(--sbb-datepicker-calendar-header-height);flex:1 0 50%;text-align:center;position:relative}.sbb-calendar-controls-months::after{content:"";display:block;position:absolute;width:0;height:100%;top:0;right:0;border-right:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls-button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;flex-grow:0;outline:0;padding-left:var(--sbb-datepicker-calendar-controls-padding);padding-right:var(--sbb-datepicker-calendar-controls-padding);height:var(--sbb-datepicker-calendar-header-height);cursor:pointer;color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-controls-button:is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-calendar-controls-button:disabled{cursor:default;opacity:0}.sbb-calendar-controls-button-previous{float:left;padding-right:0}.sbb-calendar-controls-button-next{float:right;padding-left:0}.sbb-calendar-controls-label{flex-grow:1;flex-shrink:1;font-family:var(--sbb-font-light);font-size:1.4rem;line-height:3.2;color:var(--sbb-datepicker-calendar-header-color)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-calendar-controls-label{font-size:var(--sbb-font-size-large)}}:where(html.sbb-lean) .sbb-calendar-controls-label{font-size:var(--sbb-font-size);line-height:2.4rem}.sbb-calendar-content{padding:0 var(--sbb-datepicker-calendar-table-content-padding-width)}.sbb-calendar-table{width:100%;border-spacing:0;border-collapse:collapse;margin:0;position:relative}.sbb-calendar-table :is(td,th){color:var(--sbb-color-weak-accent);font-size:var(--sbb-font-size);line-height:1.5}.sbb-calendar-table-header::after{content:"";display:block;position:absolute;top:calc(2.2rem * var(--sbb-scaling-factor));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color);width:calc(100% + var(--sbb-datepicker-calendar-table-content-padding-width)*2);left:calc(var(--sbb-datepicker-calendar-table-content-padding-width)*-1)}.sbb-calendar-table-header tr th{font-family:var(--sbb-font-roman);font-weight:400;font-size:var(--sbb-font-size-small);text-transform:uppercase;padding:calc(0.4666666667rem * var(--sbb-scaling-factor));color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-table-header-divider{height:calc(1rem * var(--sbb-scaling-factor))}.sbb-calendar-body-cell-container{position:relative;height:0;padding:0;line-height:0;text-align:center}.sbb-calendar-body-cell{position:relative;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0;cursor:pointer}.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end)::before{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color);width:100%;left:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end,.sbb-calendar-body-range-background-offset-start))::before{width:50%}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-range-background-offset-start))::before{left:auto;right:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color)}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{border-radius:50% 0 0 50%}.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background::after{border-radius:0 50% 50% 0}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::before{display:none}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::after{border-radius:50%}.sbb-calendar-body-cell,.sbb-calendar-body-label{padding-top:var(--sbb-datepicker-calendar-body-cell-padding);padding-bottom:var(--sbb-datepicker-calendar-body-cell-padding)}.sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-cement);cursor:default}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-storm)}.sbb-calendar-body-cell.sbb-calendar-body-disabled::after{content:"";width:calc(2.1333333333rem * var(--sbb-scaling-factor));height:calc(0.0666666667rem * var(--sbb-scaling-factor));top:calc(1.6666666667rem * var(--sbb-scaling-factor));left:calc(50% - var(--sbb-datepicker-calendar-body-cell-disabled-offset));background-color:var(--sbb-color-cement);display:block;position:absolute;transform:rotate(-45deg)}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled::after{background-color:var(--sbb-color-storm);width:1.6rem;top:1.2rem}.sbb-calendar-body-today{font-family:var(--sbb-font-bold);color:var(--sbb-color-black)}.sbb-calendar-body-cell-content{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));border:var(--sbb-border-width) solid rgba(0,0,0,0);border-radius:50%;z-index:1}.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):is(:hover,:focus) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-call-to-action-hover);border-color:var(--sbb-color-call-to-action-hover)}:is(.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled).sbb-calendar-body-selected,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-weak-accent);border-color:var(--sbb-color-weak-accent)}'],encapsulation:2,changeDetection:0}),n})(),oY=(()=>{class n{constructor(e,i,r){this._changeDetectorRef=e,this._datepicker=i,this._labelShowCalendar=$localize`:Open calendar@@sbbDatepickerOpenCalendar:Show calendar`,this._stateChanges=Qe.EMPTY;const a=Number(r);this.tabIndex=a||0===a?a:null}get disabled(){return void 0===this._disabled?this._datepicker.disabled:this._disabled}set disabled(e){this._disabled=Si(e)}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}open(e){this._datepicker&&!this.disabled&&(this._datepicker.open(),e.stopPropagation())}_watchStateChanges(){const e=this._datepicker?this._datepicker.disabledChange:si(),i=this._datepicker&&this._datepicker.datepickerInput?this._datepicker.datepickerInput.disabledChange:si(),r=this._datepicker?yo(this._datepicker.openedStream,this._datepicker.closedStream):si();this._stateChanges.unsubscribe(),this._stateChanges=yo(e,i,r).subscribe(()=>this._changeDetectorRef.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(le(lo),le(NA),us("tabindex"))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-datepicker-toggle"]],hostAttrs:[1,"sbb-datepicker-toggle"],hostVars:3,hostBindings:function(e,i){2&e&&(Yn("tabindex",null),l("sbb-datepicker-toggle-active",i._datepicker&&i._datepicker.opened))},inputs:{tabIndex:"tabIndex",disabled:"disabled"},features:[xo],decls:2,vars:3,consts:[["aria-haspopup","true","type","button",1,"sbb-datepicker-toggle-button","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:calendar-small"]],template:function(e,i){1&e&&(ae(0,"button",0),Zt("click",function(a){return i.open(a)}),dn(1,"sbb-icon",1),de()),2&e&&(Ve("disabled",i.disabled),Yn("aria-label",i._labelShowCalendar)("tabindex",i.disabled?-1:i.tabIndex))},dependencies:[vl],encapsulation:2,changeDetection:0}),n})(),sY=0;const bN=new Qt("sbb-datepicker-scroll-strategy"),lY={provide:bN,deps:[Ls],useFactory:function aY(n){return()=>n.scrollStrategies.reposition()}};let vC=(()=>{class n{constructor(e,i,r,a,p,y,T){if(this._overlay=e,this._ngZone=i,this._viewContainerRef=r,this._changeDetectorRef=a,this._scrollStrategy=p,this._dateAdapter=y,this.locale=T,this._arrows=!1,this._toggle=!0,this.openedStream=new Cn,this.closedStream=new Cn,this._opened=!1,this.id="sbb-datepicker-"+sY++,this._validSelected=null,this.nextDayAriaLabel=$localize`:Next day button's aria-label@@sbbDatePickerNextDayAriaLabel:Next day`,this.prevDayAriaLabel=$localize`:Previous day button's aria-label@@sbbDatePickerPrevDayAriaLabel:Previous day`,this._focusedElementBeforeOpen=null,this._inputSubscription=Qe.EMPTY,this._inputChangeSubscription=Qe.EMPTY,this._connectedDatepickerSubscription=Qe.EMPTY,this._posStrategySubscription=Qe.EMPTY,this.disabledChange=new fn,this.selectedChanged=new fn,!this._dateAdapter)throw O_("DateAdapter");this._dateAdapter.setLocale(T)}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.value:null)}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(e){const i=Si(e);i!==this._disabled&&(this._disabled=i,this.disabledChange.next(i))}set connected(e){e!==this._connected&&this._connected&&(this._connected.main=null),e&&(e.main=this),this._connected=e}get connected(){return this._connected}get arrows(){return this._arrows}set arrows(e){this._arrows=Si(e)}get arrowsVisible(){var e;return this.arrows&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get toggle(){return this._toggle}set toggle(e){this._toggle=Si(e)}set notoggle(e){this._toggle=!Si(e)}get toggleVisible(){var e;return this.toggle&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get opened(){return this._opened}set opened(e){Si(e)?this.open():this.close()}get selected(){return this._validSelected}set selected(e){this._validSelected=e,this._changeDetectorRef.markForCheck()}get minDate(){return this.datepickerInput&&this.datepickerInput.min}get maxDate(){return this.datepickerInput&&this.datepickerInput.max}get dateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}get prevDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.minDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.minDate)>0)}get nextDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.maxDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.maxDate)<0)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._inputChangeSubscription.unsubscribe(),this._connectedDatepickerSubscription.unsubscribe(),this.disabledChange.complete(),this.popupRef&&(this._posStrategySubscription.unsubscribe(),this.popupRef.dispose(),this._popupComponentRef=null)}select(e){const i=this.selected;this.selected=e,this._dateAdapter.sameDate(i,this.selected)||this.selectedChanged.next(e)}nextDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,1),this.selectedChanged.next(this.selected))}prevDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,-1),this.selectedChanged.next(this.selected))}registerInput(e){if(this.datepickerInput)throw Error("A SbbDatepicker can only be associated with a single input.");this.datepickerInput=e,this._inputSubscription=this.datepickerInput.valueChange.subscribe(i=>this.selected=i),this._inputChangeSubscription=yo(this.datepickerInput.disabledChange,this.datepickerInput.readonlyChange).subscribe(()=>this._changeDetectorRef.markForCheck()),this._connectedDatepickerSubscription=yo(this.openedStream.pipe(yx("opened")),this.selectedChanged.pipe(yx("selected")),this.closedStream.pipe(yx("closed"))).pipe(function kZ(n,t=null){return t=null!=t?t:n,cr((e,i)=>{let r=[],a=0;e.subscribe(ur(i,p=>{let y=null;a++%t==0&&r.push([]);for(const T of r)T.push(p),n<=T.length&&(y=null!=y?y:[],y.push(T));if(y)for(const T of y)d(r,T),i.next(T)},()=>{for(const p of r)i.next(p);i.complete()},void 0,()=>{r=null}))})}(3,1),go(([i,r,a])=>!!this.connected&&!!this.datepickerInput.value&&"opened"===i&&"selected"===r&&"closed"===a&&(!this.connected.datepickerInput.value||this._dateAdapter.compareDate(this.datepickerInput.value,this.connected.datepickerInput.value)>0)),ks(()=>{this.connected.datepickerInput.value&&(this.connected.datepickerInput.value=null,this.connected.datepickerInput._cvaOnChange(null))})).subscribe(()=>this.connected.open())}open(){if(!this._opened&&!this.disabled){if(!this.datepickerInput)throw Error("Attempted to open an SbbDatepicker with no associated input.");this._focusedElementBeforeOpen=ad(),this._openAsPopup(),this._opened=!0,this.openedStream.emit()}}close(){if(!this._opened)return;this.popupRef&&this.popupRef.hasAttached()&&this.popupRef.detach(),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();const e=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(e)):e()}_getPanelClasses(){return["sbb-datepicker-panel",this.arrows?"sbb-datepicker-with-arrows":"sbb-datepicker-no-arrows"]}_openAsPopup(){this._calendarPortal||(this._calendarPortal=new _h(rY,this._viewContainerRef)),this.popupRef?this.popupRef.getConfig().panelClass=this._getPanelClasses():this._createPopup(),this.popupRef.hasAttached()||(this._popupComponentRef=this.popupRef.attach(this._calendarPortal),this._popupComponentRef.instance.datepicker=this,this._popupComponentRef.instance._dialogLabelId=this.datepickerInput.getOverlayLabelId(),this._ngZone.onStable.asObservable().pipe(ko(1)).subscribe(()=>{this.popupRef.updatePosition()}))}_createPopup(){const e=new M_({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"sbb-overlay-transparent-backdrop",scrollStrategy:this._scrollStrategy(),panelClass:this._getPanelClasses()});this.popupRef=this._overlay.create(e),yo(this.popupRef.backdropClick(),this.popupRef.detachments(),this.popupRef.keydownEvents().pipe(go(i=>27===i.keyCode||this.datepickerInput&&i.altKey&&38===i.keyCode))).subscribe(()=>this.close())}_createPopupPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".sbb-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withPush(!1).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}]);return this._posStrategySubscription=e.positionChanges.subscribe(i=>{"top"===i.connectionPair.originY?this.popupRef.hostElement.classList.add("sbb-datepicker-panel-above"):this.popupRef.hostElement.classList.remove("sbb-datepicker-panel-above")}),e}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(le(Ls),le(Oi),le(Rs),le(lo),le(bN),le(km,8),le(kc))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-datepicker"]],hostAttrs:[1,"sbb-datepicker"],hostVars:6,hostBindings:function(e,i){2&e&&l("sbb-datepicker-arrows-enabled",i.arrowsVisible)("sbb-datepicker-toggle-enabled",i.toggleVisible)("sbb-datepicker-disabled",i.disabled)},inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",disabled:"disabled",panelClass:"panelClass",connected:"connected",arrows:"arrows",toggle:"toggle",notoggle:"notoggle",opened:"opened",nextDayAriaLabel:"nextDayAriaLabel",prevDayAriaLabel:"prevDayAriaLabel"},outputs:{openedStream:"opened",closedStream:"closed"},exportAs:["sbbDatepicker"],features:[wi([{provide:NA,useExisting:n}])],ngContentSelectors:tY,decls:4,vars:3,consts:[["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-left sbb-icon-scaled",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-right sbb-icon-scaled",3,"disabled","click",4,"ngIf"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-left","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-right","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"]],template:function(e,i){1&e&&(ss(),Ct(0,JZ,2,2,"button",0),Ct(1,QZ,1,0,"sbb-datepicker-toggle",1),Yr(2),Ct(3,eY,2,2,"button",2)),2&e&&(Ve("ngIf",i.prevDayActive),_e(1),Ve("ngIf",i.toggleVisible),_e(2),Ve("ngIf",i.nextDayActive))},dependencies:[Go,vl,oY],styles:[".sbb-datepicker{display:inline-block;position:relative;color:var(--sbb-color-weak-accent)}.sbb-form-field .sbb-datepicker{width:100%}.sbb-datepicker-disabled{color:var(--sbb-color-granite)}.sbb-datepicker>.sbb-date-input{width:100%}:is(.sbb-datepicker-toggle-enabled,.sbb-datepicker-arrows-enabled)>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-right:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled.sbb-datepicker-toggle-enabled>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-and-arrows-padding)}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button){background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;position:absolute;top:50%;transform:translateY(-50%);outline:0;color:inherit;line-height:0}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled){cursor:pointer}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled):is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-datepicker-arrow-button-left,.sbb-datepicker-toggle-button{left:var(--sbb-datepicker-button-offset)}.sbb-datepicker-arrows-enabled .sbb-datepicker-toggle-button{left:var(--sbb-datepicker-adjacent-button-offset)}.sbb-datepicker-arrow-button-right{right:var(--sbb-datepicker-button-offset)}"],encapsulation:2,changeDetection:0}),n})();class xC{constructor(t,e){this.target=t,this.targetElement=e,this.value=this.target.value}}const cY={provide:Vl,useExisting:dr(()=>Yx),multi:!0},uY={provide:Fa,useExisting:dr(()=>Yx),multi:!0};let Yx=(()=>{class n{constructor(e,i,r,a,p){if(this._elementRef=e,this._dateAdapter=i,this._dateFormats=r,this._datepicker=a,this._formField=p,this._disabled=!1,this._readonly=!1,this.dateChange=new Cn,this.dateInput=new Cn,this.inputBlurred=new Cn,this.valueChange=new Cn,this.disabledChange=new Cn,this.readonlyChange=new Cn,this._datepickerSubscription=Qe.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{sbbDateParse:{text:this._elementRef.nativeElement.value}},this._minValidator=y=>{const T=this._getValidDateOrNull(this._dateAdapter.deserialize(y.value));return!this.min||!T||this._dateAdapter.compareDate(this.min,T)<=0?null:{sbbDateMin:{min:this.min,actual:T}}},this._maxValidator=y=>{const T=this._getValidDateOrNull(this._dateAdapter.deserialize(y.value));return!this.max||!T||this._dateAdapter.compareDate(this.max,T)>=0?null:{sbbDateMax:{max:this.max,actual:T}}},this._filterValidator=y=>{const T=this._getValidDateOrNull(this._dateAdapter.deserialize(y.value));return this._dateFilter&&T&&!this._dateFilter(T)?{sbbDateFilter:!0}:null},this._validator=AI.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw O_("DateAdapter");if(!this._dateFormats)throw O_("SBB_DATE_FORMATS")}set dateFilter(e){this._dateFilter=e,this._validatorOnChange()}get dateFilter(){return this._dateFilter}get value(){return this._value}set value(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._getValidDateOrNull(e);const i=this.value;this._value=e,this._formatValue(e),this._dateAdapter.sameDate(i,e)||this.valueChange.emit(e)}get min(){return this._min||(this._datepicker&&this._datepicker.main&&this._datepicker.main.datepickerInput&&this._datepicker.main.datepickerInput.value?this._datepicker.main.datepickerInput.value:null)}set min(e){this._min=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get max(){return this._max}set max(e){this._max=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get disabled(){return this._disabled}set disabled(e){const i=Si(e),r=this._elementRef.nativeElement;this._disabled!==i&&(this._disabled=i,this.disabledChange.emit(i)),i&&r.blur&&r.blur()}get readonly(){return this._readonly}set readonly(e){this._readonly=Si(e),this.readonlyChange.next(this._readonly)}ngOnInit(){!this._datepicker||(this._datepicker.registerInput(this),this._datepickerSubscription.unsubscribe(),this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(e=>{this.value=e,this._cvaOnChange(e),this._onTouched(),this.dateInput.emit(new xC(this,this._elementRef.nativeElement)),this.dateChange.emit(new xC(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this.valueChange.complete(),this.disabledChange.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}getConnectedOverlayOrigin(){return this._elementRef}writeValue(e){this.value=e}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){this._datepicker&&e.altKey&&40===e.keyCode&&(this._datepicker.open(),e.preventDefault())}_onInput(e){let i=this._dateAdapter.parse(e);this._lastValueValid=!i||this._dateAdapter.isValid(i),i=this._getValidDateOrNull(i),this._dateAdapter.sameDate(i,this._value)?this._validatorOnChange():(this._value=i,this._cvaOnChange(i),this.valueChange.emit(i),this.dateInput.emit(new xC(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new xC(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched(),this.inputBlurred.emit()}_formatValue(e){var i;const r=this._datepicker?this._dateFormats.dateInput:null!==(i=this._dateFormats.dateInputPure)&&void 0!==i?i:this._dateFormats.dateInput;this._elementRef.nativeElement.value=null!=e?this._dateAdapter.format(e,r):""}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(km,8),le(WT,8),le(vC,8),le(bC,8))},n.\u0275dir=cn({type:n,selectors:[["input","sbbDateInput",""]],hostAttrs:[1,"sbb-date-input"],hostVars:5,hostBindings:function(e,i){1&e&&Zt("keydown",function(a){return i._onKeydown(a)})("input",function(a){return i._onInput(a.target.value)})("change",function(){return i._onChange()})("blur",function(){return i._onBlur()}),2&e&&(Jr("disabled",i.disabled),Yn("aria-haspopup",i._datepicker?"dialog":null)("aria-owns",(null==i._datepicker?null:i._datepicker.opened)&&i._datepicker.id||null)("min",i.min?i._dateAdapter.toIso8601(i.min):null)("max",i.max?i._dateAdapter.toIso8601(i.max):null))},inputs:{dateFilter:"dateFilter",value:"value",min:"min",max:"max",disabled:"disabled",readonly:"readonly"},outputs:{dateChange:"dateChange",dateInput:"dateInput",inputBlurred:"inputBlurred"},exportAs:["sbbDateInput"],features:[wi([cY,uY,{provide:pN,useExisting:n}])]}),n})(),yN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[lY,{provide:km,useClass:r3},{provide:WT,useValue:tW}],imports:[ro,il,C_,uc,Pr,cs]}),n})();const dY=["input"],hY=["*"];let pY=0;const fY={provide:Vl,useExisting:dr(()=>wC),multi:!0};class vN{constructor(t,e){this.source=t,this.value=e}}const xN=new Qt("SbbRadioGroup"),VA=new Qt("SbbRadioButton");let mY=(()=>{class n{constructor(e){this._changeDetector=e,this.change=new Cn,this._value=null,this._name="sbb-radio-group-"+pY++,this._selected=null,this._isInitialized=!1,this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{}}get name(){return this._name}set name(e){this._name=e,this._updateRadioButtonNames()}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}get selected(){return this._selected}set selected(e){this._selected=e,this.value=e?e.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(e){this._disabled=Si(e),this._markRadiosForCheck()}get required(){return this._required}set required(e){this._required=Si(e),this._markRadiosForCheck()}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}ngAfterContentInit(){this._isInitialized=!0}_touch(){this._onTouched&&this._onTouched()}_emitChangeEvent(){this._isInitialized&&this.change.emit(new vN(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(e=>e._markForCheck())}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetector.markForCheck()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(e=>{e.name=this.name,e._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(i=>{i.checked=this.value===i.value,i.checked&&(this._selected=i)}))}}return n.\u0275fac=function(e){return new(e||n)(le(lo))},n.\u0275dir=cn({type:n,contentQueries:function(e,i,r){if(1&e&&Ro(r,VA,5),2&e){let a;_i(a=bi())&&(i._radios=a)}},hostAttrs:[1,"sbb-radio-group-base"],inputs:{name:"name",value:"value",selected:"selected",disabled:"disabled",required:"required"},outputs:{change:"change"}}),n})(),wC=(()=>{class n extends mY{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["sbb-radio-group"]],contentQueries:function(e,i,r){if(1&e&&Ro(r,VA,5),2&e){let a;_i(a=bi())&&(i._radios=a)}},hostAttrs:["role","radiogroup",1,"sbb-radio-group"],exportAs:["sbbRadioGroup"],features:[wi([fY,{provide:xN,useExisting:n}]),zn]}),n})();const _Y=jy(class gY{});let bY=0,yY=(()=>{class n extends _Y{constructor(e,i,r,a,p,y){super(),this._elementRef=i,this._changeDetector=r,this._focusMonitor=a,this._radioDispatcher=p,this._uniqueId="sbb-radio-button-"+ ++bY,this.id=this._uniqueId,this.change=new Cn,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=e,y&&(this.tabIndex=af(y,0)),this._removeUniqueSelectionListener=p.listen((T,P)=>{T!==this.id&&P===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(e){const i=Si(e);this._checked!==i&&(this._checked=i,i&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!i&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),i&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(e){this._setDisabled(Si(e))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(e){this._required=Si(e)}get inputId(){return`${this.id||this._uniqueId}-input`}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{!e&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new vN(this,this._value))}_onInputClick(e){e.stopPropagation()}_onInputChange(e){null==e||e.stopPropagation();const i=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),i&&this.radioGroup._emitChangeEvent())}_setDisabled(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}_updateTabIndex(){var e;const i=this.radioGroup;let r;if(r=i&&i.selected&&!this.disabled?i.selected===this?this.tabIndex:-1:this.tabIndex,r!==this._previousTabIndex){const a=null===(e=this._inputElement)||void 0===e?void 0:e.nativeElement;a&&(a.setAttribute("tabindex",r+""),this._previousTabIndex=r)}}}return n.\u0275fac=function(e){Cc()},n.\u0275dir=cn({type:n,viewQuery:function(e,i){if(1&e&&io(dY,5),2&e){let r;_i(r=bi())&&(i._inputElement=r.first)}},hostVars:1,hostBindings:function(e,i){2&e&&Yn("id",i.id)},inputs:{id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],checked:"checked",value:"value",disabled:"disabled",required:"required"},outputs:{change:"change"},features:[zn]}),n})(),jA=(()=>{class n extends yY{constructor(e,i,r,a,p,y){super(e,i,r,a,p,y)}}return n.\u0275fac=function(e){return new(e||n)(le(xN,8),le(ei),le(lo),le(yl),le(DA),us("tabindex"))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-radio-button"]],hostAttrs:[1,"sbb-radio-button","sbb-selection-item"],hostVars:9,hostBindings:function(e,i){1&e&&Zt("focus",function(){return i._inputElement.nativeElement.focus()}),2&e&&(Yn("tabindex",null)("id",i.id)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),l("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbRadioButton"],features:[wi([{provide:VA,useExisting:n}]),zn],ngContentSelectors:hY,decls:9,vars:11,consts:[[1,"sbb-selection-item-label"],["type","radio",1,"sbb-selection-input","sbb-radio-input","sbb-transparent-parent-overlay",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],[1,"sbb-selection-content"],[2,"display","none"]],template:function(e,i){1&e&&(ss(),ae(0,"label",0)(1,"input",1,2),Zt("change",function(a){return i._onInputChange(a)})("click",function(a){return i._onInputClick(a)}),de(),ae(3,"div",3),dn(4,"div",4),de(),ae(5,"div",5)(6,"span",6),W(7,"\xa0"),de(),Yr(8),de()()),2&e&&(Yn("for",i.inputId),_e(1),Ve("id",i.inputId)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex)("required",i.required),Yn("name",i.name)("value",i.value)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),UA=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[Pr]}),n})();const vY=/[0-9]{3,4}/,xY=/([0-9]{1,2})[.:,\-;_hH]?([0-9]{1,2})?/,wY=/([0-9]{1,2})([0-9]{2})/;let SN=(()=>{class n{constructor(e,i,r,a,p){this._elementRef=e,this._renderer=i,this._control=r,this._input=p,this._document=a,this.placeholder="HH:MM"}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=null!=e?e:"HH:MM",this._input&&(this._input.placeholder=this._placeholder)}_onBlur(e){const i=this._validateInput(e);if(!i||i.length<=2)return;const r=this._parseHour(i[1]),a=this._parseMinute(i[2]);if(this._control&&this._control.control)this._control.control.setValue(`${r}:${a}`);else{this._renderer.setProperty(this._elementRef.nativeElement,"value",`${r}:${a}`);const p=this._document.createEvent("Event");p.initEvent("input",!0,!0),this._elementRef.nativeElement.dispatchEvent(p)}}_validateInput(e){return vY.test(e)?e.match(wY):e?e.match(xY):null}_parseHour(e){return e.length>1?e:"0"+e}_parseMinute(e){return(e=e||"00").length>1?e:"0"+e}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(uu),le(Oc,10),le(Mi),le(L_,8))},n.\u0275dir=cn({type:n,selectors:[["input","sbbTimeInput",""]],hostAttrs:["type","text","pattern","[0-9]*","inputmode","numeric",1,"sbb-time-input","sbb-input-element"],hostVars:1,hostBindings:function(e,i){1&e&&Zt("blur",function(a){return i._onBlur(a.target.value)}),2&e&&Yn("placeholder",i.placeholder)},inputs:{placeholder:"placeholder"},exportAs:["sbbTimeInput"]}),n})(),TN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[Pr]}),n})();function CN(n,t){return t?e=>bx(t.pipe(ko(1),function SY(){return cr((n,t)=>{n.subscribe(ur(t,it))})}()),e.pipe(CN(n))):Ti((e,i)=>n(e,i).pipe(ko(1),yx(e)))}const CY=["panel"];function DY(n,t){if(1&n&&(ae(0,"div",0,1),Yr(2),de()),2&n){const e=t.id,i=Ot();Ve("id",i.id)("ngClass",i._classList),Yn("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}const EY=["*"];let IY=0;class MY{constructor(t,e){this.source=t,this.option=e}}const DN=new Qt("sbb-autocomplete-default-options",{providedIn:"root",factory:function AY(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1}}});let EN=(()=>{class n{constructor(e,i,r,a){this._changeDetectorRef=e,this._elementRef=i,this._activeOptionChanges=Qe.EMPTY,this._visibleClass="sbb-autocomplete-visible",this._hiddenClass="sbb-autocomplete-hidden",this._showPanel=new Qa(!1),this._isOpen=!1,this.displayWith=null,this.localeNormalizer=null,this.optionSelected=new Cn,this.opened=new Cn,this.closed=new Cn,this.optionActivated=new Cn,this._classList={},this._showHintIfNoOptions=!1,this.id="sbb-autocomplete-"+IY++,this.inertGroups=(null==a?void 0:a.SAFARI)||!1,this._autoActiveFirstOption=!!r.autoActiveFirstOption,this._autoSelectActiveOption=!!r.autoSelectActiveOption}get showPanel(){return this._showPanel.value}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=Si(e)}get autoSelectActiveOption(){return this._autoSelectActiveOption}set autoSelectActiveOption(e){this._autoSelectActiveOption=Si(e)}set classList(e){this._classList=e&&e.length?FM(e).reduce((i,r)=>(i[r]=!0,i),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}get showHintIfNoOptions(){return this._showHintIfNoOptions}set showHintIfNoOptions(e){this._showHintIfNoOptions=Si(e)}ngAfterContentInit(){this._keyManager=new FF(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this._showPanel.next(!!this.options.length||!!this.hints.length&&this.showHintIfNoOptions),this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const i=new MY(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}}return n.\u0275fac=function(e){return new(e||n)(le(lo),le(ei),le(DN),le(la))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-autocomplete"]],contentQueries:function(e,i,r){if(1&e&&(Ro(r,Nx,5),Ro(r,KM,5),Ro(r,cW,5)),2&e){let a;_i(a=bi())&&(i.options=a),_i(a=bi())&&(i.optionGroups=a),_i(a=bi())&&(i.hints=a)}},viewQuery:function(e,i){if(1&e&&(io(Yo,7),io(CY,5)),2&e){let r;_i(r=bi())&&(i.template=r.first),_i(r=bi())&&(i.panel=r.first)}},hostAttrs:[1,"sbb-autocomplete"],inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",localeNormalizer:"localeNormalizer",autoActiveFirstOption:"autoActiveFirstOption",autoSelectActiveOption:"autoSelectActiveOption",panelWidth:"panelWidth",classList:["class","classList"],showHintIfNoOptions:"showHintIfNoOptions"},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["sbbAutocomplete"],features:[wi([{provide:XT,useExisting:n}])],ngContentSelectors:EY,decls:1,vars:0,consts:[["role","listbox",1,"sbb-panel","sbb-panel-padded","sbb-autocomplete-panel","sbb-scrollbar",3,"id","ngClass"],["panel",""]],template:function(e,i){1&e&&(ss(),Ct(0,DY,3,4,"ng-template"))},dependencies:[bm],styles:[".sbb-autocomplete-visible{visibility:visible}.sbb-autocomplete-hidden{visibility:hidden;padding:0 !important}:where(html:not(.sbb-lean)) .sbb-autocomplete-panel .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,changeDetection:0}),n})();const IN=new Qt("sbb-autocomplete-scroll-strategy"),kY={provide:IN,deps:[Ls],useFactory:function RY(n){return()=>n.scrollStrategies.reposition()}};let SC=(()=>{class n{constructor(e,i,r,a,p,y,T,P,z,H){this._element=e,this._overlay=i,this._viewContainerRef=r,this._zone=a,this._changeDetectorRef=p,this._formField=T,this._document=P,this._viewportRuler=z,this._defaults=H,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._viewportSubscription=Qe.EMPTY,this._positionSubscription=Qe.EMPTY,this._highlightSubscription=Qe.EMPTY,this._connectedElementClassSubscription=Qe.EMPTY,this._inputValue=new Qa(""),this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new fn,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="sbb-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=p_(()=>{const J=this.autocomplete?this.autocomplete.options:null;return J?J.changes.pipe(va(J),el(()=>yo(...J.map(oe=>oe.onSelectionChange)))):this._zone.onStable.pipe(ko(1),el(()=>this.optionSelections))}),this._scrollStrategy=y}get autocomplete(){return this._autocomplete}set autocomplete(e){if(this._autocomplete=e,this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),!e)return;const i=e.options?si(null):this._zone.onStable.pipe(ko(1));this._highlightSubscription=i.pipe(el(()=>h_([this._inputValue,e.options.changes.pipe(va(e.options.toArray()))])),go(r=>!!r[1]&&!!r[1].length)).subscribe(([r,a])=>{a.forEach(p=>p._highlight(r,this.autocomplete.localeNormalizer))}),this._connectedElementClassSubscription=this.autocomplete._showPanel.pipe(Am(),go(r=>!r)).subscribe(()=>{this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")})}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=Si(e)}ngAfterViewInit(){const e=this._getWindow();void 0!==e&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();void 0!==e&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay()}closePanel(){!this._overlayAttached||(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above"),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return yo(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(go(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(go(()=>this._overlayAttached)):si()).pipe(ge(e=>e instanceof s3?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return yo(ld(this._document,"click"),ld(this._document,"auxclick"),ld(this._document,"touchend")).pipe(go(e=>{const i=Mm(e),r=this._formField?this._formField._elementRef.nativeElement:null,a=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&i!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!r||!r.contains(i))&&(!a||!a.contains(i))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(i)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const i=e.keyCode,r=nl(e);if(27===i&&!r&&e.preventDefault(),this.activeOption&&13===i&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const a=this.autocomplete._keyManager.activeItem,p=38===i||40===i;9===i||p&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):p&&this._canOpen()&&this.openPanel(),(p||this.autocomplete._keyManager.activeItem!==a)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){const i=e.target;let r=i.value;"number"===i.type&&(r=""===r?null:parseFloat(r)),this._previousValue!==r&&(this._previousValue=r,this._pendingAutoselectedOption=null,this._onChange(r),this._inputValue.next(i.value),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay()):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_updateSize(){var e;null===(e=this._overlayRef)||void 0===e||e.updateSize({width:this._getPanelWidth()})}_subscribeToClosingActions(){const e=this._zone.onStable.pipe(ko(1)),i=this.autocomplete.options.changes.pipe(ks(()=>this._positionStrategy.reapplyLastPosition()),function TY(n,t=NT){const e=GM(n,t);return CN(()=>e)}(0));return yo(e,i).pipe(el(()=>(this._zone.run(()=>{const r=this.panelOpen;if(this._resetActiveItem(),this.autocomplete._setVisibility(),this._changeDetectorRef.detectChanges(),this.panelOpen){const a=this.autocomplete.panel.nativeElement.scrollTop;this._overlayRef.updatePosition(),this.autocomplete.panel.nativeElement.scrollTop=a}r!==this.panelOpen&&(this.panelOpen?this.autocomplete.opened.emit():this.autocomplete.closed.emit())}),this.panelClosingActions)),ko(1)).subscribe(r=>this._setValueAndClose(r))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const i=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(null!=i?i:"")}_updateNativeInputValue(e){this._formField&&this._formField._control?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e,this._inputValue.next(e)}_setValueAndClose(e){const i=e?e.source:this._pendingAutoselectedOption;i&&(this._clearPreviousSelectedOption(i),this._assignOptionValue(i.value),this._onChange(i.value),this.autocomplete._emitSelectEvent(i),this._element.nativeElement.focus()),this.closePanel()}_clearPreviousSelectedOption(e){this.autocomplete.options.forEach(i=>{i!==e&&i.selected&&i.deselect()})}_attachOverlay(){var e;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new D_(this.autocomplete.template,this._viewContainerRef,{id:null===(e=this._formField)||void 0===e?void 0:e.getLabelId()}),i=this._overlay.create(this._getOverlayConfig()),this._overlayRef=i,this._positionStrategy&&(this._positionSubscription.unsubscribe(),this._positionSubscription=h_([this._positionStrategy.positionChanges,this.autocomplete._showPanel]).subscribe(([a,p])=>{this.autocomplete.panel&&p&&(this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel"),"top"===a.connectionPair.originY?(this.autocomplete.panel.nativeElement.classList.add("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.autocomplete.panel.nativeElement.classList.remove("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")))})),this._handleOverlayEvents(i),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})})),i&&!i.hasAttached()&&(i.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const r=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&r!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var e;return new M_({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),panelClass:FM(null===(e=this._defaults)||void 0===e?void 0:e.overlayPanelClass).concat("sbb-overlay-panel"),minHeight:0})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!0).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,a=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}];let p;p="above"===this.position?a:"below"===this.position?i:[...i,...a],e.withPositions(p)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;e.autoActiveFirstOption?e._keyManager.setFirstItemActive():e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}_scrollToOption(e){const i=this.autocomplete,r=function aW(n,t,e){if(e.length){const i=t.toArray(),r=e.toArray();let a=0;for(let p=0;p<n+1;p++)i[p].group&&i[p].group===r[a]&&a++;return a}return 0}(e,i.options,i.optionGroups);if(0===e&&1===r)i._setScrollTop(0);else if(i.panel){const a=i.options.toArray()[e];if(a){const p=a._getHostElement(),y=a3(p.offsetTop,p.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(y)}}}_handleOverlayEvents(e){e.keydownEvents().subscribe(i=>{var r;(27===i.keyCode&&!nl(i)||38===i.keyCode&&nl(i,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(null!==(r=this._valueBeforeAutoSelection)&&void 0!==r?r:""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),i.stopPropagation(),i.preventDefault())}),e.outsidePointerEvents().subscribe()}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(Ls),le(Rs),le(Oi),le(lo),le(IN),le(bC,9),le(Mi,8),le(cd),le(DN,8))},n.\u0275dir=cn({type:n,selectors:[["input","sbbAutocomplete",""]],hostAttrs:[1,"sbb-autocomplete-trigger"],hostVars:9,hostBindings:function(e,i){1&e&&Zt("focusin",function(){return i._handleFocus()})("blur",function(){return i._onTouched()})("input",function(a){return i._handleInput(a)})("keydown",function(a){return i._handleKeydown(a)})("click",function(){return i._handleClick()}),2&e&&(Yn("autocomplete",i.autocompleteAttribute)("role",i.autocompleteDisabled?null:"combobox")("aria-autocomplete",i.autocompleteDisabled?null:"list")("aria-activedescendant",i.panelOpen&&i.activeOption?i.activeOption.id:null)("aria-expanded",i.autocompleteDisabled?null:i.panelOpen.toString())("aria-owns",i.autocompleteDisabled||!i.panelOpen||null==i.autocomplete?null:i.autocomplete.id)("aria-haspopup",i.autocompleteDisabled?null:"listbox"),l("sbb-focused",i.panelOpen))},inputs:{autocomplete:["sbbAutocomplete","autocomplete"],position:["sbbAutocompletePosition","position"],connectedTo:["sbbAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["sbbAutocompleteDisabled","autocompleteDisabled"]},exportAs:["sbbAutocompleteTrigger"],features:[wi([{provide:Vl,useExisting:dr(()=>n),multi:!0}]),xo]}),n})(),MN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[kY],imports:[ro,C_,uc,Pr,ZT,ZT,uc]}),n})();function PY(n,t){if(1&n&&(ae(0,"b"),W(1),de()),2&n){const e=Ot().$implicit;_e(1),Se("(",e.originSystem,")")}}function LY(n,t){if(1&n&&(ae(0,"sbb-option",11),W(1),Ct(2,PY,2,1,"b",12),de()),2&n){const e=t.$implicit,i=t.index;Ve("value",Ot(2).$implicit[0]+"."+i),_e(1),Se(" ",e.computeLocationName()," "),_e(1),Ve("ngIf",null==e?null:e.originSystem)}}function OY(n,t){if(1&n&&(ae(0,"sbb-optgroup",9),Ct(1,LY,3,3,"sbb-option",10),de()),2&n){const e=Ot().$implicit,i=Ot();Ve("label",e[1]),_e(1),Ve("ngForOf",i.mapLookupLocations[e[0]])}}function FY(n,t){if(1&n&&(Uo(0),Ct(1,OY,2,2,"sbb-optgroup",8),Zo()),2&n){const e=t.$implicit,i=Ot();_e(1),Ve("ngIf",i.mapLookupLocations[e[0]].length>0)}}class NY{isErrorState(t,e){return!!(t&&t.invalid&&(t.dirty||t.touched||e&&e.submitted))}}let BY=(()=>{class n{constructor(e,i,r){this.mapService=e,this.userTripService=i,this.languageService=r,this.shouldFetchNewData=!0,this.inputControl=new Qp("",[AI.required]),this.inputControlMatcher=new NY,this.placeholder="",this.endpointType="From",this.inputValue="",this.selectedLocation=new Cn,this.mapLookupLocations={},this.resetMapLocations(),this.optionLocationTypes=[["stop","Stops"],["poi","POIs"],["topographicPlace","Topographic Places"],["address","Addresses"]]}ngOnInit(){this.inputControl.valueChanges.pipe(gh(500),Am()).subscribe(e=>{if(null===e||!this.shouldFetchNewData)return;if(0===e.trim().length)return void this.selectedLocation.emit(null);if(e.length<1)return;const i=Ko.initFromLiteralCoords(e);if(i)return this.resetMapLocations(),void this.handleCoordsPick(i);this.fetchJourneyPoints(e)})}ngOnChanges(e){if("inputValue"in e){const i=e.inputValue.currentValue;if(""===i)return;this.inputControl.setValue(i,{emitEvent:!1})}}onOpenAutocomplete(){this.shouldFetchNewData=!0}onOptionSelected(e){this.shouldFetchNewData=!1;const i=e.option.value.split(".");if(2!==i.length)return;const r=i[0],a=parseInt(i[1],10),p=this.mapLookupLocations[r][a],y=p.computeLocationName();this.inputControl.setValue(y),this.selectedLocation.emit(p)}fetchJourneyPoints(e){var i=this;return ua(function*(){let r=i.userTripService.getStageConfig();const p=yield rl.initWithLocationName(r,i.languageService.language,e,[]).fetchResponse();i.resetMapLocations(),p.locations.forEach(y=>{const T=y.getLocationType();null!==T&&i.mapLookupLocations[T].push(y)})})()}handleTapOnMapButton(){const e=(()=>{var i,r,a,p;if("From"===this.endpointType)return null!==(r=null===(i=this.userTripService.fromTripLocation)||void 0===i?void 0:i.location)&&void 0!==r?r:null;if("To"===this.endpointType)return null!==(p=null===(a=this.userTripService.toTripLocation)||void 0===a?void 0:a.location)&&void 0!==p?p:null;if("Via"===this.endpointType){const y=this.userTripService.viaTripLocations;if(y.length>0)return y[0].location}return null})();this.mapService.tryToCenterAndZoomToLocation(e)}handleCoordsPick(e){const i=e.geoPosition;if(null===i)return;const r=i.asLatLngString(!1);this.inputControl.setValue(r),this.selectedLocation.emit(e)}resetMapLocations(){this.mapLookupLocations={address:[],poi:[],stop:[],topographicPlace:[]}}}return n.\u0275fac=function(e){return new(e||n)(le(Sh),le(Ba),le(Th))},n.\u0275cmp=Ut({type:n,selectors:[["journey-point-input"]],inputs:{placeholder:"placeholder",endpointType:"endpointType",inputValue:"inputValue"},outputs:{selectedLocation:"selectedLocation"},features:[xo],decls:11,vars:5,consts:[[1,"w-100","trip-endpoint"],[1,"endpoint-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["sbbInput","","type","text",1,"trip-endpoint",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected","opened"],["journeyPoint","sbbAutocomplete"],[4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[4,"ngIf"]],template:function(e,i){if(1&e&&(ae(0,"sbb-form-field",0)(1,"div",1),Zt("click",function(){return i.handleTapOnMapButton()}),Is(),ae(2,"svg",2),dn(3,"path",3),de(),W(4),de(),Ld(),dn(5,"input",4),ae(6,"sbb-error"),W(7,"Mandatory field, please complete."),de()(),ae(8,"sbb-autocomplete",5,6),Zt("optionSelected",function(a){return i.onOptionSelected(a)})("opened",function(){return i.onOpenAutocomplete()}),Ct(10,FY,2,1,"ng-container",7),de()),2&e){const r=Oa(9);_e(4),Se(" ",i.placeholder," "),_e(1),Ve("placeholder",i.placeholder)("formControl",i.inputControl)("sbbAutocomplete",r),_e(5),Ve("ngForOf",i.optionLocationTypes)}},dependencies:[cc,Go,yu,sd,Dy,Nx,KM,EN,SC,Xy,VZ,L_],styles:[".endpoint-label[_ngcontent-%COMP%]{font-size:12px}.endpoint-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})();class TC{static parseNumber(t){const e=parseFloat(t);return isNaN(e)?null:e}}const zY=["panel"];function VY(n,t){if(1&n&&(ae(0,"span",7),W(1),de()),2&n){const e=Ot();_e(1),ce(e.readonly?"-":e.placeholder||"\xa0")}}function jY(n,t){if(1&n&&(ae(0,"span",8)(1,"span"),W(2),de()()),2&n){const e=Ot();_e(2),ce(e.triggerValue||"\xa0")}}function UY(n,t){1&n&&dn(0,"sbb-icon",9)}function HY(n,t){1&n&&dn(0,"sbb-icon",10)}function GY(n,t){if(1&n){const e=Zr();ae(0,"div",11,12),Zt("@transformPanel.done",function(r){return di(e),oi(Ot()._panelDoneAnimatingStream.next(r.toState))})("keydown",function(r){return di(e),oi(Ot()._handleKeydown(r))}),Yr(2),de()}if(2&n){const e=Ot();o("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),l("sbb-select-multiple",e.multiple),Ve("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),Yn("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const qY=["*"],$Y={transformPanel:ya("transformPanel",[oo("void",mi({opacity:0})),oo("showing",mi({opacity:1})),oo("showing-multiple",mi({opacity:1})),kr("void => *",zr("120ms cubic-bezier(0, 0, 0.2, 1)")),kr("* => void",zr("100ms 25ms linear",mi({opacity:0})))])};let AN=0;const RN=new Qt("sbb-select-scroll-strategy"),XY=new Qt("SBB_SELECT_CONFIG"),ZY={provide:RN,deps:[Ls],useFactory:function WY(n){return()=>n.scrollStrategies.reposition()}};class YY{constructor(t,e){this.source=t,this.value=e}}const KY=jy(Ul($T(I_(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new fn}}))));let JY=(()=>{class n extends KY{constructor(e,i,r,a,p,y,T,P,z,H,J,oe,fe){var Ae;super(a,y,T,z),this._viewportRuler=e,this._changeDetectorRef=i,this._ngZone=r,this._elementRef=p,this._parentFormField=P,this.ngControl=z,this._liveAnnouncer=oe,this._defaultOptions=fe,this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"}],this._panelOpen=!1,this._compareWith=(We,ot)=>We===ot,this._uid="sbb-select-"+AN++,this._triggerAriaLabelledBy=null,this._destroy=new fn,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="sbb-select-value-"+AN++,this._panelDoneAnimatingStream=new fn,this._overlayPanelClass=(null===(Ae=this._defaultOptions)||void 0===Ae?void 0:Ae.overlayPanelClass)||"sbb-overlay-panel",this._focused=!1,this.controlType="sbb-select",this._multiple=!1,this._readonly=!1,this.ariaLabel="",this.optionSelectionChanges=p_(()=>{const We=this.options;return We?We.changes.pipe(va(We),el(()=>yo(...We.map(ot=>ot.onSelectionChange)))):this._ngZone.onStable.pipe(ko(1),el(()=>this.optionSelectionChanges))}),this.openedChange=new Cn,this._openedStream=this.openedChange.pipe(go(We=>We),ge(()=>{})),this._closedStream=this.openedChange.pipe(go(We=>!We),ge(()=>{})),this.selectionChange=new Cn,this.valueChange=new Cn,this.ngControl&&(this.ngControl.valueAccessor=this),null!=(null==fe?void 0:fe.typeaheadDebounceInterval)&&(this._typeaheadDebounceInterval=fe.typeaheadDebounceInterval),this._scrollStrategyFactory=J,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(H,10)||0,this.id=this.id,this._overlayOrigin=new k3(p)}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){var e,i,r,a;return null!==(a=null!==(e=this._required)&&void 0!==e?e:null===(r=null===(i=this.ngControl)||void 0===i?void 0:i.control)||void 0===r?void 0:r.hasValidator(AI.required))&&void 0!==a&&a}set required(e){this._required=Si(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=Si(e)}get readonly(){return this._readonly}set readonly(e){this._readonly=Si(e),this.stateChanges.next()}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){this._assignValue(e)&&this._onChange(e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=af(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new H7(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(Am(),br(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(br(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(br(this._destroy)).subscribe(e=>{e.added.forEach(i=>i.select()),e.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(va(null),br(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby(),i=this.ngControl;if(e!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?r.setAttribute("aria-labelledby",e):r.removeAttribute("aria-labelledby")}this.ngControl&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(e){(e.disabled||e.userAriaDescribedBy)&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this._elementRef.nativeElement).fontSize||"0",10),this._ngZone.onStable.pipe(ko(1)).subscribe(()=>{this._triggerFontSize&&this.overlayDir.overlayRef&&this.overlayDir.overlayRef.overlayElement&&(this.overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`),this._calculateOverlayPosition()}))}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation("ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this._assignValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){var e,i;return this.multiple?(null===(e=this._selectionModel)||void 0===e?void 0:e.selected)||[]:null===(i=this._selectionModel)||void 0===i?void 0:i.selected[0]}get triggerValue(){return this.empty?"":this._multiple?this._selectionModel.selected.map(i=>i.viewValue).join(", "):this._selectionModel.selected[0].viewValue}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const i=e.keyCode,r=40===i||38===i||37===i||39===i,a=13===i||32===i,p=this._keyManager;if(!p.isTyping()&&a&&!nl(e)||(this.multiple||e.altKey)&&r)e.preventDefault(),this.open();else if(!this.multiple){const y=this.selected;p.onKeydown(e);const T=this.selected;T&&y!==T&&this._liveAnnouncer.announce(T.viewValue,1e4)}}_handleOpenKeydown(e){const i=this._keyManager,r=e.keyCode,a=40===r||38===r,p=i.isTyping();if(a&&e.altKey)e.preventDefault(),this.close();else if(p||13!==r&&32!==r||!i.activeItem||nl(e))if(!p&&this._multiple&&65===r&&e.ctrlKey){e.preventDefault();const y=this.options.some(T=>!T.disabled&&!T.selected);this.options.forEach(T=>{T.disabled||(y?T.select():T.deselect())})}else{const y=i.activeItemIndex;i.onKeydown(e),this._multiple&&a&&e.shiftKey&&i.activeItem&&i.activeItemIndex!==y&&i.activeItem._selectViaInteraction()}else e.preventDefault(),i.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this.overlayDir.positionChange.pipe(ko(1)).subscribe(e=>{"top"===e.connectionPair.originY?(this.panel.nativeElement.classList.add("sbb-panel-above"),this._elementRef.nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.panel.nativeElement.classList.remove("sbb-panel-above"),this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above")),this._changeDetectorRef.detectChanges(),this._positioningSettled()})}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(e);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(e){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return null!=r.value&&this._compareWith(r.value,e)}catch(a){return!1}});return i&&this._selectionModel.select(i),i}_assignValue(e){return!!(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e,!0)}_initKeyManager(){this._keyManager=new FF(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation("ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(br(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(br(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=yo(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(br(e)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),yo(...this.options.map(i=>i._stateChanges)).pipe(br(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,i){const r=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(r!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),i&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),i&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),r!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,e):e.indexOf(i)-e.indexOf(r)),this.stateChanges.next()}}_propagateChanges(e){let i=null;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:e,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(new YY(this,i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0&&!this.readonly}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let r=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(r+=" "+this.ariaLabelledby),r}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this.overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),e||this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above"),this.openedChange.emit(e)}_getOverlayMinWidth(){var e;return null===(e=this._triggerRect)||void 0===e?void 0:e.width}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}_calculateOverlayScroll(e,i,r){const a=e._getHostElement().offsetHeight,p=e._getHostElement().offsetTop;return Math.min(Math.max(0,p-i+a/2),r)}_scrollOptionIntoView(e){if(0===e)this.panel.nativeElement.scrollTop=0;else{const i=this.options.toArray()[e];if(i){const r=i._getHostElement();this.panel.nativeElement.scrollTop=a3(r.offsetTop,r.offsetHeight,this.panel.nativeElement.scrollTop,this.panel.nativeElement.offsetHeight)}}}_positioningSettled(){this.panel.nativeElement.scrollTop=this._scrollTop}_calculateOverlayPosition(){if(!this.panel)return;const e=this.panel.nativeElement.clientHeight,r=this.panel.nativeElement.scrollHeight-e,a=this._selectionModel.selected[0];this._scrollTop=this.empty||-1===this.options.toArray().indexOf(a)?0:this._calculateOverlayScroll(a,e/2,r)}}return n.\u0275fac=function(e){return new(e||n)(le(cd),le(lo),le(Oi),le(YM),le(ei),le(Cy,8),le(Ey,8),le(bC,8),le(Oc,10),us("tabindex"),le(RN),le(UF),le(XY,8))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-select"]],contentQueries:function(e,i,r){if(1&e&&(Ro(r,Nx,5),Ro(r,KM,5)),2&e){let a;_i(a=bi())&&(i.options=a),_i(a=bi())&&(i.optionGroups=a)}},viewQuery:function(e,i){if(1&e&&(io(zY,5),io(P3,5)),2&e){let r;_i(r=bi())&&(i.panel=r.first),_i(r=bi())&&(i.overlayDir=r.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"sbb-select","sbb-input-element"],hostVars:26,hostBindings:function(e,i){1&e&&Zt("click",function(){return i.toggle()})("keydown",function(a){return i._handleKeydown(a)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&e&&(Yn("id",i.id)("tabindex",i.readonly?-1:i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-owns",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),l("sbb-disabled",i.disabled)("sbb-select-invalid",i.errorState)("sbb-select-required",i.required)("sbb-select-empty",i.empty)("sbb-select-multiple",i.multiple)("sbb-readonly",i.readonly)("sbb-focused",i.focused)("sbb-input-with-open-panel",i.panelOpen))},inputs:{disabled:"disabled",tabIndex:"tabIndex",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",readonly:"readonly",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["sbbSelect"],features:[wi([{provide:Xx,useExisting:n},{provide:XT,useExisting:n}]),zn,xo],ngContentSelectors:qY,decls:8,vars:20,consts:[["aria-hidden","true",1,"sbb-select-value",3,"ngSwitch"],["class","sbb-select-placeholder",4,"ngSwitchCase"],["class","sbb-select-value-text",4,"ngSwitchCase"],[3,"ngSwitch"],["class","sbb-icon-scaled sbb-select-arrow-icon","svgIcon","kom:chevron-small-down-small",4,"ngSwitchCase"],["class","sbb-icon-scaled sbb-select-arrow-icon sbb-select-arrow-icon-lean","svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayFlexibleDimensions","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","cdkConnectedOverlayOffsetX","cdkConnectedOverlayOffsetY","cdkConnectedOverlayMinHeight","backdropClick","attach","detach"],[1,"sbb-select-placeholder"],[1,"sbb-select-value-text"],["svgIcon","kom:chevron-small-down-small",1,"sbb-icon-scaled","sbb-select-arrow-icon"],["svgIcon","kom:chevron-right-small",1,"sbb-icon-scaled","sbb-select-arrow-icon","sbb-select-arrow-icon-lean"],["role","listbox","tabindex","-1",1,"sbb-panel","sbb-panel-padded","sbb-select-panel","sbb-scrollbar",3,"ngClass","keydown"],["panel",""]],template:function(e,i){1&e&&(ss(),ae(0,"div",0),Ct(1,VY,2,1,"span",1),Ct(2,jY,3,1,"span",2),de(),Uo(3,3),gy(4,"async"),Ct(5,UY,1,0,"sbb-icon",4),Ct(6,HY,1,0,"sbb-icon",5),Zo(),Ct(7,GY,3,12,"ng-template",6),Zt("backdropClick",function(){return i.close()})("attach",function(){return i._onAttached()})("detach",function(){return i.close()})),2&e&&(l("sbb-select-value-empty",i.empty),Ve("ngSwitch",i.empty),Yn("id",i._valueId),_e(1),Ve("ngSwitchCase",!0),_e(1),Ve("ngSwitchCase",!1),_e(1),Ve("ngSwitch",_y(4,18,i.variant)),_e(2),Ve("ngSwitchCase","standard"),_e(1),Ve("ngSwitchCase","lean"),_e(1),Ve("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",i._overlayOrigin)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayWidth",i._getOverlayMinWidth())("cdkConnectedOverlayOffsetX",0)("cdkConnectedOverlayOffsetY",i._offsetY)("cdkConnectedOverlayMinHeight",30))},dependencies:[bm,wy,AS,P3,vl,ix],styles:[".sbb-select{display:inline-block;cursor:pointer;position:relative;text-align:left;padding-right:calc(2.9333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-select{padding-right:2.5333333333rem}.sbb-select:is([readonly],.sbb-readonly){cursor:default}.sbb-form-field .sbb-select,.sbb-table th.sbb-header-cell.sbb-table-filter .sbb-select{display:block}.sbb-select-value{overflow:hidden;text-overflow:ellipsis}:where(html.sbb-lean) .sbb-select-value-empty{color:var(--sbb-color-storm)}.sbb-select-arrow-icon{position:absolute;top:50%;transform:translateY(-50%);right:calc(0.6rem * var(--sbb-scaling-factor));color:var(--sbb-color-granite)}:where(html.sbb-lean) .sbb-select-arrow-icon{right:.4rem}.sbb-select:is([readonly],.sbb-readonly) .sbb-select-arrow-icon{display:none}.sbb-select-arrow-icon>svg{transition:transform 120ms cubic-bezier(0, 0, 0.2, 1)}.sbb-input-with-open-panel .sbb-select-arrow-icon>svg{transform:rotate(180deg)}.sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(90deg)}.sbb-input-with-open-panel .sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(-90deg)}.sbb-select-panel :is(.sbb-menu-group+.sbb-menu-group,.sbb-menu-item+.sbb-menu-group,.sbb-menu-group+.sbb-menu-item){border-top:none}:where(html:not(.sbb-lean)) .sbb-select-panel.sbb-select-multiple .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[$Y.transformPanel]},changeDetection:0}),n})(),kN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[ZY],imports:[ro,uc,Pr,cs,ZT,ZT,uc]}),n})();function QY(n,t){if(1&n&&(ae(0,"sbb-option",18),W(1),de()),2&n){const e=t.$implicit,i=Ot(2);Ve("value",e.modeType),_e(1),ce(i.computeTripModeTypeText(e.modeType))}}function eK(n,t){if(1&n){const e=Zr();ae(0,"div")(1,"sbb-form-field",4)(2,"sbb-label"),W(3,"Mono-/Multi-modal"),de(),ae(4,"sbb-select",5),Zt("ngModelChange",function(r){return di(e),oi(Ot().userTripService.tripModeType=r)})("selectionChange",function(){return di(e),oi(Ot().onTripModeChange())}),Ct(5,QY,2,2,"sbb-option",6),de()()()}if(2&n){const e=Ot();_e(4),Ve("ngModel",e.userTripService.tripModeType),_e(1),Ve("ngForOf",e.tripTransportModeData)}}function tK(n,t){if(1&n&&(ae(0,"sbb-option",18),W(1),de()),2&n){const e=t.$implicit,i=Ot();Ve("value",e),_e(1),ce(i.computeTripTransportModeText(e))}}function nK(n,t){1&n&&dn(0,"sbb-icon",19)}function iK(n,t){1&n&&dn(0,"sbb-icon",20)}function rK(n,t){if(1&n){const e=Zr();Uo(0),ae(1,"div",13)(2,"div",3)(3,"sbb-checkbox",14),Zt("ngModelChange",function(r){return di(e),oi(Ot().isFilterMinDurationEnabled=r)})("change",function(){return di(e),oi(Ot().updateAdditionalRestrictions())}),W(4," MinDuration "),de()(),ae(5,"div"),dn(6,"input",21),W(7," minutes "),de()(),ae(8,"div",13)(9,"div",3)(10,"sbb-checkbox",14),Zt("ngModelChange",function(r){return di(e),oi(Ot().isFilterMaxDurationEnabled=r)})("change",function(){return di(e),oi(Ot().updateAdditionalRestrictions())}),W(11," MaxDuration "),de()(),ae(12,"div"),dn(13,"input",21),W(14," minutes "),de()(),ae(15,"div",13)(16,"div",3)(17,"sbb-checkbox",14),Zt("ngModelChange",function(r){return di(e),oi(Ot().isFilterMinDistanceEnabled=r)})("change",function(){return di(e),oi(Ot().updateAdditionalRestrictions())}),W(18," MinDistance "),de()(),ae(19,"div"),dn(20,"input",22),W(21," meters "),de()(),ae(22,"div",13)(23,"div",3)(24,"sbb-checkbox",14),Zt("ngModelChange",function(r){return di(e),oi(Ot().isFilterMaxDistanceEnabled=r)})("change",function(){return di(e),oi(Ot().updateAdditionalRestrictions())}),W(25," MaxDistance "),de()(),ae(26,"div"),dn(27,"input",22),W(28," meters "),de()(),Zo()}if(2&n){const e=Ot();_e(3),Ve("ngModel",e.isFilterMinDurationEnabled),_e(3),Ve("formControl",e.filterMinDurationControl),_e(4),Ve("ngModel",e.isFilterMaxDurationEnabled),_e(3),Ve("formControl",e.filterMaxDurationControl),_e(4),Ve("ngModel",e.isFilterMinDistanceEnabled),_e(3),Ve("formControl",e.filterMinDistanceControl),_e(4),Ve("ngModel",e.isFilterMaxDistanceEnabled),_e(3),Ve("formControl",e.filterMaxDistanceControl)}}const oK=function(n){return{show:n}},CC="self-drive-car",sK=[{modeType:"monomodal",transportModes:["public_transport","walk","cycle",CC,"bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start",transportModes:["walk","cycle","bicycle_rental","escooter_rental","taxi","others-drive-car"]},{modeType:"mode_at_end",transportModes:["walk","bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start_end",transportModes:["walk","bicycle_rental","escooter_rental"]}];let aK=(()=>{class n{constructor(e){this.userTripService=e,this.filterMinDurationControl=new Qp(""),this.filterMaxDurationControl=new Qp(""),this.filterMinDistanceControl=new Qp(""),this.filterMaxDistanceControl=new Qp(""),this.tripTransportModeData=sK,this.tripTransportModes=JSON.parse(JSON.stringify(this.tripTransportModeData[0].transportModes)),this.prevTransportMode="public_transport",this.isAdditionalRestrictionsEnabled=!1,this.settingsCollapseID="mode_custom_mode_settings_NOT_READY_YET",this.filterMinDurationControl.setValue("2",{emitEvent:!1}),this.filterMaxDurationControl.setValue("30",{emitEvent:!1}),this.filterMinDistanceControl.setValue("100",{emitEvent:!1}),this.filterMaxDistanceControl.setValue("10000",{emitEvent:!1}),this.isFilterMinDurationEnabled=!0,this.isFilterMaxDurationEnabled=!0,this.isFilterMinDistanceEnabled=!0,this.isFilterMaxDistanceEnabled=!0,this.isNumberOfResultsEnabled=!0,this.isNumberOfResultsBeforeEnabled=!1,this.isNumberOfResultsAfterEnabled=!1,this.numberOfResults=5,this.numberOfResultsBefore=1,this.numberOfResultsAfter=4,this.mapPublicTransportModesFilter={},this.mapPublicTransportModesFilter.rail=!1,this.mapPublicTransportModesFilter.bus=!1,this.mapPublicTransportModesFilter.water=!1,this.mapPublicTransportModesFilter.tram=!1,this.showMonoMultiModalSelect=!0}ngOnInit(){var e;const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.userTripService.tripModeType))&&void 0!==e?e:this.tripTransportModeData[0];this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.prevTransportMode=this.userTripService.tripTransportMode,this.userTripService.defaultsInited.subscribe(r=>{this.userTripService.updateTripLocationCustomMode();const a="monomodal"===this.userTripService.tripModeType;a||(this.isAdditionalRestrictionsEnabled=!0,this.updateAdditionalRestrictions()),a&&this.userTripService.tripTransportMode===CC&&(this.numberOfResults=0,this.userTripService.numberOfResults=0),this.userTripService.publicTransportModesFilter.length>0&&(this.isAdditionalRestrictionsEnabled=!0,this.userTripService.publicTransportModesFilter.forEach(y=>{"bus"===y&&(this.mapPublicTransportModesFilter.bus=!0),"rail"===y&&(this.mapPublicTransportModesFilter.rail=!0),"water"===y&&(this.mapPublicTransportModesFilter.water=!0),"tram"===y&&(this.mapPublicTransportModesFilter.tram=!0)})),this.userTripService.searchFormAfterDefaultsInited.emit()}),this.filterMinDurationControl.valueChanges.pipe(gh(200)).subscribe(r=>{this.updateAdditionalRestrictions()}),this.filterMaxDurationControl.valueChanges.pipe(gh(200)).subscribe(r=>{this.updateAdditionalRestrictions()}),this.filterMinDistanceControl.valueChanges.pipe(gh(200)).subscribe(r=>{this.updateAdditionalRestrictions()}),this.filterMaxDistanceControl.valueChanges.pipe(gh(200)).subscribe(r=>{this.updateAdditionalRestrictions()}),this.settingsCollapseID="mode_custom_mode_settings_0"}updateAdditionalRestrictions(){let e=null,i=null,r=null,a=null,p=5,y=null,T=null;this.userTripService.publicTransportModesFilter=[],this.isAdditionalRestrictionsEnabled&&(this.isFilterMinDurationEnabled&&(e=TC.parseNumber(this.filterMinDurationControl.value)),this.isFilterMaxDurationEnabled&&(i=TC.parseNumber(this.filterMaxDurationControl.value)),this.isFilterMinDistanceEnabled&&(r=TC.parseNumber(this.filterMinDistanceControl.value)),this.isFilterMaxDistanceEnabled&&(a=TC.parseNumber(this.filterMaxDistanceControl.value)),p=this.isNumberOfResultsEnabled?this.numberOfResults:null,this.isNumberOfResultsBeforeEnabled&&(y=this.numberOfResultsBefore),this.isNumberOfResultsAfterEnabled&&(T=this.numberOfResultsAfter),["bus","tram","rail","water"].forEach(z=>{!0===this.mapPublicTransportModesFilter[z]&&this.userTripService.publicTransportModesFilter.push(z)})),this.userTripService.updateTripLocationRestrictions(e,i,r,a),this.userTripService.numberOfResults=p,this.userTripService.numberOfResultsAfter=T,this.userTripService.numberOfResultsBefore=y,this.userTripService.updateURLs()}onTripModeChange(){var e;const i=this.userTripService.tripModeType,r=null!==(e=this.tripTransportModeData.find(p=>p.modeType===i))&&void 0!==e?e:null;null!==r&&("monomodal"!==i&&(this.isAdditionalRestrictionsEnabled||(this.isAdditionalRestrictionsEnabled=!0),this.updateAdditionalRestrictions()),this.tripTransportModes=JSON.parse(JSON.stringify(r.transportModes)),-1!==this.tripTransportModes.indexOf(this.userTripService.tripTransportMode)||(this.userTripService.tripTransportMode=this.tripTransportModes[0]),this.userTripService.updateTripMode(),this.userTripService.updateTripLocationCustomMode())}onTransportModeChange(){const e=this.userTripService.tripTransportMode===CC;e&&(this.numberOfResults=0,this.userTripService.numberOfResults=0),this.prevTransportMode===CC&&!e&&(this.numberOfResults=5,this.userTripService.numberOfResults=5),this.userTripService.updateTripMode(),this.userTripService.updateTripLocationCustomMode(),this.prevTransportMode=this.userTripService.tripTransportMode}computeTripModeTypeText(e){var i;return null!==(i={monomodal:"Monomodal",mode_at_start:"Mode at Start",mode_at_end:"Mode at End",mode_at_start_end:"Mode at Start & End"}[e])&&void 0!==i?i:"n/a"}computeTripTransportModeText(e){var i;return null!==(i={public_transport:"Public Transport",walk:"Walking",cycle:"Own Bicycle",escooter_rental:"eScooter Sharing",car_sharing:"Car Sharing","self-drive-car":"Own Car",bicycle_rental:"Bicycle Sharing",charging_station:"Charging Stations",taxi:"Taxi","others-drive-car":"Limousine","car-shuttle-train":"Autoverlad",car:"Car","car-ferry":"Ferry",foot:"Foot (walking)"}[e])&&void 0!==i?i:"n/a"}toggleAdditionalRestrictions(){this.isAdditionalRestrictionsEnabled=!this.isAdditionalRestrictionsEnabled,this.updateAdditionalRestrictions()}}return n.\u0275fac=function(e){return new(e||n)(le(Ba))},n.\u0275cmp=Ut({type:n,selectors:[["trip-mode-type"]],decls:45,vars:23,consts:[[1,"trip-mot-type-container"],[1,"d-flex","gap-1","align-items-center","via-mot"],[4,"ngIf"],[1,"flex-grow-1"],[1,"w-100"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"mobility-settings"],["sbb-secondary-button","","type","button","data-bs-toggle","collapse","aria-expanded","false",3,"disabled","click"],["svgIcon","kom:filter-small",4,"ngIf"],["svgIcon","kom:filter-x-small",4,"ngIf"],[1,"mobility-settings-left-v2","endpoint-settings-wrapper","collapse",3,"ngClass","id"],[1,"endpoint-settings"],[1,"d-flex","align-items-center","mb-2"],["value","single-checkbox",3,"ngModel","ngModelChange","change"],["sbbInput","",2,"width","50px",3,"ngModel","ngModelChange","change"],[1,"d-flex","gap-2","align-items-center","mb-2"],[3,"ngModel","ngModelChange","change"],[3,"value"],["svgIcon","kom:filter-small"],["svgIcon","kom:filter-x-small"],["sbbInput","",2,"width","50px",3,"formControl"],["sbbInput","",2,"width","70px",3,"formControl"]],template:function(e,i){1&e&&(ae(0,"div",0)(1,"div",1),Ct(2,eK,6,2,"div",2),ae(3,"div",3)(4,"sbb-form-field",4)(5,"sbb-label"),W(6,"Mode of Transport"),de(),ae(7,"sbb-select",5),Zt("ngModelChange",function(a){return i.userTripService.tripTransportMode=a})("selectionChange",function(){return i.onTransportModeChange()}),Ct(8,tK,2,2,"sbb-option",6),de()()(),ae(9,"div",7)(10,"button",8),Zt("click",function(){return i.toggleAdditionalRestrictions()}),Ct(11,nK,1,0,"sbb-icon",9),Ct(12,iK,1,0,"sbb-icon",10),de()()(),ae(13,"div",11)(14,"div",12),Ct(15,rK,29,8,"ng-container",2),ae(16,"div",13)(17,"div",3)(18,"sbb-checkbox",14),Zt("ngModelChange",function(a){return i.isNumberOfResultsEnabled=a})("change",function(){return i.updateAdditionalRestrictions()}),W(19," NumberOfResults "),de()(),ae(20,"div")(21,"input",15),Zt("ngModelChange",function(a){return i.numberOfResults=a})("change",function(){return i.updateAdditionalRestrictions()}),de()()(),ae(22,"div",13)(23,"div",3)(24,"sbb-checkbox",14),Zt("ngModelChange",function(a){return i.isNumberOfResultsBeforeEnabled=a})("change",function(){return i.updateAdditionalRestrictions()}),W(25," NumberOfResultsBefore "),de()(),ae(26,"div")(27,"input",15),Zt("ngModelChange",function(a){return i.numberOfResultsBefore=a})("change",function(){return i.updateAdditionalRestrictions()}),de()()(),ae(28,"div",13)(29,"div",3)(30,"sbb-checkbox",14),Zt("ngModelChange",function(a){return i.isNumberOfResultsAfterEnabled=a})("change",function(){return i.updateAdditionalRestrictions()}),W(31," NumberOfResultsAfter "),de()(),ae(32,"div")(33,"input",15),Zt("ngModelChange",function(a){return i.numberOfResultsAfter=a})("change",function(){return i.updateAdditionalRestrictions()}),de()()(),ae(34,"div",16)(35,"div"),W(36,"Travel only with"),de(),ae(37,"sbb-checkbox",17),Zt("ngModelChange",function(a){return i.mapPublicTransportModesFilter.rail=a})("change",function(){return i.updateAdditionalRestrictions()}),W(38,"train"),de(),ae(39,"sbb-checkbox",17),Zt("ngModelChange",function(a){return i.mapPublicTransportModesFilter.bus=a})("change",function(){return i.updateAdditionalRestrictions()}),W(40,"bus"),de(),ae(41,"sbb-checkbox",17),Zt("ngModelChange",function(a){return i.mapPublicTransportModesFilter.tram=a})("change",function(){return i.updateAdditionalRestrictions()}),W(42,"tram"),de(),ae(43,"sbb-checkbox",17),Zt("ngModelChange",function(a){return i.mapPublicTransportModesFilter.water=a})("change",function(){return i.updateAdditionalRestrictions()}),W(44,"boat"),de()()()()()),2&e&&(_e(2),Ve("ngIf",i.showMonoMultiModalSelect),_e(5),Ve("ngModel",i.userTripService.tripTransportMode),_e(1),Ve("ngForOf",i.tripTransportModes),_e(2),Ve("disabled","monomodal"!==i.userTripService.tripModeType),Yn("data-bs-target","#"+i.settingsCollapseID)("aria-controls",i.settingsCollapseID),_e(1),Ve("ngIf",!i.isAdditionalRestrictionsEnabled),_e(1),Ve("ngIf",i.isAdditionalRestrictionsEnabled),_e(1),Qo("id",i.settingsCollapseID),Ve("ngClass",lS(21,oK,i.isAdditionalRestrictionsEnabled)),_e(2),Ve("ngIf",i.showMonoMultiModalSelect),_e(3),Ve("ngModel",i.isNumberOfResultsEnabled),_e(3),Ve("ngModel",i.numberOfResults),_e(3),Ve("ngModel",i.isNumberOfResultsBeforeEnabled),_e(3),Ve("ngModel",i.numberOfResultsBefore),_e(3),Ve("ngModel",i.isNumberOfResultsAfterEnabled),_e(3),Ve("ngModel",i.numberOfResultsAfter),_e(4),Ve("ngModel",i.mapPublicTransportModesFilter.rail),_e(2),Ve("ngModel",i.mapPublicTransportModesFilter.bus),_e(2),Ve("ngModel",i.mapPublicTransportModesFilter.tram),_e(2),Ve("ngModel",i.mapPublicTransportModesFilter.water))},dependencies:[bm,cc,Go,yu,sd,fh,Dy,Nx,LA,AA,Xy,Zx,vl,L_,JY],styles:[".trip-mot-type-container[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.mobility-settings[_ngcontent-%COMP%]{margin-top:3px}.mobility-settings-left-v2[_ngcontent-%COMP%]{margin-left:10px}.endpoint-settings[_ngcontent-%COMP%]{margin-bottom:18px;margin-left:12px;margin-right:12px;padding:0 14px;border-color:#cacaca;border-style:solid;border-width:0 1px 1px 1px;border-radius:2px}"]}),n})();function lK(n,t){1&n&&ys(0)}function cK(n,t){1&n&&dn(0,"sbb-icon",37)}function uK(n,t){1&n&&dn(0,"sbb-icon",38)}function dK(n,t){1&n&&(Uo(0),dn(1,"trip-mode-type"),Zo())}function hK(n,t){if(1&n&&(ae(0,"sbb-radio-button",39),W(1),de()),2&n){const e=t.$implicit;Ve("value",e),_e(1),ce(e)}}function pK(n,t){if(1&n){const e=Zr();ae(0,"sbb-radio-button",43),Zt("change",function(r){return di(e),oi(Ot(3).onChangeStageAPI(r))}),W(1),de()}if(2&n){const e=t.$implicit,i=Ot(3);Ve("value",e)("checked",i.userTripService.currentAppStage==e),_e(1),Se(" ",e," ")}}function fK(n,t){if(1&n&&(ae(0,"div",40)(1,"div")(2,"sbb-radio-group",41),Ct(3,pK,2,3,"sbb-radio-button",42),de()()()),2&n){const e=Ot(2);_e(3),Ve("ngForOf",e.appStageOptions)}}function mK(n,t){1&n&&dn(0,"span",44)}function gK(n,t){if(1&n){const e=Zr();ae(0,"div",45)(1,"button",46),Zt("click",function(){return di(e),oi(Ot(2).loadInputTripXMLPopover())}),W(2," Debug XML "),de()()}}const _K=function(n){return{show:n}};function bK(n,t){if(1&n){const e=Zr();ae(0,"div",6)(1,"div",7)(2,"journey-point-input",8),Zt("selectedLocation",function(r){return di(e),oi(Ot().onLocationSelected(r,"From"))}),de()(),ae(3,"div",9)(4,"button",10),Zt("click",function(){return di(e),oi(Ot().toggleViaState())}),Ct(5,cK,1,0,"sbb-icon",11),Ct(6,uK,1,0,"sbb-icon",12),de()()(),ae(7,"div",13)(8,"div",14)(9,"div",7)(10,"journey-point-input",8),Zt("selectedLocation",function(r){return di(e),oi(Ot().onLocationSelected(r,"Via"))}),de()(),ae(11,"div",15)(12,"sbb-form-field",16)(13,"sbb-label"),W(14,"Dwell Time (mins)"),de(),dn(15,"input",17),de()()()(),Ct(16,dK,2,0,"ng-container",18),ae(17,"div",6)(18,"div",7)(19,"journey-point-input",8),Zt("selectedLocation",function(r){return di(e),oi(Ot().onLocationSelected(r,"To"))}),de()(),ae(20,"div",9)(21,"button",19),Zt("click",function(){return di(e),oi(Ot().swapEndpoints())}),dn(22,"sbb-icon",20),de()()(),ae(23,"div",21)(24,"div")(25,"sbb-form-field",22)(26,"sbb-datepicker",23)(27,"input",24),Zt("ngModelChange",function(r){return di(e),oi(Ot().searchDate=r)})("dateChange",function(){return di(e),oi(Ot().onChangeDateTime())}),de()()()(),ae(28,"div",25)(29,"sbb-form-field",26)(30,"input",27),Zt("ngModelChange",function(r){return di(e),oi(Ot().searchTime=r)})("change",function(){return di(e),oi(Ot().onChangeDateTime())}),de()()(),ae(31,"div")(32,"button",19),Zt("click",function(){return di(e),oi(Ot().resetDateTime())}),dn(33,"sbb-icon",28),de()(),ae(34,"div")(35,"sbb-radio-group",29),Zt("ngModelChange",function(r){return di(e),oi(Ot().userTripService.currentBoardingType=r)}),Ct(36,hK,2,2,"sbb-radio-button",30),de()()(),Ct(37,fK,4,1,"div",31),ae(38,"div",32)(39,"div",33)(40,"button",34),Zt("click",function(){return di(e),oi(Ot().handleTapOnSearch())}),Ct(41,mK,1,0,"span",35),W(42," Search Journeys "),de()(),Ct(43,gK,3,0,"div",36),de()}if(2&n){const e=Ot();_e(2),Ve("endpointType","From")("inputValue",e.fromLocationText)("placeholder","From"),_e(3),Ve("ngIf",!e.userTripService.isViaEnabled),_e(1),Ve("ngIf",e.userTripService.isViaEnabled),_e(1),Ve("ngClass",lS(22,_K,e.userTripService.isViaEnabled)),_e(3),Ve("endpointType","Via")("inputValue",e.viaText)("placeholder","Via"),_e(5),Ve("formControl",e.viaDwellTime),_e(1),Ve("ngIf",!e.isEmbed),_e(3),Ve("endpointType","To")("inputValue",e.toLocationText)("placeholder","To"),_e(8),Ve("ngModel",e.searchDate),_e(3),Ve("ngModel",e.searchTime),_e(5),Ve("ngModel",e.userTripService.currentBoardingType),_e(1),Ve("ngForOf",e.tripRequestBoardingTypes),_e(1),Ve("ngIf",!1===e.isEmbed),_e(3),Ve("disabled",e.shouldDisableSearchButton()),_e(1),Ve("ngIf",e.isSearching),_e(2),Ve("ngIf",!e.isEmbed)}}function yK(n,t){if(1&n){const e=Zr();ae(0,"div",50),Zt("click",function(){return di(e),oi(Ot(2).showRequestXMLPopover())}),ae(1,"span",51),W(2,"XML"),de()()}}function vK(n,t){if(1&n&&(ae(0,"div")(1,"span",52),W(2),de()()),2&n){const e=Ot(2);_e(2),ce(e.requestDurationF)}}function xK(n,t){if(1&n&&(Uo(0),ae(1,"div")(2,"a",53),W(3,"SBB"),de()(),ae(4,"div",54),W(5," | "),de(),ae(6,"div")(7,"a",53),W(8,"BETA-v2"),de()(),ae(9,"div",54),W(10," | "),de(),ae(11,"div")(12,"a",53),W(13,"PROD"),de()(),ae(14,"div",54),W(15," | "),de(),Zo()),2&n){const e=Ot(3);_e(2),Qo("href",e.userTripService.sbbURL,hs),_e(5),Qo("href",e.userTripService.betaV2URL,hs),_e(5),Qo("href",e.userTripService.prodURL,hs)}}function wK(n,t){if(1&n){const e=Zr();Uo(0),Ct(1,xK,16,3,"ng-container",18),ae(2,"div")(3,"a",53),W(4,"Permalink"),de()(),ae(5,"div",54),W(6," | "),de(),ae(7,"div")(8,"a",55),Zt("click",function(){return di(e),oi(Ot(2).loadEmbedHTMLPopover())}),W(9,"Embed"),de()(),Zo()}if(2&n){const e=Ot(2);_e(1),Ve("ngIf",e.showURLS),_e(2),Qo("href",e.userTripService.permalinkRelativeURL,hs)}}function SK(n,t){if(1&n&&(ae(0,"div",47)(1,"div",1)(2,"div",48),Ct(3,yK,3,0,"div",49),Ct(4,vK,3,1,"div",18),Ct(5,wK,10,2,"ng-container",18),de()()()),2&n){const e=Ot();_e(3),Ve("ngIf",null!==e.currentRequestInfo),_e(1),Ve("ngIf",null!==e.requestDurationF),_e(1),Ve("ngIf",null!==e.userTripService.permalinkRelativeURL)}}function TK(n,t){if(1&n&&(ae(0,"div",47)(1,"div",1)(2,"div",56)(3,"div")(4,"a",53),W(5,"Open in OJP Demo App"),de()()()()()),2&n){const e=Ot();_e(4),Qo("href",e.userTripService.permalinkRelativeURL,hs)}}function CK(n,t){if(1&n&&(ae(0,"div",47)(1,"div",1)(2,"div"),W(3," Content from "),ae(4,"a",53),W(5),de()()()()),2&n){const e=Ot();_e(4),Qo("href",e.gistURL,hs),_e(1),ce(e.gistURL)}}let LN=(()=>{class n{constructor(e,i,r,a,p,y,T,P){this.notificationToast=e,this.tripXmlPopover=i,this.embedHTMLPopover=r,this.debugXMLPopover=a,this.router=p,this.languageService=y,this.userTripService=T,this.mapService=P,this.viaDwellTime=new Qp(""),this.appStageOptions=[];const z=this.userTripService.departureDate;this.searchDate=z,this.searchTime=Ps.formatTimeHHMM(z),this.fromLocationText="",this.toLocationText="",this.viaText="",this.appStageOptions=_A,this.isSearching=!1,this.requestDurationF=null,this.currentRequestInfo=null,this.lastCustomTripRequestXML=null,this.useMocks=!1,this.headerText="Search",this.tripRequestBoardingTypes=["Dep","Arr"];const H=new URLSearchParams(document.location.search);this.useMocks="yes"===H.get("use_mocks"),this.isEmbed=-1!==this.router.url.indexOf("/embed/"),this.gistURL=null,this.showURLS="DEBUG"===Na}ngOnInit(){this.userTripService.locationsUpdated.subscribe(e=>{this.updateLocationTexts(),this.updateViaDwellTime()}),this.userTripService.tripsUpdated.subscribe(e=>{e.length>0?this.collapseSearchPanel():this.expandSearchPanel()}),this.userTripService.searchParamsReset.subscribe(()=>{this.expandSearchPanel(),this.requestDurationF=null,this.currentRequestInfo=null}),this.userTripService.searchFormAfterDefaultsInited.subscribe(e=>{this.customInitFromParams()}),this.userTripService.tripRequestFinished.subscribe(e=>{const i=oN.computeExecutionTime(e.requestDateTime,e.responseDateTime),r=oN.computeExecutionTime(e.responseDateTime,e.parseDateTime);this.requestDurationF=(i+r).toFixed(2)+" sec",this.currentRequestInfo=e}),this.viaDwellTime.valueChanges.pipe(gh(300)).subscribe(e=>{this.updateViaDwellTime()}),this.userTripService.initDefaults(this.languageService.language)}updateViaDwellTime(){if(0===this.userTripService.viaTripLocations.length)return;let e=Number(this.viaDwellTime.value);e=isNaN(e)?null:e,this.userTripService.viaTripLocations[0].dwellTimeMinutes=e}customInitFromParams(){var e;if(this.useMocks)return void this.initLocationsFromMocks();const i=new URLSearchParams(document.location.search);if(null!==(e=i.get("do_search"))&&void 0!==e&&e)return void this.handleTapOnSearch();const a=i.get("gist");a&&this.initFromGistRef(a)}updateLocationTexts(){var e;const r=[];["From","To"].forEach(p=>{var y,T;const P="From"===p?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,z=null!==(y=null==P?void 0:P.location)&&void 0!==y?y:null;if(null===z)return;let H=null!==(T=z.computeLocationName())&&void 0!==T?T:"";"From"===p?this.fromLocationText=H.trim():this.toLocationText=H.trim(),r.push(H)}),this.userTripService.viaTripLocations.length>0&&(this.viaText=null!==(e=this.userTripService.viaTripLocations[0].location.computeLocationName())&&void 0!==e?e:"Name n/a");const a=[];a.push(""===this.fromLocationText?"From Location":this.fromLocationText),a.push("-"),a.push(""===this.toLocationText?"To Location":this.toLocationText),this.headerText=a.join(" ")}initLocationsFromMocks(){var e=this;return ua(function*(){const r=yield(yield fetch("/path/to/mock")).text();e.initFromMockXML(r)})()}initFromMockXML(e){var i=this;return ua(function*(){const r=hd.initWithResponseMock(e);r.fetchResponseWithCallback(a=>{"TripRequest.TripsNo"===a.message&&"DEBUG"===Na&&console.log("DEBUG: TripsNo => "+a.tripsNo),"TripRequest.Trip"===a.message&&("DEBUG"===Na&&console.log("DEBUG: New Trip => "+a.trips.length+"/"+a.tripsNo),1===a.trips.length&&i.handleCustomTripResponse(a.trips,r,!1)),"TripRequest.DONE"===a.message&&(i.userTripService.massageTrips(a.trips),i.handleCustomTripResponse(a.trips,r,!0))})})()}initFromGistRef(e){var i=this;return ua(function*(){const r=yield Ws.fetchGist(e);null!==r?(i.gistURL="https://gist.github.com/"+e,i.initFromMockXML(r)):console.error("initFromGistRef: cant fetch gist XML")})()}onLocationSelected(e,i){this.userTripService.updateTripEndpoint(e,i,"SearchForm")}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value),this.userTripService.refetchEndpointsByName(this.languageService.language)}onChangeDateTime(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}computeFormDepartureDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),a=parseInt(i[1]);e.setHours(r),e.setMinutes(a)}return e}shouldDisableSearchButton(){return!!this.isSearching}handleTapOnSearch(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate());const e=this.computeTripRequest();null!==e?(this.notificationToast.dismiss(),this.isSearching=!0,e.fetchResponseWithCallback(i=>{if("ERROR"===i.message)return this.notificationToast.open("ParseTripsXMLError",{type:"error",verticalPosition:"top"}),this.isSearching=!1,this.userTripService.journeyTripRequests=[],this.requestDurationF=null,this.userTripService.updateTrips([]),void this.userTripService.selectActiveTrip(null);const r=i.trips;if(this.userTripService.journeyTripRequests=[e],"TripRequest.DONE"===i.message)if(this.isSearching=!1,0===r.length&&this.notificationToast.open("No trips found",{type:"info",verticalPosition:"top"}),this.userTripService.tripRequestFinished.emit(e.requestInfo),this.userTripService.updateTrips(r),r.length>0){const a=r[0];this.userTripService.selectActiveTrip(a),this.mapService.zoomToTrip(a),this.userTripService.fetchFares()}else this.userTripService.selectActiveTrip(null);else"TripRequest.TripsNo"===i.message&&"DEBUG"===Na&&console.log("DEBUG: TripsNo => "+i.tripsNo),"TripRequest.Trip"===i.message&&("DEBUG"===Na&&console.log("DEBUG: New Trip => "+i.trips.length+"/"+i.tripsNo),this.userTripService.updateTrips(r),1===r.length)&&this.mapService.zoomToTrip(r[0])})):this.notificationToast.open("Please check from/to input points",{type:"error",verticalPosition:"top"})}expandSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.open()}collapseSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.close()}loadInputTripXMLPopover(){const e=this.tripXmlPopover.open(rZ,{position:{top:"20px"},width:"50vw"});e.afterOpened().subscribe(()=>{var i;const r=e.componentInstance,a=this.computeTripRequest();a&&(r.inputTripRequestXML=null!==(i=a.requestInfo.requestXML)&&void 0!==i?i:"n/a");const p=y=>{this.lastCustomTripRequestXML=r.inputTripRequestXML;const T=hd.initWithResponseMock(y);T.fetchResponse().then(P=>{r.inputTripRequestResponseXML=y,e.close(),this.userTripService.massageTrips(P.trips),this.handleCustomTripResponse(P.trips,T,!0)})};r.tripCustomRequestSaved.subscribe(p),r.tripCustomResponseSaved.subscribe(p)})}handleCustomTripResponse(e,i,r){if(this.requestDurationF="USER XML",this.isSearching=!1,this.userTripService.tripRequestFinished.emit(i.requestInfo),this.userTripService.journeyTripRequests=[i],this.userTripService.updateTrips(e),this.updateSearchForm(e),e.length>0){const p=e[0];this.userTripService.selectActiveTrip(p),this.mapService.zoomToTrip(p),r&&this.userTripService.fetchFares()}}updateSearchForm(e){0!==e.length&&(this.userTripService.updateParamsFromTrip(e[0]),this.updateLocationTexts())}swapEndpoints(){this.userTripService.switchEndpoints()}loadEmbedHTMLPopover(){this.embedHTMLPopover.open(mZ,{position:{top:"20px"}}).afterOpened().subscribe(()=>{})}toggleViaState(){this.userTripService.updateVia()}resetDateTime(){const e=new Date;this.searchDate=e,this.searchTime=Ps.formatTimeHHMM(e),this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}showRequestXMLPopover(){const e=this.debugXMLPopover.open(dC,{position:{top:"20px"},width:"50vw",height:"90vh"});e.afterOpened().subscribe(()=>{if(this.currentRequestInfo){const i=e.componentInstance;i.isTripRequest=!0,i.updateRequestData(this.currentRequestInfo)}})}computeTripRequest(){const e=this.userTripService.getStageConfig();return hd.initWithTripLocationsAndDate(e,this.languageService.language,this.userTripService.fromTripLocation,this.userTripService.toTripLocation,this.userTripService.departureDate,this.userTripService.currentBoardingType,!0,this.userTripService.tripModeType,this.userTripService.tripTransportMode,this.userTripService.isViaEnabled?this.userTripService.viaTripLocations:[],this.userTripService.numberOfResults,this.userTripService.numberOfResultsBefore,this.userTripService.numberOfResultsAfter,this.userTripService.publicTransportModesFilter)}}return n.\u0275fac=function(e){return new(e||n)(le(PA),le(wl),le(wl),le(wl),le(aa),le(Th),le(Ba),le(Sh))},n.\u0275cmp=Ut({type:n,selectors:[["app-search-form"]],viewQuery:function(e,i){if(1&e&&io(ff,7),2&e){let r;_i(r=bi())&&(i.searchPanel=r.first)}},decls:12,vars:6,consts:[[1,"row","mb-1"],[1,"col"],[3,"expanded"],[4,"ngTemplateOutlet"],["searchContent",""],["class","row mb-2",4,"ngIf"],[1,"d-flex","align-items-center"],[1,"flex-grow-1","journey-endpoint"],[3,"endpointType","inputValue","placeholder","selectedLocation"],[1,"right-button"],["sbb-secondary-button","","data-bs-toggle","collapse","data-bs-target","#viaContainer","aria-controls","viaContainer","aria-expanded","false",1,"btn-collapse","collapsed",3,"click"],["svgIcon","kom:plus-medium",4,"ngIf"],["svgIcon","kom:minus-medium",4,"ngIf"],["id","viaContainer",1,"collapse",3,"ngClass"],[1,"d-flex","gap-2","align-items-center"],[1,"via-dwell-time"],[1,"sbb-form-field-long"],["type","text","sbbInput","","placeholder","0",3,"formControl"],[4,"ngIf"],["sbb-secondary-button","","aria-expanded","false",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium"],[1,"d-flex","align-items-center","gap-2"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"width","70px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],["svgIcon","kom:arrow-circle-reset-small"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["class","mb-2 d-flex",4,"ngIf"],[1,"d-flex"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","ms-auto",4,"ngIf"],["svgIcon","kom:plus-medium"],["svgIcon","kom:minus-medium"],[3,"value"],[1,"mb-2","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"row","mb-2"],[1,"d-flex","gap-1","flex-row-reverse"],["class","xml-info",3,"click",4,"ngIf"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"badge","bg-success"],["target","_blank",3,"href"],["clas","text-center"],["target","_blank","role","button",1,"text-decoration-underline",3,"click"],[1,"d-flex","flex-row-reverse"]],template:function(e,i){if(1&e&&(ae(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),W(5),de(),Ct(6,lK,1,0,"ng-container",3),de()()()(),Ct(7,bK,44,24,"ng-template",null,4,qp),Ct(9,SK,6,3,"div",5),Ct(10,TK,6,1,"div",5),Ct(11,CK,6,2,"div",5)),2&e){const r=Oa(8);_e(3),Ve("expanded",!0),_e(2),ce(i.headerText),_e(1),Ve("ngTemplateOutlet",r),_e(3),Ve("ngIf",!i.isEmbed),_e(1),Ve("ngIf",i.isEmbed&&null!==i.userTripService.permalinkRelativeURL),_e(1),Ve("ngIf",null!==i.gistURL)}},dependencies:[bm,cc,Go,nx,yu,sd,fh,Dy,fC,ff,Wx,LA,vC,Yx,Xy,Zx,vl,L_,jA,wC,SN,BY,aK],styles:[".debug-xml[_ngcontent-%COMP%]:hover{cursor:pointer}.right-button[_ngcontent-%COMP%]{margin-left:5px;margin-top:10px}.via-dwell-time[_ngcontent-%COMP%]{margin-top:6px}.via-dwell-time[_ngcontent-%COMP%]   sbb-form-field[_ngcontent-%COMP%]{width:120px}"]}),n})();function DK(n,t){1&n&&(ae(0,"div",48)(1,"div",14)(2,"div"),dn(3,"input",19),de(),ae(4,"div")(5,"span",16),W(6,"Topographic Places (z12+)"),de()(),ae(7,"div")(8,"span",17),W(9,"XML"),de()()()())}let HA=(()=>{class n{constructor(){this.model={sdkVersion:eA,lastUpdate:"3.March 2025",isTopograhicPlaceMapLayerEnabled:"DEBUG"===Na}}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["web-footer"]],decls:141,vars:3,consts:[[1,"d-none"],["id","map-debug-control"],[1,"fw-bold"],["id","map_debug_center"],["id","map_debug_zoom"],["id","map-layers-legend-control"],[1,"map-layers-legend-wrapper"],[1,"d-flex","flex-row"],[1,"flex-grow-1","map-layers-header"],["href","#map_layers_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_body",1,"content-collapse","align-middle"],[1,"bi","bi-plus-circle"],[1,"bi","bi-dash-circle"],["id","map_layers_body",1,"collapse","show"],["data-map-layer-key","stops",1,"map-layer-data","mb-2"],[1,"d-flex","gap-1"],["type","checkbox","checked","",1,"map-layer-checkbox","align-middle"],[1,"layer-text"],[1,"layer-xml-info","badge","bg-info","text-dark"],["data-map-layer-key","addresses",1,"map-layer-data","mb-2"],["type","checkbox",1,"map-layer-checkbox","align-middle"],["class","map-layer-data mb-2","data-map-layer-key","topographic_places",4,"ngIf"],[1,"flex-grow-1"],["href","#map_layers_mobility_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_mobility_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_mobility_body",1,"collapse","mb-2",2,"margin-left","8px"],["data-map-layer-key","sharing_cars",1,"map-layer-data"],["data-map-layer-key","sharing_bicycles",1,"map-layer-data"],["data-map-layer-key","sharing_scooters",1,"map-layer-data"],["data-map-layer-key","charging_stations",1,"map-layer-data"],[1,"map-composite-pois"],["href","#map_layers_pois_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_pois_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_pois_body",1,"collapse","mb-2",2,"margin-left","8px"],["type","checkbox","data-osm-tag","service",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","shopping",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","leisure",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","catering",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","public",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","parkride",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","accommodation",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","sbb_services",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","other",1,"map-layer-poi","align-middle"],[1,"row","bg-ojp-blue","text-white"],[1,"bg-ojp-orange","w-100",2,"height","5px"],[1,"col"],[1,"footer"],["href","https://opentransportdata.swiss/en/","target","_blank"],["href","https://github.com/openTdataCH/ojp-demo-app-src/blob/main/CHANGELOG.md","target","_blank"],["href","https://github.com/openTdataCH/ojp-js/blob/main/CHANGELOG.md","target","_blank"],[1,"row",2,"height","16px"],["data-map-layer-key","topographic_places",1,"map-layer-data","mb-2"]],template:function(e,i){1&e&&(ae(0,"div",0)(1,"div",1)(2,"div")(3,"span",2),W(4,"Center"),de(),W(5,": "),ae(6,"span",3),W(7,"n/a"),de()(),ae(8,"div")(9,"span",2),W(10,"Zoom"),de(),W(11,": "),ae(12,"span",4),W(13,"n/a"),de()()(),ae(14,"div",5)(15,"div",6)(16,"div",7)(17,"div",8),W(18,"Toggle Map Layers"),de(),ae(19,"div")(20,"a",9),dn(21,"i",10)(22,"i",11),de()()(),ae(23,"div",12)(24,"div",13)(25,"div",14)(26,"div"),dn(27,"input",15),de(),ae(28,"div")(29,"span",16),W(30,"Stops (z13+)"),de()(),ae(31,"div")(32,"span",17),W(33,"XML"),de()()()(),ae(34,"div",18)(35,"div",14)(36,"div"),dn(37,"input",19),de(),ae(38,"div")(39,"span",16),W(40,"Addresses (z17+)"),de()(),ae(41,"div")(42,"span",17),W(43,"XML"),de()()()(),Ct(44,DK,10,0,"div",20),ae(45,"div",7)(46,"div",21),W(47,"Shared Mobility"),de(),ae(48,"div")(49,"a",22),dn(50,"i",10)(51,"i",11),de()()(),ae(52,"div",23)(53,"div",24),dn(54,"input",19),ae(55,"span",16),W(56,"Shared Cars (z12+)"),de(),ae(57,"span",17),W(58,"XML"),de()(),ae(59,"div",25),dn(60,"input",19),ae(61,"span",16),W(62,"Shared Bicycles (z14+)"),de(),ae(63,"span",17),W(64,"XML"),de()(),ae(65,"div",26),dn(66,"input",19),ae(67,"span",16),W(68,"Shared Scooters (z14+)"),de(),ae(69,"span",17),W(70,"XML"),de()(),ae(71,"div",27),dn(72,"input",19),ae(73,"span",16),W(74,"Charging Stations (z12+)"),de(),ae(75,"span",17),W(76,"XML"),de()()(),ae(77,"div",28)(78,"div",7)(79,"div",21),W(80,"Other POIs (z16+) "),ae(81,"span",17),W(82,"XML"),de()(),ae(83,"div")(84,"a",29),dn(85,"i",10)(86,"i",11),de()()(),ae(87,"div",30)(88,"div"),dn(89,"input",31),ae(90,"span",16),W(91,"Service"),de()(),ae(92,"div"),dn(93,"input",32),ae(94,"span",16),W(95,"Shopping"),de()(),ae(96,"div"),dn(97,"input",33),ae(98,"span",16),W(99,"Leisure"),de()(),ae(100,"div"),dn(101,"input",34),ae(102,"span",16),W(103,"Catering"),de()(),ae(104,"div"),dn(105,"input",35),ae(106,"span",16),W(107,"Public"),de()(),ae(108,"div"),dn(109,"input",36),ae(110,"span",16),W(111,"Parkride"),de()(),ae(112,"div"),dn(113,"input",37),ae(114,"span",16),W(115,"Accommodation"),de()(),ae(116,"div"),dn(117,"input",38),ae(118,"span",16),W(119,"SBB Services"),de()(),ae(120,"div"),dn(121,"input",39),ae(122,"span",16),W(123,"Other"),de()()()()()()()(),ae(124,"div",40),dn(125,"div",41),ae(126,"div",42)(127,"div",43)(128,"div"),W(129," \xa9 "),ae(130,"a",44),W(131,"Open-Data-Plattform Mobilit\xe4t Schweiz"),de(),W(132," 2021 - 2024 "),de(),ae(133,"div"),W(134," Last Update: "),ae(135,"a",45),W(136),de(),W(137," - "),ae(138,"a",46),W(139),de()()()()(),dn(140,"div",47)),2&e&&(_e(44),Ve("ngIf",i.model.isTopograhicPlaceMapLayerEnabled),_e(92),ce(i.model.lastUpdate),_e(3),Se("OJP SDK ",i.model.sdkVersion,""))},dependencies:[Go],encapsulation:2}),n})(),GA=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["web-header"]],decls:21,vars:2,consts:[[1,"row"],[1,"col","nav-main","bg-ojp-blue"],[1,"d-flex","flex-row","align-items-center","justify-content-between"],[1,"mt-3"],[1,"navbar-brand","text-white",3,"routerLink"],[1,"mb-2","mt-3"],["src","assets/opentransportdata.swiss.header-icons.svg","height","23"],[1,"d-none","d-md-flex"],[1,"nav-item"],["href","https://github.com/openTdataCH/ojp-demo-app-src",1,"nav-link"],["href","https://github.com/openTdataCH/ojp-demo-app-src/blob/main/docs/README.md",1,"nav-link"],["href","https://opentransportdata.swiss/en/cookbook/open-journey-planner-ojp/",1,"nav-link"],[1,"bg-ojp-orange","w-100",2,"height","10px"]],template:function(e,i){1&e&&(ae(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3)(5,"a",4),W(6,"OJP Demo"),de()(),ae(7,"div",5)(8,"a",4),dn(9,"img",6),de()()(),ae(10,"div",7)(11,"div",8)(12,"a",9),W(13,"Source Code"),de()(),ae(14,"div",8)(15,"a",10),W(16,"Docs"),de()(),ae(17,"div",8)(18,"a",11),W(19,"OJP Cookbook"),de()()()()(),dn(20,"div",12),de()),2&e&&(_e(5),Ve("routerLink","../search"),_e(3),Ve("routerLink","../search"))},dependencies:[y_],encapsulation:2}),n})(),EK=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["journey-search"]],decls:19,vars:6,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active"],["sbb-tab-link","",3,"active","routerLink"],["tabPanel",""],[1,"row"],[1,"col-md-5"],[1,"col-md-7"]],template:function(e,i){if(1&e&&(ae(0,"div",0),dn(1,"web-header"),ae(2,"div",1)(3,"nav",2)(4,"a",3),W(5,"Journey Search"),de(),ae(6,"a",4),W(7,"Station Board"),de(),ae(8,"a",4),W(9,"Trip Info"),de()(),ae(10,"sbb-tab-nav-panel",null,5)(12,"div",6)(13,"div",7),dn(14,"app-search-form")(15,"journey-results"),de(),ae(16,"div",8),dn(17,"app-map"),de()()()(),dn(18,"web-footer"),de()),2&e){const r=Oa(11);_e(3),Ve("tabPanel",r),_e(1),Ve("active","true"),_e(2),Ve("active","false")("routerLink","../board"),_e(2),Ve("active","false")("routerLink","../trip")}},dependencies:[y_,JT,QM,QT,rN,nZ,LN,HA,GA],styles:[".app-root[_ngcontent-%COMP%]{border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})();const IK=JSON.parse('{"id":"ojp-service-track-line","type":"line","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"LineString"]],"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-width":4,"line-opacity":1,"line-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"]}}'),MK=JSON.parse('{"id":"ojp-service-track-stop","type":"circle","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"Point"]],"layout":{},"paint":{"circle-radius":["case",["==",["get","point-size"],"large"],6,4],"circle-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"],"circle-stroke-color":"#FFF","circle-stroke-width":["case",["==",["get","point-size"],"large"],3,1]}}');class ON{constructor(t){this.map=t,this.sourceID="stop-event-service-data",this.geojsonFeatures=[],this.addMapLayers(t)}addMapLayers(t){t.addSource(this.sourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const i=IK;i.source=this.sourceID,t.addLayer(i);const r=MK;r.source=this.sourceID,t.addLayer(r)}drawStopEvent(t){this.drawStopPoints(t.prevStopPoints,t.nextStopPoints,t.stopPoint)}drawServiceStopPoints(t){this.drawStopPoints([],t,t[0])}drawStopPoints(t,e,i){this.geojsonFeatures=[];const r={prev:[],next:[]},a={prev:[],next:[]},p=["prev","next"];if(p.forEach(T=>{const P="prev"===T;let z=P?t:e;z.forEach((H,J)=>{const oe=H.location.geoPosition;if(null===oe)return;r[T].push(oe.asPosition());const fe=0===J,Ae=J===z.length-1,We=H.location.asGeoJSONFeature();We&&We.properties&&(We.properties["point-type"]=T,We.properties["point-size"]=P?fe?"large":"normal":Ae?"large":"normal",a[T].push(We))})}),i){const T=i.location.geoPosition;if(T){r.prev.push(T.asPosition()),r.next.unshift(T.asPosition());const P=i.location.asGeoJSONFeature();P&&P.properties&&(P.properties["point-type"]="next",P.properties["point-size"]="large",a.next.push(P))}}p.forEach(T=>{const P=r[T];P.length<2||(this.geojsonFeatures.push({type:"Feature",properties:{"line-type":T},geometry:{type:"LineString",coordinates:P}}),this.geojsonFeatures=this.geojsonFeatures.concat(a[T]))}),this.udateStopEventSource({type:"FeatureCollection",features:this.geojsonFeatures})}resetStopEventLayers(){this.geojsonFeatures=[],this.udateStopEventSource({type:"FeatureCollection",features:[]})}udateStopEventSource(t){const e=this.map.getSource(this.sourceID);if(null===e)return console.error("ERROR - cant find the source "+this.sourceID),void console.log(this.map.getStyle());e.setData(t)}}let qA=(()=>{class n{constructor(){this.stationBoardDataUpdated=new Cn,this.stationBoardEntrySelected=new Cn,this.stationOnMapClicked=new Cn,this.searchDate=new Date}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),AK=(()=>{class n{constructor(e,i,r,a,p){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.stationBoardService=a,this.languageService=p,this.mapLoadingPromise=null,this.stopEventServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToLocation(r,e)})}),this.stationBoardService.stationBoardEntrySelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.updateMapForEntry(e)})})}initMap(){const e=this.mapService.createMap("map_canvas_station_board");this.mapLoadingPromise=new Promise((i,r)=>{e.on("load",a=>{i(e),this.onMapLoad(e)})})}onMapLoad(e){this.addMapControls(e),this.addMapListeners(e),this.stopEventServiceRenderer=new ON(e)}addMapControls(e){const i=new(da().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(da().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const a=new bA(e);e.addControl(a,"top-left");const p=new SA(e,this.debugXmlPopover,this.userTripService,this.languageService);e.addControl(p,"top-right")}updateMapForEntry(e){var i,r;null===e?null===(i=this.stopEventServiceRenderer)||void 0===i||i.resetStopEventLayers():null===(r=this.stopEventServiceRenderer)||void 0===r||r.drawStopEvent(e)}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(a,p)=>{a?console.error(a):!e.hasImage(i.id)&&p&&e.addImage(i.id,p)})}),e.on("click",i=>{const r=wh.queryNearbyFeaturesByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);r.length>0&&this.stationBoardService.stationOnMapClicked.emit(r[0].feature)})}}return n.\u0275fac=function(e){return new(e||n)(le(Ba),le(Sh),le(wl),le(qA),le(Th))},n.\u0275cmp=Ut({type:n,selectors:[["station-board-map"]],decls:1,vars:0,consts:[["id","map_canvas_station_board",1,"map_wrapper"]],template:function(e,i){1&e&&dn(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),n})();const RK=["stationBoardWrapper"];function kK(n,t){if(1&n&&(ae(0,"div")(1,"div"),W(2),de()()),2&n){const e=Ot(2).$implicit;_e(2),Se("Pl. ",e.stopPlatform,"")}}function PK(n,t){if(1&n&&(ae(0,"div")(1,"div"),W(2,"Pl. "),ae(3,"del"),W(4),de(),W(5),de()()),2&n){const e=Ot(2).$implicit;_e(4),Se(" ",e.stopPlatform,""),_e(1),Se(" ",e.stopPlatformActual,"")}}function LK(n,t){if(1&n&&(ae(0,"div",17),Ct(1,kK,3,1,"div",15),Ct(2,PK,6,2,"div",15),de()),2&n){const e=Ot().$implicit;_e(1),Ve("ngIf",!e.stopPlatformActual),_e(1),Ve("ngIf",e.stopPlatformActual)}}function OK(n,t){1&n&&(ae(0,"div")(1,"span",18),W(2,"Cancelled"),de()())}function FK(n,t){1&n&&(ae(0,"div")(1,"span",19),W(2,"Deviation"),de()())}function NK(n,t){1&n&&(ae(0,"div")(1,"span",19),W(2,"Unplanned"),de()())}function BK(n,t){if(1&n&&(ae(0,"div")(1,"div",20),W(2),de()()),2&n){const e=Ot().$implicit,i=Ot();_e(2),ce(i.formatStopEventTime(e,"stopTime"))}}function zK(n,t){if(1&n&&(ae(0,"div")(1,"del"),W(2),de()()),2&n){const e=Ot(2).$implicit,i=Ot();_e(2),ce(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function VK(n,t){if(1&n&&(ae(0,"div"),Ct(1,zK,3,1,"div",15),ae(2,"div",20),W(3),de(),ae(4,"div",21),W(5),de()()),2&n){const e=Ot().$implicit,i=Ot();_e(1),Ve("ngIf",i.hasDelayDifferentTime(e)),_e(2),ce(i.formatStopEventTime(e,"stopTimeActual")),_e(2),ce(i.formatStopEventTime(e,"stopDelayText"))}}function jK(n,t){if(1&n&&(Uo(0),ae(1,"div"),W(2),de(),Zo()),2&n){const e=Ot().$implicit;_e(2),Se(" ",e.descriptions[0]," ")}}function UK(n,t){if(1&n&&(ae(0,"li"),W(1),de()),2&n){const e=t.$implicit;_e(1),Se(" ",e," ")}}function HK(n,t){if(1&n&&(Uo(0),ae(1,"ul",24),Ct(2,UK,2,1,"li",22),de(),ae(3,"h6"),W(4,"Detail"),de(),Zo()),2&n){const e=Ot().$implicit;_e(2),Ve("ngForOf",e.descriptions)}}function GK(n,t){if(1&n&&(ae(0,"li"),W(1),de()),2&n){const e=t.$implicit;_e(1),Se(" ",e," ")}}function qK(n,t){if(1&n&&(ae(0,"div")(1,"sbb-tooltip",23)(2,"p")(3,"strong"),W(4),de()(),Ct(5,jK,3,1,"ng-container",15),Ct(6,HK,5,1,"ng-container",15),ae(7,"ul",24),Ct(8,GK,2,1,"li",22),de()()()),2&n){const e=t.$implicit;_e(4),ce(e.summary),_e(1),Ve("ngIf",1===e.descriptions.length),_e(1),Ve("ngIf",e.descriptions.length>1),_e(2),Ve("ngForOf",e.details)}}function $K(n,t){if(1&n&&(ae(0,"div")(1,"div",14),Ct(2,qK,9,4,"div",22),de()()),2&n){const e=Ot().$implicit;_e(2),Ve("ngForOf",e.situations)}}const WK=function(n){return{"item-selected":n}};function XK(n,t){if(1&n){const e=Zr();ae(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),W(5),de(),ae(6,"div",7),W(7),de()(),ae(8,"div",8)(9,"div",9),W(10),de(),ae(11,"div",10)(12,"button",11),Zt("click",function(){const a=di(e).$implicit;return oi(Ot().loadTripInfoResultPopover(a.journeyRef))}),W(13),de()(),Ct(14,LK,3,2,"div",12),ae(15,"div",13)(16,"span"),W(17),de(),W(18," - "),ae(19,"span"),W(20),de()(),ae(21,"div",14),Ct(22,OK,3,0,"div",15),Ct(23,FK,3,0,"div",15),Ct(24,NK,3,0,"div",15),de()(),ae(25,"div",16),Ct(26,BK,3,1,"div",15),Ct(27,VK,6,3,"div",15),de(),Ct(28,$K,3,1,"div",15),de()()()}if(2&n){const e=t.$implicit,i=t.index,r=Ot();Ve("ngClass",lS(15,WK,i===r.selectedIDx)),Yn("data-index",i),_e(5),ce(e.serviceLineNumber),_e(2),ce(e.tripNumber),_e(3),ce(e.tripHeading),_e(3),ce(e.serviceInfo),_e(1),Ve("ngIf",e.stopPlatform),_e(3),Se("Operator: ",e.tripOperator,""),_e(3),Se("Type: ",e.servicePtMode,""),_e(2),Ve("ngIf",!0===e.isCancelled),_e(1),Ve("ngIf",!0===e.hasDeviation),_e(1),Ve("ngIf",!0===e.isUnplanned),_e(2),Ve("ngIf",!r.hasDelay(e)),_e(1),Ve("ngIf",r.hasDelay(e)),_e(1),Ve("ngIf",r.hasSituations(e))}}let FN=(()=>{class n{constructor(e,i){this.stationBoardService=e,this.tripInfoResultPopover=i,this.stopEventsData=[],this.selectedIDx=null,this.stationBoardType="Departures"}ngOnInit(){this.stationBoardService.stationBoardDataUpdated.subscribe(e=>{this.stationBoardType=e.type;const i=e.items;this.stopEventsData=[],i.forEach(r=>{const a=this.computeStationBoardModel(r);this.stopEventsData.push(a)}),i.length>0?this.selectDataRowAtIndex(0):this.stationBoardService.stationBoardEntrySelected.emit(null)})}ngAfterViewInit(){var e;(null===(e=this.stationBoardWrapperRef)||void 0===e?void 0:e.nativeElement).addEventListener("click",i=>{var r,a;const p=i.target;if(null===p)return;const y=null!==(a=null===(r=p.closest(".card-item"))||void 0===r?void 0:r.getAttribute("data-index"))&&void 0!==a?a:null;if(null===y)return;const T=parseInt(y,10);this.selectedIDx!==T&&this.selectDataRowAtIndex(T)})}selectDataRowAtIndex(e){this.selectedIDx=e,this.stationBoardService.stationBoardEntrySelected.emit(this.stopEventsData[e].stopEvent)}hasDelay(e){const i=e.mapStationBoardTime[this.stationBoardType];return!!i&&i.hasDelay}hasDelayDifferentTime(e){const i=e.mapStationBoardTime[this.stationBoardType];return!!i&&i.hasDelayDifferentTime}formatStopEventTime(e,i){const r=e.mapStationBoardTime[this.stationBoardType];return null===r?null:r[i]}hasSituations(e){return e.situations.length>0}computeServiceLineNumber(e){var i;const r=null!==(i=e.journeyService.ptMode.shortName)&&void 0!==i?i:"N/A";return e.journeyService.serviceLineNumber||r}computeStopTime(e){return null===e?null:Ps.formatTimeHHMM(e)}computeDelayTime(e,i){var r;const p="Arrivals"===i?e.arrivalData:e.departureData,y=null!==(r=null==p?void 0:p.delayMinutes)&&void 0!==r?r:null;if(null===y)return null;if(0===y)return"ON TIME";const T=[];return T.push(" "),T.push(y>0?"+":""),T.push(""+y),T.push("'"),T.join("")}computeStopTimeData(e,i){var r;const p="Arrivals"===i?e.arrivalData:e.departureData;if(null===p)return null;const y=null!==p.delayMinutes,T=Ps.formatTimeHHMM(p.timetableTime),P=p.estimatedTime?Ps.formatTimeHHMM(p.estimatedTime):"n/a",z=!!p.estimatedTime&&T!==P,H=this.computeStopTime(p.timetableTime);return null===H?null:{stopTime:H,stopTimeActual:this.computeStopTime(null!==(r=p.estimatedTime)&&void 0!==r?r:null),stopDelayText:this.computeDelayTime(e,i),hasDelay:y,hasDelayDifferentTime:z}}computeStationBoardModel(e){var i,r,a;const p=this.computeServiceLineNumber(e),y=null!==(i=e.journeyService.ptMode.shortName)&&void 0!==i?i:"N/A",T=this.computeStopTimeData(e.stopPoint,"Arrivals"),P=this.computeStopTimeData(e.stopPoint,"Departures"),z=e.stopPoint.plannedPlatform===e.stopPoint.actualPlatform?null:e.stopPoint.actualPlatform,H=!0===e.journeyService.hasCancellation,J=!0===e.journeyService.hasDeviation,oe=!0===e.journeyService.isUnplanned;return{stopEvent:e,serviceLineNumber:p,servicePtMode:y,serviceInfo:Ws.formatServiceName(e.journeyService),journeyRef:e.journeyService.journeyRef,tripNumber:e.journeyService.journeyNumber,tripHeading:null!==(a=null===(r=e.journeyService.destinationStopPlace)||void 0===r?void 0:r.stopPlaceName)&&void 0!==a?a:"N/A",tripOperator:e.journeyService.agencyID,mapStationBoardTime:{Arrivals:T,Departures:P},stopPlatform:e.stopPoint.plannedPlatform,stopPlatformActual:z,situations:Ws.computeSituationsData(e.stopPoint.siriSituations),isCancelled:H,hasDeviation:J,isUnplanned:oe}}loadTripInfoResultPopover(e){const r=Ps.formatDate(this.stationBoardService.searchDate).substring(0,10);if(null===e)return void console.error("loadTripInfoResultPopover: cant fetch empty journeyRef");const a=this.tripInfoResultPopover.open(iN,{position:{top:"20px"}});a.afterOpened().subscribe(()=>{a.componentInstance.fetchJourneyRef(e,r)})}}return n.\u0275fac=function(e){return new(e||n)(le(qA),le(wl))},n.\u0275cmp=Ut({type:n,selectors:[["station-board-result"]],viewQuery:function(e,i){if(1&e&&io(RK,5),2&e){let r;_i(r=bi())&&(i.stationBoardWrapperRef=r.first)}},decls:3,vars:1,consts:[["stationBoardWrapper",""],["class","card card card-item mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","card","card-item","mb-2",3,"ngClass"],[1,"card-body"],[1,"d-flex","dep-content","align-items-center"],[1,"service-line-number-wrapper"],[1,"service-line-number","text-center"],[1,"trip-info","text-center"],[1,"flex-fill","dep-center"],[1,"trip-heading"],[1,"d-flex"],[1,"btn","btn-primary","btn-sm",3,"click"],["class","stop-platform-text",4,"ngIf"],[1,"trip-debug"],[1,"d-flex","gap-2"],[4,"ngIf"],[1,"text-center"],[1,"stop-platform-text"],[1,"badge","rounded-pill","bg-danger","fw-bolder"],[1,"badge","rounded-pill","bg-warning","fw-bolder","text-dark"],[1,"departure-time"],[1,"departure-delay"],[4,"ngFor","ngForOf"],["trigger","hover","svgIcon","fpl:info"],[1,"tooltip-list"]],template:function(e,i){1&e&&(ae(0,"div",null,0),Ct(2,XK,29,17,"div",1),de()),2&e&&(_e(2),Ve("ngForOf",i.stopEventsData))},dependencies:[bm,cc,Go,eN],styles:[".service-line-number-wrapper[_ngcontent-%COMP%]{padding:0 16px 0 4px}.service-line-number[_ngcontent-%COMP%]{font-size:24px}.service-pt-mode[_ngcontent-%COMP%]{font-size:12px}.trip-heading[_ngcontent-%COMP%]{margin-top:2px;font-size:20px}.trip-info[_ngcontent-%COMP%]{font-size:12px}.stop-platform-wrapper[_ngcontent-%COMP%]{margin-right:4px}.stop-platform-text[_ngcontent-%COMP%]{font-size:14px}.stop-platform[_ngcontent-%COMP%]{font-size:18px}.departure-time[_ngcontent-%COMP%]{width:80px;font-size:20px}.departure-delay[_ngcontent-%COMP%]{color:#c45f00}.trip-debug[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:12px}.card-item[_ngcontent-%COMP%]{cursor:pointer}.item-selected[_ngcontent-%COMP%]{background-color:#f5f5f5}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}"]}),n})();function ZK(n,t){if(1&n&&(ae(0,"sbb-option",5),W(1),de()),2&n){const e=t.$implicit,i=Ot();Ve("value",e.stopPlaceRef),_e(1),Se(" ",i.renderLookupName(e)," ")}}let NN=(()=>{class n{constructor(e,i){this.userTripService=e,this.languageService=i,this.locationSelected=new Cn,this.searchInputControl=new Qp(""),this.stopLookups=[n.AroundMeStopLookup],this.currentStopLookup=null,this.isBusySearching=!1,this.hackIgnoreInputChangesFlag=!1}static get AroundMeStopLookup(){return{stopPlaceRef:"AROUND_ME",stopName:"Current Location",special_type:"around_me",location:null}}ngOnInit(){this.searchInputControl.valueChanges.pipe(gh(500),Am()).subscribe(e=>{this.onInputChangeAfterIdle()})}renderLookupName(e){let i=e.stopName;return e.distance&&(i+=" ("+e.distance+" m)"),i}onInputChangeAfterIdle(){const e=this.searchInputControl.value.trim();this.hackIgnoreInputChangesFlag?this.hackIgnoreInputChangesFlag=!1:0!==e.length?e.length<3||this.fetchLookupLocations(e):this.stopLookups=[n.AroundMeStopLookup]}fetchLookupLocations(e){var i=this;return ua(function*(){i.isBusySearching=!0;const a=i.userTripService.getStageConfig(),y=yield rl.initWithLocationName(a,i.languageService.language,e,["stop"]).fetchResponse();i.parseLocations(y.locations),i.isBusySearching=!1})()}parseLocations(e,i=null){this.stopLookups=[],e.forEach(r=>{var a;const p=null===(a=r.stopPlace)||void 0===a?void 0:a.stopPlaceRef;if(null===p)return;const T={stopPlaceRef:p,stopName:null!==r.locationName?r.locationName:r.computeLocationName(),location:r};r.geoPosition&&i&&(T.distance=r.geoPosition.distanceFrom(i)),this.stopLookups.push(T)}),i&&this.stopLookups.sort((r,a)=>null==r.distance||null==a.distance?0:r.distance-a.distance),this.stopLookups=this.stopLookups.slice(0,10)}onStopLookupSelected(e){var i;const r=e.option.value;let a=null!==(i=this.stopLookups.find(y=>y.stopPlaceRef===r))&&void 0!==i?i:null;if(null===a)return void console.log("WHOOPS - cant find the stop for: "+r);if("around_me"===a.special_type)return void this.handleGeolocationLookup();this.currentStopLookup=a,this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(a.stopName);const p=a.location;p&&this.locationSelected.emit(p)}handleGeolocationLookup(){navigator.geolocation?(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue("... looking up location"),navigator.geolocation.getCurrentPosition(e=>{this.handleNewGeoPosition(e,i=>{var r;const a=new Bo(e.coords.longitude,e.coords.latitude);this.parseLocations(i,a),null===(r=this.autocompleteInputTrigger)||void 0===r||r.openPanel()})})):console.log("no navigator.geolocation enabled")}handleNewGeoPosition(e,i){var r=this;return ua(function*(){const y=e.coords.longitude-.025,T=e.coords.longitude+.025,P=e.coords.latitude+.025,z=e.coords.latitude-.025,H=r.userTripService.getStageConfig(),oe=yield rl.initWithBBOXAndType(H,r.languageService.language,y,P,T,z,["stop"],300).fetchResponse();i(oe.locations)})()}updateLocationText(e){var i,r;const a=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceName)&&void 0!==r?r:null;null!==a&&(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(a))}}return n.\u0275fac=function(e){return new(e||n)(le(Ba),le(Th))},n.\u0275cmp=Ut({type:n,selectors:[["station-board-input"]],viewQuery:function(e,i){if(1&e&&io(SC,7),2&e){let r;_i(r=bi())&&(i.autocompleteInputTrigger=r.first)}},outputs:{locationSelected:"locationSelected"},decls:6,vars:4,consts:[["label","Station",1,"w-100"],["sbbInput","","type","text",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected"],["autocompleteTemplate","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(ae(0,"div")(1,"sbb-form-field",0),dn(2,"input",1),de(),ae(3,"sbb-autocomplete",2,3),Zt("optionSelected",function(a){return i.onStopLookupSelected(a)}),Ct(5,ZK,2,2,"sbb-option",4),de()()),2&e){const r=Oa(4);_e(2),Ve("placeholder","Type to search for stations")("formControl",i.searchInputControl)("sbbAutocomplete",r),_e(3),Ve("ngForOf",i.stopLookups)}},dependencies:[cc,yu,sd,Dy,Nx,EN,SC,Xy,L_],encapsulation:2}),n})();function YK(n,t){1&n&&dn(0,"span",12)}let KK=(()=>{class n{constructor(e){this.userTripService=e,this.customRequestSaved=new Cn,this.customResponseSaved=new Cn,this.customRequestXMLs="... wait",this.customResponseXMLs="Paste custom OJP StopEventRequest Response XML here...",this.isRunningRequest=!1}parseCustomRequestXML(){this.isRunningRequest=!0;const e=this.userTripService.getStageConfig(),i=hf.initWithRequestMock(this.customRequestXMLs,e);i.fetchResponse().then(r=>{this.isRunningRequest=!1;const a=i.requestInfo.responseXML;null!==a?this.customRequestSaved.emit(a):console.log("ERROR - no response from StopEventRequest")})}parseCustomResponseXML(){this.customResponseSaved.emit(this.customResponseXMLs)}}return n.\u0275fac=function(e){return new(e||n)(le(Ba))},n.\u0275cmp=Ut({type:n,selectors:[["custom-stop-event-popover"]],outputs:{customRequestSaved:"customRequestSaved",customResponseSaved:"customResponseSaved"},decls:26,vars:4,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojp-stopeventservice/"],["rows","10",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(ae(0,"div",0),W(1,"Custom StopEvent Request / Response XML"),de(),ae(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),W(6,"StopEvent Request XML"),de(),ae(7,"div")(8,"a",4),W(9,"Cookbook opentransportdata.swiss"),de()()(),ae(10,"textarea",5),Zt("ngModelChange",function(a){return i.customRequestXMLs=a}),de(),ae(11,"div",6)(12,"button",7),Zt("click",function(){return i.parseCustomRequestXML()}),Ct(13,YK,1,0,"span",8),W(14," Execute OJP StopEvent Request "),de()(),dn(15,"hr"),ae(16,"div",3)(17,"div"),W(18,"StopEvent Request Response XML"),de()(),ae(19,"textarea",5),Zt("ngModelChange",function(a){return i.customResponseXMLs=a}),de(),ae(20,"div",6)(21,"button",9),Zt("click",function(){return i.parseCustomResponseXML()}),W(22," Display StopEvents "),de()()()(),ae(23,"div",10)(24,"button",11),W(25," Close "),de()()),2&e&&(_e(10),Ve("ngModel",i.customRequestXMLs),_e(2),Ve("disabled",i.isRunningRequest),_e(1),Ve("ngIf",i.isRunningRequest),_e(6),Ve("ngModel",i.customResponseXMLs))},dependencies:[Go,yu,sd,fh,Om,R_,k_,P_],encapsulation:2}),n})(),JK=(()=>{class n{constructor(){this.embedHTMLs="n/a"}updateEmbedHTML(e){var i,r;const a=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"n/a",p=document.location.pathname.replace("/board","/embed/board")+"?stop_id="+a,y=document.location.protocol+"//"+document.location.host+p;this.embedHTMLs='<iframe src="'+y+'" width="100%" height="100%" frameBorder="0"></iframe>'}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["embed-station-board-popover"]],decls:11,vars:1,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(ae(0,"div",0),W(1,"Embed journey in another website"),de(),ae(2,"div",1)(3,"div",2)(4,"p"),W(5,"Copy the following code in the target webpage"),de(),ae(6,"textarea",3),W(7),de()()(),ae(8,"div",4)(9,"button",5),W(10," Close "),de()()),2&e&&(_e(7),ce(i.embedHTMLs))},dependencies:[Om,R_,k_,P_],encapsulation:2}),n})();function QK(n,t){if(1&n&&(ae(0,"sbb-radio-button",25),W(1),de()),2&n){const e=t.$implicit;Ve("value",e),_e(1),Se(" ",e," ")}}function eJ(n,t){if(1&n){const e=Zr();ae(0,"div",22)(1,"div")(2,"sbb-radio-group",23),Zt("ngModelChange",function(r){return di(e),oi(Ot().stationBoardType=r)})("change",function(){return di(e),oi(Ot().onTypeChanged())}),Ct(3,QK,2,2,"sbb-radio-button",24),de()()()}if(2&n){const e=Ot();_e(2),Ve("ngModel",e.stationBoardType),_e(1),Ve("ngForOf",e.stationBoardTypes)}}function tJ(n,t){if(1&n){const e=Zr();ae(0,"sbb-radio-button",28),Zt("change",function(r){return di(e),oi(Ot(2).onChangeStageAPI(r))}),W(1),de()}if(2&n){const e=t.$implicit,i=Ot(2);Ve("value",e)("checked",i.userTripService.currentAppStage==e),_e(1),Se(" ",e," ")}}function nJ(n,t){if(1&n&&(ae(0,"div",22)(1,"div")(2,"sbb-radio-group",26),Ct(3,tJ,2,3,"sbb-radio-button",27),de()()()),2&n){const e=Ot();_e(3),Ve("ngForOf",e.appStageOptions)}}function iJ(n,t){1&n&&dn(0,"span",29)}function rJ(n,t){if(1&n){const e=Zr();ae(0,"div",30)(1,"button",31),Zt("click",function(){return di(e),oi(Ot().loadCustomXMLPopover())}),W(2," Custom XML "),de()()}}function oJ(n,t){if(1&n&&(ae(0,"div",0)(1,"div",1)(2,"div",32)(3,"div")(4,"a",33),W(5,"Open in OJP Demo App"),de()()()()()),2&n){const e=Ot();_e(4),Qo("href",e.permalinkRelativeURL,hs)}}function sJ(n,t){if(1&n){const e=Zr();Uo(0),ae(1,"div",36),Zt("click",function(){return di(e),oi(Ot(2).showRequestXmlPopover())}),ae(2,"span",37),W(3,"XML"),de()(),ae(4,"div"),W(5,"|"),de(),Zo()}}function aJ(n,t){if(1&n&&(Uo(0),ae(1,"div")(2,"a",33),W(3,"BETA-v2"),de()(),ae(4,"div"),W(5,"|"),de(),ae(6,"div")(7,"a",33),W(8,"PROD"),de()(),ae(9,"div"),W(10,"|"),de(),Zo()),2&n){const e=Ot(2);_e(2),Qo("href",e.mapURLs.betav2,hs),_e(5),Qo("href",e.mapURLs.prodv1,hs)}}function lJ(n,t){if(1&n){const e=Zr();Uo(0),ae(1,"div"),W(2,"|"),de(),ae(3,"div")(4,"a",38),Zt("click",function(){return di(e),oi(Ot(2).loadEmbedHTMLPopover())}),W(5,"Embed"),de()(),Zo()}}function cJ(n,t){if(1&n&&(ae(0,"div",0)(1,"div",1)(2,"div",34),Ct(3,sJ,6,0,"ng-container",35),Ct(4,aJ,11,2,"ng-container",35),ae(5,"div")(6,"a",33),W(7,"Permalink"),de()(),Ct(8,lJ,6,0,"ng-container",35),de()()()),2&n){const e=Ot();_e(3),Ve("ngIf",(null==e.currentRequestInfo?null:e.currentRequestInfo.requestXML)&&!e.isEmbed),_e(1),Ve("ngIf",e.showURLS&&null!==e.searchLocation),_e(2),Qo("href",e.permalinkRelativeURL,hs),_e(2),Ve("ngIf",null!==e.searchLocation)}}let BN=(()=>{class n{constructor(e,i,r,a,p,y,T,P,z){this.notificationToast=e,this.debugXmlPopover=i,this.customXmlPopover=r,this.mapService=a,this.stationBoardService=p,this.languageService=y,this.userTripService=T,this.embedHTMLPopover=P,this.router=z,this.headerText="Search",this.useMocks=!1,this.queryParams=new URLSearchParams(document.location.search),this.appStageOptions=_A,this.stationBoardTypes=["Departures","Arrivals"],this.stationBoardType=this.computeStationBoardType(),this.searchLocation=null,this.stationBoardService.searchDate=this.computeSearchDateTime(),this.searchTime=Ps.formatTimeHHMM(this.stationBoardService.searchDate),this.isSearching=!1,this.permalinkRelativeURL="",this.mapURLs={},this.updateURLs(),this.currentRequestInfo=null;const H=new URLSearchParams(document.location.search);this.useMocks="yes"===H.get("use_mocks"),this.isEmbed=-1!==this.router.url.indexOf("/embed/"),this.headerText=this.stationBoardType,this.showURLS="DEBUG"===Na}get searchDate(){return this.stationBoardService.searchDate}set searchDate(e){this.stationBoardService.searchDate=e}ngOnInit(){const e=this.queryParams.get("stage");if(e){const r=this.computeAppStageFromString(e);r&&this.userTripService.updateAppStage(r)}const i=this.queryParams.get("stop_id");i&&(this.updateCurrentRequestData(i),this.fetchStopEventsForStopRef(i),this.lookupStopPlaceRef(i)),this.stationBoardService.stationOnMapClicked.subscribe(r=>{this.handleMapClick(r)}),this.customInitFromParams()}customInitFromParams(){if(this.useMocks&&this.useMocks&&"localhost"===document.location.hostname)return void this.fetchStopEventFromMocks();const e=this.queryParams.get("gist");e&&this.initFromGistRef(e)}initFromGistRef(e){var i=this;return ua(function*(){const r=yield Ws.fetchGist(e);null!==r?i.initFromMockXML(r):console.error("initFromGistRef: cant fetch gist XML")})()}computeAppStageFromString(e){const i=this.appStageOptions.map(p=>p.toLowerCase()),r=e.trim(),a=i.indexOf(r.toLowerCase());return-1!==a?this.appStageOptions[a]:null}onLocationSelected(e){var i,r;const a=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;a&&this.updateCurrentRequestData(a),this.searchLocation=e,this.mapService.tryToCenterAndZoomToLocation(e),this.updateURLs(),this.updateHeaderText(),this.resetResultList()}onDateTimeChanged(){const e=this.searchTime.split(":");if(2===e.length){const i=parseInt(e[0],10),r=parseInt(e[1],10);this.stationBoardService.searchDate.setHours(i),this.stationBoardService.searchDate.setMinutes(r)}this.updateURLs()}onTypeChanged(){this.updateURLs(),this.updateHeaderText()}isSearchButtonDisabled(){return!(!this.isSearching&&null!==this.searchLocation)}searchButtonClicked(){var e,i,r;this.notificationToast.dismiss();const a=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null!==a?this.fetchStopEventsForStopRef(a):console.error("ERROR - no stopPlaceRef available")}computeSearchDateTime(){let e=new Date;const i=this.queryParams.get("day");i&&(e=new Date(Date.parse(i)));const r=this.queryParams.get("time"),a=new Date;let p=a.getHours(),y=a.getMinutes();if(r){const T=r.split(":");2===T.length&&(p=parseInt(T[0],10),y=parseInt(T[1],10))}return e.setHours(p),e.setMinutes(y),e}computeStationBoardType(){return"arr"===this.queryParams.get("type")?"Arrivals":"Departures"}updateURLs(){var e,i,r;const a=new URLSearchParams;"Arrivals"===this.stationBoardType&&a.set("type","arr");const p=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;p&&a.set("stop_id",p);const y=this.stationBoardService.searchDate,T=new Date;if(Math.abs((T.getTime()-y.getTime())/1e3/60)>5){const z=Ps.formatDate(new Date),H=Ps.formatDate(y),J=z.substring(0,10),oe=H.substring(0,10);oe!==J&&a.set("day",oe);const fe=z.substring(11,16),Ae=H.substring(11,16);fe!==Ae&&a.set("time",Ae)}if(this.userTripService.currentAppStage!==lC){const z=this.userTripService.currentAppStage.toLowerCase();a.append("stage",z)}this.permalinkRelativeURL=document.location.pathname.replace("/embed","")+"?"+a.toString(),this.updateLinkedURLs(a)}updateLinkedURLs(e){this.mapURLs.prodv1="https://opentdatach.github.io/ojp-demo-app/board?"+e.toString(),this.mapURLs.betav1="https://tools.odpch.ch/beta-ojp-demo/board?"+e.toString(),this.mapURLs.betav2="https://tools.odpch.ch/ojp-demo-v2/board?"+e.toString()}fetchStopEventsForStopRef(e){const i=this.computeStopEventRequest(e);i.fetchResponse().then(r=>{this.currentRequestInfo=i.requestInfo,this.parseStopEvents(r.stopEvents)})}fetchStopEventFromMocks(){var e=this;return ua(function*(){const r=yield(yield fetch("/path/to/mock.xml")).text();e.initFromMockXML(r)})()}initFromMockXML(e){hf.initWithMock(e).fetchResponse().then(r=>{if(r.stopEvents.length>0){const p=r.stopEvents[0].stopPoint.location;p&&this.onLocationSelected(p)}this.parseStopEvents(r.stopEvents)})}computeStopEventRequest(e){const i="Arrivals"===this.stationBoardType?"arrival":"departure",r=this.computeStopBoardDate(),a=this.userTripService.getStageConfig();return hf.initWithStopPlaceRef(a,this.languageService.language,e,i,r)}parseStopEvents(e){var i;e.length>0&&(null===(i=this.searchPanel)||void 0===i||i.close(),this.updateHeaderText()),this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:e})}lookupStopPlaceRef(e){var i=this;return ua(function*(){const r=i.userTripService.getStageConfig(),p=yield rl.initWithStopPlaceRef(r,i.languageService.language,e).fetchResponse();if(0===p.locations.length)return void console.error("ERROR - cant find stopPlaceRef with ID: "+e);const y=p.locations[0];i.searchLocation=y,i.mapService.tryToCenterAndZoomToLocation(y),i.updateURLs(),i.updateHeaderText(),i.autocompleteInputComponent&&i.autocompleteInputComponent.updateLocationText(y)})()}updateHeaderText(){if(null===this.searchLocation)return;const e=this.searchLocation.computeLocationName();null!==e&&(this.headerText=this.stationBoardType+" "+e)}handleMapClick(e){var i;const r=Ko.initWithFeature(e);null!==r&&(this.searchLocation=r,this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(r),this.resetResultList(),this.updateURLs(),null===(i=this.searchPanel)||void 0===i||i.open())}resetResultList(){this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:[]})}computeStopBoardDate(){const e=this.stationBoardService.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),a=parseInt(i[1]);e.setHours(r),e.setMinutes(a)}return e}showRequestXmlPopover(){const e=this.debugXmlPopover.open(dC,{position:{top:"20px"},width:"50vw",height:"90vh"});e.afterOpened().subscribe(()=>{this.currentRequestInfo&&e.componentInstance.updateRequestData(this.currentRequestInfo)})}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value)}loadCustomXMLPopover(){const e=this.customXmlPopover.open(KK,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{var i,r;this.notificationToast.dismiss();const a=e.componentInstance;if(null===this.currentRequestInfo){const y=this.computeStopEventRequest("8503000");this.currentRequestInfo=y.requestInfo}a.customRequestXMLs=null!==(r=null===(i=this.currentRequestInfo)||void 0===i?void 0:i.requestXML)&&void 0!==r?r:"n/a",a.customRequestSaved.subscribe(p=>{e.close(),this.handleCustomResponse(p)}),a.customResponseSaved.subscribe(p=>{e.close(),this.handleCustomResponse(p)})})}handleCustomResponse(e){null!==this.currentRequestInfo&&(this.currentRequestInfo.responseDateTime=new Date,this.currentRequestInfo.responseXML=e,hf.initWithMock(e).fetchResponse().then(r=>{const a=r.stopEvents;a.length>0?(this.mapService.tryToCenterAndZoomToLocation(a[0].stopPoint.location),this.parseStopEvents(r.stopEvents)):this.notificationToast.open("No StopEvents found",{type:"error",verticalPosition:"top"})}))}updateCurrentRequestData(e){const i=this.computeStopEventRequest(e);this.currentRequestInfo=i.requestInfo}loadEmbedHTMLPopover(){const e=this.embedHTMLPopover.open(JK,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{this.searchLocation&&e.componentInstance.updateEmbedHTML(this.searchLocation)})}resetDateTime(){const e=new Date;this.searchDate=e,this.searchTime=Ps.formatTimeHHMM(e),this.stationBoardService.searchDate=e}}return n.\u0275fac=function(e){return new(e||n)(le(PA),le(wl),le(wl),le(Sh),le(qA),le(Th),le(Ba),le(wl),le(aa))},n.\u0275cmp=Ut({type:n,selectors:[["station-board-search"]],viewQuery:function(e,i){if(1&e&&(io(ff,7),io(NN,5)),2&e){let r;_i(r=bi())&&(i.searchPanel=r.first),_i(r=bi())&&(i.autocompleteInputComponent=r.first)}},decls:30,vars:11,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],[3,"locationSelected"],["class","mb-3 d-flex",4,"ngIf"],[1,"d-flex","align-items-center","gap-2"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"width","70px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],["sbb-secondary-button","","aria-expanded","false",3,"click"],["svgIcon","kom:arrow-circle-reset-small"],[1,"d-flex"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","ms-auto",4,"ngIf"],["class","row mb-2",4,"ngIf"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"d-flex","flex-row-reverse"],["target","_blank",3,"href"],[1,"d-flex","flex-row-reverse","gap-2"],[4,"ngIf"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],["target","_blank","role","button",1,"text-decoration-underline",3,"click"]],template:function(e,i){1&e&&(ae(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),W(5),de(),ae(6,"div",3)(7,"div",4)(8,"station-board-input",5),Zt("locationSelected",function(a){return i.onLocationSelected(a)}),de()()(),Ct(9,eJ,4,2,"div",6),ae(10,"div",7)(11,"div")(12,"sbb-form-field",8)(13,"sbb-datepicker",9)(14,"input",10),Zt("ngModelChange",function(a){return i.searchDate=a})("dateChange",function(){return i.onDateTimeChanged()}),de()()()(),ae(15,"div",11)(16,"sbb-form-field",12)(17,"input",13),Zt("ngModelChange",function(a){return i.searchTime=a})("change",function(){return i.onDateTimeChanged()}),de()()(),ae(18,"div")(19,"button",14),Zt("click",function(){return i.resetDateTime()}),dn(20,"sbb-icon",15),de()()(),Ct(21,nJ,4,1,"div",6),ae(22,"div",16)(23,"div",17)(24,"button",18),Zt("click",function(){return i.searchButtonClicked()}),Ct(25,iJ,1,0,"span",19),W(26," Search "),de()(),Ct(27,rJ,3,0,"div",20),de()()()()(),Ct(28,oJ,6,1,"div",21),Ct(29,cJ,9,4,"div",21)),2&e&&(_e(3),Ve("expanded",!0),_e(2),ce(i.headerText),_e(4),Ve("ngIf",!i.isEmbed),_e(5),Ve("ngModel",i.searchDate),_e(3),Ve("ngModel",i.searchTime),_e(4),Ve("ngIf",!i.isEmbed),_e(3),Ve("disabled",i.isSearchButtonDisabled()),_e(1),Ve("ngIf",i.isSearching),_e(2),Ve("ngIf",!i.isEmbed),_e(1),Ve("ngIf",i.isEmbed),_e(1),Ve("ngIf",!i.isEmbed))},dependencies:[cc,Go,yu,sd,fh,fC,ff,Wx,LA,vC,Yx,Xy,vl,L_,jA,wC,SN,NN],styles:[".xml-info[_ngcontent-%COMP%]{cursor:pointer}"]}),n})(),uJ=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["station-board"]],decls:19,vars:6,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active","routerLink"],["sbb-tab-link","",3,"active"],["tabPanel",""],[1,"row"],[1,"col-md-5"],[1,"col-md-7"]],template:function(e,i){if(1&e&&(ae(0,"div",0),dn(1,"web-header"),ae(2,"div",1)(3,"nav",2)(4,"a",3),W(5,"Journey Search"),de(),ae(6,"a",4),W(7,"Station Board"),de(),ae(8,"a",3),W(9,"Trip Info"),de()(),ae(10,"sbb-tab-nav-panel",null,5)(12,"div",6)(13,"div",7),dn(14,"station-board-search")(15,"station-board-result"),de(),ae(16,"div",8),dn(17,"station-board-map"),de()()()(),dn(18,"web-footer"),de()),2&e){const r=Oa(11);_e(3),Ve("tabPanel",r),_e(1),Ve("active","false")("routerLink","../search"),_e(2),Ve("active","true"),_e(2),Ve("active","false")("routerLink","../trip")}},dependencies:[y_,JT,QM,QT,AK,FN,BN,HA,GA],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})(),dJ=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(ae(0,"div",0)(1,"div",1)(2,"div",2),dn(3,"app-search-form")(4,"journey-results"),de()()())},dependencies:[rN,LN],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})(),hJ=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(ae(0,"div",0)(1,"div",1)(2,"div",2),dn(3,"station-board-search")(4,"station-board-result"),de()()())},dependencies:[FN,BN],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})(),pJ=(()=>{class n{constructor(e,i,r,a,p){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.tripInfoService=a,this.languageService=p,this.mapLoadingPromise=null,this.journeyServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToLocation(r,e)})}),this.tripInfoService.tripInfoResultUpdated.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var a,p;null===e?null===(a=this.journeyServiceRenderer)||void 0===a||a.resetStopEventLayers():(null===(p=this.journeyServiceRenderer)||void 0===p||p.drawServiceStopPoints(e.stopPoints),this.zoomToJourneyService())})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToBounds(r,e)})}),this.tripInfoService.locationSelected.subscribe(e=>{var i,r;const a=null!==(i=e.geoPosition)&&void 0!==i?i:null;null!==a&&(null===(r=this.mapLoadingPromise)||void 0===r||r.then(p=>{this.mapService.zoomToLocation(p,{lnglat:a.asLngLat(),zoom:16})}))})}initMap(){const e=this.mapService.createMap("map_canvas_trip_info");this.mapLoadingPromise=new Promise((i,r)=>{e.on("load",a=>{i(e),this.onMapLoad(e)})})}zoomToJourneyService(){var e,i;const r=null!==(i=null===(e=this.journeyServiceRenderer)||void 0===e?void 0:e.geojsonFeatures)&&void 0!==i?i:[];if(r.length<2)return;const a=yh.initFromGeoJSONFeatures(r);if(!a.isValid())return console.error("Invalid BBOX for features"),void console.log(r);const y={bounds:new(da().LngLatBounds)(a.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(y)}onMapLoad(e){this.addMapControls(e),this.addMapListeners(e),this.journeyServiceRenderer=new ON(e)}addMapControls(e){const i=new(da().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(i,"bottom-right");const r=new(da().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(r);const a=new bA(e);e.addControl(a,"top-left");const p=new SA(e,this.debugXmlPopover,this.userTripService,this.languageService);e.addControl(p,"top-right")}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(a,p)=>{a?console.error(a):!e.hasImage(i.id)&&p&&e.addImage(i.id,p)})}),e.on("click",i=>{const r=wh.queryNearbyFeaturesByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);r.length>0&&console.log(r[0])})}}return n.\u0275fac=function(e){return new(e||n)(le(Ba),le(Sh),le(wl),le(mC),le(Th))},n.\u0275cmp=Ut({type:n,selectors:[["trip-info-map"]],decls:1,vars:0,consts:[["id","map_canvas_trip_info",1,"map_wrapper"]],template:function(e,i){1&e&&dn(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{height:600px;border:1px solid #e5e5e5}"]}),n})();function fJ(n,t){1&n&&dn(0,"span",12)}let mJ=(()=>{class n{constructor(e){this.userTripService=e,this.customRequestSaved=new Cn,this.customResponseSaved=new Cn,this.customRequestXMLs="... wait",this.customResponseXMLs="Paste custom OJP TripInfoRequest Response XML here...",this.isRunningRequest=!1}parseCustomRequestXML(){this.isRunningRequest=!0;const e=this.userTripService.getStageConfig(),i=vh.initWithRequestMock(this.customRequestXMLs,e);i.fetchResponse().then(r=>{this.isRunningRequest=!1,null!==i.requestInfo.responseXML?this.customRequestSaved.emit(i):console.log("ERROR - no response from StopEventRequest")})}parseCustomResponseXML(){this.customResponseSaved.emit(this.customResponseXMLs)}}return n.\u0275fac=function(e){return new(e||n)(le(Ba))},n.\u0275cmp=Ut({type:n,selectors:[["custom-trip-info-popover"]],outputs:{customRequestSaved:"customRequestSaved",customResponseSaved:"customResponseSaved"},decls:26,vars:4,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptripinforequest/"],["rows","10",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(ae(0,"div",0),W(1,"Custom TripInfo Request / Response XML"),de(),ae(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),W(6,"TripInfo Request XML"),de(),ae(7,"div")(8,"a",4),W(9,"Cookbook opentransportdata.swiss"),de()()(),ae(10,"textarea",5),Zt("ngModelChange",function(a){return i.customRequestXMLs=a}),de(),ae(11,"div",6)(12,"button",7),Zt("click",function(){return i.parseCustomRequestXML()}),Ct(13,fJ,1,0,"span",8),W(14," Execute OJP TripInfo Request "),de()(),dn(15,"hr"),ae(16,"div",3)(17,"div"),W(18,"TripInfo Request Response XML"),de()(),ae(19,"textarea",5),Zt("ngModelChange",function(a){return i.customResponseXMLs=a}),de(),ae(20,"div",6)(21,"button",9),Zt("click",function(){return i.parseCustomResponseXML()}),W(22," Display TripInfo "),de()()()(),ae(23,"div",10)(24,"button",11),W(25," Close "),de()()),2&e&&(_e(10),Ve("ngModel",i.customRequestXMLs),_e(2),Ve("disabled",i.isRunningRequest),_e(1),Ve("ngIf",i.isRunningRequest),_e(6),Ve("ngModel",i.customResponseXMLs))},dependencies:[Go,yu,sd,fh,Om,R_,k_,P_],encapsulation:2}),n})();function gJ(n,t){if(1&n){const e=Zr();ae(0,"div",20),Zt("click",function(){return di(e),oi(Ot().showRequestXmlPopover())}),ae(1,"span",21),W(2,"XML"),de()()}}function _J(n,t){if(1&n){const e=Zr();ae(0,"sbb-radio-button",22),Zt("change",function(r){return di(e),oi(Ot().onChangeStageAPI(r))}),W(1),de()}if(2&n){const e=t.$implicit,i=Ot();Ve("value",e)("checked",i.userTripService.currentAppStage==e),_e(1),Se(" ",e," ")}}function bJ(n,t){1&n&&dn(0,"span",23)}let yJ=(()=>{class n{constructor(e,i,r,a,p,y){this.notificationToast=e,this.debugXmlPopover=i,this.customXmlPopover=r,this.tripInfoService=a,this.languageService=p,this.userTripService=y,this.headerText="Search Trip Info",this.useMocks=!1,this.queryParams=new URLSearchParams(document.location.search),this.model={journeyRef:"",journeyDateTime:new Date,appStageOptions:_A,isSearching:!1,permalinkURLAddress:""},this.updatePermalinkURLAddress(),this.currentRequestInfo=null;const T=new URLSearchParams(document.location.search);this.useMocks="yes"===T.get("use_mocks")}ngOnInit(){const e=this.queryParams.get("stage");if(e){const i=this.computeAppStageFromString(e);i&&this.userTripService.updateAppStage(i)}this.tripInfoService.tripInfoResultUpdated.subscribe(i=>{var r;null!==i&&(null===(r=this.searchPanel)||void 0===r||r.close())}),this.initFromUserVars()}initFromUserVars(){const e=this.queryParams.get("ref");if(e){this.model.journeyRef=e;const i=this.queryParams.get("day");this.fetchTripInfo(i)}this.useMocks&&this.useMocks&&"localhost"===document.location.hostname&&this.fetchStopEventFromMocks()}computeAppStageFromString(e){const i=this.model.appStageOptions.map(p=>p.toLowerCase()),r=e.trim(),a=i.indexOf(r.toLowerCase());return-1!==a?this.model.appStageOptions[a]:null}onDateTimeChanged(){this.updatePermalinkURLAddress()}isSearchButtonDisabled(){return!!this.model.isSearching}searchButtonClicked(){this.notificationToast.dismiss(),this.fetchTripInfo()}updatePermalinkURLAddress(){const e=new URLSearchParams;e.set("ref",this.model.journeyRef);const i=Ps.formatDate(this.model.journeyDateTime).substring(0,10);e.set("day",i);const r=document.location.pathname+"?"+e.toString();this.model.permalinkURLAddress=r}fetchTripInfo(e=null){var i=this;return ua(function*(){const r=i.userTripService.getStageConfig();null===e&&(e=Ps.formatDate(i.model.journeyDateTime).substring(0,10));const a=vh.initWithJourneyRef(r,i.languageService.language,i.model.journeyRef,e);i.model.isSearching=!0;const p=yield a.fetchResponse();i.model.isSearching=!1,null===p.tripInfoResult&&(i.notificationToast.open("Invalid TripInfoRequest result",{type:"error",verticalPosition:"top"}),console.log(i.model.journeyRef)),i.parseTripInfo(a.requestInfo,p.tripInfoResult)})()}fetchStopEventFromMocks(){var e=this;return ua(function*(){const r=yield(yield fetch("/path/to/mock.xml")).text(),a=vh.initWithMock(r);a.fetchResponse().then(p=>{e.parseTripInfo(a.requestInfo,p.tripInfoResult)})})()}showRequestXmlPopover(){const e=this.debugXmlPopover.open(dC,{position:{top:"20px"},width:"50vw",height:"90vh"});e.afterOpened().subscribe(()=>{this.currentRequestInfo&&e.componentInstance.updateRequestData(this.currentRequestInfo)})}parseTripInfo(e,i){this.currentRequestInfo=e,this.tripInfoService.tripInfoResultUpdated.emit(i)}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value)}loadCustomXMLPopover(){const e=this.customXmlPopover.open(mJ,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{var i,r;this.notificationToast.dismiss();const a=e.componentInstance;a.customRequestXMLs=null!==(r=null===(i=this.currentRequestInfo)||void 0===i?void 0:i.requestXML)&&void 0!==r?r:"n/a",a.customRequestSaved.subscribe(p=>{e.close(),this.currentRequestInfo=p.requestInfo,p.requestInfo.requestXML&&this.handleCustomResponse(p.requestInfo.requestXML)}),a.customResponseSaved.subscribe(p=>{e.close(),this.handleCustomResponse(p)})})}handleCustomResponse(e){if(null===this.currentRequestInfo)return;this.currentRequestInfo.responseDateTime=new Date,this.currentRequestInfo.responseXML=e;const i=vh.initWithMock(e);i.fetchResponse().then(r=>{this.parseTripInfo(i.requestInfo,r.tripInfoResult)})}}return n.\u0275fac=function(e){return new(e||n)(le(PA),le(wl),le(wl),le(mC),le(Th),le(Ba))},n.\u0275cmp=Ut({type:n,selectors:[["trip-info-search"]],viewQuery:function(e,i){if(1&e&&io(ff,7),2&e){let r;_i(r=bi())&&(i.searchPanel=r.first)}},decls:30,vars:8,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],[1,"sbb-form-field-long"],["sbbInput","","placeholder","type a JourneyRef","value","",3,"ngModel","ngModelChange"],["class","xml-info",3,"click",4,"ngIf"],[1,"d-flex"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(ae(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),W(5),de(),ae(6,"div",3)(7,"div",4)(8,"sbb-form-field",5)(9,"sbb-label"),W(10,"Journey Ref"),de(),ae(11,"input",6),Zt("ngModelChange",function(a){return i.model.journeyRef=a}),de()()(),Ct(12,gJ,3,0,"div",7),de(),ae(13,"div",8)(14,"div")(15,"sbb-form-field",9)(16,"sbb-datepicker",10)(17,"input",11),Zt("ngModelChange",function(a){return i.model.journeyDateTime=a})("dateChange",function(){return i.onDateTimeChanged()}),de()()()()(),ae(18,"div",12)(19,"div")(20,"sbb-radio-group",13),Ct(21,_J,2,3,"sbb-radio-button",14),de()()(),ae(22,"div",8)(23,"div",15)(24,"button",16),Zt("click",function(){return i.searchButtonClicked()}),Ct(25,bJ,1,0,"span",17),W(26," Search "),de()(),ae(27,"div",18)(28,"button",19),Zt("click",function(){return i.loadCustomXMLPopover()}),W(29," Custom XML "),de()()()()()()()),2&e&&(_e(3),Ve("expanded",!0),_e(2),ce(i.headerText),_e(6),Ve("ngModel",i.model.journeyRef),_e(1),Ve("ngIf",null==i.currentRequestInfo?null:i.currentRequestInfo.requestXML),_e(5),Ve("ngModel",i.model.journeyDateTime),_e(4),Ve("ngForOf",i.model.appStageOptions),_e(3),Ve("disabled",i.isSearchButtonDisabled()),_e(1),Ve("ngIf",i.model.isSearching))},dependencies:[cc,Go,yu,sd,fh,fC,ff,Wx,vC,Yx,Xy,Zx,L_,jA,wC],styles:[".xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}"]}),n})();const vJ=[{path:"embed/search",component:dJ},{path:"embed/board",component:hJ},{path:"search",component:EK},{path:"board",component:uJ},{path:"trip",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["trip-info"]],decls:19,vars:6,consts:[[1,"container"],[1,"app-root"],["sbb-tab-nav-bar","",3,"tabPanel"],["sbb-tab-link","",3,"active","routerLink"],["sbb-tab-link","",3,"active"],["tabPanel",""],[1,"row"],[1,"col-md-5"],[1,"col-md-7"]],template:function(e,i){if(1&e&&(ae(0,"div",0),dn(1,"web-header"),ae(2,"div",1)(3,"nav",2)(4,"a",3),W(5,"Journey Search"),de(),ae(6,"a",3),W(7,"Station Board"),de(),ae(8,"a",4),W(9,"Trip Info"),de()(),ae(10,"sbb-tab-nav-panel",null,5)(12,"div",6)(13,"div",7),dn(14,"trip-info-search")(15,"trip-info-result"),de(),ae(16,"div",8),dn(17,"trip-info-map"),de()()()(),dn(18,"web-footer"),de()),2&e){const r=Oa(11);_e(3),Ve("tabPanel",r),_e(1),Ve("active","false")("routerLink","../search"),_e(2),Ve("active","false")("routerLink","../board"),_e(2),Ve("active","true")}},dependencies:[y_,JT,QM,QT,pJ,yJ,nN,HA,GA],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})()},{path:"searchOJP-Demo",redirectTo:"/search",pathMatch:"full"},{path:"",redirectTo:"/search",pathMatch:"full"}];let xJ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[LT.forRoot(vJ),LT]}),n})(),wJ=(()=>{class n{ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Ut({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(e,i){1&e&&dn(0,"router-outlet")},dependencies:[pM],encapsulation:2}),n})();ya("showDismiss",[oo("void, dismissed",mi({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),oo("visible",mi({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),kr("void => visible",zr("0.25s cubic-bezier(0.4,0.0,0.2,1)")),kr("visible => dismissed",zr("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]);let zN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,LT,Pr,cs]}),n})();Ul(class{});let $A=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[C_,Pr]}),n})();ya("transformMenu",[oo("void",mi({opacity:0})),oo("enter-usermenu",mi({width:"{{width}}",maxHeight:"100%"}),{params:{width:"288px"}}),kr("void => enter",zr("120ms cubic-bezier(0, 0, 0.2, 1)",mi({opacity:1}))),kr("enter => void",zr("100ms linear",mi({opacity:0}))),kr("void => enter-usermenu",zr("300ms cubic-bezier(.785,.135,.15,.86)",ax([mi({width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)",offset:0}),mi({width:"{{width}}",height:"*",opacity:1,maxHeight:"100%",offset:1})]))),kr("enter-usermenu => void",zr("300ms cubic-bezier(.785,.135,.15,.86)",mi({opacity:0,width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)"})))]),new Qt("SbbMenuContent"),new Qt("SBB_MENU_PANEL"),Ul(class{}),new Qt("sbb-menu-default-options",{providedIn:"root",factory:function EJ(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}}),new Qt("sbb-menu-inherited-trigger-context");const AJ={provide:new Qt("sbb-menu-scroll-strategy"),deps:[Ls],useFactory:function MJ(n){return()=>n.scrollStrategies.reposition()}};Im({passive:!0}),I_(class{});let DC=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[AJ],imports:[ro,uc,il,Pr,cs,E_]}),n})(),VN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr,DC,cs]}),n})();new Qt("recaptcha-settings");let jN=(()=>{class n{get nativeWindow(){return function PJ(){return window}()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();const LJ=new Qt("recaptcha-language"),OJ=new Qt("recaptcha-base-url"),FJ=new Qt("recaptcha-nonce-tag");let NJ=(()=>{class n{constructor(e,i,r,a,p){this._windowRef=e,this._language=r||null,this._baseUrl=a||null,this._nonce=p||null,this._document=i,this._init(),this.ready=n._ready.pipe(go(y=>!!y))}_init(){if(n._ready)return;this._windowRef.nativeWindow.ng2recaptchaloaded=()=>{n._ready.next(grecaptcha)},n._ready=new Qa(null);const e=this._document.createElement("script");e.innerHTML="",e.src=`${this._baseUrl||"https://www.google.com/recaptcha/api.js"}?render=explicit&onload=ng2recaptchaloaded${this._language?"&hl="+this._language:""}`,this._nonce&&(e.nonce=this._nonce),e.async=!0,e.defer=!0,this._document.head.appendChild(e)}}return n._ready=null,n.\u0275fac=function(e){return new(e||n)(mt(jN),mt(Mi),mt(LJ,8),mt(OJ,8),mt(FJ,8))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),UN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[NJ,jN],imports:[ro,Pr]}),n})();const BJ=["*",[["sbb-checkbox-panel-subtitle"]],[["sbb-checkbox-panel-warning"]],[["sbb-checkbox-panel-note"]]],zJ=["*","sbb-checkbox-panel-subtitle","sbb-checkbox-panel-warning","sbb-checkbox-panel-note"],VJ={provide:Vl,useExisting:dr(()=>jJ),multi:!0};let jJ=(()=>{class n extends aN{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=wr(n)))(i||n)}}(),n.\u0275cmp=Ut({type:n,selectors:[["sbb-checkbox-panel"]],hostAttrs:[1,"sbb-checkbox-panel","sbb-selection-panel-item","sbb-checkbox","sbb-selection-item"],hostVars:8,hostBindings:function(e,i){2&e&&(Jr("id",i.id),Yn("tabindex",null),l("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckboxPanel"],features:[wi([VJ]),zn],ngContentSelectors:zJ,decls:16,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content"],[1,"sbb-selection-inner-content"],[2,"display","none"]],template:function(e,i){1&e&&(ss(BJ),ae(0,"label",0)(1,"input",1,2),Zt("change",function(a){return i._onInteractionEvent(a)})("click",function(a){return i._onInputClick(a)}),de(),ae(3,"span",3)(4,"span",4),Is(),ae(5,"svg",5),dn(6,"polyline",6),de()()(),Ld(),ae(7,"span",7)(8,"span",8)(9,"span",9),W(10,"\xa0"),de(),ae(11,"span"),Yr(12),de(),Yr(13,1),de(),Yr(14,2),Yr(15,3),de()()),2&e&&(Yn("for",i.inputId),_e(1),Ve("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),Yn("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),HN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr]}),n})();new Qt("SBB_CHIP_LIST"),new Qt("SBB_CHIP"),new Qt("SbbChipRemove"),new Qt("SbbChipTrailingIcon"),jy(class HJ{constructor(t){this._elementRef=t}},-1);const YN=new Qt("sbb-chips-default-options");$T(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new fn}});let KN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[{provide:YN,useValue:{separatorKeyCodes:[13]}}],imports:[ro,Pr,cs]}),n})();new Qt("FILE_SELECTOR_OPTIONS");const Xs={TEXT:["text/*"],IMAGE:["image/*"],IMAGE_JPG:["image/jpeg","image/pjpeg"],IMAGE_PNG:["image/png"],IMAGE_SVG:["image/svg+xml"],IMAGE_GIF:["image/gif"],AUDIO:["audio/*"],AUDIO_MP4:["audio/mp4"],AUDIO_MP3:["audio/mpeg","audio/mp3"],AUDIO_OGG:["audio/ogg"],AUDIO_WAVE:["audio/wave"],AUDIO_WAV:["audio/wav","audio/x-wav","audio/x-pn-wav","audio/webm"],VIDEO:["video/*"],VIDEO_MP4:["video/mp4"],VIDEO_MPEG:["video/mpeg"],VIDEO_OGG:["video/ogg"],VIDEO_MOV:["video/quicktime"],VIDEO_WEBM:["video/webm"],VIDEO_AVI:["video/x-msvideo"],VIDEO_WMV:["video/x-ms-wmv"],PDF:["application/pdf"],MS_WORD_DOC:["application/msword","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],MS_EXCEL:["application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-excel.sheet.macroEnabled.12","application/vnd.ms-excel.template.macroEnabled.12","application/vnd.ms-excel.addin.macroEnabled.12","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],MS_POWERPOINT:["application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.ms-powerpoint.addin.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],ZIP:["application/x-gtar","application/x-gcompress","application/compress","application/x-tar","application/x-rar-compressed","application/octet-stream","application/x-zip-compressed","application/zip-compressed","application/x-7z-compressed","application/gzip","application/zip","application/x-bzip2"]};(new Map).set("doc",[...Xs.MS_WORD_DOC,...Xs.MS_EXCEL,...Xs.MS_POWERPOINT]).set("audio",[...Xs.AUDIO_MP4,...Xs.AUDIO_MP3,...Xs.AUDIO_OGG,...Xs.AUDIO_WAVE,...Xs.AUDIO_WAV]).set("image",[...Xs.IMAGE_GIF,...Xs.IMAGE_JPG,...Xs.IMAGE_PNG,...Xs.IMAGE_SVG]).set("pdf",Xs.PDF).set("video",[...Xs.VIDEO_MP4,...Xs.VIDEO_MPEG,...Xs.VIDEO_OGG,...Xs.VIDEO_MOV,...Xs.VIDEO_WEBM,...Xs.VIDEO_AVI,...Xs.VIDEO_WMV]).set("zip",Xs.ZIP),Ul(class{constructor(n){this._elementRef=n}});let JN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr,cs]}),n})();new Qt("SBB_HEADER"),ya("menu",[oo("open",mi({left:0})),oo("void",mi({left:-305,visibility:"hidden"})),kr("open => void, void => open",[zr("0.3s ease-in-out")])]);const lQ={provide:new Qt("sbb-header-menu-scroll-strategy"),deps:[Ls],useFactory:function aQ(n){return()=>n.scrollStrategies.reposition()}};Im({passive:!0}),Ul(class{});let QN=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[lQ],imports:[ro,zT,uc,il,Pr,cs]}),n})();function cQ(n,t){}function uQ(n,t){}class XA{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let dQ=(()=>{class n extends Ox{constructor(e,i,r,a,p,y,T,P){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=a,this._interactivityChecker=p,this._ngZone=y,this._overlayRef=T,this._focusMonitor=P,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=z=>{this._portalOutlet.hasAttached();const H=this._portalOutlet.attachDomPortal(z);return this._contentAttached(),H},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=ad(),a=this._elementRef.nativeElement;(!r||r===this._document.body||r===a||a.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=ad();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=ad())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(zy),le(Mi,8),le(XA),le(T_),le(Oi),le(Lm),le(yl))},n.\u0275cmp=Ut({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&io(bh,7),2&e){let r;_i(r=bi())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&Yn("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[zn],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&Ct(0,cQ,0,0,"ng-template",0)},dependencies:[bh],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class ZA{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new fn,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!nl(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const eB=new Qt("DialogScrollStrategy"),hQ=new Qt("DialogData"),pQ=new Qt("DefaultDialogConfig"),mQ={provide:eB,deps:[Ls],useFactory:function fQ(n){return()=>n.scrollStrategies.block()}};let gQ=0,_Q=(()=>{class n{constructor(e,i,r,a,p,y){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=a,this._overlayContainer=p,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new fn,this._afterOpenedAtThisLevel=new fn,this._ariaHiddenElements=new Map,this.afterAllClosed=p_(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(va(void 0))),this._scrollStrategy=y}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new XA;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+gQ++,i.id&&this.getDialogById(i.id);const a=this._getOverlayConfig(i),p=this._overlay.create(a),y=new ZA(p,i),T=this._attachContainer(p,y,i);return y.containerInstance=T,this._attachDialogContent(e,y,T,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(y),y.closed.subscribe(()=>this._removeOpenDialog(y,!0)),this.afterOpened.next(y),y}closeAll(){YA(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){YA(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),YA(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new M_({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var a;const p=r.injector||(null===(a=r.viewContainerRef)||void 0===a?void 0:a.injector),y=[{provide:XA,useValue:r},{provide:ZA,useValue:i},{provide:Lm,useValue:e}];let T;r.container?"function"==typeof r.container?T=r.container:(T=r.container.type,y.push(...r.container.providers(r))):T=dQ;const P=new _h(T,r.viewContainerRef,jo.create({parent:p||this._injector,providers:y}),r.componentFactoryResolver);return e.attach(P).instance}_attachDialogContent(e,i,r,a){if(e instanceof Yo){const p=this._createInjector(a,i,r,void 0);let y={$implicit:a.data,dialogRef:i};a.templateContext&&(y=Object.assign(Object.assign({},y),"function"==typeof a.templateContext?a.templateContext():a.templateContext)),r.attachTemplatePortal(new D_(e,null,y,p))}else{const p=this._createInjector(a,i,r,this._injector),y=r.attachComponentPortal(new _h(e,a.viewContainerRef,p,a.componentFactoryResolver));i.componentInstance=y.instance}}_createInjector(e,i,r,a){var p;const y=e.injector||(null===(p=e.viewContainerRef)||void 0===p?void 0:p.injector),T=[{provide:hQ,useValue:e.data},{provide:ZA,useValue:i}];return e.providers&&("function"==typeof e.providers?T.push(...e.providers(i,e,r)):T.push(...e.providers)),e.direction&&(!y||!y.get(Rm,null,hi.Optional))&&T.push({provide:Rm,useValue:{value:e.direction,change:si()}}),jo.create({parent:y||a,providers:T})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((a,p)=>{a?p.setAttribute("aria-hidden",a):p.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const a=i[r];a!==e&&"SCRIPT"!==a.nodeName&&"STYLE"!==a.nodeName&&!a.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(a,a.getAttribute("aria-hidden")),a.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(mt(Ls),mt(jo),mt(pQ,8),mt(n,12),mt(qy),mt(eB))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})();function YA(n,t){let e=n.length;for(;e--;)t(n[e])}let bQ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[_Q,mQ],imports:[uc,il,C_,il]}),n})();const EC={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},yQ={lightboxContainer:ya("lightboxContainer",[oo("void, exit",mi({opacity:0,transform:"scale(0.7)"})),oo("enter",mi({transform:"none"})),kr("* => enter",zr("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",mi({transform:"none",opacity:1})),EC),kr("* => void, * => exit",zr("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",mi({opacity:0})),EC)])};let vQ=(()=>{class n extends N3{constructor(e,i,r,a,p,y,T,P,z,H){var J;super(e,i,r,a,p,y,T,z),this._changeDetectorRef=P,this._viewportRuler=H,this._destroyed=new fn,null===(J=this._viewportRuler)||void 0===J||J.change().pipe(br(this._destroyed),va(null)).subscribe(()=>{this._height=this._viewportRuler.getViewportSize().height})}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}ngOnDestroy(){super.ngOnDestroy(),this._destroyed.next(),this._destroyed.complete()}}return n.\u0275fac=function(e){return new(e||n)(le(ei),le(zy),le(Mi,8),le(Hx),le(T_),le(Oi),le(Lm),le(lo),le(yl),le(cd))},n.\u0275cmp=Ut({type:n,selectors:[["sbb-lightbox-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-lightbox-container"],hostVars:8,hostBindings:function(e,i){1&e&&dm("@lightboxContainer.done",function(a){return i._onAnimationDone(a)})("@lightboxContainer.start",function(a){return i._onAnimationStart(a)}),2&e&&(Jr("id",i._config.id),Yn("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),as("@lightboxContainer",i._getAnimationState()),o("height",i._height,"px"))},features:[zn],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&Ct(0,uQ,0,0,"ng-template",0)},dependencies:[bh],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-lightbox-container{display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);width:100%;height:100vh}.cdk-high-contrast-active .sbb-lightbox-container{outline:solid .0666666667rem}.sbb-lightbox-container>*:only-child:not(.sbb-lightbox-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-lightbox-content{display:block;padding:var(--sbb-divider-big) var(--sbb-lightbox-padding-horizontal);flex:1 1 auto;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-lightbox-content>*:first-child{margin-top:0}.sbb-lightbox-title{padding:calc(1.4rem * var(--sbb-scaling-factor)) 3.7333333333rem calc(1.1333333333rem * var(--sbb-scaling-factor)) 1.3333333333rem;flex:0 0 auto;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(4.2666666667rem * var(--sbb-scaling-factor))}@media all and (min-width: 40.1875em){.sbb-lightbox-title{padding-left:1.6rem;padding-right:4rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title{padding-left:calc(5.3333333333rem * var(--sbb-scaling-factor));padding-right:calc(6.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em)and (max-width: 240.0525em){:where(html:not(.sbb-lean)) .sbb-lightbox-title{padding-top:1.8666666667rem;padding-bottom:1.8666666667rem}}.sbb-lightbox-title-close-button{position:absolute;right:1.3333333333rem;cursor:pointer;line-height:0;color:var(--sbb-color-storm);outline:0}.sbb-lightbox-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}@media all and (min-width: 40.1875em){.sbb-lightbox-title-close-button{right:1.6rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title-close-button{right:calc(3.7333333333rem * var(--sbb-scaling-factor))}}.sbb-lightbox-actions{padding:var(--sbb-lightbox-actions-padding-vertical) var(--sbb-lightbox-padding-horizontal);display:flex;flex:0 0 auto;flex-flow:column wrap;gap:var(--sbb-button-gap);align-items:center;justify-content:space-between;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}@media all and (min-width: 40.1875em){.sbb-lightbox-actions{flex-direction:row}}"],encapsulation:2,data:{animation:[yQ.lightboxContainer]}}),n})();class xQ extends uC{constructor(t,e,i){super(t,e,i),this.closeRequest=new fn,t.overlayRef.keydownEvents().pipe(go(r=>27===r.keyCode&&!!this.disableClose&&!nl(r))).subscribe(()=>this.closeRequest.next(null)),t.overlayRef.detachments().subscribe(()=>{this.closeRequest.complete()})}updatePosition(){return this}updateSize(){return this}}const wQ=new Qt("SbbLightboxData"),SQ=new Qt("sbb-lightbox-default-options"),tB=new Qt("sbb-lightbox-scroll-strategy"),CQ={provide:tB,deps:[Ls],useFactory:function TQ(n){return()=>n.scrollStrategies.block()}};let DQ=0,EQ=(()=>{class n extends V3{constructor(e,i,r,a,p,y){super(e,i,r,p,y,a,xQ,vQ,wQ),this._idPrefix="sbb-lightbox-"}get openLightboxes(){return this.openDialogs}open(e,i){const r=Object.assign(Object.assign({},i),{width:"100vw",minWidth:"100vw",maxWidth:"100vw",height:"auto",minHeight:"auto",maxHeight:"none"});return r.id=r.id||`${this._idPrefix}${DQ++}`,super.open(e,r)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}getLightboxById(e){return this.getDialogById(e)}}return n.\u0275fac=function(e){return new(e||n)(mt(Ls),mt(jo),mt(SQ,8),mt(tB),mt(n,12),mt(qy))},n.\u0275prov=vn({token:n,factory:n.\u0275fac}),n})(),nB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[EQ,CQ],imports:[ro,bQ,wA,uc,il,Pr,cs]}),n})(),iB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr]}),n})();ya("showDismiss",[oo("void, dismissed",mi({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),oo("visible",mi({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),kr("visible => dismissed",zr("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]),I_(class{});let rB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr,cs]}),n})();new Qt("SBB_PAGINATOR_DEFAULT_OPTIONS"),Ul(t3(class{}));let oB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,LT,Pr,cs]}),n})(),kQ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[qT]}),n})();ya("stepTransition",[kr("* => previous, * => next",[mi({opacity:1}),zr("150ms ease",mi({opacity:0}))]),kr("previous => current, next => current",[mi({opacity:0}),zr("500ms ease",mi({opacity:1}))]),kr("void => current",zr("0s"))]);let sB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,il,kQ,Pr,cs]}),n})(),aB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr,UA]}),n})();ya("growShrink",[oo("void",mi({opacity:0,width:"0px"})),oo("open",mi({opacity:1,width:"*"})),kr("void => *",zr("300ms ease")),kr("* => void",zr("300ms 25ms linear"))]);const NQ={provide:new Qt("sbb-select-scroll-strategy"),deps:[Ls],useFactory:function FQ(n){return()=>n.scrollStrategies.reposition()}};["start","center","end"].map(n=>({originX:n,originY:"top",overlayX:n,overlayY:"top"}));let lB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({providers:[NQ],imports:[ro,il,uc,Pr,OA,cs]}),n})();new Qt("SBB_SIDEBAR_CONTAINER"),ya("transform",[oo("open, open-instant",mi({transform:"none",visibility:"visible"})),oo("void",mi({"box-shadow":"none",visibility:"hidden"})),kr("void => open-instant",zr("0ms")),kr("void <=> open, open-instant => void",zr("300ms cubic-bezier(0.785, 0.135, 0.15, 0.86)"))]);let cB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,E_,Pr,cs,E_]}),n})(),uB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr,cs]}),n})(),JQ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[qM]}),n})();new Qt("SBB_SORT_DEFAULT_OPTIONS"),t3(Ul(class{}));const Jy="225ms cubic-bezier(0.4,0.0,0.2,1)";ya("indicator",[oo("active-asc, asc",mi({transform:"scaleY(-1)"})),oo("active-desc, desc",mi({transform:"scaleY(1)"})),kr("active-asc <=> active-desc",zr(Jy)),kr("asc <=> desc",zr("0ms"))]),ya("arrowOpacity",[oo("desc-to-active, asc-to-active, active",mi({opacity:1})),oo("desc-to-hint, asc-to-hint, hint",mi({opacity:.54})),oo("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",mi({opacity:0})),kr("* => asc, * => desc, * => active, * => hint, * => void",zr("0ms")),kr("* <=> *",zr(Jy))]),ya("arrowPosition",[kr("* => desc-to-hint, * => desc-to-active",zr(Jy,ax([mi({transform:"translateY(-25%)"}),mi({transform:"translateY(0)"})]))),kr("* => hint-to-desc, * => active-to-desc",zr(Jy,ax([mi({transform:"translateY(0)"}),mi({transform:"translateY(25%)"})]))),kr("* => asc-to-hint, * => asc-to-active",zr(Jy,ax([mi({transform:"translateY(25%)"}),mi({transform:"translateY(0)"})]))),kr("* => hint-to-asc, * => active-to-asc",zr(Jy,ax([mi({transform:"translateY(0)"}),mi({transform:"translateY(-25%)"})]))),oo("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",mi({transform:"translateY(0)"})),oo("hint-to-desc, active-to-desc, desc",mi({transform:"translateY(-25%)"})),oo("hint-to-asc, active-to-asc, asc",mi({transform:"translateY(25%)"}))]),ya("allowChildren",[kr("* <=> *",[YE("@*",ZE(),{optional:!0})])]),Ul(class{}),Im({passive:!0});let SB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[JQ,ro,Pr]}),n})(),TB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr,$A]}),n})();$T(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new fn}});let CB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,FA,Pr]}),n})(),DB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr]}),n})();const EB="225ms cubic-bezier(0.785, 0.135, 0.15, 0.86)";ya("translateHeight",[oo("void",mi({height:0,paddingTop:0,paddingBottom:0})),oo("auto",mi({height:"*",paddingTop:"*",paddingBottom:"*"})),kr("fixed => auto, initial => auto, * => void",[mi({height:"{{currentHeight}}px"}),zr(EB)]),kr("void => fixed, void => auto",zr(EB)),kr("void => initial",zr(0))]);let IB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,il,Pr,cs]}),n})();I_(class{});let MB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[ro,Pr,cs,DC]}),n})();const Nee=[Z3,zN,MN,$A,VN,OA,UN,lN,HN,KN,yN,wA,JN,yC,QN,cs,fN,nB,iB,DC,rB,kA,oB,sB,UA,aB,lB,kN,cB,uB,SB,_3,TB,CB,DB,TN,IB,tN,MB];let Bee=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n}),n.\u0275inj=qn({imports:[Nee,Z3,zN,MN,$A,VN,OA,UN,lN,HN,KN,yN,wA,JN,yC,QN,cs,fN,nB,iB,DC,rB,kA,oB,sB,UA,aB,lB,kN,cB,uB,SB,_3,TB,CB,DB,TN,IB,tN,MB]}),n})(),zee=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=$n({type:n,bootstrap:[wJ]}),n.\u0275inj=qn({imports:[ro,Kk,LU,XU,xJ,QH,e8,Bee]}),n})();(function $4(){X2=!1})(),C5().bootstrapModule(zee).catch(n=>console.error(n))},5343:(kn,Fn)=>{"use strict";Fn.byteLength=function De(dt){var Mt=xt(dt),Jn=Mt[1];return 3*(Mt[0]+Jn)/4-Jn},Fn.toByteArray=function zt(dt){var Mt,qe,bn=xt(dt),Jn=bn[0],yn=bn[1],Bt=new et(function Tt(dt,Mt,bn){return 3*(Mt+bn)/4-bn}(0,Jn,yn)),Rn=0,Re=yn>0?Jn-4:Jn;for(qe=0;qe<Re;qe+=4)Mt=Ue[dt.charCodeAt(qe)]<<18|Ue[dt.charCodeAt(qe+1)]<<12|Ue[dt.charCodeAt(qe+2)]<<6|Ue[dt.charCodeAt(qe+3)],Bt[Rn++]=Mt>>16&255,Bt[Rn++]=Mt>>8&255,Bt[Rn++]=255&Mt;return 2===yn&&(Mt=Ue[dt.charCodeAt(qe)]<<2|Ue[dt.charCodeAt(qe+1)]>>4,Bt[Rn++]=255&Mt),1===yn&&(Mt=Ue[dt.charCodeAt(qe)]<<10|Ue[dt.charCodeAt(qe+1)]<<4|Ue[dt.charCodeAt(qe+2)]>>2,Bt[Rn++]=Mt>>8&255,Bt[Rn++]=255&Mt),Bt},Fn.fromByteArray=function it(dt){for(var Mt,bn=dt.length,Jn=bn%3,yn=[],Rn=0,Re=bn-Jn;Rn<Re;Rn+=16383)yn.push(Gt(dt,Rn,Rn+16383>Re?Re:Rn+16383));return 1===Jn?yn.push(yt[(Mt=dt[bn-1])>>2]+yt[Mt<<4&63]+"=="):2===Jn&&yn.push(yt[(Mt=(dt[bn-2]<<8)+dt[bn-1])>>10]+yt[Mt>>4&63]+yt[Mt<<2&63]+"="),yn.join("")};for(var yt=[],Ue=[],et="undefined"!=typeof Uint8Array?Uint8Array:Array,Xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,Qe=Xe.length;d<Qe;++d)yt[d]=Xe[d],Ue[Xe.charCodeAt(d)]=d;function xt(dt){var Mt=dt.length;if(Mt%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var bn=dt.indexOf("=");return-1===bn&&(bn=Mt),[bn,bn===Mt?0:4-bn%4]}function en(dt){return yt[dt>>18&63]+yt[dt>>12&63]+yt[dt>>6&63]+yt[63&dt]}function Gt(dt,Mt,bn){for(var yn=[],Bt=Mt;Bt<bn;Bt+=3)yn.push(en((dt[Bt]<<16&16711680)+(dt[Bt+1]<<8&65280)+(255&dt[Bt+2])));return yn.join("")}Ue["-".charCodeAt(0)]=62,Ue["_".charCodeAt(0)]=63},3172:(kn,Fn,yt)=>{"use strict";var Ue=yt(5343),et=yt(8461),Xe="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;Fn.Buffer=De,Fn.SlowBuffer=function Bt(Pe){return+Pe!=Pe&&(Pe=0),De.alloc(+Pe)},Fn.INSPECT_MAX_BYTES=50;var d=2147483647;function xt(Pe){if(Pe>d)throw new RangeError('The value "'+Pe+'" is invalid for option "size"');var ie=new Uint8Array(Pe);return Object.setPrototypeOf(ie,De.prototype),ie}function De(Pe,ie,ue){if("number"==typeof Pe){if("string"==typeof ie)throw new TypeError('The "string" argument must be of type string. Received type number');return Gt(Pe)}return Tt(Pe,ie,ue)}function Tt(Pe,ie,ue){if("string"==typeof Pe)return function it(Pe,ie){if(("string"!=typeof ie||""===ie)&&(ie="utf8"),!De.isEncoding(ie))throw new TypeError("Unknown encoding: "+ie);var ue=0|Rn(Pe,ie),Ze=xt(ue),Et=Ze.write(Pe,ie);return Et!==ue&&(Ze=Ze.slice(0,Et)),Ze}(Pe,ie);if(ArrayBuffer.isView(Pe))return function Mt(Pe){if(zi(Pe,Uint8Array)){var ie=new Uint8Array(Pe);return bn(ie.buffer,ie.byteOffset,ie.byteLength)}return dt(Pe)}(Pe);if(null==Pe)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Pe);if(zi(Pe,ArrayBuffer)||Pe&&zi(Pe.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(zi(Pe,SharedArrayBuffer)||Pe&&zi(Pe.buffer,SharedArrayBuffer)))return bn(Pe,ie,ue);if("number"==typeof Pe)throw new TypeError('The "value" argument must not be of type number. Received type number');var Ze=Pe.valueOf&&Pe.valueOf();if(null!=Ze&&Ze!==Pe)return De.from(Ze,ie,ue);var Et=function Jn(Pe){if(De.isBuffer(Pe)){var ie=0|yn(Pe.length),ue=xt(ie);return 0===ue.length||Pe.copy(ue,0,0,ie),ue}return void 0!==Pe.length?"number"!=typeof Pe.length||_o(Pe.length)?xt(0):dt(Pe):"Buffer"===Pe.type&&Array.isArray(Pe.data)?dt(Pe.data):void 0}(Pe);if(Et)return Et;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof Pe[Symbol.toPrimitive])return De.from(Pe[Symbol.toPrimitive]("string"),ie,ue);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Pe)}function zt(Pe){if("number"!=typeof Pe)throw new TypeError('"size" argument must be of type number');if(Pe<0)throw new RangeError('The value "'+Pe+'" is invalid for option "size"')}function Gt(Pe){return zt(Pe),xt(Pe<0?0:0|yn(Pe))}function dt(Pe){for(var ie=Pe.length<0?0:0|yn(Pe.length),ue=xt(ie),Ze=0;Ze<ie;Ze+=1)ue[Ze]=255&Pe[Ze];return ue}function bn(Pe,ie,ue){if(ie<0||Pe.byteLength<ie)throw new RangeError('"offset" is outside of buffer bounds');if(Pe.byteLength<ie+(ue||0))throw new RangeError('"length" is outside of buffer bounds');var Ze;return Ze=void 0===ie&&void 0===ue?new Uint8Array(Pe):void 0===ue?new Uint8Array(Pe,ie):new Uint8Array(Pe,ie,ue),Object.setPrototypeOf(Ze,De.prototype),Ze}function yn(Pe){if(Pe>=d)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+d.toString(16)+" bytes");return 0|Pe}function Rn(Pe,ie){if(De.isBuffer(Pe))return Pe.length;if(ArrayBuffer.isView(Pe)||zi(Pe,ArrayBuffer))return Pe.byteLength;if("string"!=typeof Pe)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Pe);var ue=Pe.length,Ze=arguments.length>2&&!0===arguments[2];if(!Ze&&0===ue)return 0;for(var Et=!1;;)switch(ie){case"ascii":case"latin1":case"binary":return ue;case"utf8":case"utf-8":return ge(Pe).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*ue;case"hex":return ue>>>1;case"base64":return jt(Pe).length;default:if(Et)return Ze?-1:ge(Pe).length;ie=(""+ie).toLowerCase(),Et=!0}}function Re(Pe,ie,ue){var Ze=!1;if((void 0===ie||ie<0)&&(ie=0),ie>this.length||((void 0===ue||ue>this.length)&&(ue=this.length),ue<=0)||(ue>>>=0)<=(ie>>>=0))return"";for(Pe||(Pe="utf8");;)switch(Pe){case"hex":return jr(this,ie,ue);case"utf8":case"utf-8":return Wt(this,ie,ue);case"ascii":return _n(this,ie,ue);case"latin1":case"binary":return Gn(this,ie,ue);case"base64":return lt(this,ie,ue);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return jn(this,ie,ue);default:if(Ze)throw new TypeError("Unknown encoding: "+Pe);Pe=(Pe+"").toLowerCase(),Ze=!0}}function qe(Pe,ie,ue){var Ze=Pe[ie];Pe[ie]=Pe[ue],Pe[ue]=Ze}function kt(Pe,ie,ue,Ze,Et){if(0===Pe.length)return-1;if("string"==typeof ue?(Ze=ue,ue=0):ue>2147483647?ue=2147483647:ue<-2147483648&&(ue=-2147483648),_o(ue=+ue)&&(ue=Et?0:Pe.length-1),ue<0&&(ue=Pe.length+ue),ue>=Pe.length){if(Et)return-1;ue=Pe.length-1}else if(ue<0){if(!Et)return-1;ue=0}if("string"==typeof ie&&(ie=De.from(ie,Ze)),De.isBuffer(ie))return 0===ie.length?-1:xe(Pe,ie,ue,Ze,Et);if("number"==typeof ie)return ie&=255,"function"==typeof Uint8Array.prototype.indexOf?Et?Uint8Array.prototype.indexOf.call(Pe,ie,ue):Uint8Array.prototype.lastIndexOf.call(Pe,ie,ue):xe(Pe,[ie],ue,Ze,Et);throw new TypeError("val must be string, number or Buffer")}function xe(Pe,ie,ue,Ze,Et){var ir,Pt=1,Tn=Pe.length,tr=ie.length;if(void 0!==Ze&&("ucs2"===(Ze=String(Ze).toLowerCase())||"ucs-2"===Ze||"utf16le"===Ze||"utf-16le"===Ze)){if(Pe.length<2||ie.length<2)return-1;Pt=2,Tn/=2,tr/=2,ue/=2}function vr(Ys,za){return 1===Pt?Ys[za]:Ys.readUInt16BE(za*Pt)}if(Et){var co=-1;for(ir=ue;ir<Tn;ir++)if(vr(Pe,ir)===vr(ie,-1===co?0:ir-co)){if(-1===co&&(co=ir),ir-co+1===tr)return co*Pt}else-1!==co&&(ir-=ir-co),co=-1}else for(ue+tr>Tn&&(ue=Tn-tr),ir=ue;ir>=0;ir--){for(var bo=!0,Hl=0;Hl<tr;Hl++)if(vr(Pe,ir+Hl)!==vr(ie,Hl)){bo=!1;break}if(bo)return ir}return-1}function at(Pe,ie,ue,Ze){ue=Number(ue)||0;var Et=Pe.length-ue;Ze?(Ze=Number(Ze))>Et&&(Ze=Et):Ze=Et;var Pt=ie.length;Ze>Pt/2&&(Ze=Pt/2);for(var Tn=0;Tn<Ze;++Tn){var tr=parseInt(ie.substr(2*Tn,2),16);if(_o(tr))return Tn;Pe[ue+Tn]=tr}return Tn}function Be(Pe,ie,ue,Ze){return to(ge(ie,Pe.length-ue),Pe,ue,Ze)}function Ge(Pe,ie,ue,Ze){return to(function an(Pe){for(var ie=[],ue=0;ue<Pe.length;++ue)ie.push(255&Pe.charCodeAt(ue));return ie}(ie),Pe,ue,Ze)}function Lt(Pe,ie,ue,Ze){return to(jt(ie),Pe,ue,Ze)}function bt(Pe,ie,ue,Ze){return to(function Dt(Pe,ie){for(var ue,Ze,Pt=[],Tn=0;Tn<Pe.length&&!((ie-=2)<0);++Tn)Ze=(ue=Pe.charCodeAt(Tn))>>8,Pt.push(ue%256),Pt.push(Ze);return Pt}(ie,Pe.length-ue),Pe,ue,Ze)}function lt(Pe,ie,ue){return Ue.fromByteArray(0===ie&&ue===Pe.length?Pe:Pe.slice(ie,ue))}function Wt(Pe,ie,ue){ue=Math.min(Pe.length,ue);for(var Ze=[],Et=ie;Et<ue;){var vr,ir,co,bo,Pt=Pe[Et],Tn=null,tr=Pt>239?4:Pt>223?3:Pt>191?2:1;if(Et+tr<=ue)switch(tr){case 1:Pt<128&&(Tn=Pt);break;case 2:128==(192&(vr=Pe[Et+1]))&&(bo=(31&Pt)<<6|63&vr)>127&&(Tn=bo);break;case 3:ir=Pe[Et+2],128==(192&(vr=Pe[Et+1]))&&128==(192&ir)&&(bo=(15&Pt)<<12|(63&vr)<<6|63&ir)>2047&&(bo<55296||bo>57343)&&(Tn=bo);break;case 4:ir=Pe[Et+2],co=Pe[Et+3],128==(192&(vr=Pe[Et+1]))&&128==(192&ir)&&128==(192&co)&&(bo=(15&Pt)<<18|(63&vr)<<12|(63&ir)<<6|63&co)>65535&&bo<1114112&&(Tn=bo)}null===Tn?(Tn=65533,tr=1):Tn>65535&&(Ze.push((Tn-=65536)>>>10&1023|55296),Tn=56320|1023&Tn),Ze.push(Tn),Et+=tr}return function Dn(Pe){var ie=Pe.length;if(ie<=4096)return String.fromCharCode.apply(String,Pe);for(var ue="",Ze=0;Ze<ie;)ue+=String.fromCharCode.apply(String,Pe.slice(Ze,Ze+=4096));return ue}(Ze)}function _n(Pe,ie,ue){var Ze="";ue=Math.min(Pe.length,ue);for(var Et=ie;Et<ue;++Et)Ze+=String.fromCharCode(127&Pe[Et]);return Ze}function Gn(Pe,ie,ue){var Ze="";ue=Math.min(Pe.length,ue);for(var Et=ie;Et<ue;++Et)Ze+=String.fromCharCode(Pe[Et]);return Ze}function jr(Pe,ie,ue){var Ze=Pe.length;(!ie||ie<0)&&(ie=0),(!ue||ue<0||ue>Ze)&&(ue=Ze);for(var Et="",Pt=ie;Pt<ue;++Pt)Et+=ri[Pe[Pt]];return Et}function jn(Pe,ie,ue){for(var Ze=Pe.slice(ie,ue),Et="",Pt=0;Pt<Ze.length-1;Pt+=2)Et+=String.fromCharCode(Ze[Pt]+256*Ze[Pt+1]);return Et}function lr(Pe,ie,ue){if(Pe%1!=0||Pe<0)throw new RangeError("offset is not uint");if(Pe+ie>ue)throw new RangeError("Trying to access beyond buffer length")}function fn(Pe,ie,ue,Ze,Et,Pt){if(!De.isBuffer(Pe))throw new TypeError('"buffer" argument must be a Buffer instance');if(ie>Et||ie<Pt)throw new RangeError('"value" argument is out of bounds');if(ue+Ze>Pe.length)throw new RangeError("Index out of range")}function qo(Pe,ie,ue,Ze,Et,Pt){if(ue+Ze>Pe.length)throw new RangeError("Index out of range");if(ue<0)throw new RangeError("Index out of range")}function Fs(Pe,ie,ue,Ze,Et){return ie=+ie,ue>>>=0,Et||qo(Pe,0,ue,4),et.write(Pe,ie,ue,Ze,23,4),ue+4}function cr(Pe,ie,ue,Ze,Et){return ie=+ie,ue>>>=0,Et||qo(Pe,0,ue,8),et.write(Pe,ie,ue,Ze,52,8),ue+8}Fn.kMaxLength=d,!(De.TYPED_ARRAY_SUPPORT=function Qe(){try{var Pe=new Uint8Array(1),ie={foo:function(){return 42}};return Object.setPrototypeOf(ie,Uint8Array.prototype),Object.setPrototypeOf(Pe,ie),42===Pe.foo()}catch(ue){return!1}}())&&"undefined"!=typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(De.prototype,"parent",{enumerable:!0,get:function(){if(De.isBuffer(this))return this.buffer}}),Object.defineProperty(De.prototype,"offset",{enumerable:!0,get:function(){if(De.isBuffer(this))return this.byteOffset}}),De.poolSize=8192,De.from=function(Pe,ie,ue){return Tt(Pe,ie,ue)},Object.setPrototypeOf(De.prototype,Uint8Array.prototype),Object.setPrototypeOf(De,Uint8Array),De.alloc=function(Pe,ie,ue){return function en(Pe,ie,ue){return zt(Pe),Pe<=0?xt(Pe):void 0!==ie?"string"==typeof ue?xt(Pe).fill(ie,ue):xt(Pe).fill(ie):xt(Pe)}(Pe,ie,ue)},De.allocUnsafe=function(Pe){return Gt(Pe)},De.allocUnsafeSlow=function(Pe){return Gt(Pe)},De.isBuffer=function(ie){return null!=ie&&!0===ie._isBuffer&&ie!==De.prototype},De.compare=function(ie,ue){if(zi(ie,Uint8Array)&&(ie=De.from(ie,ie.offset,ie.byteLength)),zi(ue,Uint8Array)&&(ue=De.from(ue,ue.offset,ue.byteLength)),!De.isBuffer(ie)||!De.isBuffer(ue))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(ie===ue)return 0;for(var Ze=ie.length,Et=ue.length,Pt=0,Tn=Math.min(Ze,Et);Pt<Tn;++Pt)if(ie[Pt]!==ue[Pt]){Ze=ie[Pt],Et=ue[Pt];break}return Ze<Et?-1:Et<Ze?1:0},De.isEncoding=function(ie){switch(String(ie).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},De.concat=function(ie,ue){if(!Array.isArray(ie))throw new TypeError('"list" argument must be an Array of Buffers');if(0===ie.length)return De.alloc(0);var Ze;if(void 0===ue)for(ue=0,Ze=0;Ze<ie.length;++Ze)ue+=ie[Ze].length;var Et=De.allocUnsafe(ue),Pt=0;for(Ze=0;Ze<ie.length;++Ze){var Tn=ie[Ze];if(zi(Tn,Uint8Array))Pt+Tn.length>Et.length?De.from(Tn).copy(Et,Pt):Uint8Array.prototype.set.call(Et,Tn,Pt);else{if(!De.isBuffer(Tn))throw new TypeError('"list" argument must be an Array of Buffers');Tn.copy(Et,Pt)}Pt+=Tn.length}return Et},De.byteLength=Rn,De.prototype._isBuffer=!0,De.prototype.swap16=function(){var ie=this.length;if(ie%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var ue=0;ue<ie;ue+=2)qe(this,ue,ue+1);return this},De.prototype.swap32=function(){var ie=this.length;if(ie%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var ue=0;ue<ie;ue+=4)qe(this,ue,ue+3),qe(this,ue+1,ue+2);return this},De.prototype.swap64=function(){var ie=this.length;if(ie%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var ue=0;ue<ie;ue+=8)qe(this,ue,ue+7),qe(this,ue+1,ue+6),qe(this,ue+2,ue+5),qe(this,ue+3,ue+4);return this},De.prototype.toLocaleString=De.prototype.toString=function(){var ie=this.length;return 0===ie?"":0===arguments.length?Wt(this,0,ie):Re.apply(this,arguments)},De.prototype.equals=function(ie){if(!De.isBuffer(ie))throw new TypeError("Argument must be a Buffer");return this===ie||0===De.compare(this,ie)},De.prototype.inspect=function(){var ie="",ue=Fn.INSPECT_MAX_BYTES;return ie=this.toString("hex",0,ue).replace(/(.{2})/g,"$1 ").trim(),this.length>ue&&(ie+=" ... "),"<Buffer "+ie+">"},Xe&&(De.prototype[Xe]=De.prototype.inspect),De.prototype.compare=function(ie,ue,Ze,Et,Pt){if(zi(ie,Uint8Array)&&(ie=De.from(ie,ie.offset,ie.byteLength)),!De.isBuffer(ie))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof ie);if(void 0===ue&&(ue=0),void 0===Ze&&(Ze=ie?ie.length:0),void 0===Et&&(Et=0),void 0===Pt&&(Pt=this.length),ue<0||Ze>ie.length||Et<0||Pt>this.length)throw new RangeError("out of range index");if(Et>=Pt&&ue>=Ze)return 0;if(Et>=Pt)return-1;if(ue>=Ze)return 1;if(this===ie)return 0;for(var Tn=(Pt>>>=0)-(Et>>>=0),tr=(Ze>>>=0)-(ue>>>=0),vr=Math.min(Tn,tr),ir=this.slice(Et,Pt),co=ie.slice(ue,Ze),bo=0;bo<vr;++bo)if(ir[bo]!==co[bo]){Tn=ir[bo],tr=co[bo];break}return Tn<tr?-1:tr<Tn?1:0},De.prototype.includes=function(ie,ue,Ze){return-1!==this.indexOf(ie,ue,Ze)},De.prototype.indexOf=function(ie,ue,Ze){return kt(this,ie,ue,Ze,!0)},De.prototype.lastIndexOf=function(ie,ue,Ze){return kt(this,ie,ue,Ze,!1)},De.prototype.write=function(ie,ue,Ze,Et){if(void 0===ue)Et="utf8",Ze=this.length,ue=0;else if(void 0===Ze&&"string"==typeof ue)Et=ue,Ze=this.length,ue=0;else{if(!isFinite(ue))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");ue>>>=0,isFinite(Ze)?(Ze>>>=0,void 0===Et&&(Et="utf8")):(Et=Ze,Ze=void 0)}var Pt=this.length-ue;if((void 0===Ze||Ze>Pt)&&(Ze=Pt),ie.length>0&&(Ze<0||ue<0)||ue>this.length)throw new RangeError("Attempt to write outside buffer bounds");Et||(Et="utf8");for(var Tn=!1;;)switch(Et){case"hex":return at(this,ie,ue,Ze);case"utf8":case"utf-8":return Be(this,ie,ue,Ze);case"ascii":case"latin1":case"binary":return Ge(this,ie,ue,Ze);case"base64":return Lt(this,ie,ue,Ze);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,ie,ue,Ze);default:if(Tn)throw new TypeError("Unknown encoding: "+Et);Et=(""+Et).toLowerCase(),Tn=!0}},De.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},De.prototype.slice=function(ie,ue){var Ze=this.length;(ie=~~ie)<0?(ie+=Ze)<0&&(ie=0):ie>Ze&&(ie=Ze),(ue=void 0===ue?Ze:~~ue)<0?(ue+=Ze)<0&&(ue=0):ue>Ze&&(ue=Ze),ue<ie&&(ue=ie);var Et=this.subarray(ie,ue);return Object.setPrototypeOf(Et,De.prototype),Et},De.prototype.readUintLE=De.prototype.readUIntLE=function(ie,ue,Ze){ie>>>=0,ue>>>=0,Ze||lr(ie,ue,this.length);for(var Et=this[ie],Pt=1,Tn=0;++Tn<ue&&(Pt*=256);)Et+=this[ie+Tn]*Pt;return Et},De.prototype.readUintBE=De.prototype.readUIntBE=function(ie,ue,Ze){ie>>>=0,ue>>>=0,Ze||lr(ie,ue,this.length);for(var Et=this[ie+--ue],Pt=1;ue>0&&(Pt*=256);)Et+=this[ie+--ue]*Pt;return Et},De.prototype.readUint8=De.prototype.readUInt8=function(ie,ue){return ie>>>=0,ue||lr(ie,1,this.length),this[ie]},De.prototype.readUint16LE=De.prototype.readUInt16LE=function(ie,ue){return ie>>>=0,ue||lr(ie,2,this.length),this[ie]|this[ie+1]<<8},De.prototype.readUint16BE=De.prototype.readUInt16BE=function(ie,ue){return ie>>>=0,ue||lr(ie,2,this.length),this[ie]<<8|this[ie+1]},De.prototype.readUint32LE=De.prototype.readUInt32LE=function(ie,ue){return ie>>>=0,ue||lr(ie,4,this.length),(this[ie]|this[ie+1]<<8|this[ie+2]<<16)+16777216*this[ie+3]},De.prototype.readUint32BE=De.prototype.readUInt32BE=function(ie,ue){return ie>>>=0,ue||lr(ie,4,this.length),16777216*this[ie]+(this[ie+1]<<16|this[ie+2]<<8|this[ie+3])},De.prototype.readIntLE=function(ie,ue,Ze){ie>>>=0,ue>>>=0,Ze||lr(ie,ue,this.length);for(var Et=this[ie],Pt=1,Tn=0;++Tn<ue&&(Pt*=256);)Et+=this[ie+Tn]*Pt;return Et>=(Pt*=128)&&(Et-=Math.pow(2,8*ue)),Et},De.prototype.readIntBE=function(ie,ue,Ze){ie>>>=0,ue>>>=0,Ze||lr(ie,ue,this.length);for(var Et=ue,Pt=1,Tn=this[ie+--Et];Et>0&&(Pt*=256);)Tn+=this[ie+--Et]*Pt;return Tn>=(Pt*=128)&&(Tn-=Math.pow(2,8*ue)),Tn},De.prototype.readInt8=function(ie,ue){return ie>>>=0,ue||lr(ie,1,this.length),128&this[ie]?-1*(255-this[ie]+1):this[ie]},De.prototype.readInt16LE=function(ie,ue){ie>>>=0,ue||lr(ie,2,this.length);var Ze=this[ie]|this[ie+1]<<8;return 32768&Ze?4294901760|Ze:Ze},De.prototype.readInt16BE=function(ie,ue){ie>>>=0,ue||lr(ie,2,this.length);var Ze=this[ie+1]|this[ie]<<8;return 32768&Ze?4294901760|Ze:Ze},De.prototype.readInt32LE=function(ie,ue){return ie>>>=0,ue||lr(ie,4,this.length),this[ie]|this[ie+1]<<8|this[ie+2]<<16|this[ie+3]<<24},De.prototype.readInt32BE=function(ie,ue){return ie>>>=0,ue||lr(ie,4,this.length),this[ie]<<24|this[ie+1]<<16|this[ie+2]<<8|this[ie+3]},De.prototype.readFloatLE=function(ie,ue){return ie>>>=0,ue||lr(ie,4,this.length),et.read(this,ie,!0,23,4)},De.prototype.readFloatBE=function(ie,ue){return ie>>>=0,ue||lr(ie,4,this.length),et.read(this,ie,!1,23,4)},De.prototype.readDoubleLE=function(ie,ue){return ie>>>=0,ue||lr(ie,8,this.length),et.read(this,ie,!0,52,8)},De.prototype.readDoubleBE=function(ie,ue){return ie>>>=0,ue||lr(ie,8,this.length),et.read(this,ie,!1,52,8)},De.prototype.writeUintLE=De.prototype.writeUIntLE=function(ie,ue,Ze,Et){ie=+ie,ue>>>=0,Ze>>>=0,Et||fn(this,ie,ue,Ze,Math.pow(2,8*Ze)-1,0);var Tn=1,tr=0;for(this[ue]=255&ie;++tr<Ze&&(Tn*=256);)this[ue+tr]=ie/Tn&255;return ue+Ze},De.prototype.writeUintBE=De.prototype.writeUIntBE=function(ie,ue,Ze,Et){ie=+ie,ue>>>=0,Ze>>>=0,Et||fn(this,ie,ue,Ze,Math.pow(2,8*Ze)-1,0);var Tn=Ze-1,tr=1;for(this[ue+Tn]=255&ie;--Tn>=0&&(tr*=256);)this[ue+Tn]=ie/tr&255;return ue+Ze},De.prototype.writeUint8=De.prototype.writeUInt8=function(ie,ue,Ze){return ie=+ie,ue>>>=0,Ze||fn(this,ie,ue,1,255,0),this[ue]=255&ie,ue+1},De.prototype.writeUint16LE=De.prototype.writeUInt16LE=function(ie,ue,Ze){return ie=+ie,ue>>>=0,Ze||fn(this,ie,ue,2,65535,0),this[ue]=255&ie,this[ue+1]=ie>>>8,ue+2},De.prototype.writeUint16BE=De.prototype.writeUInt16BE=function(ie,ue,Ze){return ie=+ie,ue>>>=0,Ze||fn(this,ie,ue,2,65535,0),this[ue]=ie>>>8,this[ue+1]=255&ie,ue+2},De.prototype.writeUint32LE=De.prototype.writeUInt32LE=function(ie,ue,Ze){return ie=+ie,ue>>>=0,Ze||fn(this,ie,ue,4,4294967295,0),this[ue+3]=ie>>>24,this[ue+2]=ie>>>16,this[ue+1]=ie>>>8,this[ue]=255&ie,ue+4},De.prototype.writeUint32BE=De.prototype.writeUInt32BE=function(ie,ue,Ze){return ie=+ie,ue>>>=0,Ze||fn(this,ie,ue,4,4294967295,0),this[ue]=ie>>>24,this[ue+1]=ie>>>16,this[ue+2]=ie>>>8,this[ue+3]=255&ie,ue+4},De.prototype.writeIntLE=function(ie,ue,Ze,Et){if(ie=+ie,ue>>>=0,!Et){var Pt=Math.pow(2,8*Ze-1);fn(this,ie,ue,Ze,Pt-1,-Pt)}var Tn=0,tr=1,vr=0;for(this[ue]=255&ie;++Tn<Ze&&(tr*=256);)ie<0&&0===vr&&0!==this[ue+Tn-1]&&(vr=1),this[ue+Tn]=(ie/tr>>0)-vr&255;return ue+Ze},De.prototype.writeIntBE=function(ie,ue,Ze,Et){if(ie=+ie,ue>>>=0,!Et){var Pt=Math.pow(2,8*Ze-1);fn(this,ie,ue,Ze,Pt-1,-Pt)}var Tn=Ze-1,tr=1,vr=0;for(this[ue+Tn]=255&ie;--Tn>=0&&(tr*=256);)ie<0&&0===vr&&0!==this[ue+Tn+1]&&(vr=1),this[ue+Tn]=(ie/tr>>0)-vr&255;return ue+Ze},De.prototype.writeInt8=function(ie,ue,Ze){return ie=+ie,ue>>>=0,Ze||fn(this,ie,ue,1,127,-128),ie<0&&(ie=255+ie+1),this[ue]=255&ie,ue+1},De.prototype.writeInt16LE=function(ie,ue,Ze){return ie=+ie,ue>>>=0,Ze||fn(this,ie,ue,2,32767,-32768),this[ue]=255&ie,this[ue+1]=ie>>>8,ue+2},De.prototype.writeInt16BE=function(ie,ue,Ze){return ie=+ie,ue>>>=0,Ze||fn(this,ie,ue,2,32767,-32768),this[ue]=ie>>>8,this[ue+1]=255&ie,ue+2},De.prototype.writeInt32LE=function(ie,ue,Ze){return ie=+ie,ue>>>=0,Ze||fn(this,ie,ue,4,2147483647,-2147483648),this[ue]=255&ie,this[ue+1]=ie>>>8,this[ue+2]=ie>>>16,this[ue+3]=ie>>>24,ue+4},De.prototype.writeInt32BE=function(ie,ue,Ze){return ie=+ie,ue>>>=0,Ze||fn(this,ie,ue,4,2147483647,-2147483648),ie<0&&(ie=4294967295+ie+1),this[ue]=ie>>>24,this[ue+1]=ie>>>16,this[ue+2]=ie>>>8,this[ue+3]=255&ie,ue+4},De.prototype.writeFloatLE=function(ie,ue,Ze){return Fs(this,ie,ue,!0,Ze)},De.prototype.writeFloatBE=function(ie,ue,Ze){return Fs(this,ie,ue,!1,Ze)},De.prototype.writeDoubleLE=function(ie,ue,Ze){return cr(this,ie,ue,!0,Ze)},De.prototype.writeDoubleBE=function(ie,ue,Ze){return cr(this,ie,ue,!1,Ze)},De.prototype.copy=function(ie,ue,Ze,Et){if(!De.isBuffer(ie))throw new TypeError("argument should be a Buffer");if(Ze||(Ze=0),!Et&&0!==Et&&(Et=this.length),ue>=ie.length&&(ue=ie.length),ue||(ue=0),Et>0&&Et<Ze&&(Et=Ze),Et===Ze||0===ie.length||0===this.length)return 0;if(ue<0)throw new RangeError("targetStart out of bounds");if(Ze<0||Ze>=this.length)throw new RangeError("Index out of range");if(Et<0)throw new RangeError("sourceEnd out of bounds");Et>this.length&&(Et=this.length),ie.length-ue<Et-Ze&&(Et=ie.length-ue+Ze);var Pt=Et-Ze;return this===ie&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(ue,Ze,Et):Uint8Array.prototype.set.call(ie,this.subarray(Ze,Et),ue),Pt},De.prototype.fill=function(ie,ue,Ze,Et){if("string"==typeof ie){if("string"==typeof ue?(Et=ue,ue=0,Ze=this.length):"string"==typeof Ze&&(Et=Ze,Ze=this.length),void 0!==Et&&"string"!=typeof Et)throw new TypeError("encoding must be a string");if("string"==typeof Et&&!De.isEncoding(Et))throw new TypeError("Unknown encoding: "+Et);if(1===ie.length){var Pt=ie.charCodeAt(0);("utf8"===Et&&Pt<128||"latin1"===Et)&&(ie=Pt)}}else"number"==typeof ie?ie&=255:"boolean"==typeof ie&&(ie=Number(ie));if(ue<0||this.length<ue||this.length<Ze)throw new RangeError("Out of range index");if(Ze<=ue)return this;var Tn;if(ue>>>=0,Ze=void 0===Ze?this.length:Ze>>>0,ie||(ie=0),"number"==typeof ie)for(Tn=ue;Tn<Ze;++Tn)this[Tn]=ie;else{var tr=De.isBuffer(ie)?ie:De.from(ie,Et),vr=tr.length;if(0===vr)throw new TypeError('The value "'+ie+'" is invalid for argument "value"');for(Tn=0;Tn<Ze-ue;++Tn)this[Tn+ue]=tr[Tn%vr]}return this};var ur=/[^+/0-9A-Za-z-_]/g;function ge(Pe,ie){ie=ie||1/0;for(var ue,Ze=Pe.length,Et=null,Pt=[],Tn=0;Tn<Ze;++Tn){if((ue=Pe.charCodeAt(Tn))>55295&&ue<57344){if(!Et){if(ue>56319){(ie-=3)>-1&&Pt.push(239,191,189);continue}if(Tn+1===Ze){(ie-=3)>-1&&Pt.push(239,191,189);continue}Et=ue;continue}if(ue<56320){(ie-=3)>-1&&Pt.push(239,191,189),Et=ue;continue}ue=65536+(Et-55296<<10|ue-56320)}else Et&&(ie-=3)>-1&&Pt.push(239,191,189);if(Et=null,ue<128){if((ie-=1)<0)break;Pt.push(ue)}else if(ue<2048){if((ie-=2)<0)break;Pt.push(ue>>6|192,63&ue|128)}else if(ue<65536){if((ie-=3)<0)break;Pt.push(ue>>12|224,ue>>6&63|128,63&ue|128)}else{if(!(ue<1114112))throw new Error("Invalid code point");if((ie-=4)<0)break;Pt.push(ue>>18|240,ue>>12&63|128,ue>>6&63|128,63&ue|128)}}return Pt}function jt(Pe){return Ue.toByteArray(function ee(Pe){if((Pe=(Pe=Pe.split("=")[0]).trim().replace(ur,"")).length<2)return"";for(;Pe.length%4!=0;)Pe+="=";return Pe}(Pe))}function to(Pe,ie,ue,Ze){for(var Et=0;Et<Ze&&!(Et+ue>=ie.length||Et>=Pe.length);++Et)ie[Et+ue]=Pe[Et];return Et}function zi(Pe,ie){return Pe instanceof ie||null!=Pe&&null!=Pe.constructor&&null!=Pe.constructor.name&&Pe.constructor.name===ie.name}function _o(Pe){return Pe!=Pe}var ri=function(){for(var Pe="0123456789abcdef",ie=new Array(256),ue=0;ue<16;++ue)for(var Ze=16*ue,Et=0;Et<16;++Et)ie[Ze+Et]=Pe[ue]+Pe[Et];return ie}()},8472:function(kn,Fn){var Xe,yt="undefined"!=typeof self?self:this,Ue=function(){function Xe(){this.fetch=!1,this.DOMException=yt.DOMException}return Xe.prototype=yt,new Xe}();Xe=Ue,function(Qe){var xt_searchParams="URLSearchParams"in Xe,xt_iterable="Symbol"in Xe&&"iterator"in Symbol,xt_blob="FileReader"in Xe&&"Blob"in Xe&&function(){try{return new Blob,!0}catch(lt){return!1}}(),xt_formData="FormData"in Xe,xt_arrayBuffer="ArrayBuffer"in Xe;if(xt_arrayBuffer)var Tt=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],zt=ArrayBuffer.isView||function(lt){return lt&&Tt.indexOf(Object.prototype.toString.call(lt))>-1};function en(lt){if("string"!=typeof lt&&(lt=String(lt)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(lt))throw new TypeError("Invalid character in header field name");return lt.toLowerCase()}function Gt(lt){return"string"!=typeof lt&&(lt=String(lt)),lt}function it(lt){var Wt={next:function(){var Mn=lt.shift();return{done:void 0===Mn,value:Mn}}};return xt_iterable&&(Wt[Symbol.iterator]=function(){return Wt}),Wt}function dt(lt){this.map={},lt instanceof dt?lt.forEach(function(Wt,Mn){this.append(Mn,Wt)},this):Array.isArray(lt)?lt.forEach(function(Wt){this.append(Wt[0],Wt[1])},this):lt&&Object.getOwnPropertyNames(lt).forEach(function(Wt){this.append(Wt,lt[Wt])},this)}function Mt(lt){if(lt.bodyUsed)return Promise.reject(new TypeError("Already read"));lt.bodyUsed=!0}function bn(lt){return new Promise(function(Wt,Mn){lt.onload=function(){Wt(lt.result)},lt.onerror=function(){Mn(lt.error)}})}function Jn(lt){var Wt=new FileReader,Mn=bn(Wt);return Wt.readAsArrayBuffer(lt),Mn}function Rn(lt){if(lt.slice)return lt.slice(0);var Wt=new Uint8Array(lt.byteLength);return Wt.set(new Uint8Array(lt)),Wt.buffer}function Re(){return this.bodyUsed=!1,this._initBody=function(lt){this._bodyInit=lt,lt?"string"==typeof lt?this._bodyText=lt:xt_blob&&Blob.prototype.isPrototypeOf(lt)?this._bodyBlob=lt:xt_formData&&FormData.prototype.isPrototypeOf(lt)?this._bodyFormData=lt:xt_searchParams&&URLSearchParams.prototype.isPrototypeOf(lt)?this._bodyText=lt.toString():xt_arrayBuffer&&xt_blob&&function De(lt){return lt&&DataView.prototype.isPrototypeOf(lt)}(lt)?(this._bodyArrayBuffer=Rn(lt.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):xt_arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(lt)||zt(lt))?this._bodyArrayBuffer=Rn(lt):this._bodyText=lt=Object.prototype.toString.call(lt):this._bodyText="",this.headers.get("content-type")||("string"==typeof lt?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):xt_searchParams&&URLSearchParams.prototype.isPrototypeOf(lt)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},xt_blob&&(this.blob=function(){var lt=Mt(this);if(lt)return lt;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?Mt(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(Jn)}),this.text=function(){var lt=Mt(this);if(lt)return lt;if(this._bodyBlob)return function yn(lt){var Wt=new FileReader,Mn=bn(Wt);return Wt.readAsText(lt),Mn}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function Bt(lt){for(var Wt=new Uint8Array(lt),Mn=new Array(Wt.length),Dn=0;Dn<Wt.length;Dn++)Mn[Dn]=String.fromCharCode(Wt[Dn]);return Mn.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},xt_formData&&(this.formData=function(){return this.text().then(at)}),this.json=function(){return this.text().then(JSON.parse)},this}dt.prototype.append=function(lt,Wt){lt=en(lt),Wt=Gt(Wt);var Mn=this.map[lt];this.map[lt]=Mn?Mn+", "+Wt:Wt},dt.prototype.delete=function(lt){delete this.map[en(lt)]},dt.prototype.get=function(lt){return lt=en(lt),this.has(lt)?this.map[lt]:null},dt.prototype.has=function(lt){return this.map.hasOwnProperty(en(lt))},dt.prototype.set=function(lt,Wt){this.map[en(lt)]=Gt(Wt)},dt.prototype.forEach=function(lt,Wt){for(var Mn in this.map)this.map.hasOwnProperty(Mn)&&lt.call(Wt,this.map[Mn],Mn,this)},dt.prototype.keys=function(){var lt=[];return this.forEach(function(Wt,Mn){lt.push(Mn)}),it(lt)},dt.prototype.values=function(){var lt=[];return this.forEach(function(Wt){lt.push(Wt)}),it(lt)},dt.prototype.entries=function(){var lt=[];return this.forEach(function(Wt,Mn){lt.push([Mn,Wt])}),it(lt)},xt_iterable&&(dt.prototype[Symbol.iterator]=dt.prototype.entries);var qe=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function xe(lt,Wt){var Mn=(Wt=Wt||{}).body;if(lt instanceof xe){if(lt.bodyUsed)throw new TypeError("Already read");this.url=lt.url,this.credentials=lt.credentials,Wt.headers||(this.headers=new dt(lt.headers)),this.method=lt.method,this.mode=lt.mode,this.signal=lt.signal,!Mn&&null!=lt._bodyInit&&(Mn=lt._bodyInit,lt.bodyUsed=!0)}else this.url=String(lt);if(this.credentials=Wt.credentials||this.credentials||"same-origin",(Wt.headers||!this.headers)&&(this.headers=new dt(Wt.headers)),this.method=function kt(lt){var Wt=lt.toUpperCase();return qe.indexOf(Wt)>-1?Wt:lt}(Wt.method||this.method||"GET"),this.mode=Wt.mode||this.mode||null,this.signal=Wt.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&Mn)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Mn)}function at(lt){var Wt=new FormData;return lt.trim().split("&").forEach(function(Mn){if(Mn){var Dn=Mn.split("="),_n=Dn.shift().replace(/\+/g," "),Gn=Dn.join("=").replace(/\+/g," ");Wt.append(decodeURIComponent(_n),decodeURIComponent(Gn))}}),Wt}function Be(lt){var Wt=new dt;return lt.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(Dn){var _n=Dn.split(":"),Gn=_n.shift().trim();if(Gn){var jr=_n.join(":").trim();Wt.append(Gn,jr)}}),Wt}function Ge(lt,Wt){Wt||(Wt={}),this.type="default",this.status=void 0===Wt.status?200:Wt.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in Wt?Wt.statusText:"OK",this.headers=new dt(Wt.headers),this.url=Wt.url||"",this._initBody(lt)}xe.prototype.clone=function(){return new xe(this,{body:this._bodyInit})},Re.call(xe.prototype),Re.call(Ge.prototype),Ge.prototype.clone=function(){return new Ge(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new dt(this.headers),url:this.url})},Ge.error=function(){var lt=new Ge(null,{status:0,statusText:""});return lt.type="error",lt};var Lt=[301,302,303,307,308];Ge.redirect=function(lt,Wt){if(-1===Lt.indexOf(Wt))throw new RangeError("Invalid status code");return new Ge(null,{status:Wt,headers:{location:lt}})},Qe.DOMException=Xe.DOMException;try{new Qe.DOMException}catch(lt){Qe.DOMException=function(Wt,Mn){this.message=Wt,this.name=Mn;var Dn=Error(Wt);this.stack=Dn.stack},Qe.DOMException.prototype=Object.create(Error.prototype),Qe.DOMException.prototype.constructor=Qe.DOMException}function bt(lt,Wt){return new Promise(function(Mn,Dn){var _n=new xe(lt,Wt);if(_n.signal&&_n.signal.aborted)return Dn(new Qe.DOMException("Aborted","AbortError"));var Gn=new XMLHttpRequest;function jr(){Gn.abort()}Gn.onload=function(){var jn={status:Gn.status,statusText:Gn.statusText,headers:Be(Gn.getAllResponseHeaders()||"")};jn.url="responseURL"in Gn?Gn.responseURL:jn.headers.get("X-Request-URL"),Mn(new Ge("response"in Gn?Gn.response:Gn.responseText,jn))},Gn.onerror=function(){Dn(new TypeError("Network request failed"))},Gn.ontimeout=function(){Dn(new TypeError("Network request failed"))},Gn.onabort=function(){Dn(new Qe.DOMException("Aborted","AbortError"))},Gn.open(_n.method,_n.url,!0),"include"===_n.credentials?Gn.withCredentials=!0:"omit"===_n.credentials&&(Gn.withCredentials=!1),"responseType"in Gn&&xt_blob&&(Gn.responseType="blob"),_n.headers.forEach(function(jn,lr){Gn.setRequestHeader(lr,jn)}),_n.signal&&(_n.signal.addEventListener("abort",jr),Gn.onreadystatechange=function(){4===Gn.readyState&&_n.signal.removeEventListener("abort",jr)}),Gn.send(void 0===_n._bodyInit?null:_n._bodyInit)})}bt.polyfill=!0,Xe.fetch||(Xe.fetch=bt,Xe.Headers=dt,Xe.Request=xe,Xe.Response=Ge),Qe.Headers=dt,Qe.Request=xe,Qe.Response=Ge,Qe.fetch=bt,Object.defineProperty(Qe,"__esModule",{value:!0})}({}),Ue.fetch.ponyfill=!0,delete Ue.fetch.polyfill;var et=Ue;(Fn=et.fetch).default=et.fetch,Fn.fetch=et.fetch,Fn.Headers=et.Headers,Fn.Request=et.Request,Fn.Response=et.Response,kn.exports=Fn},6570:kn=>{function Fn(Ue){if(Ue)return function yt(Ue){for(var et in Fn.prototype)Ue[et]=Fn.prototype[et];return Ue}(Ue)}kn.exports=Fn,Fn.prototype.on=Fn.prototype.addEventListener=function(Ue,et){return this._callbacks=this._callbacks||{},(this._callbacks[Ue]=this._callbacks[Ue]||[]).push(et),this},Fn.prototype.once=function(Ue,et){var Xe=this;function d(){Xe.off(Ue,d),et.apply(this,arguments)}return this._callbacks=this._callbacks||{},d.fn=et,this.on(Ue,d),this},Fn.prototype.off=Fn.prototype.removeListener=Fn.prototype.removeAllListeners=Fn.prototype.removeEventListener=function(Ue,et){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var Xe=this._callbacks[Ue];if(!Xe)return this;if(1==arguments.length)return delete this._callbacks[Ue],this;for(var d,Qe=0;Qe<Xe.length;Qe++)if((d=Xe[Qe])===et||d.fn===et){Xe.splice(Qe,1);break}return this},Fn.prototype.emit=function(Ue){this._callbacks=this._callbacks||{};var et=[].slice.call(arguments,1),Xe=this._callbacks[Ue];if(Xe)for(var d=0,Qe=(Xe=Xe.slice(0)).length;d<Qe;++d)Xe[d].apply(this,et);return this},Fn.prototype.listeners=function(Ue){return this._callbacks=this._callbacks||{},this._callbacks[Ue]||[]},Fn.prototype.hasListeners=function(Ue){return!!this.listeners(Ue).length}},8461:(kn,Fn)=>{Fn.read=function(yt,Ue,et,Xe,d){var Qe,xt,De=8*d-Xe-1,Tt=(1<<De)-1,zt=Tt>>1,en=-7,Gt=et?d-1:0,it=et?-1:1,dt=yt[Ue+Gt];for(Gt+=it,Qe=dt&(1<<-en)-1,dt>>=-en,en+=De;en>0;Qe=256*Qe+yt[Ue+Gt],Gt+=it,en-=8);for(xt=Qe&(1<<-en)-1,Qe>>=-en,en+=Xe;en>0;xt=256*xt+yt[Ue+Gt],Gt+=it,en-=8);if(0===Qe)Qe=1-zt;else{if(Qe===Tt)return xt?NaN:1/0*(dt?-1:1);xt+=Math.pow(2,Xe),Qe-=zt}return(dt?-1:1)*xt*Math.pow(2,Qe-Xe)},Fn.write=function(yt,Ue,et,Xe,d,Qe){var xt,De,Tt,zt=8*Qe-d-1,en=(1<<zt)-1,Gt=en>>1,it=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,dt=Xe?0:Qe-1,Mt=Xe?1:-1,bn=Ue<0||0===Ue&&1/Ue<0?1:0;for(Ue=Math.abs(Ue),isNaN(Ue)||Ue===1/0?(De=isNaN(Ue)?1:0,xt=en):(xt=Math.floor(Math.log(Ue)/Math.LN2),Ue*(Tt=Math.pow(2,-xt))<1&&(xt--,Tt*=2),(Ue+=xt+Gt>=1?it/Tt:it*Math.pow(2,1-Gt))*Tt>=2&&(xt++,Tt/=2),xt+Gt>=en?(De=0,xt=en):xt+Gt>=1?(De=(Ue*Tt-1)*Math.pow(2,d),xt+=Gt):(De=Ue*Math.pow(2,Gt-1)*Math.pow(2,d),xt=0));d>=8;yt[et+dt]=255&De,dt+=Mt,De/=256,d-=8);for(xt=xt<<d|De,zt+=d;zt>0;yt[et+dt]=255&xt,dt+=Mt,xt/=256,zt-=8);yt[et+dt-Mt]|=128*bn}},9898:function(kn){kn.exports=function(){"use strict";var Fn,yt,Ue;function et(d,Qe){if(Fn)if(yt){var xt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Fn+")(sharedChunk); ("+yt+")(sharedChunk); self.onerror = null;",De={};Fn(De),Ue=Qe(De),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Ue.workerUrl=window.URL.createObjectURL(new Blob([xt],{type:"text/javascript"})))}else yt=Qe;else Fn=Qe}return et(0,function(d){function Qe(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var xt,De={},Tt={};function zt(){if(xt)return Tt;xt=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.setMatrixArrayType=function(_){Tt.ARRAY_TYPE=o=_},Tt.toRadian=function(_){return _*h},Tt.equals=function(_,f){return Math.abs(_-f)<=u*Math.max(1,Math.abs(_),Math.abs(f))},Tt.RANDOM=Tt.ARRAY_TYPE=Tt.EPSILON=void 0;var u=1e-6;Tt.EPSILON=u;var o="undefined"!=typeof Float32Array?Float32Array:Array;Tt.ARRAY_TYPE=o;var l=Math.random;Tt.RANDOM=l;var h=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var _=0,f=arguments.length;f--;)_+=arguments[f]*arguments[f];return Math.sqrt(_)}),Tt}var en,Gt={};function it(){if(en)return Gt;function u(f){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b})(f)}en=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=function(){var f=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f},Gt.clone=function(f){var b=new o.ARRAY_TYPE(4);return b[0]=f[0],b[1]=f[1],b[2]=f[2],b[3]=f[3],b},Gt.copy=function(f,b){return f[0]=b[0],f[1]=b[1],f[2]=b[2],f[3]=b[3],f},Gt.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f},Gt.fromValues=function(f,b,S,E){var R=new o.ARRAY_TYPE(4);return R[0]=f,R[1]=b,R[2]=S,R[3]=E,R},Gt.set=function(f,b,S,E,R){return f[0]=b,f[1]=S,f[2]=E,f[3]=R,f},Gt.transpose=function(f,b){if(f===b){var S=b[1];f[1]=b[2],f[2]=S}else f[0]=b[0],f[1]=b[2],f[2]=b[1],f[3]=b[3];return f},Gt.invert=function(f,b){var S=b[0],E=b[1],R=b[2],x=b[3],I=S*x-R*E;return I?(f[0]=x*(I=1/I),f[1]=-E*I,f[2]=-R*I,f[3]=S*I,f):null},Gt.adjoint=function(f,b){var S=b[0];return f[0]=b[3],f[1]=-b[1],f[2]=-b[2],f[3]=S,f},Gt.determinant=function(f){return f[0]*f[3]-f[2]*f[1]},Gt.multiply=h,Gt.rotate=function(f,b,S){var E=b[0],R=b[1],x=b[2],I=b[3],A=Math.sin(S),D=Math.cos(S);return f[0]=E*D+x*A,f[1]=R*D+I*A,f[2]=E*-A+x*D,f[3]=R*-A+I*D,f},Gt.scale=function(f,b,S){var E=b[1],R=b[2],x=b[3],I=S[0],A=S[1];return f[0]=b[0]*I,f[1]=E*I,f[2]=R*A,f[3]=x*A,f},Gt.fromRotation=function(f,b){var S=Math.sin(b),E=Math.cos(b);return f[0]=E,f[1]=S,f[2]=-S,f[3]=E,f},Gt.fromScaling=function(f,b){return f[0]=b[0],f[1]=0,f[2]=0,f[3]=b[1],f},Gt.str=function(f){return"mat2("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"},Gt.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3])},Gt.LDU=function(f,b,S,E){return f[2]=E[2]/E[0],S[0]=E[0],S[1]=E[1],S[3]=E[3]-f[2]*S[1],[f,b,S]},Gt.add=function(f,b,S){return f[0]=b[0]+S[0],f[1]=b[1]+S[1],f[2]=b[2]+S[2],f[3]=b[3]+S[3],f},Gt.subtract=_,Gt.exactEquals=function(f,b){return f[0]===b[0]&&f[1]===b[1]&&f[2]===b[2]&&f[3]===b[3]},Gt.equals=function(f,b){var S=f[0],E=f[1],R=f[2],x=f[3],I=b[0],A=b[1],D=b[2],M=b[3];return Math.abs(S-I)<=o.EPSILON*Math.max(1,Math.abs(S),Math.abs(I))&&Math.abs(E-A)<=o.EPSILON*Math.max(1,Math.abs(E),Math.abs(A))&&Math.abs(R-D)<=o.EPSILON*Math.max(1,Math.abs(R),Math.abs(D))&&Math.abs(x-M)<=o.EPSILON*Math.max(1,Math.abs(x),Math.abs(M))},Gt.multiplyScalar=function(f,b,S){return f[0]=b[0]*S,f[1]=b[1]*S,f[2]=b[2]*S,f[3]=b[3]*S,f},Gt.multiplyScalarAndAdd=function(f,b,S,E){return f[0]=b[0]+S[0]*E,f[1]=b[1]+S[1]*E,f[2]=b[2]+S[2]*E,f[3]=b[3]+S[3]*E,f},Gt.sub=Gt.mul=void 0;var o=function(f,b){if(f&&f.__esModule)return f;if(null===f||"object"!==u(f)&&"function"!=typeof f)return{default:f};var S=l(void 0);if(S&&S.has(f))return S.get(f);var E={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in f)if("default"!==x&&Object.prototype.hasOwnProperty.call(f,x)){var I=R?Object.getOwnPropertyDescriptor(f,x):null;I&&(I.get||I.set)?Object.defineProperty(E,x,I):E[x]=f[x]}return E.default=f,S&&S.set(f,E),E}(zt());function l(f){if("function"!=typeof WeakMap)return null;var b=new WeakMap,S=new WeakMap;return(l=function(E){return E?S:b})(f)}function h(f,b,S){var E=b[0],R=b[1],x=b[2],I=b[3],A=S[0],D=S[1],M=S[2],L=S[3];return f[0]=E*A+x*D,f[1]=R*A+I*D,f[2]=E*M+x*L,f[3]=R*M+I*L,f}function _(f,b,S){return f[0]=b[0]-S[0],f[1]=b[1]-S[1],f[2]=b[2]-S[2],f[3]=b[3]-S[3],f}return Gt.mul=h,Gt.sub=_,Gt}var dt,Mt={};function bn(){if(dt)return Mt;function u(f){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b})(f)}dt=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=function(){var f=new o.ARRAY_TYPE(6);return o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[4]=0,f[5]=0),f[0]=1,f[3]=1,f},Mt.clone=function(f){var b=new o.ARRAY_TYPE(6);return b[0]=f[0],b[1]=f[1],b[2]=f[2],b[3]=f[3],b[4]=f[4],b[5]=f[5],b},Mt.copy=function(f,b){return f[0]=b[0],f[1]=b[1],f[2]=b[2],f[3]=b[3],f[4]=b[4],f[5]=b[5],f},Mt.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=0,f[5]=0,f},Mt.fromValues=function(f,b,S,E,R,x){var I=new o.ARRAY_TYPE(6);return I[0]=f,I[1]=b,I[2]=S,I[3]=E,I[4]=R,I[5]=x,I},Mt.set=function(f,b,S,E,R,x,I){return f[0]=b,f[1]=S,f[2]=E,f[3]=R,f[4]=x,f[5]=I,f},Mt.invert=function(f,b){var S=b[0],E=b[1],R=b[2],x=b[3],I=b[4],A=b[5],D=S*x-E*R;return D?(f[0]=x*(D=1/D),f[1]=-E*D,f[2]=-R*D,f[3]=S*D,f[4]=(R*A-x*I)*D,f[5]=(E*I-S*A)*D,f):null},Mt.determinant=function(f){return f[0]*f[3]-f[1]*f[2]},Mt.multiply=h,Mt.rotate=function(f,b,S){var E=b[0],R=b[1],x=b[2],I=b[3],A=b[4],D=b[5],M=Math.sin(S),L=Math.cos(S);return f[0]=E*L+x*M,f[1]=R*L+I*M,f[2]=E*-M+x*L,f[3]=R*-M+I*L,f[4]=A,f[5]=D,f},Mt.scale=function(f,b,S){var E=b[1],R=b[2],x=b[3],I=b[4],A=b[5],D=S[0],M=S[1];return f[0]=b[0]*D,f[1]=E*D,f[2]=R*M,f[3]=x*M,f[4]=I,f[5]=A,f},Mt.translate=function(f,b,S){var E=b[0],R=b[1],x=b[2],I=b[3],A=b[4],D=b[5],M=S[0],L=S[1];return f[0]=E,f[1]=R,f[2]=x,f[3]=I,f[4]=E*M+x*L+A,f[5]=R*M+I*L+D,f},Mt.fromRotation=function(f,b){var S=Math.sin(b),E=Math.cos(b);return f[0]=E,f[1]=S,f[2]=-S,f[3]=E,f[4]=0,f[5]=0,f},Mt.fromScaling=function(f,b){return f[0]=b[0],f[1]=0,f[2]=0,f[3]=b[1],f[4]=0,f[5]=0,f},Mt.fromTranslation=function(f,b){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=b[0],f[5]=b[1],f},Mt.str=function(f){return"mat2d("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+")"},Mt.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],1)},Mt.add=function(f,b,S){return f[0]=b[0]+S[0],f[1]=b[1]+S[1],f[2]=b[2]+S[2],f[3]=b[3]+S[3],f[4]=b[4]+S[4],f[5]=b[5]+S[5],f},Mt.subtract=_,Mt.multiplyScalar=function(f,b,S){return f[0]=b[0]*S,f[1]=b[1]*S,f[2]=b[2]*S,f[3]=b[3]*S,f[4]=b[4]*S,f[5]=b[5]*S,f},Mt.multiplyScalarAndAdd=function(f,b,S,E){return f[0]=b[0]+S[0]*E,f[1]=b[1]+S[1]*E,f[2]=b[2]+S[2]*E,f[3]=b[3]+S[3]*E,f[4]=b[4]+S[4]*E,f[5]=b[5]+S[5]*E,f},Mt.exactEquals=function(f,b){return f[0]===b[0]&&f[1]===b[1]&&f[2]===b[2]&&f[3]===b[3]&&f[4]===b[4]&&f[5]===b[5]},Mt.equals=function(f,b){var S=f[0],E=f[1],R=f[2],x=f[3],I=f[4],A=f[5],D=b[0],M=b[1],L=b[2],N=b[3],V=b[4],q=b[5];return Math.abs(S-D)<=o.EPSILON*Math.max(1,Math.abs(S),Math.abs(D))&&Math.abs(E-M)<=o.EPSILON*Math.max(1,Math.abs(E),Math.abs(M))&&Math.abs(R-L)<=o.EPSILON*Math.max(1,Math.abs(R),Math.abs(L))&&Math.abs(x-N)<=o.EPSILON*Math.max(1,Math.abs(x),Math.abs(N))&&Math.abs(I-V)<=o.EPSILON*Math.max(1,Math.abs(I),Math.abs(V))&&Math.abs(A-q)<=o.EPSILON*Math.max(1,Math.abs(A),Math.abs(q))},Mt.sub=Mt.mul=void 0;var o=function(f,b){if(f&&f.__esModule)return f;if(null===f||"object"!==u(f)&&"function"!=typeof f)return{default:f};var S=l(void 0);if(S&&S.has(f))return S.get(f);var E={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in f)if("default"!==x&&Object.prototype.hasOwnProperty.call(f,x)){var I=R?Object.getOwnPropertyDescriptor(f,x):null;I&&(I.get||I.set)?Object.defineProperty(E,x,I):E[x]=f[x]}return E.default=f,S&&S.set(f,E),E}(zt());function l(f){if("function"!=typeof WeakMap)return null;var b=new WeakMap,S=new WeakMap;return(l=function(E){return E?S:b})(f)}function h(f,b,S){var E=b[0],R=b[1],x=b[2],I=b[3],A=b[4],D=b[5],M=S[0],L=S[1],N=S[2],V=S[3],q=S[4],$=S[5];return f[0]=E*M+x*L,f[1]=R*M+I*L,f[2]=E*N+x*V,f[3]=R*N+I*V,f[4]=E*q+x*$+A,f[5]=R*q+I*$+D,f}function _(f,b,S){return f[0]=b[0]-S[0],f[1]=b[1]-S[1],f[2]=b[2]-S[2],f[3]=b[3]-S[3],f[4]=b[4]-S[4],f[5]=b[5]-S[5],f}return Mt.mul=h,Mt.sub=_,Mt}var Jn,yn={};function Bt(){if(Jn)return yn;function u(f){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b})(f)}Jn=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.create=function(){var f=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f},yn.fromMat4=function(f,b){return f[0]=b[0],f[1]=b[1],f[2]=b[2],f[3]=b[4],f[4]=b[5],f[5]=b[6],f[6]=b[8],f[7]=b[9],f[8]=b[10],f},yn.clone=function(f){var b=new o.ARRAY_TYPE(9);return b[0]=f[0],b[1]=f[1],b[2]=f[2],b[3]=f[3],b[4]=f[4],b[5]=f[5],b[6]=f[6],b[7]=f[7],b[8]=f[8],b},yn.copy=function(f,b){return f[0]=b[0],f[1]=b[1],f[2]=b[2],f[3]=b[3],f[4]=b[4],f[5]=b[5],f[6]=b[6],f[7]=b[7],f[8]=b[8],f},yn.fromValues=function(f,b,S,E,R,x,I,A,D){var M=new o.ARRAY_TYPE(9);return M[0]=f,M[1]=b,M[2]=S,M[3]=E,M[4]=R,M[5]=x,M[6]=I,M[7]=A,M[8]=D,M},yn.set=function(f,b,S,E,R,x,I,A,D,M){return f[0]=b,f[1]=S,f[2]=E,f[3]=R,f[4]=x,f[5]=I,f[6]=A,f[7]=D,f[8]=M,f},yn.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},yn.transpose=function(f,b){if(f===b){var S=b[1],E=b[2],R=b[5];f[1]=b[3],f[2]=b[6],f[3]=S,f[5]=b[7],f[6]=E,f[7]=R}else f[0]=b[0],f[1]=b[3],f[2]=b[6],f[3]=b[1],f[4]=b[4],f[5]=b[7],f[6]=b[2],f[7]=b[5],f[8]=b[8];return f},yn.invert=function(f,b){var S=b[0],E=b[1],R=b[2],x=b[3],I=b[4],A=b[5],D=b[6],M=b[7],L=b[8],N=L*I-A*M,V=-L*x+A*D,q=M*x-I*D,$=S*N+E*V+R*q;return $?(f[0]=N*($=1/$),f[1]=(-L*E+R*M)*$,f[2]=(A*E-R*I)*$,f[3]=V*$,f[4]=(L*S-R*D)*$,f[5]=(-A*S+R*x)*$,f[6]=q*$,f[7]=(-M*S+E*D)*$,f[8]=(I*S-E*x)*$,f):null},yn.adjoint=function(f,b){var S=b[0],E=b[1],R=b[2],x=b[3],I=b[4],A=b[5],D=b[6],M=b[7],L=b[8];return f[0]=I*L-A*M,f[1]=R*M-E*L,f[2]=E*A-R*I,f[3]=A*D-x*L,f[4]=S*L-R*D,f[5]=R*x-S*A,f[6]=x*M-I*D,f[7]=E*D-S*M,f[8]=S*I-E*x,f},yn.determinant=function(f){var b=f[3],S=f[4],E=f[5],R=f[6],x=f[7],I=f[8];return f[0]*(I*S-E*x)+f[1]*(-I*b+E*R)+f[2]*(x*b-S*R)},yn.multiply=h,yn.translate=function(f,b,S){var E=b[0],R=b[1],x=b[2],I=b[3],A=b[4],D=b[5],M=b[6],L=b[7],N=b[8],V=S[0],q=S[1];return f[0]=E,f[1]=R,f[2]=x,f[3]=I,f[4]=A,f[5]=D,f[6]=V*E+q*I+M,f[7]=V*R+q*A+L,f[8]=V*x+q*D+N,f},yn.rotate=function(f,b,S){var E=b[0],R=b[1],x=b[2],I=b[3],A=b[4],D=b[5],M=b[6],L=b[7],N=b[8],V=Math.sin(S),q=Math.cos(S);return f[0]=q*E+V*I,f[1]=q*R+V*A,f[2]=q*x+V*D,f[3]=q*I-V*E,f[4]=q*A-V*R,f[5]=q*D-V*x,f[6]=M,f[7]=L,f[8]=N,f},yn.scale=function(f,b,S){var E=S[0],R=S[1];return f[0]=E*b[0],f[1]=E*b[1],f[2]=E*b[2],f[3]=R*b[3],f[4]=R*b[4],f[5]=R*b[5],f[6]=b[6],f[7]=b[7],f[8]=b[8],f},yn.fromTranslation=function(f,b){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=b[0],f[7]=b[1],f[8]=1,f},yn.fromRotation=function(f,b){var S=Math.sin(b),E=Math.cos(b);return f[0]=E,f[1]=S,f[2]=0,f[3]=-S,f[4]=E,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},yn.fromScaling=function(f,b){return f[0]=b[0],f[1]=0,f[2]=0,f[3]=0,f[4]=b[1],f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},yn.fromMat2d=function(f,b){return f[0]=b[0],f[1]=b[1],f[2]=0,f[3]=b[2],f[4]=b[3],f[5]=0,f[6]=b[4],f[7]=b[5],f[8]=1,f},yn.fromQuat=function(f,b){var S=b[0],E=b[1],R=b[2],x=b[3],I=S+S,A=E+E,D=R+R,M=S*I,L=E*I,N=E*A,V=R*I,q=R*A,$=R*D,U=x*I,Z=x*A,Y=x*D;return f[0]=1-N-$,f[3]=L-Y,f[6]=V+Z,f[1]=L+Y,f[4]=1-M-$,f[7]=q-U,f[2]=V-Z,f[5]=q+U,f[8]=1-M-N,f},yn.normalFromMat4=function(f,b){var S=b[0],E=b[1],R=b[2],x=b[3],I=b[4],A=b[5],D=b[6],M=b[7],L=b[8],N=b[9],V=b[10],q=b[11],$=b[12],U=b[13],Z=b[14],Y=b[15],se=S*A-E*I,ve=S*D-R*I,W=S*M-x*I,ce=E*D-R*A,Se=E*M-x*A,me=R*M-x*D,Me=L*U-N*$,Ne=L*Z-V*$,ze=L*Y-q*$,$e=N*Z-V*U,nt=N*Y-q*U,st=V*Y-q*Z,Je=se*st-ve*nt+W*$e+ce*ze-Se*Ne+me*Me;return Je?(f[0]=(A*st-D*nt+M*$e)*(Je=1/Je),f[1]=(D*ze-I*st-M*Ne)*Je,f[2]=(I*nt-A*ze+M*Me)*Je,f[3]=(R*nt-E*st-x*$e)*Je,f[4]=(S*st-R*ze+x*Ne)*Je,f[5]=(E*ze-S*nt-x*Me)*Je,f[6]=(U*me-Z*Se+Y*ce)*Je,f[7]=(Z*W-$*me-Y*ve)*Je,f[8]=($*Se-U*W+Y*se)*Je,f):null},yn.projection=function(f,b,S){return f[0]=2/b,f[1]=0,f[2]=0,f[3]=0,f[4]=-2/S,f[5]=0,f[6]=-1,f[7]=1,f[8]=1,f},yn.str=function(f){return"mat3("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+")"},yn.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8])},yn.add=function(f,b,S){return f[0]=b[0]+S[0],f[1]=b[1]+S[1],f[2]=b[2]+S[2],f[3]=b[3]+S[3],f[4]=b[4]+S[4],f[5]=b[5]+S[5],f[6]=b[6]+S[6],f[7]=b[7]+S[7],f[8]=b[8]+S[8],f},yn.subtract=_,yn.multiplyScalar=function(f,b,S){return f[0]=b[0]*S,f[1]=b[1]*S,f[2]=b[2]*S,f[3]=b[3]*S,f[4]=b[4]*S,f[5]=b[5]*S,f[6]=b[6]*S,f[7]=b[7]*S,f[8]=b[8]*S,f},yn.multiplyScalarAndAdd=function(f,b,S,E){return f[0]=b[0]+S[0]*E,f[1]=b[1]+S[1]*E,f[2]=b[2]+S[2]*E,f[3]=b[3]+S[3]*E,f[4]=b[4]+S[4]*E,f[5]=b[5]+S[5]*E,f[6]=b[6]+S[6]*E,f[7]=b[7]+S[7]*E,f[8]=b[8]+S[8]*E,f},yn.exactEquals=function(f,b){return f[0]===b[0]&&f[1]===b[1]&&f[2]===b[2]&&f[3]===b[3]&&f[4]===b[4]&&f[5]===b[5]&&f[6]===b[6]&&f[7]===b[7]&&f[8]===b[8]},yn.equals=function(f,b){var S=f[0],E=f[1],R=f[2],x=f[3],I=f[4],A=f[5],D=f[6],M=f[7],L=f[8],N=b[0],V=b[1],q=b[2],$=b[3],U=b[4],Z=b[5],Y=b[6],se=b[7],ve=b[8];return Math.abs(S-N)<=o.EPSILON*Math.max(1,Math.abs(S),Math.abs(N))&&Math.abs(E-V)<=o.EPSILON*Math.max(1,Math.abs(E),Math.abs(V))&&Math.abs(R-q)<=o.EPSILON*Math.max(1,Math.abs(R),Math.abs(q))&&Math.abs(x-$)<=o.EPSILON*Math.max(1,Math.abs(x),Math.abs($))&&Math.abs(I-U)<=o.EPSILON*Math.max(1,Math.abs(I),Math.abs(U))&&Math.abs(A-Z)<=o.EPSILON*Math.max(1,Math.abs(A),Math.abs(Z))&&Math.abs(D-Y)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(Y))&&Math.abs(M-se)<=o.EPSILON*Math.max(1,Math.abs(M),Math.abs(se))&&Math.abs(L-ve)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(ve))},yn.sub=yn.mul=void 0;var o=function(f,b){if(f&&f.__esModule)return f;if(null===f||"object"!==u(f)&&"function"!=typeof f)return{default:f};var S=l(void 0);if(S&&S.has(f))return S.get(f);var E={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in f)if("default"!==x&&Object.prototype.hasOwnProperty.call(f,x)){var I=R?Object.getOwnPropertyDescriptor(f,x):null;I&&(I.get||I.set)?Object.defineProperty(E,x,I):E[x]=f[x]}return E.default=f,S&&S.set(f,E),E}(zt());function l(f){if("function"!=typeof WeakMap)return null;var b=new WeakMap,S=new WeakMap;return(l=function(E){return E?S:b})(f)}function h(f,b,S){var E=b[0],R=b[1],x=b[2],I=b[3],A=b[4],D=b[5],M=b[6],L=b[7],N=b[8],V=S[0],q=S[1],$=S[2],U=S[3],Z=S[4],Y=S[5],se=S[6],ve=S[7],W=S[8];return f[0]=V*E+q*I+$*M,f[1]=V*R+q*A+$*L,f[2]=V*x+q*D+$*N,f[3]=U*E+Z*I+Y*M,f[4]=U*R+Z*A+Y*L,f[5]=U*x+Z*D+Y*N,f[6]=se*E+ve*I+W*M,f[7]=se*R+ve*A+W*L,f[8]=se*x+ve*D+W*N,f}function _(f,b,S){return f[0]=b[0]-S[0],f[1]=b[1]-S[1],f[2]=b[2]-S[2],f[3]=b[3]-S[3],f[4]=b[4]-S[4],f[5]=b[5]-S[5],f[6]=b[6]-S[6],f[7]=b[7]-S[7],f[8]=b[8]-S[8],f}return yn.mul=h,yn.sub=_,yn}var Rn,Re={};function qe(){if(Rn)return Re;function u(x){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I})(x)}Rn=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.create=function(){var x=new o.ARRAY_TYPE(16);return o.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},Re.clone=function(x){var I=new o.ARRAY_TYPE(16);return I[0]=x[0],I[1]=x[1],I[2]=x[2],I[3]=x[3],I[4]=x[4],I[5]=x[5],I[6]=x[6],I[7]=x[7],I[8]=x[8],I[9]=x[9],I[10]=x[10],I[11]=x[11],I[12]=x[12],I[13]=x[13],I[14]=x[14],I[15]=x[15],I},Re.copy=function(x,I){return x[0]=I[0],x[1]=I[1],x[2]=I[2],x[3]=I[3],x[4]=I[4],x[5]=I[5],x[6]=I[6],x[7]=I[7],x[8]=I[8],x[9]=I[9],x[10]=I[10],x[11]=I[11],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15],x},Re.fromValues=function(x,I,A,D,M,L,N,V,q,$,U,Z,Y,se,ve,W){var ce=new o.ARRAY_TYPE(16);return ce[0]=x,ce[1]=I,ce[2]=A,ce[3]=D,ce[4]=M,ce[5]=L,ce[6]=N,ce[7]=V,ce[8]=q,ce[9]=$,ce[10]=U,ce[11]=Z,ce[12]=Y,ce[13]=se,ce[14]=ve,ce[15]=W,ce},Re.set=function(x,I,A,D,M,L,N,V,q,$,U,Z,Y,se,ve,W,ce){return x[0]=I,x[1]=A,x[2]=D,x[3]=M,x[4]=L,x[5]=N,x[6]=V,x[7]=q,x[8]=$,x[9]=U,x[10]=Z,x[11]=Y,x[12]=se,x[13]=ve,x[14]=W,x[15]=ce,x},Re.identity=h,Re.transpose=function(x,I){if(x===I){var A=I[1],D=I[2],M=I[3],L=I[6],N=I[7],V=I[11];x[1]=I[4],x[2]=I[8],x[3]=I[12],x[4]=A,x[6]=I[9],x[7]=I[13],x[8]=D,x[9]=L,x[11]=I[14],x[12]=M,x[13]=N,x[14]=V}else x[0]=I[0],x[1]=I[4],x[2]=I[8],x[3]=I[12],x[4]=I[1],x[5]=I[5],x[6]=I[9],x[7]=I[13],x[8]=I[2],x[9]=I[6],x[10]=I[10],x[11]=I[14],x[12]=I[3],x[13]=I[7],x[14]=I[11],x[15]=I[15];return x},Re.invert=function(x,I){var A=I[0],D=I[1],M=I[2],L=I[3],N=I[4],V=I[5],q=I[6],$=I[7],U=I[8],Z=I[9],Y=I[10],se=I[11],ve=I[12],W=I[13],ce=I[14],Se=I[15],me=A*V-D*N,Me=A*q-M*N,Ne=A*$-L*N,ze=D*q-M*V,$e=D*$-L*V,nt=M*$-L*q,st=U*W-Z*ve,Je=U*ce-Y*ve,St=U*Se-se*ve,$t=Z*ce-Y*W,gt=Z*Se-se*W,gn=Y*Se-se*ce,on=me*gn-Me*gt+Ne*$t+ze*St-$e*Je+nt*st;return on?(x[0]=(V*gn-q*gt+$*$t)*(on=1/on),x[1]=(M*gt-D*gn-L*$t)*on,x[2]=(W*nt-ce*$e+Se*ze)*on,x[3]=(Y*$e-Z*nt-se*ze)*on,x[4]=(q*St-N*gn-$*Je)*on,x[5]=(A*gn-M*St+L*Je)*on,x[6]=(ce*Ne-ve*nt-Se*Me)*on,x[7]=(U*nt-Y*Ne+se*Me)*on,x[8]=(N*gt-V*St+$*st)*on,x[9]=(D*St-A*gt-L*st)*on,x[10]=(ve*$e-W*Ne+Se*me)*on,x[11]=(Z*Ne-U*$e-se*me)*on,x[12]=(V*Je-N*$t-q*st)*on,x[13]=(A*$t-D*Je+M*st)*on,x[14]=(W*Me-ve*ze-ce*me)*on,x[15]=(U*ze-Z*Me+Y*me)*on,x):null},Re.adjoint=function(x,I){var A=I[0],D=I[1],M=I[2],L=I[3],N=I[4],V=I[5],q=I[6],$=I[7],U=I[8],Z=I[9],Y=I[10],se=I[11],ve=I[12],W=I[13],ce=I[14],Se=I[15];return x[0]=V*(Y*Se-se*ce)-Z*(q*Se-$*ce)+W*(q*se-$*Y),x[1]=-(D*(Y*Se-se*ce)-Z*(M*Se-L*ce)+W*(M*se-L*Y)),x[2]=D*(q*Se-$*ce)-V*(M*Se-L*ce)+W*(M*$-L*q),x[3]=-(D*(q*se-$*Y)-V*(M*se-L*Y)+Z*(M*$-L*q)),x[4]=-(N*(Y*Se-se*ce)-U*(q*Se-$*ce)+ve*(q*se-$*Y)),x[5]=A*(Y*Se-se*ce)-U*(M*Se-L*ce)+ve*(M*se-L*Y),x[6]=-(A*(q*Se-$*ce)-N*(M*Se-L*ce)+ve*(M*$-L*q)),x[7]=A*(q*se-$*Y)-N*(M*se-L*Y)+U*(M*$-L*q),x[8]=N*(Z*Se-se*W)-U*(V*Se-$*W)+ve*(V*se-$*Z),x[9]=-(A*(Z*Se-se*W)-U*(D*Se-L*W)+ve*(D*se-L*Z)),x[10]=A*(V*Se-$*W)-N*(D*Se-L*W)+ve*(D*$-L*V),x[11]=-(A*(V*se-$*Z)-N*(D*se-L*Z)+U*(D*$-L*V)),x[12]=-(N*(Z*ce-Y*W)-U*(V*ce-q*W)+ve*(V*Y-q*Z)),x[13]=A*(Z*ce-Y*W)-U*(D*ce-M*W)+ve*(D*Y-M*Z),x[14]=-(A*(V*ce-q*W)-N*(D*ce-M*W)+ve*(D*q-M*V)),x[15]=A*(V*Y-q*Z)-N*(D*Y-M*Z)+U*(D*q-M*V),x},Re.determinant=function(x){var I=x[0],A=x[1],D=x[2],M=x[3],L=x[4],N=x[5],V=x[6],q=x[7],$=x[8],U=x[9],Z=x[10],Y=x[11],se=x[12],ve=x[13],W=x[14],ce=x[15];return(I*N-A*L)*(Z*ce-Y*W)-(I*V-D*L)*(U*ce-Y*ve)+(I*q-M*L)*(U*W-Z*ve)+(A*V-D*N)*($*ce-Y*se)-(A*q-M*N)*($*W-Z*se)+(D*q-M*V)*($*ve-U*se)},Re.multiply=_,Re.translate=function(x,I,A){var D,M,L,N,V,q,$,U,Z,Y,se,ve,W=A[0],ce=A[1],Se=A[2];return I===x?(x[12]=I[0]*W+I[4]*ce+I[8]*Se+I[12],x[13]=I[1]*W+I[5]*ce+I[9]*Se+I[13],x[14]=I[2]*W+I[6]*ce+I[10]*Se+I[14],x[15]=I[3]*W+I[7]*ce+I[11]*Se+I[15]):(M=I[1],L=I[2],N=I[3],V=I[4],q=I[5],$=I[6],U=I[7],Z=I[8],Y=I[9],se=I[10],ve=I[11],x[0]=D=I[0],x[1]=M,x[2]=L,x[3]=N,x[4]=V,x[5]=q,x[6]=$,x[7]=U,x[8]=Z,x[9]=Y,x[10]=se,x[11]=ve,x[12]=D*W+V*ce+Z*Se+I[12],x[13]=M*W+q*ce+Y*Se+I[13],x[14]=L*W+$*ce+se*Se+I[14],x[15]=N*W+U*ce+ve*Se+I[15]),x},Re.scale=function(x,I,A){var D=A[0],M=A[1],L=A[2];return x[0]=I[0]*D,x[1]=I[1]*D,x[2]=I[2]*D,x[3]=I[3]*D,x[4]=I[4]*M,x[5]=I[5]*M,x[6]=I[6]*M,x[7]=I[7]*M,x[8]=I[8]*L,x[9]=I[9]*L,x[10]=I[10]*L,x[11]=I[11]*L,x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15],x},Re.rotate=function(x,I,A,D){var M,L,N,V,q,$,U,Z,Y,se,ve,W,ce,Se,me,Me,Ne,ze,$e,nt,st,Je,St,$t,gt=D[0],gn=D[1],on=D[2],Kt=Math.hypot(gt,gn,on);return Kt<o.EPSILON?null:(gt*=Kt=1/Kt,gn*=Kt,on*=Kt,M=Math.sin(A),L=Math.cos(A),q=I[1],$=I[2],U=I[3],Y=I[5],se=I[6],ve=I[7],ce=I[9],Se=I[10],me=I[11],Me=gt*gt*(N=1-L)+L,$e=gt*gn*N-on*M,nt=gn*gn*N+L,st=on*gn*N+gt*M,Je=gt*on*N+gn*M,St=gn*on*N-gt*M,$t=on*on*N+L,x[0]=(V=I[0])*Me+(Z=I[4])*(Ne=gn*gt*N+on*M)+(W=I[8])*(ze=on*gt*N-gn*M),x[1]=q*Me+Y*Ne+ce*ze,x[2]=$*Me+se*Ne+Se*ze,x[3]=U*Me+ve*Ne+me*ze,x[4]=V*$e+Z*nt+W*st,x[5]=q*$e+Y*nt+ce*st,x[6]=$*$e+se*nt+Se*st,x[7]=U*$e+ve*nt+me*st,x[8]=V*Je+Z*St+W*$t,x[9]=q*Je+Y*St+ce*$t,x[10]=$*Je+se*St+Se*$t,x[11]=U*Je+ve*St+me*$t,I!==x&&(x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x)},Re.rotateX=function(x,I,A){var D=Math.sin(A),M=Math.cos(A),L=I[4],N=I[5],V=I[6],q=I[7],$=I[8],U=I[9],Z=I[10],Y=I[11];return I!==x&&(x[0]=I[0],x[1]=I[1],x[2]=I[2],x[3]=I[3],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x[4]=L*M+$*D,x[5]=N*M+U*D,x[6]=V*M+Z*D,x[7]=q*M+Y*D,x[8]=$*M-L*D,x[9]=U*M-N*D,x[10]=Z*M-V*D,x[11]=Y*M-q*D,x},Re.rotateY=function(x,I,A){var D=Math.sin(A),M=Math.cos(A),L=I[0],N=I[1],V=I[2],q=I[3],$=I[8],U=I[9],Z=I[10],Y=I[11];return I!==x&&(x[4]=I[4],x[5]=I[5],x[6]=I[6],x[7]=I[7],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x[0]=L*M-$*D,x[1]=N*M-U*D,x[2]=V*M-Z*D,x[3]=q*M-Y*D,x[8]=L*D+$*M,x[9]=N*D+U*M,x[10]=V*D+Z*M,x[11]=q*D+Y*M,x},Re.rotateZ=function(x,I,A){var D=Math.sin(A),M=Math.cos(A),L=I[0],N=I[1],V=I[2],q=I[3],$=I[4],U=I[5],Z=I[6],Y=I[7];return I!==x&&(x[8]=I[8],x[9]=I[9],x[10]=I[10],x[11]=I[11],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x[0]=L*M+$*D,x[1]=N*M+U*D,x[2]=V*M+Z*D,x[3]=q*M+Y*D,x[4]=$*M-L*D,x[5]=U*M-N*D,x[6]=Z*M-V*D,x[7]=Y*M-q*D,x},Re.fromTranslation=function(x,I){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=I[0],x[13]=I[1],x[14]=I[2],x[15]=1,x},Re.fromScaling=function(x,I){return x[0]=I[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=I[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=I[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Re.fromRotation=function(x,I,A){var D,M,L,N=A[0],V=A[1],q=A[2],$=Math.hypot(N,V,q);return $<o.EPSILON?null:(N*=$=1/$,V*=$,q*=$,D=Math.sin(I),M=Math.cos(I),x[0]=N*N*(L=1-M)+M,x[1]=V*N*L+q*D,x[2]=q*N*L-V*D,x[3]=0,x[4]=N*V*L-q*D,x[5]=V*V*L+M,x[6]=q*V*L+N*D,x[7]=0,x[8]=N*q*L+V*D,x[9]=V*q*L-N*D,x[10]=q*q*L+M,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},Re.fromXRotation=function(x,I){var A=Math.sin(I),D=Math.cos(I);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=D,x[6]=A,x[7]=0,x[8]=0,x[9]=-A,x[10]=D,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Re.fromYRotation=function(x,I){var A=Math.sin(I),D=Math.cos(I);return x[0]=D,x[1]=0,x[2]=-A,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=A,x[9]=0,x[10]=D,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Re.fromZRotation=function(x,I){var A=Math.sin(I),D=Math.cos(I);return x[0]=D,x[1]=A,x[2]=0,x[3]=0,x[4]=-A,x[5]=D,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Re.fromRotationTranslation=f,Re.fromQuat2=function(x,I){var A=new o.ARRAY_TYPE(3),D=-I[0],M=-I[1],L=-I[2],N=I[3],V=I[4],q=I[5],$=I[6],U=I[7],Z=D*D+M*M+L*L+N*N;return Z>0?(A[0]=2*(V*N+U*D+q*L-$*M)/Z,A[1]=2*(q*N+U*M+$*D-V*L)/Z,A[2]=2*($*N+U*L+V*M-q*D)/Z):(A[0]=2*(V*N+U*D+q*L-$*M),A[1]=2*(q*N+U*M+$*D-V*L),A[2]=2*($*N+U*L+V*M-q*D)),f(x,I,A),x},Re.getTranslation=function(x,I){return x[0]=I[12],x[1]=I[13],x[2]=I[14],x},Re.getScaling=b,Re.getRotation=function(x,I){var A=new o.ARRAY_TYPE(3);b(A,I);var D=1/A[0],M=1/A[1],L=1/A[2],N=I[0]*D,V=I[1]*M,q=I[2]*L,$=I[4]*D,U=I[5]*M,Z=I[6]*L,Y=I[8]*D,se=I[9]*M,ve=I[10]*L,W=N+U+ve,ce=0;return W>0?(ce=2*Math.sqrt(W+1),x[3]=.25*ce,x[0]=(Z-se)/ce,x[1]=(Y-q)/ce,x[2]=(V-$)/ce):N>U&&N>ve?(ce=2*Math.sqrt(1+N-U-ve),x[3]=(Z-se)/ce,x[0]=.25*ce,x[1]=(V+$)/ce,x[2]=(Y+q)/ce):U>ve?(ce=2*Math.sqrt(1+U-N-ve),x[3]=(Y-q)/ce,x[0]=(V+$)/ce,x[1]=.25*ce,x[2]=(Z+se)/ce):(ce=2*Math.sqrt(1+ve-N-U),x[3]=(V-$)/ce,x[0]=(Y+q)/ce,x[1]=(Z+se)/ce,x[2]=.25*ce),x},Re.fromRotationTranslationScale=function(x,I,A,D){var M=I[0],L=I[1],N=I[2],V=I[3],q=M+M,$=L+L,U=N+N,Z=M*q,Y=M*$,se=M*U,ve=L*$,W=L*U,ce=N*U,Se=V*q,me=V*$,Me=V*U,Ne=D[0],ze=D[1],$e=D[2];return x[0]=(1-(ve+ce))*Ne,x[1]=(Y+Me)*Ne,x[2]=(se-me)*Ne,x[3]=0,x[4]=(Y-Me)*ze,x[5]=(1-(Z+ce))*ze,x[6]=(W+Se)*ze,x[7]=0,x[8]=(se+me)*$e,x[9]=(W-Se)*$e,x[10]=(1-(Z+ve))*$e,x[11]=0,x[12]=A[0],x[13]=A[1],x[14]=A[2],x[15]=1,x},Re.fromRotationTranslationScaleOrigin=function(x,I,A,D,M){var L=I[0],N=I[1],V=I[2],q=I[3],$=L+L,U=N+N,Z=V+V,Y=L*$,se=L*U,ve=L*Z,W=N*U,ce=N*Z,Se=V*Z,me=q*$,Me=q*U,Ne=q*Z,ze=D[0],$e=D[1],nt=D[2],st=M[0],Je=M[1],St=M[2],$t=(1-(W+Se))*ze,gt=(se+Ne)*ze,gn=(ve-Me)*ze,on=(se-Ne)*$e,Kt=(1-(Y+Se))*$e,Ht=(ce+me)*$e,Vn=(ve+Me)*nt,pn=(ce-me)*nt,Sn=(1-(Y+W))*nt;return x[0]=$t,x[1]=gt,x[2]=gn,x[3]=0,x[4]=on,x[5]=Kt,x[6]=Ht,x[7]=0,x[8]=Vn,x[9]=pn,x[10]=Sn,x[11]=0,x[12]=A[0]+st-($t*st+on*Je+Vn*St),x[13]=A[1]+Je-(gt*st+Kt*Je+pn*St),x[14]=A[2]+St-(gn*st+Ht*Je+Sn*St),x[15]=1,x},Re.fromQuat=function(x,I){var A=I[0],D=I[1],M=I[2],L=I[3],N=A+A,V=D+D,q=M+M,$=A*N,U=D*N,Z=D*V,Y=M*N,se=M*V,ve=M*q,W=L*N,ce=L*V,Se=L*q;return x[0]=1-Z-ve,x[1]=U+Se,x[2]=Y-ce,x[3]=0,x[4]=U-Se,x[5]=1-$-ve,x[6]=se+W,x[7]=0,x[8]=Y+ce,x[9]=se-W,x[10]=1-$-Z,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Re.frustum=function(x,I,A,D,M,L,N){var V=1/(A-I),q=1/(M-D),$=1/(L-N);return x[0]=2*L*V,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*L*q,x[6]=0,x[7]=0,x[8]=(A+I)*V,x[9]=(M+D)*q,x[10]=(N+L)*$,x[11]=-1,x[12]=0,x[13]=0,x[14]=N*L*2*$,x[15]=0,x},Re.perspectiveNO=S,Re.perspectiveZO=function(x,I,A,D,M){var L,N=1/Math.tan(I/2);return x[0]=N/A,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=N,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,null!=M&&M!==1/0?(x[10]=M*(L=1/(D-M)),x[14]=M*D*L):(x[10]=-1,x[14]=-D),x},Re.perspectiveFromFieldOfView=function(x,I,A,D){var M=Math.tan(I.upDegrees*Math.PI/180),L=Math.tan(I.downDegrees*Math.PI/180),N=Math.tan(I.leftDegrees*Math.PI/180),V=Math.tan(I.rightDegrees*Math.PI/180),q=2/(N+V),$=2/(M+L);return x[0]=q,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=$,x[6]=0,x[7]=0,x[8]=-(N-V)*q*.5,x[9]=(M-L)*$*.5,x[10]=D/(A-D),x[11]=-1,x[12]=0,x[13]=0,x[14]=D*A/(A-D),x[15]=0,x},Re.orthoNO=E,Re.orthoZO=function(x,I,A,D,M,L,N){var V=1/(I-A),q=1/(D-M),$=1/(L-N);return x[0]=-2*V,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*q,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=$,x[11]=0,x[12]=(I+A)*V,x[13]=(M+D)*q,x[14]=L*$,x[15]=1,x},Re.lookAt=function(x,I,A,D){var M,L,N,V,q,$,U,Z,Y,se,ve=I[0],W=I[1],ce=I[2],Se=D[0],me=D[1],Me=D[2],Ne=A[0],ze=A[1],$e=A[2];return Math.abs(ve-Ne)<o.EPSILON&&Math.abs(W-ze)<o.EPSILON&&Math.abs(ce-$e)<o.EPSILON?h(x):(U=ve-Ne,Z=W-ze,Y=ce-$e,M=me*(Y*=se=1/Math.hypot(U,Z,Y))-Me*(Z*=se),L=Me*(U*=se)-Se*Y,N=Se*Z-me*U,(se=Math.hypot(M,L,N))?(M*=se=1/se,L*=se,N*=se):(M=0,L=0,N=0),V=Z*N-Y*L,q=Y*M-U*N,$=U*L-Z*M,(se=Math.hypot(V,q,$))?(V*=se=1/se,q*=se,$*=se):(V=0,q=0,$=0),x[0]=M,x[1]=V,x[2]=U,x[3]=0,x[4]=L,x[5]=q,x[6]=Z,x[7]=0,x[8]=N,x[9]=$,x[10]=Y,x[11]=0,x[12]=-(M*ve+L*W+N*ce),x[13]=-(V*ve+q*W+$*ce),x[14]=-(U*ve+Z*W+Y*ce),x[15]=1,x)},Re.targetTo=function(x,I,A,D){var M=I[0],L=I[1],N=I[2],V=D[0],q=D[1],$=D[2],U=M-A[0],Z=L-A[1],Y=N-A[2],se=U*U+Z*Z+Y*Y;se>0&&(U*=se=1/Math.sqrt(se),Z*=se,Y*=se);var ve=q*Y-$*Z,W=$*U-V*Y,ce=V*Z-q*U;return(se=ve*ve+W*W+ce*ce)>0&&(ve*=se=1/Math.sqrt(se),W*=se,ce*=se),x[0]=ve,x[1]=W,x[2]=ce,x[3]=0,x[4]=Z*ce-Y*W,x[5]=Y*ve-U*ce,x[6]=U*W-Z*ve,x[7]=0,x[8]=U,x[9]=Z,x[10]=Y,x[11]=0,x[12]=M,x[13]=L,x[14]=N,x[15]=1,x},Re.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},Re.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},Re.add=function(x,I,A){return x[0]=I[0]+A[0],x[1]=I[1]+A[1],x[2]=I[2]+A[2],x[3]=I[3]+A[3],x[4]=I[4]+A[4],x[5]=I[5]+A[5],x[6]=I[6]+A[6],x[7]=I[7]+A[7],x[8]=I[8]+A[8],x[9]=I[9]+A[9],x[10]=I[10]+A[10],x[11]=I[11]+A[11],x[12]=I[12]+A[12],x[13]=I[13]+A[13],x[14]=I[14]+A[14],x[15]=I[15]+A[15],x},Re.subtract=R,Re.multiplyScalar=function(x,I,A){return x[0]=I[0]*A,x[1]=I[1]*A,x[2]=I[2]*A,x[3]=I[3]*A,x[4]=I[4]*A,x[5]=I[5]*A,x[6]=I[6]*A,x[7]=I[7]*A,x[8]=I[8]*A,x[9]=I[9]*A,x[10]=I[10]*A,x[11]=I[11]*A,x[12]=I[12]*A,x[13]=I[13]*A,x[14]=I[14]*A,x[15]=I[15]*A,x},Re.multiplyScalarAndAdd=function(x,I,A,D){return x[0]=I[0]+A[0]*D,x[1]=I[1]+A[1]*D,x[2]=I[2]+A[2]*D,x[3]=I[3]+A[3]*D,x[4]=I[4]+A[4]*D,x[5]=I[5]+A[5]*D,x[6]=I[6]+A[6]*D,x[7]=I[7]+A[7]*D,x[8]=I[8]+A[8]*D,x[9]=I[9]+A[9]*D,x[10]=I[10]+A[10]*D,x[11]=I[11]+A[11]*D,x[12]=I[12]+A[12]*D,x[13]=I[13]+A[13]*D,x[14]=I[14]+A[14]*D,x[15]=I[15]+A[15]*D,x},Re.exactEquals=function(x,I){return x[0]===I[0]&&x[1]===I[1]&&x[2]===I[2]&&x[3]===I[3]&&x[4]===I[4]&&x[5]===I[5]&&x[6]===I[6]&&x[7]===I[7]&&x[8]===I[8]&&x[9]===I[9]&&x[10]===I[10]&&x[11]===I[11]&&x[12]===I[12]&&x[13]===I[13]&&x[14]===I[14]&&x[15]===I[15]},Re.equals=function(x,I){var A=x[0],D=x[1],M=x[2],L=x[3],N=x[4],V=x[5],q=x[6],$=x[7],U=x[8],Z=x[9],Y=x[10],se=x[11],ve=x[12],W=x[13],ce=x[14],Se=x[15],me=I[0],Me=I[1],Ne=I[2],ze=I[3],$e=I[4],nt=I[5],st=I[6],Je=I[7],St=I[8],$t=I[9],gt=I[10],gn=I[11],on=I[12],Kt=I[13],Ht=I[14],Vn=I[15];return Math.abs(A-me)<=o.EPSILON*Math.max(1,Math.abs(A),Math.abs(me))&&Math.abs(D-Me)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(Me))&&Math.abs(M-Ne)<=o.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ne))&&Math.abs(L-ze)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(ze))&&Math.abs(N-$e)<=o.EPSILON*Math.max(1,Math.abs(N),Math.abs($e))&&Math.abs(V-nt)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(nt))&&Math.abs(q-st)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(st))&&Math.abs($-Je)<=o.EPSILON*Math.max(1,Math.abs($),Math.abs(Je))&&Math.abs(U-St)<=o.EPSILON*Math.max(1,Math.abs(U),Math.abs(St))&&Math.abs(Z-$t)<=o.EPSILON*Math.max(1,Math.abs(Z),Math.abs($t))&&Math.abs(Y-gt)<=o.EPSILON*Math.max(1,Math.abs(Y),Math.abs(gt))&&Math.abs(se-gn)<=o.EPSILON*Math.max(1,Math.abs(se),Math.abs(gn))&&Math.abs(ve-on)<=o.EPSILON*Math.max(1,Math.abs(ve),Math.abs(on))&&Math.abs(W-Kt)<=o.EPSILON*Math.max(1,Math.abs(W),Math.abs(Kt))&&Math.abs(ce-Ht)<=o.EPSILON*Math.max(1,Math.abs(ce),Math.abs(Ht))&&Math.abs(Se-Vn)<=o.EPSILON*Math.max(1,Math.abs(Se),Math.abs(Vn))},Re.sub=Re.mul=Re.ortho=Re.perspective=void 0;var o=function(x,I){if(x&&x.__esModule)return x;if(null===x||"object"!==u(x)&&"function"!=typeof x)return{default:x};var A=l(void 0);if(A&&A.has(x))return A.get(x);var D={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var L in x)if("default"!==L&&Object.prototype.hasOwnProperty.call(x,L)){var N=M?Object.getOwnPropertyDescriptor(x,L):null;N&&(N.get||N.set)?Object.defineProperty(D,L,N):D[L]=x[L]}return D.default=x,A&&A.set(x,D),D}(zt());function l(x){if("function"!=typeof WeakMap)return null;var I=new WeakMap,A=new WeakMap;return(l=function(D){return D?A:I})(x)}function h(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function _(x,I,A){var D=I[0],M=I[1],L=I[2],N=I[3],V=I[4],q=I[5],$=I[6],U=I[7],Z=I[8],Y=I[9],se=I[10],ve=I[11],W=I[12],ce=I[13],Se=I[14],me=I[15],Me=A[0],Ne=A[1],ze=A[2],$e=A[3];return x[0]=Me*D+Ne*V+ze*Z+$e*W,x[1]=Me*M+Ne*q+ze*Y+$e*ce,x[2]=Me*L+Ne*$+ze*se+$e*Se,x[3]=Me*N+Ne*U+ze*ve+$e*me,x[4]=(Me=A[4])*D+(Ne=A[5])*V+(ze=A[6])*Z+($e=A[7])*W,x[5]=Me*M+Ne*q+ze*Y+$e*ce,x[6]=Me*L+Ne*$+ze*se+$e*Se,x[7]=Me*N+Ne*U+ze*ve+$e*me,x[8]=(Me=A[8])*D+(Ne=A[9])*V+(ze=A[10])*Z+($e=A[11])*W,x[9]=Me*M+Ne*q+ze*Y+$e*ce,x[10]=Me*L+Ne*$+ze*se+$e*Se,x[11]=Me*N+Ne*U+ze*ve+$e*me,x[12]=(Me=A[12])*D+(Ne=A[13])*V+(ze=A[14])*Z+($e=A[15])*W,x[13]=Me*M+Ne*q+ze*Y+$e*ce,x[14]=Me*L+Ne*$+ze*se+$e*Se,x[15]=Me*N+Ne*U+ze*ve+$e*me,x}function f(x,I,A){var D=I[0],M=I[1],L=I[2],N=I[3],V=D+D,q=M+M,$=L+L,U=D*V,Z=D*q,Y=D*$,se=M*q,ve=M*$,W=L*$,ce=N*V,Se=N*q,me=N*$;return x[0]=1-(se+W),x[1]=Z+me,x[2]=Y-Se,x[3]=0,x[4]=Z-me,x[5]=1-(U+W),x[6]=ve+ce,x[7]=0,x[8]=Y+Se,x[9]=ve-ce,x[10]=1-(U+se),x[11]=0,x[12]=A[0],x[13]=A[1],x[14]=A[2],x[15]=1,x}function b(x,I){var A=I[4],D=I[5],M=I[6],L=I[8],N=I[9],V=I[10];return x[0]=Math.hypot(I[0],I[1],I[2]),x[1]=Math.hypot(A,D,M),x[2]=Math.hypot(L,N,V),x}function S(x,I,A,D,M){var L,N=1/Math.tan(I/2);return x[0]=N/A,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=N,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,null!=M&&M!==1/0?(x[10]=(M+D)*(L=1/(D-M)),x[14]=2*M*D*L):(x[10]=-1,x[14]=-2*D),x}function E(x,I,A,D,M,L,N){var V=1/(I-A),q=1/(D-M),$=1/(L-N);return x[0]=-2*V,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*q,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*$,x[11]=0,x[12]=(I+A)*V,x[13]=(M+D)*q,x[14]=(N+L)*$,x[15]=1,x}function R(x,I,A){return x[0]=I[0]-A[0],x[1]=I[1]-A[1],x[2]=I[2]-A[2],x[3]=I[3]-A[3],x[4]=I[4]-A[4],x[5]=I[5]-A[5],x[6]=I[6]-A[6],x[7]=I[7]-A[7],x[8]=I[8]-A[8],x[9]=I[9]-A[9],x[10]=I[10]-A[10],x[11]=I[11]-A[11],x[12]=I[12]-A[12],x[13]=I[13]-A[13],x[14]=I[14]-A[14],x[15]=I[15]-A[15],x}return Re.perspective=S,Re.ortho=E,Re.mul=_,Re.sub=R,Re}var kt,xe={},at={};function Be(){if(kt)return at;function u(M){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(L){return typeof L}:function(L){return L&&"function"==typeof Symbol&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L})(M)}kt=1,Object.defineProperty(at,"__esModule",{value:!0}),at.create=h,at.clone=function(M){var L=new o.ARRAY_TYPE(3);return L[0]=M[0],L[1]=M[1],L[2]=M[2],L},at.length=_,at.fromValues=function(M,L,N){var V=new o.ARRAY_TYPE(3);return V[0]=M,V[1]=L,V[2]=N,V},at.copy=function(M,L){return M[0]=L[0],M[1]=L[1],M[2]=L[2],M},at.set=function(M,L,N,V){return M[0]=L,M[1]=N,M[2]=V,M},at.add=function(M,L,N){return M[0]=L[0]+N[0],M[1]=L[1]+N[1],M[2]=L[2]+N[2],M},at.subtract=f,at.multiply=b,at.divide=S,at.ceil=function(M,L){return M[0]=Math.ceil(L[0]),M[1]=Math.ceil(L[1]),M[2]=Math.ceil(L[2]),M},at.floor=function(M,L){return M[0]=Math.floor(L[0]),M[1]=Math.floor(L[1]),M[2]=Math.floor(L[2]),M},at.min=function(M,L,N){return M[0]=Math.min(L[0],N[0]),M[1]=Math.min(L[1],N[1]),M[2]=Math.min(L[2],N[2]),M},at.max=function(M,L,N){return M[0]=Math.max(L[0],N[0]),M[1]=Math.max(L[1],N[1]),M[2]=Math.max(L[2],N[2]),M},at.round=function(M,L){return M[0]=Math.round(L[0]),M[1]=Math.round(L[1]),M[2]=Math.round(L[2]),M},at.scale=function(M,L,N){return M[0]=L[0]*N,M[1]=L[1]*N,M[2]=L[2]*N,M},at.scaleAndAdd=function(M,L,N,V){return M[0]=L[0]+N[0]*V,M[1]=L[1]+N[1]*V,M[2]=L[2]+N[2]*V,M},at.distance=E,at.squaredDistance=R,at.squaredLength=x,at.negate=function(M,L){return M[0]=-L[0],M[1]=-L[1],M[2]=-L[2],M},at.inverse=function(M,L){return M[0]=1/L[0],M[1]=1/L[1],M[2]=1/L[2],M},at.normalize=function(M,L){var N=L[0],V=L[1],q=L[2],$=N*N+V*V+q*q;return $>0&&($=1/Math.sqrt($)),M[0]=L[0]*$,M[1]=L[1]*$,M[2]=L[2]*$,M},at.dot=I,at.cross=function(M,L,N){var V=L[0],q=L[1],$=L[2],U=N[0],Z=N[1],Y=N[2];return M[0]=q*Y-$*Z,M[1]=$*U-V*Y,M[2]=V*Z-q*U,M},at.lerp=function(M,L,N,V){var q=L[0],$=L[1],U=L[2];return M[0]=q+V*(N[0]-q),M[1]=$+V*(N[1]-$),M[2]=U+V*(N[2]-U),M},at.hermite=function(M,L,N,V,q,$){var U=$*$,Z=U*(2*$-3)+1,Y=U*($-2)+$,se=U*($-1),ve=U*(3-2*$);return M[0]=L[0]*Z+N[0]*Y+V[0]*se+q[0]*ve,M[1]=L[1]*Z+N[1]*Y+V[1]*se+q[1]*ve,M[2]=L[2]*Z+N[2]*Y+V[2]*se+q[2]*ve,M},at.bezier=function(M,L,N,V,q,$){var U=1-$,Z=U*U,Y=$*$,se=Z*U,ve=3*$*Z,W=3*Y*U,ce=Y*$;return M[0]=L[0]*se+N[0]*ve+V[0]*W+q[0]*ce,M[1]=L[1]*se+N[1]*ve+V[1]*W+q[1]*ce,M[2]=L[2]*se+N[2]*ve+V[2]*W+q[2]*ce,M},at.random=function(M,L){L=L||1;var N=2*o.RANDOM()*Math.PI,V=2*o.RANDOM()-1,q=Math.sqrt(1-V*V)*L;return M[0]=Math.cos(N)*q,M[1]=Math.sin(N)*q,M[2]=V*L,M},at.transformMat4=function(M,L,N){var V=L[0],q=L[1],$=L[2],U=N[3]*V+N[7]*q+N[11]*$+N[15];return M[0]=(N[0]*V+N[4]*q+N[8]*$+N[12])/(U=U||1),M[1]=(N[1]*V+N[5]*q+N[9]*$+N[13])/U,M[2]=(N[2]*V+N[6]*q+N[10]*$+N[14])/U,M},at.transformMat3=function(M,L,N){var V=L[0],q=L[1],$=L[2];return M[0]=V*N[0]+q*N[3]+$*N[6],M[1]=V*N[1]+q*N[4]+$*N[7],M[2]=V*N[2]+q*N[5]+$*N[8],M},at.transformQuat=function(M,L,N){var V=N[0],q=N[1],$=N[2],U=L[0],Z=L[1],Y=L[2],se=q*Y-$*Z,ve=$*U-V*Y,W=V*Z-q*U,ce=q*W-$*ve,Se=$*se-V*W,me=V*ve-q*se,Me=2*N[3];return ve*=Me,W*=Me,Se*=2,me*=2,M[0]=U+(se*=Me)+(ce*=2),M[1]=Z+ve+Se,M[2]=Y+W+me,M},at.rotateX=function(M,L,N,V){var q=[],$=[];return q[0]=L[0]-N[0],q[1]=L[1]-N[1],q[2]=L[2]-N[2],$[0]=q[0],$[1]=q[1]*Math.cos(V)-q[2]*Math.sin(V),$[2]=q[1]*Math.sin(V)+q[2]*Math.cos(V),M[0]=$[0]+N[0],M[1]=$[1]+N[1],M[2]=$[2]+N[2],M},at.rotateY=function(M,L,N,V){var q=[],$=[];return q[0]=L[0]-N[0],q[1]=L[1]-N[1],q[2]=L[2]-N[2],$[0]=q[2]*Math.sin(V)+q[0]*Math.cos(V),$[1]=q[1],$[2]=q[2]*Math.cos(V)-q[0]*Math.sin(V),M[0]=$[0]+N[0],M[1]=$[1]+N[1],M[2]=$[2]+N[2],M},at.rotateZ=function(M,L,N,V){var q=[],$=[];return q[0]=L[0]-N[0],q[1]=L[1]-N[1],q[2]=L[2]-N[2],$[0]=q[0]*Math.cos(V)-q[1]*Math.sin(V),$[1]=q[0]*Math.sin(V)+q[1]*Math.cos(V),$[2]=q[2],M[0]=$[0]+N[0],M[1]=$[1]+N[1],M[2]=$[2]+N[2],M},at.angle=function(M,L){var N=M[0],V=M[1],q=M[2],$=L[0],U=L[1],Z=L[2],Y=Math.sqrt(N*N+V*V+q*q)*Math.sqrt($*$+U*U+Z*Z),se=Y&&I(M,L)/Y;return Math.acos(Math.min(Math.max(se,-1),1))},at.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M},at.str=function(M){return"vec3("+M[0]+", "+M[1]+", "+M[2]+")"},at.exactEquals=function(M,L){return M[0]===L[0]&&M[1]===L[1]&&M[2]===L[2]},at.equals=function(M,L){var N=M[0],V=M[1],q=M[2],$=L[0],U=L[1],Z=L[2];return Math.abs(N-$)<=o.EPSILON*Math.max(1,Math.abs(N),Math.abs($))&&Math.abs(V-U)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(U))&&Math.abs(q-Z)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(Z))},at.forEach=at.sqrLen=at.len=at.sqrDist=at.dist=at.div=at.mul=at.sub=void 0;var o=function(M,L){if(M&&M.__esModule)return M;if(null===M||"object"!==u(M)&&"function"!=typeof M)return{default:M};var N=l(void 0);if(N&&N.has(M))return N.get(M);var V={},q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var $ in M)if("default"!==$&&Object.prototype.hasOwnProperty.call(M,$)){var U=q?Object.getOwnPropertyDescriptor(M,$):null;U&&(U.get||U.set)?Object.defineProperty(V,$,U):V[$]=M[$]}return V.default=M,N&&N.set(M,V),V}(zt());function l(M){if("function"!=typeof WeakMap)return null;var L=new WeakMap,N=new WeakMap;return(l=function(V){return V?N:L})(M)}function h(){var M=new o.ARRAY_TYPE(3);return o.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0),M}function _(M){return Math.hypot(M[0],M[1],M[2])}function f(M,L,N){return M[0]=L[0]-N[0],M[1]=L[1]-N[1],M[2]=L[2]-N[2],M}function b(M,L,N){return M[0]=L[0]*N[0],M[1]=L[1]*N[1],M[2]=L[2]*N[2],M}function S(M,L,N){return M[0]=L[0]/N[0],M[1]=L[1]/N[1],M[2]=L[2]/N[2],M}function E(M,L){return Math.hypot(L[0]-M[0],L[1]-M[1],L[2]-M[2])}function R(M,L){var N=L[0]-M[0],V=L[1]-M[1],q=L[2]-M[2];return N*N+V*V+q*q}function x(M){var L=M[0],N=M[1],V=M[2];return L*L+N*N+V*V}function I(M,L){return M[0]*L[0]+M[1]*L[1]+M[2]*L[2]}at.sub=f,at.mul=b,at.div=S,at.dist=E,at.sqrDist=R,at.len=_,at.sqrLen=x;var A,D=(A=h(),function(M,L,N,V,q,$){var U,Z;for(L||(L=3),N||(N=0),Z=V?Math.min(V*L+N,M.length):M.length,U=N;U<Z;U+=L)A[0]=M[U],A[1]=M[U+1],A[2]=M[U+2],q(A,A,$),M[U]=A[0],M[U+1]=A[1],M[U+2]=A[2];return M});return at.forEach=D,at}var Ge,Lt,bt={};function lt(){if(Ge)return bt;function u(D){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(M){return typeof M}:function(M){return M&&"function"==typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(D)}Ge=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.create=h,bt.clone=function(D){var M=new o.ARRAY_TYPE(4);return M[0]=D[0],M[1]=D[1],M[2]=D[2],M[3]=D[3],M},bt.fromValues=function(D,M,L,N){var V=new o.ARRAY_TYPE(4);return V[0]=D,V[1]=M,V[2]=L,V[3]=N,V},bt.copy=function(D,M){return D[0]=M[0],D[1]=M[1],D[2]=M[2],D[3]=M[3],D},bt.set=function(D,M,L,N,V){return D[0]=M,D[1]=L,D[2]=N,D[3]=V,D},bt.add=function(D,M,L){return D[0]=M[0]+L[0],D[1]=M[1]+L[1],D[2]=M[2]+L[2],D[3]=M[3]+L[3],D},bt.subtract=_,bt.multiply=f,bt.divide=b,bt.ceil=function(D,M){return D[0]=Math.ceil(M[0]),D[1]=Math.ceil(M[1]),D[2]=Math.ceil(M[2]),D[3]=Math.ceil(M[3]),D},bt.floor=function(D,M){return D[0]=Math.floor(M[0]),D[1]=Math.floor(M[1]),D[2]=Math.floor(M[2]),D[3]=Math.floor(M[3]),D},bt.min=function(D,M,L){return D[0]=Math.min(M[0],L[0]),D[1]=Math.min(M[1],L[1]),D[2]=Math.min(M[2],L[2]),D[3]=Math.min(M[3],L[3]),D},bt.max=function(D,M,L){return D[0]=Math.max(M[0],L[0]),D[1]=Math.max(M[1],L[1]),D[2]=Math.max(M[2],L[2]),D[3]=Math.max(M[3],L[3]),D},bt.round=function(D,M){return D[0]=Math.round(M[0]),D[1]=Math.round(M[1]),D[2]=Math.round(M[2]),D[3]=Math.round(M[3]),D},bt.scale=function(D,M,L){return D[0]=M[0]*L,D[1]=M[1]*L,D[2]=M[2]*L,D[3]=M[3]*L,D},bt.scaleAndAdd=function(D,M,L,N){return D[0]=M[0]+L[0]*N,D[1]=M[1]+L[1]*N,D[2]=M[2]+L[2]*N,D[3]=M[3]+L[3]*N,D},bt.distance=S,bt.squaredDistance=E,bt.length=R,bt.squaredLength=x,bt.negate=function(D,M){return D[0]=-M[0],D[1]=-M[1],D[2]=-M[2],D[3]=-M[3],D},bt.inverse=function(D,M){return D[0]=1/M[0],D[1]=1/M[1],D[2]=1/M[2],D[3]=1/M[3],D},bt.normalize=function(D,M){var L=M[0],N=M[1],V=M[2],q=M[3],$=L*L+N*N+V*V+q*q;return $>0&&($=1/Math.sqrt($)),D[0]=L*$,D[1]=N*$,D[2]=V*$,D[3]=q*$,D},bt.dot=function(D,M){return D[0]*M[0]+D[1]*M[1]+D[2]*M[2]+D[3]*M[3]},bt.cross=function(D,M,L,N){var V=L[0]*N[1]-L[1]*N[0],q=L[0]*N[2]-L[2]*N[0],$=L[0]*N[3]-L[3]*N[0],U=L[1]*N[2]-L[2]*N[1],Z=L[1]*N[3]-L[3]*N[1],Y=L[2]*N[3]-L[3]*N[2],se=M[0],ve=M[1],W=M[2],ce=M[3];return D[0]=ve*Y-W*Z+ce*U,D[1]=-se*Y+W*$-ce*q,D[2]=se*Z-ve*$+ce*V,D[3]=-se*U+ve*q-W*V,D},bt.lerp=function(D,M,L,N){var V=M[0],q=M[1],$=M[2],U=M[3];return D[0]=V+N*(L[0]-V),D[1]=q+N*(L[1]-q),D[2]=$+N*(L[2]-$),D[3]=U+N*(L[3]-U),D},bt.random=function(D,M){var L,N,V,q,$,U;M=M||1;do{$=(L=2*o.RANDOM()-1)*L+(N=2*o.RANDOM()-1)*N}while($>=1);do{U=(V=2*o.RANDOM()-1)*V+(q=2*o.RANDOM()-1)*q}while(U>=1);var Z=Math.sqrt((1-$)/U);return D[0]=M*L,D[1]=M*N,D[2]=M*V*Z,D[3]=M*q*Z,D},bt.transformMat4=function(D,M,L){var N=M[0],V=M[1],q=M[2],$=M[3];return D[0]=L[0]*N+L[4]*V+L[8]*q+L[12]*$,D[1]=L[1]*N+L[5]*V+L[9]*q+L[13]*$,D[2]=L[2]*N+L[6]*V+L[10]*q+L[14]*$,D[3]=L[3]*N+L[7]*V+L[11]*q+L[15]*$,D},bt.transformQuat=function(D,M,L){var N=M[0],V=M[1],q=M[2],$=L[0],U=L[1],Z=L[2],Y=L[3],se=Y*N+U*q-Z*V,ve=Y*V+Z*N-$*q,W=Y*q+$*V-U*N,ce=-$*N-U*V-Z*q;return D[0]=se*Y+ce*-$+ve*-Z-W*-U,D[1]=ve*Y+ce*-U+W*-$-se*-Z,D[2]=W*Y+ce*-Z+se*-U-ve*-$,D[3]=M[3],D},bt.zero=function(D){return D[0]=0,D[1]=0,D[2]=0,D[3]=0,D},bt.str=function(D){return"vec4("+D[0]+", "+D[1]+", "+D[2]+", "+D[3]+")"},bt.exactEquals=function(D,M){return D[0]===M[0]&&D[1]===M[1]&&D[2]===M[2]&&D[3]===M[3]},bt.equals=function(D,M){var L=D[0],N=D[1],V=D[2],q=D[3],$=M[0],U=M[1],Z=M[2],Y=M[3];return Math.abs(L-$)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs($))&&Math.abs(N-U)<=o.EPSILON*Math.max(1,Math.abs(N),Math.abs(U))&&Math.abs(V-Z)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(Z))&&Math.abs(q-Y)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(Y))},bt.forEach=bt.sqrLen=bt.len=bt.sqrDist=bt.dist=bt.div=bt.mul=bt.sub=void 0;var o=function(D,M){if(D&&D.__esModule)return D;if(null===D||"object"!==u(D)&&"function"!=typeof D)return{default:D};var L=l(void 0);if(L&&L.has(D))return L.get(D);var N={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in D)if("default"!==q&&Object.prototype.hasOwnProperty.call(D,q)){var $=V?Object.getOwnPropertyDescriptor(D,q):null;$&&($.get||$.set)?Object.defineProperty(N,q,$):N[q]=D[q]}return N.default=D,L&&L.set(D,N),N}(zt());function l(D){if("function"!=typeof WeakMap)return null;var M=new WeakMap,L=new WeakMap;return(l=function(N){return N?L:M})(D)}function h(){var D=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0,D[3]=0),D}function _(D,M,L){return D[0]=M[0]-L[0],D[1]=M[1]-L[1],D[2]=M[2]-L[2],D[3]=M[3]-L[3],D}function f(D,M,L){return D[0]=M[0]*L[0],D[1]=M[1]*L[1],D[2]=M[2]*L[2],D[3]=M[3]*L[3],D}function b(D,M,L){return D[0]=M[0]/L[0],D[1]=M[1]/L[1],D[2]=M[2]/L[2],D[3]=M[3]/L[3],D}function S(D,M){return Math.hypot(M[0]-D[0],M[1]-D[1],M[2]-D[2],M[3]-D[3])}function E(D,M){var L=M[0]-D[0],N=M[1]-D[1],V=M[2]-D[2],q=M[3]-D[3];return L*L+N*N+V*V+q*q}function R(D){return Math.hypot(D[0],D[1],D[2],D[3])}function x(D){var M=D[0],L=D[1],N=D[2],V=D[3];return M*M+L*L+N*N+V*V}bt.sub=_,bt.mul=f,bt.div=b,bt.dist=S,bt.sqrDist=E,bt.len=R,bt.sqrLen=x;var I,A=(I=h(),function(D,M,L,N,V,q){var $,U;for(M||(M=4),L||(L=0),U=N?Math.min(N*M+L,D.length):D.length,$=L;$<U;$+=M)I[0]=D[$],I[1]=D[$+1],I[2]=D[$+2],I[3]=D[$+3],V(I,I,q),D[$]=I[0],D[$+1]=I[1],D[$+2]=I[2],D[$+3]=I[3];return D});return bt.forEach=A,bt}function Wt(){if(Lt)return xe;function u(me){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(Me){return typeof Me}:function(Me){return Me&&"function"==typeof Symbol&&Me.constructor===Symbol&&Me!==Symbol.prototype?"symbol":typeof Me})(me)}Lt=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.create=S,xe.identity=function(me){return me[0]=0,me[1]=0,me[2]=0,me[3]=1,me},xe.setAxisAngle=E,xe.getAxisAngle=function(me,Me){var Ne=2*Math.acos(Me[3]),ze=Math.sin(Ne/2);return ze>o.EPSILON?(me[0]=Me[0]/ze,me[1]=Me[1]/ze,me[2]=Me[2]/ze):(me[0]=1,me[1]=0,me[2]=0),Ne},xe.getAngle=function(me,Me){var Ne=L(me,Me);return Math.acos(2*Ne*Ne-1)},xe.multiply=R,xe.rotateX=function(me,Me,Ne){Ne*=.5;var ze=Me[0],$e=Me[1],nt=Me[2],st=Me[3],Je=Math.sin(Ne),St=Math.cos(Ne);return me[0]=ze*St+st*Je,me[1]=$e*St+nt*Je,me[2]=nt*St-$e*Je,me[3]=st*St-ze*Je,me},xe.rotateY=function(me,Me,Ne){Ne*=.5;var ze=Me[0],$e=Me[1],nt=Me[2],st=Me[3],Je=Math.sin(Ne),St=Math.cos(Ne);return me[0]=ze*St-nt*Je,me[1]=$e*St+st*Je,me[2]=nt*St+ze*Je,me[3]=st*St-$e*Je,me},xe.rotateZ=function(me,Me,Ne){Ne*=.5;var ze=Me[0],$e=Me[1],nt=Me[2],st=Me[3],Je=Math.sin(Ne),St=Math.cos(Ne);return me[0]=ze*St+$e*Je,me[1]=$e*St-ze*Je,me[2]=nt*St+st*Je,me[3]=st*St-nt*Je,me},xe.calculateW=function(me,Me){var Ne=Me[0],ze=Me[1],$e=Me[2];return me[0]=Ne,me[1]=ze,me[2]=$e,me[3]=Math.sqrt(Math.abs(1-Ne*Ne-ze*ze-$e*$e)),me},xe.exp=x,xe.ln=I,xe.pow=function(me,Me,Ne){return I(me,Me),M(me,me,Ne),x(me,me),me},xe.slerp=A,xe.random=function(me){var Me=o.RANDOM(),Ne=o.RANDOM(),ze=o.RANDOM(),$e=Math.sqrt(1-Me),nt=Math.sqrt(Me);return me[0]=$e*Math.sin(2*Math.PI*Ne),me[1]=$e*Math.cos(2*Math.PI*Ne),me[2]=nt*Math.sin(2*Math.PI*ze),me[3]=nt*Math.cos(2*Math.PI*ze),me},xe.invert=function(me,Me){var Ne=Me[0],ze=Me[1],$e=Me[2],nt=Me[3],st=Ne*Ne+ze*ze+$e*$e+nt*nt,Je=st?1/st:0;return me[0]=-Ne*Je,me[1]=-ze*Je,me[2]=-$e*Je,me[3]=nt*Je,me},xe.conjugate=function(me,Me){return me[0]=-Me[0],me[1]=-Me[1],me[2]=-Me[2],me[3]=Me[3],me},xe.fromMat3=D,xe.fromEuler=function(me,Me,Ne,ze){var $e=.5*Math.PI/180;Me*=$e,Ne*=$e,ze*=$e;var nt=Math.sin(Me),st=Math.cos(Me),Je=Math.sin(Ne),St=Math.cos(Ne),$t=Math.sin(ze),gt=Math.cos(ze);return me[0]=nt*St*gt-st*Je*$t,me[1]=st*Je*gt+nt*St*$t,me[2]=st*St*$t-nt*Je*gt,me[3]=st*St*gt+nt*Je*$t,me},xe.str=function(me){return"quat("+me[0]+", "+me[1]+", "+me[2]+", "+me[3]+")"},xe.setAxes=xe.sqlerp=xe.rotationTo=xe.equals=xe.exactEquals=xe.normalize=xe.sqrLen=xe.squaredLength=xe.len=xe.length=xe.lerp=xe.dot=xe.scale=xe.mul=xe.add=xe.set=xe.copy=xe.fromValues=xe.clone=void 0;var o=b(zt()),l=b(Bt()),h=b(Be()),_=b(lt());function f(me){if("function"!=typeof WeakMap)return null;var Me=new WeakMap,Ne=new WeakMap;return(f=function(ze){return ze?Ne:Me})(me)}function b(me,Me){if(me&&me.__esModule)return me;if(null===me||"object"!==u(me)&&"function"!=typeof me)return{default:me};var Ne=f(Me);if(Ne&&Ne.has(me))return Ne.get(me);var ze={},$e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var nt in me)if("default"!==nt&&Object.prototype.hasOwnProperty.call(me,nt)){var st=$e?Object.getOwnPropertyDescriptor(me,nt):null;st&&(st.get||st.set)?Object.defineProperty(ze,nt,st):ze[nt]=me[nt]}return ze.default=me,Ne&&Ne.set(me,ze),ze}function S(){var me=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(me[0]=0,me[1]=0,me[2]=0),me[3]=1,me}function E(me,Me,Ne){Ne*=.5;var ze=Math.sin(Ne);return me[0]=ze*Me[0],me[1]=ze*Me[1],me[2]=ze*Me[2],me[3]=Math.cos(Ne),me}function R(me,Me,Ne){var ze=Me[0],$e=Me[1],nt=Me[2],st=Me[3],Je=Ne[0],St=Ne[1],$t=Ne[2],gt=Ne[3];return me[0]=ze*gt+st*Je+$e*$t-nt*St,me[1]=$e*gt+st*St+nt*Je-ze*$t,me[2]=nt*gt+st*$t+ze*St-$e*Je,me[3]=st*gt-ze*Je-$e*St-nt*$t,me}function x(me,Me){var Ne=Me[0],ze=Me[1],$e=Me[2],nt=Me[3],st=Math.sqrt(Ne*Ne+ze*ze+$e*$e),Je=Math.exp(nt),St=st>0?Je*Math.sin(st)/st:0;return me[0]=Ne*St,me[1]=ze*St,me[2]=$e*St,me[3]=Je*Math.cos(st),me}function I(me,Me){var Ne=Me[0],ze=Me[1],$e=Me[2],nt=Me[3],st=Math.sqrt(Ne*Ne+ze*ze+$e*$e),Je=st>0?Math.atan2(st,nt)/st:0;return me[0]=Ne*Je,me[1]=ze*Je,me[2]=$e*Je,me[3]=.5*Math.log(Ne*Ne+ze*ze+$e*$e+nt*nt),me}function A(me,Me,Ne,ze){var $e,nt,st,Je,St,$t=Me[0],gt=Me[1],gn=Me[2],on=Me[3],Kt=Ne[0],Ht=Ne[1],Vn=Ne[2],pn=Ne[3];return(nt=$t*Kt+gt*Ht+gn*Vn+on*pn)<0&&(nt=-nt,Kt=-Kt,Ht=-Ht,Vn=-Vn,pn=-pn),1-nt>o.EPSILON?($e=Math.acos(nt),st=Math.sin($e),Je=Math.sin((1-ze)*$e)/st,St=Math.sin(ze*$e)/st):(Je=1-ze,St=ze),me[0]=Je*$t+St*Kt,me[1]=Je*gt+St*Ht,me[2]=Je*gn+St*Vn,me[3]=Je*on+St*pn,me}function D(me,Me){var Ne,ze=Me[0]+Me[4]+Me[8];if(ze>0)Ne=Math.sqrt(ze+1),me[3]=.5*Ne,me[0]=(Me[5]-Me[7])*(Ne=.5/Ne),me[1]=(Me[6]-Me[2])*Ne,me[2]=(Me[1]-Me[3])*Ne;else{var $e=0;Me[4]>Me[0]&&($e=1),Me[8]>Me[3*$e+$e]&&($e=2);var nt=($e+1)%3,st=($e+2)%3;Ne=Math.sqrt(Me[3*$e+$e]-Me[3*nt+nt]-Me[3*st+st]+1),me[$e]=.5*Ne,me[3]=(Me[3*nt+st]-Me[3*st+nt])*(Ne=.5/Ne),me[nt]=(Me[3*nt+$e]+Me[3*$e+nt])*Ne,me[st]=(Me[3*st+$e]+Me[3*$e+st])*Ne}return me}xe.clone=_.clone,xe.fromValues=_.fromValues,xe.copy=_.copy,xe.set=_.set,xe.add=_.add,xe.mul=R;var M=_.scale;xe.scale=M;var L=_.dot;xe.dot=L,xe.lerp=_.lerp;var N=_.length;xe.length=N,xe.len=N;var V=_.squaredLength;xe.squaredLength=V,xe.sqrLen=V;var q=_.normalize;xe.normalize=q,xe.exactEquals=_.exactEquals,xe.equals=_.equals;var $,U,Z,Y=($=h.create(),U=h.fromValues(1,0,0),Z=h.fromValues(0,1,0),function(me,Me,Ne){var ze=h.dot(Me,Ne);return ze<-.999999?(h.cross($,U,Me),h.len($)<1e-6&&h.cross($,Z,Me),h.normalize($,$),E(me,$,Math.PI),me):ze>.999999?(me[0]=0,me[1]=0,me[2]=0,me[3]=1,me):(h.cross($,Me,Ne),me[0]=$[0],me[1]=$[1],me[2]=$[2],me[3]=1+ze,q(me,me))});xe.rotationTo=Y;var se,ve,W=(se=S(),ve=S(),function(me,Me,Ne,ze,$e,nt){return A(se,Me,$e,nt),A(ve,Ne,ze,nt),A(me,se,ve,2*nt*(1-nt)),me});xe.sqlerp=W;var ce,Se=(ce=l.create(),function(me,Me,Ne,ze){return ce[0]=Ne[0],ce[3]=Ne[1],ce[6]=Ne[2],ce[1]=ze[0],ce[4]=ze[1],ce[7]=ze[2],ce[2]=-Me[0],ce[5]=-Me[1],ce[8]=-Me[2],q(me,D(me,ce))});return xe.setAxes=Se,xe}var Mn,Dn={};var Gn,jr,jn={};function lr(){if(Gn)return jn;function u(D){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(M){return typeof M}:function(M){return M&&"function"==typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(D)}Gn=1,Object.defineProperty(jn,"__esModule",{value:!0}),jn.create=h,jn.clone=function(D){var M=new o.ARRAY_TYPE(2);return M[0]=D[0],M[1]=D[1],M},jn.fromValues=function(D,M){var L=new o.ARRAY_TYPE(2);return L[0]=D,L[1]=M,L},jn.copy=function(D,M){return D[0]=M[0],D[1]=M[1],D},jn.set=function(D,M,L){return D[0]=M,D[1]=L,D},jn.add=function(D,M,L){return D[0]=M[0]+L[0],D[1]=M[1]+L[1],D},jn.subtract=_,jn.multiply=f,jn.divide=b,jn.ceil=function(D,M){return D[0]=Math.ceil(M[0]),D[1]=Math.ceil(M[1]),D},jn.floor=function(D,M){return D[0]=Math.floor(M[0]),D[1]=Math.floor(M[1]),D},jn.min=function(D,M,L){return D[0]=Math.min(M[0],L[0]),D[1]=Math.min(M[1],L[1]),D},jn.max=function(D,M,L){return D[0]=Math.max(M[0],L[0]),D[1]=Math.max(M[1],L[1]),D},jn.round=function(D,M){return D[0]=Math.round(M[0]),D[1]=Math.round(M[1]),D},jn.scale=function(D,M,L){return D[0]=M[0]*L,D[1]=M[1]*L,D},jn.scaleAndAdd=function(D,M,L,N){return D[0]=M[0]+L[0]*N,D[1]=M[1]+L[1]*N,D},jn.distance=S,jn.squaredDistance=E,jn.length=R,jn.squaredLength=x,jn.negate=function(D,M){return D[0]=-M[0],D[1]=-M[1],D},jn.inverse=function(D,M){return D[0]=1/M[0],D[1]=1/M[1],D},jn.normalize=function(D,M){var L=M[0],N=M[1],V=L*L+N*N;return V>0&&(V=1/Math.sqrt(V)),D[0]=M[0]*V,D[1]=M[1]*V,D},jn.dot=function(D,M){return D[0]*M[0]+D[1]*M[1]},jn.cross=function(D,M,L){var N=M[0]*L[1]-M[1]*L[0];return D[0]=D[1]=0,D[2]=N,D},jn.lerp=function(D,M,L,N){var V=M[0],q=M[1];return D[0]=V+N*(L[0]-V),D[1]=q+N*(L[1]-q),D},jn.random=function(D,M){M=M||1;var L=2*o.RANDOM()*Math.PI;return D[0]=Math.cos(L)*M,D[1]=Math.sin(L)*M,D},jn.transformMat2=function(D,M,L){var N=M[0],V=M[1];return D[0]=L[0]*N+L[2]*V,D[1]=L[1]*N+L[3]*V,D},jn.transformMat2d=function(D,M,L){var N=M[0],V=M[1];return D[0]=L[0]*N+L[2]*V+L[4],D[1]=L[1]*N+L[3]*V+L[5],D},jn.transformMat3=function(D,M,L){var N=M[0],V=M[1];return D[0]=L[0]*N+L[3]*V+L[6],D[1]=L[1]*N+L[4]*V+L[7],D},jn.transformMat4=function(D,M,L){var N=M[0],V=M[1];return D[0]=L[0]*N+L[4]*V+L[12],D[1]=L[1]*N+L[5]*V+L[13],D},jn.rotate=function(D,M,L,N){var V=M[0]-L[0],q=M[1]-L[1],$=Math.sin(N),U=Math.cos(N);return D[0]=V*U-q*$+L[0],D[1]=V*$+q*U+L[1],D},jn.angle=function(D,M){var L=D[0],N=D[1],V=M[0],q=M[1],$=Math.sqrt(L*L+N*N)*Math.sqrt(V*V+q*q);return Math.acos(Math.min(Math.max($&&(L*V+N*q)/$,-1),1))},jn.zero=function(D){return D[0]=0,D[1]=0,D},jn.str=function(D){return"vec2("+D[0]+", "+D[1]+")"},jn.exactEquals=function(D,M){return D[0]===M[0]&&D[1]===M[1]},jn.equals=function(D,M){var L=D[0],N=D[1],V=M[0],q=M[1];return Math.abs(L-V)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(V))&&Math.abs(N-q)<=o.EPSILON*Math.max(1,Math.abs(N),Math.abs(q))},jn.forEach=jn.sqrLen=jn.sqrDist=jn.dist=jn.div=jn.mul=jn.sub=jn.len=void 0;var o=function(D,M){if(D&&D.__esModule)return D;if(null===D||"object"!==u(D)&&"function"!=typeof D)return{default:D};var L=l(void 0);if(L&&L.has(D))return L.get(D);var N={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in D)if("default"!==q&&Object.prototype.hasOwnProperty.call(D,q)){var $=V?Object.getOwnPropertyDescriptor(D,q):null;$&&($.get||$.set)?Object.defineProperty(N,q,$):N[q]=D[q]}return N.default=D,L&&L.set(D,N),N}(zt());function l(D){if("function"!=typeof WeakMap)return null;var M=new WeakMap,L=new WeakMap;return(l=function(N){return N?L:M})(D)}function h(){var D=new o.ARRAY_TYPE(2);return o.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0),D}function _(D,M,L){return D[0]=M[0]-L[0],D[1]=M[1]-L[1],D}function f(D,M,L){return D[0]=M[0]*L[0],D[1]=M[1]*L[1],D}function b(D,M,L){return D[0]=M[0]/L[0],D[1]=M[1]/L[1],D}function S(D,M){return Math.hypot(M[0]-D[0],M[1]-D[1])}function E(D,M){var L=M[0]-D[0],N=M[1]-D[1];return L*L+N*N}function R(D){return Math.hypot(D[0],D[1])}function x(D){var M=D[0],L=D[1];return M*M+L*L}jn.len=R,jn.sub=_,jn.mul=f,jn.div=b,jn.dist=S,jn.sqrDist=E,jn.sqrLen=x;var I,A=(I=h(),function(D,M,L,N,V,q){var $,U;for(M||(M=2),L||(L=0),U=N?Math.min(N*M+L,D.length):D.length,$=L;$<U;$+=M)I[0]=D[$],I[1]=D[$+1],V(I,I,q),D[$]=I[0],D[$+1]=I[1];return D});return jn.forEach=A,jn}var qo,Fs,cr,ur,ee=function fn(){if(jr)return De;function u(D){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(M){return typeof M}:function(M){return M&&"function"==typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(D)}jr=1,Object.defineProperty(De,"__esModule",{value:!0}),De.vec4=De.vec3=De.vec2=De.quat2=De.quat=De.mat4=De.mat3=De.mat2d=De.mat2=De.glMatrix=void 0;var o=A(zt());De.glMatrix=o;var l=A(it());De.mat2=l;var h=A(bn());De.mat2d=h;var _=A(Bt());De.mat3=_;var f=A(qe());De.mat4=f;var b=A(Wt());De.quat=b;var S=A(function _n(){if(Mn)return Dn;function u(A){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(D){return typeof D}:function(D){return D&&"function"==typeof Symbol&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D})(A)}Mn=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.create=function(){var A=new o.ARRAY_TYPE(8);return o.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[4]=0,A[5]=0,A[6]=0,A[7]=0),A[3]=1,A},Dn.clone=function(A){var D=new o.ARRAY_TYPE(8);return D[0]=A[0],D[1]=A[1],D[2]=A[2],D[3]=A[3],D[4]=A[4],D[5]=A[5],D[6]=A[6],D[7]=A[7],D},Dn.fromValues=function(A,D,M,L,N,V,q,$){var U=new o.ARRAY_TYPE(8);return U[0]=A,U[1]=D,U[2]=M,U[3]=L,U[4]=N,U[5]=V,U[6]=q,U[7]=$,U},Dn.fromRotationTranslationValues=function(A,D,M,L,N,V,q){var $=new o.ARRAY_TYPE(8);$[0]=A,$[1]=D,$[2]=M,$[3]=L;var U=.5*N,Z=.5*V,Y=.5*q;return $[4]=U*L+Z*M-Y*D,$[5]=Z*L+Y*A-U*M,$[6]=Y*L+U*D-Z*A,$[7]=-U*A-Z*D-Y*M,$},Dn.fromRotationTranslation=b,Dn.fromTranslation=function(A,D){return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A[4]=.5*D[0],A[5]=.5*D[1],A[6]=.5*D[2],A[7]=0,A},Dn.fromRotation=function(A,D){return A[0]=D[0],A[1]=D[1],A[2]=D[2],A[3]=D[3],A[4]=0,A[5]=0,A[6]=0,A[7]=0,A},Dn.fromMat4=function(A,D){var M=l.create();h.getRotation(M,D);var L=new o.ARRAY_TYPE(3);return h.getTranslation(L,D),b(A,M,L),A},Dn.copy=S,Dn.identity=function(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A[4]=0,A[5]=0,A[6]=0,A[7]=0,A},Dn.set=function(A,D,M,L,N,V,q,$,U){return A[0]=D,A[1]=M,A[2]=L,A[3]=N,A[4]=V,A[5]=q,A[6]=$,A[7]=U,A},Dn.getDual=function(A,D){return A[0]=D[4],A[1]=D[5],A[2]=D[6],A[3]=D[7],A},Dn.setDual=function(A,D){return A[4]=D[0],A[5]=D[1],A[6]=D[2],A[7]=D[3],A},Dn.getTranslation=function(A,D){var M=D[4],L=D[5],N=D[6],V=D[7],q=-D[0],$=-D[1],U=-D[2],Z=D[3];return A[0]=2*(M*Z+V*q+L*U-N*$),A[1]=2*(L*Z+V*$+N*q-M*U),A[2]=2*(N*Z+V*U+M*$-L*q),A},Dn.translate=function(A,D,M){var L=D[0],N=D[1],V=D[2],q=D[3],$=.5*M[0],U=.5*M[1],Z=.5*M[2],Y=D[4],se=D[5],ve=D[6],W=D[7];return A[0]=L,A[1]=N,A[2]=V,A[3]=q,A[4]=q*$+N*Z-V*U+Y,A[5]=q*U+V*$-L*Z+se,A[6]=q*Z+L*U-N*$+ve,A[7]=-L*$-N*U-V*Z+W,A},Dn.rotateX=function(A,D,M){var L=-D[0],N=-D[1],V=-D[2],q=D[3],$=D[4],U=D[5],Z=D[6],Y=D[7],se=$*q+Y*L+U*V-Z*N,ve=U*q+Y*N+Z*L-$*V,W=Z*q+Y*V+$*N-U*L,ce=Y*q-$*L-U*N-Z*V;return l.rotateX(A,D,M),A[4]=se*(q=A[3])+ce*(L=A[0])+ve*(V=A[2])-W*(N=A[1]),A[5]=ve*q+ce*N+W*L-se*V,A[6]=W*q+ce*V+se*N-ve*L,A[7]=ce*q-se*L-ve*N-W*V,A},Dn.rotateY=function(A,D,M){var L=-D[0],N=-D[1],V=-D[2],q=D[3],$=D[4],U=D[5],Z=D[6],Y=D[7],se=$*q+Y*L+U*V-Z*N,ve=U*q+Y*N+Z*L-$*V,W=Z*q+Y*V+$*N-U*L,ce=Y*q-$*L-U*N-Z*V;return l.rotateY(A,D,M),A[4]=se*(q=A[3])+ce*(L=A[0])+ve*(V=A[2])-W*(N=A[1]),A[5]=ve*q+ce*N+W*L-se*V,A[6]=W*q+ce*V+se*N-ve*L,A[7]=ce*q-se*L-ve*N-W*V,A},Dn.rotateZ=function(A,D,M){var L=-D[0],N=-D[1],V=-D[2],q=D[3],$=D[4],U=D[5],Z=D[6],Y=D[7],se=$*q+Y*L+U*V-Z*N,ve=U*q+Y*N+Z*L-$*V,W=Z*q+Y*V+$*N-U*L,ce=Y*q-$*L-U*N-Z*V;return l.rotateZ(A,D,M),A[4]=se*(q=A[3])+ce*(L=A[0])+ve*(V=A[2])-W*(N=A[1]),A[5]=ve*q+ce*N+W*L-se*V,A[6]=W*q+ce*V+se*N-ve*L,A[7]=ce*q-se*L-ve*N-W*V,A},Dn.rotateByQuatAppend=function(A,D,M){var L=M[0],N=M[1],V=M[2],q=M[3],$=D[0],U=D[1],Z=D[2],Y=D[3];return A[0]=$*q+Y*L+U*V-Z*N,A[1]=U*q+Y*N+Z*L-$*V,A[2]=Z*q+Y*V+$*N-U*L,A[3]=Y*q-$*L-U*N-Z*V,A[4]=($=D[4])*q+(Y=D[7])*L+(U=D[5])*V-(Z=D[6])*N,A[5]=U*q+Y*N+Z*L-$*V,A[6]=Z*q+Y*V+$*N-U*L,A[7]=Y*q-$*L-U*N-Z*V,A},Dn.rotateByQuatPrepend=function(A,D,M){var L=D[0],N=D[1],V=D[2],q=D[3],$=M[0],U=M[1],Z=M[2],Y=M[3];return A[0]=L*Y+q*$+N*Z-V*U,A[1]=N*Y+q*U+V*$-L*Z,A[2]=V*Y+q*Z+L*U-N*$,A[3]=q*Y-L*$-N*U-V*Z,A[4]=L*(Y=M[7])+q*($=M[4])+N*(Z=M[6])-V*(U=M[5]),A[5]=N*Y+q*U+V*$-L*Z,A[6]=V*Y+q*Z+L*U-N*$,A[7]=q*Y-L*$-N*U-V*Z,A},Dn.rotateAroundAxis=function(A,D,M,L){if(Math.abs(L)<o.EPSILON)return S(A,D);var N=Math.hypot(M[0],M[1],M[2]);L*=.5;var V=Math.sin(L),q=V*M[0]/N,$=V*M[1]/N,U=V*M[2]/N,Z=Math.cos(L),Y=D[0],se=D[1],ve=D[2],W=D[3];A[0]=Y*Z+W*q+se*U-ve*$,A[1]=se*Z+W*$+ve*q-Y*U,A[2]=ve*Z+W*U+Y*$-se*q,A[3]=W*Z-Y*q-se*$-ve*U;var ce=D[4],Se=D[5],me=D[6],Me=D[7];return A[4]=ce*Z+Me*q+Se*U-me*$,A[5]=Se*Z+Me*$+me*q-ce*U,A[6]=me*Z+Me*U+ce*$-Se*q,A[7]=Me*Z-ce*q-Se*$-me*U,A},Dn.add=function(A,D,M){return A[0]=D[0]+M[0],A[1]=D[1]+M[1],A[2]=D[2]+M[2],A[3]=D[3]+M[3],A[4]=D[4]+M[4],A[5]=D[5]+M[5],A[6]=D[6]+M[6],A[7]=D[7]+M[7],A},Dn.multiply=E,Dn.scale=function(A,D,M){return A[0]=D[0]*M,A[1]=D[1]*M,A[2]=D[2]*M,A[3]=D[3]*M,A[4]=D[4]*M,A[5]=D[5]*M,A[6]=D[6]*M,A[7]=D[7]*M,A},Dn.lerp=function(A,D,M,L){var N=1-L;return R(D,M)<0&&(L=-L),A[0]=D[0]*N+M[0]*L,A[1]=D[1]*N+M[1]*L,A[2]=D[2]*N+M[2]*L,A[3]=D[3]*N+M[3]*L,A[4]=D[4]*N+M[4]*L,A[5]=D[5]*N+M[5]*L,A[6]=D[6]*N+M[6]*L,A[7]=D[7]*N+M[7]*L,A},Dn.invert=function(A,D){var M=I(D);return A[0]=-D[0]/M,A[1]=-D[1]/M,A[2]=-D[2]/M,A[3]=D[3]/M,A[4]=-D[4]/M,A[5]=-D[5]/M,A[6]=-D[6]/M,A[7]=D[7]/M,A},Dn.conjugate=function(A,D){return A[0]=-D[0],A[1]=-D[1],A[2]=-D[2],A[3]=D[3],A[4]=-D[4],A[5]=-D[5],A[6]=-D[6],A[7]=D[7],A},Dn.normalize=function(A,D){var M=I(D);if(M>0){M=Math.sqrt(M);var L=D[0]/M,N=D[1]/M,V=D[2]/M,q=D[3]/M,$=D[4],U=D[5],Z=D[6],Y=D[7],se=L*$+N*U+V*Z+q*Y;A[0]=L,A[1]=N,A[2]=V,A[3]=q,A[4]=($-L*se)/M,A[5]=(U-N*se)/M,A[6]=(Z-V*se)/M,A[7]=(Y-q*se)/M}return A},Dn.str=function(A){return"quat2("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+", "+A[4]+", "+A[5]+", "+A[6]+", "+A[7]+")"},Dn.exactEquals=function(A,D){return A[0]===D[0]&&A[1]===D[1]&&A[2]===D[2]&&A[3]===D[3]&&A[4]===D[4]&&A[5]===D[5]&&A[6]===D[6]&&A[7]===D[7]},Dn.equals=function(A,D){var M=A[0],L=A[1],N=A[2],V=A[3],q=A[4],$=A[5],U=A[6],Z=A[7],Y=D[0],se=D[1],ve=D[2],W=D[3],ce=D[4],Se=D[5],me=D[6],Me=D[7];return Math.abs(M-Y)<=o.EPSILON*Math.max(1,Math.abs(M),Math.abs(Y))&&Math.abs(L-se)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(se))&&Math.abs(N-ve)<=o.EPSILON*Math.max(1,Math.abs(N),Math.abs(ve))&&Math.abs(V-W)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(W))&&Math.abs(q-ce)<=o.EPSILON*Math.max(1,Math.abs(q),Math.abs(ce))&&Math.abs($-Se)<=o.EPSILON*Math.max(1,Math.abs($),Math.abs(Se))&&Math.abs(U-me)<=o.EPSILON*Math.max(1,Math.abs(U),Math.abs(me))&&Math.abs(Z-Me)<=o.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Me))},Dn.sqrLen=Dn.squaredLength=Dn.len=Dn.length=Dn.dot=Dn.mul=Dn.setReal=Dn.getReal=void 0;var o=f(zt()),l=f(Wt()),h=f(qe());function _(A){if("function"!=typeof WeakMap)return null;var D=new WeakMap,M=new WeakMap;return(_=function(L){return L?M:D})(A)}function f(A,D){if(A&&A.__esModule)return A;if(null===A||"object"!==u(A)&&"function"!=typeof A)return{default:A};var M=_(D);if(M&&M.has(A))return M.get(A);var L={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in A)if("default"!==V&&Object.prototype.hasOwnProperty.call(A,V)){var q=N?Object.getOwnPropertyDescriptor(A,V):null;q&&(q.get||q.set)?Object.defineProperty(L,V,q):L[V]=A[V]}return L.default=A,M&&M.set(A,L),L}function b(A,D,M){var L=.5*M[0],N=.5*M[1],V=.5*M[2],q=D[0],$=D[1],U=D[2],Z=D[3];return A[0]=q,A[1]=$,A[2]=U,A[3]=Z,A[4]=L*Z+N*U-V*$,A[5]=N*Z+V*q-L*U,A[6]=V*Z+L*$-N*q,A[7]=-L*q-N*$-V*U,A}function S(A,D){return A[0]=D[0],A[1]=D[1],A[2]=D[2],A[3]=D[3],A[4]=D[4],A[5]=D[5],A[6]=D[6],A[7]=D[7],A}function E(A,D,M){var L=D[0],N=D[1],V=D[2],q=D[3],$=M[4],U=M[5],Z=M[6],Y=M[7],se=D[4],ve=D[5],W=D[6],ce=D[7],Se=M[0],me=M[1],Me=M[2],Ne=M[3];return A[0]=L*Ne+q*Se+N*Me-V*me,A[1]=N*Ne+q*me+V*Se-L*Me,A[2]=V*Ne+q*Me+L*me-N*Se,A[3]=q*Ne-L*Se-N*me-V*Me,A[4]=L*Y+q*$+N*Z-V*U+se*Ne+ce*Se+ve*Me-W*me,A[5]=N*Y+q*U+V*$-L*Z+ve*Ne+ce*me+W*Se-se*Me,A[6]=V*Y+q*Z+L*U-N*$+W*Ne+ce*Me+se*me-ve*Se,A[7]=q*Y-L*$-N*U-V*Z+ce*Ne-se*Se-ve*me-W*Me,A}Dn.getReal=l.copy,Dn.setReal=l.copy,Dn.mul=E;var R=l.dot;Dn.dot=R;var x=l.length;Dn.length=x,Dn.len=x;var I=l.squaredLength;return Dn.squaredLength=I,Dn.sqrLen=I,Dn}());De.quat2=S;var E=A(lr());De.vec2=E;var R=A(Be());De.vec3=R;var x=A(lt());function I(D){if("function"!=typeof WeakMap)return null;var M=new WeakMap,L=new WeakMap;return(I=function(N){return N?L:M})(D)}function A(D,M){if(D&&D.__esModule)return D;if(null===D||"object"!==u(D)&&"function"!=typeof D)return{default:D};var L=I(M);if(L&&L.has(D))return L.get(D);var N={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in D)if("default"!==q&&Object.prototype.hasOwnProperty.call(D,q)){var $=V?Object.getOwnPropertyDescriptor(D,q):null;$&&($.get||$.set)?Object.defineProperty(N,q,$):N[q]=D[q]}return N.default=D,L&&L.set(D,N),N}return De.vec4=x,De}(),an=Qe(function(){if(Fs)return qo;function u(o,l,h,_){this.cx=3*o,this.bx=3*(h-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(_-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=l,this.p2x=h,this.p2y=_}return Fs=1,qo=u,u.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,l){if(void 0===l&&(l=1e-6),o<0)return 0;if(o>1)return 1;for(var h=o,_=0;_<8;_++){var f=this.sampleCurveX(h)-o;if(Math.abs(f)<l)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=f/b}var S=0,E=1;for(h=o,_=0;_<20&&(f=this.sampleCurveX(h),!(Math.abs(f-o)<l));_++)o>f?S=h:E=h,h=.5*(E-S)+S;return h},solve:function(o,l){return this.sampleCurveY(this.solveCurveX(o,l))}},qo}());function Dt(){if(ur)return cr;function u(o,l){this.x=o,this.y=l}return ur=1,cr=u,u.prototype={clone:function(){return new u(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,l){return this.clone()._rotateAround(o,l)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var l=o.x-this.x,h=o.y-this.y;return l*l+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,l){return Math.atan2(this.x*l-this.y*o,this.x*o+this.y*l)},_matMult:function(o){var l=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=l,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var l=Math.cos(o),h=Math.sin(o),_=h*this.x+l*this.y;return this.x=l*this.x-h*this.y,this.y=_,this},_rotateAround:function(o,l){var h=Math.cos(o),_=Math.sin(o),f=l.y+_*(this.x-l.x)+h*(this.y-l.y);return this.x=l.x+h*(this.x-l.x)-_*(this.y-l.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},u.convert=function(o){return o instanceof u?o:Array.isArray(o)?new u(o[0],o[1]):o},cr}var jt=Qe(Dt());function to(u,o){if(Array.isArray(u)){if(!Array.isArray(o)||u.length!==o.length)return!1;for(let l=0;l<u.length;l++)if(!to(u[l],o[l]))return!1;return!0}if("object"==typeof u&&null!==u&&null!==o){if("object"!=typeof o||Object.keys(u).length!==Object.keys(o).length)return!1;for(const l in u)if(!to(u[l],o[l]))return!1;return!0}return u===o}const zi=Math.PI/180,_o=180/Math.PI;function ri(u){return u*zi}function Pe(u){return u*_o}const ie=[[0,0],[1,0],[1,1],[0,1]];function ue(u){if(u<=0)return 0;if(u>=1)return 1;const o=u*u,l=o*u;return 4*(u<.5?l:3*(u-o)+l-.75)}function Ze(u,o,l,h){const _=new an(u,o,l,h);return function(f){return _.solve(f)}}const Et=Ze(.25,.1,.25,1);function Pt(u,o,l){return Math.min(l,Math.max(o,u))}function Tn(u,o,l){return(l=Pt((l-u)/(o-u),0,1))*l*(3-2*l)}function tr(u,o,l){const h=l-o,_=((u-o)%h+h)%h+o;return _===o?l:_}function vr(u,o,l){if(!u.length)return l(null,[]);let h=u.length;const _=new Array(u.length);let f=null;u.forEach((b,S)=>{o(b,(E,R)=>{E&&(f=E),_[S]=R,0==--h&&l(f,_)})})}function ir(u,...o){for(const l of o)for(const h in l)u[h]=l[h];return u}let co=1;function bo(){return co++}function Hl(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))}function Ys(u,o){u.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function za(u,o){return-1!==u.indexOf(o,u.length-o.length)}function Su(u,o,l){const h={};for(const _ in u)h[_]=o.call(this,u[_],_,u);return h}function Tu(u,o,l){const h={};for(const _ in u)o.call(this,u[_],_,u)&&(h[_]=u[_]);return h}function ol(u){return Array.isArray(u)?u.map(ol):"object"==typeof u&&u?Su(u,ol):u}const Eh={};function ji(u){Eh[u]||("undefined"!=typeof console&&console.warn(u),Eh[u]=!0)}function Gl(u,o,l){return(l.y-u.y)*(o.x-u.x)>(o.y-u.y)*(l.x-u.x)}function bf(u){let o=0;for(let l,h,_=0,f=u.length,b=f-1;_<f;b=_++)l=u[_],h=u[b],o+=(h.x-l.x)*(l.y+h.y);return o}function Va([u,o,l]){const h=ri(o+90),_=ri(l);return{x:u*Math.cos(h)*Math.sin(_),y:u*Math.sin(h)*Math.sin(_),z:u*Math.cos(_),azimuthal:o,polar:l}}function Cu(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Ih(u){const o={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,_,f)=>{const b=_||f;return o[h]=!b||b.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let Mh=null;function pd(u,o){return[u[4*o],u[4*o+1],u[4*o+2],u[4*o+3]]}function Ah(u,o,l,h){for(;o<l;){const _=o+l>>1;u[_]<h?o=_+1:l=_}return o}function ht(u,o,l,h){for(;o<l;){const _=o+l>>1;u[_]<=h?o=_+1:l=_}return o}function re(u){return u>0?1/(1.001-u):1+u}function he(u){return u>0?1-1/(1.001-u):-u}const Te={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Te.API_URL)return null;try{const u=new URL(Te.API_URL);return"api.mapbox.cn"===u.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===u.hostname?"https://events.mapbox.com/events/v2":null}catch(u){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function He(u){return Te.API_URL_REGEX.test(u)}function ke(u){return Te.API_SPRITE_REGEX.test(u)}let Ye,pt,tt,ut,vt,wt;function qt(){return null==Ye&&(Ye=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),Ye}const hn={now:()=>void 0!==ut?ut:performance.now(),setNow(u){ut=u},restoreNow(){ut=void 0},frame(u){const o=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(u,o=0){const{width:l,height:h}=u;vt||(vt=document.createElement("canvas"));const _=vt.getContext("2d",{willReadFrequently:!0});if(!_)throw new Error("failed to create canvas 2d context");return(l>vt.width||h>vt.height)&&(vt.width=l,vt.height=h),_.clearRect(-o,-o,l+2*o,h+2*o),_.drawImage(u,0,0,l,h),_.getImageData(-o,-o,l+2*o,h+2*o)},resolveURL:u=>(pt||(pt=document.createElement("a")),pt.href=u,pt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==tt&&(tt=window.matchMedia("(prefers-reduced-motion: reduce)")),tt.matches)},hasCanvasFingerprintNoise(){if(void 0!==wt)return wt;if(!qt())return wt=!1,!1;const u=new OffscreenCanvas(85,1),o=u.getContext("2d",{willReadFrequently:!0});let l=0;for(let _=0;_<u.width;++_)o.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,o.fillRect(_,0,1,1);const h=o.getImageData(0,0,u.width,u.height);l=0;for(let _=0;_<h.data.length;++_)if(_%4!=3&&l++!==h.data[_])return wt=!0,!0;return wt=!1,!1}};function En(u,o){const l=u.indexOf("?");if(l<0)return`${u}?${new URLSearchParams(o).toString()}`;const h=new URLSearchParams(u.slice(l));for(const _ in o)h.set(_,o[_]);return`${u.slice(0,l)}?${h.toString()}`}function Qn(u,o={persistentParams:[]}){const l=u.indexOf("?");if(l<0)return u;const h=new URLSearchParams,_=new URLSearchParams(u.slice(l));for(const b of o.persistentParams){const S=_.get(b);S&&h.set(b,S)}const f=h.toString();return`${u.slice(0,l)}${f.length>0?`?${f}`:""}`}const ui="mapbox-tiles";let ai=500,ti=50;const fr=["language","worldview","jobid"];let ki,Di;function Ti(){try{return caches}catch(u){}}function xr(){const u=Ti();u&&null==ki&&(ki=u.open(ui))}let uo=1/0;const Ns={supported:!1,testSupport:function(u){!ql&&ps&&(Cl?yf(u):Jo=u)}};let Jo,ps,ql=!1,Cl=!1;const Bc="undefined"!=typeof self?self:{};function yf(u){const o=u.createTexture();u.bindTexture(u.TEXTURE_2D,o);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,ps),u.isContextLost())return;Ns.supported=!0}catch(l){}u.deleteTexture(o),ql=!0}Bc.document&&(ps=Bc.document.createElement("img"),ps.onload=function(){Jo&&yf(Jo),Jo=null,Cl=!0},ps.onerror=function(){ql=!0,Jo=null},ps.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Rh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Rh);class vf extends Error{constructor(o,l,h){401===l&&He(h)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Bm=Cu()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,fd=function(u,o){if(!(/^file:/.test(l=u.url)||/^file:/.test(Bm())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(h,_){const f=new AbortController,b=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Bm(),referrerPolicy:h.referrerPolicy,signal:f.signal});let S=!1,E=!1;const R=(x=b.url).indexOf("sku=")>0&&He(x);var x;"json"===h.type&&b.headers.set("Accept","application/json");const I=(D,M,L)=>{if(E)return;if(D&&"SecurityError"!==D.message&&ji(D.toString()),M&&L)return A(M);const N=Date.now();fetch(b).then(V=>{if(V.ok){const q=R?V.clone():null;return A(V,q,N)}return _(new vf(V.statusText,V.status,h.url))}).catch(V=>{"AbortError"!==V.name&&_(new Error(`${V.message} ${h.url}`))})},A=(D,M,L)=>{("arrayBuffer"===h.type?D.arrayBuffer():"json"===h.type?D.json():D.text()).then(N=>{E||(M&&L&&function(V,q,$){if(xr(),null==ki)return;const U=Ih(q.headers.get("Cache-Control")||"");if(U["no-store"])return;const Z={status:q.status,statusText:q.statusText,headers:new Headers};q.headers.forEach((ve,W)=>Z.headers.set(W,ve)),U["max-age"]&&Z.headers.set("Expires",new Date($+1e3*U["max-age"]).toUTCString());const Y=Z.headers.get("Expires");if(!Y||new Date(Y).getTime()-$<42e4)return;let se=Qn(V.url,{persistentParams:fr});if(206===q.status){const ve=V.headers.get("Range");if(!ve)return;Z.status=200,se=En(se,{range:ve})}!function(ve,W){if(void 0===Di)try{new Response(new ReadableStream),Di=!0}catch(ce){Di=!1}Di?W(ve.body):ve.blob().then(W)}(q,ve=>{const W=new Response(200!==(ce=q.status)&&404!==ce&&[101,103,204,205,304].includes(ce)?null:ve,Z);var ce;xr(),null!=ki&&ki.then(Se=>Se.put(se,W)).catch(Se=>ji(Se.message))})}(b,M,L),S=!0,_(null,N,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(N=>{E||_(new Error(N.message))})};return R?function(D,M){if(xr(),null==ki)return M(null);ki.then(L=>{let N=Qn(D.url,{persistentParams:fr});const V=D.headers.get("Range");V&&(N=En(N,{range:V})),L.match(N).then(q=>{const $=function(U){if(!U)return!1;const Z=new Date(U.headers.get("Expires")||0),Y=Ih(U.headers.get("Cache-Control")||"");return Z>Date.now()&&!Y["no-cache"]}(q);L.delete(N),$&&L.put(N,q.clone()),M(null,q,$)}).catch(M)}).catch(M)}(b,I):I(null,null),{cancel:()=>{E=!0,S||f.abort()}}}(u,o);if(Cu()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,o,void 0,!0)}var l;return function(h,_){const f=new XMLHttpRequest;f.open(h.method||"GET",h.url,!0),"arrayBuffer"===h.type&&(f.responseType="arraybuffer");for(const b in h.headers)f.setRequestHeader(b,h.headers[b]);return"json"===h.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===h.credentials,f.onerror=()=>{_(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let b=f.response;if("json"===h.type)try{b=JSON.parse(f.response)}catch(S){return _(S)}_(null,b,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else _(new vf(f.statusText,f.status,h.url))},f.send(h.body),{cancel:()=>f.abort()}}(u,o)},md=function(u,o){return fd(ir(u,{type:"arrayBuffer"}),o)};function sl(u){const o=document.createElement("a");return o.href=u,o.protocol===location.protocol&&o.host===location.host}const al="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Dl,xa;Dl=[],xa=0;const ho=function(u,o){if(Ns.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),xa>=Te.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:u,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return Dl.push(f),f}xa++;let l=!1;const h=()=>{if(!l)for(l=!0,xa--;Dl.length&&xa<Te.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Dl.shift(),{requestParameters:b,callback:S,cancelled:E}=f;E||(f.cancel=ho(b,S).cancel)}},_=md(u,(f,b,S,E)=>{h(),f?o(f):b&&(self.createImageBitmap?function(R,x){const I=new Blob([new Uint8Array(R)],{type:"image/png"});createImageBitmap(I).then(A=>{x(null,A)}).catch(A=>{x(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(R,x)=>o(R,x,S,E)):function(R,x){const I=new Image;I.onload=()=>{x(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=al})},I.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const A=new Blob([new Uint8Array(R)],{type:"image/png"});I.src=R.byteLength?URL.createObjectURL(A):al}(b,(R,x)=>o(R,x,S,E)))});return{cancel:()=>{_.cancel(),h()}}};var yo,xf,kh,Er={exports:{}},gd={exports:{}},vo={exports:{}},wa=Qe(function(){if(kh)return Er.exports;kh=1;var u=(yo||(yo=1,gd.exports=function(l,h){var _,f,b,S,E,R,x,I;for(f=l.length-(_=3&l.length),b=h,E=3432918353,R=461845907,I=0;I<f;)x=255&l.charCodeAt(I)|(255&l.charCodeAt(++I))<<8|(255&l.charCodeAt(++I))<<16|(255&l.charCodeAt(++I))<<24,++I,b=27492+(65535&(S=5*(65535&(b=(b^=x=(65535&(x=(x=(65535&x)*E+(((x>>>16)*E&65535)<<16)&4294967295)<<15|x>>>17))*R+(((x>>>16)*R&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(x=0,_){case 3:x^=(255&l.charCodeAt(I+2))<<16;case 2:x^=(255&l.charCodeAt(I+1))<<8;case 1:b^=x=(65535&(x=(x=(65535&(x^=255&l.charCodeAt(I)))*E+(((x>>>16)*E&65535)<<16)&4294967295)<<15|x>>>17))*R+(((x>>>16)*R&65535)<<16)&4294967295}return b^=l.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),gd.exports),o=(xf||(xf=1,vo.exports=function(l,h){for(var _,f=l.length,b=h^f,S=0;f>=4;)_=1540483477*(65535&(_=255&l.charCodeAt(S)|(255&l.charCodeAt(++S))<<8|(255&l.charCodeAt(++S))<<16|(255&l.charCodeAt(++S))<<24))+((1540483477*(_>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),f-=4,++S;switch(f){case 3:b^=(255&l.charCodeAt(S+2))<<16;case 2:b^=(255&l.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&l.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),vo.exports);return Er.exports=u,Er.exports.murmur3=u,Er.exports.murmur2=o,Er.exports}());class dr{constructor(o,...l){ir(this,l[0]||{}),this.type=o}}class Pi extends dr{constructor(o,l={}){super("error",ir({error:o},l))}}function zc(u,o,l){l[u]&&-1!==l[u].indexOf(o)||(l[u]=l[u]||[],l[u].push(o))}function N_(u,o,l){if(l&&l[u]){const h=l[u].indexOf(o);-1!==h&&l[u].splice(h,1)}}class ln{on(o,l){return this._listeners=this._listeners||{},zc(o,l,this._listeners),this}off(o,l){return N_(o,l,this._listeners),N_(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},zc(o,l,this._oneTimeListeners),this):new Promise(h=>this.once(o,h))}fire(o,l){const h="string"==typeof o?new dr(o,l):o,_=h.type;if(this.listens(_)){h.target=this;const f=this._listeners&&this._listeners[_]?this._listeners[_].slice():[];for(const E of f)E.call(this,h);const b=this._oneTimeListeners&&this._oneTimeListeners[_]?this._oneTimeListeners[_].slice():[];for(const E of b)N_(_,E,this._oneTimeListeners),E.call(this,h);const S=this._eventedParent;S&&(ir(h,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),S.fire(h))}else h instanceof Pi&&console.error(h.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var _d,Ln={},$r=function(){if(_d)return Ln;_d=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(f){return(f=Math.round(f))<0?0:f>255?255:f}function l(f){return o("%"===f[f.length-1]?parseFloat(f)/100*255:parseInt(f))}function h(f){return(b="%"===f[f.length-1]?parseFloat(f)/100:parseFloat(f))<0?0:b>1?1:b;var b}function _(f,b,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?f+(b-f)*S*6:2*S<1?b:3*S<2?f+(b-f)*(2/3-S)*6:f}try{Ln.parseCSSColor=function(f){var b,S=f.replace(/ /g,"").toLowerCase();if(S in u)return u[S].slice();if("#"===S[0])return 4===S.length?(b=parseInt(S.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:7===S.length&&(b=parseInt(S.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var E=S.indexOf("("),R=S.indexOf(")");if(-1!==E&&R+1===S.length){var x=S.substr(0,E),I=S.substr(E+1,R-(E+1)).split(","),A=1;switch(x){case"rgba":if(4!==I.length)return null;A=h(I.pop());case"rgb":return 3!==I.length?null:[l(I[0]),l(I[1]),l(I[2]),A];case"hsla":if(4!==I.length)return null;A=h(I.pop());case"hsl":if(3!==I.length)return null;var D=(parseFloat(I[0])%360+360)%360/360,M=h(I[1]),L=h(I[2]),N=L<=.5?L*(M+1):L+M-L*M,V=2*L-N;return[o(255*_(V,N,D+1/3)),o(255*_(V,N,D)),o(255*_(V,N,D-1/3)),A];default:return null}}return null}}catch(f){}return Ln}();class mr{constructor(o,l,h,_=1){this.r=o,this.g=l,this.b=h,this.a=_}static parse(o){if(!o)return;if(o instanceof mr)return o;if("string"!=typeof o)return;const l=$r.parseCSSColor(o);return l?new mr(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,h,_]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(h)},${_})`}toRenderColor(o){const{r:l,g:h,b:_,a:f}=this;return new e1(o,l,h,_,f)}}class e1{constructor(o,l,h,_,f){if(o){const b=o.image.height,S=b*b;l=0===f?0:l/f*(b-1),h=0===f?0:h/f*(b-1),_=0===f?0:_/f*(b-1);const E=Math.floor(l),R=Math.floor(h),x=Math.floor(_),I=Math.ceil(l),A=Math.ceil(h),D=Math.ceil(_),M=l-E,L=h-R,N=_-x,V=o.image.data,q=4*(E+R*S+x*b),$=4*(E+R*S+D*b),U=4*(E+A*S+x*b),Z=4*(E+A*S+D*b),Y=4*(I+R*S+x*b),se=4*(I+R*S+D*b),ve=4*(I+A*S+x*b),W=4*(I+A*S+D*b);if(q<0||W>=V.length)throw new Error("out of range");this.r=Wn(Wn(Wn(V[q],V[$],N),Wn(V[U],V[Z],N),L),Wn(Wn(V[Y],V[se],N),Wn(V[ve],V[W],N),L),M)/255*f,this.g=Wn(Wn(Wn(V[q+1],V[$+1],N),Wn(V[U+1],V[Z+1],N),L),Wn(Wn(V[Y+1],V[se+1],N),Wn(V[ve+1],V[W+1],N),L),M)/255*f,this.b=Wn(Wn(Wn(V[q+2],V[$+2],N),Wn(V[U+2],V[Z+2],N),L),Wn(Wn(V[Y+2],V[se+2],N),Wn(V[ve+2],V[W+2],N),L),M)/255*f,this.a=f}else this.r=l,this.g=h,this.b=_,this.a=f}toArray(){const{r:o,g:l,b:h,a:_}=this;return 0===_?[0,0,0,0]:[255*o/_,255*l/_,255*h/_,_]}toArray01(){const{r:o,g:l,b:h,a:_}=this;return 0===_?[0,0,0,0]:[o/_,l/_,h/_,_]}toArray01Scaled(o){const{r:l,g:h,b:_,a:f}=this;return 0===f?[0,0,0]:[l/f*o,h/f*o,_/f*o]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:h,a:_}=this;return[o,l,h,_]}toArray01Linear(){const{r:o,g:l,b:h,a:_}=this;return 0===_?[0,0,0,0]:[Math.pow(o/_,2.2),Math.pow(l/_,2.2),Math.pow(h/_,2.2),_]}}function Wn(u,o,l){return u*(1-l)+o*l}function Vc(u,o,l){return u.map((h,_)=>Wn(h,o[_],l))}mr.black=new mr(0,0,0,1),mr.white=new mr(1,1,1,1),mr.transparent=new mr(0,0,0,0),mr.red=new mr(1,0,0,1),mr.blue=new mr(0,0,1,1);var fs=Object.freeze({__proto__:null,array:Vc,color:function(u,o,l){return new mr(Wn(u.r,o.r,l),Wn(u.g,o.g,l),Wn(u.b,o.b,l),Wn(u.a,o.a,l))},number:Wn});function Ph(u,...o){for(const l of o)for(const h in l)u[h]=l[h];return u}class El extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}class Vm{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[h,_]of l)this.bindings[h]=_}concat(o){return new Vm(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const ms={kind:"null"},In={kind:"number"},Xi={kind:"string"},Zi={kind:"boolean"},ja={kind:"color"},Ks={kind:"object"},Ji={kind:"value"},wf={kind:"collator"},Lh={kind:"formatted"},Ss={kind:"resolvedImage"};function Qi(u,o){return{kind:"array",itemType:u,N:o}}function zo(u){if("array"===u.kind){const o=zo(u.itemType);return"number"==typeof u.N?`array<${o}, ${u.N}>`:"value"===u.itemType.kind?"array":`array<${o}>`}return u.kind}const ev=[ms,In,Xi,Zi,ja,Lh,Ks,Qi(Ji),Ss];function Oh(u,o){if("error"===o.kind)return null;if("array"===u.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!Oh(u.itemType,o.itemType))&&("number"!=typeof u.N||u.N===o.N))return null}else{if(u.kind===o.kind)return null;if("value"===u.kind)for(const l of ev)if(!Oh(l,o))return null}return`Expected ${zo(u)} but found ${zo(o)} instead.`}function vn(u,o){return o.some(l=>l.kind===u.kind)}function dc(u,o){return o.some(l=>"null"===l?null===u:"array"===l?Array.isArray(u):"object"===l?u&&!Array.isArray(u)&&"object"==typeof u:l===typeof u)}class qn{constructor(o,l,h){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Js{constructor(o,l,h,_,f){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=h,this.fontStack=_,this.textColor=f}}class Qs{constructor(o){this.sections=o}static fromString(o){return new Qs([new Js(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.namePrimary.length)}static factory(o){return o instanceof Qs?o:Qs.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.namePrimary]);continue}o.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toRenderColor(null).toArray())),o.push(h)}return o}}class ea{constructor(o){this.namePrimary=o.namePrimary,o.nameSecondary&&(this.nameSecondary=o.nameSecondary),this.available=o.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(o,l){return o?new ea({namePrimary:o,nameSecondary:l,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function B_(u,o,l,h){return"number"==typeof u&&u>=0&&u<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[u,o,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[u,o,l,h]:[u,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function jc(u){if(null===u||"string"==typeof u||"boolean"==typeof u||"number"==typeof u||u instanceof mr||u instanceof qn||u instanceof Qs||u instanceof ea)return!0;if(Array.isArray(u)){for(const o of u)if(!jc(o))return!1;return!0}if("object"==typeof u){for(const o in u)if(!jc(u[o]))return!1;return!0}return!1}function Vo(u){if(null===u)return ms;if("string"==typeof u)return Xi;if("boolean"==typeof u)return Zi;if("number"==typeof u)return In;if(u instanceof mr)return ja;if(u instanceof qn)return wf;if(u instanceof Qs)return Lh;if(u instanceof ea)return Ss;if(Array.isArray(u)){const o=u.length;let l;for(const h of u){const _=Vo(h);if(l){if(l===_)continue;l=Ji;break}l=_}return Qi(l||Ji,o)}return Ks}function Ts(u){const o=typeof u;return null===u?"":"string"===o||"number"===o||"boolean"===o?String(u):u instanceof mr||u instanceof Qs||u instanceof ea?u.toString():JSON.stringify(u)}class Ua{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!jc(o[1]))return l.error("invalid value");const h=o[1];let _=Vo(h);const f=l.expectedType;return"array"!==_.kind||0!==_.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(_=f),new Ua(_,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof mr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Qs?this.value.serialize():this.value}}class ts{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const jm={string:Xi,number:In,boolean:Zi,object:Ks};class hi{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let h,_=1;const f=o[0];if("array"===f){let S,E;if(o.length>2){const R=o[1];if("string"!=typeof R||!(R in jm)||"object"===R)return l.error('The item type argument of "array" must be one of string, number, boolean',1);S=jm[R],_++}else S=Ji;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);E=o[2],_++}h=Qi(S,E)}else h=jm[f];const b=[];for(;_<o.length;_++){const S=l.parse(o[_],_,Ji);if(!S)return null;b.push(S)}return new hi(h,b)}evaluate(o){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(o);if(!Oh(this.type,Vo(h)))return h;if(l===this.args.length-1)throw new ts(`The expression ${JSON.stringify(this.args[l].serialize())} evaluated to ${zo(Vo(h))} but was expected to be of type ${zo(this.type)}.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const h=o.itemType;if("string"===h.kind||"number"===h.kind||"boolean"===h.kind){l.push(h.kind);const _=o.N;("number"==typeof _||this.args.length>1)&&l.push(_)}}return l.concat(this.args.map(h=>h.serialize()))}}class Uc{constructor(o){this.type=Lh,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const h=o[1];if(!Array.isArray(h)&&"object"==typeof h)return l.error("First argument must be an image or text section.");const _=[];let f=!1;for(let b=1;b<=o.length-1;++b){const S=o[b];if(f&&"object"==typeof S&&!Array.isArray(S)){f=!1;let E=null;if(S["font-scale"]&&(E=l.parseObjectValue(S["font-scale"],b,"font-scale",In),!E))return null;let R=null;if(S["text-font"]&&(R=l.parseObjectValue(S["text-font"],b,"text-font",Qi(Xi)),!R))return null;let x=null;if(S["text-color"]&&(x=l.parseObjectValue(S["text-color"],b,"text-color",ja),!x))return null;const I=_[_.length-1];I.scale=E,I.font=R,I.textColor=x}else{const E=l.parse(o[b],b,Ji);if(!E)return null;const R=E.type.kind;if("string"!==R&&"value"!==R&&"null"!==R&&"resolvedImage"!==R)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,_.push({content:E,scale:null,font:null,textColor:null})}}return new Uc(_)}evaluate(o){return new Qs(this.sections.map(l=>{const h=l.content.evaluate(o);return Vo(h)===Ss?new Js("",h,null,null,null):new Js(Ts(h),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),o.push(h)}return o}}class Du{constructor(o,l){this.type=Ss,this.inputPrimary=o,this.inputSecondary=l}static parse(o,l){if(o.length<2)return l.error("Expected two or more arguments.");const h=l.parse(o[1],1,Xi);if(!h)return l.error("No image name provided.");if(2===o.length)return new Du(h);const _=l.parse(o[2],1,Xi);return _?new Du(h,_):l.error("Secondary image variant is not a string.")}evaluate(o){const l=ea.fromString(this.inputPrimary.evaluate(o),this.inputSecondary?this.inputSecondary.evaluate(o):void 0);return l&&o.availableImages&&(l.available=o.availableImages.indexOf(l.namePrimary)>-1,l.nameSecondary&&l.available&&o.availableImages&&(l.available=o.availableImages.indexOf(l.nameSecondary)>-1)),l}eachChild(o){o(this.inputPrimary),this.inputSecondary&&o(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Cs(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":null===u?"null":typeof u}const Fh={"to-boolean":Zi,"to-color":ja,"to-number":In,"to-string":Xi};class Hc{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const h=o[0],_=[];let f=ms;if("to-array"===h){if(!Array.isArray(o[1]))return null;const b=o[1].length;if(l.expectedType){if("array"!==l.expectedType.kind)return l.error(`Expected ${l.expectedType.kind} but found array.`);f=Qi(l.expectedType.itemType,b)}else{if(!(b>0&&jc(o[1][0])))return null;f=Qi(Vo(o[1][0]),b)}for(let S=0;S<b;S++){const E=o[1][S];let R;if("array"===Cs(E))R=l.parse(E,void 0,f.itemType);else{const x=Cs(E);if(x!==f.itemType.kind)return l.error(`Expected ${f.itemType.kind} but found ${x}.`);R=l.registry.literal.parse(["literal",void 0===E?null:E],l)}if(!R)return null;_.push(R)}}else{if(("to-boolean"===h||"to-string"===h)&&2!==o.length)return l.error("Expected one argument.");f=Fh[h];for(let b=1;b<o.length;b++){const S=l.parse(o[b],b,Ji);if(!S)return null;_.push(S)}}return new Hc(f,_)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let l,h;for(const _ of this.args){if(l=_.evaluate(o),h=null,l instanceof mr)return l;if("string"==typeof l){const f=o.parseColor(l);if(f)return f}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:B_(l[0],l[1],l[2],l[3]),!h))return new mr(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ts(h||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const h of this.args){if(l=h.evaluate(o),null===l)return 0;const _=Number(l);if(!isNaN(_))return _}throw new ts(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Qs.fromString(Ts(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?ea.fromString(Ts(this.args[0].evaluate(o))):"array"===this.type.kind?this.args.map(l=>l.evaluate(o)):Ts(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Uc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Du(this.args[0]).serialize();const o="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}const Gc=["Unknown","Point","LineString","Polygon"];class ll{constructor(o,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=o,this.options=l}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Gc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(o){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:h,y:_}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*l-o[0])+this.featureDistanceData.bearing[1]*(_*l-o[1])}return 0}parseColor(o){let l=this._parseColorCache[o];return l||(l=this._parseColorCache[o]=mr.parse(o)),l}getConfig(o){return this.options?this.options.get(o):null}}class Ha{constructor(o,l,h,_,f){this.name=o,this.type=l,this._evaluate=h,this.args=_,this._overloadIndex=f}evaluate(o){if(!this._evaluate){const l=Ha.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const h=o[0],_=Ha.definitions[h];if(!_)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(_)?_[0]:_.type,b=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,S=[];let E=null,R=-1;for(const[x,I]of b){if(Array.isArray(x)&&x.length!==o.length-1)continue;S.push(x),R++,E=new tv(l.registry,l.path,null,l.scope,void 0,l._scope,l.options);const A=[];let D=!1;for(let M=1;M<o.length;M++){const L=o[M],N=Array.isArray(x)?x[M-1]:x.type,V=E.parse(L,1+A.length,N);if(!V){D=!0;break}A.push(V)}if(!D)if(Array.isArray(x)&&x.length!==A.length)E.error(`Expected ${x.length} arguments, but found ${A.length} instead.`);else{for(let M=0;M<A.length;M++){const L=Array.isArray(x)?x[M]:x.type,N=A[M];E.concat(M+1).checkSubtype(L,N.type)}if(0===E.errors.length)return new Ha(h,f,I,A,R)}}if(1===S.length)l.errors.push(...E.errors);else{const x=(S.length?S:b.map(([A])=>A)).map(t1).join(" | "),I=[];for(let A=1;A<o.length;A++){const D=l.parse(o[A],1+I.length);if(!D)return null;I.push(zo(D.type))}l.error(`Expected arguments of type ${x}, but found (${I.join(", ")}) instead.`)}return null}static register(o,l){Ha.definitions=l;for(const h in l)o[h]=Ha}}function t1(u){return Array.isArray(u)?`(${u.map(zo).join(", ")})`:`(${zo(u.type)}...)`}class Sa{constructor(o,l,h){this.type=wf,this.locale=h,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const h=o[1];if("object"!=typeof h||Array.isArray(h))return l.error("Collator options argument must be an object.");const _=void 0===h["case-sensitive"]?l.parse(!1,1,Zi):l.parseObjectValue(h["case-sensitive"],1,"case-sensitive",Zi);if(!_)return null;const f=void 0===h["diacritic-sensitive"]?l.parse(!1,1,Zi):l.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",Zi);if(!f)return null;let b=null;return h.locale&&(b=l.parseObjectValue(h.locale,1,"locale",Xi),!b)?null:new Sa(_,f,b)}evaluate(o){return new qn(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}function To(u,o,l=0,h=u.length-1,_=Bh){for(;h>l;){if(h-l>600){const E=h-l+1,R=o-l+1,x=Math.log(E),I=.5*Math.exp(2*x/3),A=.5*Math.sqrt(x*I*(E-I)/E)*(R-E/2<0?-1:1);To(u,o,Math.max(l,Math.floor(o-R*I/E+A)),Math.min(h,Math.floor(o+(E-R)*I/E+A)),_)}const f=u[o];let b=l,S=h;for(Nh(u,l,o),_(u[h],f)>0&&Nh(u,l,h);b<S;){for(Nh(u,b,S),b++,S--;_(u[b],f)<0;)b++;for(;_(u[S],f)>0;)S--}0===_(u[l],f)?Nh(u,l,S):(S++,Nh(u,S,h)),S<=o&&(l=S+1),o<=S&&(h=S-1)}}function Nh(u,o,l){const h=u[o];u[o]=u[l],u[l]=h}function Bh(u,o){return u<o?-1:u>o?1:0}function bd(u){let o=0;for(let l,h,_=0,f=u.length,b=f-1;_<f;b=_++)l=u[_],h=u[b],o+=(h.x-l.x)*(l.y+h.y);return o}function Or(u,o){u[0]=Math.min(u[0],o[0]),u[1]=Math.min(u[1],o[1]),u[2]=Math.max(u[2],o[0]),u[3]=Math.max(u[3],o[1])}function $l(u,o){return!(u[0]<=o[0]||u[2]>=o[2]||u[1]<=o[1]||u[3]>=o[3])}function Um(u,o,l){const h=u[0]-o[0],_=u[1]-o[1],f=u[0]-l[0],b=u[1]-l[1];return h*b-f*_==0&&h*f<=0&&_*b<=0}function qc(u,o,l=!1){let h=!1;for(let S=0,E=o.length;S<E;S++){const R=o[S];for(let x=0,I=R.length,A=I-1;x<I;A=x++){const D=R[A],M=R[x];if(Um(u,D,M))return l;(f=D)[1]>(_=u)[1]!=(b=M)[1]>_[1]&&_[0]<(b[0]-f[0])*(_[1]-f[1])/(b[1]-f[1])+f[0]&&(h=!h)}}var _,f,b;return h}function Hm(u,o,l,h){const _=h[0]-l[0],f=h[1]-l[1],b=(u[0]-l[0])*f-_*(u[1]-l[1]),S=(o[0]-l[0])*f-_*(o[1]-l[1]);return b>0&&S<0||b<0&&S>0}function cl(u,o,l,h){return(_=[h[0]-l[0],h[1]-l[1]])[0]*(f=[o[0]-u[0],o[1]-u[1]])[1]-_[1]*f[0]!=0&&!(!Hm(u,o,l,h)||!Hm(l,h,u,o));var _,f}const Bs=8192;function Li(u,o){const l=(180+u[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,_=Math.pow(2,o.z);return[Math.round(l*_*Bs),Math.round(h*_*Bs)]}function Ut(u,o){for(let l=0;l<o.length;l++)if(qc(u,o[l]))return!0;return!1}function Gm(u,o,l){for(const h of l)for(let _=0,f=h.length,b=f-1;_<f;b=_++)if(cl(u,o,h[b],h[_]))return!0;return!1}function li(u,o){for(let l=0;l<u.length;++l)if(!qc(u[l],o))return!1;for(let l=0;l<u.length-1;++l)if(Gm(u[l],u[l+1],o))return!1;return!0}function Sf(u,o){for(let l=0;l<o.length;l++)if(li(u,o[l]))return!0;return!1}function $n(u,o,l){const h=[];for(let _=0;_<u.length;_++){const f=[];for(let b=0;b<u[_].length;b++){const S=Li(u[_][b],l);Or(o,S),f.push(S)}h.push(f)}return h}function ni(u,o,l){const h=[];for(let _=0;_<u.length;_++){const f=$n(u[_],o,l);h.push(f)}return h}function Tf(u,o,l,h){if(u[0]<l[0]||u[0]>l[2]){const _=.5*h;let f=u[0]-l[0]>_?-h:l[0]-u[0]>_?h:0;0===f&&(f=u[0]-l[2]>_?-h:l[2]-u[0]>_?h:0),u[0]+=f}Or(o,u)}function cn(u,o,l,h){const _=Math.pow(2,h.z)*Bs,f=[h.x*Bs,h.y*Bs],b=[];if(!u)return b;for(const S of u)for(const E of S){const R=[E.x+f[0],E.y+f[1]];Tf(R,o,l,_),b.push(R)}return b}function ta(u,o,l,h){const _=Math.pow(2,h.z)*Bs,f=[h.x*Bs,h.y*Bs],b=[];if(!u)return b;for(const E of u){const R=[];for(const x of E){const I=[x.x+f[0],x.y+f[1]];Or(o,I),R.push(I)}b.push(R)}if(o[2]-o[0]<=_/2){(S=o)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const E of b)for(const R of E)Tf(R,o,l,_)}var S;return b}class Ir{constructor(o,l){this.type=Zi,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(jc(o[1])){const h=o[1];if("FeatureCollection"===h.type)for(let _=0;_<h.features.length;++_){const f=h.features[_].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Ir(h,h.features[_].geometry)}else if("Feature"===h.type){const _=h.geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new Ir(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new Ir(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,h){const _=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===h.type){const S=$n(h.coordinates,f,b),E=cn(l.geometry(),_,f,b);if(!$l(_,f))return!1;for(const R of E)if(!qc(R,S))return!1}if("MultiPolygon"===h.type){const S=ni(h.coordinates,f,b),E=cn(l.geometry(),_,f,b);if(!$l(_,f))return!1;for(const R of E)if(!Ut(R,S))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,h){const _=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===h.type){const S=$n(h.coordinates,f,b),E=ta(l.geometry(),_,f,b);if(!$l(_,f))return!1;for(const R of E)if(!li(R,S))return!1}if("MultiPolygon"===h.type){const S=ni(h.coordinates,f,b),E=ta(l.geometry(),_,f,b);if(!$l(_,f))return!1;for(const R of E)if(!Sf(R,S))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ns={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},so=1/298.257223563,hc=so*(2-so),Ds=Math.PI/180;class pc{static fromTile(o,l,h){const _=Math.PI*(1-2*(o+.5)/Math.pow(2,l)),f=Math.atan(.5*(Math.exp(_)-Math.exp(-_)))/Ds;return new pc(f,h)}static get units(){return ns}constructor(o,l){if(void 0===o)throw new Error("No latitude given.");if(l&&!ns[l])throw new Error(`Unknown unit ${l}. Use one of: ${Object.keys(ns).join(", ")}`);const h=6378.137*Ds*(l?ns[l]:1),_=Math.cos(o*Ds),f=1/(1-hc*(1-_*_)),b=Math.sqrt(f);this.kx=h*b*_,this.ky=h*b*f*(1-hc)}distance(o,l){const h=po(o[0]-l[0])*this.kx,_=(o[1]-l[1])*this.ky;return Math.sqrt(h*h+_*_)}bearing(o,l){const h=po(l[0]-o[0])*this.kx;return Math.atan2(h,(l[1]-o[1])*this.ky)/Ds}destination(o,l,h){const _=h*Ds;return this.offset(o,Math.sin(_)*l,Math.cos(_)*l)}offset(o,l,h){return[o[0]+l/this.kx,o[1]+h/this.ky]}lineDistance(o){let l=0;for(let h=0;h<o.length-1;h++)l+=this.distance(o[h],o[h+1]);return l}area(o){let l=0;for(let h=0;h<o.length;h++){const _=o[h];for(let f=0,b=_.length,S=b-1;f<b;S=f++)l+=po(_[f][0]-_[S][0])*(_[f][1]+_[S][1])*(h?-1:1)}return Math.abs(l)/2*this.kx*this.ky}along(o,l){let h=0;if(l<=0)return o[0];for(let _=0;_<o.length-1;_++){const f=o[_],b=o[_+1],S=this.distance(f,b);if(h+=S,h>l)return Ga(f,b,(l-(h-S))/S)}return o[o.length-1]}pointToSegmentDistance(o,l,h){let[_,f]=l,b=po(h[0]-_)*this.kx,S=(h[1]-f)*this.ky;if(0!==b||0!==S){const E=(po(o[0]-_)*this.kx*b+(o[1]-f)*this.ky*S)/(b*b+S*S);E>1?(_=h[0],f=h[1]):E>0&&(_+=b/this.kx*E,f+=S/this.ky*E)}return b=po(o[0]-_)*this.kx,S=(o[1]-f)*this.ky,Math.sqrt(b*b+S*S)}pointOnLine(o,l){let h=1/0,_=o[0][0],f=o[0][1],b=0,S=0;for(let E=0;E<o.length-1;E++){let R=o[E][0],x=o[E][1],I=po(o[E+1][0]-R)*this.kx,A=(o[E+1][1]-x)*this.ky,D=0;0===I&&0===A||(D=(po(l[0]-R)*this.kx*I+(l[1]-x)*this.ky*A)/(I*I+A*A),D>1?(R=o[E+1][0],x=o[E+1][1]):D>0&&(R+=I/this.kx*D,x+=A/this.ky*D)),I=po(l[0]-R)*this.kx,A=(l[1]-x)*this.ky;const M=I*I+A*A;M<h&&(h=M,_=R,f=x,b=E,S=D)}return{point:[_,f],index:b,t:Math.max(0,Math.min(1,S))}}lineSlice(o,l,h){let _=this.pointOnLine(h,o),f=this.pointOnLine(h,l);if(_.index>f.index||_.index===f.index&&_.t>f.t){const R=_;_=f,f=R}const b=[_.point],S=_.index+1,E=f.index;!yd(h[S],b[0])&&S<=E&&b.push(h[S]);for(let R=S+1;R<=E;R++)b.push(h[R]);return yd(h[E],f.point)||b.push(f.point),b}lineSliceAlong(o,l,h){let _=0;const f=[];for(let b=0;b<h.length-1;b++){const S=h[b],E=h[b+1],R=this.distance(S,E);if(_+=R,_>o&&0===f.length&&f.push(Ga(S,E,(o-(_-R))/R)),_>=l)return f.push(Ga(S,E,(l-(_-R))/R)),f;_>o&&f.push(E)}return f}bufferPoint(o,l){const h=l/this.ky,_=l/this.kx;return[o[0]-_,o[1]-h,o[0]+_,o[1]+h]}bufferBBox(o,l){const h=l/this.ky,_=l/this.kx;return[o[0]-_,o[1]-h,o[2]+_,o[3]+h]}insideBBox(o,l){return po(o[0]-l[0])>=0&&po(o[0]-l[2])<=0&&o[1]>=l[1]&&o[1]<=l[3]}}function yd(u,o){return u[0]===o[0]&&u[1]===o[1]}function Ga(u,o,l){const h=po(o[0]-u[0]);return[u[0]+h*l,u[1]+(o[1]-u[1])*l]}function po(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class fc{constructor(o=[],l=((h,_)=>h<_?-1:h>_?1:0)){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:h}=this,_=l[o];for(;o>0;){const f=o-1>>1,b=l[f];if(h(_,b)>=0)break;l[o]=b,o=f}l[o]=_}_down(o){const{data:l,compare:h}=this,_=this.length>>1,f=l[o];for(;o<_;){let b=1+(o<<1);const S=b+1;if(S<this.length&&h(l[S],l[b])<0&&(b=S),h(l[b],f)>=0)break;l[o]=l[b],o=b}l[o]=f}}var Jt=8192;function z_(u,o){return o.dist-u.dist}function Yi(u){const o=[1/0,1/0,-1/0,-1/0];if(o.length!==u.length)return!1;for(let l=0;l<o.length;l++)if(o[l]!==u[l])return!1;return!0}function Co(u){return u[1]-u[0]+1}function is(u,o){const l=u[1]>=u[0]&&u[1]<o;return l||console.warn("Distance Expression: Index is out of range"),l}function mc(u,o){if(u[0]>u[1])return[null,null];const l=Co(u);if(o){if(2===l)return[u,null];const h=Math.floor(l/2);return[[u[0],u[0]+h],[u[0]+h,u[1]]]}{if(1===l)return[u,null];const h=Math.floor(l/2)-1;return[[u[0],u[0]+h],[u[0]+h+1,u[1]]]}}function fo(u,o){const l=[1/0,1/0,-1/0,-1/0];if(!is(o,u.length))return l;for(let h=o[0];h<=o[1];++h)Or(l,u[h]);return l}function Wl(u){const o=[1/0,1/0,-1/0,-1/0];for(let l=0;l<u.length;++l)for(let h=0;h<u[l].length;++h)Or(o,u[l][h]);return o}function Do(u,o,l){if(Yi(u)||Yi(o))return NaN;let h=0,_=0;return u[2]<o[0]&&(h=o[0]-u[2]),u[0]>o[2]&&(h=u[0]-o[2]),u[1]>o[3]&&(_=u[1]-o[3]),u[3]<o[1]&&(_=o[1]-u[3]),l.distance([0,0],[h,_])}function vd(u){return 360*u-180}function xd(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Ai(u,o){const l=Math.pow(2,o.z),h=(u.y/Jt+o.y)/l;return[vd((u.x/Jt+o.x)/l),xd(h)]}function zh(u,o){const l=[];for(let h=0;h<u.length;++h)l.push(Ai(u[h],o));return l}function $c(u,o,l){const h=l.pointOnLine(o,u).point;return l.distance(u,h)}function Vh(u,o,l,h,_){const f=l.slice(h[0],h[1]+1);let b=1/0;for(let S=o[0];S<=o[1];++S)if(0===(b=Math.min(b,$c(u[S],f,_))))return 0;return b}function Xl(u,o,l,h,_){const f=Math.min(_.pointToSegmentDistance(u,l,h),_.pointToSegmentDistance(o,l,h)),b=Math.min(_.pointToSegmentDistance(l,u,o),_.pointToSegmentDistance(h,u,o));return Math.min(f,b)}function Vs(u,o,l,h,_){if(!is(o,u.length)||!is(h,l.length))return NaN;let f=1/0;for(let b=o[0];b<o[1];++b)for(let S=h[0];S<h[1];++S){if(cl(u[b],u[b+1],l[S],l[S+1]))return 0;f=Math.min(f,Xl(u[b],u[b+1],l[S],l[S+1],_))}return f}function wd(u,o,l,h,_){if(!is(o,u.length)||!is(h,l.length))return NaN;let f=1/0;for(let b=o[0];b<=o[1];++b)for(let S=h[0];S<=h[1];++S)if(0===(f=Math.min(f,_.distance(u[b],l[S]))))return f;return f}function Eu(u,o,l){if(qc(u,o,!0))return 0;let h=1/0;for(const _ of o){const f=_.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(_[0]!==_[f-1]&&0===(h=Math.min(h,l.pointToSegmentDistance(u,_[f-1],_[0])))||0===(h=Math.min(h,$c(u,_,l))))return h}return h}function ul(u,o,l,h){if(!is(o,u.length))return NaN;for(let f=o[0];f<=o[1];++f)if(qc(u[f],l,!0))return 0;let _=1/0;for(let f=o[0];f<o[1];++f)for(const b of l)for(let S=0,E=b.length,R=E-1;S<E;R=S++){if(cl(u[f],u[f+1],b[R],b[S]))return 0;_=Math.min(_,Xl(u[f],u[f+1],b[R],b[S],h))}return _}function Wc(u,o){for(const l of u)for(let h=0;h<=l.length-1;++h)if(qc(l[h],o,!0))return!0;return!1}function qm(u,o,l,h=1/0){const _=Wl(u),f=Wl(o);if(h!==1/0&&Do(_,f,l)>=h)return h;if($l(_,f)){if(Wc(u,o))return 0}else if(Wc(o,u))return 0;let b=h;for(const S of u)for(let E=0,R=S.length,x=R-1;E<R;x=E++)for(const I of o)for(let A=0,D=I.length,M=D-1;A<D;M=A++){if(cl(S[x],S[E],I[M],I[A]))return 0;b=Math.min(b,Xl(S[x],S[E],I[M],I[A],l))}return b}function mo(u,o,l,h,_,f,b){if(null===f||null===b)return;const S=Do(fo(h,f),fo(_,b),l);S<o&&u.push({dist:S,range1:f,range2:b})}function Cf(u,o,l,h,_=1/0){let f=Math.min(h.distance(u[0],l[0][0]),_);if(0===f)return f;const b=new fc([{dist:0,range1:[0,u.length-1],range2:[0,0]}],z_),S=o?50:100,E=Wl(l);for(;b.length;){const R=b.pop();if(R.dist>=f)continue;const x=R.range1;if(Co(x)<=S){if(!is(x,u.length))return NaN;if(o){const I=ul(u,x,l,h);if(0===(f=Math.min(f,I)))return f}else for(let I=x[0];I<=x[1];++I){const A=Eu(u[I],l,h);if(0===(f=Math.min(f,A)))return f}}else{const I=mc(x,o);if(null!==I[0]){const A=Do(fo(u,I[0]),E,h);A<f&&b.push({dist:A,range1:I[0],range2:[0,0]})}if(null!==I[1]){const A=Do(fo(u,I[1]),E,h);A<f&&b.push({dist:A,range1:I[1],range2:[0,0]})}}}return f}function jh(u,o,l,h,_,f=1/0){let b=Math.min(f,_.distance(u[0],l[0]));if(0===b)return b;const S=new fc([{dist:0,range1:[0,u.length-1],range2:[0,l.length-1]}],z_),E=o?50:100,R=h?50:100;for(;S.length;){const x=S.pop();if(x.dist>=b)continue;const I=x.range1,A=x.range2;if(Co(I)<=E&&Co(A)<=R){if(!is(I,u.length)||!is(A,l.length))return NaN;if(o&&h?b=Math.min(b,Vs(u,I,l,A,_)):o||h?o&&!h?b=Math.min(b,Vh(l,A,u,I,_)):!o&&h&&(b=Math.min(b,Vh(u,I,l,A,_))):b=Math.min(b,wd(u,I,l,A,_)),0===b)return b}else{const D=mc(I,o),M=mc(A,h);mo(S,b,_,u,l,D[0],M[0]),mo(S,b,_,u,l,D[0],M[1]),mo(S,b,_,u,l,D[1],M[0]),mo(S,b,_,u,l,D[1],M[1])}}return b}function gs(u,o,l,h,_=1/0){let f=_;const b=fo(u,[0,u.length-1]);for(const S of l)if(!(f!==1/0&&Do(b,fo(S,[0,S.length-1]),h)>=f)&&(f=Math.min(f,jh(u,o,S,!0,h,f)),0===f))return f;return f}function ha(u,o,l,h,_=1/0){let f=_;const b=fo(u,[0,u.length-1]);for(const S of l){if(f!==1/0&&Do(b,Wl(S),h)>=f)continue;const E=Cf(u,o,S,h,f);if(isNaN(E))return E;if(0===(f=Math.min(f,E)))return f}return f}function Sd(u){return"Point"===u||"MultiPoint"===u||"LineString"===u||"MultiLineString"===u||"Polygon"===u||"MultiPolygon"===u}class Il{constructor(o,l){this.type=In,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'distance' expression requires either one argument, but found ' ${o.length-1} instead.`);if(jc(o[1])){const h=o[1];if("FeatureCollection"===h.type){for(let _=0;_<h.features.length;++_)if(Sd(h.features[_].geometry.type))return new Il(h,h.features[_].geometry)}else if("Feature"===h.type){if(Sd(h.geometry.type))return new Il(h,h.geometry)}else if(Sd(h.type))return new Il(h,h)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(o){const l=o.geometry(),h=o.canonicalID();if(null!=l&&null!=h){if("Point"===o.geometryType())return function(_,f,b){const S=[];for(const R of _)for(const x of R)S.push(Ai(x,f));const E=new pc(S[0][1],"meters");return"Point"===b.type||"MultiPoint"===b.type||"LineString"===b.type?jh(S,!1,"Point"===b.type?[b.coordinates]:b.coordinates,"LineString"===b.type,E):"MultiLineString"===b.type?gs(S,!1,b.coordinates,E):"Polygon"===b.type||"MultiPolygon"===b.type?ha(S,!1,"Polygon"===b.type?[b.coordinates]:b.coordinates,E):null}(l,h,this.geometries);if("LineString"===o.geometryType())return function(_,f,b){const S=[];for(const R of _){const x=[];for(const I of R)x.push(Ai(I,f));S.push(x)}const E=new pc(S[0][0][1],"meters");if("Point"===b.type||"MultiPoint"===b.type||"LineString"===b.type)return gs("Point"===b.type?[b.coordinates]:b.coordinates,"LineString"===b.type,S,E);if("MultiLineString"===b.type){let R=1/0;for(let x=0;x<b.coordinates.length;x++){const I=gs(b.coordinates[x],!0,S,E,R);if(isNaN(I))return I;if(0===(R=Math.min(R,I)))return R}return R}if("Polygon"===b.type||"MultiPolygon"===b.type){let R=1/0;for(let x=0;x<S.length;x++){const I=ha(S[x],!0,"Polygon"===b.type?[b.coordinates]:b.coordinates,E,R);if(isNaN(I))return I;if(0===(R=Math.min(R,I)))return R}return R}return null}(l,h,this.geometries);if("Polygon"===o.geometryType())return function(_,f,b){const S=[];for(const R of function(x,I){const A=x.length;if(A<=1)return[x];const D=[];let M,L;for(let N=0;N<A;N++){const V=bd(x[N]);0!==V&&(x[N].area=Math.abs(V),void 0===L&&(L=V<0),L===V<0?(M&&D.push(M),M=[x[N]]):M.push(x[N]))}return M&&D.push(M),D}(_)){const x=[];for(let I=0;I<R.length;++I)x.push(zh(R[I],f));S.push(x)}const E=new pc(S[0][0][0][1],"meters");if("Point"===b.type||"MultiPoint"===b.type||"LineString"===b.type)return ha("Point"===b.type?[b.coordinates]:b.coordinates,"LineString"===b.type,S,E);if("MultiLineString"===b.type){let R=1/0;for(let x=0;x<b.coordinates.length;x++){const I=ha(b.coordinates[x],!0,S,E,R);if(isNaN(I))return I;if(0===(R=Math.min(R,I)))return R}return R}return"Polygon"===b.type||"MultiPolygon"===b.type?function(R,x,I){let A=1/0;for(const D of R)for(const M of x){const L=qm(D,M,I,A);if(isNaN(L))return L;if(0===(A=Math.min(A,L)))return A}return A}("Polygon"===b.type?[b.coordinates]:b.coordinates,S,E):null}(l,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ml(u,o){switch(u){case"string":return Ts(o);case"number":return+o;case"boolean":return!!o;case"color":return mr.parse(o);case"formatted":return Qs.fromString(Ts(o));case"resolvedImage":return ea.fromString(Ts(o))}return o}function vi(u,o,l,h){return void 0!==h&&(u=h*Math.round(u/h)),void 0!==o&&u<o&&(u=o),void 0!==l&&u>l&&(u=l),u}class Td{constructor(o,l,h){this.type=o,this.key=l,this.scope=h}static parse(o,l){let h=l.expectedType;if(null==h&&(h=Ji),o.length<2||o.length>3)return l.error("Invalid number of arguments for 'config' expression.");const _=l.parse(o[1],1);if(!(_ instanceof Ua))return l.error("Key name of 'config' expression must be a string literal.");if(o.length>=3){const f=l.parse(o[2],2);return f instanceof Ua?new Td(h,Ts(_.value),Ts(f.value)):l.error("Scope of 'config' expression must be a string literal.")}return new Td(h,Ts(_.value))}evaluate(o){const l=[this.key,this.scope,o.scope].filter(Boolean).join("\x1f"),h=o.getConfig(l);if(!h)return null;const{type:_,value:f,values:b,minValue:S,maxValue:E,stepValue:R}=h,x=h.default.evaluate(o);let I=x;if(f){const A=o.scope;o.scope=(A||"").split("\x1f").slice(1).join("\x1f"),I=f.evaluate(o),o.scope=A}return _&&(I=Ml(_,I)),void 0===I||void 0===S&&void 0===E&&void 0===R||("number"==typeof I?I=vi(I,S,E,R):Array.isArray(I)&&(I=I.map(A=>"number"==typeof A?vi(A,S,E,R):A))),void 0!==f&&void 0!==I&&b&&!b.includes(I)&&(I=x,_&&(I=Ml(_,I))),(_&&_!==this.type||void 0!==I&&Vo(I)!==this.type)&&(I=Ml(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){const o=["config",this.key];return this.scope&&o.concat(this.key),o}}function Df(u){if(u instanceof Ha&&("get"===u.name&&1===u.args.length||"feature-state"===u.name||"has"===u.name&&1===u.args.length||"properties"===u.name||"geometry-type"===u.name||"id"===u.name||/^filter-/.test(u.name))||u instanceof Ir||u instanceof Il)return!1;let o=!0;return u.eachChild(l=>{o&&!Df(l)&&(o=!1)}),o}function Ef(u){if(u instanceof Ha&&"feature-state"===u.name)return!1;let o=!0;return u.eachChild(l=>{o&&!Ef(l)&&(o=!1)}),o}function Uh(u){if(u instanceof Td)return new Set([u.key]);let o=new Set;return u.eachChild(l=>{o=new Set([...o,...Uh(l)])}),o}function Hh(u,o){if(u instanceof Ha&&o.indexOf(u.name)>=0)return!1;let l=!0;return u.eachChild(h=>{l&&!Hh(h,o)&&(l=!1)}),l}class Ur{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const h=o[1];return l.scope.has(h)?new Ur(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class V_{constructor(o,l=[],h,_=new Vm,f=[],b,S){this.registry=o,this.path=l,this.key=l.map(E=>"string"==typeof E?`['${E}']`:`[${E}]`).join(""),this.scope=_,this.errors=f,this.expectedType=h,this._scope=b,this.options=S}parse(o,l,h,_,f={}){return l||h?this.concat(l,null,h,_)._parse(o,f):this._parse(o,f)}parseObjectValue(o,l,h,_,f,b={}){return this.concat(l,h,_,f)._parse(o,b)}_parse(o,l){function h(_,f,b){return"assert"===b?new hi(f,[_]):"coerce"===b?new Hc(f,[_]):_}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _="string"==typeof o[0]?this.registry[o[0]]:void 0;if(_){let f=_.parse(o,this);if(!f)return null;if(this.expectedType){const b=this.expectedType,S=f.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==S.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==S.kind&&"string"!==S.kind){if(this.checkSubtype(b,S))return null}else f=h(f,b,l.typeAnnotation||"coerce");else f=h(f,b,l.typeAnnotation||"assert")}if(!(f instanceof Ua)&&"resolvedImage"!==f.type.kind&&j_(f)){const b=new ll(this._scope,this.options);try{f=new Ua(f.type,f.evaluate(b))}catch(S){return this.error(S.message),null}}return f}return Hc.parse(["to-array",o],this)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,h,_){let f="number"==typeof o?this.path.concat(o):this.path;f="string"==typeof l?f.concat(l):f;const b=_?this.scope.concat(_):this.scope;return new V_(this.registry,f,h||null,b,this.errors,this._scope,this.options)}error(o,...l){const h=`${this.key}${l.map(_=>`[${_}]`).join("")}`;this.errors.push(new El(h,o))}checkSubtype(o,l){const h=Oh(o,l);return h&&this.error(h),h}}var tv=V_;function j_(u){if(u instanceof Ur)return j_(u.boundExpression);if(u instanceof Ha&&"error"===u.name||u instanceof Sa||u instanceof Ir||u instanceof Il||u instanceof Td)return!1;const o=u instanceof Hc||u instanceof hi;let l=!0;return u.eachChild(h=>{l=o?l&&j_(h):l&&h instanceof Ua}),!!l&&Df(u)&&Hh(u,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function $m(u,o){const l=u.length-1;let h,_,f=0,b=l,S=0;for(;f<=b;)if(S=Math.floor((f+b)/2),h=u[S],_=u[S+1],h<=o){if(S===l||o<_)return S;f=S+1}else{if(!(h>o))throw new ts("Input is not a number.");b=S-1}return 0}class If{constructor(o,l,h){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[_,f]of h)this.labels.push(_),this.outputs.push(f)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(o[1],1,In);if(!h)return null;const _=[];let f=null;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);for(let b=1;b<o.length;b+=2){const S=1===b?-1/0:o[b],E=o[b+1],R=b,x=b+1;if("number"!=typeof S)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(_.length&&_[_.length-1][0]>=S)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const I=l.parse(E,x,f);if(!I)return null;f=f||I.type,_.push([S,I])}return new If(f,h,_)}evaluate(o){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(o);const _=this.input.evaluate(o);if(_<=l[0])return h[0].evaluate(o);const f=l.length;return _>=l[f-1]?h[f-1].evaluate(o):h[$m(l,_)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}const rv=4/29,Gh=6/29,ov=3*Gh*Gh,r1=Math.PI/180,U_=180/Math.PI;function qh(u){return u>.008856451679035631?Math.pow(u,1/3):u/ov+rv}function H_(u){return u>Gh?u*u*u:ov*(u-rv)}function G_(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function q_(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Xc(u){const o=q_(u.r),l=q_(u.g),h=q_(u.b),_=qh((.4124564*o+.3575761*l+.1804375*h)/.95047),f=qh((.2126729*o+.7151522*l+.072175*h)/1);return{l:116*f-16,a:500*(_-f),b:200*(f-qh((.0193339*o+.119192*l+.9503041*h)/1.08883)),alpha:u.a}}function $_(u){let o=(u.l+16)/116,l=isNaN(u.a)?o:o+u.a/500,h=isNaN(u.b)?o:o-u.b/200;return o=1*H_(o),l=.95047*H_(l),h=1.08883*H_(h),new mr(G_(3.2404542*l-1.5371385*o-.4985314*h),G_(-.969266*l+1.8760108*o+.041556*h),G_(.0556434*l-.2040259*o+1.0572252*h),u.alpha)}function xo(u,o,l){const h=o-u;return u+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const Cd={forward:Xc,reverse:$_,interpolate:function(u,o,l){return{l:Wn(u.l,o.l,l),a:Wn(u.a,o.a,l),b:Wn(u.b,o.b,l),alpha:Wn(u.alpha,o.alpha,l)}}},$h={forward:function(u){const{l:o,a:l,b:h}=Xc(u),_=Math.atan2(h,l)*U_;return{h:_<0?_+360:_,c:Math.sqrt(l*l+h*h),l:o,alpha:u.a}},reverse:function(u){const o=u.h*r1,l=u.c;return $_({l:u.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:u.alpha})},interpolate:function(u,o,l){return{h:xo(u.h,o.h,l),c:Wn(u.c,o.c,l),l:Wn(u.l,o.l,l),alpha:Wn(u.alpha,o.alpha,l)}}};var W_=Object.freeze({__proto__:null,hcl:$h,lab:Cd});class Ta{constructor(o,l,h,_,f){this.type=o,this.operator=l,this.interpolation=h,this.input=_,this.labels=[],this.outputs=[];for(const[b,S]of f)this.labels.push(b),this.outputs.push(S)}static interpolationFactor(o,l,h,_){let f=0;if("exponential"===o.name)f=Mf(l,o.base,h,_);else if("linear"===o.name)f=Mf(l,1,h,_);else if("cubic-bezier"===o.name){const b=o.controlPoints;f=new an(b[0],b[1],b[2],b[3]).solve(Mf(l,1,h,_))}return f}static parse(o,l){let[h,_,f,...b]=o;if(!Array.isArray(_)||0===_.length)return l.error("Expected an interpolation type expression.",1);if("linear"===_[0])_={name:"linear"};else if("exponential"===_[0]){const R=_[1];if("number"!=typeof R)return l.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:R}}else{if("cubic-bezier"!==_[0])return l.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const R=_.slice(1);if(4!==R.length||R.some(x=>"number"!=typeof x||x<0||x>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:R}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(f=l.parse(f,2,In),!f)return null;const S=[];let E=null;"interpolate-hcl"===h||"interpolate-lab"===h?E=ja:l.expectedType&&"value"!==l.expectedType.kind&&(E=l.expectedType);for(let R=0;R<b.length;R+=2){const x=b[R],I=b[R+1],A=R+3,D=R+4;if("number"!=typeof x)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(S.length&&S[S.length-1][0]>=x)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const M=l.parse(I,D,E);if(!M)return null;E=E||M.type,S.push([x,M])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Ta(E,h,_,f,S):l.error(`Type ${zo(E)} is not interpolatable.`)}evaluate(o){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(o);const _=this.input.evaluate(o);if(_<=l[0])return h[0].evaluate(o);const f=l.length;if(_>=l[f-1])return h[f-1].evaluate(o);const b=$m(l,_),S=Ta.interpolationFactor(this.interpolation,_,l[b],l[b+1]),E=h[b].evaluate(o),R=h[b+1].evaluate(o);return"interpolate"===this.operator?fs[this.type.kind.toLowerCase()](E,R,S):"interpolate-hcl"===this.operator?$h.reverse($h.interpolate($h.forward(E),$h.forward(R),S)):Cd.reverse(Cd.interpolate(Cd.forward(E),Cd.forward(R),S))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function Mf(u,o,l,h){const _=h-l,f=u-l;return 0===_?0:1===o?f/_:(Math.pow(o,f)-1)/(Math.pow(o,_)-1)}class Af{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let h=null;const _=l.expectedType;_&&"value"!==_.kind&&(h=_);const f=[];for(const S of o.slice(1)){const E=l.parse(S,1+f.length,h,void 0,{typeAnnotation:"omit"});if(!E)return null;h=h||E.type,f.push(E)}const b=_&&f.some(S=>Oh(_,S.type));return new Af(b?Ji:h,f)}evaluate(o){let l,h=null,_=0;for(const f of this.args){if(_++,h=f.evaluate(o),h&&h instanceof ea&&!h.available&&(l||(l=h),h=null,_===this.args.length))return l;if(null!==h)break}return h}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class Dd{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const h=[];for(let f=1;f<o.length-1;f+=2){const b=o[f];if("string"!=typeof b)return l.error(`Expected string, but found ${typeof b} instead.`,f);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",f);const S=l.parse(o[f+1],f+1);if(!S)return null;h.push([b,S])}const _=l.parse(o[o.length-1],o.length-1,l.expectedType,h);return _?new Dd(h,_):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,h]of this.bindings)o.push(l,h.serialize());return o.push(this.result.serialize()),o}}class Wm{constructor(o,l,h){this.type=o,this.index=l,this.input=h}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const h=l.parse(o[1],1,In),_=l.parse(o[2],2,Qi(l.expectedType||Ji));return h&&_?new Wm(_.type.itemType,h,_):null}evaluate(o){const l=this.index.evaluate(o),h=this.input.evaluate(o);if(l<0)throw new ts(`Array index out of bounds: ${l} < 0.`);if(l>h.length-1)throw new ts(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l===Math.floor(l))return h[l];const _=Math.floor(l),f=Math.ceil(l),b=h[_],S=h[f];if("number"!=typeof b||"number"!=typeof S)throw new ts(`Cannot interpolate between non-number values at index ${l}.`);const E=l-_;return b*(1-E)+S*E}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ca{constructor(o,l){this.type=Zi,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const h=l.parse(o[1],1,Ji),_=l.parse(o[2],2,Ji);return h&&_?vn(h.type,[Zi,Xi,In,ms,Ji])?new Ca(h,_):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${zo(h.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),h=this.haystack.evaluate(o);if(null==h)return!1;if(!dc(l,["boolean","string","number","null"]))throw new ts(`Expected first argument to be of type boolean, string, number or null, but found ${zo(Vo(l))} instead.`);if(!dc(h,["string","array"]))throw new ts(`Expected second argument to be of type array or string, but found ${zo(Vo(h))} instead.`);return h.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ed{constructor(o,l,h){this.type=In,this.needle=o,this.haystack=l,this.fromIndex=h}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const h=l.parse(o[1],1,Ji),_=l.parse(o[2],2,Ji);if(!h||!_)return null;if(!vn(h.type,[Zi,Xi,In,ms,Ji]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${zo(h.type)} instead`);if(4===o.length){const f=l.parse(o[3],3,In);return f?new Ed(h,_,f):null}return new Ed(h,_)}evaluate(o){const l=this.needle.evaluate(o),h=this.haystack.evaluate(o);if(!dc(l,["boolean","string","number","null"]))throw new ts(`Expected first argument to be of type boolean, string, number or null, but found ${zo(Vo(l))} instead.`);if(!dc(h,["string","array"]))throw new ts(`Expected second argument to be of type array or string, but found ${zo(Vo(h))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(o);return h.indexOf(l,_)}return h.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Xm{constructor(o,l,h,_,f,b){this.inputType=o,this.type=l,this.input=h,this.cases=_,this.outputs=f,this.otherwise=b}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let h,_;l.expectedType&&"value"!==l.expectedType.kind&&(_=l.expectedType);const f={},b=[];for(let R=2;R<o.length-1;R+=2){let x=o[R];const I=o[R+1];Array.isArray(x)||(x=[x]);const A=l.concat(R);if(0===x.length)return A.error("Expected at least one branch label.");for(const M of x){if("number"!=typeof M&&"string"!=typeof M)return A.error("Branch labels must be numbers or strings.");if("number"==typeof M&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof M&&Math.floor(M)!==M)return A.error("Numeric branch labels must be integer values.");if(h){if(A.checkSubtype(h,Vo(M)))return null}else h=Vo(M);if(void 0!==f[String(M)])return A.error("Branch labels must be unique.");f[String(M)]=b.length}const D=l.parse(I,R,_);if(!D)return null;_=_||D.type,b.push(D)}const S=l.parse(o[1],1,Ji);if(!S)return null;const E=l.parse(o[o.length-1],o.length-1,_);return E?"value"!==S.type.kind&&l.concat(1).checkSubtype(h,S.type)?null:new Xm(h,_,S,f,b,E):null}evaluate(o){const l=this.input.evaluate(o);return(Vo(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],_={};for(const b of l){const S=_[this.cases[b]];void 0===S?(_[this.cases[b]]=h.length,h.push([this.cases[b],[b]])):h[S][1].push(b)}const f=b=>"number"===this.inputType.kind?Number(b):b;for(const[b,S]of h)o.push(1===S.length?f(S[0]):S.map(f)),o.push(this.outputs[b].serialize());return o.push(this.otherwise.serialize()),o}}class Iu{constructor(o,l,h){this.type=o,this.branches=l,this.otherwise=h}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&"value"!==l.expectedType.kind&&(h=l.expectedType);const _=[];for(let b=1;b<o.length-1;b+=2){const S=l.parse(o[b],b,Zi);if(!S)return null;const E=l.parse(o[b+1],b+1,h);if(!E)return null;_.push([S,E]),h=h||E.type}const f=l.parse(o[o.length-1],o.length-1,h);return f?new Iu(h,_,f):null}evaluate(o){for(const[l,h]of this.branches)if(l.evaluate(o))return h.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,h]of this.branches)o(l),o(h);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class Rf{constructor(o,l,h,_){this.type=o,this.input=l,this.beginIndex=h,this.endIndex=_}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const h=l.parse(o[1],1,Ji),_=l.parse(o[2],2,In);if(!h||!_)return null;if(!vn(h.type,[Qi(Ji),Xi,Ji]))return l.error(`Expected first argument to be of type array or string, but found ${zo(h.type)} instead`);if(4===o.length){const f=l.parse(o[3],3,In);return f?new Rf(h.type,h,_,f):null}return new Rf(h.type,h,_)}evaluate(o){const l=this.input.evaluate(o),h=this.beginIndex.evaluate(o);if(!dc(l,["string","array"]))throw new ts(`Expected first argument to be of type array or string, but found ${zo(Vo(l))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(o);return l.slice(h,_)}return l.slice(h)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function X_(u,o){return"=="===u||"!="===u?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function rs(u,o,l,h){return 0===h.compare(o,l)}function Id(u,o,l){const h="=="!==u&&"!="!==u;return class RB{constructor(f,b,S){this.type=Zi,this.lhs=f,this.rhs=b,this.collator=S,this.hasUntypedArgument="value"===f.type.kind||"value"===b.type.kind}static parse(f,b){if(3!==f.length&&4!==f.length)return b.error("Expected two or three arguments.");const S=f[0];let E=b.parse(f[1],1,Ji);if(!E)return null;if(!X_(S,E.type))return b.concat(1).error(`"${S}" comparisons are not supported for type '${zo(E.type)}'.`);let R=b.parse(f[2],2,Ji);if(!R)return null;if(!X_(S,R.type))return b.concat(2).error(`"${S}" comparisons are not supported for type '${zo(R.type)}'.`);if(E.type.kind!==R.type.kind&&"value"!==E.type.kind&&"value"!==R.type.kind)return b.error(`Cannot compare types '${zo(E.type)}' and '${zo(R.type)}'.`);h&&("value"===E.type.kind&&"value"!==R.type.kind?E=new hi(R.type,[E]):"value"!==E.type.kind&&"value"===R.type.kind&&(R=new hi(E.type,[R])));let x=null;if(4===f.length){if("string"!==E.type.kind&&"string"!==R.type.kind&&"value"!==E.type.kind&&"value"!==R.type.kind)return b.error("Cannot use collator to compare non-string types.");if(x=b.parse(f[3],3,wf),!x)return null}return new RB(E,R,x)}evaluate(f){const b=this.lhs.evaluate(f),S=this.rhs.evaluate(f);if(h&&this.hasUntypedArgument){const E=Vo(b),R=Vo(S);if(E.kind!==R.kind||"string"!==E.kind&&"number"!==E.kind)throw new ts(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${E.kind}, ${R.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const E=Vo(b),R=Vo(S);if("string"!==E.kind||"string"!==R.kind)return o(f,b,S)}return this.collator?l(f,b,S,this.collator.evaluate(f)):o(f,b,S)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[u];return this.eachChild(b=>{f.push(b.serialize())}),f}}}const o1=Id("==",function(u,o,l){return o===l},rs),Wh=Id("!=",function(u,o,l){return o!==l},function(u,o,l,h){return!rs(0,o,l,h)}),Da=Id("<",function(u,o,l){return o<l},function(u,o,l,h){return h.compare(o,l)<0}),Md=Id(">",function(u,o,l){return o>l},function(u,o,l,h){return h.compare(o,l)>0}),kf=Id("<=",function(u,o,l){return o<=l},function(u,o,l,h){return h.compare(o,l)<=0}),Mu=Id(">=",function(u,o,l){return o>=l},function(u,o,l,h){return h.compare(o,l)>=0});class pa{constructor(o,l,h,_,f,b){this.type=Xi,this.number=o,this.locale=l,this.currency=h,this.unit=_,this.minFractionDigits=f,this.maxFractionDigits=b}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const h=l.parse(o[1],1,In);if(!h)return null;const _=o[2];if("object"!=typeof _||Array.isArray(_))return l.error("NumberFormat options argument must be an object.");let f=null;if(_.locale&&(f=l.parseObjectValue(_.locale,2,"locale",Xi),!f))return null;let b=null;if(_.currency&&(b=l.parseObjectValue(_.currency,2,"currency",Xi),!b))return null;let S=null;if(_.unit&&(S=l.parseObjectValue(_.unit,2,"unit",Xi),!S))return null;let E=null;if(_["min-fraction-digits"]&&(E=l.parseObjectValue(_["min-fraction-digits"],2,"min-fraction-digits",In),!E))return null;let R=null;return _["max-fraction-digits"]&&(R=l.parseObjectValue(_["max-fraction-digits"],2,"max-fraction-digits",In),!R)?null:new pa(h,f,b,S,E,R)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Xh{constructor(o){this.type=In,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const h=l.parse(o[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?l.error(`Expected argument of type string or array, but found ${zo(h.type)} instead.`):new Xh(h):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new ts(`Expected value to be of type string or array, but found ${zo(Vo(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}function Au(u){return function(){u=1831565813+(u|=0)|0;let o=Math.imul(u^u>>>15,1|u);return o=o+Math.imul(o^o>>>7,61|o)^o,((o^o>>>14)>>>0)/4294967296}}const Ad={"==":o1,"!=":Wh,">":Md,"<":Da,">=":Mu,"<=":kf,array:hi,at:Wm,boolean:hi,case:Iu,coalesce:Af,collator:Sa,format:Uc,image:Du,in:Ca,"index-of":Ed,interpolate:Ta,"interpolate-hcl":Ta,"interpolate-lab":Ta,length:Xh,let:Dd,literal:Ua,match:Xm,number:hi,"number-format":pa,object:hi,slice:Rf,step:If,string:hi,"to-boolean":Hc,"to-color":Hc,"to-number":Hc,"to-string":Hc,var:Ur,within:Ir,distance:Il,config:Td};function gc(u,[o,l,h,_]){o=o.evaluate(u),l=l.evaluate(u),h=h.evaluate(u);const f=_?_.evaluate(u):1,b=B_(o,l,h,f);if(b)throw new ts(b);return new mr(o/255*f,l/255*f,h/255*f,f)}function Pf(u,[o,l,h,_]){o=o.evaluate(u),l=l.evaluate(u),h=h.evaluate(u);const f=_?_.evaluate(u):1,b=(x=l,I=h,A=f,"number"==typeof(R=o)&&R>=0&&R<=360?"number"==typeof x&&x>=0&&x<=100&&"number"==typeof I&&I>=0&&I<=100?void 0===A||"number"==typeof A&&A>=0&&A<=1?null:`Invalid hsla value [${[R,x,I,A].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof A?[R,x,I,A]:[R,x,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof A?[R,x,I,A]:[R,x,I]).join(", ")}]: 'h' must be between 0 and 360.`);var R,x,I,A;if(b)throw new ts(b);const S=`hsla(${o}, ${l}%, ${h}%, ${f})`,E=mr.parse(S);if(!E)throw new ts(`Failed to parse HSLA color: ${S}`);return E}function Zh(u,o){return u in o}function Hi(u,o){const l=o[u];return void 0===l?null:l}function Zc(u){return{type:u}}function sv(u){return{result:"success",value:u}}function _c(u){return{result:"error",value:u}}function Lf(u,o){return!!u&&!!u.parameters&&u.parameters.indexOf(o)>-1}function Ru(u){return"data-driven"===u["property-type"]}function Zm(u){return Lf(u.expression,"measure-light")}function Ym(u){return Lf(u.expression,"zoom")}function Km(u){return!!u.expression&&u.expression.interpolated}function mn(u){return"object"==typeof u&&null!==u&&!Array.isArray(u)}function Fr(u){return u}function di(u,o){const l="color"===o.type,h=u.stops&&"object"==typeof u.stops[0][0],_=h||!(h||void 0!==u.property),f=u.type||(Km(o)?"exponential":"interval");if(l&&((u=Ph({},u)).stops&&(u.stops=u.stops.map(R=>[R[0],mr.parse(R[1])])),u.default=mr.parse(u.default?u.default:o.default)),u.colorSpace&&"rgb"!==u.colorSpace&&!W_[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let b,S,E;if("exponential"===f)b=ku;else if("interval"===f)b=Z_;else if("categorical"===f){b=_s,S=Object.create(null);for(const R of u.stops)S[R[0]]=R[1];E=typeof u.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);b=Zl}if(h){const R={},x=[];for(let D=0;D<u.stops.length;D++){const M=u.stops[D],L=M[0].zoom;void 0===R[L]&&(R[L]={zoom:L,type:u.type,property:u.property,default:u.default,stops:[]},x.push(L)),R[L].stops.push([M[0].value,M[1]])}const I=[];for(const D of x)I.push([R[D].zoom,di(R[D],o)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:Ta.interpolationFactor.bind(void 0,A),zoomStops:I.map(D=>D[0]),evaluate:({zoom:D},M)=>ku({stops:I,base:u.base},o,D).evaluate(D,M)}}if(_){const R="exponential"===f?{name:"exponential",base:void 0!==u.base?u.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Ta.interpolationFactor.bind(void 0,R),zoomStops:u.stops.map(x=>x[0]),evaluate:({zoom:x})=>b(u,o,x,S,E)}}return{kind:"source",evaluate(R,x){const I=x&&x.properties?x.properties[u.property]:void 0;return void 0===I?oi(u.default,o.default):b(u,o,I,S,E)}}}function oi(u,o,l){return void 0!==u?u:void 0!==o?o:void 0!==l?l:void 0}function _s(u,o,l,h,_){return oi(typeof l===_?h[l]:void 0,u.default,o.default)}function Z_(u,o,l){if("number"!==Cs(l))return oi(u.default,o.default);const h=u.stops.length;if(1===h||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[h-1][0])return u.stops[h-1][1];const _=$m(u.stops.map(f=>f[0]),l);return u.stops[_][1]}function ku(u,o,l){const h=void 0!==u.base?u.base:1;if("number"!==Cs(l))return oi(u.default,o.default);const _=u.stops.length;if(1===_||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[_-1][0])return u.stops[_-1][1];const f=$m(u.stops.map(x=>x[0]),l),b=function(x,I,A,D){const M=D-A,L=x-A;return 0===M?0:1===I?L/M:(Math.pow(I,L)-1)/(Math.pow(I,M)-1)}(l,h,u.stops[f][0],u.stops[f+1][0]),S=u.stops[f][1],E=u.stops[f+1][1];let R=fs[o.type]||Fr;if(u.colorSpace&&"rgb"!==u.colorSpace){const x=W_[u.colorSpace];R=(I,A)=>x.reverse(x.interpolate(x.forward(I),x.forward(A),b))}return"function"==typeof S.evaluate?{evaluate(...x){const I=S.evaluate.apply(void 0,x),A=E.evaluate.apply(void 0,x);if(void 0!==I&&void 0!==A)return R(I,A,b)}}:R(S,E,b)}function Zl(u,o,l){return"color"===o.type?l=mr.parse(l):"formatted"===o.type?l=Qs.fromString(l.toString()):"resolvedImage"===o.type?l=ea.fromString(l.toString()):Cs(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),oi(l,u.default,o.default)}Ha.register(Ad,{error:[{kind:"error"},[Xi],(u,[o])=>{throw new ts(o.evaluate(u))}],typeof:[Xi,[Ji],(u,[o])=>zo(Vo(o.evaluate(u)))],"to-rgba":[Qi(In,4),[ja],(u,[o])=>o.evaluate(u).toRenderColor(null).toArray()],rgb:[ja,[In,In,In],gc],rgba:[ja,[In,In,In,In],gc],hsl:[ja,[In,In,In],Pf],hsla:[ja,[In,In,In,In],Pf],has:{type:Zi,overloads:[[[Xi],(u,[o])=>Zh(o.evaluate(u),u.properties())],[[Xi,Ks],(u,[o,l])=>Zh(o.evaluate(u),l.evaluate(u))]]},get:{type:Ji,overloads:[[[Xi],(u,[o])=>Hi(o.evaluate(u),u.properties())],[[Xi,Ks],(u,[o,l])=>Hi(o.evaluate(u),l.evaluate(u))]]},"feature-state":[Ji,[Xi],(u,[o])=>Hi(o.evaluate(u),u.featureState||{})],properties:[Ks,[],u=>u.properties()],"geometry-type":[Xi,[],u=>u.geometryType()],id:[Ji,[],u=>u.id()],zoom:[In,[],u=>u.globals.zoom],pitch:[In,[],u=>u.globals.pitch||0],"distance-from-center":[In,[],u=>u.distanceFromCenter()],"measure-light":[In,[Xi],(u,[o])=>u.measureLight(o.evaluate(u))],"heatmap-density":[In,[],u=>u.globals.heatmapDensity||0],"line-progress":[In,[],u=>u.globals.lineProgress||0],"raster-value":[In,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[In,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[In,[],u=>u.globals.skyRadialProgress||0],accumulated:[Ji,[],u=>void 0===u.globals.accumulated?null:u.globals.accumulated],"+":[In,Zc(In),(u,o)=>{let l=0;for(const h of o)l+=h.evaluate(u);return l}],"*":[In,Zc(In),(u,o)=>{let l=1;for(const h of o)l*=h.evaluate(u);return l}],"-":{type:In,overloads:[[[In,In],(u,[o,l])=>o.evaluate(u)-l.evaluate(u)],[[In],(u,[o])=>-o.evaluate(u)]]},"/":[In,[In,In],(u,[o,l])=>o.evaluate(u)/l.evaluate(u)],"%":[In,[In,In],(u,[o,l])=>o.evaluate(u)%l.evaluate(u)],ln2:[In,[],()=>Math.LN2],pi:[In,[],()=>Math.PI],e:[In,[],()=>Math.E],"^":[In,[In,In],(u,[o,l])=>Math.pow(o.evaluate(u),l.evaluate(u))],sqrt:[In,[In],(u,[o])=>Math.sqrt(o.evaluate(u))],log10:[In,[In],(u,[o])=>Math.log(o.evaluate(u))/Math.LN10],ln:[In,[In],(u,[o])=>Math.log(o.evaluate(u))],log2:[In,[In],(u,[o])=>Math.log(o.evaluate(u))/Math.LN2],sin:[In,[In],(u,[o])=>Math.sin(o.evaluate(u))],cos:[In,[In],(u,[o])=>Math.cos(o.evaluate(u))],tan:[In,[In],(u,[o])=>Math.tan(o.evaluate(u))],asin:[In,[In],(u,[o])=>Math.asin(o.evaluate(u))],acos:[In,[In],(u,[o])=>Math.acos(o.evaluate(u))],atan:[In,[In],(u,[o])=>Math.atan(o.evaluate(u))],min:[In,Zc(In),(u,o)=>Math.min(...o.map(l=>l.evaluate(u)))],max:[In,Zc(In),(u,o)=>Math.max(...o.map(l=>l.evaluate(u)))],abs:[In,[In],(u,[o])=>Math.abs(o.evaluate(u))],round:[In,[In],(u,[o])=>{const l=o.evaluate(u);return l<0?-Math.round(-l):Math.round(l)}],floor:[In,[In],(u,[o])=>Math.floor(o.evaluate(u))],ceil:[In,[In],(u,[o])=>Math.ceil(o.evaluate(u))],"filter-==":[Zi,[Xi,Ji],(u,[o,l])=>u.properties()[o.value]===l.value],"filter-id-==":[Zi,[Ji],(u,[o])=>u.id()===o.value],"filter-type-==":[Zi,[Xi],(u,[o])=>u.geometryType()===o.value],"filter-<":[Zi,[Xi,Ji],(u,[o,l])=>{const h=u.properties()[o.value],_=l.value;return typeof h==typeof _&&h<_}],"filter-id-<":[Zi,[Ji],(u,[o])=>{const l=u.id(),h=o.value;return typeof l==typeof h&&l<h}],"filter->":[Zi,[Xi,Ji],(u,[o,l])=>{const h=u.properties()[o.value],_=l.value;return typeof h==typeof _&&h>_}],"filter-id->":[Zi,[Ji],(u,[o])=>{const l=u.id(),h=o.value;return typeof l==typeof h&&l>h}],"filter-<=":[Zi,[Xi,Ji],(u,[o,l])=>{const h=u.properties()[o.value],_=l.value;return typeof h==typeof _&&h<=_}],"filter-id-<=":[Zi,[Ji],(u,[o])=>{const l=u.id(),h=o.value;return typeof l==typeof h&&l<=h}],"filter->=":[Zi,[Xi,Ji],(u,[o,l])=>{const h=u.properties()[o.value],_=l.value;return typeof h==typeof _&&h>=_}],"filter-id->=":[Zi,[Ji],(u,[o])=>{const l=u.id(),h=o.value;return typeof l==typeof h&&l>=h}],"filter-has":[Zi,[Ji],(u,[o])=>o.value in u.properties()],"filter-has-id":[Zi,[],u=>null!==u.id()&&void 0!==u.id()],"filter-type-in":[Zi,[Qi(Xi)],(u,[o])=>o.value.indexOf(u.geometryType())>=0],"filter-id-in":[Zi,[Qi(Ji)],(u,[o])=>o.value.indexOf(u.id())>=0],"filter-in-small":[Zi,[Xi,Qi(Ji)],(u,[o,l])=>l.value.indexOf(u.properties()[o.value])>=0],"filter-in-large":[Zi,[Xi,Qi(Ji)],(u,[o,l])=>function(h,_,f,b){for(;f<=b;){const S=f+b>>1;if(_[S]===h)return!0;_[S]>h?b=S-1:f=S+1}return!1}(u.properties()[o.value],l.value,0,l.value.length-1)],all:{type:Zi,overloads:[[[Zi,Zi],(u,[o,l])=>o.evaluate(u)&&l.evaluate(u)],[Zc(Zi),(u,o)=>{for(const l of o)if(!l.evaluate(u))return!1;return!0}]]},any:{type:Zi,overloads:[[[Zi,Zi],(u,[o,l])=>o.evaluate(u)||l.evaluate(u)],[Zc(Zi),(u,o)=>{for(const l of o)if(l.evaluate(u))return!0;return!1}]]},"!":[Zi,[Zi],(u,[o])=>!o.evaluate(u)],"is-supported-script":[Zi,[Xi],(u,[o])=>{const l=u.globals&&u.globals.isSupportedScript;return!l||l(o.evaluate(u))}],upcase:[Xi,[Xi],(u,[o])=>o.evaluate(u).toUpperCase()],downcase:[Xi,[Xi],(u,[o])=>o.evaluate(u).toLowerCase()],concat:[Xi,Zc(Ji),(u,o)=>o.map(l=>Ts(l.evaluate(u))).join("")],"resolved-locale":[Xi,[wf],(u,[o])=>o.evaluate(u).resolvedLocale()],random:[In,[In,In,Ji],(u,o)=>{const[l,h,_]=o.map(b=>b.evaluate(u));if(l>h||l===h)return l;let f;if("string"==typeof _)f=function(b){let S=0;if(0===b.length)return S;for(let E=0;E<b.length;E++)S=(S<<5)-S+b.charCodeAt(E),S|=0;return S}(_);else{if("number"!=typeof _)throw new ts(`Invalid seed input: ${_}`);f=_}return l+Au(f)()*(h-l)}]});class Yh{constructor(o,l,h,_){var f;this.expression=o,this._warningHistory={},this._evaluator=new ll(h,_),this._defaultValue=l?"color"===(f=l).type&&(mn(f.default)||Array.isArray(f.default))?new mr(0,0,0,0):"color"===f.type?mr.parse(f.default)||null:void 0===f.default?null:f.default:null,this._enumValues=l&&"enum"===l.type?l.values:null,this.configDependencies=Uh(o)}evaluateWithoutErrorHandling(o,l,h,_,f,b,S,E){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=_||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,h,_,f,b,S,E){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=_||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=E||null;try{const R=this.expression.evaluate(this._evaluator);if(null==R||"number"==typeof R&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new ts(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,"undefined"!=typeof console&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${R.message}`)),this._defaultValue}}}function Rd(u){return Array.isArray(u)&&u.length>0&&"string"==typeof u[0]&&u[0]in Ad}function Kh(u,o,l,h){const _=new tv(Ad,[],o?function(b){const S={color:ja,string:Xi,number:In,enum:Xi,boolean:Zi,formatted:Lh,resolvedImage:Ss};return"array"===b.type?Qi(S[b.value]||Ji,b.length):S[b.type]}(o):void 0,void 0,void 0,l,h),f=_.parse(u,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return f?sv(new Yh(f,o,l,h)):_c(_.errors)}class Of{constructor(o,l,h){this.kind=o,this._styleExpression=l,this.isLightConstant=h,this.isStateDependent="constant"!==o&&!Ef(l.expression),this.configDependencies=Uh(l.expression)}evaluateWithoutErrorHandling(o,l,h,_,f,b){return this._styleExpression.evaluateWithoutErrorHandling(o,l,h,_,f,b)}evaluate(o,l,h,_,f,b){return this._styleExpression.evaluate(o,l,h,_,f,b)}}class Ff{constructor(o,l,h,_,f){this.kind=o,this.zoomStops=h,this._styleExpression=l,this.isStateDependent="camera"!==o&&!Ef(l.expression),this.isLightConstant=f,this.configDependencies=Uh(l.expression),this.interpolationType=_}evaluateWithoutErrorHandling(o,l,h,_,f,b){return this._styleExpression.evaluateWithoutErrorHandling(o,l,h,_,f,b)}evaluate(o,l,h,_,f,b){return this._styleExpression.evaluate(o,l,h,_,f,b)}interpolationFactor(o,l,h){return this.interpolationType?Ta.interpolationFactor(this.interpolationType,o,l,h):0}}function Yc(u,o,l,h){if("error"===(u=Kh(u,o,l,h)).result)return u;const _=u.value.expression,f=Df(_);if(!f&&!Ru(o))return _c([new El("","data expressions not supported")]);const b=Hh(_,["zoom","pitch","distance-from-center"]);if(!b&&!Ym(o))return _c([new El("","zoom expressions not supported")]);const S=Hh(_,["measure-light"]);if(!S&&!Zm(o))return _c([new El("","measure-light expression not supported")]);const E=Hh(_,["line-progress"]);if(!E&&!Lf(o.expression,"line-progress"))return _c([new El("","line-progress expression not supported")]);const R=o.expression&&o.expression.relaxZoomRestriction,x=dl(_);return x||b||R?x instanceof El?_c([x]):x instanceof Ta&&!Km(o)?_c([new El("",'"interpolate" expressions cannot be used with this property')]):sv(x?new Ff(f&&E?"camera":"composite",u.value,x.labels,x instanceof Ta?x.interpolation:void 0,S):new Of(f&&E?"constant":"source",u.value,S)):_c([new El("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Es{constructor(o,l){this._parameters=o,this._specification=l,Ph(this,di(this._parameters,this._specification))}static deserialize(o){return new Es(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function dl(u){let o=null;if(u instanceof Dd)o=dl(u.result);else if(u instanceof Af){for(const l of u.args)if(o=dl(l),o)break}else(u instanceof If||u instanceof Ta)&&u.input instanceof Ha&&"zoom"===u.input.name&&(o=u);return o instanceof El||u.eachChild(l=>{const h=dl(l);h instanceof El?o=h:o&&h&&o!==h&&(o=new El("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}var Nf,Kc,Pu=Qe(function(){if(Kc)return Nf;Kc=1,Nf=o;function o(l,h,_){var f=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var b=new Int32Array(this.arrayBuffer);l=b[0],this.d=(h=b[1])+2*(_=b[2]);for(var S=0;S<this.d*this.d;S++){var E=b[3+S],R=b[3+S+1];f.push(E===R?null:b.subarray(E,R))}var x=b[3+f.length+1];this.keys=b.subarray(b[3+f.length],x),this.bboxes=b.subarray(x),this.insert=this._insertReadonly}else{this.d=h+2*_;for(var I=0;I<this.d*this.d;I++)f.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=l,this.padding=_,this.scale=h/l,this.uid=0;var A=_/h*l;this.min=-A,this.max=l+A}return o.prototype.insert=function(l,h,_,f,b){this._forEachCell(h,_,f,b,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(f),this.bboxes.push(b)},o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},o.prototype._insertCell=function(l,h,_,f,b,S){this.cells[b].push(S)},o.prototype.query=function(l,h,_,f,b){var S=this.min,E=this.max;if(l<=S&&h<=S&&E<=_&&E<=f&&!b)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(l,h,_,f,this._queryCell,R,{},b),R},o.prototype._queryCell=function(l,h,_,f,b,S,E,R){var x=this.cells[b];if(null!==x)for(var I=this.keys,A=this.bboxes,D=0;D<x.length;D++){var M=x[D];if(void 0===E[M]){var L=4*M;(R?R(A[L+0],A[L+1],A[L+2],A[L+3]):l<=A[L+2]&&h<=A[L+3]&&_>=A[L+0]&&f>=A[L+1])?(E[M]=!0,S.push(I[M])):E[M]=!1}}},o.prototype._forEachCell=function(l,h,_,f,b,S,E,R){for(var x=this._convertToCellCoord(l),I=this._convertToCellCoord(h),A=this._convertToCellCoord(_),D=this._convertToCellCoord(f),M=x;M<=A;M++)for(var L=I;L<=D;L++){var N=this.d*L+M;if((!R||R(this._convertFromCellCoord(M),this._convertFromCellCoord(L),this._convertFromCellCoord(M+1),this._convertFromCellCoord(L+1)))&&b.call(this,l,h,_,f,N,S,E,R))return}},o.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},o.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,h=3+this.cells.length+1+1,_=0,f=0;f<this.cells.length;f++)_+=this.cells[f].length;var b=new Int32Array(h+_+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var S=h,E=0;E<l.length;E++){var R=l[E];b[3+E]=S,b.set(R,S),S+=R.length}return b[3+l.length]=S,b.set(this.keys,S),b[3+l.length+1]=S+=this.keys.length,b.set(this.bboxes,S),S+=this.bboxes.length,b.buffer},Nf}());const kd={};function xn(u,o,l={}){Object.defineProperty(u,"_classRegistryKey",{value:o,writable:!1}),kd[o]={klass:u,omit:l.omit||[]}}xn(Object,"Object"),Pu.serialize=function(u,o){const l=u.toArrayBuffer();return o&&o.add(l),{buffer:l}},Pu.deserialize=function(u){return new Pu(u.buffer)},Object.defineProperty(Pu,"name",{value:"Grid"}),xn(Pu,"Grid"),xn(mr,"Color"),xn(Error,"Error"),xn(Qs,"Formatted"),xn(Js,"FormattedSection"),xn(vf,"AJAXError"),xn(ea,"ResolvedImage"),xn(Es,"StylePropertyFunction"),xn(Yh,"StyleExpression",{omit:["_evaluator"]}),xn(Ff,"ZoomDependentExpression"),xn(Of,"ZoomConstantExpression"),xn(Ha,"CompoundExpression",{omit:["_evaluate"]});for(const u in Ad)kd[Ad[u]._classRegistryKey]||xn(Ad[u],`Expression${u}`);function Bf(u){return u&&"undefined"!=typeof ArrayBuffer&&(u instanceof ArrayBuffer||u.constructor&&"ArrayBuffer"===u.constructor.name)}function Jh(u){return self.ImageBitmap&&u instanceof ImageBitmap}function bc(u,o){if(null==u||"boolean"==typeof u||"number"==typeof u||"string"==typeof u||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(Bf(u)||Jh(u))return o&&o.add(u),u;if(ArrayBuffer.isView(u)){const l=u;return o&&o.add(l.buffer),l}if(u instanceof ImageData)return o&&o.add(u.data.buffer),u;if(Array.isArray(u)){const l=[];for(const h of u)l.push(bc(h,o));return l}if(u instanceof Map){const l={$name:"Map"};for(const[h,_]of u.entries())l[h]=bc(_);return l}if(u instanceof Set){const l={$name:"Set"};let h=0;for(const _ of u.values())l[++h]=bc(_);return l}if("object"==typeof u){const l=u.constructor,h=l._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const _=l.serialize?l.serialize(u,o):{};if(!l.serialize){for(const f in u)u.hasOwnProperty(f)&&(kd[h].omit.indexOf(f)>=0||(_[f]=bc(u[f],o)));u instanceof Error&&(_.message=u.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==h&&(_.$name=h),_}throw new Error("can't serialize object of type "+typeof u)}function yc(u){if(null==u||"boolean"==typeof u||"number"==typeof u||"string"==typeof u||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||Bf(u)||Jh(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(yc);if("object"==typeof u){const o=u.$name||"Object";if("Map"===o){const _=new Map;for(const f of Object.keys(u))"$name"!==f&&_.set(f,yc(u[f]));return _}if("Set"===o){const _=new Set;for(const f of Object.keys(u))"$name"!==f&&_.add(yc(u[f]));return _}const{klass:l}=kd[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(u);const h=Object.create(l.prototype);for(const _ of Object.keys(u))"$name"!==_&&(h[_]=yc(u[_]));return h}throw new Error("can't deserialize object of type "+typeof u)}const Pn_Latin_1_Supplement=u=>u>=128&&u<=255,Pn_Arabic=u=>u>=1536&&u<=1791,Pn_Arabic_Supplement=u=>u>=1872&&u<=1919,Pn_Arabic_Extended_A=u=>u>=2208&&u<=2303,Pn_Hangul_Jamo=u=>u>=4352&&u<=4607,Pn_Unified_Canadian_Aboriginal_Syllabics=u=>u>=5120&&u<=5759,Pn_Khmer=u=>u>=6016&&u<=6143,Pn_Unified_Canadian_Aboriginal_Syllabics_Extended=u=>u>=6320&&u<=6399,Pn_General_Punctuation=u=>u>=8192&&u<=8303,Pn_Letterlike_Symbols=u=>u>=8448&&u<=8527,Pn_Number_Forms=u=>u>=8528&&u<=8591,Pn_Miscellaneous_Technical=u=>u>=8960&&u<=9215,Pn_Control_Pictures=u=>u>=9216&&u<=9279,Pn_Optical_Character_Recognition=u=>u>=9280&&u<=9311,Pn_Enclosed_Alphanumerics=u=>u>=9312&&u<=9471,Pn_Geometric_Shapes=u=>u>=9632&&u<=9727,Pn_Miscellaneous_Symbols=u=>u>=9728&&u<=9983,Pn_Miscellaneous_Symbols_and_Arrows=u=>u>=11008&&u<=11263,Pn_CJK_Radicals_Supplement=u=>u>=11904&&u<=12031,Pn_Kangxi_Radicals=u=>u>=12032&&u<=12255,Pn_Ideographic_Description_Characters=u=>u>=12272&&u<=12287,Pn_CJK_Symbols_and_Punctuation=u=>u>=12288&&u<=12351,Pn_Hiragana=u=>u>=12352&&u<=12447,Pn_Katakana=u=>u>=12448&&u<=12543,Pn_Bopomofo=u=>u>=12544&&u<=12591,Pn_Hangul_Compatibility_Jamo=u=>u>=12592&&u<=12687,Pn_Kanbun=u=>u>=12688&&u<=12703,Pn_Bopomofo_Extended=u=>u>=12704&&u<=12735,Pn_CJK_Strokes=u=>u>=12736&&u<=12783,Pn_Katakana_Phonetic_Extensions=u=>u>=12784&&u<=12799,Pn_Enclosed_CJK_Letters_and_Months=u=>u>=12800&&u<=13055,Pn_CJK_Compatibility=u=>u>=13056&&u<=13311,Pn_CJK_Unified_Ideographs_Extension_A=u=>u>=13312&&u<=19903,Pn_Yijing_Hexagram_Symbols=u=>u>=19904&&u<=19967,Pn_CJK_Unified_Ideographs=u=>u>=19968&&u<=40959,Pn_Yi_Syllables=u=>u>=40960&&u<=42127,Pn_Yi_Radicals=u=>u>=42128&&u<=42191,Pn_Hangul_Jamo_Extended_A=u=>u>=43360&&u<=43391,Pn_Hangul_Syllables=u=>u>=44032&&u<=55215,Pn_Hangul_Jamo_Extended_B=u=>u>=55216&&u<=55295,Pn_Private_Use_Area=u=>u>=57344&&u<=63743,Pn_CJK_Compatibility_Ideographs=u=>u>=63744&&u<=64255,Pn_Arabic_Presentation_Forms_A=u=>u>=64336&&u<=65023,Pn_Vertical_Forms=u=>u>=65040&&u<=65055,Pn_CJK_Compatibility_Forms=u=>u>=65072&&u<=65103,Pn_Small_Form_Variants=u=>u>=65104&&u<=65135,Pn_Arabic_Presentation_Forms_B=u=>u>=65136&&u<=65279,Pn_Halfwidth_and_Fullwidth_Forms=u=>u>=65280&&u<=65519,Pn_Osage=u=>u>=66736&&u<=66815,Pn_CJK_Unified_Ideographs_Extension_B=u=>u>=131072&&u<=173791;function Jm(u){for(const o of u)if(Lu(o.charCodeAt(0)))return!0;return!1}function Qm(u){for(const o of u)if(!eg(o.charCodeAt(0)))return!1;return!0}function eg(u){return!(Pn_Arabic(u)||Pn_Arabic_Supplement(u)||Pn_Arabic_Extended_A(u)||Pn_Arabic_Presentation_Forms_A(u)||Pn_Arabic_Presentation_Forms_B(u))}function Lu(u){return!(746!==u&&747!==u&&(u<4352||!(Pn_Bopomofo_Extended(u)||Pn_Bopomofo(u)||Pn_CJK_Compatibility_Forms(u)&&!(u>=65097&&u<=65103)||Pn_CJK_Compatibility_Ideographs(u)||Pn_CJK_Compatibility(u)||Pn_CJK_Radicals_Supplement(u)||Pn_CJK_Strokes(u)||!(!Pn_CJK_Symbols_and_Punctuation(u)||u>=12296&&u<=12305||u>=12308&&u<=12319||12336===u)||Pn_CJK_Unified_Ideographs_Extension_A(u)||Pn_CJK_Unified_Ideographs(u)||Pn_Enclosed_CJK_Letters_and_Months(u)||Pn_Hangul_Compatibility_Jamo(u)||Pn_Hangul_Jamo_Extended_A(u)||Pn_Hangul_Jamo_Extended_B(u)||Pn_Hangul_Jamo(u)||Pn_Hangul_Syllables(u)||Pn_Hiragana(u)||Pn_Ideographic_Description_Characters(u)||Pn_Kanbun(u)||Pn_Kangxi_Radicals(u)||Pn_Katakana_Phonetic_Extensions(u)||Pn_Katakana(u)&&12540!==u||!(!Pn_Halfwidth_and_Fullwidth_Forms(u)||65288===u||65289===u||65293===u||u>=65306&&u<=65310||65339===u||65341===u||65343===u||u>=65371&&u<=65503||65507===u||u>=65512&&u<=65519)||!(!Pn_Small_Form_Variants(u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Pn_Unified_Canadian_Aboriginal_Syllabics(u)||Pn_Unified_Canadian_Aboriginal_Syllabics_Extended(u)||Pn_Vertical_Forms(u)||Pn_Yijing_Hexagram_Symbols(u)||Pn_Yi_Syllables(u)||Pn_Yi_Radicals(u))))}function zf(u){return!(Lu(u)||(o=u,Pn_Latin_1_Supplement(o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||Pn_General_Punctuation(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||Pn_Letterlike_Symbols(o)||Pn_Number_Forms(o)||Pn_Miscellaneous_Technical(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||Pn_Control_Pictures(o)&&9251!==o||Pn_Optical_Character_Recognition(o)||Pn_Enclosed_Alphanumerics(o)||Pn_Geometric_Shapes(o)||Pn_Miscellaneous_Symbols(o)&&!(o>=9754&&o<=9759)||Pn_Miscellaneous_Symbols_and_Arrows(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Pn_CJK_Symbols_and_Punctuation(o)||Pn_Katakana(o)||Pn_Private_Use_Area(o)||Pn_CJK_Compatibility_Forms(o)||Pn_Small_Form_Variants(o)||Pn_Halfwidth_and_Fullwidth_Forms(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function Pd(u){return u>=1424&&u<=2303||Pn_Arabic_Presentation_Forms_A(u)||Pn_Arabic_Presentation_Forms_B(u)}function tg(u,o){return!(!o&&Pd(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Pn_Khmer(u))}function ng(u){for(const o of u)if(Pd(o.charCodeAt(0)))return!0;return!1}const ig="deferred",Qh="loading",bs="loaded";let Al=null,gr="unavailable",Is=null;const Y_=function(u){u&&"string"==typeof u&&u.indexOf("NetworkError")>-1&&(gr="error"),Al&&Al(u)};function Ld(){rg.fire(new dr("pluginStateChange",{pluginStatus:gr,pluginURL:Is}))}const rg=new ln,og=function(){return gr},K_=function(){if(gr!==ig||!Is)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");gr=Qh,Ld(),Is&&md({url:Is},u=>{u?Y_(u):(gr=bs,Ld())})},na={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>gr===bs||null!=na.applyArabicShaping,isLoading:()=>gr===Qh,setState(u){gr=u.pluginStatus,Is=u.pluginURL},isParsed:()=>null!=na.applyArabicShaping&&null!=na.processBidirectionalText&&null!=na.processStyledBidirectionalText,getPluginURL:()=>Is};class ao{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(o){return function(l,h){for(const _ of l)if(!tg(_.charCodeAt(0),h))return!1;return!0}(o,na.isLoaded())}}class Ou{constructor(o,l,h,_){this.property=o,this.value=l,this.expression=function(f,b,S,E){if(mn(f))return new Es(f,b);if(Rd(f)||Array.isArray(f)&&f.length>0){const R=Yc(f,b,S,E);if("error"===R.result)throw new Error(R.value.map(x=>`${x.key}: ${x.message}`).join(", "));return R.value}{let R=f;return"string"==typeof f&&"color"===b.type&&(R=mr.parse(f)),{kind:"constant",configDependencies:new Set,evaluate:()=>R}}}(void 0===l?o.specification.default:l,o.specification,h,_)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,h){return this.property.possiblyEvaluate(this,o,l,h)}}class ep{constructor(o,l,h){this.property=o,this.value=new Ou(o,void 0,l,h)}transitioned(o,l){return new J_(this.property,this.value,l,ir({},o.transition,this.transition),o.now)}untransitioned(){return new J_(this.property,this.value,null,{},0)}}class sg{constructor(o,l,h){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._scope=l,this._options=h,this.configDependencies=new Set}getValue(o){return ol(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new ep(this._values[o].property,this._scope,this._options)),this._values[o].value=new Ou(this._values[o].property,null===l?void 0:ol(l),this._scope,this._options),this._values[o].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].value.expression.configDependencies]))}setTransitionOrValue(o,l){l&&(this._options=l);const h=this._properties.properties;if(o)for(const _ in o){const f=o[_];if(za(_,"-transition")){const b=_.slice(0,-11);h[b]&&this.setTransition(b,f)}else h.hasOwnProperty(_)&&this.setValue(_,f)}}getTransition(o){return ol(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new ep(this._values[o].property)),this._values[o].transition=ol(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(o[l]=h);const _=this.getTransition(l);void 0!==_&&(o[`${l}-transition`]=_)}return o}transitioned(o,l){const h=new vc(this._properties);for(const _ of Object.keys(this._values))h._values[_]=this._values[_].transitioned(o,l._values[_]);return h}untransitioned(){const o=new vc(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class J_{constructor(o,l,h,_,f){const b=_.delay||0,S=_.duration||0;f=f||0,this.property=o,this.value=l,this.begin=f+b,this.end=this.begin+S,o.specification.transition&&(_.delay||_.duration)&&(this.prior=h)}possiblyEvaluate(o,l,h){const _=o.now||0,f=this.value.possiblyEvaluate(o,l,h),b=this.prior;if(b){if(_>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(_<this.begin)return b.possiblyEvaluate(o,l,h);{const S=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(o,l,h),f,ue(S))}}return f}}class vc{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,h){const _=new Fd(this._properties);for(const f of Object.keys(this._values))_._values[f]=this._values[f].possiblyEvaluate(o,l,h);return _}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class tp{constructor(o,l,h){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._scope=l,this._options=h,this.configDependencies=new Set}getValue(o){return ol(this._values[o].value)}setValue(o,l){this._values[o]=new Ou(this._values[o].property,null===l?void 0:ol(l),this._scope,this._options),this._values[o].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].expression.configDependencies]))}serialize(){const o={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(o[l]=h)}return o}possiblyEvaluate(o,l,h){const _=new Fd(this._properties);for(const f of Object.keys(this._values))_._values[f]=this._values[f].possiblyEvaluate(o,l,h);return _}}class Od{constructor(o,l,h){this.property=o,this.value=l,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,h,_){return this.property.evaluate(this.value,this.parameters,o,l,h,_)}}class Fd{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Xt{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,h){const _=fs[this.specification.type];return _?_(o,l,h):o}}class On{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,h,_){return new Od(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},h,_)}:o.expression,l)}interpolate(o,l,h){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new Od(this,{kind:"constant",value:void 0},o.parameters);const _=fs[this.specification.type];return _?new Od(this,{kind:"constant",value:_(o.value.value,l.value.value,h)},o.parameters):o}evaluate(o,l,h,_,f,b){return"constant"===o.kind?o.value:o.evaluate(l,h,_,f,b)}}class Nd{constructor(o){this.specification=o}possiblyEvaluate(o,l,h,_){return!!o.expression.evaluate(l,null,{},h,_)}interpolate(){return!1}}class Wr{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new ao(0,{});for(const h in o){const _=o[h];_.specification.overridable&&this.overridableProperties.push(h);const f=this.defaultPropertyValues[h]=new Ou(_,void 0),b=this.defaultTransitionablePropertyValues[h]=new ep(_);this.defaultTransitioningPropertyValues[h]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=f.possiblyEvaluate(l)}}}xn(On,"DataDrivenProperty"),xn(Xt,"DataConstantProperty"),xn(Nd,"ColorRampProperty");var rt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,90],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"rain":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Q_(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Kl(u){if(Array.isArray(u))return u.map(Kl);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const o={};for(const l in u)o[l]=Kl(u[l]);return o}return Q_(u)}function Vf(u){if(!0===u||!1===u)return!0;if(!Array.isArray(u)||0===u.length)return!1;switch(u[0]){case"has":return u.length>=2&&"$id"!==u[1]&&"$type"!==u[1];case"in":return u.length>=3&&("string"!=typeof u[1]||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==u.length||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const o of u.slice(1))if(!Vf(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function np(u,o="",l=null,h="fill"){if(null==u)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Vf(u)||(u=zd(u));const _=u;let f=!0;try{f=function(x){if(!pl(x))return x;let I=Kl(x);return jf(I),I=hl(I),I}(_)}catch(x){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(_,null,2)}\n        `)}let b=null,S=null;if("background"!==h&&"sky"!==h&&"slot"!==h){S=rt[`filter_${h}`];const x=Kh(f,S,o,l);if("error"===x.result)throw new Error(x.value.map(I=>`${I.key}: ${I.message}`).join(", "));b=(I,A,D)=>x.value.evaluate(I,A,{},D)}let E=null,R=null;if(f!==_){const x=Kh(_,S,o,l);if("error"===x.result)throw new Error(x.value.map(I=>`${I.key}: ${I.message}`).join(", "));E=(I,A,D,M,L)=>x.value.evaluate(I,A,{},D,void 0,void 0,M,L),R=!Df(x.value.expression)}return{filter:b,dynamicFilter:E||void 0,needGeometry:Fu(f),needFeature:!!R}}function hl(u){if(!Array.isArray(u))return u;const o=function(l){if(Bd.has(l[0]))for(let h=1;h<l.length;h++)if(pl(l[h]))return!0;return l}(u);return!0===o?o:o.map(l=>hl(l))}function jf(u){let o=!1;const l=[];if("case"===u[0]){for(let h=1;h<u.length-1;h+=2)o=o||pl(u[h]),l.push(u[h+1]);l.push(u[u.length-1])}else if("match"===u[0]){o=o||pl(u[1]);for(let h=2;h<u.length-1;h+=2)l.push(u[h+1]);l.push(u[u.length-1])}else if("step"===u[0]){o=o||pl(u[1]);for(let h=1;h<u.length-1;h+=2)l.push(u[h+1])}o&&(u.length=0,u.push("any",...l));for(let h=1;h<u.length;h++)jf(u[h])}function pl(u){if(!Array.isArray(u))return!1;if("pitch"===(o=u[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<u.length;l++)if(pl(u[l]))return!0;return!1}const Bd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function av(u,o){return u<o?-1:u>o?1:0}function Fu(u){if(!Array.isArray(u))return!1;if("within"===u[0]||"distance"===u[0])return!0;for(let o=1;o<u.length;o++)if(Fu(u[o]))return!0;return!1}function zd(u){if(!u)return!0;const o=u[0];return u.length<=1?"any"!==o:"=="===o?Vd(u[1],u[2],"=="):"!="===o?Jc(Vd(u[1],u[2],"==")):"<"===o||">"===o||"<="===o||">="===o?Vd(u[1],u[2],o):"any"===o?(l=u.slice(1),["any"].concat(l.map(zd))):"all"===o?["all"].concat(u.slice(1).map(zd)):"none"===o?["all"].concat(u.slice(1).map(zd).map(Jc)):"in"===o?eb(u[1],u.slice(2)):"!in"===o?Jc(eb(u[1],u.slice(2))):"has"===o?ip(u[1]):"!has"!==o||Jc(ip(u[1]));var l}function Vd(u,o,l){switch(u){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,u,o]}}function eb(u,o){if(0===o.length)return!1;switch(u){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",u,["literal",o.sort(av)]]:["filter-in-small",u,["literal",o]]}}function ip(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Jc(u){return["!",u]}function qa(u,o){return o?`${u}\x1f${o}`:u}const tb="-transition",Ea=new Set(["fill","line","background","hillshade","raster"]);class js extends ln{constructor(o,l,h,_,f){if(super(),this.id=o.id,this.fqid=qa(this.id,h),this.type=o.type,this.scope=h,this.lut=_,this.options=f,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==o.type){if(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type&&"background"!==o.type&&"sky"!==o.type&&"slot"!==o.type){this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter;const b=Kh(this.filter,rt[`filter_${o.type}`]);"error"!==b.result&&(this.configDependencies=new Set([...this.configDependencies,...b.value.configDependencies]))}if(o.slot&&(this.slot=o.slot),l.layout&&(this._unevaluatedLayout=new tp(l.layout,this.scope,f),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),l.paint){this._transitionablePaint=new sg(l.paint,this.scope,f);for(const b in o.paint)this.setPaintProperty(b,o.paint[b]);for(const b in o.layout)this.setLayoutProperty(b,o.layout[b]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fd(l.paint)}}}onAdd(o){}onRemove(o){}isDraped(o){return!this.is3D()&&Ea.has(this.type)}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l){if("custom"===this.type&&"visibility"===o)return void(this.visibility=l);const h=this._unevaluatedLayout;h._properties.properties[o]&&(h.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),"visibility"===o&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(o){return za(o,tb)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l){const h=this._transitionablePaint,_=h._properties.properties;if(za(o,tb)){const I=o.slice(0,-11);return _[I]&&h.setTransition(I,l||void 0),!1}if(!_[o])return!1;const f=h._values[o],b=f.value.isDataDriven(),S=f.value;h.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),this._handleSpecialPaintPropertyUpdate(o);const E=h._values[o].value,R=E.isDataDriven(),x=za(o,"pattern")||"line-dasharray"===o;return R||b||x||this._handleOverridablePaintPropertyUpdate(o,S,E)}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getDefaultProgramParams(o,l,h){return null}_handleOverridablePaintPropertyUpdate(o,l,h){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){return Tu({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(o,l)=>!(void 0===o||"layout"===l&&!Object.keys(o).length||"paint"===l&&!Object.keys(o).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof Od&&Ru(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(o){this._filterCompiled||(this._featureFilter=np(this.filter,this.scope,o),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(o){this._stats&&("shadow"===o.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(o){}queryIntersectsFeature(o,l,h,_,f,b,S,E,R){}queryIntersectsMatchingFeature(o,l,h,_){}}const Uf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qc{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Mr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.add(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...o){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...o){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function nr(u,o=1){let l=0,h=0;return{members:u.map(_=>{const f=Uf[_.type].BYTES_PER_ELEMENT,b=l=ag(l,Math.max(o,f)),S=_.components||1;return h=Math.max(h,f),l+=f*S,{name:_.name,type:_.type,components:S,offset:b}}),size:ag(l,Math.max(h,o)),alignment:o}}function ag(u,o){return Math.ceil(u/o)*o}class xc extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const h=this.length;return this.resize(h+1),this.emplace(h,o,l)}emplace(o,l,h){const _=2*o;return this.int16[_+0]=l,this.int16[_+1]=h,o}}xc.prototype.bytesPerElement=4,xn(xc,"StructArrayLayout2i4");class op extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,h){const _=this.length;return this.resize(_+1),this.emplace(_,o,l,h)}emplace(o,l,h,_){const f=3*o;return this.int16[f+0]=l,this.int16[f+1]=h,this.int16[f+2]=_,o}}op.prototype.bytesPerElement=6,xn(op,"StructArrayLayout3i6");class Nu extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,h,_){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,h,_)}emplace(o,l,h,_,f){const b=4*o;return this.int16[b+0]=l,this.int16[b+1]=h,this.int16[b+2]=_,this.int16[b+3]=f,o}}Nu.prototype.bytesPerElement=8,xn(Nu,"StructArrayLayout4i8");class lg extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,h,_,f)}emplace(o,l,h,_,f,b){const S=5*o;return this.int16[S+0]=l,this.int16[S+1]=h,this.int16[S+2]=_,this.int16[S+3]=f,this.int16[S+4]=b,o}}lg.prototype.bytesPerElement=10,xn(lg,"StructArrayLayout5i10");class eu extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b,S){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,h,_,f,b,S)}emplace(o,l,h,_,f,b,S,E){const R=6*o,x=12*o,I=3*o;return this.int16[R+0]=l,this.int16[R+1]=h,this.uint8[x+4]=_,this.uint8[x+5]=f,this.uint8[x+6]=b,this.uint8[x+7]=S,this.float32[I+2]=E,o}}eu.prototype.bytesPerElement=12,xn(eu,"StructArrayLayout2i4ub1f12");class $a extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,_){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,h,_)}emplace(o,l,h,_,f){const b=4*o;return this.float32[b+0]=l,this.float32[b+1]=h,this.float32[b+2]=_,this.float32[b+3]=f,o}}$a.prototype.bytesPerElement=16,xn($a,"StructArrayLayout4f16");class tu extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h){const _=this.length;return this.resize(_+1),this.emplace(_,o,l,h)}emplace(o,l,h,_){const f=3*o;return this.float32[f+0]=l,this.float32[f+1]=h,this.float32[f+2]=_,o}}tu.prototype.bytesPerElement=12,xn(tu,"StructArrayLayout3f12");class Jl extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,h,_,f)}emplace(o,l,h,_,f,b){const S=6*o,E=3*o;return this.uint16[S+0]=l,this.uint16[S+1]=h,this.uint16[S+2]=_,this.uint16[S+3]=f,this.float32[E+2]=b,o}}Jl.prototype.bytesPerElement=12,xn(Jl,"StructArrayLayout4ui1f12");class sp extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,h,_){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,h,_)}emplace(o,l,h,_,f){const b=4*o;return this.uint16[b+0]=l,this.uint16[b+1]=h,this.uint16[b+2]=_,this.uint16[b+3]=f,o}}sp.prototype.bytesPerElement=8,xn(sp,"StructArrayLayout4ui8");class Ql extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,h,_,f,b)}emplace(o,l,h,_,f,b,S){const E=6*o;return this.int16[E+0]=l,this.int16[E+1]=h,this.int16[E+2]=_,this.int16[E+3]=f,this.int16[E+4]=b,this.int16[E+5]=S,o}}Ql.prototype.bytesPerElement=12,xn(Ql,"StructArrayLayout6i12");class jd extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b,S,E,R,x,I,A){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,h,_,f,b,S,E,R,x,I,A)}emplace(o,l,h,_,f,b,S,E,R,x,I,A,D){const M=12*o;return this.int16[M+0]=l,this.int16[M+1]=h,this.int16[M+2]=_,this.int16[M+3]=f,this.uint16[M+4]=b,this.uint16[M+5]=S,this.uint16[M+6]=E,this.uint16[M+7]=R,this.int16[M+8]=x,this.int16[M+9]=I,this.int16[M+10]=A,this.int16[M+11]=D,o}}jd.prototype.bytesPerElement=24,xn(jd,"StructArrayLayout4i4ui4i24");class wr extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,h,_,f,b)}emplace(o,l,h,_,f,b,S){const E=10*o,R=5*o;return this.int16[E+0]=l,this.int16[E+1]=h,this.int16[E+2]=_,this.float32[R+2]=f,this.float32[R+3]=b,this.float32[R+4]=S,o}}wr.prototype.bytesPerElement=20,xn(wr,"StructArrayLayout3i3f20");class ap extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}ap.prototype.bytesPerElement=4,xn(ap,"StructArrayLayout1ul4");class nu extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const h=this.length;return this.resize(h+1),this.emplace(h,o,l)}emplace(o,l,h){const _=2*o;return this.uint16[_+0]=l,this.uint16[_+1]=h,o}}nu.prototype.bytesPerElement=4,xn(nu,"StructArrayLayout2ui4");class Hf extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b,S,E,R,x,I,A,D){const M=this.length;return this.resize(M+1),this.emplace(M,o,l,h,_,f,b,S,E,R,x,I,A,D)}emplace(o,l,h,_,f,b,S,E,R,x,I,A,D,M){const L=20*o,N=10*o;return this.int16[L+0]=l,this.int16[L+1]=h,this.int16[L+2]=_,this.int16[L+3]=f,this.int16[L+4]=b,this.float32[N+3]=S,this.float32[N+4]=E,this.float32[N+5]=R,this.float32[N+6]=x,this.int16[L+14]=I,this.uint32[N+8]=A,this.uint16[L+18]=D,this.uint16[L+19]=M,o}}Hf.prototype.bytesPerElement=40,xn(Hf,"StructArrayLayout5i4f1i1ul2ui40");class us extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b,S){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,h,_,f,b,S)}emplace(o,l,h,_,f,b,S,E){const R=8*o;return this.int16[R+0]=l,this.int16[R+1]=h,this.int16[R+2]=_,this.int16[R+4]=f,this.int16[R+5]=b,this.int16[R+6]=S,this.int16[R+7]=E,o}}us.prototype.bytesPerElement=16,xn(us,"StructArrayLayout3i2i2i16");class Rl extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,h,_,f)}emplace(o,l,h,_,f,b){const S=4*o,E=8*o;return this.float32[S+0]=l,this.float32[S+1]=h,this.float32[S+2]=_,this.int16[E+6]=f,this.int16[E+7]=b,o}}Rl.prototype.bytesPerElement=16,xn(Rl,"StructArrayLayout2f1f2i16");class kl extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b){const S=this.length;return this.resize(S+1),this.emplace(S,o,l,h,_,f,b)}emplace(o,l,h,_,f,b,S){const E=20*o,R=5*o;return this.uint8[E+0]=l,this.uint8[E+1]=h,this.float32[R+1]=_,this.float32[R+2]=f,this.float32[R+3]=b,this.float32[R+4]=S,o}}kl.prototype.bytesPerElement=20,xn(kl,"StructArrayLayout2ub4f20");class Nr extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,h){const _=this.length;return this.resize(_+1),this.emplace(_,o,l,h)}emplace(o,l,h,_){const f=3*o;return this.uint16[f+0]=l,this.uint16[f+1]=h,this.uint16[f+2]=_,o}}Nr.prototype.bytesPerElement=6,xn(Nr,"StructArrayLayout3ui6");class Bu extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b,S,E,R,x,I,A,D,M,L,N,V,q,$,U,Z){const Y=this.length;return this.resize(Y+1),this.emplace(Y,o,l,h,_,f,b,S,E,R,x,I,A,D,M,L,N,V,q,$,U,Z)}emplace(o,l,h,_,f,b,S,E,R,x,I,A,D,M,L,N,V,q,$,U,Z,Y){const se=30*o,ve=15*o,W=60*o;return this.int16[se+0]=l,this.int16[se+1]=h,this.int16[se+2]=_,this.float32[ve+2]=f,this.float32[ve+3]=b,this.uint16[se+8]=S,this.uint16[se+9]=E,this.uint32[ve+5]=R,this.uint32[ve+6]=x,this.uint32[ve+7]=I,this.uint16[se+16]=A,this.uint16[se+17]=D,this.uint16[se+18]=M,this.float32[ve+10]=L,this.float32[ve+11]=N,this.uint8[W+48]=V,this.uint8[W+49]=q,this.uint8[W+50]=$,this.uint32[ve+13]=U,this.int16[se+28]=Z,this.uint8[W+58]=Y,o}}Bu.prototype.bytesPerElement=60,xn(Bu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class lp extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b,S,E,R,x,I,A,D,M,L,N,V,q,$,U,Z,Y,se,ve,W,ce,Se,me,Me,Ne,ze,$e){const nt=this.length;return this.resize(nt+1),this.emplace(nt,o,l,h,_,f,b,S,E,R,x,I,A,D,M,L,N,V,q,$,U,Z,Y,se,ve,W,ce,Se,me,Me,Ne,ze,$e)}emplace(o,l,h,_,f,b,S,E,R,x,I,A,D,M,L,N,V,q,$,U,Z,Y,se,ve,W,ce,Se,me,Me,Ne,ze,$e,nt){const st=20*o,Je=40*o,St=80*o;return this.float32[st+0]=l,this.float32[st+1]=h,this.int16[Je+4]=_,this.int16[Je+5]=f,this.int16[Je+6]=b,this.int16[Je+7]=S,this.int16[Je+8]=E,this.int16[Je+9]=R,this.int16[Je+10]=x,this.int16[Je+11]=I,this.int16[Je+12]=A,this.uint16[Je+13]=D,this.uint16[Je+14]=M,this.uint16[Je+15]=L,this.uint16[Je+16]=N,this.uint16[Je+17]=V,this.uint16[Je+18]=q,this.uint16[Je+19]=$,this.uint16[Je+20]=U,this.uint16[Je+21]=Z,this.uint16[Je+22]=Y,this.uint16[Je+23]=se,this.uint16[Je+24]=ve,this.uint16[Je+25]=W,this.uint16[Je+26]=ce,this.uint16[Je+27]=Se,this.uint32[st+14]=me,this.float32[st+15]=Me,this.float32[st+16]=Ne,this.float32[st+17]=ze,this.float32[st+18]=$e,this.uint8[St+76]=nt,o}}lp.prototype.bytesPerElement=80,xn(lp,"StructArrayLayout2f9i15ui1ul4f1ub80");class Pl extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}Pl.prototype.bytesPerElement=4,xn(Pl,"StructArrayLayout1f4");class Ud extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,h,_,f)}emplace(o,l,h,_,f,b){const S=5*o;return this.float32[S+0]=l,this.float32[S+1]=h,this.float32[S+2]=_,this.float32[S+3]=f,this.float32[S+4]=b,o}}Ud.prototype.bytesPerElement=20,xn(Ud,"StructArrayLayout5f20");class cg extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b,S){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,h,_,f,b,S)}emplace(o,l,h,_,f,b,S,E){const R=7*o;return this.float32[R+0]=l,this.float32[R+1]=h,this.float32[R+2]=_,this.float32[R+3]=f,this.float32[R+4]=b,this.float32[R+5]=S,this.float32[R+6]=E,o}}cg.prototype.bytesPerElement=28,xn(cg,"StructArrayLayout7f28");class Qt extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b,S,E,R,x,I){const A=this.length;return this.resize(A+1),this.emplace(A,o,l,h,_,f,b,S,E,R,x,I)}emplace(o,l,h,_,f,b,S,E,R,x,I,A){const D=11*o;return this.float32[D+0]=l,this.float32[D+1]=h,this.float32[D+2]=_,this.float32[D+3]=f,this.float32[D+4]=b,this.float32[D+5]=S,this.float32[D+6]=E,this.float32[D+7]=R,this.float32[D+8]=x,this.float32[D+9]=I,this.float32[D+10]=A,o}}Qt.prototype.bytesPerElement=44,xn(Qt,"StructArrayLayout11f44");class lv extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b,S,E,R){const x=this.length;return this.resize(x+1),this.emplace(x,o,l,h,_,f,b,S,E,R)}emplace(o,l,h,_,f,b,S,E,R,x){const I=9*o;return this.float32[I+0]=l,this.float32[I+1]=h,this.float32[I+2]=_,this.float32[I+3]=f,this.float32[I+4]=b,this.float32[I+5]=S,this.float32[I+6]=E,this.float32[I+7]=R,this.float32[I+8]=x,o}}lv.prototype.bytesPerElement=36,xn(lv,"StructArrayLayout9f36");class Gf extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,h,_){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,h,_)}emplace(o,l,h,_,f){const b=6*o;return this.uint32[3*o+0]=l,this.uint16[b+2]=h,this.uint16[b+3]=_,this.uint16[b+4]=f,o}}Gf.prototype.bytesPerElement=12,xn(Gf,"StructArrayLayout1ul3ui12");class nb extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}nb.prototype.bytesPerElement=2,xn(nb,"StructArrayLayout1ui2");class qf extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const h=this.length;return this.resize(h+1),this.emplace(h,o,l)}emplace(o,l,h){const _=2*o;return this.float32[_+0]=l,this.float32[_+1]=h,o}}qf.prototype.bytesPerElement=8,xn(qf,"StructArrayLayout2f8");class $f extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b,S,E,R,x,I,A,D,M,L,N){const V=this.length;return this.resize(V+1),this.emplace(V,o,l,h,_,f,b,S,E,R,x,I,A,D,M,L,N)}emplace(o,l,h,_,f,b,S,E,R,x,I,A,D,M,L,N,V){const q=16*o;return this.float32[q+0]=l,this.float32[q+1]=h,this.float32[q+2]=_,this.float32[q+3]=f,this.float32[q+4]=b,this.float32[q+5]=S,this.float32[q+6]=E,this.float32[q+7]=R,this.float32[q+8]=x,this.float32[q+9]=I,this.float32[q+10]=A,this.float32[q+11]=D,this.float32[q+12]=M,this.float32[q+13]=L,this.float32[q+14]=N,this.float32[q+15]=V,o}}$f.prototype.bytesPerElement=64,xn($f,"StructArrayLayout16f64");class ug extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,_,f,b,S){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,h,_,f,b,S)}emplace(o,l,h,_,f,b,S,E){const R=10*o,x=5*o;return this.uint16[R+0]=l,this.uint16[R+1]=h,this.uint16[R+2]=_,this.uint16[R+3]=f,this.float32[x+2]=b,this.float32[x+3]=S,this.float32[x+4]=E,o}}ug.prototype.bytesPerElement=20,xn(ug,"StructArrayLayout4ui3f20");class dg extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.int16[1*o+0]=l,o}}dg.prototype.bytesPerElement=2,xn(dg,"StructArrayLayout1i2");class iu extends Mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint8[1*o+0]=l,o}}iu.prototype.bytesPerElement=1,xn(iu,"StructArrayLayout1ub1");class cv extends Qc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}cv.prototype.size=40;class hg extends Hf{get(o){return new cv(this,o)}}xn(hg,"CollisionBoxArray");class $o extends Qc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}$o.prototype.size=60;class cp extends Bu{get(o){return new $o(this,o)}}xn(cp,"PlacedSymbolArray");class Hd extends Qc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(o){this._structArray.uint32[this._pos4+14]=o}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(o){this._structArray.float32[this._pos4+18]=o}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Hd.prototype.size=80;class ib extends lp{get(o){return new Hd(this,o)}}xn(ib,"SymbolInstanceArray");class rb extends Pl{getoffsetX(o){return this.float32[1*o+0]}}xn(rb,"GlyphOffsetArray");class ia extends xc{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}xn(ia,"SymbolLineVertexArray");class ec extends Qc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ec.prototype.size=12;class pg extends Gf{get(o){return new ec(this,o)}}xn(pg,"FeatureIndexArray");class up extends nu{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}xn(up,"FillExtrusionCentroidArray");class Gd extends Qc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Gd.prototype.size=6;class Wf extends op{get(o){return new Gd(this,o)}}xn(Wf,"FillExtrusionWallArray");const uv=nr([{name:"a_pos",components:2,type:"Int16"}],4),dv=nr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Lo{constructor(o=[]){this.segments=o}_prepareSegment(o,l,h,_){let f=this.segments[this.segments.length-1];return o>Lo.MAX_VERTEX_ARRAY_LENGTH&&ji(`Max vertices per segment is ${Lo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!f||f.vertexLength+o>Lo.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==_)&&(f={vertexOffset:l,primitiveOffset:h,vertexLength:0,primitiveLength:0},void 0!==_&&(f.sortKey=_),this.segments.push(f)),f}prepareSegment(o,l,h,_){return this._prepareSegment(o,l.length,h.length,_)}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,h,_){return new Lo([{vertexOffset:o,primitiveOffset:l,vertexLength:h,primitiveLength:_,vaos:{},sortKey:0}])}}function hv(u,o){return 256*(u=Pt(Math.floor(u),0,255))+Pt(Math.floor(o),0,255)}Lo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xn(Lo,"SegmentVector");const ob=nr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Wa=nr([{name:"a_dash",components:4,type:"Uint16"}]);class zu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(o,l,h,_){this.ids.push(Vu(o)),this.positions.push(l,h,_)}eachPosition(o,l){const h=Vu(o);let _=0,f=this.ids.length-1;for(;_<f;){const b=_+f>>1;this.ids[b]>=h?f=b:_=b+1}for(;this.ids[_]===h;)l(this.positions[3*_],this.positions[3*_+1],this.positions[3*_+2]),_++}static serialize(o,l){const h=new Float64Array(o.ids),_=new Uint32Array(o.positions);return dp(h,_,0,h.length-1),l&&(l.add(h.buffer),l.add(_.buffer)),{ids:h,positions:_}}static deserialize(o){const l=new zu;let h;l.ids=o.ids,l.positions=o.positions;for(const _ of l.ids)_!==h&&l.uniqueIds.push(_),h=_;return l.indexed=!0,l}}function Vu(u){const o=+u;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:wa(String(u))}function dp(u,o,l,h){for(;l<h;){const _=u[l+h>>1];let f=l-1,b=h+1;for(;;){do{f++}while(u[f]<_);do{b--}while(u[b]>_);if(f>=b)break;hp(u,f,b),hp(o,3*f,3*b),hp(o,3*f+1,3*b+1),hp(o,3*f+2,3*b+2)}b-l<h-b?(dp(u,o,l,b),l=b+1):(dp(u,o,b+1,h),h=b)}}function hp(u,o,l){const h=u[o];u[o]=u[l],u[l]=h}xn(zu,"FeaturePositionMap");class wc{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}set(o,l,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class ju extends wc{constructor(o){super(o),this.current=0}set(o,l,h){this.fetchUniformLocation(o,l)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class os extends wc{constructor(o){super(o),this.current=0}set(o,l,h){this.fetchUniformLocation(o,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class tc extends wc{constructor(o){super(o),this.current=[0,0]}set(o,l,h){this.fetchUniformLocation(o,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class fg extends wc{constructor(o){super(o),this.current=[0,0,0]}set(o,l,h){this.fetchUniformLocation(o,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class Xf extends wc{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,h){this.fetchUniformLocation(o,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class pp extends wc{constructor(o){super(o),this.current=mr.transparent.toRenderColor(null)}set(o,l,h){this.fetchUniformLocation(o,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const fp=new Float32Array(16);class Zf extends wc{constructor(o){super(o),this.current=fp}set(o,l,h){if(this.fetchUniformLocation(o,l)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let _=1;_<16;_++)if(h[_]!==this.current[_]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const mp=new Float32Array(9),Yf=new Float32Array(4);class Uu extends wc{constructor(o){super(o),this.current=Yf}set(o,l,h){if(this.fetchUniformLocation(o,l))for(let _=0;_<4;_++)if(h[_]!==this.current[_]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}function mg(u){return[hv(255*u.r,255*u.g),hv(255*u.b,255*u.a)]}class gp{constructor(o,l,h,_){this.value=o,this.uniformNames=l.map(f=>`u_${f}`),this.type=h,this.context=_}setUniform(o,l,h,_,f){const b=_.constantOr(this.value);l.set(o,f,b instanceof mr?b.toRenderColor(this.context.lut):b)}getBinding(o,l){return"color"===this.type?new pp(o):new os(o)}}class qd{constructor(o,l){this.uniformNames=l.map(h=>`u_${h}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,h,_,f){const b="u_pattern"===f||"u_dash"===f?this.pattern:"u_pixel_ratio"===f?this.pixelRatio:null;b&&l.set(o,f,b)}getBinding(o,l){return"u_pattern"===l||"u_dash"===l?new Xf(o):new os(o)}}class nc{constructor(o,l,h,_){this.expression=o,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(o,l,h,_,f,b,S){const E=this.paintVertexArray.length,R=this.expression.evaluate(new ao(0,{brightness:b}),l,{},f,_,S);this.paintVertexArray.resize(o),this._setPaintValue(E,o,R,this.context)}updatePaintArray(o,l,h,_,f,b,S){const E=this.expression.evaluate({zoom:0,brightness:S},h,_,void 0,f);this._setPaintValue(o,l,E,this.context)}_setPaintValue(o,l,h,_){if("color"===this.type){const f=mg(h.toRenderColor(_.lut));for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,f[0],f[1])}else{for(let f=o;f<l;f++)this.paintVertexArray.emplace(f,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fa{constructor(o,l,h,_,f,b){this.expression=o,this.uniformNames=l.map(S=>`u_${S}_t`),this.type=h,this.useIntegerZoom=_,this.context=f,this.maxValue=0,this.paintVertexAttributes=l.map(S=>({name:`a_${S}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(o,l,h,_,f,b,S){const E=this.expression.evaluate(new ao(this.context.zoom,{brightness:b}),l,{},f,_,S),R=this.expression.evaluate(new ao(this.context.zoom+1,{brightness:b}),l,{},f,_,S),x=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(x,o,E,R,this.context)}updatePaintArray(o,l,h,_,f,b,S){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:S},h,_,void 0,f),R=this.expression.evaluate({zoom:this.context.zoom+1,brightness:S},h,_,void 0,f);this._setPaintValue(o,l,E,R,this.context)}_setPaintValue(o,l,h,_,f){if("color"===this.type){const b=mg(h.toRenderColor(f.lut)),S=mg(h.toRenderColor(f.lut));for(let E=o;E<l;E++)this.paintVertexArray.emplace(E,b[0],b[1],S[0],S[1])}else{for(let b=o;b<l;b++)this.paintVertexArray.emplace(b,h,_);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(_))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,h,_,f){const b=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,S=Pt(this.expression.interpolationFactor(b,this.context.zoom,this.context.zoom+1),0,1);l.set(o,f,S)}getBinding(o,l){return new os(o)}}class Ia{constructor(o,l,h,_,f){this.expression=o,this.layerId=f,this.paintVertexAttributes=("array"===h?Wa:ob).members;for(let b=0;b<l.length;++b);this.paintVertexArray=new _}populatePaintArray(o,l,h,_){const f=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(f,o,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(o,l,h,_,f,b,S){this._setPaintValues(o,l,h.patterns&&h.patterns[this.layerId],b)}_setPaintValues(o,l,h,_){if(!_||!h)return;const f=_[h];if(!f)return;const{tl:b,br:S,pixelRatio:E}=f;for(let R=o;R<l;R++)this.paintVertexArray.emplace(R,b[0],b[1],S[0],S[1],E)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sc{constructor(o,l,h=(()=>!0)){this.binders={},this._buffers=[],this.context=l;const _=[];for(const f in o.paint._values){const b=o.paint.get(f);if(!h(f)||!(b instanceof Od&&Ru(b.property.specification)))continue;const S=Oo(f,o.type),E=b.value,R=b.property.specification.type,x=!!b.property.useIntegerZoom,I="line-dasharray"===f||f.endsWith("pattern"),A="line-dasharray"===f&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==E.kind||A)if("source"===E.kind||A||I){const D=ab(f,R,"source");this.binders[f]=I?new Ia(E,S,R,D,o.id):new nc(E,S,R,D),_.push(`/a_${f}`)}else{const D=ab(f,R,"composite");this.binders[f]=new fa(E,S,R,x,l,D),_.push(`/z_${f}`)}else this.binders[f]=I?new qd(E.value,S):new gp(E.value,S,R,l),_.push(`/u_${f}`)}this.cacheKey=_.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof nc||l instanceof fa?l.maxValue:0}populatePaintArrays(o,l,h,_,f,b,S){for(const E in this.binders){const R=this.binders[E];R.context=this.context,(R instanceof nc||R instanceof fa||R instanceof Ia)&&R.populatePaintArray(o,l,h,_,f,b,S)}}setConstantPatternPositions(o){for(const l in this.binders){const h=this.binders[l];h instanceof qd&&h.setConstantPatternPositions(o)}}updatePaintArrays(o,l,h,_,f,b,S,E){let R=!1;const x=Object.keys(o),I=0!==x.length,A=I?x:l.uniqueIds;this.context.lut=f.lut;for(const D in this.binders){const M=this.binders[D];if(M.context=this.context,(M instanceof nc||M instanceof fa||M instanceof Ia)&&(!0===M.expression.isStateDependent||!1===M.expression.isLightConstant)){const L=f.paint.get(D);M.expression=L.value;for(const N of A){const V=o[N.toString()];l.eachPosition(N,(q,$,U)=>{const Z=_.feature(q);M.updatePaintArray($,U,Z,V,b,S,E)})}if(!I)for(const N of h.uniqueIds){const V=o[N.toString()];h.eachPosition(N,(q,$,U)=>{const Z=_.feature(q);M.updatePaintArray($,U,Z,V,b,S,E)})}R=!0}}return R}defines(){const o=[];for(const l in this.binders){const h=this.binders[l];(h instanceof gp||h instanceof qd)&&o.push(...h.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof nc||h instanceof fa||h instanceof Ia)for(let _=0;_<h.paintVertexAttributes.length;_++)o.push(h.paintVertexAttributes[_].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof gp||h instanceof qd||h instanceof fa)for(const _ of h.uniformNames)o.push(_)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const h in this.binders){const _=this.binders[h];if(_ instanceof gp||_ instanceof qd||_ instanceof fa)for(const f of _.uniformNames)l.push({name:f,property:h,binding:_.getBinding(o,f)})}return l}setUniforms(o,l,h,_,f){for(const{name:b,property:S,binding:E}of h)this.binders[S].setUniform(o,E,f,_.get(S),b)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof nc||l instanceof fa||l instanceof Ia)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(const l in this.binders){const h=this.binders[l];(h instanceof nc||h instanceof fa||h instanceof Ia)&&h.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof nc||l instanceof fa||l instanceof Ia)&&l.destroy()}}}class mt{constructor(o,l,h=(()=>!0)){this.programConfigurations={};for(const _ of o)this.programConfigurations[_.id]=new Sc(_,l,h);this.needsUpload=!1,this._featureMap=new zu,this._featureMapWithoutIds=new zu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(o,l,h,_,f,b,S,E){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(o,l,_,f,b,S,E);void 0!==l.id?this._featureMap.add(l.id,h,this._bufferOffset,o):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,o),this._idlessCounter+=1),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,h,_,f,b){for(const S of h)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(o,this._featureMap,this._featureMapWithoutIds,l,S,_,f,b||0)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const sb={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Oo(u,o){return sb[u]||[u.replace(`${o}-`,"").replace(/-/g,"_")]}const gg={"line-pattern":{source:Jl,composite:Jl},"fill-pattern":{source:Jl,composite:Jl},"fill-extrusion-pattern":{source:Jl,composite:Jl},"line-dasharray":{source:sp,composite:sp}},_p={color:{source:qf,composite:$a},number:{source:Pl,composite:qf}};function ab(u,o,l){const h=gg[u];return h&&h[l]||_p[o][l]}xn(gp,"ConstantBinder"),xn(qd,"PatternConstantBinder"),xn(nc,"SourceExpressionBinder"),xn(Ia,"PatternCompositeBinder"),xn(fa,"CompositeExpressionBinder"),xn(Sc,"ProgramConfiguration",{omit:["_buffers"]}),xn(mt,"ProgramConfigurationSet");const Us=Jt/Math.PI/2,c=64,g=[c,32,16],v=-Us,w=Us;function C(u,o,l,h=Us){return l=ri(l),[u*Math.sin(l)*h,-o*h,u*Math.cos(l)*h]}function k(u,o,l){return C(Math.cos(ri(u)),Math.sin(ri(u)),o,l)}const O=6371008.8,B=2*Math.PI*O;class F{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new F(tr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,h=this.lat*l,_=o.lat*l,f=Math.sin(h)*Math.sin(_)+Math.cos(h)*Math.cos(_)*Math.cos((o.lng-this.lng)*l);return O*Math.acos(Math.min(f,1))}toBounds(o=0){const l=360*o/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new j({lng:this.lng-h,lat:this.lat-l},{lng:this.lng+h,lat:this.lat+l})}toEcef(o){return k(this.lat,this.lng,Us+o*Us/O)}static convert(o){if(o instanceof F)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new F(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new F(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class j{constructor(o,l){if(o)if(l)this.setSouthWest(o).setNorthEast(l);else if(4===o.length){const h=o;this.setSouthWest([h[0],h[1]]).setNorthEast([h[2],h[3]])}else{const h=o;this.setSouthWest(h[0]).setNorthEast(h[1])}}setNorthEast(o){return this._ne=o instanceof F?new F(o.lng,o.lat):F.convert(o),this}setSouthWest(o){return this._sw=o instanceof F?new F(o.lng,o.lat):F.convert(o),this}extend(o){const l=this._sw,h=this._ne;let _,f;if(o instanceof F)_=o,f=o;else{if(!(o instanceof j))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(j.convert(o)):this.extend(F.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(F.convert(o)):this;if(_=o._sw,f=o._ne,!_||!f)return this}return l||h?(l.lng=Math.min(_.lng,l.lng),l.lat=Math.min(_.lat,l.lat),h.lng=Math.max(f.lng,h.lng),h.lat=Math.max(f.lat,h.lat)):(this._sw=new F(_.lng,_.lat),this._ne=new F(f.lng,f.lat)),this}getCenter(){return new F((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new F(this.getWest(),this.getNorth())}getSouthEast(){return new F(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:h}=F.convert(o);let _=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&_}static convert(o){if(o)return o instanceof j?o:new j(o)}}function Q(u){return B*Math.cos(u*Math.PI/180)}function K(u){return(180+u)/360}function ne(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function te(u,o){return u/Q(o)}function pe(u){return 360*u-180}function be(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function ye(u,o){return u*Q(be(o))}const we=85.051129;function Ee(u){return Math.cos(ri(Pt(u,-we,we)))}function Ce(u,o){const l=Pt(o,0,25.5),h=Math.pow(2,l);return Ee(u)*B/(512*h)}function Ie(u){return 1/Math.cos(u*Math.PI/180)}function Le(u,o=0){const l=Math.exp(Math.PI*(1-(u.y+o/Jt)/(1<<u.z)*2));return 80150034*l/(l*l+1)/Jt/(1<<u.z)}class je{constructor(o,l,h=0){this.x=+o,this.y=+l,this.z=+h}static fromLngLat(o,l=0){const h=F.convert(o);return new je(K(h.lng),ne(h.lat),te(l,h.lat))}toLngLat(){return new F(pe(this.x),be(this.y))}toAltitude(){return ye(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/B*Ie(be(this.y))}}function Fe(u,o,l,h,_,f,b,S,E){const R=(o+h)/2,x=(l+_)/2,I=new jt(R,x);S(I),function(A,D,M,L,N,V){const q=M-N,$=L-V;return Math.abs((L-D)*q-(M-A)*$)/Math.hypot(q,$)}(I.x,I.y,f.x,f.y,b.x,b.y)>=E?(Fe(u,o,l,R,x,f,I,S,E),Fe(u,R,x,h,_,I,b,S,E)):u.push(b)}function Oe(u,o,l){let h=u[0],_=h.x,f=h.y;o(h);const b=[h];for(let S=1;S<u.length;S++){const E=u[S],{x:R,y:x}=E;o(E),Fe(b,_,f,R,x,h,E,o,l),_=R,f=x,h=E}return b}function ct(u,o,l,h){if(h(o,l)){const _=o.add(l)._mult(.5);ct(u,o,_,h),ct(u,_,l,h)}else u.push(l)}function _t(u,o){let l=u[0];const h=[l];for(let _=1;_<u.length;_++){const f=u[_];ct(h,l,f,o),l=f}return h}const Ft=Math.pow(2,14)-1,Yt=-Ft-1;function nn(u,o){const l=Math.round(u.x*o),h=Math.round(u.y*o);return u.x=Pt(l,Yt,Ft),u.y=Pt(h,Yt,Ft),(l<u.x||l>u.x+1||h<u.y||h>u.y+1)&&ji("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function Ke(u,o,l){const h=u.loadGeometry(),_=u.extent,f=Jt/_;if(o&&l&&l.projection.isReprojectedInTileSpace){const b=1<<o.z,{scale:S,x:E,y:R,projection:x}=l,I=A=>{const D=pe((o.x+A.x/_)/b),M=be((o.y+A.y/_)/b),L=x.project(D,M);A.x=(L.x*S-E)*_,A.y=(L.y*S-R)*_};for(let A=0;A<h.length;A++)if(1!==u.type)h[A]=Oe(h[A],I,1);else{const D=[];for(const M of h[A])M.x<0||M.x>=_||M.y<0||M.y>=_||(I(M),D.push(M));h[A]=D}}for(const b of h)for(const S of b)nn(S,f);return h}function At(u,o){return{type:u.type,id:u.id,properties:u.properties,geometry:o?Ke(u):[]}}function ft(u,o,l,h,_){u.emplaceBack(2*o+(h+1)/2,2*l+(_+1)/2)}function Rt(u,o,l){u.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class Vt{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new xc,this.indexArray=new Nr,this.segments=new Lo,this.programConfigurations=new mt(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}updateFootprints(o,l){}populate(o,l,h,_){const f=this.layers[0],b=[];let S=null;"circle"===f.type&&(S=f.layout.get("circle-sort-key"));for(const{feature:R,id:x,index:I,sourceLayerIndex:A}of o){const D=this.layers[0]._featureFilter.needGeometry,M=At(R,D);if(!this.layers[0]._featureFilter.filter(new ao(this.zoom),M,h))continue;const L=S?S.evaluate(M,{},h):void 0,N={id:x,properties:R.properties,type:R.type,sourceLayerIndex:A,index:I,geometry:D?M.geometry:Ke(R,h,_),patterns:{},sortKey:L};b.push(N)}S&&b.sort((R,x)=>R.sortKey-x.sortKey);let E=null;"globe"===_.projection.name&&(this.globeExtVertexArray=new Ql,E=_.projection);for(const R of b){const{geometry:x,index:I,sourceLayerIndex:A}=R,D=o[I].feature;this.addFeature(R,x,I,l.availableImages,h,E,l.brightness),l.featureIndex.insert(D,x,I,A,this.index)}}update(o,l,h,_,f){const b=0!==Object.keys(o).length;b&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(o,l,b?this.stateDependentLayers:this.layers,h,_,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,uv.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,dv.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,h,_,f,b,S){for(const E of l)for(const R of E){const x=R.x,I=R.y;if(x<0||x>=Jt||I<0||I>=Jt)continue;if(b){const M=b.projectTilePoint(x,I,f),L=b.upVector(f,x,I),N=this.globeExtVertexArray;Rt(N,M,L),Rt(N,M,L),Rt(N,M,L),Rt(N,M,L)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),D=A.vertexLength;ft(this.layoutVertexArray,x,I,-1,-1),ft(this.layoutVertexArray,x,I,1,-1),ft(this.layoutVertexArray,x,I,1,1),ft(this.layoutVertexArray,x,I,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,h,{},_,f,S)}}function It(u,o){for(let l=0;l<u.length;l++)if(Bi(o,u[l]))return!0;for(let l=0;l<o.length;l++)if(Bi(u,o[l]))return!0;return!!wn(u,o)}function sn(u,o,l){return!!Bi(u,o)||!!rn(o,u,l)}function An(u,o){if(1===u.length)return pi(o,u[0]);for(let l=0;l<o.length;l++){const h=o[l];for(let _=0;_<h.length;_++)if(Bi(u,h[_]))return!0}for(let l=0;l<u.length;l++)if(pi(o,u[l]))return!0;for(let l=0;l<o.length;l++)if(wn(u,o[l]))return!0;return!1}function Nn(u,o,l){if(u.length>1){if(wn(u,o))return!0;for(let h=0;h<o.length;h++)if(rn(o[h],u,l))return!0}for(let h=0;h<u.length;h++)if(rn(u[h],o,l))return!0;return!1}function wn(u,o){if(0===u.length||0===o.length)return!1;for(let l=0;l<u.length-1;l++){const h=u[l],_=u[l+1];for(let f=0;f<o.length-1;f++)if(Bn(h,_,o[f],o[f+1]))return!0}return!1}function Bn(u,o,l,h){return Gl(u,l,h)!==Gl(o,l,h)&&Gl(u,o,l)!==Gl(u,o,h)}function rn(u,o,l){const h=l*l;if(1===o.length)return u.distSqr(o[0])<h;for(let _=1;_<o.length;_++)if(Hn(u,o[_-1],o[_])<h)return!0;return!1}function Hn(u,o,l){const h=o.distSqr(l);if(0===h)return u.distSqr(o);const _=((u.x-o.x)*(l.x-o.x)+(u.y-o.y)*(l.y-o.y))/h;return u.distSqr(_<0?o:_>1?l:l.sub(o)._mult(_)._add(o))}function pi(u,o){let l,h,_,f=!1;for(let b=0;b<u.length;b++){l=u[b];for(let S=0,E=l.length-1;S<l.length;E=S++)h=l[S],_=l[E],h.y>o.y!=_.y>o.y&&o.x<(_.x-h.x)*(o.y-h.y)/(_.y-h.y)+h.x&&(f=!f)}return f}function Bi(u,o){let l=!1;for(let h=0,_=u.length-1;h<u.length;_=h++){const f=u[h],b=u[_];f.y>o.y!=b.y>o.y&&o.x<(b.x-f.x)*(o.y-f.y)/(b.y-f.y)+f.x&&(l=!l)}return l}function Sr(u,o,l,h,_){for(const b of u)if(o<=b.x&&l<=b.y&&h>=b.x&&_>=b.y)return!0;const f=[new jt(o,l),new jt(o,_),new jt(h,_),new jt(h,l)];if(u.length>2)for(const b of f)if(Bi(u,b))return!0;for(let b=0;b<u.length-1;b++)if(Gi(u[b],u[b+1],f))return!0;return!1}function Gi(u,o,l){const h=l[0],_=l[2];if(u.x<h.x&&o.x<h.x||u.x>_.x&&o.x>_.x||u.y<h.y&&o.y<h.y||u.y>_.y&&o.y>_.y)return!1;const f=Gl(u,o,l[0]);return f!==Gl(u,o,l[1])||f!==Gl(u,o,l[2])||f!==Gl(u,o,l[3])}function Hr(u,o,l,h,_,f){let b=o.y-u.y,S=u.x-o.x;if(f=f||0){const E=b*b+S*S;if(0===E)return!0;const R=Math.sqrt(E);b/=R,S/=R}return!((l.x-u.x)*b+(l.y-u.y)*S-f<0||(h.x-u.x)*b+(h.y-u.y)*S-f<0||(_.x-u.x)*b+(_.y-u.y)*S-f<0)}function rr(u,o,l,h,_,f,b){return!(Hr(u,o,h,_,f,b)||Hr(o,l,h,_,f,b)||Hr(l,u,h,_,f,b)||Hr(h,_,u,o,l,b)||Hr(_,f,u,o,l,b)||Hr(f,h,u,o,l,b))}function Ar(u,o,l){const h=o.paint.get(u).value;return"constant"===h.kind?h.value:l.programConfigurations.get(o.id).getMaxValue(u)}function Ei(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Tr(u,o,l,h,_){if(!o[0]&&!o[1])return u;const f=jt.convert(o)._mult(_);"viewport"===l&&f._rotate(-h);const b=[];for(let S=0;S<u.length;S++)b.push(u[S].sub(f));return b}function yr(u,o,l,h){const _=jt.convert(u)._mult(h);return"viewport"===o&&_._rotate(-l),_}let Ci,Gr;xn(Vt,"CircleBucket",{omit:["layers"]});var Wo,ma={exports:{}},Eo=(Wo||(Wo=1,function(l){function h(f,b,S){var E=_(256*f,256*(b=Math.pow(2,S)-b-1),S),R=_(256*(f+1),256*(b+1),S);return E[0]+","+E[1]+","+R[0]+","+R[1]}function _(f,b,S){var E=2*Math.PI*6378137/256/Math.pow(2,S);return[f*E-2*Math.PI*6378137/2,b*E-2*Math.PI*6378137/2]}l.getURL=function(f,b,S,E,R,x){return x=x||{},f+"?"+["bbox="+h(S,E,R),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+b].join("&")},l.getTileBBox=h,l.getMercCoords=_,Object.defineProperty(l,"__esModule",{value:!0})}(ma.exports)),ma.exports);class Fo{constructor(o,l,h){this.z=o,this.x=l,this.y=h,this.key=or(0,o,o,l,h)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const h=Eo.getTileBBox(this.x,this.y,this.z),_=function(f,b,S){let E,R="";for(let x=f;x>0;x--)E=1<<x-1,R+=(b&E?1:0)+(S&E?2:0);return R}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",_).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qi{constructor(o,l){this.wrap=o,this.canonical=l,this.key=or(o,l.z,l.z,l.x,l.y)}}class Vi{constructor(o,l,h,_,f){this.overscaledZ=o,this.wrap=l,this.canonical=new Fo(h,+_,+f),this.key=0===l&&o===h?this.canonical.key:or(l,o,h,_,f)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new Vi(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vi(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return or(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-o;return or(this.wrap*+l,o,o,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.z<this.canonical.z&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new Vi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,_=2*this.canonical.y;return[new Vi(l,this.wrap,l,h,_),new Vi(l,this.wrap,l,h+1,_),new Vi(l,this.wrap,l,h,_+1),new Vi(l,this.wrap,l,h+1,_+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Vi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Vi(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function or(u,o,l,h,_){const f=1<<Math.min(l,22);let b=f*(_%f)+h%f;return u&&l<22&&(b+=f*f*((u<0?-2*u-1:2*u)%(1<<2*(22-l)))),16*(32*b+l)+(o-l)}const Rr=[u=>{let o=u.canonical.x-1,l=u.wrap;return o<0&&(o=(1<<u.canonical.z)-1,l--),new Vi(u.overscaledZ,l,u.canonical.z,o,u.canonical.y)},u=>{let o=u.canonical.x+1,l=u.wrap;return o===1<<u.canonical.z&&(o=0,l++),new Vi(u.overscaledZ,l,u.canonical.z,o,u.canonical.y)},u=>new Vi(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(0===u.canonical.y?1<<u.canonical.z:u.canonical.y)-1),u=>new Vi(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];xn(Fo,"CanonicalTileID"),xn(Vi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Io=nr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Xr}=Io,ds=nr([{name:"a_pos_3",components:3,type:"Int16"}]);var Ll=nr([{name:"a_pos",type:"Int16",components:2}]);class Ma{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,h){const _=ee.vec3.dot(l,this.dir);if(Math.abs(_)<1e-6)return!1;const f=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/_;return h[0]=this.pos[0]+this.dir[0]*f,h[1]=this.pos[1]+this.dir[1]*f,h[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(o,l,h){if(ee.vec3.equals(this.pos,o)||0===l)return h[0]=h[1]=h[2]=0,!1;const[_,f,b]=this.dir,S=this.pos[0]-o[0],E=this.pos[1]-o[1],R=this.pos[2]-o[2],x=_*_+f*f+b*b,I=2*(S*_+E*f+R*b),A=I*I-4*x*(S*S+E*E+R*R-l*l);if(A<0){const D=Math.max(-I/2,0),M=S+_*D,L=E+f*D,N=R+b*D,V=Math.hypot(M,L,N);return h[0]=M*l/V,h[1]=L*l/V,h[2]=N*l/V,!1}{const D=(-I-Math.sqrt(A))/(2*x);if(D<0){const M=Math.hypot(S,E,R);return h[0]=S*l/M,h[1]=E*l/M,h[2]=R*l/M,!1}return h[0]=S+_*D,h[1]=E+f*D,h[2]=R+b*D,!0}}}class Aa{constructor(o,l,h,_,f){this.TL=o,this.TR=l,this.BR=h,this.BL=_,this.horizon=f}static fromInvProjectionMatrix(o,l,h){const _=[-1,1,1],f=[1,1,1],b=[1,-1,1],S=[-1,-1,1],E=ee.vec3.transformMat4(_,_,o),R=ee.vec3.transformMat4(f,f,o),x=ee.vec3.transformMat4(b,b,o),I=ee.vec3.transformMat4(S,S,o);return new Aa(E,R,x,I,l/h)}}function Ra(u,o,l){let h=1/0,_=-1/0;const f=[];for(const b of u){ee.vec3.sub(f,b,o);const S=ee.vec3.dot(f,l);h=Math.min(h,S),_=Math.max(_,S)}return[h,_]}function Xa(u,o){let l=!0;for(let h=0;h<u.planes.length;h++){const _=u.planes[h];let f=0;for(let b=0;b<o.length;b++)f+=ee.vec3.dot(_,o[b])+_[3]>=0;if(0===f)return 0;f!==o.length&&(l=!1)}return l?2:1}function ka(u,o){for(const l of u.projections){const h=Ra(o,u.points[0],l.axis);if(l.projection[1]<h[0]||l.projection[0]>h[1])return 0}return 1}function ic(u,o){let l=0;const h=[0,0,0,0];for(let _=0;_<u.length;_++)h[0]=u[_][0],h[1]=u[_][1],h[2]=u[_][2],h[3]=1,ee.vec4.dot(h,o)>=0&&l++;return l}class fl{constructor(o,l){this.points=o||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=er.fromPoints(this.points),this.projections=[],this.frustumEdges=[ee.vec3.sub([],this.points[2],this.points[3]),ee.vec3.sub([],this.points[0],this.points[3]),ee.vec3.sub([],this.points[4],this.points[0]),ee.vec3.sub([],this.points[5],this.points[1]),ee.vec3.sub([],this.points[6],this.points[2]),ee.vec3.sub([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const _=[0,-h[2],h[1]],f=[h[2],0,-h[0]];this.projections.push({axis:_,projection:Ra(this.points,this.points[0],_)}),this.projections.push({axis:f,projection:Ra(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(o,l,h,_){const f=Math.pow(2,h),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const x=ee.vec4.transformMat4([],R,o),I=1/x[3]/l*f;return ee.vec4.mul(x,x,[I,I,_?1/x[3]:I,I])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const x=ee.vec3.sub([],b[R[0]],b[R[1]]),I=ee.vec3.sub([],b[R[2]],b[R[1]]),A=ee.vec3.normalize([],ee.vec3.cross([],x,I)),D=-ee.vec3.dot(A,b[R[1]]);return A.concat(D)}),E=[];for(let R=0;R<b.length;R++)E.push([b[R][0],b[R][1],b[R][2]]);return new fl(E,S)}intersectsPrecise(o,l,h){for(let _=0;_<l.length;_++)if(!ic(o,l[_]))return 0;for(let _=0;_<this.planes.length;_++)if(!ic(o,this.planes[_]))return 0;for(const _ of h)for(const f of this.frustumEdges){const b=ee.vec3.cross([],_,f),S=ee.vec3.length(b);if(0===S)continue;ee.vec3.scale(b,b,1/S);const E=Ra(this.points,this.points[0],b),R=Ra(o,this.points[0],b);if(E[0]>R[1]||R[0]>E[1])return 0}return 1}containsPoint(o){for(const l of this.planes){const h=l[3];if(ee.vec3.dot([l[0],l[1],l[2]],o)+h<0)return!1}return!0}}class er{static fromPoints(o){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const _ of o)ee.vec3.min(l,l,_),ee.vec3.max(h,h,_);return new er(l,h)}static fromTileIdAndHeight(o,l,h){const _=1<<o.canonical.z,f=o.canonical.x,b=o.canonical.y;return new er([f/_,b/_,l],[(f+1)/_,(b+1)/_,h])}static applyTransform(o,l){const h=o.getCorners();for(let _=0;_<h.length;++_)ee.vec3.transformMat4(h[_],h[_],l);return er.fromPoints(h)}static applyTransformFast(o,l){const h=[l[12],l[13],l[14]],_=[...h];for(let f=0;f<3;f++)for(let b=0;b<3;b++){const S=l[4*b+f],E=S*o.min[b],R=S*o.max[b];h[f]+=Math.min(E,R),_[f]+=Math.max(E,R)}return new er(h,_)}static projectAabbCorners(o,l){const h=o.getCorners();for(let _=0;_<h.length;++_)ee.vec3.transformMat4(h[_],h[_],l);return h}constructor(o,l){this.min=o,this.max=l,this.center=ee.vec3.scale([],ee.vec3.add([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],h=ee.vec3.clone(this.min),_=ee.vec3.clone(this.max);for(let f=0;f<l.length;f++)h[f]=l[f]?this.min[f]:this.center[f],_[f]=l[f]?this.center[f]:this.max[f];return _[2]=this.max[2],new er(h,_)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){return this.intersectsAabb(o.bounds)?Xa(o,this.getCorners()):0}intersectsFlat(o){return this.intersectsAabb(o.bounds)?Xa(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(o,l){return l||this.intersects(o)?ka(o,this.getCorners()):0}intersectsPreciseFlat(o,l){return l||this.intersectsFlat(o)?ka(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(o){for(let l=0;l<3;++l)if(this.min[l]>o.max[l]||o.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(o){return!(this.min[0]>o.max[0]||o.min[0]>this.max[0]||this.min[1]>o.max[1]||o.min[1]>this.max[1])}encapsulate(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o.min[l]),this.max[l]=Math.max(this.max[l],o.max[l])}encapsulatePoint(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o[l]),this.max[l]=Math.max(this.max[l],o[l])}closestPoint(o){return[Math.max(Math.min(this.max[0],o[0]),this.min[0]),Math.max(Math.min(this.max[1],o[1]),this.min[1]),Math.max(Math.min(this.max[2],o[2]),this.min[2])]}}function $d(u){return u*Us/O}xn(er,"Aabb");const _g=[new er([v,v,v],[w,w,w]),new er([v,v,v],[0,0,w]),new er([0,v,v],[w,0,w]),new er([v,0,v],[0,w,w]),new er([0,0,v],[w,w,w])];function ru(u,o,l,h=!0){const _=ee.vec3.scale([],u._camera.position,u.worldSize),f=[o,l,1,1];ee.vec4.transformMat4(f,f,u.pixelMatrixInverse),ee.vec4.scale(f,f,1/f[3]);const b=ee.vec3.sub([],f,_),S=ee.vec3.normalize([],b),E=u.globeMatrix,R=[E[12],E[13],E[14]],x=ee.vec3.sub([],R,_),I=ee.vec3.length(x),A=ee.vec3.normalize([],x),D=u.worldSize/(2*Math.PI),M=ee.vec3.dot(A,S),L=Math.asin(D/I);if(L<Math.acos(M)){if(!h)return null;const Se=[],me=[];ee.vec3.scale(Se,S,I/M),ee.vec3.normalize(me,ee.vec3.sub(me,Se,x)),ee.vec3.normalize(S,ee.vec3.add(S,x,ee.vec3.scale(S,me,Math.tan(L)*I)))}const N=[];new Ma(_,S).closestPointOnSphere(R,D,N);const V=ee.vec3.normalize([],pd(E,0)),q=ee.vec3.normalize([],pd(E,1)),$=ee.vec3.normalize([],pd(E,2)),U=ee.vec3.dot(V,N),Z=ee.vec3.dot(q,N),Y=ee.vec3.dot($,N),se=Pe(Math.asin(-Z/D));let ve=Pe(Math.atan2(U,Y));ve=u.center.lng+function(Se,me){const Me=(me-Se+180)%360-180;return Me<-180?Me+360:Me}(u.center.lng,ve);const W=K(ve),ce=Pt(ne(se),0,1);return new je(W,ce)}class bp{constructor(o,l,h){this.a=ee.vec3.sub([],o,h),this.b=ee.vec3.sub([],l,h),this.center=h;const _=ee.vec3.normalize([],this.a),f=ee.vec3.normalize([],this.b);this.angle=Math.acos(ee.vec3.dot(_,f))}}function Wd(u,o){if(0===u.angle)return null;let l;return l=0===u.a[o]?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[o]/u.a[o]/Math.sin(u.angle)-1/Math.tan(u.angle)),l<0||l>1?null:function(h,_,f,b){const S=Math.sin(f);return h*(Math.sin((1-b)*f)/S)+_*(Math.sin(b*f)/S)}(u.a[o],u.b[o],u.angle,Pt(l,0,1))+u.center[o]}function Hu(u){if(u.z<=1)return _g[u.z+2*u.y+u.x];const o=bg(ub(u));return er.fromPoints(o)}function ml(u,o,l){return ee.vec3.scale(u,u,1-l),ee.vec3.scaleAndAdd(u,u,o,l)}function cb(u,o,l){for(const h of u)ee.vec3.transformMat4(h,h,o),ee.vec3.scale(h,h,l)}function pv(u,o,l,h){const _=o/u.worldSize,f=u.globeMatrix;if(l.z<=1){const W=Hu(l).getCorners();return cb(W,f,_),er.fromPoints(W)}const b=ub(l,h),S=bg(b,Us+$d(u._tileCoverLift));cb(S,f,_);const E=Number.MAX_VALUE,R=[-E,-E,-E],x=[E,E,E];if(b.contains(u.center)){for(const Se of S)ee.vec3.min(x,x,Se),ee.vec3.max(R,R,Se);R[2]=0;const W=u.point,ce=[W.x*_,W.y*_,0];return ee.vec3.min(x,x,ce),ee.vec3.max(R,R,ce),new er(x,R)}if(u._tileCoverLift>0){for(const W of S)ee.vec3.min(x,x,W),ee.vec3.max(R,R,W);return new er(x,R)}const I=[f[12]*_,f[13]*_,f[14]*_],A=b.getCenter(),D=Pt(u.center.lat,-we,we),M=Pt(A.lat,-we,we),L=K(u.center.lng),N=ne(D);let V=L-K(A.lng);const q=N-ne(M);V>.5?V-=1:V<-.5&&(V+=1);let $=0;if(Math.abs(V)>Math.abs(q))$=V>=0?1:3;else{$=q>=0?0:2;const W=[f[4]*_,f[5]*_,f[6]*_],ce=-Math.sin(ri(q>=0?b.getSouth():b.getNorth()))*Us;ee.vec3.scaleAndAdd(I,I,W,ce)}const U=S[$],Z=S[($+1)%4],Y=new bp(U,Z,I),se=[Wd(Y,0)||U[0],Wd(Y,1)||U[1],Wd(Y,2)||U[2]],ve=Gu(u.zoom);if(ve>0){const W=function({x:Se,y:me,z:Me},Ne,ze,$e,nt){const st=1/(1<<Me);let Je=Se*st,St=Je+st,$t=me*st,gt=$t+st,gn=0;const on=(Je+St)/2-$e;return on>.5?gn=-1:on<-.5&&(gn=1),Je=((Je+gn)*Ne-($e*=Ne))*ze+$e,St=((St+gn)*Ne-$e)*ze+$e,$t=($t*Ne-(nt*=Ne))*ze+nt,gt=(gt*Ne-nt)*ze+nt,[[Je,gt,0],[St,gt,0],[St,$t,0],[Je,$t,0]]}(l,o,u._pixelsPerMercatorPixel,L,N);for(let Se=0;Se<S.length;Se++)ml(S[Se],W[Se],ve);const ce=ee.vec3.add([],W[$],W[($+1)%4]);ee.vec3.scale(ce,ce,.5),ml(se,ce,ve)}for(const W of S)ee.vec3.min(x,x,W),ee.vec3.max(R,R,W);return x[2]=Math.min(U[2],Z[2]),ee.vec3.min(x,x,se),ee.vec3.max(R,R,se),new er(x,R)}function ub({x:u,y:o,z:l},h=!1){const _=1/(1<<l),f=new F(pe(u*_),o===(1<<l)-1&&h?-90:be((o+1)*_)),b=new F(pe((u+1)*_),0===o&&h?90:be(o*_));return new j(f,b)}function bg(u,o=Us){const l=ri(u.getNorth()),h=ri(u.getSouth()),_=Math.cos(l),f=Math.cos(h),b=Math.sin(l),S=Math.sin(h),E=u.getWest(),R=u.getEast();return[C(f,S,E,o),C(f,S,R,o),C(_,b,R,o),C(_,b,E,o)]}function yg(u,o,l,h){const _=1<<l.z,f=(u/Jt+l.x)/_;return k(be((o/Jt+l.y)/_),pe(f),h)}function db({min:u,max:o}){return 16383/Math.max(o[0]-u[0],o[1]-u[1],o[2]-u[2])}const s1=new Float64Array(16);function hb(u){const o=db(u),l=ee.mat4.fromScaling(s1,[o,o,o]);return ee.mat4.translate(l,l,ee.vec3.negate([],u.min))}function fv(u){const o=ee.mat4.fromTranslation(s1,u.min),l=1/db(u);return ee.mat4.scale(o,o,[l,l,l])}function mv(u){const o=Jt/(2*Math.PI);return u/(2*Math.PI)/o}function gv(u,o){return Jt/(512*Math.pow(2,u))*db(Hu(o))}function pb(u,o,l,h,_){const f=mv(l),b=[u,o,-l/(2*Math.PI)],S=ee.mat4.identity(new Float64Array(16));return ee.mat4.translate(S,S,b),ee.mat4.scale(S,S,[f,f,f]),ee.mat4.rotateX(S,S,ri(-_)),ee.mat4.rotateY(S,S,ri(-h)),S}function Gu(u){return Tn(5,6,u)}function fb(u,o){const l=k(o.lat,o.lng),h=function(f){const b=k(f._center.lat,f._center.lng),S=ee.vec3.fromValues(0,1,0);let E=ee.vec3.cross([],S,b);const R=ee.mat4.fromRotation([],-f.angle,b);E=ee.vec3.transformMat4(E,E,R),ee.mat4.fromRotation(R,-f._pitch,E);const x=ee.vec3.normalize([],b);return ee.vec3.scale(x,x,$d(f.cameraToCenterDistance/f.pixelsPerMeter)),ee.vec3.transformMat4(x,x,R),ee.vec3.add([],b,x)}(u),_=ee.vec3.subtract([],h,l);return ee.vec3.angle(_,l)}function _v(u,o){return fb(u,o)>Math.PI/2*1.01}const a1=ri(85),l1=Math.cos(a1),c1=Math.sin(a1),yp=ee.mat4.create(),bv=u=>{const o=[];return"map"===u.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===u.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o};function yv(u,o,l,h,_,f,b,S,E){if(f&&u.queryGeometry.isAboveHorizon)return!1;f&&(E*=u.pixelToTileUnitsFactor);const R=u.tileID.canonical,x=l.projection.upVectorScale(R,l.center.lat,l.worldSize).metersToTile;for(const I of o)for(const A of I){const D=A.add(S),M=_&&l.elevation?l.elevation.exaggeration()*_.getElevationAt(D.x,D.y,!0):0,L=l.projection.projectTilePoint(D.x,D.y,R);if(M>0){const $=l.projection.upVector(R,D.x,D.y);L.x+=$[0]*x*M,L.y+=$[1]*x*M,L.z+=$[2]*x*M}const N=f?D:VC(L.x,L.y,L.z,h),V=f?u.tilespaceRays.map($=>UC($,M)):u.queryGeometry.screenGeometry,q=ee.vec4.transformMat4([],[L.x,L.y,L.z,1],h);if(!b&&f?E*=q[3]/l.cameraToCenterDistance:b&&!f&&(E*=l.cameraToCenterDistance/q[3]),f){const $=be((A.y/Jt+R.y)/(1<<R.z));E/=l.projection.pixelsPerMeter($,1)/te(1,$)}if(sn(V,N,E))return!0}return!1}function VC(u,o,l,h){const _=ee.vec4.transformMat4([],[u,o,l,1],h);return new jt(_[0]/_[3],_[1]/_[3])}const jC=ee.vec3.fromValues(0,0,0),mb=ee.vec3.fromValues(0,0,1);function UC(u,o){const l=ee.vec3.create();return jC[2]=o,u.intersectsPlane(jC,mb,l),new jt(l[0],l[1])}class vv extends Vt{}let xv,wv,gb,Sv;function vg(u,{width:o,height:l},h,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==o*l*h)throw new RangeError("mismatched image size")}else _=new Uint8Array(o*l*h);return u.width=o,u.height=l,u.data=_,u}function xg(u,o,l){const{width:h,height:_}=o;h===u.width&&_===u.height||(_b(u,o,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,h),height:Math.min(u.height,_)},l,null),u.width=h,u.height=_,u.data=o.data)}function _b(u,o,l,h,_,f,b,S){if(0===_.width||0===_.height)return o;if(_.width>u.width||_.height>u.height||l.x>u.width-_.width||l.y>u.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>o.width||_.height>o.height||h.x>o.width-_.width||h.y>o.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const E=u.data,R=o.data,x=4===f&&S;for(let I=0;I<_.height;I++){const A=((l.y+I)*u.width+l.x)*f,D=((h.y+I)*o.width+h.x)*f;if(x)for(let M=0;M<_.width;M++){const L=A+M*f+3,N=D+M*f;R[N+0]=255,R[N+1]=255,R[N+2]=255,R[N+3]=E[L]}else if(b)for(let M=0;M<_.width;M++){const L=A+M*f,N=D+M*f,V=E[L+3],q=new mr(E[L+0]/255*V,E[L+1]/255*V,E[L+2]/255*V,V).toRenderColor(b).toArray();R[N+0]=q[0],R[N+1]=q[1],R[N+2]=q[2],R[N+3]=q[3]}else for(let M=0;M<_.width*f;M++)R[D+M]=E[A+M]}return o}xn(vv,"HeatmapBucket",{omit:["layers"]});class ou{constructor(o,l){vg(this,o,1,l)}resize(o){xg(this,new ou(o),1)}clone(){return new ou({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,h,_,f){_b(o,l,h,_,f,1,null)}}class Hs{constructor(o,l){vg(this,o,4,l)}resize(o){xg(this,new Hs(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Hs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,h,_,f,b,S){_b(o,l,h,_,f,4,b,S)}}class bb{constructor(o,l){this.width=o.width,this.height=o.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}function qu(u){const o={},l=u.resolution||256,h=u.clips?u.clips.length:1,_=u.image||new Hs({width:l,height:h}),f=(b,S,E)=>{o[u.evaluationKey]=E;const R=u.expression.evaluate(o);R&&(_.data[b+S+0]=Math.floor(255*R.r/R.a),_.data[b+S+1]=Math.floor(255*R.g/R.a),_.data[b+S+2]=Math.floor(255*R.b/R.a),_.data[b+S+3]=Math.floor(255*R.a))};if(u.clips)for(let b=0,S=0;b<h;++b,S+=4*l)for(let E=0,R=0;E<l;E++,R+=4){const x=E/(l-1),{start:I,end:A}=u.clips[b];f(S,R,I*(1-x)+A*x)}else for(let b=0,S=0;b<l;b++,S+=4)f(0,S,b/(l-1));return _}xn(ou,"AlphaImage"),xn(Hs,"RGBAImage");const HC=nr([{name:"a_pos",components:2,type:"Int16"}],4),{members:u1}=HC;function wg(u,o,l=2){const h=o&&o.length,_=h?o[0]*l:u.length;let f=d1(u,0,_,l,!0);const b=[];if(!f||f.next===f.prev)return b;let S,E,R;if(h&&(f=function(x,I,A,D){const M=[];for(let L=0,N=I.length;L<N;L++){const V=d1(x,I[L]*D,L<N-1?I[L+1]*D:x.length,D,!1);V===V.next&&(V.steiner=!0),M.push(WC(V))}M.sort(qC);for(let L=0;L<M.length;L++)A=sR(M[L],A);return A}(u,o,f,l)),u.length>80*l){S=1/0,E=1/0;let x=-1/0,I=-1/0;for(let A=l;A<_;A+=l){const D=u[A],M=u[A+1];D<S&&(S=D),M<E&&(E=M),D>x&&(x=D),M>I&&(I=M)}R=Math.max(x-S,I-E),R=0!==R?32767/R:0}return vp(f,b,l,S,E,R,0),b}function d1(u,o,l,h,_){let f;if(_===function(b,S,E,R){let x=0;for(let I=S,A=E-R;I<E;I+=R)x+=(b[A]-b[I])*(b[I+1]+b[A+1]),A=I;return x}(u,o,l,h)>0)for(let b=o;b<l;b+=h)f=p1(b/h|0,u[b],u[b+1],f);else for(let b=l-h;b>=o;b-=h)f=p1(b/h|0,u[b],u[b+1],f);return f&&Tg(f,f.next)&&(Eg(f),f=f.next),f}function Xd(u,o){if(!u)return u;o||(o=u);let l,h=u;do{if(l=!1,h.steiner||!Tg(h,h.next)&&0!==Xo(h.prev,h,h.next))h=h.next;else{if(Eg(h),h=o=h.prev,h===h.next)break;l=!0}}while(l||h!==o);return o}function vp(u,o,l,h,_,f,b){if(!u)return;!b&&f&&function(E,R,x,I){let A=E;do{0===A.z&&(A.z=Sg(A.x,A.y,R,x,I)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next}while(A!==E);A.prevZ.nextZ=null,A.prevZ=null,function(D){let M,L=1;do{let N,V=D;D=null;let q=null;for(M=0;V;){M++;let $=V,U=0;for(let Y=0;Y<L&&(U++,$=$.nextZ,$);Y++);let Z=L;for(;U>0||Z>0&&$;)0!==U&&(0===Z||!$||V.z<=$.z)?(N=V,V=V.nextZ,U--):(N=$,$=$.nextZ,Z--),q?q.nextZ=N:D=N,N.prevZ=q,q=N;V=$}q.nextZ=null,L*=2}while(M>1)}(A)}(u,h,_,f);let S=u;for(;u.prev!==u.next;){const E=u.prev,R=u.next;if(f?Tv(u,h,_,f):yb(u))o.push(E.i,u.i,R.i),Eg(u),u=R.next,S=R.next;else if((u=R)===S){b?1===b?vp(u=xp(Xd(u),o),o,l,h,_,f,2):2===b&&GC(u,o,l,h,_,f):vp(Xd(u),o,l,h,_,f,1);break}}}function yb(u){const o=u.prev,l=u,h=u.next;if(Xo(o,l,h)>=0)return!1;const _=o.x,f=l.x,b=h.x,S=o.y,E=l.y,R=h.y,x=_<f?_<b?_:b:f<b?f:b,I=S<E?S<R?S:R:E<R?E:R,A=_>f?_>b?_:b:f>b?f:b,D=S>E?S>R?S:R:E>R?E:R;let M=h.next;for(;M!==o;){if(M.x>=x&&M.x<=A&&M.y>=I&&M.y<=D&&wp(_,S,f,E,b,R,M.x,M.y)&&Xo(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function Tv(u,o,l,h){const _=u.prev,f=u,b=u.next;if(Xo(_,f,b)>=0)return!1;const S=_.x,E=f.x,R=b.x,x=_.y,I=f.y,A=b.y,D=S<E?S<R?S:R:E<R?E:R,M=x<I?x<A?x:A:I<A?I:A,L=S>E?S>R?S:R:E>R?E:R,N=x>I?x>A?x:A:I>A?I:A,V=Sg(D,M,o,l,h),q=Sg(L,N,o,l,h);let $=u.prevZ,U=u.nextZ;for(;$&&$.z>=V&&U&&U.z<=q;){if($.x>=D&&$.x<=L&&$.y>=M&&$.y<=N&&$!==_&&$!==b&&wp(S,x,E,I,R,A,$.x,$.y)&&Xo($.prev,$,$.next)>=0||($=$.prevZ,U.x>=D&&U.x<=L&&U.y>=M&&U.y<=N&&U!==_&&U!==b&&wp(S,x,E,I,R,A,U.x,U.y)&&Xo(U.prev,U,U.next)>=0))return!1;U=U.nextZ}for(;$&&$.z>=V;){if($.x>=D&&$.x<=L&&$.y>=M&&$.y<=N&&$!==_&&$!==b&&wp(S,x,E,I,R,A,$.x,$.y)&&Xo($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;U&&U.z<=q;){if(U.x>=D&&U.x<=L&&U.y>=M&&U.y<=N&&U!==_&&U!==b&&wp(S,x,E,I,R,A,U.x,U.y)&&Xo(U.prev,U,U.next)>=0)return!1;U=U.nextZ}return!0}function xp(u,o){let l=u;do{const h=l.prev,_=l.next.next;!Tg(h,_)&&Cv(h,l,l.next,_)&&Dg(h,_)&&Dg(_,h)&&(o.push(h.i,l.i,_.i),Eg(l),Eg(l.next),l=u=_),l=l.next}while(l!==u);return Xd(l)}function GC(u,o,l,h,_,f){let b=u;do{let S=b.next.next;for(;S!==b.prev;){if(b.i!==S.i&&vb(b,S)){let E=h1(b,S);return b=Xd(b,b.next),E=Xd(E,E.next),vp(b,o,l,h,_,f,0),void vp(E,o,l,h,_,f,0)}S=S.next}b=b.next}while(b!==u)}function qC(u,o){return u.x-o.x}function sR(u,o){const l=function(_,f){let b=f;const S=_.x,E=_.y;let R,x=-1/0;do{if(E<=b.y&&E>=b.next.y&&b.next.y!==b.y){const L=b.x+(E-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(L<=S&&L>x&&(x=L,R=b.x<b.next.x?b:b.next,L===S))return R}b=b.next}while(b!==f);if(!R)return null;const I=R,A=R.x,D=R.y;let M=1/0;b=R;do{if(S>=b.x&&b.x>=A&&S!==b.x&&wp(E<D?S:x,E,A,D,E<D?x:S,E,b.x,b.y)){const L=Math.abs(E-b.y)/(S-b.x);Dg(b,_)&&(L<M||L===M&&(b.x>R.x||b.x===R.x&&$C(R,b)))&&(R=b,M=L)}b=b.next}while(b!==I);return R}(u,o);if(!l)return o;const h=h1(l,u);return Xd(h,h.next),Xd(l,l.next)}function $C(u,o){return Xo(u.prev,u,o.prev)<0&&Xo(o.next,u,u.next)<0}function Sg(u,o,l,h,_){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-l)*_|0)|u<<8))|u<<4))|u<<2))|u<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-h)*_|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function WC(u){let o=u,l=u;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==u);return l}function wp(u,o,l,h,_,f,b,S){return(_-b)*(o-S)>=(u-b)*(f-S)&&(u-b)*(h-S)>=(l-b)*(o-S)&&(l-b)*(f-S)>=(_-b)*(h-S)}function vb(u,o){return u.next.i!==o.i&&u.prev.i!==o.i&&!function(l,h){let _=l;do{if(_.i!==l.i&&_.next.i!==l.i&&_.i!==h.i&&_.next.i!==h.i&&Cv(_,_.next,l,h))return!0;_=_.next}while(_!==l);return!1}(u,o)&&(Dg(u,o)&&Dg(o,u)&&function(l,h){let _=l,f=!1;const b=(l.x+h.x)/2,S=(l.y+h.y)/2;do{_.y>S!=_.next.y>S&&_.next.y!==_.y&&b<(_.next.x-_.x)*(S-_.y)/(_.next.y-_.y)+_.x&&(f=!f),_=_.next}while(_!==l);return f}(u,o)&&(Xo(u.prev,u,o.prev)||Xo(u,o.prev,o))||Tg(u,o)&&Xo(u.prev,u,u.next)>0&&Xo(o.prev,o,o.next)>0)}function Xo(u,o,l){return(o.y-u.y)*(l.x-o.x)-(o.x-u.x)*(l.y-o.y)}function Tg(u,o){return u.x===o.x&&u.y===o.y}function Cv(u,o,l,h){const _=su(Xo(u,o,l)),f=su(Xo(u,o,h)),b=su(Xo(l,h,u)),S=su(Xo(l,h,o));return _!==f&&b!==S||!(0!==_||!Cg(u,l,o))||!(0!==f||!Cg(u,h,o))||!(0!==b||!Cg(l,u,h))||!(0!==S||!Cg(l,o,h))}function Cg(u,o,l){return o.x<=Math.max(u.x,l.x)&&o.x>=Math.min(u.x,l.x)&&o.y<=Math.max(u.y,l.y)&&o.y>=Math.min(u.y,l.y)}function su(u){return u>0?1:u<0?-1:0}function Dg(u,o){return Xo(u.prev,u,u.next)<0?Xo(u,o,u.next)>=0&&Xo(u,u.prev,o)>=0:Xo(u,o,u.prev)<0||Xo(u,u.next,o)<0}function h1(u,o){const l=Dv(u.i,u.x,u.y),h=Dv(o.i,o.x,o.y),_=u.next,f=o.prev;return u.next=o,o.prev=u,l.next=_,_.prev=l,h.next=l,l.prev=h,f.next=h,h.prev=f,h}function p1(u,o,l,h){const _=Dv(u,o,l);return h?(_.next=h.next,_.prev=h,h.next.prev=_,h.next=_):(_.prev=_,_.next=_),_}function Eg(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function Dv(u,o,l){return{i:u,x:o,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Pa(u,o){const l=u.length;if(l<=1)return[u];const h=[];let _,f;for(let b=0;b<l;b++){const S=bf(u[b]);0!==S&&(u[b].area=Math.abs(S),void 0===f&&(f=S<0),f===S<0?(_&&h.push(_),_=[u[b]]):_.push(u[b]))}if(_&&h.push(_),o>1)for(let b=0;b<h.length;b++)h[b].length<=o||(To(h[b],o,1,h[b].length-1,au),h[b]=h[b].slice(0,o));return h}function au(u,o){return o.area-u.area}function Ev(u,o,l){const h=l.patternDependencies;let _=!1;for(const f of o){const b=f.paint.get(`${u}-pattern`);b.isConstant()||(_=!0);const S=b.constantOr(null);S&&(_=!0,h[S]=!0)}return _}function Iv(u,o,l,h,_){const f=_.patternDependencies;for(const b of o){const S=b.paint.get(`${u}-pattern`).value;if("constant"!==S.kind){let E=S.evaluate({zoom:h},l,{},_.availableImages);E=E&&E.name?E.name:E,f[E]=!0,l.patterns[b.id]=E}}return l}class Mv{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xc,this.indexArray=new Nr,this.indexArray2=new nu,this.programConfigurations=new mt(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new Lo,this.segments2=new Lo,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}updateFootprints(o,l){}populate(o,l,h,_){this.hasPattern=Ev("fill",this.layers,l);const f=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:S,id:E,index:R,sourceLayerIndex:x}of o){const I=this.layers[0]._featureFilter.needGeometry,A=At(S,I);if(!this.layers[0]._featureFilter.filter(new ao(this.zoom),A,h))continue;const D=f?f.evaluate(A,{},h,l.availableImages):void 0,M={id:E,properties:S.properties,type:S.type,sourceLayerIndex:x,index:R,geometry:I?A.geometry:Ke(S,h,_),patterns:{},sortKey:D};b.push(M)}f&&b.sort((S,E)=>S.sortKey-E.sortKey);for(const S of b){const{geometry:E,index:R,sourceLayerIndex:x}=S;if(this.hasPattern){const I=Iv("fill",this.layers,S,this.zoom,l);this.patternFeatures.push(I)}else this.addFeature(S,E,R,h,{},l.availableImages,l.brightness);l.featureIndex.insert(o[R].feature,E,R,x,this.index)}}update(o,l,h,_,f){const b=0!==Object.keys(o).length;b&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(o,l,b?this.stateDependentLayers:this.layers,h,_,f)}addFeatures(o,l,h,_,f,b){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,l,h,_,b)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,u1),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,h,_,f,b=[],S){for(const E of Pa(l,500)){let R=0;for(const L of E)R+=L.length;const x=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray),I=x.vertexLength,A=[],D=[];for(const L of E){if(0===L.length)continue;L!==E[0]&&D.push(A.length/2);const N=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),V=N.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(V+L.length-1,V),A.push(L[0].x),A.push(L[0].y);for(let q=1;q<L.length;q++)this.layoutVertexArray.emplaceBack(L[q].x,L[q].y),this.indexArray2.emplaceBack(V+q-1,V+q),A.push(L[q].x),A.push(L[q].y);N.vertexLength+=L.length,N.primitiveLength+=L.length}const M=wg(A,D);for(let L=0;L<M.length;L+=3)this.indexArray.emplaceBack(I+M[L],I+M[L+1],I+M[L+2]);x.vertexLength+=R,x.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,h,f,b,_,S)}}let f1,m1,g1,Av;xn(Mv,"FillBucket",{omit:["layers","patternFeatures"]});class Rv{constructor(o,l,h,_){if(this.triangleCount=l.length/3,this.min=new jt(0,0),this.max=new jt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===o.length)return;const[f,b]=[o[0].clone(),o[0].clone()];for(let I=1;I<o.length;++I){const A=o[I];f.x=Math.min(f.x,A.x),f.y=Math.min(f.y,A.y),b.x=Math.max(b.x,A.x),b.y=Math.max(b.y,A.y)}if(_){const I=Math.ceil(Math.max(b.x-f.x,b.y-f.y)/_);h=Math.max(h,I)}if(0===h)return;this.min=f,this.max=b;const S=this.max.sub(this.min);S.x=Math.max(S.x,1),S.y=Math.max(S.y,1);const E=Math.max(S.x,S.y)/h;this.cellsX=Math.max(1,Math.ceil(S.x/E)),this.cellsY=Math.max(1,Math.ceil(S.y/E)),this.xScale=1/E,this.yScale=1/E;const R=[];for(let I=0;I<this.triangleCount;I++){const A=o[l[3*I+0]].sub(this.min),D=o[l[3*I+1]].sub(this.min),M=o[l[3*I+2]].sub(this.min),L=lu(Math.floor(Math.min(A.x,D.x,M.x)),this.xScale,this.cellsX),N=lu(Math.floor(Math.max(A.x,D.x,M.x)),this.xScale,this.cellsX),V=lu(Math.floor(Math.min(A.y,D.y,M.y)),this.yScale,this.cellsY),q=lu(Math.floor(Math.max(A.y,D.y,M.y)),this.yScale,this.cellsY),$=new jt(0,0),U=new jt(0,0),Z=new jt(0,0),Y=new jt(0,0);for(let se=V;se<=q;++se){$.y=U.y=se*E,Z.y=Y.y=(se+1)*E;for(let ve=L;ve<=N;++ve)$.x=Z.x=ve*E,U.x=Y.x=(ve+1)*E,(rr(A,D,M,$,U,Y)||rr(A,D,M,$,Y,Z))&&R.push({cellIdx:se*this.cellsX+ve,triIdx:I})}}if(0===R.length)return;R.sort((I,A)=>I.cellIdx-A.cellIdx||I.triIdx-A.triIdx);let x=0;for(;x<R.length;){const I=R[x].cellIdx,A={start:this.payload.length,len:0};for(;x<R.length&&R[x].cellIdx===I;)++A.len,this.payload.push(R[x++].triIdx);this.cells[I]=A}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(o,l){if(0===this.triangleCount||0===this.cells.length||o.x>this.max.x||this.min.x>o.x||o.y>this.max.y||this.min.y>o.y)return;const h=lu(o.x-this.min.x,this.xScale,this.cellsX),_=lu(o.y-this.min.y,this.yScale,this.cellsY),f=this.cells[_*this.cellsX+h];if(f){this._lazyInitLookup();for(let b=0;b<f.len;b++){const S=this.payload[f.start+b],E=Math.floor(S/8),R=1<<S%8;if(!(this.lookup[E]&R)&&(this.lookup[E]|=R,l.push(S),l.length===this.triangleCount))return}}}query(o,l,h){if(0===this.triangleCount||0===this.cells.length||o.x>this.max.x||this.min.x>l.x||o.y>this.max.y||this.min.y>l.y)return;this._lazyInitLookup();const _=lu(o.x-this.min.x,this.xScale,this.cellsX),f=lu(l.x-this.min.x,this.xScale,this.cellsX),b=lu(o.y-this.min.y,this.yScale,this.cellsY),S=lu(l.y-this.min.y,this.yScale,this.cellsY);for(let E=b;E<=S;E++)for(let R=_;R<=f;R++){const x=this.cells[E*this.cellsX+R];if(x)for(let I=0;I<x.len;I++){const A=this.payload[x.start+I],D=Math.floor(A/8),M=1<<A%8;if(!(this.lookup[D]&M)&&(this.lookup[D]|=M,h.push(A),h.length===this.triangleCount))return}}}}function lu(u,o,l){return Math.max(0,Math.min(l-1,Math.floor(u*o)))}xn(Rv,"TriangleGridIndex");class _1{constructor(o){this.zoom=o.zoom,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.footprints=[]}updateFootprints(o,l){for(const h of this.footprints)l.push({footprint:h,id:o})}populate(o,l,h,_){const f=[];for(const{feature:b,id:S,index:E,sourceLayerIndex:R}of o){const x=this.layers[0]._featureFilter.needGeometry,I=At(b,x);if(!this.layers[0]._featureFilter.filter(new ao(this.zoom),I,h))continue;const A={id:S,properties:b.properties,type:b.type,sourceLayerIndex:R,index:E,geometry:x?I.geometry:Ke(b,h,_),patterns:{}};f.push(A)}for(const b of f){const{geometry:S,index:E,sourceLayerIndex:R}=b;this.addFeature(b,S,E,h,{},l.availableImages,l.brightness),l.featureIndex.insert(o[E].feature,S,E,R,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(o){}update(o,l,h,_,f){}destroy(){}addFeature(o,l,h,_,f,b=[],S){for(const E of Pa(l,2)){const R=[],x=[],I=[],A=new jt(1/0,1/0),D=new jt(-1/0,-1/0);for(const N of E)if(0!==N.length){N!==E[0]&&I.push(x.length/2);for(let V=0;V<N.length;V++)x.push(N[V].x),x.push(N[V].y),R.push(N[V]),A.x=Math.min(A.x,N[V].x),A.y=Math.min(A.y,N[V].y),D.x=Math.max(D.x,N[V].x),D.y=Math.max(D.y,N[V].y)}const M=wg(x,I),L=new Rv(R,M,8,256);this.footprints.push({vertices:R,indices:M,grid:L,min:A,max:D})}}}xn(_1,"ClipBucket",{omit:["layers"]});const XC=nr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),xb=nr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),$u=nr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ig=nr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),b1=nr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),y1=nr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:v1}=XC;var x1,ZC,w1,wb,Mg,YC,KC,Ag={};function S1(){if(ZC)return x1;ZC=1;var u=Dt();function o(_,f,b,S,E){this.properties={},this.extent=b,this.type=0,this._pbf=_,this._geometry=-1,this._keys=S,this._values=E,_.readFields(l,this,f)}function l(_,f,b){1==_?f.id=b.readVarint():2==_?function(S,E){for(var R=S.readVarint()+S.pos;S.pos<R;){var x=E._keys[S.readVarint()],I=E._values[S.readVarint()];E.properties[x]=I}}(b,f):3==_?f.type=b.readVarint():4==_&&(f._geometry=b.pos)}function h(_){for(var f,b,S=0,E=0,R=_.length,x=R-1;E<R;x=E++)S+=((b=_[x]).x-(f=_[E]).x)*(f.y+b.y);return S}return x1=o,o.types=["Unknown","Point","LineString","Polygon"],o.prototype.loadGeometry=function(){var _=this._pbf;_.pos=this._geometry;for(var f,b=_.readVarint()+_.pos,S=1,E=0,R=0,x=0,I=[];_.pos<b;){if(E<=0){var A=_.readVarint();S=7&A,E=A>>3}if(E--,1===S||2===S)R+=_.readSVarint(),x+=_.readSVarint(),1===S&&(f&&I.push(f),f=[]),f.push(new u(R,x));else{if(7!==S)throw new Error("unknown command "+S);f&&f.push(f[0].clone())}}return f&&I.push(f),I},o.prototype.bbox=function(){var _=this._pbf;_.pos=this._geometry;for(var f=_.readVarint()+_.pos,b=1,S=0,E=0,R=0,x=1/0,I=-1/0,A=1/0,D=-1/0;_.pos<f;){if(S<=0){var M=_.readVarint();b=7&M,S=M>>3}if(S--,1===b||2===b)(E+=_.readSVarint())<x&&(x=E),E>I&&(I=E),(R+=_.readSVarint())<A&&(A=R),R>D&&(D=R);else if(7!==b)throw new Error("unknown command "+b)}return[x,A,I,D]},o.prototype.toGeoJSON=function(_,f,b){var S,E,R=this.extent*Math.pow(2,b),x=this.extent*_,I=this.extent*f,A=this.loadGeometry(),D=o.types[this.type];function M(V){for(var q=0;q<V.length;q++){var $=V[q];V[q]=[360*($.x+x)/R-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+I)/R)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(S=0;S<A.length;S++)L[S]=A[S][0];M(A=L);break;case 2:for(S=0;S<A.length;S++)M(A[S]);break;case 3:for(A=function(V){var q=V.length;if(q<=1)return[V];for(var $,U,Z=[],Y=0;Y<q;Y++){var se=h(V[Y]);0!==se&&(void 0===U&&(U=se<0),U===se<0?($&&Z.push($),$=[V[Y]]):$.push(V[Y]))}return $&&Z.push($),Z}(A),S=0;S<A.length;S++)for(E=0;E<A[S].length;E++)M(A[S][E])}1===A.length?A=A[0]:D="Multi"+D;var N={type:"Feature",geometry:{type:D,coordinates:A},properties:this.properties};return"id"in this&&(N.id=this.id),N},x1}function T1(){if(wb)return w1;wb=1;var u=S1();function o(h,_){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(l,this,_),this.length=this._features.length}function l(h,_,f){15===h?_.version=f.readVarint():1===h?_.name=f.readString():5===h?_.extent=f.readVarint():2===h?_._features.push(f.pos):3===h?_._keys.push(f.readString()):4===h&&_._values.push(function(b){for(var S=null,E=b.readVarint()+b.pos;b.pos<E;){var R=b.readVarint()>>3;S=1===R?b.readString():2===R?b.readFloat():3===R?b.readDouble():4===R?b.readVarint64():5===R?b.readVarint():6===R?b.readSVarint():7===R?b.readBoolean():null}return S}(f))}return w1=o,o.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var _=this._pbf.readVarint()+this._pbf.pos;return new u(this._pbf,_,this.extent,this._keys,this._values)},w1}function C1(){return KC||(KC=1,Ag.VectorTile=function(){if(YC)return Mg;YC=1;var u=T1();function o(l,h,_){if(3===l){var f=new u(_,_.readVarint()+_.pos);f.length&&(h[f.name]=f)}}return Mg=function(l,h){this.layers=l.readFields(o,{},h)}}(),Ag.VectorTileFeature=S1(),Ag.VectorTileLayer=T1()),Ag}var Kf=C1();class Zd extends jt{constructor(o,l,h){super(o,l),this.z=h}}class Rg extends Zd{constructor(o,l,h,_){super(o,l,h),this.w=_}}function kg(u,o,l,h){const _=[],f=0===h?(b,S,E,R,x,I)=>{b.push(new jt(I,E+(I-S)/(R-S)*(x-E)))}:(b,S,E,R,x,I)=>{b.push(new jt(S+(I-E)/(x-E)*(R-S),I))};for(const b of u){const S=[];for(const E of b){if(E.length<=2)continue;const R=[];for(let A=0;A<E.length-1;A++){const D=E[A].x,M=E[A].y,L=E[A+1].x,N=E[A+1].y,V=0===h?D:M,q=0===h?L:N;V<o?q>o&&f(R,D,M,L,N,o):V>l?q<l&&f(R,D,M,L,N,l):R.push(E[A]),q<o&&V>=o&&f(R,D,M,L,N,o),q>l&&V<=l&&f(R,D,M,L,N,l)}let x=E[E.length-1];const I=0===h?x.x:x.y;I>=o&&I<=l&&R.push(x),R.length&&(x=R[R.length-1],R[0].x===x.x&&R[0].y===x.y||R.push(R[0]),S.push(R))}S.length&&_.push(S)}return _}function Sb(u,o,l,h){const _="x"===l?"y":"x",f=(h-u[l])/(o[l]-u[l]);u[_]=u[_]+(o[_]-u[_])*f,u[l]=h,u.hasOwnProperty("z")&&(u.z=Wn(u.z,o.z,f)),u.hasOwnProperty("w")&&(u.w=Wn(u.w,o.w,f))}function D1(u,o,l,h){const _=l,f=h;for(const b of["x","y"]){let S=u,E=o;S[b]>=E[b]&&(S=o,E=u),S[b]<_&&E[b]>_&&Sb(S,E,b,_),S[b]<f&&E[b]>f&&Sb(E,S,b,f)}}const no=Number.MAX_SAFE_INTEGER;function E1(u,o,l,h){return u.order<o||u.order===no||!(u.clipMask&l)||(_=h,0!==(f=u.clipScope).length&&void 0===f.find(b=>b===_));var _,f}function Tb(u,o){return u.x-o.x||u.y-o.y}function hs(u,o){return 0===Tb(u.min,o.min)&&0===Tb(u.max,o.max)}function Cb(u,o){return!(u.min.x>o.max.x||u.max.x<o.min.x||u.min.y>o.max.y||u.max.y<o.min.y)}function kv(u,o){if(u.length!==o.length)return!1;for(let l=0;l<u.length;l++)if(u[l].sourceId!==o[l].sourceId||!hs(u[l],o[l])||u[l].order!==o[l].order||u[l].clipMask!==o[l].clipMask||!to(u[l].clipScope,o[l].clipScope))return!1;return!0}function I1(u,o,l){const h=1/Jt,_=1/(1<<l.canonical.z),f=(o.x*h+l.canonical.x)*_+l.wrap,b=(o.y*h+l.canonical.y)*_;return{min:new jt((u.x*h+l.canonical.x)*_+l.wrap,(u.y*h+l.canonical.y)*_),max:new jt(f,b)}}function JC(u,o,l){const h=1<<l.canonical.z,_=((o.x-l.wrap)*h-l.canonical.x)*Jt,f=(o.y*h-l.canonical.y)*Jt;return{min:new jt(((u.x-l.wrap)*h-l.canonical.x)*Jt,(u.y*h-l.canonical.y)*Jt),max:new jt(_,f)}}function M1(u,o,l,h,_,f,b){const S=u.indices,E=u.vertices,R=[];for(let x=h;x<h+_;x+=3){const I=o[l[x+0]+f],A=o[l[x+1]+f],D=o[l[x+2]+f],M=Math.min(I.x,A.x,D.x),L=Math.max(I.x,A.x,D.x),N=Math.min(I.y,A.y,D.y),V=Math.max(I.y,A.y,D.y);R.length=0,u.grid.query(new jt(M,N),new jt(L,V),R);for(let q=0;q<R.length;q++){const $=R[q];if(rr(E[S[3*$+0]],E[S[3*$+1]],E[S[3*$+2]],I,A,D,b))return!0}}return!1}function A1(u,o,l,h){if(!u||!l)return!1;let _=u.vertices;if(!o.canonical.equals(h.canonical)||o.wrap!==h.wrap){if(l.vertices.length<u.vertices.length)return A1(l,h,u,o);const f=o.canonical,b=h.canonical,S=Math.pow(2,b.z-f.z);_=u.vertices.map(E=>new jt((E.x+f.x*Jt)*S-b.x*Jt,(E.y+f.y*Jt)*S-b.y*Jt))}return M1(l,_,u.indices,0,u.indices.length,0,0)}function QC(u,o,l,h){const _=Math.pow(2,h.z-l.z);return new jt((u+l.x*Jt)*_-h.x*Jt,(o+l.y*Jt)*_-h.y*Jt)}function eD(u,o){const l=[];o.grid.queryPoint(u,l);const h=o.indices,_=o.vertices;for(let f=0;f<l.length;f++){const b=l[f];if(Bi([_[h[3*b+0]],_[h[3*b+1]],_[h[3*b+2]]],u))return!0}return!1}const Sp=[new jt(0,0),new jt(Jt,0),new jt(Jt,Jt),new jt(0,Jt)];function Db(u,o){const l=[];let h=[];if(!o||u.length<2)return[u];if(2===u.length)return Gi(u[0],u[1],Sp)?[u]:[];for(let _=0;_<u.length+2;_++){const f=u[_%u.length],b=u[(_+1)%u.length],S=Gi(0===_?u[u.length-1]:u[(_-1)%u.length],f,Sp),E=Gi(f,b,Sp),R=S||E;R&&h.push(f),R&&E||h.length>0&&(h.length>1&&l.push(h),h=[])}return h.length>1&&l.push(h),l}const Eb=Kf.VectorTileFeature.types,R1=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],k1=["fill-extrusion-flood-light-ground-radius"],tD=Math.pow(2,13),P1=Math.pow(2,15)-1,Pv=new jt(0,1),cu=2147483648;function Ib(u,o,l,h,_,f,b,S){u.emplaceBack((o<<1)+b,(l<<1)+f,(Math.floor(h*tD)<<1)+_,Math.round(S))}function Pg(u,o,l){u.emplaceBack(o.x*Jt,o.y*Jt,l?1:0)}function Jf(u,o,l,h,_,f){u.emplaceBack(o.x,o.y,(l.x<<1)+h,(l.y<<1)+_,f)}function Qf(u,o,l){u.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class Lv{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Yd{constructor(){this.centroidXY=new jt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new jt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new jt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new jt(this.max.x-this.min.x,this.max.y-this.min.y)}}class L1{constructor(){this.acc=new jt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(o,l){o.min.x===Number.MAX_VALUE&&(o.min.x=o.max.x=l.x,o.min.y=o.max.y=l.y)}appendEdge(o,l,h){this.accCount++,this.acc._add(l);let _=!!this.borders;l.x<o.min.x?(o.min.x=l.x,_=!0):l.x>o.max.x&&(o.max.x=l.x,_=!0),l.y<o.min.y?(o.min.y=l.y,_=!0):l.y>o.max.y&&(o.max.y=l.y,_=!0),((0===l.x||l.x===Jt)&&l.x===h.x)!=((0===l.y||l.y===Jt)&&l.y===h.y)&&this.processBorderOverlap(l,h),_&&this.checkBorderIntersection(l,h)}checkBorderIntersection(o,l){l.x<0!=o.x<0&&this.addBorderIntersection(0,Wn(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>Jt!=o.x>Jt&&this.addBorderIntersection(1,Wn(l.y,o.y,(Jt-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,Wn(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>Jt!=o.y>Jt&&this.addBorderIntersection(3,Wn(l.x,o.x,(Jt-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[o];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const h=0===o.x?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,o.y)}else{const h=0===o.y?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,o.x)}}centroid(){return 0===this.accCount?new jt(0,0):new jt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0):0}}function Mb(u,o){const l=u.add(o)._unit(),h=Pt(u.x*l.x+u.y*l.y,-1,1);var _,f,b;return b=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(b)))/4*P1*((_=u).x*(f=o).y-_.y*f.x<0?-1:1)}const Ab=[u=>u.x<0,u=>u.x>Jt,u=>u.y<0,u=>u.y>Jt];function nD(u,o,l,h){const _=[4];if(0===h)return _;l._mult(h);const f=u.sub(l),b=o.sub(l),S=[u,o,f,b];for(let E=0;E<4;E++)for(const R of S)if(Ab[E](R)){_.push(E);break}return _}class Rb{constructor(o){this.vertexArray=new lg,this.indexArray=new Nr,this.programConfigurations=new mt(o.layers,{zoom:o.zoom,lut:o.lut},l=>k1.includes(l)),this._segments=new Lo,this.hiddenByLandmarkVertexArray=new iu,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Lo}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(o,l,h,_=!1){const f=o.length;if(f>2){let b=Math.max(0,this._segments.get().length-1);const S=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[b].length);let E;b!==this._segments.get().length-1&&(b++,this._segmentToGroundQuads[b]=[],this._segmentToRegionTriCounts[b]=[0,0,0,0,0]);{const R=o[0],x=o[1];E=Mb(R.sub(o[f-1])._perp()._unit(),x.sub(R)._perp()._unit())}for(let R=0;R<f;R++){const x=R===f-1?0:R+1,I=o[R],A=o[x],D=o[x===f-1?0:x+1],M=A.sub(I)._perp()._unit(),L=Mb(M,D.sub(A)._perp()._unit()),N=E,V=L;if(Ov(I,A,l)||_&&F1(I,l)&&F1(A,l)){E=L;continue}const q=S.vertexLength;Jf(this.vertexArray,I,A,1,1,N),Jf(this.vertexArray,I,A,1,0,N),Jf(this.vertexArray,I,A,0,1,V),Jf(this.vertexArray,I,A,0,0,V),S.vertexLength+=4;const $=nD(I,A,M,h);for(const U of $)this._segmentToGroundQuads[b].push({id:q,region:U}),this._segmentToRegionTriCounts[b][U]+=2,S.primitiveLength+=2;E=L}}}prepareBorderSegments(){if(!this.hasData())return;const o=this._segments.get(),l=o.length;for(let h=0;h<l;h++)this._segmentToGroundQuads[h].sort((_,f)=>_.region-f.region);for(let h=0;h<l;h++){const _=this._segmentToGroundQuads[h],f=o[h],b=this._segmentToRegionTriCounts[h];b.reduce((E,R)=>E+R,0);let S=0;for(let E=0;E<=4;E++){const R=b[E];if(0!==R){let x=this.regionSegments[E];x||(x=this.regionSegments[E]=new Lo);const I={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+S,vertexLength:f.vertexLength,primitiveLength:R};x.get().push(I)}S+=R}for(let E=0;E<_.length;E++){const R=_[E].id;this.indexArray.emplaceBack(R,R+1,R+3),this.indexArray.emplaceBack(R,R+3,R+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(o,l,h,_,f,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,o,l,h,_,f,b)}upload(o){this.hasData()&&(this.vertexBuffer=o.createVertexBuffer(this.vertexArray,xb.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}uploadPaintProperties(o){this.hasData()&&this.programConfigurations.upload(o)}update(o,l,h,_,f,b){this.hasData()&&this.programConfigurations.updatePaintArrays(o,l,h,_,f,b)}updateHiddenByLandmark(o){if(!this.hasData())return;const l=o.groundVertexCount+o.groundVertexArrayOffset;if(0===o.groundVertexCount)return;const h=o.flags&cu?1:0;for(let _=o.groundVertexArrayOffset;_<l;++_)this.hiddenByLandmarkVertexArray.emplace(_,h);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(o){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=o.createVertexBuffer(this.hiddenByLandmarkVertexArray,b1.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let o=0;o<=4;o++){const l=this.regionSegments[o];l&&l.destroy()}}}}class Tp{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Nr,this.footprintVertices=new xc,this.footprintSegments=[],this.layoutVertexArray=new Nu,this.centroidVertexArray=new up,this.wallVertexArray=new Wf,this.indexArray=new Nr,this.programConfigurations=new mt(o.layers,{zoom:o.zoom,lut:o.lut},l=>R1.includes(l)),this.segments=new Lo,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new Rb(o),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(o,l){}populate(o,l,h,_){this.features=[],this.hasPattern=Ev("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Le(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:f,id:b,index:S,sourceLayerIndex:E}of o){const R=this.layers[0]._featureFilter.needGeometry,x=At(f,R);if(!this.layers[0]._featureFilter.filter(new ao(this.zoom),x,h))continue;const I={id:b,sourceLayerIndex:E,index:S,geometry:R?x.geometry:Ke(f,h,_),properties:f.properties,type:f.type,patterns:{}},A=this.layoutVertexArray.length,D="Polygon"===Eb[I.type];if(this.hasPattern)this.features.push(Iv("fill-extrusion",this.layers,I,this.zoom,l));else if(this.wallMode)for(const M of I.geometry)for(const L of Db(M,D))this.addFeature(I,[L],S,h,{},l.availableImages,_,l.brightness);else this.addFeature(I,I.geometry,S,h,{},l.availableImages,_,l.brightness);l.featureIndex.insert(f,I.geometry,S,E,this.index,A)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(o,l,h,_,f,b){for(const S of this.features){const E="Polygon"===Eb[S.type],{geometry:R}=S;if(this.wallMode)for(const x of R)for(const I of Db(x,E))this.addFeature(S,[I],S.index,l,h,_,f,b);else this.addFeature(S,R,S.index,l,h,_,f,b)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(o,l,h,_,f){const b=0!==Object.keys(o).length;if(b&&!this.stateDependentLayers.length)return;const S=b?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(o,l,S,h,_,f),this.groundEffect.update(o,l,S,h,_,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,v1),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.wallVertexBuffer=o.createVertexBuffer(this.wallVertexArray,Ig.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,y1.members,!0)),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.groundEffect.uploadHiddenByLandmark(o),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,$u.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,h,_,f,b,S,E){const R=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,x=[new jt(0,0),new jt(Jt,Jt)],I=S.projection,A="globe"===I.name,D=this.wallMode||"Polygon"===Eb[o.type],M=new L1;M.centroidDataIndex=this.centroidData.length;const L=new Yd,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},_)<=0,V=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},_);let q;if(L.height=V,L.vertexArrayOffset=this.layoutVertexArray.length,L.groundVertexArrayOffset=this.groundEffect.vertexArray.length,A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ql),this.wallMode){if(A)return void ji("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==l.length)return;q=function(ce){const Se=ce[0].x===ce[ce.length-1].x&&ce[0].y===ce[ce.length-1].y;(function(Kt){let Ht=0;const Vn=Kt.length;for(let pn=0;pn<Vn;pn++)Ht+=(Kt[(pn+1)%Vn].x-Kt[pn].x)*(Kt[(pn+1)%Vn].y+Kt[pn].y);return Ht>=0})(ce)||(ce=ce.reverse());const Me={geometry:[],joinNormals:[],indices:[]},Ne=[],ze=[],$e=[];let nt=ce.length;if(nt<(Se?3:2))return Me;for(;nt>=2&&ce[nt-1].equals(ce[nt-2]);)nt--;let st,Je,St,$t,gt,gn=0;for(;gn<nt-1&&ce[gn].equals(ce[gn+1]);)gn++;Se&&(st=ce[nt-2],gt=ce[gn].sub(st)._unit()._perp());for(let Kt=gn;Kt<nt;Kt++){if(St=Kt===nt-1?Se?ce[gn+1]:void 0:ce[Kt+1],St&&ce[Kt].equals(St))continue;gt&&($t=gt),st&&(Je=st),st=ce[Kt],gt=St?St.sub(st)._unit()._perp():$t,$t=$t||gt;let Ht=$t.add(gt);0===Ht.x&&0===Ht.y||Ht._unit();const Vn=Ht.x*gt.x+Ht.y*gt.y,pn=0!==Vn?1/Vn:1/0,Sn=$t.x*gt.y-$t.y*gt.x>0;let ii="miter";const yi=2;"miter"===ii&&pn>yi&&(ii="bevel"),"bevel"===ii&&(pn>100&&(ii="flipbevel"),pn<yi&&(ii="miter"));const xi=(fi,Ri,Ii,Br)=>{const Cr=new jt(fi.x,fi.y),Xn=new jt(fi.x,fi.y);Cr.x+=Ri.x*Br,Cr.y+=Ri.y*Br,Xn.x-=Ri.x*Math.max(Ii,1),Xn.y-=Ri.y*Math.max(Ii,1),$e.push(Ri),Ne.push(Cr),ze.push(Xn)};if("miter"===ii)Ht._mult(pn),xi(st,Ht,0,0);else if("flipbevel"===ii)Ht=gt.mult(-1),xi(st,Ht,0,0),xi(st,Ht.mult(-1),0,0);else{const fi=-Math.sqrt(pn*pn-1),Ri=Sn?fi:0,Ii=Sn?0:fi;Je&&xi(st,$t,Ri,Ii),St&&xi(st,gt,Ri,Ii)}}Me.geometry=[...Ne,...ze.reverse(),Ne[0]],Me.joinNormals=[...$e,...$e.reverse(),$e[$e.length-1]];const on=Me.geometry.length-1;for(let Kt=0;Kt<on/2;Kt++)if(Kt+1<on/2){let Ht=Kt,Vn=Kt+1,pn=on-1-Kt,Sn=on-2-Kt;Ht=0===Ht?on-1:Ht-1,Vn=0===Vn?on-1:Vn-1,pn=0===pn?on-1:pn-1,Sn=0===Sn?on-1:Sn-1,Me.indices.push(pn),Me.indices.push(Vn),Me.indices.push(Ht),Me.indices.push(pn),Me.indices.push(Sn),Me.indices.push(Vn)}return Me}(l[0]),l=[q.geometry]}const $=(ce,Se)=>ce<(Se.length-1)/2||ce===Se.length-1,U=this.wallMode?[l]:Pa(l,500);for(let ce=U.length-1;ce>=0;ce--){const Se=U[ce];(0===Se.length||(Z=Se[0]).every(me=>me.x<=0)||Z.every(me=>me.x>=Jt)||Z.every(me=>me.y<=0)||Z.every(me=>me.y>=Jt))&&U.splice(ce,1)}var Z;let Y;if(A)Y=B1(U,x,_);else{Y=[];for(const ce of U)Y.push({polygon:ce,bounds:x})}const se=D?this.edgeRadius:0,ve=se>0&&this.zoom<17,W=(ce,Se)=>{if(0===ce.length)return!1;const me=ce[ce.length-1];return Se.x===me.x&&Se.y===me.y};for(const{polygon:ce,bounds:Se}of Y){let me=0,Me=0;for(const nt of ce)D&&!nt[0].equals(nt[nt.length-1])&&nt.push(nt[0]),Me+=D?nt.length-1:nt.length;const Ne=this.segments.prepareSegment((D?5:4)*Me,this.layoutVertexArray,this.indexArray);L.footprintSegIdx<0&&(L.footprintSegIdx=this.footprintSegments.length),L.polygonSegIdx<0&&(L.polygonSegIdx=this.polygonSegments.length);const ze={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},$e=new Lv;if($e.vertexOffset=this.footprintVertices.length,$e.indexOffset=3*this.footprintIndices.length,$e.ringIndices=[],D){const nt=[],st=[];me=Ne.vertexLength;for(let St=0;St<ce.length;St++){const $t=ce[St];$t.length&&0!==St&&st.push(nt.length/2);const gt=[];let gn,on;gn=$t[1].sub($t[0])._perp()._unit(),$e.ringIndices.push($t.length-1);for(let Kt=1;Kt<$t.length;Kt++){const Ht=$t[Kt],Vn=$t[Kt===$t.length-1?1:Kt+1],pn=Ht.clone();if(se){on=Vn.sub(Ht)._perp()._unit();const Sn=gn.add(on)._unit(),ii=se*Math.min(4,1/(gn.x*Sn.x+gn.y*Sn.y));pn.x+=ii*Sn.x,pn.y+=ii*Sn.y,pn.x=Math.round(pn.x),pn.y=Math.round(pn.y),gn=on}if(!N||0!==se&&!ve||W(gt,pn)||gt.push(pn),Ib(this.layoutVertexArray,pn.x,pn.y,0,0,1,1,0),this.wallMode){const Sn=$(Kt,$t);Pg(this.wallVertexArray,q.joinNormals[Kt],!Sn)}Ne.vertexLength++,this.footprintVertices.emplaceBack(Ht.x,Ht.y),nt.push(Ht.x,Ht.y),A&&Qf(this.layoutVertexExtArray,I.projectTilePoint(pn.x,pn.y,_),I.upVector(_,pn.x,pn.y))}N&&(0===se||ve)&&(0!==gt.length&&W(gt,gt[0])&&gt.pop(),this.groundEffect.addData(gt,Se,R))}const Je=this.wallMode?q.indices:wg(nt,st);for(let St=0;St<Je.length;St+=3)this.footprintIndices.emplaceBack($e.vertexOffset+Je[St+0],$e.vertexOffset+Je[St+1],$e.vertexOffset+Je[St+2]),this.indexArray.emplaceBack(me+Je[St],me+Je[St+2],me+Je[St+1]),Ne.primitiveLength++;$e.indexCount+=Je.length,$e.vertexCount+=this.footprintVertices.length-$e.vertexOffset}for(let nt=0;nt<ce.length;nt++){const st=ce[nt];M.startRing(L,st[0]);let Je=st.length>4&&Fv(st[st.length-2],st[0],st[1]),St=se?O1(st[st.length-2],st[0],st[1],se):0;const $t=[];let gt,gn,on;gn=st[1].sub(st[0])._perp()._unit();let Kt=!0;for(let Ht=1,Vn=0;Ht<st.length;Ht++){let pn=st[Ht-1],Sn=st[Ht];const ii=st[Ht===st.length-1?1:Ht+1];if(M.appendEdge(L,Sn,pn),Ov(Sn,pn,Se)){se&&(gn=ii.sub(Sn)._perp()._unit(),Kt=!Kt);continue}const yi=Sn.sub(pn)._perp(),xi=yi.x/(Math.abs(yi.x)+Math.abs(yi.y)),fi=yi.y>0?1:0,Ri=pn.dist(Sn);if(Vn+Ri>32768&&(Vn=0),se){on=ii.sub(Sn)._perp()._unit();let Xn=kb(pn,Sn,ii,Wu(gn,on),se);isNaN(Xn)&&(Xn=0);const ar=Sn.sub(pn)._unit();pn=pn.add(ar.mult(St))._round(),Sn=Sn.add(ar.mult(-Xn))._round(),St=Xn,gn=on,N&&this.zoom>=17&&(W($t,pn)||$t.push(pn),W($t,Sn)||$t.push(Sn))}const Ii=Ne.vertexLength,Br=st.length>4&&Fv(pn,Sn,ii);let Cr=Cp(Vn,Je,Kt);if(Ib(this.layoutVertexArray,pn.x,pn.y,xi,fi,0,0,Cr),Ib(this.layoutVertexArray,pn.x,pn.y,xi,fi,0,1,Cr),this.wallMode){const Xn=$(Ht-1,st),ar=q.joinNormals[Ht-1];Pg(this.wallVertexArray,ar,Xn),Pg(this.wallVertexArray,ar,Xn)}if(Vn+=Ri,Cr=Cp(Vn,Br,!Kt),Je=Br,Ib(this.layoutVertexArray,Sn.x,Sn.y,xi,fi,0,0,Cr),Ib(this.layoutVertexArray,Sn.x,Sn.y,xi,fi,0,1,Cr),this.wallMode){const Xn=$(Ht,st),ar=q.joinNormals[Ht];Pg(this.wallVertexArray,ar,Xn),Pg(this.wallVertexArray,ar,Xn)}if(Ne.vertexLength+=4,this.indexArray.emplaceBack(Ii+0,Ii+1,Ii+2),this.indexArray.emplaceBack(Ii+1,Ii+3,Ii+2),Ne.primitiveLength+=2,se){const Xn=me+(1===Ht?st.length-2:Ht-2),ar=1===Ht?me:Xn+1;if(this.indexArray.emplaceBack(Ii+1,Xn,Ii+3),this.indexArray.emplaceBack(Xn,ar,Ii+3),Ne.primitiveLength+=2,void 0===gt&&(gt=Ii),!Ov(ii,st[Ht],Se)){const hr=Ht===st.length-1?gt:Ne.vertexLength;this.indexArray.emplaceBack(Ii+2,Ii+3,hr),this.indexArray.emplaceBack(Ii+3,hr+1,hr),this.indexArray.emplaceBack(Ii+3,ar,hr+1),Ne.primitiveLength+=3}Kt=!Kt}if(A){const Xn=this.layoutVertexExtArray,ar=I.projectTilePoint(pn.x,pn.y,_),hr=I.projectTilePoint(Sn.x,Sn.y,_),Kr=I.upVector(_,pn.x,pn.y),Mo=I.upVector(_,Sn.x,Sn.y);Qf(Xn,ar,Kr),Qf(Xn,ar,Kr),Qf(Xn,hr,Mo),Qf(Xn,hr,Mo)}}D&&(me+=st.length-1),N&&se&&this.zoom>=17&&(0!==$t.length&&W($t,$t[0])&&$t.pop(),this.groundEffect.addData($t,Se,R,se>0))}this.footprintSegments.push($e),ze.triangleCount=this.indexArray.length-ze.triangleArrayOffset,this.polygonSegments.push(ze),++L.footprintSegLen,++L.polygonSegLen}if(L.vertexCount=this.layoutVertexArray.length-L.vertexArrayOffset,L.groundVertexCount=this.groundEffect.vertexArray.length-L.groundVertexArrayOffset,0!==L.vertexCount){if(L.centroidXY=M.borders?Pv:this.encodeCentroid(M,L),this.centroidData.push(L),M.borders){this.featuresOnBorder.push(M);const ce=this.featuresOnBorder.length-1;for(let Se=0;Se<M.borders.length;Se++)M.borders[Se][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Se].push(ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,h,f,b,_,E),this.groundEffect.addPaintPropertiesData(o,h,f,b,_,E),this.maxHeight=Math.max(this.maxHeight,V)}}sortBorders(){for(let o=0;o<this.borderFeatureIndices.length;o++)this.borderFeatureIndices[o].sort((l,h)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[h].borders[o][0])}splitToSubtiles(){const o=[];for(let S=0;S<this.centroidData.length;S++){const E=this.centroidData[S],R=+(E.min.y+E.max.y>Jt),x=2*R+(+(E.min.x+E.max.x>Jt)^R);for(let I=0;I<E.polygonSegLen;I++){const A=E.polygonSegIdx+I;o.push({centroidIdx:S,subtile:x,polygonSegmentIdx:A,triangleSegmentIdx:this.polygonSegments[A].triangleSegIdx})}}const l=new Nr;o.sort((S,E)=>S.triangleSegmentIdx===E.triangleSegmentIdx?S.subtile-E.subtile:S.triangleSegmentIdx-E.triangleSegmentIdx);let h=0,_=0,f=0;for(const S of o){if(S.triangleSegmentIdx!==h)break;f++}const b=o.length;for(;_!==o.length;){h=o[_].triangleSegmentIdx;let S=0,E=_,R=_;for(let x=E;x<f&&o[x].subtile===S;x++)R++;for(;E!==f;){const x=o[E];S=x.subtile;const I=this.centroidData[x.centroidIdx].min.clone(),A=this.centroidData[x.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let M=E;M<R;M++){const L=o[M],N=this.polygonSegments[L.polygonSegmentIdx],V=this.centroidData[L.centroidIdx].min,q=this.centroidData[L.centroidIdx].max,$=this.indexArray.uint16;for(let U=N.triangleArrayOffset;U<N.triangleArrayOffset+N.triangleCount;U++)l.emplaceBack($[3*U],$[3*U+1],$[3*U+2]);D.primitiveLength+=N.triangleCount,I.x=Math.min(I.x,V.x),I.y=Math.min(I.y,V.y),A.x=Math.max(A.x,q.x),A.y=Math.max(A.y,q.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:I,max:A}),E=R;for(let M=E;M<f&&o[M].subtile===o[E].subtile;M++)R++}_=f;for(let x=_;x<b&&o[x].triangleSegmentIdx===o[_].triangleSegmentIdx;x++)f++}l._trim(),this.indexArray=l}getVisibleSegments(o,l,h){const _=new Lo;if(this.wallMode){for(const L of this.triangleSubSegments)_.segments.push(L.segment);return _}let f=0,b=0;const S=1<<o.canonical.z;if(l){const L=l.getMinMaxForTile(o);L&&(f=L.min,b=L.max)}b+=this.maxHeight;const E=o.toUnwrapped();let R;const x=[E.canonical.x/S+E.wrap,E.canonical.y/S],I=[(E.canonical.x+1)/S+E.wrap,(E.canonical.y+1)/S],A=(L,N,V)=>[L[0]*(1-V[0])+N[0]*V[0],L[1]*(1-V[1])+N[1]*V[1]],D=[],M=[];for(const L of this.triangleSubSegments){D[0]=L.min.x/Jt,D[1]=L.min.y/Jt,M[0]=L.max.x/Jt,M[1]=L.max.y/Jt;const N=A(x,I,D),V=A(x,I,M);if(0===new er([N[0],N[1],f],[V[0],V[1],b]).intersectsPrecise(h)){R&&(_.segments.push(R),R=void 0);continue}const q=L.segment;R&&R.vertexOffset!==q.vertexOffset&&(_.segments.push(R),R=void 0),R?(R.vertexLength+=q.vertexLength,R.primitiveLength+=q.primitiveLength):R={vertexOffset:q.vertexOffset,primitiveLength:q.primitiveLength,vertexLength:q.vertexLength,primitiveOffset:q.primitiveOffset,sortKey:void 0,vaos:{}}}return R&&_.segments.push(R),_}encodeCentroid(o,l){const h=o.centroid(),_=l.span(),f=Math.min(7,Math.round(_.x*this.tileToMeter/10)),b=Math.min(7,Math.round(_.y*this.tileToMeter/10));return new jt(Pt(h.x,1,8191)<<3|f,Pt(h.y,1,8191)<<3|b)}encodeBorderCentroid(o){if(!o.borders)return new jt(0,0);const l=o.borders,h=Number.MAX_VALUE;if(l[0][0]!==h||l[1][0]!==h){const _=l[0][0]!==h?0:1;return new jt(6|(l[0][0]!==h?0:65528),(l[_][0]+l[_][1])/2<<3|6)}{const _=l[2][0]!==h?2:3;return new jt((l[_][0]+l[_][1])/2<<3|6,6|(l[2][0]!==h?0:65528))}}showCentroid(o){const l=this.centroidData[o.centroidDataIndex];l.flags&=cu,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(o){this.groundEffect.updateHiddenByLandmark(o);const l=o.vertexArrayOffset,h=o.vertexCount+o.vertexArrayOffset,_=o.flags&cu?Pv:o.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==_.y||f!==_.x){for(let b=l;b<h;++b)this.centroidVertexArray.emplace(b,_.x,_.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.centroidData)this.writeCentroidToBuffer(o)}updateReplacement(o,l,h){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const _=l.getReplacementRegionsForTile(o.toUnwrapped());if(kv(this.activeReplacements,_))return;if(this.activeReplacements=_,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const b of this.centroidData)b.flags&=2147483647;const f=[];for(const b of this.activeReplacements){if(b.order<h)continue;const S=Math.max(1,Math.pow(2,b.footprintTileId.canonical.z-o.canonical.z));for(const E of this.centroidData)if(!(E.flags&cu||b.min.x>E.max.x||E.min.x>b.max.x||b.min.y>E.max.y||E.min.y>b.max.y))for(let R=0;R<E.footprintSegLen;R++){const x=this.footprintSegments[E.footprintSegIdx+R];if(f.length=0,iD(this.footprintVertices,x.vertexOffset,x.vertexCount,b.footprintTileId.canonical,o.canonical,f),M1(b.footprint,f,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-S)){E.flags|=cu;break}}}for(const b of this.centroidData)this.writeCentroidToBuffer(b);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(o,l,h){let _=!1;for(let f=0;f<h.footprintSegLen;f++){const b=this.footprintSegments[h.footprintSegIdx+f];let S=0;for(const E of b.ringIndices){for(let R=S,x=E+S-1;R<E+S;x=R++){const I=this.footprintVertices.int16[2*(R+b.vertexOffset)+0],A=this.footprintVertices.int16[2*(R+b.vertexOffset)+1],D=this.footprintVertices.int16[2*(x+b.vertexOffset)+1];A>l!=D>l&&o<(this.footprintVertices.int16[2*(x+b.vertexOffset)+0]-I)*(l-A)/(D-A)+I&&(_=!_)}S=E}}return _}getHeightAtTileCoord(o,l){let h=Number.NEGATIVE_INFINITY,_=!0;const f=4*(o+Jt)*Jt+(l+Jt);if(this.partLookup.hasOwnProperty(f)){const b=this.partLookup[f];return b?{height:b.height,hidden:!!(b.flags&cu)}:void 0}for(const b of this.centroidData)o>b.max.x||b.min.x>o||l>b.max.y||b.min.y>l||this.footprintContainsPoint(o,l,b)&&b&&b.height>h&&(h=b.height,this.partLookup[f]=b,_=!!(b.flags&cu));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:_};this.partLookup[f]=void 0}}function Wu(u,o){const l=u.add(o)._unit();return u.x*l.x+u.y*l.y}function O1(u,o,l,h){const _=o.sub(u)._perp()._unit(),f=l.sub(o)._perp()._unit();return kb(u,o,l,Wu(_,f),h)}function kb(u,o,l,h,_){const f=Math.sqrt(1-h*h);return Math.min(u.dist(o)/3,o.dist(l)/3,_*f/h)}function Ov(u,o,l){return u.x<l[0].x&&o.x<l[0].x||u.x>l[1].x&&o.x>l[1].x||u.y<l[0].y&&o.y<l[0].y||u.y>l[1].y&&o.y>l[1].y}function F1(u,o){return u.x<o[0].x||u.x>o[1].x||u.y<o[0].y||u.y>o[1].y}function Fv(u,o,l){if(u.x<0||u.x>=Jt||o.x<0||o.x>=Jt||l.x<0||l.x>=Jt)return!1;const h=l.sub(o),_=h.perp(),f=u.sub(o);return(h.x*f.x+h.y*f.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(f.x*f.x+f.y*f.y))>-.866&&_.x*f.x+_.y*f.y<0}function Cp(u,o,l){const h=o?2|u:-3&u;return l?1|h:-2&h}function N1(){const u=Math.PI/32,o=Math.tan(u),l=O;return l*Math.sqrt(1+2*o*o)-l}function B1(u,o,l){const h=1<<l.z,_=pe(l.x/h),f=pe((l.x+1)/h),b=be(l.y/h),S=be((l.y+1)/h);return function(E,R,x,I,A=0,D){const M=[];if(!E.length||!x||!I)return M;const L=(Y,se)=>{for(const ve of Y)M.push({polygon:ve,bounds:se})},N=Math.ceil(Math.log2(x)),V=Math.ceil(Math.log2(I)),q=N-V,$=[];for(let Y=0;Y<Math.abs(q);Y++)$.push(q>0?0:1);for(let Y=0;Y<Math.min(N,V);Y++)$.push(0),$.push(1);let U=E;if(U=kg(U,R[0].y-A,R[1].y+A,1),U=kg(U,R[0].x-A,R[1].x+A,0),!U.length)return M;const Z=[];for($.length?Z.push({polygons:U,bounds:R,depth:0}):L(U,R);Z.length;){const Y=Z.pop(),se=Y.depth,ve=$[se],W=Y.bounds[0],ce=Y.bounds[1],Se=0===ve?W.x:W.y,me=0===ve?ce.x:ce.y,Me=D?D(ve,Se,me):.5*(Se+me),Ne=kg(Y.polygons,Se-A,Me+A,ve),ze=kg(Y.polygons,Me-A,me+A,ve);if(Ne.length){const $e=[W,new jt(0===ve?Me:ce.x,1===ve?Me:ce.y)];$.length>se+1?Z.push({polygons:Ne,bounds:$e,depth:se+1}):L(Ne,$e)}if(ze.length){const $e=[new jt(0===ve?Me:W.x,1===ve?Me:W.y),ce];$.length>se+1?Z.push({polygons:ze,bounds:$e,depth:se+1}):L(ze,$e)}}return M}(u,o,Math.ceil((f-_)/11.25),Math.ceil((b-S)/11.25),1,(E,R,x)=>{if(0===E)return.5*(R+x);{const I=be((l.y+R/Jt)/h);return(ne(.5*(be((l.y+x/Jt)/h)+I))*h-l.y)*Jt}})}function iD(u,o,l,h,_,f){const b=Math.pow(2,h.z-_.z);for(let S=0;S<l;S++){let E=u.int16[2*(S+o)+0],R=u.int16[2*(S+o)+1];E=(E+_.x*Jt)*b-h.x*Jt,R=(R+_.y*Jt)*b-h.y*Jt,f.push(new jt(E,R))}}let z1,Pb;function Lg(u,o){return u.x*o.x+u.y*o.y}function Nv(u,o){if(1===u.length){let l=0;const h=o[l++];let _;for(;!_||h.equals(_);)if(_=o[l++],!_)return 1/0;for(;l<o.length;l++){const f=o[l],b=u[0],S=_.sub(h),E=f.sub(h),R=b.sub(h),x=Lg(S,S),I=Lg(S,E),A=Lg(E,E),D=Lg(R,S),M=Lg(R,E),L=x*A-I*I,N=(A*D-I*M)/L,V=(x*M-I*D)/L,q=h.z*(1-N-V)+_.z*N+f.z*V;if(isFinite(q))return q}return 1/0}{let l=1/0;for(const h of o)l=Math.min(l,h.z);return l}}function V1(u,o,l,h,_,f,b,S){const E=b*_.getElevationAt(u,o,!0,!0),R=0!==f[0],x=R?0===f[1]?b*(f[0]/7-450):b*function(I,A,D){const M=Math.floor(A[0]/8),L=Math.floor(A[1]/8),N=10*(A[0]-8*M),V=10*(A[1]-8*L),q=I.getElevationAt(M,L,!0,!0),$=I.getMeterToDEM(D),U=Math.floor(.5*(N*$-1)),Z=Math.floor(.5*(V*$-1)),Y=I.tileCoordToPixel(M,L),se=2*U+1,ve=2*Z+1,W=(st=se,Je=ve,[(ze=I).getElevationAtPixel($e=Y.x-U,nt=Y.y-Z,!0),ze.getElevationAtPixel($e+Je,nt,!0),ze.getElevationAtPixel($e,nt+Je,!0),ze.getElevationAtPixel($e+st,nt+Je,!0)]),ce=Math.abs(W[0]-W[1]),Se=Math.abs(W[2]-W[3]),me=Math.abs(W[0]-W[2])+Math.abs(W[1]-W[3]),Me=Math.min(.25,.5*$*(ce+Se)/se),Ne=Math.min(.25,.5*$*me/ve);var ze,$e,nt,st,Je;return q+Math.max(Me*N,Ne*V)}(_,f,S):E;return{base:E+(0===l?-1:l),top:R?Math.max(x+h,E+l+2):E+h}}xn(Tp,"FillExtrusionBucket",{omit:["layers","features"]}),xn(Yd,"PartData"),xn(Lv,"FootprintSegment"),xn(L1,"BorderCentroidData"),xn(Rb,"GroundEffect");const j1=nr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),aR=nr([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:rD}=j1,Dp=nr([{name:"a_packed",components:4,type:"Float32"}]),{members:oD}=Dp,em=nr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:ei}=em;class U1{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new ou({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const h=this.getKey(o,l);return this.positions[h]}trim(){const o=this.width,l=this.height=Hl(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,h){const _=[];let f=o.length%2==1?-o[o.length-1]*h:0,b=o[0]*h,S=!0;_.push({left:f,right:b,isDash:S,zeroLength:0===o[0]});let E=o[0];for(let R=1;R<o.length;R++){S=!S;const x=o[R];f=E*h,E+=x,b=E*h,_.push({left:f,right:b,isDash:S,zeroLength:0===x})}return _}addRoundDash(o,l,h){const _=l/2;for(let f=-h;f<=h;f++){const b=this.width*(this.nextRow+h+f);let S=0,E=o[S];for(let R=0;R<this.width;R++){R/E.right>1&&(E=o[++S]);const x=Math.abs(R-E.left),I=Math.abs(R-E.right),A=Math.min(x,I);let D;const M=f/h*(_+1);if(E.isDash){const L=_-Math.abs(M);D=Math.sqrt(A*A+L*L)}else D=_-Math.sqrt(A*A+M*M);this.image.data[b+R]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(o,l){for(let E=o.length-1;E>=0;--E){const R=o[E],x=o[E+1];R.zeroLength?o.splice(E,1):x&&x.isDash===R.isDash&&(x.left=R.left,o.splice(E,1))}const h=o[0],_=o[o.length-1];h.isDash===_.isDash&&(h.left=_.left-this.width,_.right=h.right+this.width);const f=this.width*this.nextRow;let b=0,S=o[b];for(let E=0;E<this.width;E++){E/S.right>1&&(S=o[++b]);const R=Math.abs(E-S.left),x=Math.abs(E-S.right),I=Math.min(R,x);this.image.data[f+E]=Math.max(0,Math.min(255,(S.isDash?I:-I)+l+128))}}addDash(o,l){const h=this.getKey(o,l);if(this.positions[h])return this.positions[h];const _="round"===l,f=_?7:0,b=2*f+1;if(this.nextRow+b>this.height)return ji("LineAtlas out of space"),null;0===o.length&&o.push(1);let S=0;for(let x=0;x<o.length;x++)o[x]<0&&(ji("Negative value is found in line dasharray, replacing values with 0"),o[x]=0),S+=o[x];if(0!==S){const x=this.width/S,I=this.getDashRanges(o,this.width,x);_?this.addRoundDash(I,x,f):this.addRegularDash(I,"square"===l?.5*x:0)}const E=this.nextRow+f;this.nextRow+=b;const R={tl:[E,f],br:[S,0]};return this.positions[h]=R,R}}xn(U1,"LineAtlas");const lR=Kf.VectorTileFeature.types,Og=Math.cos(Math.PI/180*37.5),uu=Math.cos(Math.PI/180*5);class Bv{constructor(o){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=o.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new eu,this.layoutVertexArray2=new $a,this.patternVertexArray=new tu,this.indexArray=new Nr,this.programConfigurations=new mt(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new Lo,this.maxLineLength=0,this.zOffsetVertexArray=new Pl,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.tessellationStep=o.tessellationStep?o.tessellationStep:128}updateFootprints(o,l){}populate(o,l,h,_){this.hasPattern=Ev("line",this.layers,l);const f=this.layers[0].layout.get("line-sort-key");this.hasZOffset=!this.layers[0].isDraped();const b=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&"none"===b&&ji(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const S=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&void 0!==S;const E=[];for(const{feature:A,id:D,index:M,sourceLayerIndex:L}of o){const N=this.layers[0]._featureFilter.needGeometry,V=At(A,N);if(!this.layers[0]._featureFilter.filter(new ao(this.zoom),V,h))continue;const q=f?f.evaluate(V,{},h):void 0,$={id:D,properties:A.properties,type:A.type,sourceLayerIndex:L,index:M,geometry:N?V.geometry:Ke(A,h,_),patterns:{},sortKey:q};E.push($)}f&&E.sort((A,D)=>A.sortKey-D.sortKey);const{lineAtlas:R,featureIndex:x}=l,I=this.addConstantDashes(R);for(const A of E){const{geometry:D,index:M,sourceLayerIndex:L}=A;if(I&&this.addFeatureDashes(A,R),this.hasPattern){const N=Iv("line",this.layers,A,this.zoom,l);this.patternFeatures.push(N)}else this.addFeature(A,D,M,h,R.positions,l.availableImages,l.brightness);x.insert(o[M].feature,D,M,L,this.index)}}addConstantDashes(o){let l=!1;for(const h of this.layers){const _=h.paint.get("line-dasharray").value,f=h.layout.get("line-cap").value;if("constant"!==_.kind||"constant"!==f.kind)l=!0;else{const b=f.value,S=_.value;if(!S)continue;o.addDash(S,b)}}return l}addFeatureDashes(o,l){const h=this.zoom;for(const _ of this.layers){const f=_.paint.get("line-dasharray").value,b=_.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===b.kind)continue;let S,E;if("constant"===f.kind){if(S=f.value,!S)continue}else S=f.evaluate({zoom:h},o);E="constant"===b.kind?b.value:b.evaluate({zoom:h},o),l.addDash(S,E),o.patterns[_.id]=l.getKey(S,E)}}update(o,l,h,_,f){const b=0!==Object.keys(o).length;b&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(o,l,b?this.stateDependentLayers:this.layers,h,_,f)}addFeatures(o,l,h,_,f,b){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,l,h,_,b)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,oD)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=o.createVertexBuffer(this.patternVertexArray,ei)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,aR.members,!0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,rD),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,h,_,f,b,S){const E=this.layers[0].layout,R=E.get("line-join").evaluate(o,{}),x=E.get("line-cap").evaluate(o,{}),I=E.get("line-miter-limit"),A=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(o),this.lineFeature=o,this.zOffsetValue=E.get("line-z-offset").value;for(const D of l)this.addLine(D,o,_,R,x,I,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,h,f,b,_,S)}addLine(o,l,h,_,f,b,S){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const E="none"===_;if(this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let $=0;$<o.length-1;$++)this.totalDistance+=o[$].dist(o[$+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const R="Polygon"===lR[l.type];let x=o.length;for(;x>=2&&o[x-1].equals(o[x-2]);)x--;let I=0;for(;I<x-1&&o[I].equals(o[I+1]);)I++;if(x<(R?3:2))return;"bevel"===_&&(b=1.05);const A=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let D,M,L,N,V,q;this.e1=this.e2=-1,R&&(D=o[x-2],V=o[I].sub(D)._unit()._perp());for(let $=I;$<x;$++){if(L=$===x-1?R?o[I+1]:void 0:o[$+1],L&&o[$].equals(L))continue;V&&(N=V),D&&(M=D),D=o[$],q=this.hasZOffset?this.evaluateElevationValue(M?M.dist(D):0):null,V=L?L.sub(D)._unit()._perp():N,N=N||V;const U=M&&L;let Z=U?_:R||E?"butt":f;const Y=N.x*V.x+N.y*V.y;if(E){const Ne=function(ze){if(ze.patternJoinNone){const $e=ze.segmentPoints.length/2,nt=ze.lineSoFar-ze.segmentStart;for(let st=0;st<$e;++st){const Je=ze.segmentPoints[2*st+1],St=Math.round(ze.segmentPoints[2*st])+.5+.25*Je;ze.patternVertexArray.emplaceBack(St,nt,ze.segmentStart),ze.patternVertexArray.emplaceBack(St,nt,ze.segmentStart)}ze.segmentPoints.length=0}ze.e1=ze.e2=-1};if(U&&Y<uu){this.updateDistance(M,D),this.addCurrentVertex(D,N,1,1,A,q),Ne(this),this.addCurrentVertex(D,V,-1,-1,A,q);continue}if(M){if(!L){this.updateDistance(M,D),this.addCurrentVertex(D,N,1,1,A,q),Ne(this);continue}Z="miter"}}let se=N.add(V);0===se.x&&0===se.y||se._unit();const ve=se.x*V.x+se.y*V.y,W=0!==ve?1/ve:1/0,ce=2*Math.sqrt(2-2*ve),Se=ve<Og&&M&&L,me=N.x*V.y-N.y*V.x>0,Me=this.overscaling<=16?15*Jt/(512*this.overscaling):0;if(U&&"round"===Z)if(W<S)Z="miter";else if(W<=2){const Ne=zv(D,-10,8202);Z=this.hasZOffset&&(Ne||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===Z&&W>b&&(Z="bevel"),"bevel"===Z&&(W>2&&(Z="flipbevel"),W<b&&(Z="miter")),M&&!("miter"===Z&&Se)&&this.updateDistance(M,D),"miter"===Z)if(Se){const Ne=D.dist(M);if(Ne>2*Me){const $e=D.sub(D.sub(M)._mult(Me/Ne)._round());this.updateDistance(M,$e),this.addCurrentVertex($e,N,0,0,A,q),M=$e}this.updateDistance(M,D),se._mult(W),this.addCurrentVertex(D,se,0,0,A,q);const ze=D.dist(L);if(ze>2*Me){const $e=D.add(L.sub(D)._mult(Me/ze)._round());this.updateDistance(D,$e),this.addCurrentVertex($e,V,0,0,A,q),D=$e}}else se._mult(W),this.addCurrentVertex(D,se,0,0,A,q);else if("flipbevel"===Z){if(W>100)se=V.mult(-1);else{const Ne=W*N.add(V).mag()/N.sub(V).mag();se._perp()._mult(Ne*(me?-1:1))}this.addCurrentVertex(D,se,0,0,A,q),this.addCurrentVertex(D,se.mult(-1),0,0,A,q)}else if("bevel"===Z||"fakeround"===Z){null!=q&&M&&this.addCurrentVertex(D,N,-1,-1,A,q);const Ne=D.dist(M)<=2*Me&&"bevel"!==Z,ze=se.mult(me?1:-1);ze._mult(W);const $e=V.mult(me?-1:1),nt=N.mult(me?-1:1),st=this.evaluateElevationValue(this.distance);if(null==q&&(this.addHalfVertex(D,ze.x,ze.y,!1,!me,0,A,st),Ne||this.addHalfVertex(D,ze.x+2*nt.x,ze.y+2*nt.y,!1,me,0,A,st)),"fakeround"===Z){const Je=Math.round(180*ce/Math.PI/20);this.addHalfVertex(D,nt.x,nt.y,!1,me,0,A,st);for(let St=0;St<Je;St++){let $t=St/Je;if(.5!==$t){const gn=$t-.5;$t+=$t*gn*($t-1)*((1.0904+Y*(Y*(3.55645-1.43519*Y)-3.2452))*gn*gn+(.848013+Y*(.215638*Y-1.06021)))}const gt=$e.sub(nt)._mult($t)._add(nt)._unit();this.addHalfVertex(D,gt.x,gt.y,!1,me,0,A,st)}this.addHalfVertex(D,$e.x,$e.y,!1,me,0,A,st)}Ne||null!=q||this.addHalfVertex(D,ze.x+2*$e.x,ze.y+2*$e.y,!1,me,0,A,st),null!=q&&L&&this.addCurrentVertex(D,V,1,1,A,q)}else"butt"===Z?this.addCurrentVertex(D,se,0,0,A,q):"square"===Z?(M||this.addCurrentVertex(D,se,-1,-1,A,q),this.addCurrentVertex(D,se,0,0,A,q),M&&this.addCurrentVertex(D,se,1,1,A,q)):"round"===Z&&(M&&(this.addCurrentVertex(D,N,0,0,A,q),this.addCurrentVertex(D,N,1,1,A,q,!0)),L&&(this.addCurrentVertex(D,V,-1,-1,A,q,!0),this.addCurrentVertex(D,V,0,0,A,q)))}}addVerticesTo(o,l,h,_,f,b,S,E,R,x){const I=(l.w-o.w)/this.tessellationStep|0;let A=0;const D=this.scaledDistance;if(I>1){this.lineSoFar=o.w;const L=(l.x-o.x)/I,N=(l.y-o.y)/I,V=(l.z-o.z)/I,q=(l.w-o.w)/I;for(let $=1;$<I;++$){o.x+=L,o.y+=N,o.z+=V,this.lineSoFar+=q,A+=q;const U=this.evaluateElevationValue(this.prevDistance+A);this.scaledDistance=(this.prevDistance+A)/this.totalDistance,this.addHalfVertex(o,h,_,x,!1,S,R,U),this.addHalfVertex(o,f,b,x,!0,-E,R,U)}}this.lineSoFar=l.w,this.scaledDistance=D;const M=this.evaluateElevationValue(this.distance);this.addHalfVertex(l,h,_,x,!1,S,R,M),this.addHalfVertex(l,f,b,x,!0,-E,R,M)}evaluateElevationValue(o){return this.hasZOffset?"constant"===this.zOffsetValue.kind?this.zOffsetValue.value:(this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+o)/this.totalFeatureLength):ji(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0):void 0}addCurrentVertex(o,l,h,_,f,b,S=!1){const E=l.x+l.y*h,R=l.y-l.x*h,x=l.y*_-l.x,I=-l.y-l.x*_;if(null!=b){const D=8202,M=b,L=new Rg(o.x,o.y,M,this.lineSoFar),N=zv(o,-10,D),V=this.lineSoFar,q=this.distance;if(this.currentVertex)if(N){const $=this.currentVertexIsOutside,U=this.currentVertex,Z=new Rg(o.x,o.y,M,this.lineSoFar);if(D1(U,Z,-10,D),!zv(Z,-10,D)){if($){this.e1=this.e2=-1,this.distance-=U.dist(L),this.lineSoFar=U.w;const Y=this.evaluateElevationValue(U.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(U,E,R,S,!1,h,f,Y),this.addHalfVertex(U,x,I,S,!0,-_,f,Y),this.prevDistance=this.distance}this.distance=this.prevDistance+U.dist(Z),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(U,Z,E,R,x,I,h,_,f,S),this.distance=q,this.scaledDistance=this.distance/this.totalDistance}}else{const $=this.currentVertex;if(this.currentVertexIsOutside){D1($,L,-10,D),this.e1=this.e2=-1,this.distance-=$.dist(L),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=$.w;const U=this.evaluateElevationValue($.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($,E,R,S,!1,h,f,U),this.addHalfVertex($,x,I,S,!0,-_,f,U),this.prevDistance=this.distance,this.distance=q,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo($,L,E,R,x,I,h,_,f,S)}else N||(this.addHalfVertex(o,E,R,S,!1,h,f,b),this.addHalfVertex(o,x,I,S,!0,-_,f,b));this.currentVertex=L,this.currentVertexIsOutside=N,this.lineSoFar=V}else this.addHalfVertex(o,E,R,S,!1,h,f,b),this.addHalfVertex(o,x,I,S,!0,-_,f,b)}addHalfVertex({x:o,y:l},h,_,f,b,S,E,R){this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),b||this.segmentPoints.push(this.lineSoFar-this.segmentStart,S)),this.layoutVertexArray.emplaceBack((o<<1)+(f?1:0),(l<<1)+(b?1:0),Math.round(63*h)+128,Math.round(63*_)+128,1+(0===S?0:S<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),E.primitiveLength++),b?this.e2=x:this.e1=x,null!=R&&this.zOffsetVertexArray.emplaceBack(R)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(o,l){this.prevDistance=this.distance,this.distance+=o.dist(l),this.updateScaledDistance()}}function zv(u,o,l){return u.x<o||u.x>l||u.y<o||u.y>l}let Kd,H1;function Lb(u,o,l){return o*(Jt/(u.tileSize*Math.pow(2,l-u.tileID.overscaledZ)))}xn(Bv,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Ob=(u,o,l)=>(1-l)*u+l*o;function G1(u,o){return 1/Lb(u,1,o.tileZoom)}function Fb(u,o,l,h){return u.translatePosMatrix(h||o.tileID.projMatrix,o,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const Xu=u=>{const o=[];q1(u)&&o.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT");const l=u.paint.get("line-trim-offset");0===l[0]&&0===l[1]||o.push("RENDER_LINE_TRIM_OFFSET"),0!==u.paint.get("line-border-width").constantOr(1)&&o.push("RENDER_LINE_BORDER");const h="none"===u.layout.get("line-join").constantOr("miter"),_=!!u.paint.get("line-pattern").constantOr(1);return h&&_&&o.push("LINE_JOIN_NONE"),o};function q1(u){const o=u.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}let Vv;const $1=()=>Vv||(Vv={layout:Kd||(Kd=new Wr({"line-cap":new On(rt.layout_line["line-cap"]),"line-join":new On(rt.layout_line["line-join"]),"line-miter-limit":new Xt(rt.layout_line["line-miter-limit"]),"line-round-limit":new Xt(rt.layout_line["line-round-limit"]),"line-sort-key":new On(rt.layout_line["line-sort-key"]),"line-z-offset":new On(rt.layout_line["line-z-offset"]),"line-elevation-reference":new Xt(rt.layout_line["line-elevation-reference"]),"line-cross-slope":new Xt(rt.layout_line["line-cross-slope"]),visibility:new Xt(rt.layout_line.visibility)})),paint:H1||(H1=new Wr({"line-opacity":new On(rt.paint_line["line-opacity"]),"line-color":new On(rt.paint_line["line-color"]),"line-translate":new Xt(rt.paint_line["line-translate"]),"line-translate-anchor":new Xt(rt.paint_line["line-translate-anchor"]),"line-width":new On(rt.paint_line["line-width"]),"line-gap-width":new On(rt.paint_line["line-gap-width"]),"line-offset":new On(rt.paint_line["line-offset"]),"line-blur":new On(rt.paint_line["line-blur"]),"line-dasharray":new On(rt.paint_line["line-dasharray"]),"line-pattern":new On(rt.paint_line["line-pattern"]),"line-gradient":new Nd(rt.paint_line["line-gradient"]),"line-trim-offset":new Xt(rt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Xt(rt.paint_line["line-trim-fade-range"]),"line-trim-color":new Xt(rt.paint_line["line-trim-color"]),"line-emissive-strength":new Xt(rt.paint_line["line-emissive-strength"]),"line-border-width":new On(rt.paint_line["line-border-width"]),"line-border-color":new On(rt.paint_line["line-border-color"]),"line-occlusion-opacity":new Xt(rt.paint_line["line-occlusion-opacity"])}))},Vv);class sD extends On{possiblyEvaluate(o,l){return l=new ao(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition}),super.possiblyEvaluate(o,l)}evaluate(o,l,h,_){return l=ir({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(o,l,h,_)}}let Fg;function W1(u,o){return o>0?o+2*u:u}const aD=nr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tm=nr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Zu=nr([{name:"a_projected_pos",components:4,type:"Float32"}],4);nr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lD=nr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),cD=nr([{name:"a_texb",components:2,type:"Uint16"}]),cR=nr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),uR=nr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);nr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jv=nr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dR=nr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);nr([{name:"triangle",components:3,type:"Uint16"}]),nr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),nr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),nr([{type:"Float32",name:"offsetX"}]),nr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const du=128;function Nb(u,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new ao(u+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:_}=l;let f=0;for(;f<h.length&&h[f]<=u;)f++;f=Math.max(0,f-1);let b=f;for(;b<h.length&&h[b]<u+1;)b++;b=Math.min(h.length-1,b);const S=h[f],E=h[b];return"composite"===l.kind?{kind:"composite",minZoom:S,maxZoom:E,interpolationType:_}:{kind:"camera",minZoom:S,maxZoom:E,minSize:l.evaluate(new ao(S)),maxSize:l.evaluate(new ao(E)),interpolationType:_}}}function Bb(u,{uSize:o,uSizeT:l},{lowerSize:h,upperSize:_}){return"source"===u.kind?h/du:"composite"===u.kind?Wn(h/du,_/du,l):o}function Ep(u,o,l=1){let h=0,_=0;if("constant"===u.kind)_=u.layoutSize*l;else if("source"!==u.kind){const{interpolationType:f,minZoom:b,maxZoom:S}=u,E=f?Pt(Ta.interpolationFactor(f,o,b,S),0,1):0;"camera"===u.kind?_=Wn(u.minSize,u.maxSize,E)*l:h=E*l}return{uSizeT:h,uSize:_}}var uD=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:du,evaluateSizeForFeature:Bb,evaluateSizeForZoom:Ep,getSizeData:Nb});function dD(u,o,l){return u.sections.forEach(h=>{h.text=function(_,f,b){const S=f.layout.get("text-transform").evaluate(b,{});return"uppercase"===S?_=_.toLocaleUpperCase():"lowercase"===S&&(_=_.toLocaleLowerCase()),na.applyArabicShaping&&(_=na.applyArabicShaping(_)),_}(h.text,o,l)}),u}const Za={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function hD(u){return"\ufe36"===u||"\ufe48"===u||"\ufe38"===u||"\ufe44"===u||"\ufe42"===u||"\ufe3e"===u||"\ufe3c"===u||"\ufe3a"===u||"\ufe18"===u||"\ufe40"===u||"\ufe10"===u||"\ufe13"===u||"\ufe14"===u||"\uff40"===u||"\uffe3"===u||"\ufe11"===u||"\ufe12"===u}function X1(u){return"\ufe35"===u||"\ufe47"===u||"\ufe37"===u||"\ufe43"===u||"\ufe41"===u||"\ufe3d"===u||"\ufe3b"===u||"\ufe39"===u||"\ufe17"===u||"\ufe3f"===u}var Z1,Uv,Y1,Hv={};function J1(){if(Y1)return Uv;Y1=1,Uv=o;var u=function K1(){return Z1||(Z1=1,Hv.read=function(u,o,l,h,_){var f,b,S=8*_-h-1,E=(1<<S)-1,R=E>>1,x=-7,I=l?_-1:0,A=l?-1:1,D=u[o+I];for(I+=A,f=D&(1<<-x)-1,D>>=-x,x+=S;x>0;f=256*f+u[o+I],I+=A,x-=8);for(b=f&(1<<-x)-1,f>>=-x,x+=h;x>0;b=256*b+u[o+I],I+=A,x-=8);if(0===f)f=1-R;else{if(f===E)return b?NaN:1/0*(D?-1:1);b+=Math.pow(2,h),f-=R}return(D?-1:1)*b*Math.pow(2,f-h)},Hv.write=function(u,o,l,h,_,f){var b,S,E,R=8*f-_-1,x=(1<<R)-1,I=x>>1,A=23===_?Math.pow(2,-24)-Math.pow(2,-77):0,D=h?0:f-1,M=h?1:-1,L=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(S=isNaN(o)?1:0,b=x):(b=Math.floor(Math.log(o)/Math.LN2),o*(E=Math.pow(2,-b))<1&&(b--,E*=2),(o+=b+I>=1?A/E:A*Math.pow(2,1-I))*E>=2&&(b++,E/=2),b+I>=x?(S=0,b=x):b+I>=1?(S=(o*E-1)*Math.pow(2,_),b+=I):(S=o*Math.pow(2,I-1)*Math.pow(2,_),b=0));_>=8;u[l+D]=255&S,D+=M,S/=256,_-=8);for(b=b<<_|S,R+=_;R>0;u[l+D]=255&b,D+=M,b/=256,R-=8);u[l+D-M]|=128*L}),Hv}();function o(U){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(U)?U:new Uint8Array(U||0),this.pos=0,this.type=0,this.length=this.buf.length}o.Varint=0,o.Fixed64=1,o.Bytes=2,o.Fixed32=5;var l=4294967296,h=1/l,_="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function f(U){return U.type===o.Bytes?U.readVarint()+U.pos:U.pos+1}function S(U,Z,Y){var se=Z<=16383?1:Z<=2097151?2:Z<=268435455?3:Math.floor(Math.log(Z)/(7*Math.LN2));Y.realloc(se);for(var ve=Y.pos-1;ve>=U;ve--)Y.buf[ve+se]=Y.buf[ve]}function E(U,Z){for(var Y=0;Y<U.length;Y++)Z.writeVarint(U[Y])}function R(U,Z){for(var Y=0;Y<U.length;Y++)Z.writeSVarint(U[Y])}function x(U,Z){for(var Y=0;Y<U.length;Y++)Z.writeFloat(U[Y])}function I(U,Z){for(var Y=0;Y<U.length;Y++)Z.writeDouble(U[Y])}function A(U,Z){for(var Y=0;Y<U.length;Y++)Z.writeBoolean(U[Y])}function D(U,Z){for(var Y=0;Y<U.length;Y++)Z.writeFixed32(U[Y])}function M(U,Z){for(var Y=0;Y<U.length;Y++)Z.writeSFixed32(U[Y])}function L(U,Z){for(var Y=0;Y<U.length;Y++)Z.writeFixed64(U[Y])}function N(U,Z){for(var Y=0;Y<U.length;Y++)Z.writeSFixed64(U[Y])}function V(U,Z){return(U[Z]|U[Z+1]<<8|U[Z+2]<<16)+16777216*U[Z+3]}function q(U,Z,Y){U[Y]=Z,U[Y+1]=Z>>>8,U[Y+2]=Z>>>16,U[Y+3]=Z>>>24}function $(U,Z){return(U[Z]|U[Z+1]<<8|U[Z+2]<<16)+(U[Z+3]<<24)}return o.prototype={destroy:function(){this.buf=null},readFields:function(U,Z,Y){for(Y=Y||this.length;this.pos<Y;){var se=this.readVarint(),ve=se>>3,W=this.pos;this.type=7&se,U(ve,Z,this),this.pos===W&&this.skip(se)}return Z},readMessage:function(U,Z){return this.readFields(U,Z,this.readVarint()+this.pos)},readFixed32:function(){var U=V(this.buf,this.pos);return this.pos+=4,U},readSFixed32:function(){var U=$(this.buf,this.pos);return this.pos+=4,U},readFixed64:function(){var U=V(this.buf,this.pos)+V(this.buf,this.pos+4)*l;return this.pos+=8,U},readSFixed64:function(){var U=V(this.buf,this.pos)+$(this.buf,this.pos+4)*l;return this.pos+=8,U},readFloat:function(){var U=u.read(this.buf,this.pos,!0,23,4);return this.pos+=4,U},readDouble:function(){var U=u.read(this.buf,this.pos,!0,52,8);return this.pos+=8,U},readVarint:function(U){var Z,Y,se=this.buf;return Z=127&(Y=se[this.pos++]),Y<128?Z:(Z|=(127&(Y=se[this.pos++]))<<7,Y<128?Z:(Z|=(127&(Y=se[this.pos++]))<<14,Y<128?Z:(Z|=(127&(Y=se[this.pos++]))<<21,Y<128?Z:function(ve,W,ce){var Se,me,Me=ce.buf;if(Se=(112&(me=Me[ce.pos++]))>>4,me<128||(Se|=(127&(me=Me[ce.pos++]))<<3,me<128)||(Se|=(127&(me=Me[ce.pos++]))<<10,me<128)||(Se|=(127&(me=Me[ce.pos++]))<<17,me<128)||(Se|=(127&(me=Me[ce.pos++]))<<24,me<128)||(Se|=(1&(me=Me[ce.pos++]))<<31,me<128))return function b(U,Z,Y){return Y?4294967296*Z+(U>>>0):4294967296*(Z>>>0)+(U>>>0)}(ve,Se,W);throw new Error("Expected varint not more than 10 bytes")}(Z|=(15&(Y=se[this.pos]))<<28,U,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var U=this.readVarint();return U%2==1?(U+1)/-2:U/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var U=this.readVarint()+this.pos,Z=this.pos;return this.pos=U,U-Z>=12&&_?_.decode(this.buf.subarray(Z,U)):function(Y,se,ve){for(var W="",ce=se;ce<ve;){var Se,me,Me,Ne=Y[ce],ze=null,$e=Ne>239?4:Ne>223?3:Ne>191?2:1;if(ce+$e>ve)break;1===$e?Ne<128&&(ze=Ne):2===$e?128==(192&(Se=Y[ce+1]))&&(ze=(31&Ne)<<6|63&Se)<=127&&(ze=null):3===$e?(me=Y[ce+2],128==(192&(Se=Y[ce+1]))&&128==(192&me)&&((ze=(15&Ne)<<12|(63&Se)<<6|63&me)<=2047||ze>=55296&&ze<=57343)&&(ze=null)):4===$e&&(me=Y[ce+2],Me=Y[ce+3],128==(192&(Se=Y[ce+1]))&&128==(192&me)&&128==(192&Me)&&((ze=(15&Ne)<<18|(63&Se)<<12|(63&me)<<6|63&Me)<=65535||ze>=1114112)&&(ze=null)),null===ze?(ze=65533,$e=1):ze>65535&&(ze-=65536,W+=String.fromCharCode(ze>>>10&1023|55296),ze=56320|1023&ze),W+=String.fromCharCode(ze),ce+=$e}return W}(this.buf,Z,U)},readBytes:function(){var U=this.readVarint()+this.pos,Z=this.buf.subarray(this.pos,U);return this.pos=U,Z},readPackedVarint:function(U,Z){if(this.type!==o.Bytes)return U.push(this.readVarint(Z));var Y=f(this);for(U=U||[];this.pos<Y;)U.push(this.readVarint(Z));return U},readPackedSVarint:function(U){if(this.type!==o.Bytes)return U.push(this.readSVarint());var Z=f(this);for(U=U||[];this.pos<Z;)U.push(this.readSVarint());return U},readPackedBoolean:function(U){if(this.type!==o.Bytes)return U.push(this.readBoolean());var Z=f(this);for(U=U||[];this.pos<Z;)U.push(this.readBoolean());return U},readPackedFloat:function(U){if(this.type!==o.Bytes)return U.push(this.readFloat());var Z=f(this);for(U=U||[];this.pos<Z;)U.push(this.readFloat());return U},readPackedDouble:function(U){if(this.type!==o.Bytes)return U.push(this.readDouble());var Z=f(this);for(U=U||[];this.pos<Z;)U.push(this.readDouble());return U},readPackedFixed32:function(U){if(this.type!==o.Bytes)return U.push(this.readFixed32());var Z=f(this);for(U=U||[];this.pos<Z;)U.push(this.readFixed32());return U},readPackedSFixed32:function(U){if(this.type!==o.Bytes)return U.push(this.readSFixed32());var Z=f(this);for(U=U||[];this.pos<Z;)U.push(this.readSFixed32());return U},readPackedFixed64:function(U){if(this.type!==o.Bytes)return U.push(this.readFixed64());var Z=f(this);for(U=U||[];this.pos<Z;)U.push(this.readFixed64());return U},readPackedSFixed64:function(U){if(this.type!==o.Bytes)return U.push(this.readSFixed64());var Z=f(this);for(U=U||[];this.pos<Z;)U.push(this.readSFixed64());return U},skip:function(U){var Z=7&U;if(Z===o.Varint)for(;this.buf[this.pos++]>127;);else if(Z===o.Bytes)this.pos=this.readVarint()+this.pos;else if(Z===o.Fixed32)this.pos+=4;else{if(Z!==o.Fixed64)throw new Error("Unimplemented type: "+Z);this.pos+=8}},writeTag:function(U,Z){this.writeVarint(U<<3|Z)},realloc:function(U){for(var Z=this.length||16;Z<this.pos+U;)Z*=2;if(Z!==this.length){var Y=new Uint8Array(Z);Y.set(this.buf),this.buf=Y,this.length=Z}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(U){this.realloc(4),q(this.buf,U,this.pos),this.pos+=4},writeSFixed32:function(U){this.realloc(4),q(this.buf,U,this.pos),this.pos+=4},writeFixed64:function(U){this.realloc(8),q(this.buf,-1&U,this.pos),q(this.buf,Math.floor(U*h),this.pos+4),this.pos+=8},writeSFixed64:function(U){this.realloc(8),q(this.buf,-1&U,this.pos),q(this.buf,Math.floor(U*h),this.pos+4),this.pos+=8},writeVarint:function(U){(U=+U||0)>268435455||U<0?function(Z,Y){var se,ve,W,Se;if(Z>=0?(se=Z%4294967296|0,ve=Z/4294967296|0):(ve=~(-Z/4294967296),4294967295^(se=~(-Z%4294967296))?se=se+1|0:(se=0,ve=ve+1|0)),Z>=0x10000000000000000||Z<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");Y.realloc(10),W=se,(Se=Y).buf[Se.pos++]=127&W|128,W>>>=7,Se.buf[Se.pos++]=127&W|128,W>>>=7,Se.buf[Se.pos++]=127&W|128,W>>>=7,Se.buf[Se.pos++]=127&W|128,Se.buf[Se.pos]=127&(W>>>=7),function(W,ce){var Se=(7&W)<<4;ce.buf[ce.pos++]|=Se|((W>>>=3)?128:0),W&&(ce.buf[ce.pos++]=127&W|((W>>>=7)?128:0),W&&(ce.buf[ce.pos++]=127&W|((W>>>=7)?128:0),W&&(ce.buf[ce.pos++]=127&W|((W>>>=7)?128:0),W&&(ce.buf[ce.pos++]=127&W|((W>>>=7)?128:0),W&&(ce.buf[ce.pos++]=127&W)))))}(ve,Y)}(U,this):(this.realloc(4),this.buf[this.pos++]=127&U|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=U>>>7&127))))},writeSVarint:function(U){this.writeVarint(U<0?2*-U-1:2*U)},writeBoolean:function(U){this.writeVarint(Boolean(U))},writeString:function(U){U=String(U),this.realloc(4*U.length),this.pos++;var Z=this.pos;this.pos=function(se,ve,W){for(var ce,Se,me=0;me<ve.length;me++){if((ce=ve.charCodeAt(me))>55295&&ce<57344){if(!Se){ce>56319||me+1===ve.length?(se[W++]=239,se[W++]=191,se[W++]=189):Se=ce;continue}if(ce<56320){se[W++]=239,se[W++]=191,se[W++]=189,Se=ce;continue}ce=Se-55296<<10|ce-56320|65536,Se=null}else Se&&(se[W++]=239,se[W++]=191,se[W++]=189,Se=null);ce<128?se[W++]=ce:(ce<2048?se[W++]=ce>>6|192:(ce<65536?se[W++]=ce>>12|224:(se[W++]=ce>>18|240,se[W++]=ce>>12&63|128),se[W++]=ce>>6&63|128),se[W++]=63&ce|128)}return W}(this.buf,U,this.pos);var Y=this.pos-Z;Y>=128&&S(Z,Y,this),this.pos=Z-1,this.writeVarint(Y),this.pos+=Y},writeFloat:function(U){this.realloc(4),u.write(this.buf,U,this.pos,!0,23,4),this.pos+=4},writeDouble:function(U){this.realloc(8),u.write(this.buf,U,this.pos,!0,52,8),this.pos+=8},writeBytes:function(U){var Z=U.length;this.writeVarint(Z),this.realloc(Z);for(var Y=0;Y<Z;Y++)this.buf[this.pos++]=U[Y]},writeRawMessage:function(U,Z){this.pos++;var Y=this.pos;U(Z,this);var se=this.pos-Y;se>=128&&S(Y,se,this),this.pos=Y-1,this.writeVarint(se),this.pos+=se},writeMessage:function(U,Z,Y){this.writeTag(U,o.Bytes),this.writeRawMessage(Z,Y)},writePackedVarint:function(U,Z){Z.length&&this.writeMessage(U,E,Z)},writePackedSVarint:function(U,Z){Z.length&&this.writeMessage(U,R,Z)},writePackedBoolean:function(U,Z){Z.length&&this.writeMessage(U,A,Z)},writePackedFloat:function(U,Z){Z.length&&this.writeMessage(U,x,Z)},writePackedDouble:function(U,Z){Z.length&&this.writeMessage(U,I,Z)},writePackedFixed32:function(U,Z){Z.length&&this.writeMessage(U,D,Z)},writePackedSFixed32:function(U,Z){Z.length&&this.writeMessage(U,M,Z)},writePackedFixed64:function(U,Z){Z.length&&this.writeMessage(U,L,Z)},writePackedSFixed64:function(U,Z){Z.length&&this.writeMessage(U,N,Z)},writeBytesField:function(U,Z){this.writeTag(U,o.Bytes),this.writeBytes(Z)},writeFixed32Field:function(U,Z){this.writeTag(U,o.Fixed32),this.writeFixed32(Z)},writeSFixed32Field:function(U,Z){this.writeTag(U,o.Fixed32),this.writeSFixed32(Z)},writeFixed64Field:function(U,Z){this.writeTag(U,o.Fixed64),this.writeFixed64(Z)},writeSFixed64Field:function(U,Z){this.writeTag(U,o.Fixed64),this.writeSFixed64(Z)},writeVarintField:function(U,Z){this.writeTag(U,o.Varint),this.writeVarint(Z)},writeSVarintField:function(U,Z){this.writeTag(U,o.Varint),this.writeSVarint(Z)},writeStringField:function(U,Z){this.writeTag(U,o.Bytes),this.writeString(Z)},writeFloatField:function(U,Z){this.writeTag(U,o.Fixed32),this.writeFloat(Z)},writeDoubleField:function(U,Z){this.writeTag(U,o.Fixed64),this.writeDouble(Z)},writeBooleanField:function(U,Z){this.writeVarintField(U,Boolean(Z))}},Uv}var zb=Qe(J1());function sr(u,o,l){o.glyphs=[],1===u&&l.readMessage(_e,o)}function _e(u,o,l){if(3===u){const{id:h,bitmap:_,width:f,height:b,left:S,top:E,advance:R}=l.readMessage(Q1,{});o.glyphs.push({id:h,bitmap:new ou({width:f+6,height:b+6},_),metrics:{width:f,height:b,left:S,top:E,advance:R}})}else 4===u?o.ascender=l.readSVarint():5===u&&(o.descender=l.readSVarint())}function Q1(u,o,l){1===u?o.id=l.readVarint():2===u?o.bitmap=l.readBytes():3===u?o.width=l.readVarint():4===u?o.height=l.readVarint():5===u?o.left=l.readSVarint():6===u?o.top=l.readSVarint():7===u&&(o.advance=l.readVarint())}const Ol={horizontal:1,vertical:2,horizontalOnly:3};class Ng{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const h=new Ng;return h.scale=o||1,h.fontStack=l,h}static forImage(o){const l=new Ng;return l.imageName=o,l}}class Ip{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const h=new Ip;for(let _=0;_<o.sections.length;_++){const f=o.sections[_];f.image?h.addImageSection(f):h.addTextSection(f,l)}return h}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCodePoint(o){return this.text.codePointAt(o)}verticalizePunctuation(o){this.text=function(l,h){let _="";for(let f=0;f<l.length;f++){const b=l.charCodeAt(f+1)||null,S=l.charCodeAt(f-1)||null;_+=!h&&(b&&zf(b)&&!Za[l[f+1]]||S&&zf(S)&&!Za[l[f-1]])||!Za[l[f]]?l[f]:Za[l[f]]}return _}(this.text,o)}trim(){let o=0;for(let h=0;h<this.text.length&&Bg[this.text.charCodeAt(h)];h++)o++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=o&&Bg[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const h=new Ip;return h.text=this.text.substring(o,l),h.sectionIndex=this.sectionIndex.slice(o,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(Ng.forText(o.scale,o.fontStack||l));const h=this.sections.length-1;for(let _=0;_<o.text.length;++_)this.sectionIndex.push(h)}addImageSection(o){const l=o.image?o.image.namePrimary:"";if(0===l.length)return void ji("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(Ng.forImage(l)),this.sectionIndex.push(this.sections.length-1)):ji("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $v(u,o,l,h,_,f,b,S,E,R,x,I,A,D,M){const L=Ip.fromFeature(u,_);I===Ol.vertical&&L.verticalizePunctuation(A);let N=[];const V=function(Y,se,ve,W,ce,Se){if(!Y)return[];const me=[],Me=function(nt,st,Je,St,$t,gt){let gn=0;for(let on=0;on<nt.length();on++){const Kt=nt.getSection(on);gn+=ew(nt.getCodePoint(on),Kt,St,$t,st,gt)}return gn/Math.max(1,Math.ceil(gn/Je))}(Y,se,ve,W,ce,Se),Ne=Y.text.indexOf("\u200b")>=0;let ze=0;for(let nt=0;nt<Y.length();nt++){const st=Y.getSection(nt),Je=Y.getCodePoint(nt);if(Bg[Je]||(ze+=ew(Je,st,W,ce,se,Se)),nt<Y.length()-1){const St=!(($e=Je)<11904||!(Pn_Bopomofo_Extended($e)||Pn_Bopomofo($e)||Pn_CJK_Compatibility_Forms($e)||Pn_CJK_Compatibility_Ideographs($e)||Pn_CJK_Compatibility($e)||Pn_CJK_Radicals_Supplement($e)||Pn_CJK_Strokes($e)||Pn_CJK_Symbols_and_Punctuation($e)||Pn_CJK_Unified_Ideographs_Extension_A($e)||Pn_CJK_Unified_Ideographs($e)||Pn_Enclosed_CJK_Letters_and_Months($e)||Pn_Halfwidth_and_Fullwidth_Forms($e)||Pn_Hiragana($e)||Pn_Ideographic_Description_Characters($e)||Pn_Kangxi_Radicals($e)||Pn_Katakana_Phonetic_Extensions($e)||Pn_Katakana($e)||Pn_Vertical_Forms($e)||Pn_Yi_Radicals($e)||Pn_Yi_Syllables($e)));(pD[Je]||St||st.imageName)&&me.push(Wv(nt+1,ze,Me,me,tw(Je,Y.getCodePoint(nt+1),St&&Ne),!1))}}var $e;return jo(Wv(Y.length(),ze,Me,me,0,!0))}(L,R,f,o,h,D),{processBidirectionalText:q,processStyledBidirectionalText:$}=na;if(q&&1===L.sections.length){const Y=q(L.toString(),V);for(const se of Y){const ve=new Ip;ve.text=se,ve.sections=L.sections;for(let W=0;W<se.length;W++)ve.sectionIndex.push(0);N.push(ve)}}else if($){const Y=$(L.text,L.sectionIndex,V);for(const se of Y){const ve=new Ip;ve.text=se[0],ve.sectionIndex=se[1],ve.sections=L.sections,N.push(ve)}}else N=function(Y,se){const ve=[],W=Y.text;let ce=0;for(const Se of se)ve.push(Y.substring(ce,Se)),ce=Se;return ce<W.length&&ve.push(Y.substring(ce,W.length)),ve}(L,V);const U=[],Z={positionedLines:U,text:L.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Y,se,ve,W,ce,Se,me,Me,Ne,ze,$e,nt){let st=0,Je=0,St=0;const $t="right"===Me?1:"left"===Me?0:.5;let gt=!1;for(const pn of ce){const Sn=pn.getSections();for(const ii of Sn){if(ii.imageName)continue;const yi=se[ii.fontStack];if(yi&&(gt=void 0!==yi.ascender&&void 0!==yi.descender,!gt))break}if(!gt)break}let gn=0;for(const pn of ce){pn.trim();const Sn=pn.getMaxScale(),ii=24*(Sn-1),yi={positionedGlyphs:[],lineOffset:0};Y.positionedLines[gn]=yi;const xi=yi.positionedGlyphs;let fi=0;if(!pn.length()){Je+=Se,++gn;continue}let Ri=0,Ii=0;for(let Cr=0;Cr<pn.length();Cr++){const Xn=pn.getSection(Cr),ar=pn.getSectionIndex(Cr),hr=pn.getCodePoint(Cr);let Kr=Xn.scale,Mo=null,Ho=null,Ao=null,So=24,No=0;const Jr=!(Ne===Ol.horizontal||!$e&&!Lu(hr)||$e&&(Bg[hr]||(on=hr,Pn_Arabic(on)||Pn_Arabic_Supplement(on)||Pn_Arabic_Extended_A(on)||Pn_Arabic_Presentation_Forms_A(on)||Pn_Arabic_Presentation_Forms_B(on))));if(Xn.imageName){const as=W[Xn.imageName];if(!as)continue;Ao=Xn.imageName,Y.iconsInText=Y.iconsInText||!0,Ho=as.paddedRect;const _r=as.displaySize;Kr=24*Kr/nt,Mo={width:_r[0],height:_r[1],left:0,top:-3,advance:Jr?_r[1]:_r[0],localGlyph:!1},No=gt?-Mo.height*Kr:24*Sn-17-_r[1]*Kr,So=Mo.advance;const Ka=(Jr?_r[0]:_r[1])*Kr-24*Sn;Ka>0&&Ka>fi&&(fi=Ka)}else{const as=ve[Xn.fontStack];if(!as)continue;as[hr]&&(Ho=as[hr]);const _r=se[Xn.fontStack];if(!_r)continue;const Ka=_r.glyphs[hr];if(!Ka)continue;if(Mo=Ka.metrics,So=8203!==hr?24:0,gt){const Mc=void 0!==_r.ascender?Math.abs(_r.ascender):0,_a=void 0!==_r.descender?Math.abs(_r.descender):0,Ac=(Mc+_a)*Kr;Ri<Ac&&(Ri=Ac,Ii=(Mc-_a)/2*Kr),No=-Mc*Kr}else No=24*(Sn-Kr)-17}Jr?(Y.verticalizable=!0,xi.push({glyph:hr,imageName:Ao,x:st,y:Je+No,vertical:Jr,scale:Kr,localGlyph:Mo.localGlyph,fontStack:Xn.fontStack,sectionIndex:ar,metrics:Mo,rect:Ho}),st+=So*Kr+ze):(xi.push({glyph:hr,imageName:Ao,x:st,y:Je+No,vertical:Jr,scale:Kr,localGlyph:Mo.localGlyph,fontStack:Xn.fontStack,sectionIndex:ar,metrics:Mo,rect:Ho}),st+=Mo.advance*Kr+ze)}0!==xi.length&&(St=Math.max(st-ze,St),gt?Vb(xi,$t,fi,Ii,Se*Sn/2):Vb(xi,$t,fi,0,Se/2)),st=0;const Br=Se*Sn+fi;yi.lineOffset=Math.max(fi,ii),Je+=Br,++gn}var on;const Kt=Je,{horizontalAlign:Ht,verticalAlign:Vn}=Xv(me);(function(pn,Sn,ii,yi,xi,fi){const Ri=(Sn-ii)*xi,Ii=-fi*yi;for(const Br of pn)for(const Cr of Br.positionedGlyphs)Cr.x+=Ri,Cr.y+=Ii})(Y.positionedLines,$t,Ht,Vn,St,Kt),Y.top+=-Vn*Kt,Y.bottom=Y.top+Kt,Y.left+=-Ht*St,Y.right=Y.left+St,Y.hasBaseline=gt}(Z,o,l,h,N,b,S,E,I,R,A,M),!function(Y){for(const se of Y)if(0!==se.positionedGlyphs.length)return!1;return!0}(U)&&Z}const Bg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pD={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ew(u,o,l,h,_,f){if(o.imageName){const b=h[o.imageName];return b?b.displaySize[0]*o.scale*24/f+_:0}{const b=l[o.fontStack],S=b&&b.glyphs[u];return S?S.metrics.advance*o.scale+_:0}}function fD(u,o,l,h){const _=Math.pow(u-o,2);return h?u<o?_/2:2*_:_+Math.abs(l)*l}function tw(u,o,l){let h=0;return 10===u&&(h-=1e4),l&&(h+=150),40!==u&&65288!==u||(h+=50),41!==o&&65289!==o||(h+=50),h}function Wv(u,o,l,h,_,f){let b=null,S=fD(o,l,_,f);for(const E of h){const R=fD(o-E.x,l,_,f)+E.badness;R<=S&&(b=E,S=R)}return{index:u,x:o,priorBreak:b,badness:S}}function jo(u){return u?jo(u.priorBreak).concat(u.index):[]}function Xv(u){let o=.5,l=.5;switch(u){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function Vb(u,o,l,h,_){if(!(o||l||h||_))return;const f=u.length-1,b=u[f],S=(b.x+b.metrics.advance*b.scale)*o;for(let E=0;E<=f;E++)u[E].x-=S,u[E].y+=l+h+_}function Zv(u,o,l,h){const{horizontalAlign:_,verticalAlign:f}=Xv(h),b=l[0]-u.displaySize[0]*_,S=l[1]-u.displaySize[1]*f;return{imagePrimary:u,imageSecondary:o,top:S,bottom:S+u.displaySize[1],left:b,right:b+u.displaySize[0]}}function nw(u,o,l,h,_,f){const b=u.imagePrimary;let S;if(b.content){const N=b.content,V=b.pixelRatio||1;S=[N[0]/V,N[1]/V,b.displaySize[0]-N[2]/V,b.displaySize[1]-N[3]/V]}const E=o.left*f,R=o.right*f;let x,I,A,D;"width"===l||"both"===l?(D=_[0]+E-h[3],I=_[0]+R+h[1]):(D=_[0]+(E+R-b.displaySize[0])/2,I=D+b.displaySize[0]);const M=o.top*f,L=o.bottom*f;return"height"===l||"both"===l?(x=_[1]+M-h[0],A=_[1]+L+h[2]):(x=_[1]+(M+L-b.displaySize[1])/2,A=x+b.displaySize[1]),{imagePrimary:b,imageSecondary:void 0,top:x,right:I,bottom:A,left:D,collisionPadding:S}}class Jd extends jt{constructor(o,l,h,_,f){super(o,l),this.angle=_,this.z=h,void 0!==f&&(this.segment=f)}clone(){return new Jd(this.x,this.y,this.z,this.angle,this.segment)}}function mD(u,o,l,h,_){if(void 0===o.segment)return!0;let f=o,b=o.segment+1,S=0;for(;S>-l/2;){if(b--,b<0)return!1;S-=u[b].dist(f),f=u[b]}S+=u[b].dist(u[b+1]),b++;const E=[];let R=0;for(;S<l/2;){const x=u[b],I=u[b+1];if(!I)return!1;let A=u[b-1].angleTo(x)-x.angleTo(I);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:S,angleDelta:A}),R+=A;S-E[0].distance>h;)R-=E.shift().angleDelta;if(R>_)return!1;b++,S+=x.dist(I)}return!0}function gD(u){let o=0;for(let l=0;l<u.length-1;l++)o+=u[l].dist(u[l+1]);return o}function iw(u,o,l){return u?.6*o*l:0}function Yv(u,o){return Math.max(u?u.right-u.left:0,o?o.right-o.left:0)}function hR(u,o,l,h,_,f){const b=iw(l,_,f),S=Yv(l,h)*f;let E=0;const R=gD(u)/2;for(let x=0;x<u.length-1;x++){const I=u[x],A=u[x+1],D=I.dist(A);if(E+D>R){const M=(R-E)/D,L=Wn(I.x,A.x,M),N=Wn(I.y,A.y,M),V=new Jd(L,N,0,A.angleTo(I),x);return!b||mD(u,V,S,b,o)?V:void 0}E+=D}}function _D(u,o,l,h,_,f,b,S,E){const R=iw(h,f,b),x=Yv(h,_),I=x*b,A=0===u[0].x||u[0].x===E||0===u[0].y||u[0].y===E;return o-I<o/4&&(o=I+o/4),Mp(u,A?o/2*S%o:(x/2+2*f)*b*S%o,o,R,l,I,A,!1,E)}function Mp(u,o,l,h,_,f,b,S,E){const R=f/2,x=gD(u);let I=0,A=o-l,D=[];for(let M=0;M<u.length-1;M++){const L=u[M],N=u[M+1],V=L.dist(N),q=N.angleTo(L);for(;A+l<I+V;){A+=l;const $=(A-I)/V,U=Wn(L.x,N.x,$),Z=Wn(L.y,N.y,$);if(U>=0&&U<E&&Z>=0&&Z<E&&A-R>=0&&A+R<=x){const Y=new Jd(U,Z,0,q,M);h&&!mD(u,Y,f,h,_)||D.push(Y)}}I+=V}return S||D.length||b||(D=Mp(u,I/2,l,h,_,f,b,!0,E)),D}function rw(u,o,l,h,_){const f=[];for(let b=0;b<u.length;b++){const S=u[b];let E;for(let R=0;R<S.length-1;R++){let x=S[R],I=S[R+1];x.x<o&&I.x<o||(x.x<o?x=new jt(o,x.y+(o-x.x)/(I.x-x.x)*(I.y-x.y))._round():I.x<o&&(I=new jt(o,x.y+(o-x.x)/(I.x-x.x)*(I.y-x.y))._round()),x.y<l&&I.y<l||(x.y<l?x=new jt(x.x+(l-x.y)/(I.y-x.y)*(I.x-x.x),l)._round():I.y<l&&(I=new jt(x.x+(l-x.y)/(I.y-x.y)*(I.x-x.x),l)._round()),x.x>=h&&I.x>=h||(x.x>=h?x=new jt(h,x.y+(h-x.x)/(I.x-x.x)*(I.y-x.y))._round():I.x>=h&&(I=new jt(h,x.y+(h-x.x)/(I.x-x.x)*(I.y-x.y))._round()),x.y>=_&&I.y>=_||(x.y>=_?x=new jt(x.x+(_-x.y)/(I.y-x.y)*(I.x-x.x),_)._round():I.y>=_&&(I=new jt(x.x+(_-x.y)/(I.y-x.y)*(I.x-x.x),_)._round()),E&&x.equals(E[E.length-1])||(E=[x],f.push(E)),E.push(I)))))}}return f}function Kv(u){let o=0,l=0;for(const b of u)o+=b.w*b.h,l=Math.max(l,b.w);u.sort((b,S)=>S.h-b.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let _=0,f=0;for(const b of u)for(let S=h.length-1;S>=0;S--){const E=h[S];if(!(b.w>E.w||b.h>E.h)){if(b.x=E.x,b.y=E.y,f=Math.max(f,b.y+b.h),_=Math.max(_,b.x+b.w),b.w===E.w&&b.h===E.h){const R=h.pop();S<h.length&&(h[S]=R)}else b.h===E.h?(E.x+=b.w,E.w-=b.w):b.w===E.w?(E.y+=b.h,E.h-=b.h):(h.push({x:E.x+b.w,y:E.y,w:E.w-b.w,h:b.h}),E.y+=b.h,E.h-=b.h);break}}return{w:_,h:f,fill:o/(_*f)||0}}xn(Jd,"Anchor");class Jv{constructor(o,{pixelRatio:l,version:h,stretchX:_,stretchY:f,content:b},S){this.paddedRect=o,this.pixelRatio=l,this.stretchX=_,this.stretchY=f,this.content=b,this.version=h,this.padding=S}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class Qv{constructor(o,l,h){const _={},f={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,_,1,b),this.addImages(l,f,2,b);const{w:S,h:E}=Kv(b),R=new Hs({width:S||1,height:E||1});for(const x in o){const I=o[x],A=_[x].paddedRect;Hs.copy(I.data,R,{x:0,y:0},{x:A.x+1,y:A.y+1},I.data,h,I.sdf)}for(const x in l){const I=l[x],A=f[x].paddedRect;let D=f[x].padding;const M=A.x+D,L=A.y+D,N=I.data.width,V=I.data.height;D=D>1?D-1:D,Hs.copy(I.data,R,{x:0,y:0},{x:M,y:L},I.data,h),Hs.copy(I.data,R,{x:0,y:V-D},{x:M,y:L-D},{width:N,height:D},h),Hs.copy(I.data,R,{x:0,y:0},{x:M,y:L+V},{width:N,height:D},h),Hs.copy(I.data,R,{x:N-D,y:0},{x:M-D,y:L},{width:D,height:V},h),Hs.copy(I.data,R,{x:0,y:0},{x:M+N,y:L},{width:D,height:V},h),Hs.copy(I.data,R,{x:N-D,y:V-D},{x:M-D,y:L-D},{width:D,height:D},h),Hs.copy(I.data,R,{x:0,y:V-D},{x:M+N,y:L-D},{width:D,height:D},h),Hs.copy(I.data,R,{x:0,y:0},{x:M+N,y:L+V},{width:D,height:D},h),Hs.copy(I.data,R,{x:N-D,y:0},{x:M-D,y:L+V},{width:D,height:D},h)}this.image=R,this.iconPositions=_,this.patternPositions=f}addImages(o,l,h,_){for(const f in o){const b=o[f],S={x:0,y:0,w:b.data.width+2*h,h:b.data.height+2*h};_.push(S),l[f]=new Jv(S,b,h),b.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(o,l,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(_=>o.hasImage(_,h)),o.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const _ in o.getUpdatedImages(h))this.patchUpdatedImage(this.iconPositions[_],o.getImage(_,h),l),this.patchUpdatedImage(this.patternPositions[_],o.getImage(_,h),l)}patchUpdatedImage(o,l,h){if(!o||!l||o.version===l.version)return;o.version=l.version;const[_,f]=o.tl;h.update(l.data,{position:{x:_,y:f}})}}xn(Jv,"ImagePosition"),xn(Qv,"ImageAtlas");const zg=1e20;function ow(u,o,l,h,_,f,b,S,E){for(let R=o;R<o+h;R++)sw(u,l*f+R,f,_,b,S,E);for(let R=l;R<l+_;R++)sw(u,R*f+o,1,h,b,S,E)}function sw(u,o,l,h,_,f,b){f[0]=0,b[0]=-zg,b[1]=zg,_[0]=u[o];for(let S=1,E=0,R=0;S<h;S++){_[S]=u[o+S*l];const x=S*S;do{const I=f[E];R=(_[S]-_[I]+x-I*I)/(S-I)/2}while(R<=b[E]&&--E>-1);E++,f[E]=S,b[E]=R,b[E+1]=zg}for(let S=0,E=0;S<h;S++){for(;b[E+1]<S;)E++;const R=f[E],x=S-R;u[o+S*l]=_[R]+x*x}}const e0={none:0,ideographs:1,all:2};class Ap{constructor(o,l,h){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=h,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o,l){this.urls[l]=o}getGlyphs(o,l,h){const _=[],f=this.urls[l]||Te.GLYPHS_URL;for(const b in o)for(const S of o[b])_.push({stack:b,id:S});vr(_,({stack:b,id:S},E)=>{let R=this.entries[b];R||(R=this.entries[b]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=R.glyphs[S];if(void 0!==x)return void E(null,{stack:b,id:S,glyph:x});if(x=this._tinySDF(R,b,S),x)return R.glyphs[S]=x,void E(null,{stack:b,id:S,glyph:x});const I=Math.floor(S/256);if(256*I>65535)return ji("glyphs > 65535 not supported"),void E(null,{stack:b,id:S,glyph:x});if(R.ranges[I])return void E(null,{stack:b,id:S,glyph:x});let A=R.requests[I];A||(A=R.requests[I]=[],Ap.loadGlyphRange(b,I,f,this.requestManager,(D,M)=>{if(M){R.ascender=M.ascender,R.descender=M.descender;for(const L in M.glyphs)this._doesCharSupportLocalGlyph(+L)||(R.glyphs[+L]=M.glyphs[+L]);R.ranges[I]=!0}for(const L of A)L(D,M);delete R.requests[I]})),A.push((D,M)=>{D?E(D):M&&E(null,{stack:b,id:S,glyph:M.glyphs[S]||null})})},(b,S)=>{if(b)h(b);else if(S){const E={};for(const{stack:R,id:x,glyph:I}of S)void 0===E[R]&&(E[R]={}),void 0===E[R].glyphs&&(E[R].glyphs={}),E[R].glyphs[x]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},E[R].ascender=this.entries[R].ascender,E[R].descender=this.entries[R].descender;h(null,E)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==e0.none&&(this.localGlyphMode===e0.all?!!this.localFontFamily:!!this.localFontFamily&&(Pn_CJK_Unified_Ideographs(o)||Pn_Hangul_Syllables(o)||Pn_Hiragana(o)||Pn_Katakana(o)||Pn_CJK_Symbols_and_Punctuation(o)||Pn_CJK_Unified_Ideographs_Extension_A(o)||Pn_CJK_Unified_Ideographs_Extension_B(o)||Pn_Osage(o)))}_tinySDF(o,l,h){const _=this.localFontFamily;if(!_||!this._doesCharSupportLocalGlyph(h))return;let f=o.tinySDF;if(!f){let L="400";/bold/i.test(l)?L="900":/medium/i.test(l)?L="500":/light/i.test(l)&&(L="200"),f=o.tinySDF=new Ap.TinySDF({fontFamily:_,fontWeight:L,fontSize:48,buffer:6,radius:16}),f.fontWeight=L}if(this.localGlyphs[f.fontWeight][h])return this.localGlyphs[f.fontWeight][h];const b=String.fromCodePoint(h),{data:S,width:E,height:R,glyphWidth:x,glyphHeight:I,glyphLeft:A,glyphTop:D,glyphAdvance:M}=f.draw(b);return this.localGlyphs[f.fontWeight][h]={id:h,bitmap:new ou({width:E,height:R},S),metrics:{width:x/2,height:I/2,left:A/2,top:D/2-27,advance:M/2,localGlyph:!0}}}}Ap.loadGlyphRange=function(u,o,l,h,_){const f=256*o,b=f+255,S=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",u).replace("{range}",`${f}-${b}`),Rh.Glyphs);md(S,(E,R)=>{if(E)_(E);else if(R){const x={},I=new zb(R).readFields(sr,{});for(const A of I.glyphs)x[A.id]=A;_(null,{glyphs:x,ascender:I.ascender,descender:I.descender})}})},Ap.TinySDF=class{constructor({fontSize:u=24,buffer:o=3,radius:l=8,cutoff:h=.25,fontFamily:_="sans-serif",fontWeight:f="normal",fontStyle:b="normal"}={}){this.buffer=o,this.cutoff=h,this.radius=l;const S=this.size=u+4*o,E=this._createCanvas(S),R=this.ctx=E.getContext("2d",{willReadFrequently:!0});R.font=`${b} ${f} ${u}px ${_}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(u){const o=document.createElement("canvas");return o.width=o.height=u,o}draw(u){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:_,actualBoundingBoxRight:f}=this.ctx.measureText(u),b=Math.ceil(l),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-_))),E=Math.min(this.size-this.buffer,b+Math.ceil(h)),R=S+2*this.buffer,x=E+2*this.buffer,I=Math.max(R*x,0),A=new Uint8ClampedArray(I),D={data:A,width:R,height:x,glyphWidth:S,glyphHeight:E,glyphTop:b,glyphLeft:0,glyphAdvance:o};if(0===S||0===E)return D;const{ctx:M,buffer:L,gridInner:N,gridOuter:V}=this;M.clearRect(L,L,S,E),M.fillText(u,L,L+b);const q=M.getImageData(L,L,S,E);V.fill(zg,0,I),N.fill(0,0,I);for(let $=0;$<E;$++)for(let U=0;U<S;U++){const Z=q.data[4*($*S+U)+3]/255;if(0===Z)continue;const Y=($+L)*R+U+L;if(1===Z)V[Y]=0,N[Y]=zg;else{const se=.5-Z;V[Y]=se>0?se*se:0,N[Y]=se<0?se*se:0}}ow(V,0,0,R,x,R,this.f,this.v,this.z),ow(N,L,L,S,E,R,this.f,this.v,this.z);for(let $=0;$<I;$++){const U=Math.sqrt(V[$])-Math.sqrt(N[$]);A[$]=Math.round(255-255*(U/this.radius+this.cutoff))}return D}};function t0(u,o,l,h,_=1){const f=[],b=u.imagePrimary,S=b.pixelRatio,E=b.paddedRect.w-2,R=b.paddedRect.h-2,x=(u.right-u.left)*_,I=(u.bottom-u.top)*_,A=b.stretchX||[[0,E]],D=b.stretchY||[[0,R]],M=(me,Me)=>me+Me[1]-Me[0],L=A.reduce(M,0),N=D.reduce(M,0),V=E-L,q=R-N;let $=0,U=L,Z=0,Y=N,se=0,ve=V,W=0,ce=q;if(b.content&&h){const me=b.content;$=Vg(A,0,me[0]),Z=Vg(D,0,me[1]),U=Vg(A,me[0],me[2]),Y=Vg(D,me[1],me[3]),se=me[0]-$,W=me[1]-Z,ve=me[2]-me[0]-U,ce=me[3]-me[1]-Y}const Se=(me,Me,Ne,ze)=>{const $e=n0(me.stretch-$,U,x,u.left*_),nt=nm(me.fixed-se,ve,me.stretch,L),st=n0(Me.stretch-Z,Y,I,u.top*_),Je=nm(Me.fixed-W,ce,Me.stretch,N),St=n0(Ne.stretch-$,U,x,u.left*_),$t=nm(Ne.fixed-se,ve,Ne.stretch,L),gt=n0(ze.stretch-Z,Y,I,u.top*_),gn=nm(ze.fixed-W,ce,ze.stretch,N),on=new jt($e,st),Kt=new jt(St,st),Ht=new jt(St,gt),Vn=new jt($e,gt),pn=new jt(nt/S,Je/S),Sn=new jt($t/S,gn/S),ii=o*Math.PI/180;if(ii){const Br=Math.sin(ii),Cr=Math.cos(ii),Xn=[Cr,-Br,Br,Cr];on._matMult(Xn),Kt._matMult(Xn),Vn._matMult(Xn),Ht._matMult(Xn)}const yi=me.stretch+me.fixed,xi=Ne.stretch+Ne.fixed,fi=Me.stretch+Me.fixed,Ri=ze.stretch+ze.fixed,Ii=u.imageSecondary;return{tl:on,tr:Kt,bl:Vn,br:Ht,texPrimary:{x:b.paddedRect.x+1+yi,y:b.paddedRect.y+1+fi,w:xi-yi,h:Ri-fi},texSecondary:Ii?{x:Ii.paddedRect.x+1+yi,y:Ii.paddedRect.y+1+fi,w:xi-yi,h:Ri-fi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pn,pixelOffsetBR:Sn,minFontScaleX:ve/S/x,minFontScaleY:ce/S/I,isSDF:l}};if(h&&(b.stretchX||b.stretchY)){const me=jb(A,V,L),Me=jb(D,q,N);for(let Ne=0;Ne<me.length-1;Ne++){const ze=me[Ne],$e=me[Ne+1];for(let nt=0;nt<Me.length-1;nt++)f.push(Se(ze,Me[nt],$e,Me[nt+1]))}}else f.push(Se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:R+1}));return f}function Vg(u,o,l){let h=0;for(const _ of u)h+=Math.max(o,Math.min(l,_[1]))-Math.max(o,Math.min(l,_[0]));return h}function jb(u,o,l){const h=[{fixed:-1,stretch:0}];for(const[_,f]of u){const b=h[h.length-1];h.push({fixed:_-b.stretch,stretch:b.stretch}),h.push({fixed:_-b.stretch,stretch:b.stretch+(f-_)})}return h.push({fixed:o+1,stretch:l}),h}function n0(u,o,l,h){return u/o*l+h}function nm(u,o,l,h){return u-o*l/h}function bD(u,o,l,h){const _=o+u.positionedLines[h].lineOffset;return 0===h?l+_/2:l+(_+(o+u.positionedLines[h-1].lineOffset))/2}function pR(u,o=1,l=!1){let h=1/0,_=1/0,f=-1/0,b=-1/0;const S=u[0];for(let D=0;D<S.length;D++){const M=S[D];(!D||M.x<h)&&(h=M.x),(!D||M.y<_)&&(_=M.y),(!D||M.x>f)&&(f=M.x),(!D||M.y>b)&&(b=M.y)}const E=Math.min(f-h,b-_);let R=E/2;const x=new fc([],le);if(0===E)return new jt(h,_);for(let D=h;D<f;D+=E)for(let M=_;M<b;M+=E)x.push(new Cc(D+R,M+R,R,u));let I=function(D){let M=0,L=0,N=0;const V=D[0];for(let q=0,$=V.length,U=$-1;q<$;U=q++){const Z=V[q],Y=V[U],se=Z.x*Y.y-Y.x*Z.y;L+=(Z.x+Y.x)*se,N+=(Z.y+Y.y)*se,M+=3*se}return new Cc(L/M,N/M,0,D)}(u),A=x.length;for(;x.length;){const D=x.pop();(D.d>I.d||!I.d)&&(I=D,l&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,A)),D.max-I.d<=o||(R=D.h/2,x.push(new Cc(D.p.x-R,D.p.y-R,R,u)),x.push(new Cc(D.p.x+R,D.p.y-R,R,u)),x.push(new Cc(D.p.x-R,D.p.y+R,R,u)),x.push(new Cc(D.p.x+R,D.p.y+R,R,u)),A+=4)}return l&&(console.log(`num probes: ${A}`),console.log(`best distance: ${I.d}`)),I.p}function le(u,o){return o.max-u.max}class Cc{constructor(o,l,h,_){this.p=new jt(o,l),this.h=h,this.d=function(f,b){let S=!1,E=1/0;for(let R=0;R<b.length;R++){const x=b[R];for(let I=0,A=x.length,D=A-1;I<A;D=I++){const M=x[I],L=x[D];M.y>f.y!=L.y>f.y&&f.x<(L.x-M.x)*(f.y-M.y)/(L.y-M.y)+M.x&&(S=!S),E=Math.min(E,Hn(f,M,L))}}return(S?1:-1)*Math.sqrt(E)}(this.p,_),this.max=this.d+this.h*Math.SQRT2}}const Ub=Number.POSITIVE_INFINITY,Hb=Math.sqrt(2);function rc(u,[o,l]){let h=0,_=0;if(l===Ub){o<0&&(o=0);const f=o/Hb;switch(u){case"top-right":case"top-left":_=f-7;break;case"bottom-right":case"bottom-left":_=7-f;break;case"bottom":_=7-o;break;case"top":_=o-7}switch(u){case"top-right":case"bottom-right":h=-f;break;case"top-left":case"bottom-left":h=f;break;case"left":h=o;break;case"right":h=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),u){case"top-right":case"top-left":case"top":_=l-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-l}switch(u){case"top-right":case"bottom-right":case"right":h=-o;break;case"top-left":case"bottom-left":case"left":h=o}}return[h,_]}function Gb(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function yD(u,o,l,h,_,f,b,S,E,R,x,I,A,D,M){let L=f.textMaxSize.evaluate(o,{},I);void 0===L?L=b*f.textScaleFactor:L*=f.textScaleFactor;const N=u.layers[0].layout,V=N.get("icon-offset").evaluate(o,{},I),q=r0(l.horizontal)||l.vertical,$="globe"===A.name,Z=b*f.textScaleFactor/24,Y=u.tilePixelRatio*L/24,se=(ze=u.overscaling,u.zoom>18&&ze>2&&(ze>>=1),Math.max(Jt/(512*ze),1)*N.get("symbol-spacing")),ve=N.get("text-padding")*u.tilePixelRatio,W=N.get("icon-padding")*u.tilePixelRatio,ce=ri(N.get("text-max-angle")),Se="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),me="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),Me=N.get("symbol-placement"),Ne=se/2;var ze;const $e=N.get("icon-text-fit").evaluate(o,{},I),nt=N.get("icon-text-fit-padding").evaluate(o,{},I),st="none"!==$e;let Je;!1===u.hasAnyIconTextFit&&st&&(u.hasAnyIconTextFit=!0),h&&st&&(u.allowVerticalPlacement&&l.vertical&&(Je=nw(h,l.vertical,$e,nt,V,Z)),q&&(h=nw(h,q,$e,nt,V,Z)));const St=($t,gt,gn)=>{if(gt.x<0||gt.x>=Jt||gt.y<0||gt.y>=Jt)return;let on=null;if($){const{x:Kt,y:Ht,z:Vn}=A.projectTilePoint(gt.x,gt.y,gn);on={anchor:new Jd(Kt,Ht,Vn,0,void 0),up:A.upVector(gn,gt.x,gt.y)}}!function(Kt,Ht,Vn,pn,Sn,ii,yi,xi,fi,Ri,Ii,Br,Cr,Xn,ar,hr,Kr,Mo,Ho,Ao,So,No,Jr,as,_r,Ka,Mc){const _a=Kt.addToLineVertexArray(Ht,pn);let Ac,vs,Hp,lh,fm,XD,Kn,eS=0,tS=0,nS=0,Gp=0,H0=-1,mm=-1;const Bl={};let ls=wa("");const gm=Vn?Vn.anchor:Ht,py="none"!==fi.layout.get("icon-text-fit").evaluate(So,{},_r);let fy=0,G0=0;if(void 0===fi._unevaluatedLayout.getValue("text-radial-offset")?[fy,G0]=fi.layout.get("text-offset").evaluate(So,{},_r).map(Ja=>24*Ja):(fy=24*fi.layout.get("text-radial-offset").evaluate(So,{},_r),G0=Ub),Kt.allowVerticalPlacement&&Sn.vertical){const Ja=Sn.vertical;if(ar)XD=aw(Ja),xi&&(Kn=aw(xi));else{const bl=fi.layout.get("text-rotate").evaluate(So,{},_r)+90;Hp=im(Ri,gm,Ht,Ii,Br,Cr,Ja,Xn,bl,hr),xi&&(lh=im(Ri,gm,Ht,Ii,Br,Cr,xi,Mo,bl))}}if(ii){const Ja=fi.layout.get("icon-rotate").evaluate(So,{},_r),bl=t0(ii,Ja,Jr,py,No.iconScaleFactor),_m=xi?t0(xi,Ja,Jr,py,No.iconScaleFactor):void 0;vs=im(Ri,gm,Ht,Ii,Br,Cr,ii,Mo,Ja),eS=4*bl.length;const rS=Kt.iconSizeData;let Rc=null;"source"===rS.kind?(Rc=[du*fi.layout.get("icon-size").evaluate(So,{},_r)*No.iconScaleFactor],Rc[0]>La&&ji(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Rp}. Reduce your "icon-size".`)):"composite"===rS.kind&&(Rc=[du*No.compositeIconSizes[0].evaluate(So,{},_r)*No.iconScaleFactor,du*No.compositeIconSizes[1].evaluate(So,{},_r)*No.iconScaleFactor],(Rc[0]>La||Rc[1]>La)&&ji(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Rp}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,bl,Rc,Ao,Ho,So,!1,Vn,Ht,_a.lineStartIndex,_a.lineLength,-1,as,_r,Ka,Mc),H0=Kt.icon.placedSymbolArray.length-1,_m&&(tS=4*_m.length,Kt.addSymbols(Kt.icon,_m,Rc,Ao,Ho,So,Ol.vertical,Vn,Ht,_a.lineStartIndex,_a.lineLength,-1,as,_r,Ka,Mc),mm=Kt.icon.placedSymbolArray.length-1)}for(const Ja in Sn.horizontal){const bl=Sn.horizontal[Ja];Ac||(ls=wa(bl.text),ar?fm=aw(bl):Ac=im(Ri,gm,Ht,Ii,Br,Cr,bl,Xn,fi.layout.get("text-rotate").evaluate(So,{},_r),hr));const _m=1===bl.positionedLines.length;if(nS+=qb(Kt,Vn,Ht,bl,yi,fi,ar,So,hr,_a,Sn.vertical?Ol.horizontal:Ol.horizontalOnly,_m?Object.keys(Sn.horizontal):[Ja],Bl,H0,No,as,_r,Ka),_m)break}Sn.vertical&&(Gp+=qb(Kt,Vn,Ht,Sn.vertical,yi,fi,ar,So,hr,_a,Ol.vertical,["vertical"],Bl,mm,No,as,_r,Ka));let nd=-1;const my=(Ja,bl)=>Ja?Math.max(Ja,bl):bl;nd=my(fm,nd),nd=my(XD,nd),nd=my(Kn,nd);const iS=nd>-1?1:0;Kt.glyphOffsetArray.length>=65535&&ji("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==So.sortKey&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,So.sortKey),Kt.symbolInstances.emplaceBack(Ht.x,Ht.y,gm.x,gm.y,gm.z,Bl.right>=0?Bl.right:-1,Bl.center>=0?Bl.center:-1,Bl.left>=0?Bl.left:-1,Bl.vertical>=0?Bl.vertical:-1,H0,mm,ls,void 0!==Ac?Ac:Kt.collisionBoxArray.length,void 0!==Ac?Ac+1:Kt.collisionBoxArray.length,void 0!==Hp?Hp:Kt.collisionBoxArray.length,void 0!==Hp?Hp+1:Kt.collisionBoxArray.length,void 0!==vs?vs:Kt.collisionBoxArray.length,void 0!==vs?vs+1:Kt.collisionBoxArray.length,lh||Kt.collisionBoxArray.length,lh?lh+1:Kt.collisionBoxArray.length,Ii,nS,Gp,eS,tS,iS,0,fy,G0,nd,0,py?1:0)}(u,gt,on,$t,l,h,_,Je,u.layers[0],u.collisionBoxArray,o.index,o.sourceLayerIndex,u.index,ve,Se,E,0,W,me,V,o,f,R,x,I,D,M)};if("line"===Me)for(const $t of rw(o.geometry,0,0,Jt,Jt)){const gt=_D($t,se,ce,l.vertical||q,h,24,Y,u.overscaling,Jt);for(const gn of gt)q&&lw(u,q.text,Ne,gn)||St($t,gn,I)}else if("line-center"===Me){for(const $t of o.geometry)if($t.length>1){const gt=hR($t,ce,l.vertical||q,h,24,Y);gt&&St($t,gt,I)}}else if("Polygon"===o.type)for(const $t of Pa(o.geometry,0)){const gt=pR($t,16);St($t[0],new Jd(gt.x,gt.y,0,0,void 0),I)}else if("LineString"===o.type)for(const $t of o.geometry)St($t,new Jd($t[0].x,$t[0].y,0,0,void 0),I);else if("Point"===o.type)for(const $t of o.geometry)for(const gt of $t)St([gt],new Jd(gt.x,gt.y,0,0,void 0),I)}const Rp=255,La=Rp*du;function qb(u,o,l,h,_,f,b,S,E,R,x,I,A,D,M,L,N,V){const q=function(Z,Y,se,ve,W,ce,Se,me){const Me=[];if(0===Y.positionedLines.length)return Me;const Ne=ve.layout.get("text-rotate").evaluate(ce,{})*Math.PI/180,ze=function(St){const $t=St[0],gt=St[1],gn=$t*gt;return gn>0?[$t,-gt]:gn<0?[-$t,gt]:0===$t?[gt,$t]:[gt,-$t]}(se);let $e=Math.abs(Y.top-Y.bottom);for(const St of Y.positionedLines)$e-=St.lineOffset;const nt=Y.positionedLines.length,st=$e/nt;let Je=Y.top-se[1];for(let St=0;St<nt;++St){const $t=Y.positionedLines[St];Je=bD(Y,st,Je,St);for(const gt of $t.positionedGlyphs){if(!gt.rect)continue;const gn=gt.rect||{};let on=4,Kt=!0,Ht=1,Vn=0;if(gt.imageName){const Ao=Se[gt.imageName];if(!Ao)continue;if(Ao.sdf){ji("SDF images are not supported in formatted text and will be ignored.");continue}Kt=!1,Ht=Ao.pixelRatio,on=1/Ht}const pn=(W||me)&&gt.vertical,Sn=gt.metrics.advance*gt.scale/2,ii=gt.metrics,yi=gt.rect;if(null===yi)continue;me&&Y.verticalizable&&(Vn=gt.imageName?Sn-gt.metrics.width*gt.scale/2:0);const xi=W?[gt.x+Sn,gt.y]:[0,0];let fi=[0,0],Ri=[0,0],Ii=!1;W||(pn?(Ri=[gt.x+Sn+ze[0],gt.y+ze[1]-Vn],Ii=!0):fi=[gt.x+Sn+se[0],gt.y+se[1]-Vn]);const Br=yi.w*gt.scale/(Ht*(gt.localGlyph?2:1)),Cr=yi.h*gt.scale/(Ht*(gt.localGlyph?2:1));let Xn,ar,hr,Kr;if(pn){const Ao=gt.y-Je,So=new jt(-Sn,Sn-Ao),No=-Math.PI/2,Jr=new jt(...Ri);Xn=new jt(-Sn+fi[0],fi[1]),Xn._rotateAround(No,So)._add(Jr),Xn.x+=-Ao+Sn,Xn.y-=(ii.left-on)*gt.scale;const as=gt.imageName?ii.advance*gt.scale:24*gt.scale,_r=String.fromCodePoint(gt.glyph);hD(_r)?Xn.x+=(1-on)*gt.scale:X1(_r)?Xn.x+=as-ii.height*gt.scale+(-on-1)*gt.scale:Xn.x+=gt.imageName||ii.width+2*on===yi.w&&ii.height+2*on===yi.h?(as-Cr)/2:(as-(ii.height+2*on)*gt.scale)/2,ar=new jt(Xn.x,Xn.y-Br),hr=new jt(Xn.x+Cr,Xn.y),Kr=new jt(Xn.x+Cr,Xn.y-Br)}else{const Ao=(ii.left-on)*gt.scale-Sn+fi[0],So=(-ii.top-on)*gt.scale+fi[1],No=Ao+Br,Jr=So+Cr;Xn=new jt(Ao,So),ar=new jt(No,So),hr=new jt(Ao,Jr),Kr=new jt(No,Jr)}if(Ne){let Ao;Ao=W?new jt(0,0):Ii?new jt(ze[0],ze[1]):new jt(se[0],se[1]),Xn._rotateAround(Ne,Ao),ar._rotateAround(Ne,Ao),hr._rotateAround(Ne,Ao),Kr._rotateAround(Ne,Ao)}const Mo=new jt(0,0),Ho=new jt(0,0);Me.push({tl:Xn,tr:ar,bl:hr,br:Kr,texPrimary:gn,texSecondary:void 0,writingMode:Y.writingMode,glyphOffset:xi,sectionIndex:gt.sectionIndex,isSDF:Kt,pixelOffsetTL:Mo,pixelOffsetBR:Ho,minFontScaleX:0,minFontScaleY:0})}}return Me}(0,h,E,f,b,S,_,u.allowVerticalPlacement),$=u.textSizeData;let U=null;"source"===$.kind?(U=[du*f.layout.get("text-size").evaluate(S,{},N)*M.textScaleFactor],U[0]>La&&ji(`${u.layerIds[0]}: Value for "text-size" is >= ${Rp}. Reduce your "text-size".`)):"composite"===$.kind&&(U=[du*M.compositeTextSizes[0].evaluate(S,{},N)*M.textScaleFactor,du*M.compositeTextSizes[1].evaluate(S,{},N)*M.textScaleFactor],(U[0]>La||U[1]>La)&&ji(`${u.layerIds[0]}: Value for "text-size" is >= ${Rp}. Reduce your "text-size".`)),u.addSymbols(u.text,q,U,E,b,S,x,o,l,R.lineStartIndex,R.lineLength,D,L,N,V,!1);for(const Z of I)A[Z]=u.text.placedSymbolArray.length-1;return 4*q.length}function r0(u){for(const o in u)return u[o];return null}function im(u,o,l,h,_,f,b,S,E,R){let x=b.top,I=b.bottom,A=b.left,D=b.right;const M=b.collisionPadding;if(M&&(A-=M[0],x-=M[1],D+=M[2],I+=M[3]),E){const L=new jt(A,x),N=new jt(D,x),V=new jt(A,I),q=new jt(D,I),$=ri(E);let U=new jt(0,0);R&&(U=new jt(R[0],R[1])),L._rotateAround($,U),N._rotateAround($,U),V._rotateAround($,U),q._rotateAround($,U),A=Math.min(L.x,N.x,V.x,q.x),D=Math.max(L.x,N.x,V.x,q.x),x=Math.min(L.y,N.y,V.y,q.y),I=Math.max(L.y,N.y,V.y,q.y)}return u.emplaceBack(o.x,o.y,o.z,l.x,l.y,A,x,D,I,S,h,_,f),u.length-1}function aw(u){u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const o=u.bottom-u.top;return o>0?Math.max(10,o):null}function lw(u,o,l,h){const _=u.compareText;if(o in _){const f=_[o];for(let b=f.length-1;b>=0;b--)if(h.dist(f[b])<l)return!0}else _[o]=[];return _[o].push(h),!1}function vD(u,o){const l=u.fovAboveCenter,h=u.elevation?u.elevation.getMinElevationBelowMSL()*o:0,_=(u._camera.position[2]*u.worldSize-h)/Math.cos(u._pitch),f=Math.sin(l)*_/Math.sin(Math.max(Math.PI/2-u._pitch-l,.01));let b=Math.sin(u._pitch)*f+_;const S=_*(1/u._horizonShift);return u.elevation&&0!==u.elevation.exaggeration()||(b*=1+Math.max(u.zoom-17,0)),Math.min(1.01*b,S)}function th(u,o){if(!o.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:o};const l=Math.pow(2,-u.z),h=u.x*l,_=(u.x+1)*l,f=u.y*l,b=(u.y+1)*l,S=pe(h),E=pe(_),R=be(f),x=be(b),I=o.project(S,R),A=o.project(E,R),D=o.project(E,x),M=o.project(S,x);let L=Math.min(I.x,A.x,D.x,M.x),N=Math.min(I.y,A.y,D.y,M.y),V=Math.max(I.x,A.x,D.x,M.x),q=Math.max(I.y,A.y,D.y,M.y);const $=l/16;function U(Y,se,ve,W,ce,Se){const me=(ve+ce)/2,Me=(W+Se)/2,Ne=o.project(pe(me),be(Me)),ze=Math.max(0,L-Ne.x,N-Ne.y,Ne.x-V,Ne.y-q);L=Math.min(L,Ne.x),V=Math.max(V,Ne.x),N=Math.min(N,Ne.y),q=Math.max(q,Ne.y),ze>$&&(U(Y,Ne,ve,W,me,Me),U(Ne,se,me,Me,ce,Se))}U(I,A,h,f,_,f),U(A,D,_,f,_,b),U(D,M,_,b,h,b),U(M,I,h,b,h,f),L-=$,N-=$,V+=$,q+=$;const Z=1/Math.max(V-L,q-N);return{scale:Z,x:L*Z,y:N*Z,x2:V*Z,y2:q*Z,projection:o}}function jg(u,{x:o,y:l},h=0){return new jt(((o-h)*u.scale-u.x)*Jt,(l*u.scale-u.y)*Jt)}const o0=ee.mat4.identity(new Float32Array(16));class hu{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new F(0,0)}projectTilePoint(o,l,h){return{x:o,y:l,z:0}}locationPoint(o,l,h=!0){return o._coordinatePoint(o.locationCoordinate(l),h)}pixelsPerMeter(o,l){return te(1,o)*l}pixelSpaceConversion(o,l,h){return 1}farthestPixelDistance(o){return vD(o,o.pixelsPerMeter)}pointCoordinate(o,l,h,_){const f=o.horizonLineFromTop(!1),b=new jt(l,Math.max(f,h));return o.rayIntersectionCoordinate(o.pointRayIntersection(b,_))}pointCoordinate3D(o,l,h){const _=new jt(l,h);if(o.elevation)return o.elevation.pointCoordinate(_);{const f=this.pointCoordinate(o,_.x,_.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(o,l){if(o.elevation&&o.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(o,l.x,l.y);const h=o.horizonLineFromTop();return l.y<h}createInversionMatrix(o,l){return o0}createTileMatrix(o,l,h){let _,f,b;const S=h.canonical,E=ee.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=th(S,this);_=1,f=R.x+h.wrap*R.scale,b=R.y,ee.mat4.scale(E,E,[_/R.scale,_/R.scale,o.pixelsPerMeter/l])}else _=l/o.zoomScale(S.z),f=(S.x+Math.pow(2,S.z)*h.wrap)*_,b=S.y*_;return ee.mat4.translate(E,E,[f,b,0]),ee.mat4.scale(E,E,[_/Jt,_/Jt,1]),E}upVector(o,l,h){return[0,0,1]}upVectorScale(o,l,h){return{metersToTile:1}}}class s0 extends hu{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,h]=this.parallels=o.parallels||[29.5,45.5],_=Math.sin(ri(l));this.n=(_+Math.sin(ri(h)))/2,this.c=1+_*(2*this.n-_),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:h,c:_,r0:f}=this,b=ri(o-this.center[0]),S=ri(l),E=Math.sqrt(_-2*h*Math.sin(S))/h;return{x:E*Math.sin(b*h),y:E*Math.cos(b*h)-f,z:0}}unproject(o,l){const{n:h,c:_,r0:f}=this,b=f+l;let S=Math.atan2(o,Math.abs(b))*Math.sign(b);b*h<0&&(S-=Math.PI*Math.sign(o)*Math.sign(b));const E=ri(this.center[0])*h;S=tr(S,-Math.PI-E,Math.PI-E);const R=Pt(Pe(S/h)+this.center[0],-180,180),x=Math.asin(Pt((_-(o*o+b*b)*h*h)/(2*h),-1,1)),I=Pt(Pe(x),-we,we);return new F(R,I)}}const $b=1.340264,Ug=-.081106,Hg=893e-6,Gg=.003796,Wb=Math.sqrt(3)/2;class cw extends hu{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const h=Math.asin(Wb*Math.sin(l)),_=h*h,f=_*_*_;return{x:.5*(o*Math.cos(h)/(Wb*($b+3*Ug*_+f*(7*Hg+9*Gg*_)))/Math.PI+.5),y:1-.5*(h*($b+Ug*_+f*(Hg+Gg*_))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,_=h*h,f=_*_*_;for(let x,I,A,D=0;D<12&&(I=h*($b+Ug*_+f*(Hg+Gg*_))-l,A=$b+3*Ug*_+f*(7*Hg+9*Gg*_),x=I/A,h=Pt(h-x,-Math.PI/3,Math.PI/3),_=h*h,f=_*_*_,!(Math.abs(x)<1e-12));++D);const b=Wb*o*($b+3*Ug*_+f*(7*Hg+9*Gg*_))/Math.cos(h),S=Math.asin(Math.sin(h)/Wb),E=Pt(180*b/Math.PI,-180,180),R=Pt(180*S/Math.PI,-we,we);return new F(E,R)}}class fR extends hu{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const h=360*(o-.5),_=Pt(360*(.5-l),-we,we);return new F(h,_)}}const rm=Math.PI/2;function a0(u){return Math.tan((rm+u)/2)}class uw extends hu{constructor(o){super(o),this.center=o.center||[0,30];const[l,h]=this.parallels=o.parallels||[30,30];let _=ri(l),f=ri(h);this.southernCenter=_+f<0,this.southernCenter&&(_=-_,f=-f);const b=Math.cos(_),S=a0(_);this.n=_===f?Math.sin(_):Math.log(b/Math.cos(f))/Math.log(a0(f)/S),this.f=b*Math.pow(a0(_),this.n)/this.n}project(o,l){l=ri(l),this.southernCenter&&(l=-l),o=ri(o-this.center[0]);const h=1e-6,{n:_,f}=this;f>0?l<-rm+h&&(l=-rm+h):l>rm-h&&(l=rm-h);const b=f/Math.pow(a0(l),_);let S=b*Math.sin(_*o),E=f-b*Math.cos(_*o);return S=.5*(S/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:S,y:this.southernCenter?E:1-E,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f:_}=this,f=_-l,b=Math.sign(f),S=Math.sign(h)*Math.sqrt(o*o+f*f);let E=Math.atan2(o,Math.abs(f))*b;f*h<0&&(E-=Math.PI*Math.sign(o)*b);const R=Pt(Pe(E/h)+this.center[0],-180,180),x=Pt(Pe(2*Math.atan(Math.pow(_/S,1/h))-rm),-we,we);return new F(R,this.southernCenter?-x:x)}}class l0 extends hu{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:K(o),y:ne(l),z:0}}unproject(o,l){const h=pe(o),_=be(l);return new F(h,_)}}const dw=ri(we);class c0 extends hu{project(o,l){const h=(l=ri(l))*l,_=h*h;return{x:.5*((o=ri(o))*(.8707-.131979*h+_*(_*(.003971*h-.001529*_)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+_*(.028874*h-.044475-.005916*_)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,_=25,f=0,b=h*h;do{b=h*h;const R=b*b;f=(h*(1.007226+b*(.015085+R*(.028874*b-.044475-.005916*R)))-l)/(1.007226+b*(.045255+R*(.259866*b-.311325-.005916*11*R))),h=Pt(h-f,-dw,dw)}while(Math.abs(f)>1e-6&&--_>0);b=h*h;const S=Pt(Pe(o/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),E=Pe(h);return new F(S,E)}}const xD=ri(we);class mR extends hu{project(o,l){l=ri(l),o=ri(o);const h=Math.cos(l),_=2/Math.PI,f=Math.acos(h*Math.cos(o/2)),b=Math.sin(f)/f,S=.5*(o*_+2*h*Math.sin(o/2)/b)||0,E=.5*(l+Math.sin(l)/b)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(o,l){let h=o=(2*o-.5)*Math.PI,_=l=(2*(1-l)-1)*Math.PI,f=25;const b=1e-6;let S=0,E=0;do{const R=Math.cos(_),x=Math.sin(_),I=2*x*R,A=x*x,D=R*R,M=Math.cos(h/2),L=Math.sin(h/2),N=2*M*L,V=L*L,q=1-D*M*M,$=q?1/q:0,U=q?Math.acos(R*M)*Math.sqrt(1/q):0,Z=.5*(2*U*R*L+2*h/Math.PI)-o,Y=.5*(U*x+_)-l,se=.5*$*(D*V+U*R*M*A)+1/Math.PI,ve=$*(N*I/4-U*x*L),W=.125*$*(I*L-U*x*D*N),ce=.5*$*(A*M+U*V*R)+.5,Se=ve*W-ce*se;S=(Y*ve-Z*ce)/Se,E=(Z*W-Y*se)/Se,h=Pt(h-S,-Math.PI,Math.PI),_=Pt(_-E,-xD,xD)}while((Math.abs(S)>b||Math.abs(E)>b)&&--f>0);return new F(Pe(h),Pe(_))}}class wD extends hu{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ri(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:h,cosPhi:_}=this;return{x:ri(o)*_*h+.5,y:-Math.sin(ri(l))/_*h+.5,z:0}}unproject(o,l){const{scale:h,cosPhi:_}=this,f=-(l-.5)/h,b=Pt(Pe((o-.5)/h)/_,-180,180),S=Math.asin(Pt(f*_,-1,1)),E=Pt(Pe(S),-we,we);return new F(b,E)}}class gR extends l0{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,h){const _=yg(o,l,h),f=hb(Hu(h));return ee.vec3.transformMat4(_,_,f),{x:_[0],y:_[1],z:_[2]}}locationPoint(o,l){const h=k(l.lat,l.lng),_=ee.vec3.normalize([],h),f=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude,b=te(1,0)*Jt*f;ee.vec3.scaleAndAdd(h,h,_,b);const S=ee.mat4.identity(new Float64Array(16));return ee.mat4.multiply(S,o.pixelMatrix,o.globeMatrix),ee.vec3.transformMat4(h,h,S),new jt(h[0],h[1])}pixelsPerMeter(o,l){return te(1,0)*l}pixelSpaceConversion(o,l,h){const _=te(1,o)*l,f=Wn(te(1,45)*l,_,h);return this.pixelsPerMeter(o,l)/f}createTileMatrix(o,l,h){const _=fv(Hu(h.canonical));return ee.mat4.multiply(new Float64Array(16),o.globeMatrix,_)}createInversionMatrix(o,l){const{center:h}=o,_=hb(Hu(l));return ee.mat4.rotateY(_,_,ri(h.lng)),ee.mat4.rotateX(_,_,ri(h.lat)),ee.mat4.scale(_,_,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(_)}pointCoordinate(o,l,h,_){return ru(o,l,h,!0)||new je(0,0)}pointCoordinate3D(o,l,h){const _=this.pointCoordinate(o,l,h,0);return[_.x,_.y,_.z]}isPointAboveHorizon(o,l){return!ru(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(_,f){const b=_.cameraToCenterDistance,S=_._centerAltitude*f,E=_._camera,R=_._camera.forward(),x=ee.vec3.add([],ee.vec3.scale([],R,-b),[0,0,S]),I=_.worldSize/(2*Math.PI),A=[0,0,-I],D=_.width/_.height,M=Math.tan(_.fovAboveCenter),L=ee.vec3.scale([],E.up(),M),N=ee.vec3.scale([],E.right(),M*D),V=ee.vec3.normalize([],ee.vec3.add([],ee.vec3.add([],R,L),N)),q=[];let $;if(new Ma(x,V).closestPointOnSphere(A,I,q)){const U=ee.vec3.add([],q,A),Z=ee.vec3.sub([],U,x);$=Math.cos(_.fovAboveCenter)*ee.vec3.length(Z)}else{const U=ee.vec3.sub([],x,A),Z=ee.vec3.sub([],A,x);ee.vec3.normalize(Z,Z);const Y=ee.vec3.length(U)-I;$=Math.sqrt(Y*(Y+2*I));const se=Math.acos($/(I+Y))-Math.acos(ee.vec3.dot(R,Z));$*=Math.cos(se)}return 1.01*$}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),h=Gu(o.zoom);if(h>0){const _=vD(o,te(1,o.center.lat)*o.worldSize),f=o.worldSize/(2*Math.PI),b=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Wn(l,_+f*(1-Math.cos(b)),Math.pow(h,10))}return l}upVector(o,l,h){return yg(l,h,o,1)}upVectorScale(o){return{metersToTile:$d(db(Hu(o)))}}}function SD(u){const o=u.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(u.name){case"mercator":return new l0(u);case"equirectangular":return new fR(u);case"naturalEarth":return new c0(u);case"equalEarth":return new cw(u);case"winkelTripel":return new mR(u);case"albers":return l?new wD(u):new s0(u);case"lambertConformalConic":return l?new wD(u):new uw(u);case"globe":return new gR(u)}throw new Error(`Invalid projection name: ${u.name}`)}const _R=Kf.VectorTileFeature.types,bR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function u0(u,o,l,h,_,f,b,S,E,R,x,I,A){const D=S?Math.min(La,Math.round(S[0])):0,M=S?Math.min(La,Math.round(S[1])):0;u.emplaceBack(o,l,Math.round(32*h),Math.round(32*_),f,b,(D<<1)+(E?1:0),M,16*R,16*x,256*I,256*A)}function d0(u,o,l){u.emplaceBack(o,l)}function h0(u,o,l,h,_,f,b){u.emplaceBack(o,l,h,_,f,b)}function Dc(u,o,l,h,_){u.emplaceBack(o,l,h,_),u.emplaceBack(o,l,h,_),u.emplaceBack(o,l,h,_),u.emplaceBack(o,l,h,_)}function p0(u){for(const o of u.sections)if(ng(o.text))return!0;return!1}class f0{constructor(o){this.layoutVertexArray=new jd,this.indexArray=new Nr,this.programConfigurations=o,this.segments=new Lo,this.dynamicLayoutVertexArray=new $a,this.opacityVertexArray=new ap,this.placedSymbolArray=new cp,this.iconTransitioningVertexArray=new nu,this.globeExtVertexArray=new wr,this.zOffsetVertexArray=new Pl}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(o,l,h,_,f){this.isEmpty()||(h&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,aD.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,Zu.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,bR,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=o.createVertexBuffer(this.iconTransitioningVertexArray,cD.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,tm.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,lD.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||_)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}xn(f0,"SymbolBuffers");class Xb{constructor(o,l,h){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new h,this.segments=new Lo,this.collisionVertexArray=new kl,this.collisionVertexArrayExt=new $a}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,cR.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,uR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}xn(Xb,"CollisionBuffers");class om{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.lut=o.lut,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(b=>b.fqid),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ee.mat4.identity([]),this.placementViewportMatrix=ee.mat4.identity([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nb(this.zoom,l["text-size"]),this.iconSizeData=Nb(this.zoom,l["icon-size"]);const h=this.layers[0].layout,_=h.get("symbol-sort-key"),f=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==_.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(b=>Ol[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=o.sourceID,this.projection=o.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=h.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new f0(new mt(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("text")||o.startsWith("symbol"))),this.icon=new f0(new mt(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("icon")||o.startsWith("symbol"))),this.glyphOffsetArray=new rb,this.lineVertexArray=new ia,this.symbolInstances=new ib}calculateGlyphDependencies(o,l,h,_,f){for(const b of o){const S=b.codePointAt(0);if(void 0===S)break;if(l[S]=!0,_&&f&&S<=65535){const E=Za[b];E&&(l[E.charCodeAt(0)]=!0)}}}updateFootprints(o,l){}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const h=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);return!kv(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}populate(o,l,h,_){const f=this.layers[0],b=f.layout,S="globe"===this.projection.name,E=b.get("text-font"),R=b.get("text-field"),x=b.get("icon-image"),I=("constant"!==R.value.kind||R.value.value instanceof Qs&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&("constant"!==E.value.kind||E.value.value.length>0),A="constant"!==x.value.kind||!!x.value.value||Object.keys(x.parameters).length>0,D=b.get("symbol-sort-key");if(this.features=[],!I&&!A)return;const M=l.iconDependencies,L=l.glyphDependencies,N=l.availableImages,V=new ao(this.zoom);for(const{feature:q,id:$,index:U,sourceLayerIndex:Z}of o){const Y=f._featureFilter.needGeometry,se=At(q,Y);if(!f._featureFilter.filter(V,se,h))continue;if(Y||(se.geometry=Ke(q,h,_)),S&&1!==q.type&&h.z<=5){const Se=se.geometry,me=.98078528056,Me=(Ne,ze)=>{const $e=yg(Ne.x,Ne.y,h,1),nt=yg(ze.x,ze.y,h,1);return ee.vec3.dot($e,nt)<me};for(let Ne=0;Ne<Se.length;Ne++)Se[Ne]=_t(Se[Ne],Me)}let ve,W;if(I){const Se=f.getValueAndResolveTokens("text-field",se,h,N),me=Qs.factory(Se);p0(me)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===og()||this.hasRTLText&&na.isParsed())&&(ve=dD(me,f,se))}if(A){const Se=f.getValueAndResolveTokens("icon-image",se,h,N);W=Se instanceof ea?Se:ea.fromString(Se)}if(!ve&&!W)continue;const ce=this.sortFeaturesByKey?D.evaluate(se,{},h):void 0;if(this.features.push({id:$,text:ve,icon:W,index:U,sourceLayerIndex:Z,geometry:se.geometry,properties:q.properties,type:_R[q.type],sortKey:ce}),W&&(M[W.namePrimary]=!0,W.nameSecondary&&(M[W.nameSecondary]=!0)),ve){const Se=E.evaluate(se,{},h).join(","),me="map"===b.get("text-rotation-alignment")&&"point"!==b.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ol.vertical)>=0;for(const Me of ve.sections)if(Me.image)M[Me.image.namePrimary]=!0;else{const Ne=Jm(ve.toString()),ze=Me.fontStack||Se,$e=L[ze]=L[ze]||{};this.calculateGlyphDependencies(Me.text,$e,me,this.allowVerticalPlacement,Ne)}}}"line"===b.get("symbol-placement")&&(this.features=function(q){const $={},U={},Z=[];let Y=0;function se(Se){Z.push(q[Se]),Y++}function ve(Se,me,Me){const Ne=U[Se];return delete U[Se],U[me]=Ne,Z[Ne].geometry[0].pop(),Z[Ne].geometry[0]=Z[Ne].geometry[0].concat(Me[0]),Ne}function W(Se,me,Me){const Ne=$[me];return delete $[me],$[Se]=Ne,Z[Ne].geometry[0].shift(),Z[Ne].geometry[0]=Me[0].concat(Z[Ne].geometry[0]),Ne}function ce(Se,me,Me){const Ne=Me?me[0][me[0].length-1]:me[0][0];return`${Se}:${Ne.x}:${Ne.y}`}for(let Se=0;Se<q.length;Se++){const me=q[Se],Me=me.geometry,Ne=me.text?me.text.toString():null;if(!Ne){se(Se);continue}const ze=ce(Ne,Me),$e=ce(Ne,Me,!0);if(ze in U&&$e in $&&U[ze]!==$[$e]){const nt=W(ze,$e,Me),st=ve(ze,$e,Z[nt].geometry);delete $[ze],delete U[$e],U[ce(Ne,Z[st].geometry,!0)]=st,Z[nt].geometry=null}else ze in U?ve(ze,$e,Me):$e in $?W(ze,$e,Me):(se(Se),$[ze]=Y-1,U[$e]=Y-1)}return Z.filter(Se=>Se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((q,$)=>q.sortKey-$.sortKey)}update(o,l,h,_,f){const b=0!==Object.keys(o).length;if(b&&!this.stateDependentLayers.length)return;const S=b?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(o,l,S,h,_,f),this.icon.programConfigurations.updatePaintArrays(o,l,S,h,_,f)}updateZOffset(){const o=(f,b,S)=>{h+=b,h>f.length&&f.resize(h);for(let E=-b;E<0;E++)f.emplace(E+h,S)},l=(f,b,S)=>{_+=b,_>f.length&&f.resize(_);for(let E=-b;E<0;E++)f.emplace(E+_,S)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,_=0;for(let f=0;f<this.symbolInstances.length;f++){const b=this.symbolInstances.get(f),{numHorizontalGlyphVertices:S,numVerticalGlyphVertices:E,numIconVertices:R}=b,x=b.zOffset,I=R>0;if((S>0||E>0)&&(o(this.text.zOffsetVertexArray,S,x),o(this.text.zOffsetVertexArray,E,x)),I){const{placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:D}=b;A>=0&&l(this.icon.zOffsetVertexArray,R,x),D>=0&&l(this.icon.zOffsetVertexArray,b.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=SD(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const h=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:_,y:f}of l)this.lineVertexArray.emplaceBack(_,f);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(o,l,h,_,f,b,S,E,R,x,I,A,D,M,L,N){const V=o.indexArray,q=o.layoutVertexArray,$=o.globeExtVertexArray,U=o.segments.prepareSegment(4*l.length,q,V,this.canOverlap?b.sortKey:void 0),Z=this.glyphOffsetArray.length,Y=U.vertexLength,se=this.allowVerticalPlacement&&S===Ol.vertical?Math.PI/2:0,ve=b.text&&b.text.sections;for(let ce=0;ce<l.length;ce++){const{tl:Se,tr:me,bl:Me,br:Ne,texPrimary:ze,texSecondary:$e,pixelOffsetTL:nt,pixelOffsetBR:st,minFontScaleX:Je,minFontScaleY:St,glyphOffset:$t,isSDF:gt,sectionIndex:gn}=l[ce],on=U.vertexLength,Kt=$t[1];if(u0(q,R.x,R.y,Se.x,Kt+Se.y,ze.x,ze.y,h,gt,nt.x,nt.y,Je,St),u0(q,R.x,R.y,me.x,Kt+me.y,ze.x+ze.w,ze.y,h,gt,st.x,nt.y,Je,St),u0(q,R.x,R.y,Me.x,Kt+Me.y,ze.x,ze.y+ze.h,h,gt,nt.x,st.y,Je,St),u0(q,R.x,R.y,Ne.x,Kt+Ne.y,ze.x+ze.w,ze.y+ze.h,h,gt,st.x,st.y,Je,St),E){const{x:Ht,y:Vn,z:pn}=E.anchor,[Sn,ii,yi]=E.up;h0($,Ht,Vn,pn,Sn,ii,yi),h0($,Ht,Vn,pn,Sn,ii,yi),h0($,Ht,Vn,pn,Sn,ii,yi),h0($,Ht,Vn,pn,Sn,ii,yi),Dc(o.dynamicLayoutVertexArray,Ht,Vn,pn,se)}else Dc(o.dynamicLayoutVertexArray,R.x,R.y,R.z,se);if(N){const Ht=$e||ze;d0(o.iconTransitioningVertexArray,Ht.x,Ht.y),d0(o.iconTransitioningVertexArray,Ht.x+Ht.w,Ht.y),d0(o.iconTransitioningVertexArray,Ht.x,Ht.y+Ht.h),d0(o.iconTransitioningVertexArray,Ht.x+Ht.w,Ht.y+Ht.h)}V.emplaceBack(on,on+1,on+2),V.emplaceBack(on+1,on+2,on+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($t[0]),ce!==l.length-1&&gn===l[ce+1].sectionIndex||o.programConfigurations.populatePaintArrays(q.length,b,b.index,{},D,M,L,ve&&ve[gn])}const W=E?E.anchor:R;o.placedSymbolArray.emplaceBack(W.x,W.y,W.z,R.x,R.y,Z,this.glyphOffsetArray.length-Z,Y,x,I,R.segment,h?h[0]:0,h?h[1]:0,_[0],_[1],S,0,!1,0,A,0)}_commitLayoutVertex(o,l,h,_,f,b,S){o.emplaceBack(l,h,_,f,b,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(o,l,h,_,f,b,S){const E=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),R=E.vertexLength,x=S.tileAnchorX,I=S.tileAnchorY;for(let D=0;D<4;D++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,l,o.padding,S.zOffset),this._commitLayoutVertex(h.layoutVertexArray,_,f,b,x,I,new jt(o.x1,o.y1)),this._commitLayoutVertex(h.layoutVertexArray,_,f,b,x,I,new jt(o.x2,o.y1)),this._commitLayoutVertex(h.layoutVertexArray,_,f,b,x,I,new jt(o.x2,o.y2)),this._commitLayoutVertex(h.layoutVertexArray,_,f,b,x,I,new jt(o.x1,o.y2)),E.vertexLength+=4;const A=h.indexArray;A.emplaceBack(R,R+1),A.emplaceBack(R+1,R+2),A.emplaceBack(R+2,R+3),A.emplaceBack(R+3,R),E.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,h,_,f,b){for(let S=_;S<f;S++){const E=h.get(S),R=this.getSymbolInstanceTextSize(o,b,l,S);this._addCollisionDebugVertices(E,R,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(o,l,h,_,f,b){for(let S=_;S<f;S++){const E=h.get(S),R=this.getSymbolInstanceIconSize(o,l,b.placedIconSymbolIndex);this._addCollisionDebugVertices(E,R,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,b)}}generateCollisionDebugBuffers(o,l,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xb(us,jv.members,nu),this.iconCollisionBox=new Xb(us,jv.members,nu);const _=Ep(this.iconSizeData,o),f=Ep(this.textSizeData,o,h);for(let b=0;b<this.symbolInstances.length;b++){const S=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(f,o,l,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(f,o,l,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(_,o,l,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(_,o,l,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(o,l,h,_){const f=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:_),b=Bb(this.textSizeData,o,f)/24;return this.tilePixelRatio*b}getSymbolInstanceIconSize(o,l,h){const _=this.icon.placedSymbolArray.get(h),f=Bb(this.iconSizeData,o,_);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(o,l,h,_){o.emplaceBack(l,-h,-h,_),o.emplaceBack(l,h,-h,_),o.emplaceBack(l,h,h,_),o.emplaceBack(l,-h,h,_)}_updateTextDebugCollisionBoxes(o,l,h,_,f,b,S){for(let E=_;E<f;E++){const R=h.get(E),x=this.getSymbolInstanceTextSize(o,b,l,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,R.padding,b.zOffset)}}_updateIconDebugCollisionBoxes(o,l,h,_,f,b,S){for(let E=_;E<f;E++){const R=h.get(E),x=this.getSymbolInstanceIconSize(o,l,b.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,R.padding,b.zOffset)}}updateCollisionDebugBuffers(o,l,h,_){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=Ep(this.iconSizeData,o,_),b=Ep(this.textSizeData,o,h);for(let S=0;S<this.symbolInstances.length;S++){const E=this.symbolInstances.get(S);this._updateTextDebugCollisionBoxes(b,o,l,E.textBoxStartIndex,E.textBoxEndIndex,E,h),this._updateTextDebugCollisionBoxes(b,o,l,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,h),this._updateIconDebugCollisionBoxes(f,o,l,E.iconBoxStartIndex,E.iconBoxEndIndex,E,_),this._updateIconDebugCollisionBoxes(f,o,l,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,_)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,h,_,f,b,S,E,R){const x={};if(l<h){const{x1:I,y1:A,x2:D,y2:M,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:U,featureIndex:Z}=o.get(l);x.textBox={x1:I,y1:A,x2:D,y2:M,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:U},x.textFeatureIndex=Z}if(_<f){const{x1:I,y1:A,x2:D,y2:M,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:U,featureIndex:Z}=o.get(_);x.verticalTextBox={x1:I,y1:A,x2:D,y2:M,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:U},x.verticalTextFeatureIndex=Z}if(b<S){const{x1:I,y1:A,x2:D,y2:M,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:U,featureIndex:Z}=o.get(b);x.iconBox={x1:I,y1:A,x2:D,y2:M,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:U},x.iconFeatureIndex=Z}if(E<R){const{x1:I,y1:A,x2:D,y2:M,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:U,featureIndex:Z}=o.get(E);x.verticalIconBox={x1:I,y1:A,x2:D,y2:M,padding:L,projectedAnchorX:N,projectedAnchorY:V,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:U},x.verticalIconFeatureIndex=Z}return x}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(o,l){const h=o.placedSymbolArray.get(l),_=h.vertexStartIndex+4*h.numGlyphs;for(let f=h.vertexStartIndex;f<_;f+=4)o.indexArray.emplaceBack(f,f+1,f+2),o.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),h=Math.cos(o),_=[],f=[],b=[];for(let S=0;S<this.symbolInstances.length;++S){b.push(S);const E=this.symbolInstances.get(S);_.push(0|Math.round(l*E.tileAnchorX+h*E.tileAnchorY)),f.push(E.featureIndex)}return b.sort((S,E)=>_[S]-_[E]||f[E]-f[S]),b}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let o=0;o<this.symbolInstances.length;++o)this.symbolInstanceIndexesSortedZOffset.push(o)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((o,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(o).zOffset)}addToSortKeyRanges(o,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:R}=h;_>=0&&this.addIndicesForPlacedSymbol(this.text,_),f>=0&&f!==_&&this.addIndicesForPlacedSymbol(this.text,f),b>=0&&b!==f&&b!==_&&this.addIndicesForPlacedSymbol(this.text,b),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let m0,Zb,g0;xn(om,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),om.addDynamicAttributes=Dc;class Yu{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:ms,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xn(Yu,"FormatSectionOverride",{omit:["defaultValue"]});const Yb=()=>g0||(g0={layout:m0||(m0=new Wr({"symbol-placement":new Xt(rt.layout_symbol["symbol-placement"]),"symbol-spacing":new Xt(rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xt(rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new On(rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xt(rt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Xt(rt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Xt(rt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Xt(rt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Xt(rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xt(rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xt(rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new On(rt.layout_symbol["icon-size"]),"icon-size-scale-range":new Xt(rt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new On(rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new On(rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new On(rt.layout_symbol["icon-image"]),"icon-rotate":new On(rt.layout_symbol["icon-rotate"]),"icon-padding":new Xt(rt.layout_symbol["icon-padding"]),"icon-keep-upright":new Xt(rt.layout_symbol["icon-keep-upright"]),"icon-offset":new On(rt.layout_symbol["icon-offset"]),"icon-anchor":new On(rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xt(rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xt(rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xt(rt.layout_symbol["text-rotation-alignment"]),"text-field":new On(rt.layout_symbol["text-field"]),"text-font":new On(rt.layout_symbol["text-font"]),"text-size":new On(rt.layout_symbol["text-size"]),"text-size-scale-range":new Xt(rt.layout_symbol["text-size-scale-range"]),"text-max-width":new On(rt.layout_symbol["text-max-width"]),"text-line-height":new On(rt.layout_symbol["text-line-height"]),"text-letter-spacing":new On(rt.layout_symbol["text-letter-spacing"]),"text-justify":new On(rt.layout_symbol["text-justify"]),"text-radial-offset":new On(rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xt(rt.layout_symbol["text-variable-anchor"]),"text-anchor":new On(rt.layout_symbol["text-anchor"]),"text-max-angle":new Xt(rt.layout_symbol["text-max-angle"]),"text-writing-mode":new Xt(rt.layout_symbol["text-writing-mode"]),"text-rotate":new On(rt.layout_symbol["text-rotate"]),"text-padding":new Xt(rt.layout_symbol["text-padding"]),"text-keep-upright":new Xt(rt.layout_symbol["text-keep-upright"]),"text-transform":new On(rt.layout_symbol["text-transform"]),"text-offset":new On(rt.layout_symbol["text-offset"]),"text-allow-overlap":new Xt(rt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Xt(rt.layout_symbol["text-ignore-placement"]),"text-optional":new Xt(rt.layout_symbol["text-optional"]),visibility:new Xt(rt.layout_symbol.visibility)})),paint:Zb||(Zb=new Wr({"icon-opacity":new On(rt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new On(rt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new On(rt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new On(rt.paint_symbol["text-emissive-strength"]),"icon-color":new On(rt.paint_symbol["icon-color"]),"icon-halo-color":new On(rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new On(rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new On(rt.paint_symbol["icon-halo-blur"]),"icon-translate":new Xt(rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xt(rt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new On(rt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new On(rt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new On(rt.paint_symbol["text-occlusion-opacity"]),"text-color":new On(rt.paint_symbol["text-color"],{runtimeType:ja,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new On(rt.paint_symbol["text-halo-color"]),"text-halo-width":new On(rt.paint_symbol["text-halo-width"]),"text-halo-blur":new On(rt.paint_symbol["text-halo-blur"]),"text-translate":new Xt(rt.paint_symbol["text-translate"]),"text-translate-anchor":new Xt(rt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Xt(rt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Xt(rt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Xt(rt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Xt(rt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new On(rt.paint_symbol["symbol-z-offset"])}))},g0);class Kb extends js{constructor(o,l,h,_){super(o,Yb(),l,h,_),this._colorAdjustmentMatrix=ee.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==o.paint&&("icon-occlusion-opacity"in o.paint||"text-occlusion-opacity"in o.paint)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const _=[];for(const f of h)_.indexOf(f)<0&&_.push(f);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(o,l,h,_){return this._saturation===o&&this._contrast===l&&this._brightnessMin===h&&this._brightnessMax===_||(this._colorAdjustmentMatrix=function(f,b,S,E){f=he(f),b=re(b);const R=ee.mat4.create(),x=f/3,I=1-2*x,A=[I,x,x,0,x,I,x,0,x,x,I,0,0,0,0,1],D=.5-.5*b,M=E-S;return ee.mat4.multiply(R,[M,0,0,0,0,M,0,0,0,0,M,0,S,S,S,1],[b,0,0,0,0,b,0,0,0,0,b,0,D,D,D,1]),ee.mat4.multiply(R,R,A),R}(o,l,h,_),this._saturation=o,this._contrast=l,this._brightnessMin=h,this._brightnessMax=_),this._colorAdjustmentMatrix}getValueAndResolveTokens(o,l,h,_){const f=this.layout.get(o).evaluate(l,{},h,_),b=this._unevaluatedLayout._values[o];return b.isDataDriven()||Rd(b.value)||!f?f:(S=l.properties,f.replace(/{([^{}]+)}/g,(R,x)=>x in S?String(S[x]):""));var S}createBucket(o){return new om(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of Yb().paint.overridableProperties){if(!Kb.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),h=new Yu(l),_=new Yh(h,l.property.specification,this.scope,this.options);let f=null;f="constant"===l.value.kind||"source"===l.value.kind?new Of("source",_):new Ff("composite",_,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new Od(l.property,f,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&Kb.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const h=o.get("text-field"),_=Yb().paint.properties[l];let f=!1;const b=S=>{for(const E of S)if(_.overrides&&_.overrides.hasOverride(E))return void(f=!0)};if("constant"===h.value.kind&&h.value.value instanceof Qs)b(h.value.value.sections);else if("source"===h.value.kind){const S=R=>{f||(R instanceof Ua&&Vo(R.value)===Lh?b(R.value.sections):R instanceof Uc?b(R.sections):R.eachChild(S))},E=h.value;E._styleExpression&&S(E._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(o,l,h){return{config:new Sc(this,{zoom:l,lut:h}),overrideFog:!1}}}let hw,_0,pw,fw;var sm=nr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function nh(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function qg(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class ih{constructor(o,l,h,_){this.context=o,this.format=h,this.useMipmap=_&&_.useMipmap,this.texture=o.gl.createTexture(),this.update(l,{premultiply:_&&_.premultiply})}update(o,l){const h=o&&o instanceof HTMLVideoElement&&0===o.width?o.videoWidth:o.width,_=o&&o instanceof HTMLVideoElement&&0===o.height?o.videoHeight:o.height,{context:f}=this,{gl:b}=f,{x:S,y:E}=l&&l.position?l.position:{x:0,y:0},R=Math.max(S+h,this.size?this.size[0]:0),x=Math.max(E+_,this.size?this.size[1]:0);!this.size||this.size[0]===R&&this.size[1]===x||(b.bindTexture(b.TEXTURE_2D,null),b.deleteTexture(this.texture),this.texture=b.createTexture(),this.size=null),b.bindTexture(b.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA8&&(!l||!1!==l.premultiply));const I=o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap;if(!this.size&&R>0&&x>0){const A=this.useMipmap?Math.floor(Math.log2(Math.max(R,x)))+1:1;b.texStorage2D(b.TEXTURE_2D,A,this.format,R,x),this.size=[R,x]}if(this.size)if(I)b.texSubImage2D(b.TEXTURE_2D,0,S,E,nh(this.format),qg(this.format),o);else{const A=o.data;A&&b.texSubImage2D(b.TEXTURE_2D,0,S,E,h,_,nh(this.format),qg(this.format),A)}this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(o,l,h=!1){const{context:_}=this,{gl:f}=_;f.bindTexture(f.TEXTURE_2D,this.texture),o!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!h?o===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),l!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(o,l,h,_){const{context:f}=this,{gl:b}=f;b.bindTexture(b.TEXTURE_2D,this.texture),l!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,l),this.magFilter=l),o!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?o===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),h!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),this.wrapS=h),_!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,_),this.wrapT=_)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class am{constructor(o,l){this.context=o,this.texture=l}bind(o,l){const{context:h}=this,{gl:_}=h;_.bindTexture(_.TEXTURE_2D,this.texture),o!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,o),this.minFilter=o),l!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,l),this.wrapS=l)}}function kp(u,o,l,h,_,f,b,S){const E=[u,o,1,l,h,1,_,f,1],R=[b,S,1],x=ee.mat3.adjoint([],E),[I,A,D]=ee.vec3.transformMat3(R,R,x);return ee.mat3.multiply(E,E,[I,0,0,0,A,0,0,0,D])}function b0(u,o,l,h,_,f,b,S){const E=function(R,x,I,A,D,M,L,N){const V=kp(0,0,1,0,1,1,0,1),q=kp(R,x,I,A,D,M,L,N),$=ee.mat3.adjoint([],V);return ee.mat3.multiply(q,q,$)}(u,o,l,h,_,f,b,S);return[E[2]/E[8]/Jt,E[5]/E[8]/Jt]}function $g(u){return[u[0],Math.min(Math.max(u[1],-we),we)]}class Jb extends ln{constructor(o,l,h,_){super(),this.id=o,this.dispatcher=h,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(_),this.options=l,this._dirty=!1}load(o,l){if(this._loaded=l||!1,this.fire(new dr("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return o&&(this.coordinates=o),this._loaded=!0,void this._finishLoading();this._imageRequest=ho(this.map._requestManager.transformRequest(this.url,Rh.Image),(h,_)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new Pi(h)):_&&(this.image=_ instanceof HTMLImageElement?hn.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}setTexture(o){if(!(o.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new am(this.map.painter.context,o.handle),this.width=o.dimensions[0],this.height=o.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new dr("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(o){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof am||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(o){if(this.coordinates=o,this._boundsArray=void 0,this._unsupportedCoords=!1,!o.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=o[0][1],h=o[0][1];for(const f of o)f[1]>h&&(h=f[1]),f[1]<l&&(l=f[1]);const _=(h+l)/2;if(_>we?this.onNorthPole=!0:_<-we&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=o.map(je.fromLngLat);this.tileID=function(b){let S=1/0,E=1/0,R=-1/0,x=-1/0;for(const L of b)S=Math.min(S,L.x),E=Math.min(E,L.y),R=Math.max(R,L.x),x=Math.max(x,L.y);const I=Math.max(R-S,x-E),A=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),D=Math.pow(2,A);let M=Math.floor((S+R)/2*D);return M>1&&(M-=1),new Fo(A,M,Math.floor((E+x)/2*D))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new dr("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(o){for(const V in this.tiles){const q=this.tiles[V];"loaded"!==q.state&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const l=th(new Fo(0,0,0),this.map.transform.projection),h=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){const q=V[1].x-V[0].x,$=V[1].y-V[0].y,U=V[2].x-V[1].x,Z=V[2].y-V[1].y,Y=V[3].x-V[2].x,se=V[3].y-V[2].y,ve=V[0].x-V[3].x,W=V[0].y-V[3].y,ce=q*Z-U*$,Se=U*se-Y*Z,me=Y*W-ve*se,Me=ve*$-q*W;return ce>0&&Se>0&&me>0&&Me>0||ce<0&&Se<0&&me<0&&Me<0}(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const _=th(this.tileID,this.map.transform.projection),[f,b,S,E]=this.coordinates.map(V=>{const q=_.projection.project(V[0],V[1]);return jg(_,q)._round()});this.perspectiveTransform=b0(f.x,f.y,b.x,b.y,S.x,S.y,E.x,E.y);const R=this._boundsArray=new Nu;R.emplaceBack(f.x,f.y,0,0),R.emplaceBack(b.x,b.y,Jt,0),R.emplaceBack(E.x,E.y,0,Jt),R.emplaceBack(S.x,S.y,Jt,Jt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=o.createVertexBuffer(R,sm.members),this.boundsSegments=Lo.simpleSegment(0,0,4,2);const x=[],I=[$g((A=this.coordinates)[0]),$g(A[1]),$g(A[2]),$g(A[3])];var A;const[D,M,L,N]=function(V){let q=V[0][0],$=q,U=V[0][1],Z=U;for(let Y=1;Y<V.length;Y++)V[Y][0]<q?q=V[Y][0]:V[Y][0]>$&&($=V[Y][0]),V[Y][1]<U?U=V[Y][1]:V[Y][1]>Z&&(Z=V[Y][1]);return[q,U,$-q,Z-U]}(I);{const V=new Nu,[q,$,U,Z]=function(nt){let st=nt[0].x,Je=st,St=nt[0].y,$t=St;for(let gt=1;gt<nt.length;gt++)nt[gt].x<st?st=nt[gt].x:nt[gt].x>Je&&(Je=nt[gt].x),nt[gt].y<St?St=nt[gt].y:nt[gt].y>$t&&($t=nt[gt].y);return[st,St,Je-st,$t-St]}(h),Y=nt=>[(nt.x-q)/U,(nt.y-$)/Z],[se,ve,W,ce]=h.map(Y),Se=function(nt,st,Je,St,$t,gt,gn,on){const Kt=kp(0,0,1,0,1,1,0,1),Ht=kp(nt,st,Je,St,$t,gt,gn,on),Vn=ee.mat3.adjoint([],Ht);return ee.mat3.multiply(Kt,Kt,Vn)}(se[0],se[1],ve[0],ve[1],W[0],W[1],ce[0],ce[1]);this.elevatedGlobePerspectiveTransform=b0(se[0],se[1],ve[0],ve[1],W[0],W[1],ce[0],ce[1]);const me=(nt,st)=>{x.push(nt.lng);const Je=Math.round((nt.lng-D)/L*Jt),St=Math.round((nt.lat-M)/N*Jt),$t=Y(st),gt=ee.vec3.transformMat3([],[$t[0],$t[1],1],Se),gn=Math.round(gt[0]/gt[2]*Jt),on=Math.round(gt[1]/gt[2]*Jt);V.emplaceBack(Je,St,gn,on)},Me=h[3].x-h[0].x,Ne=h[3].y-h[0].y,ze=h[2].x-h[1].x,$e=h[2].y-h[1].y;for(let nt=0;nt<65;nt++){const st=nt/64,Je=[h[0].x+st*Me,h[0].y+st*Ne],St=[h[1].x+st*ze,h[1].y+st*$e],$t=St[0]-Je[0],gt=St[1]-Je[1];for(let gn=0;gn<65;gn++){const on=gn/64,Kt={x:Je[0]+$t*on,y:Je[1]+gt*on,z:0};me(l.projection.unproject(Kt.x,Kt.y),Kt)}}this.elevatedGlobeVertexBuffer=o.createVertexBuffer(V,sm.members)}{this.maxLongitudeTriangleSize=0;let V=[],q=new Nr;const $=(U,Z,Y)=>{q.emplaceBack(U,Z,Y);const se=x[U],ve=x[Z],W=x[Y],ce=Math.min(Math.min(se,ve),W),Se=Math.max(Math.max(se,ve),W)-ce;Se>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Se),V.push(ce+Se/2)};for(let U=0;U<64;U++)for(let Z=0;Z<64;Z++){const Y=65*U+Z,se=Y+1,ve=Y+65,W=ve+1;$(Y,ve,se),$(se,ve,W)}[V,q]=function(U,Z){const Y=Array.from({length:U.length},(W,ce)=>ce);Y.sort((W,ce)=>U[W]-U[ce]);const se=[],ve=new Nr;for(let W=0;W<Y.length;W++){const ce=Y[W];se.push(U[ce]);const Se=3*ce,me=Se+1;ve.emplaceBack(Z.uint16[Se],Z.uint16[me],Z.uint16[me+1])}return[se,ve]}(V,q),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=o.createIndexBuffer(q)}this.elevatedGlobeSegments=Lo.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,L/Jt,0,N/Jt,0,0,M,D,0])}prepare(){const o=0!==Object.keys(this.tiles).length;if(this.tileID&&!o)return;const l=this.map.painter.context,h=l.gl;!this._dirty||this.texture instanceof am||(this.texture?this.texture.update(this.image):(this.texture=new ih(l,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),o&&this._prepareData(l)}loadTile(o,l){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},l(null)):(o.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(o){const l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let _=(f=o+180)+360*Math.round((h[0]-f)/360);var f;const b=new Lo,S=(I,A)=>{b.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:l.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-_)<=E){const I=ht(h,0,h.length,_+E);return I===h.length||S(I,Ah(h,I+1,h.length,_+360-E)-I),b}_<h[0]&&(_+=360);const R=Ah(h,0,h.length,_-E);if(R===h.length)return S(0,h.length),b;S(0,R-0);const x=ht(h,R+1,h.length,_+E);return x!==h.length&&S(x,h.length-x),b}}const y0=(Math.pow(256,2)-1)/16907520;class v0 extends js{constructor(o,l,h,_){super(o,{layout:pw||(pw=new Wr({visibility:new Xt(rt.layout_raster.visibility)})),paint:fw||(fw=new Wr({"raster-opacity":new Xt(rt.paint_raster["raster-opacity"]),"raster-color":new Nd(rt.paint_raster["raster-color"]),"raster-color-mix":new Xt(rt.paint_raster["raster-color-mix"]),"raster-color-range":new Xt(rt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Xt(rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xt(rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xt(rt.paint_raster["raster-brightness-max"]),"raster-saturation":new Xt(rt.paint_raster["raster-saturation"]),"raster-contrast":new Xt(rt.paint_raster["raster-contrast"]),"raster-resampling":new Xt(rt.paint_raster["raster-resampling"]),"raster-fade-duration":new Xt(rt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Xt(rt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Xt(rt.paint_raster["raster-array-band"]),"raster-elevation":new Xt(rt.paint_raster["raster-elevation"])}))},l,h,_),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(o){return!(o&&o._source instanceof Jb&&(o._source.onNorthPole||o._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(o){"raster-color"!==o&&"raster-color-range"!==o||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(o){if(!this.hasColorMap()||!this._curRampRange)return;const l=this._transitionablePaint._values["raster-color"].value.expression,[h,_]=o||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(_)||h===this._curRampRange[0]&&_===this._curRampRange[1]||(this.colorRamp=qu({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:_}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,_])}}let Qb,mw,TD,gw,x0;class _w extends js{constructor(o,l,h,_){super(o,{layout:Qb||(Qb=new Wr({visibility:new Xt(rt["layout_raster-particle"].visibility)})),paint:mw||(mw=new Wr({"raster-particle-array-band":new Xt(rt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Xt(rt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Nd(rt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Xt(rt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Xt(rt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Xt(rt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Xt(rt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Xt(rt["paint_raster-particle"]["raster-particle-elevation"])}))},l,h,_),this._updateColorRamp(),this.lastInvalidatedAt=hn.now()}onRemove(o){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(o){return!1}_handleSpecialPaintPropertyUpdate(o){"raster-particle-color"!==o&&"raster-particle-max-speed"!==o||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===o&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const o=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=qu({expression:o,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=hn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class bw extends js{constructor(o,l){super(o,{},l,null),this.implementation=o,o.slot&&(this.slot=o.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(o){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}function ey(u,o,l){const h=[0,0,1],_=ee.quat.identity([]);return ee.quat.rotateY(_,_,l?-ri(u)+Math.PI:ri(u)),ee.quat.rotateX(_,_,-ri(o)),ee.vec3.transformQuat(h,h,_),ee.vec3.normalize(h,h)}function yw(u,o){const l=Wg(u.projection,u.zoom,u.width,u.height),h=function(f,b,S,E,R){const x=new F(S.lng-180*rh,S.lat),I=new F(S.lng+180*rh,S.lat),A=f.project(x.lng,x.lat),D=f.project(I.lng,I.lat),M=-Math.atan2(D.y-A.y,D.x-A.x),L=je.fromLngLat(S);L.y=Pt(L.y,-1+rh,1-rh);const N=L.toLngLat(),V=f.project(N.lng,N.lat),q=je.fromLngLat(N);q.x+=rh;const $=q.toLngLat(),U=f.project($.lng,$.lat),Z=xw(U.x-V.x,U.y-V.y,M),Y=je.fromLngLat(N);Y.y+=rh;const se=Y.toLngLat(),ve=f.project(se.lng,se.lat),W=xw(ve.x-V.x,ve.y-V.y,M),ce=Math.abs(Z.x)/Math.abs(W.y),Se=ee.mat4.identity([]);ee.mat4.rotateZ(Se,Se,-M*(1-(R?0:E)));const me=ee.mat4.identity([]);return ee.mat4.scale(me,me,[1,1-(1-ce)*E,1]),me[4]=-W.x/W.y*E,ee.mat4.rotateZ(me,me,M),ee.mat4.multiply(me,Se,me),me}(u.projection,0,u.center,l,o),_=gl(u);return ee.mat4.scale(h,h,[_,_,1]),h}function gl(u){const o=u.projection,l=Wg(u.projection,u.zoom,u.width,u.height),h=vw(o,u.center),_=vw(o,F.convert(o.center));return Math.pow(2,h*l+(1-l)*_)}function Wg(u,o,l,h,_=1/0){const f=u.range;if(!f)return 0;const b=Math.min(_,Math.max(l,h)),S=Math.log(b/1024)/Math.LN2;return Tn(f[0]+S,f[1]+S,o)}const rh=1/4e4;function vw(u,o){const l=Pt(o.lat,-we,we),h=new F(o.lng-180*rh,l),_=new F(o.lng+180*rh,l),f=u.project(h.lng,l),b=u.project(_.lng,l),S=je.fromLngLat(h),E=je.fromLngLat(_),R=b.x-f.x,x=b.y-f.y,I=E.x-S.x,A=E.y-S.y,D=Math.sqrt((I*I+A*A)/(R*R+x*x));return Math.log(D)/Math.LN2}function xw(u,o,l){const h=Math.cos(l),_=Math.sin(l);return{x:u*h-o*_,y:u*_+o*h}}function ty(u,o,l){ee.mat4.identity(u),ee.mat4.rotateZ(u,u,ri(o[2])),ee.mat4.rotateX(u,u,ri(o[0])),ee.mat4.rotateY(u,u,ri(o[1])),ee.mat4.scale(u,u,l),ee.mat4.multiply(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Xg(u,o,l,h,_,f,b,S){const E=[l[0]-o[0],l[1]-o[1],0],R=[h[0]-o[0],h[1]-o[1],0];if(ee.vec3.length(E)<1e-12||ee.vec3.length(R)<1e-12)return ee.quat.identity(u);const x=ee.vec3.cross([],E,R);ee.vec3.normalize(x,x),ee.vec3.subtract(R,h,o),E[2]=(f-_)*S,R[2]=(b-_)*S;const I=E;return ee.vec3.cross(I,E,R),ee.vec3.normalize(I,I),ee.quat.rotationTo(u,x,I)}function w0(u,o,l=!1){const h=Gu(o.zoom),_=function(f,b,S){const E=b.worldSize,R=[f[12],f[13],f[14]],x=be(R[1]/E),I=pe(R[0]/E),A=ee.mat4.identity([]),D=te(1,x)*E,M=te(1,0)*E*Ce(x,b.zoom),L=1/mv(E);let N=M*L;if(S){const U=Wg(b.projection,b.zoom,b.width,b.height,1024);N=L*b.projection.pixelSpaceConversion(b.center.lat,E,U)}const V=k(x,I);ee.vec3.add(V,V,ee.vec3.scale([],ee.vec3.normalize([],V),D*N*R[2]));const q=function(U){const Z=[U[0],U[1],U[2]];let Y=[0,1,0];const se=ee.vec3.cross([],Y,Z);return ee.vec3.cross(Y,Z,se),0===ee.vec3.squaredLength(Y)&&(Y=[0,1,0],ee.vec3.cross(se,Z,Y)),ee.vec3.normalize(se,se),ee.vec3.normalize(Y,Y),ee.vec3.normalize(Z,Z),[se[0],se[1],se[2],0,Y[0],Y[1],Y[2],0,Z[0],Z[1],Z[2],0,U[0],U[1],U[2],1]}(V);ee.mat4.scale(A,A,[N,N,N*D]),ee.mat4.translate(A,A,[-R[0],-R[1],-R[2]]);const $=ee.mat4.multiply([],b.globeMatrix,q);return ee.mat4.multiply($,$,A),ee.mat4.multiply($,$,f),$}(u,o,l);return h>0?function(b,S,E){const R=(M,L,N)=>{const V=ee.vec3.length(M),q=ee.vec3.length(L),$=ml(M,L,N);return ee.vec3.scale($,$,1/ee.vec3.length($)*Wn(V,q,N))},x=R([b[0],b[1],b[2]],[S[0],S[1],S[2]],E),I=R([b[4],b[5],b[6]],[S[4],S[5],S[6]],E),A=R([b[8],b[9],b[10]],[S[8],S[9],S[10]],E),D=ml([b[12],b[13],b[14]],[S[12],S[13],S[14]],E);return[x[0],x[1],x[2],0,I[0],I[1],I[2],0,A[0],A[1],A[2],0,D[0],D[1],D[2],1]}(_,function(b,S){const E=S.worldSize,R=te(1,0)*E*Ce(S.center.lat,S.zoom)/mv(E),x=te(1,S.center.lat)*E,I=ee.mat4.identity([]);return ee.mat4.rotateY(I,I,ri(S.center.lng)),ee.mat4.rotateX(I,I,ri(S.center.lat)),ee.mat4.translate(I,I,[0,0,Us]),ee.mat4.scale(I,I,[R,R,R*x]),ee.mat4.translate(I,I,[S.point.x-.5*E,S.point.y-.5*E,0]),ee.mat4.multiply(I,I,b),ee.mat4.multiply(I,S.globeMatrix,I)}(u,o),h):_}function ww(u,o,l,h){const _=er.projectAabbCorners(h,l);let f=Number.MAX_VALUE,b=-1;for(let R=0;R<_.length;++R){const x=_[R];x[0]=(.5*x[0]+.5)*o.width,x[1]=(.5-.5*x[1])*o.height,x[2]<f&&(b=R,f=x[2])}const S=R=>new jt(_[R][0],_[R][1]);let E;switch(b){case 0:case 6:E=[S(1),S(5),S(4),S(7),S(3),S(2),S(1)];break;case 1:case 7:E=[S(0),S(4),S(5),S(6),S(2),S(3),S(0)];break;case 3:case 5:E=[S(1),S(0),S(4),S(7),S(6),S(2),S(1)];break;default:E=[S(1),S(5),S(6),S(7),S(3),S(0),S(1)]}if(It(u,E))return f}const CD=nr([{name:"a_pos_3f",components:3,type:"Float32"}]),Sw=nr([{name:"a_color_3f",components:3,type:"Float32"}]),DD=nr([{name:"a_color_4f",components:4,type:"Float32"}]),Tw=nr([{name:"a_uv_2f",components:2,type:"Float32"}]),ED=nr([{name:"a_normal_3f",components:3,type:"Float32"}]),ID=nr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Cw=nr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),S0={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class ny{constructor(o,l,h,_){this.message=(o?`${o}: `:"")+h,_&&(this.identifier=_),null!=l&&l.__line__&&(this.line=l.__line__)}}function Ec(u,o){const l=-1===u.indexOf("://");try{return new URL(u,l&&o?"http://example.com":void 0),!0}catch(h){return!1}}class iy{constructor(o,l){this.feature=o,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Dw{constructor(){this.instancedDataArray=new $f,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class T0{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=o.projection,this.index=o.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(o,l){}populate(o,l,h,_){this.tileToMeter=Le(h);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:b,id:S,index:E,sourceLayerIndex:R}of o){const x=null!=S?S:b.properties&&b.properties.hasOwnProperty("id")?b.properties.id:void 0,I=At(b,f);if(!this.layers[0]._featureFilter.filter(new ao(this.zoom),I,h))continue;const A={id:x,sourceLayerIndex:R,index:E,geometry:f?I.geometry:Ke(b,h,_),properties:b.properties,type:b.type,patterns:{}},D=this.addFeature(A,A.geometry,I);D&&l.featureIndex.insert(b,A.geometry,E,R,this.index,this.instancesPerModel[D].instancedDataArray.length,256)}this.lookup=null}update(o,l,h,_){for(const f in this.instancesPerModel){const b=this.instancesPerModel[f];for(const S in o)b.idToFeaturesIndex.hasOwnProperty(S)&&(this.evaluate(b.features[b.idToFeaturesIndex[S]],o[S],b,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let o=!1;for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];for(const _ of h.features){const f=this.layers[0],b=_.feature,S=this.canonical,E=f.paint.get("model-rotation").evaluate(b,{},S),R=f.paint.get("model-scale").evaluate(b,{},S),x=f.paint.get("model-translation").evaluate(b,{},S);ee.vec3.exactEquals(_.rotation,E)&&ee.vec3.exactEquals(_.scale,R)&&ee.vec3.exactEquals(_.translation,x)||(this.evaluate(_,_.featureStates,h,!0),o=!0)}}return o}updateReplacement(o,l,h,_){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const f=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);if(kv(this.activeReplacements,f))return!1;this.activeReplacements=f;let b=!1;for(const S in this.instancesPerModel){const E=this.instancesPerModel[S],R=E.instancedDataArray;for(const x of E.features){const I=x.instancedDataOffset,A=x.instancedDataCount;for(let D=0;D<A;D++){const M=16*(D+I);let L=R.float32[M+0];const N=L>Jt;L=N?L-Jt:L;const V=Math.floor(L),q=R.float32[M+1];let $=!1;for(const U of this.activeReplacements)if(!E1(U,h,S0.Model,_)&&!(U.min.x>V||V>U.max.x||U.min.y>q||q>U.max.y)&&($=eD(QC(V,q,o.canonical,U.footprintTileId.canonical),U.footprint),$))break;R.float32[M]=$?L+Jt:L,b=b||$!==N}}}return b}isEmpty(){for(const o in this.instancesPerModel)if(0!==this.instancesPerModel[o].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(o){if(!this.uploaded)for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];h.instancedDataArray.length<0||0===h.instancedDataArray.length||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=o.createVertexBuffer(h.instancedDataArray,ID.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];0!==h.instancedDataArray.length&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const o=this.layers[0].modelManager;if(o&&this.modelUris)for(const l of this.modelUris)o.removeModel(l,"")}addFeature(o,l,h){const _=this.layers[0],f=_.layout.get("model-id").evaluate(h,{},this.canonical);if(!f)return ji(`modelId is not evaluated for layer ${_.id} and it is not going to get rendered.`),f;Ec(f,!1)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new Dw);const b=this.instancesPerModel[f],S=b.instancedDataArray,E=new iy(h,S.length);for(const R of l)for(const x of R){if(x.x<0||x.x>=Jt||x.y<0||x.y>=Jt)continue;const I=(this.lookupDim-1)/Jt,A=this.lookupDim*(x.y*I|0)+x.x*I|0;if(this.lookup){if(0!==this.lookup[A])continue;this.lookup[A]=1}this.instanceCount++;const D=S.length;S.resize(D+1),b.instancesEvaluatedElevation.push(0),S.float32[16*D]=x.x,S.float32[16*D+1]=x.y}return E.instancedDataCount=b.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(o.id&&(b.idToFeaturesIndex[o.id]=b.features.length),b.features.push(E),this.evaluate(E,{},b,!1)),f}getModelUris(){return this.modelUris}evaluate(o,l,h,_){const f=this.layers[0],b=o.feature,S=this.canonical,E=o.rotation=f.paint.get("model-rotation").evaluate(b,l,S),R=o.scale=f.paint.get("model-scale").evaluate(b,l,S),x=o.translation=f.paint.get("model-translation").evaluate(b,l,S),I=f.paint.get("model-color").evaluate(b,l,S);I.a=f.paint.get("model-color-mix-intensity").evaluate(b,l,S);const A=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,R[0]),Math.max(R[1],R[2])),ty(A,E,R);const D=Math.round(100*I.a)+I.b/1.05;for(let M=0;M<o.instancedDataCount;++M){const L=o.instancedDataOffset+M,N=16*L,V=h.instancedDataArray.float32;let q=0;_&&(q=V[N+6]-h.instancesEvaluatedElevation[L]);const $=0|V[N+1];V[N]=(0|V[N])+I.r/1.05,V[N+1]=$+I.g/1.05,V[N+2]=D,V[N+3]=1/(S.z>10?this.tileToMeter:Le(S,$)),V[N+4]=x[0],V[N+5]=x[1],V[N+6]=x[2]+q,V[N+7]=A[0],V[N+8]=A[1],V[N+9]=A[2],V[N+10]=A[4],V[N+11]=A[5],V[N+12]=A[6],V[N+13]=A[8],V[N+14]=A[9],V[N+15]=A[10],h.instancesEvaluatedElevation[L]=x[2]}}}let MD,C0;xn(T0,"ModelBucket",{omit:["layers"]}),xn(Dw,"PerModelAttributes"),xn(iy,"ModelFeature");const lm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Ew(u,o,l,h,_,f,b,S,E,R=!1){const x=l.zoom,I=l.project(h),A=Ce(h.lat,x),D=1/A;ee.mat4.identity(u),ee.mat4.translate(u,u,[I.x+b[0]*D,I.y+b[1]*D,b[2]]);let M=1,L=1;const N=l.worldSize;if(R){if("mercator"===l.projection.name){let U=0;l.elevation&&(U=l.elevation.getAtPointOrZero(new je(I.x/N,I.y/N),0));const Z=ee.vec4.transformMat4([],[I.x,I.y,U,1],l.projMatrix)[3]/l.cameraToCenterDistance;M=Z,L=Z*Ce(l.center.lat,x)}else if("globe"===l.projection.name){const U=w0(u,l),Z=ee.mat4.multiply([],l.projMatrix,U),Y=[0,0,0,1];ee.vec4.transformMat4(Y,Y,Z);const se=Y[3]/l.cameraToCenterDistance,ve=Gu(x),W=l.projection.pixelsPerMeter(h.lat,N)*Ce(h.lat,x),ce=l.projection.pixelsPerMeter(l.center.lat,N)*Ce(l.center.lat,x);M=se/Wn(W,Ee(l.center.lat),ve),L=se*A/W,M*=ce,L*=ce}}else M=D;ee.mat4.scale(u,u,[M,M,L]);const V=[...u],q=o.orientation,$=[];if(ty($,[q[0]+_[0],q[1]+_[1],q[2]+_[2]],f),ee.mat4.multiply(u,V,$),S&&l.elevation){let U=0;const Z=[];if(E&&l.elevation){U=function(ve,W,ce,Se,me){const Me=W.elevation;if(!Me)return 0;const Ne=er.projectAabbCorners(ce,Se),ze=te(1,me.lat)*W.worldSize,$e=function(Vn,pn){const Sn=[0,0,1],ii=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const yi of ii){const xi=Vn[yi.corners[0]],fi=Vn[yi.corners[1]],Ri=Vn[yi.corners[2]],Ii=[fi[0]-xi[0],fi[1]-xi[1],pn*(fi[2]-xi[2])],Br=ee.vec3.cross(Ii,Ii,[Ri[0]-xi[0],Ri[1]-xi[1],pn*(Ri[2]-xi[2])]);ee.vec3.normalize(Br,Br),yi.dotProductWithUp=ee.vec3.dot(Br,Sn)}return ii.sort((yi,xi)=>yi.dotProductWithUp-xi.dotProductWithUp),ii[0].corners}(Ne,ze),nt=Ne[$e[0]],st=Ne[$e[1]],Je=Ne[$e[2]],St=Ne[$e[3]],$t=Me.getAtPointOrZero(new je(nt[0]/W.worldSize,nt[1]/W.worldSize),0),gt=Me.getAtPointOrZero(new je(st[0]/W.worldSize,st[1]/W.worldSize),0),gn=Me.getAtPointOrZero(new je(Je[0]/W.worldSize,Je[1]/W.worldSize),0),on=Me.getAtPointOrZero(new je(St[0]/W.worldSize,St[1]/W.worldSize),0),Kt=($t+on)/2,Ht=(gt+gn)/2;return Kt>Ht?gt<gn?Xg(ve,st,St,nt,gt,on,$t,ze):Xg(ve,Je,nt,St,gn,$t,on,ze):$t<on?Xg(ve,nt,st,Je,$t,gt,gn,ze):Xg(ve,St,Je,st,on,gn,gt,ze),Math.max(Kt,Ht)}(Z,l,o.aabb,u,h);const Y=ee.mat4.fromQuat([],Z),se=ee.mat4.multiply([],Y,$);ee.mat4.multiply(u,V,se)}else U=l.elevation.getAtPointOrZero(new je(I.x/N,I.y/N),0);0!==U&&(u[14]+=U)}}function Lp(u,o,l=!1){u.uploaded||(u.gfxTexture=new ih(o,u.image,l?o.gl.R8:o.gl.RGBA8,{useMipmap:u.sampler.minFilter>=o.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function AD(u,o,l){u.indexBuffer=o.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=o.createVertexBuffer(u.vertexArray,CD.members,!1,!0),u.normalArray&&(u.normalBuffer=o.createVertexBuffer(u.normalArray,ED.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=o.createVertexBuffer(u.texcoordArray,Tw.members,!1,!0)),u.colorArray&&(u.colorBuffer=o.createVertexBuffer(u.colorArray,(12===u.colorArray.bytesPerElement?Sw:DD).members,!1,!0)),u.featureArray&&(u.pbrBuffer=o.createVertexBuffer(u.featureArray,Cw.members,!0)),u.segments=Lo.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const h=u.material;h.pbrMetallicRoughness.baseColorTexture&&Lp(h.pbrMetallicRoughness.baseColorTexture,o),h.pbrMetallicRoughness.metallicRoughnessTexture&&Lp(h.pbrMetallicRoughness.metallicRoughnessTexture,o),h.normalTexture&&Lp(h.normalTexture,o),h.occlusionTexture&&Lp(h.occlusionTexture,o,l),h.emissionTexture&&Lp(h.emissionTexture,o)}function D0(u,o,l){if(u.meshes)for(const h of u.meshes)AD(h,o,l);if(u.children)for(const h of u.children)D0(h,o,l)}function Op(u){if(u.meshes)for(const o of u.meshes)o.indexArray.destroy(),o.vertexArray.destroy(),o.colorArray&&o.colorArray.destroy(),o.normalArray&&o.normalArray.destroy(),o.texcoordArray&&o.texcoordArray.destroy(),o.featureArray&&o.featureArray.destroy();if(u.children)for(const o of u.children)Op(o)}function Zg(u){if(u.meshes)for(const l of u.meshes)l.vertexBuffer&&(l.vertexBuffer.destroy(),l.indexBuffer.destroy(),l.normalBuffer&&l.normalBuffer.destroy(),l.texcoordBuffer&&l.texcoordBuffer.destroy(),l.colorBuffer&&l.colorBuffer.destroy(),l.pbrBuffer&&l.pbrBuffer.destroy(),l.segments.destroy(),l.material&&((o=l.material).pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()));var o;if(u.children)for(const l of u.children)Zg(l)}class Ku{constructor(o,l,h){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(o,l,h){const _=h||o.findDEMTileFor(l);if(!_||!_.dem)return;const f=_.dem,b=_.tileID,S=1<<l.canonical.z-b.canonical.z;return new Ku(_,f.dim/Jt/S,[(l.canonical.x/S-b.canonical.x)*f.dim,(l.canonical.y/S-b.canonical.y)*f.dim])}tileCoordToPixel(o,l){const h=l*this._scale+this._offset[1],_=Math.floor(o*this._scale+this._offset[0]),f=Math.floor(h);return new jt(_,f)}getElevationAt(o,l,h,_){const f=o*this._scale+this._offset[0],b=l*this._scale+this._offset[1],S=Math.floor(f),E=Math.floor(b),R=this._dem;return _=!!_,h?Wn(Wn(R.get(S,E,_),R.get(S,E+1,_),b-E),Wn(R.get(S+1,E,_),R.get(S+1,E+1,_),b-E),f-S):R.get(S,E,_)}getElevationAtPixel(o,l,h){return this._dem.get(o,l,!!h)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*te(1,o)*this._dem.stride}}const Iw=new Float32Array(262144),Ju=new Uint8Array(262144);function RD(u){let o=0;if(u.meshes)for(const l of u.meshes)o=Math.max(o,l.aabb.max[2]);if(u.children)for(const l of u.children)o=Math.max(o,RD(l));return o}function E0(u,o,l){if(u.meshes)for(const h of u.meshes){if(h.aabb.min[0]===1/0)continue;const _=er.applyTransform(h.aabb,u.matrix);l.insert(o,_.min[0],_.min[1],_.max[0],_.max[1])}if(u.children)for(const h of u.children)E0(h,o,l)}const I0=["","wall","door","roof","window","lamp","logo"];class M0{constructor(o){this.node=o,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:o.id,geometry:[],properties:{height:RD(o)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let o=0;const l=new er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==o&&(h.transformedAabb=er.applyTransformFast(h.aabb,this.node.matrix),l.encapsulate(h.transformedAabb)),o++;this.aabb=l}return this.aabb}}class Yg{constructor(o,l,h,_,f,b,S){this.id=h,this.layers=o,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=lm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,_&&(this.modelTraits|=lm.HasMapboxMeshFeatures),f&&(this.modelTraits|=lm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=b,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const E of l)this.nodesInfo.push(new M0(E)),E0(E,S.featureIndexArray.length,S.grid),S.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,S.bucketLayerIDs.length-1,0)}updateFootprints(o,l){for(const h of this.getNodesInfo()){const _=h.node;_.footprint&&l.push({footprint:_.footprint,id:o})}}update(o){const l=0!==Object.keys(o).length;if(l&&!this.stateDependentLayers.length)return;const h=l?this.stateDependentLayers:this.layers;for(const _ of h)this.evaluate(_,o)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(o){if(!this.needsUpload)return;const l=this.getNodesInfo();for(const h of l){const _=h.node;this.uploaded?this.updatePbrBuffer(_):D0(_,o,!0)}for(const h of l)Op(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(o){let l=!1;if(!o.meshes)return l;for(const h of o.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),l=!0);return l}needsReEvaluation(o,l,h){const _=o.transform.projectionOptions,f=o.style.getBrightness(),b=this.brightness!==f;return!!(!this.uploaded||this.dirty||_.name!==this.projection.name||Fp(h.paint.get("model-color").value,b)||Fp(h.paint.get("model-color-mix-intensity").value,b)||Fp(h.paint.get("model-roughness").value,b)||Fp(h.paint.get("model-emissive-strength").value,b)||Fp(h.paint.get("model-height-based-emissive-strength-multiplier").value,b))&&(this.projection=_,this.brightness=f,!0)}evaluateScale(o,l){if(o.transform.zoom===this.zoom)return;this.zoom=o.transform.zoom;const h=this.getNodesInfo(),_=this.id.canonical;for(const f of h){const b=f.feature;f.evaluatedScale=l.paint.get("model-scale").evaluate(b,{},_)}}evaluate(o,l){const h=this.getNodesInfo();for(const _ of h){if(!_.node.meshes)continue;const f=_.feature,b=l&&l[f.id],S=_.node.meshes&&_.node.meshes[0].featureData,E=_.evaluatedColor[2],R=_.evaluatedRMEA[2],x=this.id.canonical;if(_.hasTranslucentParts=!1,S){for(let I=0;I<I0.length;I++){const A=I0[I];A.length&&(f.properties.part=A);const D=o.paint.get("model-color").evaluate(f,b,x).toRenderColor(null),M=o.paint.get("model-color-mix-intensity").evaluate(f,b,x);_.evaluatedColor[I]=[D.r,D.g,D.b,M],_.evaluatedRMEA[I][0]=o.paint.get("model-roughness").evaluate(f,b,x),_.evaluatedRMEA[I][2]=o.paint.get("model-emissive-strength").evaluate(f,b,x),_.evaluatedRMEA[I][3]=D.a,_.emissionHeightBasedParams[I]=o.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,b,x),!_.hasTranslucentParts&&D.a<1&&(_.hasTranslucentParts=!0)}delete f.properties.part,ry(_,E!==_.evaluatedColor[2]||R!==_.evaluatedRMEA[2],this.modelTraits)}else _.evaluatedRMEA[0][2]=o.paint.get("model-emissive-strength").evaluate(f,b,x);_.evaluatedScale=o.paint.get("model-scale").evaluate(f,b,x),this.updatePbrBuffer(_.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(o,l,h,_){const f=o.findDEMTileFor(h);if(f&&(f.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const b=Ku.create(o,h,f);if(!b)return;this.modelTraits&lm.HasMapboxMeshFeatures&&this.updateDEM(o,b,h,_);for(const S of this.getNodesInfo()){const E=S.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const R=E.footprint.vertices;let x=b.getElevationAt(R[0].x,R[0].y,!0,!0);for(let I=1;I<R.length;I++)x=Math.min(x,b.getElevationAt(R[I].x,R[I].y,!0,!0));E.elevation=x}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=l}}updateDEM(o,l,h,_){let f=l._dem._modifiedForSources[_];if(void 0===f&&(l._dem._modifiedForSources[_]=[],f=l._dem._modifiedForSources[_]),f.includes(h.canonical))return;const b=l._dem.dim;f.push(h.canonical);let S=!1;for(const E of this.getNodesInfo()){const R=E.node;if(!R.footprint||!R.footprint.grid)continue;const x=R.footprint.grid,I=l.tileCoordToPixel(x.min.x,x.min.y),A=l.tileCoordToPixel(x.max.x,x.max.y),D=Math.min(Math.min(b-A.y,I.x),Math.min(I.y,b-A.x));if(D<0)continue;const M=Pt(D,2,5);let L=Math.max(0,I.x-M),N=Math.max(0,I.y-M),V=Math.min(A.x+M,b-1),q=Math.min(A.y+M,b-1);for(let Y=N;Y<=q;++Y)for(let se=L;se<=V;++se)Ju[Y*b+se]=255;let $=0,U=0;for(let Y=0;Y<x.cellsY;++Y)for(let se=0;se<x.cellsX;++se){if(!x.cells[Y*x.cellsX+se])continue;const ve=l.tileCoordToPixel(x.min.x+se/x.xScale,x.min.y+Y/x.yScale),W=l.tileCoordToPixel(x.min.x+(se+1)/x.xScale,x.min.y+(Y+1)/x.yScale);for(let ce=ve.y;ce<=Math.min(W.y+1,b-1);++ce)for(let Se=ve.x;Se<=Math.min(W.x+1,b-1);++Se)255===Ju[ce*b+Se]&&(Ju[ce*b+Se]=0,$+=l.getElevationAtPixel(Se,ce),U++)}const Z=$/U;L=Math.max(1,I.x-M),N=Math.max(1,I.y-M),V=Math.min(A.x+M,b-2),q=Math.min(A.y+M,b-2),S=!0;for(let Y=N;Y<=q;++Y)for(let se=L;se<=V;++se)0===Ju[Y*b+se]&&(Iw[Y*b+se]=l._dem.set(se,Y,Z));for(let Y=1;Y<M;++Y){L=Math.max(1,I.x-Y),N=Math.max(1,I.y-Y),V=Math.min(A.x+Y,b-2),q=Math.min(A.y+Y,b-2);for(let se=N;se<=q;++se)for(let ve=L;ve<=V;++ve){const W=se*b+ve;if(255===Ju[W]){let ce=0,Se=0,me=-1,Me=-1;for(let Ne=-1;Ne<=1;++Ne)for(let ze=-1;ze<=1;++ze){const $e=(se+Ne)*b+ve+ze;if(Ju[$e]>=Y)continue;const nt=Iw[$e],st=Math.abs(nt);st>Se&&(ce=nt,Se=st,me=ze,Me=Ne)}if(Se>.1){const Ne=1-(Y+.5*Math.abs(me*Me))/M;let ze=l._dem.get(ve,se)+ce*Ne;const $e=l._dem.get(ve+me,se+Me),nt=l._dem.get(ve-me,se-Me,!0);(ze-$e)*(ze-nt)>0&&(ze=($e+nt)/2),Iw[W]=l._dem.set(ve,se,ze),Ju[W]=Y}}}}}S&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=hn.now())}getNodesInfo(){return this.nodesInfo}destroy(){const o=this.getNodesInfo();for(const l of o)Op(l.node),Zg(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const h=l.getReplacementRegionsForTile(o.toUnwrapped()),_=this.getNodesInfo();for(let f=0;f<this.nodesInfo.length;f++){const b=_[f].node;_[f].hiddenByReplacement=!!b.footprint&&!h.find(S=>S.footprint===b.footprint)}}getHeightAtTileCoord(o,l){const h=this.getNodesInfo(),_=[],f=[0,0,0],b=ee.mat4.identity([]);for(let S=0;S<this.nodesInfo.length;S++){const E=h[S],R=E.node.meshes[0],x=R.transformedAabb;if(o<x.min[0]||l<x.min[1]||o>x.max[0]||l>x.max[1])continue;if(!0===E.node.hidden)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};ee.mat4.invert(b,E.node.matrix),f[0]=o,f[1]=l,ee.vec3.transformMat4(f,f,b);const I=(f[0]-R.aabb.min[0])/(R.aabb.max[0]-R.aabb.min[0])*64|0,A=64*Math.min(63,(f[1]-R.aabb.min[1])/(R.aabb.max[1]-R.aabb.min[1])*64|0)+Math.min(63,I),D=R.heightmap[A];if(!(D<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:D,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new jt(o,l),new jt(o,l),_),_.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function Fp(u,o){return!u.isLightConstant&&o}function Qu(u,o,l,h,_,f,b,S){let E=(61440&o|(61440&o)>>4)>>8,R=(3840&o|(3840&o)>>4)>>4,x=240&o|(240&o)>>4;l[3]>0&&(E=Wn(E,255*l[0],l[3]),R=Wn(R,255*l[1],l[3]),x=Wn(x,255*l[2],l[3]));const I=E<<8|R,A=x<<8|Math.floor(255*h[3]),D=function(Y){const se=Pt(Y,0,2);return Math.min(Math.round(.5*se*255),255)}(h[2])<<8|15*h[0]<<4|15*h[1],M=Pt(_[0],0,1),L=Pt(_[1],0,1),N=Pt(_[2],0,1),V=Pt(_[3],0,1);let q,$,U,Z;if(M!==L&&b!==f&&L!==M){const Y=b-f;$=1/(Y*(L-M)),U=-(f+Y*M)/(Y*(L-M));const se=Pt(_[4],-1,1);Z=Math.pow(10,se),q=255*N<<8|255*V}else q=65535,$=0,U=1,Z=1;if(u.emplaceBack(I,A,D,q,$,U,Z),S){const Y=S.length;S.clear();for(let se=0;se<Y;se++)S.emplaceBack(I,A,D,q,$,U,Z)}}function ry(u,o,l){const h=u.node;let _=0;const f=l&lm.HasMeshoptCompression;for(const b of h.meshes){if(h.lights&&h.lightMeshIndex===_||!b.featureData)continue;b.featureArray=new ug,b.featureArray.reserve(b.featureData.length);let S=o;for(const E of b.featureData){const R=f?65535&E:E>>16&65535,x=f?E>>16&65535:65535&E,I=(15&x)<8?15&x:0,A=u.evaluatedRMEA[I],D=u.evaluatedColor[I],M=u.emissionHeightBasedParams[I];let L;if(S&&2===I&&h.lights&&(L=new ug,L.resize(10*h.lights.length)),Qu(b.featureArray,R,D,A,M,b.aabb.min[2],b.aabb.max[2],L),L&&S){S=!1;const N=h.meshes[h.lightMeshIndex];N.featureArray=L,N.featureArray._trim()}}b.featureArray._trim(),_++}}xn(Yg,"Tiled3dModelBucket",{omit:["layers"]}),xn(M0,"Tiled3dModelFeature");const oy=["id","tile","layer","source","sourceLayer","state"];class ed{constructor(o,l,h,_,f){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=h,this._y=_,this.properties=o.properties,this.id=f}clone(){const o=new ed(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(o.state={...this.state}),this.layer&&(o.layer={...this.layer}),this.namespace&&(o.namespace=this.namespace),o}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const l of oy)void 0!==this[l]&&(o[l]=this[l]);return o}}function Mw(u,o,l,h){const _=1<<u.z;o.lat=be((h/Jt+u.y)/_),o.lng=pe((l/Jt+u.x)/_)}const A0={circle:class extends js{constructor(u,o,l,h){super(u,{layout:Ci||(Ci=new Wr({"circle-sort-key":new On(rt.layout_circle["circle-sort-key"]),visibility:new Xt(rt.layout_circle.visibility)})),paint:Gr||(Gr=new Wr({"circle-radius":new On(rt.paint_circle["circle-radius"]),"circle-color":new On(rt.paint_circle["circle-color"]),"circle-blur":new On(rt.paint_circle["circle-blur"]),"circle-opacity":new On(rt.paint_circle["circle-opacity"]),"circle-translate":new Xt(rt.paint_circle["circle-translate"]),"circle-translate-anchor":new Xt(rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xt(rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xt(rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new On(rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new On(rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new On(rt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Xt(rt.paint_circle["circle-emissive-strength"])}))},o,l,h)}createBucket(u){return new Vt(u)}queryRadius(u){const o=u;return Ar("circle-radius",this,o)+Ar("circle-stroke-width",this,o)+Ei(this.paint.get("circle-translate"))}queryIntersectsFeature(u,o,l,h,_,f,b,S){const E=yr(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return yv(u,h,f,b,S,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,R)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,o,l){const h=bv(this);return{config:new Sc(this,{zoom:o,lut:l}),defines:h,overrideFog:!1}}},heatmap:class extends js{createBucket(u){return new vv(u)}constructor(u,o,l,h){super(u,{layout:xv||(xv=new Wr({visibility:new Xt(rt.layout_heatmap.visibility)})),paint:wv||(wv=new Wr({"heatmap-radius":new On(rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new On(rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xt(rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Nd(rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xt(rt.paint_heatmap["heatmap-opacity"])}))},o,l,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){"heatmap-color"===u&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(u){return Ar("heatmap-radius",this,u)}queryIntersectsFeature(u,o,l,h,_,f,b,S){const E=this.paint.get("heatmap-radius").evaluate(o,l);return yv(u,h,f,b,S,!0,!0,new jt(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,o,l){return"heatmap"===u?{config:new Sc(this,{zoom:o,lut:l}),overrideFog:!1}:{}}},hillshade:class extends js{constructor(u,o,l,h){super(u,{layout:gb||(gb=new Wr({visibility:new Xt(rt.layout_hillshade.visibility)})),paint:Sv||(Sv=new Wr({"hillshade-illumination-direction":new Xt(rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xt(rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xt(rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xt(rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xt(rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xt(rt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Xt(rt.paint_hillshade["hillshade-emissive-strength"])}))},o,l,h)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,o,l){return{overrideFog:!1}}},fill:class extends js{constructor(u,o,l,h){super(u,{layout:f1||(f1=new Wr({"fill-sort-key":new On(rt.layout_fill["fill-sort-key"]),visibility:new Xt(rt.layout_fill.visibility),"fill-elevation-reference":new Xt(rt.layout_fill["fill-elevation-reference"])})),paint:m1||(m1=new Wr({"fill-antialias":new Xt(rt.paint_fill["fill-antialias"]),"fill-opacity":new On(rt.paint_fill["fill-opacity"]),"fill-color":new On(rt.paint_fill["fill-color"]),"fill-outline-color":new On(rt.paint_fill["fill-outline-color"]),"fill-translate":new Xt(rt.paint_fill["fill-translate"]),"fill-translate-anchor":new Xt(rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new On(rt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Xt(rt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new On(rt.paint_fill["fill-z-offset"])}))},o,l,h)}getProgramIds(){const u=this.paint.get("fill-pattern"),o=u&&u.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(u,o,l){return{config:new Sc(this,{zoom:o,lut:l}),overrideFog:!1}}recalculate(u,o){super.recalculate(u,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new Mv(u)}queryRadius(){return Ei(this.paint.get("fill-translate"))}queryIntersectsFeature(u,o,l,h,_,f){return!u.queryGeometry.isAboveHorizon&&An(Tr(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}is3D(){return 0!==this.paint.get("fill-z-offset").constantOr(1)}},"fill-extrusion":class extends js{constructor(u,o,l,h){super(u,{layout:z1||(z1=new Wr({visibility:new Xt(rt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Xt(rt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Pb||(Pb=new Wr({"fill-extrusion-opacity":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new On(rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new On(rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new On(rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new On(rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new On(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new On(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new On(rt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new On(rt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Xt(rt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},o,l,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new Tp(u)}queryRadius(){return Ei(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,o,l,h,_,f,b,S,E){const R=yr(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(o,l),I=this.paint.get("fill-extrusion-base").evaluate(o,l),A=[0,0],D=S&&f.elevation,M=f.elevation?f.elevation.exaggeration():1,L=u.tile.getBucket(this);if(D&&L instanceof Tp){const U=L.centroidVertexArray,Z=E+1;Z<U.length&&(A[0]=U.geta_centroid_pos0(Z),A[1]=U.geta_centroid_pos1(Z))}if(0===A[0]&&1===A[1])return!1;"globe"===f.projection.name&&(h=B1([h],[new jt(0,0),new jt(Jt,Jt)],u.tileID.canonical).map(U=>U.polygon).flat());const N=D?S:null,[V,q]=(Z=h,Y=I,se=x,ve=R,W=b,ce=N,Se=A,me=M,Me=f.center.lat,"globe"===(U=f).projection.name?function(ze,$e,nt,st,Je,St,$t,gt,gn,on,Kt){const Ht=[],Vn=[],pn=ze.projection.upVectorScale(Kt,ze.center.lat,ze.worldSize).metersToTile,Sn=[0,0,0,1],ii=[0,0,0,1],yi=(fi,Ri,Ii,Br)=>{fi[0]=Ri,fi[1]=Ii,fi[2]=Br,fi[3]=1},xi=N1();nt>0&&(nt+=xi),st+=xi;for(const fi of $e){const Ri=[],Ii=[];for(const Br of fi){const Cr=Br.x+Je.x,Xn=Br.y+Je.y,ar=ze.projection.projectTilePoint(Cr,Xn,Kt),hr=ze.projection.upVector(Kt,Br.x,Br.y);let Kr=nt,Mo=st;if($t){const Ho=V1(Cr,Xn,nt,st,$t,gt,gn,on);Kr+=Ho.base,Mo+=Ho.top}0!==nt?yi(Sn,ar.x+hr[0]*pn*Kr,ar.y+hr[1]*pn*Kr,ar.z+hr[2]*pn*Kr):yi(Sn,ar.x,ar.y,ar.z),yi(ii,ar.x+hr[0]*pn*Mo,ar.y+hr[1]*pn*Mo,ar.z+hr[2]*pn*Mo),ee.vec3.transformMat4(Sn,Sn,St),ee.vec3.transformMat4(ii,ii,St),Ri.push(new Zd(Sn[0],Sn[1],Sn[2])),Ii.push(new Zd(ii[0],ii[1],ii[2]))}Ht.push(Ri),Vn.push(Ii)}return[Ht,Vn]}(U,Z,Y,se,ve,W,ce,Se,me,Me,u.tileID.canonical):ce?function(ze,$e,nt,st,Je,St,$t,gt,gn){const on=[],Kt=[],Ht=[0,0,0,1];for(const Vn of ze){const pn=[],Sn=[];for(const ii of Vn){const yi=ii.x+st.x,xi=ii.y+st.y,fi=V1(yi,xi,$e,nt,St,$t,gt,gn);Ht[0]=yi,Ht[1]=xi,Ht[2]=fi.base,Ht[3]=1,ee.vec4.transformMat4(Ht,Ht,Je),Ht[3]=Math.max(Ht[3],1e-5);const Ri=new Zd(Ht[0]/Ht[3],Ht[1]/Ht[3],Ht[2]/Ht[3]);Ht[0]=yi,Ht[1]=xi,Ht[2]=fi.top,Ht[3]=1,ee.vec4.transformMat4(Ht,Ht,Je),Ht[3]=Math.max(Ht[3],1e-5);const Ii=new Zd(Ht[0]/Ht[3],Ht[1]/Ht[3],Ht[2]/Ht[3]);pn.push(Ri),Sn.push(Ii)}on.push(pn),Kt.push(Sn)}return[on,Kt]}(Z,Y,se,ve,W,ce,Se,me,Me):function(ze,$e,nt,st,Je){const St=[],$t=[],gt=Je[8]*$e,gn=Je[9]*$e,on=Je[10]*$e,Kt=Je[11]*$e,Ht=Je[8]*nt,Vn=Je[9]*nt,pn=Je[10]*nt,Sn=Je[11]*nt;for(const ii of ze){const yi=[],xi=[];for(const fi of ii){const Ri=fi.x+st.x,Ii=fi.y+st.y,Br=Je[0]*Ri+Je[4]*Ii+Je[12],Cr=Je[1]*Ri+Je[5]*Ii+Je[13],Xn=Je[2]*Ri+Je[6]*Ii+Je[14],ar=Je[3]*Ri+Je[7]*Ii+Je[15],hr=Br+gt,Kr=Cr+gn,Mo=Xn+on,Ho=Math.max(ar+Kt,1e-5),Ao=Br+Ht,So=Cr+Vn,No=Xn+pn,Jr=Math.max(ar+Sn,1e-5);yi.push(new Zd(hr/Ho,Kr/Ho,Mo/Ho)),xi.push(new Zd(Ao/Jr,So/Jr,No/Jr))}St.push(yi),$t.push(xi)}return[St,$t]}(Z,Y,se,ve,W)),$=u.queryGeometry;var U,Z,Y,se,ve,W,ce,Se,me,Me;return function(U,Z,Y){let se=1/0;An(Y,Z)&&(se=Nv(Y,Z[0]));for(let ve=0;ve<Z.length;ve++){const W=Z[ve],ce=U[ve];for(let Se=0;Se<W.length-1;Se++){const me=W[Se],Me=[me,W[Se+1],ce[Se+1],ce[Se],me];It(Y,Me)&&(se=Math.min(se,Nv(Y,Me)))}}return se!==1/0&&se}(V,q,$.isPointQuery()?$.screenBounds:$.screenGeometry)}},line:class extends js{constructor(u,o,l,h){const _=$1();super(u,_,o,l,h),_.layout&&(this.layout=new Fd(_.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(u){if("line-gradient"===u){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof If,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,o){super.recalculate(u,o),this.paint._values["line-floorwidth"]=(()=>{if(Fg)return Fg;const l=$1();return Fg=new sD(l.paint.properties["line-width"].specification),Fg.useIntegerZoom=!0,Fg})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new Bv(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,o,l){const h=Xu(this);return{config:new Sc(this,{zoom:o,lut:l}),defines:h,overrideFog:!1}}queryRadius(u){const o=u,l=W1(Ar("line-width",this,o),Ar("line-gap-width",this,o)),h=Ar("line-offset",this,o);return l/2+Math.abs(h)+Ei(this.paint.get("line-translate"))}queryIntersectsFeature(u,o,l,h,_,f){if(u.queryGeometry.isAboveHorizon)return!1;const b=Tr(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),S=u.pixelToTileUnitsFactor/2*W1(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),E=this.paint.get("line-offset").evaluate(o,l);return E&&(h=function(R,x){const I=[],A=new jt(0,0);for(let D=0;D<R.length;D++){const M=R[D],L=[];for(let N=0;N<M.length;N++){const V=M[N],q=M[N+1],$=0===N?A:V.sub(M[N-1])._unit()._perp(),U=N===M.length-1?A:q.sub(V)._unit()._perp(),Z=$._add(U)._unit();Z._mult(1/(Z.x*U.x+Z.y*U.y)),L.push(Z._mult(x)._add(V))}I.push(L)}return I}(h,E*u.pixelToTileUnitsFactor)),function(R,x,I){for(let A=0;A<x.length;A++){const D=x[A];if(R.length>=3)for(let M=0;M<D.length;M++)if(Bi(R,D[M]))return!0;if(Nn(R,D,I))return!0}return!1}(b,h,S)}isTileClipped(){return!0}isDraped(u){const o=this.layout.get("line-z-offset"),l=o.isConstant()&&!o.constantOr(0),h=this.layout.get("line-elevation-reference");return!("sea"===h||"ground"===h)&&(l||"none"!==h)}},symbol:Kb,background:class extends js{constructor(u,o,l,h){super(u,{layout:hw||(hw=new Wr({visibility:new Xt(rt.layout_background.visibility)})),paint:_0||(_0=new Wr({"background-pitch-alignment":new Xt(rt.paint_background["background-pitch-alignment"]),"background-color":new Xt(rt.paint_background["background-color"]),"background-pattern":new Xt(rt.paint_background["background-pattern"]),"background-opacity":new Xt(rt.paint_background["background-opacity"]),"background-emissive-strength":new Xt(rt.paint_background["background-emissive-strength"])}))},o,l,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,o,l){return{overrideFog:!1}}is3D(){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:v0,"raster-particle":_w,sky:class extends js{constructor(u,o,l,h){super(u,{layout:TD||(TD=new Wr({visibility:new Xt(rt.layout_sky.visibility)})),paint:gw||(gw=new Wr({"sky-type":new Xt(rt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Xt(rt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Xt(rt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Xt(rt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Xt(rt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Nd(rt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Xt(rt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Xt(rt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Xt(rt.paint_sky["sky-opacity"])}))},o,l,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){"sky-gradient"===u?this._updateColorRamp():"sky-atmosphere-sun"!==u&&"sky-atmosphere-halo-color"!==u&&"sky-atmosphere-color"!==u&&"sky-atmosphere-sun-intensity"!==u||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=qu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(u,o){if("atmosphere"===this.paint.get("sky-type")){const h=this.paint.get("sky-atmosphere-sun"),_=!h,f=u.style.light,b=f.properties.get("position");return _&&"viewport"===f.properties.get("anchor")&&ji("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),_?ey(b.azimuthal,90-b.polar,o):ey(h[0],90-h[1],o)}const l=this.paint.get("sky-gradient-center");return ey(l[0],90-l[1],o)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return"atmosphere"===u?["skyboxCapture","skybox"]:"gradient"===u?["skyboxGradient"]:null}},slot:class extends js{constructor(u,o,l,h){super(u,{paint:x0||(x0=new Wr({}))},o,null)}},model:class extends js{constructor(u,o,l,h){super(u,{layout:MD||(MD=new Wr({visibility:new Xt(rt.layout_model.visibility),"model-id":new On(rt.layout_model["model-id"])})),paint:C0||(C0=new Wr({"model-opacity":new Xt(rt.paint_model["model-opacity"]),"model-rotation":new On(rt.paint_model["model-rotation"]),"model-scale":new On(rt.paint_model["model-scale"]),"model-translation":new On(rt.paint_model["model-translation"]),"model-color":new On(rt.paint_model["model-color"]),"model-color-mix-intensity":new On(rt.paint_model["model-color-mix-intensity"]),"model-type":new Xt(rt.paint_model["model-type"]),"model-cast-shadows":new Xt(rt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Xt(rt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Xt(rt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new On(rt.paint_model["model-emissive-strength"]),"model-roughness":new On(rt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new On(rt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Xt(rt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Xt(rt.paint_model["model-front-cutoff"])}))},o,l,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new T0(u)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof Yg?8191:0}queryIntersectsFeature(u,o,l,h,_,f){if(!this.modelManager)return!1;const b=this.modelManager,S=u.tile.getBucket(this);if(!(S&&S instanceof T0))return!1;const E=S;for(const R in E.instancesPerModel){const x=E.instancesPerModel[R],I=void 0!==o.id?o.id:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0;if(x.idToFeaturesIndex.hasOwnProperty(I)){const A=x.features[x.idToFeaturesIndex[I]],D=b.getModel(R,this.scope);if(!D)return!1;let M=ee.mat4.create();const L=new F(0,0),N=E.canonical;let V=Number.MAX_VALUE;for(let q=0;q<A.instancedDataCount;++q){const $=16*(A.instancedDataOffset+q),U=x.instancedDataArray.float32,Z=[U[$+4],U[$+5],U[$+6]];Mw(N,L,U[$],0|U[$+1]),Ew(M,D,f,L,A.rotation,A.scale,Z,!1,!1,!1),"globe"===f.projection.name&&(M=w0(M,f));const Y=ee.mat4.multiply([],f.projMatrix,M),se=u.queryGeometry,ve=ww(se.isPointQuery()?se.screenBounds:se.screenGeometry,f,Y,D.aabb);null!=ve&&(V=Math.min(ve,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(u,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven()||"model-color"!==u&&"model-color-mix-intensity"!==u&&"model-rotation"!==u&&"model-scale"!==u&&"model-translation"!==u&&"model-emissive-strength"!==u)}_isPropertyZoomDependent(u){const o=this._transitionablePaint._values[u];return null!=o&&null!=o.value&&null!=o.value.expression&&o.value.expression instanceof Ff}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(u,o,l,h){const _=u.tile,f=_.getBucket(this);let b=null,S=Number.MAX_VALUE;if(!(f&&f instanceof Yg))return{queryFeature:b,intersectionZ:S};const E=f.getNodesInfo()[o];if(E.hiddenByReplacement||!E.node.meshes||!l.filter(new ao(_.tileID.overscaledZ),E.feature,_.tileID.canonical))return{queryFeature:b,intersectionZ:S};const R=E.node,x=h.calculatePosMatrix(_.tileID.toUnwrapped(),h.worldSize),I=E.evaluatedScale;let A=0;h.elevation&&R.elevation&&(A=R.elevation*h.elevation.exaggeration()),ee.mat4.translate(x,x,[(R.anchor?R.anchor[0]:0)*(I[0]-1),(R.anchor?R.anchor[1]:0)*(I[1]-1),A]),ee.mat4.scale(x,x,I);const D=u.queryGeometry,M=D.isPointQuery()?D.screenBounds:D.screenGeometry,L=function(U){const Z=ee.mat4.multiply([],x,U.matrix);ee.mat4.multiply(Z,h.expandedFarZProjMatrix,Z);for(let Y=0;Y<U.meshes.length;++Y){const se=U.meshes[Y];if(Y===U.lightMeshIndex)continue;const ve=ww(M,h,Z,se.aabb);null!=ve&&(S=Math.min(ve,S))}if(U.children)for(const Y of U.children)L(Y)};if(L(R),S===Number.MAX_VALUE)return{queryFeature:b,intersectionZ:S};const N=new F(0,0);Mw(_.tileID.canonical,N,E.node.anchor[0],E.node.anchor[1]);const{z:V,x:q,y:$}=_.tileID.canonical;return b=new ed({},V,q,$,E.feature.id),b.properties=E.feature.properties,b.geometry={type:"Point",coordinates:[N.lng,N.lat]},b.layer={...this.serialize(),id:this.fqid},b.state={},b.tile=_.tileID.canonical,{queryFeature:b,intersectionZ:S}}},clip:class extends js{constructor(u,o,l,h){super(u,{layout:g1||(g1=new Wr({"clip-layer-types":new Xt(rt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Xt(rt.layout_clip["clip-layer-scope"])})),paint:Av||(Av=new Wr({}))},o,l,h)}recalculate(u,o){super.recalculate(u,o)}createBucket(u){return new _1(u)}isTileClipped(){return!0}is3D(){return!0}}};class Aw{constructor(o){this._callback=o,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class kD{constructor(){this.tasks={},this.taskQueue=[],Ys(["process"],this),this.invoker=new Aw(this.process),this.nextId=0}add(o,l){const h=this.nextId++,_=function({type:f,isSymbolTile:b,zoom:S}){return S=S||0,"message"===f?0:"maybePrepare"!==f||b?"parseTile"!==f||b?"parseTile"===f&&b?300-S:"maybePrepare"===f&&b?400-S:500:200-S:100-S}(l);if(0===_){try{o()}finally{}return null}return this.tasks[h]={fn:o,metadata:l,priority:_,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let _=0;_<this.taskQueue.length;_++){const f=this.tasks[this.taskQueue[_]];f.priority<l&&(l=f.priority,o=_)}if(null===o)return null;const h=this.taskQueue[o];return this.taskQueue.splice(o,1),h}remove(){this.invoker.remove()}}class Rw{constructor(o,l,h){this.target=o,this.parent=l,this.mapId=h,this.callbacks={},this.cancelCallbacks={},Ys(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new kD}send(o,l,h,_,f=!1,b){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=b,this.callbacks[S]=h);const E=new Set;return this.target.postMessage({id:S,type:o,hasCallback:!!h,targetMapId:_,mustQueue:f,sourceMapId:this.mapId,data:bc(l,E)},E),{cancel:()=>{h&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:_,sourceMapId:this.mapId})}}}receive(o){const l=o.data,h=l.id;if(h&&(!l.targetMapId||this.mapId===l.targetMapId))if("<cancel>"===l.type){const _=this.cancelCallbacks[h];delete this.cancelCallbacks[h],_&&_.cancel()}else if(l.mustQueue||Cu()){const _=this.callbacks[h],f=this.scheduler.add(()=>this.processTask(h,l),_&&_.metadata||{type:"message"});f&&(this.cancelCallbacks[h]=f)}else this.processTask(h,l)}processTask(o,l){if(delete this.cancelCallbacks[o],"<response>"===l.type){const h=this.callbacks[o];delete this.callbacks[o],h&&(l.error?h(yc(l.error)):h(null,yc(l.data)))}else{const h=new Set,_=l.hasCallback?(b,S)=>{this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:b?bc(b):null,data:bc(S,h)},h)}:()=>{},f=yc(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,f,_);else if(this.parent.getWorkerSource){const b=l.type.split(".");this.parent.getWorkerSource(l.sourceMapId,b[0],f.source,f.scope)[b[1]](f,_)}else _(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Np=(()=>{class u{constructor(l,h){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=bo();const _=this.workerPool.acquire(this.id);for(let f=0;f<_.length;f++){const b=new u.Actor(_[f],h,this.id);b.name=`Worker ${f}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,h,_){vr(this.actors,(f,b)=>{f.send(l,h,b)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}return u.Actor=Rw,u})();class kw{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const h=this.toIdx(o,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function PD(u,o,l,h){let _=0,f=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(h[b])<1e-15){if(l[b]<u[b]||l[b]>o[b])return null}else{const S=1/h[b];let E=(u[b]-l[b])*S,R=(o[b]-l[b])*S;if(E>R){const x=E;E=R,R=x}if(E>_&&(_=E),R<f&&(f=R),_>f)return null}return _}function Pw(u,o,l,h,_,f,b,S,E,R,x){const I=h-u,A=_-o,D=f-l,M=b-u,L=S-o,N=E-l,V=x[1]*N-x[2]*L,q=x[2]*M-x[0]*N,$=x[0]*L-x[1]*M,U=I*V+A*q+D*$;if(Math.abs(U)<1e-15)return null;const Z=1/U,Y=R[0]-u,se=R[1]-o,ve=R[2]-l,W=(Y*V+se*q+ve*$)*Z;if(W<0||W>1)return null;const ce=se*D-ve*A,Se=ve*I-Y*D,me=Y*A-se*I,Me=(x[0]*ce+x[1]*Se+x[2]*me)*Z;return Me<0||W+Me>1?null:(M*ce+L*Se+N*me)*Z}function LD(u,o,l){return(u-o)/(l-o)}function Lw(u,o,l,h,_,f,b,S,E){const R=1<<l,x=f-h,I=b-_,A=(u+1)/R*x+h,D=(o+0)/R*I+_,M=(o+1)/R*I+_;S[0]=(u+0)/R*x+h,S[1]=D,E[0]=A,E[1]=M}class Ow{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(f){const b=Math.ceil(Math.log2(f.dim/8)),S=[];let E=Math.ceil(Math.pow(2,b));const R=1/E,x=(D,M,L,N,V)=>{const q=N?1:0,$=(D+1)*L-q,U=M*L,Z=(M+1)*L-q;V[0]=D*L,V[1]=U,V[2]=$,V[3]=Z};let I=new kw(E);const A=[];for(let D=0;D<E*E;D++){x(D%E,Math.floor(D/E),R,!1,A);const M=td(A[0],A[1],f),L=td(A[2],A[1],f),N=td(A[2],A[3],f),V=td(A[0],A[3],f);I.minimums.push(Math.min(M,L,N,V)),I.maximums.push(Math.max(M,L,N,V)),I.leaves.push(1)}for(S.push(I),E/=2;E>=1;E/=2){const D=S[S.length-1];I=new kw(E);for(let M=0;M<E*E;M++){x(M%E,Math.floor(M/E),2,!0,A);const L=D.getElevation(A[0],A[1]),N=D.getElevation(A[2],A[1]),V=D.getElevation(A[2],A[3]),q=D.getElevation(A[0],A[3]),$=D.isLeaf(A[0],A[1]),U=D.isLeaf(A[2],A[1]),Z=D.isLeaf(A[2],A[3]),Y=D.isLeaf(A[0],A[3]),se=Math.min(L.min,N.min,V.min,q.min),ve=Math.max(L.max,N.max,V.max,q.max),W=$&&U&&Z&&Y;I.maximums.push(ve),I.minimums.push(se),I.leaves.push(ve-se<=5&&W?1:0)}S.push(I)}return S}(this.dem),h=l.length-1,_=l[h];this._addNode(_.minimums[0],_.maximums[0],_.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(o,l,h,_,f,b,S=1){return PD([o,l,-100],[h,_,this.maximums[0]*S],f,b)}raycast(o,l,h,_,f,b,S=1){if(!this.nodeCount)return null;const E=this.raycastRoot(o,l,h,_,f,b,S);if(null==E)return null;const R=[],x=[],I=[],A=[],D=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:M,t:L,nodex:N,nodey:V,depth:q}=D.pop();if(this.leaves[M]){Lw(N,V,q,o,l,h,_,I,A);const U=1<<q,Z=(N+0)/U,Y=(N+1)/U,se=(V+0)/U,ve=(V+1)/U,W=td(Z,se,this.dem)*S,ce=td(Y,se,this.dem)*S,Se=td(Y,ve,this.dem)*S,me=td(Z,ve,this.dem)*S,Me=Pw(I[0],I[1],W,A[0],I[1],ce,A[0],A[1],Se,f,b),Ne=Pw(A[0],A[1],Se,I[0],A[1],me,I[0],I[1],W,f,b),ze=Math.min(null!==Me?Me:Number.MAX_VALUE,null!==Ne?Ne:Number.MAX_VALUE);if(ze!==Number.MAX_VALUE)return ze;{const $e=ee.vec3.scaleAndAdd([],f,b,L);if(Fw(W,ce,me,Se,LD($e[0],I[0],A[0]),LD($e[1],I[1],A[1]))>=$e[2])return L}continue}let $=0;for(let U=0;U<this._siblingOffset.length;U++){Lw((N<<1)+this._siblingOffset[U][0],(V<<1)+this._siblingOffset[U][1],q+1,o,l,h,_,I,A),I[2]=-100,A[2]=this.maximums[this.childOffsets[M]+U]*S;const Z=PD(I,A,f,b);if(null!=Z){const Y=Z;R[U]=Y;let se=!1;for(let ve=0;ve<$&&!se;ve++)Y>=R[x[ve]]&&(x.splice(ve,0,U),se=!0);se||(x[$]=U),$++}}for(let U=0;U<$;U++){const Z=x[U];D.push({idx:this.childOffsets[M]+Z,t:R[Z],nodex:(N<<1)+this._siblingOffset[Z][0],nodey:(V<<1)+this._siblingOffset[Z][1],depth:q+1})}}return null}_addNode(o,l,h){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,h,_,f){if(1===o[_].isLeaf(l,h))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const b=_-1,S=o[b];let E=0,R=0;for(let x=0;x<this._siblingOffset.length;x++){const I=2*l+this._siblingOffset[x][0],A=2*h+this._siblingOffset[x][1],D=S.getElevation(I,A),M=S.isLeaf(I,A),L=this._addNode(D.min,D.max,M);M&&(E|=1<<x),R||(R=L)}for(let x=0;x<this._siblingOffset.length;x++)E&1<<x||this._construct(o,2*l+this._siblingOffset[x][0],2*h+this._siblingOffset[x][1],b,R+x)}}function Fw(u,o,l,h,_,f){return Wn(Wn(u,l,f),Wn(o,h,f),_)}function td(u,o,l){const h=l.dim,_=Pt(u*h-.5,0,h-1),f=Pt(o*h-.5,0,h-1),b=Math.floor(_),S=Math.floor(f),E=Math.min(b+1,h-1),R=Math.min(S+1,h-1);return Fw(l.get(b,S),l.get(E,S),l.get(b,R),l.get(E,R),_-b,f-S)}const zn={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function OD(u,o,l){return(256*u*256+256*o+l)/10-1e4}function R0(u,o,l){return 256*u+o+l/256-32768}class sy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,h,_=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&"mapbox"!==h&&"terrarium"!==h)return void ji(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const f=this.dim=l.height-2,b=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=_,this._modifiedForSources={},!_){for(let E=0;E<f;E++)b[this._idx(-1,E)]=b[this._idx(0,E)],b[this._idx(f,E)]=b[this._idx(f-1,E)],b[this._idx(E,-1)]=b[this._idx(E,0)],b[this._idx(E,f)]=b[this._idx(E,f-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(f,-1)]=b[this._idx(f-1,0)],b[this._idx(-1,f)]=b[this._idx(0,f-1)],b[this._idx(f,f)]=b[this._idx(f-1,f-1)]}const S="terrarium"===h?R0:OD;for(let E=0;E<b.length;++E){const R=4*E;this.floatView[E]=S(this.pixels[R],this.pixels[R+1],this.pixels[R+2])}this._timestamp=hn.now()}_buildQuadTree(){this._tree=new Ow(this)}get(o,l,h=!1){h&&(o=Pt(o,-1,this.dim),l=Pt(l,-1,this.dim));const _=this._idx(o,l);return this.floatView[_]}set(o,l,h){const _=this._idx(o,l),f=this.floatView[_];return this.floatView[_]=h,h-f}static getUnpackVector(o){return zn[o]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const h=[0,0,0,0],_=sy.getUnpackVector(l);let f=Math.floor((o+_[3])/_[2]);return h[2]=f%256,f=Math.floor(f/256),h[1]=f%256,f=Math.floor(f/256),h[0]=f,h}getPixels(){return new bb({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,h){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let _=l*this.dim,f=l*this.dim+this.dim,b=h*this.dim,S=h*this.dim+this.dim;switch(l){case-1:_=f-1;break;case 1:f=_+1}switch(h){case-1:b=S-1;break;case 1:S=b+1}const E=-l*this.dim,R=-h*this.dim;for(let x=b;x<S;x++)for(let I=_;I<f;I++){const A=4*this._idx(I,x),D=4*this._idx(I+E,x+R);this.pixels[A+0]=o.pixels[D+0],this.pixels[A+1]=o.pixels[D+1],this.pixels[A+2]=o.pixels[D+2],this.pixels[A+3]=o.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function FD(u,o,l){var h,_;1===u?o.headerLength=l.readFixed32():2===u?o.x=l.readVarint():3===u?o.y=l.readVarint():4===u?o.z=l.readVarint():5===u&&o.layers.push((h=l,_=l.readVarint()+l.pos,h.readFields(ay,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},_)))}function ND(u,o,l){var h,_;1===u?(o.delta_filter=(h=l,_=l.readVarint()+l.pos,h.readFields(BD,{blockSize:0},_)),o.filter="delta_filter"):2===u?(l.readVarint(),o.filter="zigzag_filter"):3===u?(l.readVarint(),o.filter="bitshuffle_filter"):4===u&&(l.readVarint(),o.filter="byteshuffle_filter")}function BD(u,o,l){1===u&&(o.blockSize=l.readVarint())}function zD(u,o,l){1===u?(l.readVarint(),o.codec="gzip_data"):2===u?(l.readVarint(),o.codec="jpeg_image"):3===u?(l.readVarint(),o.codec="webp_image"):4===u&&(l.readVarint(),o.codec="png_image")}function VD(u,o,l){let h=0,_=0;var f,b;1===u?o.firstByte=l.readFixed64():2===u?o.lastByte=l.readFixed64():3===u?o.filters.push((f=l,b=l.readVarint()+l.pos,f.readFields(ND,{},b))):4===u?o.codec=function(f,b){return f.readFields(zD,{},b)}(l,l.readVarint()+l.pos):5===u?_=l.readFloat():6===u?h=l.readFloat():7===u?o.bands.push(l.readString()):8===u?o.offset=l.readDouble():9===u&&(o.scale=l.readDouble()),0===o.offset&&(o.offset=_),0===o.scale&&(o.scale=h)}function ay(u,o,l){var h,_;1===u?o.version=l.readVarint():2===u?o.name=l.readString():3===u?o.units=l.readString():4===u?o.tileSize=l.readVarint():5===u?o.buffer=l.readVarint():6===u?o.pixelFormat=l.readVarint():7===u&&o.dataIndex.push((h=l,_=l.readVarint()+l.pos,h.readFields(VD,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},_)))}function Bp(u,o,l){if(2===u)h=l,_=l.readVarint()+l.pos,h.readFields(yR,o,_);else if(3===u)throw new Error("Not implemented");var h,_}function yR(u,o,l){if(1===u){let h=0;const _=l.readVarint()+l.pos;for(;l.pos<_;)o[h++]=l.readVarint()}}xn(sy,"DEMData"),xn(Ow,"DemMinMaxQuadTree",{omit:["dem"]});class Kg{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;const l=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,l),l}put(o,l){this.cache.has(o)?this.cache.delete(o):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(o,l)}}function jD(u,o){if(4!==o.length)throw new Error(`Expected data of dimension 4 but got ${o.length}.`);let l=o[3];for(let h=2;h>=1;h--){const _=1===h?1:0,f=2===h?1:0;for(let b=0;b<o[0];b++){const S=o[1]*b;for(let E=_;E<o[1];E++){const R=o[2]*(E+S);for(let x=f;x<o[2];x++){const I=o[3]*(x+R);for(let A=0;A<o[3];A++){const D=I+A;u[D]+=u[D-l]}}}}l*=o[h]}return u}function UD(u){for(let o=0,l=u.length;o<l;o++)u[o]=u[o]>>>1^-(1&u[o]);return u}function k0(u,o){switch(o){case"uint32":return u;case"uint16":for(let l=0;l<u.length;l+=2){const h=u[l],_=u[l+1];u[l]=(240&h)>>4|(61440&h)>>8|(240&_)<<4|61440&_,u[l+1]=15&h|(3840&h)>>4|(15&_)<<8|(3840&_)<<4}return u;case"uint8":for(let l=0;l<u.length;l+=4){const h=u[l],_=u[l+1],f=u[l+2],b=u[l+3];u[l+0]=(192&h)>>6|(192&_)>>4|(192&f)>>2|192&b,u[l+1]=(48&h)>>4|(48&_)>>2|48&f|(48&b)<<2,u[l+2]=(12&h)>>2|12&_|(12&f)<<2|(12&b)<<4,u[l+3]=3&h|(3&_)<<2|(3&f)<<4|(3&b)<<6}return u;default:throw new Error(`Invalid pixel format, "${o}"`)}}var Fl=Uint8Array,_l=Uint16Array,Jg=Int32Array,ga=new Fl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),oh=new Fl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ly=new Fl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nl=function(u,o){for(var l=new _l(31),h=0;h<31;++h)l[h]=o+=1<<u[h-1];var _=new Jg(l[30]);for(h=1;h<30;++h)for(var f=l[h];f<l[h+1];++f)_[f]=f-l[h]<<5|h;return{b:l,r:_}},Yn=Nl(ga,2),zp=Yn.b,cm=Yn.r;zp[28]=258,cm[258]=28;for(var um=Nl(oh,0).b,Vp=new _l(32768),wo=0;wo<32768;++wo){var Ic=(43690&wo)>>1|(21845&wo)<<1;Vp[wo]=((65280&(Ic=(61680&(Ic=(52428&Ic)>>2|(13107&Ic)<<2))>>4|(3855&Ic)<<4))>>8|(255&Ic)<<8)>>1}var pu=function(u,o,l){for(var h=u.length,_=0,f=new _l(o);_<h;++_)u[_]&&++f[u[_]-1];var b,S=new _l(o);for(_=1;_<o;++_)S[_]=S[_-1]+f[_-1]<<1;b=new _l(1<<o);var E=15-o;for(_=0;_<h;++_)if(u[_])for(var R=_<<4|u[_],x=o-u[_],I=S[u[_]-1]++<<x,A=I|(1<<x)-1;I<=A;++I)b[Vp[I]>>E]=R;return b},fu=new Fl(288);for(wo=0;wo<144;++wo)fu[wo]=8;for(wo=144;wo<256;++wo)fu[wo]=9;for(wo=256;wo<280;++wo)fu[wo]=7;for(wo=280;wo<288;++wo)fu[wo]=8;var jp=new Fl(32);for(wo=0;wo<32;++wo)jp[wo]=5;var Nw=pu(fu,9),Bw=pu(jp,5),cy=function(u){for(var o=u[0],l=1;l<u.length;++l)u[l]>o&&(o=u[l]);return o},oc=function(u,o,l){var h=o/8|0;return(u[h]|u[h+1]<<8)>>(7&o)&l},uy=function(u,o){var l=o/8|0;return(u[l]|u[l+1]<<8|u[l+2]<<16)>>(7&o)},zw=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],sc=function(u,o,l){var h=new Error(o||zw[u]);if(h.code=u,Error.captureStackTrace&&Error.captureStackTrace(h,sc),!l)throw h;return h},Vw=new Fl(0),jw="undefined"!=typeof TextDecoder&&new TextDecoder;try{jw.decode(Vw,{stream:!0})}catch(u){}const HD={gzip_data:"gzip"};class ac extends Error{constructor(o){super(o),this.name="MRTError"}}const Ct={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Uw={uint32:1,uint16:2,uint8:4},Oa={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Ve;class Qg{constructor(o=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=o}getLayer(o){const l=this.layers[o];if(!l)throw new ac(`Layer '${o}' not found`);return l}getHeaderLength(o){const l=new Uint8Array(o),h=new DataView(o);if(13!==l[0])throw new ac("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(o){const l=new Uint8Array(o),h=this.getHeaderLength(o);if(l.length<h)throw new ac(`Expected header with length >= ${h} but got buffer of length ${l.length}`);const _=new Ve(l.subarray(0,h)).readFields(FD,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==_.x||this.y!==_.y||this.z!==_.z))throw new ac(`Invalid attempt to parse header ${_.z}/${_.x}/${_.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=_.x,this.y=_.y,this.z=_.z;for(const f of _.layers)this.layers[f.name]=new GD(f,{cacheSize:this._cacheSize});return this}createDecodingTask(o){const l=[],h=this.getLayer(o.layerName);for(let _ of o.blockIndices){const f=h.dataIndex[_],b=f.firstByte-o.firstByte,S=f.lastByte-o.firstByte;if(h._blocksInProgress.has(_))continue;const E={layerName:h.name,firstByte:b,lastByte:S,pixelFormat:h.pixelFormat,blockIndex:_,blockShape:[f.bands.length].concat(h.bandShape),buffer:h.buffer,codec:f.codec.codec,filters:f.filters.map(R=>R.filter)};h._blocksInProgress.add(_),l.push(E)}return new ae(l,()=>{l.forEach(_=>h._blocksInProgress.delete(_.blockIndex))},(_,f)=>{if(l.forEach(b=>h._blocksInProgress.delete(b.blockIndex)),_)throw _;f.forEach(b=>{this.getLayer(b.layerName).processDecodedData(b)})})}}class GD{constructor({version:o,name:l,units:h,tileSize:_,pixelFormat:f,buffer:b,dataIndex:S},E){if(this.version=o,1!==this.version)throw new ac(`Cannot parse raster layer encoded with MRT version ${o}`);this.name=l,this.units=h,this.tileSize=_,this.buffer=b,this.pixelFormat=Ct[f],this.dataIndex=S,this.bandShape=[_+2*b,_+2*b,Uw[this.pixelFormat]],this._decodedBlocks=new Kg(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Uw[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:o})=>o).flat()}processDecodedData(o){const l=o.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.put(l,o.data)}getBlockForBand(o){let l=0;switch(typeof o){case"string":for(const[h,_]of this.dataIndex.entries()){for(const[f,b]of _.bands.entries())if(b===o)return{bandIndex:l+f,blockIndex:h,blockBandIndex:f};l+=_.bands.length}break;case"number":for(const[h,_]of this.dataIndex.entries()){if(o>=l&&o<l+_.bands.length)return{bandIndex:o,blockIndex:h,blockBandIndex:o-l};l+=_.bands.length}break;default:throw new ac(`Invalid band \`${JSON.stringify(o)}\`. Expected string or integer.`)}throw new ac(`Band not found: ${JSON.stringify(o)}`)}getDataRange(o){let l=1/0,h=-1/0;const _=[],f=new Set;for(const b of o){const{blockIndex:S}=this.getBlockForBand(b);if(S<0)throw new ac(`Invalid band: ${JSON.stringify(b)}`);const E=this.dataIndex[S];_.includes(S)||_.push(S),f.add(S),l=Math.min(l,E.firstByte),h=Math.max(h,E.lastByte)}if(f.size>this.cacheSize)throw new ac(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:l,lastByte:h,blockIndices:_}}hasBand(o){const{blockIndex:l}=this.getBlockForBand(o);return l>=0}hasDataForBand(o){const{blockIndex:l}=this.getBlockForBand(o);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(o){const{blockIndex:l,blockBandIndex:h}=this.getBlockForBand(o),_=this._decodedBlocks.get(l.toString());if(!_)throw new ac(`Data for band ${JSON.stringify(o)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[l],b=this.bandShape.reduce((R,x)=>R*x,1),S=h*b,E=_.subarray(S,S+b);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}Qg.setPbf=function(u){Ve=u};class ae{constructor(o,l,h){this.tasks=o,this._onCancel=l,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(o,l){this._finalized||(this._onComplete(o,l),this._finalized=!0)}}Qg.performDecoding=function(u,o){const l=new Uint8Array(u);return Promise.all(o.tasks.map(h=>{const{layerName:_,firstByte:f,lastByte:b,pixelFormat:S,blockShape:E,blockIndex:R,filters:x,codec:I}=h,A=l.subarray(f,b+1),D=new Uint32Array(E[0]*E[1]*E[2]);let M;if("gzip_data"!==I)throw new ac(`Unhandled codec: ${I}`);return M=function(L,N){if(!globalThis.DecompressionStream&&"gzip_data"===N)return Promise.resolve(((U=function(se){31==se[0]&&139==se[1]&&8==se[2]||sc(6,"invalid gzip data");var ve=se[3],W=10;4&ve&&(W+=2+(se[10]|se[11]<<8));for(var ce=(ve>>3&1)+(ve>>4&1);ce>0;ce-=!se[W++]);return W+(2&ve)}($=L))+8>$.length&&sc(6,"invalid gzip data"),function(se,ve,W,ce){var Se=se.length;if(!Se||ve.f&&!ve.l)return W||new Fl(0);var me=!W,Me=me||2!=ve.i,Ne=ve.i;me&&(W=new Fl(3*Se));var ze,$e,nt=function(Hp){var lh=W.length;if(Hp>lh){var fm=new Fl(Math.max(2*lh,Hp));fm.set(W),W=fm}},st=ve.f||0,Je=ve.p||0,St=ve.b||0,$t=ve.l,gt=ve.d,gn=ve.m,on=ve.n,Kt=8*Se;do{if(!$t){st=oc(se,Je,1);var Ht=oc(se,Je+1,3);if(Je+=3,!Ht){var Vn=se[(Xn=4+((Je+7)/8|0))-4]|se[Xn-3]<<8,pn=Xn+Vn;if(pn>Se){Ne&&sc(0);break}Me&&nt(St+Vn),W.set(se.subarray(Xn,pn),St),ve.b=St+=Vn,ve.p=Je=8*pn,ve.f=st;continue}if(1==Ht)$t=Nw,gt=Bw,gn=9,on=5;else if(2==Ht){var Sn=oc(se,Je,31)+257,ii=oc(se,Je+10,15)+4,yi=Sn+oc(se,Je+5,31)+1;Je+=14;for(var xi=new Fl(yi),fi=new Fl(19),Ri=0;Ri<ii;++Ri)fi[ly[Ri]]=oc(se,Je+3*Ri,7);Je+=3*ii;var Ii=cy(fi),Br=(1<<Ii)-1,Cr=pu(fi,Ii);for(Ri=0;Ri<yi;){var Xn,ar=Cr[oc(se,Je,Br)];if(Je+=15&ar,(Xn=ar>>4)<16)xi[Ri++]=Xn;else{var hr=0,Kr=0;for(16==Xn?(Kr=3+oc(se,Je,3),Je+=2,hr=xi[Ri-1]):17==Xn?(Kr=3+oc(se,Je,7),Je+=3):18==Xn&&(Kr=11+oc(se,Je,127),Je+=7);Kr--;)xi[Ri++]=hr}}var Mo=xi.subarray(0,Sn),Ho=xi.subarray(Sn);gn=cy(Mo),on=cy(Ho),$t=pu(Mo,gn),gt=pu(Ho,on)}else sc(1);if(Je>Kt){Ne&&sc(0);break}}Me&&nt(St+131072);for(var Ao=(1<<gn)-1,So=(1<<on)-1,No=Je;;No=Je){var Jr=(hr=$t[uy(se,Je)&Ao])>>4;if((Je+=15&hr)>Kt){Ne&&sc(0);break}if(hr||sc(2),Jr<256)W[St++]=Jr;else{if(256==Jr){No=Je,$t=null;break}var as=Jr-254;Jr>264&&(as=oc(se,Je,(1<<(Mc=ga[Ri=Jr-257]))-1)+zp[Ri],Je+=Mc);var _r=gt[uy(se,Je)&So],Ka=_r>>4;if(_r||sc(3),Je+=15&_r,Ho=um[Ka],Ka>3){var Mc=oh[Ka];Ho+=uy(se,Je)&(1<<Mc)-1,Je+=Mc}if(Je>Kt){Ne&&sc(0);break}Me&&nt(St+131072);var _a=St+as;if(St<Ho){var Ac=0-Ho,vs=Math.min(Ho,_a);for(Ac+St<0&&sc(3);St<vs;++St)W[St]=(void 0)[Ac+St]}for(;St<_a;++St)W[St]=W[St-Ho]}}ve.l=$t,ve.p=No,ve.b=St,ve.f=st,$t&&(st=1,ve.m=gn,ve.d=gt,ve.n=on)}while(!st);return St!=W.length&&me?(ze=W,(null==($e=St)||$e>ze.length)&&($e=ze.length),new Fl(ze.subarray(0,$e))):W.subarray(0,St)}($.subarray(U,-8),{i:2},new Fl(((V=$)[(q=V.length)-4]|V[q-3]<<8|V[q-2]<<16|V[q-1]<<24)>>>0))));var V,q,$,U;const Z=HD[N];if(!Z)throw new Error(`Unhandled codec: ${N}`);const Y=new globalThis.DecompressionStream(Z);return new Response(new Blob([L]).stream().pipeThrough(Y)).arrayBuffer().then(se=>new Uint8Array(se))}(A,I).then(L=>(new Ve(L).readFields(Bp,D),new Oa[S](D.buffer))),M.then(L=>{for(let N=x.length-1;N>=0;N--)switch(x[N]){case"delta_filter":jD(L,E);break;case"zigzag_filter":UD(L);break;case"bitshuffle_filter":k0(L,S);break;default:throw new ac(`Unhandled filter "${x[N]}"`)}return{layerName:_,blockIndex:R,data:L}}).catch(L=>{throw L})}))},xn(ae,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var de={workerUrl:"",workerClass:null,workerParams:void 0};const dn="mapboxgl_preloaded_worker_pool";class e_{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<e_.workerCount;)this.workers.push(null!=de.workerClass?new de.workerClass:new self.Worker(de.workerUrl,de.workerParams));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.workers&&0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[dn]}numActive(){return Object.keys(this.active).length}}let Uo;function Zo(){return Uo||(Uo=new e_),Uo}e_.workerCount=2;let ys,Zr,Ya,Up,t_,Zt=null;function dm(){return Cu()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Zr||Te.DRACO_URL}function Hw(){if(Cu()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Up)return Up;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Up=WebAssembly.validate(u)?Te.MESHOPT_SIMD_URL:Te.MESHOPT_URL,Up}const n_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Gw={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},hm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Ot(u,o,l){const h=l.json.bufferViews.length,_=l.buffers.length;o.bufferView=h,l.json.bufferViews[h]={buffer:_,byteLength:u.byteLength},l.buffers[_]=u}const P0="KHR_draco_mesh_compression";function ss(u,o){const l=u.extensions&&u.extensions[P0];if(!l)return;const h=new Ya.Decoder,_=F0(o,l.bufferView),f=new Ya.Mesh;if(!h.DecodeArrayToMesh(_,_.byteLength,f))throw new Error("Failed to decode Draco mesh");const b=o.json.accessors[u.indices],S=n_[b.componentType],E=b.count*S.BYTES_PER_ELEMENT,R=Ya._malloc(E);S===Uint16Array?h.GetTrianglesUInt16Array(f,E,R):h.GetTrianglesUInt32Array(f,E,R),Ot(Ya.memory.buffer.slice(R,R+E),b,o),Ya._free(R);for(const x of Object.keys(l.attributes)){const I=h.GetAttributeByUniqueId(f,l.attributes[x]),A=o.json.accessors[u.attributes[x]],D=Gw[A.componentType],M=A.count*hm[A.type]*n_[A.componentType].BYTES_PER_ELEMENT,L=Ya._malloc(M);h.GetAttributeDataArrayForAllPoints(f,I,Ya[D],M,L),Ot(Ya.memory.buffer.slice(L,L+M),A,o),Ya._free(L)}h.destroy(),f.destroy(),delete u.extensions[P0]}const Yr="EXT_meshopt_compression";function Qo(u,o){if(!u.extensions||!u.extensions[Yr])return;const l=u.extensions[Yr],h=new Uint8Array(o.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),_=new Uint8Array(l.count*l.byteStride);t_.decodeGltfBuffer(_,l.count,l.byteStride,h,l.mode,l.filter),u.buffer=o.buffers.length,u.byteOffset=0,o.buffers[u.buffer]=_.buffer,delete u.extensions[Yr]}const dy=1179937895,L0=new TextDecoder("utf8");function O0(u,o){return new URL(u,o).href}function qw(u,o,l,h){return fetch(O0(u.uri,h)).then(_=>_.arrayBuffer()).then(_=>{o.buffers[l]=_})}function F0(u,o){const l=u.json.bufferViews[o];return new Uint8Array(u.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function $w(u,o,l,h){if(u.uri){const _=O0(u.uri,h);return fetch(_).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{o.images[l]=f})}if(void 0!==u.bufferView){const _=F0(o,u.bufferView),f=new Blob([_],{type:u.mimeType});return createImageBitmap(f).then(b=>{o.images[l]=b})}}function N0(u,o=0,l){const h={json:null,images:[],buffers:[]};if(new Uint32Array(u,o,1)[0]===dy){const x=new Uint32Array(u,o);let I=2;const A=(x[I++]>>2)-3,D=x[I++]>>2;if(I++,h.json=JSON.parse(L0.decode(x.subarray(I,I+D))),I+=D,I<A){const M=x[I++];I++;const L=o+(I<<2);h.buffers[0]=u.slice(L,L+M)}}else h.json=JSON.parse(L0.decode(new Uint8Array(u,o)));const{buffers:_,images:f,meshes:b,extensionsUsed:S,bufferViews:E}=h.json;let R=Promise.resolve();if(_){const x=[];for(let I=0;I<_.length;I++){const A=_[I];A.uri?x.push(qw(A,h,I,l)):h.buffers[I]||(h.buffers[I]=null)}R=Promise.all(x)}return R.then(()=>{const x=[],I=S&&S.includes(P0),A=S&&S.includes(Yr);if(I&&x.push(function(){if(!Ya)return null!=ys?ys:(ys=function(D){let M,L=null;function N(){M=new Uint8Array(L.buffer)}function V(){throw new Error("Unexpected Draco error.")}const q={a:{a:V,d:function($,U,Z){return M.copyWithin($,U,U+Z)},c:function($){const U=M.length,Z=Math.max($>>>0,Math.ceil(1.2*U)),Y=Math.ceil((Z-U)/65536);try{return L.grow(Y),N(),!0}catch(se){return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,q):D.then($=>$.arrayBuffer()).then($=>WebAssembly.instantiate($,q))).then($=>{const{Rb:U,Qb:Z,P:Y,T:se,X:ve,Ja:W,La:ce,Qa:Se,Va:me,Wa:Me,eb:Ne,jb:ze,f:$e,e:nt,yb:st,zb:Je,Ab:St,Bb:$t,Db:gt,Gb:gn}=$.instance.exports;L=nt;const on=(()=>{let Kt=0,Ht=0,Vn=0,pn=0;return Sn=>{Vn&&(U(pn),U(Kt),Ht+=Vn,Vn=Kt=0),Kt||(Ht+=128,Kt=Z(Ht));const ii=Sn.length+7&-8;let yi=Kt;ii>=Ht&&(Vn=ii,yi=pn=Z(ii));for(let xi=0;xi<Sn.length;xi++)M[yi+xi]=Sn[xi];return yi}})();return N(),$e(),{memory:nt,_free:U,_malloc:Z,Mesh:class{constructor(){this.ptr=Y()}destroy(){se(this.ptr)}},Decoder:class{constructor(){this.ptr=W()}destroy(){ze(this.ptr)}DecodeArrayToMesh(Kt,Ht,Vn){const pn=on(Kt),Sn=ce(this.ptr,pn,Ht,Vn.ptr);return!!ve(Sn)}GetAttributeByUniqueId(Kt,Ht){return{ptr:Se(this.ptr,Kt.ptr,Ht)}}GetTrianglesUInt16Array(Kt,Ht,Vn){me(this.ptr,Kt.ptr,Ht,Vn)}GetTrianglesUInt32Array(Kt,Ht,Vn){Me(this.ptr,Kt.ptr,Ht,Vn)}GetAttributeDataArrayForAllPoints(Kt,Ht,Vn,pn,Sn){Ne(this.ptr,Kt.ptr,Ht.ptr,Vn,pn,Sn)}},DT_INT8:st(),DT_UINT8:Je(),DT_INT16:St(),DT_UINT16:$t(),DT_UINT32:gt(),DT_FLOAT32:gn()}})}(fetch(dm())),ys.then(D=>{Ya=D,ys=void 0}))}()),A&&x.push(function(){if(t_)return;const D=function(M){let L;const N=WebAssembly.instantiateStreaming(M,{}).then($=>{L=$.instance,L.exports.__wasm_call_ctors()}),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},q={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:N,supported:!0,decodeGltfBuffer($,U,Z,Y,se,ve){!function(W,ce,Se,me,Me,Ne,ze){const $e=W.exports.sbrk,nt=me+3&-4,st=$e(nt*Me),Je=$e(Ne.length),St=new Uint8Array(W.exports.memory.buffer);St.set(Ne,Je);const $t=ce(st,me,Me,Je,Ne.length);if(0===$t&&ze&&ze(st,nt,Me),Se.set(St.subarray(st,st+me*Me)),$e(st-$e(0)),0!==$t)throw new Error(`Malformed buffer data: ${$t}`)}(L,L.exports[q[se]],$,U,Z,Y,L.exports[V[ve]])}}}(fetch(Hw()));return D.ready.then(()=>{t_=D})}()),f)for(let D=0;D<f.length;D++)x.push($w(f[D],h,D,l));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(I&&b)for(const{primitives:D}of b)for(const M of D)ss(M,h);if(A&&b&&E)for(const D of E)Qo(D,h);return h})})}function sh(u,o){const l=u.json.bufferViews[o.bufferView],h=n_[o.componentType];return new h(u.buffers[l.buffer],(o.byteOffset||0)+(l.byteOffset||0),o.count*(l.byteStride&&l.byteStride!==hm[o.type]*h.BYTES_PER_ELEMENT?l.byteStride/h.BYTES_PER_ELEMENT:hm[o.type]))}function hy(u,o,l,h){const _=n_[o.componentType],f=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(_),b=u.json.bufferViews[o.bufferView],S=b.byteStride?b.byteStride/_.BYTES_PER_ELEMENT:hm[o.type],E=l.float32,R=E.length/l.capacity;for(let x=0,I=0;x<o.count*S;x+=S,I+=R)for(let A=0;A<R;A++)E[I+A]=h[x+A]*f;l._trim()}function vR(u,o,l){const h=u.indices,_=u.attributes,f={};f.indexArray=new Nr;const b=o.json.accessors[h],S=b.count/3;f.indexArray.reserve(S);const E=sh(o,b);for(let A=0;A<S;A++)f.indexArray.emplaceBack(E[3*A],E[3*A+1],E[3*A+2]);f.indexArray._trim(),f.vertexArray=new tu;const R=o.json.accessors[_.POSITION];f.vertexArray.reserve(R.count);const x=sh(o,R);for(let A=0;A<R.count;A++)f.vertexArray.emplaceBack(x[3*A],x[3*A+1],x[3*A+2]);if(f.vertexArray._trim(),f.aabb=new er(R.min,R.max),f.centroid=function(A,D){const M=[0,0,0],L=A.length;if(L>0){for(let N=0;N<L;N++){const V=3*A[N];M[0]+=D[V],M[1]+=D[V+1],M[2]+=D[V+2]}M[0]/=L,M[1]/=L,M[2]/=L}return M}(E,x),void 0!==_.COLOR_0){const A=o.json.accessors[_.COLOR_0],D=hm[A.type],M=sh(o,A);f.colorArray=3===D?new tu:new $a,f.colorArray.resize(A.count),hy(o,A,f.colorArray,M)}if(void 0!==_.NORMAL){f.normalArray=new tu;const A=o.json.accessors[_.NORMAL];f.normalArray.resize(A.count);const D=sh(o,A);hy(o,A,f.normalArray,D)}if(void 0!==_.TEXCOORD_0&&l.length>0){f.texcoordArray=new qf;const A=o.json.accessors[_.TEXCOORD_0];f.texcoordArray.resize(A.count);const D=sh(o,A);hy(o,A,f.texcoordArray,D)}if(void 0!==_._FEATURE_ID_RGBA4444){const A=o.json.accessors[_._FEATURE_ID_RGBA4444];o.json.extensionsUsed&&o.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=sh(o,A))}void 0!==_._FEATURE_RGBA4444&&(f.featureData=new Uint32Array(sh(o,o.json.accessors[_._FEATURE_RGBA4444]).buffer));const I=u.material;return f.material=function(A,D){const{emissiveFactor:M=[0,0,0],alphaMode:L="OPAQUE",alphaCutoff:N=.5,normalTexture:V,occlusionTexture:q,emissiveTexture:$,doubleSided:U}=A,{baseColorFactor:Z=[1,1,1,1],metallicFactor:Y=1,roughnessFactor:se=1,baseColorTexture:ve,metallicRoughnessTexture:W}=A.pbrMetallicRoughness||{},ce=q?D[q.index]:void 0;if(q&&q.extensions&&q.extensions.KHR_texture_transform&&ce){const Se=q.extensions.KHR_texture_transform;ce.offsetScale=[Se.offset[0],Se.offset[1],Se.scale[0],Se.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new mr(...Z),metallicFactor:Y,roughnessFactor:se,baseColorTexture:ve?D[ve.index]:void 0,metallicRoughnessTexture:W?D[W.index]:void 0},doubleSided:U,emissiveFactor:M,alphaMode:L,alphaCutoff:N,normalTexture:V?D[V.index]:void 0,occlusionTexture:ce,emissionTexture:$?D[$.index]:void 0,defined:void 0===A.defined}}(void 0!==I?o.json.materials[I]:{defined:!1},l),f}function Ww(u,o,l){const{matrix:h,rotation:_,translation:f,scale:b,mesh:S,extras:E,children:R}=u,x={};if(x.matrix=h||ee.mat4.fromRotationTranslationScale([],_||[0,0,0,1],f||[0,0,0],b||[1,1,1]),void 0!==S){x.meshes=l[S];const I=x.anchor=[0,0];for(const A of x.meshes){const{min:D,max:M}=A.aabb;I[0]+=D[0]+M[0],I[1]+=D[1]+M[1]}I[0]=Math.floor(I[0]/x.meshes.length/2),I[1]=Math.floor(I[1]/x.meshes.length/2)}if(E&&(E.id&&(x.id=E.id),E.lights&&(x.lights=function(I){if(!I.length)return[];const A=function(V){const q=atob(V),$=new Uint8Array(q.length);for(let U=0;U<q.length;U++)$[U]=q.codePointAt(U);return $}(I),D=[],M=A.length/24,L=new Uint16Array(A.buffer),N=new Float32Array(A.buffer);for(let V=0;V<M;V++){const q=L[2*V*6]/30,$=L[2*V*6+1]/30,U=L[2*V*6+10]/100,Z=N[6*V+1],Y=N[6*V+2],se=N[6*V+3],ve=N[6*V+4],W=se-Z,ce=ve-Y,Se=Math.hypot(W,ce);D.push({pos:[Z+.5*W,Y+.5*ce,$],normal:[ce/Se,-W/Se,0],width:Se,height:q,depth:U,points:[Z,Y,se,ve]})}return D}(E.lights))),R){const I=[];for(const A of R)I.push(Ww(o.json.nodes[A],o,l));x.children=I}return x}function qD(u){if(0===u.vertices.length||0===u.indices.length)return null;const o=new Rv(u.vertices,u.indices,8,256),[l,h]=[o.min.clone(),o.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:o,min:l,max:h}}function Xw(u){if(!u.extras||!u.extras.ground)return null;const o=u.extras.ground;if(!o||!Array.isArray(o)||0===o.length)return null;const l=o[0];if(!l||!Array.isArray(l)||0===l.length)return null;const h=[];for(const b of l){if(!Array.isArray(b)||2!==b.length)continue;const S=b[0],E=b[1];"number"==typeof S&&"number"==typeof E&&h.push(new jt(S,E))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let _=0;for(let b=0;b<h.length;b++){const S=h[b],E=h[(b+1)%h.length],R=h[(b+2)%h.length];_+=(S.x-E.x)*(R.y-E.y)-(R.x-E.x)*(S.y-E.y)}_>0&&h.reverse();const f=wg(h.flatMap(b=>[b.x,b.y]),[]);return 0===f.length?null:{vertices:h,indices:f}}function $D(u,o){const l=[],h=[];let _=0;const f=[];for(const b of u){_=l.length;const S=b.vertexArray.float32,E=b.indexArray.uint16;for(let R=0;R<b.vertexArray.length;R++)f[0]=S[3*R+0],f[1]=S[3*R+1],f[2]=S[3*R+2],ee.vec3.transformMat4(f,f,o),l.push(new jt(f[0],f[1]));for(let R=0;R<3*b.indexArray.length;R++)h.push(E[R]+_)}if(h.length%3!=0)return null;for(let b=0;b<h.length;b+=3){const S=l[h[b+0]],E=l[h[b+1]],R=l[h[b+2]];(S.x-E.x)*(R.y-E.y)-(R.x-E.x)*(S.y-E.y)>0&&([h[b+1],h[b+2]]=[h[b+2],h[b+1]])}return{vertices:l,indices:h}}function As(u){const l=function(E,R){const x=[];for(const I of E.json.meshes){const A=[];for(const D of I.primitives)A.push(vR(D,E,R));x.push(A)}return x}(u,function(E,R){const x=[],I=WebGL2RenderingContext;if(E.json.textures)for(const A of E.json.textures){const D={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};void 0!==A.sampler&&Object.assign(D,E.json.samplers[A.sampler]),x.push({image:R[A.source],sampler:D,uploaded:!1})}return x}(u,u.images)),{scenes:h,scene:_,nodes:f}=u.json,b=h?h[_||0].nodes:f,S=[];for(const E of b)S.push(Ww(f[E],u,l));return function(E,R,x){const I={},A=new Set;for(let D=0;D<E.length;D++){const M=x[R[D]];if(!M.extras)continue;const L=M.extras["mapbox:footprint:version"],N=M.extras["mapbox:footprint:id"];(L||N)&&A.add(D),"1.0.0"===L&&N&&(I[N]=D)}for(let D=0;D<E.length;D++){if(A.has(D))continue;const M=E[D],L=x[R[D]];if(!L.extras)continue;let N=null;M.id in I&&(N=$D(E[I[M.id]].meshes,M.matrix)),N||(N=Xw(L)),N&&(M.footprint=qD(N))}if(A.size>0){const D=Array.from(A.values()).sort((M,L)=>M-L);for(let M=D.length-1;M>=0;M--)E.splice(D[M],1)}}(S,b,u.json.nodes),S}function Zw(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const o=u.vertexArray.float32,l=u.aabb.min[0]-1,h=u.aabb.min[1]-1,_=64/(u.aabb.max[0]-l+2),f=64/(u.aabb.max[1]-h+2);for(let b=0;b<o.length;b+=3){const S=o[b+2],E=(o[b+0]-l)*_|0,R=(o[b+1]-h)*f|0;S>u.heightmap[64*R+E]&&(u.heightmap[64*R+E]=S)}}function WD(u,o){const l={};l.indexArray=new Nr,l.indexArray.reserve(4*u.length),l.vertexArray=new tu,l.vertexArray.reserve(10*u.length),l.colorArray=new $a,l.vertexArray.reserve(10*u.length);let h=0;for(const b of u){const S=Math.min(10,Math.max(4,1.3*b.height))*o,E=[-b.normal[1],b.normal[0],0],R=Math.min(.29,.1*b.width/b.depth),x=b.width-2*b.depth*o*(R+.01),I=ee.vec3.scaleAndAdd([],b.pos,E,x/2),A=ee.vec3.scaleAndAdd([],b.pos,E,-x/2),D=[I[0],I[1],I[2]+b.height],M=[A[0],A[1],A[2]+b.height],L=ee.vec3.scaleAndAdd([],b.normal,E,R);ee.vec3.scale(L,L,S);const N=ee.vec3.scaleAndAdd([],b.normal,E,-R);ee.vec3.scale(N,N,S),ee.vec3.add(L,I,L),ee.vec3.add(N,A,N),I[2]+=.1,A[2]+=.1,l.vertexArray.emplaceBack(L[0],L[1],L[2]),l.vertexArray.emplaceBack(N[0],N[1],N[2]),l.vertexArray.emplaceBack(I[0],I[1],I[2]),l.vertexArray.emplaceBack(A[0],A[1],A[2]),l.vertexArray.emplaceBack(D[0],D[1],D[2]),l.vertexArray.emplaceBack(M[0],M[1],M[2]),l.vertexArray.emplaceBack(I[0],I[1],I[2]),l.vertexArray.emplaceBack(A[0],A[1],A[2]),l.vertexArray.emplaceBack(L[0],L[1],L[2]),l.vertexArray.emplaceBack(N[0],N[1],N[2]);const V=x/S/2;l.colorArray.emplaceBack(-V-R,-1,V,.8),l.colorArray.emplaceBack(V+R,-1,V,.8),l.colorArray.emplaceBack(-V,0,V,1.3),l.colorArray.emplaceBack(V,0,V,1.3),l.colorArray.emplaceBack(V+R,-.8,V,.7),l.colorArray.emplaceBack(V+R,-.8,V,.7),l.colorArray.emplaceBack(0,0,V,1.3),l.colorArray.emplaceBack(0,0,V,1.3),l.colorArray.emplaceBack(V+R,-1.2,V,.8),l.colorArray.emplaceBack(V+R,-1.2,V,.8),l.indexArray.emplaceBack(6+h,4+h,8+h),l.indexArray.emplaceBack(7+h,9+h,5+h),l.indexArray.emplaceBack(0+h,1+h,2+h),l.indexArray.emplaceBack(1+h,3+h,2+h),h+=10}const _={defined:!0,emissiveFactor:[0,0,0]},f={};return f.baseColorFactor=mr.white,_.pbrMetallicRoughness=f,l.material=_,l.aabb=new er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}class Yw{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const h=o[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}class B0{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Pu(Jt,16,0),this.featureIndexArray=new pg,this.promoteId=l,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(o,l,h,_,f,b=0,S=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,_,f,b);const R=this.grid;for(let x=0;x<l.length;x++){const I=l[x],A=[1/0,1/0,-1/0,-1/0];for(let D=0;D<I.length;D++){const M=I[D];A[0]=Math.min(A[0],M.x),A[1]=Math.min(A[1],M.y),A[2]=Math.max(A[2],M.x),A[3]=Math.max(A[3],M.y)}0!==S&&(A[0]-=S,A[1]-=S,A[2]+=S,A[3]+=S),A[0]<Jt&&A[1]<Jt&&A[2]>=0&&A[3]>=0&&R.insert(E,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Kf.VectorTile(new zb(this.rawTileData)).layers,this.sourceLayerCoder=new Yw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,h){this.loadVTLayers(),this.serializedLayersCache.clear();const _=np(o.filter),f=o.tileResult,b=o.transform,S=f.bufferedTilespaceBounds,E=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(A,D,M,L)=>Sr(f.bufferedTilespaceGeometry,A,D,M,L));E.sort(Jw);let R=null;b.elevation&&E.length>0&&(R=Ku.create(b.elevation,this.tileID));const x={};let I;for(let A=0;A<E.length;A++){const D=E[A];if(D===I)continue;I=D;const M=this.featureIndexArray.get(D);let L=null;if(this.is3DTile){const N=this.bucketLayerIDs[0][0],V=l[N];if("model"!==V.type)continue;const{queryFeature:q,intersectionZ:$}=V.queryIntersectsMatchingFeature(f,M.featureIndex,_,b);q&&this.appendToResult(x,N,M.featureIndex,q,$)}else this.loadMatchingFeature(x,M,_,o.layers,o.availableImages,l,h,(N,V,q,$=0)=>(L||(L=Ke(N,this.tileID.canonical,o.tileTransform)),V.queryIntersectsFeature(f,N,q,L,this.z,o.transform,o.pixelPosMatrix,R,$)))}return x}loadMatchingFeature(o,l,h,_,f,b,S,E){const{featureIndex:R,bucketIndex:x,sourceLayerIndex:I,layoutVertexArrayOffset:A}=l,D=this.bucketLayerIDs[x];if(_.length&&!function(V,q){for(let $=0;$<V.length;$++)if(q.indexOf(V[$])>=0)return!0;return!1}(_,D))return;const M=this.sourceLayerCoder.decode(I),L=this.vtLayers[M].feature(R);if(h.needGeometry){const V=At(L,!0);if(!h.filter(new ao(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!h.filter(new ao(this.tileID.overscaledZ),L))return;const N=this.getId(L,M);for(let V=0;V<D.length;V++){const q=D[V];if(_.length&&_.indexOf(q)<0)continue;const $=b[q];if(!$)continue;let U={};void 0!==N&&S&&(U=S.getState($.sourceLayer||"_geojsonTileLayer",N));const Z=!E||E(L,$,U,A);if(!Z)continue;const Y=new ed(L,this.z,this.x,this.y,N);let se=this.serializedLayersCache.get(q);se||(se=$.serialize(),se.id=q,this.serializedLayersCache.set(q,se)),Y.layer=ir({},se),Y.tile=this.tileID.canonical,Y.layer.paint=Kw(se.paint,$.paint,L,U,f),Y.layer.layout=Kw(se.layout,$.layout,L,U,f),this.appendToResult(o,q,R,Y,Z)}}appendToResult(o,l,h,_,f){let b=o[l];void 0===b&&(b=o[l]=[]),b.push({featureIndex:h,feature:_,intersectionZ:f})}lookupSymbolFeatures(o,l,h,_,f,b,S){const E={};this.loadVTLayers();const R=np(_);for(const x of o)this.loadMatchingFeature(E,{bucketIndex:l,sourceLayerIndex:h,featureIndex:x,layoutVertexArrayOffset:0},R,f,b,S);return E}loadFeature(o){const{featureIndex:l,sourceLayerIndex:h}=o;this.loadVTLayers();const _=this.sourceLayerCoder.decode(h),f=this.vtFeatures[_];if(f[l])return f[l];const b=this.vtLayers[_].feature(l);return f[l]=b,b}hasLayer(o){for(const l of this.bucketLayerIDs)for(const h of l)if(o===h)return!0;return!1}getId(o,l){let h=o.id;if(this.promoteId){const _="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=_&&(h=o.properties[_]),"boolean"==typeof h&&(h=Number(h))}return h}}function Kw(u,o,l,h,_){return Su(u,(f,b)=>{const S=o instanceof Fd?o.get(b):null;return S&&S.evaluate?S.evaluate(l,h,_):S})}function Jw(u,o){return o-u}xn(B0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const z0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ah{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(o,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const _=h>>4;if(1!==_)throw new Error(`Got v${_} data when expected v1.`);const f=z0[15&h];if(!f)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(o,2,1),[S]=new Uint32Array(o,4,1);return new ah(S,b,f,o)}constructor(o,l=64,h=Float64Array,_){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const f=z0.indexOf(this.ArrayType),b=2*o*this.ArrayType.BYTES_PER_ELEMENT,S=o*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-S%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${h}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+S+E,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+b+S+E),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+S+E,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=o,this.coords[this._pos++]=l,h}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return V0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,h,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:b,nodeSize:S}=this,E=[0,f.length-1,0],R=[];for(;E.length;){const x=E.pop()||0,I=E.pop()||0,A=E.pop()||0;if(I-A<=S){for(let N=A;N<=I;N++){const V=b[2*N],q=b[2*N+1];V>=o&&V<=h&&q>=l&&q<=_&&R.push(f[N])}continue}const D=A+I>>1,M=b[2*D],L=b[2*D+1];M>=o&&M<=h&&L>=l&&L<=_&&R.push(f[D]),(0===x?o<=M:l<=L)&&(E.push(A),E.push(D-1),E.push(1-x)),(0===x?h>=M:_>=L)&&(E.push(D+1),E.push(I),E.push(1-x))}return R}within(o,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:f,nodeSize:b}=this,S=[0,_.length-1,0],E=[],R=h*h;for(;S.length;){const x=S.pop()||0,I=S.pop()||0,A=S.pop()||0;if(I-A<=b){for(let N=A;N<=I;N++)U0(f[2*N],f[2*N+1],o,l)<=R&&E.push(_[N]);continue}const D=A+I>>1,M=f[2*D],L=f[2*D+1];U0(M,L,o,l)<=R&&E.push(_[D]),(0===x?o-h<=M:l-h<=L)&&(S.push(A),S.push(D-1),S.push(1-x)),(0===x?o+h>=M:l+h>=L)&&(S.push(D+1),S.push(I),S.push(1-x))}return E}}function V0(u,o,l,h,_,f){if(_-h<=l)return;const b=h+_>>1;Qw(u,o,b,h,_,f),V0(u,o,l,h,b-1,1-f),V0(u,o,l,b+1,_,1-f)}function Qw(u,o,l,h,_,f){for(;_>h;){if(_-h>600){const R=_-h+1,x=l-h+1,I=Math.log(R),A=.5*Math.exp(2*I/3),D=.5*Math.sqrt(I*A*(R-A)/R)*(x-R/2<0?-1:1);Qw(u,o,l,Math.max(h,Math.floor(l-x*A/R+D)),Math.min(_,Math.floor(l+(R-x)*A/R+D)),f)}const b=o[2*l+f];let S=h,E=_;for(pm(u,o,h,l),o[2*_+f]>b&&pm(u,o,h,_);S<E;){for(pm(u,o,S,E),S++,E--;o[2*S+f]<b;)S++;for(;o[2*E+f]>b;)E--}o[2*h+f]===b?pm(u,o,h,E):(E++,pm(u,o,E,_)),E<=l&&(h=E+1),l<=E&&(_=E-1)}}function pm(u,o,l,h){j0(u,l,h),j0(o,2*l,2*h),j0(o,2*l+1,2*h+1)}function j0(u,o,l){const h=u[o];u[o]=u[l],u[l]=h}function U0(u,o,l,h){const _=u-l,f=o-h;return _*_+f*f}d.$=sg,d.A=class extends ny{},d.B=Cs,d.C=Ph,d.D=Q_,d.E=ln,d.F=Km,d.G=Ru,d.H=Ym,d.I=Jv,d.J=Rd,d.K=Kl,d.L=Yc,d.M=Kh,d.N=Ef,d.O=Hh,d.P=jt,d.Q=Df,d.R=Rh,d.S=Ha,d.T=ih,d.U=$r,d.V=ny,d.W=Vf,d.X=mn,d.Y=Zm,d.Z=function(u){const o=u.value;let l=[];if(!o)return l;const h=Cs(o);return"string"!==h?(l=l.concat([new ny(u.key,o,`string expected, "${h}" found`)]),l):(Ec(o,!0)||(l=l.concat([new ny(u.key,o,`invalid url "${o}"`)])),l)},d._=rt,d.a=function(u){return Te.API_CDN_URL_REGEX.test(u)},d.a$=xc,d.a0=Wr,d.a1=Xt,d.a2=class{constructor(u){this.specification=u}possiblyEvaluate(u,o){return Va(u.expression.evaluate(o))}interpolate(u,o,l){return{x:Wn(u.x,o.x,l),y:Wn(u.y,o.y,l),z:Wn(u.z,o.z,l),azimuthal:Wn(u.azimuthal,o.azimuthal,l),polar:Wn(u.polar,o.polar,l)}}},d.a3=ao,d.a4=Ff,d.a5=je,d.a6=ee,d.a7=Tn,d.a8=Fd,d.a9=Gu,d.aA=Vi,d.aB=v0,d.aC=_w,d.aD=Jb,d.aE=function(u,o){const l=document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let h=0;h<u.length;h++){const _=document.createElement("source");sl(u[h])||(l.crossOrigin="Anonymous"),_.src=u[h],l.appendChild(_)}return{cancel:()=>{}}},d.aF=am,d.aG=function(u){return fetch(u).then(o=>o.arrayBuffer()).then(o=>N0(o,0,u))},d.aH=As,d.aI=class{constructor(u,o,l,h){this.id=u,this.position=null!=o?new F(o[0],o[1]):new F(0,0),this.orientation=null!=l?l:[0,0,0],this.nodes=h,this.uploaded=!1,this.aabb=new er([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(u,o){if(ee.mat4.multiply(u.matrix,o,u.matrix),u.meshes)for(const l of u.meshes){const h=er.applyTransformFast(l.aabb,u.matrix);this.aabb.encapsulate(h)}if(u.children)for(const l of u.children)this._applyTransformations(l,u.matrix)}computeBoundsAndApplyParent(){const u=ee.mat4.identity([]);for(const o of this.nodes)this._applyTransformations(o,u)}computeModelMatrix(u,o,l,h,_,f,b=!1){Ew(this.matrix,this,u.transform,this.position,o,l,h,_,f,b)}upload(u){if(!this.uploaded){for(const o of this.nodes)D0(o,u);for(const o of this.nodes)Op(o);this.uploaded=!0}}destroy(){for(const u of this.nodes)Zg(u)}},d.aJ=Ys,d.aK=function(u){return u.indexOf("\x1f")>=0},d.aL=th,d.aM=pe,d.aN=be,d.aO=Nu,d.aP=Nr,d.aQ=bo,d.aR=hg,d.aS=om,d.aT=function(){na.isLoading()||na.isLoaded()||"deferred"!==og()||K_()},d.aU=np,d.aV=At,d.aW=ed,d.aX=Ih,d.aY=Bv,d.aZ=Mv,d.a_=Ke,d.aa=Wn,d.ab=Jt,d.ac=Vc,d.ad=class{constructor(u){this.specification=u}possiblyEvaluate(u,o){return function([l,h]){const _=Va([1,l,h]);return{x:_.x,y:_.y,z:_.z}}(u.expression.evaluate(o))}interpolate(u,o,l){return{x:Wn(u.x,o.x,l),y:Wn(u.y,o.y,l),z:Wn(u.z,o.z,l)}}},d.ae=function(u,o,l=0,h=!0){const _=new jt(l,l),f=u.sub(_),b=o.add(_),S=[f,new jt(b.x,f.y),b,new jt(f.x,b.y)];return h&&S.push(f.clone()),S},d.af=function(u,o){const l=[];for(let h=0;h<u.length;h++){const _=tr(h-1,-1,u.length-1),f=tr(h+1,-1,u.length-1),b=u[h],S=u[f],E=u[_].sub(b).unit(),R=S.sub(b).unit(),x=R.angleWithSep(E.x,E.y),I=E.add(R).unit().mult(-1*o/Math.sin(x/2));l.push(b.add(I))}return l},d.ag=jg,d.ah=Sr,d.ai=function(u,o,l=0){return ee.vec3.fromValues(((o.x-l)*u.scale-u.x)*Jt,(o.y*u.scale-u.y)*Jt,ye(o.z,o.y))},d.aj=Ma,d.ak=Lb,d.al=function(u){let o=1/0,l=1/0,h=-1/0,_=-1/0;for(const f of u)o=Math.min(o,f.x),l=Math.min(l,f.y),h=Math.max(h,f.x),_=Math.max(_,f.y);return{min:new jt(o,l),max:new jt(h,_)}},d.am=K,d.an=Bi,d.ao=Oe,d.ap=Pt,d.aq=Us,d.ar=function(u,o){const l={};for(let h=0;h<o.length;h++){const _=o[h];_ in u&&(l[_]=u[_])}return l},d.as=j,d.at=ne,d.au=class{constructor(u){this.entries={},this.scheduler=u}request(u,o,l,h){const _=this.entries[u]=this.entries[u]||{callbacks:[]};if(_.result){const[f,b]=_.result;return this.scheduler?this.scheduler.add(()=>{h(f,b)},o):h(f,b),()=>{}}return _.callbacks.push(h),_.cancel||(_.cancel=l((f,b)=>{_.result=[f,b];for(const S of _.callbacks)this.scheduler?this.scheduler.add(()=>{S(f,b)},o):S(f,b);setTimeout(()=>delete this.entries[u],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(f=>f!==h),_.callbacks.length||(_.cancel(),delete this.entries[u]))}}},d.av=qa,d.aw=function(u,o,l){const h=JSON.stringify(u.request);return u.data&&(this.deduped.entries[h]={result:[null,u.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},_=>{const f=md(u.request,(b,S,E,R)=>{b?_(b):S&&_(null,{vectorTile:l?void 0:new Kf.VectorTile(new zb(S)),rawData:S,cacheControl:E,expires:R})});return()=>{f.cancel(),_()}},o)},d.ax=function(u){uo++,uo>ti&&(u.getActor().send("enforceCacheSizeLimit",ai),uo=0)},d.ay=qt,d.az=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log(u)/Math.LN2))},d.b=function(u){return Te.API_FONTS_REGEX.test(u)},d.b$=Aa,d.b0=nb,d.b1=Ll,d.b2=Lo,d.b3=wg,d.b4=sm,d.b5=function(u,o){const l=Gu(o.zoom);if(0===l)return Hu(u);const h=ub(u),_=bg(h),f=K(h.getWest())*o.worldSize,b=K(h.getEast())*o.worldSize,S=ne(h.getNorth())*o.worldSize,E=ne(h.getSouth())*o.worldSize,R=[f,S,0],x=[b,S,0],I=[f,E,0],A=[b,E,0],D=ee.mat4.invert([],o.globeMatrix);return ee.vec3.transformMat4(R,R,D),ee.vec3.transformMat4(x,x,D),ee.vec3.transformMat4(I,I,D),ee.vec3.transformMat4(A,A,D),_[0]=ml(_[0],I,l),_[1]=ml(_[1],A,l),_[2]=ml(_[2],x,l),_[3]=ml(_[3],R,l),er.fromPoints(_)},d.b6=hb,d.b7=yg,d.b8=ml,d.b9=op,d.bA=mr,d.bB=tr,d.bC=ri,d.bD=pd,d.bE=te,d.bF=function(u,o,l){u[4*o+0]=l[0],u[4*o+1]=l[1],u[4*o+2]=l[2],u[4*o+3]=l[3]},d.bG=Zf,d.bH=tc,d.bI=fg,d.bJ=os,d.bK=ju,d.bL=F,d.bM=SD,d.bN=qi,d.bO=fl,d.bP=gl,d.bQ=Fo,d.bR=pv,d.bS=function(u,o,l,h,_,f,b,S,E){if("globe"===E.name)return pv(u,o,new Fo(l,h,_),!1);const R=th({z:l,x:h,y:_},E);return new er([(f+R.x/R.scale)*o,o*(R.y/R.scale),b],[(f+R.x2/R.scale)*o,o*(R.y2/R.scale),S])},d.bT=function(u,o,l){let h=0;for(let _=0;_<2;++_)u[_]>0&&(h+=(u[_]-0)*(u[_]-0)),o[_]<0&&(h+=(0-o[_])*(0-o[_]));return h},d.bU=we,d.bV=6,d.bW=function(u){const o=ee.mat4.identity(new Float64Array(16));ee.mat4.multiply(o,u.pixelMatrix,u.globeMatrix);const l=[0,v,0],h=[0,w,0];return ee.vec3.transformMat4(l,l,o),ee.vec3.transformMat4(h,h,o),[l[0]>0&&l[0]<=u.width&&l[1]>0&&l[1]<=u.height&&!_v(u,new F(u.center.lat,90)),h[0]>0&&h[0]<=u.width&&h[1]>0&&h[1]<=u.height&&!_v(u,new F(u.center.lat,-90))]},d.bX=function(u,o){const{scale:l}=u.tileTransform,h=l*Jt/(u.tileSize*Math.pow(2,o.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return ee.mat2.scale(new Float32Array(4),o.inverseAdjustmentMatrix,[h,h])},d.bY=Wg,d.bZ=yw,d.b_=function(u){const o=yw(u,!0);return ee.mat2.invert([],[o[0],o[1],o[4],o[5]])},d.ba=ds,d.bb=Qg,d.bc=zb,d.bd=md,d.be=function(u){const o=[];for(const l in u)o.push(u[l]);return o},d.bf=function(u,o){const l=[];for(const h in u)h in o||l.push(h);return l},d.bg=vr,d.bh=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.bi=to,d.bj=function(u,o){const{x:l,y:h}=u.point,_=pb(l,h,u.worldSize/u._pixelsPerMercatorPixel,0,0);return ee.mat4.multiply(_,_,fv(Hu(o)))},d.bk=Ep,d.bl=Ol,d.bm=Bb,d.bn=function(u,o,l,h,_){const f=5*o+2;u.float32[f+0]=l,u.float32[f+1]=h,u.float32[f+2]=_},d.bo=Dc,d.bp=rw,d.bq=It,d.br=24,d.bs=E1,d.bt=S0,d.bu=QC,d.bv=eD,d.bw=Gb,d.bx=rc,d.by=Xv,d.bz=ah,d.c=ke,d.c$=Rr,d.c0=function(u){const{x:o,y:l}=u.point,{lng:h,lat:_}=u._center;return pb(o,l,u.worldSize,h,_)},d.c1=Pe,d.c2=or,d.c3=5,d.c4=function(u){const o=Math.round((u+45+360)%360/90)%4;return ie[o]},d.c5=45,d.c6=Q,d.c7=Xf,d.c8=function(u,o,l){const h=Math.sqrt(u*u+o*o+l*l),_=h>0?Math.acos(l/h)*_o:0;let f=0!==u||0!==o?Math.atan2(-o,-u)*_o+90:0;return f<0&&(f+=360),[h,f,_]},d.c9=Le,d.cA=function(u){const o=we-5;u=Pt(u,-o,o)/o*90;const l=Math.pow(Math.abs(Math.sin(ri(u))),3);return Math.round(l*(g.length-1))},d.cB=function(u,o,l,h){const _=o.getNorth(),f=o.getSouth(),b=o.getWest(),S=o.getEast(),E=1<<u.z,R=S-b,x=_-f,I=R/c,A=-x/g[l],D=[0,I,0,A,0,0,_,b,0];if(u.z>0){const M=180/h;ee.mat3.multiply(D,D,[M/R+1,0,0,0,M/x+1,0,-.5*M/I,.5*M/A,1])}return D[2]=E,D[5]=u.x,D[8]=u.y,D},d.cC=Hu,d.cD=function(u,o,l){const h=ee.mat4.identity(new Float64Array(16)),_=(o/(1<<u)-.5)*Math.PI*2;return ee.mat4.rotateY(h,l.globeMatrix,_),Float32Array.from(h)},d.cE=class{isDataAvailableAtPoint(u){const o=this._source();if(this.isUsingMockSource()||!o||u.y<0||u.y>1)return!1;const l=o.getSource().maxzoom,h=1<<l,_=Math.floor(u.x),f=Math.floor((u.x-_)*h),b=Math.floor(u.y*h),S=this.findDEMTileFor(new Vi(l,_,l,f,b));return!(!S||!S.dem)}getAtPointOrZero(u,o=0){return this.getAtPoint(u,o)||0}getAtPoint(u,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const h=this._source();if(!h||u.y<0||u.y>1)return o;const _=h.getSource().maxzoom,f=1<<_,b=Math.floor(u.x),S=u.x-b,E=new Vi(_,b,_,Math.floor(S*f),Math.floor(u.y*f)),R=this.findDEMTileFor(E);if(!R||!R.dem)return o;const x=R.dem,I=1<<R.tileID.canonical.z,A=(S*I-R.tileID.canonical.x)*x.dim,D=(u.y*I-R.tileID.canonical.y)*x.dim,M=Math.floor(A),L=Math.floor(D);return(l?this.exaggeration():1)*Wn(Wn(x.get(M,L),x.get(M,L+1),D-L),Wn(x.get(M+1,L),x.get(M+1,L+1),D-L),A-M)}getAtTileOffset(u,o,l){const h=1<<u.canonical.z;return this.getAtPointOrZero(new je(u.wrap+(u.canonical.x+o/Jt)/h,(u.canonical.y+l/Jt)/h))}getAtTileOffsetFunc(u,o,l,h){return _=>{const f=this.getAtTileOffset(u,_.x,_.y),b=h.upVector(u.canonical,_.x,_.y),S=h.upVectorScale(u.canonical,o,l).metersToTile;return ee.vec3.scale(b,b,f*S),b}}getForTilePoints(u,o,l,h){if(this.isUsingMockSource())return!1;const _=Ku.create(this,u,h);return!!_&&(o.forEach(f=>{f[2]=this.exaggeration()*_.getElevationAt(f[0],f[1],l)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(u);if(!o||!o.dem)return null;const l=o.dem.tree,h=o.tileID,_=1<<u.canonical.z-h.canonical.z;let f=u.canonical.x/_-h.canonical.x,b=u.canonical.y/_-h.canonical.y,S=0;for(let E=0;E<u.canonical.z-h.canonical.z&&!l.leaves[S];E++){f*=2,b*=2;const R=2*Math.floor(b)+Math.floor(f);S=l.childOffsets[S]+R,f%=1,b%=1}return{min:this.exaggeration()*l.minimums[S],max:this.exaggeration()*l.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(0===u.length)return null;let o=!1,l=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const _ of u){const f=this.getMinMaxForTile(_.tileID);f&&(l=Math.min(l,f.min),h=Math.max(h,f.max),o=!0)}return o?{min:l,max:h}:null}},d.cF=bb,d.cG=$d,d.cH=function(u,o){return[Math.pow(u[0],2.2)*o,Math.pow(u[1],2.2)*o,Math.pow(u[2],2.2)*o]},d.cI=gv,d.cJ=he,d.cK=re,d.cL=256,d.cM=function(u,o){const l=[0,0,0],h=hb(Hu(o.canonical));return ee.vec3.transformMat4(l,l,h),ee.vec3.transformMat4(l,l,u),l},d.cN=u=>({u_camera_to_center_distance:new os(u),u_extrude_scale:new Uu(u),u_device_pixel_ratio:new os(u),u_matrix:new Zf(u),u_inv_rot_matrix:new Zf(u),u_merc_center:new tc(u),u_tile_id:new fg(u),u_zoom_transition:new os(u),u_up_dir:new fg(u),u_emissive_strength:new os(u)}),d.cO=u=>({u_matrix:new Zf(u),u_pixels_to_tile_units:new Uu(u),u_device_pixel_ratio:new os(u),u_units_to_pixels:new tc(u),u_dash_image:new ju(u),u_gradient_image:new ju(u),u_image_height:new os(u),u_texsize:new tc(u),u_tile_units_to_pixels:new os(u),u_alpha_discard_threshold:new os(u),u_trim_offset:new tc(u),u_trim_fade_range:new tc(u),u_trim_color:new Xf(u),u_emissive_strength:new os(u),u_zbias_factor:new os(u),u_tile_to_meter:new os(u)}),d.cP=u=>({u_matrix:new Zf(u),u_texsize:new tc(u),u_pixels_to_tile_units:new Uu(u),u_device_pixel_ratio:new os(u),u_image:new ju(u),u_units_to_pixels:new tc(u),u_tile_units_to_pixels:new os(u),u_alpha_discard_threshold:new os(u),u_trim_offset:new tc(u),u_emissive_strength:new os(u),u_zbias_factor:new os(u),u_tile_to_meter:new os(u)}),d.cQ=Rl,d.cR=dR,d.cS=uD,d.cT=bv,d.cU=(u,o,l,h,_,f)=>{const b=u.transform,S="globe"===b.projection.name;let E;if("map"===f.paint.get("circle-pitch-alignment"))if(S){const x=gv(b.zoom,o.canonical)*b._pixelsPerMercatorPixel;E=Float32Array.from([x,0,0,x])}else E=b.calculatePixelsToTileUnitsMatrix(l);else E=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(b.projection),u_matrix:u.translatePosMatrix(o.projMatrix,l,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:hn.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:yp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(S){R.u_inv_rot_matrix=h,R.u_merc_center=_,R.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],R.u_zoom_transition=Gu(b.zoom);const x=_[0]*Jt,I=_[1]*Jt;R.u_up_dir=b.projection.upVector(new Fo(0,0,0),x,I)}return R},d.cV=Xu,d.cW=(u,o,l,h,_,f)=>{const b=u.transform,S=b.pitch<15?Ob(.07,.7,Pt((14-b.zoom)/5,0,1)):.07;return{u_matrix:Fb(u,o,l,h),u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:G1(o,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:f,u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:S,u_tile_to_meter:Le(o.tileID.canonical,0)}},d.cX=(u,o,l,h,_,f,b)=>{const S=u.transform,E=S.calculatePixelsToTileUnitsMatrix(o),R=S.pitch<15?Ob(.07,.7,Pt((14-S.zoom)/5,0,1)):.07;return{u_matrix:Fb(u,o,l,h),u_pixels_to_tile_units:E,u_device_pixel_ratio:f,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:q1(l)&&o.lineAtlasTexture?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:G1(o,u.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toRenderColor(l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:R,u_tile_to_meter:Le(o.tileID.canonical,0)}},d.cY=Hl,d.cZ=qu,d.c_=N1,d.ca=er,d.cb=Va,d.cc=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},d.cd=function(u){return u({pluginStatus:gr,pluginURL:Is}),rg.on("pluginStateChange",u),u},d.ce=Np,d.cf=Zo,d.cg=Ap,d.ch=e0,d.ci=Bm,d.cj=Y_,d.ck=Qn,d.cl=wa,d.cm=ol,d.cn=function(u){const o=u.indexOf("\x1f");return o>=0?u.slice(0,o):u},d.co=function(u){const o=u.indexOf("\x1f");return o>=0?u.slice(o+1):""},d.cp=function(u){const o=[],l=u.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===u.render&&o.push({message:`layers.${l}: missing required method "render"`}),u.renderingMode&&"2d"!==u.renderingMode&&"3d"!==u.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},d.cq=function(u,o,l,h){return"custom"===u.type?new bw(u,o):new A0[u.type](u,o,l,h)},d.cr=Tu,d.cs=rg,d.ct=fd,d.cu=pp,d.cv=class extends wc{constructor(u){super(u),this.current=mp}set(u,o,l){if(this.fetchUniformLocation(u,o))for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},d.cw=ue,d.cx=function(u,o,l){const h=Gu(l.zoom),_=u.style.map._antialias,f=o.options.extStandardDerivativesForceOff||u.terrain&&u.terrain.exaggeration()>0;return 0===h&&!_&&!f},d.cy=function(u){const o=u.pixelsPerMeter,l=o/te(1,u.center.lat),h=ee.mat4.identity(new Float64Array(16));return ee.mat4.translate(h,h,[u.point.x,u.point.y,0]),ee.mat4.scale(h,h,[l,l,o]),Float32Array.from(h)},d.cz=ub,d.d=function(u){return Te.API_TILEJSON_REGEX.test(u)},d.d$=Qe,d.d0=Tp,d.d1=cu,d.d2=450,d.d3=7,d.d4=y0,d.d5=nr,d.d6=dg,d.d7=256,d.d8=fv,d.d9=tu,d.dA=fb,d.dB=function(u){const o=[0,0,0],l=ee.mat4.identity(new Float64Array(16));return ee.mat4.multiply(l,u.pixelMatrix,u.globeMatrix),ee.vec3.transformMat4(o,o,l),new jt(o[0],o[1])},d.dC=function(u,o,l=!1){if(gr===ig||gr===Qh||gr===bs)throw new Error("setRTLTextPlugin cannot be called multiple times.");Is=hn.resolveURL(u),gr=ig,Al=o,Ld(),l||K_()},d.dD=og,d.dE=function(){Zo().acquire(dn)},d.dF=function(){const u=Uo;u&&(u.isPreloaded()&&1===u.numActive()?(u.release(dn),Uo=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.dG=e_,d.dH=function(u){const o=Ti();if(!o)return;const l=o.delete(ui);u&&l.catch(u).then(()=>u())},d.dI=de,d.dJ=dm,d.dK=function(u){Zr=hn.resolveURL(u),Zt||(Zt=new Np(Zo(),new ln)),Zt.broadcast("setDracoUrl",Zr)},d.dL=Hw,d.dM=function(u){Up=hn.resolveURL(u),Zt||(Zt=new Np(Zo(),new ln)),Zt.broadcast("setMeshoptUrl",Up)},d.dN=xn,d.dO=ou,d.dP=2,d.dQ=Yw,d.dR=B0,d.dS=U1,d.dT=Su,d.dU=Qv,d.dV=function(u,o,l,h,_,f,b,S,E,R,x=1,I){u.createArrays(),u.tilePixelRatio=Jt/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const A=u.layers[0].layout,D=u.layers[0]._unevaluatedLayout._values,M={};if(M.scaleFactor=x,M.textSizeScaleRange=A.get("text-size-scale-range"),M.iconSizeScaleRange=A.get("icon-size-scale-range"),M.textScaleFactor=Pt(M.scaleFactor,M.textSizeScaleRange[0],M.textSizeScaleRange[1]),M.iconScaleFactor=Pt(M.scaleFactor,M.iconSizeScaleRange[0],M.iconSizeScaleRange[1]),"composite"===u.textSizeData.kind){const{minZoom:q,maxZoom:$}=u.textSizeData;M.compositeTextSizes=[D["text-size"].possiblyEvaluate(new ao(q),S),D["text-size"].possiblyEvaluate(new ao($),S)]}if("composite"===u.iconSizeData.kind){const{minZoom:q,maxZoom:$}=u.iconSizeData;M.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new ao(q),S),D["icon-size"].possiblyEvaluate(new ao($),S)]}M.layoutTextSize=D["text-size"].possiblyEvaluate(new ao(E+1),S),M.layoutIconSize=D["icon-size"].possiblyEvaluate(new ao(E+1),S),M.textMaxSize=D["text-size"].possiblyEvaluate(new ao(18),S);const L="map"===A.get("text-rotation-alignment")&&"point"!==A.get("symbol-placement"),N=A.get("text-size");let V=!1;for(const q of u.features)if(q.icon&&q.icon.nameSecondary){V=!0;break}for(const q of u.features){const $=A.get("text-font").evaluate(q,{},S).join(","),U=N.evaluate(q,{},S)*M.textScaleFactor,Z=M.layoutTextSize.evaluate(q,{},S)*M.textScaleFactor,Y=(M.layoutIconSize.evaluate(q,{},S),{horizontal:{},vertical:void 0}),se=q.text;let ve,W=[0,0];if(se){const me=se.toString(),Me=24*A.get("text-letter-spacing").evaluate(q,{},S),Ne=24*A.get("text-line-height").evaluate(q,{},S),ze=Qm(me)?Me:0,$e=A.get("text-anchor").evaluate(q,{},S),nt=A.get("text-variable-anchor");if(!nt){const gt=A.get("text-radial-offset").evaluate(q,{},S);W=gt?rc($e,[24*gt,Ub]):A.get("text-offset").evaluate(q,{},S).map(gn=>24*gn)}let st=L?"center":A.get("text-justify").evaluate(q,{},S);const Je="point"===A.get("symbol-placement"),St=Je?24*A.get("text-max-width").evaluate(q,{},S):1/0,$t=gt=>{u.allowVerticalPlacement&&Jm(me)&&(Y.vertical=$v(se,o,l,_,$,St,Ne,$e,gt,ze,W,Ol.vertical,!0,Z,U))};if(!L&&nt){const gt="auto"===st?nt.map(on=>Gb(on)):[st];let gn=!1;for(let on=0;on<gt.length;on++){const Kt=gt[on];if(!Y.horizontal[Kt])if(gn)Y.horizontal[Kt]=Y.horizontal[0];else{const Ht=$v(se,o,l,_,$,St,Ne,"center",Kt,ze,W,Ol.horizontal,!1,Z,U);Ht&&(Y.horizontal[Kt]=Ht,gn=1===Ht.positionedLines.length)}}$t("left")}else{if("auto"===st&&(st=Gb($e)),Je||A.get("text-writing-mode").indexOf("horizontal")>=0||!Jm(me)){const gt=$v(se,o,l,_,$,St,Ne,$e,st,ze,W,Ol.horizontal,!1,Z,U);gt&&(Y.horizontal[st]=gt)}$t(Je?"left":st)}}let ce=!1;if(q.icon&&q.icon.namePrimary){const me=h[q.icon.namePrimary];me&&(ve=Zv(_[q.icon.namePrimary],q.icon.nameSecondary?_[q.icon.nameSecondary]:void 0,A.get("icon-offset").evaluate(q,{},S),A.get("icon-anchor").evaluate(q,{},S)),ce=me.sdf,void 0===u.sdfIcons?u.sdfIcons=me.sdf:u.sdfIcons!==me.sdf&&ji("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(me.pixelRatio!==u.pixelRatio||0!==A.get("icon-rotate").constantOr(1))&&(u.iconsNeedLinear=!0))}const Se=r0(Y.horizontal)||Y.vertical;u.iconsInText||(u.iconsInText=!!Se&&Se.iconsInText),(Se||ve)&&yD(u,q,Y,ve,h,M,Z,0,W,ce,b,S,R,I,V)}f&&u.generateCollisionDebugBuffers(E,u.collisionBoxArray,M.textScaleFactor)},d.dW=Kf,d.dX=sy,d.dY=Dt,d.dZ=C1,d.d_=J1,d.da=Ud,d.db=cg,d.dc=function(u,o,l,h,_){return Pt((u-o)/(l-o)*(_-h)+h,h,_)},d.dd=Au,d.de=Ce,d.df=class{constructor(u,o,l,h){this.context=u,this.format=h,this.size=l,this.texture=u.gl.createTexture();const[_,f,b]=this.size,{gl:S}=u;S.bindTexture(S.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),S.texImage3D(S.TEXTURE_3D,0,this.format,_,f,b,0,nh(this.format),qg(this.format),o.data)}bind(u,o){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_3D,this.texture),u!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,u),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,u),this.minFilter=u),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},d.dg=w0,d.dh=[1,1,1],d.di=Ku,d.dj=lm,d.dk=nu,d.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new jt(1/0,1/0),max:new jt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,o=!1){const l=I1(new jt(0,0),new jt(Jt,Jt),u),h=[];if(o&&!Cb(l,this._globalClipBounds))return h;for(const _ of this._activeRegions){if(_.hiddenByOverlap||!Cb(l,_))continue;const f=JC(_.min,_.max,u);h.push({min:f.min,max:f.max,sourceId:this._sourceIds[_.priority],footprint:_.footprint,footprintTileId:_.tileId,order:_.order,clipMask:_.clipMask,clipScope:_.clipScope})}return h}setSources(u){this._setSources(u.map(o=>({getSourceId:()=>o.cache.id,getFootprints:()=>{const l=[];for(const h of o.cache.getVisibleCoordinates()){const _=o.cache.getTile(h).buckets[o.layer];_&&_.updateFootprints(h.toUnwrapped(),l)}return l},getOrder:()=>o.order,getClipMask:()=>o.clipMask,getClipScope:()=>o.clipScope})))}_addSource(u){const o=u.getFootprints();if(0===o.length)return;const l=u.getOrder(),h=u.getClipMask(),_=u.getClipScope();for(const f of o){if(!f.footprint)continue;const b=I1(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:b.min,max:b.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:l,clipMask:h,clipScope:_})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((o,l)=>o.priority-l.priority||Tb(o.min,l.min)||Tb(o.max,l.max)||o.order-l.order||o.clipMask-l.clipMask||function(h,_){const f=(b,S)=>b+S;return h.length-_.length||h.reduce(f,"").localeCompare(_.reduce(f,""))}(o.clipScope,l.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let o=0;for(;!u&&o!==this._activeRegions.length;){const l=this._activeRegions[o],h=this._prevRegions[o];u=l.priority!==h.priority||!hs(l,h)||l.order!==h.order||l.clipMask!==h.clipMask||!to(l.clipScope,h.clipScope),++o}}if(u){++this._updateTime;for(const l of this._activeRegions)l.order!==no&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,l.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,l.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,l.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,l.max.y));const o=l=>{const h=this._activeRegions;if(l>=h.length)return l;const _=h[l].priority;for(;l<h.length&&h[l].priority===_;)++l;return l};if(this._sourceIds.length>1){let l=0,h=o(l);for(;l!==h;){let _=l;const f=l;for(;_!==h;){const b=this._activeRegions[_];b.hiddenByOverlap=!1;for(let S=0;S<f;S++){const E=this._activeRegions[S];if(!E.hiddenByOverlap&&b.order===no&&Cb(b,E)&&(b.hiddenByOverlap=A1(b.footprint,b.tileId,E.footprint,E.tileId),b.hiddenByOverlap))break}++_}l=h,h=o(l)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let o=u.length-1;o>=0;o--)this._addSource(u[o]);this._computeReplacement()}},d.dm=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,o){const l=new xc,h=new Nr,_=[],f=u+1+2,b=o[0]+1,S=o[0]+1+(1+o.length),E=(R,x,I)=>{let A=R===f-1?R-2:0===R?R:R-1;return A+=I?24575:0,[A,x]};for(let R=0;R<f;++R)l.emplaceBack(...E(R,0,!0));for(let R=0;R<b;++R)for(let x=0;x<f;++x)l.emplaceBack(...E(x,R,(0===x||x===f-1)&&!0));for(let R=0;R<o.length;++R){const x=o[R];for(let I=0;I<f;++I)l.emplaceBack(...E(I,x,!0))}for(let R=0;R<o.length;++R){const x=h.length,I=o[R]+1+2,A=new Nr;for(let L=0;L<I-1;L++){const N=L===I-2,V=N?f*(S-o.length+R-L):f;for(let q=0;q<f-1;q++){const $=L*f+q;0===L||N||0===q||q===f-2?(A.emplaceBack($+1,$,$+V),A.emplaceBack($+V,$+V+1,$+1)):(h.emplaceBack($+1,$,$+V),h.emplaceBack($+V,$+V+1,$+1))}}const D=Lo.simpleSegment(0,x,l.length,h.length-x);for(let L=0;L<A.uint16.length;L+=3)h.emplaceBack(A.uint16[L],A.uint16[L+1],A.uint16[L+2]);const M=Lo.simpleSegment(0,x,l.length,h.length-x);_.push({withoutSkirts:D,withSkirts:M})}return{vertices:l,indices:h,segments:_}}_createGrid(u){const o=this._fillGridMeshWithLods(c,g);this._gridSegments=o.segments,this._gridBuffer=u.createVertexBuffer(o.vertices,Ll.members),this._gridIndexBuffer=u.createIndexBuffer(o.indices,!0)}_createPoles(u){const o=new Nr;for(let b=0;b<=c;b++)o.emplaceBack(0,b+1,b+2);this._poleIndexBuffer=u.createIndexBuffer(o,!0);const l=new Ud,h=new Ud,_=new Ud,f=new Ud;this._poleSegments=[];for(let b=0,S=0;b<5;b++){const E=360/(1<<b);l.emplaceBack(0,-Us,0,.5,0),h.emplaceBack(0,-Us,0,.5,1),_.emplaceBack(0,-Us,0,.5,.5),f.emplaceBack(0,-Us,0,.5,.5);for(let R=0;R<=c;R++){let x=R/c,I=0;const A=Wn(0,E,x),[D,M,L]=C(l1,c1,A,Us);l.emplaceBack(D,M,L,x,I),h.emplaceBack(D,M,L,x,1-I);const N=ri(A);x=.5+.5*Math.sin(N),I=.5+.5*Math.cos(N),_.emplaceBack(D,M,L,x,I),f.emplaceBack(D,M,L,x,1-I)}this._poleSegments.push(Lo.simpleSegment(S,0,66,64)),S+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(l,Xr,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(h,Xr,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(_,Xr,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(f,Xr,!1)}getGridBuffers(u,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,o){return[o?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,o?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},d.dn=no,d.dp=Ze,d.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},d.dr=Et,d.ds=Ie,d.dt=k,d.du=function([u,o,l]){const h=Math.hypot(u,o,l),_=Math.atan2(u,l),f=.5*Math.PI-Math.acos(-o/h);return new F(Pe(_),Pe(f))},d.dv=vw,d.dw=O,d.dx=function(u){const o=u.navigator?u.navigator.userAgent:null;return!!function(l){if(null==Mh){const h=l.navigator?l.navigator.userAgent:null;Mh=!!l.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return Mh}(u)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},d.dy=function(u,o){ai=u,ti=o},d.dz=_v,d.e=Te,d.e0=function(u){let o=0;if(new Uint32Array(u,0,1)[0]!==dy){const l=new Uint32Array(u,0,7),[,,h,_,f,b]=l;o=l.byteLength+_+f+b+f,(h!==u.byteLength||o>=u.byteLength)&&ji("Invalid b3dm header information.")}return N0(u,o)},d.e1=function(u,o){const l=As(u);for(const h of l){for(const _ of h.meshes)Zw(_);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(WD(h.lights,o)))}return l},d.e2=Yg,d.e3=Rw,d.e4=na,d.e5=function(u){xr(),null!=ki&&ki.then(o=>{o.keys().then(l=>{for(let h=0;h<l.length-u;h++)o.delete(l[h])})})},d.f=function(u){return 0===u.indexOf("mapbox:")},d.g=function(u,o){return fd(ir(u,{method:"GET"}),o)},d.h=He,d.i=function(u){return Te.API_STYLE_REGEX.test(u)&&!ke(u)},d.j=function(u){return decodeURIComponent(atob(u).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))},d.k=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(o,l)=>String.fromCharCode(Number("0x"+l))))},d.l=ir,d.m=Ns,d.n=function(u,o){return fd(ir(u,{type:"json"}),o)},d.o=ho,d.p=function(u,o){return fd(ir(u,{method:"POST"}),o)},d.q=hn,d.r=Hs,d.s=function(u){try{const o=self[u];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(o){return!1}},d.t=Pi,d.u=function(){return function u(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},d.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},d.w=ji,d.x=dr,d.y=2,d.z=Kv}),et(0,function(d){function Qe(ht){const re=ht?ht.url.toString():void 0;return re?performance.getEntriesByName(re):[]}function xt(ht){if("number"==typeof ht||"boolean"==typeof ht||"string"==typeof ht||null==ht)return JSON.stringify(ht);if(Array.isArray(ht)){let he="[";for(const Te of ht)he+=`${xt(Te)},`;return`${he}]`}let re="{";for(const he of Object.keys(ht).sort())re+=`${he}:${xt(ht[he])},`;return`${re}}`}function De(ht){let re="";for(const he of d.bh)re+=`/${xt(ht[he])}`;return re}class Tt{constructor(re){this.keyCache={},this._layers={},this._layerConfigs={},re&&this.replace(re)}replace(re,he){this._layerConfigs={},this._layers={},this.update(re,[],he)}update(re,he,Te){this._options=Te;for(const ke of re)this._layerConfigs[ke.id]=ke,(this._layers[ke.id]=d.cq(ke,this.scope,null,this._options)).compileFilter(Te),this.keyCache[ke.id]&&delete this.keyCache[ke.id];for(const ke of he)delete this.keyCache[ke],delete this._layerConfigs[ke],delete this._layers[ke];this.familiesBySource={};const He=function(ke,Ye){const pt={};for(let ut=0;ut<ke.length;ut++){const vt=Ye&&Ye[ke[ut].id]||De(ke[ut]);Ye&&(Ye[ke[ut].id]=vt);let wt=pt[vt];wt||(wt=pt[vt]=[]),wt.push(ke[ut])}const tt=[];for(const ut in pt)tt.push(pt[ut]);return tt}(d.be(this._layerConfigs),this.keyCache);for(const ke of He){const Ye=ke.map(qt=>this._layers[qt.id]),pt=Ye[0];if("none"===pt.visibility)continue;const tt=pt.source||"";let ut=this.familiesBySource[tt];ut||(ut=this.familiesBySource[tt]={});const vt=pt.sourceLayer||"_geojsonTileLayer";let wt=ut[vt];wt||(wt=ut[vt]=[]),wt.push(Ye)}}}const zt=1*d.dP;class en{constructor(re){const he={},Te=[];for(const pt in re){const tt=re[pt],ut=he[pt]={};for(const vt in tt.glyphs){const wt=tt.glyphs[+vt];if(!wt||0===wt.bitmap.width||0===wt.bitmap.height)continue;const qt=wt.metrics.localGlyph?zt:1,hn={x:0,y:0,w:wt.bitmap.width+2*qt,h:wt.bitmap.height+2*qt};Te.push(hn),ut[vt]=hn}}const{w:He,h:ke}=d.z(Te),Ye=new d.dO({width:He||1,height:ke||1});for(const pt in re){const tt=re[pt];for(const ut in tt.glyphs){const vt=tt.glyphs[+ut];if(!vt||0===vt.bitmap.width||0===vt.bitmap.height)continue;const wt=he[pt][ut],qt=vt.metrics.localGlyph?zt:1;d.dO.copy(vt.bitmap,Ye,{x:0,y:0},{x:wt.x+qt,y:wt.y+qt},vt.bitmap)}}this.image=Ye,this.positions=he}}d.dN(en,"GlyphAtlas");class Gt{constructor(re){this.tileID=new d.aA(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.lut=re.lut,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.scope=re.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.request&&re.request.collectResourceTiming,this.promoteId=re.promoteId,this.isSymbolTile=re.isSymbolTile,this.tileTransform=d.aL(re.tileID.canonical,re.projection),this.projection=re.projection,this.worldview=re.worldview,this.localizableLayerIds=re.localizableLayerIds,this.brightness=re.brightness,this.extraShadowCaster=!!re.extraShadowCaster,this.tessellationStep=re.tessellationStep,this.scaleFactor=re.scaleFactor}parse(re,he,Te,He,ke){this.status="parsing",this.data=re,this.collisionBoxArray=new d.aR;const Ye=new d.dQ(Object.keys(re.layers).sort()),pt=new d.dR(this.tileID,this.promoteId);pt.bucketLayerIDs=[];const tt={},ut=new d.dS(256,256),vt={featureIndex:pt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:ut,availableImages:Te,brightness:this.brightness},wt=he.familiesBySource[this.source];for(const ti in wt){const fr=re.layers[ti];if(!fr)continue;let ki=!1,Di=!1,Ti=!1;for(const Ns of wt[ti])"symbol"===Ns[0].type?ki=!0:Di=!0,Ns[0].is3D()&&"model"!==Ns[0].type&&(Ti=!0);if(this.extraShadowCaster&&!Ti||!0===this.isSymbolTile&&!ki||!1===this.isSymbolTile&&!Di)continue;1===fr.version&&d.w(`Vector tile source "${this.source}" layer "${ti}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const xr=Ye.encode(ti),uo=[];for(let Ns=0,Jo=0;Ns<fr.length;Ns++){const ps=fr.feature(Ns),ql=pt.getId(ps,ti);if(this.localizableLayerIds&&this.localizableLayerIds.has(ti)){const Cl=ps.properties?ps.properties.worldview:null;if(this.worldview&&"string"==typeof Cl)if("all"===Cl)ps.properties.$localized=!0;else{if(!Cl.split(",").includes(this.worldview))continue;ps.properties.$localized=!0,ps.properties.worldview=this.worldview}}uo.push({feature:ps,id:ql,index:Jo,sourceLayerIndex:xr}),Jo++}for(const Ns of wt[ti]){const Jo=Ns[0];(!this.extraShadowCaster||Jo.is3D()&&"model"!==Jo.type)&&(void 0!==this.isSymbolTile&&"symbol"===Jo.type!==this.isSymbolTile||Jo.minzoom&&this.zoom<Math.floor(Jo.minzoom)||Jo.maxzoom&&this.zoom>=Jo.maxzoom||"none"!==Jo.visibility&&(it(Ns,this.zoom,vt.brightness,Te),(tt[Jo.id]=Jo.createBucket({index:pt.bucketLayerIDs.length,layers:Ns,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(uo,vt,this.tileID.canonical,this.tileTransform),pt.bucketLayerIDs.push(Ns.map(ps=>d.av(ps.id,ps.scope)))))}}let qt,hn,En,Qn;ut.trim();const ui={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ai=()=>{if(qt)return this.status="done",ke(qt);if(this.extraShadowCaster)this.status="done",ke(null,{buckets:d.be(tt).filter(ti=>!ti.isEmpty()),featureIndex:pt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:vt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(hn&&En&&Qn){const ti=new en(hn),fr=new d.dU(En,Qn,this.lut);for(const ki in tt){const Di=tt[ki];Di instanceof d.aS?(it(Di.layers,this.zoom,vt.brightness,Te),d.dV(Di,hn,ti.positions,En,fr.iconPositions,this.showCollisionBoxes,Te,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.brightness)):Di.hasPattern&&(Di instanceof d.aY||Di instanceof d.aZ||Di instanceof d.d0)&&(it(Di.layers,this.zoom,vt.brightness,Te),Di.addFeatures(vt,this.tileID.canonical,fr.patternPositions,Te,this.tileTransform,this.brightness))}this.status="done",ke(null,{buckets:d.be(tt).filter(ki=>!ki.isEmpty()),featureIndex:pt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ti.image,lineAtlas:ut,imageAtlas:fr,brightness:vt.brightness})}};if(!this.extraShadowCaster){const ti=d.dT(vt.glyphDependencies,Di=>Object.keys(Di).map(Number));Object.keys(ti).length?He.send("getGlyphs",{uid:this.uid,stacks:ti,scope:this.scope},(Di,Ti)=>{qt||(qt=Di,hn=Ti,ai())},void 0,!1,ui):hn={};const fr=Object.keys(vt.iconDependencies);fr.length?He.send("getImages",{icons:fr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Di,Ti)=>{qt||(qt=Di,En=Ti,ai())},void 0,!1,ui):En={};const ki=Object.keys(vt.patternDependencies);ki.length?He.send("getImages",{icons:ki,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Di,Ti)=>{qt||(qt=Di,Qn=Ti,ai())},void 0,!1,ui):Qn={}}ai()}}function it(ht,re,he,Te){const He=new d.a3(re,{brightness:he});for(const ke of ht)ke.recalculate(He,Te)}class dt extends d.E{constructor(re,he,Te,He,ke,Ye){super(),this.actor=re,this.layerIndex=he,this.availableImages=Te,this.loadVectorData=ke||d.aw,this.loading={},this.loaded={},this.deduped=new d.au(re.scheduler),this.isSpriteLoaded=He,this.scheduler=re.scheduler,this.brightness=Ye}loadTile(re,he){const Te=re.uid,He=re&&re.request,ke=He&&He.collectResourceTiming,Ye=this.loading[Te]=new Gt(re);Ye.abort=this.loadVectorData(re,(pt,tt)=>{const ut=!this.loading[Te];if(delete this.loading[Te],ut||pt||!tt)return Ye.status="done",ut||(this.loaded[Te]=Ye),he(pt);const vt=tt.rawData,wt={};tt.expires&&(wt.expires=tt.expires),tt.cacheControl&&(wt.cacheControl=tt.cacheControl),Ye.vectorTile=tt.vectorTile||new d.dW.VectorTile(new d.bc(vt));const qt=()=>{Ye.parse(Ye.vectorTile,this.layerIndex,this.availableImages,this.actor,(hn,En)=>{if(hn||!En)return he(hn);const Qn={};if(ke){const ui=Qe(He);ui.length>0&&(Qn.resourceTiming=JSON.parse(JSON.stringify(ui)))}he(null,d.l({rawTileData:vt.slice(0)},En,wt,Qn))})};this.isSpriteLoaded?qt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(qt,{type:"parseTile",isSymbolTile:re.isSymbolTile,zoom:re.tileZoom}):qt()}),this.loaded=this.loaded||{},this.loaded[Te]=Ye})}reloadTile(re,he){const Te=this.loaded,He=re.uid;if(Te&&Te[He]){const ke=Te[He];ke.scaleFactor=re.scaleFactor,ke.showCollisionBoxes=re.showCollisionBoxes,ke.projection=re.projection,ke.brightness=re.brightness,ke.tileTransform=d.aL(re.tileID.canonical,re.projection),ke.extraShadowCaster=re.extraShadowCaster,ke.lut=re.lut;const Ye=(pt,tt)=>{const ut=ke.reloadCallback;ut&&(delete ke.reloadCallback,ke.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.actor,ut)),he(pt,tt)};"parsing"===ke.status?ke.reloadCallback=Ye:"done"===ke.status&&(ke.vectorTile?ke.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.actor,Ye):Ye())}else he(null,void 0)}abortTile(re,he){const Te=re.uid,He=this.loading[Te];He&&(He.abort&&He.abort(),delete this.loading[Te]),he()}removeTile(re,he){const Te=this.loaded,He=re.uid;Te&&Te[He]&&delete Te[He],he()}}class Mt{loadTile(re,he){const{uid:Te,encoding:He,rawImageData:ke,padding:Ye}=re,pt=ImageBitmap&&ke instanceof ImageBitmap?this.getImageData(ke,Ye):ke;he(null,new d.dX(Te,pt,He,Ye<1))}getImageData(re,he){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(re.width,re.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=re.width,this.offscreenCanvas.height=re.height,this.offscreenCanvasContext.drawImage(re,0,0,re.width,re.height);const Te=this.offscreenCanvasContext.getImageData(-he,-he,re.width+2*he,re.height+2*he);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Te}}d.bb.setPbf(d.bc);class bn{decodeRasterArray({task:re,buffer:he},Te){d.bb.performDecoding(he,re).then(He=>{Te(null,He)},He=>{Te(He)})}}const Jn=d.dW.VectorTileFeature.prototype.toGeoJSON;class yn{constructor(re){this._feature=re,this.extent=d.ab,this.type=re.type,this.properties=re.tags,"id"in re&&!isNaN(re.id)&&(this.id=parseInt(re.id,10))}loadGeometry(){if(1===this._feature.type){const re=[];for(const he of this._feature.geometry)re.push([new d.P(he[0],he[1])]);return re}{const re=[];for(const he of this._feature.geometry){const Te=[];for(const He of he)Te.push(new d.P(He[0],He[1]));re.push(Te)}return re}}toGeoJSON(re,he,Te){return Jn.call(this,re,he,Te)}}class Bt{constructor(re){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.ab,this.length=re.length,this._features=re}feature(re){return new yn(this._features[re])}}const Rn=64/4096;class qe{constructor(){this.features=new Map}clear(){this.features.clear()}load(re=[],he){for(const Te of re){const He=Te.id;if(null==He)continue;let ke=this.features.get(He);ke&&this.updateCache(ke,he),Te.geometry?(ke=xe(Te),this.updateCache(ke,he),this.features.set(He,ke)):this.features.delete(He),this.updateCache(ke,he)}}updateCache(re,he){for(const{canonical:Te,uid:He}of Object.values(he)){const{z:ke,x:Ye,y:pt}=Te;kt(re,Math.pow(2,ke),Ye,pt)&&delete he[He]}}getTile(re,he,Te){const He=Math.pow(2,re),ke=[];for(const Ye of this.features.values())kt(Ye,He,he,Te)&&ke.push(Lt(Ye,He,he,Te));return{features:ke}}getFeatures(){return[...this.features.values()]}}function kt({minX:ht,minY:re,maxX:he,maxY:Te},He,ke,Ye){return ht<(ke+1+Rn)/He&&re<(Ye+1+Rn)/He&&he>(ke-Rn)/He&&Te>(Ye-Rn)/He}function xe(ht){const{id:re,geometry:he,properties:Te}=ht;if(!he)return;if("GeometryCollection"===he.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:He,coordinates:ke}=he,Ye={id:re,type:1,geometry:[],tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},pt=Ye.geometry;if("Point"===He)at(ke,pt,Ye);else if("MultiPoint"===He)for(const tt of ke)at(tt,pt,Ye);else if("LineString"===He)Ye.type=2,Be(ke,pt,Ye);else if("MultiLineString"===He)Ye.type=2,Ge(ke,pt,Ye);else if("Polygon"===He)Ye.type=3,Ge(ke,pt,Ye,!0);else{if("MultiPolygon"!==He)throw new Error("Input data is not a valid GeoJSON object.");Ye.type=3;for(const tt of ke)Ge(tt,pt,Ye,!0)}return Ye}function at([ht,re],he,Te){const He=d.am(ht);let ke=d.at(re);ke=ke<0?0:ke>1?1:ke,he.push(He,ke),Te.minX=Math.min(Te.minX,He),Te.minY=Math.min(Te.minY,ke),Te.maxX=Math.max(Te.maxX,He),Te.maxY=Math.max(Te.maxY,ke)}function Be(ht,re,he,Te=!1,He=!1){const ke=[];for(const Ye of ht)at(Ye,ke,he);re.push(ke),Te&&function(Ye,pt){let tt=0;for(let ut=0,vt=Ye.length,wt=vt-2;ut<vt;wt=ut,ut+=2)tt+=(Ye[ut]-Ye[wt])*(Ye[ut+1]+Ye[wt+1]);if(tt>0===pt)for(let ut=0,vt=Ye.length;ut<vt/2;ut+=2){const wt=Ye[ut],qt=Ye[ut+1];Ye[ut]=Ye[vt-2-ut],Ye[ut+1]=Ye[vt-1-ut],Ye[vt-2-ut]=wt,Ye[vt-1-ut]=qt}}(ke,He)}function Ge(ht,re,he,Te=!1){for(let He=0;He<ht.length;He++)Be(ht[He],re,he,Te,0===He)}function Lt(ht,re,he,Te){const{id:He,type:ke,geometry:Ye,tags:pt}=ht,tt=[];if(1===ke)!function(ut,vt,wt,qt,hn){for(let En=0;En<ut.length;En+=2){const Qn=Math.round(d.ab*(ut[En+0]*vt-wt)),ui=Math.round(d.ab*(ut[En+1]*vt-qt));hn.push([Qn,ui])}}(Ye,re,he,Te,tt);else for(const ut of Ye)bt(ut,re,he,Te,tt);return{id:He,type:ke,geometry:tt,tags:pt}}function bt(ht,re,he,Te,He){const ke=-128,Ye=d.ab+128;let pt;for(let tt=0;tt<ht.length-2;tt+=2){let ut=Math.round(d.ab*(ht[tt+0]*re-he)),vt=Math.round(d.ab*(ht[tt+1]*re-Te)),wt=Math.round(d.ab*(ht[tt+2]*re-he)),qt=Math.round(d.ab*(ht[tt+3]*re-Te));const hn=wt-ut,En=qt-vt;ut<ke&&wt<ke||(ut<ke?(vt+=Math.round(En*((ke-ut)/hn)),ut=ke):wt<ke&&(qt=vt+Math.round(En*((ke-ut)/hn)),wt=ke),vt<ke&&qt<ke||(vt<ke?(ut+=Math.round(hn*((ke-vt)/En)),vt=ke):qt<ke&&(wt=ut+Math.round(hn*((ke-vt)/En)),qt=ke),ut>=Ye&&wt>=Ye||(ut>=Ye?(vt+=Math.round(En*((Ye-ut)/hn)),ut=Ye):wt>=Ye&&(qt=vt+Math.round(En*((Ye-ut)/hn)),wt=Ye),vt>=Ye&&qt>=Ye||(vt>=Ye?(ut+=Math.round(hn*((Ye-vt)/En)),vt=Ye):qt>=Ye&&(wt=ut+Math.round(hn*((Ye-vt)/En)),qt=Ye),pt&&ut===pt[pt.length-1][0]&&vt===pt[pt.length-1][1]||(pt=[[ut,vt]],He.push(pt)),pt.push([wt,qt])))))}}var lt,Wt,Mn,Dn={exports:{}},_n=function(){if(Mn)return Dn.exports;Mn=1;var ht=d.d_(),re=function(){if(Wt)return lt;Wt=1;var vt=d.dY(),wt=d.dZ().VectorTileFeature;function qt(En,Qn){this.options=Qn||{},this.features=En,this.length=En.length}function hn(En,Qn){this.id="number"==typeof En.id?En.id:void 0,this.type=En.type,this.rawGeometry=1===En.type?[En.geometry]:En.geometry,this.properties=En.tags,this.extent=Qn||4096}return lt=qt,qt.prototype.feature=function(En){return new hn(this.features[En],this.options.extent)},hn.prototype.loadGeometry=function(){var En=this.rawGeometry;this.geometry=[];for(var Qn=0;Qn<En.length;Qn++){for(var ui=En[Qn],ai=[],ti=0;ti<ui.length;ti++)ai.push(new vt(ui[ti][0],ui[ti][1]));this.geometry.push(ai)}return this.geometry},hn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var En=this.geometry,Qn=1/0,ui=-1/0,ai=1/0,ti=-1/0,fr=0;fr<En.length;fr++)for(var ki=En[fr],Di=0;Di<ki.length;Di++){var Ti=ki[Di];Qn=Math.min(Qn,Ti.x),ui=Math.max(ui,Ti.x),ai=Math.min(ai,Ti.y),ti=Math.max(ti,Ti.y)}return[Qn,ai,ui,ti]},hn.prototype.toGeoJSON=wt.prototype.toGeoJSON,lt}();function he(vt){var wt=new ht;return function(qt,hn){for(var En in qt.layers)hn.writeMessage(3,Te,qt.layers[En])}(vt,wt),wt.finish()}function Te(vt,wt){var qt;wt.writeVarintField(15,vt.version||1),wt.writeStringField(1,vt.name||""),wt.writeVarintField(5,vt.extent||4096);var hn={keys:[],values:[],keycache:{},valuecache:{}};for(qt=0;qt<vt.length;qt++)hn.feature=vt.feature(qt),wt.writeMessage(2,He,hn);var En=hn.keys;for(qt=0;qt<En.length;qt++)wt.writeStringField(3,En[qt]);var Qn=hn.values;for(qt=0;qt<Qn.length;qt++)wt.writeMessage(4,ut,Qn[qt])}function He(vt,wt){var qt=vt.feature;void 0!==qt.id&&wt.writeVarintField(1,qt.id),wt.writeMessage(2,ke,vt),wt.writeVarintField(3,qt.type),wt.writeMessage(4,tt,qt)}function ke(vt,wt){var qt=vt.feature,hn=vt.keys,En=vt.values,Qn=vt.keycache,ui=vt.valuecache;for(var ai in qt.properties){var ti=qt.properties[ai],fr=Qn[ai];if(null!==ti){void 0===fr&&(hn.push(ai),Qn[ai]=fr=hn.length-1),wt.writeVarint(fr);var ki=typeof ti;"string"!==ki&&"boolean"!==ki&&"number"!==ki&&(ti=JSON.stringify(ti));var Di=ki+":"+ti,Ti=ui[Di];void 0===Ti&&(En.push(ti),ui[Di]=Ti=En.length-1),wt.writeVarint(Ti)}}}function Ye(vt,wt){return(wt<<3)+(7&vt)}function pt(vt){return vt<<1^vt>>31}function tt(vt,wt){for(var qt=vt.loadGeometry(),hn=vt.type,En=0,Qn=0,ui=qt.length,ai=0;ai<ui;ai++){var ti=qt[ai],fr=1;1===hn&&(fr=ti.length),wt.writeVarint(Ye(1,fr));for(var ki=3===hn?ti.length-1:ti.length,Di=0;Di<ki;Di++){1===Di&&1!==hn&&wt.writeVarint(Ye(2,ki-1));var Ti=ti[Di].x-En,xr=ti[Di].y-Qn;wt.writeVarint(pt(Ti)),wt.writeVarint(pt(xr)),En+=Ti,Qn+=xr}3===hn&&wt.writeVarint(Ye(7,1))}}function ut(vt,wt){var qt=typeof vt;"string"===qt?wt.writeStringField(1,vt):"boolean"===qt?wt.writeBooleanField(7,vt):"number"===qt&&(vt%1!=0?wt.writeDoubleField(3,vt):vt<0?wt.writeSVarintField(6,vt):wt.writeVarintField(5,vt))}return Dn.exports=he,Dn.exports.fromVectorTileJs=he,Dn.exports.fromGeojsonVt=function(vt,wt){wt=wt||{};var qt={};for(var hn in vt)qt[hn]=new re(vt[hn].features,wt),qt[hn].name=hn,qt[hn].version=wt.version,qt[hn].extent=wt.extent;return he({layers:qt})},Dn.exports.GeoJSONWrapper=re,Dn.exports}(),Gn=d.d$(_n);const jr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ht=>ht},jn=Math.fround||(lr=new Float32Array(1),ht=>(lr[0]=+ht,lr[0]));var lr;class cr{constructor(re){this.options=Object.assign(Object.create(jr),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:he,minZoom:Te,maxZoom:He}=this.options;he&&console.time("total time");const ke=`prepare ${re.length} points`;he&&console.time(ke),this.points=re;const Ye=[];for(let tt=0;tt<re.length;tt++){const ut=re[tt];if(!ut.geometry)continue;const[vt,wt]=ut.geometry.coordinates,qt=jn(ge(vt)),hn=jn(an(wt));Ye.push(qt,hn,1/0,tt,-1,1),this.options.reduce&&Ye.push(0)}let pt=this.trees[He+1]=this._createTree(Ye);he&&console.timeEnd(ke);for(let tt=He;tt>=Te;tt--){const ut=+Date.now();pt=this.trees[tt]=this._createTree(this._cluster(pt,tt)),he&&console.log("z%d: %d clusters in %dms",tt,pt.numItems,+Date.now()-ut)}return he&&console.timeEnd("total time"),this}getClusters(re,he){let Te=((re[0]+180)%360+360)%360-180;const He=Math.max(-90,Math.min(90,re[1]));let ke=180===re[2]?180:((re[2]+180)%360+360)%360-180;const Ye=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)Te=-180,ke=180;else if(Te>ke){const wt=this.getClusters([Te,He,180,Ye],he),qt=this.getClusters([-180,He,ke,Ye],he);return wt.concat(qt)}const pt=this.trees[this._limitZoom(he)],tt=pt.range(ge(Te),an(Ye),ge(ke),an(He)),ut=pt.data,vt=[];for(const wt of tt){const qt=this.stride*wt;vt.push(ut[qt+5]>1?ur(ut,qt,this.clusterProps):this.points[ut[qt+3]])}return vt}getChildren(re){const he=this._getOriginId(re),Te=this._getOriginZoom(re),He="No cluster with the specified id.",ke=this.trees[Te];if(!ke)throw new Error(He);const Ye=ke.data;if(he*this.stride>=Ye.length)throw new Error(He);const pt=this.options.radius/(this.options.extent*Math.pow(2,Te-1)),tt=ke.within(Ye[he*this.stride],Ye[he*this.stride+1],pt),ut=[];for(const vt of tt){const wt=vt*this.stride;Ye[wt+4]===re&&ut.push(Ye[wt+5]>1?ur(Ye,wt,this.clusterProps):this.points[Ye[wt+3]])}if(0===ut.length)throw new Error(He);return ut}getLeaves(re,he,Te){const He=[];return this._appendLeaves(He,re,he=he||10,Te=Te||0,0),He}getTile(re,he,Te){const He=this.trees[this._limitZoom(re)],ke=Math.pow(2,re),{extent:Ye,radius:pt}=this.options,tt=pt/Ye,ut=(Te-tt)/ke,vt=(Te+1+tt)/ke,wt={features:[]};return this._addTileFeatures(He.range((he-tt)/ke,ut,(he+1+tt)/ke,vt),He.data,he,Te,ke,wt),0===he&&this._addTileFeatures(He.range(1-tt/ke,ut,1,vt),He.data,ke,Te,ke,wt),he===ke-1&&this._addTileFeatures(He.range(0,ut,tt/ke,vt),He.data,-1,Te,ke,wt),wt.features.length?wt:null}getClusterExpansionZoom(re){let he=this._getOriginZoom(re)-1;for(;he<=this.options.maxZoom;){const Te=this.getChildren(re);if(he++,1!==Te.length)break;re=Te[0].properties.cluster_id}return he}_appendLeaves(re,he,Te,He,ke){const Ye=this.getChildren(he);for(const pt of Ye){const tt=pt.properties;if(tt&&tt.cluster?ke+tt.point_count<=He?ke+=tt.point_count:ke=this._appendLeaves(re,tt.cluster_id,Te,He,ke):ke<He?ke++:re.push(pt),re.length===Te)break}return ke}_createTree(re){const he=new d.bz(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Te=0;Te<re.length;Te+=this.stride)he.add(re[Te],re[Te+1]);return he.finish(),he.data=re,he}_addTileFeatures(re,he,Te,He,ke,Ye){for(const pt of re){const tt=pt*this.stride,ut=he[tt+5]>1;let vt,wt,qt;if(ut)vt=ee(he,tt,this.clusterProps),wt=he[tt],qt=he[tt+1];else{const Qn=this.points[he[tt+3]];vt=Qn.properties;const[ui,ai]=Qn.geometry.coordinates;wt=ge(ui),qt=an(ai)}const hn={type:1,geometry:[[Math.round(this.options.extent*(wt*ke-Te)),Math.round(this.options.extent*(qt*ke-He))]],tags:vt};let En;En=ut||this.options.generateId?he[tt+3]:this.points[he[tt+3]].id,void 0!==En&&(hn.id=En),Ye.features.push(hn)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,he){const{radius:Te,extent:He,reduce:ke,minPoints:Ye}=this.options,pt=Te/(He*Math.pow(2,he)),tt=re.data,ut=[],vt=this.stride;for(let wt=0;wt<tt.length;wt+=vt){if(tt[wt+2]<=he)continue;tt[wt+2]=he;const qt=tt[wt],hn=tt[wt+1],En=re.within(tt[wt],tt[wt+1],pt),Qn=tt[wt+5];let ui=Qn;for(const ai of En){const ti=ai*vt;tt[ti+2]>he&&(ui+=tt[ti+5])}if(ui>Qn&&ui>=Ye){let ai,ti=qt*Qn,fr=hn*Qn,ki=-1;const Di=(wt/vt<<5)+(he+1)+this.points.length;for(const Ti of En){const xr=Ti*vt;if(tt[xr+2]<=he)continue;tt[xr+2]=he;const uo=tt[xr+5];ti+=tt[xr]*uo,fr+=tt[xr+1]*uo,tt[xr+4]=Di,ke&&(ai||(ai=this._map(tt,wt,!0),ki=this.clusterProps.length,this.clusterProps.push(ai)),ke(ai,this._map(tt,xr)))}tt[wt+4]=Di,ut.push(ti/ui,fr/ui,1/0,Di,-1,ui),ke&&ut.push(ki)}else{for(let ai=0;ai<vt;ai++)ut.push(tt[wt+ai]);if(ui>1)for(const ai of En){const ti=ai*vt;if(!(tt[ti+2]<=he)){tt[ti+2]=he;for(let fr=0;fr<vt;fr++)ut.push(tt[ti+fr])}}}}return ut}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,he,Te){if(re[he+5]>1){const Ye=this.clusterProps[re[he+6]];return Te?Object.assign({},Ye):Ye}const He=this.points[re[he+3]].properties,ke=this.options.map(He);return Te&&ke===He?Object.assign({},ke):ke}}function ur(ht,re,he){return{type:"Feature",id:ht[re+3],properties:ee(ht,re,he),geometry:{type:"Point",coordinates:[(Te=ht[re],360*(Te-.5)),Dt(ht[re+1])]}};var Te}function ee(ht,re,he){const Te=ht[re+5],He=Te>=1e4?`${Math.round(Te/1e3)}k`:Te>=1e3?Math.round(Te/100)/10+"k":Te,ke=ht[re+6],Ye=-1===ke?{}:Object.assign({},he[ke]);return Object.assign(Ye,{cluster:!0,cluster_id:ht[re+3],point_count:Te,point_count_abbreviated:He})}function ge(ht){return ht/360+.5}function an(ht){const re=Math.sin(ht*Math.PI/180),he=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return he<0?0:he>1?1:he}function Dt(ht){const re=(180-360*ht)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function jt(ht,re,he,Te){let He=Te;const ke=re+(he-re>>1);let Ye,pt=he-re;const tt=ht[re],ut=ht[re+1],vt=ht[he],wt=ht[he+1];for(let qt=re+3;qt<he;qt+=3){const hn=to(ht[qt],ht[qt+1],tt,ut,vt,wt);if(hn>He)Ye=qt,He=hn;else if(hn===He){const En=Math.abs(qt-ke);En<pt&&(Ye=qt,pt=En)}}He>Te&&(Ye-re>3&&jt(ht,re,Ye,Te),ht[Ye+2]=He,he-Ye>3&&jt(ht,Ye,he,Te))}function to(ht,re,he,Te,He,ke){let Ye=He-he,pt=ke-Te;if(0!==Ye||0!==pt){const tt=((ht-he)*Ye+(re-Te)*pt)/(Ye*Ye+pt*pt);tt>1?(he=He,Te=ke):tt>0&&(he+=Ye*tt,Te+=pt*tt)}return Ye=ht-he,pt=re-Te,Ye*Ye+pt*pt}function zi(ht,re,he,Te){const He={id:null!=ht?ht:null,type:re,geometry:he,tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===re||"MultiPoint"===re||"LineString"===re)_o(He,he);else if("Polygon"===re)_o(He,he[0]);else if("MultiLineString"===re)for(const ke of he)_o(He,ke);else if("MultiPolygon"===re)for(const ke of he)_o(He,ke[0]);return He}function _o(ht,re){for(let he=0;he<re.length;he+=3)ht.minX=Math.min(ht.minX,re[he]),ht.minY=Math.min(ht.minY,re[he+1]),ht.maxX=Math.max(ht.maxX,re[he]),ht.maxY=Math.max(ht.maxY,re[he+1])}function ri(ht,re,he,Te){if(!re.geometry)return;const He=re.geometry.coordinates;if(He&&0===He.length)return;const ke=re.geometry.type,Ye=Math.pow(he.tolerance/((1<<he.maxZoom)*he.extent),2);let pt=[],tt=re.id;if(he.promoteId?tt=re.properties[he.promoteId]:he.generateId&&(tt=Te||0),"Point"===ke)Pe(He,pt);else if("MultiPoint"===ke)for(const ut of He)Pe(ut,pt);else if("LineString"===ke)ie(He,pt,Ye,!1);else if("MultiLineString"===ke){if(he.lineMetrics){for(const ut of He)pt=[],ie(ut,pt,Ye,!1),ht.push(zi(tt,"LineString",pt,re.properties));return}ue(He,pt,Ye,!1)}else if("Polygon"===ke)ue(He,pt,Ye,!0);else{if("MultiPolygon"!==ke){if("GeometryCollection"===ke){for(const ut of re.geometry.geometries)ri(ht,{id:tt,geometry:ut,properties:re.properties},he,Te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ut of He){const vt=[];ue(ut,vt,Ye,!0),pt.push(vt)}}ht.push(zi(tt,ke,pt,re.properties))}function Pe(ht,re){re.push(Ze(ht[0]),Et(ht[1]),0)}function ie(ht,re,he,Te){let He,ke,Ye=0;for(let tt=0;tt<ht.length;tt++){const ut=Ze(ht[tt][0]),vt=Et(ht[tt][1]);re.push(ut,vt,0),tt>0&&(Ye+=Te?(He*vt-ut*ke)/2:Math.sqrt(Math.pow(ut-He,2)+Math.pow(vt-ke,2))),He=ut,ke=vt}const pt=re.length-3;re[2]=1,jt(re,0,pt,he),re[pt+2]=1,re.size=Math.abs(Ye),re.start=0,re.end=re.size}function ue(ht,re,he,Te){for(let He=0;He<ht.length;He++){const ke=[];ie(ht[He],ke,he,Te),re.push(ke)}}function Ze(ht){return ht/360+.5}function Et(ht){const re=Math.sin(ht*Math.PI/180),he=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return he<0?0:he>1?1:he}function Pt(ht,re,he,Te,He,ke,Ye,pt){if(Te/=re,ke>=(he/=re)&&Ye<Te)return ht;if(Ye<he||ke>=Te)return null;const tt=[];for(const ut of ht){const vt=ut.geometry;let wt=ut.type;const qt=0===He?ut.minX:ut.minY,hn=0===He?ut.maxX:ut.maxY;if(qt>=he&&hn<Te){tt.push(ut);continue}if(hn<he||qt>=Te)continue;let En=[];if("Point"===wt||"MultiPoint"===wt)Tn(vt,En,he,Te,He);else if("LineString"===wt)tr(vt,En,he,Te,He,!1,pt.lineMetrics);else if("MultiLineString"===wt)ir(vt,En,he,Te,He,!1);else if("Polygon"===wt)ir(vt,En,he,Te,He,!0);else if("MultiPolygon"===wt)for(const Qn of vt){const ui=[];ir(Qn,ui,he,Te,He,!0),ui.length&&En.push(ui)}if(En.length){if(pt.lineMetrics&&"LineString"===wt){for(const Qn of En)tt.push(zi(ut.id,wt,Qn,ut.tags));continue}"LineString"!==wt&&"MultiLineString"!==wt||(1===En.length?(wt="LineString",En=En[0]):wt="MultiLineString"),"Point"!==wt&&"MultiPoint"!==wt||(wt=3===En.length?"Point":"MultiPoint"),tt.push(zi(ut.id,wt,En,ut.tags))}}return tt.length?tt:null}function Tn(ht,re,he,Te,He){for(let ke=0;ke<ht.length;ke+=3){const Ye=ht[ke+He];Ye>=he&&Ye<=Te&&co(re,ht[ke],ht[ke+1],ht[ke+2])}}function tr(ht,re,he,Te,He,ke,Ye){let pt=vr(ht);const tt=0===He?bo:Hl;let ut,vt,wt=ht.start;for(let ui=0;ui<ht.length-3;ui+=3){const ai=ht[ui],ti=ht[ui+1],fr=ht[ui+2],ki=ht[ui+3],Di=ht[ui+4],Ti=0===He?ai:ti,xr=0===He?ki:Di;let uo=!1;Ye&&(ut=Math.sqrt(Math.pow(ai-ki,2)+Math.pow(ti-Di,2))),Ti<he?xr>he&&(vt=tt(pt,ai,ti,ki,Di,he),Ye&&(pt.start=wt+ut*vt)):Ti>Te?xr<Te&&(vt=tt(pt,ai,ti,ki,Di,Te),Ye&&(pt.start=wt+ut*vt)):co(pt,ai,ti,fr),xr<he&&Ti>=he&&(vt=tt(pt,ai,ti,ki,Di,he),uo=!0),xr>Te&&Ti<=Te&&(vt=tt(pt,ai,ti,ki,Di,Te),uo=!0),!ke&&uo&&(Ye&&(pt.end=wt+ut*vt),re.push(pt),pt=vr(ht)),Ye&&(wt+=ut)}let qt=ht.length-3;const hn=ht[qt],En=ht[qt+1],Qn=0===He?hn:En;Qn>=he&&Qn<=Te&&co(pt,hn,En,ht[qt+2]),qt=pt.length-3,ke&&qt>=3&&(pt[qt]!==pt[0]||pt[qt+1]!==pt[1])&&co(pt,pt[0],pt[1],pt[2]),pt.length&&re.push(pt)}function vr(ht){const re=[];return re.size=ht.size,re.start=ht.start,re.end=ht.end,re}function ir(ht,re,he,Te,He,ke){for(const Ye of ht)tr(Ye,re,he,Te,He,ke,!1)}function co(ht,re,he,Te){ht.push(re,he,Te)}function bo(ht,re,he,Te,He,ke){const Ye=(ke-re)/(Te-re);return co(ht,ke,he+(He-he)*Ye,1),Ye}function Hl(ht,re,he,Te,He,ke){const Ye=(ke-he)/(He-he);return co(ht,re+(Te-re)*Ye,ke,1),Ye}function Ys(ht,re){const he=[];for(let Te=0;Te<ht.length;Te++){const He=ht[Te],ke=He.type;let Ye;if("Point"===ke||"MultiPoint"===ke||"LineString"===ke)Ye=za(He.geometry,re);else if("MultiLineString"===ke||"Polygon"===ke){Ye=[];for(const pt of He.geometry)Ye.push(za(pt,re))}else if("MultiPolygon"===ke){Ye=[];for(const pt of He.geometry){const tt=[];for(const ut of pt)tt.push(za(ut,re));Ye.push(tt)}}he.push(zi(He.id,ke,Ye,He.tags))}return he}function za(ht,re){const he=[];he.size=ht.size,void 0!==ht.start&&(he.start=ht.start,he.end=ht.end);for(let Te=0;Te<ht.length;Te+=3)he.push(ht[Te]+re,ht[Te+1],ht[Te+2]);return he}function Su(ht,re){if(ht.transformed)return ht;const he=1<<ht.z,Te=ht.x,He=ht.y;for(const ke of ht.features){const Ye=ke.geometry,pt=ke.type;if(ke.geometry=[],1===pt)for(let tt=0;tt<Ye.length;tt+=2)ke.geometry.push(Tu(Ye[tt],Ye[tt+1],re,he,Te,He));else for(let tt=0;tt<Ye.length;tt++){const ut=[];for(let vt=0;vt<Ye[tt].length;vt+=2)ut.push(Tu(Ye[tt][vt],Ye[tt][vt+1],re,he,Te,He));ke.geometry.push(ut)}}return ht.transformed=!0,ht}function Tu(ht,re,he,Te,He,ke){return[Math.round(he*(ht*Te-He)),Math.round(he*(re*Te-ke))]}function ol(ht,re,he,Te,He){const ke=re===He.maxZoom?0:He.tolerance/((1<<re)*He.extent),Ye={features:[],numPoints:0,numSimplified:0,numFeatures:ht.length,source:null,x:he,y:Te,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const pt of ht)Eh(Ye,pt,ke,He);return Ye}function Eh(ht,re,he,Te){const He=re.geometry,ke=re.type,Ye=[];if(ht.minX=Math.min(ht.minX,re.minX),ht.minY=Math.min(ht.minY,re.minY),ht.maxX=Math.max(ht.maxX,re.maxX),ht.maxY=Math.max(ht.maxY,re.maxY),"Point"===ke||"MultiPoint"===ke)for(let pt=0;pt<He.length;pt+=3)Ye.push(He[pt],He[pt+1]),ht.numPoints++,ht.numSimplified++;else if("LineString"===ke)ji(Ye,He,ht,he,!1,!1);else if("MultiLineString"===ke||"Polygon"===ke)for(let pt=0;pt<He.length;pt++)ji(Ye,He[pt],ht,he,"Polygon"===ke,0===pt);else if("MultiPolygon"===ke)for(let pt=0;pt<He.length;pt++){const tt=He[pt];for(let ut=0;ut<tt.length;ut++)ji(Ye,tt[ut],ht,he,!0,0===ut)}if(Ye.length){let pt=re.tags||null;if("LineString"===ke&&Te.lineMetrics){pt={};for(const ut in re.tags)pt[ut]=re.tags[ut];pt.mapbox_clip_start=He.start/He.size,pt.mapbox_clip_end=He.end/He.size}const tt={geometry:Ye,type:"Polygon"===ke||"MultiPolygon"===ke?3:"LineString"===ke||"MultiLineString"===ke?2:1,tags:pt};null!==re.id&&(tt.id=re.id),ht.features.push(tt)}}function ji(ht,re,he,Te,He,ke){const Ye=Te*Te;if(Te>0&&re.size<(He?Ye:Te))return void(he.numPoints+=re.length/3);const pt=[];for(let tt=0;tt<re.length;tt+=3)(0===Te||re[tt+2]>Ye)&&(he.numSimplified++,pt.push(re[tt],re[tt+1])),he.numPoints++;He&&function(tt,ut){let vt=0;for(let wt=0,qt=tt.length,hn=qt-2;wt<qt;hn=wt,wt+=2)vt+=(tt[wt]-tt[hn])*(tt[wt+1]+tt[hn+1]);if(vt>0===ut)for(let wt=0,qt=tt.length;wt<qt/2;wt+=2){const hn=tt[wt],En=tt[wt+1];tt[wt]=tt[qt-2-wt],tt[wt+1]=tt[qt-1-wt],tt[qt-2-wt]=hn,tt[qt-1-wt]=En}}(pt,ke),ht.push(pt)}const Gl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class bf{constructor(re,he){const Te=(he=this.options=function(ke,Ye){for(const pt in Ye)ke[pt]=Ye[pt];return ke}(Object.create(Gl),he)).debug;if(Te&&console.time("preprocess data"),he.maxZoom<0||he.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(he.promoteId&&he.generateId)throw new Error("promoteId and generateId cannot be used together.");let He=function(ke,Ye){const pt=[];if("FeatureCollection"===ke.type)for(let tt=0;tt<ke.features.length;tt++)ri(pt,ke.features[tt],Ye,tt);else ri(pt,"Feature"===ke.type?ke:{geometry:ke},Ye);return pt}(re,he);this.tiles={},this.tileCoords=[],Te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",he.indexMaxZoom,he.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),He=function(ke,Ye){const pt=Ye.buffer/Ye.extent;let tt=ke;const ut=Pt(ke,1,-1-pt,pt,0,-1,2,Ye),vt=Pt(ke,1,1-pt,2+pt,0,-1,2,Ye);return(ut||vt)&&(tt=Pt(ke,1,-pt,1+pt,0,-1,2,Ye)||[],ut&&(tt=Ys(ut,1).concat(tt)),vt&&(tt=tt.concat(Ys(vt,-1)))),tt}(He,he),He.length&&this.splitTile(He,0,0,0),Te&&(He.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(re,he,Te,He,ke,Ye,pt){const tt=[re,he,Te,He],ut=this.options,vt=ut.debug;for(;tt.length;){He=tt.pop(),Te=tt.pop(),he=tt.pop(),re=tt.pop();const wt=1<<he,qt=Va(he,Te,He);let hn=this.tiles[qt];if(!hn&&(vt>1&&console.time("creation"),hn=this.tiles[qt]=ol(re,he,Te,He,ut),this.tileCoords.push({z:he,x:Te,y:He}),vt)){vt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",he,Te,He,hn.numFeatures,hn.numPoints,hn.numSimplified),console.timeEnd("creation"));const uo=`z${he}`;this.stats[uo]=(this.stats[uo]||0)+1,this.total++}if(hn.source=re,null==ke){if(he===ut.indexMaxZoom||hn.numPoints<=ut.indexMaxPoints)continue}else{if(he===ut.maxZoom||he===ke)continue;if(null!=ke){const uo=ke-he;if(Te!==Ye>>uo||He!==pt>>uo)continue}}if(hn.source=null,0===re.length)continue;vt>1&&console.time("clipping");const En=.5*ut.buffer/ut.extent,Qn=.5-En,ui=.5+En,ai=1+En;let ti=null,fr=null,ki=null,Di=null,Ti=Pt(re,wt,Te-En,Te+ui,0,hn.minX,hn.maxX,ut),xr=Pt(re,wt,Te+Qn,Te+ai,0,hn.minX,hn.maxX,ut);re=null,Ti&&(ti=Pt(Ti,wt,He-En,He+ui,1,hn.minY,hn.maxY,ut),fr=Pt(Ti,wt,He+Qn,He+ai,1,hn.minY,hn.maxY,ut),Ti=null),xr&&(ki=Pt(xr,wt,He-En,He+ui,1,hn.minY,hn.maxY,ut),Di=Pt(xr,wt,He+Qn,He+ai,1,hn.minY,hn.maxY,ut),xr=null),vt>1&&console.timeEnd("clipping"),tt.push(ti||[],he+1,2*Te,2*He),tt.push(fr||[],he+1,2*Te,2*He+1),tt.push(ki||[],he+1,2*Te+1,2*He),tt.push(Di||[],he+1,2*Te+1,2*He+1)}}getTile(re,he,Te){re=+re,he=+he,Te=+Te;const He=this.options,{extent:ke,debug:Ye}=He;if(re<0||re>24)return null;const pt=1<<re,tt=Va(re,he=he+pt&pt-1,Te);if(this.tiles[tt])return Su(this.tiles[tt],ke);Ye>1&&console.log("drilling down to z%d-%d-%d",re,he,Te);let ut,vt=re,wt=he,qt=Te;for(;!ut&&vt>0;)vt--,wt>>=1,qt>>=1,ut=this.tiles[Va(vt,wt,qt)];return ut&&ut.source?(Ye>1&&(console.log("found parent tile z%d-%d-%d",vt,wt,qt),console.time("drilling down")),this.splitTile(ut.source,vt,wt,qt,re,he,Te),Ye>1&&console.timeEnd("drilling down"),this.tiles[tt]?Su(this.tiles[tt],ke):null):null}}function Va(ht,re,he){return 32*((1<<ht)*he+re)+ht}function Cu(ht,re){const he=ht.tileID.canonical;if(!this._geoJSONIndex)return void re(null,null);const Te=this._geoJSONIndex.getTile(he.z,he.x,he.y);if(!Te)return void re(null,null);const He=new Bt(Te.features);let ke=Gn(He);0===ke.byteOffset&&ke.byteLength===ke.buffer.byteLength||(ke=new Uint8Array(ke)),re(null,{vectorTile:He,rawData:ke.buffer})}class Ih extends dt{constructor(re,he,Te,He,ke,Ye){super(re,he,Te,He,Cu,Ye),ke&&(this.loadGeoJSON=ke),this._dynamicIndex=new qe}loadData(re,he){const Te=re&&re.request,He=Te&&Te.collectResourceTiming;this.loadGeoJSON(re,(ke,Ye)=>{if(ke||!Ye)return he(ke);if("object"!=typeof Ye)return he(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));{try{if(re.filter){const tt=d.M(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===tt.result)throw new Error(tt.value.map(ut=>`${ut.key}: ${ut.message}`).join(", "));Ye.features=Ye.features.filter(ut=>tt.value.evaluate({zoom:0},ut))}re.dynamic?("Feature"===Ye.type&&(Ye={type:"FeatureCollection",features:[Ye]}),re.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ye.features,this.loaded),re.cluster&&(Ye.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=re.cluster?new cr(function({superclusterOptions:tt,clusterProperties:ut}){if(!ut||!tt)return tt;const vt={},wt={},qt={accumulated:null,zoom:0},hn={properties:null},En=Object.keys(ut);for(const Qn of En){const[ui,ai]=ut[Qn],ti=d.M(ai),fr=d.M("string"==typeof ui?[ui,["accumulated"],["get",Qn]]:ui);vt[Qn]=ti.value,wt[Qn]=fr.value}return tt.map=Qn=>{hn.properties=Qn;const ui={};for(const ai of En)ui[ai]=vt[ai].evaluate(qt,hn);return ui},tt.reduce=(Qn,ui)=>{hn.properties=ui;for(const ai of En)qt.accumulated=Qn[ai],Qn[ai]=wt[ai].evaluate(qt,hn)},tt}(re)).load(Ye.features):re.dynamic?this._dynamicIndex:new bf(tt=Ye,re.geojsonVtOptions)}catch(tt){return he(tt)}const pt={};if(He){const tt=Qe(Te);tt&&(pt.resourceTiming={},pt.resourceTiming[re.source]=JSON.parse(JSON.stringify(tt)))}he(null,pt)}var tt})}reloadTile(re,he){const Te=this.loaded;return Te&&Te[re.uid]?re.partial?he(null,void 0):super.reloadTile(re,he):this.loadTile(re,he)}loadGeoJSON(re,he){if(re.request)d.n(re.request,he);else{if("string"!=typeof re.data)return he(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));try{return he(null,JSON.parse(re.data))}catch(Te){return he(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(re,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(Te){he(Te)}}getClusterChildren(re,he){try{he(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(Te){he(Te)}}getClusterLeaves(re,he){try{he(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(Te){he(Te)}}}class Mh{constructor(re,he){this.tileID=new d.aA(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=re.projection,this.brightness=he}parse(re,he,Te,He){this.status="parsing";const ke=new d.aA(Te.tileID.overscaledZ,Te.tileID.wrap,Te.tileID.canonical.z,Te.tileID.canonical.x,Te.tileID.canonical.y),Ye=[],pt=he.familiesBySource[Te.source],tt=new d.dR(ke,Te.promoteId);return tt.bucketLayerIDs=[],tt.is3DTile=!0,d.e0(re).then(ut=>{if(!ut)return He(new Error("Could not parse tile"));const vt=d.e1(ut,1/d.c9(Te.tileID.canonical)),wt=ut.json.extensionsUsed&&ut.json.extensionsUsed.includes("MAPBOX_mesh_features")||ut.json.asset.extras&&ut.json.asset.extras.MAPBOX_mesh_features,qt=ut.json.extensionsUsed&&ut.json.extensionsUsed.includes("EXT_meshopt_compression"),hn=new d.a3(this.zoom,{brightness:this.brightness});for(const En in pt)for(const Qn of pt[En]){const ui=Qn[0];tt.bucketLayerIDs.push(Qn.map(ti=>d.av(ti.id,ti.scope))),ui.recalculate(hn,[]);const ai=new d.e2(Qn,vt,ke,wt,qt,this.brightness,tt);wt||(ai.needsUpload=!0),Ye.push(ai),ai.evaluate(ui)}this.status="done",He(null,{buckets:Ye,featureIndex:tt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(ut=>He(new Error(ut.message)))}}class pd{constructor(re,he,Te,He,ke,Ye){this.actor=re,this.layerIndex=he,this.availableImages=Te,this.brightness=Ye,this.loading={},this.loaded={}}loadTile(re,he){const Te=re.uid,He=this.loading[Te]=new Mh(re,this.brightness);d.bd(re.request,(ke,Ye)=>{const pt=!this.loading[Te];return delete this.loading[Te],pt||ke?(He.status="done",pt||(this.loaded[Te]=He),he(ke)):Ye&&0!==Ye.byteLength?void He.parse(Ye,this.layerIndex,re,(tt,ut)=>{He.status="done",this.loaded=this.loaded||{},this.loaded[Te]=He,tt||!ut?he(tt):he(null,ut)}):(He.status="done",this.loaded[Te]=He,he())})}reloadTile(re,he){const Te=this.loaded,He=re.uid;if(Te&&Te[He]){const ke=Te[He];ke.projection=re.projection,ke.brightness=re.brightness;const Ye=(pt,tt)=>{ke.reloadCallback&&(delete ke.reloadCallback,this.loadTile(re,he)),he(pt,tt)};"parsing"===ke.status?ke.reloadCallback=Ye:"done"===ke.status&&this.loadTile(re,he)}}abortTile(re,he){const Te=re.uid;this.loading[Te]&&delete this.loading[Te],he()}removeTile(re,he){const Te=this.loaded,He=re.uid;Te&&Te[He]&&delete Te[He],he()}}class Ah{constructor(re){this.self=re,this.actor=new d.e3(re,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.bM({name:"mercator"}),this.workerSourceTypes={vector:dt,geojson:Ih,"batched-model":pd},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(he,Te)=>{if(this.workerSourceTypes[he])throw new Error(`Worker source with name "${he}" already registered.`);this.workerSourceTypes[he]=Te},this.self.registerRTLTextPlugin=he=>{if(d.e4.isParsed())throw new Error("RTL text plugin already registered.");d.e4.applyArabicShaping=he.applyArabicShaping,d.e4.processBidirectionalText=he.processBidirectionalText,d.e4.processStyledBidirectionalText=he.processStyledBidirectionalText}}clearCaches(re,he,Te){delete this.layerIndexes[re],delete this.availableImages[re],delete this.workerSources[re],delete this.demWorkerSources[re],delete this.rasterArrayWorkerSource,Te()}checkIfReady(re,he,Te){Te()}setReferrer(re,he){this.referrer=he}spriteLoaded(re,{scope:he,isLoaded:Te}){if(this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),this.isSpriteLoaded[re][he]=Te,this.workerSources[re]&&this.workerSources[re][he])for(const He in this.workerSources[re][he]){const ke=this.workerSources[re][he][He];for(const Ye in ke){const pt=ke[Ye];pt instanceof dt&&(pt.isSpriteLoaded=Te,pt.fire(new d.x("isSpriteLoaded")))}}}setImages(re,{scope:he,images:Te},He){if(this.availableImages[re]||(this.availableImages[re]={}),this.availableImages[re][he]=Te,this.workerSources[re]&&this.workerSources[re][he]){for(const ke in this.workerSources[re][he]){const Ye=this.workerSources[re][he][ke];for(const pt in Ye)Ye[pt].availableImages=Te}He()}else He()}setProjection(re,he){this.projections[re]=d.bM(he)}setBrightness(re,he,Te){this.brightness=he,Te()}setLayers(re,he,Te){this.getLayerIndex(re,he.scope).replace(he.layers,he.options),Te()}updateLayers(re,he,Te){this.getLayerIndex(re,he.scope).update(he.layers,he.removedIds,he.options),Te()}loadTile(re,he,Te){he.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,he.type,he.source,he.scope).loadTile(he,Te)}loadDEMTile(re,he,Te){this.getDEMWorkerSource(re,he.source,he.scope).loadTile(he,Te)}decodeRasterArray(re,he,Te){this.getRasterArrayWorkerSource().decodeRasterArray(he,Te)}reloadTile(re,he,Te){he.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,he.type,he.source,he.scope).reloadTile(he,Te)}abortTile(re,he,Te){this.getWorkerSource(re,he.type,he.source,he.scope).abortTile(he,Te)}removeTile(re,he,Te){this.getWorkerSource(re,he.type,he.source,he.scope).removeTile(he,Te)}removeSource(re,he,Te){if(!(this.workerSources[re]&&this.workerSources[re][he.scope]&&this.workerSources[re][he.scope][he.type]&&this.workerSources[re][he.scope][he.type][he.source]))return;const He=this.workerSources[re][he.scope][he.type][he.source];delete this.workerSources[re][he.scope][he.type][he.source],void 0!==He.removeSource?He.removeSource(he,Te):Te()}loadWorkerSource(re,he,Te){try{this.self.importScripts(he.url),Te()}catch(He){Te(He.toString())}}syncRTLPluginState(re,he,Te){try{d.e4.setState(he);const He=d.e4.getPluginURL();if(d.e4.isLoaded()&&!d.e4.isParsed()&&null!=He){this.self.importScripts(He);const ke=d.e4.isParsed();Te(ke?void 0:new Error(`RTL Text Plugin failed to import scripts from ${He}`),ke)}}catch(He){Te(He.toString())}}setDracoUrl(re,he){this.dracoUrl=he}getAvailableImages(re,he){this.availableImages[re]||(this.availableImages[re]={});let Te=this.availableImages[re][he];return Te||(Te=[]),Te}getLayerIndex(re,he){this.layerIndexes[re]||(this.layerIndexes[re]={});let Te=this.layerIndexes[re][he];return Te||(Te=this.layerIndexes[re][he]=new Tt,Te.scope=he),Te}getWorkerSource(re,he,Te,He){return this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][He]||(this.workerSources[re][He]={}),this.workerSources[re][He][he]||(this.workerSources[re][He][he]={}),this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),this.workerSources[re][He][he][Te]||(this.workerSources[re][He][he][Te]=new this.workerSourceTypes[he]({send:(ke,Ye,pt,tt,ut,vt)=>{this.actor.send(ke,Ye,pt,re,ut,vt)},scheduler:this.actor.scheduler},this.getLayerIndex(re,He),this.getAvailableImages(re,He),this.isSpriteLoaded[re][He],void 0,this.brightness)),this.workerSources[re][He][he][Te]}getDEMWorkerSource(re,he,Te){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][Te]||(this.demWorkerSources[re][Te]={}),this.demWorkerSources[re][Te][he]||(this.demWorkerSources[re][Te][he]=new Mt),this.demWorkerSources[re][Te][he]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new bn),this.rasterArrayWorkerSource}enforceCacheSizeLimit(re,he){d.e5(he)}getWorkerPerformanceMetrics(re,he,Te){Te(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Ah(self)),Ah}),et(0,function(d){var Qe="3.8.0";const xt={create:"create",load:"load",fullLoad:"fullLoad"},De={mark(m){performance.mark(m)},measure(m,s,c){performance.measure(m,s,c)}};function Tt(m){const s=m.name.split("?")[0];return d.a(s)&&s.includes("mapbox-gl.js")?"javascript":d.a(s)&&s.includes("mapbox-gl.css")?"css":d.b(s)?"fontRange":d.c(s)?"sprite":d.i(s)?"style":d.d(s)?"tilejson":"other"}var zt,en={},Gt=function(){if(zt)return en;function m(g){return!s(g)}function s(g){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,C,k=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(k);try{C=new Worker(O),w=!0}catch(B){w=!1}return C&&C.terminate(),URL.revokeObjectURL(O),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var C=w.getContext("2d");if(!C)return!1;var k=C.getImageData(0,0,1,1);return k&&k.width===w.width}()?(void 0===c[v=g&&g.failIfMajorPerformanceCaveat]&&(c[v]=function(w){var C,O,B,F,k=(O=w,B=document.createElement("canvas"),(F=Object.create(m.webGLContextAttributes)).failIfMajorPerformanceCaveat=O,B.getContext("webgl2",F));if(!k)return!1;try{C=k.createShader(k.VERTEX_SHADER)}catch(O){return!1}return!(!C||k.isContextLost())&&(k.shaderSource(C,"void main() {}"),k.compileShader(C),!0===k.getShaderParameter(C,k.COMPILE_STATUS))}(v)),c[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}zt=1,en.supported=m,en.notSupportedReason=s;var c={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},en}();function it(m,s,c){const g=document.createElement(m);return null!=s&&(g.className=s),c&&c.appendChild(g),g}function dt(m,s,c){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const v of Object.keys(s))g.setAttributeNS(null,v,String(s[v]));return c&&c.appendChild(g),g}const Mt="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,bn=Mt&&void 0!==Mt.userSelect?"userSelect":"WebkitUserSelect";let Jn;function yn(){Mt&&bn&&(Jn=Mt[bn],Mt[bn]="none")}function Bt(){Mt&&bn&&(Mt[bn]=Jn)}function Rn(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Rn,!0)}function Re(){window.addEventListener("click",Rn,!0),window.setTimeout(()=>{window.removeEventListener("click",Rn,!0)},0)}function qe(m,s){const c=m.getBoundingClientRect();return at(m,c,s)}function kt(m,s){const c=m.getBoundingClientRect(),g=[];for(let v=0;v<s.length;v++)g.push(at(m,c,s[v]));return g}function xe(m){return void 0!==window.InstallTrigger&&2===m.button&&m.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function at(m,s,c){const g=m.offsetWidth===s.width?1:m.offsetWidth/s.width;return new d.P((c.clientX-s.left)*g,(c.clientY-s.top)*g)}const Be="01",Ge="NO_ACCESS_TOKEN";class Lt{constructor(s,c,g){this._transformRequestFn=s,this._customAccessToken=c,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const s=function(){let c="";for(let g=0;g<10;g++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Be,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,c){return this._transformRequestFn&&this._transformRequestFn(s,c)||{url:s}}normalizeStyleURL(s,c){if(!d.f(s))return s;const g=lt(s);return g.params.push("sdk=js-3.8.0"),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeGlyphsURL(s,c){if(!d.f(s))return s;const g=lt(s);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeModelURL(s,c){if(!d.f(s))return s;const g=lt(s);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeSourceURL(s,c,g,v){if(!d.f(s))return s;const w=lt(s);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),g&&w.params.push(`language=${g}`),v&&w.params.push(`worldview=${v}`),this._makeAPIURL(w,this._customAccessToken||c)}normalizeSpriteURL(s,c,g,v){const w=lt(s);return d.f(s)?(w.path=`/styles/v1${w.path}/sprite${c}${g}`,this._makeAPIURL(w,this._customAccessToken||v)):(w.path+=`${c}${g}`,Wt(w))}normalizeTileURL(s,c,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!d.f(s))return s;const v=lt(s);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||g&&"raster"!==v.authority&&512===g?"@2x":""}${d.m.supported?".webp":"$1"}`),"raster"===v.authority?v.path=`/${d.e.RASTER_URL_PREFIX}${v.path}`:"rasterarrays"===v.authority?v.path=`/${d.e.RASTERARRAYS_URL_PREFIX}${v.path}`:"3dtiles"===v.authority?v.path=`/${d.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${d.e.TILE_URL_VERSION}${v.path}`);const w=this._customAccessToken||function(C){for(const k of C){const O=k.match(/^access_token=(.*)$/);if(O)return O[1]}return null}(v.params)||d.e.ACCESS_TOKEN;return d.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,w)}canonicalizeTileURL(s,c){const g=lt(s);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return s;let v="mapbox://";g.path.match(/^\/raster\/v1\//)?v+=`raster/${g.path.replace(`/${d.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${g.path.replace(`/${d.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${g.path.replace(`/${d.e.TILE_URL_VERSION}/`,"")}`;let w=g.params;return c&&(w=w.filter(C=>!C.match(/^access_token=/))),w.length&&(v+=`?${w.join("&")}`),v}canonicalizeTileset(s,c){const g=!!c&&d.f(c),v=[];for(const w of s.tiles||[])d.h(w)?v.push(this.canonicalizeTileURL(w,g)):v.push(w);return v}_makeAPIURL(s,c){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=lt(d.e.API_URL);if(s.protocol=v.protocol,s.authority=v.authority,"http"===s.protocol){const w=s.params.indexOf("secure");w>=0&&s.params.splice(w,1)}if("/"!==v.path&&(s.path=`${v.path}${s.path}`),!d.e.REQUIRE_ACCESS_TOKEN)return Wt(s);if(c=c||d.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if("s"===c[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return s.params=s.params.filter(w=>-1===w.indexOf("access_token")),s.params.push(`access_token=${c||""}`),Wt(s)}}const bt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function lt(m){const s=m.match(bt);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function Wt(m){const s=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${s}`}const Mn="mapbox.eventData";function Dn(m){if(!m)return null;const s=m.split(".");if(!s||3!==s.length)return null;try{return JSON.parse(d.j(s[1]))}catch(c){return null}}class _n{constructor(s){this.type=s,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const c=Dn(d.e.ACCESS_TOKEN);let g="";return g=c&&c.u?d.k(c.u):d.e.ACCESS_TOKEN||"",s?`${Mn}.${s}:${g}`:`${Mn}:${g}`}fetchEventData(){const s=d.s("localStorage"),c=this.getStorageKey(),g=this.getStorageKey("uuid");if(s)try{const v=localStorage.getItem(c);v&&(this.eventData=JSON.parse(v));const w=localStorage.getItem(g);w&&(this.anonId=w)}catch(v){d.w("Unable to read from LocalStorage")}}saveEventData(){const s=d.s("localStorage"),c=this.getStorageKey(),g=this.getStorageKey("uuid"),v=this.anonId;if(s&&v)try{localStorage.setItem(g,v),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch(w){d.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,c,g,v){if(!d.e.EVENTS_URL)return;const w=lt(d.e.EVENTS_URL);w.params.push(`access_token=${v||d.e.ACCESS_TOKEN||""}`);const C={event:this.type,created:new Date(s).toISOString()},k=c?d.l(C,c):C,O={url:Wt(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=d.p(O,B=>{this.pendingRequest=null,g(B),this.saveEventData(),this.processRequests(v)})}queueRequest(s,c){this.queue.push(s),this.processRequests(c)}}const Gn=new class extends _n{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,s){d.e.EVENTS_URL&&d.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(c=>d.f(c)||d.h(c))&&this.queueRequest(Date.now(),s)}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=Dn(d.e.ACCESS_TOKEN),c=s?s.u:d.e.ACCESS_TOKEN;let g=c!==this.eventData.tokenU;d.v(this.anonId)||(this.anonId=d.u(),g=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),C=new Date(v),k=(v-this.eventData.lastSuccess)/864e5;g=g||k>=1||k<-1||w.getDate()!==C.getDate()}else g=!0;g?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Qe,skuId:Be,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=v,this.eventData.tokenU=c)},m):this.processRequests()}},jr=Gn.postTurnstileEvent.bind(Gn),jn=new class extends _n{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,s,c,g){this.skuToken=s,this.errorCb=g,d.e.EVENTS_URL&&(c||d.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(Ge)))}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||(this.anonId||this.fetchEventData(),d.v(this.anonId)||(this.anonId=d.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Qe,skuId:Be,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):s&&(this.success[s]=!0)},m))}remove(){this.errorCb=null}},lr=jn.postMapLoadEvent.bind(jn),fn=new class extends _n{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let s=this.mapInstanceIdMap.get(m);return s||(s=d.u(),this.mapInstanceIdMap.set(m,s)),s}getEventId(m){const s=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,s+1),s}postStyleLoadEvent(m,s){const{map:c,style:g,importedStyles:v}=s;if(!d.e.EVENTS_URL||!m&&!d.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(c),C={mapInstanceId:w,eventId:this.getEventId(w),style:g};v.length&&(C.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:C},m)}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:s,payload:c}=this.queue.shift();this.postEvent(s,c,()=>{},m)}},qo=fn.postStyleLoadEvent.bind(fn),Fs=new class extends _n{constructor(){super("gljs.performance")}postPerformanceEvent(m,s){d.e.EVENTS_URL&&(m||d.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},m)}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:s,performanceData:c}=this.queue.shift(),g=function(v){const w=performance.getEntriesByType("resource"),C=performance.getEntriesByType("mark"),k=function(X){const Q={};if(X)for(const K in X)if("other"!==K)for(const ne of X[K]){const te=`${K}ResolveRangeMin`,pe=`${K}ResolveRangeMax`,be=`${K}RequestCount`,ye=`${K}RequestCachedCount`;Q[te]=Math.min(Q[te]||1/0,ne.startTime),Q[pe]=Math.max(Q[pe]||-1/0,ne.responseEnd);const we=Ee=>{void 0===Q[Ee]&&(Q[Ee]=0),++Q[Ee]};void 0!==ne.transferSize&&0===ne.transferSize&&we(ye),we(be)}return Q}(function(X,Q){const K={};if(X)for(const ne of X){const te=Q(ne);void 0===K[te]&&(K[te]=[]),K[te].push(ne)}return K}(w,Tt)),O=window.devicePixelRatio,B=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=B?B.effectiveType:void 0,j={counters:[],metadata:[],attributes:[]},G=(X,Q,K)=>{null!=K&&X.push({name:Q,value:K.toString()})};for(const X in k)G(j.counters,X,k[X]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(G(j.counters,"interactionRangeMin",v.interactionRange[0]),G(j.counters,"interactionRangeMax",v.interactionRange[1])),C)for(const X of Object.keys(xt)){const Q=xt[X],K=C.find(ne=>ne.name===Q);K&&G(j.counters,Q,K.startTime)}return G(j.counters,"visibilityHidden",v.visibilityHidden),G(j.attributes,"style",function(X){if(X)for(const Q of X){const K=Q.name.split("?")[0];if(d.i(K)){const ne=K.split("/").slice(-2);if(2===ne.length)return`mapbox://styles/${ne[0]}/${ne[1]}`}}}(w)),G(j.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),G(j.attributes,"fogEnabled",v.fogEnabled?"true":"false"),G(j.attributes,"projection",v.projection),G(j.attributes,"zoom",v.zoom),G(j.metadata,"devicePixelRatio",O),G(j.metadata,"connectionEffectiveType",F),G(j.metadata,"navigatorUserAgent",navigator.userAgent),G(j.metadata,"screenWidth",window.screen.width),G(j.metadata,"screenHeight",window.screen.height),G(j.metadata,"windowWidth",window.innerWidth),G(j.metadata,"windowHeight",window.innerHeight),G(j.metadata,"mapWidth",v.width/O),G(j.metadata,"mapHeight",v.height/O),G(j.metadata,"webglRenderer",v.renderer),G(j.metadata,"webglVendor",v.vendor),G(j.metadata,"sdkVersion",Qe),G(j.metadata,"sdkIdentifier","mapbox-gl-js"),j}(c);for(const v of g.metadata);for(const v of g.counters);for(const v of g.attributes);this.postEvent(s,g,()=>{},m)}},cr=Fs.postPerformanceEvent.bind(Fs),ur=new class extends _n{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,s,c,g){if(!d.e.API_URL||!d.e.SESSION_PATH)return;const v=lt(d.e.API_URL+d.e.SESSION_PATH);v.params.push(`sku=${s||""}`),v.params.push(`access_token=${g||d.e.ACCESS_TOKEN||""}`);const w={url:Wt(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=d.g(w,C=>{this.pendingRequest=null,c(C),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,s,c,g){this.skuToken=s,this.errorCb=g,d.e.SESSION_PATH&&d.e.API_URL&&(c||d.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(Ge)))}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||this.getSession(c,this.skuToken,g=>{g?this.errorCb(g):s&&(this.success[s]=!0)},m)}remove(){this.errorCb=null}},ee=ur.getSessionAPI.bind(ur),ge=new Set;function an(m,s){s?ge.add(m):ge.delete(m)}class Dt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,c){this._updatedSourceCaches[s]=c,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const c=s.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(s.id),this.setDirty()}removeLayer(s){const c=s.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][s.id]=s,this._updatedLayers[c].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const c in this._updatedLayers)s[c]=s[c]||{},s[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)s[c]=s[c]||{},s[c].removedIds=Object.keys(this._removedLayers[c]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(s){this._updatedImages.add(s),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function jt(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class to extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(s){this.images[s]={},this.loaded[s]=!1,this.updatedImages[s]={},this.patterns[s]={},this.callbackDispatchedThisFrame[s]={},this.atlasImage[s]=new d.r({width:1,height:1})}isLoaded(){for(const s in this.loaded)if(!this.loaded[s])return!1;return!0}setLoaded(s,c){if(this.loaded[c]!==s&&(this.loaded[c]=s,s)){for(const{ids:g,callback:v}of this.requestors)this._notify(g,c,v);this.requestors=[]}}hasImage(s,c){return!!this.getImage(s,c)}getImage(s,c){return this.images[c][s]}addImage(s,c,g){this._validate(s,g)&&(this.images[c][s]=g)}_validate(s,c){let g=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new d.t(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new d.t(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(c.content,c)||(this.fire(new d.t(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,c){if(!s)return!0;let g=0;for(const v of s){if(v[0]<g||v[1]<v[0]||c<v[1])return!1;g=v[1]}return!0}_validateContent(s,c){return!(s&&(4!==s.length||s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,c,g){g.version=this.images[c][s].version+1,this.images[c][s]=g,this.updatedImages[c][s]=!0}removeImage(s,c){const g=this.images[c][s];delete this.images[c][s],delete this.patterns[c][s],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(s){return Object.keys(this.images[s])}getImages(s,c,g){let v=!0;const w=!!this.loaded[c];if(!w)for(const C of s)this.images[c][C]||(v=!1);w||v?this._notify(s,c,g):this.requestors.push({ids:s,scope:c,callback:g})}getUpdatedImages(s){return this.updatedImages[s]}_notify(s,c,g){const v={};for(const w of s){this.images[c][w]||this.fire(new d.x("styleimagemissing",{id:w}));const C=this.images[c][w];C?v[w]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:Boolean(C.userImage&&C.userImage.render)}:d.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(s){const{width:c,height:g}=this.atlasImage[s];return{width:c,height:g}}getPattern(s,c,g){const v=this.patterns[c][s],w=this.getImage(s,c);if(!w)return null;if(v&&v.position.version===w.version)return v.position;if(v)v.position.version=w.version;else{const C={w:w.data.width+2*d.y,h:w.data.height+2*d.y,x:0,y:0},k=new d.I(C,w,d.y);this.patterns[c][s]={bin:C,position:k}}return this._updatePatternAtlas(c,g),this.patterns[c][s].position}bind(s,c){const g=s.gl;let v=this.atlasTexture[c];v?this.dirty&&(v.update(this.atlasImage[c]),this.dirty=!1):(v=new d.T(s,this.atlasImage[c],g.RGBA8),this.atlasTexture[c]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(s,c){const g=[];for(const k in this.patterns[s])g.push(this.patterns[s][k].bin);const{w:v,h:w}=d.z(g),C=this.atlasImage[s];C.resize({width:v||1,height:w||1});for(const k in this.patterns[s]){const{bin:O,position:B}=this.patterns[s][k];let F=B.padding;const j=O.x+F,G=O.y+F,X=this.images[s][k].data,Q=X.width,K=X.height;F=F>1?F-1:F,d.r.copy(X,C,{x:0,y:0},{x:j,y:G},{width:Q,height:K},c),d.r.copy(X,C,{x:0,y:K-F},{x:j,y:G-F},{width:Q,height:F},c),d.r.copy(X,C,{x:0,y:0},{x:j,y:G+K},{width:Q,height:F},c),d.r.copy(X,C,{x:Q-F,y:0},{x:j-F,y:G},{width:F,height:K},c),d.r.copy(X,C,{x:0,y:0},{x:j+Q,y:G},{width:F,height:K},c),d.r.copy(X,C,{x:Q-F,y:K-F},{x:j-F,y:G-F},{width:F,height:F},c),d.r.copy(X,C,{x:0,y:K-F},{x:j+Q,y:G-F},{width:F,height:F},c),d.r.copy(X,C,{x:0,y:0},{x:j+Q,y:G+K},{width:F,height:F},c),d.r.copy(X,C,{x:Q-F,y:0},{x:j-F,y:G+K},{width:F,height:F},c)}this.dirty=!0}beginFrame(){for(const s in this.images)this.callbackDispatchedThisFrame[s]={}}dispatchRenderCallbacks(s,c){for(const g of s){if(this.callbackDispatchedThisFrame[c][g])continue;this.callbackDispatchedThisFrame[c][g]=!0;const v=this.images[c][g];jt(v)&&this.updateImage(g,c,v)}}}function zi(m){const s=m.key,c=m.value,g=m.valueSpec||{},v=m.objectElementValidators||{},w=m.style,C=m.styleSpec;let k=[];const O=d.B(c);if("object"!==O)return[new d.V(s,c,`object expected, ${O} found`)];for(const B in c){const F=B.split(".")[0];let j;v[F]?j=v[F]:g[F]?j=ji:v["*"]?j=v["*"]:g["*"]&&(j=ji),j?k=k.concat(j({key:(s&&`${s}.`)+B,value:c[B],valueSpec:g[F]||g["*"],style:w,styleSpec:C,object:c,objectKey:B},c)):k.push(new d.A(s,c[B],`unknown property "${B}"`))}for(const B in g)v[B]||g[B].required&&void 0===g[B].default&&void 0===c[B]&&k.push(new d.V(s,c,`missing required property "${B}"`));return k}function _o(m){const s=m.value,c=m.valueSpec,g=m.style,v=m.styleSpec,w=m.key,C=m.arrayElementValidator||ji;if("array"!==d.B(s))return[new d.V(w,s,`array expected, ${d.B(s)} found`)];if(c.length&&s.length!==c.length)return[new d.V(w,s,`array length ${c.length} expected, length ${s.length} found`)];if(c["min-length"]&&s.length<c["min-length"])return[new d.V(w,s,`array length at least ${c["min-length"]} expected, length ${s.length} found`)];let k={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};v.$version<7&&(k.function=c.function),"object"===d.B(c.value)&&(k=c.value);let O=[];for(let B=0;B<s.length;B++)O=O.concat(C({array:s,arrayIndex:B,value:s[B],valueSpec:k,style:g,styleSpec:v,key:`${w}[${B}]`},!0));return O}function ri(m){const s=m.key,c=m.value,g=m.valueSpec;let v=d.B(c);if("number"===v&&c!=c&&(v="NaN"),"number"!==v)return[new d.V(s,c,`number expected, ${v} found`)];if("minimum"in g){let w=g.minimum;if("array"===d.B(g.minimum)&&(w=g.minimum[m.arrayIndex]),c<w)return[new d.V(s,c,`${c} is less than the minimum value ${w}`)]}if("maximum"in g){let w=g.maximum;if("array"===d.B(g.maximum)&&(w=g.maximum[m.arrayIndex]),c>w)return[new d.V(s,c,`${c} is greater than the maximum value ${w}`)]}return[]}function Pe(m){const s=m.valueSpec,c=d.D(m.value.type);let g,v,w,C={};const k="categorical"!==c&&void 0===m.value.property,O=!k,B="array"===d.B(m.value.stops)&&"array"===d.B(m.value.stops[0])&&"object"===d.B(m.value.stops[0][0]),F=zi({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(X){if("identity"===c)return[new d.V(X.key,X.value,'identity function may not have a "stops" property')];let Q=[];const K=X.value;return Q=Q.concat(_o({key:X.key,value:K,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:j})),"array"===d.B(K)&&0===K.length&&Q.push(new d.V(X.key,K,"array must have at least one stop")),Q},default:function(X){return ji({key:X.key,value:X.value,valueSpec:s,style:X.style,styleSpec:X.styleSpec})}}});return"identity"===c&&k&&F.push(new d.V(m.key,m.value,'missing required property "property"')),"identity"===c||m.value.stops||F.push(new d.V(m.key,m.value,'missing required property "stops"')),"exponential"===c&&m.valueSpec.expression&&!d.F(m.valueSpec)&&F.push(new d.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(O&&!d.G(m.valueSpec)?F.push(new d.V(m.key,m.value,"property functions not supported")):k&&!d.H(m.valueSpec)&&F.push(new d.V(m.key,m.value,"zoom functions not supported"))),"categorical"!==c&&!B||void 0!==m.value.property||F.push(new d.V(m.key,m.value,'"property" property is required')),F;function j(X){let Q=[];const K=X.value,ne=X.key;if("array"!==d.B(K))return[new d.V(ne,K,`array expected, ${d.B(K)} found`)];if(2!==K.length)return[new d.V(ne,K,`array length 2 expected, length ${K.length} found`)];if(B){if("object"!==d.B(K[0]))return[new d.V(ne,K,`object expected, ${d.B(K[0])} found`)];if(void 0===K[0].zoom)return[new d.V(ne,K,"object stop key must have zoom")];if(void 0===K[0].value)return[new d.V(ne,K,"object stop key must have value")];const te=d.D(K[0].zoom);if("number"!=typeof te)return[new d.V(ne,K[0].zoom,"stop zoom values must be numbers")];if(w&&w>te)return[new d.V(ne,K[0].zoom,"stop zoom values must appear in ascending order")];te!==w&&(w=te,v=void 0,C={}),Q=Q.concat(zi({key:`${ne}[0]`,value:K[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:ri,value:G}}))}else Q=Q.concat(G({key:`${ne}[0]`,value:K[0],valueSpec:{},style:X.style,styleSpec:X.styleSpec},K));return d.J(d.K(K[1]))?Q.concat([new d.V(`${ne}[1]`,K[1],"expressions are not allowed in function stops.")]):Q.concat(ji({key:`${ne}[1]`,value:K[1],valueSpec:s,style:X.style,styleSpec:X.styleSpec}))}function G(X,Q){const K=d.B(X.value),ne=d.D(X.value),te=null!==X.value?X.value:Q;if(g){if(K!==g)return[new d.V(X.key,te,`${K} stop domain type must match previous stop domain type ${g}`)]}else g=K;if("number"!==K&&"string"!==K&&"boolean"!==K&&"number"!=typeof ne&&"string"!=typeof ne&&"boolean"!=typeof ne)return[new d.V(X.key,te,"stop domain value must be a number, string, or boolean")];if("number"!==K&&"categorical"!==c){let pe=`number expected, ${K} found`;return d.G(s)&&void 0===c&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new d.V(X.key,te,pe)]}return"categorical"!==c||"number"!==K||"number"==typeof ne&&isFinite(ne)&&Math.floor(ne)===ne?"categorical"!==c&&"number"===K&&"number"==typeof ne&&"number"==typeof v&&void 0!==v&&ne<v?[new d.V(X.key,te,"stop domain values must appear in ascending order")]:(v=ne,"categorical"===c&&ne in C?[new d.V(X.key,te,"stop domain values must be unique")]:(C[ne]=!0,[])):[new d.V(X.key,te,`integer expected, found ${String(ne)}`)]}}function ie(m){const s=("property"===m.expressionContext?d.L:d.M)(d.K(m.value),m.valueSpec);if("error"===s.result)return s.value.map(g=>new d.V(`${m.key}${g.key}`,m.value,g.message));const c=s.value.expression||s.value._styleExpression.expression;if("property"===m.expressionContext&&"text-font"===m.propertyKey&&!c.outputDefined())return[new d.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===m.expressionContext&&"layout"===m.propertyType&&!d.N(c))return[new d.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===m.expressionContext)return ue(c,m);if(m.expressionContext&&0===m.expressionContext.indexOf("cluster")){if(!d.O(c,["zoom","feature-state"]))return[new d.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===m.expressionContext&&!d.Q(c))return[new d.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ue(m,s){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const v of s.valueSpec.expression.parameters)c.delete(v);if(0===c.size)return[];const g=[];return m instanceof d.S&&c.has(m.name)?[new d.V(s.key,s.value,`["${m.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(m.eachChild(v=>{g.push(...ue(v,s))}),g)}function Ze(m){const s=m.key,c=m.value,g=m.valueSpec,v=[];return Array.isArray(g.values)?-1===g.values.indexOf(d.D(c))&&v.push(new d.V(s,c,`expected one of [${g.values.join(", ")}], ${JSON.stringify(c)} found`)):-1===Object.keys(g.values).indexOf(d.D(c))&&v.push(new d.V(s,c,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(c)} found`)),v}function Et(m){return d.W(d.K(m.value))?ie(d.C({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):Pt(m)}function Pt(m){const s=m.value,c=m.key;if("array"!==d.B(s))return[new d.V(c,s,`array expected, ${d.B(s)} found`)];const g=m.styleSpec;let v,w=[];if(s.length<1)return[new d.V(c,s,"filter array must have at least 1 element")];switch(w=w.concat(Ze({key:`${c}[0]`,value:s[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),d.D(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&"$type"===d.D(s[1])&&w.push(new d.V(c,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":3!==s.length&&w.push(new d.V(c,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=d.B(s[1]),"string"!==v&&w.push(new d.V(`${c}[1]`,s[1],`string expected, ${v} found`)));for(let C=2;C<s.length;C++)v=d.B(s[C]),"$type"===d.D(s[1])?w=w.concat(Ze({key:`${c}[${C}]`,value:s[C],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):"string"!==v&&"number"!==v&&"boolean"!==v&&w.push(new d.V(`${c}[${C}]`,s[C],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let C=1;C<s.length;C++)w=w.concat(Pt({key:`${c}[${C}]`,value:s[C],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":v=d.B(s[1]),2!==s.length?w.push(new d.V(c,s,`filter array for "${s[0]}" operator must have 2 elements`)):"string"!==v&&w.push(new d.V(`${c}[1]`,s[1],`string expected, ${v} found`))}return w}function Tn(m,s){const c=m.key,g=m.style,v=m.layer,w=m.styleSpec,C=m.value,k=m.objectKey,O=w[`${s}_${m.layerType}`];if(!O)return[];const B=k.match(/^(.*)-transition$/);if("paint"===s&&B&&O[B[1]]&&O[B[1]].transition)return ji({key:c,value:C,valueSpec:w.transition,style:g,styleSpec:w});const F=m.valueSpec||O[k];if(!F)return[new d.A(c,C,`unknown property "${k}"`)];let j;if("string"===d.B(C)&&d.G(F)&&!F.tokens&&(j=/^{([^}]+)}$/.exec(C))){const X=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new d.V(c,C,`"${k}" does not support interpolation syntax\nUse an identity property function instead: ${X}.`)]}const G=[];if("symbol"===m.layerType)"text-field"!==k||!g||g.glyphs||g.imports||G.push(new d.V(c,C,'use of "text-field" requires a style "glyphs" property')),"text-font"===k&&d.X(d.K(C))&&"identity"===d.D(C.type)&&G.push(new d.V(c,C,'"text-font" does not support identity functions'));else if("model"===m.layerType&&"paint"===s&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&d.G(F)&&(d.Y(F)||d.H(F))){const X=d.L(d.K(C),F),Q=X.value.expression||X.value._styleExpression.expression;Q&&!d.O(Q,["measure-light"])&&("model-emissive-strength"===k&&d.Q(Q)&&d.N(Q)||G.push(new d.V(c,C,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return G.concat(ji({key:m.key,value:C,valueSpec:F,style:g,styleSpec:w,expressionContext:"property",propertyType:s,propertyKey:k}))}function tr(m){return Tn(m,"paint")}function vr(m){return Tn(m,"layout")}function ir(m){let s=[];const c=m.value,g=m.key,v=m.style,w=m.styleSpec;c.type||c.ref||s.push(new d.V(g,c,'either "type" or "ref" is required'));let C=d.D(c.type);const k=d.D(c.ref);if(c.id){const O=d.D(c.id);for(let B=0;B<m.arrayIndex;B++){const F=v.layers[B];d.D(F.id)===O&&s.push(new d.V(g,c.id,`duplicate layer id "${c.id}", previously used at line ${F.id.__line__}`))}}if("ref"in c){let O;["type","source","source-layer","filter","layout"].forEach(B=>{B in c&&s.push(new d.V(g,c[B],`"${B}" is prohibited for ref layers`))}),v.layers.forEach(B=>{d.D(B.id)===k&&(O=B)}),O?O.ref?s.push(new d.V(g,c.ref,"ref cannot reference another ref layer")):C=d.D(O.type):"string"==typeof k&&s.push(new d.V(g,c.ref,`ref layer "${k}" not found`))}else if("background"!==C&&"sky"!==C&&"slot"!==C)if(c.source){const O=v.sources&&v.sources[c.source],B=O&&d.D(O.type);O?"vector"===B&&"raster"===C?s.push(new d.V(g,c.source,`layer "${c.id}" requires a raster source`)):"raster"===B&&"raster"!==C?s.push(new d.V(g,c.source,`layer "${c.id}" requires a vector source`)):"vector"!==B||c["source-layer"]?"raster-dem"===B&&"hillshade"!==C?s.push(new d.V(g,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==B||["raster","raster-particle"].includes(C)?"line"!==C||!c.paint||!c.paint["line-gradient"]&&!c.paint["line-trim-offset"]||"geojson"===B&&O.lineMetrics?"raster-particle"===C&&"raster-array"!==B&&s.push(new d.V(g,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):s.push(new d.V(g,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new d.V(g,c.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new d.V(g,c,`layer "${c.id}" must specify a "source-layer"`)):s.push(new d.V(g,c.source,`source "${c.source}" not found`))}else s.push(new d.V(g,c,'missing required property "source"'));return s=s.concat(zi({key:g,value:c,valueSpec:w.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ji({key:`${g}.type`,value:c.type,valueSpec:w.layer.type,style:m.style,styleSpec:m.styleSpec,object:c,objectKey:"type"}),filter:O=>Et(d.C({layerType:C},O)),layout:O=>zi({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":B=>vr(d.C({layerType:C},B))}}),paint:O=>zi({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":B=>tr(d.C({layerType:C,layer:c},B))}})}})),s}function co(m){const s=m.value,c=m.key,g=d.B(s);return"string"!==g?[new d.V(c,s,`string expected, ${g} found`)]:[]}const bo={promoteId:function({key:m,value:s}){if("string"===d.B(s))return co({key:m,value:s});{const c=[];for(const g in s)c.push(...co({key:`${m}.${g}`,value:s[g]}));return c}}};function Hl(m){const s=m.value,c=m.key,g=m.styleSpec,v=m.style;if(!s.type)return[new d.V(c,s,'"type" is required')];const w=d.D(s.type);let C=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(s.url||s.tiles||C.push(new d.A(c,s,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return C=C.concat(zi({key:c,value:s,valueSpec:g[`source_${w.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:bo})),C;case"geojson":if(C=zi({key:c,value:s,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:bo}),s.cluster)for(const k in s.clusterProperties){const[O,B]=s.clusterProperties[k],F="string"==typeof O?[O,["accumulated"],["get",k]]:O;C.push(...ie({key:`${c}.${k}.map`,value:B,expressionContext:"cluster-map"})),C.push(...ie({key:`${c}.${k}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return C;case"video":return zi({key:c,value:s,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return zi({key:c,value:s,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new d.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ze({key:`${c}.type`,value:s.type,valueSpec:{values:Ys(g)},style:v,styleSpec:g})}}function Ys(m){return m.source.reduce((s,c)=>{const g=m[c];return"enum"===g.type.type&&(s=s.concat(Object.keys(g.type.values))),s},[])}function za(m){const s=m.value,c=m.styleSpec,g=c.light,v=m.style;let w=[];const C=d.B(s);if(void 0===s)return w;if("object"!==C)return w=w.concat([new d.V("light",s,`object expected, ${C} found`)]),w;for(const k in s){const O=k.match(/^(.*)-transition$/);w=w.concat(O&&g[O[1]]&&g[O[1]].transition?ji({key:k,value:s[k],valueSpec:c.transition,style:v,styleSpec:c}):g[k]?ji({key:k,value:s[k],valueSpec:g[k],style:v,styleSpec:c}):[new d.V(k,s[k],`unknown property "${k}"`)])}return w}function Su(m){const s=m.value;let c=[];if(!s)return c;const g=d.B(s);if("object"!==g)return c=c.concat([new d.V("light-3d",s,`object expected, ${g} found`)]),c;const v=m.styleSpec,w=v["light-3d"],C=m.key,k=m.style,O=m.style.lights;for(const j of["type","id"])if(!(j in s))return c=c.concat([new d.V("light-3d",s,`missing property ${j} on light`)]),c;if(s.type&&O)for(let j=0;j<m.arrayIndex;j++){const G=d.D(s.type),X=O[j];d.D(X.type)===G&&c.push(new d.V(C,s.id,`duplicate light type "${s.type}", previously defined at line ${X.id.__line__}`))}const B=`properties_light_${s.type}`;if(!(B in v))return c=c.concat([new d.V("light-3d",s,`Invalid light type ${s.type}`)]),c;const F=v[B];for(const j in s)if("properties"===j){const G=s[j],X=d.B(G);if("object"!==X)return c=c.concat([new d.V("properties",G,`object expected, ${X} found`)]),c;for(const Q in G)c=c.concat(F[Q]?ji({key:Q,value:G[Q],valueSpec:F[Q],style:k,styleSpec:v}):[new d.A(m.key,G[Q],`unknown property "${Q}"`)])}else{const G=j.match(/^(.*)-transition$/);c=c.concat(G&&w[G[1]]&&w[G[1]].transition?ji({key:j,value:s[j],valueSpec:v.transition,style:k,styleSpec:v}):w[j]?ji({key:j,value:s[j],valueSpec:w[j],style:k,styleSpec:v}):[new d.A(j,s[j],`unknown property "${j}"`)])}return c}function Tu(m){const s=m.value,c=m.key,g=m.style,v=m.styleSpec,w=v.terrain;let C=[];const k=d.B(s);if(void 0===s||"null"===k)return C;if("object"!==k)return C=C.concat([new d.V("terrain",s,`object expected, ${k} found`)]),C;for(const O in s){const B=O.match(/^(.*)-transition$/);C=C.concat(B&&w[B[1]]&&w[B[1]].transition?ji({key:O,value:s[O],valueSpec:v.transition,style:g,styleSpec:v}):w[O]?ji({key:O,value:s[O],valueSpec:w[O],style:g,styleSpec:v}):[new d.A(O,s[O],`unknown property "${O}"`)])}if(s.source){const O=g.sources&&g.sources[s.source],B=O&&d.D(O.type);O?"raster-dem"!==B&&C.push(new d.V(c,s.source,`terrain cannot be used with a source of type ${String(B)}, it only be used with a "raster-dem" source type`)):C.push(new d.V(c,s.source,`source "${s.source}" not found`))}else C.push(new d.V(c,s,'terrain is missing required property "source"'));return C}function ol(m){const s=m.value,c=m.style,g=m.styleSpec,v=g.fog;let w=[];const C=d.B(s);if(void 0===s)return w;if("object"!==C)return w=w.concat([new d.V("fog",s,`object expected, ${C} found`)]),w;for(const k in s){const O=k.match(/^(.*)-transition$/);w=w.concat(O&&v[O[1]]&&v[O[1]].transition?ji({key:k,value:s[k],valueSpec:g.transition,style:c,styleSpec:g}):v[k]?ji({key:k,value:s[k],valueSpec:v[k],style:c,styleSpec:g}):[new d.A(k,s[k],`unknown property "${k}"`)])}return w}const Eh={"*":()=>[],array:_o,boolean:function(m){const s=m.value,c=m.key,g=d.B(s);return"boolean"!==g?[new d.V(c,s,`boolean expected, ${g} found`)]:[]},number:ri,color:function(m){const s=m.key,c=m.value,g=d.B(c);return"string"!==g?[new d.V(s,c,`color expected, ${g} found`)]:null===d.U.parseCSSColor(c)?[new d.V(s,c,`color expected, "${c}" found`)]:[]},enum:Ze,filter:Et,function:Pe,layer:ir,object:zi,source:Hl,model:d.Z,light:za,"light-3d":Su,terrain:Tu,fog:ol,string:co,formatted:function(m){return 0===co(m).length?[]:ie(m)},resolvedImage:function(m){return 0===co(m).length?[]:ie(m)},projection:function(m){const s=m.value,c=m.styleSpec,g=c.projection,v=m.style;let w=[];const C=d.B(s);if("object"===C)for(const k in s)w=w.concat(ji({key:k,value:s[k],valueSpec:g[k],style:v,styleSpec:c}));else"string"!==C&&(w=w.concat([new d.V("projection",s,`object or string expected, ${C} found`)]));return w},import:function(m){const{value:s,styleSpec:c}=m,{data:g,...v}=s;Object.defineProperty(v,"__line__",{value:s.__line__,enumerable:!1});let w=zi(d.C({},m,{value:v,valueSpec:c.import}));return""===d.D(v.id)&&w.push(new d.V(`${m.key}.id`,v,"import id can't be an empty string")),g&&(w=w.concat(bf(g,c,{key:`${m.key}.data`}))),w}};function ji(m,s=!1){const c=m.value,g=m.valueSpec,v=m.styleSpec;if(g.expression&&d.X(d.D(c)))return Pe(m);if(g.expression&&d.J(d.K(c)))return ie(m);if(g.type&&Eh[g.type]){const w=Eh[g.type](m);return!0===s&&w.length>0&&"array"===d.B(m.value)?ie(m):w}return zi(d.C({},m,{valueSpec:g.type?v[g.type]:g}))}function Gl(m){const s=m.value,c=m.key,g=co(m);return g.length||(-1===s.indexOf("{fontstack}")&&g.push(new d.V(c,s,'"glyphs" url must include a "{fontstack}" token')),-1===s.indexOf("{range}")&&g.push(new d.V(c,s,'"glyphs" url must include a "{range}" token'))),g}function bf(m,s=d._,c={}){return ji({key:c.key||"",value:m,valueSpec:s.$root,styleSpec:s,style:m,objectElementValidators:{glyphs:Gl,"*":()=>[]}})}function Va(m,s=d._){return ke(bf(m,s))}const Cu=m=>ke(Hl(m)),Ih=m=>ke(za(m)),Mh=m=>ke(Su(m)),pd=m=>ke(Tu(m)),Ah=m=>ke(ol(m)),ht=m=>ke(ir(m)),re=m=>ke(Et(m)),he=m=>ke(tr(m)),Te=m=>ke(vr(m)),He=m=>ke(d.Z(m));function ke(m){return m.slice().sort((s,c)=>s.line&&c.line?s.line-c.line:0)}function Ye(m,s){let c=!1;if(s&&s.length)for(const g of s)g instanceof d.A?d.w(g.message):(m.fire(new d.t(new Error(g.message))),c=!0);return c}let pt;class tt extends d.E{constructor(s,c="flat"){super(),this._transitionable=new d.$(pt||(pt=new d.a0({anchor:new d.a1(d._.light.anchor),position:new d.a2(d._.light.position),color:new d.a1(d._.light.color),intensity:new d.a1(d._.light.intensity)}))),this.setLight(s,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c,g={}){this._validate(Ih,s,g)||(this._transitionable.setTransitionOrValue(s),this.id=c)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,g){return(!g||!1!==g.validate)&&Ye(this,s.call(Va,d.l({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d._})))}}let ut=class extends d.E{constructor(m,s,c,g){super(),this.scope=c,this._transitionable=new d.$(new d.a0({source:new d.a1(d._.terrain.source),exaggeration:new d.a1(d._.terrain.exaggeration)}),c,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(m,s){this._transitionable.setTransitionOrValue(m,s)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new d.a3(m)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const s=m.value.expression;if(!s)return null;let c=-1,g=-1,v=1;for(const w of s.zoomStops)v=s.evaluate(new d.a3(w)),v>.01?(c=w,g=-1):g=w;return v<.01&&c>0&&g>c?[c,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return null!=m&&null!=m.value&&null!=m.value.expression&&m.value.expression instanceof d.a4}};const qt=.05;function hn(m,s,c,g){const v=d.a7(45,65,c),[w,C]=En(m,g);let k=1-Math.min(1,Math.exp((s-w)/(C-w)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*v*m.alpha}function En(m,s){const c=.5/Math.tan(.5*s);return[m.range[0]+c,m.range[1]+c]}function Qn(m,s,c,g,v){const w=d.a6.vec3.transformMat4([],[s,c,g],v.mercatorFogMatrix);return hn(m,d.a6.vec3.length(w),v.pitch,v._fov)}function ui(m,s,c,g,v,w,C){const k=[[c,g,0],[v,g,0],[v,w,0],[c,w,0]];let O=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(const F of k){const j=d.a6.vec3.transformMat4([],F,s),G=d.a6.vec3.length(j);O=Math.min(O,G),B=Math.max(B,G)}return[hn(m,O,C.pitch,C._fov),hn(m,B,C.pitch,C._fov)]}class ai extends d.E{constructor(s,c,g,v){super();const w=new d.a0({range:new d.a1(d._.fog.range),color:new d.a1(d._.fog.color),"high-color":new d.a1(d._.fog["high-color"]),"space-color":new d.a1(d._.fog["space-color"]),"horizon-blend":new d.a1(d._.fog["horizon-blend"]),"star-intensity":new d.a1(d._.fog["star-intensity"]),"vertical-range":new d.a1(d._.fog["vertical-range"])});this._transitionable=new d.$(w,g,new Map(v)),this.set(s,v),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new d.a8(w),this.scope=g}get state(){const s=this._transform,c="globe"===s.projection.name,g=d.a9(s.zoom),v=this.properties.get("range"),w=[.5,3];return{range:c?[d.aa(w[0],v[0],g),d.aa(w[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,c,g={}){if(this._validate(Ah,s,g))return;const v=d.l({},s);for(const w of Object.keys(d._.fog))void 0===v[w]&&(v[w]=d._.fog[w].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:d.a7(45,65,s))*c.a}getOpacityAtLatLng(s,c){return this._transform.projection.supportsFog?function(g,v,w){const C=d.a5.fromLngLat(v),k=w.elevation?w.elevation.getAtPointOrZero(C):0;return Qn(g,C.x,C.y,k,w)}(this.state,s,c):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(s.toUnwrapped());return ui(this.state,c,0,0,d.ab,d.ab,this._transform)}getOpacityForBounds(s,c,g,v,w){return this._transform.projection.supportsFog?ui(this.state,s,c,g,v,w,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?En(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const g of c){const v=s.points[g];let w;if(v[2]>=0)w=v;else{const C=s.points[g-4];w=d.ac(C,v,C[2]/(C[2]-v[2]))}if(Qn(this.state,w[0],w[1],0,this._transform)>=qt)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,g){return(!g||!1!==g.validate)&&Ye(this,s.call(Va,d.l({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d._})))}}class ti extends d.E{constructor(s,c,g,v){super(),this.scope=g,this._options=s,this.properties=new d.a8(c),this._transitionable=new d.$(c,g,new Map(v)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,c){this._options=s,this._transitionable.setTransitionOrValue(s.properties,c)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}let fr,ki;class Di{constructor(s,c,g,v){this.screenBounds=s,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,c){let g,v;if(s instanceof d.P||"number"==typeof s[0]){const w=d.P.convert(s);g=[w],v=c.isPointAboveHorizon(w)}else{const w=d.P.convert(s[0]),C=d.P.convert(s[1]);g=[w,C],v=d.ae(w,C).every(k=>c.isPointAboveHorizon(k))}return new Di(g,c.getCameraPoint(),v,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(s){return d.ae(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const c=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new d.P(1,1)):this.screenBounds[1],v=d.ae(c,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),d.af(v,s)}bufferedCameraGeometryGlobe(s){const c=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new d.P(1,1)):this.screenBounds[1],v=d.ae(c,g,s),w=this.cameraPoint.clone();switch(3*((w.y>c.y)+(w.y>g.y))+((w.x>c.x)+(w.x>g.x))){case 0:v[0]=w,v[4]=w.clone();break;case 1:v.splice(1,0,w);break;case 2:v[1]=w;break;case 3:v.splice(4,0,w);break;case 5:v.splice(2,0,w);break;case 6:v[3]=w;break;case 7:v.splice(3,0,w);break;case 8:v[2]=w}return v}containsTile(s,c,g,v=0){const w=s.queryPadding/c._pixelsPerMercatorPixel+1,C=g?this._bufferedCameraMercator(w,c):this._bufferedScreenMercator(w,c);let k=s.tileID.wrap+(C.unwrapped?v:0);const O=C.polygon.map(ne=>d.ag(s.tileTransform,ne,k));if(!d.ah(O,0,0,d.ab,d.ab))return;k=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const B=this.screenGeometryMercator.polygon.map(ne=>d.ai(s.tileTransform,ne,k)),F=B.map(ne=>new d.P(ne[0],ne[1])),j=c.getFreeCameraOptions().position||new d.a5(0,0,0),G=d.ai(s.tileTransform,j,k),X=B.map(ne=>{const te=d.a6.vec3.sub(ne,ne,G);return d.a6.vec3.normalize(te,te),new d.aj(G,te)}),Q=d.ak(s,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:X,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(K=d.al(O),K.min.x=d.ap(K.min.x,0,d.ab),K.min.y=d.ap(K.min.y,0,d.ab),K.max.x=d.ap(K.max.x,0,d.ab),K.max.y=d.ap(K.max.y,0,d.ab),K),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:Q};var K}_bufferedScreenMercator(s,c){const g=uo(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v="globe"===c.projection.name?this._projectAndResample(this.bufferedScreenGeometry(s),c):{polygon:this.bufferedScreenGeometry(s).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(s,c){const g=uo(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v="globe"===c.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),c):{polygon:this.bufferedCameraGeometry(s).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(s,c){const g=function(w,C){const k=d.a6.mat4.multiply([],C.pixelMatrix,C.globeMatrix),O=[0,-d.aq,0,1],B=[0,d.aq,0,1],F=[0,0,0,1];d.a6.vec4.transformMat4(O,O,k),d.a6.vec4.transformMat4(B,B,k),d.a6.vec4.transformMat4(F,F,k);const j=new d.P(O[0]/O[3],O[1]/O[3]),G=new d.P(B[0]/B[3],B[1]/B[3]),X=d.an(w,j)&&O[3]<F[3],Q=d.an(w,G)&&B[3]<F[3];if(!X&&!Q)return null;const K=function(Ce,Ie,Le){for(let je=1;je<Ce.length;je++){const Fe=xr(Ie.pointCoordinate3D(Ce[je-1]).x),Oe=xr(Ie.pointCoordinate3D(Ce[je]).x);if(Le<0){if(Fe<Oe)return{idx:je,t:-Fe/(Oe-1-Fe)}}else if(Oe<Fe)return{idx:je,t:(1-Fe)/(Oe+1-Fe)}}return null}(w,C,X?-1:1);if(!K)return null;const{idx:ne,t:te}=K;let pe=ne>1?Ti(w.slice(0,ne),C):[],be=ne<w.length?Ti(w.slice(ne),C):[];pe=pe.map(Ce=>new d.P(xr(Ce.x),Ce.y)),be=be.map(Ce=>new d.P(xr(Ce.x),Ce.y));const ye=[...pe];0===ye.length&&ye.push(be[be.length-1]);const we=d.aa(ye[ye.length-1].y,(0===be.length?pe[0]:be[0]).y,te);let Ee;return Ee=X?[new d.P(0,we),new d.P(0,0),new d.P(1,0),new d.P(1,we)]:[new d.P(1,we),new d.P(1,1),new d.P(0,1),new d.P(0,we)],ye.push(...Ee),0===be.length?ye.push(pe[0]):ye.push(...be),{polygon:ye.map(Ce=>new d.a5(Ce.x,Ce.y)),unwrapped:!1}}(s,c);if(g)return g;const v=function(w,C){let k=!1,O=-1/0,B=0;for(let j=0;j<w.length-1;j++)w[j].x>O&&(O=w[j].x,B=j);for(let j=0;j<w.length-1;j++){const G=(B+j)%(w.length-1),X=w[G],Q=w[G+1];Math.abs(X.x-Q.x)>.5&&(X.x<Q.x?(X.x+=1,0===G&&(w[w.length-1].x+=1)):(Q.x+=1,G+1===w.length-1&&(w[0].x+=1)),k=!0)}const F=d.am(C.center.lng);return k&&F<Math.abs(F-1)&&w.forEach(j=>{j.x-=1}),{polygon:w,unwrapped:k}}(Ti(s,c).map(w=>new d.P(xr(w.x),w.y)),c);return{polygon:v.polygon.map(w=>new d.a5(w.x,w.y)),unwrapped:v.unwrapped}}}function Ti(m,s){return d.ao(m,c=>{const g=s.pointCoordinate3D(c);c.x=g.x,c.y=g.y},1/256)}function xr(m){return m<0?1+m%1:m%1}function uo(m){return 100*m|0}function Ns(m,s,c,g,v){const w=function(k,O){if(k)return v(k);if(O){if(m.url&&O.tiles&&m.tiles&&delete m.tiles,O.variants){if(!Array.isArray(O.variants))return v(new Error("variants must be an array"));for(const F of O.variants){if(null==F||"object"!=typeof F||F.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return v(new Error("capabilities must be an array"));if(1===F.capabilities.length&&"meshopt"===F.capabilities[0]){O=d.l(O,F);break}}}const B=d.ar(d.l({},O,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);B.tiles=s.canonicalizeTileset(B,m.url),v(null,B)}},C=function(k,O,B){if(!k)return null;if(!O&&!B)return k;B=B||k.worldview_default;const F=Object.values(k.language||{});if(0===F.length)return null;const j=Object.values(k.worldview||{});if(0===j.length)return null;const G=F.every(Q=>Q===O),X=j.every(Q=>Q===B);return G&&X?k:O in(k.language_options||{})||B in(k.worldview_options||{})?null:k.language_options&&k.worldview_options?k:null}(m.data,c,g);return C?d.q.frame(()=>w(null,C)):m.url?d.n(s.transformRequest(s.normalizeSourceURL(m.url,null,c,g),d.R.Source),w):d.q.frame(()=>{const{data:k,...O}=m;w(null,O)})}class Jo{constructor(s,c,g){this.bounds=d.as.convert(this.validateBounds(s)),this.minzoom=c||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const c=Math.pow(2,s.z),g=Math.floor(d.am(this.bounds.getWest())*c),v=Math.floor(d.at(this.bounds.getNorth())*c),w=Math.ceil(d.am(this.bounds.getEast())*c),C=Math.ceil(d.at(this.bounds.getSouth())*c);return s.x>=g&&s.x<w&&s.y>=v&&s.y<C}}class ps extends d.E{constructor(s,c,g,v){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.l(this,d.ar(c,["url","scheme","tileSize","promoteId"])),this._options=d.l({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new d.au}load(s){this._loaded=!1,this.fire(new d.x("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=Ns(this._options,this.map._requestManager,c,g,(v,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new d.t(v));else if(w){if(d.l(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const C of w.vector_layers)this.vectorLayerIds.push(C.id),w.worldview&&w.worldview[C.source]&&this.localizableLayerIds.add(C.id)}w.bounds&&(this.tileBounds=new Jo(w.bounds,this.minzoom,this.maxzoom)),jr(w.tiles,this.map._requestManager._customAccessToken),this.fire(new d.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.x("data",{dataType:"source",sourceDataType:"content"}))}s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=d.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return d.l({},this._options)}loadTile(s,c){const g=s.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(g),w=this.map._requestManager.transformRequest(v,d.R.Tile),C=this.map.style?this.map.style.getLut(this.scope):null,k=C?{image:C.image.clone()}:null,O={request:w,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:k,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:d.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&d.f(g)&&(O.worldview=this.map.getWorldview()||this.worldviewDefault,O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,s.actor&&"expired"!==s.state)"loading"===s.state?s.reloadCallback=c:s.request=s.actor.send("reloadTile",O,B.bind(this));else if(s.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",O,B.bind(this),void 0,!0);else{const F=d.aw.call({deduped:this._deduped},O,(j,G)=>{j||!G?B.call(this,j):(O.data={cacheControl:G.cacheControl,expires:G.expires,rawData:G.rawData.slice(0)},s.actor&&s.actor.send("loadTile",O,B.bind(this),void 0,!0))},!0);s.request={cancel:F}}function B(F,j){return delete s.request,s.aborted?c(null):F&&404!==F.status?c(F):(j&&j.resourceTiming&&(s.resourceTiming=j.resourceTiming),this.map._refreshExpiredTiles&&j&&s.setExpiryData(j),s.loadVectorData(j,this.map.painter),d.ax(this.dispatcher),c(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ql extends d.E{constructor(s,c,g,v){super(),this.id=s,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.l({type:"raster"},c),d.l(this,d.ar(c,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new d.x("dataloading",{dataType:"source"})),this._tileJSONRequest=Ns(this._options,this.map._requestManager,null,null,(c,g)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new d.t(c)):g&&(d.l(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map(v=>v.id)),g.bounds&&(this.tileBounds=new Jo(g.bounds,this.minzoom,this.maxzoom)),jr(g.tiles),this.fire(new d.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.x("data",{dataType:"source",sourceDataType:"content"}))),s&&s(c)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=d.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return d.l({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const g=d.q.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=d.o(this.map._requestManager.transformRequest(v,d.R.Tile),(w,C,k,O)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):w?(s.state="errored",c(w)):C?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:k,expires:O}),s.setTexture(C,this.map.painter),s.state="loaded",d.ax(this.dispatcher),void c(null)):c(null)))}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c&&c()}unloadTile(s,c){s.texture&&s.texture instanceof d.T?(s.destroy(!0),s.texture&&s.texture instanceof d.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Cl extends ql{constructor(s,c,g,v){super(s,c,g,v),this.type="raster-array",this.maxzoom=22,this._options=d.l({type:"raster-array"},c)}triggerRepaint(s){const c=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);c&&c.enabled&&g&&c._clearRenderCacheForTile(g.id,s.tileID),this.map.triggerRepaint()}loadTile(s,c){const g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,d.R.Tile);s.requestParams=v,s.actor||(s.actor=this.dispatcher.getActor()),s.request=s.fetchHeader(void 0,(w,C,k,O)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):w?20===w.code?void 0:(s.state="errored",c(w)):(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:k,expires:O}),s.state="empty",void c(null))))}unloadTile(s,c){const g=s.texture;g&&g instanceof d.T?(s.destroy(!0),this.map.painter.saveTileTexture(g)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,c,g){s._isHeaderLoaded&&("empty"!==s.state&&(s.state="reloading"),s.fetchBand(c,g,(v,w)=>{if(v)return s.state="errored",this.fire(new d.t(v)),void this.triggerRepaint(s);w&&(s.setTexture(w,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:w})=>w===s),g=c&&c.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(s,c,g){if(!s)return;const v=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let w=null;c instanceof d.aB?w=c.paint.get("raster-array-band"):c instanceof d.aC&&(w=c.paint.get("raster-particle-array-band"));const C=w||this.getInitialBand(v);if(null!=C)if(s.textureDescriptor){if(!s.updateNeeded(v,C)||g)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,v,C)}}const Bc={vector:ps,raster:ql,"raster-dem":class extends ql{constructor(m,s,c,g){super(m,s,c,g),this.type="raster-dem",this.maxzoom=22,this._options=d.l({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(m,s){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,w){v&&(m.state="errored",s(v)),w&&(m.dem=w,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",s(null))}m.request=d.o(this.map._requestManager.transformRequest(c,d.R.Tile),function(v,w,C,k){if(delete m.request,m.aborted)m.state="unloaded",s(null);else if(v)m.state="errored",s(v);else if(w){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:C,expires:k});const O=ImageBitmap&&w instanceof ImageBitmap&&d.ay(),B=1-(w.width-d.az(w.width))/2;B<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const F=O?w:d.q.getImageData(w,B),j={uid:m.uid,coord:m.tileID,source:this.id,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:B};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",j,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const s=m.canonical,c=Math.pow(2,s.z),g=(s.x-1+c)%c,v=0===s.x?m.wrap-1:m.wrap,w=(s.x+1+c)%c,C=s.x+1===c?m.wrap+1:m.wrap,k={};return k[new d.aA(m.overscaledZ,v,s.z,g,s.y).key]={backfilled:!1},k[new d.aA(m.overscaledZ,C,s.z,w,s.y).key]={backfilled:!1},s.y>0&&(k[new d.aA(m.overscaledZ,v,s.z,g,s.y-1).key]={backfilled:!1},k[new d.aA(m.overscaledZ,m.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},k[new d.aA(m.overscaledZ,C,s.z,w,s.y-1).key]={backfilled:!1}),s.y+1<c&&(k[new d.aA(m.overscaledZ,v,s.z,g,s.y+1).key]={backfilled:!1},k[new d.aA(m.overscaledZ,m.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},k[new d.aA(m.overscaledZ,C,s.z,w,s.y+1).key]={backfilled:!1}),k}},"raster-array":Cl,geojson:class extends d.E{constructor(m,s,c,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(g),this._data=s.data,this._options=d.l({},s),this._collectResourceTiming=s.collectResourceTiming,void 0!==s.maxzoom&&(this.maxzoom=s.maxzoom),void 0!==s.minzoom&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const v=d.ab/this.tileSize;this.workerOptions=d.l({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(void 0!==s.buffer?s.buffer:128)*v,tolerance:(void 0!==s.tolerance?s.tolerance:.375)*v,extent:d.ab,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:void 0!==s.clusterMaxZoom?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.ab,radius:(void 0!==s.clusterRadius?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new d.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof m&&("Feature"===m.type&&(m={type:"FeatureCollection",features:[m]}),"FeatureCollection"!==m.type))return this.fire(new d.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof m&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const s=new Map;for(const c of this._data.features)s.set(c.id,c);for(const c of m.features)s.set(c.id,c);this._data.features=[...s.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterChildren(m,s){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterLeaves(m,s,c,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:s,offset:c},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.x("dataloading",{dataType:"source"})),this._loaded=!1;const s=d.l({append:m},this.workerOptions);s.scope=this.scope;const c=this._data;"string"==typeof c?(s.request=this.map._requestManager.transformRequest(d.q.resolveURL(c),d.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new d.t(g));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new d.x("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,s){const c=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,v=g?{image:g.image.clone()}:null,w=this._partialReload,C={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:d.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:w};m.request=this.actor.send(c,C,(k,O)=>w&&!O?(m.state="loaded",s(null)):(delete m.request,m.destroy(),m.aborted?s(null):k?s(k):(m.loadVectorData(O,this.map.painter,"reloadTile"===c),s(null))),void 0,"loadTile"===c)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,s){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends d.aD{constructor(m,s,c,g){super(m,s,c,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const s of m.urls)this.urls.push(this.map._requestManager.transformRequest(s,d.R.Source).url);d.aE(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new d.t(s)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const s=this.video.seekable;m<s.start(0)||m>s.end(0)?this.fire(new d.t(new d.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,s=m.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(m,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:d.aD,model:class extends d.E{constructor(m,s,c,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){const m=[];for(const s in this._options.models){const c=this._options.models[s],g=d.aG(this.map._requestManager.transformRequest(c.uri,d.R.Model).url).then(v=>{if(!v)return;const w=d.aH(v),C=new d.aI(s,c.position,c.orientation,w);C.computeBoundsAndApplyParent(),this.models.push(C)}).catch(v=>{this.fire(new d.t(new Error(`Could not load model ${s} from ${c.uri}: ${v.message}`)))});m.push(g)}return Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new d.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this.fire(new d.t(new Error(`Could not load models: ${s.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,s){}serialize(){return{type:"model"}}},"batched-model":class extends d.E{constructor(m,s,c,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}load(m){this._loaded=!1,this.fire(new d.x("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Ns(this._options,this.map._requestManager,s,c,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),c&&2!==c.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new d.t(g))):v&&(d.l(this,v),v.bounds&&(this.tileBounds=new Jo(v.bounds,this.minzoom,this.maxzoom)),jr(v.tiles,this.map._requestManager._customAccessToken),this.fire(new d.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.x("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,s){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(c,d.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(m.actor&&"expired"!==m.state)if("loading"===m.state)m.reloadCallback=s;else{if(m.buckets){const w=Object.values(m.buckets);for(const C of w)C.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,v.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(w,C){return m.aborted?s(null):w&&404!==w.status?s(w):(this.map._refreshExpiredTiles&&C&&m.setExpiryData(C),m.loadModelData(C,this.map.painter),m.state="loaded",void s(null))}}serialize(){return d.l({},this._options)}},canvas:class extends d.aD{constructor(m,s,c,g){super(m,s,c,g),s.coordinates?Array.isArray(s.coordinates)&&4===s.coordinates.length&&!s.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(w=>"number"!=typeof w))||this.fire(new d.t(new d.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.t(new d.V(`sources.${m}`,null,'missing required property "coordinates"'))),s.animate&&"boolean"!=typeof s.animate&&this.fire(new d.t(new d.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),s.canvas?"string"==typeof s.canvas||s.canvas instanceof HTMLCanvasElement||this.fire(new d.t(new d.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.t(new d.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=s,this.animate=void 0===s.animate||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const s=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof d.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends d.E{constructor(m,s,c,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new d.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new d.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Jo(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),d.l(this,d.ar(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return d.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new d.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new d.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:s,y:c,z:g}=m.canonical;return this._implementation.hasTile({x:s,y:c,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,s){const{x:c,y:g,z:v}=m.tileID.canonical,w=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:c,y:g,z:v},{signal:w.signal})).then(function(C){return delete m.request,m.aborted?(m.state="unloaded",s(null)):void 0===C?(m.state="errored",s(null)):null===C?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",s(null)):(k=C)instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement?(this.loadTileData(m,C),m.state="loaded",void s(null)):(m.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var k}.bind(this)).catch(C=>{20!==C.code&&(m.state="errored",s(C))}),m.request.cancel=()=>w.abort()}loadTileData(m,s){m.setTexture(s,this.map.painter)}unloadTile(m,s){if(m.texture&&m.texture instanceof d.T?(m.destroy(!0),m.texture&&m.texture instanceof d.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:c,y:g,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:c,y:g,z:v})}s&&s()}abortTile(m,s){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=d.av(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new d.x("data",{dataType:"source",sourceDataType:"content"}))}}},yf=function(m,s,c,g){const v=new Bc[s.type](m,s,c,g);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return d.aJ(["load","abort","unload","serialize","prepare"],v),v};function Rh(m,s){const c=d.a6.mat4.identity([]);return d.a6.mat4.scale(c,c,[.5*m.width,.5*-m.height,1]),d.a6.mat4.translate(c,c,[1,-1,0]),d.a6.mat4.multiply(c,c,m.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(c)}function vf(m,s,c,g,v,w,C,k,O=!1){const B=m.tilesIn(c,k,O);B.sort(fd);const F=[];for(const G of B)F.push({wrappedTileID:G.tile.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(s,m._state,G,g,v,w,C,Rh(m.transform,G.tile.tileID),O)});const j=function(G){const X={},Q={};for(const K of G){const ne=K.queryResults,te=K.wrappedTileID,pe=Q[te]=Q[te]||{};for(const be in ne){const ye=ne[be],we=pe[be]=pe[be]||{},Ee=X[be]=X[be]||[];for(const Ce of ye)we[Ce.featureIndex]||(we[Ce.featureIndex]=!0,Ee.push(Ce))}}return X}(F);for(const G in j)j[G].forEach(X=>{const Q=X.feature,K=Q.layer;K&&"background"!==K.type&&"sky"!==K.type&&"slot"!==K.type&&(d.aK(G)||(Q.source=K.source,K["source-layer"]&&(Q.sourceLayer=K["source-layer"])),Q.state=void 0!==Q.id?m.getFeatureState(K["source-layer"],Q.id):{})});return j}function Bm(m,s){const c=m.getRenderableIds().map(w=>m.getTileByID(w)),g=[],v={};for(let w=0;w<c.length;w++){const C=c[w],k=C.tileID.canonical.key;v[k]||(v[k]=!0,C.querySourceFeatures(g,s))}return g}function fd(m,s){const c=m.tileID,g=s.tileID;return c.overscaledZ-g.overscaledZ||c.canonical.y-g.canonical.y||c.wrap-g.wrap||c.canonical.x-g.canonical.x}function md(m,s){const c={};if(!s)return c;for(const g of m){const v=g.layerIds.map(w=>s.getLayer(w)).filter(Boolean);if(0!==v.length){g.layers=v,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(w=>v.filter(C=>C.id===w)[0]));for(const w of v)c[w.fqid]=g}}return c}const Dl=new Uint16Array(8184);for(let m=0;m<2046;m++){let s=m+2,c=0,g=0,v=0,w=0,C=0,k=0;for(1&s?v=w=C=32:c=g=k=32;(s>>=1)>1;){const B=c+v>>1,F=g+w>>1;1&s?(v=c,w=g,c=C,g=k):(c=v,g=w,v=C,w=k),C=B,k=F}const O=4*m;Dl[O+0]=c,Dl[O+1]=g,Dl[O+2]=v,Dl[O+3]=w}const xa=new Uint16Array(2178),ho=new Uint8Array(1089),yo=new Uint16Array(1089);function xf(m){return 0===m?-.03125:32===m?.03125:0}const kh={type:2,extent:d.ab,loadGeometry:()=>[[new d.P(0,0),new d.P(d.ab+1,0),new d.P(d.ab+1,d.ab+1),new d.P(0,d.ab+1),new d.P(0,0)]]};class Er{constructor(s,c,g,v,w){this.tileID=s,this.uid=d.aQ(),this.uses=0,this.tileSize=c,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection)}registerFadeDuration(s){const c=s+this.timeAdded;c<d.q.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=d.aL(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,c,g){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=md(s.buckets,c.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const w=this.buckets[v];if(w instanceof d.aS){if(this.hasSymbolBuckets=!0,!g)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const w=this.buckets[v];if(w instanceof d.aS&&w.hasRTLText){this.hasRTLText=!0,d.aT();break}}this.queryPadding=0;for(const v in this.buckets){const w=this.buckets[v],C=c.style.getOwnLayer(v);if(!C)continue;const k=C.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,k)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new d.aR}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,c,g){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets={...this.buckets,...md(s.buckets,c.style)},s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s){for(const v in this.buckets){const w=this.buckets[v];w.uploadPending()&&w.upload(s)}const c=s.gl,g=this.imageAtlas;if(g&&!g.uploaded){const v=!!Object.keys(g.patternPositions).length;this.imageAtlasTexture=new d.T(s,g.image,c.RGBA8,{useMipmap:v}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new d.T(s,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new d.T(s,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(s,c,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,g),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=c.style.getBrightness();(this._lastUpdatedBrightness||v)&&(this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this._lastUpdatedBrightness=v,this.updateBuckets(c)))}queryRenderedFeatures(s,c,g,v,w,C,k,O,B){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:g,pixelPosMatrix:O,transform:k,filter:v,layers:w,availableImages:C,tileTransform:this.tileTransform},s,c):{}}querySourceFeatures(s,c){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const v=g.loadVTLayers(),w=c?c.sourceLayer:"",C=v._geojsonTileLayer||v[w];if(!C)return;const k=d.aU(c&&c.filter),{z:O,x:B,y:F}=this.tileID.canonical,j={z:O,x:B,y:F};for(let G=0;G<C.length;G++){const X=C.feature(G);if(k.needGeometry){const ne=d.aV(X,!0);if(!k.filter(new d.a3(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!k.filter(new d.a3(this.tileID.overscaledZ),X))continue;const Q=g.getId(X,w),K=new d.aW(X,O,B,F,Q);K.tile=j,s.push(K)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const c=this.expirationTime;if(s.cacheControl){const g=d.aX(s.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const g=Date.now();let v=!1;if(this.expirationTime>g)v=!1;else if(c)if(this.expirationTime<c)v=!0;else{const w=this.expirationTime-c;w?this.expirationTime=g+Math.max(w,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}updateBuckets(s){if(!this.latestFeatureIndex)return;const c=this.latestFeatureIndex.loadVTLayers(),g=s.style.listImages(),v=s.style.getBrightness();for(const w in this.buckets){if(!s.style.hasLayer(w))continue;const C=this.buckets[w],k=C.layers[0],O=k.sourceLayer||"_geojsonTileLayer",B=c[O],F=s.style.getSourceCache(k.source,k.scope);let j={};F&&(j=F._state.getState(O,void 0)),C.update(j,B,g,this.imageAtlas&&this.imageAtlas.patternPositions||{},v),(C instanceof d.aY||C instanceof d.aZ)&&s._terrain&&s._terrain.enabled&&F&&C.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(F.id,this.tileID);const G=s&&s.style&&s.style.getOwnLayer(w);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(C)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<d.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=d.q.now()+s}setTexture(s,c){const g=c.context,v=g.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof d.T?this.texture.update(s):(this.texture=new d.T(g,s,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(s,c){const g={};for(const v of c)g[v]=!0;this.dependencies[s]=g}hasDependency(s,c){for(const g of s){const v=this.dependencies[g];if(v)for(const w of c)if(v[w])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,c){if(!c||"mercator"===c.name||this._tileDebugBuffer)return;const g=d.a_(kh,this.tileID.canonical,this.tileTransform)[0],v=new d.a$,w=new d.b0;for(let C=0;C<g.length;C++){const{x:k,y:O}=g[C];v.emplaceBack(k,O),w.emplaceBack(C)}w.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(w),this._tileDebugBuffer=s.createVertexBuffer(v,d.b1.members),this._tileDebugSegments=d.b2.simpleSegment(0,0,v.length,w.length)}_makeTileBoundsBuffers(s,c){if(this._tileBoundsBuffer||!c||"mercator"===c.name)return;const g=d.a_(kh,this.tileID.canonical,this.tileTransform)[0];let v,w;if(this.isRaster){const C=function(k,O){const B=d.aL(k,O),F=Math.pow(2,k.z);for(let ne=0;ne<33;ne++)for(let te=0;te<33;te++){const pe=d.aM((k.x+(te+xf(te))/32)/F),be=d.aN((k.y+(ne+xf(ne))/32)/F),ye=O.project(pe,be),we=33*ne+te;xa[2*we+0]=Math.round((ye.x*B.scale-B.x)*d.ab),xa[2*we+1]=Math.round((ye.y*B.scale-B.y)*d.ab)}ho.fill(0),yo.fill(0);for(let ne=2045;ne>=0;ne--){const te=4*ne,pe=Dl[te+0],be=Dl[te+1],ye=Dl[te+2],we=Dl[te+3],Ee=pe+ye>>1,Ce=be+we>>1,Ie=Ee+Ce-be,Le=Ce+pe-Ee,je=33*be+pe,Fe=33*we+ye,Oe=33*Ce+Ee,ct=Math.hypot((xa[2*je+0]+xa[2*Fe+0])/2-xa[2*Oe+0],(xa[2*je+1]+xa[2*Fe+1])/2-xa[2*Oe+1])>=16;ho[Oe]=ho[Oe]||(ct?1:0),ne<1022&&(ho[Oe]=ho[Oe]||ho[33*(be+Le>>1)+(pe+Ie>>1)]||ho[33*(we+Le>>1)+(ye+Ie>>1)])}const j=new d.aO,G=new d.aP;let X=0;function Q(ne,te){const pe=33*te+ne;return 0===yo[pe]&&(j.emplaceBack(xa[2*pe+0],xa[2*pe+1],ne*d.ab/32,te*d.ab/32),yo[pe]=++X),yo[pe]-1}function K(ne,te,pe,be,ye,we){const Ee=ne+pe>>1,Ce=te+be>>1;if(Math.abs(ne-ye)+Math.abs(te-we)>1&&ho[33*Ce+Ee])K(ye,we,ne,te,Ee,Ce),K(pe,be,ye,we,Ee,Ce);else{const Ie=Q(ne,te),Le=Q(pe,be),je=Q(ye,we);G.emplaceBack(Ie,Le,je)}}return K(0,0,32,32,32,0),K(32,32,0,0,0,32),{vertices:j,indices:G}}(this.tileID.canonical,c);v=C.vertices,w=C.indices}else{v=new d.aO,w=new d.aP;for(const{x:k,y:O}of g)v.emplaceBack(k,O,0,0);const C=d.b3(v.int16,void 0,4);for(let k=0;k<C.length;k+=3)w.emplaceBack(C[k],C[k+1],C[k+2])}this._tileBoundsBuffer=s.createVertexBuffer(v,d.b4.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(w),this._tileBoundsSegments=d.b2.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugBuffers(s,c){const g=c.projection;if(!g||"globe"!==g.name||c.freezeTileCoverage)return;const v=this.tileID.canonical,w=d.b5(v,c),C=d.b6(w),k=d.a9(c.zoom);let O;k>0&&(O=d.a6.mat4.invert(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,v,c,C,O,k),this._makeGlobeTileDebugTextBuffer(s,v,c,C,O,k)}_globePoint(s,c,g,v,w,C,k){let O=d.b7(s,c,g);if(C){const B=1<<g.z,F=d.am(v.center.lng),j=d.at(v.center.lat),G=(g.x+.5)/B-F;let X=0;G>.5?X=-1:G<-.5&&(X=1);let Q=(s/d.ab+g.x)/B+X,K=(c/d.ab+g.y)/B;Q=(Q-F)*v._pixelsPerMercatorPixel+F,K=(K-j)*v._pixelsPerMercatorPixel+j;const ne=[Q*v.worldSize,K*v.worldSize,0];d.a6.vec3.transformMat4(ne,ne,C),O=d.b8(O,ne,k)}return d.a6.vec3.transformMat4(O,O,w)}_makeGlobeTileDebugBorderBuffer(s,c,g,v,w,C){const k=new d.a$,O=new d.b0,B=new d.b9,F=(G,X,Q,K,ne)=>{const te=(Q-G)/(ne-1),pe=(K-X)/(ne-1),be=k.length;for(let ye=0;ye<ne;ye++){const we=G+ye*te,Ee=X+ye*pe;k.emplaceBack(we,Ee);const Ce=this._globePoint(we,Ee,c,g,v,w,C);B.emplaceBack(Ce[0],Ce[1],Ce[2]),O.emplaceBack(be+ye)}},j=d.ab;F(0,0,j,0,16),F(j,0,j,j,16),F(j,j,0,j,16),F(0,j,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(O),this._tileDebugBuffer=s.createVertexBuffer(k,d.b1.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(B,d.ba.members),this._tileDebugSegments=d.b2.simpleSegment(0,0,k.length,O.length)}_makeGlobeTileDebugTextBuffer(s,c,g,v,w,C){const k=d.ab/4,O=new d.a$,B=new d.aP,F=new d.b9,j=25;B.reserve(32),O.reserve(j),F.reserve(j);const G=(X,Q)=>j*X+Q;for(let X=0;X<j;X++){const Q=X*k;for(let K=0;K<j;K++){const ne=K*k;O.emplaceBack(ne,Q);const te=this._globePoint(ne,Q,c,g,v,w,C);F.emplaceBack(te[0],te[1],te[2])}}for(let X=0;X<4;X++)for(let Q=0;Q<4;Q++){const K=G(X,Q),ne=G(X,Q+1),te=G(X+1,Q),pe=G(X+1,Q+1);B.emplaceBack(K,ne,te),B.emplaceBack(te,ne,pe)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(B),this._tileDebugTextBuffer=s.createVertexBuffer(O,d.b1.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(F,d.ba.members),this._tileDebugTextSegments=d.b2.simpleSegment(0,0,j,32)}destroy(s=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof d.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}d.bb.setPbf(d.bc);class gd extends Er{constructor(s,c,g,v,w){super(s,c,g,v,w),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(s,c){const g=c.context,v=g.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof d.T?this.texture.update(s,{premultiply:!1}):this.texture=new d.T(g,s,v.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(s=16384,c){const g=this._mrt=new d.bb(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=d.bd(v,(w,C,k,O)=>{if(w)c(w);else try{const B=g.getHeaderLength(C);if(B>s)return void(this.request=this.fetchHeader(B,c));g.parseHeader(C),this._isHeaderLoaded=!0;let F=0;for(const j of Object.values(g.layers))F=Math.max(F,j.dataIndex[j.dataIndex.length-1].last_byte);C.byteLength>=F&&(this.entireBuffer=C),c(null,this.entireBuffer||C,k,O)}catch(B){c(B)}}),this.request}fetchBand(s,c,g){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void g(new Error("Tile header is not ready"));const w=this.actor;if(!w)return void g(new Error("Can't fetch tile band without an actor"));let C;const k=(j,G)=>{C.complete(j,G),j?g(j):(this.updateTextureDescriptor(s,c),g(null,this.textureDescriptor&&this.textureDescriptor.img))},O=(j,G)=>{if(j)return g(j);const X=w.send("decodeRasterArray",{buffer:G,task:C},k,void 0,!0);this._workQueue.push(()=>{X&&X.cancel(),C.cancel()})},B=v.getLayer(s);if(!B)return void g(new Error(`Unknown sourceLayer "${s}"`));if(B.hasDataForBand(c))return this.updateTextureDescriptor(s,c),void g(null,this.textureDescriptor?this.textureDescriptor.img:null);const F=B.getDataRange([c]);if(C=v.createDecodingTask(F),!C||C.tasks.length)if(this.flushQueues(),this.entireBuffer)O(null,this.entireBuffer.slice(F.firstByte,F.lastByte+1));else{const j=Object.assign({},this.requestParams,{headers:{Range:`bytes=${F.firstByte}-${F.lastByte}`}}),G=d.bd(j,O);this._fetchQueue.push(()=>{G.cancel(),C.cancel()})}else g(null)}updateNeeded(s,c){return(!this.textureDescriptor||this.textureDescriptor.band!==c||this.textureDescriptor.layer!==s)&&"errored"!==this.state}updateTextureDescriptor(s,c){if(!this._mrt)return;const g=this._mrt.getLayer(s);if(!g||!g.hasBand(c)||!g.hasDataForBand(c))return;const{bytes:v,tileSize:w,buffer:C,offset:k,scale:O}=g.getBandView(c),B=w+2*C,F={data:v,width:B,height:B},j=this.texture;j&&j instanceof d.T&&j.update(F,{premultiply:!1}),this.textureDescriptor={layer:s,band:c,img:F,buffer:C,offset:k,tileSize:w,format:g.pixelFormat,mix:[O,256*O,65536*O,16777216*O]}}}class vo{constructor(s,c){this.max=s,this.onRemove=c,this.reset()}reset(){for(const s in this.data)for(const c of this.data[s])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(s,c,g){const v=s.wrapped().key;void 0===this.data[v]&&(this.data[v]=[]);const w={value:c,timeout:void 0};if(void 0!==g&&(w.timeout=setTimeout(()=>{this.remove(s,w)},g)),this.data[v].push(w),this.order.push(v),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),0===this.data[s].length&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value}getByKey(s){const c=this.data[s];return c?c[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,c){if(!this.has(s))return this;const g=s.wrapped().key,v=void 0===c?0:this.data[g].indexOf(c),w=this.data[g][v];return this.data[g].splice(v,1),w.timeout&&clearTimeout(w.timeout),0===this.data[g].length&&delete this.data[g],this.onRemove(w.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(s){const c=[];for(const g in this.data)for(const v of this.data[g])s(v.value)||c.push(v);for(const g of c)this.remove(g.value.tileID,g)}}class zm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,c,g){const v=String(c);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][v]=this.stateChanges[s][v]||{},d.l(this.stateChanges[s][v],g),null===this.deletedStates[s]){this.deletedStates[s]={};for(const w in this.state[s])w!==v&&(this.deletedStates[s][w]=null)}else if(this.deletedStates[s]&&null===this.deletedStates[s][v]){this.deletedStates[s][v]={};for(const w in this.state[s][v])g[w]||(this.deletedStates[s][v][w]=null)}else for(const w in g)this.deletedStates[s]&&this.deletedStates[s][v]&&null===this.deletedStates[s][v][w]&&delete this.deletedStates[s][v][w]}removeFeatureState(s,c,g){if(null===this.deletedStates[s])return;const v=String(c);if(this.deletedStates[s]=this.deletedStates[s]||{},g&&void 0!==c)null!==this.deletedStates[s][v]&&(this.deletedStates[s][v]=this.deletedStates[s][v]||{},this.deletedStates[s][v][g]=null);else if(void 0!==c)if(this.stateChanges[s]&&this.stateChanges[s][v])for(g in this.deletedStates[s][v]={},this.stateChanges[s][v])this.deletedStates[s][v][g]=null;else this.deletedStates[s][v]=null;else this.deletedStates[s]=null}getState(s,c){const g=this.state[s]||{},v=this.stateChanges[s]||{},w=this.deletedStates[s];if(null===w)return{};if(void 0!==c){const k=String(c),O=d.l({},g[k],v[k]);if(w){const B=w[c];if(null===B)return{};for(const F in B)delete O[F]}return O}const C=d.l({},g,v);if(w)for(const k in w)delete C[k];return C}initializeTileState(s,c){s.refreshFeatureState(c)}coalesceChanges(s,c){const g={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const w={};for(const C in this.stateChanges[v])this.state[v][C]||(this.state[v][C]={}),d.l(this.state[v][C],this.stateChanges[v][C]),w[C]=this.state[v][C];g[v]=w}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const w={};if(null===this.deletedStates[v])for(const C in this.state[v])w[C]={},this.state[v][C]={};else for(const C in this.deletedStates[v]){if(null===this.deletedStates[v][C])this.state[v][C]={};else if(this.state[v][C])for(const k of Object.keys(this.deletedStates[v][C]))delete this.state[v][C][k];w[C]=this.state[v][C]}g[v]=g[v]||{},d.l(g[v],w)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(g).length)for(const v in s)s[v].refreshFeatureState(c)}}class wa extends d.E{constructor(s,c,g){super(),this.id=s,this._onlySymbols=g,c.on("data",v=>{"source"===v.dataType&&"metadata"===v.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===v.dataType&&"content"===v.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new vo(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new zm,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(s){this.map=s,this._minTileCacheSize=void 0===this._minTileCacheSize&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const c=this._tiles[s];if("loaded"!==c.state&&"errored"!==c.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,c){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,c)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const g=this._tiles[c];g.upload(s),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return d.be(this._tiles).map(s=>s.tileID).sort(dr).map(s=>s.key)}getRenderableIds(s,c){const g=[];for(const v in this._tiles)this._isIdRenderable(+v,s,c)&&g.push(this._tiles[v]);return s?g.sort((v,w)=>{const C=v.tileID,k=w.tileID,O=new d.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle),B=new d.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle);return C.overscaledZ-k.overscaledZ||B.y-O.y||B.x-O.x}).map(v=>v.tileID.key):g.map(v=>v.tileID).sort(dr).map(v=>v.key)}hasRenderableParent(s){const c=this.findLoadedParent(s,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(s,c,g){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(c||!this._tiles[s].holdingForFade())&&(g||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)"errored"!==this._tiles[s].state&&this._reloadTile(+s,"reloading")}}_reloadTile(s,c){const g=this._tiles[s];g&&("loading"!==g.state&&(g.state=c),this._loadTile(g,this._tileLoaded.bind(this,g,s,c)))}_tileLoaded(s,c,g,v){if(v)if(s.state="errored",404!==v.status)this._source.fire(new d.t(v,{tile:s}));else{if(this._source.fire(new d.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}else s.timeAdded=d.q.now(),"expired"===g&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(c,s),"raster-dem"===this._source.type&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new d.x("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id}))}_backfillDEM(s){const c=this.getRenderableIds();for(let v=0;v<c.length;v++){const w=c[v];if(s.neighboringTiles&&s.neighboringTiles[w]){const C=this.getTileByID(w);g(s,C),g(C,s)}}function g(v,w){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let C=w.tileID.canonical.x-v.tileID.canonical.x;const k=w.tileID.canonical.y-v.tileID.canonical.y,O=Math.pow(2,v.tileID.canonical.z),B=w.tileID.key;0===C&&0===k||Math.abs(k)>1||(Math.abs(C)>1&&(1===Math.abs(C+O)?C+=O:1===Math.abs(C-O)&&(C-=O)),w.dem&&v.dem&&(v.dem.backfillBorder(w.dem,C,k),v.neighboringTiles&&v.neighboringTiles[B]&&(v.neighboringTiles[B].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,c,g,v){for(const w in this._tiles){let C=this._tiles[w];if(v[w]||!C.hasData()||C.tileID.overscaledZ<=c||C.tileID.overscaledZ>g)continue;let k=C.tileID;for(;C&&C.tileID.overscaledZ>c+1;){const B=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[B.key],C&&C.hasData()&&(k=B)}let O=k;for(;O.overscaledZ>c;)if(O=O.scaledTo(O.overscaledZ-1),s[O.key]){v[k.key]=k;break}}}findLoadedParent(s,c){if(s.key in this._loadedParentTiles){const g=this._loadedParentTiles[s.key];return g&&g.tileID.overscaledZ>=c?g:null}for(let g=s.overscaledZ-1;g>=c;g--){const v=s.scaledTo(g),w=this._getLoadedTile(v);if(w)return w}}_getLoadedTile(s){const c=this._tiles[s.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,c){c=c||this._source.tileSize;const g=Math.ceil(s.width/c)+1,v=Math.ceil(s.height/c)+1,w=Math.floor(g*v*5),C="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,w):w,k="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(k)}handleWrapJump(s){const c=Math.round((s-(void 0===this._prevLng?s:this._prevLng))/360);if(this._prevLng=s,c){const g={};for(const v in this._tiles){const w=this._tiles[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+c),g[w.tileID.key]=w}this._tiles=g;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(s,c,g,v){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(s,c),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w="batched-model"===this._source.type;let C,k=this._source.maxzoom;const O=this.map&&this.map.painter?this.map.painter._terrain:null;if(O&&O.sourceCache===this&&O.attenuationRange()){const j=O.attenuationRange()[0],G=Math.floor(j)-Math.log2(O.getDemUpscale());k>G&&(k=G)}if(this.used||this.usedForTerrain){if(this._source.tileID)C=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(j=>new d.aA(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y));else if(0!==this.tileCoverLift){const j=s.clone();j.tileCoverLift=this.tileCoverLift,C=j.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&"globe"===s.projection.name&&(C.push(new d.aA(1,0,1,0,0)),C.push(new d.aA(1,0,1,1,0)),C.push(new d.aA(1,0,1,0,1)),C.push(new d.aA(1,0,1,1,1)))}else if(C=s.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const j=this._source.hasTile.bind(this._source);C=C.filter(G=>j(G))}}else C=[];if(C.length>0&&this.castsShadows&&v&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Pi(this._source.type)){const j=s.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),G=Math.min(j,this._source.maxzoom);if(w){const X=s.extendTileCover(C,G);for(const Q of X)C.push(Q)}else{const X=s.extendTileCover(C,G,v);for(const Q of X)this._shadowCasterTiles[Q.key]=!0,C.push(Q)}}const B=this._updateRetainedTiles(C);if(Pi(this._source.type)&&0!==C.length){const j={},G={},X=Object.keys(B);for(const K of X){const ne=B[K],te=this._tiles[K];if(!te||te.fadeEndTime&&te.fadeEndTime<=d.q.now())continue;const pe=this.findLoadedParent(ne,Math.max(ne.overscaledZ-wa.maxOverzooming,this._source.minzoom));pe&&(this._addTile(pe.tileID),j[pe.tileID.key]=pe.tileID),G[K]=ne}const Q=C[C.length-1].overscaledZ;for(const K in this._tiles){const ne=this._tiles[K];if(B[K]||!ne.hasData())continue;let te=ne.tileID;for(;te.overscaledZ>Q;){te=te.scaledTo(te.overscaledZ-1);const pe=this._tiles[te.key];if(pe&&pe.hasData()&&G[te.key]){B[K]=ne.tileID;break}}}for(const K in j)B[K]||(this._coveredTiles[K]=!0,B[K]=j[K])}for(const j in B)this._tiles[j].clearFadeHold();const F=d.bf(this._tiles,B);for(const j of F){const G=this._tiles[j];G.hasSymbolBuckets&&!G.holdingForFade()?G.setHoldDuration(this.map._fadeDuration):G.hasSymbolBuckets&&!G.symbolFadeFinished()||this._removeTile(+j)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const c={};if(0===s.length)return c;const g={},v=s.reduce((B,F)=>Math.min(B,F.overscaledZ),1/0),w=s[0].overscaledZ,C=Math.max(w-wa.maxOverzooming,this._source.minzoom),k=Math.max(w+wa.maxUnderzooming,this._source.minzoom),O={};for(const B of s){const F=this._addTile(B);c[B.key]=B,F.hasData()||v<this._source.maxzoom&&(O[B.key]=B)}this._retainLoadedChildren(O,v,k,c);for(const B of s){let F=this._tiles[B.key];if(F.hasData())continue;if(B.canonical.z>=this._source.maxzoom){const G=B.children(this._source.maxzoom)[0],X=this.getTile(G);if(X&&X.hasData()){c[G.key]=G;continue}}else{const G=B.children(this._source.maxzoom);if(c[G[0].key]&&c[G[1].key]&&c[G[2].key]&&c[G[3].key])continue}let j=F.wasRequested();for(let G=B.overscaledZ-1;G>=C;--G){const X=B.scaledTo(G);if(g[X.key]||(g[X.key]=!0,F=this.getTile(X),!F&&j&&(F=this._addTile(X)),F&&(c[X.key]=X,j=F.wasRequested(),F.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const c=[];let g,v=this._tiles[s].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){g=this._loadedParentTiles[v.key];break}c.push(v.key);const w=v.scaledTo(v.overscaledZ-1);if(g=this._getLoadedTile(w),g)break;v=w}for(const w of c)this._loadedParentTiles[w]=g}}_addTile(s){let c=this._tiles[s.key];if(c)return!0!==c.isExtraShadowCaster||!!this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),c;c=this._cache.getAndRemove(s),c&&(this._setTileReloadTimer(s.key,c),c.tileID=s,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,c)));const g=Boolean(c);if(!g){const v=this.map?this.map.painter:null,w=this._source.tileSize*s.overscaleFactor();c="raster-array"===this._source.type?new gd(s,w,this.transform.tileZoom,v,this._isRaster):new Er(s,w,this.transform.tileZoom,v,this._isRaster),this._loadTile(c,this._tileLoaded.bind(this,c,s.key,c.state))}return c?(c.uses++,this._tiles[s.key]=c,g||this._source.fire(new d.x("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(s,c){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const g=c.getExpiryTimeout();g&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},g))}_removeTile(s){const c=this._tiles[s];c&&(c.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),c.uses>0||(c.hasData()&&"reloading"!==c.state||"empty"===c.state?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,c,g){const v=[],w=this.transform;if(!w)return v;const C="globe"===w.projection.name,k=d.am(w.center.lng);for(const O in this._tiles){const B=this._tiles[O];if(g&&B.clearQueryDebugViz(),B.holdingForFade())continue;let F;if(C){const j=B.tileID.canonical;if(0===j.z){const G=[Math.abs(d.ap(k,...zc(j,-1))-k),Math.abs(d.ap(k,...zc(j,1))-k)];F=[0,2*G.indexOf(Math.min(...G))-1]}else{const G=[Math.abs(d.ap(k,...zc(j,-1))-k),Math.abs(d.ap(k,...zc(j,0))-k),Math.abs(d.ap(k,...zc(j,1))-k)];F=[G.indexOf(Math.min(...G))-1]}}else F=[0];for(const j of F){const G=s.containsTile(B,w,c,j);G&&v.push(G)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,c){const g=this.getRenderableIds(s,c).map(w=>this._tiles[w].tileID),v="globe"===this.transform.projection.name;for(const w of g)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=v?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return g}sortCoordinatesByDistance(s){const c=s.slice(),g=this.transform._camera.position,v=this.transform._camera.forward(),w={};for(const C of c){const k=1/(1<<C.canonical.z);w[C.key]=((C.canonical.x+.5)*k+C.wrap-g[0])*v[0]+((C.canonical.y+.5)*k-g[1])*v[1]-g[2]*v[2]}return c.sort((C,k)=>w[C.key]-w[k.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(Pi(this._source.type))for(const s in this._tiles){const c=this._tiles[s];if(void 0!==c.fadeEndTime&&c.fadeEndTime>=d.q.now())return!0}return!1}setFeatureState(s,c,g){this._state.updateState(s=s||"_geojsonTileLayer",c,g)}removeFeatureState(s,c,g){this._state.removeFeatureState(s=s||"_geojsonTileLayer",c,g)}getFeatureState(s,c){return this._state.getState(s=s||"_geojsonTileLayer",c)}setDependencies(s,c,g){const v=this._tiles[s];v&&v.setDependencies(c,g)}reloadTilesForDependencies(s,c){for(const g in this._tiles)this._tiles[g].hasDependency(s,c)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(s,c))}_preloadTiles(s,c){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(s,c))};return void this._source.on("data",O)}const g=new Map,v=Array.isArray(s)?s:[s],w=this.map.painter.terrain,C=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const O of v){const B=O.coveringTiles({tileSize:C,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of B)g.set(F.key,F);this.usedForTerrain&&O.updateElevation(!1)}const k=Array.from(g.values());d.bg(k,(O,B)=>{const F=new Er(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(F,j=>{"raster-dem"===this._source.type&&F.dem&&this._backfillDEM(F),B(j,F)})},c)}}function dr(m,s){const c=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||g-c||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function Pi(m){return"raster"===m||"image"===m||"video"===m||"custom"===m}function zc(m,s){const c=1<<m.z;return[m.x/c+s,(m.x+1)/c+s]}wa.maxOverzooming=10,wa.maxUnderzooming=3;class N_{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];for(const g in this.style._mergedLayers){const v=this.style._mergedLayers[g];if("fill-extrusion"===v.type)this.layers.push({layer:v,visible:false,visibilityChanged:false});else if("model"===v.type){const w=this.style.getLayerSource(v);w&&"batched-model"===w.type&&this.layers.push({layer:v,visible:false,visibilityChanged:false})}}}onNewFrame(s){this.layersGotHidden=!1;for(const c of this.layers){const g=c.layer;let v=!1;"fill-extrusion"===g.type?v=!g.isHidden(s)&&g.paint.get("fill-extrusion-opacity")>0:"model"===g.type&&(v=!g.isHidden(s)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&c.visible,c.visible=v}}updateZOffset(s,c){this.currentBuildingBuckets=[];for(const v of this.layers){const w=v.layer,C=this.style.getLayerSourceCache(w);let k=1;"fill-extrusion"===w.type&&(k=v.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let O=C?C.getTile(c):null;if(!O&&C&&c.canonical.z>C.getSource().minzoom){let B=c.scaledTo(Math.min(C.getSource().maxzoom,c.overscaledZ-1));for(;B.overscaledZ>=C.getSource().minzoom&&(O=C.getTile(B),!O&&0!==B.overscaledZ);)B=B.scaledTo(B.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:O?O.getBucket(w):null,tileID:O?O.tileID:c,verticalScale:k})}s.hasAnyZOffset=!1;let g=!1;for(let v=0;v<s.symbolInstances.length;v++){const w=s.symbolInstances.get(v),C=w.zOffset,k=this._getHeightAtTileOffset(c,w.tileAnchorX,w.tileAnchorY);w.zOffset=k!==Number.NEGATIVE_INFINITY?k:C,g||C===w.zOffset||(g=!0),s.hasAnyZOffset||0===w.zOffset||(s.hasAnyZOffset=!0)}g&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,c,g,v){let w=c,C=g;if(s.canonical.z!==v.canonical.z){const k=v.canonical,O=1/(1<<s.canonical.z-k.z);w=(c+s.canonical.x*d.ab)*O-k.x*d.ab|0,C=(g+s.canonical.y*d.ab)*O-k.y*d.ab|0}return{tileX:w,tileY:C}}_getHeightAtTileOffset(s,c,g){let v,w;for(let C=0;C<this.layers.length;++C){if("fill-extrusion"!==this.layers[C].layer.type)continue;const{bucket:k,tileID:O,verticalScale:B}=this.currentBuildingBuckets[C];if(!k)continue;const{tileX:F,tileY:j}=this._mapCoordToOverlappingTile(s,c,g,O),G=k.getHeightAtTileCoord(F,j);G&&void 0!==G.height&&(G.hidden?v=G.height:w=Math.max(G.height*B,w||0))}if(void 0!==w)return w;for(let C=0;C<this.layers.length;++C){const k=this.layers[C];if("model"!==k.layer.type||!k.visible)continue;const{bucket:O,tileID:B}=this.currentBuildingBuckets[C];if(!O)continue;const{tileX:F,tileY:j}=this._mapCoordToOverlappingTile(s,c,g,B),G=O.getHeightAtTileCoord(F,j);if(G&&!G.hidden)return void 0===G.height&&void 0!==v?Math.min(G.maxHeight,v)*G.verticalScale:G.height?G.height*G.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ln(m,s){const c={};for(const g in m)"ref"!==g&&(c[g]=m[g]);return d.bh.forEach(g=>{g in s&&(c[g]=s[g])}),c}function _d(m){m=m.slice();const s=Object.create(null);for(let c=0;c<m.length;c++)s[m[c].id]=m[c];for(let c=0;c<m.length;c++)"ref"in m[c]&&(m[c]=ln(m[c],s[m[c].ref]));return m}const Ln={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function $r(m,s,c){c.push({command:Ln.addSource,args:[m,s[m]]})}function mr(m,s,c){s.push({command:Ln.removeSource,args:[m]}),c[m]=!0}function e1(m,s,c,g){mr(m,c,g),$r(m,s,c)}function Wn(m,s,c){let g;for(g in m[c])if(m[c].hasOwnProperty(g)&&"data"!==g&&!d.bi(m[c][g],s[c][g]))return!1;for(g in s[c])if(s[c].hasOwnProperty(g)&&"data"!==g&&!d.bi(m[c][g],s[c][g]))return!1;return!0}function Vc(m,s,c,g,v,w){let C;for(C in s=s||{},m=m||{})m.hasOwnProperty(C)&&(d.bi(m[C],s[C])||c.push({command:w,args:[g,C,s[C],v]}));for(C in s)s.hasOwnProperty(C)&&!m.hasOwnProperty(C)&&(d.bi(m[C],s[C])||c.push({command:w,args:[g,C,s[C],v]}))}function fs(m){return m.id}function Ph(m,s){return m[s.id]=s,m}class El{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(1===this.points.length)return this.points[0];s=d.ap(s,0,1);let c=1,g=this._distances[c];const v=s*this.paddedLength+this.padding;for(;g<v&&c<this._distances.length;)g=this._distances[++c];const w=c-1,C=this._distances[w],k=g-C,O=k>0?(v-C)/k:0;return this.points[w].mult(1-O).add(this.points[c].mult(O))}}class Vm{constructor(s,c,g){const v=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(c/g);for(let C=0;C<this.xCellCount*this.yCellCount;C++)v.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,g,v,w){this._forEachCell(c,g,v,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(w)}insertCircle(s,c,g,v){this._forEachCell(c-v,g-v,c+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(g),this.circles.push(v)}_insertBoxCell(s,c,g,v,w,C){this.boxCells[w].push(C)}_insertCircleCell(s,c,g,v,w,C){this.circleCells[w].push(C)}_query(s,c,g,v,w,C){if(g<0||s>this.width||v<0||c>this.height)return!w&&[];const k=[];if(s<=0&&c<=0&&this.width<=g&&this.height<=v){if(w)return!0;for(let O=0;O<this.boxKeys.length;O++)k.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const B=this.circles[3*O],F=this.circles[3*O+1],j=this.circles[3*O+2];k.push({key:this.circleKeys[O],x1:B-j,y1:F-j,x2:B+j,y2:F+j})}return C?k.filter(C):k}return this._forEachCell(s,c,g,v,this._queryCell,k,{hitTest:w,seenUids:{box:{},circle:{}}},C),w?k.length>0:k}_queryCircle(s,c,g,v,w){const C=s-g,k=s+g,O=c-g,B=c+g;if(k<0||C>this.width||B<0||O>this.height)return!v&&[];const F=[];return this._forEachCell(C,O,k,B,this._queryCellCircle,F,{hitTest:v,circle:{x:s,y:c,radius:g},seenUids:{box:{},circle:{}}},w),v?F.length>0:F}query(s,c,g,v,w){return this._query(s,c,g,v,!1,w)}hitTest(s,c,g,v,w){return this._query(s,c,g,v,!0,w)}hitTestCircle(s,c,g,v){return this._queryCircle(s,c,g,!0,v)}_queryCell(s,c,g,v,w,C,k,O){const B=k.seenUids,F=this.boxCells[w];if(null!==F){const G=this.bboxes;for(const X of F)if(!B.box[X]){B.box[X]=!0;const Q=4*X;if(s<=G[Q+2]&&c<=G[Q+3]&&g>=G[Q+0]&&v>=G[Q+1]&&(!O||O(this.boxKeys[X]))){if(k.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[X],x1:G[Q],y1:G[Q+1],x2:G[Q+2],y2:G[Q+3]})}}}const j=this.circleCells[w];if(null!==j){const G=this.circles;for(const X of j)if(!B.circle[X]){B.circle[X]=!0;const Q=3*X;if(this._circleAndRectCollide(G[Q],G[Q+1],G[Q+2],s,c,g,v)&&(!O||O(this.circleKeys[X]))){if(k.hitTest)return C.push(!0),!0;{const K=G[Q],ne=G[Q+1],te=G[Q+2];C.push({key:this.circleKeys[X],x1:K-te,y1:ne-te,x2:K+te,y2:ne+te})}}}}}_queryCellCircle(s,c,g,v,w,C,k,O){const B=k.circle,F=k.seenUids,j=this.boxCells[w];if(null!==j){const X=this.bboxes;for(const Q of j)if(!F.box[Q]){F.box[Q]=!0;const K=4*Q;if(this._circleAndRectCollide(B.x,B.y,B.radius,X[K+0],X[K+1],X[K+2],X[K+3])&&(!O||O(this.boxKeys[Q])))return C.push(!0),!0}}const G=this.circleCells[w];if(null!==G){const X=this.circles;for(const Q of G)if(!F.circle[Q]){F.circle[Q]=!0;const K=3*Q;if(this._circlesCollide(X[K],X[K+1],X[K+2],B.x,B.y,B.radius)&&(!O||O(this.circleKeys[Q])))return C.push(!0),!0}}}_forEachCell(s,c,g,v,w,C,k,O){const B=this._convertToXCellCoord(s),F=this._convertToYCellCoord(c),j=this._convertToXCellCoord(g),G=this._convertToYCellCoord(v);for(let X=B;X<=j;X++)for(let Q=F;Q<=G;Q++)if(w.call(this,s,c,g,v,this.xCellCount*Q+X,C,k,O))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,g,v,w,C){const k=v-s,O=w-c,B=g+C;return B*B>k*k+O*O}_circleAndRectCollide(s,c,g,v,w,C,k){const O=(C-v)/2,B=Math.abs(s-(v+O));if(B>O+g)return!1;const F=(k-w)/2,j=Math.abs(c-(w+F));if(j>F+g)return!1;if(B<=O||j<=F)return!0;const G=B-O,X=j-F;return G*G+X*X<=g*g}}const ms_unknown=0,ms_flipRequired=1,ms_flipNotRequired=2,In=Math.tan(85*Math.PI/180);function Xi(m,s,c,g,v,w,C){const k=d.a6.mat4.create();if(c)if("globe"===w.name){const O=d.bj(v,s);d.a6.mat4.multiply(k,k,O)}else{const O=d.a6.mat2.invert([],C);k[0]=O[0],k[1]=O[1],k[4]=O[2],k[5]=O[3],g||d.a6.mat4.rotateZ(k,k,v.angle)}else d.a6.mat4.multiply(k,v.labelPlaneMatrix,m);return k}function Zi(m,s,c,g,v,w,C){const k=Xi(m,s,c,g,v,w,C);return"globe"===w.name&&c||(k[2]=k[6]=k[10]=k[14]=0),k}function ja(m,s,c,g,v,w,C){if(c){if("globe"===w.name){const k=Xi(m,s,c,g,v,w,C);return d.a6.mat4.invert(k,k),d.a6.mat4.multiply(k,m,k),k}{const k=d.a6.mat4.clone(m),O=d.a6.mat4.identity([]);return O[0]=C[0],O[1]=C[1],O[4]=C[2],O[5]=C[3],d.a6.mat4.multiply(k,k,O),g||d.a6.mat4.rotateZ(k,k,-v.angle),k}}return v.glCoordMatrix}function Ks(m,s,c,g){const v=[m,s,c,1];c?d.a6.vec4.transformMat4(v,v,g):qn(v,v,g);const w=v[3];return v[0]/=w,v[1]/=w,v[2]/=w,v}function Ji(m,s){return Math.min(.5+m/s*.5,1.5)}function wf(m,s){const c=m[0]/m[3],g=m[1]/m[3];return c>=-s[0]&&c<=s[0]&&g>=-s[1]&&g<=s[1]}function Lh(m,s,c,g,v,w,C,k,O,B){const F=c.transform,j=g?m.textSizeData:m.iconSizeData,G=d.bk(j,c.transform.zoom),X="globe"===F.projection.name,Q=[256/c.width*2+1,256/c.height*2+1],K=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;K.clear();let ne=null;X&&(ne=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const te=m.lineVertexArray,pe=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,be=c.transform.width/c.transform.height;let ye,we=!1;for(let Ee=0;Ee<pe.length;Ee++){const Ce=pe.get(Ee),{numGlyphs:Ie,writingMode:Le}=Ce;if(Le!==d.bl.vertical||we||ye===d.bl.horizontal||(we=!0),ye=Le,(Ce.hidden||Le===d.bl.vertical)&&!we){dc(Ie,K);continue}we=!1;const je=new d.P(Ce.tileAnchorX,Ce.tileAnchorY);let{x:Fe,y:Oe,z:ct}=F.projection.projectTilePoint(je.x,je.y,B.canonical);if(O){const[It,sn,An]=O(je);Fe+=It,Oe+=sn,ct+=An}const _t=[Fe,Oe,ct,1];if(d.a6.vec4.transformMat4(_t,_t,s),!wf(_t,Q)){dc(Ie,K);continue}const Ft=_t[3],Yt=Ji(c.transform.getCameraToCenterDistance(F.projection),Ft),nn=d.bm(j,G,Ce),Ke=C?nn/Yt:nn*Yt,At=Ks(Fe,Oe,ct,v);if(At[3]<=0){dc(Ie,K);continue}let ft={};const Rt=C?null:O,Vt=zo(Ce,Ke,!1,k,s,v,w,m.glyphOffsetArray,te,K,ne,At,je,ft,be,Rt,F.projection,B,C);we=Vt.useVertical,Rt&&Vt.needsFlipping&&(ft={}),(Vt.notEnoughRoom||we||Vt.needsFlipping&&zo(Ce,Ke,!0,k,s,v,w,m.glyphOffsetArray,te,K,ne,At,je,ft,be,Rt,F.projection,B,C).notEnoughRoom)&&dc(Ie,K)}g?(m.text.dynamicLayoutVertexBuffer.updateData(K),ne&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(ne)):(m.icon.dynamicLayoutVertexBuffer.updateData(K),ne&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(ne))}function Ss(m,s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K){const{lineStartIndex:ne,glyphStartIndex:te,segment:pe}=k,be=te+k.numGlyphs,ye=ne+k.lineLength,we=s.getoffsetX(te),Ee=s.getoffsetX(be-1),Ce=vn(m*we,c,g,v,w,C,pe,ne,ye,O,B,F,j,G,!0,X,Q,K);if(!Ce)return null;const Ie=vn(m*Ee,c,g,v,w,C,pe,ne,ye,O,B,F,j,G,!0,X,Q,K);return Ie?{first:Ce,last:Ie}:null}function Qi(m,s,c,g){return m===d.bl.horizontal&&Math.abs(g)>Math.abs(c)?{useVertical:!0}:m===d.bl.vertical?g>0?{needsFlipping:!0}:null:s!==ms_unknown&&(0===(v=c)||Math.abs(g/v)>In)?s===ms_flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null;var v}function zo(m,s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K,ne,te,pe){const be=s/24,ye=m.lineOffsetX*be,we=m.lineOffsetY*be,{lineStartIndex:Ee,glyphStartIndex:Ce,numGlyphs:Ie,segment:Le,writingMode:je,flipState:Fe}=m,Oe=Ee+m.lineLength,ct=_t=>{if(F){const[Ke,At,ft]=_t.up,Rt=B.length;d.bn(F,Rt+0,Ke,At,ft),d.bn(F,Rt+1,Ke,At,ft),d.bn(F,Rt+2,Ke,At,ft),d.bn(F,Rt+3,Ke,At,ft)}const[Ft,Yt,nn]=_t.point;d.bo(B,Ft,Yt,nn,_t.angle)};if(Ie>1){const _t=Ss(be,k,ye,we,c,j,G,m,O,w,X,K,!1,ne,te,pe);if(!_t)return{notEnoughRoom:!0};if(g&&!c){let[Ft,Yt,nn]=_t.first.point,[Ke,At,ft]=_t.last.point;[Ft,Yt]=Ks(Ft,Yt,nn,C),[Ke,At]=Ks(Ke,At,ft,C);const Rt=Qi(je,Fe,(Ke-Ft)*Q,At-Yt);if(m.flipState=Rt&&Rt.needsFlipping?ms_flipRequired:ms_flipNotRequired,Rt)return Rt}ct(_t.first);for(let Ft=Ce+1;Ft<Ce+Ie-1;Ft++){const Yt=vn(be*k.getoffsetX(Ft),ye,we,c,j,G,Le,Ee,Oe,O,w,X,K,!1,!1,ne,te,pe);if(!Yt)return B.length-=4*(Ft-Ce),{notEnoughRoom:!0};ct(Yt)}ct(_t.last)}else{if(g&&!c){const Ft=Ks(G.x,G.y,0,v),Yt=Ee+Le+1,nn=new d.P(O.getx(Yt),O.gety(Yt)),Ke=Ks(nn.x,nn.y,0,v),At=Ke[3]>0?Ke:Oh(G,nn,Ft,1,v,void 0,ne,te.canonical),ft=Qi(je,Fe,(At[0]-Ft[0])*Q,At[1]-Ft[1]);if(m.flipState=ft&&ft.needsFlipping?ms_flipRequired:ms_flipNotRequired,ft)return ft}const _t=vn(be*k.getoffsetX(Ce),ye,we,c,j,G,Le,Ee,Oe,O,w,X,K,!1,!1,ne,te,pe);if(!_t)return{notEnoughRoom:!0};ct(_t)}return{}}function ev(m,s,c,g,v){const{x:w,y:C,z:k}=g.projectTilePoint(m.x,m.y,s);if(!v)return Ks(w,C,k,c);const[O,B,F]=v(m);return Ks(w+O,C+B,k+F,c)}function Oh(m,s,c,g,v,w,C,k){const O=ev(m.sub(s)._unit()._add(m),k,v,C,w);return d.a6.vec3.sub(O,c,O),d.a6.vec3.normalize(O,O),d.a6.vec3.scaleAndAdd(O,c,O,g)}function vn(m,s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K,ne,te){const pe=g?m-s:m+s;let be=pe>0?1:-1,ye=0;g&&(be*=-1,ye=Math.PI),be<0&&(ye+=Math.PI);let we=k+C+(be>0?0:1)|0,Ee=v,Ce=v,Ie=0,Le=0;const je=Math.abs(pe),Fe=[],Oe=[];let ct=w,_t=ct;const Ft=()=>Oh(_t,ct,Ce,je-Ie+1,F,G,K,ne.canonical);for(;Ie+Le<=je;){if(we+=be,we<k||we>=O)return null;if(Ce=Ee,_t=ct,Fe.push(Ce),X&&Oe.push(_t),ct=new d.P(B.getx(we),B.gety(we)),Ee=j[we],!Ee){const sn=ev(ct,ne.canonical,F,K,G);Ee=sn[3]>0?j[we]=sn:Ft()}Ie+=Le,Le=d.a6.vec3.distance(Ce,Ee)}Q&&G&&(j[we]&&(Ee=Ft(),Le=d.a6.vec3.distance(Ce,Ee)),j[we]=Ee);const Yt=(je-Ie)/Le,nn=ct.sub(_t)._mult(Yt)._add(_t),Ke=d.a6.vec3.sub([],Ee,Ce),At=d.a6.vec3.scaleAndAdd([],Ce,Ke,Yt);let ft=[0,0,1],Rt=Ke[0],Vt=Ke[1];if(te&&(ft=K.upVector(ne.canonical,nn.x,nn.y),0!==ft[0]||0!==ft[1]||1!==ft[2])){const sn=[ft[2],0,-ft[0]],An=d.a6.vec3.cross([],ft,sn);d.a6.vec3.normalize(sn,sn),d.a6.vec3.normalize(An,An),Rt=d.a6.vec3.dot(Ke,sn),Vt=d.a6.vec3.dot(Ke,An)}if(c){const sn=d.a6.vec3.cross([],ft,Ke);d.a6.vec3.normalize(sn,sn),d.a6.vec3.scaleAndAdd(At,At,sn,c*be)}const It=ye+Math.atan2(Vt,Rt);return Fe.push(At),X&&Oe.push(nn),{point:At,angle:It,path:Fe,tilePath:Oe,up:ft}}function dc(m,s){const c=s.length,g=c+4*m;s.resize(g),s.float32.fill(-1/0,4*c,4*g)}function qn(m,s,c){const g=s[0],v=s[1];return m[0]=c[0]*g+c[4]*v+c[12],m[1]=c[1]*g+c[5]*v+c[13],m[3]=c[3]*g+c[7]*v+c[15],m}const Js=100;class Qs{constructor(s,c,g=new Vm(s.width+200,s.height+200,25),v=new Vm(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Js,this.screenBottomBoundary=s.height+Js,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=c}placeCollisionBox(s,c,g,v,w,C,k,O){let B=g.projectedAnchorX,F=g.projectedAnchorY,j=g.projectedAnchorZ;const G=g.elevation,X=g.tileID,Q=s.getProjection();if(G&&X){const[Ee,Ce,Ie]=Q.upVector(X.canonical,g.tileAnchorX,g.tileAnchorY),Le=Q.upVectorScale(X.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=Ee*G*Le,F+=Ce*G*Le,j+=Ie*G*Le}const K=this.projectAndGetPerspectiveRatio(k,B,F,j,g.tileID,"globe"===Q.name||!!G||this.transform.pitch>0,Q),ne=C*K.perspectiveRatio,te=(g.x1*c+v.x-g.padding)*ne+K.point.x,pe=(g.y1*c+v.y-g.padding)*ne+K.point.y,be=(g.x2*c+v.x+g.padding)*ne+K.point.x,ye=(g.y2*c+v.y+g.padding)*ne+K.point.y,we=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(te,pe,be,ye)||!w&&this.grid.hitTest(te,pe,be,ye,O)||we?{box:[],offscreen:!1,occluded:K.occluded}:{box:[te,pe,be,ye],offscreen:this.isOffscreen(te,pe,be,ye),occluded:!1}}placeCollisionCircles(s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K){const ne=[],te=this.transform.elevation,pe=s.getProjection(),be=te?te.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,pe):null,ye=new d.P(g.tileAnchorX,g.tileAnchorY);let{x:we,y:Ee,z:Ce}=pe.projectTilePoint(ye.x,ye.y,K.canonical);if(be){const[nn,Ke,At]=be(ye);we+=nn,Ee+=Ke,Ce+=At}const Ie="globe"===pe.name,Le=this.projectAndGetPerspectiveRatio(k,we,Ee,Ce,K,Ie||!!te||this.transform.pitch>0,pe),{perspectiveRatio:je}=Le,Fe=(j?C/je:C*je)/d.br,Oe=Ks(we,Ee,Ce,O),ct=Le.signedDistanceFromCamera>0?Ss(Fe,w,g.lineOffsetX*Fe,g.lineOffsetY*Fe,!1,Oe,ye,g,v,O,{},te&&!j?be:null,j&&!!te,pe,K,j):null;let _t=!1,Ft=!1,Yt=!0;if(ct&&!Le.occluded){const nn=.5*X*je+Q,Ke=new d.P(-100,-100),At=new d.P(this.screenRightBoundary,this.screenBottomBoundary),ft=new El,{first:Rt,last:Vt}=ct,It=Rt.path.length;let sn=[];for(let wn=It-1;wn>=1;wn--)sn.push(Rt.path[wn]);for(let wn=1;wn<Vt.path.length;wn++)sn.push(Vt.path[wn]);const An=2.5*nn;B&&(sn=sn.map(([wn,Bn,rn],Hn)=>(be&&!Ie&&(rn=be(Hn<It-1?Rt.tilePath[It-1-Hn]:Vt.tilePath[Hn-It+2])[2]),Ks(wn,Bn,rn,B))),sn.some(wn=>wn[3]<=0)&&(sn=[]));let Nn=[];if(sn.length>0){let wn=1/0,Bn=-1/0,rn=1/0,Hn=-1/0;for(const pi of sn)wn=Math.min(wn,pi[0]),rn=Math.min(rn,pi[1]),Bn=Math.max(Bn,pi[0]),Hn=Math.max(Hn,pi[1]);Bn>=Ke.x&&wn<=At.x&&Hn>=Ke.y&&rn<=At.y&&(Nn=[sn.map(pi=>new d.P(pi[0],pi[1]))],(wn<Ke.x||Bn>At.x||rn<Ke.y||Hn>At.y)&&(Nn=d.bp(Nn,Ke.x,Ke.y,At.x,At.y)))}for(const wn of Nn){ft.reset(wn,.25*nn);let Bn=0;Bn=ft.length<=.5*nn?1:Math.ceil(ft.paddedLength/An)+1;for(let rn=0;rn<Bn;rn++){const Hn=rn/Math.max(Bn-1,1),pi=ft.lerp(Hn),Bi=pi.x+Js,Sr=pi.y+Js;ne.push(Bi,Sr,nn,0);const Gi=Bi-nn,Hr=Sr-nn,rr=Bi+nn,Ar=Sr+nn;if(Yt=Yt&&this.isOffscreen(Gi,Hr,rr,Ar),Ft=Ft||this.isInsideGrid(Gi,Hr,rr,Ar),!c&&this.grid.hitTestCircle(Bi,Sr,nn,G)&&(_t=!0,!F))return{circles:[],offscreen:!1,collisionDetected:_t,occluded:!1}}}}return{circles:!F&&_t||!Ft?[]:ne,offscreen:Yt,collisionDetected:_t,occluded:Le.occluded}}queryRenderedSymbols(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let g=1/0,v=1/0,w=-1/0,C=-1/0;for(const F of s){const j=new d.P(F.x+Js,F.y+Js);g=Math.min(g,j.x),v=Math.min(v,j.y),w=Math.max(w,j.x),C=Math.max(C,j.y),c.push(j)}const k=this.grid.query(g,v,w,C).concat(this.ignoredGrid.query(g,v,w,C)),O={},B={};for(const F of k){const j=F.key;if(void 0===O[j.bucketInstanceId]&&(O[j.bucketInstanceId]={}),O[j.bucketInstanceId][j.featureIndex])continue;const G=[new d.P(F.x1,F.y1),new d.P(F.x2,F.y1),new d.P(F.x2,F.y2),new d.P(F.x1,F.y2)];d.bq(c,G)&&(O[j.bucketInstanceId][j.featureIndex]=!0,void 0===B[j.bucketInstanceId]&&(B[j.bucketInstanceId]=[]),B[j.bucketInstanceId].push(j.featureIndex))}return B}insertCollisionBox(s,c,g,v,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:w},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,g,v,w){const C=c?this.ignoredGrid:this.grid,k={bucketInstanceId:g,featureIndex:v,collisionGroupID:w};for(let O=0;O<s.length;O+=4)C.insertCircle(k,s[O],s[O+1],s[O+2])}projectAndGetPerspectiveRatio(s,c,g,v,w,C,k){const O=[c,g,v,1];let B=!1;v||this.transform.pitch>0?(d.a6.vec4.transformMat4(O,O,s),this.fogState&&w&&"globe"!==k.name&&(B=function(G,X,Q,K,ne,te){const pe=te.calculateFogTileMatrix(ne),be=[X,Q,K];return d.a6.vec3.transformMat4(be,be,pe),hn(G,d.a6.vec3.length(be),te.pitch,te._fov)}(this.fogState,c,g,v,w.toUnwrapped(),this.transform)>.9)):qn(O,O,s);const F=O[3];return{point:new d.P((O[0]/F+1)/2*this.transform.width+Js,(-O[1]/F+1)/2*this.transform.height+Js),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/F*.5,1.5),signedDistanceFromCamera:F,occluded:C&&O[2]>F||B}}isOffscreen(s,c,g,v){return g<Js||s>=this.screenRightBoundary||v<Js||c>this.screenBottomBoundary}isInsideGrid(s,c,g,v){return g>=0&&s<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=d.a6.mat4.identity([]);return d.a6.mat4.translate(s,s,[-100,-100,0]),s}}function ea(m,s,c){const g=s.createTileMatrix(m,m.worldSize,c.toUnwrapped());return d.a6.mat4.multiply(new Float32Array(16),m.projMatrix,g)}function B_(m,s,c){if(s.projection.name===c.projection.name)return m.projMatrix;const g=c.clone();return g.setProjection(s.projection),ea(g,s.getProjection(),m)}function jc(m,s,c){return s.name===c.projection.name?m.projMatrix:ea(c,s,m)}class Vo{constructor(s,c,g,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):v&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class Ts{constructor(s,c,g,v,w,C=!1){this.text=new Vo(s?s.text:null,c,g,w),this.icon=new Vo(s?s.icon:null,c,v,w),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ua{constructor(s,c,g,v=!1){this.text=s,this.icon=c,this.skipFade=g,this.clipped=v}}class ts{constructor(){this.invProjMatrix=d.a6.mat4.create(),this.viewportMatrix=d.a6.mat4.create(),this.circles=[]}}class jm{constructor(s,c,g,v,w){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=w}}class hi{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:g=>g.collisionGroupID===c}}return this.collisionGroups[s]}}function Uc(m,s,c,g,v){const{horizontalAlign:w,verticalAlign:C}=d.by(m),k=-(w-.5)*s,O=-(C-.5)*c,B=d.bx(m,g);return new d.P(k+B[0]*v,O+B[1]*v)}function Du(m,s,c,g,v){const w=new d.P(m,s);return c&&w._rotate(g?v:-v),w}class Cs{constructor(s,c,g,v,w,C){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Qs(this.transform,w),this.buildingIndex=C,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new hi(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,c,g,v,w=1){const C=g.getBucket(c),k=g.latestFeatureIndex;if(!C||!k||c.fqid!==C.layerIds[0])return;const O=C.layers[0].layout,B=C.layers[0].paint,F=g.collisionBoxArray,j=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),G=g.tileSize/d.ab,X=g.tileID.toUnwrapped();this.transform.setProjection(C.projection);const Q=(K=g.tileID,ne=C.getProjection(),te=this.transform,ne.name===this.projection?te.calculateProjMatrix(K.toUnwrapped()):ea(te,ne,K));var K,ne,te;const pe="map"===O.get("text-pitch-alignment"),be="map"===O.get("text-rotation-alignment");c.compileFilter(c.options);const ye=c.dynamicFilter(),we=c.dynamicFilterNeedsFeature(),Ee=this.transform.calculatePixelsToTileUnitsMatrix(g),Ce=Zi(Q,g.tileID.canonical,pe,be,this.transform,C.getProjection(),Ee);let Ie=null;if(pe){const Ft=ja(Q,g.tileID.canonical,pe,be,this.transform,C.getProjection(),Ee);Ie=d.a6.mat4.multiply([],this.transform.labelPlaneMatrix,Ft)}let Le=null;ye&&g.latestFeatureIndex&&(Le={unwrappedTileID:X,dynamicFilter:ye,dynamicFilterNeedsFeature:we}),this.retainedQueryData[C.bucketInstanceId]=new jm(C.bucketInstanceId,k,C.sourceLayerIndex,C.index,g.tileID);const je=C.layers[0].layout.get("text-size-scale-range"),Fe=d.ap(w,je[0],je[1]),Oe=C.layers[0].layout.get("icon-size-scale-range"),ct=d.ap(w,Oe[0],Oe[1]),_t={bucket:C,layout:O,paint:B,posMatrix:Q,textLabelPlaneMatrix:Ce,labelToScreenMatrix:Ie,clippingData:Le,scale:j,textPixelRatio:G,holdingForFade:g.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:d.bk(C.textSizeData,this.transform.zoom,Fe),partiallyEvaluatedIconSize:d.bk(C.iconSizeData,this.transform.zoom,ct),collisionGroup:this.collisionGroups.get(C.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(v)for(const Ft of C.sortKeyRanges){const{sortKey:Yt,symbolInstanceStart:nn,symbolInstanceEnd:Ke}=Ft;s.push({sortKey:Yt,symbolInstanceStart:nn,symbolInstanceEnd:Ke,parameters:_t})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:_t})}attemptAnchorPlacement(s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K,ne,te,pe){const{textOffset0:be,textOffset1:ye,crossTileID:we}=G,Ee=[be,ye],Ce=Uc(s,g,v,Ee,w),Ie=this.collisionIndex.placeCollisionBox(Q,w,c,Du(Ce.x,Ce.y,C,k,this.transform.angle),j,O,B,F.predicate);if(ne){const Le=Q.getSymbolInstanceIconSize(pe,this.transform.zoom,G.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Q,Le,ne,Du(Ce.x,Ce.y,C,k,this.transform.angle),j,O,B,F.predicate).box.length)return}if(Ie.box.length>0){let Le;return this.prevPlacement&&this.prevPlacement.variableOffsets[we]&&this.prevPlacement.placements[we]&&this.prevPlacement.placements[we].text&&(Le=this.prevPlacement.variableOffsets[we].anchor),this.variableOffsets[we]={textOffset:Ee,width:g,height:v,anchor:s,textScale:w,prevAnchor:Le},this.markUsedJustification(Q,s,G,K),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,K,G),this.placedOrientations[we]=K),{shift:Ce,placedGlyphBoxes:Ie}}}placeLayerBucketPart(s,c,g,v,w=1){const{bucket:C,layout:k,paint:O,posMatrix:B,textLabelPlaneMatrix:F,labelToScreenMatrix:j,clippingData:G,textPixelRatio:X,holdingForFade:Q,collisionBoxArray:K,partiallyEvaluatedTextSize:ne,partiallyEvaluatedIconSize:te,collisionGroup:pe,latestFeatureIndex:be}=s.parameters,ye=k.get("text-optional"),we=k.get("icon-optional"),Ee=k.get("text-allow-overlap"),Ce=k.get("icon-allow-overlap"),Ie="map"===k.get("text-rotation-alignment"),Le="map"===k.get("text-pitch-alignment"),je=k.get("symbol-z-elevate"),Fe=O.get("symbol-z-offset"),Oe="sea"===k.get("symbol-elevation-reference"),ct=k.get("text-size-scale-range"),_t=k.get("icon-size-scale-range"),Ft=d.ap(w,ct[0],ct[1]),Yt=d.ap(w,_t[0],_t[1]);this.transform.setProjection(C.projection);let nn=Ee&&(Ce||!C.hasIconData()||we),Ke=Ce&&(Ee||!C.hasTextData()||ye);const At=!Fe.isConstant();!C.collisionArrays&&K&&C.deserializeCollisionBoxes(K),g&&v&&C.updateCollisionDebugBuffers(this.transform.zoom,K,Ft,Yt);const ft=(Rt,Vt,It)=>{const{crossTileID:sn,numVerticalGlyphVertices:An}=Rt;let Nn=null;if(G&&G.dynamicFilterNeedsFeature||At){const qi=this.retainedQueryData[C.bucketInstanceId];Nn=be.loadFeature({featureIndex:Rt.featureIndex,bucketIndex:qi.bucketIndex,sourceLayerIndex:qi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(G&&!(0,G.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Nn,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new d.P(Rt.tileAnchorX,Rt.tileAnchorY),this.transform.calculateDistanceTileData(G.unwrappedTileID)))return this.placements[sn]=new Ua(!1,!1,!1,!0),void c.add(sn);const wn=Fe.evaluate(Nn,{});if(c.has(sn))return;if(Q)return void(this.placements[sn]=new Ua(!1,!1,!1));let Bn=!1,rn=!1,Hn=!0,pi=!1,Bi=!1,Sr=null,Gi={box:null,offscreen:null,occluded:null},Hr={box:null,offscreen:null,occluded:null},rr=null,Ar=null,Ei=null,Tr=0,yr=0,Ci=0;It.textFeatureIndex?Tr=It.textFeatureIndex:Rt.useRuntimeCollisionCircles&&(Tr=Rt.featureIndex),It.verticalTextFeatureIndex&&(yr=It.verticalTextFeatureIndex);const Gr=qi=>{qi.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const Vi=this.transform.elevation;qi.elevation=Oe?wn:wn+(Vi?Vi.getAtTileOffset(qi.tileID,qi.tileAnchorX,qi.tileAnchorY):0),qi.elevation+=Rt.zOffset},Wo=It.textBox;if(Wo){Gr(Wo);const qi=or=>{let Rr=d.bl.horizontal;if(C.allowVerticalPlacement&&!or&&this.prevPlacement){const Io=this.prevPlacement.placedOrientations[sn];Io&&(this.placedOrientations[sn]=Io,Rr=Io,this.markUsedOrientation(C,Rr,Rt))}return Rr},Vi=(or,Rr)=>{if(C.allowVerticalPlacement&&An>0&&It.verticalTextBox){for(const Io of C.writingModes)if(Io===d.bl.vertical?(Gi=Rr(),Hr=Gi):Gi=or(),Gi&&Gi.box&&Gi.box.length)break}else Gi=or()};if(k.get("text-variable-anchor")){let or=k.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[sn]){const Xr=this.prevPlacement.variableOffsets[sn];or.indexOf(Xr.anchor)>0&&(or=or.filter(ds=>ds!==Xr.anchor),or.unshift(Xr.anchor))}const Rr=(Xr,ds,Ll)=>{const Ma=C.getSymbolInstanceTextSize(ne,Rt,this.transform.zoom,Vt),Aa=(Xr.x2-Xr.x1)*Ma+2*Xr.padding,Ra=(Xr.y2-Xr.y1)*Ma+2*Xr.padding,Xa=Rt.hasIconTextFit&&!Ce?ds:null;Xa&&Gr(Xa);let ka={box:[],offscreen:!1,occluded:!1};const ic=Ee?2*or.length:or.length;for(let fl=0;fl<ic;++fl){const er=this.attemptAnchorPlacement(or[fl%or.length],Xr,Aa,Ra,Ma,Ie,Le,X,B,pe,fl>=or.length,Rt,Vt,C,Ll,Xa,ne,te);if(er&&(ka=er.placedGlyphBoxes,ka&&ka.box&&ka.box.length)){Bn=!0,Sr=er.shift;break}}return ka};Vi(()=>Rr(Wo,It.iconBox,d.bl.horizontal),()=>{const Xr=It.verticalTextBox;return Xr&&Gr(Xr),C.allowVerticalPlacement&&!(Gi&&Gi.box&&Gi.box.length)&&An>0&&Xr?Rr(Xr,It.verticalIconBox,d.bl.vertical):{box:null,offscreen:null,occluded:null}}),Gi&&(Bn=Gi.box,Hn=Gi.offscreen,pi=Gi.occluded);const Io=qi(!(!Gi||!Gi.box));if(!Bn&&this.prevPlacement){const Xr=this.prevPlacement.variableOffsets[sn];Xr&&(this.variableOffsets[sn]=Xr,this.markUsedJustification(C,Xr.anchor,Rt,Io))}}else{const or=(Rr,Io)=>{const Xr=C.getSymbolInstanceTextSize(ne,Rt,this.transform.zoom,Vt,w),ds=this.collisionIndex.placeCollisionBox(C,Xr,Rr,new d.P(0,0),Ee,X,B,pe.predicate);return ds&&ds.box&&ds.box.length&&(this.markUsedOrientation(C,Io,Rt),this.placedOrientations[sn]=Io),ds};Vi(()=>or(Wo,d.bl.horizontal),()=>{const Rr=It.verticalTextBox;return C.allowVerticalPlacement&&An>0&&Rr?(Gr(Rr),or(Rr,d.bl.vertical)):{box:null,offscreen:null,occluded:null}}),qi(!!(Gi&&Gi.box&&Gi.box.length))}}if(rr=Gi,Bn=rr&&rr.box&&rr.box.length>0,Hn=rr&&rr.offscreen,pi=rr&&rr.occluded,Rt.useRuntimeCollisionCircles){const qi=C.text.placedSymbolArray.get(Rt.centerJustifiedTextSymbolIndex>=0?Rt.centerJustifiedTextSymbolIndex:Rt.verticalPlacedTextSymbolIndex),Vi=d.bm(C.textSizeData,ne,qi),or=k.get("text-padding");Ar=this.collisionIndex.placeCollisionCircles(C,Ee,qi,C.lineVertexArray,C.glyphOffsetArray,Vi,B,F,j,g,Le,pe.predicate,Rt.collisionCircleDiameter*Vi/d.br,or,this.retainedQueryData[C.bucketInstanceId].tileID),Bn=Ee||Ar.circles.length>0&&!Ar.collisionDetected,Hn=Hn&&Ar.offscreen,pi=Ar.occluded}if(It.iconFeatureIndex&&(Ci=It.iconFeatureIndex),It.iconBox){const qi=Vi=>{Gr(Vi);const or=Rt.hasIconTextFit&&Sr?Du(Sr.x,Sr.y,Ie,Le,this.transform.angle):new d.P(0,0),Rr=C.getSymbolInstanceIconSize(te,this.transform.zoom,Rt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,Rr,Vi,or,Ce,X,B,pe.predicate)};Hr&&Hr.box&&Hr.box.length&&It.verticalIconBox?(Ei=qi(It.verticalIconBox),rn=Ei.box.length>0):(Ei=qi(It.iconBox),rn=Ei.box.length>0),Hn=Hn&&Ei.offscreen,Bi=Ei.occluded}const ma=ye||0===Rt.numHorizontalGlyphVertices&&0===An,Eo=we||0===Rt.numIconVertices;if(ma||Eo?Eo?ma||(rn=rn&&Bn):Bn=rn&&Bn:rn=Bn=rn&&Bn,Bn&&rr&&rr.box&&this.collisionIndex.insertCollisionBox(rr.box,k.get("text-ignore-placement"),C.bucketInstanceId,Hr&&Hr.box&&yr?yr:Tr,pe.ID),rn&&Ei&&this.collisionIndex.insertCollisionBox(Ei.box,k.get("icon-ignore-placement"),C.bucketInstanceId,Ci,pe.ID),Ar&&(Bn&&this.collisionIndex.insertCollisionCircles(Ar.circles,k.get("text-ignore-placement"),C.bucketInstanceId,Tr,pe.ID),g)){const qi=C.bucketInstanceId;let Vi=this.collisionCircleArrays[qi];void 0===Vi&&(Vi=this.collisionCircleArrays[qi]=new ts);for(let or=0;or<Ar.circles.length;or+=4)Vi.circles.push(Ar.circles[or+0]),Vi.circles.push(Ar.circles[or+1]),Vi.circles.push(Ar.circles[or+2]),Vi.circles.push(Ar.collisionDetected?1:0)}const Fo="globe"!==C.projection.name;nn=nn&&(Fo||!pi),Ke=Ke&&(Fo||!Bi),this.placements[sn]=new Ua(Bn||nn,rn||Ke,Hn||C.justReloaded),c.add(sn)};if(je&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,this.retainedQueryData[C.bucketInstanceId].tileID),C.updateZOffset()),C.sortFeaturesByY){const Rt=C.getSortedSymbolIndexes(this.transform.angle);for(let Vt=Rt.length-1;Vt>=0;--Vt){const It=Rt[Vt];ft(C.symbolInstances.get(It),It,C.collisionArrays[It])}C.hasAnyZOffset&&d.w(`${C.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(C.hasAnyZOffset){const Rt=C.getSortedIndexesByZOffset();for(let Vt=0;Vt<Rt.length;++Vt){const It=Rt[Vt];ft(C.symbolInstances.get(It),It,C.collisionArrays[It])}}else for(let Rt=s.symbolInstanceStart;Rt<s.symbolInstanceEnd;Rt++)ft(C.symbolInstances.get(Rt),Rt,C.collisionArrays[Rt]);if(g&&C.bucketInstanceId in this.collisionCircleArrays){const Rt=this.collisionCircleArrays[C.bucketInstanceId];d.a6.mat4.invert(Rt.invProjMatrix,B),Rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(s,c,g,v){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:O,crossTileID:B}=g,F=d.bw(c),j=v===d.bl.vertical?O:"left"===F?w:"center"===F?C:"right"===F?k:-1;w>=0&&(s.text.placedSymbolArray.get(w).crossTileID=j>=0&&w!==j?0:B),C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=j>=0&&C!==j?0:B),k>=0&&(s.text.placedSymbolArray.get(k).crossTileID=j>=0&&k!==j?0:B),O>=0&&(s.text.placedSymbolArray.get(O).crossTileID=j>=0&&O!==j?0:B)}markUsedOrientation(s,c,g){const v=c===d.bl.horizontal||c===d.bl.horizontalOnly?c:0,w=c===d.bl.vertical?c:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:B}=g,F=s.text.placedSymbolArray;C>=0&&(F.get(C).placedOrientation=v),k>=0&&(F.get(k).placedOrientation=v),O>=0&&(F.get(O).placedOrientation=v),B>=0&&(F.get(B).placedOrientation=w)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let g=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const v=c?c.symbolFadeChange(s):1,w=c?c.opacities:{},C=c?c.variableOffsets:{},k=c?c.placedOrientations:{};for(const O in this.placements){const B=this.placements[O],F=w[O];F?(this.opacities[O]=new Ts(F,v,B.text,B.icon,null,B.clipped),g=g||B.text!==F.text.placed||B.icon!==F.icon.placed):(this.opacities[O]=new Ts(null,v,B.text,B.icon,B.skipFade,B.clipped),g=g||B.text||B.icon)}for(const O in w){const B=w[O];if(!this.opacities[O]){const F=new Ts(B,v,!1,!1);F.isHidden()||(this.opacities[O]=F,g=g||B.text.placed||B.icon.placed)}}for(const O in C)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=C[O]);for(const O in k)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=k[O]);g?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c,g,v){const w=new Set;for(const C of c){const k=C.getBucket(s);k&&C.latestFeatureIndex&&s.fqid===k.layerIds[0]&&(this.updateBucketOpacities(k,w,C,C.collisionBoxArray,g,v,C.tileID,s.scope),k.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(k,C.tileID),k.updateZOffset()))}}updateBucketOpacities(s,c,g,v,w,C,k,O){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const B=s.layers[0].layout,F=s.layers[0].paint,j=!!s.layers[0].dynamicFilter(),G=new Ts(null,0,!1,!1,!0),X=B.get("text-allow-overlap"),Q=B.get("icon-allow-overlap"),K=B.get("text-variable-anchor"),ne="map"===B.get("text-rotation-alignment"),te="map"===B.get("text-pitch-alignment"),pe=F.get("symbol-z-offset"),be="sea"===B.get("symbol-elevation-reference"),ye=!pe.isConstant(),we=new Ts(null,0,X&&(Q||!s.hasIconData()||B.get("icon-optional")),Q&&(X||!s.hasTextData()||B.get("text-optional")),!0);!s.collisionArrays&&v&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(v);const Ee=(Ie,Le,je)=>{for(let Fe=0;Fe<Le/4;Fe++)Ie.opacityVertexArray.emplaceBack(je)};let Ce=0;C&&s.updateReplacement(k,C);for(let Ie=0;Ie<s.symbolInstances.length;Ie++){const Le=s.symbolInstances.get(Ie),{numHorizontalGlyphVertices:je,numVerticalGlyphVertices:Fe,crossTileID:Oe,numIconVertices:ct,tileAnchorX:_t,tileAnchorY:Ft}=Le;let Yt=null;const nn=this.retainedQueryData[s.bucketInstanceId];ye&&Le&&nn&&(Yt=g.latestFeatureIndex.loadFeature({featureIndex:Le.featureIndex,bucketIndex:nn.bucketIndex,sourceLayerIndex:nn.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ke=pe.evaluate(Yt,{}),At=c.has(Oe);let ft=this.opacities[Oe];At?ft=G:ft||(ft=we,this.opacities[Oe]=ft),c.add(Oe);const Rt=je>0||Fe>0,Vt=ct>0,It=this.placedOrientations[Oe],sn=It===d.bl.vertical,An=It===d.bl.horizontal||It===d.bl.horizontalOnly;!Rt&&!Vt||ft.isHidden()||Ce++;let Nn=!1;if((Rt||Vt)&&C)for(const wn of s.activeReplacements){if(d.bs(wn,w,d.bt.Symbol,O)||wn.min.x>_t||_t>wn.max.x||wn.min.y>Ft||Ft>wn.max.y)continue;const Bn=d.bu(_t,Ft,k.canonical,wn.footprintTileId.canonical);if(Nn=d.bv(Bn,wn.footprint),Nn)break}if(Rt){const wn=Nn?Bh:Nh(ft.text);Ee(s.text,je,sn?Bh:wn),Ee(s.text,Fe,An?Bh:wn);const Bn=ft.text.isHidden(),{leftJustifiedTextSymbolIndex:rn,centerJustifiedTextSymbolIndex:Hn,rightJustifiedTextSymbolIndex:pi,verticalPlacedTextSymbolIndex:Bi}=Le,Sr=s.text.placedSymbolArray,Gi=Bn||sn?1:0;rn>=0&&(Sr.get(rn).hidden=Gi),Hn>=0&&(Sr.get(Hn).hidden=Gi),pi>=0&&(Sr.get(pi).hidden=Gi),Bi>=0&&(Sr.get(Bi).hidden=Bn||An?1:0);const Hr=this.variableOffsets[Oe];Hr&&this.markUsedJustification(s,Hr.anchor,Le,It);const rr=this.placedOrientations[Oe];rr&&(this.markUsedJustification(s,"left",Le,rr),this.markUsedOrientation(s,rr,Le))}if(Vt){const wn=Nn?Bh:Nh(ft.icon),{placedIconSymbolIndex:Bn,verticalPlacedIconSymbolIndex:rn}=Le,Hn=s.icon.placedSymbolArray,pi=ft.icon.isHidden()?1:0;Bn>=0&&(Ee(s.icon,ct,sn?Bh:wn),Hn.get(Bn).hidden=pi),rn>=0&&(Ee(s.icon,Le.numVerticalIconVertices,An?Bh:wn),Hn.get(rn).hidden=pi)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const wn=s.collisionArrays[Ie];if(wn){let Bn=new d.P(0,0),rn=!0;if(wn.textBox||wn.verticalTextBox){if(K){const pi=this.variableOffsets[Oe];pi?(Bn=Uc(pi.anchor,pi.width,pi.height,pi.textOffset,pi.textScale),ne&&Bn._rotate(te?this.transform.angle:-this.transform.angle)):rn=!1}j&&(rn=!ft.clipped),wn.textBox&&Fh(s.textCollisionBox.collisionVertexArray,ft.text.placed,!rn||sn,Ke,be,Bn.x,Bn.y),wn.verticalTextBox&&Fh(s.textCollisionBox.collisionVertexArray,ft.text.placed,!rn||An,Ke,be,Bn.x,Bn.y)}const Hn=rn&&Boolean(!An&&wn.verticalIconBox);wn.iconBox&&Fh(s.iconCollisionBox.collisionVertexArray,ft.icon.placed,Hn,Ke,be,Le.hasIconTextFit?Bn.x:0,Le.hasIconTextFit?Bn.y:0),wn.verticalIconBox&&Fh(s.iconCollisionBox.collisionVertexArray,ft.icon.placed,!Hn,Ke,be,Le.hasIconTextFit?Bn.x:0,Le.hasIconTextFit?Bn.y:0)}}}if(s.fullyClipped=0===Ce,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const Ie=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Ie.invProjMatrix,s.placementViewportMatrix=Ie.viewportMatrix,s.collisionCircleArray=Ie.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const g=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function Fh(m,s,c,g,v,w,C){m.emplaceBack(s?1:0,c?1:0,w||0,C||0,g,v?1:0),m.emplaceBack(s?1:0,c?1:0,w||0,C||0,g,v?1:0),m.emplaceBack(s?1:0,c?1:0,w||0,C||0,g,v?1:0),m.emplaceBack(s?1:0,c?1:0,w||0,C||0,g,v?1:0)}const Hc=Math.pow(2,25),Gc=Math.pow(2,24),ll=Math.pow(2,17),Ha=Math.pow(2,16),t1=Math.pow(2,9),Sa=Math.pow(2,8),To=Math.pow(2,1);function Nh(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const s=m.placed?1:0,c=Math.floor(127*m.opacity);return c*Hc+s*Gc+c*ll+s*Ha+c*t1+s*Sa+c*To+s}const Bh=0;class bd{constructor(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&void 0!==s.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,c,g,v,w,C){const k=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(k,v,s[this._currentTileIndex],this._sortAcrossTiles,C),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,k.sort((O,B)=>O.sortKey-B.sortKey));this._currentPartIndex<k.length;){const O=k[this._currentPartIndex];if(c.placeLayerBucketPart(O,this._seenCrossTileIDs,g,0===O.symbolInstanceStart,C),this._currentPartIndex++,w())return!0}return!1}}class Or{constructor(s,c,g,v,w,C,k,O,B){this.placement=new Cs(s,w,C,k,O,B),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,c,g,v,w){const C=d.q.now(),k=()=>{const O=d.q.now()-C;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=c[s[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if("symbol"===O.type&&(!O.minzoom||O.minzoom<=B)&&(!O.maxzoom||O.maxzoom>B)){const F=O,j=F.layout.get("symbol-z-elevate"),G=void 0!==F.layout.get("symbol-sort-key").constantOr(1),X=F.layout.get("symbol-z-order"),Q="viewport-y"===X||"auto"===X&&!("viewport-y"!==X&&G),K=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),ne=Q&&K,te=this._inProgressLayer=this._inProgressLayer||new bd(F),pe=d.av(O.source,O.scope);if(te.continuePlacement(j||ne?v[pe]:g[pe],this.placement,this._showCollisionBoxes,O,k,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const $l=512/d.ab/2;class Um{constructor(s,c,g){this.tileID=s,this.bucketInstanceId=g,this.index=new d.bz(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=s.canonical.x*d.ab,w=s.canonical.y*d.ab;for(let C=0;C<c.length;C++){const{key:k,crossTileID:O,tileAnchorX:B,tileAnchorY:F}=c.get(C),j=Math.floor((v+B)*$l),G=Math.floor((w+F)*$l);this.index.add(j,G),this.keys.push(k),this.crossTileIDs.push(O)}this.index.finish()}findMatches(s,c,g){const v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),w=$l/Math.pow(2,c.canonical.z-this.tileID.canonical.z),C=c.canonical.x*d.ab,k=c.canonical.y*d.ab;for(let O=0;O<s.length;O++){const B=s.get(O);if(B.crossTileID)continue;const{key:F,tileAnchorX:j,tileAnchorY:G}=B,X=Math.floor((C+j)*w),Q=Math.floor((k+G)*w),K=this.index.range(X-v,Q-v,X+v,Q+v);for(const ne of K){const te=this.crossTileIDs[ne];if(this.keys[ne]===F&&!g.has(te)){g.add(te),B.crossTileID=te;break}}}}}class qc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Hm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(0!==c)for(const g in this.indexes){const v=this.indexes[g],w={};for(const C in v){const k=v[C];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+c),w[k.tileID.key]=k}this.indexes[g]=w}this.lng=s}addBucket(s,c,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let w=0;w<c.symbolInstances.length;w++)c.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const v=this.usedCrossTileIDs[s.overscaledZ];for(const w in this.indexes){const C=this.indexes[w];if(Number(w)>s.overscaledZ)for(const k in C){const O=C[k];O.tileID.isChildOf(s)&&O.findMatches(c.symbolInstances,s,v)}else{const k=C[s.scaledTo(Number(w)).key];k&&k.findMatches(c.symbolInstances,s,v)}}for(let w=0;w<c.symbolInstances.length;w++){const C=c.symbolInstances.get(w);C.crossTileID||(C.crossTileID=g.generate(),v.add(C.crossTileID))}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Um(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const g of c.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let c=!1;for(const g in this.indexes){const v=this.indexes[g];for(const w in v)s[v[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[w]),delete v[w],c=!0)}return c}}class cl{constructor(){this.layerIndexes={},this.crossTileIDs=new qc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,g,v){let w=this.layerIndexes[s.fqid];void 0===w&&(w=this.layerIndexes[s.fqid]=new Hm);let C=!1;const k={};"globe"!==v.name&&w.handleWrapJump(g);for(const O of c){const B=O.getBucket(s);B&&s.fqid===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(O.tileID,B,this.crossTileIDs)&&(C=!0),k[B.bucketInstanceId]=!0)}return w.removeStaleBuckets(k)&&(C=!0),C}pruneUnusedLayers(s){const c={};s.forEach(g=>{c[g]=!0});for(const g in this.layerIndexes)c[g]||delete this.layerIndexes[g]}}class Li{constructor(s,c,g,v){this.blendFunction=s,this.blendColor=c,this.mask=g,this.blendEquation=v}}Li.Replace=[1,0,1,0],Li.disabled=new Li(Li.Replace,d.bA.transparent,[!1,!1,!1,!1]),Li.unblended=new Li(Li.Replace,d.bA.transparent,[!0,!0,!0,!0]),Li.alphaBlended=new Li([1,771,1,771],d.bA.transparent,[!0,!0,!0,!0]),Li.alphaBlendedNonPremultiplied=new Li([770,771,770,771],d.bA.transparent,[!0,!0,!0,!0]),Li.multiply=new Li([774,0,774,0],d.bA.transparent,[!0,!0,!0,!0]);class Ut{constructor(s,c,g){this.func=s,this.mask=c,this.range=g}}Ut.ReadOnly=!1,Ut.ReadWrite=!0,Ut.disabled=new Ut(519,Ut.ReadOnly,[0,1]);class li{constructor(s,c,g,v,w,C){this.test=s,this.ref=c,this.mask=g,this.fail=v,this.depthFail=w,this.pass=C}}li.disabled=new li({func:519,mask:0},0,0,7680,7680,7680);class ni{constructor(s,c,g){this.enable=s,this.mode=c,this.frontFace=g}}function Tf(m,s){const c=d.bD(m,3);d.a6.mat4.fromQuat(m,s),d.bF(m,3,c)}function cn(m,s){const c=d.a6.quat.identity([]);return d.a6.quat.rotateZ(c,c,-s),d.a6.quat.rotateX(c,c,-m),c}function ta(m,s){const c=[m[0],m[1],0],g=[s[0],s[1],0];if(d.a6.vec3.length(c)>=1e-15){const C=d.a6.vec3.normalize([],c);d.a6.vec3.scale(g,C,d.a6.vec3.dot(g,C)),s[0]=g[0],s[1]=g[1]}const v=d.a6.vec3.cross([],s,m);if(d.a6.vec3.len(v)<1e-15)return null;const w=Math.atan2(-v[1],v[0]);return cn(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),w)}ni.disabled=new ni(!1,1029,2305),ni.backCCW=new ni(!0,1029,2305),ni.backCW=new ni(!0,1029,2304),ni.frontCW=new ni(!0,1028,2304),ni.frontCCW=new ni(!0,1028,2305);class Ir{constructor(s,c){this.position=s,this.orientation=c}get position(){return this._position}set position(s){if(s){const c=s instanceof d.a5?s:new d.a5(s[0],s[1],s[2]);this._renderWorldCopies&&(c.x=d.bB(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(s,c){if(this.orientation=null,!this.position)return;const g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(d.a5.fromLngLat(s)):0,w=d.a5.fromLngLat(s,v),C=[w.x-g.x,w.y-g.y,w.z-g.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=ta(C,c)}setPitchBearing(s,c){this.orientation=cn(d.bC(s),d.bC(-c))}}class ns{constructor(s,c){this._transform=d.a6.mat4.identity([]),this.orientation=c,this.position=s}get mercatorPosition(){const s=this.position;return new d.a5(s[0],s[1],s[2])}get position(){const s=d.bD(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var c;s&&d.bF(this._transform,3,[(c=s)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||d.a6.quat.identity([]),s&&Tf(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,c){this._orientation=cn(s,c),Tf(this._transform,this._orientation)}forward(){const s=d.bD(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=d.bD(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=d.bD(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,c){const g=new Float64Array(16);return d.a6.mat4.invert(g,this.getWorldToCamera(s,c)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,c,g){const v=this.position;d.a6.vec3.scale(v,v,-s);const w=new Float64Array(16);return d.a6.mat4.fromScaling(w,[g,g,g]),d.a6.mat4.translate(w,w,v),w[10]*=c,w}getWorldToCamera(s,c){const g=new Float64Array(16),v=new Float64Array(4),w=this.position;return d.a6.quat.conjugate(v,this._orientation),d.a6.vec3.scale(w,w,-s),d.a6.mat4.fromQuat(g,v),d.a6.mat4.translate(g,g,w),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=c,g[9]*=c,g[10]*=c,g[11]*=c,g}getCameraToClipPerspective(s,c,g,v){const w=new Float64Array(16);return d.a6.mat4.perspective(w,s,c,g,v),w}getCameraToClipOrthographic(s,c,g,v,w,C){const k=new Float64Array(16);return d.a6.mat4.ortho(k,s,c,g,v,w,C),k}getDistanceToElevation(s,c=!1){const g=0===s?0:d.bE(s,c?d.aN(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new ns([...this.position],[...this.orientation])}}const so_BaseColor=5,so_MetallicRoughness=6,so_Normal=7,so_Occlusion=8,so_Emission=9,so_LUT=10,so_ShadowMap0=11;class hc{constructor(s=0,c=0,g=0,v=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=g,this.right=v}interpolate(s,c,g){return null!=c.top&&null!=s.top&&(this.top=d.aa(s.top,c.top,g)),null!=c.bottom&&null!=s.bottom&&(this.bottom=d.aa(s.bottom,c.bottom,g)),null!=c.left&&null!=s.left&&(this.left=d.aa(s.left,c.left,g)),null!=c.right&&null!=s.right&&(this.right=d.aa(s.right,c.right,g)),this}getCenter(s,c){const g=d.ap((this.left+s-this.right)/2,0,s),v=d.ap((this.top+c-this.bottom)/2,0,c);return new d.P(g,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new hc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ds=(m,s,c)=>(1-c)*m+c*s,pc=m=>m*m*m*m*m;class yd{constructor(s,c,g,v,w,C,k){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=null!=g?g:0,this._maxPitch=null!=v?v:60,this.setProjection(C),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new d.bL(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new hc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ns,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const s=new yd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(s,c=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return d.ar(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=d.bM(this.projectionOptions);const g=this.getProjection(),v=!d.bi(c,g);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=d.bM({name:"mercator"});const c=s!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return d.bE(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return d.bB(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const c=-s*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=d.a6.mat2.create(),d.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=d.ap(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=d.bC(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,w=0;for(let C=0;C<c.length;C++){const k=new d.P(c[C][0]*this.width,g+c[C][1]*(this.height-g)),O=s.pointCoordinate(k);if(!O)continue;const B=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);v+=O[3]*B,w+=B}return 0===w?NaN:v/w}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const s=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(s),w=this._mercatorZfromZoom(this._maxZoom),C=Math.max(v-g,w);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let g;g=s.z<this._camera.position[2]?[c.x,c.y,c.z]:[s.x,s.y,s.z];const v=d.a6.vec3.length(d.a6.vec3.sub([],this._camera.position,g));return d.ap(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let c=!1;if(s.orientation&&!d.a6.quat.exactEquals(s.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(s.orientation)),s.position){const g=[s.position.x,s.position.y,s.position.z];d.a6.vec3.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,c=new Ir;return c.position=new d.a5(s[0],s[1],s[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(s){if(!d.a6.quat.length(s))return!1;d.a6.quat.normalize(s,s);const c=d.a6.vec3.transformQuat([],[0,0,-1],s),g=d.a6.vec3.transformQuat([],[0,-1,0],s);if(g[2]<0)return!1;const v=ta(c,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){const c=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=d.ap(s[2],v/g,v/c),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,g){this._unmodified=!1,this._edgeInsets.interpolate(s,c,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new d.bN(0,s)];if(this.renderWorldCopies){const g=this.pointCoordinate(new d.P(0,0)),v=this.pointCoordinate(new d.P(this.width,0)),w=this.pointCoordinate(new d.P(this.width,this.height)),C=this.pointCoordinate(new d.P(0,this.height)),k=Math.floor(Math.min(g.x,v.x,w.x,C.x)),O=Math.floor(Math.max(g.x,v.x,w.x,C.x)),B=1;for(let F=k-B;F<=O+B;F++)0!==F&&c.push(new d.bN(F,s))}return c}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,c,g){let v=[];const w=void 0!==g,C=!w;if(C&&this.zoom<c||w&&0===g[0]&&0===g[1])return v;const k=new Set,O=(F,j,G,X,Q)=>{const K=d.c2(j,F,G,X,Q);k.has(K)||(v.push(new d.aA(F,j,G,X,Q)),k.add(K))};for(let F=0;F<s.length;F++){const j=s[F];if(C&&j.canonical.z!==c)continue;const G=j.canonical,X=j.overscaledZ,Q=j.wrap,K=1<<G.z,ne=G.x+1<K,te=G.x>0,pe=G.y+1<K,be=G.y>0,ye=j.wrap-(te?0:1),we=j.wrap+(ne?0:1),Ee=te?G.x-1:K-1,Ce=ne?G.x+1:0;if(w)g[0]<0?(O(X,we,G.z,Ce,G.y),g[1]<0&&pe&&(O(X,Q,G.z,G.x,G.y+1),O(X,we,G.z,Ce,G.y+1)),g[1]>0&&be&&(O(X,Q,G.z,G.x,G.y-1),O(X,we,G.z,Ce,G.y-1))):g[0]>0?(O(X,ye,G.z,Ee,G.y),g[1]<0&&pe&&(O(X,Q,G.z,G.x,G.y+1),O(X,ye,G.z,Ee,G.y+1)),g[1]>0&&be&&(O(X,Q,G.z,G.x,G.y-1),O(X,ye,G.z,Ee,G.y-1))):g[1]<0&&pe?O(X,Q,G.z,G.x,G.y+1):be&&O(X,Q,G.z,G.x,G.y-1);else{const Ie=j.visibleQuadrants;1&Ie&&(O(X,ye,G.z,Ee,G.y),be&&(O(X,Q,G.z,G.x,G.y-1),O(X,ye,G.z,Ee,G.y-1))),2&Ie&&(O(X,we,G.z,Ce,G.y),be&&(O(X,Q,G.z,G.x,G.y-1),O(X,we,G.z,Ce,G.y-1))),4&Ie&&(O(X,ye,G.z,Ee,G.y),pe&&(O(X,Q,G.z,G.x,G.y+1),O(X,ye,G.z,Ee,G.y+1))),8&Ie&&(O(X,we,G.z,Ce,G.y),pe&&(O(X,Q,G.z,G.x,G.y+1),O(X,we,G.z,Ce,G.y+1)))}}const B=[];for(const F of v)v.some(j=>F.isChildOf(j))||B.push(F);if(v=B.filter(F=>!s.some(j=>!!(F.overscaledZ<c&&j.isChildOf(F))||F.equals(j)||F.isChildOf(j))),C){const F=1<<c,j="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=[F*j.x,F*j.y],X=4,Q=X*X;v=v.filter(K=>{const ne=K.canonical.x+.5-G[0],te=K.canonical.y+.5-G[1];return ne*ne+te*te<Q})}return v}coveringTiles(s){let c=this.coveringZoomLevel(s);const g=c,v=this.elevation&&this.elevation.exaggeration(),w=v&&!s.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==s.minzoom&&c<s.minzoom)return[];void 0!==s.maxzoom&&c>s.maxzoom&&(c=s.maxzoom);const k=this.locationCoordinate(this.center),O=this.center.lat,B=1<<c,F=[B*k.x,B*k.y,0],j="globe"===this.projection.name,G=!j,X=d.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,G),Q=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=B*d.bE(1,this.center.lat),ne=this._camera.position[2]/d.bE(1,this.center.lat),te=[B*Q.x,B*Q.y,ne*(G?1:K)],pe=j||v,be=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ye=this.isLODDisabled(!0)?c:0;let we;if(this._elevation&&s.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){const Ke=this._elevation.getMinMaxForVisibleTiles();we=Ke?Ke.max:this._centerAltitude}else we=this._centerAltitude;const Ee=s.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ce=this.projection.isReprojectedInTileSpace?d.bP(this):1,Ie=Ke=>{const ft=new d.a5(Ke.x+25e-6,Ke.y,Ke.z),Rt=new d.a5(Ke.x,Ke.y+25e-6,Ke.z),Vt=Ke.toLngLat(),It=ft.toLngLat(),sn=Rt.toLngLat(),An=this.locationCoordinate(Vt),Nn=this.locationCoordinate(It),wn=this.locationCoordinate(sn),Bn=Math.hypot(Nn.x-An.x,Nn.y-An.y),rn=Math.hypot(wn.x-An.x,wn.y-An.y);return Math.sqrt(Bn*rn)*Ce/25e-6},Le=Ke=>{const At=we,ft=Ee;return{aabb:d.bS(this,B,0,0,0,Ke,ft,At,this.projection),zoom:0,x:0,y:0,minZ:ft,maxZ:At,wrap:Ke,fullyVisible:!1}},je=[];let Fe=[];const Oe=c,ct=s.reparseOverscaled?g:c,_t=(ne-this._centerAltitude)*K,Ft=Ke=>{if(!this._elevation||!Ke.tileID||!C)return;const At=this._elevation.getMinMaxForTile(Ke.tileID),ft=Ke.aabb;At?(ft.min[2]=At.min,ft.max[2]=At.max,ft.center[2]=(ft.min[2]+ft.max[2])/2):(Ke.shouldSplit=nn(Ke),Ke.shouldSplit||(ft.min[2]=ft.max[2]=ft.center[2]=this._centerAltitude))},Yt=(Ke,At)=>{if(.707*At<Ke)return 1;const ft=At/Ke;return ft/(1.4144271570014144+(Math.pow(1.1,ft-1.4144271570014144+1)-1)/(1.1-1)-1)},nn=Ke=>{if(Ke.zoom<ye)return!0;if(Ke.zoom===Oe)return!1;if(null!=Ke.shouldSplit)return Ke.shouldSplit;const At=Ke.aabb.distanceX(te),ft=Ke.aabb.distanceY(te);let Rt=_t,Vt=1;if(j){Rt=Ke.aabb.distanceZ(te);const rn=Math.pow(2,Ke.zoom),Hn=d.aN((Ke.y+1)/rn),pi=d.aN(Ke.y/rn),Bi=Math.min(Math.max(O,Hn),pi),Sr=d.c6(Bi)/d.c6(O);if(Vt=Bi===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Sr/this._mercatorScaleRatio),this.zoom<=d.c3&&Ke.zoom===Oe-1&&Sr>=.9)return!0}else if(w&&(Rt=Ke.aabb.distanceZ(te)*K),this.projection.isReprojectedInTileSpace&&g<=5){const rn=Math.pow(2,Ke.zoom),Hn=Ie(new d.a5((Ke.x+.5)/rn,(Ke.y+.5)/rn));Vt=Hn>.85?1:Hn}if(!C){const rn=Math.sqrt(At*At+ft*ft+Rt*Rt);let Hn=(1<<Oe-Ke.zoom)*be*Vt;return Hn*=Yt(Math.max(Rt,_t),rn),rn<Hn}let It=Number.MAX_VALUE,sn=0;const An=Ke.aabb.getCorners(),Nn=[];for(const rn of An){d.a6.vec3.sub(Nn,rn,te),j||(w?Nn[2]*=K:Nn[2]=_t);const Hn=d.a6.vec3.dot(Nn,this._camera.forward());Hn<It&&(It=Hn,sn=Math.abs(Nn[2]))}let wn=(1<<Oe-Ke.zoom)*be*Vt;if(wn*=Yt(Math.max(sn,_t),It),It<wn)return!0;const Bn=Ke.aabb.closestPoint(F);return Bn[0]===F[0]&&Bn[1]===F[1]};if(this.renderWorldCopies)for(let Ke=1;Ke<=3;Ke++)je.push(Le(-Ke)),je.push(Le(Ke));for(je.push(Le(0));je.length>0;){const Ke=je.pop(),At=Ke.x,ft=Ke.y;let Rt=Ke.fullyVisible;const Vt=()=>"globe"===this.projection.name&&(0===Ke.y||Ke.y===(1<<Ke.zoom)-1);if(!Rt){let It=pe?Ke.aabb.intersects(X):Ke.aabb.intersectsFlat(X);if(0===It&&Vt()){const sn=new d.bQ(Ke.zoom,At,ft);It=d.bR(this,B,sn,!0).intersects(X)}if(0===It)continue;Rt=2===It}if(Ke.zoom!==Oe&&nn(Ke))for(let It=0;It<4;It++){const sn=(At<<1)+It%2,An=(ft<<1)+(It>>1),Nn={aabb:C?Ke.aabb.quadrant(It):d.bS(this,B,Ke.zoom+1,sn,An,Ke.wrap,Ke.minZ,Ke.maxZ,this.projection),zoom:Ke.zoom+1,x:sn,y:An,wrap:Ke.wrap,fullyVisible:Rt,tileID:void 0,shouldSplit:void 0,minZ:Ke.minZ,maxZ:Ke.maxZ};w&&!j&&(Nn.tileID=new d.aA(Ke.zoom+1===Oe?ct:Ke.zoom+1,Ke.wrap,Ke.zoom+1,sn,An),Ft(Nn)),je.push(Nn)}else{const It=Ke.zoom===Oe?ct:Ke.zoom;if(s.minzoom&&s.minzoom>It)continue;let sn=0;if(!Rt){let Bn=pe?Ke.aabb.intersectsPrecise(X):Ke.aabb.intersectsPreciseFlat(X);if(0===Bn&&Vt()){const rn=new d.bQ(Ke.zoom,At,ft);Bn=d.bR(this,B,rn,!0).intersectsPrecise(X)}if(0===Bn)continue;if(s.calculateQuadrantVisibility)if(X.containsPoint(Ke.aabb.center))sn=15;else for(let rn=0;rn<4;rn++)0!==Ke.aabb.quadrant(rn).intersects(X)&&(sn|=1<<rn)}const An=F[0]-(.5+At+(Ke.wrap<<Ke.zoom))*(1<<c-Ke.zoom),Nn=F[1]-.5-ft,wn=Ke.tileID?Ke.tileID:new d.aA(It,Ke.wrap,Ke.zoom,At,ft);s.calculateQuadrantVisibility&&(wn.visibleQuadrants=sn),Fe.push({tileID:wn,distanceSq:An*An+Nn*Nn})}}if(this.fogCullDistSq){const Ke=this.fogCullDistSq,At=this.horizonLineFromTop();Fe=Fe.filter(ft=>{const Rt=[0,0,0,1],Vt=[d.ab,d.ab,0,1],It=this.calculateFogTileMatrix(ft.tileID.toUnwrapped());d.a6.vec4.transformMat4(Rt,Rt,It),d.a6.vec4.transformMat4(Vt,Vt,It);const sn=d.a6.vec4.min([],Rt,Vt),An=d.a6.vec4.max([],Rt,Vt),Nn=d.bT(sn,An);if(0===Nn)return!0;let wn=!1;const Bn=this._elevation;if(Bn&&Nn>Ke&&0!==At){const rn=this.calculateProjMatrix(ft.tileID.toUnwrapped());let Hn;s.isTerrainDEM||(Hn=Bn.getMinMaxForTile(ft.tileID)),Hn||(Hn={min:Ee,max:we});const pi=d.c4(this.rotation),Bi=[pi[0]*d.ab,pi[1]*d.ab,Hn.max];d.a6.vec3.transformMat4(Bi,Bi,rn),wn=(1-Bi[1])*this.height*.5<At}return Nn<Ke||wn})}return Fe.sort((Ke,At)=>Ke.distanceSq-At.distanceSq).map(Ke=>Ke.tileID)}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const c=d.ap(s.lat,-d.bU,d.bU),g=this.projection.project(s.lng,c);return new d.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/d.bE(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,c){let g,v;const w=this.centerPoint;if("globe"===this.projection.name){const k=this.worldSize;g=(c.x-w.x)/k,v=(c.y-w.y)/k}else{const k=this.pointCoordinate(c),O=this.pointCoordinate(w);g=k.x-O.x,v=k.y-O.y}const C=this.locationCoordinate(s);this.setLocation(new d.a5(C.x-g,C.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,c){const g=c?d.bE(c,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new d.a5(v.x,v.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,c){const g=null!=c?c:this._centerAltitude,v=[s.x,s.y,0,1],w=[s.x,s.y,1,1];d.a6.vec4.transformMat4(v,v,this.pixelMatrixInverse),d.a6.vec4.transformMat4(w,w,this.pixelMatrixInverse);const C=w[3];d.a6.vec4.scale(v,v,1/v[3]),d.a6.vec4.scale(w,w,1/C);const k=v[2],O=w[2];return{p0:v,p1:w,t:k===O?0:(g-k)/(O-k)}}screenPointToMercatorRay(s){const c=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return d.a6.vec4.transformMat4(c,c,this.pixelMatrixInverse),d.a6.vec4.transformMat4(g,g,this.pixelMatrixInverse),d.a6.vec4.scale(c,c,1/c[3]),d.a6.vec4.scale(g,g,1/g[3]),c[2]=d.bE(c[2],this._center.lat)*this.worldSize,g[2]=d.bE(g[2],this._center.lat)*this.worldSize,d.a6.vec4.scale(c,c,1/this.worldSize),d.a6.vec4.scale(g,g,1/this.worldSize),new d.aj([c[0],c[1],c[2]],d.a6.vec3.normalize([],d.a6.vec3.sub([],g,c)))}rayIntersectionCoordinate(s){const{p0:c,p1:g,t:v}=s,w=d.bE(c[2],this._center.lat),C=d.bE(g[2],this._center.lat);return new d.a5(d.aa(c[0],g[0],v)/this.worldSize,d.aa(c[1],g[1],v)/this.worldSize,d.aa(w,C,v))}pointCoordinate(s,c=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,c)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let c=this.projection.pointCoordinate3D(this,s.x,s.y);if(c)return new d.a5(c[0],c[1],c[2]);let g=0,v=this.horizonLineFromTop();if(s.y>v)return this.pointCoordinate(s);const w=.02*v,C=s.clone();for(let k=0;k<10&&v-g>w;k++){C.y=d.aa(g,v,.66);const O=this.projection.pointCoordinate3D(this,C.x,C.y);O?(v=C.y,c=O):g=C.y}return c?new d.a5(c[0],c[1],c[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=d.bV)return!this.isPointAboveHorizon(s);const c=this.pointCoordinate(s);return c.y>=0&&c.y<=1}_coordinatePoint(s,c){const g=c&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return d.a6.vec4.transformMat4(v,v,this.pixelMatrix),v[3]>0?new d.P(v[0]/v[3],v[1]/v[3]):new d.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:c}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,w=this.pointLocation3D(new d.P(c,s)),C=this.pointLocation3D(new d.P(v,s)),k=this.pointLocation3D(new d.P(v,g)),O=this.pointLocation3D(new d.P(c,g));let B=Math.min(w.lng,C.lng,k.lng,O.lng),F=Math.max(w.lng,C.lng,k.lng,O.lng),j=Math.min(w.lat,C.lat,k.lat,O.lat),G=Math.max(w.lat,C.lat,k.lat,O.lat);const X=Math.pow(2,-this.zoom)/16*270,Q="globe"===this.projection.name?1:4,K=(ne,te,pe,be,ye)=>{const we=(ne+pe)/2,Ee=(te+be)/2,Ce=new d.P(we,Ee),{lng:Ie,lat:Le}=this.pointLocation3D(Ce),je=Math.max(0,B-Ie,j-Le,Ie-F,Le-G);B=Math.min(B,Ie),F=Math.max(F,Ie),j=Math.min(j,Le),G=Math.max(G,Le),(ye<Q||je>X)&&(K(ne,te,we,Ee,ye+1),K(we,Ee,pe,be,ye+1))};if(K(c,s,v,s,1),K(v,s,v,g,1),K(v,g,c,g,1),K(c,g,c,s,1),"globe"===this.projection.name){const[ne,te]=d.bW(this);ne?(G=90,F=180,B=-180):te&&(j=-90,F=180,B=-180)}return new d.as(new d.bL(B,j),new d.bL(F,G))}_getBoundsRectangular(s,c){const{top:g,left:v}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,k=new d.P(v,g),O=new d.P(C,g),B=new d.P(C,w),F=new d.P(v,w);let j=this.pointCoordinate(k,s),G=this.pointCoordinate(O,s);const X=this.pointCoordinate(B,c),Q=this.pointCoordinate(F,c),K=(ne,te)=>(te.y-ne.y)/(te.x-ne.x);return j.y>1&&G.y>=0?j=new d.a5((1-Q.y)/K(Q,j)+Q.x,1):j.y<0&&G.y<=1&&(j=new d.a5(-Q.y/K(Q,j)+Q.x,0)),G.y>1&&j.y>=0?G=new d.a5((1-X.y)/K(X,G)+X.x,1):G.y<0&&j.y<=1&&(G=new d.a5(-X.y/K(X,G)+X.x,0)),(new d.as).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(X))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=s.visibleDemTiles.reduce((g,v)=>{if(v.dem){const w=v.dem.tree;g.min=Math.min(g.min,w.minimums[0]),g.max=Math.max(g.max,w.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*s.exaggeration(),c.max*s.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-c*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-d.bU,this.maxLat=d.bU,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.am(this.minLng)*this.tileSize,this.worldMaxX=d.am(this.maxLng)*this.tileSize,this.worldMinY=d.at(this.maxLat)*this.tileSize,this.worldMaxY=d.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,c){return this.projection.createTileMatrix(this,c,s)}calculateDistanceTileData(s){const c=s.key,g=this._distanceTileDataCache;if(g[c])return g[c];const v=s.canonical,w=1/this.height,C=this.cameraWorldSize,k=C/this.zoomScale(v.z),O=(v.x+Math.pow(2,v.z)*s.wrap)*k,B=v.y*k,F=this.point;F.x*=C/this.worldSize,F.y*=C/this.worldSize;const j=this.angle,G=Math.sin(-j),X=-Math.cos(-j);return g[c]={bearing:[G,X],center:[(F.x-O)*w,(F.y-B)*w],scale:k/d.ab*w},g[c]}calculateFogTileMatrix(s){const c=s.key,g=this._fogTileMatrixCache;if(g[c])return g[c];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return d.a6.mat4.multiply(v,this.worldToFogMatrix,v),g[c]=new Float32Array(v),g[c]}calculateProjMatrix(s,c=!1,g=!1){const v=s.key;let w;if(w=g?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,w[v])return w[v];const C=this.calculatePosMatrix(s,this.worldSize);let k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,d.a6.mat4.multiply(C,k,C),w[v]=new Float32Array(C),w[v]}calculatePixelsToTileUnitsMatrix(s){const c=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[c])return g[c];const v=d.bX(s,this);return g[c]=v,g[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const s=1/this.worldSize,c=d.a6.mat4.fromScaling([],[s,s,s]);return d.a6.mat4.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const s=this._elevation;this._updateCameraState();const c=d.bE(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(c),v=this._camera.forward(),w=d.bE(1,this._center.lat);g[2]/=w,v[2]/=w,d.a6.vec3.normalize(v,v);const C=s.raycast(g,v,s.exaggeration());if(C){const k=d.a6.vec3.scaleAndAdd([],g,v,C),O=new d.a5(k[0],k[1],d.bE(k[2],d.aN(k[1]))),B=(O.z+d.a6.vec3.length([O.x-g[0],O.y-g[1],O.z-g[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const c=this._elevation,g=d.bE(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),w=c.getAtPointOrZero(new d.a5(...v)),C=this.pixelsPerMeter/this.worldSize*w,k=this._minimumHeightOverTerrain(),O=v[2]-C;if(O<=k)if(O<0||s){const B=this.locationCoordinate(this._center,this._centerAltitude),F=[v[0],v[1],B.z-v[2]],j=d.a6.vec3.length(F);F[2]-=(k-O)/this._pixelsPerMercatorPixel;const G=d.a6.vec3.length(F);if(0===G)return;d.a6.vec3.scale(F,F,j/G*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],B.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const G=this.center;return G.lat=d.ap(G.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(G.lng=d.ap(G.lng,this.minLng,this.maxLng)),this.center=G,void(this._constraining=!1)}const c=this._unmodified,{x:g,y:v}=this.point;let w=0,C=g,k=v;const O=this.width/2,B=this.height/2,F=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(v-B<F&&(k=F+B),v+B>j&&(k=j-B),j-F<this.height&&(w=Math.max(w,this.height/(j-F)),k=(j+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const G=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,Q=this.worldSize/2-(G+X)/2;C=(g+Q+this.worldSize)%this.worldSize-Q,C-O<G&&(C=G+O),C+O>X&&(C=X-O),X-G<this.width&&(w=Math.max(w,this.width/(X-G)),C=(X+G)/2)}C===g&&k===v||(this.center=this.unproject(new d.P(C,k))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,c="globe"===this.projection.name,g=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=d.bE(1,this.center.lat)/d.bE(1,d.c5));const v=d.bY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w="meters"===this.projection.zAxisUnit?g:1,C=this._camera.getWorldToCamera(this.worldSize,w);let k;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-s.x/this.width,O[9]=2*s.y/this.height,this.isOrthographic){let Le=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),je=Le*this.aspect,Fe=-je,Oe=-Le;je-=s.x,Fe-=s.x,Le+=s.y,Oe+=s.y,k=this._camera.getCameraToClipOrthographic(Fe,je,Oe,Le,this._nearZ,this._farZ),((ct,_t,Ft,Yt)=>{for(let nn=0;nn<16;nn++)ct[nn]=Ds(_t[nn],Ft[nn],Yt)})(k,k,O,pc(this.pitch>=15?1:this.pitch/15))}else k=O;const B=d.a6.mat4.mul([],O,C);let F=d.a6.mat4.mul([],k,C);if(this.projection.isReprojectedInTileSpace){const Le=this.locationCoordinate(this.center),je=d.a6.mat4.identity([]);d.a6.mat4.translate(je,je,[Le.x*this.worldSize,Le.y*this.worldSize,0]),d.a6.mat4.multiply(je,je,d.bZ(this)),d.a6.mat4.translate(je,je,[-Le.x*this.worldSize,-Le.y*this.worldSize,0]),d.a6.mat4.multiply(F,F,je),d.a6.mat4.multiply(B,B,je),this.inverseAdjustmentMatrix=d.b_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=d.a6.mat4.scale([],F,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=F,this.invProjMatrix=d.a6.mat4.invert(new Float64Array(16),this.projMatrix),c){const Le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Le[8]=2*-s.x/this.width,Le[9]=2*s.y/this.height,this.expandedFarZProjMatrix=d.a6.mat4.mul([],Le,C)}else this.expandedFarZProjMatrix=this.projMatrix;const j=d.a6.mat4.invert([],k);this.frustumCorners=d.b$.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height),this.cameraFrustum=d.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const G=new Float32Array(16);d.a6.mat4.identity(G),d.a6.mat4.scale(G,G,[1,-1,1]),d.a6.mat4.rotateX(G,G,this._pitch),d.a6.mat4.rotateZ(G,G,this.angle);const X=d.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=d.a6.mat4.clone(X);const Q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;X[8]=2*-s.x/this.width,X[9]=2*(s.y+Q)/this.height,this.skyboxMatrix=d.a6.mat4.multiply(G,X,G);const K=this.point,ne=K.x,te=K.y,pe=this.width%2/2,be=this.height%2/2,ye=Math.cos(this.angle),we=Math.sin(this.angle),Ee=ne-Math.round(ne)+ye*pe+we*be,Ce=te-Math.round(te)+ye*be+we*pe,Ie=new Float64Array(F);if(d.a6.mat4.translate(Ie,Ie,[Ee>.5?Ee-1:Ee,Ce>.5?Ce-1:Ce,0]),this.alignedProjMatrix=Ie,F=d.a6.mat4.create(),d.a6.mat4.scale(F,F,[this.width/2,-this.height/2,1]),d.a6.mat4.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=d.a6.mat4.create(),d.a6.mat4.scale(F,F,[1,-1,1]),d.a6.mat4.translate(F,F,[-1,-1,0]),d.a6.mat4.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=d.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,B),this._calcFogMatrices(),this._distanceTileDataCache={},F=d.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=d.c0(this);const Le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=d.a6.vec3.transformMat4(Le,Le,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,w=[s,s,c];d.a6.vec3.scale(w,w,v),d.a6.vec3.scale(g,g,-1),d.a6.vec3.multiply(g,g,w);const C=d.a6.mat4.create();d.a6.mat4.translate(C,C,g),d.a6.mat4.scale(C,C,w),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,c,v)}_computeCameraPosition(s){const c=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*w,v.y/this.worldSize-g[1]*w,s/this.worldSize*this._centerAltitude-g[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=s[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(w=Math.min((c-g)/v,1)),this._camera.position=d.a6.vec3.scaleAndAdd([],this._camera.position,s,w),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,c=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),w=d.bE(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.bC(this._maxPitch)),k=Math.max((s[2]-w)/Math.cos(g),C),O=this._zoomFromMercatorZ(k);d.a6.vec3.scaleAndAdd(s,s,c,k),this._pitch=d.ap(g,d.bC(this.minPitch),d.bC(this.maxPitch)),this.angle=d.bB(v,-Math.PI,Math.PI),this._setZoom(d.ap(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new d.a5(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let c=0,g=d.bV,v=0,w=1/0;for(;g-c>1e-6&&g>c;){const C=c+.5*(g-c),k=this.tileSize*Math.pow(2,C),O=this.getCameraToCenterDistance(this.projection,C,k),B=this.scaleZoom(O/(s*this.tileSize)),F=Math.abs(C-B);F<w&&(w=F,v=C),C<B?c=C:g=C}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,c){const g=Math.min(s.x,c.x),v=Math.max(s.x,c.x),w=Math.min(s.y,c.y),C=Math.max(s.y,c.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const k=[new d.P(g,w),new d.P(v,C),new d.P(g,C),new d.P(v,w)],O=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const F of k){const j=this.pointRayIntersection(F);if(j.t<0)return!0;const G=this.rayIntersectionCoordinate(j);if(G.x<O||G.y<0||G.x>B||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.c1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.P(0,0),new d.P(this.width,this.height))}zoomDeltaToMovement(s,c){const g=d.a6.vec3.length(d.a6.vec3.sub([],this._camera.position,s)),v=this._zoomFromMercatorZ(g)+c;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if("globe"===this.projection.name){const s=function([c,g,v],w){const C=[c,g,v,1];d.a6.vec4.transformMat4(C,C,w);const k=C[3]=Math.max(C[3],1e-6);return C[0]/=k,C[1]/=k,C[2]/=k,C}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new d.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,s))}}getCameraToCenterDistance(s,c=this.zoom,g=this.worldSize){const v=d.bY(s,c,this.width,this.height,1024),w=s.pixelSpaceConversion(this.center.lat,g,v);let C=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(C=Ds(1,C,pc(this.pitch>=15?1:this.pitch/15))),C}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&d.a6.mat4.multiply(s,s,this.globeMatrix),s}getFrustum(s){return d.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,"meters"===this.projection.zAxisUnit)}}const Ga=(m,s)=>{if(s>0&&m.terrain&&d.w("Cutoff is currently disabled on terrain"),s<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=m.transform,g=Math.max(Math.abs(c._zoom-(m.minCutoffZoom-1)),1),v=c.isLODDisabled(!1)?d.a7(60,45,c.pitch):d.a7(30,15,c.pitch),w=c._farZ-c._nearZ,C=s*c.height,k=((1-(O=v))*c.cameraToCenterDistance+O*(c._farZ+C))*g;var O;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(k-c._nearZ)/w,(k-C-c._nearZ)/w]}}},po={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class fc{constructor(s,c){this.aabb=s,this.lastCascade=c}}class Jt{add(s,c){const g=this.receivers[s.key];void 0!==g?(g.aabb.min[0]=Math.min(g.aabb.min[0],c.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],c.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],c.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],c.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],c.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],c.max[2])):this.receivers[s.key]=new fc(c,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,c,g){const v=d.ca.fromPoints(s.points);let w=0;for(const C in this.receivers){const k=this.receivers[C];if(!k||!v.intersectsAabb(k.aabb))continue;k.aabb.min=v.closestPoint(k.aabb.min),k.aabb.max=v.closestPoint(k.aabb.max);const O=k.aabb.getCorners();for(let B=0;B<g.length;B++){let F=!0;for(const j of O){const G=[j[0]*c,j[1]*c,j[2]];if(d.a6.vec3.transformMat4(G,G,g[B].matrix),G[0]<-1||G[0]>1||G[1]<-1||G[1]>1){F=!1;break}}if(k.lastCascade=B,w=Math.max(w,B),F)break}}return w+1}}class z_{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Jt,this._depthMode=new Ut(s.context.gl.LEQUAL,Ut.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(po,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(po,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),s.tp.registerParameter(po,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,c){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const v=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((Q,K)=>{const ne=g.style._mergedLayers[K];return Q+(ne.hasShadowPass()&&!ne.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=g.context,C=po.shadowMapResolution,k=po.shadowMapResolution;if(0===this._cascades.length||po.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Q=0;Q<po.cascadeCount;++Q){const K=g._shadowMapDebug,ne=w.gl,te=w.createFramebuffer(C,k,K,"texture"),pe=new d.T(w,{width:C,height:k,data:null},ne.DEPTH_COMPONENT16);if(te.depthAttachment.set(pe.texture),K){const be=new d.T(w,{width:C,height:k,data:null},ne.RGBA8);te.colorAttachment.set(be.texture)}this._cascades.push({framebuffer:te,texture:pe,matrix:[],far:0,boundingSphereRadius:0,frustum:new d.bO,scale:0})}}this.shadowDirection=Un(c);let O=0;if(s.elevation){const Q=s.elevation,K=[1e4,-1e4];Q.visibleDemTiles.filter(ne=>ne.dem).forEach(ne=>{const te=ne.dem.tree;K[0]=Math.min(K[0],te.minimums[0]),K[1]=Math.max(K[1],te.maximums[0])}),1e4!==K[0]&&(O=(K[1]-K[0])*Q.exaggeration())}const B=1.5*s.cameraToCenterDistance,F=3*B,j=new Float64Array(16);for(let Q=0;Q<this._cascades.length;++Q){const K=this._cascades[Q];let ne=s.height/50,te=1;1===po.cascadeCount?te=F:0===Q?te=B:(ne=B,te=F);const[pe,be]=Co(s,this.shadowDirection,ne,te,po.shadowMapResolution,O);K.scale=s.scale,K.matrix=pe,K.boundingSphereRadius=be,d.a6.mat4.invert(j,K.matrix),K.frustum=d.bO.fromInvProjectionMatrix(j,1,0,!0),K.far=te}const G=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[G].far,this._cascades[G].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/po.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=po.shadowMapResolution,this._uniformValues.u_shadowmap_0=so_ShadowMap0,this._uniformValues.u_shadowmap_1=so_ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const X=g.transform.elevation;for(const Q of this._groundShadowTiles){let K={min:0,max:0};if(X){const ne=X.getMinMaxForTile(Q);ne&&(K=ne)}this.addShadowReceiver(Q.toUnwrapped(),K.min,K.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,c){if(!this.enabled)return;const g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,po.shadowMapResolution,po.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){g.currentShadowCascade=w,v.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),v.clear({color:d.bA.white,depth:1});for(const C of s.order){const k=s._mergedLayers[C];if(!k.hasShadowPass()||k.isHidden(g.transform.zoom))continue;const O=s.getLayerSourceCache(k),B=O?c[O.id]:void 0;("model"===k.type||B&&B.length)&&g.renderLayer(g,O,k,B)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,c=s.style,g=s.context,v=c.directionalLight,w=c.ambientLight;if(!v||!w)return;const C=[],k=Ga(s,s.longestCutoffRange);k.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),C.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&C.push("NORMAL_OFFSET");const O=Yi(c,v,w),B=new Ut(g.gl.LEQUAL,Ut.ReadOnly,s.depthRangeFor3D);for(const F of this._groundShadowTiles){const j=F.toUnwrapped(),G=s.isTileAffectedByFog(F),X=s.getOrCreateProgram("groundShadow",{defines:C,overrideFog:G});this.setupShadows(j,X),s.uploadCommonUniforms(g,X,j,null,k);const Q={u_matrix:s.transform.calculateProjMatrix(j),u_ground_shadow_factor:O};X.draw(s,g.gl.TRIANGLES,B,li.disabled,Li.multiply,ni.disabled,Q,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,{},s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Li.unblended:Li.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const c=this.painter.transform,g=c.calculatePosMatrix(s,c.worldSize);return d.a6.mat4.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(s){return d.a6.mat4.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,c,g,v=0){if(!this.enabled)return;const w=this.painter.transform,C=this.painter.context,k=C.gl,O=this._uniformValues,B=new Float64Array(16),F=w.calculatePosMatrix(s,w.worldSize);for(let j=0;j<this._cascades.length;j++)d.a6.mat4.multiply(B,this._cascades[j].matrix,F),O[0===j?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(B),C.activeTexture.set(k.TEXTURE0+so_ShadowMap0+j),this._cascades[j].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){const j=d.c9(s.canonical),G=2/w.tileSize*d.ab/po.shadowMapResolution,X=G*this._cascades[0].boundingSphereRadius,Q=G*this._cascades[this._cascades.length-1].boundingSphereRadius,K=("vector-tile"===g?1:3)/Math.pow(2,v-s.canonical.z-(1-w.zoom+Math.floor(w.zoom)));O.u_shadow_normal_offset=[j,X*K,Q*K],O.u_shadow_bias=[6e-5,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(C,O)}setupShadowsFromMatrix(s,c,g=!1){if(!this.enabled)return;const v=this.painter.context,w=v.gl,C=this._uniformValues,k=new Float64Array(16);for(let O=0;O<po.cascadeCount;O++)d.a6.mat4.multiply(k,this._cascades[O].matrix,s),C[0===O?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),v.activeTexture.set(w.TEXTURE0+so_ShadowMap0+O),this._cascades[O].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);if(this.useNormalOffset=g,g){const O=po.normalOffset;C.u_shadow_normal_offset=[1,O,O],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(v,C)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,c,g,v){if(v[2]>=0)return{};const w=function(O,B,F){const j=F/(1<<O.canonical.z);return new d.ca([O.canonical.x*j+O.wrap*F,O.canonical.y*j+O.wrap*F,0],[(O.canonical.x+1)*j+O.wrap*F,(O.canonical.y+1)*j+O.wrap*F,B])}(s,c,g).getCorners(),C=c/-v[2];v[0]<0?(d.a6.vec3.add(w[0],w[0],[v[0]*C,0,0]),d.a6.vec3.add(w[3],w[3],[v[0]*C,0,0])):v[0]>0&&(d.a6.vec3.add(w[1],w[1],[v[0]*C,0,0]),d.a6.vec3.add(w[2],w[2],[v[0]*C,0,0])),v[1]<0?(d.a6.vec3.add(w[0],w[0],[0,v[1]*C,0]),d.a6.vec3.add(w[1],w[1],[0,v[1]*C,0])):v[1]>0&&(d.a6.vec3.add(w[2],w[2],[0,v[1]*C,0]),d.a6.vec3.add(w[3],w[3],[0,v[1]*C,0]));const k={};return k.vertices=w,k.planes=[zs(w[1],w[0],w[4]),zs(w[2],w[1],w[5]),zs(w[3],w[2],w[6]),zs(w[0],w[3],w[7])],k}addShadowReceiver(s,c,g){this._receivers.add(s,d.ca.fromTileIdAndHeight(s,c,g))}getMaxCascadeForTile(s){const c=this._receivers.get(s);return c&&c.lastCascade?c.lastCascade:0}}function zs(m,s,c){const g=d.a6.vec3.sub([],c,s),v=d.a6.vec3.sub([],m,s),w=d.a6.vec3.cross([],g,v),C=d.a6.vec3.length(w);return 0===C?[0,0,1,0]:(d.a6.vec3.scale(w,w,1/C),[w[0],w[1],w[2],-d.a6.vec3.dot(w,s)])}function Un(m){const s=m.properties.get("direction"),c=d.c8(s.x,s.y,s.z);c[2]=d.ap(c[2],0,75);const g=d.cb([c[0],c[1],c[2]]);return d.a6.vec3.fromValues(g.x,g.y,g.z)}function Yi(m,s,c){const g=s.properties.get("color"),v=s.properties.get("intensity"),w=s.properties.get("direction"),C=[w.x,w.y,w.z],k=c.properties.get("color"),O=c.properties.get("intensity"),B=Math.max(d.a6.vec3.dot([0,0,1],C),0),F=[0,0,0];d.a6.vec3.scale(F,k.toRenderColor(m.getLut(s.scope)).toArray01Linear().slice(0,3),O);const j=[0,0,0];return d.a6.vec3.scale(j,g.toRenderColor(m.getLut(c.scope)).toArray01Linear().slice(0,3),B*v),d.cc([F[0]>0?F[0]/(F[0]+j[0]):0,F[1]>0?F[1]/(F[1]+j[1]):0,F[2]>0?F[2]/(F[2]+j[2]):0])}function Co(m,s,c,g,v,w){const C=m.zoom,k=m.scale,O=m.worldSize,B=1/O,F=m.aspect,j=Math.sqrt(1+F*F)*Math.tan(.5*m.fovX),G=j*j,X=g-c,Q=g+c;let K,ne;G>X/Q?(K=g,ne=g*j):(K=.5*Q*(1+G),ne=.5*Math.sqrt(X*X+2*(g*g+c*c)*G+Q*Q*G*G));const te=m.projection.pixelsPerMeter(m.center.lat,O),pe=m._camera.getCameraToWorldMercator(),be=[0,0,-K*B];d.a6.vec3.transformMat4(be,be,pe);let ye=ne*B;const we=m._edgeInsets;if(!(0===we.left&&0===we.top&&0===we.right&&0===we.bottom||we.left===we.right&&we.top===we.bottom)){const Rt=m._camera.getWorldToCamera(m.worldSize,"meters"===m.projection.zAxisUnit?te:1),Vt=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,c,g);Vt[8]=2*-m.centerOffset.x/m.width,Vt[9]=2*m.centerOffset.y/m.height;const It=new Float64Array(16);d.a6.mat4.mul(It,Vt,Rt);const sn=new Float64Array(16);d.a6.mat4.invert(sn,It);const An=d.bO.fromInvProjectionMatrix(sn,O,C,!0);for(const Nn of An.points){const wn=((Ee=Nn)[0]/=k,Ee[1]/=k,Ee[2]=d.bE(Ee[2],m._center.lat),Ee);ye=Math.max(ye,d.a6.vec3.len(d.a6.vec3.subtract([],be,wn)))}}var Ee;ye*=v/(v-1);const Ce=Math.acos(s[2]),Ie=Math.atan2(-s[0],-s[1]),Le=new ns;Le.position=be,Le.setPitchBearing(Ce,Ie);const je=Le.getWorldToCamera(O,te),Fe=ye*O,Oe=Math.min(m._mercatorZfromZoom(17)*O*-2,-2*Fe),ct=Le.getCameraToClipOrthographic(-Fe,Fe,-Fe,Fe,Oe,(Fe+w*te)/s[2]),_t=new Float64Array(16);d.a6.mat4.multiply(_t,ct,je);const Ft=d.a6.vec3.fromValues(Math.floor(1e6*be[0])/1e6*O,Math.floor(1e6*be[1])/1e6*O,0),Yt=.5*v,nn=[0,0,0];d.a6.vec3.transformMat4(nn,Ft,_t),d.a6.vec3.scale(nn,nn,Yt);const Ke=[Math.floor(nn[0]),Math.floor(nn[1]),Math.floor(nn[2])],At=[0,0,0];d.a6.vec3.sub(At,nn,Ke),d.a6.vec3.scale(At,At,-1/Yt);const ft=new Float64Array(16);return d.a6.mat4.identity(ft),d.a6.mat4.translate(ft,ft,At),d.a6.mat4.multiply(_t,ft,_t),[_t,Fe]}class is extends d.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.numModelsLoading={}}loadModel(s,c){return d.aG(this.requestManager.transformRequest(c,d.R.Model).url).then(g=>{if(!g)return;const v=d.aH(g),w=new d.aI(s,void 0,void 0,v);return w.computeBoundsAndApplyParent(),w}).catch(g=>{if(g&&404===g.status)return null;this.fire(new d.t(new Error(`Could not load model ${s} from ${c}: ${g.message}`)))})}load(s,c){this.models[c]||(this.models[c]={});const g=Object.keys(s);this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+g.length;const v=[];for(const w of g)v.push(this.loadModel(w,s[w]));Promise.allSettled(v).then(w=>{for(let C=0;C<w.length;C++){const{status:k,value:O}=w[C];"fulfilled"===k&&O&&(this.models[c][g[C]]={model:O,numReferences:1})}this.numModelsLoading[c]-=g.length,this.fire(new d.x("data",{dataType:"style"}))}).catch(w=>{this.fire(new d.t(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,c){return!!this.getModel(s,c)}getModel(s,c){return this.models[c]||(this.models[c]={}),this.models[c][s]?this.models[c][s].model:void 0}addModel(s,c,g){this.models[g]||(this.models[g]={}),this.hasModel(s,g)&&this.models[g][s].numReferences++,this.load({[s]:this.requestManager.normalizeModelURL(c)},g)}addModels(s,c){this.models[c]||(this.models[c]={});const g={};for(const v in s)this.models[c][v]={},g[v]=this.requestManager.normalizeModelURL(s[v]);this.load(g,c)}addModelsFromBucket(s,c){this.models[c]||(this.models[c]={});const g={};for(const v of s)this.hasModel(v,c)?this.models[c][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,c)}removeModel(s,c){if(this.models[c]&&this.models[c][s]&&(this.models[c][s].numReferences--,0===this.models[c][s].numReferences)){const g=this.models[c][s].model;delete this.models[c][s],g.destroy()}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,c){this.models[c]||(this.models[c]={});for(const g in this.models[c])this.models[c][g].model&&this.models[c][g].model.upload(s.context)}}const mc=new d.a0({data:new d.a1(d._.colorTheme.data)}),fo=(m,s)=>Ye(m,s&&s.filter(c=>"source.canvas"!==c.identifier)),Wl=d.ar(Ln,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Do=d.ar(Ln,["setCenter","setZoom","setBearing","setPitch"]),vd={version:8,layers:[],sources:{}},xd={duration:300,delay:0};class Ai extends d.E{constructor(s,c={}){super(),this.map=s,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=d.l({},xd),this._buildingIndex=new N_(this),this.crossTileSymbolIndex=new cl,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._mergedLayerSelectors=new Map,this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new Dt,this.dispatcher=c.dispatcher?c.dispatcher:new d.ce(d.cf(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new to,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new d.cg(s._requestManager,c.localFontFamily?d.ch.all:c.localIdeographFontFamily?d.ch.ideographs:d.ch.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new is(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",d.ci());const g=this;this._rtlTextPluginCallback=Ai.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(w,C)=>{if(d.cj(w),C&&C.every(k=>k))for(const k in g._sourceCaches){const O=g._sourceCaches[k],B=O.getSource().type;"vector"!==B&&"geojson"!==B||O.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const w=this.getOwnSource(v.sourceId);if(w&&w.vectorLayerIds)for(const C in this._layers){const k=this._layers[C];k.source===w.id&&this._validateLayer(k)}})}load(s){return s?("string"==typeof s?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if("string"==typeof s){if(d.f(s))return s;const c=d.ck(s);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch(g){return c}return c}return`json://${d.cl(JSON.stringify(s))}`}_diffStyle(s,c,g){this.globalId=this._getGlobalId(s);const v=(w,C)=>{try{C(null,this.setState(w,g))}catch(k){C(k,!1)}};if("string"==typeof s){const w=this.map._requestManager.normalizeStyleURL(s),C=this.map._requestManager.transformRequest(w,d.R.Style);d.n(C,(k,O)=>{k?this.fire(new d.t(k)):O&&v(O,c)})}else"object"==typeof s&&v(s,c)}loadURL(s,c={}){this.fire(new d.x("dataloading",{dataType:"style"}));const g="boolean"==typeof c.validate?c.validate:!d.f(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,c.accessToken),this.resolvedImports.add(s);const v=this.importsCache.get(s);if(v)return this._load(v,g);const w=this.map._requestManager.transformRequest(s,d.R.Style);this._request=d.n(w,(C,k)=>{if(this._request=null,C)this.fire(new d.t(C));else if(k)return this.importsCache.set(s,k),this._load(k,g)})}loadJSON(s,c={}){this.fire(new d.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=d.q.frame(()=>{this._request=null,this._load(s,!1!==c.validate)})}loadEmpty(){this.fire(new d.x("dataloading",{dataType:"style"})),this._load(vd,!1)}_loadImports(s,c,g){if(this.importDepth>=4)return d.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const w of s){const C=this._createFragmentStyle(w),k=new Promise(F=>{C.once("style.import.load",F),C.once("error",F)}).then(()=>this.mergeAll());if(v.push(k),this.resolvedImports.has(w.url)){C.loadEmpty();continue}const O=w.data||this.importsCache.get(w.url);O?(C.loadJSON(O,{validate:c}),this._isInternalStyle(O)&&(C.globalId=null)):w.url?C.loadURL(w.url,{validate:c}):C.loadEmpty();const B={style:C,id:w.id,config:w.config};if(g){const F=this.fragments.findIndex(({id:j})=>j===g);this.fragments=this.fragments.slice(0,F).concat(B).concat(this.fragments.slice(F))}else this.fragments.push(B)}return Promise.allSettled(v)}getImportGlobalIds(s=this,c=new Set){for(const g of s.fragments)g.style.globalId&&c.add(g.style.globalId),this.getImportGlobalIds(g.style,c);return[...c.values()]}_createFragmentStyle(s){const c=this.scope?d.av(s.id,this.scope):s.id;let g;const v=this._initialConfig&&this._initialConfig[c];(s.config||v)&&(g=d.l({},s.config,v));const w=new Ai(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&!1!==s.fragment)}_load(s,c){const g=s.schema;if(this._isInternalStyle(s)){const C=d.l({},vd,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(C,c)}if(this.updateConfig(this._config,g),c&&fo(this,Va(s)))return;this._loaded=!0,this.stylesheet=d.cm(s);const v=()=>{for(const B in s.sources)this.addSource(B,s.sources[B],{validate:!1,isInitialLoad:!0});s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(s.glyphs,this.scope);const C=_d(this.stylesheet.layers);if(this._order=C.map(B=>B.id),this.stylesheet.light&&d.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const B=this.stylesheet.lights[0];this.light=new tt(B.properties,B.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new tt(this.stylesheet.light)),this._layers={};for(const B of C){const F=d.cq(B,this.scope,this._styleColorTheme.lut,this.options);0!==F.configDependencies.size&&this._configDependentLayers.add(F.fqid),F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F;const j=this.getOwnLayerSourceCache(F),G=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&F.canCastShadows()&&G&&(j.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new d.x("data",{dataType:"style"}));const O=this.isRootStyle();s.imports?this._loadImports(s.imports,c).then(()=>{this._reloadImports(),this.fire(new d.x(O?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new d.x(O?"style.load":"style.import.load")))},w=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=w,w){const C=this._evaluateColorThemeData(w);this._loadColorTheme(C).then(()=>{v()}).catch(k=>{d.w(`Couldn't load color theme from the stylesheet: ${k}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return 0===this.importDepth}mergeAll(){let s,c,g,v,w,C,k,O;const B={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(F=>{if(F.stylesheet){if(null!=F.light&&(s=F.light),F.stylesheet.lights)for(const j of F.stylesheet.lights)"ambient"===j.type&&null!=F.ambientLight&&(c=F.ambientLight),"directional"===j.type&&null!=F.directionalLight&&(g=F.directionalLight);v=this._prioritizeTerrain(v,F.terrain,F.stylesheet.terrain),F.stylesheet.fog&&null!=F.fog&&(w=F.fog),null!=F.stylesheet.camera&&(O=F.stylesheet.camera),null!=F.stylesheet.projection&&(C=F.stylesheet.projection),null!=F.stylesheet.transition&&(k=F.stylesheet.transition),B[F.scope]=F._styleColorTheme}}),this.light=s,this.ambientLight=c,this.directionalLight=g,this.fog=w,this._styleColorThemeForScope=B,null===v?delete this.terrain:this.terrain=v,this.camera=O||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=d.l({},xd,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){const c=g=>{for(const v of g.fragments)c(v.style);s(g)};c(this)}_prioritizeTerrain(s,c,g){const v=s&&0===s.drapeRenderMode;return null===g?c&&0===c.drapeRenderMode?c:v?s:null:null!=c&&(!s||v||c&&1===c.drapeRenderMode)?c:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{s=this._prioritizeTerrain(s,c.terrain,c.stylesheet.terrain)}),null===s?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(c=>{null!=c.stylesheet.projection&&(s=c.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},c={},g={};this.forEachFragmentStyle(v=>{for(const w in v._sourceCaches){const C=d.av(w,v.scope);s[C]=v._sourceCaches[w]}for(const w in v._otherSourceCaches){const C=d.av(w,v.scope);c[C]=v._otherSourceCaches[w]}for(const w in v._symbolSourceCaches){const C=d.av(w,v.scope);g[C]=v._symbolSourceCaches[w]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=g}mergeLayers(){const s={},c=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._mergedLayerSelectors.clear(),this.forEachFragmentStyle(w=>{for(const k of w._order){const O=w._layers[k];if("slot"===O.type){const B=d.cn(k);if(s[B])continue;s[B]=[]}O.slot&&s[O.slot]?s[O.slot].push(O):c.push(O)}const{featuresets:C}=w.stylesheet||{};if(C)for(const k in C){const{selectors:O}=C[k];for(const B of O){const F=w._layers[B.layer],j=this._mergedLayerSelectors.get(F.fqid)||[];let G;if(B.properties)for(const X in B.properties){const Q=d.M(B.properties[X]);"success"===Q.result&&(G=G||{},G[X]=Q.value)}j.push({featuresetId:k,featureNamespace:B.featureNamespace,properties:G}),this._mergedLayerSelectors.set(F.fqid,j)}}}),this._mergedOrder=[];const v=(w=[])=>{for(const C of w)if("slot"===C.type){const k=d.cn(C.id);s[k]&&v(s[k]),this._mergedSlots.push(k)}else{const k=d.av(C.id,C.scope);this._mergedOrder.push(k),g[k]=C,C.is3D()&&(this._has3DLayers=!0),"circle"===C.type&&(this._hasCircleLayers=!0),"symbol"===C.type&&(this._hasSymbolLayers=!0),"clip"===C.type&&(this._clipLayerPresent=!0)}};v(c),this._mergedOrder.sort((w,C)=>{const k=g[w],O=g[C];return k.hasInitialOcclusionOpacityProperties?O.is3D()?1:0:k.is3D()&&O.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=d.l({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(c,g,v){const w=d.l({},g);for(const k of Object.keys(d._.colorTheme))void 0===w[k]&&(w[k]=d._.colorTheme[k].default);const C=new d.$(mc,c,new Map(v));return C.setTransitionOrValue(w,v),C.untransitioned().possiblyEvaluate(new d.a3(0))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,v)=>{const w="data:image/png;base64,";if(!s||0===s.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let C=s;C.startsWith(w)||(C=w+C);const k="mapbox-reserved-lut",O=new Image;O.src=C,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void g();this._styleColorTheme.lutLoading=!1;const{width:B,height:F,data:j}=d.q.getImageData(O);if(F>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(B!==F*F)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(k)&&this.removeImage(k),this.addImage(k,{data:new d.r({width:B,height:F},j),pixelRatio:1,sdf:!1,version:0});const G=this.imageManager.getImage(k,this.scope);G?(this._styleColorTheme.lut={image:G.data,data:s},g()):v(new Error("Missing LUT image."))}})}getLut(s){const c=this._styleColorThemeForScope[s];return c?c.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(c,g,v){let w,C,k;const O=d.q.devicePixelRatio>1?"@2x":"";let B=d.n(g.transformRequest(g.normalizeSpriteURL(c,O,".json"),d.R.SpriteJSON),(G,X)=>{B=null,k||(k=G,w=X,j())}),F=d.o(g.transformRequest(g.normalizeSpriteURL(c,O,".png"),d.R.SpriteImage),(G,X)=>{F=null,k||(k=G,C=X,j())});function j(){if(k)v(k);else if(w&&C){const G=d.q.getImageData(C),X={};for(const Q in w){const{width:K,height:ne,x:te,y:pe,sdf:be,pixelRatio:ye,stretchX:we,stretchY:Ee,content:Ce}=w[Q],Ie=new d.r({width:K,height:ne});d.r.copy(G,Ie,{x:te,y:pe},{x:0,y:0},{width:K,height:ne},null),X[Q]={data:Ie,pixelRatio:ye,sdf:be,stretchX:we,stretchY:Ee,content:Ce}}v(null,X)}}return{cancel(){B&&(B.cancel(),B=null),F&&(F.cancel(),F=null)}}}(s,this.map._requestManager,(c,g)=>{if(this._spriteRequest=null,c)this.fire(new d.t(c));else if(g)for(const v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new d.x("data",{dataType:"style"}))})}_validateLayer(s){const c=this.getOwnSource(s.source);if(!c)return;const g=s.sourceLayer;g&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(g))&&this.fire(new d.t(new Error(`Source layer "${g}" does not exist on source "${c.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,c)=>{const g=this.fragments[c];return g&&g.style&&(s.data=g.style.serialize()),s})}_serializeSources(){const s={};for(const c in this._sourceCaches){const g=this._sourceCaches[c].getSource();s[g.id]||(s[g.id]=g.serialize())}return s}_serializeLayers(s){const c=[];for(const g of s){const v=this._layers[g];v&&"custom"!==v.type&&c.push(v.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const c=this.getOwnLayer(s);if(c)return c;this.fire(new d.t(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const c=this.getOwnSource(s);if(c)return c;this.fire(new d.t(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,c){const g=this.map.painter;if(g)for(let v=s.minzoom||0;v<(s.maxzoom||25.5);v++){const w=s.getProgramIds();if(w)for(const C of w){const k=s.getDefaultProgramParams(C,c.zoom,this._styleColorTheme.lut);k&&(g.style=this,this.fog&&(g._fogVisible=!0,k.overrideFog=!0,g.getOrCreateProgram(C,k)),g._fogVisible=!1,k.overrideFog=!1,g.getOrCreateProgram(C,k),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(k.overrideRtt=!0,g.getOrCreateProgram(C,k)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const c=this.calculateLightsBrightness();s.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c));const g=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const C=this._changes.getLayerUpdatesByScope();for(const k in C){const{updatedIds:O,removedIds:B}=C[k];(O||B)&&(this._updateWorkerLayers(k,O,B),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._changes.reset()}const w={};for(const C in this._mergedSourceCaches){const k=this._mergedSourceCaches[C];w[C]=k.used,k.used=!1,k.tileCoverLift=0}for(const C of this._mergedOrder){const k=this._mergedLayers[C];if(k.recalculate(s,this._availableImages),!k.isHidden(s.zoom)){const O=this.getLayerSourceCache(k);O&&(O.used=!0,O.tileCoverLift=Math.max(O.tileCoverLift,k.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(k,s)}):this.precompilePrograms(k,s))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(const C in w){const k=this._mergedSourceCaches[C];w[C]!==k.used&&k.getSource().fire(new d.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new d.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=this._changes.getUpdatedImages();if(s.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s);this._changes.resetUpdatedImages()}}_updateWorkerLayers(s,c,g){const v=this.getFragmentStyle(s);v&&this.dispatcher.broadcast("updateLayers",{layers:c?v._serializeLayers(c):[],scope:s,removedIds:g||[],options:v.options})}setState(s,c){if(this._checkLoaded(),fo(this,Va(s)))return!1;(s=d.cm(s)).layers=_d(s.layers);const g=function(C,k){if(!C)return[{command:Ln.setStyle,args:[k]}];let O=[];try{if(!d.bi(C.version,k.version))return[{command:Ln.setStyle,args:[k]}];if(d.bi(C.center,k.center)||O.push({command:Ln.setCenter,args:[k.center]}),d.bi(C.zoom,k.zoom)||O.push({command:Ln.setZoom,args:[k.zoom]}),d.bi(C.bearing,k.bearing)||O.push({command:Ln.setBearing,args:[k.bearing]}),d.bi(C.pitch,k.pitch)||O.push({command:Ln.setPitch,args:[k.pitch]}),d.bi(C.sprite,k.sprite)||O.push({command:Ln.setSprite,args:[k.sprite]}),d.bi(C.glyphs,k.glyphs)||O.push({command:Ln.setGlyphs,args:[k.glyphs]}),d.bi(C.imports,k.imports)||function(X=[],Q=[],K){Q=Q||[];const ne=(X=X||[]).map(fs),te=Q.map(fs),pe=X.reduce(Ph,{}),be=Q.reduce(Ph,{}),ye=ne.slice();let we,Ee,Ce,Ie;for(we=0,Ee=0;we<ne.length;we++)Ce=ne[we],be.hasOwnProperty(Ce)?Ee++:(K.push({command:Ln.removeImport,args:[Ce]}),ye.splice(ye.indexOf(Ce,Ee),1));for(we=0,Ee=0;we<te.length;we++)Ce=te[te.length-1-we],ye[ye.length-1-we]!==Ce&&(pe.hasOwnProperty(Ce)?(K.push({command:Ln.removeImport,args:[Ce]}),ye.splice(ye.lastIndexOf(Ce,ye.length-Ee),1)):Ee++,Ie=ye[ye.length-we],K.push({command:Ln.addImport,args:[be[Ce],Ie]}),ye.splice(ye.length-we,0,Ce));for(const Le of Q){const je=pe[Le.id];je&&!d.bi(je,Le)&&K.push({command:Ln.updateImport,args:[Le.id,Le]})}}(C.imports,k.imports,O),d.bi(C.transition,k.transition)||O.push({command:Ln.setTransition,args:[k.transition]}),d.bi(C.light,k.light)||O.push({command:Ln.setLight,args:[k.light]}),d.bi(C.fog,k.fog)||O.push({command:Ln.setFog,args:[k.fog]}),d.bi(C.projection,k.projection)||O.push({command:Ln.setProjection,args:[k.projection]}),d.bi(C.lights,k.lights)||O.push({command:Ln.setLights,args:[k.lights]}),d.bi(C.camera,k.camera)||O.push({command:Ln.setCamera,args:[k.camera]}),!d.bi(C["color-theme"],k["color-theme"]))return[{command:Ln.setStyle,args:[k]}];const B={},F=[];!function(X,Q,K,ne){let te;for(te in Q=Q||{},X=X||{})X.hasOwnProperty(te)&&(Q.hasOwnProperty(te)||mr(te,K,ne));for(te in Q){if(!Q.hasOwnProperty(te))continue;const pe=Q[te];X.hasOwnProperty(te)?d.bi(X[te],pe)||("geojson"===X[te].type&&"geojson"===pe.type&&Wn(X,Q,te)?K.push({command:Ln.setGeoJSONSourceData,args:[te,pe.data]}):e1(te,Q,K,ne)):$r(te,Q,K)}}(C.sources,k.sources,F,B);const j=[];C.layers&&C.layers.forEach(X=>{X.source&&B[X.source]?O.push({command:Ln.removeLayer,args:[X.id]}):j.push(X)});let G=C.terrain;G&&B[G.source]&&(O.push({command:Ln.setTerrain,args:[void 0]}),G=void 0),O=O.concat(F),d.bi(G,k.terrain)||O.push({command:Ln.setTerrain,args:[k.terrain]}),function(X,Q,K){Q=Q||[];const ne=(X=X||[]).map(fs),te=Q.map(fs),pe=X.reduce(Ph,{}),be=Q.reduce(Ph,{}),ye=ne.slice(),we=Object.create(null);let Ee,Ce,Ie,Le,je,Fe,Oe;for(Ee=0,Ce=0;Ee<ne.length;Ee++)Ie=ne[Ee],be.hasOwnProperty(Ie)?Ce++:(K.push({command:Ln.removeLayer,args:[Ie]}),ye.splice(ye.indexOf(Ie,Ce),1));for(Ee=0,Ce=0;Ee<te.length;Ee++)Ie=te[te.length-1-Ee],ye[ye.length-1-Ee]!==Ie&&(pe.hasOwnProperty(Ie)?(K.push({command:Ln.removeLayer,args:[Ie]}),ye.splice(ye.lastIndexOf(Ie,ye.length-Ce),1)):Ce++,Fe=ye[ye.length-Ee],K.push({command:Ln.addLayer,args:[be[Ie],Fe]}),ye.splice(ye.length-Ee,0,Ie),we[Ie]=!0);for(Ee=0;Ee<te.length;Ee++)if(Ie=te[Ee],Le=pe[Ie],je=be[Ie],!we[Ie]&&!d.bi(Le,je))if(d.bi(Le.source,je.source)&&d.bi(Le["source-layer"],je["source-layer"])&&d.bi(Le.type,je.type)){for(Oe in Vc(Le.layout,je.layout,K,Ie,null,Ln.setLayoutProperty),Vc(Le.paint,je.paint,K,Ie,null,Ln.setPaintProperty),d.bi(Le.slot,je.slot)||K.push({command:Ln.setSlot,args:[Ie,je.slot]}),d.bi(Le.filter,je.filter)||K.push({command:Ln.setFilter,args:[Ie,je.filter]}),d.bi(Le.minzoom,je.minzoom)&&d.bi(Le.maxzoom,je.maxzoom)||K.push({command:Ln.setLayerZoomRange,args:[Ie,je.minzoom,je.maxzoom]}),Le)Le.hasOwnProperty(Oe)&&"layout"!==Oe&&"paint"!==Oe&&"filter"!==Oe&&"metadata"!==Oe&&"minzoom"!==Oe&&"maxzoom"!==Oe&&"slot"!==Oe&&(0===Oe.indexOf("paint.")?Vc(Le[Oe],je[Oe],K,Ie,Oe.slice(6),Ln.setPaintProperty):d.bi(Le[Oe],je[Oe])||K.push({command:Ln.setLayerProperty,args:[Ie,Oe,je[Oe]]}));for(Oe in je)je.hasOwnProperty(Oe)&&!Le.hasOwnProperty(Oe)&&"layout"!==Oe&&"paint"!==Oe&&"filter"!==Oe&&"metadata"!==Oe&&"minzoom"!==Oe&&"maxzoom"!==Oe&&"slot"!==Oe&&(0===Oe.indexOf("paint.")?Vc(Le[Oe],je[Oe],K,Ie,Oe.slice(6),Ln.setPaintProperty):d.bi(Le[Oe],je[Oe])||K.push({command:Ln.setLayerProperty,args:[Ie,Oe,je[Oe]]}))}else K.push({command:Ln.removeLayer,args:[Ie]}),Fe=ye[ye.lastIndexOf(Ie)+1],K.push({command:Ln.addLayer,args:[je,Fe]})}(j,k.layers,O)}catch(B){console.warn("Unable to compute style diff:",B),O=[{command:Ln.setStyle,args:[k]}]}return O}(this.serialize(),s).filter(C=>!(C.command in Do));if(0===g.length)return!1;const v=g.filter(C=>!(C.command in Wl));if(v.length>0)throw new Error(`Unimplemented: ${v.map(C=>C.command).join(", ")}.`);const w=[];return g.forEach(C=>{w.push(this[C.command].apply(this,C.args))}),c&&Promise.all(w).then(c),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(s,c){return this.getImage(s)?this.fire(new d.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,this.scope,c),this._afterImageUpdated(s),this)}updateImage(s,c){this.imageManager.updateImage(s,this.scope,c)}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._afterImageUpdated(s),this):this.fire(new d.t(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(s),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new d.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(s,c,g={}){return this._checkLoaded(),this._validate(He,`models.${s}`,c,null,g)||(this.modelManager.addModel(s,c,this.scope),this._changes.setDirty()),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this):this.fire(new d.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,c,g={}){if(this._checkLoaded(),void 0!==this.getOwnSource(s))throw new Error(`There is already a source with ID "${s}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Cu,`sources.${s}`,c,null,g))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const v=yf(s,c,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const w=C=>{const k=(C?"symbol:":"other:")+v.id,O=d.av(k,this.scope),B=this._sourceCaches[k]=new wa(O,v,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=B,B.onAdd(this.map)};w(!1),"vector"!==c.type&&"geojson"!==c.type||w(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const c=this.getOwnSource(s);if(!c)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===s)return this.fire(new d.t(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new d.t(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const g=this.getOwnSourceCaches(s);for(const v of g){const w=d.cn(v.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(v.id),v.fire(new d.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,c){this._checkLoaded(),this.getOwnSource(s).setData(c),this._changes.setDirty()}getOwnSource(s){const c=this.getOwnSourceCache(s);return c&&c.getSource()}getOwnSources(){const s=[];for(const c in this._otherSourceCaches){const g=this.getOwnSourceCache(c);g&&s.push(g.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const c in s){const g=s[c]._tiles;for(const v in g){const w=g[v];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const v of s){if(this._validate(Mh,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(v),w.updateTransitions(c)}else this.ambientLight=new ti(v,fr||(fr=new d.a0({color:new d.a1(d._.properties_light_ambient.color),intensity:new d.a1(d._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(v),w.updateTransitions(c)}else this.directionalLight=new ti(v,ki||(ki=new d.a0({direction:new d.ad(d._.properties_light_directional.direction),color:new d.a1(d._.properties_light_directional.color),intensity:new d.a1(d._.properties_light_directional.intensity),"cast-shadows":new d.a1(d._.properties_light_directional["cast-shadows"]),"shadow-intensity":new d.a1(d._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const g=new d.a3(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,c=this.ambientLight;if(!s||!c)return;const g=G=>.2126*(G[0]<=.03928?G[0]/12.92:Math.pow((G[0]+.055)/1.055,2.4))+.7152*(G[1]<=.03928?G[1]/12.92:Math.pow((G[1]+.055)/1.055,2.4))+.0722*(G[2]<=.03928?G[2]/12.92:Math.pow((G[2]+.055)/1.055,2.4)),v=s.properties.get("color").toRenderColor(null).toArray01(),w=s.properties.get("intensity"),C=s.properties.get("direction"),k=1-d.c8(C.x,C.y,C.z)[2]/90,O=g(v)*w*k,B=c.properties.get("color").toRenderColor(null).toArray01(),F=c.properties.get("intensity"),j=g(B)*F;return Number(((O+j)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(!s)return this;if(d.aK(s)){const c=d.co(s),g=this.fragments.find(({id:w})=>w===c);if(!g)throw new Error(`Style import '${s}' not found`);const v=d.cn(s);return g.style.getFragmentStyle(v)}{const c=this.fragments.find(({id:g})=>g===s);if(!c)throw new Error(`Style import '${s}' not found`);return c.style}}getFeaturesetDescriptors(s){const c=this.getFragmentStyle(s);if(!c||!c.stylesheet.featuresets)return[];const g=[];for(const v in c.stylesheet.featuresets)g.push({featuresetId:v,importId:c.scope?c.scope:void 0});return g}getFeaturesetLayers(s,c){const g=this.getFragmentStyle(c),v=g.stylesheet.featuresets;if(!v||!v[s])return this.fire(new d.t(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const C of v[s].selectors){const k=g.getOwnLayer(C.layer);k&&w.push(k)}return w}getConfigProperty(s,c){const g=this.getFragmentStyle(s);if(!g)return null;const v=d.av(c,g.scope),w=g.options.get(v),C=w?w.value||w.default:null;return C?C.serialize():null}setConfigProperty(s,c,g){const v=this.getFragmentStyle(s);if(!v)return;const w=v.stylesheet.schema;if(!w||!w[c])return;const C=d.M(g);if("success"!==C.result)return void fo(this,C.value);const k=C.value.expression,O=d.av(c,v.scope),B=v.options.get(O);if(!B)return;let F;const{minValue:j,maxValue:G,stepValue:X,type:Q,values:K}=w[c],ne=d.M(w[c].default);"success"===ne.result&&(F=ne.value.expression),F?(this.options.set(O,{...B,value:k,default:F,minValue:j,maxValue:G,stepValue:X,type:Q,values:K}),this.updateConfigDependencies(c)):this.fire(new d.t(new Error(`No schema defined for the config option "${c}" in the "${s}" fragment.`)))}getConfig(s){const c=this.getFragmentStyle(s);if(!c)return null;const g=c.stylesheet.schema;if(!g)return null;const v={};for(const w in g){const C=d.av(w,c.scope),k=c.options.get(C),O=k?k.value||k.default:null;v[w]=O?O.serialize():null}return v}setConfig(s,c){const g=this.getFragmentStyle(s);g&&(g.updateConfig(c,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const c=this.getFragmentStyle(s);return c?c.stylesheet.schema:null}setSchema(s,c){const g=this.getFragmentStyle(s);g&&(g.stylesheet.schema=c,g.updateConfig(g._config,c),this.updateConfigDependencies())}updateConfig(s,c){if(this._config=s,s||c)if(c)for(const g in c){let v,w;const C=d.M(c[g].default);if("success"===C.result&&(v=C.value.expression),s&&void 0!==s[g]){const G=d.M(s[g]);"success"===G.result&&(w=G.value.expression)}const{minValue:k,maxValue:O,stepValue:B,type:F,values:j}=c[g];if(v){const G=d.av(g,this.scope);this.options.set(G,{default:v,value:w,minValue:k,maxValue:O,stepValue:B,type:F,values:j})}else this.fire(new d.t(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new d.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(s){for(const c of this._configDependentLayers){const g=this.getLayer(c);if(g){if(s&&!g.configDependencies.has(s))continue;g.possiblyEvaluateVisibility(),this._updateLayer(g)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(c=>{if(c._styleColorTheme.colorTheme){const g=c._evaluateColorThemeData(c._styleColorTheme.colorTheme);(!c._styleColorTheme.lut&&""!==g||c._styleColorTheme.lut&&g!==c._styleColorTheme.lut.data)&&c.setColorTheme(c._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(s,c,g={}){this._checkLoaded();const v=s.id;if(this._layers[v])return void this.fire(new d.t(new Error(`Layer with id "${v}" already exists on this map`)));let w;if("custom"===s.type){if(fo(this,d.cp(s)))return;w=d.cq(s,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof s.source&&(this.addSource(v,s.source),s=d.cm(s),s=d.l(s,{source:v})),this._validate(ht,`layers.${v}`,s,{arrayIndex:-1},g))return;w=d.cq(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:v}})}0!==w.configDependencies.size&&this._configDependentLayers.add(w.fqid);let C=this._order.length;if(c){const F=this._order.indexOf(c);if(-1===F)return void this.fire(new d.t(new Error(`Layer with id "${c}" does not exist on this map.`)));w.slot===this._layers[c].slot?C=F:d.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,v),this._layerOrderChanged=!0,this._layers[v]=w;const k=this.getOwnLayerSourceCache(w),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&w.canCastShadows()&&O&&(k.castsShadows=!0);const B=this._changes.getRemovedLayer(w);if(B&&w.source&&k&&"custom"!==w.type){this._changes.discardLayerRemoval(w);const F=d.av(w.source,w.scope);B.type!==w.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),k.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(s,c){this._checkLoaded();const g=this._checkLayer(s);if(!g||s===c)return;const v=this._order.indexOf(s);this._order.splice(v,1);let w=this._order.length;if(c){const C=this._order.indexOf(c);if(-1===C)return void this.fire(new d.t(new Error(`Layer with id "${c}" does not exist on this map.`)));g.slot===this._layers[c].slot?w=C:d.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const c=this._checkLayer(s);if(!c)return;c.setEventedParent(null);const g=this._order.indexOf(s);this._order.splice(g,1),delete this._layers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const v=this.getOwnLayerSourceCache(c);if(v&&v.castsShadows){let w=!1;for(const C in this._layers)if(this._layers[C].source===c.source&&this._layers[C].canCastShadows()){w=!0;break}v.castsShadows=w}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const c in this._layers)if(this._layers[c].type===s)return!0;return!1}setLayerZoomRange(s,c,g){this._checkLoaded();const v=this._checkLayer(s);v&&(v.minzoom===c&&v.maxzoom===g||(null!=c&&(v.minzoom=c),null!=g&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,c){this._checkLoaded();const g=this._checkLayer(s);g&&g.slot!==c&&(g.slot=c,this._updateLayer(g))}setFilter(s,c,g={}){this._checkLoaded();const v=this._checkLayer(s);if(v&&!d.bi(v.filter,c))return null==c?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(re,`layers.${v.id}.filter`,c,{layerType:v.type},g)||(v.filter=d.cm(c),this._updateLayer(v)))}getFilter(s){const c=this._checkLayer(s);if(c)return d.cm(c.filter)}setLayoutProperty(s,c,g,v={}){this._checkLoaded();const w=this._checkLayer(s);if(w&&!d.bi(w.getLayoutProperty(c),g)){if(null!=g&&(!v||!1!==v.validate)&&fo(w,Te.call(Va,{key:`layers.${s}.layout.${c}`,layerType:w.type,objectKey:c,value:g,styleSpec:d._,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(c,g),0!==w.configDependencies.size&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(s,c){const g=this._checkLayer(s);if(g)return g.getLayoutProperty(c)}setPaintProperty(s,c,g,v={}){this._checkLoaded();const w=this._checkLayer(s);if(!w||d.bi(w.getPaintProperty(c),g)||null!=g&&(!v||!1!==v.validate)&&fo(w,he.call(Va,{key:`layers.${s}.paint.${c}`,layerType:w.type,objectKey:c,value:g,styleSpec:d._})))return;const C=w.setPaintProperty(c,g);0!==w.configDependencies.size&&this._configDependentLayers.add(w.fqid),C&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(s,c){const g=this._checkLayer(s);if(g)return g.getPaintProperty(c)}setFeatureState(s,c){this._checkLoaded();const g=s.featureset;if(g){if("featuresetId"in g){const B=this.getFragmentStyle(g.importId),F=B.getFeaturesetLayers(g.featuresetId);for(const{source:j,sourceLayer:G}of F)B.setFeatureState({id:s.id,source:j,sourceLayer:G},c)}else if("layerId"in g){const B=this.getLayer(g.layerId);this.setFeatureState({id:s.id,source:B.source,sourceLayer:B.sourceLayer},c)}return}const v=s.source,w=s.sourceLayer,C=this._checkSource(v);if(!C)return;const k=C.type;if("geojson"===k&&w)return void this.fire(new d.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===k&&!w)return void this.fire(new d.t(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===s.id&&this.fire(new d.t(new Error("The feature id parameter must be provided.")));const O=this.getOwnSourceCaches(v);for(const B of O)B.setFeatureState(w,s.id,c)}removeFeatureState(s,c){this._checkLoaded();const g=s.featureset;if(g){if("featuresetId"in g){const B=this.getFragmentStyle(g.importId),F=B.getFeaturesetLayers(g.featuresetId);for(const{source:j,sourceLayer:G}of F)B.removeFeatureState({id:s.id,source:j,sourceLayer:G},c)}else if("layerId"in g){const B=this.getLayer(g.layerId);this.removeFeatureState({id:s.id,source:B.source,sourceLayer:B.sourceLayer},c)}return}const v=s.source,w=this._checkSource(v);if(!w)return;const C=w.type,k="vector"===C?s.sourceLayer:void 0;if("vector"===C&&!k)return void this.fire(new d.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof s.id&&"number"!=typeof s.id)return void this.fire(new d.t(new Error("A feature id is required to remove its specific state property.")));const O=this.getOwnSourceCaches(v);for(const B of O)B.removeFeatureState(k,s.id,c)}getFeatureState(s){this._checkLoaded();const c=s.featureset;if(c){let C;if("featuresetId"in c){const k=this.getFragmentStyle(c.importId),O=k.getFeaturesetLayers(c.featuresetId);for(const{source:B,sourceLayer:F}of O){const j=k.getFeatureState({id:s.id,source:B,sourceLayer:F});if(j&&!C)C=j;else if(!d.bi(C,j))return void this.fire(new d.t(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s){const k=this.getLayer(c.layerId);C=this.getFeatureState({id:s.id,source:k.source,sourceLayer:k.sourceLayer})}return C}const g=s.source,v=s.sourceLayer,w=this._checkSource(g);if(w){if("vector"!==w.type||v)return void 0===s.id&&this.fire(new d.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(g)[0].getFeatureState(v,s.id);this.fire(new d.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=d.l({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return d.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),c=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return d.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>void 0!==g)}_updateFilteredLayers(s){for(const c of Object.values(this._mergedLayers))s(c)&&this._updateLayer(c)}_updateLayer(s){this._changes.updateLayer(s);const c=this.getLayerSourceCache(s),g=d.av(s.source,s.scope),v=this._changes.getUpdatedSourceCaches();s.source&&!v[g]&&c&&"raster"!==c.getSource().type&&(this._changes.updateSourceCache(g,"reload"),c.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const c=k=>this._mergedLayers[k].is3D(),g=this.order,v={},w=[];for(let k=g.length-1;k>=0;k--){const O=g[k];if(c(O)){v[O]=k;for(const B of s){const F=B[O];if(F)for(const j of F)w.push(j)}}}w.sort((k,O)=>O.intersectionZ-k.intersectionZ);const C=[];for(let k=g.length-1;k>=0;k--){const O=g[k];if(c(O))for(let B=w.length-1;B>=0;B--){const F=w[B].feature;if(F.layer&&v[F.layer.id]<k)break;C.push(F),w.pop()}else for(const B of s){const F=B[O];if(F)for(const j of F)C.push(j.feature)}}return C}queryRenderedFeatures(s,c,g){c&&!Array.isArray(c)&&c.filter&&this._validate(re,"queryRenderedFeatures.filter",c.filter,null,c);let v,w=!1;const C=new Set;if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new d.t(new Error("parameters.layers must be an Array."))),[];v=[];for(const F of c.layers){const j=this._mergedLayers[F];if(!j)return this.fire(new d.t(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];j.is3D()&&(w=!0),C.add(j.source),v.push(F)}}else w=this.has3DLayers();const k=this._queryRenderedFeatures(s,g,{layerIds:v,filter:c.filter,has3DLayers:w,includedSources:C}),O=this._flattenAndSortRenderedFeatures(k),B=[];for(const F of O)d.co(F.layer.id)===this.scope&&B.push(F);return B}queryRenderedFeaturesForInteractions(s,c,g){let v=[];for(const{featureset:O,filter:B,radius:F}of c){let j=!1;const G=[],X=new Set;if("featuresetId"in O){const K=this.getFeaturesetLayers(O.featuresetId,O.importId);if(0===K.length)continue;for(const ne of K)ne.is3D()&&(j=!0),X.add(ne.source),G.push(ne.fqid)}else if("layerId"in O){const K=this._mergedLayers[O.layerId];if(!K)return this.fire(new d.t(new Error(`The layer '${O.layerId}' does not exist in the map's style and cannot be queried for features.`))),[];K.is3D()&&(j=!0),X.add(K.source),G.push(O.layerId)}let Q=s;if(F)if(s instanceof d.P||"number"==typeof s[0]){const K=d.P.convert(s);Q=[[K.x-F,K.y-F],[K.x+F,K.y+F]]}else{const K=d.P.convert(s[0]),ne=d.P.convert(s[1]);Q=[[K.x-F,K.y-F],[ne.x+F,ne.y+F]]}v=v.concat(this._queryRenderedFeatures(Q,g,{layerIds:G,filter:B,has3DLayers:j,includedSources:X}))}const w=this._flattenAndSortRenderedFeatures(v),C=(O,B,F)=>{const j=O.clone();if(delete j.layer,j.featureset=B,F&&F.featureNamespace&&(j.namespace=F.featureNamespace),F&&F.properties){const G={},X=this.map.transform.zoom;for(const Q of Object.keys(F.properties)){const K=F.properties[Q].evaluate({zoom:X},O._vectorTileFeature,O.state,O.tile,this._availableImages);null!=K&&(G[Q]=K)}j.properties=G}return j},k=[];for(const O of w){const B=O.layer.id,F=d.cn(B),j=d.co(B);for(const{featureset:G}of c){if("layerId"in G&&G.layerId!==B)continue;if("layerId"in G&&G.layerId===B){const Q=C(O,G);k.push(Q);continue}if("featuresetId"in G&&(G.importId!==j||!this.getFeaturesetLayers(G.featuresetId,G.importId).map(Q=>Q.id).includes(F)))continue;const X=this._mergedLayerSelectors.get(B)||[];for(const Q of X){const K=C(O,G,Q);k.push(K)}}}return k}_queryRenderedFeatures(s,c,g){const{layerIds:v,filter:w,has3DLayers:C,includedSources:k}=g,O=[],B=Di.createFromScreenPoints(s,c);for(const F in this._mergedSourceCaches){if(!this._mergedSourceCaches[F].getSource())continue;const j=this._mergedSourceCaches[F].getSource().id;v&&!k.has(j)||O.push(vf(this._mergedSourceCaches[F],this._mergedLayers,B,w,v||[],this._availableImages,c,C,!!this.map._showQueryGeometry))}return this.placement&&O.push(function(F,j,G,X,Q,K,ne,te){const pe={},be=ne.queryRenderedSymbols(G),ye=[];for(const we of Object.keys(be).map(Number))ye.push(te[we]);ye.sort(fd);for(const we of ye){const Ee=we.featureIndex.lookupSymbolFeatures(be[we.bucketInstanceId],we.bucketIndex,we.sourceLayerIndex,X,Q,K,F);for(const Ce in Ee){const Ie=pe[Ce]=pe[Ce]||[],Le=Ee[Ce];Le.sort((je,Fe)=>{const Oe=we.featureSortOrder;if(Oe){const ct=Oe.indexOf(je.featureIndex);return Oe.indexOf(Fe.featureIndex)-ct}return Fe.featureIndex-je.featureIndex});for(const je of Le)Ie.push(je)}}for(const we in pe)pe[we].forEach(Ee=>{const Ce=Ee.feature,Ie=F[we],Le=j(Ie);if(!Le)return;const je=Le.getFeatureState(Ce.layer["source-layer"],Ce.id);Ce.state=je,d.aK(Ie.id)||(Ce.source=Ce.layer.source,Ce.layer["source-layer"]&&(Ce.sourceLayer=Ce.layer["source-layer"]))});return pe}(this._mergedLayers,this.getLayerSourceCache.bind(this),B.screenGeometry,w,v||[],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData)),O}querySourceFeatures(s,c){const g=c&&c.filter;g&&this._validate(re,"querySourceFeatures.filter",g,null,c);let v=[];const w=this.getOwnSourceCaches(s);for(const C of w)v=v.concat(Bm(C,c));return v}addSourceType(s,c,g){return Ai.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(Ai.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,c,g={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const k in s)if(!d.bi(s[k],v[k])){w=!0;break}if(!w)return;const C=this._getTransitionParameters();this.light.setLight(s,c,g),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=d.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&d.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,c=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===c&&delete this.terrain,null===s?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=s;const v=null==s.source;if(1===c){if(this.disableElevatedTerrain)return;if("object"==typeof g.source){const k="terrain-dem-src";this.addSource(k,g.source),g=d.cm(g),g=d.l(g,{source:k})}const w=d.l({},g),C={};if(this.terrain&&v){w.source=this.terrain.get().source;const k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(C.style=k.serialize())}if(this._validate(pd,"terrain",w,C))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&c!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,c),this.fire(new d.x("data",{dataType:"style"}))}else{const w=this.terrain,C=w.get();for(const k of Object.keys(d._.terrain))!g.hasOwnProperty(k)&&d._.terrain[k].default&&(g[k]=d._.terrain[k].default);for(const k in s)if(!d.bi(s[k],C[k])){w.set(s,this.options),this.stylesheet.terrain=s;const O=this._getTransitionParameters({duration:0});w.updateTransitions(O),this.fire(new d.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const c=this.fog=new ai(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!d.bi(c.get(),s)){c.set(s,this.options),this.stylesheet.fog=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}}else this._createFog(s);this._markersNeedUpdate=!0}setColorTheme(s){this._checkLoaded();const c=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=s,!s)return this._styleColorTheme.lut=null,void c();const g=this._evaluateColorThemeData(s);this._loadColorTheme(g).then(()=>{this.fire(new d.x("colorthemeset")),c()}).catch(v=>{d.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(s){return{now:d.q.now(),transition:d.l(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],c=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?s.push(g):c.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...c)}_createTerrain(s,c){const g=this.terrain=new ut(s,c,this.scope,this.options);1===c&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const s in this._layers){const c=this._layers[s];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const c=this._layers[s];"symbol"===c.type&&this._updateLayer(c)}}_validate(s,c,g,v,w={}){if(w&&!1===w.validate)return!1;const C=d.l({},this.serialize());return fo(this,s.call(Va,d.l({key:c,style:C,value:g,styleSpec:d._},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(s){const c=this.getSourceCaches(s);for(const g of c)g.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){const c=this.getSourceCaches(s);for(const g of c)g.resume(),g.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}updateSources(s){let c;this.directionalLight&&(c=Un(this.directionalLight));for(const g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(s,void 0,void 0,c)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const c=this._sourceCaches[s];c.resume(),c.reload()}}_updatePlacement(s,c,g,v,w,C,k=!1){let O=!1,B=!1;const F={},j={};for(const G of this._mergedOrder){const X=this._mergedLayers[G];if("symbol"!==X.type)continue;const Q=d.av(X.source,X.scope);let K=F[Q];if(!K){const te=this.getLayerSourceCache(X);if(!te)continue;const pe=te.getRenderableIds(!0).map(be=>te.getTileByID(be));j[Q]=pe.slice(),K=F[Q]=pe.sort((be,ye)=>ye.tileID.overscaledZ-be.tileID.overscaledZ||(be.tileID.isLessThan(ye.tileID)?-1:1))}const ne=this.crossTileSymbolIndex.addLayer(X,K,c.center.lng,c.projection);O=O||ne}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),k=k||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new d.x("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.q.now(),c.zoom))&&(this.pauseablePlacement=new Or(c,this._mergedOrder,k,g,v,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,j,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.q.now()),B=!0),O&&this.pauseablePlacement.placement.setStale()),B||O){this._buildingIndex.onNewFrame(c.zoom);for(let G=0;G<this._mergedOrder.length;G++){const X=this._mergedLayers[this._mergedOrder[G]];if("symbol"!==X.type)continue;const Q=this.isLayerClipped(X);this.placement.updateLayerOpacities(X,F[d.av(X.source,X.scope)],G,Q?C:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.q.now())}}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,c){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==g.findIndex(({id:w})=>w===s.id))return void this.fire(new d.t(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!c)return g.push(s),this._loadImports([s],!0);const v=g.findIndex(({id:w})=>w===c);return-1===v&&this.fire(new d.t(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(s).concat(g.slice(v)),this._loadImports([s],!0,c)}updateImport(s,c){this._checkLoaded();const g=this.stylesheet.imports||[],v=this.getImportIndex(s);return-1===v?this:"string"==typeof c?(this.setImportUrl(s,c),this):(c.url&&c.url!==g[v].url&&this.setImportUrl(s,c.url),d.bi(c.config,g[v].config)||this.setImportConfig(s,c.config),d.bi(c.data,g[v].data)||this.setImportData(s,c.data),this)}moveImport(s,c){this._checkLoaded();let g=this.stylesheet.imports||[];const v=this.getImportIndex(s);if(-1===v)return this;const w=this.getImportIndex(c);if(-1===w)return this;const C=g[v],k=this.fragments[v];return g=g.filter(({id:O})=>O!==s),this.fragments=this.fragments.filter(({id:O})=>O!==s),this.stylesheet.imports=g.slice(0,w).concat(C).concat(g.slice(w)),this.fragments=this.fragments.slice(0,w).concat(k).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(s,c){this._checkLoaded();const g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(-1===v)return this;g[v].url=c;const w=this.fragments[v];return w.style=this._createFragmentStyle(g[v]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(c),this}setImportData(s,c){this._checkLoaded();const g=this.getImportIndex(s),v=this.stylesheet.imports||[];return-1===g?this:c?(this.fragments[g].style.setState(c),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(s,v[g].url))}setImportConfig(s,c){this._checkLoaded();const g=this.getImportIndex(s),v=this.stylesheet.imports||[];if(-1===g)return this;c?v[g].config=c:delete v[g].config;const w=this.fragments[g],C=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=c,w.style.updateConfig(c,C),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const c=this.stylesheet.imports||[],g=this.getImportIndex(s);-1!==g&&(c.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(s){const c=(this.stylesheet.imports||[]).findIndex(g=>g.id===s);return-1===c&&this.fire(new d.t(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),c}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const c in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[c];g&&s.push(g.getSource())}return s}getSource(s,c){const g=this.getSourceCache(s,c);return g&&g.getSource()}getLayerSource(s){const c=this.getLayerSourceCache(s);return c&&c.getSource()}getSourceCache(s,c){const g=d.av(s,c);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(s){const c=d.av(s.source,s.scope);return"symbol"===s.type?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(s){if(null==s)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[s]&&c.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&c.push(this._mergedSymbolSourceCaches[s]),c}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const c in s){const g=s[c];"reload"===g?this.reloadSource(c):"clear"===g&&this.clearSource(c)}}updateLayers(s){const c=this._changes.getUpdatedPaintProperties();for(const g of c){const v=this.getLayer(g);v&&v.updateTransitions(s)}}getImages(s,c,g){this.imageManager.getImages(c.icons,c.scope,g),this._updateTilesForChangedImages();const v=w=>{w&&w.setDependencies(c.tileID.key,c.type,c.icons)};v(this._otherSourceCaches[c.source]),v(this._symbolSourceCaches[c.source])}getGlyphs(s,c,g){this.glyphManager.getGlyphs(c.stacks,c.scope,g)}getResource(s,c,g){return d.ct(c,g)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return"symbol"===s.type?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const c=[];return this._otherSourceCaches[s]&&c.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&c.push(this._symbolSourceCaches[s]),c}_isSourceCacheLoaded(s){const c=this.getOwnSourceCaches(s);return 0===c.length?(this.fire(new d.t(new Error(`There is no source with ID '${s}'`))),!1):c.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,c){if(!this._clipLayerPresent&&"fill-extrusion"!==s.type)return!1;const g="fill-extrusion"===s.type&&"building"===s.sourceLayer;if(s.is3D()){if(g||c&&"batched-model"===c.type||"model"===s.type)return!0}else if("symbol"===s.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ai.getSourceType=function(m){return Bc[m]},Ai.setSourceType=function(m,s){Bc[m]=s},Ai.registerForPluginStateChange=d.cd;var zh="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",$c="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",Vh="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Xl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Vs="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",wd="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Eu="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",ul="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Wc="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",qm="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",mo="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Cf=[];Ml(zh,Cf),Ml(Vh,Cf),Ml($c,Cf);const jh={"_prelude_fog.vertex.glsl":wd,"_prelude_terrain.vertex.glsl":Vs,"_prelude_shadow.vertex.glsl":qm,"_prelude_fog.fragment.glsl":Eu,"_prelude_shadow.fragment.glsl":mo,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":ul,"_prelude_raster_particle.glsl":Wc},gs={};vi("",Vs),vi(Eu,wd),vi(mo,qm),vi(ul,""),vi(Wc,"");const ha=vi($c,Vh),Sd=zh;var Il={background:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:vi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:vi('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:vi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:vi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:vi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:vi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:vi('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:vi("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:vi("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin float a_z_offset;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LINE_JOIN_NONE\nfloat pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin float a_z_offset;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef LINE_JOIN_NONE\nv_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:vi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:vi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:vi('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:vi('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;\n#else\nz+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n}'),terrainRaster:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:vi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:vi('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Xl),skyboxGradient:vi('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Xl),skyboxCapture:vi("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:vi('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:vi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:vi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:vi("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:vi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:vi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),occlusion:vi("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function Ml(m,s){const c=m.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let g of c)if(g=g.trim(),"#"===g[0]&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=g.split(" ");for(const w of v)s.includes(w)||s.push(w)}}function vi(m,s){const c=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let v=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(B=>{const F=B.split(" ");return F[F.length-1]}),v=[...new Set(v)]);const w={},C=[],k=[];if(m=m.replace(c,(B,F)=>(k.push(F),"")),(s=s.replace(c,(B,F)=>(C.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let O=[...Cf];Ml(m,O),Ml(s,O);for(const B of[...C,...k])jh[B]||console.error(`Undefined include: ${B}`),gs[B]||(gs[B]=[],Ml(jh[B],gs[B])),O=[...O,...gs[B]];return{fragmentSource:m=m.replace(g,(B,F,j,G,X)=>(w[X]=!0,"define"===F?`\n#ifndef HAS_UNIFORM_u_${X}\nin ${j} ${G} ${X};\n#else\nuniform ${j} ${G} u_${X};\n#endif\n`:"initialize"===F?`\n#ifdef HAS_UNIFORM_u_${X}\n    ${j} ${G} ${X} = u_${X};\n#endif\n`:"define-attribute"===F?`\n#ifdef HAS_ATTRIBUTE_a_${X}\n    in ${j} ${G} ${X};\n#endif\n`:"initialize-attribute"===F?"":void 0)),vertexSource:s=s.replace(g,(B,F,j,G,X)=>{const Q="float"===G?"vec2":G,K=X.match(/color/)?"color":Q;return"define-attribute-vertex-shader-only"===F?`\n#ifdef HAS_ATTRIBUTE_a_${X}\nin ${j} ${G} a_${X};\n#endif\n`:w[X]?"define"===F?`\n#ifndef HAS_UNIFORM_u_${X}\nuniform lowp float u_${X}_t;\nin ${j} ${Q} a_${X};\nout ${j} ${G} ${X};\n#else\nuniform ${j} ${G} u_${X};\n#endif\n`:"initialize"===F?"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${X}\n    ${X} = a_${X};\n#else\n    ${j} ${G} ${X} = u_${X};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${X}\n    ${X} = unpack_mix_${K}(a_${X}, u_${X}_t);\n#else\n    ${j} ${G} ${X} = u_${X};\n#endif\n`:"define-attribute"===F?`\n#ifdef HAS_ATTRIBUTE_a_${X}\n    in ${j} ${G} a_${X};\n    out ${j} ${G} ${X};\n#endif\n`:"initialize-attribute"===F?`\n#ifdef HAS_ATTRIBUTE_a_${X}\n    ${X} = a_${X};\n#endif\n`:void 0:"define"===F?`\n#ifndef HAS_UNIFORM_u_${X}\nuniform lowp float u_${X}_t;\nin ${j} ${Q} a_${X};\n#else\nuniform ${j} ${G} u_${X};\n#endif\n`:"define-instanced"===F?"mat4"===K?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${X}0;\nin vec4 a_${X}1;\nin vec4 a_${X}2;\nin vec4 a_${X}3;\n#else\nuniform ${j} ${G} u_${X};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${j} ${Q} a_${X};\n#else\nuniform ${j} ${G} u_${X};\n#endif\n`:"initialize-attribute-custom"===F?`\n#ifdef HAS_ATTRIBUTE_a_${X}\n    ${j} ${G} ${X} = a_${X};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${X}\n    ${j} ${G} ${X} = a_${X};\n#else\n    ${j} ${G} ${X} = u_${X};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${X}\n    ${j} ${G} ${X} = unpack_mix_${K}(a_${X}, u_${X}_t);\n#else\n    ${j} ${G} ${X} = u_${X};\n#endif\n`}),staticAttributes:v,usedDefines:O,vertexIncludes:C,fragmentIncludes:k}}class Td{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,c,g,v,w,C,k,O){this.context=s;let B=this.boundPaintVertexBuffers.length!==v.length;for(let j=0;!B&&j<v.length;j++)this.boundPaintVertexBuffers[j]!==v[j]&&(B=!0);let F=this.boundDynamicVertexBuffers.length!==k.length;for(let j=0;!F&&j<k.length;j++)this.boundDynamicVertexBuffers[j]!==k[j]&&(F=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==g||B||F||this.boundIndexBuffer!==w||this.boundVertexOffset!==C)this.freshBind(c,g,v,w,C,k,O);else{s.bindVertexArrayOES.set(this.vao);for(const j of k)j&&(j.bind(),O&&j.instanceCount&&j.setVertexAttribDivisor(s.gl,c,O));w&&w.dynamicDraw&&w.bind()}}freshBind(s,c,g,v,w,C,k){const O=s.numAttributes,B=this.context,F=B.gl;this.vao&&this.destroy(),this.vao=B.gl.createVertexArray(),B.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=C,c.enableAttributes(F,s),c.bind(),c.setVertexAttribPointers(F,s,w);for(const j of g)j.enableAttributes(F,s),j.bind(),j.setVertexAttribPointers(F,s,w);for(const j of C)j&&(j.enableAttributes(F,s),j.bind(),j.setVertexAttribPointers(F,s,w),k&&j.instanceCount&&j.setVertexAttribDivisor(F,s,k));v&&v.bind(),B.currentNumAttributes=O}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Df(m,s){const c=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new d.a5(0,g/c).toLngLat().lat,new d.a5(0,(g+1)/c).toLngLat().lat]}function Ef(m,s,c,g,v,w,C){const k=m.context,O=k.gl,B=c.hillshadeFBO;if(!B)return;m.prepareDrawTile();const F=m.isTileAffectedByFog(s),j=m.getOrCreateProgram("hillshade",{overrideFog:F});k.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,B.colorAttachment.get());const G=((ne,te,pe,be)=>{const ye=pe.paint.get("hillshade-shadow-color"),we=pe.paint.get("hillshade-highlight-color"),Ee=pe.paint.get("hillshade-accent-color"),Ce=pe.paint.get("hillshade-emissive-strength");let Ie=d.bC(pe.paint.get("hillshade-illumination-direction"));if("viewport"===pe.paint.get("hillshade-illumination-anchor"))Ie-=ne.transform.angle;else if(ne.style&&ne.style.enable3dLights()&&ne.style.directionalLight){const je=ne.style.directionalLight.properties.get("direction"),Fe=d.c8(je.x,je.y,je.z);Ie=d.bC(Fe[1])}const Le=!ne.options.moving;return{u_matrix:be||ne.transform.calculateProjMatrix(te.tileID.toUnwrapped(),Le),u_image:0,u_latrange:Df(0,te.tileID),u_light:[pe.paint.get("hillshade-exaggeration"),Ie],u_shadow:ye.toRenderColor(pe.lut),u_highlight:we.toRenderColor(pe.lut),u_emissive_strength:Ce,u_accent:Ee.toRenderColor(pe.lut)}})(m,c,g,m.terrain?s.projMatrix:null);m.uploadCommonUniforms(k,j,s.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:Q,tileBoundsSegments:K}=m.getTileBoundsBuffers(c);j.draw(m,O.TRIANGLES,v,w,C,ni.disabled,G,g.id,X,Q,K)}function Uh(m,s,c){if(!s.needsDEMTextureUpload)return;const g=m.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(c.stride);const w=c.getPixels();s.demTexture?s.demTexture.update(w,{premultiply:!1}):s.demTexture=new d.T(g,w,v.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Hh(m,s,c){const g=m.context,v=g.gl;if(!s.dem)return;const w=s.dem;if(g.activeTexture.set(v.TEXTURE1),Uh(m,s,w),!s.demTexture)return;s.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const C=w.dim;g.activeTexture.set(v.TEXTURE0);let k=s.hillshadeFBO;if(!k){const G=new d.T(g,{width:C,height:C,data:null},v.RGBA8);G.bind(v.LINEAR,v.CLAMP_TO_EDGE),k=s.hillshadeFBO=g.createFramebuffer(C,C,!0,"renderbuffer"),k.colorAttachment.set(G.texture)}g.bindFramebuffer.set(k.framebuffer),g.viewport.set([0,0,C,C]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:B,tileBoundsSegments:F}=m.getMercatorTileBoundsBuffers(),j=[];m.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:j}).draw(m,v.TRIANGLES,Ut.disabled,li.disabled,Li.unblended,ni.disabled,((G,X)=>{const Q=X.stride,K=d.a6.mat4.create();return d.a6.mat4.ortho(K,0,d.ab,-d.ab,0,0,1),d.a6.mat4.translate(K,K,[0,-d.ab,0]),{u_matrix:K,u_image:1,u_dimension:[Q,Q],u_zoom:G.overscaledZ}})(s.tileID,w),c.id,O,B,F),s.needsHillshadePrepare=!1}class Ur{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class V_ extends Ur{getDefault(){return d.bA.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class tv extends Ur{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class j_ extends Ur{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class $m extends Ur{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class If extends Ur{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class nv extends Ur{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class iv extends Ur{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class rv extends Ur{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Gh extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class ov extends Ur{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class n1 extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class r1 extends Ur{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class U_ extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class qh extends Ur{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class H_ extends Ur{getDefault(){return d.bA.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class G_ extends Ur{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class q_ extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class Xc extends Ur{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class $_ extends Ur{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let xo=class extends Ur{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Cd extends Ur{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class $h extends Ur{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class W_ extends Ur{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Ta extends Ur{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Mf extends Ur{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Af extends Ur{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Dd extends Ur{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Wm extends Ur{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class Ca extends Ur{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Ed extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Xm extends Ur{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Iu extends Ur{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class Rf extends Iu{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class X_ extends Iu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class rs extends Iu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Id extends X_{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const o1=(m,s,c)=>({u_matrix:m,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:c}),Wh=(m,s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:c,u_zoom_transition:v,u_merc_center:w,u_image0:0,u_frustum_tl:C,u_frustum_tr:k,u_frustum_br:O,u_frustum_bl:B,u_globe_pos:F,u_globe_radius:j,u_viewport:G,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9),u_skirt_height:X,u_far_z_cutoff:Q});function Da(m,s){return null!=m&&null!=s&&!(!m.hasData()||!s.hasData())&&null!=m.demTexture&&null!=s.demTexture&&m.tileID.key!==s.tileID.key}const Md=new class{constructor(){this.operations={}}newMorphing(m,s,c,g,v){if(m in this.operations){const w=this.operations[m];w.to.tileID.key!==c.tileID.key&&(w.queued=c)}else this.operations[m]={startTime:g,phase:0,duration:v,from:s,to:c,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const s=this.operations[m];return{from:s.from,to:s.to,phase:s.phase}}update(m){for(const s in this.operations){const c=this.operations[s];for(c.phase=(m-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,m)){delete this.operations[s];break}}}_nextOp(m,s){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=s,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},kf={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Mu(m,s,c){if(0===s)return 0;const g=s<1&&514===c?.25/s:1;return 6*Math.pow(1.5,22-m)*Math.max(s,1)*g}function pa(m,s){const c=1<<m.z;return!s&&(0===m.x||m.x===c-1)||0===m.y||m.y===c-1}const Xh=m=>({u_matrix:m});function Au(m,s,c,g,v){if(v>0){const w=d.q.now(),C=(w-m.timeAdded)/v,k=s?(w-s.timeAdded)/v:-1,O=c.getSource(),B=g.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),F=!s||Math.abs(s.tileID.overscaledZ-B)>Math.abs(m.tileID.overscaledZ-B),j=F&&m.refreshedUponExpiration?1:d.ap(F?C:1-k,0,1);return m.refreshedUponExpiration&&C>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class Ad extends wa{constructor(s){const c={type:"raster-dem",maxzoom:s.transform.maxZoom},g=new d.ce(d.cf(),null),v=yf("mock-dem",c,g,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,c){s.state="loaded",c(null)}}class gc extends wa{constructor(s){const c=yf("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new d.ce(d.cf(),null),s.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,c,g){if(s.freezeTileCoverage)return;this.transform=s;const v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,C)=>{if(w[C.key]="",!this._tiles[C.key]){const k=new Er(C,this._source.tileSize*C.overscaleFactor(),s.tileZoom);k.state="loaded",this._tiles[C.key]=k}return w},{});for(const w in this._tiles)w in v||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(s){const c=this.proxyCachedFBO[s];if(void 0!==c){const g=Object.values(c);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Pf extends d.aA{constructor(s,c,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=c,this.projMatrix=g}}class Zh extends d.cE{constructor(s,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,w]=function(O){const B=new d.a$,F=new d.aP,j=131;B.reserve(17161),F.reserve(33800);const G=d.ab/128,X=d.ab+G/2,Q=X+G;for(let ne=-G;ne<Q;ne+=G)for(let te=-G;te<Q;te+=G){const pe=te<0||te>X||ne<0||ne>X?24575:0,be=d.ap(Math.round(te),0,d.ab),ye=d.ap(Math.round(ne),0,d.ab);B.emplaceBack(be+pe,ye)}const K=(ne,te)=>{const pe=te*j+ne;F.emplaceBack(pe+1,pe,pe+j),F.emplaceBack(pe+j,pe+j+1,pe+1)};for(let ne=1;ne<129;ne++)for(let te=1;te<129;te++)K(te,ne);return[0,129].forEach(ne=>{for(let te=0;te<130;te++)K(te,ne),K(ne,te)}),[B,F,32768]}(),C=s.context;this.gridBuffer=C.createVertexBuffer(g,d.b1.members),this.gridIndexBuffer=C.createIndexBuffer(v),this.gridSegments=d.b2.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=d.b2.simpleSegment(0,0,g.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new gc(c.map),this.orthoMatrix=d.a6.mat4.create(),d.a6.mat4.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,d.ab,0,d.ab,0,1);const k=C.gl;this._overlapStencilMode=new li({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ad(c.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,c,g){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const v=s.terrain.properties,w=0===s.terrain.drapeRenderMode,C=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=d.q.now();const k=s.terrain&&s.terrain.scope,O=v.get("source"),B=w?this._mockSourceCache:s.getSourceCache(O,k);if(!B)return void d.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=B,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=C?this.calculateExaggeration(c):v.get("exaggeration"),!c.projection.requiresDraping&&C&&0===this._exaggeration)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&d.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(c,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),c.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const c=this._previousCameraAltitude,g=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=g;const v=null!=c?g-c:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const w=s.zoom,C=this._style.terrain;if(!this._previousUpdateTimestamp)return C.getExaggeration(w);let k=w-this._previousZoom;const O=this._previousUpdateTimestamp;let B=w;null!=this._evaluationZoom&&(B=this._evaluationZoom,Math.abs(w-B)>.5&&(k=.5*(w-B+k)),k*v<0&&(B+=k)),this._evaluationZoom=B;const F=C.getExaggeration(B),j=F===C.getExaggeration(Math.max(0,B-.1));if(j&&Math.abs(F-this._exaggeration)<.01)return F;let G=Math.min(.1,.00375*(this._updateTimestamp-O));return(j||F<.1||Math.abs(k)<1e-4)&&(G=Math.min(.2,4*G)),d.aa(this._exaggeration,F,G)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&"source"===s.dataType?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):"style"===s.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(d.a5.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=c.getIds().map(O=>{const B=c.getTileByID(O).tileID;return B.projMatrix=g.calculateProjMatrix(B.toUnwrapped()),B});!function(O,B){const F=B.transform.pointCoordinate(B.transform.getCameraPoint()),j=new d.P(F.x,F.y);O.sort((G,X)=>{if(X.overscaledZ-G.overscaledZ)return X.overscaledZ-G.overscaledZ;const Q=new d.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),K=new d.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),ne=j.mult(1<<G.canonical.z);return ne.x-=.5,ne.y-=.5,ne.distSqr(Q)-ne.distSqr(K)})}(v,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},v.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const C=this._style._mergedSourceCaches;for(const O in C){const B=C[O];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,s[O],w),B.usedForTerrain))continue;const F=s[O];B.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[c.id]=v.map(O=>new Pf(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const k={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const B=this.terrainTileForTile[O.key];if(!B)continue;const F=B.tileID.key;F in k||(this._visibleDemTiles.push(B),k[F]=F)}}_assignTerrainTiles(s){this._initializing||s.forEach(c=>{if(this.terrainTileForTile[c.key])return;const g=this._findTileCoveringTileID(c,this.sourceCache);g&&(this.terrainTileForTile[c.key]=g)})}_prepareDEMTextures(){const s=this.painter.context,c=s.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],w=v.dem;!w||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(c.TEXTURE1),Uh(this.painter,v,w))}}_prepareDemTileUniforms(s,c,g,v){if(!c||null==c.demTexture)return!1;const w=s.tileID.canonical,C=Math.pow(2,c.tileID.canonical.z-w.z),k=v||"";return g[`u_dem_tl${k}`]=[w.x*C%1,w.y*C%1],g[`u_dem_scale${k}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const c=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const w=v.dem.tree.minimums[0];return w>0&&s++,g+w},0);return s?c/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,c=s.gl;s.activeTexture.set(c.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new d.cF({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(v,{premultiply:!1}):w=this._emptyDEMTexture=new d.T(s,v,c.R32F,{premultiply:!1}),w}setupElevationDraw(s,c,g){const v=this.painter.context,w=v.gl,C={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};C.u_exaggeration=this.exaggeration();let k=null,O=null,B=1;if(g&&g.morphing&&this._useVertexMorphing){const X=g.morphing.srcDemTile,Q=g.morphing.dstDemTile;B=g.morphing.phase,X&&Q&&(this._prepareDemTileUniforms(s,X,C,"_prev")&&(O=X),this._prepareDemTileUniforms(s,Q,C)&&(k=Q))}const F=X=>X&&X.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let j=null;var G;if(this.enabled?O&&k?(j=k.demTexture,v.activeTexture.set(w.TEXTURE4),O.demTexture.bind(F(O),w.CLAMP_TO_EDGE),C.u_dem_lerp=B):(k=this.terrainTileForTile[s.tileID.key],j=this._prepareDemTileUniforms(s,k,C)?k.demTexture:this.emptyDEMTexture):j=this.emptyDEMTexture,v.activeTexture.set(w.TEXTURE2),j&&(C.u_dem_size=1===(G=j).size[0]?1:G.size[0]-2,j.bind(F(k),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,c,C),g&&g.useMeterToDem&&k){const X=(1<<k.tileID.canonical.z)*d.bE(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=X}if(g&&g.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),c.setTerrainUniformValues(v,C),"globe"===this.painter.transform.projection.name){const X=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);c.setGlobeUniformValues(v,X)}}globeUniformValues(s,c,g){const v=s.projection;return{u_tile_tl_up:v.upVector(c,0,0),u_tile_tr_up:v.upVector(c,d.ab,0),u_tile_br_up:v.upVector(c,d.ab,d.ab),u_tile_bl_up:v.upVector(c,0,d.ab),u_tile_up_scale:g?d.cG(1):v.upVectorScale(c,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const c=this.painter,g=this.painter.context;0!==s.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,w,C,k,O){if("globe"===v.transform.projection.name)!function(B,F,j,G,X){const Q=B.context,K=Q.gl;let ne,te;const pe=B.transform,be=d.cx(B,Q,pe),ye=(ct,_t)=>{if(te===_t)return;const Ft=[kf[_t],"PROJECTION_GLOBE_VIEW"];be&&Ft.push("CUSTOM_ANTIALIASING");const Yt=B.isTileAffectedByFog(ct);ne=B.getOrCreateProgram("globeRaster",{defines:Ft,overrideFog:Yt}),te=_t},we=B.colorModeForRenderPass(),Ee=new Ut(K.LEQUAL,Ut.ReadWrite,B.depthRangeFor3D);Md.update(X);const Ce=d.cy(pe),Ie=[d.am(pe.center.lng),d.at(pe.center.lat)],Le=B.globeSharedBuffers,je=[pe.width*d.q.devicePixelRatio,pe.height*d.q.devicePixelRatio],Fe=Float32Array.from(pe.globeMatrix),Oe={useDenormalizedUpVectorScale:!0};{const ct=B.transform,_t=Mu(ct.zoom,F.exaggeration(),F.sourceCache._source.tileSize);te=-1;const Ft=K.TRIANGLES;for(const Yt of G){const nn=j.getTile(Yt),Ke=li.disabled,At=F.prevTerrainTileForTile[Yt.key],ft=F.terrainTileForTile[Yt.key];Da(At,ft)&&Md.newMorphing(Yt.key,At,ft,X,250),Q.activeTexture.set(K.TEXTURE0),nn.texture&&nn.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const Rt=Md.getMorphValuesForProxy(Yt.key),Vt=Rt?1:0;Rt&&d.C(Oe,{morphing:{srcDemTile:Rt.from,dstDemTile:Rt.to,phase:d.cw(Rt.phase)}});const It=d.cz(Yt.canonical),sn=d.cA(It.getCenter().lat),An=d.cB(Yt.canonical,It,sn,ct.worldSize/ct._pixelsPerMercatorPixel),Nn=d.b6(d.cC(Yt.canonical)),wn=Wh(ct.expandedFarZProjMatrix,Fe,Ce,Nn,d.a9(ct.zoom),Ie,ct.frustumCorners.TL,ct.frustumCorners.TR,ct.frustumCorners.BR,ct.frustumCorners.BL,ct.globeCenterInViewSpace,ct.globeRadius,je,_t,ct._farZ,An);if(ye(Yt,Vt),ne&&(F.setupElevationDraw(nn,ne,Oe),B.uploadCommonUniforms(Q,ne,Yt.toUnwrapped()),Le)){const[Bn,rn,Hn]=Le.getGridBuffers(sn,0!==_t);ne.draw(B,Ft,Ee,Ke,we,ni.backCCW,wn,"globe_raster",Bn,rn,Hn)}}}if(Le&&(B.renderDefaultNorthPole||B.renderDefaultSouthPole)){const ct=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];be&&ct.push("CUSTOM_ANTIALIASING"),ne=B.getOrCreateProgram("globeRaster",{defines:ct});for(const _t of G){const{x:Ft,y:Yt,z:nn}=_t.canonical,Ke=0===Yt,At=Yt===(1<<nn)-1,[ft,Rt,Vt,It]=Le.getPoleBuffers(nn,!1);if(It&&(Ke||At)){const sn=j.getTile(_t);Q.activeTexture.set(K.TEXTURE0),sn.texture&&sn.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let An=d.cD(nn,Ft,pe);const Nn=d.b6(d.cC(_t.canonical)),wn=(Bn,rn)=>Bn.draw(B,K.TRIANGLES,Ee,li.disabled,we,ni.disabled,Wh(pe.expandedFarZProjMatrix,An,An,Nn,0,Ie,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,je,0,pe._farZ),"globe_pole_raster",rn,Vt,It);F.setupElevationDraw(sn,ne,Oe),B.uploadCommonUniforms(Q,ne,_t.toUnwrapped()),Ke&&B.renderDefaultNorthPole&&wn(ne,ft),At&&B.renderDefaultSouthPole&&(An=d.a6.mat4.scale(d.a6.mat4.create(),An,[1,-1,1]),wn(ne,Rt))}}}}(v,w,C,k,O);else{const B=v.context,F=B.gl;let j,G;const X=v.shadowRenderer,Q=Ga(v,v.longestCutoffRange),K=we=>{if(G===we)return;const Ee=[];Ee.push(kf[we]),Q.shouldRenderCutoff&&Ee.push("RENDER_CUTOFF"),X&&(Ee.push("RENDER_SHADOWS","DEPTH_TEXTURE"),X.useNormalOffset&&Ee.push("NORMAL_OFFSET")),j=v.getOrCreateProgram("terrainRaster",{defines:Ee}),G=we},ne=v.colorModeForRenderPass(),te=new Ut(F.LEQUAL,Ut.ReadWrite,v.depthRangeFor3D);Md.update(O);const pe=v.transform,be=Mu(pe.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let ye=[0,0,0];if(X){const we=v.style.directionalLight,Ee=v.style.ambientLight;we&&Ee&&(ye=Yi(v.style,we,Ee))}{G=-1;const we=F.TRIANGLES,[Ee,Ce]=[w.gridIndexBuffer,w.gridSegments];for(const Ie of k){const Le=C.getTile(Ie),je=li.disabled,Fe=w.prevTerrainTileForTile[Ie.key],Oe=w.terrainTileForTile[Ie.key];Da(Fe,Oe)&&Md.newMorphing(Ie.key,Fe,Oe,O,250),B.activeTexture.set(F.TEXTURE0),Le.texture&&Le.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const ct=Md.getMorphValuesForProxy(Ie.key),_t=ct?1:0;let Ft;ct&&(Ft={morphing:{srcDemTile:ct.from,dstDemTile:ct.to,phase:d.cw(ct.phase)}});const Yt=o1(Ie.projMatrix,pa(Ie.canonical,pe.renderWorldCopies)?be/10:be,ye);if(K(_t),!j)continue;w.setupElevationDraw(Le,j,Ft);const nn=Ie.toUnwrapped();X&&X.setupShadows(nn,j),v.uploadCommonUniforms(B,j,nn,null,Q),j.draw(v,we,te,je,ne,ni.backCCW,Yt,"terrain_raster",w.gridBuffer,Ee,Ce)}}}}(c,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(0===this._drapedRenderBatches.length)return s+1;this.renderingToTexture=!0;const c=this.painter,g=this.painter.context,v=this.proxySourceCache,w=this.proxiedCoords[v.id],C=this._drapedRenderBatches.shift(),k=c.style.order,O=[];let B=0;for(const F of w){const j=v.getTileByID(F.proxyTileKey),G=v.proxyCachedFBO[F.key]?v.proxyCachedFBO[F.key][s]:void 0,X=void 0!==G?v.renderCache[G]:this.pool[B++],Q=void 0!==G;if(j.texture=X.tex,Q&&!X.dirty){O.push(j.tileID);continue}let K;g.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(g.clear({color:d.bA.transparent,stencil:0}),X.dirty=!1);for(let ne=C.start;ne<=C.end;++ne){const te=c.style._mergedLayers[k[ne]];if(te.isHidden(c.transform.zoom))continue;const pe=c.style.getLayerSourceCache(te),be=pe?this.proxyToSource[F.key][pe.id]:[F];if(!be)continue;const ye=be;g.viewport.set([0,0,X.fb.width,X.fb.height]),K!==(pe?pe.id:null)&&(this._setupStencil(X,be,te,pe),K=pe?pe.id:null),c.renderLayer(c,pe,te,ye)}if(0===this._drapedRenderBatches.length)for(const ne of this._pendingGroundEffectLayers){const te=c.style._mergedLayers[k[ne]];if(te.isHidden(c.transform.zoom))continue;const pe=c.style.getLayerSourceCache(te),be=pe?this.proxyToSource[F.key][pe.id]:[F];if(!be)continue;const ye=be;g.viewport.set([0,0,X.fb.width,X.fb.height]),K!==(pe?pe.id:null)&&(this._setupStencil(X,be,te,pe),K=pe?pe.id:null),c.renderLayer(c,pe,te,ye)}this.renderedToTile?(X.dirty=!0,O.push(j.tileID)):Q||--B,5===B&&(B=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),C.end+1}postRender(){}isLayerOrderingCorrect(s){const c=s.order.length;let g=-1,v=c;for(let w=0;w<c;++w)this._style.isLayerDraped(s._mergedLayers[s.order[w]])?g=Math.max(g,w):v=Math.min(v,w);return v>g}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{s=Math.min(s,c.dem.tree.minimums[0])}),0===s?s:(s-30)*this._exaggeration}raycast(s,c,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const C=w.tileID,k=1<<C.overscaledZ,{x:O,y:B}=C.canonical,F=O/k,j=(O+1)/k,G=B/k,X=(B+1)/k;return{minx:F,miny:G,maxx:j,maxy:X,t:w.dem.tree.raycastRoot(F,G,j,X,s,c,g),tile:w}});v.sort((w,C)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==C.t?C.t:Number.MAX_VALUE));for(const w of v){if(null==w.t)return null;const C=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,s,c,g);if(null!=C)return C}return null}_createFBO(){const s=this.painter.context,c=s.gl,g=this.drapeBufferSize;s.activeTexture.set(c.TEXTURE0);const v=new d.T(s,{width:g[0],height:g[1],data:null},c.RGBA8);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);const w=s.createFramebuffer(g[0],g[1],!0,null);return w.colorAttachment.set(v.texture),w.depthAttachment=new Id(s,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:w,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const c=this._style._mergedLayers[s],g=c.isHidden(this.painter.transform.zoom);return"hillshade"===c.type||"custom"===c.type?!g&&c.shouldRedrape():!g&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const g of this._style.getSources())if(g instanceof ps){s=!0;break}if(!s)return;const c={};for(let g=0;g<this._style.order.length;++g){const v=this._style._mergedLayers[this._style.order[g]],w=this._style.getLayerSourceCache(v);if(w&&!c[w.id]&&!v.isHidden(this.painter.transform.zoom)&&"line"===v.type&&v.widthExpression()instanceof d.a4){c[w.id]=!0;for(const C of this.proxyCoords){const k=this.proxyToSource[C.key][w.id];if(k)for(const O of k)this._clearRenderCacheForTile(w.id,O)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof ql){s=!0;break}if(!s)return;const c={};for(let g=0;g<this._style.order.length;++g){const v=this._style._mergedLayers[this._style.order[g]],w=this._style.getLayerSourceCache(v);if(!w||c[w.id]||v.isHidden(this.painter.transform.zoom)||"raster"!==v.type)continue;const C=v.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const O=this.proxyToSource[k.key][w.id];if(O)for(const B of O){const F=Au(w.getTile(B),w.findLoadedParent(B,0),w,this.painter.transform,C);(1!==F.opacity||0!==F.mix)&&this._clearRenderCacheForTile(w.id,B)}}}}_setupDrapedRenderBatches(){const s=this._style.order,c=s.length;if(0===c)return;const g=[];this._pendingGroundEffectLayers=[];let v,w=0,C=this._style._mergedLayers[s[w]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++w<c;)C=this._style._mergedLayers[s[w]];for(;w<c;++w){const k=this._style._mergedLayers[s[w]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?void 0===v&&(v=w):("fill-extrusion"===k.type&&this._pendingGroundEffectLayers.push(w),void 0!==v&&(g.push({start:v,end:w-1}),v=void 0)))}if(void 0!==v&&g.push({start:v,end:w-1}),0!==g.length){const k=g[g.length-1];this._pendingGroundEffectLayers.every(O=>O>k.end)||d.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(s){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const C=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let k=0;k<C.length;++k){const O=Object.values(C[k]);c.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let C=g.length-1;C>=0;C--){const k=g[C];if(c.getTileByID(k.key),void 0!==c.proxyCachedFBO[k.key]){const O=s[k.key],B=this.proxyToSource[k.key];let F=0;for(const j in B){const G=B[j],X=O[j];if(!X||X.length!==G.length||G.some((Q,K)=>Q!==X[K]||v[j]&&v[j].hasOwnProperty(Q.key))){F=-1;break}++F}for(const j in c.proxyCachedFBO[k.key])c.renderCache[c.proxyCachedFBO[k.key][j]].dirty=F<0||F!==Object.values(O).length}}const w=[...this._drapedRenderBatches];w.sort((C,k)=>k.end-k.start-(C.end-C.start));for(const C of w)for(const k of g){if(c.proxyCachedFBO[k.key])continue;let O=c.renderCachePool.pop();void 0===O&&c.renderCache.length<50&&(O=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==O&&(c.proxyCachedFBO[k.key]={},c.proxyCachedFBO[k.key][C.start]=O,c.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(s,c,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,C=w.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let k;if(g.isTileClipped())k=c.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):li.disabled}_renderTileClippingMasks(s,c){const g=this.painter,v=this.painter.context,w=v.gl;g._tileClippingMaskIDs={},v.setColorMode(Li.disabled),v.setDepthMode(Ut.disabled);const C=g.getOrCreateProgram("clippingMask");for(const k of s){const O=g._tileClippingMaskIDs[k.key]=--c;C.draw(g,w.TRIANGLES,Ut.disabled,new li({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),Li.disabled,ni.disabled,Xh(k.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){const c=this.painter.transform;if(s.x<0||s.x>c.width||s.y<0||s.y>c.height)return null;const g=[s.x,s.y,1,1];d.a6.vec4.transformMat4(g,g,c.pixelMatrixInverse),d.a6.vec4.scale(g,g,1/g[3]),g[0]/=c.worldSize,g[1]/=c.worldSize;const v=c._camera.position,w=d.bE(1,c.center.lat),C=[v[0],v[1],v[2]/w,0],k=d.a6.vec3.subtract([],g.slice(0,3),C);d.a6.vec3.normalize(k,k);const O=this.raycast(C,k,this._exaggeration);return null!==O&&O?(d.a6.vec3.scaleAndAdd(C,C,k,O),C[3]=C[2],C[2]*=w,C):null}_setupProxiedCoordsForOrtho(s,c,g){if(s.getSource()instanceof d.aD)return this._setupProxiedCoordsForImageSource(s,c,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const v=this.proxiedCoords[s.id]=[],w=this.proxyCoords;for(let O=0;O<w.length;O++){const B=w[O],F=this._findTileCoveringTileID(B,s);if(F){const j=this._createProxiedId(B,F,g[B.key]&&g[B.key][s.id]);v.push(j),this.proxyToSource[B.key][s.id]=[j]}}let C=!1;const k=new Set;for(let O=0;O<c.length;O++){const B=s.getTile(c[O]);if(!B||!B.hasData())continue;const F=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==B.tileID.canonical.z){const j=this.proxyToSource[F.tileID.key][s.id],G=this._createProxiedId(F.tileID,B,g[F.tileID.key]&&g[F.tileID.key][s.id]);j?j.splice(j.length-1,0,G):this.proxyToSource[F.tileID.key][s.id]=[G];const X=this.proxyToSource[F.tileID.key][s.id];k.has(X)||k.add(X),v.push(G),C=!0}}if(this._sourceTilesOverlap[s.id]=C,C&&this._debugParams.sortTilesHiZFirst)for(const O of k)O.sort((B,F)=>F.overscaledZ-B.overscaledZ)}_setupProxiedCoordsForImageSource(s,c,g){if(!s.getSource().loaded())return;const v=this.proxiedCoords[s.id]=[],w=this.proxyCoords,C=s.getSource(),k=C.tileID;if(!k)return;const O=new d.P(k.x,k.y)._div(1<<k.z),B=C.coordinates.map(d.a5.fromLngLat).reduce((j,G)=>(j.min.x=Math.min(j.min.x,G.x-O.x),j.min.y=Math.min(j.min.y,G.y-O.y),j.max.x=Math.max(j.max.x,G.x-O.x),j.max.y=Math.max(j.max.y,G.y-O.y),j),{min:new d.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(j,G)=>{const X=j.wrap+j.canonical.x/(1<<j.canonical.z),Q=j.canonical.y/(1<<j.canonical.z),K=d.ab/(1<<j.canonical.z),ne=G.wrap+G.canonical.x/(1<<G.canonical.z),te=G.canonical.y/(1<<G.canonical.z);return X+K<ne+B.min.x||X>ne+B.max.x||Q+K<te+B.min.y||Q>te+B.max.y};for(let j=0;j<w.length;j++){const G=w[j];for(let X=0;X<c.length;X++){const Q=s.getTile(c[X]);if(!Q||!Q.hasData()||F(G,Q.tileID))continue;const K=this._createProxiedId(G,Q,g[G.key]&&g[G.key][s.id]),ne=this.proxyToSource[G.key][s.id];ne?ne.push(K):this.proxyToSource[G.key][s.id]=[K],v.push(K)}}}_createProxiedId(s,c,g){let v=this.orthoMatrix;if(g){const w=g.find(C=>C.key===c.tileID.key);if(w)return w}if(c.tileID.key!==s.key){const w=s.canonical.z-c.tileID.canonical.z;let C,k,O;v=d.a6.mat4.create();const B=c.tileID.wrap-s.wrap<<s.overscaledZ;w>0?(C=d.ab>>w,k=C*((c.tileID.canonical.x<<w)-s.canonical.x+B),O=C*((c.tileID.canonical.y<<w)-s.canonical.y)):(C=d.ab<<-w,k=d.ab*(c.tileID.canonical.x-(s.canonical.x+B<<-w)),O=d.ab*(c.tileID.canonical.y-(s.canonical.y<<-w))),d.a6.mat4.ortho(v,0,C,0,C,0,1),d.a6.mat4.translate(v,v,[k,O,0])}return new Pf(c.tileID,s.key,v)}_findTileCoveringTileID(s,c){let g=c.getTile(s);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[c.id],w=v[s.key];if(g=w?c.getTileByID(w):null,g&&g.hasData()||null===w)return g;let C=g?g.tileID:s,k=C.overscaledZ;const O=c.getSource().minzoom,B=[];if(!w){const j=c.getSource().maxzoom;if(s.canonical.z>=j){const G=s.canonical.z-j;c.getSource().reparseOverscaled?(k=Math.max(s.canonical.z+2,c.transform.tileZoom),C=new d.aA(k,s.wrap,j,s.canonical.x>>G,s.canonical.y>>G)):0!==G&&(k=j,C=new d.aA(k,s.wrap,j,s.canonical.x>>G,s.canonical.y>>G))}C.key!==s.key&&(B.push(C.key),g=c.getTile(C))}const F=j=>{B.forEach(G=>{v[G]=j}),B.length=0};for(k-=1;k>=O&&(!g||!g.hasData());k--){g&&F(g.tileID.key);const j=C.calculateScaledKey(k);if(g=c.getTileByID(j),g&&g.hasData())break;const G=v[j];if(null===G)break;void 0===G?B.push(j):g=c.getTileByID(G)}return F(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,c){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[c.key]=!0}}function Hi(m,s,c){const g=function(k,O,B){const F=d.a6.vec3.dot(O,k),j=d.a6.vec3.dot(B,[.2126,.7152,.0722]),G=(Q,K,ne)=>(1-ne)*Q+ne*K,X=G(1-.3*Math.min(j,1),1,Math.min(F+1,1));return G(.92,1,Math.asin(d.ap(O[2],-1,1))/Math.PI+.5)*X}(m,[0,0,1],s),v=[0,0,0];d.a6.vec3.scale(v,c.slice(0,3),g);const w=[0,0,0];d.a6.vec3.scale(w,s.slice(0,3),m[2]);const C=[0,0,0];return d.a6.vec3.add(C,v,w),d.cc(C)}const Zc=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],sv=["stars","rain_particle","snow_particle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class _c{static cacheKey(s,c,g,v){let w=`${c}${v?v.cacheKey:""}`;for(const C of g)s.usedDefines.includes(C)&&(w+=`/${C}`);return w}constructor(s,c,g,v,w,C){const k=s.gl;this.program=k.createProgram(),this.configuration=v,this.name=c,this.fixedDefines=[...C];const O=v?v.getBinderAttributes():[],B=(g.staticAttributes||[]).concat(O);let F=v?v.defines():[];F=F.concat(C.map(ne=>`#define ${ne}`));const j="#version 300 es\n";let G=j+F.concat("precision mediump float;",Sd,ha.fragmentSource).join("\n");for(const ne of g.fragmentIncludes)G+=`\n${jh[ne]}`;G+=`\n${g.fragmentSource}`;let X=j+F.concat("precision highp float;",Sd,ha.vertexSource).join("\n");for(const ne of g.vertexIncludes)X+=`\n${jh[ne]}`;X+=`\n${g.vertexSource}`;const Q=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(Q,G),k.compileShader(Q),k.attachShader(this.program,Q);const K=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(K,X),k.compileShader(K),k.attachShader(this.program,K),this.attributes={},this.numAttributes=B.length;for(let ne=0;ne<this.numAttributes;ne++)if(B[ne]){const te=B[ne].startsWith("a_")?B[ne]:`a_${B[ne]}`;k.bindAttribLocation(this.program,ne,te),this.attributes[te]=ne}k.linkProgram(this.program),k.deleteShader(K),k.deleteShader(Q),this.fixedUniforms=w(s),this.binderUniforms=v?v.getUniforms(s):[],(C.includes("TERRAIN")||-1!==c.indexOf("symbol")||-1!==c.indexOf("circle"))&&(this.terrainUniforms={u_dem:new d.bK(ne=s),u_dem_prev:new d.bK(ne),u_dem_tl:new d.bH(ne),u_dem_scale:new d.bJ(ne),u_dem_tl_prev:new d.bH(ne),u_dem_scale_prev:new d.bJ(ne),u_dem_size:new d.bJ(ne),u_dem_lerp:new d.bJ(ne),u_exaggeration:new d.bJ(ne),u_depth:new d.bK(ne),u_depth_size_inv:new d.bH(ne),u_depth_range_unpack:new d.bH(ne),u_occluder_half_size:new d.bJ(ne),u_occlusion_depth_offset:new d.bJ(ne),u_meter_to_dem:new d.bJ(ne),u_label_plane_matrix_inv:new d.bG(ne)}),C.includes("GLOBE")&&(this.globeUniforms=(ne=>({u_tile_tl_up:new d.bI(ne),u_tile_tr_up:new d.bI(ne),u_tile_br_up:new d.bI(ne),u_tile_bl_up:new d.bI(ne),u_tile_up_scale:new d.bJ(ne)}))(s)),C.includes("FOG")&&(this.fogUniforms=(ne=>({u_fog_matrix:new d.bG(ne),u_fog_range:new d.bH(ne),u_fog_color:new d.c7(ne),u_fog_horizon_blend:new d.bJ(ne),u_fog_vertical_limit:new d.bH(ne),u_fog_temporal_offset:new d.bJ(ne),u_frustum_tl:new d.bI(ne),u_frustum_tr:new d.bI(ne),u_frustum_br:new d.bI(ne),u_frustum_bl:new d.bI(ne),u_globe_pos:new d.bI(ne),u_globe_radius:new d.bJ(ne),u_globe_transition:new d.bJ(ne),u_is_globe:new d.bK(ne),u_viewport:new d.bH(ne)}))(s)),C.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ne=>({u_cutoff_params:new d.c7(ne)}))(s)),C.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ne=>({u_lighting_ambient_color:new d.bI(ne),u_lighting_directional_dir:new d.bI(ne),u_lighting_directional_color:new d.bI(ne),u_ground_radiance:new d.bI(ne)}))(s)),C.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ne=>({u_light_matrix_0:new d.bG(ne),u_light_matrix_1:new d.bG(ne),u_fade_range:new d.bH(ne),u_shadow_normal_offset:new d.bI(ne),u_shadow_intensity:new d.bJ(ne),u_shadow_texel_size:new d.bJ(ne),u_shadow_map_resolution:new d.bJ(ne),u_shadow_direction:new d.bI(ne),u_shadow_bias:new d.bI(ne),u_shadowmap_0:new d.bK(ne),u_shadowmap_1:new d.bK(ne)}))(s))}var ne}setTerrainUniformValues(s,c){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)g[v]&&g[v].set(this.program,v,c[v])}}setGlobeUniformValues(s,c){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)g[v]&&g[v].set(this.program,v,c[v])}}setFogUniformValues(s,c){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}}setCutoffUniformValues(s,c){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}}setLightsUniformValues(s,c){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}}setShadowUniformValues(s,c){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;s.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}_drawDebugWireframe(s,c,g,v,w,C,k,O,B,F){const j=s.options.wireframe;if(!1===j.terrain&&!1===j.layers2D&&!1===j.layers3D)return;const G=s.context;if(!(()=>!(!j.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!j.layers2D||s._terrain&&s._terrain.renderingToTexture||!Zc.includes(this.name))||!(!j.layers3D||!sv.includes(this.name)))())return;const X=G.gl,Q=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,w,G);if(!Q)return;const K=[...this.fixedDefines];K.push("DEBUG_WIREFRAME");const ne=s.getOrCreateProgram(this.name,{config:this.configuration,defines:K});G.program.set(ne.program);const te=(ye,we,Ee)=>{if(we[ye]&&Ee[ye])for(const Ce in we[ye])Ee[ye][Ce]&&Ee[ye][Ce].set(Ee.program,Ce,we[ye][Ce].current)};B&&B.setUniforms(ne.program,G,ne.binderUniforms,k,{zoom:O}),te("fixedUniforms",this,ne),te("terrainUniforms",this,ne),te("globeUniforms",this,ne),te("fogUniforms",this,ne),te("lightsUniforms",this,ne),te("shadowUniforms",this,ne),Q.bind(),G.setColorMode(new Li([X.ONE,X.ONE_MINUS_SRC_ALPHA,X.ZERO,X.ONE],d.bA.transparent,[!0,!0,!0,!1])),G.setDepthMode(new Ut(c.func===X.LESS?X.LEQUAL:c.func,Ut.ReadOnly,c.range)),G.setStencilMode(li.disabled);const pe=3*C.primitiveLength*2,be=3*C.primitiveOffset*2*2;F&&F>1?X.drawElementsInstanced(X.LINES,pe,X.UNSIGNED_SHORT,be,F):X.drawElements(X.LINES,pe,X.UNSIGNED_SHORT,be),w.bind(),G.program.set(this.program),G.setDepthMode(c),G.setStencilMode(g),G.setColorMode(v)}checkUniforms(s,c,g){if(this.fixedDefines.includes(c))for(const v of Object.keys(g))if(!g[v].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${v} not set but required by ${c} being defined`)}draw(s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K,ne){const te=s.context,pe=te.gl;if(this.failedToCreate)return;te.program.set(this.program),te.setDepthMode(g),te.setStencilMode(v),te.setColorMode(w),te.setCullFace(C);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,k[we]);Q&&Q.setUniforms(this.program,te,this.binderUniforms,G,{zoom:X});const be={[pe.POINTS]:1,[pe.LINES]:2,[pe.TRIANGLES]:3,[pe.LINE_STRIP]:1}[c];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const ye=ne&&ne>0?1:void 0;for(const we of j.get()){const Ee=we.vaos||(we.vaos={});(Ee[O]||(Ee[O]=new Td)).bind(te,this,B,Q?Q.getPaintVertexBuffers():[],F,we.vertexOffset,K||[],ye),ne&&ne>1?pe.drawElementsInstanced(c,we.primitiveLength*be,pe.UNSIGNED_SHORT,we.primitiveOffset*be*2,ne):F?pe.drawElements(c,we.primitiveLength*be,pe.UNSIGNED_SHORT,we.primitiveOffset*be*2):pe.drawArrays(c,we.vertexOffset,we.vertexLength),c===pe.TRIANGLES&&F&&this._drawDebugWireframe(s,g,v,w,F,we,G,X,Q,ne)}}}function Lf(m,s){const c=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,m.transform.tileZoom)/c,v=g*(s.tileID.canonical.x+s.tileID.wrap*c),w=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/d.ak(s,1,m.transform.tileZoom),u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const Ru={terrain:0,flat:1},Zm=d.a6.mat4.create(),Ym=(m,s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K,ne,te)=>{const pe=s.style.light,be=pe.properties.get("position"),ye=[be.x,be.y,be.z],we=d.a6.mat3.create();"viewport"===pe.properties.get("anchor")&&(d.a6.mat3.fromRotation(we,-s.transform.angle),d.a6.vec3.transformMat3(ye,ye,we));const Ee=pe.properties.get("color"),Ce=s.transform,Ie={u_matrix:m,u_lightpos:ye,u_lightintensity:pe.properties.get("intensity"),u_lightcolor:[Ee.r,Ee.g,Ee.b],u_vertical_gradient:+c,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Ru[B],u_base_type:Ru[F],u_ao:v,u_edge_radius:w,u_width_scale:C,u_flood_light_color:Q,u_vertical_scale:K,u_flood_light_intensity:ne,u_ground_shadow_factor:te};return"globe"===Ce.projection.name&&(Ie.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],Ie.u_zoom_transition=j,Ie.u_inv_rot_matrix=X,Ie.u_merc_center=G,Ie.u_up_dir=Ce.projection.upVector(new d.bQ(0,0,0),G[0]*d.ab,G[1]*d.ab),Ie.u_height_lift=O),Ie},Km=(m,s,c,g,v,w)=>({u_matrix:m,u_edge_radius:s,u_width_scale:c,u_vertical_scale:g,u_height_type:Ru[v],u_base_type:Ru[w]}),mn=(m,s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K,ne)=>{const te=Ym(m,s,c,g,v,w,C,k,B,F,j,G,X,Q,K,ne,1,[0,0,0]),pe={u_height_factor:-Math.pow(2,k.overscaledZ)/O.tileSize/8};return d.l(te,Lf(s,O),pe)},Fr=(m,s)=>({u_matrix:m,u_emissive_strength:s}),di=(m,s,c,g)=>d.l(Fr(m,s),Lf(c,g)),oi=(m,s,c)=>({u_matrix:m,u_world:c,u_emissive_strength:s}),_s=(m,s,c,g,v)=>d.l(di(m,s,c,g),{u_world:v}),Z_=(m,s,c,g)=>{const v=d.ab/c.tileSize;return{u_matrix:m,u_camera_to_center_distance:s.getCameraToCenterDistance(g),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},ku=(m,s,c=1)=>({u_matrix:m,u_color:s.toRenderColor(null),u_overlay:0,u_overlay_scale:c}),Zl=d.a6.mat4.create(),Yh=(m,s,c,g,v,w,C)=>{const k=m.transform,O="globe"===k.projection.name,B=O?d.cI(k.zoom,s.canonical)*k._pixelsPerMercatorPixel:d.ak(c,1,w),F={u_matrix:s.projMatrix,u_extrude_scale:B,u_intensity:C,u_inv_rot_matrix:Zl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){F.u_inv_rot_matrix=g,F.u_merc_center=v,F.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],F.u_zoom_transition=d.a9(k.zoom);const j=v[0]*d.ab,G=v[1]*d.ab;F.u_up_dir=k.projection.upVector(new d.bQ(0,0,0),j,G)}return F};function Rd(m,[s,c,g,v],[w,C]){if(w===C)return[0,0,0,0];const k=255*(m-1)/(m*(C-w));return[s*k,c*k,g*k,v*k]}function Kh(m,s,[c,g]){return c===g?0:.5/m+(s-c)*(m-1)/(m*(g-c))}const Of=(m,s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K,ne,te,pe,be,ye)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:B,u_fade_t:F.mix,u_opacity:F.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:d.cJ(j.paint.get("raster-saturation")),u_contrast_factor:d.cK(j.paint.get("raster-contrast")),u_spin_weights:Ff(j.paint.get("raster-hue-rotate")),u_perspective_transform:G,u_raster_elevation:X,u_zoom_transition:C,u_merc_center:k,u_cutoff_params:O,u_colorization_mix:Rd(d.cL,K,te),u_colorization_offset:Kh(d.cL,ne,te),u_color_ramp:Q,u_texture_offset:[be/(pe+2*be),pe/(pe+2*be)],u_texture_res:[pe+2*be,pe+2*be],u_emissive_strength:ye});function Ff(m){m*=Math.PI/180;const s=Math.sin(m),c=Math.cos(m);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const Yc=.05,Es=(m,s,c,g,v,w,C,k,O,B,F,j)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:B,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:j,u_zoom_transition:C,u_merc_center:k,u_cutoff_params:O}),dl=(m,s,c,g,v,w,C,k,O,B)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_tile_offset:c,u_velocity:g,u_color_ramp:w,u_velocity_res:v,u_max_speed:C,u_uv_offset:k,u_data_scale:[255*O[0],255*O[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[Yc,Yc]}),Nf=(m,s,c,g,v,w,C,k,O,B)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_velocity:c,u_velocity_res:g,u_max_speed:v,u_speed_factor:w,u_reset_rate:C,u_rand_seed:Math.random(),u_uv_offset:k,u_data_scale:[255*O[0],255*O[1]],u_data_offset:B,u_particle_pos_scale:1.1,u_particle_pos_offset:[Yc,Yc]}),Kc=d.a6.mat4.create(),Yl=(m,s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K,ne,te,pe,be,ye,we)=>{const Ee=v.transform,Ce={u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Ee.getCameraToCenterDistance(pe),u_rotate_symbol:+c,u_aspect_ratio:Ee.width/Ee.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:C,u_coord_matrix:k,u_is_text:+B,u_elevation_from_sea:O?1:0,u_pitch_with_map:+g,u_texsize:F,u_texsize_icon:j,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Kc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Kc,u_up_vector:[0,-1,0],u_color_adj_mat:be,u_icon_transition:ye||0,u_gamma_scale:g?v.transform.getCameraToCenterDistance(pe)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:d.q.devicePixelRatio,u_is_halo:+G,u_scale_factor:we||1};return"globe"===pe.name&&(Ce.u_tile_id=[X.canonical.x,X.canonical.y,1<<X.canonical.z],Ce.u_zoom_transition=Q,Ce.u_inv_rot_matrix=ne,Ce.u_merc_center=K,Ce.u_camera_forward=Ee._camera.forward(),Ce.u_ecef_origin=d.cM(Ee.globeMatrix,X.toUnwrapped()),Ce.u_tile_matrix=Float32Array.from(Ee.globeMatrix),Ce.u_up_vector=te),Ce},Pu=(m,s,c,g)=>({u_matrix:m,u_emissive_strength:s,u_opacity:c,u_color:g}),kd=(m,s,c,g,v,w,C,k,O)=>d.l(function(B,F,j,G,X,Q){const{width:K,height:ne}=G.imageManager.getPixelSize(F),te=Math.pow(2,Q.tileID.overscaledZ),pe=Q.tileSize*Math.pow(2,G.transform.tileZoom)/te,be=pe*(Q.tileID.canonical.x+Q.tileID.wrap*te),ye=pe*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[K,ne],u_pattern_size:j.displaySize,u_pattern_units_to_pixels:X?[G.transform.width,-1*G.transform.height]:[1/d.ak(Q,1,G.transform.tileZoom),1/d.ak(Q,1,G.transform.tileZoom)],u_pixel_coord_upper:[be>>16,ye>>16],u_pixel_coord_lower:[65535&be,65535&ye]}}(0,w,C,g,k,O),{u_matrix:m,u_emissive_strength:s,u_opacity:c}),xn=new Float32Array(d.a6.mat4.identity([])),Bf=(m,s,c,g,v,w,C,k,O,B,F,j,G,X=[0,0,0],Q)=>{const K=v.style.light,ne=K.properties.get("position"),te=[-ne.x,-ne.y,ne.z],pe=d.a6.mat3.create();"viewport"===K.properties.get("anchor")&&(d.a6.mat3.fromRotation(pe,-v.transform.angle),d.a6.vec3.transformMat3(te,te,pe));const be="MASK"===F.alphaMode,ye=K.properties.get("color").toRenderColor(null),we=G.paint.get("model-ambient-occlusion-intensity"),Ee=G.paint.get("model-color").constantOr(d.bA.white).toRenderColor(null),Ce=G.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:s,u_normal_matrix:c,u_node_matrix:g||xn,u_lightpos:te,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_camera_pos:X,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+be,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:[C.r,C.g,C.b,C.a],u_emissiveFactor:[k[0],k[1],k[2],1],u_metallicFactor:O,u_roughnessFactor:B,u_baseColorTexture:so_BaseColor,u_metallicRoughnessTexture:so_MetallicRoughness,u_normalTexture:so_Normal,u_occlusionTexture:so_Occlusion,u_emissionTexture:so_Emission,u_lutTexture:so_LUT,u_color_mix:[Ee.r,Ee.g,Ee.b,Ce],u_aoIntensity:we,u_emissive_strength:j,u_occlusionTextureTransform:Q||[0,0,0,0]}},Jh=(m,s=xn,c=xn)=>({u_matrix:m,u_instance:s,u_node_matrix:c}),bc={fillExtrusion:m=>({u_matrix:new d.bG(m),u_lightpos:new d.bI(m),u_lightintensity:new d.bJ(m),u_lightcolor:new d.bI(m),u_vertical_gradient:new d.bJ(m),u_opacity:new d.bJ(m),u_edge_radius:new d.bJ(m),u_width_scale:new d.bJ(m),u_ao:new d.bH(m),u_height_type:new d.bK(m),u_base_type:new d.bK(m),u_tile_id:new d.bI(m),u_zoom_transition:new d.bJ(m),u_inv_rot_matrix:new d.bG(m),u_merc_center:new d.bH(m),u_up_dir:new d.bI(m),u_height_lift:new d.bJ(m),u_flood_light_color:new d.bI(m),u_vertical_scale:new d.bJ(m),u_flood_light_intensity:new d.bJ(m),u_ground_shadow_factor:new d.bI(m)}),fillExtrusionDepth:m=>({u_matrix:new d.bG(m),u_edge_radius:new d.bJ(m),u_width_scale:new d.bJ(m),u_vertical_scale:new d.bJ(m),u_height_type:new d.bK(m),u_base_type:new d.bK(m)}),fillExtrusionPattern:m=>({u_matrix:new d.bG(m),u_lightpos:new d.bI(m),u_lightintensity:new d.bJ(m),u_lightcolor:new d.bI(m),u_vertical_gradient:new d.bJ(m),u_height_factor:new d.bJ(m),u_edge_radius:new d.bJ(m),u_width_scale:new d.bJ(m),u_ao:new d.bH(m),u_height_type:new d.bK(m),u_base_type:new d.bK(m),u_tile_id:new d.bI(m),u_zoom_transition:new d.bJ(m),u_inv_rot_matrix:new d.bG(m),u_merc_center:new d.bH(m),u_up_dir:new d.bI(m),u_height_lift:new d.bJ(m),u_image:new d.bK(m),u_texsize:new d.bH(m),u_pixel_coord_upper:new d.bH(m),u_pixel_coord_lower:new d.bH(m),u_tile_units_to_pixels:new d.bJ(m),u_opacity:new d.bJ(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new d.bG(m),u_opacity:new d.bJ(m),u_ao_pass:new d.bJ(m),u_meter_to_tile:new d.bJ(m),u_ao:new d.bH(m),u_flood_light_intensity:new d.bJ(m),u_flood_light_color:new d.bI(m),u_attenuation:new d.bJ(m),u_edge_radius:new d.bJ(m),u_fb:new d.bK(m),u_fb_size:new d.bJ(m),u_dynamic_offset:new d.bJ(m)}),fill:m=>({u_matrix:new d.bG(m),u_emissive_strength:new d.bJ(m)}),fillPattern:m=>({u_matrix:new d.bG(m),u_emissive_strength:new d.bJ(m),u_image:new d.bK(m),u_texsize:new d.bH(m),u_pixel_coord_upper:new d.bH(m),u_pixel_coord_lower:new d.bH(m),u_tile_units_to_pixels:new d.bJ(m)}),fillOutline:m=>({u_matrix:new d.bG(m),u_emissive_strength:new d.bJ(m),u_world:new d.bH(m)}),fillOutlinePattern:m=>({u_matrix:new d.bG(m),u_emissive_strength:new d.bJ(m),u_world:new d.bH(m),u_image:new d.bK(m),u_texsize:new d.bH(m),u_pixel_coord_upper:new d.bH(m),u_pixel_coord_lower:new d.bH(m),u_tile_units_to_pixels:new d.bJ(m)}),circle:d.cN,collisionBox:m=>({u_matrix:new d.bG(m),u_camera_to_center_distance:new d.bJ(m),u_extrude_scale:new d.bH(m)}),collisionCircle:m=>({u_matrix:new d.bG(m),u_inv_matrix:new d.bG(m),u_camera_to_center_distance:new d.bJ(m),u_viewport_size:new d.bH(m)}),debug:m=>({u_color:new d.cu(m),u_matrix:new d.bG(m),u_overlay:new d.bK(m),u_overlay_scale:new d.bJ(m)}),clippingMask:m=>({u_matrix:new d.bG(m)}),heatmap:m=>({u_extrude_scale:new d.bJ(m),u_intensity:new d.bJ(m),u_matrix:new d.bG(m),u_inv_rot_matrix:new d.bG(m),u_merc_center:new d.bH(m),u_tile_id:new d.bI(m),u_zoom_transition:new d.bJ(m),u_up_dir:new d.bI(m)}),heatmapTexture:m=>({u_image:new d.bK(m),u_color_ramp:new d.bK(m),u_opacity:new d.bJ(m)}),hillshade:m=>({u_matrix:new d.bG(m),u_image:new d.bK(m),u_latrange:new d.bH(m),u_light:new d.bH(m),u_shadow:new d.cu(m),u_highlight:new d.cu(m),u_emissive_strength:new d.bJ(m),u_accent:new d.cu(m)}),hillshadePrepare:m=>({u_matrix:new d.bG(m),u_image:new d.bK(m),u_dimension:new d.bH(m),u_zoom:new d.bJ(m)}),line:d.cO,linePattern:d.cP,raster:m=>({u_matrix:new d.bG(m),u_normalize_matrix:new d.bG(m),u_globe_matrix:new d.bG(m),u_merc_matrix:new d.bG(m),u_grid_matrix:new d.cv(m),u_tl_parent:new d.bH(m),u_scale_parent:new d.bJ(m),u_fade_t:new d.bJ(m),u_opacity:new d.bJ(m),u_image0:new d.bK(m),u_image1:new d.bK(m),u_brightness_low:new d.bJ(m),u_brightness_high:new d.bJ(m),u_saturation_factor:new d.bJ(m),u_contrast_factor:new d.bJ(m),u_spin_weights:new d.bI(m),u_perspective_transform:new d.bH(m),u_raster_elevation:new d.bJ(m),u_zoom_transition:new d.bJ(m),u_merc_center:new d.bH(m),u_cutoff_params:new d.c7(m),u_colorization_mix:new d.c7(m),u_colorization_offset:new d.bJ(m),u_color_ramp:new d.bK(m),u_texture_offset:new d.bH(m),u_texture_res:new d.bH(m),u_emissive_strength:new d.bJ(m)}),rasterParticle:m=>({u_matrix:new d.bG(m),u_normalize_matrix:new d.bG(m),u_globe_matrix:new d.bG(m),u_merc_matrix:new d.bG(m),u_grid_matrix:new d.cv(m),u_tl_parent:new d.bH(m),u_scale_parent:new d.bJ(m),u_fade_t:new d.bJ(m),u_opacity:new d.bJ(m),u_image0:new d.bK(m),u_image1:new d.bK(m),u_raster_elevation:new d.bJ(m),u_zoom_transition:new d.bJ(m),u_merc_center:new d.bH(m),u_cutoff_params:new d.c7(m)}),rasterParticleTexture:m=>({u_texture:new d.bK(m),u_opacity:new d.bJ(m)}),rasterParticleDraw:m=>({u_particle_texture:new d.bK(m),u_particle_texture_side_len:new d.bJ(m),u_tile_offset:new d.bH(m),u_velocity:new d.bK(m),u_color_ramp:new d.bK(m),u_velocity_res:new d.bH(m),u_max_speed:new d.bJ(m),u_uv_offset:new d.bH(m),u_data_scale:new d.bH(m),u_data_offset:new d.bJ(m),u_particle_pos_scale:new d.bJ(m),u_particle_pos_offset:new d.bH(m)}),rasterParticleUpdate:m=>({u_particle_texture:new d.bK(m),u_particle_texture_side_len:new d.bJ(m),u_velocity:new d.bK(m),u_velocity_res:new d.bH(m),u_max_speed:new d.bJ(m),u_speed_factor:new d.bJ(m),u_reset_rate:new d.bJ(m),u_rand_seed:new d.bJ(m),u_uv_offset:new d.bH(m),u_data_scale:new d.bH(m),u_data_offset:new d.bJ(m),u_particle_pos_scale:new d.bJ(m),u_particle_pos_offset:new d.bH(m)}),symbol:m=>({u_is_size_zoom_constant:new d.bK(m),u_is_size_feature_constant:new d.bK(m),u_size_t:new d.bJ(m),u_size:new d.bJ(m),u_camera_to_center_distance:new d.bJ(m),u_rotate_symbol:new d.bK(m),u_aspect_ratio:new d.bJ(m),u_fade_change:new d.bJ(m),u_matrix:new d.bG(m),u_label_plane_matrix:new d.bG(m),u_coord_matrix:new d.bG(m),u_is_text:new d.bK(m),u_elevation_from_sea:new d.bK(m),u_pitch_with_map:new d.bK(m),u_texsize:new d.bH(m),u_texsize_icon:new d.bH(m),u_texture:new d.bK(m),u_texture_icon:new d.bK(m),u_gamma_scale:new d.bJ(m),u_device_pixel_ratio:new d.bJ(m),u_tile_id:new d.bI(m),u_zoom_transition:new d.bJ(m),u_inv_rot_matrix:new d.bG(m),u_merc_center:new d.bH(m),u_camera_forward:new d.bI(m),u_tile_matrix:new d.bG(m),u_up_vector:new d.bI(m),u_ecef_origin:new d.bI(m),u_is_halo:new d.bK(m),u_icon_transition:new d.bJ(m),u_color_adj_mat:new d.bG(m),u_scale_factor:new d.bJ(m)}),background:m=>({u_matrix:new d.bG(m),u_emissive_strength:new d.bJ(m),u_opacity:new d.bJ(m),u_color:new d.cu(m)}),backgroundPattern:m=>({u_matrix:new d.bG(m),u_emissive_strength:new d.bJ(m),u_opacity:new d.bJ(m),u_image:new d.bK(m),u_pattern_tl:new d.bH(m),u_pattern_br:new d.bH(m),u_texsize:new d.bH(m),u_pattern_size:new d.bH(m),u_pixel_coord_upper:new d.bH(m),u_pixel_coord_lower:new d.bH(m),u_pattern_units_to_pixels:new d.bH(m)}),terrainRaster:m=>({u_matrix:new d.bG(m),u_image0:new d.bK(m),u_skirt_height:new d.bJ(m),u_ground_shadow_factor:new d.bI(m)}),skybox:m=>({u_matrix:new d.bG(m),u_sun_direction:new d.bI(m),u_cubemap:new d.bK(m),u_opacity:new d.bJ(m),u_temporal_offset:new d.bJ(m)}),skyboxGradient:m=>({u_matrix:new d.bG(m),u_color_ramp:new d.bK(m),u_center_direction:new d.bI(m),u_radius:new d.bJ(m),u_opacity:new d.bJ(m),u_temporal_offset:new d.bJ(m)}),skyboxCapture:m=>({u_matrix_3f:new d.cv(m),u_sun_direction:new d.bI(m),u_sun_intensity:new d.bJ(m),u_color_tint_r:new d.c7(m),u_color_tint_m:new d.c7(m),u_luminance:new d.bJ(m)}),globeRaster:m=>({u_proj_matrix:new d.bG(m),u_globe_matrix:new d.bG(m),u_normalize_matrix:new d.bG(m),u_merc_matrix:new d.bG(m),u_zoom_transition:new d.bJ(m),u_merc_center:new d.bH(m),u_image0:new d.bK(m),u_grid_matrix:new d.cv(m),u_skirt_height:new d.bJ(m),u_far_z_cutoff:new d.bJ(m),u_frustum_tl:new d.bI(m),u_frustum_tr:new d.bI(m),u_frustum_br:new d.bI(m),u_frustum_bl:new d.bI(m),u_globe_pos:new d.bI(m),u_globe_radius:new d.bJ(m),u_viewport:new d.bH(m)}),globeAtmosphere:m=>({u_frustum_tl:new d.bI(m),u_frustum_tr:new d.bI(m),u_frustum_br:new d.bI(m),u_frustum_bl:new d.bI(m),u_horizon:new d.bJ(m),u_transition:new d.bJ(m),u_fadeout_range:new d.bJ(m),u_color:new d.c7(m),u_high_color:new d.c7(m),u_space_color:new d.c7(m),u_temporal_offset:new d.bJ(m),u_horizon_angle:new d.bJ(m)}),model:m=>({u_matrix:new d.bG(m),u_lighting_matrix:new d.bG(m),u_normal_matrix:new d.bG(m),u_node_matrix:new d.bG(m),u_lightpos:new d.bI(m),u_lightintensity:new d.bJ(m),u_lightcolor:new d.bI(m),u_camera_pos:new d.bI(m),u_opacity:new d.bJ(m),u_baseColorFactor:new d.c7(m),u_emissiveFactor:new d.c7(m),u_metallicFactor:new d.bJ(m),u_roughnessFactor:new d.bJ(m),u_baseTextureIsAlpha:new d.bK(m),u_alphaMask:new d.bK(m),u_alphaCutoff:new d.bJ(m),u_baseColorTexture:new d.bK(m),u_metallicRoughnessTexture:new d.bK(m),u_normalTexture:new d.bK(m),u_occlusionTexture:new d.bK(m),u_emissionTexture:new d.bK(m),u_lutTexture:new d.bK(m),u_color_mix:new d.c7(m),u_aoIntensity:new d.bJ(m),u_emissive_strength:new d.bJ(m),u_occlusionTextureTransform:new d.c7(m)}),modelDepth:m=>({u_matrix:new d.bG(m),u_instance:new d.bG(m),u_node_matrix:new d.bG(m)}),groundShadow:m=>({u_matrix:new d.bG(m),u_ground_shadow_factor:new d.bI(m)}),stars:m=>({u_matrix:new d.bG(m),u_up:new d.bI(m),u_right:new d.bI(m),u_intensity_multiplier:new d.bJ(m)}),snowParticle:m=>({u_modelview:new d.bG(m),u_projection:new d.bG(m),u_time:new d.bJ(m),u_cam_pos:new d.bI(m),u_velocityConeAperture:new d.bJ(m),u_velocity:new d.bJ(m),u_horizontalOscillationRadius:new d.bJ(m),u_horizontalOscillationRate:new d.bJ(m),u_boxSize:new d.bJ(m),u_billboardSize:new d.bJ(m),u_simpleShapeParameters:new d.bH(m),u_screenSize:new d.bH(m),u_thinningCenterPos:new d.bH(m),u_thinningShape:new d.bI(m),u_thinningAffectedRatio:new d.bJ(m),u_thinningParticleOffset:new d.bJ(m),u_particleColor:new d.c7(m),u_direction:new d.bI(m)}),rainParticle:m=>({u_modelview:new d.bG(m),u_projection:new d.bG(m),u_time:new d.bJ(m),u_cam_pos:new d.bI(m),u_texScreen:new d.bK(m),u_velocityConeAperture:new d.bJ(m),u_velocity:new d.bJ(m),u_boxSize:new d.bJ(m),u_rainDropletSize:new d.bH(m),u_distortionStrength:new d.bJ(m),u_rainDirection:new d.bI(m),u_color:new d.c7(m),u_screenSize:new d.bH(m),u_thinningCenterPos:new d.bH(m),u_thinningShape:new d.bI(m),u_thinningAffectedRatio:new d.bJ(m),u_thinningParticleOffset:new d.bJ(m),u_shapeDirectionalPower:new d.bJ(m),u_mode:new d.bJ(m)}),occlusion:m=>({u_matrix:new d.bG(m),u_anchorPos:new d.bI(m),u_screenSizePx:new d.bH(m),u_occluderSizePx:new d.bH(m),u_color:new d.c7(m)})};let yc=(()=>{class m{constructor(c,g,v,w){this.id=m.uniqueIdxCounter,m.uniqueIdxCounter++,this.context=c;const C=c.gl;this.buffer=C.createBuffer(),this.dynamicDraw=Boolean(v),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||w||g.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){this.id=m.uniqueIdxCounter,m.uniqueIdxCounter++;const g=this.context.gl;this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return m.uniqueIdxCounter=0,m})();const Pn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Jm{constructor(s,c,g,v,w,C){this.length=c.length,this.attributes=g,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.instanceCount=C,this.context=s;const k=s.gl;this.buffer=k.createBuffer(),s.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||w||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let g=0;g<this.attributes.length;g++){const v=c.attributes[this.attributes[g].name];void 0!==v&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,c,g){for(let v=0;v<this.attributes.length;v++){const w=this.attributes[v],C=c.attributes[w.name];void 0!==C&&s.vertexAttribPointer(C,w.components,s[Pn[w.type]],!1,this.itemSize,w.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(s,c,g){for(let v=0;v<this.attributes.length;v++){const w=c.attributes[this.attributes[v].name];void 0!==w&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(w,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Qm{constructor(s,c,g,v,w){this.context=s,this.width=c,this.height=g;const C=this.framebuffer=s.gl.createFramebuffer();v&&(this.colorAttachment=new Rf(s,C)),w&&(this.depthAttachmentType=w,this.depthAttachment="renderbuffer"===w?new X_(s,C):new rs(s,C))}destroy(){const s=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&s.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const c=this.depthAttachment.get();c&&s.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&s.deleteTexture(c)}s.deleteFramebuffer(this.framebuffer)}}class eg{constructor(s,c){this.gl=s,this.clearColor=new V_(this),this.clearDepth=new tv(this),this.clearStencil=new j_(this),this.colorMask=new $m(this),this.depthMask=new If(this),this.stencilMask=new nv(this),this.stencilFunc=new iv(this),this.stencilOp=new rv(this),this.stencilTest=new Gh(this),this.depthRange=new ov(this),this.depthTest=new n1(this),this.depthFunc=new r1(this),this.blend=new U_(this),this.blendFunc=new qh(this),this.blendColor=new H_(this),this.blendEquation=new G_(this),this.cullFace=new q_(this),this.cullFaceSide=new Xc(this),this.frontFace=new $_(this),this.program=new xo(this),this.activeTexture=new Cd(this),this.viewport=new $h(this),this.bindFramebuffer=new W_(this),this.bindRenderbuffer=new Ta(this),this.bindTexture=new Mf(this),this.bindVertexBuffer=new Af(this),this.bindElementBuffer=new Dd(this),this.bindVertexArrayOES=new Wm(this),this.pixelStoreUnpack=new Ca(this),this.pixelStoreUnpackPremultiplyAlpha=new Ed(this),this.pixelStoreUnpackFlipY=new Xm(this),this.options=c?{...c}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c,g){return new yc(this,s,c,g)}createVertexBuffer(s,c,g,v,w){return new Jm(this,s,c,g,v,w)}createRenderbuffer(s,c,g){const v=this.gl,w=v.createRenderbuffer();return this.bindRenderbuffer.set(w),v.renderbufferStorage(v.RENDERBUFFER,s,c,g),this.bindRenderbuffer.set(null),w}createFramebuffer(s,c,g,v){return new Qm(this,s,c,g,v)}clear({color:s,depth:c,stencil:g,colorMask:v}){const w=this.gl;let C=0;s&&(C|=w.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set(v||[!0,!0,!0,!0])),void 0!==c&&(C|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==g&&(C|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),w.clear(C)}setCullFace(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){d.bi(s.blendFunction,Li.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Lu;function zf(m,s,c,g,v,w,C){const k=m.context,O=k.gl,B=m.transform,F=m.getOrCreateProgram("collisionBox"),j=[];let G=0,X=0;for(let ye=0;ye<g.length;ye++){const we=g[ye],Ee=s.getTile(we),Ce=Ee.getBucket(c);if(!Ce)continue;const Ie=B_(we,Ce,B);let Le=Ie;0===v[0]&&0===v[1]||(Le=m.translatePosMatrix(Ie,Ee,v,w));const je=C?Ce.textCollisionBox:Ce.iconCollisionBox,Fe=Ce.collisionCircleArray;if(Fe.length>0){const Oe=d.a6.mat4.create(),ct=Le;d.a6.mat4.mul(Oe,Ce.placementInvProjMatrix,B.glCoordMatrix),d.a6.mat4.mul(Oe,Oe,Ce.placementViewportMatrix),j.push({circleArray:Fe,circleOffset:X,transform:ct,invTransform:Oe,projection:Ce.getProjection()}),G+=Fe.length/4,X=G}je&&(m.terrain&&m.terrain.setupElevationDraw(Ee,F),F.draw(m,O.LINES,Ut.disabled,li.disabled,m.colorModeForRenderPass(),ni.disabled,Z_(Le,B,Ee,Ce.getProjection()),c.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,null,B.zoom,null,[je.collisionVertexBuffer,je.collisionVertexBufferExt]))}if(!C||!j.length)return;const Q=m.getOrCreateProgram("collisionCircle"),K=new d.cQ;K.resize(4*G),K._trim();let ne=0;for(const ye of j)for(let we=0;we<ye.circleArray.length/4;we++){const Ee=4*we,Ce=ye.circleArray[Ee+0],Ie=ye.circleArray[Ee+1],Le=ye.circleArray[Ee+2],je=ye.circleArray[Ee+3];K.emplace(ne++,Ce,Ie,Le,je,0),K.emplace(ne++,Ce,Ie,Le,je,1),K.emplace(ne++,Ce,Ie,Le,je,2),K.emplace(ne++,Ce,Ie,Le,je,3)}(!Lu||Lu.length<2*G)&&(Lu=function(ye){const we=2*ye,Ee=new d.aP;Ee.resize(we),Ee._trim();for(let Ce=0;Ce<we;Ce++){const Ie=6*Ce;Ee.uint16[Ie+0]=4*Ce+0,Ee.uint16[Ie+1]=4*Ce+1,Ee.uint16[Ie+2]=4*Ce+2,Ee.uint16[Ie+3]=4*Ce+2,Ee.uint16[Ie+4]=4*Ce+3,Ee.uint16[Ie+5]=4*Ce+0}return Ee}(G));const te=k.createIndexBuffer(Lu,!0),pe=k.createVertexBuffer(K,d.cR.members,!0);for(const ye of j){const we={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(be=B).getCameraToCenterDistance(ye.projection),u_viewport_size:[be.width,be.height]};Q.draw(m,O.TRIANGLES,Ut.disabled,li.disabled,m.colorModeForRenderPass(),ni.disabled,we,c.id,pe,te,d.b2.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,B.zoom)}var be;pe.destroy(),te.destroy()}const Pd=d.a6.mat4.create();function tg(m){const s=m._camera.getWorldToCamera(m.worldSize,1),c=d.a6.mat4.multiply([],s,m.globeMatrix);d.a6.mat4.invert(c,c);const g=[0,0,0],v=[0,1,0,0];return d.a6.vec4.transformMat4(v,v,c),g[0]=v[0],g[1]=v[1],g[2]=v[2],d.a6.vec3.normalize(g,g),g}function ng({width:m,height:s,anchor:c,textOffset:g,textScale:v},w){const{horizontalAlign:C,verticalAlign:k}=d.by(c),O=-(C-.5)*m,B=-(k-.5)*s,F=d.bx(c,g);return new d.P((O/v+F[0])*w,(B/v+F[1])*w)}function ig(m,s,c,g,v,w,C,k,O,B,F){const j=m.text.placedSymbolArray,G=m.text.dynamicLayoutVertexArray,X=m.icon.dynamicLayoutVertexArray,Q={},K=m.getProjection(),ne=jc(k,K,w),te=w.elevation,pe=K.upVectorScale(k.canonical,w.center.lat,w.worldSize).metersToTile;G.clear();for(let be=0;be<j.length;be++){const ye=j.get(be),{tileAnchorX:we,tileAnchorY:Ee,numGlyphs:Ce}=ye,Ie=ye.hidden||!ye.crossTileID||m.allowVerticalPlacement&&!ye.placedOrientation?null:g[ye.crossTileID];if(Ie){let Le=0,je=0,Fe=0;if(te){const ft=te?te.getAtTileOffset(k,we,Ee):0,[Rt,Vt,It]=K.upVector(k.canonical,we,Ee);Le=ft*Rt*pe,je=ft*Vt*pe,Fe=ft*It*pe}let[Oe,ct,_t,Ft]=Ks(ye.projectedAnchorX+Le,ye.projectedAnchorY+je,ye.projectedAnchorZ+Fe,c?ne:C);const Yt=Ji(w.getCameraToCenterDistance(K),Ft);let nn=v.evaluateSizeForFeature(m.textSizeData,B,ye)*Yt/d.br;c&&(nn*=m.tilePixelRatio/O);const Ke=ng(Ie,nn);c?(({x:Oe,y:ct,z:_t}=K.projectTilePoint(we+Ke.x,Ee+Ke.y,k.canonical)),[Oe,ct,_t]=Ks(Oe+Le,ct+je,_t+Fe,C)):(s&&Ke._rotate(-w.angle),Oe+=Ke.x,ct+=Ke.y,_t=0);const At=m.allowVerticalPlacement&&ye.placedOrientation===d.bl.vertical?Math.PI/2:0;for(let ft=0;ft<Ce;ft++)d.bo(G,Oe,ct,_t,At);F&&ye.associatedIconIndex>=0&&(Q[ye.associatedIconIndex]={x:Oe,y:ct,z:_t,angle:At})}else dc(Ce,G)}if(F){X.clear();const be=m.icon.placedSymbolArray;for(let ye=0;ye<be.length;ye++){const we=be.get(ye),{numGlyphs:Ee}=we,Ce=Q[ye];if(we.hidden||!Ce)dc(Ee,X);else{const{x:Ie,y:Le,z:je,angle:Fe}=Ce;for(let Oe=0;Oe<Ee;Oe++)d.bo(X,Ie,Le,je,Fe)}}m.icon.dynamicLayoutVertexBuffer.updateData(X)}m.text.dynamicLayoutVertexBuffer.updateData(G)}function Qh(m,s,c,g,v,w,C={}){const k=c.paint.get("icon-translate"),O=c.paint.get("text-translate"),B=c.paint.get("icon-translate-anchor"),F=c.paint.get("text-translate-anchor"),j=c.layout.get("icon-rotation-alignment"),G=c.layout.get("text-rotation-alignment"),X=c.layout.get("icon-pitch-alignment"),Q=c.layout.get("text-pitch-alignment"),K=c.layout.get("icon-keep-upright"),ne=c.layout.get("text-keep-upright"),te=c.paint.get("icon-color-saturation"),pe=c.paint.get("icon-color-contrast"),be=c.paint.get("icon-color-brightness-min"),ye=c.paint.get("icon-color-brightness-max"),we="sea"===c.layout.get("symbol-elevation-reference"),Ee=m.context,Ce=Ee.gl,Ie=m.transform,Le="map"===j,je="map"===G,Fe="map"===X,Oe="map"===Q,ct=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let _t=!1;const Ft=m.depthModeForSublayer(0,Ut.ReadOnly),Yt=[d.am(Ie.center.lng),d.at(Ie.center.lat)],nn=c.layout.get("text-variable-anchor"),Ke="globe"===Ie.projection.name,At=[],ft=[0,-1,0];for(const Rt of g){const Vt=s.getTile(Rt),It=Vt.getBucket(c);if(!It||"mercator"===It.projection.name&&Ke||It.fullyClipped)continue;const sn="globe"===It.projection.name,An=sn?d.a9(Ie.zoom):0,Nn=jc(Rt,It.getProjection(),Ie),wn=Ie.calculatePixelsToTileUnitsMatrix(Vt),Bn=nn&&It.hasTextData(),rn=It.hasIconTextFit()&&Bn&&It.hasIconData(),Hn=It.getProjection().createInversionMatrix(Ie,Rt.canonical),pi=yr=>{Ie.depthOcclusionForSymbolsAndCircles&&(c.hasInitialOcclusionOpacityProperties||m.terrain)&&(yr.push("DEPTH_D24"),yr.push("DEPTH_OCCLUSION"))},Bi=()=>{const yr=Le&&"point"!==c.layout.get("symbol-placement"),Ci=[];pi(Ci);const Gr=yr||rn,Wo=c.paint.get("icon-image-cross-fade").constantOr(0);m.terrainRenderModeElevated()&&Fe&&Ci.push("PITCH_WITH_MAP_TERRAIN"),sn&&(Ci.push("PROJECTION_GLOBE_VIEW"),Gr&&Ci.push("PROJECTED_POS_ON_VIEWPORT")),Wo>0&&Ci.push("ICON_TRANSITION"),It.icon.zOffsetVertexBuffer&&Ci.push("Z_OFFSET"),0===te&&0===pe&&0===be&&1===ye||Ci.push("COLOR_ADJUSTMENT"),It.sdfIcons&&Ci.push("RENDER_SDF");const ma=It.icon.programConfigurations.get(c.id),Eo=m.getOrCreateProgram("symbol",{config:ma,defines:Ci}),Fo=Vt.imageAtlasTexture?Vt.imageAtlasTexture.size:[0,0],qi=It.iconSizeData,Vi=d.bk(qi,Ie.zoom),or=Fe||0!==Ie.pitch,Rr=Xi(Nn,Vt.tileID.canonical,Fe,Le,Ie,It.getProjection(),wn),Io=ja(Nn,Vt.tileID.canonical,Fe,Le,Ie,It.getProjection(),wn),Xr=m.translatePosMatrix(Io,Vt,k,B,!0),ds=m.translatePosMatrix(Nn,Vt,k,B),Ll=Gr?Pd:Rr,Ma=Le&&!Fe&&!yr;let Aa=ft;!Ke&&!Ie.mercatorFromTransition||Le||(Aa=tg(Ie));const Ra=sn?Aa:ft,Xa=c.getColorAdjustmentMatrix(te,pe,be,ye),ka=Yl(qi.kind,Vi,Ma,Fe,m,ds,Ll,Xr,we,!1,Fo,[0,0],!0,Rt,An,Yt,Hn,Ra,It.getProjection(),Xa,Wo),ic=Vt.imageAtlasTexture?Vt.imageAtlasTexture:null,fl=1!==c.layout.get("icon-size").constantOr(0)||It.iconsNeedLinear,er=It.sdfIcons||m.options.rotating||m.options.zooming||fl||or?Ce.LINEAR:Ce.NEAREST,$d=It.sdfIcons&&0!==c.paint.get("icon-halo-width").constantOr(1),_g=m.terrain&&Fe&&yr?d.a6.mat4.invert(d.a6.mat4.create(),Rr):Pd;if(yr&&It.icon){const ru=Ie.elevation,bp=ru?ru.getAtTileOffsetFunc(Rt,Ie.center.lat,Ie.worldSize,It.getProjection()):null,Wd=Zi(Nn,Vt.tileID.canonical,Fe,Le,Ie,It.getProjection(),wn);Lh(It,Nn,m,!1,Wd,Io,Fe,K,bp,Rt)}return{program:Eo,buffers:It.icon,uniformValues:ka,atlasTexture:ic,atlasTextureIcon:null,atlasInterpolation:er,atlasInterpolationIcon:null,isSDF:It.sdfIcons,hasHalo:$d,tile:Vt,labelPlaneMatrixInv:_g}},Sr=()=>{const yr=je&&"point"!==c.layout.get("symbol-placement"),Ci=[],Gr=yr||nn||rn;m.terrainRenderModeElevated()&&Oe&&Ci.push("PITCH_WITH_MAP_TERRAIN"),sn&&(Ci.push("PROJECTION_GLOBE_VIEW"),Gr&&Ci.push("PROJECTED_POS_ON_VIEWPORT")),It.text.zOffsetVertexBuffer&&Ci.push("Z_OFFSET"),It.iconsInText&&Ci.push("RENDER_TEXT_AND_SYMBOL"),Ci.push("RENDER_SDF"),pi(Ci);const Wo=It.text.programConfigurations.get(c.id),ma=m.getOrCreateProgram("symbol",{config:Wo,defines:Ci});let Eo,Fo=[0,0],qi=null;const Vi=It.textSizeData;It.iconsInText&&(Fo=Vt.imageAtlasTexture?Vt.imageAtlasTexture.size:[0,0],qi=Vt.imageAtlasTexture?Vt.imageAtlasTexture:null,Eo=Oe||0!==Ie.pitch||m.options.rotating||m.options.zooming||"composite"===Vi.kind||"camera"===Vi.kind?Ce.LINEAR:Ce.NEAREST);const or=Vt.glyphAtlasTexture?Vt.glyphAtlasTexture.size:[0,0],Rr=c.layout.get("text-size-scale-range"),Io=d.ap(m.scaleFactor,Rr[0],Rr[1]),Xr=d.bk(Vi,Ie.zoom,Io),ds=Xi(Nn,Vt.tileID.canonical,Oe,je,Ie,It.getProjection(),wn),Ll=ja(Nn,Vt.tileID.canonical,Oe,je,Ie,It.getProjection(),wn),Ma=m.translatePosMatrix(Ll,Vt,O,F,!0),Aa=m.translatePosMatrix(Nn,Vt,O,F),Ra=Gr?Pd:ds,Xa=je&&!Oe&&!yr;let ka=ft;!Ke&&!Ie.mercatorFromTransition||je||(ka=tg(Ie));const ic=Yl(Vi.kind,Xr,Xa,Oe,m,Aa,Ra,Ma,we,!0,or,Fo,!0,Rt,An,Yt,Hn,sn?ka:ft,It.getProjection(),null,null,Io),fl=Vt.glyphAtlasTexture?Vt.glyphAtlasTexture:null,er=Ce.LINEAR,$d=0!==c.paint.get("text-halo-width").constantOr(1),_g=m.terrain&&Oe&&yr?d.a6.mat4.invert(d.a6.mat4.create(),ds):Pd;if(yr&&It.text){const ru=Ie.elevation,bp=ru?ru.getAtTileOffsetFunc(Rt,Ie.center.lat,Ie.worldSize,It.getProjection()):null,Wd=Zi(Nn,Vt.tileID.canonical,Oe,je,Ie,It.getProjection(),wn);Lh(It,Nn,m,!0,Wd,Ll,Oe,ne,bp,Rt)}return{program:ma,buffers:It.text,uniformValues:ic,atlasTexture:fl,atlasTextureIcon:qi,atlasInterpolation:er,atlasInterpolationIcon:Eo,isSDF:!0,hasHalo:$d,tile:Vt,labelPlaneMatrixInv:_g}},Gi=It.icon.segments.get().length,Hr=It.text.segments.get().length,rr=Gi&&!C.onlyText?Bi():null,Ar=Hr&&!C.onlyIcons?Sr():null,Ei=c.paint.get("icon-opacity").constantOr(1),Tr=c.paint.get("text-opacity").constantOr(1);if(ct&&It.canOverlap){_t=!0;const yr=Ei&&!C.onlyText?It.icon.segments.get():[],Ci=Tr&&!C.onlyIcons?It.text.segments.get():[];for(const Gr of yr)At.push({segments:new d.b2([Gr]),sortKey:Gr.sortKey,state:rr});for(const Gr of Ci)At.push({segments:new d.b2([Gr]),sortKey:Gr.sortKey,state:Ar})}else C.onlyText||At.push({segments:Ei?It.icon.segments:new d.b2([]),sortKey:0,state:rr}),C.onlyIcons||At.push({segments:Tr?It.text.segments:new d.b2([]),sortKey:0,state:Ar})}_t&&At.sort((Rt,Vt)=>Rt.sortKey-Vt.sortKey);for(const Rt of At){const Vt=Rt.state;if(Vt)if(m.terrain?m.terrain.setupElevationDraw(Vt.tile,Vt.program,{useDepthForOcclusion:Ie.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Vt.labelPlaneMatrixInv}):m.setupDepthForOcclusion(Ie.depthOcclusionForSymbolsAndCircles,Vt.program),Ee.activeTexture.set(Ce.TEXTURE0),Vt.atlasTexture&&Vt.atlasTexture.bind(Vt.atlasInterpolation,Ce.CLAMP_TO_EDGE,!0),Vt.atlasTextureIcon&&(Ee.activeTexture.set(Ce.TEXTURE1),Vt.atlasTextureIcon&&Vt.atlasTextureIcon.bind(Vt.atlasInterpolationIcon,Ce.CLAMP_TO_EDGE,!0)),m.uploadCommonLightUniforms(m.context,Vt.program),Vt.hasHalo){const It=Vt.uniformValues;It.u_is_halo=1,bs(Vt.buffers,Rt.segments,c,m,Vt.program,Ft,v,w,It,2),It.u_is_halo=0}else{if(Vt.isSDF){const It=Vt.uniformValues;Vt.hasHalo&&(It.u_is_halo=1,bs(Vt.buffers,Rt.segments,c,m,Vt.program,Ft,v,w,It,1)),It.u_is_halo=0}bs(Vt.buffers,Rt.segments,c,m,Vt.program,Ft,v,w,Vt.uniformValues,1)}}}function bs(m,s,c,g,v,w,C,k,O,B){const F=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];v.draw(g,g.context.gl.TRIANGLES,w,C,k,ni.disabled,O,c.id,m.layoutVertexBuffer,m.indexBuffer,s,c.paint,g.transform.zoom,m.programConfigurations.get(c.id),F,B)}function Al(m,s,c,g,v,w,C){const k=m.context.gl,O=c.paint.get("fill-pattern"),B=c.is3D(),F=B?m.stencilModeFor3D():li.disabled,j=O&&O.constantOr(1);let G,X,Q,K,ne;C?(X=j&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=k.LINES):(X=j?"fillPattern":"fill",G=k.TRIANGLES);for(const te of g){const pe=s.getTile(te);if(j&&!pe.patternsLoaded())continue;const be=pe.getBucket(c);if(!be)continue;m.prepareDrawTile();const ye=be.programConfigurations.get(c.id),we=m.isTileAffectedByFog(te),Ee=m.getOrCreateProgram(X,{config:ye,overrideFog:we});j&&(m.context.activeTexture.set(k.TEXTURE0),pe.imageAtlasTexture&&pe.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ye.updatePaintBuffers());const Ce=O.constantOr(null);if(Ce&&pe.imageAtlas){const je=pe.imageAtlas.patternPositions[Ce.toString()];je&&ye.setConstantPatternPositions(je)}const Ie=m.translatePosMatrix(te.projMatrix,pe,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Le=c.paint.get("fill-emissive-strength");if(C){K=be.indexBuffer2,ne=be.segments2;const je=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];Q="fillOutlinePattern"===X&&j?_s(Ie,Le,m,pe,je):oi(Ie,Le,je)}else K=be.indexBuffer,ne=be.segments,Q=j?di(Ie,Le,m,pe):Fr(Ie,Le);m.uploadCommonUniforms(m.context,Ee,te.toUnwrapped()),Ee.draw(m,G,v,B?F:m.stencilModeForClipping(te),w,ni.disabled,Q,c.id,be.layoutVertexBuffer,K,ne,c.paint,m.transform.zoom,ye,void 0)}}function gr(m,s,c,g,v,w,C,k){c.resetLayerRenderingStats(m);const O=m.context,B=O.gl,F=m.transform,j=c.paint.get("fill-extrusion-pattern"),G=j.constantOr(1),X=c.paint.get("fill-extrusion-opacity"),Q=m.style.enable3dLights(),K=c.paint.get(Q&&!G?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ne=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],te=c.layout.get("fill-extrusion-edge-radius"),pe=te>0&&!c.paint.get("fill-extrusion-rounded-roof"),be=pe?0:te,ye="globe"===F.projection.name?d.c_():0,we="globe"===F.projection.name,Ee=we?d.a9(F.zoom):0,Ce=[d.am(F.center.lng),d.at(F.center.lat)],Ie=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(c.lut).toArray01().slice(0,3),Le=c.paint.get("fill-extrusion-flood-light-intensity"),je=c.paint.get("fill-extrusion-vertical-scale"),Fe=0!==c.paint.get("fill-extrusion-line-width").constantOr(1),Oe=c.paint.get("fill-extrusion-height-alignment"),ct=c.paint.get("fill-extrusion-base-alignment"),_t=Ga(m,c.paint.get("fill-extrusion-cutoff-fade-range")),Ft=[];let Yt;we&&Ft.push("PROJECTION_GLOBE_VIEW"),ne[0]>0&&Ft.push("FAUX_AO"),pe&&Ft.push("ZERO_ROOF_RADIUS"),k&&Ft.push("HAS_CENTROID"),Le>0&&Ft.push("FLOOD_LIGHT"),_t.shouldRenderCutoff&&Ft.push("RENDER_CUTOFF"),Fe&&Ft.push("RENDER_WALL_MODE");const nn="shadow"===m.renderPass,Ke=m.shadowRenderer,At=nn&&!!Ke;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let ft=[0,0,0];if(Ke){const It=m.style.directionalLight,sn=m.style.ambientLight;It&&sn&&(ft=Yi(m.style,It,sn)),nn||(Ft.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ke.useNormalOffset&&Ft.push("NORMAL_OFFSET")),Yt=Ft.concat(["SHADOWS_SINGLE_CASCADE"])}const Rt=At?"fillExtrusionDepth":G?"fillExtrusionPattern":"fillExtrusion",Vt=c.getLayerRenderingStats();for(const It of g){const sn=s.getTile(It),An=sn.getBucket(c);if(!An||An.projection.name!==F.projection.name)continue;let Nn=!1;Ke&&(Nn=0===Ke.getMaxCascadeForTile(It.toUnwrapped()));const wn=m.isTileAffectedByFog(It),Bn=An.programConfigurations.get(c.id),rn=m.getOrCreateProgram(Rt,{config:Bn,defines:Nn?Yt:Ft,overrideFog:wn});if(m.terrain&&m.terrain.setupElevationDraw(sn,rn,{useMeterToDem:!0}),!An.centroidVertexBuffer){const rr=rn.attributes.a_centroid_pos;void 0!==rr&&B.vertexAttrib2f(rr,0,0)}!nn&&Ke&&Ke.setupShadows(sn.tileID.toUnwrapped(),rn,"vector-tile",sn.tileID.overscaledZ),G&&(m.context.activeTexture.set(B.TEXTURE0),sn.imageAtlasTexture&&sn.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Bn.updatePaintBuffers());const Hn=j.constantOr(null);if(Hn&&sn.imageAtlas){const rr=sn.imageAtlas.patternPositions[Hn.toString()];rr&&Bn.setConstantPatternPositions(rr)}const pi=c.paint.get("fill-extrusion-vertical-gradient"),Bi=1/An.tileToMeter;let Sr;if(nn&&Ke){if(K_(sn.tileID,An,m))continue;const rr=Ke.calculateShadowPassMatrixFromTile(sn.tileID.toUnwrapped());Sr=Km(rr,be,Bi,je,Oe,ct)}else{const rr=m.translatePosMatrix(It.expandedProjMatrix,sn,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ar=F.projection.createInversionMatrix(F,It.canonical);Sr=G?mn(rr,m,pi,X,ne,be,Bi,It,sn,ye,Oe,ct,Ee,Ce,Ar,Ie,je):Ym(rr,m,pi,X,ne,be,Bi,It,ye,Oe,ct,Ee,Ce,Ar,Ie,je,Le,ft)}m.uploadCommonUniforms(O,rn,It.toUnwrapped(),null,_t);let Gi=An.segments;if("mercator"===F.projection.name&&!nn&&(Gi=An.getVisibleSegments(sn.tileID,m.terrain,m.transform.getFrustum(0)),!Gi.get().length))continue;if(Vt)if(nn)for(const rr of Gi.get())Vt.numRenderedVerticesInShadowPass+=rr.primitiveLength;else for(const rr of Gi.get())Vt.numRenderedVerticesInTransparentPass+=rr.primitiveLength;const Hr=[];(m.terrain||k)&&Hr.push(An.centroidVertexBuffer),we&&Hr.push(An.layoutVertexExtBuffer),Fe&&Hr.push(An.wallVertexBuffer),rn.draw(m,O.gl.TRIANGLES,v,w,C,ni.backCCW,Sr,c.id,An.layoutVertexBuffer,An.indexBuffer,Gi,c.paint,m.transform.zoom,Bn,Hr)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function Is(m,s,c,g,v,w,C,k,O,B,F,j,G,X,Q,K,ne,te,pe){const be=m.context,ye=be.gl,we=m.transform,Ee=m.transform.zoom,Ce=[],Ie=Ga(m,c.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===B?(Ce.push("CLEAR_SUBPASS"),pe&&(Ce.push("CLEAR_FROM_TEXTURE"),be.activeTexture.set(ye.TEXTURE0),pe.bind(ye.LINEAR,ye.CLAMP_TO_EDGE))):"sdf"===B&&Ce.push("SDF_SUBPASS"),ne&&Ce.push("HAS_CENTROID"),Ie.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF");const Le=c.layout.get("fill-extrusion-edge-radius"),je=(Fe,Oe,ct,_t,Ft)=>{const Yt=Oe.programConfigurations.get(c.id),nn=m.isTileAffectedByFog(Fe),Ke=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:Yt,defines:Ce,overrideFog:nn}),At={u_matrix:_t,u_opacity:F,u_ao_pass:O?1:0,u_meter_to_tile:Ft,u_ao:[j,G*Ft],u_flood_light_intensity:X,u_flood_light_color:Q,u_attenuation:K,u_edge_radius:Ee>=17?0:Le*Ft,u_fb:0,u_fb_size:pe?pe.size[0]:0,u_dynamic_offset:1},ft=[];ne&&ft.push(Oe.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(be,Ke,Fe.toUnwrapped(),null,Ie),Ke.draw(m,be.gl.TRIANGLES,v,w,C,k,At,c.id,Oe.vertexBuffer,Oe.indexBuffer,ct,c.paint,Ee,Yt,ft)};for(const Fe of g){const Oe=s.getTile(Fe),ct=Oe.getBucket(c);if(!ct||ct.projection.name!==we.projection.name||!ct.groundEffect||ct.groundEffect&&!ct.groundEffect.hasData())continue;const _t=ct.groundEffect,Ft=1/ct.tileToMeter;{const Yt=m.translatePosMatrix(Fe.projMatrix,Oe,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),nn=_t.getDefaultSegment();je(Fe,_t,nn,Yt,Ft)}if(te)for(let Yt=0;Yt<4;Yt++){const nn=d.c$[Yt](Fe),Ke=s.getTile(nn);if(!Ke)continue;const At=Ke.getBucket(c);if(!At||At.projection.name!==we.projection.name||!At.groundEffect||At.groundEffect&&!At.groundEffect.hasData())continue;const ft=At.groundEffect;let Rt,Vt;0===Yt?(Rt=[-d.ab,0,0],Vt=1):1===Yt?(Rt=[d.ab,0,0],Vt=0):2===Yt?(Rt=[0,-d.ab,0],Vt=3):(Rt=[0,d.ab,0],Vt=2);const It=ft.regionSegments[Vt];if(!It)continue;const sn=new Float32Array(16);d.a6.mat4.translate(sn,Fe.projMatrix,Rt),je(Fe,ft,It,m.translatePosMatrix(sn,Oe,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ft)}}}function Y_(m,s,c,g,v,w,C){0===g.centroidVertexArray.length&&g.createCentroidsBuffer();const k=w?w.findDEMTileFor(c):null;if(!(k&&k.dem||C))return;const O=te=>new d.P(Math.ceil((te+d.d2)*d.d3),0),B=te=>{const pe=s.getSource().minzoom,be=we=>{const Ee=s.getTileByID(we);if(Ee&&Ee.hasData())return Ee.getBucket(v)},ye=[0,-1,1];for(const we of ye){if(te.overscaledZ+we<pe)continue;const Ee=be(te.calculateScaledKey(te.overscaledZ+we));if(Ee)return Ee}},F=[0,0,0],j=(te,pe)=>(F[0]=Math.min(te.min.y,pe.min.y),F[1]=Math.max(te.max.y,pe.max.y),F[2]=d.ab-pe.min.x>te.max.x?pe.min.x-d.ab:te.max.x,F),G=(te,pe)=>(F[0]=Math.min(te.min.x,pe.min.x),F[1]=Math.max(te.max.x,pe.max.x),F[2]=d.ab-pe.min.y>te.max.y?pe.min.y-d.ab:te.max.y,F),X=[(te,pe)=>j(te,pe),(te,pe)=>j(pe,te),(te,pe)=>G(te,pe),(te,pe)=>G(pe,te)],Q=(te,pe,be,ye,we,Ee,Ce)=>{if(!w)return 0;const Ie=[[Ee?be:te,Ee?te:be,0],[Ee?be:pe,Ee?pe:be,0]],Le=Ce<0?d.ab+Ce:Ce,je=[Ee?Le:(te+pe)/2,Ee?(te+pe)/2:Le,0];return 0===be&&Ce<0||0!==be&&Ce>0?w.getForTilePoints(we,[je],!0,ye):Ie.push(je),w.getForTilePoints(c,Ie,!0,k),Math.max(Ie[0][2],Ie[1][2],je[2])/w.exaggeration()};for(let te=0;te<4;te++){const pe=g.borderFeatureIndices[te];if(0===pe.length)continue;const be=d.c$[te](c),ye=B(be);if(!(ye&&ye instanceof d.d0)||g.borderDoneWithNeighborZ[te]===ye.canonical.z)continue;0===ye.centroidVertexArray.length&&ye.createCentroidsBuffer();const we=w?w.findDEMTileFor(be):null;if(!(we&&we.dem||C))continue;const Ee=(te<2?1:5)-te,Ce=ye.borderDoneWithNeighborZ[Ee]!==g.canonical.z,Ie=ye.borderFeatureIndices[Ee];let Le=0;if(g.canonical.z!==ye.canonical.z){for(const je of pe)g.showCentroid(g.featuresOnBorder[je]);if(Ce)for(const je of Ie)ye.showCentroid(ye.featuresOnBorder[je]);g.borderDoneWithNeighborZ[te]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ee]=g.canonical.z}for(const je of pe){const Fe=g.featuresOnBorder[je],Oe=g.centroidData[Fe.centroidDataIndex],ct=Fe.borders[te];let _t;for(;Le<Ie.length;){_t=ye.featuresOnBorder[Ie[Le]];const Ft=_t.borders[Ee];if(Ft[1]>ct[0]+3||Ft[0]>ct[0]-3)break;ye.showCentroid(_t),Le++}if(_t&&Le<Ie.length){const Ft=Le;let Yt=0;for(;!(_t.borders[Ee][0]>ct[1]-3)&&(Yt++,++Le!==Ie.length);)_t=ye.featuresOnBorder[Ie[Le]];_t=ye.featuresOnBorder[Ie[Ft]];let nn=!1;if(Yt>=1){const ft=_t.borders[Ee];Math.abs(ct[0]-ft[0])<3&&Math.abs(ct[1]-ft[1])<3&&(Yt=1,nn=!0,Le=Ft+1)}else if(0===Yt){g.showCentroid(Fe);continue}const Ke=ye.centroidData[_t.centroidDataIndex];C&&nn&&(((K=Oe).flags|(ne=Ke).flags)&d.d1?(K.flags|=d.d1,ne.flags|=d.d1):(K.flags&=~d.d1,ne.flags&=~d.d1));const At=Fe.intersectsCount()>1||_t.intersectsCount()>1;if(Yt>1)Le=Ft,Oe.centroidXY=Ke.centroidXY=new d.P(0,0);else if(we&&we.dem&&!At){const ft=X[te](Oe,Ke),Rt=te%2?d.ab-1:0,Vt=Q(ft[0],Math.min(d.ab-1,ft[1]),Rt,we,be,te<2,ft[2]);Oe.centroidXY=Ke.centroidXY=O(Vt)}else At?Oe.centroidXY=Ke.centroidXY=new d.P(0,0):(Oe.centroidXY=g.encodeBorderCentroid(Fe),Ke.centroidXY=ye.encodeBorderCentroid(_t));g.writeCentroidToBuffer(Oe),ye.writeCentroidToBuffer(Ke)}else g.showCentroid(Fe)}g.borderDoneWithNeighborZ[te]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ee]=g.canonical.z}var K,ne;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(m)}const Ld=[1,0,0],rg=[0,1,0],og=[0,0,1];function K_(m,s,c){const g=c.transform,v=c.shadowRenderer;if(!v)return!0;const w=m.toUnwrapped(),C=g.tileSize*v._cascades[c.currentShadowCascade].scale;let k=s.maxHeight;if(g.elevation){const K=g.elevation.getMinMaxForTile(m);K&&(k+=K.max)}const O=[...v.shadowDirection];O[2]=-O[2];const B=v.computeSimplifiedTileShadowVolume(w,k,C,O);if(!B)return!1;const F=[Ld,rg,og,O,[O[0],0,O[2]],[0,O[1],O[2]]],j="globe"===g.projection.name,G=g.scaleZoom(C),X=d.bO.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,G,!j),Q=v.getCurrentCascadeFrustum();return 0===X.intersectsPrecise(B.vertices,B.planes,F)||0===Q.intersectsPrecise(B.vertices,B.planes,F)}function na(m){return[m[0]*d.d4,m[1]*d.d4,m[2]*d.d4,0]}function ao(m,s,c,g,v,w,C,k,O){const B=g.getSource(),F=c.globeSharedBuffers;if(!F)return;let j,G,X;if(s&&(j=g.getTile(s)),B instanceof d.aD?(G=B.texture,X=d.cD(0,0,c.transform)):j&&s&&(G=j.texture,X=d.cD(s.canonical.z,s.canonical.x,c.transform)),!G||!X)return;m||(X=d.a6.mat4.scale(d.a6.mat4.create(),X,[1,-1,1]));const Q=c.context,K=Q.gl,ne="nearest"===v.paint.get("raster-resampling")?K.NEAREST:K.LINEAR,te=c.colorModeForDrapableLayerRenderPass(w),pe=C.defines;pe.push("GLOBE_POLES");const be=new Ut(K.LEQUAL,Ut.ReadWrite,c.depthRangeFor3D),ye=Float32Array.from(c.transform.expandedFarZProjMatrix),we=Float32Array.from(d.b6(d.cC(new d.bQ(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),Q.activeTexture.set(K.TEXTURE0),G.bind(ne,K.CLAMP_TO_EDGE),Q.activeTexture.set(K.TEXTURE1),G.bind(ne,K.CLAMP_TO_EDGE),G.useMipmap&&Q.extTextureFilterAnisotropic&&c.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,Q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Q.extTextureFilterAnisotropicMax);const[Ee,Ce,Ie,Le]=s?F.getPoleBuffers(s.canonical.z,!1):F.getPoleBuffers(0,!0),je=v.paint.get("raster-elevation");let Fe;m?(Fe=Ee,c.renderDefaultNorthPole=0!==je):(Fe=Ce,c.renderDefaultSouthPole=0!==je);const Oe=na(C.mix),ct=(Ft=ye,Yt=we,nn=X,Ke=d.a9(c.transform.zoom),ft=v,Vt=je,sn=Oe,An=C.offset,Nn=C.range,wn=w,Of(Ft,Yt,nn,new Float32Array(16),new Float32Array(9),[0,0],Ke,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ft,[0,0],Vt,2,sn,An,Nn,1,0,wn)),_t=c.getOrCreateProgram("raster",{defines:pe});var Ft,Yt,nn,Ke,ft,Vt,sn,An,Nn,wn;c.uploadCommonUniforms(Q,_t,null),_t.draw(c,K.TRIANGLES,be,O,te,k,ct,v.id,Fe,Ie,Le)}function Ou(m){const s=m._nearZ,c=m.projection.farthestPixelDistance(m),g=c-s,v=.2*m.height,w=s+v;return[s,c,(w-v-s)/g,(w-s)/g]}function ep(m,s,c,g){if(m)return s instanceof Cl&&m instanceof gd?s.getTextureDescriptor(m,c,!0):{texture:m.texture,mix:na(g.mix),offset:g.offset,buffer:0,tileSize:1}}var sg=d.d5([{name:"a_index",type:"Int16",components:1}]);class J_{constructor(s,c,g,v){const w={width:g[0],height:g[1],data:null},C=s.gl;this.targetColorTexture=new d.T(s,w,C.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new d.T(s,w,C.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(c,v),this.lastInvalidatedAt=0}updateParticleTexture(s,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,v=c.width*c.height;this.particleTexture0=new d.T(this.context,c,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new d.T(this.context,c,g.RGBA8,{premultiply:!1,useMipmap:!1});const w=new d.d6;w.reserve(v);for(let C=0;C<v;C++)w.emplaceBack(C);this.particleIndexBuffer=this.context.createVertexBuffer(w,sg.members,!0),this.particleSegment=d.b2.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=d.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function vc(m,s,c){if(!m)return null;const g=s.getTextureDescriptor(m,c,!0);if(!g)return null;let{texture:v,mix:w,offset:C,tileSize:k,buffer:O,format:B}=g;if(!v||!B)return null;let F=!1;return"uint32"===B&&(F=!0,w[3]=0,w=Rd(d.d7,w,[0,c.paint.get("raster-particle-max-speed")]),C=Kh(d.d7,C,[0,c.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[O/(k+2*O),k/(k+2*O)],tileSize:k,scalarData:F,scale:w,offset:C,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[B]]}}function tp(m){const s=m._nearZ,c=m.projection.farthestPixelDistance(m),g=c-s,v=.2*m.height,w=s+v;return[s,c,(w-v-s)/g,(w-s)/g]}const Od=new d.bA(1,0,0,1),Fd=new d.bA(0,1,0,1),Xt=new d.bA(0,0,1,1),On=new d.bA(1,0,1,1),Nd=new d.bA(0,1,1,1);function Wr(m,s,c,g,v,w,C){const k=m.context,O=m.transform,B=k.gl,F="globe"===O.projection.name,j=F?["PROJECTION_GLOBE_VIEW"]:[];let G=d.a6.mat4.clone(c.projMatrix);if(F&&d.a9(O.zoom)>0){const Oe=d.b5(c.canonical,O),ct=d.d8(Oe);G=d.a6.mat4.multiply(new Float32Array(16),O.globeMatrix,ct),d.a6.mat4.multiply(G,O.projMatrix,G)}const X=d.a6.mat4.create();X[12]+=2*v/(d.q.devicePixelRatio*O.width),X[13]+=2*w/(d.q.devicePixelRatio*O.height),d.a6.mat4.multiply(G,X,G);const Q=m.getOrCreateProgram("debug",{defines:j}),K=s.getTileByID(c.key);m.terrain&&m.terrain.setupElevationDraw(K,Q);const ne=Ut.disabled,te=li.disabled,pe=m.colorModeForRenderPass();k.activeTexture.set(B.TEXTURE0),m.emptyTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),F?K._makeGlobeTileDebugBuffers(m.context,O):K._makeDebugTileBoundsBuffers(m.context,O.projection);const ye=K._tileDebugBuffer||m.debugBuffer,we=K._tileDebugIndexBuffer||m.debugIndexBuffer,Ee=K._tileDebugSegments||m.debugSegments;if(Q.draw(m,B.LINE_STRIP,ne,te,pe,ni.disabled,ku(G,g),"$debug",ye,we,Ee,null,null,null,[K._globeTileDebugBorderBuffer]),C){const Oe=K.latestRawTileData,ct=Math.floor((Oe&&Oe.byteLength||0)/1024);let _t=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(_t+=` => ${c.overscaledZ}`),_t+=` ${K.state}`,_t+=` ${ct}kb`,function(Ft,Yt){Ft.initDebugOverlayCanvas();const nn=Ft.debugOverlayCanvas,Ke=Ft.context.gl,At=Ft.debugOverlayCanvas.getContext("2d");At.clearRect(0,0,nn.width,nn.height),At.shadowColor="white",At.shadowBlur=2,At.lineWidth=1.5,At.strokeStyle="white",At.textBaseline="top",At.font="bold 36px Open Sans, sans-serif",At.fillText(Yt,5,5),At.strokeText(Yt,5,5),Ft.debugOverlayTexture.update(nn),Ft.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(m,_t)}const Ce=s.getTile(c).tileSize,Ie=512/Math.min(Ce,512)*(c.overscaledZ/O.zoom)*.5,Le=K._tileDebugTextBuffer||m.debugBuffer,je=K._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Fe=K._tileDebugTextSegments||m.debugSegments;Q.draw(m,B.TRIANGLES,ne,te,Li.alphaBlended,ni.disabled,ku(G,d.bA.transparent,Ie),"$debug",Le,je,Fe,null,null,null,[K._globeTileDebugTextBuffer])}function rt(m,s,c,g){Kl(m,0,s+c/2,m.transform.width,c,g)}function Q_(m,s,c,g){Kl(m,s-c/2,0,c,m.transform.height,g)}function Kl(m,s,c,g,v,w){const C=m.context,k=C.gl;k.enable(k.SCISSOR_TEST),k.scissor(s*d.q.devicePixelRatio,c*d.q.devicePixelRatio,g*d.q.devicePixelRatio,v*d.q.devicePixelRatio),C.clear({color:w}),k.disable(k.SCISSOR_TEST)}const Vf=d.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:np}=Vf;function hl(m,s,c,g){m.emplaceBack(s,c,g)}class jf{constructor(s){this.vertexArray=new d.d9,this.indices=new d.aP,hl(this.vertexArray,-1,-1,1),hl(this.vertexArray,1,-1,1),hl(this.vertexArray,-1,1,1),hl(this.vertexArray,1,1,1),hl(this.vertexArray,-1,-1,-1),hl(this.vertexArray,1,-1,-1),hl(this.vertexArray,-1,1,-1),hl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,np),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=d.b2.simpleSegment(0,0,36,12)}}function pl(m,s,c,g,v,w){const C=m.context.gl,k=s.paint.get("sky-atmosphere-color"),O=s.paint.get("sky-atmosphere-halo-color"),B=s.paint.get("sky-atmosphere-sun-intensity"),F={u_matrix_3f:d.a6.mat3.fromMat4(d.a6.mat3.create(),g),u_sun_direction:v,u_sun_intensity:B,u_color_tint_r:[(Q=k).r,Q.g,Q.b,Q.a],u_color_tint_m:[(K=O).r,K.g,K.b,K.a],u_luminance:5e-5};var Q,K;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+w,s.skyboxTexture,0),c.draw(m,C.TRIANGLES,Ut.disabled,li.disabled,Li.unblended,ni.frontCW,F,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const Bd=d.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class av{constructor(s){const c=new d.da;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const g=new d.aP;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(c,Bd.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=d.b2.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Fu=d.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class zd{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Vd{constructor(s){this.colorModeAlphaBlendedWriteRGB=new Li([1,771,1,771],d.bA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Li([1,0,1,0],d.bA.transparent,[!1,!1,!1,!0]),this.params=new zd,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){const c=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new av(c);const g=this.params.sizeRange,v=this.params.intensityRange,w=function(F){const j=d.dd(30),G=[];for(let X=0;X<F;++X){const Q=2*Math.PI*j(),K=Math.acos(1-2*j())-.5*Math.PI;G.push(d.a6.vec3.fromValues(Math.cos(K)*Math.cos(Q),Math.cos(K)*Math.sin(Q),Math.sin(K)))}return G}(this.params.starsCount),C=d.dd(300),k=new d.db,O=new d.aP;let B=0;for(let F=0;F<w.length;++F){const j=d.a6.vec3.scale([],w[F],200),G=Math.max(0,1+.01*g*(1*C()-.5)),X=Math.max(0,1+.01*v*(1*C()-.5));k.emplaceBack(j[0],j[1],j[2],-1,-1,G,X),k.emplaceBack(j[0],j[1],j[2],1,-1,G,X),k.emplaceBack(j[0],j[1],j[2],1,1,G,X),k.emplaceBack(j[0],j[1],j[2],-1,1,G,X),O.emplaceBack(B+0,B+1,B+2),O.emplaceBack(B+0,B+2,B+3),B+=4}this.starsVx=c.createVertexBuffer(k,Fu.members),this.starsIdx=c.createIndexBuffer(O),this.starsSegments=d.b2.simpleSegment(0,0,k.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,c){const g=s.context,v=g.gl,w=s.transform,C=new Ut(v.LEQUAL,Ut.ReadOnly,[0,1]),k=d.a9(w.zoom),O=s.style.getLut(c.scope),B=c.properties.get("color").toRenderColor(O).toArray01(),F=c.properties.get("high-color").toRenderColor(O).toArray01(),j=c.properties.get("space-color").toRenderColor(O).toArray01PremultipliedAlpha(),G=5e-4,X=d.dc(c.properties.get("horizon-blend"),0,1,G,.25),Q=d.cx(s,g,w)&&X===G?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,K=s.frameCounter/1e3%1,ne=d.a6.vec3.length(w.globeCenterInViewSpace),te=Math.sqrt(Math.pow(ne,2)-Math.pow(Q,2)),pe=Math.acos(te/ne),be=ye=>{const we="globe"===w.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ye&&we.push("ALPHA_PASS");const Ee=s.getOrCreateProgram("globeAtmosphere",{defines:we}),Ce={u_frustum_tl:w.frustumCorners.TL,u_frustum_tr:w.frustumCorners.TR,u_frustum_br:w.frustumCorners.BR,u_frustum_bl:w.frustumCorners.BL,u_horizon:w.frustumCorners.horizon,u_transition:k,u_fadeout_range:X,u_color:B,u_high_color:F,u_space_color:j,u_temporal_offset:K,u_horizon_angle:pe};s.uploadCommonUniforms(g,Ee);const Ie=this.atmosphereBuffer;Ie&&Ee.draw(s,v.TRIANGLES,C,li.disabled,ye?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ni.backCW,Ce,ye?"atmosphere_glow_alpha":"atmosphere_glow",Ie.vertexBuffer,Ie.indexBuffer,Ie.segments)};be(!1),be(!0)}drawStars(s,c){const g=d.ap(c.properties.get("star-intensity"),0,1);if(0===g)return;const v=s.context,w=v.gl,C=s.transform,k=s.getOrCreateProgram("stars"),O=d.a6.quat.identity([]);d.a6.quat.rotateX(O,O,-C._pitch),d.a6.quat.rotateZ(O,O,-C.angle),d.a6.quat.rotateX(O,O,d.bC(C._center.lat)),d.a6.quat.rotateY(O,O,-d.bC(C._center.lng));const B=d.a6.mat4.fromQuat(new Float32Array(16),O),F=d.a6.mat4.multiply([],C.starsProjMatrix,B),j=d.a6.mat3.fromMat4([],B),G=d.a6.mat3.invert([],j),X=[0,1,0];d.a6.vec3.transformMat3(X,X,G),d.a6.vec3.scale(X,X,this.params.sizeMultiplier);const Q=[1,0,0];d.a6.vec3.transformMat3(Q,Q,G),d.a6.vec3.scale(Q,Q,this.params.sizeMultiplier);const K=(ne=X,te=Q,pe=g,{u_matrix:Float32Array.from(F),u_up:ne,u_right:te,u_intensity_multiplier:pe});var ne,te,pe;s.uploadCommonUniforms(v,k),this.starsVx&&this.starsIdx&&k.draw(s,w.TRIANGLES,Ut.disabled,li.disabled,this.colorModeAlphaBlendedWriteRGB,ni.disabled,K,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function eb(m,s){const c=[...m],g=s.cameraWorldSizeForFog/s.worldSize,v=d.a6.mat4.identity([]);return d.a6.mat4.scale(v,v,[g,g,1]),d.a6.mat4.multiply(c,v,c),d.a6.mat4.multiply(c,s.worldToFogMatrix,c),c}function ip(m,s,c,g,v){const w=c.material,C=g.context,{baseColorTexture:k,metallicRoughnessTexture:O}=w.pbrMetallicRoughness,{normalTexture:B,occlusionTexture:F,emissionTexture:j}=w;function G(Q,K,ne){if(Q&&(m.push(K),C.activeTexture.set(C.gl.TEXTURE0+ne),Q.gfxTexture)){const{minFilter:te,magFilter:pe,wrapS:be,wrapT:ye}=Q.sampler;Q.gfxTexture.bindExtraParam(te,pe,be,ye)}}G(k,"HAS_TEXTURE_u_baseColorTexture",so_BaseColor),G(O,"HAS_TEXTURE_u_metallicRoughnessTexture",so_MetallicRoughness),G(B,"HAS_TEXTURE_u_normalTexture",so_Normal),G(F,"HAS_TEXTURE_u_occlusionTexture",so_Occlusion),G(j,"HAS_TEXTURE_u_emissionTexture",so_Emission),v&&(v.texture||(v.texture=new d.df(g.context,v.image,[v.image.height,v.image.height,v.image.height],C.gl.RGBA8)),C.activeTexture.set(C.gl.TEXTURE0+so_LUT),v.texture&&v.texture.bind(C.gl.LINEAR,C.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(c.texcoordBuffer)),c.colorBuffer&&(m.push(12===c.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(c.colorBuffer)),c.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(c.normalBuffer)),c.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(c.pbrBuffer)),"OPAQUE"!==w.alphaMode&&"MASK"!==w.alphaMode||m.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||m.push("DIFFUSE_SHADED"),m.push("USE_STANDARD_DERIVATIVES");const X=g.shadowRenderer;X&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),X.useNormalOffset&&m.push("NORMAL_OFFSET"))}function Jc(m,s,c,g,v,w){const C=c.paint.get("model-opacity"),k=s.context,O=new Ut(s.context.gl.LEQUAL,Ut.ReadWrite,s.depthRangeFor3D),B=s.transform,F=m.mesh,j=F.material,G=j.pbrMetallicRoughness,X=s.style.fog;let Q;Q="pixels"===s.transform.projection.zAxisUnit?[...m.nodeModelMatrix]:d.a6.mat4.multiply([],g.zScaleMatrix,m.nodeModelMatrix),d.a6.mat4.multiply(Q,g.negCameraPosMatrix,Q);const K=d.a6.mat4.invert([],Q);d.a6.mat4.transpose(K,K);const ne=c.paint.get("model-emissive-strength").constantOr(0),te=Bf(new Float32Array(m.worldViewProjection),new Float32Array(Q),new Float32Array(K),null,s,C,G.baseColorFactor.toRenderColor(null),j.emissiveFactor,G.metallicFactor,G.roughnessFactor,j,ne,c),pe={defines:[]},be=[],ye=s.shadowRenderer;ye&&(ye.useNormalOffset=!1),ip(pe.defines,be,F,s,c.lut);let we=null;if(X){const Ie=eb(m.nodeModelMatrix,s.transform);if(we=new Float32Array(Ie),"globe"!==B.projection.name){const Le=F.aabb.min,je=F.aabb.max,[Fe,Oe]=X.getOpacityForBounds(Ie,Le[0],Le[1],je[0],je[1]);pe.overrideFog=Fe>=qt||Oe>=qt}}const Ee=Ga(s,c.paint.get("model-cutoff-fade-range"));Ee.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const Ce=s.getOrCreateProgram("model",pe);s.uploadCommonUniforms(k,Ce,null,we,Ee),"shadow"!==s.renderPass&&ye&&ye.setupShadowsFromMatrix(m.nodeModelMatrix,Ce),Ce.draw(s,k.gl.TRIANGLES,O,v,w,F.material.doubleSided?ni.disabled:ni.backCCW,te,c.id,F.vertexBuffer,F.indexBuffer,F.segments,c.paint,s.transform.zoom,void 0,be)}function rp(m,s,c,g,v,w,C){let k;k="globe"===m.projection.name?d.dg(c,m):[...c],d.a6.mat4.multiply(k,k,s.matrix);const O=d.a6.mat4.multiply([],g,k);if(s.meshes)for(const B of s.meshes){if("BLEND"!==B.material.alphaMode){C.push({mesh:B,depth:0,modelIndex:v,worldViewProjection:O,nodeModelMatrix:k});continue}const F=d.a6.vec3.transformMat4([],B.centroid,O);F[2]>0&&w.push({mesh:B,depth:F[2],modelIndex:v,worldViewProjection:O,nodeModelMatrix:k})}if(s.children)for(const B of s.children)rp(m,B,c,g,v,w,C)}function qa(m,s,c,g){const v=c.shadowRenderer;if(!v)return;const w=v.getShadowPassDepthMode(),C=v.getShadowPassColorMode(),k=v.calculateShadowPassMatrixFromMatrix(s),O=Jh(k);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,w,li.disabled,C,ni.backCCW,O,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,c.transform.zoom,void 0,void 0)}function tb(m,s,c){const g=s.updateZoomBasedPaintProperties(),v=function(w,C,k){let O,B,F,j=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&j>0){const G=w.terrain,X=G.findDEMTileFor(k);X&&X.dem?O=d.di.create(G,k,X):j=0}if(0===j&&(C.terrainElevationMin=0,C.terrainElevationMax=0),j===C.validForExaggeration&&(0===j||O&&O._demTile&&O._demTile.tileID===C.validForDEMTile.id&&O._dem._timestamp===C.validForDEMTile.timestamp))return!1;for(const G in C.instancesPerModel){const X=C.instancesPerModel[G];for(let Q=0;Q<X.instancedDataArray.length;++Q){const K=(O?j*O.getElevationAt(0|X.instancedDataArray.float32[16*Q],0|X.instancedDataArray.float32[16*Q+1],!0,!0):0)+X.instancesEvaluatedElevation[Q];X.instancedDataArray.float32[16*Q+6]=K,B=B?Math.min(C.terrainElevationMin,K):K,F=F?Math.max(C.terrainElevationMax,K):K}}return C.terrainElevationMin=B||0,C.terrainElevationMax=F||0,C.validForExaggeration=j,C.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,s,c);(g||v)&&(s.uploaded=!1,s.upload(m.context))}const Ea={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new d.ca([0,0,0],[d.ab,d.ab,0])};function js(m,s){const c=1<<m.canonical.z,g=s.getFreeCameraOptions().position,v=s.elevation,w=m.canonical.x/c,C=(m.canonical.x+1)/c,k=m.canonical.y/c,O=(m.canonical.y+1)/c;let B=s._centerAltitude;if(v){const X=v.getMinMaxForTile(m);X&&X.max>B&&(B=X.max)}const F=d.ap(g.x,w,C)-g.x,j=d.ap(g.y,k,O)-g.y,G=d.bE(B,s.center.lat)-g.z;return s._zoomFromMercatorZ(Math.sqrt(F*F+j*j+G*G))}function Uf(m,s,c,g,v,w,C){const k=m.context,O="shadow"===m.renderPass,B=m.shadowRenderer,F=O&&B?B.getShadowPassDepthMode():new Ut(k.gl.LEQUAL,Ut.ReadWrite,m.depthRangeFor3D),j=m.isTileAffectedByFog(w);if(c.meshes)for(const G of c.meshes){const X=["MODEL_POSITION_ON_GPU"],Q=[];let K,ne,te;g.instancedDataArray.length>20&&X.push("INSTANCED_ARRAYS");const pe=Ga(m,s.paint.get("model-cutoff-fade-range"));if(pe.shouldRenderCutoff&&X.push("RENDER_CUTOFF"),O&&B)K=m.getOrCreateProgram("modelDepth",{defines:X}),ne=Jh(C.shadowTileMatrix,C.shadowTileMatrix,Float32Array.from(c.matrix)),te=B.getShadowPassColorMode();else{ip(X,Q,G,m,s.lut),K=m.getOrCreateProgram("model",{defines:X,overrideFog:j});const ye=G.material,we=ye.pbrMetallicRoughness,Ee=s.paint.get("model-opacity"),Ce=s.paint.get("model-emissive-strength").constantOr(0);ne=Bf(w.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,m,Ee,we.baseColorFactor.toRenderColor(null),ye.emissiveFactor,we.metallicFactor,we.roughnessFactor,ye,Ce,s,v),B&&(C.shadowUniformsInitialized?K.setShadowUniformValues(k,B.getShadowUniformValues()):(B.setupShadows(w.toUnwrapped(),K,"model-tile",w.overscaledZ),C.shadowUniformsInitialized=!0)),te=pe.shouldRenderCutoff||Ee<1||"OPAQUE"!==ye.alphaMode?Li.alphaBlended:Li.unblended}m.uploadCommonUniforms(k,K,w.toUnwrapped(),null,pe);const be=G.material.doubleSided?ni.disabled:ni.backCCW;if(g.instancedDataArray.length>20)Q.push(g.instancedDataBuffer),K.draw(m,k.gl.TRIANGLES,F,li.disabled,te,be,ne,s.id,G.vertexBuffer,G.indexBuffer,G.segments,s.paint,m.transform.zoom,void 0,Q,g.instancedDataArray.length);else{const ye=O?"u_instance":"u_normal_matrix";for(let we=0;we<g.instancedDataArray.length;++we)ne[ye]=new Float32Array(g.instancedDataArray.arrayBuffer,64*we,16),K.draw(m,k.gl.TRIANGLES,F,li.disabled,te,be,ne,s.id,G.vertexBuffer,G.indexBuffer,G.segments,s.paint,m.transform.zoom,void 0,Q)}}if(c.children)for(const G of c.children)Uf(m,s,G,g,v,w,C)}const Qc=[1,-1,1];function Mr(m,s,c,g){if(!c.modelManager)return!0;const v=c.modelManager;if(!c.shadowRenderer)return!0;const w=c.shadowRenderer,C=s.aabb;let k=!0,O=m.maxHeight;if(0===O){let F=0;for(const j in m.instancesPerModel){const G=v.getModel(j,g);G?F=Math.max(F,Math.max(Math.max(G.aabb.max[0],G.aabb.max[1]),G.aabb.max[2])):k=!1}O=m.maxScale*F*1.41+m.maxVerticalOffset,k&&(m.maxHeight=O)}C.max[2]=O,C.min[2]+=m.terrainElevationMin,C.max[2]+=m.terrainElevationMax,d.a6.vec3.transformMat4(C.min,C.min,s.tileMatrix),d.a6.vec3.transformMat4(C.max,C.max,s.tileMatrix);const B=C.intersects(w.getCurrentCascadeFrustum());return 0===c.currentShadowCascade&&(m.isInsideFirstShadowMapFrustum=2===B),0===B}function nr(m,s){const c=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],v=m.uniformValues.u_cutoff_params[2],w=m.uniformValues.u_cutoff_params[3];return g===c||w===v?1:d.ap(((s-c)/(g-c)-v)/(w-v),0,1)}function ag(m,s,c,g){if(s.pitch<20)return 1;const v=s.getWorldToCameraMatrix();d.a6.mat4.multiply(v,v,m);const w=d.a6.vec4.fromValues(c.min[0],c.min[1],c.min[2],1);let C=d.a6.vec4.transformMat4(d.a6.vec4.create(),w,v),k=C,O=C;w[1]=c.max[1],C=d.a6.vec4.transformMat4(d.a6.vec4.create(),w,v),k=C[1]<k[1]?C:k,O=C[1]>O[1]?C:O,w[0]=c.max[0],C=d.a6.vec4.transformMat4(d.a6.vec4.create(),w,v),k=C[1]<k[1]?C:k,O=C[1]>O[1]?C:O,w[1]=c.min[1],C=d.a6.vec4.transformMat4(d.a6.vec4.create(),w,v),k=C[1]<k[1]?C:k,O=C[1]>O[1]?C:O;const B=d.ap(g[0],0,1),F=100*s.pixelsPerMeter*d.ap(g[1],0,1),j=d.ap(g[2],0,1),G=d.a6.vec4.lerp(d.a6.vec4.create(),k,O,B),X=Math.tan(.5*s.fovX),Q=-G[2]*X;if(0===F)return G[1]<-Math.abs(Q)?j:1;const K=(-Math.abs(Q)-G[1])/F,ne=(pe,be,ye)=>(1-ye)*pe+ye*be,te=d.ap(ne(1,j,K),j,1);return ne(1,te,d.ap((s.pitch-20)/20,0,1))}class xc{}class op{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,c,g){{const j=this._storage.get(c.id);if(j)return j.lastUsedFrameIdx=s,j.buf}const v=g.gl,w=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),C=new ArrayBuffer(w),k=new Int16Array(C);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(C));const O=new d.dk;for(let j=0;j<w/2;j+=3){const G=k[j],X=k[j+1],Q=k[j+2];O.emplaceBack(G,X),O.emplaceBack(X,Q),O.emplaceBack(Q,G)}const B=g.bindVertexArrayOES.current,F=new xc;return F.buf=new yc(g,O),F.lastUsedFrameIdx=s,this._storage.set(c.id,F),g.bindVertexArrayOES.set(B),F.buf}update(s){for(const[c,g]of this._storage)s-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(c))}destroy(){for(const[s,c]of this._storage)c.buf.destroy(),this._storage.delete(s)}}class Nu{constructor(s){this.occluderSize=30,this.depthOffset=-1e-4,s.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}class lg{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const eu={symbol:function(m,s,c,g,v){if("translucent"!==m.renderPass)return;const w=li.disabled,C=m.colorModeForRenderPass(),k=c.layout.get("text-variable-anchor"),O=c.layout.get("text-size-scale-range"),B=d.ap(m.scaleFactor,O[0],O[1]);k&&function(G,X,Q,K,ne,te,pe,be){const ye=X.transform,we="map"===ne,Ee="map"===te;for(const Ce of G){const Ie=K.getTile(Ce),Le=Ie.getBucket(Q);if(!Le||!Le.text||!Le.text.segments.get().length)continue;const je=d.bk(Le.textSizeData,ye.zoom,be),Fe=jc(Ce,Le.getProjection(),ye),Oe=ye.calculatePixelsToTileUnitsMatrix(Ie),ct=Xi(Fe,Ie.tileID.canonical,Ee,we,ye,Le.getProjection(),Oe),_t=Le.hasIconTextFit()&&Le.hasIconData();if(je){const Ft=Math.pow(2,ye.zoom-Ie.tileID.overscaledZ);ig(Le,we,Ee,pe,d.cS,ye,ct,Ce,Ft,je,_t)}}}(g,m,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v,B);const F=0!==c.paint.get("icon-opacity").constantOr(1),j=0!==c.paint.get("text-opacity").constantOr(1);void 0!==c.layout.get("symbol-sort-key").constantOr(1)&&(F||j)?Qh(m,s,c,g,w,C):(F&&Qh(m,s,c,g,w,C,{onlyIcons:!0}),j&&Qh(m,s,c,g,w,C,{onlyText:!0})),s.map.showCollisionBoxes&&(zf(m,s,c,g,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),zf(m,s,c,g,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,c,g){if("translucent"!==m.renderPass)return;const v=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),C=c.paint.get("circle-stroke-opacity"),k=void 0!==c.layout.get("circle-sort-key").constantOr(1),O=c.paint.get("circle-emissive-strength");if(0===v.constantOr(1)&&(0===w.constantOr(1)||0===C.constantOr(1)))return;const B=m.context,F=B.gl,j=m.transform,G=m.depthModeForSublayer(0,Ut.ReadOnly),X=li.disabled,Q=m.colorModeForDrapableLayerRenderPass(O),K="globe"===j.projection.name,ne=[d.am(j.center.lng),d.at(j.center.lat)],te=[];for(let be=0;be<g.length;be++){const ye=g[be],we=s.getTile(ye),Ee=we.getBucket(c);if(!Ee||Ee.projection.name!==j.projection.name)continue;const Ce=Ee.programConfigurations.get(c.id),Ie=d.cT(c),Le=m.isTileAffectedByFog(ye);K&&Ie.push("PROJECTION_GLOBE_VIEW"),Ie.push("DEPTH_D24"),m.terrain&&j.depthOcclusionForSymbolsAndCircles&&Ie.push("DEPTH_OCCLUSION");const je=m.getOrCreateProgram("circle",{config:Ce,defines:Ie,overrideFog:Le}),Fe=Ee.layoutVertexBuffer,Oe=Ee.globeExtVertexBuffer,ct=Ee.indexBuffer,_t=j.projection.createInversionMatrix(j,ye.canonical),Ft={programConfiguration:Ce,program:je,layoutVertexBuffer:Fe,globeExtVertexBuffer:Oe,indexBuffer:ct,uniformValues:d.cU(m,ye,we,_t,ne,c),tile:we};if(k){const Yt=Ee.segments.get();for(const nn of Yt)te.push({segments:new d.b2([nn]),sortKey:nn.sortKey,state:Ft})}else te.push({segments:Ee.segments,sortKey:0,state:Ft})}k&&te.sort((be,ye)=>be.sortKey-ye.sortKey);const pe={useDepthForOcclusion:j.depthOcclusionForSymbolsAndCircles};for(const be of te){const{programConfiguration:ye,program:we,layoutVertexBuffer:Ee,globeExtVertexBuffer:Ce,indexBuffer:Ie,uniformValues:Le,tile:je}=be.state,Fe=be.segments;m.terrain&&m.terrain.setupElevationDraw(je,we,pe),m.uploadCommonUniforms(B,we,je.tileID.toUnwrapped()),we.draw(m,F.TRIANGLES,G,X,Q,ni.disabled,Le,c.id,Ee,Ie,Fe,c.paint,j.zoom,ye,[Ce])}},heatmap:function(m,s,c,g){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const v=m.context,w=v.gl,C=li.disabled,k=new Li([w.ONE,w.ONE,w.ONE,w.ONE],d.bA.transparent,[!0,!0,!0,!0]);(function(X,Q,K,ne){const te=X.gl,pe=Q.width*ne,be=Q.height*ne;X.activeTexture.set(te.TEXTURE1),X.viewport.set([0,0,pe,be]);let ye=K.heatmapFbo;if(!ye||ye&&(ye.width!==pe||ye.height!==be)){ye&&ye.destroy();const we=te.createTexture();te.bindTexture(te.TEXTURE_2D,we),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),ye=K.heatmapFbo=X.createFramebuffer(pe,be,!0,null),function(Ee,Ce,Ie,Le,je,Fe){const Oe=Ee.gl;Oe.texImage2D(Oe.TEXTURE_2D,0,Ee.extRenderToTextureHalfFloat?Oe.RGBA16F:Oe.RGBA,je,Fe,0,Oe.RGBA,Ee.extRenderToTextureHalfFloat?Oe.HALF_FLOAT:Oe.UNSIGNED_BYTE,null),Le.colorAttachment.set(Ie)}(X,0,we,ye,pe,be)}else te.bindTexture(te.TEXTURE_2D,ye.colorAttachment.get()),X.bindFramebuffer.set(ye.framebuffer)})(v,m,c,"globe"===m.transform.projection.name?.5:.25),v.clear({color:d.bA.transparent});const O=m.transform,B="globe"===O.projection.name,F=B?["PROJECTION_GLOBE_VIEW"]:[],j=B?ni.frontCCW:ni.disabled,G=[d.am(O.center.lng),d.at(O.center.lat)];for(let X=0;X<g.length;X++){const Q=g[X];if(s.hasRenderableParent(Q))continue;const K=s.getTile(Q),ne=K.getBucket(c);if(!ne||ne.projection.name!==O.projection.name)continue;const te=m.isTileAffectedByFog(Q),pe=ne.programConfigurations.get(c.id),be=m.getOrCreateProgram("heatmap",{config:pe,defines:F,overrideFog:te}),{zoom:ye}=m.transform;m.terrain&&m.terrain.setupElevationDraw(K,be),m.uploadCommonUniforms(v,be,Q.toUnwrapped());const we=O.projection.createInversionMatrix(O,Q.canonical);be.draw(m,w.TRIANGLES,Ut.disabled,C,k,j,Yh(m,Q,K,we,G,ye,c.paint.get("heatmap-intensity")),c.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,c.paint,m.transform.zoom,pe,B?[ne.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,w){const C=v.context,k=C.gl,O=w.heatmapFbo;if(!O)return;C.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,O.colorAttachment.get()),C.activeTexture.set(k.TEXTURE1);let B=w.colorRampTexture;B||(B=w.colorRampTexture=new d.T(C,w.colorRamp,k.RGBA8)),B.bind(k.LINEAR,k.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,k.TRIANGLES,Ut.disabled,li.disabled,v.colorModeForRenderPass(),ni.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,w.paint,v.transform.zoom)}(m,c))},line:function(m,s,c,g){if("translucent"!==m.renderPass)return;const v=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(0===v.constantOr(1)||0===w.constantOr(1))return;const C=c.paint.get("line-emissive-strength"),k=c.paint.get("line-occlusion-opacity"),O="sea"===c.layout.get("line-elevation-reference"),B=m.context,F=B.gl,j=!c.isDraped();if(j&&"globe"===m.transform.projection.name)return;const G=c.layout.get("line-cross-slope"),X=void 0!==G,Q=G<1,K=j?new Ut(m.depthOcclusion?F.GREATER:F.LEQUAL,Ut.ReadOnly,m.depthRangeFor3D):m.depthModeForSublayer(0,Ut.ReadOnly),ne=m.colorModeForDrapableLayerRenderPass(C),te=m.terrain&&m.terrain.renderingToTexture,pe=te?1:d.q.devicePixelRatio,be=c.paint.get("line-dasharray"),ye=be.constantOr(1),we=c.layout.get("line-cap"),Ee=be.constantOr(null),Ce=we.constantOr(null),Ie=c.paint.get("line-pattern"),Le=Ie.constantOr(1),je=Ie.constantOr(null),Fe=c.paint.get("line-opacity").constantOr(1);let Oe=!Le&&1!==Fe||m.depthOcclusion&&k>0&&k<1;const ct=c.paint.get("line-gradient"),_t=Le?"linePattern":"line",Ft=d.cV(c);let Yt;if(te&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Oe=!1),0!==k&&m.depthOcclusion){const Ke=c.paint._values["line-opacity"];Ke&&Ke.value&&"constant"===Ke.value.kind?Yt=Ke.value:d.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}if(j&&(m.forceTerrainMode=!0),!j&&0!==k&&m.terrain&&!te)return void d.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`);const nn=Oe&&j?m.stencilModeFor3D():li.disabled;j&&(Ft.push("ELEVATED"),X&&Ft.push(Q?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),O&&Ft.push("ELEVATION_REFERENCE_SEA"));for(const Ke of g){const At=s.getTile(Ke);if(Le&&!At.patternsLoaded())continue;const ft=At.getBucket(c);if(!ft)continue;m.prepareDrawTile();const Rt=ft.programConfigurations.get(c.id),Vt=m.isTileAffectedByFog(Ke),It=m.getOrCreateProgram(_t,{config:Rt,defines:Ft,overrideFog:Vt,overrideRtt:!j&&void 0});if(je&&At.imageAtlas){const rn=At.imageAtlas.patternPositions[je.toString()];rn&&Rt.setConstantPatternPositions(rn)}if(!Le&&Ee&&Ce&&At.lineAtlas){const rn=At.lineAtlas.getDash(Ee,Ce);rn&&Rt.setConstantPatternPositions(rn)}let[sn,An]=c.paint.get("line-trim-offset");("round"===Ce||"square"===Ce)&&sn!==An&&(0===sn&&(sn-=1),1===An&&(An+=1));const Nn=te?Ke.projMatrix:null,wn=Le?d.cW(m,At,c,Nn,pe,[sn,An]):d.cX(m,At,c,Nn,ft.lineClipsArray.length,pe,[sn,An]);if(ct){const rn=ft.gradients[c.id];let Hn=rn.texture;if(c.gradientVersion!==rn.version){let pi=256;if(c.stepInterpolant){const Bi=s.getSource().maxzoom,Sr=Ke.canonical.z===Bi?Math.ceil(1<<m.transform.maxZoom-Ke.canonical.z):1;pi=d.ap(d.cY(ft.maxLineLength/d.ab*1024*Sr),256,B.maxTextureSize)}rn.gradient=d.cZ({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:pi,image:rn.gradient||void 0,clips:ft.lineClipsArray}),rn.texture?rn.texture.update(rn.gradient):rn.texture=new d.T(B,rn.gradient,F.RGBA8),rn.version=c.gradientVersion,Hn=rn.texture}B.activeTexture.set(F.TEXTURE1),Hn.bind(c.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}ye&&(B.activeTexture.set(F.TEXTURE0),At.lineAtlasTexture&&At.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),Rt.updatePaintBuffers()),Le&&(B.activeTexture.set(F.TEXTURE0),At.imageAtlasTexture&&At.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Rt.updatePaintBuffers()),j&&!O&&m.terrain.setupElevationDraw(At,It),m.uploadCommonUniforms(B,It,Ke.toUnwrapped());const Bn=rn=>{null!=Yt&&(Yt.value=Fe*k),It.draw(m,F.TRIANGLES,K,rn,ne,ni.disabled,wn,c.id,ft.layoutVertexBuffer,ft.indexBuffer,ft.segments,c.paint,m.transform.zoom,Rt,[ft.layoutVertexBuffer2,ft.patternVertexBuffer,ft.zOffsetVertexBuffer]),null!=Yt&&(Yt.value=Fe)};if(Oe&&!j){const rn=m.stencilModeForClipping(Ke).ref;0===rn&&te&&B.clear({stencil:0});const Hn={func:F.EQUAL,mask:255};wn.u_alpha_discard_threshold=.8,Bn(new li(Hn,rn,255,F.KEEP,F.KEEP,F.INVERT)),wn.u_alpha_discard_threshold=0,Bn(new li(Hn,rn,255,F.KEEP,F.KEEP,F.KEEP))}else Oe&&j&&(wn.u_alpha_discard_threshold=.001),Bn(j?nn:m.stencilModeForClipping(Ke))}j&&(m.forceTerrainMode=!1),Oe&&(m.resetStencilClippingMasks(),te&&B.clear({stencil:0})),0===k||m.depthOcclusion||te||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,s,c,g){const v=c.paint.get("fill-color"),w=c.paint.get("fill-opacity"),C=c.is3D(),k=new Ut(m.context.gl.LEQUAL,Ut.ReadWrite,m.depthRangeFor3D);if(0===w.constantOr(1))return;const O=c.paint.get("fill-emissive-strength"),B=m.colorModeForDrapableLayerRenderPass(O),F=c.paint.get("fill-pattern"),j=m.opaquePassEnabledForLayer()&&!F.constantOr(1)&&1===v.constantOr(d.bA.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(m.renderPass===j){const G=C?k:m.depthModeForSublayer(1,"opaque"===m.renderPass?Ut.ReadWrite:Ut.ReadOnly);Al(m,s,c,g,G,B,!1)}if(!C&&"translucent"===m.renderPass&&c.paint.get("fill-antialias")){const G=C?k:m.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,Ut.ReadOnly);Al(m,s,c,g,G,B,!0)}},"fill-extrusion":function(m,s,c,g){const v=c.paint.get("fill-extrusion-opacity"),w=m.context,C=w.gl,k=m.terrain,O=k&&k.renderingToTexture;if(0===v)return;const B=m.conflationActive&&m.style.isLayerClipped(c,s.getSource()),F=m.style.order.indexOf(c.fqid);if(B&&function(j,G,X,Q,K){for(const ne of Q){const te=G.getTile(ne).getBucket(X);te&&(te.updateReplacement(ne,j.replacementSource,K),te.uploadCentroid(j.context))}}(m,s,c,g,F),k||B)for(const j of g){const G=s.getTile(j).getBucket(c);G&&Y_(m.context,s,j,G,c,k,B)}if("shadow"===m.renderPass&&m.shadowRenderer){const j=m.shadowRenderer;if(k&&v<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof d.a4)return;const G=j.getShadowPassDepthMode(),X=j.getShadowPassColorMode();gr(m,s,c,g,G,li.disabled,X,B)}else if("translucent"===m.renderPass){const j=!c.paint.get("fill-extrusion-pattern").constantOr(1),G=c.paint.get("fill-extrusion-color").constantOr(d.bA.white);if(!O&&0!==G.a){const X=new Ut(m.context.gl.LEQUAL,Ut.ReadWrite,m.depthRangeFor3D);1===v&&j?gr(m,s,c,g,X,li.disabled,Li.unblended,B):(gr(m,s,c,g,X,li.disabled,Li.disabled,B),gr(m,s,c,g,X,m.stencilModeFor3D(),m.colorModeForRenderPass(),B),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&j&&(!k&&"globe"!==m.transform.projection.name||O)){const X=c.paint.get("fill-extrusion-opacity"),Q=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),K=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ne=c.paint.get("fill-extrusion-flood-light-intensity"),te=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(c.lut).toArray01().slice(0,3),pe=Q>0&&K>0,be=ne>0,ye=(Ee,Ce,Ie)=>(1-Ie)*Ee+Ie*Ce,we=Ee=>{const Ce=m.depthModeForSublayer(1,Ut.ReadOnly,C.LEQUAL,!0),Ie=c.paint.get(Ee?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Le=ye(.1,3,Ie),je=m._showOverdrawInspector;if(!je){const Fe=new li({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),Oe=new Li([C.ONE,C.ONE,C.ONE,C.ONE],d.bA.transparent,[!1,!1,!1,!0],C.MIN);Is(m,s,c,g,Ce,Fe,Oe,ni.disabled,Ee,"sdf",X,Q,K,ne,te,Le,B,!1)}{const Fe=je?li.disabled:new li({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),Oe=je?m.colorModeForRenderPass():new Li([C.ONE_MINUS_DST_ALPHA,C.DST_ALPHA,C.ONE,C.ONE],d.bA.transparent,[!0,!0,!0,!0]);Is(m,s,c,g,Ce,Fe,Oe,ni.disabled,Ee,"color",X,Q,K,ne,te,Le,B,!1)}};if(O){const Ee=(Ce,Ie,Le)=>{const je=m.depthModeForSublayer(1,Ut.ReadOnly,C.LEQUAL,!1),Fe=c.paint.get(Ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Oe=ye(.1,3,Fe);{const ct=new Li([C.ONE,C.ONE,C.ONE,C.ONE],d.bA.transparent,[!1,!1,!1,!0]);Is(m,s,c,g,je,li.disabled,ct,ni.disabled,Ce,"clear",X,Q,K,ne,te,Oe,B,Ie)}{const ct=new li({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),_t=new Li([C.ONE,C.ONE,C.ONE,C.ONE],d.bA.transparent,[!1,!1,!1,!0],C.MIN);Is(m,s,c,g,je,ct,_t,ni.disabled,Ce,"sdf",X,Q,K,ne,te,Oe,B,Ie)}{const ct=Ce?C.ZERO:C.ONE_MINUS_DST_ALPHA,_t=new li({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),Ft=new Li([ct,C.DST_ALPHA,C.ONE_MINUS_DST_ALPHA,C.ZERO],d.bA.transparent,[!0,!0,!0,!0]);Is(m,s,c,g,je,_t,Ft,ni.disabled,Ce,"color",X,Q,K,ne,te,Oe,B,Ie)}{const ct=new Li([C.ONE,C.ONE,C.ONE,Ce?C.ZERO:C.ONE],d.bA.transparent,[!1,!1,!1,!0],Ce?C.FUNC_ADD:C.MAX);Is(m,s,c,g,je,li.disabled,ct,ni.disabled,Ce,"clear",X,Q,K,ne,te,Oe,B,Ie,Le)}};if(pe||be){let Ce;if(m.prepareDrawTile(),k){const Ie=k.drapeBufferSize[0],Le=k.drapeBufferSize[1];Ce=k.framebufferCopyTexture,Ce&&(!Ce||Ce.size[0]===Ie&&Ce.size[1]===Le)||(Ce&&Ce.destroy(),Ce=k.framebufferCopyTexture=new d.T(w,new d.r({width:Ie,height:Le}),C.RGBA8)),Ce.bind(C.LINEAR,C.CLAMP_TO_EDGE),C.copyTexSubImage2D(C.TEXTURE_2D,0,0,0,0,0,Ie,Le)}pe&&Ee(!0,!1,Ce),be&&Ee(!1,!0,Ce)}}else pe&&we(!0),be&&we(!1),(pe||be)&&m.resetStencilClippingMasks()}}},hillshade:function(m,s,c,g){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass||m.style.disableElevatedTerrain)return;const v=m.context,w=m.terrain&&m.terrain.renderingToTexture,[C,k]="translucent"!==m.renderPass||w?[{},g]:m.stencilConfigForOverlap(g);for(const O of k){const B=s.getTile(O);if(B.needsHillshadePrepare&&"offscreen"===m.renderPass)Hh(m,B,c);else if("translucent"===m.renderPass){const F=m.depthModeForSublayer(0,Ut.ReadOnly),j=c.paint.get("hillshade-emissive-strength"),G=m.colorModeForDrapableLayerRenderPass(j),X=w&&m.terrain?m.terrain.stencilModeForRTTOverlap(O):C[O.overscaledZ];Ef(m,O,B,c,F,X,G)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,s,c,g,v,w){if("translucent"!==m.renderPass||0===c.paint.get("raster-opacity"))return;const C="globe"===m.transform.projection.name,k=0!==c.paint.get("raster-elevation"),O=k&&C;if(m.renderElevatedRasterBackface&&!O)return;const B=m.context,F=B.gl,j=s.getSource(),G=function(Ee,Ce,Ie,Le){const je=Ce.paint.get("raster-color"),Fe="raster-array"===Ee.type,Oe=[],ct=Ce.paint.get("raster-resampling"),_t=Ce.paint.get("raster-color-mix");let Ft=Ce.paint.get("raster-color-range");const Yt=[_t[0],_t[1],_t[2],0],nn=_t[3];let Ke="nearest"===ct?Le.NEAREST:Le.LINEAR;if(Fe&&(Oe.push("RASTER_ARRAY"),je||Oe.push("RASTER_COLOR"),"linear"===ct&&Oe.push("RASTER_ARRAY_LINEAR"),Ke=Le.NEAREST,!Ft&&Ee.rasterLayers)){const At=Ee.rasterLayers.find(({id:ft})=>ft===Ce.sourceLayer);At&&At.fields&&At.fields.range&&(Ft=At.fields.range)}if(Ft=Ft||[0,1],je){Oe.push("RASTER_COLOR"),Ie.activeTexture.set(Le.TEXTURE2),Ce.updateColorRamp(Ft);let At=Ce.colorRampTexture;At||(At=Ce.colorRampTexture=new d.T(Ie,Ce.colorRamp,Le.RGBA8)),At.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}return{mix:Yt,range:Ft,offset:nn,defines:Oe,resampling:Ke}}(j,c,B,F);if(j instanceof d.aD&&!g.length&&!C)return;const X=c.paint.get("raster-emissive-strength"),Q=m.colorModeForDrapableLayerRenderPass(X),K=m.terrain&&m.terrain.renderingToTexture,ne=!m.options.moving,te="nearest"===c.paint.get("raster-resampling")?F.NEAREST:F.LINEAR;if(j instanceof d.aD&&!g.length&&(j.onNorthPole||j.onSouthPole)){const Ee=k?m.stencilModeFor3D():li.disabled;return void ao(!!j.onNorthPole,null,m,s,c,X,G,ni.disabled,Ee)}if(!g.length)return;const[pe,be]=j instanceof d.aD||K?[{},g]:m.stencilConfigForOverlap(g),ye=be[be.length-1].overscaledZ;O&&G.defines.push("PROJECTION_GLOBE_VIEW"),k&&G.defines.push("RENDER_CUTOFF");const we=(Ee,Ce,Ie)=>{for(const Le of Ee){const je=Le.toUnwrapped(),Fe=s.getTile(Le);if(K&&(!Fe||!Fe.hasData()))continue;B.activeTexture.set(F.TEXTURE0);const Oe=ep(Fe,j,c,G);if(!Oe||!Oe.texture)continue;const{texture:ct,mix:_t,offset:Ft,tileSize:Yt,buffer:nn}=Oe;let Ke,At;K?(Ke=Ut.disabled,At=Le.projMatrix):k?(Ke=new Ut(F.LEQUAL,Ut.ReadWrite,m.depthRangeFor3D),At=C?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(je,ne)):(Ke=m.depthModeForSublayer(Le.overscaledZ-ye,1===c.paint.get("raster-opacity")?Ut.ReadWrite:Ut.ReadOnly,F.LESS),At=m.transform.calculateProjMatrix(je,ne));const ft=m.terrain&&K?m.terrain.stencilModeForRTTOverlap(Le):pe[Le.overscaledZ],Rt=w?0:c.paint.get("raster-fade-duration");Fe.registerFadeDuration(Rt);const Vt=s.findLoadedParent(Le,0),It=Au(Fe,Vt,s,m.transform,Rt);let sn,An;m.terrain&&m.terrain.prepareDrawTile(),B.activeTexture.set(F.TEXTURE0),ct.bind(te,F.CLAMP_TO_EDGE),B.activeTexture.set(F.TEXTURE1),Vt?(Vt.texture&&Vt.texture.bind(te,F.CLAMP_TO_EDGE),sn=Math.pow(2,Vt.tileID.overscaledZ-Fe.tileID.overscaledZ),An=[Fe.tileID.canonical.x*sn%1,Fe.tileID.canonical.y*sn%1]):ct.bind(te,F.CLAMP_TO_EDGE),ct.useMipmap&&B.extTextureFilterAnisotropic&&m.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const Nn=m.transform;let wn;const Bn=k?Ou(Nn):[0,0,0,0];let rn,Hn,pi,Bi,Sr,Gi=0;if(O&&j instanceof d.aD&&j.coordinates.length>3)rn=Float32Array.from(d.b6(d.cC(new d.bQ(0,0,0)))),Hn=Float32Array.from(Nn.globeMatrix),pi=Float32Array.from(d.cy(Nn)),Bi=[d.am(Nn.center.lng),d.at(Nn.center.lat)],wn=j.elevatedGlobePerspectiveTransform,Sr=j.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const Ei=d.cz(Le.canonical);Gi=d.cA(Ei.getCenter().lat),rn=Float32Array.from(d.b6(d.cC(Le.canonical))),Hn=Float32Array.from(Nn.globeMatrix),pi=Float32Array.from(d.cy(Nn)),Bi=[d.am(Nn.center.lng),d.at(Nn.center.lat)],wn=[0,0],Sr=Float32Array.from(d.cB(Le.canonical,Ei,Gi,Nn.worldSize/Nn._pixelsPerMercatorPixel))}else wn=j instanceof d.aD?j.perspectiveTransform:[0,0],rn=new Float32Array(16),Hn=new Float32Array(9),pi=new Float32Array(16),Bi=[0,0],Sr=new Float32Array(9);const Hr=Of(At,rn,Hn,pi,Sr,An||[0,0],d.a9(m.transform.zoom),Bi,Bn,sn||1,It,c,wn,k?c.paint.get("raster-elevation"):0,2,_t,Ft,G.range,Yt,nn,X),rr=m.isTileAffectedByFog(Le),Ar=m.getOrCreateProgram("raster",{defines:G.defines,overrideFog:rr});if(m.uploadCommonUniforms(B,Ar,je),j instanceof d.aD){const Ei=j.elevatedGlobeVertexBuffer,Tr=j.elevatedGlobeIndexBuffer;if(K||!C)j.boundsBuffer&&j.boundsSegments&&Ar.draw(m,F.TRIANGLES,Ke,li.disabled,Q,ni.disabled,Hr,c.id,j.boundsBuffer,m.quadTriangleIndexBuffer,j.boundsSegments);else if(Ei&&Tr){const yr=Nn.zoom<=d.c3?j.elevatedGlobeSegments:j.getSegmentsForLongitude(Nn.center.lng);yr&&Ar.draw(m,F.TRIANGLES,Ke,li.disabled,Q,Ce,Hr,c.id,Ei,Tr,yr)}}else if(O){Ke=new Ut(F.LEQUAL,Ut.ReadOnly,m.depthRangeFor3D);const Ei=m.globeSharedBuffers;if(Ei){const[Tr,yr,Ci]=Ei.getGridBuffers(Gi,!1);Ar.draw(m,F.TRIANGLES,Ke,Ie||ft,m.colorModeForRenderPass(),Ce,Hr,c.id,Tr,yr,Ci)}}else{const{tileBoundsBuffer:Ei,tileBoundsIndexBuffer:Tr,tileBoundsSegments:yr}=m.getTileBoundsBuffers(Fe);Ar.draw(m,F.TRIANGLES,Ke,ft,Q,ni.disabled,Hr,c.id,Ei,Tr,yr)}}if(!(j instanceof d.aD)&&O)for(const Le of Ee){const je=Le.canonical.y===(1<<Le.canonical.z)-1;0===Le.canonical.y&&ao(!0,Le,m,s,c,X,G,Ce,Ie||li.disabled),je&&ao(!1,Le,m,s,c,X,G,Ce===ni.frontCW?ni.backCW:ni.frontCW,Ie||li.disabled)}};O?we(be,m.renderElevatedRasterBackface?ni.backCW:ni.frontCW,m.stencilModeFor3D()):we(be,ni.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,s,c,g,v,w){"offscreen"===m.renderPass&&function(C,k,O,B){if(!B.length)return;const F=C.context,j=F.gl,G=k.getSource();if(!(G instanceof Cl))return;const X=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let Q=O.particlePositionRGBAImage;if(!Q||Q.width!==X){const be=function(ye){const we=ye*ye,Ee=new Uint8Array(4*we),Ce=function(Le){return Le|=0,Le=Math.imul(2747636419^Le,2654435769),Le=Math.imul(Le^Le>>>16,2654435769),((Le=Math.imul(Le^Le>>>16,2654435769))>>>0)/4294967296},Ie=1/1.1;for(let Le=0;Le<we;Le++){const je=Ie*(Ce(2*Le+0)+Yc),Fe=Ie*(Ce(2*Le+1)+Yc),Oe=255*je%1,ct=255*Fe%1,_t=Oe,Ft=Fe-ct/255,Yt=ct;Ee[4*Le+0]=255*(je-Oe/255),Ee[4*Le+1]=255*_t,Ee[4*Le+2]=255*Ft,Ee[4*Le+3]=255*Yt}return Ee}(X);Q=O.particlePositionRGBAImage=new d.r({width:X,height:X},be)}let K=O.particleFramebuffer;K?K.width!==X&&(K.destroy(),K=O.particleFramebuffer=F.createFramebuffer(X,X,!0,null)):K=O.particleFramebuffer=F.createFramebuffer(X,X,!0,null);const ne=[];for(const be of B){const ye=k.getTile(be);if(!(ye instanceof gd))continue;const we=vc(ye,G,O);if(!we)continue;const Ee=[ye.tileSize,ye.tileSize];let Ce=O.tileFramebuffer;Ce||(Ce=O.tileFramebuffer=F.createFramebuffer(Ee[0],Ee[1],!0,null));let Ie=ye.rasterParticleState;Ie||(Ie=ye.rasterParticleState=new J_(F,be,Ee,Q));const Le=Ie.update(O.lastInvalidatedAt);Ie.particleTextureDimension!==X&&Ie.updateParticleTexture(be,Q);const je=Ie.targetColorTexture;Ie.targetColorTexture=Ie.backgroundColorTexture,Ie.backgroundColorTexture=je;const Fe=Ie.particleTexture0;Ie.particleTexture0=Ie.particleTexture1,Ie.particleTexture1=Fe,ne.push([be,we,Ie,Le])}if(0===ne.length)return;const te=d.q.now(),pe=O.previousDrawTimestamp?.001*(te-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=te,O.hasColorMap()){F.activeTexture.set(j.TEXTURE0+2);let be=O.colorRampTexture;be||(be=O.colorRampTexture=new d.T(F,O.colorRamp,j.RGBA8)),be.bind(j.LINEAR,j.CLAMP_TO_EDGE)}F.bindFramebuffer.set(O.tileFramebuffer.framebuffer),function(be,ye,we){const Ee=be.context,Ce=Ee.gl,Ie=ye.tileFramebuffer;Ee.activeTexture.set(Ce.TEXTURE0);const Le={u_texture:0,u_opacity:1.05*(Fe=ye.paint.get("raster-particle-fade-opacity-factor"))/(Fe+.05)},je=be.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Fe;for(const Oe of we){const[,,ct,_t]=Oe;Ie.colorAttachment.set(ct.targetColorTexture.texture),Ee.viewport.set([0,0,Ie.width,Ie.height]),Ee.clear({color:d.bA.transparent}),_t&&(ct.backgroundColorTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE),je.draw(be,Ce.TRIANGLES,Ut.disabled,li.disabled,Li.alphaBlended,ni.disabled,Le,ye.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments))}}(C,O,ne),function(be,ye,we,Ee){const Ce=be.context,Ie=Ce.gl,Le=we.tileFramebuffer,je="globe"===be.transform.projection.name,Fe=we.paint.get("raster-particle-max-speed");for(const Oe of Ee){const[ct,_t,Ft]=Oe;Ce.activeTexture.set(Ie.TEXTURE0+0),_t.texture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),Le.colorAttachment.set(Ft.targetColorTexture.texture);const Yt=be.getOrCreateProgram("rasterParticleDraw",{defines:_t.defines,overrideFog:!1});Ce.activeTexture.set(Ie.TEXTURE0+1);const nn=_t.scalarData?[]:[0,1,2,3].map(ft=>d.c$[ft](ct));nn.push(ct);const Ke=ct.canonical.x,At=ct.canonical.y;for(const ft of nn){const Rt=ye.getTile(je?ft.wrapped():ft);if(!Rt)continue;const Vt=Rt.rasterParticleState;if(!Vt)continue;const It=ft.canonical.x+(1<<ft.canonical.z)*(ft.wrap-ct.wrap),sn=ft.canonical.y;Vt.particleTexture0.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE);const An=dl(1,Vt.particleTexture0.size[0],[It-Ke,sn-At],0,_t.texture.size,2,Fe,_t.textureOffset,_t.scale,_t.offset);Yt.draw(be,Ie.POINTS,Ut.disabled,li.disabled,Li.alphaBlended,ni.disabled,An,we.id,Vt.particleIndexBuffer,void 0,Vt.particleSegment)}}}(C,k,O,ne),F.bindFramebuffer.set(O.particleFramebuffer.framebuffer),function(be,ye,we,Ee){const Ce=be.context,Ie=Ce.gl,Le=ye.paint.get("raster-particle-max-speed"),je=Ee*ye.paint.get("raster-particle-speed-factor")*.15,Fe=(ct=.01+1*ye.paint.get("raster-particle-reset-rate-factor"),Math.pow(ct,6)),Oe=ye.particleFramebuffer;var ct;Ce.viewport.set([0,0,Oe.width,Oe.height]);for(const ct of we){const[,_t,Ft]=ct;Ce.activeTexture.set(Ie.TEXTURE0+0),_t.texture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),Ce.activeTexture.set(Ie.TEXTURE0+1);const Yt=Ft.particleTexture0;Yt.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE);const nn=Nf(1,Yt.size[0],0,_t.texture.size,Le,je,Fe,_t.textureOffset,_t.scale,_t.offset);Oe.colorAttachment.set(Ft.particleTexture1.texture),Ce.clear({color:d.bA.transparent}),be.getOrCreateProgram("rasterParticleUpdate",{defines:_t.defines}).draw(be,Ie.TRIANGLES,Ut.disabled,li.disabled,Li.unblended,ni.disabled,nn,ye.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments)}}(C,O,ne,pe)}(m,s,c,g),"translucent"===m.renderPass&&(function(C,k,O,B,F){const j=C.context,G=j.gl,X=k.getSource().tileSize,Q=5*(1-d.a7(d.bV,d.bV+1,C.transform.zoom))*X+O.paint.get("raster-particle-elevation"),K=!C.options.moving,ne="globe"===C.transform.projection.name;if(!B.length)return;const[te,pe]=C.stencilConfigForOverlap(B),be=[];ne&&be.push("PROJECTION_GLOBE_VIEW");const ye=C.stencilModeFor3D();for(const we of pe){const Ee=we.toUnwrapped(),Ce=k.getTile(we);if(!Ce.rasterParticleState)continue;const Ie=Ce.rasterParticleState,Le=100;Ce.registerFadeDuration(Le);const je=k.findLoadedParent(we,0),Fe=Au(Ce,je,k,C.transform,Le);let Oe,ct;C.terrain&&C.terrain.prepareDrawTile(),j.activeTexture.set(G.TEXTURE0),Ie.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),j.activeTexture.set(G.TEXTURE1),je&&je.rasterParticleState?(je.rasterParticleState.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Oe=Math.pow(2,je.tileID.overscaledZ-Ce.tileID.overscaledZ),ct=[Ce.tileID.canonical.x*Oe%1,Ce.tileID.canonical.y*Oe%1]):Ie.targetColorTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const _t=ne?Float32Array.from(C.transform.expandedFarZProjMatrix):C.transform.calculateProjMatrix(Ee,K),Ft=C.transform,Yt=tp(Ft),nn=d.cz(we.canonical),Ke=d.cA(nn.getCenter().lat);let At,ft,Rt,Vt,It;ne?(At=Float32Array.from(d.b6(d.cC(we.canonical))),ft=Float32Array.from(Ft.globeMatrix),Rt=Float32Array.from(d.cy(Ft)),Vt=[d.am(Ft.center.lng),d.at(Ft.center.lat)],It=Float32Array.from(d.cB(we.canonical,nn,Ke,Ft.worldSize/Ft._pixelsPerMercatorPixel))):(At=new Float32Array(16),ft=new Float32Array(9),Rt=new Float32Array(16),Vt=[0,0],It=new Float32Array(9));const sn=Es(_t,At,ft,Rt,It,ct||[0,0],d.a9(C.transform.zoom),Vt,Yt,Oe||1,Fe,Q),An=C.isTileAffectedByFog(we),Nn=C.getOrCreateProgram("rasterParticle",{defines:be,overrideFog:An});if(C.uploadCommonUniforms(j,Nn,Ee),ne){const wn=new Ut(G.LEQUAL,Ut.ReadOnly,C.depthRangeFor3D),Bn=0,rn=C.globeSharedBuffers;if(rn){const[Hn,pi,Bi]=rn.getGridBuffers(Ke,0!==Bn);Nn.draw(C,G.TRIANGLES,wn,ye,Li.alphaBlended,C.renderElevatedRasterBackface?ni.frontCCW:ni.backCCW,sn,O.id,Hn,pi,Bi)}}else{const wn=C.depthModeForSublayer(0,Ut.ReadOnly),Bn=te[we.overscaledZ],{tileBoundsBuffer:rn,tileBoundsIndexBuffer:Hn,tileBoundsSegments:pi}=C.getTileBoundsBuffers(Ce);Nn.draw(C,G.TRIANGLES,wn,Bn,Li.alphaBlended,ni.disabled,sn,O.id,rn,Hn,pi)}}C.resetStencilClippingMasks()}(m,s,c,g),m.style.map.triggerRepaint())},background:function(m,s,c,g){const v=c.paint.get("background-color"),w=c.paint.get("background-opacity"),C=c.paint.get("background-emissive-strength"),k="viewport"===c.paint.get("background-pitch-alignment");if(0===w)return;const O=m.context,B=O.gl,F=m.transform,j=F.tileSize,G=c.paint.get("background-pattern");let X;if(void 0!==G&&(null===G||(X=m.imageManager.getPattern(G.toString(),c.scope,m.style.getLut(c.scope)),!X)))return;const Q=!G&&1===v.a&&1===w&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==Q)return;const K=li.disabled,ne=m.depthModeForSublayer(0,"opaque"===Q?Ut.ReadWrite:Ut.ReadOnly),te=m.colorModeForDrapableLayerRenderPass(C),pe=G?"backgroundPattern":"background";let be,ye=g;if(ye||(be=m.getBackgroundTiles(),ye=Object.values(be).map(we=>we.tileID)),G&&(O.activeTexture.set(B.TEXTURE0),m.imageManager.bind(m.context,c.scope)),k){const we=m.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0}),Ee=new Float32Array(d.a6.mat4.identity([])),Ce=new d.aA(0,0,0,0,0),Ie=G?kd(Ee,C,w,m,0,c.scope,X,k,{tileID:Ce,tileSize:j}):Pu(Ee,C,w,v.toRenderColor(c.lut));we.draw(m,B.TRIANGLES,ne,K,te,ni.disabled,Ie,c.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const we of ye){const Ee=m.isTileAffectedByFog(we),Ce=m.getOrCreateProgram(pe,{overrideFog:Ee}),Ie=we.toUnwrapped(),Le=g?we.projMatrix:m.transform.calculateProjMatrix(Ie);m.prepareDrawTile();const je=s?s.getTile(we):be?be[we.key]:new Er(we,j,F.zoom,m),Fe=G?kd(Le,C,w,m,0,c.scope,X,k,{tileID:we,tileSize:j}):Pu(Le,C,w,v.toRenderColor(c.lut));m.uploadCommonUniforms(O,Ce,Ie);const{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:ct,tileBoundsSegments:_t}=m.getTileBoundsBuffers(je);Ce.draw(m,B.TRIANGLES,ne,K,te,ni.disabled,Fe,c.id,Oe,ct,_t)}},sky:function(m,s,c){const g=m._atmosphere?d.a9(m.transform.zoom):1,v=c.paint.get("sky-opacity")*g;if(0===v)return;const w=m.context,C=c.paint.get("sky-type"),k=new Ut(w.gl.LEQUAL,Ut.ReadOnly,[0,1]),O=m.frameCounter/1e3%1;"atmosphere"===C?"offscreen"===m.renderPass?c.needsSkyboxCapture(m)&&(function(B,F,j,G){const X=B.context,Q=X.gl;let K=F.skyboxFbo;if(!K){K=F.skyboxFbo=X.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new jf(X),F.skyboxTexture=X.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,F.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let be=0;be<6;++be)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(K.framebuffer),X.viewport.set([0,0,32,32]);const ne=F.getCenter(B,!0),te=B.getOrCreateProgram("skyboxCapture"),pe=new Float64Array(16);d.a6.mat4.identity(pe),d.a6.mat4.rotateY(pe,pe,.5*-Math.PI),pl(B,F,te,pe,ne,0),d.a6.mat4.identity(pe),d.a6.mat4.rotateY(pe,pe,.5*Math.PI),pl(B,F,te,pe,ne,1),d.a6.mat4.identity(pe),d.a6.mat4.rotateX(pe,pe,.5*-Math.PI),pl(B,F,te,pe,ne,2),d.a6.mat4.identity(pe),d.a6.mat4.rotateX(pe,pe,.5*Math.PI),pl(B,F,te,pe,ne,3),d.a6.mat4.identity(pe),pl(B,F,te,pe,ne,4),d.a6.mat4.identity(pe),d.a6.mat4.rotateY(pe,pe,Math.PI),pl(B,F,te,pe,ne,5),X.viewport.set([0,0,B.width,B.height])}(m,c),c.markSkyboxValid(m)):"sky"===m.renderPass&&function(B,F,j,G,X){const Q=B.context,K=Q.gl,ne=B.transform,te=B.getOrCreateProgram("skybox");Q.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,F.skyboxTexture);const pe={u_matrix:ne.skyboxMatrix,u_sun_direction:F.getCenter(B,!1),u_cubemap:0,u_opacity:G,u_temporal_offset:X};B.uploadCommonUniforms(Q,te),te.draw(B,K.TRIANGLES,j,li.disabled,B.colorModeForRenderPass(),ni.backCW,pe,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,c,k,v,O):"gradient"===C&&"sky"===m.renderPass&&function(B,F,j,G,X){const Q=B.context,K=Q.gl,ne=B.transform,te=B.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new jf(Q)),Q.activeTexture.set(K.TEXTURE0);let pe=F.colorRampTexture;pe||(pe=F.colorRampTexture=new d.T(Q,F.colorRamp,K.RGBA8)),pe.bind(K.LINEAR,K.CLAMP_TO_EDGE);const be=(ye=ne.skyboxMatrix,we=F.getCenter(B,!1),Ee=F.paint.get("sky-gradient-radius"),Ce=G,Ie=X,{u_matrix:ye,u_color_ramp:0,u_center_direction:we,u_radius:d.bC(Ee),u_opacity:Ce,u_temporal_offset:Ie});var ye,we,Ee,Ce,Ie;B.uploadCommonUniforms(Q,te),te.draw(B,K.TRIANGLES,j,li.disabled,B.colorModeForRenderPass(),ni.backCW,be,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,c,k,v,O)},debug:function(m,s,c,g,v,w){for(let C=0;C<c.length;C++)if(v){const B=new d.bA(.8*g.r,.8*g.g,.8*g.b,1);Wr(m,s,c[C],g,-1,-1,w),Wr(m,s,c[C],g,-1,1,w),Wr(m,s,c[C],g,1,1,w),Wr(m,s,c[C],g,1,-1,w),Wr(m,s,c[C],B,0,0,w)}else Wr(m,s,c[C],g,0,0,w)},custom:function(m,s,c,g){const v=m.context,w=c.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||"offscreen"===m.renderPass)&&c.isDraped(s)){if("offscreen"===m.renderPass){const C=w.prerender;if(C){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),"globe"===m.transform.projection.name){const k=m.transform.pointMerc;C.call(w,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),d.a9(m.transform.zoom),[k.x,k.y],m.transform.pixelsPerMeterRatio)}else C.call(w,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if("translucent"===m.renderPass){if(m.terrain&&m.terrain.renderingToTexture){const k=w.renderToTile;if(k){const O=g[0].canonical,B=new d.a5(O.x+g[0].wrap*(1<<O.z),O.y,O.z);v.setDepthMode(Ut.disabled),v.setStencilMode(li.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),k.call(w,v.gl,B),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(li.disabled);const C="3d"===w.renderingMode?new Ut(m.context.gl.LEQUAL,Ut.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Ut.ReadOnly);if(v.setDepthMode(C),"globe"===m.transform.projection.name){const k=m.transform.pointMerc;w.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),d.a9(m.transform.zoom),[k.x,k.y],m.transform.pixelsPerMeterRatio)}else w.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else d.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,s,c,g){if("opaque"===m.renderPass)return;const v=c.paint.get("model-opacity");if(0===v)return;const w=c.paint.get("model-cast-shadows");if("shadow"===m.renderPass&&(!w||m.terrain&&v<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof d.a4))return;const C=m.shadowRenderer,k=c.paint.get("model-receive-shadows");C&&(C.useNormalOffset=!0,k||(C.enabled=!1));const O=()=>{C&&(C.useNormalOffset=!0,k||(C.enabled=!0))},B=s.getSource();if("light-beam"===m.renderPass&&"batched-model"!==B.type)return;if("vector"===B.type||"geojson"===B.type)return function(te,pe,be,ye,we){const Ee=te.transform;if("mercator"!==Ee.projection.name)return void d.w(`Drawing 3D models for ${Ee.projection.name} projection is not yet implemented`);const Ce=Ee.getFreeCameraOptions().position;if(!te.modelManager)return;const Ie=te.modelManager;be.modelManager=Ie;const Le=te.shadowRenderer;if(!be._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const je=be._unevaluatedLayout._values["model-id"],Fe={...be.layout.get("model-id").parameters},Oe=te.style.order.indexOf(be.fqid);for(const ct of ye){const _t=pe.getTile(ct).getBucket(be);if(!_t||_t.projection.name!==Ee.projection.name)continue;const Ft=_t.getModelUris();Ft&&!_t.modelsRequested&&(Ie.addModelsFromBucket(Ft,we),_t.modelsRequested=!0);const Yt=js(ct,Ee);Fe.zoom=Yt;const nn=je.possiblyEvaluate(Fe);if(tb(te,_t,ct),Ea.shadowUniformsInitialized=!1,Ea.useSingleShadowCascade=!!Le&&0===Le.getMaxCascadeForTile(ct.toUnwrapped()),"shadow"===te.renderPass&&Le){if(1===te.currentShadowCascade&&_t.isInsideFirstShadowMapFrustum)continue;const ft=Ee.calculatePosMatrix(ct.toUnwrapped(),Ee.worldSize);if(Ea.tileMatrix.set(ft),Ea.shadowTileMatrix=Float32Array.from(Le.calculateShadowPassMatrixFromMatrix(ft)),Ea.aabb.min.fill(0),Ea.aabb.max[0]=Ea.aabb.max[1]=d.ab,Ea.aabb.max[2]=0,Mr(_t,Ea,te,be.scope))continue}const Ke=1<<ct.canonical.z,At=[((Ce.x-ct.wrap)*Ke-ct.canonical.x)*d.ab,(Ce.y*Ke-ct.canonical.y)*d.ab,Ce.z*Ke*d.ab];te.conflationActive&&Object.keys(_t.instancesPerModel).length>0&&te.style.isLayerClipped(be,pe.getSource())&&_t.updateReplacement(ct,te.replacementSource,Oe,we)&&(_t.uploaded=!1,_t.upload(te.context));for(let ft in _t.instancesPerModel){const Rt=_t.instancesPerModel[ft];Rt.features.length>0&&(ft=nn.evaluate(Rt.features[0].feature,{}));const Vt=Ie.getModel(ft,we);if(Vt&&Vt.uploaded)for(const It of Vt.nodes)Uf(te,be,It,Rt,At,ct,Ea)}}}(m,s,c,g,"vector"===B.type?c.scope:""),void O();if(!B.loaded())return;if("batched-model"===B.type)return function(te,pe,be,ye){be.resetLayerRenderingStats(te);const we=te.context,Ee=te.transform,Ce=te.style.fog,Ie=te.shadowRenderer;if("mercator"!==Ee.projection.name)return void d.w(`Drawing 3D landmark models for ${Ee.projection.name} projection is not yet implemented`);const Le=te.transform.getFreeCameraOptions().position,je=d.a6.vec3.scale([],[Le.x,Le.y,Le.z],te.transform.worldSize),Fe=d.a6.vec3.negate([],je),Oe=d.a6.mat4.identity([]),ct=d.de(Ee.center.lat,Ee.zoom),_t=d.a6.mat4.fromScaling([],[1,1,1/ct]);d.a6.mat4.translate(Oe,Oe,Fe);const Ft=be.paint.get("model-opacity"),Yt=new Ut(we.gl.LEQUAL,Ut.ReadWrite,te.depthRangeFor3D),nn=new Ut(we.gl.LEQUAL,Ut.ReadOnly,te.depthRangeFor3D),Ke=new d.ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),At="shadow"===te.renderPass,ft=At&&Ie?Ie.getCurrentCascadeFrustum():Ee.getFrustum(Ee.scaleZoom(Ee.worldSize)),Rt=be.paint.get("model-front-cutoff"),Vt=Rt[2]<1,It=Ga(te,be.paint.get("model-cutoff-fade-range")),sn=be.getLayerRenderingStats();(function(An,Nn,wn,Bn){const rn=An.terrain?An.terrain.exaggeration():0,Hn=An.transform.zoom;for(const pi of Bn){const Bi=Nn.getTile(pi).getBucket(wn);Bi&&(An.conflationActive&&Bi.updateReplacement(pi,An.replacementSource),Bi.evaluateScale(An,wn),An.terrain&&rn>0&&Bi.elevationUpdate(An.terrain,rn,pi,wn.source),Bi.needsReEvaluation(An,Hn,wn)&&Bi.evaluate(wn))}})(te,pe,be,ye),function(){let An,Nn,wn;Vt?(An=ye.length-1,Nn=-1,wn=-1):(An=0,Nn=ye.length,wn=1);const Bn=new Float64Array(16),rn=d.a6.vec3.create(),Hn=new d.P(0,0);for(let pi=An;pi!==Nn;pi+=wn){const Bi=ye[pi],Sr=pe.getTile(Bi).getBucket(be);if(!Sr||!Sr.uploaded)continue;let Gi=!1;Ie&&(Gi=0===Ie.getMaxCascadeForTile(Bi.toUnwrapped()));const Hr=Ee.calculatePosMatrix(Bi.toUnwrapped(),Ee.worldSize),rr=Sr.modelTraits;!At&&Vt&&(d.a6.mat4.invert(Bn,Hr),d.a6.vec3.transformMat4(rn,je,Bn),Hn.x=rn[0],Hn.y=rn[1]);const Ar=[];for(const Ei of Sr.getNodesInfo()){if(Ei.hiddenByReplacement||!Ei.node.meshes)continue;const Tr=Ei.node;let yr=0;te.terrain&&Tr.elevation&&(yr=Tr.elevation*te.terrain.exaggeration());const Ci=(()=>{const Io=Ei.aabb;return Ke.min=[...Io.min],Ke.max=[...Io.max],Ke.min[2]+=yr,Ke.max[2]+=yr,d.a6.vec3.transformMat4(Ke.min,Ke.min,Hr),d.a6.vec3.transformMat4(Ke.max,Ke.max,Hr),Ke})(),Gr=Ei.evaluatedScale;if(Gr[0]<=1&&Gr[1]<=1&&Gr[2]<=1&&0===Ci.intersects(ft))continue;if(!At&&Vt){const Io=.16666666666666666;Ei.cameraCollisionOpacity=je[0]>Ci.min[0]&&je[0]<Ci.max[0]&&je[1]>Ci.min[1]&&je[1]<Ci.max[1]&&je[2]*ct<Ci.max[2]&&Tr.footprint&&d.bv(Hn,Tr.footprint)?Math.max(Ei.cameraCollisionOpacity-Io,0):Math.min(1,Ei.cameraCollisionOpacity+Io)}const Wo=[...Hr],ma=Tr.anchor?Tr.anchor[0]:0,Eo=Tr.anchor?Tr.anchor[1]:0;d.a6.mat4.translate(Wo,Wo,[ma*(Gr[0]-1),Eo*(Gr[1]-1),yr]),d.a6.vec3.exactEquals(Gr,d.dh)||d.a6.mat4.scale(Wo,Wo,Gr);const Fo=d.a6.mat4.multiply([],Wo,Tr.matrix),qi=d.a6.mat4.multiply([],Ee.expandedFarZProjMatrix,Fo),Vi=d.a6.mat4.multiply([],Ee.expandedFarZProjMatrix,Wo),or=d.a6.vec4.transformMat4([],[ma,Eo,yr,1],qi)[2];Tr.hidden=!1;let Rr=Ft;At||(Vt&&(Rr*=Ei.cameraCollisionOpacity,Rr*=ag(Wo,Ee,Ei.aabb,Rt)),Rr*=nr(It,or)),0!==Rr?Ar.push({nodeInfo:Ei,depth:or,opacity:Rr,wvpForNode:qi,wvpForTile:Vi,nodeModelMatrix:Fo,tileModelMatrix:Wo}):Tr.hidden=!0}At||Ar.sort((Ei,Tr)=>!Vt||1===Ei.opacity&&1===Tr.opacity?Ei.depth<Tr.depth?-1:1:1===Ei.opacity?-1:1===Tr.opacity?1:Ei.depth>Tr.depth?-1:1);for(const Ei of Ar){const Tr=Ei.nodeInfo,yr=Tr.node;let Ci=d.a6.mat4.multiply([],_t,Ei.tileModelMatrix);d.a6.mat4.multiply(Ci,Oe,Ci);const Gr=d.a6.mat4.invert([],Ci);d.a6.mat4.transpose(Gr,Gr),d.a6.mat4.scale(Gr,Gr,Qc),Ci=d.a6.mat4.multiply(Ci,Ci,yr.matrix);const Wo="light-beam"===te.renderPass,ma=rr&d.dj.HasMapboxMeshFeatures,Eo=ma?0:Tr.evaluatedRMEA[0][2];for(let Fo=0;Fo<yr.meshes.length;++Fo){const qi=yr.meshes[Fo],Vi=Fo===yr.lightMeshIndex;let or=Ei.wvpForNode;if(Vi){if(!Wo&&!te.terrain&&te.shadowRenderer){te.currentLayer<te.firstLightBeamLayer&&(te.firstLightBeamLayer=te.currentLayer);continue}or=Ei.wvpForTile}else if(Wo)continue;const Rr={defines:[]},Io=[];if(!At&&Ie&&(Ie.useNormalOffset=!!qi.normalBuffer),ip(Rr.defines,Io,qi,te,be.lut),ma||Rr.defines.push("DIFFUSE_SHADED"),Gi&&Rr.defines.push("SHADOWS_SINGLE_CASCADE"),sn&&(At?sn.numRenderedVerticesInShadowPass+=qi.vertexArray.length:sn.numRenderedVerticesInTransparentPass+=qi.vertexArray.length),At){qa(qi,Ei.nodeModelMatrix,te,be);continue}let Xr=null;if(Ce){const Xa=eb(Ei.nodeModelMatrix,te.transform);if(Xr=new Float32Array(Xa),"globe"!==Ee.projection.name){const ka=qi.aabb.min,ic=qi.aabb.max,[fl,er]=Ce.getOpacityForBounds(Xa,ka[0],ka[1],ic[0],ic[1]);Rr.overrideFog=fl>=qt||er>=qt}}const ds=qi.material;let Ll;ds.occlusionTexture&&ds.occlusionTexture.offsetScale&&(Ll=ds.occlusionTexture.offsetScale,Rr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ma=te.getOrCreateProgram("model",Rr);!At&&Ie&&Ie.setupShadowsFromMatrix(Ei.tileModelMatrix,Ma,Ie.useNormalOffset),te.uploadCommonUniforms(we,Ma,null,Xr);const Aa=ds.pbrMetallicRoughness;Aa.metallicFactor=.9,Aa.roughnessFactor=.5;const Ra=Bf(new Float32Array(or),new Float32Array(Ci),new Float32Array(Gr),new Float32Array(yr.matrix),te,Ei.opacity,Aa.baseColorFactor.toRenderColor(null),ds.emissiveFactor,Aa.metallicFactor,Aa.roughnessFactor,ds,Eo,be,[0,0,0],Ll);!Vi&&(Tr.hasTranslucentParts||Ei.opacity<1)&&Ma.draw(te,we.gl.TRIANGLES,Yt,li.disabled,Li.disabled,ni.backCCW,Ra,be.id,qi.vertexBuffer,qi.indexBuffer,qi.segments,be.paint,te.transform.zoom,void 0,Io),Ma.draw(te,we.gl.TRIANGLES,Vi?nn:Yt,li.disabled,Vi||Ei.opacity<1||Tr.hasTranslucentParts?Li.alphaBlended:Li.unblended,ni.backCCW,Ra,be.id,qi.vertexBuffer,qi.indexBuffer,qi.segments,be.paint,te.transform.zoom,void 0,Io)}}}}()}(m,s,c,g),void O();if("model"!==B.type)return;const F=B.getModels(),j=[],G=m.transform.getFreeCameraOptions().position,X=d.a6.vec3.scale([],[G.x,G.y,G.z],m.transform.worldSize);d.a6.vec3.negate(X,X);const Q=[],K=[];let ne=0;for(const te of F){const pe=c.paint.get("model-rotation").constantOr(null),be=c.paint.get("model-scale").constantOr(null),ye=c.paint.get("model-translation").constantOr(null);te.computeModelMatrix(m,pe,be,ye,!0,!0,!1);const we=d.a6.mat4.identity([]),Ee=d.de(te.position.lat,m.transform.zoom),Ce=d.a6.mat4.fromScaling([],[1,1,1/Ee]);d.a6.mat4.translate(we,we,X),j.push({zScaleMatrix:Ce,negCameraPosMatrix:we});for(const Ie of te.nodes)rp(m.transform,Ie,te.matrix,m.transform.expandedFarZProjMatrix,ne,Q,K);ne++}if(Q.sort((te,pe)=>pe.depth-te.depth),"shadow"!==m.renderPass){if(1===v)for(const te of K)Jc(te,m,c,j[te.modelIndex],li.disabled,m.colorModeForRenderPass());else{for(const te of K)Jc(te,m,c,j[te.modelIndex],li.disabled,Li.disabled);for(const te of K)Jc(te,m,c,j[te.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const te of Q)Jc(te,m,c,j[te.modelIndex],li.disabled,m.colorModeForRenderPass());O()}else{for(const te of K)qa(te.mesh,te.nodeModelMatrix,m,c);for(const te of Q)qa(te.mesh,te.nodeModelMatrix,m,c);O()}}},$a={model:function(m,s,c){const g=s.getSource();if(!g.loaded())return;if("vector"===g.type||"geojson"===g.type)return void(c.modelManager&&c.modelManager.upload(c,"vector"===g.type?m.scope:""));if("batched-model"===g.type||"model"!==g.type)return;const v=g.getModels();for(const w of v)w.upload(c.context)},raster:function(m,s,c){const g=s.getSource();if(!(g instanceof Cl&&g.loaded()))return;const v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;const w=m.paint.get("raster-array-band")||g.getInitialBand(v);if(null==w)return;const C=s.getIds().map(k=>s.getTileByID(k));for(const k of C)k.updateNeeded(v,w)&&g.prepareTile(k,v,w)},"raster-particle":function(m,s,c){const g=s.getSource();if(!(g instanceof Cl&&g.loaded()))return;const v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;const w=m.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(null==w)return;const C=s.getIds().map(k=>s.getTileByID(k));for(const k of C)k.updateNeeded(v,w)&&g.prepareTile(k,v,w)}};class tu{constructor(s,c,g,v,w){this.context=new eg(s,c),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=d.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const C=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const O of C)this._debugParams.enabledLayers[O]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),w.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const O of C)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],O);this.occlusionParams=new Nu(w),this.setup(),this.numSublayers=wa.maxUnderzooming+wa.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new d.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new z_(this),this._wireframeDebugCache=new op,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const k=new d.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new d.T(this.context,k,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v}updateTerrain(s,c){const g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Zh(this,s));const v=this._terrain;this.transform.elevation=g?v:null,v.update(s,this.transform,c),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(s){const c=s.fog;if(!c||"globe"===this.transform.projection.name||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=c.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const w=g+.78*(v-g);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new Zh(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,c){if(this.width=s*d.q.devicePixelRatio,this.height=c*d.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const s=this.context,c=new d.a$;c.emplaceBack(0,0),c.emplaceBack(d.ab,0),c.emplaceBack(0,d.ab),c.emplaceBack(d.ab,d.ab),this.tileExtentBuffer=s.createVertexBuffer(c,d.b1.members),this.tileExtentSegments=d.b2.simpleSegment(0,0,4,2);const g=new d.a$;g.emplaceBack(0,0),g.emplaceBack(d.ab,0),g.emplaceBack(0,d.ab),g.emplaceBack(d.ab,d.ab),this.debugBuffer=s.createVertexBuffer(g,d.b1.members),this.debugSegments=d.b2.simpleSegment(0,0,4,5);const v=new d.a$;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,d.b1.members),this.viewportSegments=d.b2.simpleSegment(0,0,4,2);const w=new d.aO;w.emplaceBack(0,0,0,0),w.emplaceBack(d.ab,0,d.ab,0),w.emplaceBack(0,d.ab,0,d.ab),w.emplaceBack(d.ab,d.ab,d.ab,d.ab),this.mercatorBoundsBuffer=s.createVertexBuffer(w,d.b4.members),this.mercatorBoundsSegments=d.b2.simpleSegment(0,0,4,2);const C=new d.aP;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(C);const k=new d.b0;for(const B of[0,1,3,2,0])k.emplaceBack(B);this.debugIndexBuffer=s.createIndexBuffer(k),this.emptyTexture=new d.T(s,new d.r({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=d.a6.mat4.create();const O=this.context.gl;this.stencilClearMode=new li({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,Ut.disabled,this.stencilClearMode,Li.disabled,ni.disabled,Xh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,c,g){if(!c||this.currentStencilSource===c.id||!s.isTileClipped()||!g||0===g.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const O of g)if(void 0===this._tileClippingMaskIDs[O.key]){k=!0;break}if(!k)return}this.currentStencilSource=c.id;const v=this.context,w=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(Li.disabled),v.setDepthMode(Ut.disabled);const C=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of g){const O=c.getTile(k),B=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:j,tileBoundsSegments:G}=this.getTileBoundsBuffers(O);C.draw(this,w.TRIANGLES,Ut.disabled,new li({func:w.ALWAYS,mask:0},B,255,w.KEEP,w.KEEP,w.REPLACE),Li.disabled,ni.disabled,Xh(k.projMatrix),"$clipping",F,j,G)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new li({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const c=this.context.gl;return new li({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,g=s.sort((C,k)=>k.overscaledZ-C.overscaledZ),v=g[g.length-1].overscaledZ,w=g[0].overscaledZ-v+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const C={};for(let k=0;k<w;k++)C[k+v]=new li({func:c.GEQUAL,mask:255},k+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[C,g]}return[{[v]:li.disabled},g]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Li([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new d.bA(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Li.unblended:Li.alphaBlended}colorModeForDrapableLayerRenderPass(s){const c=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Li([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new d.bA(0,0,0,void 0===s?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,c,g,v=!1){if(this.depthOcclusion)return new Ut(this.context.gl.GREATER,Ut.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return Ut.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Ut(g||this.context.gl.LEQUAL,c,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,c=Math.ceil(this.width),g=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),w=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==c&&0!==g&&(this.depthFBO=new Qm(this.context,c,g,!1,"texture"),this.depthTexture=new d.T(this.context,{width:c,height:g,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),s.bindTexture(s.TEXTURE_2D,w),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,c,g,0,0,c,g,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,c)=>s+c/this._fpsHistory.length,0))}render(s,c){const g=d.q.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=c;const v=this.style._mergedLayers,w=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(Fe=>{const Oe=v[Fe];return!(Oe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Oe.type]});let C=!1,k=!1;for(const Fe of w){const Oe=v[Fe];"circle"===Oe.type&&(C=!0),"symbol"===Oe.type&&(Oe.hasInitialOcclusionOpacityProperties?k=!0:C=!0)}const O=w.map(Fe=>v[Fe]),B=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(d.q.now()),this.imageManager.beginFrame();let F=0,j=!1;for(const Fe in B){const Oe=B[Fe];Oe.used&&(Oe.prepare(this.context),Oe.getSource().usedInConflation&&++F)}let G=!1;for(const Fe of O)Fe.isHidden(this.transform.zoom)||("clip"===Fe.type&&(G=!0),this.prepareLayer(Fe));const X={},Q={},K={},ne={},te={};for(const Fe in B){const Oe=B[Fe];X[Fe]=Oe.getVisibleCoordinates(),Q[Fe]=X[Fe].slice().reverse(),K[Fe]=Oe.getVisibleCoordinates(!0).reverse(),ne[Fe]=Oe.getShadowCasterCoordinates(),te[Fe]=Oe.sortCoordinatesByDistance(X[Fe])}const pe=Fe=>{const Oe=this.style.getLayerSourceCache(Fe);return Oe&&Oe.used?Oe.getSource():null};if(F||G||this._clippingActiveLastFrame){const Fe=[],Oe=[];let ct=0;for(const _t of O)this.isSourceForClippingOrConflation(_t,pe(_t))&&(Fe.push(_t),Oe.push(ct)),ct++;if(Fe&&(G||Fe.length>1)||this._clippingActiveLastFrame){G=!1;const _t=[];for(let Ft=0;Ft<Fe.length;Ft++){const Yt=Fe[Ft],nn=Oe[Ft],Ke=this.style.getLayerSourceCache(Yt);if(!Ke||!Ke.used||!Ke.getSource().usedInConflation&&"clip"!==Yt.type)continue;let At=d.dn,ft=d.bt.None;const Rt=[];let Vt=!0;if("clip"===Yt.type){At=nn;for(const It of Yt.layout.get("clip-layer-types"))ft|="model"===It?d.bt.Model:"symbol"===It?d.bt.Symbol:d.bt.FillExtrusion;for(const It of Yt.layout.get("clip-layer-scope"))Rt.push(It);Yt.isHidden(this.transform.zoom)?Vt=!1:G=!0}Vt&&_t.push({layer:Yt.fqid,cache:Ke,order:At,clipMask:ft,clipScope:Rt})}this.replacementSource.setSources(_t),j=!0}}this._clippingActiveLastFrame=G,j||this.replacementSource.clear(),this.conflationActive=j,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<O.length;Fe++){const Oe=O[Fe],ct=Oe.cutoffRange();if(this.longestCutoffRange=Math.max(ct,this.longestCutoffRange),ct>0){const _t=pe(Oe);_t&&(this.minCutoffZoom=Math.max(_t.minzoom,this.minCutoffZoom)),Oe.minzoom&&(this.minCutoffZoom=Math.max(Oe.minzoom,this.minCutoffZoom))}Oe.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}const be=this.style&&this.style.fog;be?(this._fogVisible=0!==be.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(K),this.opaquePassCutoff=0);const ye=this._shadowRenderer;if(ye){ye.updateShadowParameters(this.transform,this.style.directionalLight);for(const Fe in B)for(const Oe of X[Fe]){let ct={min:0,max:0};this.terrain&&(ct=this.terrain.getMinMaxForTile(Oe)||ct),ye.addShadowReceiver(Oe.toUnwrapped(),ct.min,ct.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Vd(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!ge.has(this.context.gl))return;this.renderPass="offscreen";for(const Fe of O){const Oe=s.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const ct=Oe?Q[Oe.id]:void 0;("custom"===Fe.type||"raster"===Fe.type||"raster-particle"===Fe.type||Fe.isSky()||ct&&ct.length)&&this.renderLayer(this,Oe,Fe,ct)}this.depthRangeFor3D=[0,1-(O.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ne)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const we="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),Ee=(()=>{if(c.showOverdrawInspector)return d.bA.black;const Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){const Oe=this.style.getLut(Fe.scope);if(!we){const ct=Fe.properties.get("color").toRenderColor(Oe).toArray01();return new d.bA(...ct)}if(we){const ct=Fe.properties.get("space-color").toRenderColor(Oe).toArray01();return new d.bA(...ct)}}return d.bA.transparent})();if(this.context.clear({color:Ee,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const Fe=O[this.currentLayer],Oe=s.getLayerSourceCache(Fe);if(Fe.isSky())continue;const ct=Oe?(Fe.is3D()?te:Q)[Oe.id]:void 0;this._renderTileClippingMasks(Fe,Oe,ct),this.renderLayer(this,Oe,Fe,ct)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||d.a9(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const Fe=O[this.currentLayer],Oe=s.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,Oe,Fe,Oe?Q[Oe.id]:void 0)}function Ce(Fe,Oe){let ct;return Oe&&(ct=("symbol"===Fe.type?K:Fe.is3D()?te:Q)[Oe.id]),ct}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const Fe=O[this.currentLayer];if("raster"===Fe.type||"raster-particle"===Fe.type){const Oe=s.getLayerSourceCache(Fe);this.renderLayer(this,Oe,Fe,Ce(Fe,Oe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ie=0;ye&&(Ie=ye.getShadowCastingLayerCount());let Le=!1,je=-1;for(let Fe=0;Fe<w.length;++Fe){const Oe=O[Fe];Oe.isHidden(this.transform.zoom)||Oe.is3D()&&(je=Fe)}for(k&&-1===je&&(C=!0);this.currentLayer<w.length;){const Fe=O[this.currentLayer],Oe=s.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(C&&!Le&&this.terrain&&!this.transform.isOrthographic&&(Le=!0,this.blitDepth()),k&&-1!==je&&this.currentLayer===je+1&&!this.transform.isOrthographic&&this.blitDepth(),Fe.is3D()||this.terrain||this._renderTileClippingMasks(Fe,Oe,Oe?X[Oe.id]:void 0),this.renderLayer(this,Oe,Fe,Ce(Fe,Oe)),!this.terrain&&ye&&Ie>0&&Fe.hasShadowPass()&&0==--Ie&&(ye.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ct=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ct;this.currentLayer++){const _t=O[this.currentLayer];if(!_t.hasLightBeamPass())continue;const Ft=s.getLayerSourceCache(_t);this.renderLayer(this,Ft,_t,Ft?Q[Ft.id]:void 0)}this.currentLayer=ct,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ct=this.currentLayer;this.depthOcclusion=!0;for(const _t of this.layersWithOcclusionOpacity){this.currentLayer=_t;const Ft=O[this.currentLayer],Yt=s.getLayerSourceCache(Ft),nn=Yt?Q[Yt.id]:void 0;Ft.is3D()||this.terrain||this._renderTileClippingMasks(Ft,Yt,Yt?X[Yt.id]:void 0),this.renderLayer(this,Yt,Ft,nn)}this.depthOcclusion=!1,this.currentLayer=ct,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;O.forEach(Oe=>{const ct=s.getLayerSourceCache(Oe);ct&&!Oe.isHidden(this.transform.zoom)&&ct.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<ct.getSource().maxzoom)&&(Fe=ct)}),Fe&&this.options.showTileBoundaries&&eu.debug(this,Fe,Fe.getVisibleCoordinates(),d.bA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&eu.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new d.bA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Fe){const Oe=Fe.transform.padding;rt(Fe,Fe.transform.height-(Oe.top||0),3,Od),rt(Fe,Oe.bottom||0,3,Fd),Q_(Fe,Oe.left||0,3,Xt),Q_(Fe,Fe.transform.width-(Oe.right||0),3,On);const ct=Fe.transform.centerPoint;var _t,Ft,Yt,nn;Kl(_t=Fe,(Ft=ct.x)-1,(Yt=Fe.transform.height-ct.y)-10,2,20,nn=Nd),Kl(_t,Ft-10,Yt-1,20,2,nn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),j||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:c}=this.transform.projection,g=!c||!c.includes(s.type);if($a[s.type]&&(g||this.terrain&&"custom"===s.type)){const v=this.style.getLayerSourceCache(s);$a[s.type](s,v,this)}this.gpuTimingEnd()}renderLayer(s,c,g,v){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||"model"===g.type||"raster"===g.type||"raster-particle"===g.type||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(g.type)&&(!s.terrain||"custom"!==g.type)||"clip"===g.type||eu[g.type](s,c,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,g=this.context.gl;let v=this.gpuTimers[s.id];v||(v=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(c.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,c=this.context.gl,g=c.createQuery();this.deferredRenderGpuTimeQueries.push(g),c.beginQuery(s.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const c={};for(const g in s){const v=s[g],w=this.context.extTimerQuery,C=w.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(v.query),c[g]=C}return c}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let g=0;for(const v of s)g+=c.getQueryParameter(v,c.QUERY_RESULT)/1e6,c.deleteQuery(v);return g}translatePosMatrix(s,c,g,v,w){if(!g[0]&&!g[1])return s;const C=w?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(C){const B=Math.sin(C),F=Math.cos(C);g=[g[0]*F-g[1]*B,g[0]*B+g[1]*F]}const k=[w?g[0]:d.ak(c,g[0],this.transform.zoom),w?g[1]:d.ak(c,g[1],this.transform.zoom),0],O=new Float32Array(16);return d.a6.mat4.translate(O,s,k),O}saveTileTexture(s){const c=s.size[0],g=this._tileTextures[c];g?g.push(s):this._tileTextures[c]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(s,c,g){const v=void 0===g?this.terrain&&this.terrain.renderingToTexture:g,w=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===s||"terrainRaster"===s?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||w.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&w.push("GLOBE"),!this._fogVisible||v||void 0!==c&&!c||w.push("FOG","FOG_DITHERING"),v&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(s,c){this.cache=this.cache||{};const g=c&&c.defines||[],v=c&&c.config,w=this.currentGlobalDefines(s,c&&c.overrideFog,c&&c.overrideRtt).concat(g),C=_c.cacheKey(Il[s],s,w,v);return this.cache[C]||(this.cache[C]=new _c(this.context,s,Il[s],v,bc[s],w)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,c){if(this.style.enable3dLights()){const g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){const w=((C,k,O)=>{const B=C.properties.get("direction"),F=C.properties.get("color").toRenderColor(O.getLut(C.scope)).toArray01(),j=C.properties.get("intensity"),G=k.properties.get("color").toRenderColor(O.getLut(k.scope)).toArray01(),X=k.properties.get("intensity"),Q=[B.x,B.y,B.z],K=d.cH(G,X),ne=d.cH(F,j);return{u_lighting_ambient_color:K,u_lighting_directional_dir:Q,u_lighting_directional_color:ne,u_ground_radiance:Hi(Q,ne,K)}})(g,v,this.style);c.setLightsUniformValues(s,w)}}}uploadCommonUniforms(s,c,g,v,w){if(this.uploadCommonLightUniforms(s,c),this.terrain&&this.terrain.renderingToTexture)return;const C=this.style.fog;if(C){const k=C.getOpacity(this.transform.pitch),O=((B,F,j,G,X,Q,K,ne,te,pe,be,ye)=>{const we=B.transform,Ee=F.properties.get("color").toRenderColor(B.style.getLut(F.scope)).toArray01();Ee[3]=G;const Ce=B.frameCounter/1e3%1,[Ie,Le]=F.properties.get("vertical-range");return{u_fog_matrix:j?we.calculateFogTileMatrix(j):ye||B.identityMat,u_fog_range:F.getFovAdjustedRange(we._fov),u_fog_color:Ee,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ie,Le),Le],u_fog_temporal_offset:Ce,u_frustum_tl:X,u_frustum_tr:Q,u_frustum_br:K,u_frustum_bl:ne,u_globe_pos:te,u_globe_radius:pe,u_viewport:be,u_globe_transition:d.a9(we.zoom),u_is_globe:+("globe"===we.projection.name)}})(this,C,g,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*d.q.devicePixelRatio,this.transform.height*d.q.devicePixelRatio],v);c.setFogUniformValues(s,O)}w&&c.setCutoffUniformValues(s,w.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,c=s.createTexture();return s.bindTexture(s.TEXTURE_2D,c),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&0!==s.getOpacity(this.transform.pitch)}getBackgroundTiles(){const s=this._backgroundTiles,c=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)c[v.key]=s[v.key]||new Er(v,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,c){return!(!s.is3D()||"clip"!==s.type&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==s.sourceLayer)&&(!c||"batched-model"!==c.type)))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let c=this._cachedTileFogOpacities[s.key];return c||(this._cachedTileFogOpacities[s.key]=c=this.style.fog.getOpacityForTile(s)),c[0]>=qt||c[1]>=qt}setupDepthForOcclusion(s,c,g){const v=this.context,w=v.gl,C=!!g;var k;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(w.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((k=this.depthRangeFor3D)[1]-k[0]),-1-2*k[0]/(k[1]-k[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),v.activeTexture.set(w.TEXTURE0),C||c.setTerrainUniformValues(v,g)}}function Jl(m,s){let c=!1,g=null;const v=()=>{g=null,c&&(m(),g=setTimeout(v,s),c=!1)};return()=>(c=!0,g||v(),g)}class sp{constructor(s){this._hashName=s&&encodeURIComponent(s),d.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Jl(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const c=Ql(s);if(this._hashName){const g=this._hashName;let v=!1;const w=location.hash.slice(1).split("&").map(C=>{const k=C.split("=")[0];return k===g?(v=!0,`${k}=${c}`):C}).filter(C=>C);return v||w.push(`${g}=${c}`),`#${w.join("&")}`}return`#${c}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(c=g)}),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(g=>isNaN(g))){const g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(c[3]||0):s.getBearing();return s.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:g,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ql(m,s){const c=m.getCenter(),g=Math.round(100*m.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,v),C=Math.round(c.lng*w)/w,k=Math.round(c.lat*w)/w,O=m.getBearing(),B=m.getPitch();let F=s?`/${C}/${k}/${g}`:`${g}/${k}/${C}`;return(O||B)&&(F+="/"+Math.round(10*O)/10),B&&(F+=`/${Math.round(B)}`),F}const jd={linearity:.3,easing:d.dp(0,0,.3,1)},wr=d.l({deceleration:2500,maxSpeed:1400},jd),ap=d.l({deceleration:20,maxSpeed:1400},jd),nu=d.l({deceleration:1e3,maxSpeed:360},jd),Hf=d.l({deceleration:1e3,maxSpeed:90},jd);class us{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.q.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=d.q.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)c.zoom+=w.zoomDelta||0,c.bearing+=w.bearingDelta||0,c.pitch+=w.pitchDelta||0,w.panDelta&&c.pan._add(w.panDelta),w.around&&(c.around=w.around),w.pinchAround&&(c.pinchAround=w.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){const w=kl(c.pan.mag(),g,d.l({},wr,s||{}));v.offset=c.pan.mult(w.amount/c.pan.mag()),v.center=this._map.transform.center,Rl(v,w)}if(c.zoom){const w=kl(c.zoom,g,ap);v.zoom=this._map.transform.zoom+w.amount,Rl(v,w)}if(c.bearing){const w=kl(c.bearing,g,nu);v.bearing=this._map.transform.bearing+d.ap(w.amount,-179,179),Rl(v,w)}if(c.pitch){const w=kl(c.pitch,g,Hf);v.pitch=this._map.transform.pitch+w.amount,Rl(v,w)}if(v.zoom||v.bearing){const w=void 0===c.pinchAround?c.around:c.pinchAround;v.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Rl(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function kl(m,s,c){const{maxSpeed:g,linearity:v,deceleration:w}=c,C=d.ap(m*v/(s/1e3),-g,g),k=Math.abs(C)/(w*v);return{easing:c.easing,duration:1e3*k,amount:C*(k/2)}}class Nr extends d.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,g,v={}){const w=qe(c.getCanvasContainer(),g),C=c.unproject(w);super(s,d.l({point:w,lngLat:C,originalEvent:g},v)),this._defaultPrevented=!1,this.target=c}}class Bu extends d.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,g){const v="touchend"===s?g.changedTouches:g.touches,w=kt(c.getCanvasContainer(),v),C=w.map(O=>c.unproject(O)),k=w.reduce((O,B,F,j)=>O.add(B.div(j.length)),new d.P(0,0));super(s,{points:w,point:k,lngLats:C,lngLat:c.unproject(k),originalEvent:g}),this._defaultPrevented=!1}}class lp extends d.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Pl{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new lp(this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new Nr(s.type,this._map,s))}mouseup(s){this._map.fire(new Nr(s.type,this._map,s))}preclick(s){const c=d.l({},s);c.type="preclick",this._map.fire(new Nr(c.type,this._map,c))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Nr(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Nr(s.type,this._map,s))}mouseover(s){this._map.fire(new Nr(s.type,this._map,s))}mouseout(s){this._map.fire(new Nr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Bu(s.type,this._map,s))}touchmove(s){this._map.fire(new Bu(s.type,this._map,s))}touchend(s){this._map.fire(new Bu(s.type,this._map,s))}touchcancel(s){this._map.fire(new Bu(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ud{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Nr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Nr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Nr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cg{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&0===s.button&&(yn(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const g=c,v=this._startPos,w=this._lastPos;if(!v||!w||w.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=it("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const C=Math.min(v.x,g.x),k=Math.max(v.x,g.x),O=Math.min(v.y,g.y),B=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${O}px)`,this._box.style.width=k-C+"px",this._box.style.height=B-O+"px")})}mouseupWindow(s,c){if(!this._active)return;const g=this._startPos,v=c;if(g&&0===s.button){if(this.reset(),Re(),g.x!==v.x||g.y!==v.y)return this._map.fire(new d.x("boxzoomend",{originalEvent:s})),{cameraAnimation:w=>w.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Bt(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new d.x(s,{originalEvent:c}))}}function Qt(m,s){const c={};for(let g=0;g<m.length;g++)c[m[g].identifier]=s[g];return c}class lv{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,c,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const w=new d.P(0,0);for(const C of v)w._add(C);return w.div(v.length)}(c),this.touches=Qt(g,c)))}touchmove(s,c,g){if(this.aborted||!this.centroid)return;const v=Qt(g,c);for(const w in this.touches){const C=v[w];(!C||C.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(s,c,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Gf{constructor(s){this.singleTap=new lv(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,c,g){this.singleTap.touchstart(s,c,g)}touchmove(s,c,g){this.singleTap.touchmove(s,c,g)}touchend(s,c,g){const v=this.singleTap.touchend(s,c,g);if(v){const w=s.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(v)<30;if(w&&C||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class nb{constructor(){this._zoomIn=new Gf({numTouches:1,numTaps:2}),this._zoomOut=new Gf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,g){this._zoomIn.touchstart(s,c,g),this._zoomOut.touchstart(s,c,g)}touchmove(s,c,g){this._zoomIn.touchmove(s,c,g),this._zoomOut.touchmove(s,c,g)}touchend(s,c,g){const v=this._zoomIn.touchend(s,c,g),w=this._zoomOut.touchend(s,c,g);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(v)},{originalEvent:s})}):w?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(w)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qf={0:1,2:2};class $f{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const g=xe(s);this._correctButton(s,g)&&(this._lastPoint=c,this._eventButton=g)}mousemoveWindow(s,c){const g=this._lastPoint;if(g)if(s.preventDefault(),null!=this._eventButton&&function(v,w){const C=qf[w];return void 0===v.buttons||(v.buttons&C)!==C}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(g,c)}mouseupWindow(s){this._lastPoint&&xe(s)===this._eventButton&&(this._moved&&Re(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ug extends $f{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return 0===c&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class dg extends $f{_correctButton(s,c){return 0===c&&s.ctrlKey||2===c}_move(s,c){const g=.8*(c.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){s.preventDefault()}}class iu extends $f{_correctButton(s,c){return 0===c&&s.ctrlKey||2===c}_move(s,c){const g=-.5*(c.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){s.preventDefault()}}class cv{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),d.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}touchstart(s,c,g){return this._calculateTransform(s,c,g)}touchmove(s,c,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length&&!d.dq())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,c,g)}}touchend(s,c,g){this._calculateTransform(s,c,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,g){g.length>0&&(this._active=!0);const v=Qt(g,c),w=new d.P(0,0),C=new d.P(0,0);let k=0;for(const B in v){const F=v[B],j=this._touches[B];j&&(w._add(F),C._add(F.sub(j)),k++,v[B]=F)}if(this._touches=v,k<this._minTouches||!C.mag())return;const O=C.div(k);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(k),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=it("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class hg{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,c,g){return{}}touchstart(s,c,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,g){const v=this._firstTwoTouches;if(!v)return;s.preventDefault();const[w,C]=v,k=$o(g,c,w),O=$o(g,c,C);if(!k||!O)return;const B=this._aroundCenter?null:k.add(O).div(2);return this._move([k,O],B,s)}touchend(s,c,g){if(!this._firstTwoTouches)return;const[v,w]=this._firstTwoTouches,C=$o(g,c,v),k=$o(g,c,w);C&&k||(this._active&&Re(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function $o(m,s,c){for(let g=0;g<m.length;g++)if(m[g].identifier===c)return s[g]}function cp(m,s){return Math.log(m/s)/Math.LN2}class Hd extends hg{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(cp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:cp(this._distance,g),pinchAround:c}}}function ib(m,s){return 180*m.angleWith(s)/Math.PI}class rb extends hg{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ib(this._vector,g),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const v=ib(s,g);return Math.abs(v)<c}}function ia(m){return Math.abs(m.y)>Math.abs(m.x)}class ec extends hg{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,ia(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,g){const v=this._lastPoints;if(!v)return;const w=s[0].sub(v[0]),C=s[1].sub(v[1]);return this._map._cooperativeGestures&&!d.dq()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(w,C,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(w.y+C.y)/2*-.5})}gestureBeginsVertically(s,c,g){if(void 0!==this._valid)return this._valid;const v=s.mag()>=2,w=c.mag()>=2;if(!v&&!w)return;if(!v||!w)return null==this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const C=s.y>0==c.y>0;return ia(s)&&ia(c)&&C}}const pg={panStep:100,bearingStep:15,pitchStep:10};class up{constructor(){const s=pg;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,g=0,v=0,w=0,C=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),w=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),w=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),C=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:k=>{const O=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Gd,zoom:c?Math.round(O)+c*(s.shiftKey?2:1):O,bearing:k.getBearing()+g*this._bearingStep,pitch:k.getPitch()+v*this._pitchStep,offset:[-w*this._panStep,-C*this._panStep],center:k.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gd(m){return m*(2-m)}const Wf=4.000244140625;class dv{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||d.dq()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const g=d.q.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==c&&c%Wf==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=qe(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;"wheel"===this._type&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(0!==this._delta){const B="wheel"===this._type&&Math.abs(this._delta)>Wf?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&0!==F&&(F=1/F);const j=c(),G=Math.pow(2,j),X="number"==typeof this._targetZoom?s.zoomScale(this._targetZoom):G;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(X*F))),"wheel"===this._type&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:c(),v=this._startZoom,w=this._easing;let C,k=!1;if("wheel"===this._type&&v&&w){const B=Math.min((d.q.now()-this._lastWheelEventTime)/200,1),F=w(B);C=d.aa(v,g,F),B<1?this._frameId||(this._frameId=!0):k=!0}else C=g,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=C-c();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=d.dr;if(this._prevEase){const g=this._prevEase,v=(d.q.now()-g.start)/g.duration,w=g.easing(v+.01)-g.easing(v),C=.27/Math.sqrt(w*w+1e-4)*.01,k=Math.sqrt(.0729-C*C);c=d.dp(C,k,.25,1)}return this._prevEase={start:d.q.now(),duration:s,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=it("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Lo{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hv{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,c){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ob{constructor(){this._tap=new Gf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,c,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=c[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,c,g))}touchmove(s,c,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=c[0],w=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(s,c,g)}touchend(s,c,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(s,c,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wa{constructor(s,c,g){this._el=s,this._mousePan=c,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class zu{constructor(s,c,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vu{constructor(s,c,g,v){this._el=s,this._touchZoom=c,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const dp=m=>m.zoom||m.drag||m.pitch||m.rotate;class hp extends d.x{}class wc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,c){const g=d.a6.vec3.sub([],c,s);this.radius=d.a6.vec3.length(g[2]<0?d.a6.vec3.div([],g,this.constants):[g[0],g[1],0])}projectRay(s){d.a6.vec3.div(s,s,this.constants),d.a6.vec3.normalize(s,s),d.a6.vec3.mul(s,s,this.constants);const c=d.a6.vec3.scale([],s,this.radius);if(c[2]>0){const g=d.a6.vec3.scale([],[0,0,1],d.a6.vec3.dot(c,[0,0,1])),v=d.a6.vec3.scale([],d.a6.vec3.normalize([],[c[0],c[1],0]),this.radius),w=d.a6.vec3.add([],c,d.a6.vec3.scale([],d.a6.vec3.sub([],d.a6.vec3.add([],v,g),c),2));c[0]=w[0],c[1]=w[1]}return c}}function ju(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class os{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new us(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new wc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),d.aJ(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,w,C]of this._listeners){const k=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(w,k,C)}}destroy(){for(const[s,c,g]of this._listeners){const v=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(c,v,g)}}_addDefaultHandlers(s){const c=this._map,g=c.getCanvasContainer();this._add("mapEvent",new Pl(c,s));const v=c.boxZoom=new cg(c,s);this._add("boxZoom",v);const w=new nb,C=new hv;c.doubleClickZoom=new Lo(C,w),this._add("tapZoom",w),this._add("clickZoom",C);const k=new ob;this._add("tapDragZoom",k);const O=c.touchPitch=new ec(c);this._add("touchPitch",O);const B=new dg(s),F=new iu(s);c.dragRotate=new zu(s,B,F),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const j=new ug(s),G=new cv(c,s);c.dragPan=new Wa(g,j,G),this._add("mousePan",j),this._add("touchPan",G,["touchZoom","touchRotate"]);const X=new rb,Q=new Hd;c.touchZoomRotate=new Vu(g,Q,X,k),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ud(c));const K=c.scrollZoom=new dv(c,this);this._add("scrollZoom",K,["mousePan"]);const ne=c.keyboard=new up;this._add("keyboard",ne);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[te]&&c[te].enable(s[te])}_add(s,c,g){this._handlers.push({handlerName:s,handler:c,allowed:g}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!dp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,c,g){for(const v in s)if(v!==g&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const g of s)this._el.contains(g.target)&&c.push(g);return c}handleEvent(s,c){this._updatingCamera=!0;const g="renderFrame"===s.type,v=g?void 0:s,w={needsRenderFrame:!1},C={},k={},O=s.touches?this._getMapTouches(s.touches):void 0,B=O?kt(this._el,O):g?void 0:qe(this._el,s);for(const{handlerName:G,handler:X,allowed:Q}of this._handlers){if(!X.isEnabled())continue;let K;this._blockedByActive(k,Q,G)?X.reset():X[c||s.type]&&(K=X[c||s.type](s,B,O),this.mergeHandlerResult(w,C,K,G,v),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||X.isActive())&&(k[G]=X)}const F={};for(const G in this._previousActiveHandlers)k[G]||(F[G]=v);this._previousActiveHandlers=k,(Object.keys(F).length||ju(w))&&(this._changes.push([w,C,F]),this._triggerRenderFrame()),(Object.keys(k).length||ju(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=w;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(s,c,g,v,w){if(!g)return;d.l(s,g);const C={handlerName:v,originalEvent:g.originalEvent||w};void 0!==g.zoomDelta&&(c.zoom=C),void 0!==g.panDelta&&(c.drag=C),void 0!==g.pitchDelta&&(c.pitch=C),void 0!==g.bearingDelta&&(c.rotate=C)}_applyChanges(){const s={},c={},g={};for(const[v,w,C]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new d.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(s.around=v.around),void 0!==v.aroundCoord&&(s.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),d.l(c,w),d.l(g,C);this._updateMapTransform(s,c,g),this._changes=[]}_updateMapTransform(s,c,g){const v=this._map,w=v.transform,C=pe=>[pe.x,pe.y,pe.z];if((pe=>{const be=this._eventsInProgress.drag;return be&&!this._handlersById[be.handlerName].isActive()})()&&!ju(s)){const pe=w.zoom;w.cameraElevationReference="sea",null!=this._originalZoom&&w._orthographicProjectionAtLowPitch&&"globe"!==w.projection.name&&0===w.pitch?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),pe!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&v._stop(!0),!ju(s))return void this._fireEvents(c,g,!0);let{panDelta:k,zoomDelta:O,bearingDelta:B,pitchDelta:F,around:j,aroundCoord:G,pinchAround:X}=s;w._isCameraConstrained&&(O>0&&(O=0),w._isCameraConstrained=!1),void 0!==X&&(j=X),(O||(pe=>c.drag&&!this._eventsInProgress.drag)())&&j&&(this._dragOrigin=C(w.pointCoordinate3D(j)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",v._stop(!0),j=j||v.transform.centerPoint,B&&(w.bearing+=B),F&&(w.pitch+=F),w._updateCameraState();const Q=[0,0,0];if(k)if("mercator"===w.projection.name){const pe=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(j).dir),be=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(j.sub(k)).dir);Q[0]=be[0]-pe[0],Q[1]=be[1]-pe[1]}else{const pe=w.pointCoordinate(j);if("globe"===w.projection.name){k=k.rotate(-w.angle);const be=w._pixelsPerMercatorPixel/w.worldSize;Q[0]=-k.x*d.ds(d.aN(pe.y))*be,Q[1]=-k.y*d.ds(w.center.lat)*be}else{const be=w.pointCoordinate(j.sub(k));pe&&be&&(Q[0]=be.x-pe.x,Q[1]=be.y-pe.y)}}const K=w.zoom,ne=[0,0,0];if(O){const pe=C(G||w.pointCoordinate3D(j)),be={dir:d.a6.vec3.normalize([],d.a6.vec3.sub([],pe,w._camera.position))};if(be.dir[2]<0){const ye=w.zoomDeltaToMovement(pe,O);d.a6.vec3.scale(ne,be.dir,ye)}}const te=d.a6.vec3.add(Q,Q,ne);w._translateCameraConstrained(te),O&&Math.abs(w.zoom-K)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,g,!0)}_fireEvents(s,c,g){const v=dp(this._eventsInProgress),w=dp(s),C={};for(const F in s){const{originalEvent:j}=s[F];this._eventsInProgress[F]||(C[`${F}start`]=j),this._eventsInProgress[F]=s[F]}!v&&w&&this._fireEvent("movestart",w.originalEvent);for(const F in C)this._fireEvent(F,C[F]);w&&this._fireEvent("move",w.originalEvent);for(const F in s){const{originalEvent:j}=s[F];this._fireEvent(F,j)}const k={};let O;for(const F in this._eventsInProgress){const{handlerName:j,originalEvent:G}=this._eventsInProgress[F];this._handlersById[j].isActive()||(delete this._eventsInProgress[F],O=c[j]||G,k[`${F}end`]=O)}for(const F in k)this._fireEvent(F,k[F]);const B=dp(this._eventsInProgress);if(g&&(v||w)&&!B){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=G=>0!==G&&-this._bearingSnap<G&&G<this._bearingSnap;F?(j(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:O})):(this._map.fire(new d.x("moveend",{originalEvent:O})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new d.x(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new hp("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const tc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class fg extends d.E{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=!1!==c.respectPrefersReducedMotion,d.aJ(["_renderFrameCallback"],this)}getCenter(){return new d.bL(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,g){return s=d.P.convert(s).mult(-1),this.panTo(this.transform.center,d.l({offset:s},c),g)}panTo(s,c,g){return this.easeTo(d.l({center:s},c),g)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,g){return this.easeTo(d.l({zoom:s},c),g)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,g){return this.easeTo(d.l({bearing:s},c),g)}resetNorth(s,c){return this.rotateTo(0,d.l({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(d.l({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=d.as.convert(s);const g=c&&c.bearing||0,v=c&&c.pitch||0,w=s.getNorthWest(),C=s.getSouthEast();return this._cameraForBounds(this.transform,w,C,g,v,c)}_extendPadding(s){const c={top:0,right:0,bottom:0,left:0};return null==s?d.l({},c,this.transform.padding):"number"==typeof s?{top:s,bottom:s,right:s,left:s}:d.l({},c,s)}_extendCameraOptions(s){return(s=d.l({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,c){const g=c.max[0]-c.min[0],v=c.max[1]-c.min[1];return g/v>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,c,g,v,w,C){const k=s.clone(),O=this._extendCameraOptions(C);k.bearing=v,k.pitch=w;const B=d.bL.convert(c),F=d.bL.convert(g),j=.5*(B.lat+F.lat),G=.5*(B.lng+F.lng),X=d.dt(j,G),Q=d.a6.vec3.normalize([],X),K=d.a6.vec3.normalize([],d.a6.vec3.cross([],Q,[0,1,0])),ne=d.a6.vec3.cross([],K,Q),te=[K[0],K[1],K[2],0,ne[0],ne[1],ne[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],pe=[X,d.dt(B.lat,B.lng),d.dt(F.lat,B.lng),d.dt(F.lat,F.lng),d.dt(B.lat,F.lng),d.dt(j,B.lng),d.dt(j,F.lng),d.dt(B.lat,G),d.dt(F.lat,G)];let be=d.ca.fromPoints(pe.map(ft=>[d.a6.vec3.dot(K,ft),d.a6.vec3.dot(ne,ft),d.a6.vec3.dot(Q,ft)]));const ye=d.a6.vec3.transformMat4([],be.center,te);0===d.a6.vec3.squaredLength(ye)&&d.a6.vec3.set(ye,0,0,1),d.a6.vec3.normalize(ye,ye),d.a6.vec3.scale(ye,ye,d.aq),k.center=d.du(ye);const we=k.getWorldToCameraMatrix(),Ee=d.a6.mat4.invert(new Float64Array(16),we);be=d.ca.applyTransform(be,d.a6.mat4.multiply([],we,te));const Ce=this._extendAABB(be,k,O,v);if(!Ce)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");be=Ce,d.a6.vec3.transformMat4(ye,ye,we);const Ie=.5*(be.max[2]-be.min[2]),Le=this._minimumAABBFrustumDistance(k,be),je=d.a6.vec3.scale([],[0,0,1],Ie),Fe=d.a6.vec3.add(je,ye,je),Oe=Le+(0===k.pitch?0:d.a6.vec3.distance(ye,Fe)),ct=k.globeCenterInViewSpace,_t=d.a6.vec3.sub([],ye,[ct[0],ct[1],ct[2]]);d.a6.vec3.normalize(_t,_t),d.a6.vec3.scale(_t,_t,Oe);const Ft=d.a6.vec3.add([],ye,_t);d.a6.vec3.transformMat4(Ft,Ft,Ee);const Yt=d.dw/d.aq,nn=d.a6.vec3.length(Ft),Ke=d.bE(Math.max(nn*Yt-d.dw,Number.EPSILON),0),At=Math.min(k.zoomFromMercatorZAdjusted(Ke),O.maxZoom);return At>.5*(d.c3+d.bV)?(k.setProjection({name:"mercator"}),k.zoom=At,this._cameraForBounds(k,c,g,v,w,C)):{center:k.center,zoom:At,bearing:v,pitch:w}}_extendAABB(s,c,g,v){const w=.5*((g.padding.left||0)+(g.padding.right||0)),C=.5*((g.padding.top||0)+(g.padding.bottom||0)),k=C,O=w,B=w,F=C,j=c.width-(O+B),G=c.height-(k+F),X=d.a6.vec3.sub([],s.max,s.min),Q=Math.min(j/X[0],G/X[1]),K=Math.min(c.scaleZoom(c.scale*Q),g.maxZoom);if(isNaN(K))return null;const ne=c.scale/c.zoomScale(K),te=new d.ca([s.min[0]-O*ne,s.min[1]-F*ne,s.min[2]],[s.max[0]+B*ne,s.max[1]+k*ne,s.max[2]]),pe=("number"==typeof g.offset.x&&"number"==typeof g.offset.y?new d.P(g.offset.x,g.offset.y):d.P.convert(g.offset)).rotate(-d.bC(v));return te.center[0]-=pe.x*ne,te.center[1]+=pe.y*ne,te}queryTerrainElevation(s,c){const g=this.transform.elevation;return g?(c=d.l({},{exaggerated:!0},c),g.getAtPoint(d.a5.fromLngLat(s),null,c.exaggerated)):null}_cameraForBounds(s,c,g,v,w,C){if("globe"===s.projection.name)return this._cameraForBoundsOnGlobe(s,c,g,v,w,C);const k=s.clone(),O=this._extendCameraOptions(C);k.bearing=v,k.pitch=w;const B=d.bL.convert(c),F=d.bL.convert(g),j=new d.bL(B.lng,F.lat),G=new d.bL(F.lng,B.lat),X=k.project(B),Q=k.project(F),K=this.queryTerrainElevation(B),ne=this.queryTerrainElevation(F),te=this.queryTerrainElevation(j),pe=this.queryTerrainElevation(G),be=[[X.x,X.y,Math.min(K||0,ne||0,te||0,pe||0)],[Q.x,Q.y,Math.max(K||0,ne||0,te||0,pe||0)]];let ye=d.ca.fromPoints(be);const we=k.getWorldToCameraMatrix(),Ee=d.a6.mat4.invert(new Float64Array(16),we);ye=d.ca.applyTransform(ye,we);const Ce=this._extendAABB(ye,k,O,v);if(!Ce)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=Ce;const Ie=.5*d.a6.vec3.sub([],ye.max,ye.min)[2],Le=this._minimumAABBFrustumDistance(k,ye),je=[0,0,1,0];d.a6.vec4.transformMat4(je,je,we),d.a6.vec4.normalize(je,je);const Fe=d.a6.vec3.scale([],je,Le+Ie),Oe=d.a6.vec3.add([],ye.center,Fe);d.a6.vec3.transformMat4(ye.center,ye.center,Ee),d.a6.vec3.transformMat4(Oe,Oe,Ee);const ct=k.unproject(new d.P(ye.center[0],ye.center[1])),_t=d.dv(k.projection,ct),Ft=Math.pow(2,_t),Yt=Math.min(k._zoomFromMercatorZ(Oe[2]*k.pixelsPerMeter*Ft/k.worldSize),O.maxZoom);return k.mercatorFromTransition&&Yt<.5*(d.c3+d.bV)?(k.setProjection({name:"globe"}),k.zoom=Yt,this._cameraForBounds(k,c,g,v,w,C)):{center:ct,zoom:Yt,bearing:v,pitch:w}}fitBounds(s,c,g){const v=this.cameraForBounds(s,c);return this._fitInternal(v,c,g)}fitScreenCoordinates(s,c,g,v,w){const C=d.P.convert(s),k=d.P.convert(c),O=new d.P(Math.min(C.x,k.x),Math.min(C.y,k.y)),B=new d.P(Math.max(C.x,k.x),Math.max(C.y,k.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(C,k))return this;const F=this.transform.pointLocation3D(O),j=this.transform.pointLocation3D(B),G=this.transform.pointLocation3D(new d.P(O.x,B.y)),X=this.transform.pointLocation3D(new d.P(B.x,O.y)),Q=[Math.min(F.lng,j.lng,G.lng,X.lng),Math.min(F.lat,j.lat,G.lat,X.lat)],K=[Math.max(F.lng,j.lng,G.lng,X.lng),Math.max(F.lat,j.lat,G.lat,X.lat)],ne=v&&v.pitch?v.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,Q,K,g,ne,v);return this._fitInternal(te,v,w)}_fitInternal(s,c,g){return s?(c=d.l(s,c)).linear?this.easeTo(c,g):this.flyTo(c,g):this}jumpTo(s,c){this.stop();const g=s.preloadOnly?this.transform.clone():this.transform;let v=!1,w=!1,C=!1;"zoom"in s&&g.zoom!==+s.zoom&&(v=!0,g.zoom=+s.zoom),void 0!==s.center&&(g.center=d.bL.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(w=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(C=!0,g.pitch=+s.pitch);const k="number"==typeof s.padding?this._extendPadding(s.padding):s.padding;if(null!=s.padding&&!g.isPaddingEqual(k))if(!1===s.retainPadding){const O=g.clone();O.padding=k,g.setLocationAtPoint(g.center,O.centerPoint)}else g.padding=k;return s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new d.x("movestart",c)).fire(new d.x("move",c)),v&&this.fire(new d.x("zoomstart",c)).fire(new d.x("zoom",c)).fire(new d.x("zoomend",c)),w&&this.fire(new d.x("rotatestart",c)).fire(new d.x("rotate",c)).fire(new d.x("rotateend",c)),C&&this.fire(new d.x("pitchstart",c)).fire(new d.x("pitch",c)).fire(new d.x("pitchend",c)),this.fire(new d.x("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.w(tc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,c){const g=this.transform;if(!g.projection.supportsFreeCamera)return d.w(tc),this;this.stop();const v=g.zoom,w=g.pitch,C=g.bearing;g.setFreeCameraOptions(s);const k=v!==g.zoom,O=w!==g.pitch,B=C!==g.bearing;return this.fire(new d.x("movestart",c)).fire(new d.x("move",c)),k&&this.fire(new d.x("zoomstart",c)).fire(new d.x("zoom",c)).fire(new d.x("zoomend",c)),B&&this.fire(new d.x("rotatestart",c)).fire(new d.x("rotate",c)).fire(new d.x("rotateend",c)),O&&this.fire(new d.x("pitchstart",c)).fire(new d.x("pitch",c)).fire(new d.x("pitchend",c)),this.fire(new d.x("moveend",c)),this}easeTo(s,c){this._stop(!1,s.easeId),(!1===(s=d.l({offset:[0,0],duration:500,easing:d.dr},s)).animate||this._prefersReducedMotion(s))&&(s.duration=0);const g=this.transform,v=this.getZoom(),w=this.getBearing(),C=this.getPitch(),k=this.getPadding(),O="zoom"in s?+s.zoom:v,B="bearing"in s?this._normalizeBearing(s.bearing,w):w,F="pitch"in s?+s.pitch:C,j=this._extendPadding(s.padding),G=d.P.convert(s.offset);let X,Q,K;if("globe"===g.projection.name){const je=d.a5.fromLngLat(g.center),Fe=G.rotate(-g.angle);je.x+=Fe.x/g.worldSize,je.y+=Fe.y/g.worldSize;const Oe=je.toLngLat(),ct=d.bL.convert(s.center||Oe);this._normalizeCenter(ct),X=g.centerPoint.add(Fe),Q=new d.P(je.x,je.y).mult(g.worldSize),K=new d.P(d.am(ct.lng),d.at(ct.lat)).mult(g.worldSize).sub(Q)}else{X=g.centerPoint.add(G);const je=g.pointLocation(X),Fe=d.bL.convert(s.center||je);this._normalizeCenter(Fe),Q=g.project(je),K=g.project(Fe).sub(Q)}const ne=g.zoomScale(O-v);let te,pe;s.around&&(te=d.bL.convert(s.around),pe=g.locationPoint(te));const be=this._zooming||O!==v,ye=this._rotating||w!==B,we=this._pitching||F!==C,Ee=!g.isPaddingEqual(j),Ce=!1===s.retainPadding?g.clone():g,Ie=je=>Fe=>{if(be&&(je.zoom=d.aa(v,O,Fe)),ye&&(je.bearing=d.aa(w,B,Fe)),we&&(je.pitch=d.aa(C,F,Fe)),Ee&&(Ce.interpolatePadding(k,j,Fe),X=Ce.centerPoint.add(G)),te)je.setLocationAtPoint(te,pe);else{const Oe=je.zoomScale(je.zoom-v),ct=O>v?Math.min(2,ne):Math.max(.5,ne),_t=Math.pow(ct,1-Fe),Ft=je.unproject(Q.add(K.mult(Fe*_t)).mult(Oe));je.setLocationAtPoint(je.renderWorldCopies?Ft.wrap():Ft,X)}return s.preloadOnly||this._fireMoveEvents(c),je};if(s.preloadOnly){const je=this._emulate(Ie,s.duration,g);return this._preloadTiles(je),this}const Le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=be,this._rotating=ye,this._pitching=we,this._padding=Ee,this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,Le),this._ease(Ie(g),je=>{"sea"===g.cameraElevationReference&&g.recenterOnTerrain(),this._afterEase(c,je)},s),this}_prepareEase(s,c,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),c||g.moving||this.fire(new d.x("movestart",s)),this._zooming&&!g.zooming&&this.fire(new d.x("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new d.x("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new d.x("pitchstart",s))}_fireMoveEvents(s){this.fire(new d.x("move",s)),this._zooming&&this.fire(new d.x("zoom",s)),this._rotating&&this.fire(new d.x("rotate",s)),this._pitching&&this.fire(new d.x("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new d.x("zoomend",s)),v&&this.fire(new d.x("rotateend",s)),w&&this.fire(new d.x("pitchend",s)),this.fire(new d.x("moveend",s))}flyTo(s,c){if(this._prefersReducedMotion(s)){const ft=d.ar(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ft,c)}this.stop(),s=d.l({offset:[0,0],speed:1.2,curve:1.42,easing:d.dr},s);const g=this.transform,v=this.getZoom(),w=this.getBearing(),C=this.getPitch(),k=this.getPadding(),O="zoom"in s?d.ap(+s.zoom,g.minZoom,g.maxZoom):v,B="bearing"in s?this._normalizeBearing(s.bearing,w):w,F="pitch"in s?+s.pitch:C,j=this._extendPadding(s.padding),G=g.zoomScale(O-v),X=d.P.convert(s.offset);let Q=g.centerPoint.add(X);const K=g.pointLocation(Q),ne=d.bL.convert(s.center||K);this._normalizeCenter(ne);const te=g.project(K),pe=g.project(ne).sub(te);let be=s.curve;const ye=Math.max(g.width,g.height),we=ye/G,Ee=pe.mag();if("minZoom"in s){const ft=d.ap(Math.min(s.minZoom,v,O),g.minZoom,g.maxZoom),Rt=ye/g.zoomScale(ft-v);be=Math.sqrt(Rt/Ee*2)}const Ce=be*be;function Ie(ft){const Rt=(we*we-ye*ye+(ft?-1:1)*Ce*Ce*Ee*Ee)/(2*(ft?we:ye)*Ce*Ee);return Math.log(Math.sqrt(Rt*Rt+1)-Rt)}function Le(ft){return(Math.exp(ft)-Math.exp(-ft))/2}function je(ft){return(Math.exp(ft)+Math.exp(-ft))/2}const Fe=Ie(0);let Oe=function(ft){return je(Fe)/je(Fe+be*ft)},ct=function(ft){return ye*((je(Fe)*(Le(Rt=Fe+be*ft)/je(Rt))-Le(Fe))/Ce)/Ee;var Rt},_t=(Ie(1)-Fe)/be;if(Math.abs(Ee)<1e-6||!isFinite(_t)){if(Math.abs(ye-we)<1e-6)return this.easeTo(s,c);const ft=we<ye?-1:1;_t=Math.abs(Math.log(we/ye))/be,ct=function(){return 0},Oe=function(Rt){return Math.exp(ft*be*Rt)}}s.duration="duration"in s?+s.duration:1e3*_t/("screenSpeed"in s?+s.screenSpeed/be:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const Ft=w!==B,Yt=F!==C,nn=!g.isPaddingEqual(j),Ke=!1===s.retainPadding?g.clone():g,At=ft=>Rt=>{const Vt=Rt*_t,It=1/Oe(Vt);ft.zoom=1===Rt?O:v+ft.scaleZoom(It),Ft&&(ft.bearing=d.aa(w,B,Rt)),Yt&&(ft.pitch=d.aa(C,F,Rt)),nn&&(Ke.interpolatePadding(k,j,Rt),Q=Ke.centerPoint.add(X));const sn=1===Rt?ne:ft.unproject(te.add(pe.mult(ct(Vt))).mult(It));return ft.setLocationAtPoint(ft.renderWorldCopies?sn.wrap():sn,Q),ft._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(c),ft};if(s.preloadOnly){const ft=this._emulate(At,s.duration,g);return this._preloadTiles(ft),this}return this._zooming=!0,this._rotating=Ft,this._pitching=Yt,this._padding=nn,this._prepareEase(c,!1),this._ease(At(g),()=>this._afterEase(c),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,c)}if(!s){const g=this.handlers;g&&g.stop(!1)}return this}_ease(s,c,g){!1===g.animate||0===g.duration?(s(1),c()):(this._easeStart=d.q.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((d.q.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=d.bB(s,-180,180);const g=Math.abs(s-c);return Math.abs(s-360-c)<g&&(s-=360),Math.abs(s+360-c)<g&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(c.maxBounds||"globe"!==c.projection.name&&!c.renderWorldCopies)return;const g=s.lng-c.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&d.q.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,c,g){const v=Math.ceil(15*c/1e3),w=[],C=s(g.clone());for(let k=0;k<=v;k++){const O=C(k/v);w.push(O.clone())}return w}_preloadTiles(s,c){}}class Xf{constructor(s={}){this.options=s,d.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const c=this.options&&this.options.compact,g=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=it("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const v=it("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",g),this._innerContainer=it("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.e.ACCESS_TOKEN}];if(s){const g=c.reduce((v,w,C)=>(w.value&&(v+=`${w.key}=${w.value}${C<c.length-1?"&":""}`),v),"?");s.href=`${d.e.FEEDBACK_URL}/${g}#${Ql(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const c=this._map.style._mergedSourceCaches;for(const v in c){const w=c[v];if(w.used){const C=w.getSource();C.attribution&&s.indexOf(C.attribution)<0&&s.push(C.attribution)}}s.sort((v,w)=>v.length-w.length),s=s.filter((v,w)=>{for(let C=w+1;C<s.length;C++)if(s[C].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class pp{constructor(){d.aJ(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=it("div","mapboxgl-ctrl");const c=it("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&"metadata"!==s.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(0===Object.entries(s).length)return!0;for(const c in s){const g=s[c].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class fp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,g=c?this._queue.concat(c):this._queue;for(const v of g)if(v.id===s)return void(v.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const g of c)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Zf{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const c=d.cw((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,c,g){this._start=this.getValue(c),this._end=s,this._startTime=c,this._endTime=c+g}}const mp={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Yf=["mouseenter","mouseover","mouseleave","mouseout"];class Uu extends d.x{constructor(s,c,g,v){const{point:w,lngLat:C,originalEvent:k,target:O}=s;super(s.type,{point:w,lngLat:C,originalEvent:k,target:O}),this.preventDefault=()=>{s.preventDefault()},this.id=c,this.interaction=g,this.feature=v}}class mg{constructor(s){this.map=s,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(s,c){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const{type:g,filter:v}=c;if(v){const C=d.M(v,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===C.result)throw new Error(C.value.map(k=>`${k.key}: ${k.message}`).join(", "));this.filters.set(s,C.value)}const w=this.interactionsByType.get(g)||new Map;0===w.size&&(Yf.includes(g)?this.map.on(g,c.featureset,this.handleType):this.map.on(g,this.handleType),this.interactionsByType.set(g,w)),w.set(s,c),this.typeById.set(s,g)}remove(s){const c=this.typeById.get(s);if(!c)return;this.typeById.delete(s),this.filters.delete(s);const g=this.interactionsByType.get(c);g&&(g.delete(s),0===g.size&&this.map.off(c,this.handleType))}handleType(s){const c=this.interactionsByType.get(s.type),g=Array.from(c).reverse(),v=[];for(const[,k]of g)k.featureset&&v.push({featureset:k.featureset,filter:k.filter,radius:k.radius});let w=this.map.style.queryRenderedFeaturesForInteractions(s.point,v,this.map.transform);!w.length&&Yf.includes(s.type)&&(w=[null]);let C=!1;for(const k of w){for(const[O,B]of g){const{handler:F,featureset:j}=B;if(j&&(null==k||d.bi(k.featureset,j))&&!1!==F(new Uu(s,O,B,k))){C=!0;break}}if(C)break}if(!C)for(const[k,O]of g){const{handler:B,featureset:F}=O;if(!F&&!1!==B(new Uu(s,k,O,null)))break}}}function gp(m,s){if(Array.isArray(m)&&Array.isArray(s)){const c=new Set(m),g=new Set(s);return c.size===g.size&&m.every(v=>g.has(v))}return d.bi(m,s)}const qd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1},nc={showCompass:!0,showZoom:!0,visualizePitch:!1};class fa{constructor(s,c,g=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new dg({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new iu({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),d.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),yn()}move(s,c){const g=this.map,v=this.mouseRotate.mousemoveWindow(s,c),w=v&&v.bearingDelta;if(w&&g.setBearing(g.getBearing()+w),this.mousePitch){const C=this.mousePitch.mousemoveWindow(s,c),k=C&&C.pitchDelta;k&&g.setPitch(g.getPitch()+k)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Bt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(d.l({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),qe(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,qe(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=kt(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){1!==s.targetTouches.length?this.reset():(this._lastPos=kt(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ia(m,s,c){if(m=new d.bL(m.lng,m.lat),s){const g=new d.bL(m.lng-360,m.lat),v=new d.bL(m.lng+360,m.lat),w=360*Math.ceil(Math.abs(m.lng-c.center.lng)/360),C=c.locationPoint(m).distSqr(s),k=s.x<0||s.y<0||s.x>c.width||s.y>c.height;c.locationPoint(g).distSqr(s)<C&&(k||Math.abs(g.lng-c.center.lng)<w)?m=g:c.locationPoint(v).distSqr(s)<C&&(k||Math.abs(v.lng-c.center.lng)<w)&&(m=v)}for(;Math.abs(m.lng-c.center.lng)>180;){const g=c.locationPoint(m);if(g.x>=0&&g.y>=0&&g.x<=c.width&&g.y<=c.height)break;m.lng>c.center.lng?m.lng-=360:m.lng+=360}return m}const Sc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class mt extends d.E{constructor(s,c){if(super(),(s instanceof HTMLElement||c)&&(s=d.l({element:s},c)),d.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=d.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=it("div");const w=41,C=27,k=dt("svg",{display:"block",height:w*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${w}`},this._element),O=dt("radialGradient",{id:"shadowGradient"},dt("defs",{},k));dt("stop",{offset:"10%","stop-opacity":.4},O),dt("stop",{offset:"100%","stop-opacity":.05},O),dt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),dt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),dt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),dt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=d.P.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const g=this._element.classList;for(const w in Sc)g.remove(`mapboxgl-marker-anchor-${w}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);const v=s&&s.className?s.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=d.bL.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const c=s.code,g=s.charCode||s.keyCode;"Space"!==c&&"Enter"!==c&&32!==g&&13!==g||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,g=this._element;this._popup&&(c===g||g.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,c=this._pos;if(!s||!c)return!1;const g=s.unproject(c),v=s.getFreeCameraOptions();if(!v.position)return!1;const w=v.position.toLngLat();return w.distanceTo(g)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const c=this._pos;if(!c||c.x<0||c.x>s.transform.width||c.y<0||c.y>s.transform.height)return void this._clearFadeTimer();const g=s.unproject(c);let v;s._showingGlobe()&&d.dz(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${s.x}px,${s.y}px)\n            ${Sc[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${c.x}px,${c.y}px)\n        `}_calculateXYTransform(){const s=this._pos,c=this._map,g=this.getPitchAlignment();if(!c||!s||"map"!==g)return"";if(!c._showingGlobe()){const O=c.getPitch();return O?`rotateX(${O}deg)`:""}const v=d.c1(d.dA(c.transform,this._lngLat)),w=s.sub(d.dB(c.transform)),C=Math.abs(w.x)+Math.abs(w.y);if(0===C)return"";const k=v/C;return`rotateX(${-w.y*k}deg) rotateY(${w.x*k}deg)`}_calculateZTransform(){const s=this._pos,c=this._map;if(!c||!s)return"";let g=0;const v=this.getRotationAlignment();if("map"===v)if(c._showingGlobe()){const w=c.project(new d.bL(this._lngLat.lng,this._lngLat.lat+.001)),C=c.project(new d.bL(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);g=d.c1(Math.atan2(C.y,C.x))-90}else g=-c.getBearing();else if("horizon"===v){const w=d.a7(4,6,c.getZoom()),C=d.dB(c.transform);C.y+=w*c.transform.height;const k=s.sub(C),O=d.c1(Math.atan2(k.y,k.x));g=(O>90?O-270:O+90)*(1-w)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Ia(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),!0===s?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=d.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const c=this._map;if(!c)return;const g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){const w=this._clickTolerance||c._clickTolerance;if(s.point.dist(g)<w)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.x("dragstart"))),this.fire(new d.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new d.x("dragend")),this._state="inactive"}_addDragHandler(s){const c=this._map,g=this._pos;c&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const c=this._map;return c&&(s?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const sb={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Oo={maxWidth:100,unit:"metric"},gg={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_p={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ab=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Us(m=new d.P(0,0),s="bottom"){if("number"==typeof m){const c=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(s){case"top":return new d.P(0,m);case"top-left":return new d.P(c,c);case"top-right":return new d.P(-c,c);case"bottom":return new d.P(0,-m);case"bottom-left":return new d.P(c,-c);case"bottom-right":return new d.P(-c,-c);case"left":return new d.P(m,0);case"right":return new d.P(-m,0)}return new d.P(0,0)}return m instanceof d.P||Array.isArray(m)?d.P.convert(m):d.P.convert(m[s]||[0,0])}return{version:Qe,supported:Gt.supported,setRTLTextPlugin:d.dC,getRTLTextPluginStatus:d.dD,Map:class extends fg{constructor(m){De.mark(xt.create);const s=m;if(null!=(m=d.l({},qd,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&d.dx(window)&&(m.antialias=!1,d.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new yd(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new fp,this._domRenderTaskQueue=new fp,this._controls=[],this._markers=[],this._popups=[],this._mapId=d.aQ(),this._locale=d.l({},mp,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Zf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Lt(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?{...m.contextCreateOptions}:{},"string"==typeof m.container){const c=document.getElementById(m.container);if(!c)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=c}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&d.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),d.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new lg),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new os(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||d.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new sp("string"==typeof m.hash&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==s.center&&null==s.zoom||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const c=m.bounds;c&&(this.resize(),this.fitBounds(c,d.l({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Xf({customAttribution:m.customAttribution})),this._logoControl=new pp,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new d.x(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new d.x(`${c.dataType}dataloading`,c))}),this._interactions=new mg(this)}_getMapId(){return this._mapId}addControl(m,s){if(void 0===s&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[s];return-1!==s.indexOf("bottom")?g.insertBefore(c,g.firstChild):g.appendChild(c),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new d.x("movestart",m)).fire(new d.x("move",m)),this.fire(new d.x("resize",m)),s&&this.fire(new d.x("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(d.as.convert(m)),this._update()}setMinZoom(m){if((m=null!=m?m:-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new d.x("zoomstart")).fire(new d.x("zoom")).fire(new d.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=null!=m?m:22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new d.x("zoomstart")).fire(new d.x("zoom")).fire(new d.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=null!=m?m:0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new d.x("pitchstart")).fire(new d.x("pitch")).fire(new d.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=null!=m?m:85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new d.x("pitchstart")).fire(new d.x("pitch")).fire(new d.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(s=>"symbol"===s.type),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return"auto"===m?navigator.language:Array.isArray(m)?0===m.length?void 0:m.map(s=>"auto"===s?navigator.language:s):m}setLanguage(m){const s=this._parseLanguage(m);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(m){return this._lazyInitEmptyStyle(),m?"string"==typeof m&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const m=this.transform,s=m.projection.name;let c;"globe"===s&&m.zoom>=d.bV?(m.setMercatorFromTransition(),c=!0):"mercator"===s&&m.zoom<d.bV&&(m.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,s){return this._updateProjection(m||s||{name:"mercator"})}_updateProjection(m){let s;return s="globe"===m.name&&this.transform.zoom>=d.bV?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m){return this.transform.locationPoint3D(d.bL.convert(m))}unproject(m){return this.transform.pointLocation3D(d.P.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,s,c){const g=v=>{let w=[];if(Array.isArray(s)){const C=s.filter(k=>this.getLayer(k));w=C.length?this.queryRenderedFeatures(v,{layers:C}):[]}else w=this.queryRenderedFeatures(v,{featureset:s});return w};if("mouseenter"===m||"mouseover"===m){let v=!1;return{listener:c,targets:s,delegates:{mousemove:C=>{const k=g(C.point);k.length?v||(v=!0,c.call(this,new Nr(m,this,C.originalEvent,{features:k}))):v=!1},mouseout:()=>{v=!1}}}}if("mouseleave"===m||"mouseout"===m){let v=!1;return{listener:c,targets:s,delegates:{mousemove:k=>{g(k.point).length?v=!0:v&&(v=!1,c.call(this,new Nr(m,this,k.originalEvent)))},mouseout:k=>{v&&(v=!1,c.call(this,new Nr(m,this,k.originalEvent)))}}}}{const v=w=>{const C=g(w.point);C.length&&(w.features=C,c.call(this,w),delete w.features)};return{listener:c,targets:s,delegates:{[m]:v}}}}on(m,s,c){if("function"==typeof s||void 0===c)return super.on(m,s);if("string"==typeof s&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._createDelegatedListener(m,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(m,s,c){if("function"==typeof s||void 0===c)return super.once(m,s);if("string"==typeof s&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._createDelegatedListener(m,s,c);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(m,s,c){if("function"==typeof s||void 0===c)return super.off(m,s);if("string"==typeof s&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(v=>{for(let w=0;w<v.length;w++){const C=v[w];if(C.listener===c&&gp(C.targets,s)){for(const k in C.delegates)this.off(k,C.delegates[k]);return v.splice(w,1),this}}})(g),this}queryRenderedFeatures(m,s){if(!this.style)return[];if(void 0!==s||void 0===m||m instanceof d.P||Array.isArray(m)||(s=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],"featureset"in(s=s||{}))return this._isFeaturesetDescriptorValid(s.featureset)?this.style.queryRenderedFeaturesForInteractions(m,[s],this.transform):[];if(s.layers&&Array.isArray(s.layers))for(const c of s.layers)if(!this._isValidId(c))return[];return this.style.queryRenderedFeatures(m,s,this.transform)}querySourceFeatures(m,s){return!m||"string"==typeof m&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,s)}isPointOnSurface(m){const{name:s}=this.transform.projection;return"globe"!==s&&"mercator"!==s&&d.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(d.P.convert(m))}addInteraction(m,s){return this._interactions.add(m,s),this}removeInteraction(m){return this._interactions.remove(m),this}setStyle(m,s){return s=d.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&m&&!1!==s.diff&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(m,(c,g)=>{c?(d.w(`Unable to perform style diff: ${String(c.message||c.error||c)}. Rebuilding the style from scratch.`),this._updateStyle(m,s)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(m,s))}_getUIString(m){const s=this._locale[m];if(null==s)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const c=d.l({},s);s&&s.config&&(c.initialConfig=s.config,delete c.config),this.style=new Ai(this,c).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ai(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(d.w("There is no style added to the map."),!1)}_isValidId(m){return null==m?(this.fire(new d.t(new Error("IDs can't be empty."))),!1):!d.aK(m)||(this.fire(new d.t(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isFeaturesetDescriptorValid(m){return"featuresetId"in m?this._isValidId(m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const s of m)if(!this._isValidId(s))return!1;return!0}return this._isFeaturesetDescriptorValid(m)}addSource(m,s){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,s,c){this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,c)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,s,{pixelRatio:c=1,sdf:g=!1,stretchX:v,stretchY:w,content:C}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:k,height:O,data:B}=d.q.getImageData(s);this.style.addImage(m,{data:new d.r({width:k,height:O},B),pixelRatio:c,stretchX:v,stretchY:w,content:C,sdf:g,version:0})}else if(void 0===s.width||void 0===s.height)this.fire(new d.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:O}=s,B=s;this.style.addImage(m,{data:new d.r({width:k,height:O},new Uint8Array(B.data)),pixelRatio:c,stretchX:v,stretchY:w,content:C,sdf:g,version:0,userImage:B}),B.onAdd&&B.onAdd(this,m)}}updateImage(m,s){this._lazyInitEmptyStyle();const c=this.style.getImage(m);if(!c)return void this.fire(new d.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?d.q.getImageData(s):s,{width:v,height:w,data:C}=g;if(void 0===v||void 0===w)return void this.fire(new d.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==c.data.width||w!==c.data.height)return void this.fire(new d.t(new Error(`The width and height of the updated image (${v}, ${w})\n                must be that same as the previous version of the image\n                (${c.data.width}, ${c.data.height})`)));const k=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);c.data.replace(C,k),this.style.updateImage(m,c)}hasImage(m){return m?!!this.style&&!!this.style.getImage(m):(this.fire(new d.t(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,s){d.o(this._requestManager.transformRequest(m,d.R.Image),(c,g)=>{s(c,g instanceof HTMLImageElement?d.q.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(m,s){this._lazyInitEmptyStyle(),this.style.addModel(m,s)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new d.t(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,s){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)):this}getSlot(m){const s=this.getLayer(m);return s&&s.slot||null}setSlot(m,s){return this.style.setSlot(m,s),this.style.mergeLayers(),this._update(!0)}addImport(m,s){return this.style.addImport(m,s),this}updateImport(m,s){return"string"!=typeof s&&s.id!==m?(this.removeImport(m),this.addImport(s)):(this.style.updateImport(m,s),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,s){return this.style.moveImport(m,s),this._update(!0)}moveLayer(m,s){return this._isValidId(m)?(this.style.moveLayer(m,s),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const s=this.style.getOwnLayer(m);return s?"custom"===s.type?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,s,c){return this._isValidId(m)?(this.style.setLayerZoomRange(m,s,c),this._update(!0)):this}setFilter(m,s,c={}){return this._isValidId(m)?(this.style.setFilter(m,s,c),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,s,c,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,s,c,g),this._update(!0)):this}getPaintProperty(m,s){return this._isValidId(m)?this.style.getPaintProperty(m,s):null}setLayoutProperty(m,s,c,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,s,c,g),this._update(!0)):this}getLayoutProperty(m,s){return this._isValidId(m)?this.style.getLayoutProperty(m,s):null}getSchema(m){return this.style.getSchema(m)}setSchema(m,s){return this.style.setSchema(m,s),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,s){return this.style.setConfig(m,s),this._update(!0)}getConfigProperty(m,s){return this.style.getConfigProperty(m,s)}setConfigProperty(m,s,c){return this.style.setConfigProperty(m,s,c),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&1===m.length&&"flat"===m[0].type){const s=m[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return 0===m.length&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===m["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.bL.convert(m),this.transform):0}setFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,s),this._update())}removeFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,s),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let c,g,v,w=this._container;for(;w&&(!g||!v);){const C=window.getComputedStyle(w).transform;C&&"none"!==C&&(c=C.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&"0"!==c[0]&&"1"!==c[0]&&(g=c[0]),c[3]&&"0"!==c[3]&&"1"!==c[3]&&(v=c[3])),w=w.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=it("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=it("div","mapboxgl-canvas-container",m);this._canvas=it("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=it("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{g[v]=it("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s){const c=d.q.devicePixelRatio||1;this._canvas.width=c*Math.ceil(m),this._canvas.height=c*Math.ceil(s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const s=this._markers.indexOf(m);-1!==s&&this._markers.splice(s,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const s=this._popups.indexOf(m);-1!==s&&this._popups.splice(s,1)}_setupPainter(){const m=d.l({},Gt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",m);s?(an(s,!0),this.painter=new tu(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),d.m.testSupport(s)):this.fire(new d.t(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.x("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new d.x("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let s;this.fire(new d.x("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,g=d.q.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=v.createQuery(),v.beginQuery(c.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,F=this.transform.pitch,j=d.q.now(),G=new d.a3(B,{now:j,fadeDuration:w,pitch:F,transition:this.style.transition});this.style.update(G)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(g);const k=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),k&&(this._placementDirty=k.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,De.mark(xt.load),this.fire(new d.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const B=d.q.now()-g;v.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const F=v.getQueryParameter(s,v.QUERY_RESULT)/1e6;v.deleteQuery(s),this.fire(new d.x("gpu-timing-frame",{cpuTime:B,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const B=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(B);this.fire(new d.x("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const B=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(B);this.fire(new d.x("gpu-timing-deferred-render",{gpuTime:F}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(O||this._repaint)this.triggerRepaint();else{const B=this.idle();if(B&&(C=this._updateAverageElevation(g,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),B&&(this.fire(new d.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new d.x("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,De.mark(xt.fullLoad),this._performanceMetricsCollection&&cr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const s of this._markers)m&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!m||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(m,s=!1){const c=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(s||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const v=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=m;const C=Math.abs(v-w);if(C>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(w),c(w);this._averageElevation.easeTo(w,m,300)}else if(C>1e-4)return this._averageElevation.jumpTo(w),c(w)}return!!this._averageElevation.isEasing(m)&&c(this._averageElevation.getValue(m))}_authenticate(){ee(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===Ge||401===m.status)){const s=this.painter.context.gl;an(s,!1),this._logoControl instanceof pp&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),lr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&qo(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const c=this.painter.context.gl,g=c.createFramebuffer();function v(w){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,w,0);const C=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,C),C}return c.bindFramebuffer(c.FRAMEBUFFER,g),this._canvasPixelComparison(v(m),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(m,s,c){let g=c[1]-c[0];const v=m.length/4;for(let w=0;w<s.length;w++){const C=s[w];let k=0;for(let O=0;O<C.length;O+=4)C[O]===m[O]&&C[O+1]===m[O+1]&&C[O+2]===m[O+2]&&C[O+3]===m[O+3]&&(k+=1);g+=(c[w+2]-c[w+1])*(1-k/v)}return g}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ge.delete(this.painter.context.gl),ur.remove(),jn.remove(),this._removed=!0,this.fire(new d.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=d.q.frame(s=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(s)}))}_preloadTiles(m){const s=this.style?this.style.getSourceCaches():[];return d.bg(s,(c,g)=>c._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,s){d.dy(m,s)}get version(){return Qe}},NavigationControl:class{constructor(m={}){this.options=d.l({},nc,m),this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(d.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),it("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),it("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(d.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:s}):c.resetNorth({},{originalEvent:s}))}),this._compassIcon=it("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const s=m.getZoom(),c=s===m.getMaxZoom(),g=s===m.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fa(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,s){const c=it("button",m,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(m,s){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${s}`);m.setAttribute("aria-label",c),m.firstElementChild&&m.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends d.E{constructor(m={}){super();const s=navigator.geolocation;this.options=d.l({geolocation:s},sb,m),d.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Jl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const s=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,m(c)};void 0!==this._supportsGeolocation?m(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(c=>s("denied"!==c.state)).catch(()=>s()):s()}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),c=m.coords;return!!s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new d.x("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new d.x("geolocate",m)),this._finish()}}_updateCamera(m){const s=new d.bL(m.coords.longitude,m.coords.latitude),c=m.coords.accuracy,g=this._map.getBearing(),v=d.l({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),v,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new d.bL(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,s=d.bE(1,m._center.lat)*m.worldSize,c=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new d.x("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=it("button","mapboxgl-ctrl-geolocate",this._container),it("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=it("div","mapboxgl-user-location"),this._dotElement.appendChild(it("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(it("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new mt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=it("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new mt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||"ACTIVE_LOCK"!==this._watchState||s.originalEvent&&"resize"===s.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.x("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(s=>{"granted"===s&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xf,ScaleControl:class{constructor(m={}){this.options=d.l({},Oo,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(s){return!1}}(),d.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,s=this._map,c=s._containerHeight/2,g=s._containerWidth/2-m/2,v=s.unproject([g,c]),w=s.unproject([g+m,c]),C=v.distanceTo(w);if("imperial"===this.options.unit){const k=3.2808*C;k>5280?this._setScale(m,k/5280,"mile"):this._setScale(m,k,"foot")}else"nautical"===this.options.unit?this._setScale(m,C/1852,"nautical-mile"):C>=1e3?this._setScale(m,C/1e3,"kilometer"):this._setScale(m,C,"meter")}_setScale(m,s,c){this._map._requestDomTask(()=>{const g=function(w){const C=Math.pow(10,`${Math.floor(w)}`.length-1);let k=w/C;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(O){const B=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*B)/B}(k),C*k}(s),v=g/s;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==c?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(g):`${g}&nbsp;${gg[c]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),d.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=it("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=it("button","mapboxgl-ctrl-fullscreen",this._controlContainer);it("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.E{constructor(m){super(),this.options=d.l(Object.create(_p),m),d.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new d.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new d.x("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=d.bL.convert(m),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),c=document.createElement("body");let g;for(c.innerHTML=m;g=c.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=it("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(m),this.options.closeButton){const c=this._closeButton=it("button","mapboxgl-popup-close-button",s);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let s;return this._classList.delete(m)?s=!1:(this._classList.add(m),s=!0),this._updateClassList(),s}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const s=this._map,c=this._container,g=this._pos;if(!s||!c||!g)return"bottom";const v=c.offsetWidth,w=c.offsetHeight,C=g.x<v/2,k=g.x>s.transform.width-v/2;if(g.y+m<w)return C?"top-left":k?"top-right":"top";if(g.y>s.transform.height-w){if(C)return"bottom-left";if(k)return"bottom-right"}return C?"left":k?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),m.className=s.join(" ")}_update(m){const s=this._map,c=this._content;if(!s||!this._lngLat&&!this._trackPointer||!c)return;let g=this._container;if(g||(g=this._container=it("div","mapboxgl-popup",s.getContainer()),this._tip=it("div","mapboxgl-popup-tip",g),g.appendChild(c)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ia(this._lngLat,this._pos,s.transform)),!this._trackPointer||m){const v=this._pos=this._trackPointer&&m instanceof d.P?m:s.project(this._lngLat),w=Us(this.options.offset),C=this._anchor=this._getAnchor(w.y),k=Us(this.options.offset,C),O=v.add(k).round();s._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${Sc[C]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&s._showingGlobe()){const v=d.dz(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(ab);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:mt,Style:Ai,LngLat:d.bL,LngLatBounds:d.as,Point:d.P,MercatorCoordinate:d.a5,FreeCameraOptions:Ir,Evented:d.E,config:d.e,prewarm:d.dE,clearPrewarmedResources:d.dF,get accessToken(){return d.e.ACCESS_TOKEN},set accessToken(m){d.e.ACCESS_TOKEN=m},get baseApiUrl(){return d.e.API_URL},set baseApiUrl(m){d.e.API_URL=m},get workerCount(){return d.dG.workerCount},set workerCount(m){d.dG.workerCount=m},get maxParallelImageRequests(){return d.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){d.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){d.dH(m)},get workerUrl(){return d.dI.workerUrl},set workerUrl(m){d.dI.workerUrl=m},get workerClass(){return d.dI.workerClass},set workerClass(m){d.dI.workerClass=m},get workerParams(){return d.dI.workerParams},set workerParams(m){d.dI.workerParams=m},get dracoUrl(){return d.dJ()},set dracoUrl(m){d.dK(m)},get meshoptUrl(){return d.dL()},set meshoptUrl(m){d.dM(m)},setNow:d.q.setNow,restoreNow:d.q.restoreNow}}),Ue}()},9611:(kn,Fn,yt)=>{!function(Ue){Ue.parser=function(ee,ge){return new Xe(ee,ge)},Ue.SAXParser=Xe,Ue.SAXStream=en,Ue.createStream=function zt(ee,ge){return new en(ee,ge)},Ue.MAX_BUFFER_LENGTH=65536;var De,et=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function Xe(ee,ge){if(!(this instanceof Xe))return new Xe(ee,ge);var an=this;(function Qe(ee){for(var ge=0,an=et.length;ge<an;ge++)ee[et[ge]]=""})(an),an.q=an.c="",an.bufferCheckPosition=Ue.MAX_BUFFER_LENGTH,an.opt=ge||{},an.opt.lowercase=an.opt.lowercase||an.opt.lowercasetags,an.looseCase=an.opt.lowercase?"toLowerCase":"toUpperCase",an.tags=[],an.closed=an.closedRoot=an.sawRoot=!1,an.tag=an.error=null,an.strict=!!ee,an.noscript=!(!ee&&!an.opt.noscript),an.state=Be.BEGIN,an.strictEntities=an.opt.strictEntities,an.ENTITIES=Object.create(an.strictEntities?Ue.XML_ENTITIES:Ue.ENTITIES),an.attribList=[],an.opt.xmlns&&(an.ns=Object.create(bn)),an.trackPosition=!1!==an.opt.position,an.trackPosition&&(an.position=an.line=an.column=0),Lt(an,"onready")}Ue.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(ee){function ge(){}return ge.prototype=ee,new ge}),Object.keys||(Object.keys=function(ee){var ge=[];for(var an in ee)ee.hasOwnProperty(an)&&ge.push(an);return ge}),Xe.prototype={end:function(){Dn(this)},write:function ur(ee){var ge=this;if(this.error)throw this.error;if(ge.closed)return Mn(ge,"Cannot write after close. Assign an onready handler.");if(null===ee)return Dn(ge);"object"==typeof ee&&(ee=ee.toString());for(var an=0,Dt="";Dt=cr(ee,an++),ge.c=Dt,Dt;)switch(ge.trackPosition&&(ge.position++,"\n"===Dt?(ge.line++,ge.column=0):ge.column++),ge.state){case Be.BEGIN:if(ge.state=Be.BEGIN_WHITESPACE,"\ufeff"===Dt)continue;Fs(ge,Dt);continue;case Be.BEGIN_WHITESPACE:Fs(ge,Dt);continue;case Be.TEXT:if(ge.sawRoot&&!ge.closedRoot){for(var jt=an-1;Dt&&"<"!==Dt&&"&"!==Dt;)(Dt=cr(ee,an++))&&ge.trackPosition&&(ge.position++,"\n"===Dt?(ge.line++,ge.column=0):ge.column++);ge.textNode+=ee.substring(jt,an-1)}"<"!==Dt||ge.sawRoot&&ge.closedRoot&&!ge.strict?(!Re(Dt)&&(!ge.sawRoot||ge.closedRoot)&&_n(ge,"Text data outside of root node."),"&"===Dt?ge.state=Be.TEXT_ENTITY:ge.textNode+=Dt):(ge.state=Be.OPEN_WAKA,ge.startTagPosition=ge.position);continue;case Be.SCRIPT:"<"===Dt?ge.state=Be.SCRIPT_ENDING:ge.script+=Dt;continue;case Be.SCRIPT_ENDING:"/"===Dt?ge.state=Be.CLOSE_TAG:(ge.script+="<"+Dt,ge.state=Be.SCRIPT);continue;case Be.OPEN_WAKA:"!"===Dt?(ge.state=Be.SGML_DECL,ge.sgmlDecl=""):Re(Dt)||(xe(Jn,Dt)?(ge.state=Be.OPEN_TAG,ge.tagName=Dt):"/"===Dt?(ge.state=Be.CLOSE_TAG,ge.tagName=""):"?"===Dt?(ge.state=Be.PROC_INST,ge.procInstName=ge.procInstBody=""):(_n(ge,"Unencoded <"),ge.startTagPosition+1<ge.position&&(Dt=new Array(ge.position-ge.startTagPosition).join(" ")+Dt),ge.textNode+="<"+Dt,ge.state=Be.TEXT));continue;case Be.SGML_DECL:"[CDATA["===(ge.sgmlDecl+Dt).toUpperCase()?(bt(ge,"onopencdata"),ge.state=Be.CDATA,ge.sgmlDecl="",ge.cdata=""):ge.sgmlDecl+Dt==="--"?(ge.state=Be.COMMENT,ge.comment="",ge.sgmlDecl=""):"DOCTYPE"===(ge.sgmlDecl+Dt).toUpperCase()?(ge.state=Be.DOCTYPE,(ge.doctype||ge.sawRoot)&&_n(ge,"Inappropriately located doctype declaration"),ge.doctype="",ge.sgmlDecl=""):">"===Dt?(bt(ge,"onsgmldeclaration",ge.sgmlDecl),ge.sgmlDecl="",ge.state=Be.TEXT):(qe(Dt)&&(ge.state=Be.SGML_DECL_QUOTED),ge.sgmlDecl+=Dt);continue;case Be.SGML_DECL_QUOTED:Dt===ge.q&&(ge.state=Be.SGML_DECL,ge.q=""),ge.sgmlDecl+=Dt;continue;case Be.DOCTYPE:">"===Dt?(ge.state=Be.TEXT,bt(ge,"ondoctype",ge.doctype),ge.doctype=!0):(ge.doctype+=Dt,"["===Dt?ge.state=Be.DOCTYPE_DTD:qe(Dt)&&(ge.state=Be.DOCTYPE_QUOTED,ge.q=Dt));continue;case Be.DOCTYPE_QUOTED:ge.doctype+=Dt,Dt===ge.q&&(ge.q="",ge.state=Be.DOCTYPE);continue;case Be.DOCTYPE_DTD:ge.doctype+=Dt,"]"===Dt?ge.state=Be.DOCTYPE:qe(Dt)&&(ge.state=Be.DOCTYPE_DTD_QUOTED,ge.q=Dt);continue;case Be.DOCTYPE_DTD_QUOTED:ge.doctype+=Dt,Dt===ge.q&&(ge.state=Be.DOCTYPE_DTD,ge.q="");continue;case Be.COMMENT:"-"===Dt?ge.state=Be.COMMENT_ENDING:ge.comment+=Dt;continue;case Be.COMMENT_ENDING:"-"===Dt?(ge.state=Be.COMMENT_ENDED,ge.comment=Wt(ge.opt,ge.comment),ge.comment&&bt(ge,"oncomment",ge.comment),ge.comment=""):(ge.comment+="-"+Dt,ge.state=Be.COMMENT);continue;case Be.COMMENT_ENDED:">"!==Dt?(_n(ge,"Malformed comment"),ge.comment+="--"+Dt,ge.state=Be.COMMENT):ge.state=Be.TEXT;continue;case Be.CDATA:"]"===Dt?ge.state=Be.CDATA_ENDING:ge.cdata+=Dt;continue;case Be.CDATA_ENDING:"]"===Dt?ge.state=Be.CDATA_ENDING_2:(ge.cdata+="]"+Dt,ge.state=Be.CDATA);continue;case Be.CDATA_ENDING_2:">"===Dt?(ge.cdata&&bt(ge,"oncdata",ge.cdata),bt(ge,"onclosecdata"),ge.cdata="",ge.state=Be.TEXT):"]"===Dt?ge.cdata+="]":(ge.cdata+="]]"+Dt,ge.state=Be.CDATA);continue;case Be.PROC_INST:"?"===Dt?ge.state=Be.PROC_INST_ENDING:Re(Dt)?ge.state=Be.PROC_INST_BODY:ge.procInstName+=Dt;continue;case Be.PROC_INST_BODY:if(!ge.procInstBody&&Re(Dt))continue;"?"===Dt?ge.state=Be.PROC_INST_ENDING:ge.procInstBody+=Dt;continue;case Be.PROC_INST_ENDING:">"===Dt?(bt(ge,"onprocessinginstruction",{name:ge.procInstName,body:ge.procInstBody}),ge.procInstName=ge.procInstBody="",ge.state=Be.TEXT):(ge.procInstBody+="?"+Dt,ge.state=Be.PROC_INST_BODY);continue;case Be.OPEN_TAG:xe(yn,Dt)?ge.tagName+=Dt:(Gn(ge),">"===Dt?lr(ge):"/"===Dt?ge.state=Be.OPEN_TAG_SLASH:(Re(Dt)||_n(ge,"Invalid character in tag name"),ge.state=Be.ATTRIB));continue;case Be.OPEN_TAG_SLASH:">"===Dt?(lr(ge,!0),fn(ge)):(_n(ge,"Forward-slash in opening tag not followed by >"),ge.state=Be.ATTRIB);continue;case Be.ATTRIB:if(Re(Dt))continue;">"===Dt?lr(ge):"/"===Dt?ge.state=Be.OPEN_TAG_SLASH:xe(Jn,Dt)?(ge.attribName=Dt,ge.attribValue="",ge.state=Be.ATTRIB_NAME):_n(ge,"Invalid attribute name");continue;case Be.ATTRIB_NAME:"="===Dt?ge.state=Be.ATTRIB_VALUE:">"===Dt?(_n(ge,"Attribute without value"),ge.attribValue=ge.attribName,jn(ge),lr(ge)):Re(Dt)?ge.state=Be.ATTRIB_NAME_SAW_WHITE:xe(yn,Dt)?ge.attribName+=Dt:_n(ge,"Invalid attribute name");continue;case Be.ATTRIB_NAME_SAW_WHITE:if("="===Dt)ge.state=Be.ATTRIB_VALUE;else{if(Re(Dt))continue;_n(ge,"Attribute without value"),ge.tag.attributes[ge.attribName]="",ge.attribValue="",bt(ge,"onattribute",{name:ge.attribName,value:""}),ge.attribName="",">"===Dt?lr(ge):xe(Jn,Dt)?(ge.attribName=Dt,ge.state=Be.ATTRIB_NAME):(_n(ge,"Invalid attribute name"),ge.state=Be.ATTRIB)}continue;case Be.ATTRIB_VALUE:if(Re(Dt))continue;qe(Dt)?(ge.q=Dt,ge.state=Be.ATTRIB_VALUE_QUOTED):(_n(ge,"Unquoted attribute value"),ge.state=Be.ATTRIB_VALUE_UNQUOTED,ge.attribValue=Dt);continue;case Be.ATTRIB_VALUE_QUOTED:if(Dt!==ge.q){"&"===Dt?ge.state=Be.ATTRIB_VALUE_ENTITY_Q:ge.attribValue+=Dt;continue}jn(ge),ge.q="",ge.state=Be.ATTRIB_VALUE_CLOSED;continue;case Be.ATTRIB_VALUE_CLOSED:Re(Dt)?ge.state=Be.ATTRIB:">"===Dt?lr(ge):"/"===Dt?ge.state=Be.OPEN_TAG_SLASH:xe(Jn,Dt)?(_n(ge,"No whitespace between attributes"),ge.attribName=Dt,ge.attribValue="",ge.state=Be.ATTRIB_NAME):_n(ge,"Invalid attribute name");continue;case Be.ATTRIB_VALUE_UNQUOTED:if(!kt(Dt)){"&"===Dt?ge.state=Be.ATTRIB_VALUE_ENTITY_U:ge.attribValue+=Dt;continue}jn(ge),">"===Dt?lr(ge):ge.state=Be.ATTRIB;continue;case Be.CLOSE_TAG:if(ge.tagName)">"===Dt?fn(ge):xe(yn,Dt)?ge.tagName+=Dt:ge.script?(ge.script+="</"+ge.tagName,ge.tagName="",ge.state=Be.SCRIPT):(Re(Dt)||_n(ge,"Invalid tagname in closing tag"),ge.state=Be.CLOSE_TAG_SAW_WHITE);else{if(Re(Dt))continue;at(Jn,Dt)?ge.script?(ge.script+="</"+Dt,ge.state=Be.SCRIPT):_n(ge,"Invalid tagname in closing tag."):ge.tagName=Dt}continue;case Be.CLOSE_TAG_SAW_WHITE:if(Re(Dt))continue;">"===Dt?fn(ge):_n(ge,"Invalid characters in closing tag");continue;case Be.TEXT_ENTITY:case Be.ATTRIB_VALUE_ENTITY_Q:case Be.ATTRIB_VALUE_ENTITY_U:var zi,_o;switch(ge.state){case Be.TEXT_ENTITY:zi=Be.TEXT,_o="textNode";break;case Be.ATTRIB_VALUE_ENTITY_Q:zi=Be.ATTRIB_VALUE_QUOTED,_o="attribValue";break;case Be.ATTRIB_VALUE_ENTITY_U:zi=Be.ATTRIB_VALUE_UNQUOTED,_o="attribValue"}if(";"===Dt)if(ge.opt.unparsedEntities){var ri=qo(ge);ge.entity="",ge.state=zi,ge.write(ri)}else ge[_o]+=qo(ge),ge.entity="",ge.state=zi;else xe(ge.entity.length?Rn:Bt,Dt)?ge.entity+=Dt:(_n(ge,"Invalid character in entity name"),ge[_o]+="&"+ge.entity+Dt,ge.entity="",ge.state=zi);continue;default:throw new Error(ge,"Unknown state: "+ge.state)}return ge.position>=ge.bufferCheckPosition&&function d(ee){for(var ge=Math.max(Ue.MAX_BUFFER_LENGTH,10),an=0,Dt=0,jt=et.length;Dt<jt;Dt++){var to=ee[et[Dt]].length;if(to>ge)switch(et[Dt]){case"textNode":lt(ee);break;case"cdata":bt(ee,"oncdata",ee.cdata),ee.cdata="";break;case"script":bt(ee,"onscript",ee.script),ee.script="";break;default:Mn(ee,"Max buffer length exceeded: "+et[Dt])}an=Math.max(an,to)}ee.bufferCheckPosition=Ue.MAX_BUFFER_LENGTH-an+ee.position}(ge),ge},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){!function xt(ee){lt(ee),""!==ee.cdata&&(bt(ee,"oncdata",ee.cdata),ee.cdata=""),""!==ee.script&&(bt(ee,"onscript",ee.script),ee.script="")}(this)}};try{De=yt(5398).Stream}catch(ee){De=function(){}}De||(De=function(){});var Tt=Ue.EVENTS.filter(function(ee){return"error"!==ee&&"end"!==ee});function en(ee,ge){if(!(this instanceof en))return new en(ee,ge);De.apply(this),this._parser=new Xe(ee,ge),this.writable=!0,this.readable=!0;var an=this;this._parser.onend=function(){an.emit("end")},this._parser.onerror=function(Dt){an.emit("error",Dt),an._parser.error=null},this._decoder=null,Tt.forEach(function(Dt){Object.defineProperty(an,"on"+Dt,{get:function(){return an._parser["on"+Dt]},set:function(jt){if(!jt)return an.removeAllListeners(Dt),an._parser["on"+Dt]=jt,jt;an.on(Dt,jt)},enumerable:!0,configurable:!1})})}(en.prototype=Object.create(De.prototype,{constructor:{value:en}})).write=function(ee){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(ee)){if(!this._decoder){var ge=yt(3054).s;this._decoder=new ge("utf8")}ee=this._decoder.write(ee)}return this._parser.write(ee.toString()),this.emit("data",ee),!0},en.prototype.end=function(ee){return ee&&ee.length&&this.write(ee),this._parser.end(),!0},en.prototype.on=function(ee,ge){var an=this;return!an._parser["on"+ee]&&-1!==Tt.indexOf(ee)&&(an._parser["on"+ee]=function(){var Dt=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);Dt.splice(0,0,ee),an.emit.apply(an,Dt)}),De.prototype.on.call(an,ee,ge)};var dt="http://www.w3.org/XML/1998/namespace",Mt="http://www.w3.org/2000/xmlns/",bn={xml:dt,xmlns:Mt},Jn=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,yn=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,Bt=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Rn=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function Re(ee){return" "===ee||"\n"===ee||"\r"===ee||"\t"===ee}function qe(ee){return'"'===ee||"'"===ee}function kt(ee){return">"===ee||Re(ee)}function xe(ee,ge){return ee.test(ge)}function at(ee,ge){return!xe(ee,ge)}var ee,ge,an,Be=0;for(var Ge in Ue.STATE={BEGIN:Be++,BEGIN_WHITESPACE:Be++,TEXT:Be++,TEXT_ENTITY:Be++,OPEN_WAKA:Be++,SGML_DECL:Be++,SGML_DECL_QUOTED:Be++,DOCTYPE:Be++,DOCTYPE_QUOTED:Be++,DOCTYPE_DTD:Be++,DOCTYPE_DTD_QUOTED:Be++,COMMENT_STARTING:Be++,COMMENT:Be++,COMMENT_ENDING:Be++,COMMENT_ENDED:Be++,CDATA:Be++,CDATA_ENDING:Be++,CDATA_ENDING_2:Be++,PROC_INST:Be++,PROC_INST_BODY:Be++,PROC_INST_ENDING:Be++,OPEN_TAG:Be++,OPEN_TAG_SLASH:Be++,ATTRIB:Be++,ATTRIB_NAME:Be++,ATTRIB_NAME_SAW_WHITE:Be++,ATTRIB_VALUE:Be++,ATTRIB_VALUE_QUOTED:Be++,ATTRIB_VALUE_CLOSED:Be++,ATTRIB_VALUE_UNQUOTED:Be++,ATTRIB_VALUE_ENTITY_Q:Be++,ATTRIB_VALUE_ENTITY_U:Be++,CLOSE_TAG:Be++,CLOSE_TAG_SAW_WHITE:Be++,SCRIPT:Be++,SCRIPT_ENDING:Be++},Ue.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},Ue.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(Ue.ENTITIES).forEach(function(ee){var ge=Ue.ENTITIES[ee],an="number"==typeof ge?String.fromCharCode(ge):ge;Ue.ENTITIES[ee]=an}),Ue.STATE)Ue.STATE[Ue.STATE[Ge]]=Ge;function Lt(ee,ge,an){ee[ge]&&ee[ge](an)}function bt(ee,ge,an){ee.textNode&&lt(ee),Lt(ee,ge,an)}function lt(ee){ee.textNode=Wt(ee.opt,ee.textNode),ee.textNode&&Lt(ee,"ontext",ee.textNode),ee.textNode=""}function Wt(ee,ge){return ee.trim&&(ge=ge.trim()),ee.normalize&&(ge=ge.replace(/\s+/g," ")),ge}function Mn(ee,ge){return lt(ee),ee.trackPosition&&(ge+="\nLine: "+ee.line+"\nColumn: "+ee.column+"\nChar: "+ee.c),ge=new Error(ge),ee.error=ge,Lt(ee,"onerror",ge),ee}function Dn(ee){return ee.sawRoot&&!ee.closedRoot&&_n(ee,"Unclosed root tag"),ee.state!==Be.BEGIN&&ee.state!==Be.BEGIN_WHITESPACE&&ee.state!==Be.TEXT&&Mn(ee,"Unexpected end"),lt(ee),ee.c="",ee.closed=!0,Lt(ee,"onend"),Xe.call(ee,ee.strict,ee.opt),ee}function _n(ee,ge){if("object"!=typeof ee||!(ee instanceof Xe))throw new Error("bad call to strictFail");ee.strict&&Mn(ee,ge)}function Gn(ee){ee.strict||(ee.tagName=ee.tagName[ee.looseCase]());var ge=ee.tags[ee.tags.length-1]||ee,an=ee.tag={name:ee.tagName,attributes:{}};ee.opt.xmlns&&(an.ns=ge.ns),ee.attribList.length=0,bt(ee,"onopentagstart",an)}function jr(ee,ge){var Dt=ee.indexOf(":")<0?["",ee]:ee.split(":"),jt=Dt[0],to=Dt[1];return ge&&"xmlns"===ee&&(jt="xmlns",to=""),{prefix:jt,local:to}}function jn(ee){if(ee.strict||(ee.attribName=ee.attribName[ee.looseCase]()),-1!==ee.attribList.indexOf(ee.attribName)||ee.tag.attributes.hasOwnProperty(ee.attribName))ee.attribName=ee.attribValue="";else{if(ee.opt.xmlns){var ge=jr(ee.attribName,!0),Dt=ge.local;if("xmlns"===ge.prefix)if("xml"===Dt&&ee.attribValue!==dt)_n(ee,"xml: prefix must be bound to "+dt+"\nActual: "+ee.attribValue);else if("xmlns"===Dt&&ee.attribValue!==Mt)_n(ee,"xmlns: prefix must be bound to "+Mt+"\nActual: "+ee.attribValue);else{var jt=ee.tag,to=ee.tags[ee.tags.length-1]||ee;jt.ns===to.ns&&(jt.ns=Object.create(to.ns)),jt.ns[Dt]=ee.attribValue}ee.attribList.push([ee.attribName,ee.attribValue])}else ee.tag.attributes[ee.attribName]=ee.attribValue,bt(ee,"onattribute",{name:ee.attribName,value:ee.attribValue});ee.attribName=ee.attribValue=""}}function lr(ee,ge){if(ee.opt.xmlns){var an=ee.tag,Dt=jr(ee.tagName);an.prefix=Dt.prefix,an.local=Dt.local,an.uri=an.ns[Dt.prefix]||"",an.prefix&&!an.uri&&(_n(ee,"Unbound namespace prefix: "+JSON.stringify(ee.tagName)),an.uri=Dt.prefix),an.ns&&(ee.tags[ee.tags.length-1]||ee).ns!==an.ns&&Object.keys(an.ns).forEach(function(Tn){bt(ee,"onopennamespace",{prefix:Tn,uri:an.ns[Tn]})});for(var to=0,zi=ee.attribList.length;to<zi;to++){var _o=ee.attribList[to],ri=_o[0],Pe=_o[1],ie=jr(ri,!0),ue=ie.prefix,Et=""===ue?"":an.ns[ue]||"",Pt={name:ri,value:Pe,prefix:ue,local:ie.local,uri:Et};ue&&"xmlns"!==ue&&!Et&&(_n(ee,"Unbound namespace prefix: "+JSON.stringify(ue)),Pt.uri=ue),ee.tag.attributes[ri]=Pt,bt(ee,"onattribute",Pt)}ee.attribList.length=0}ee.tag.isSelfClosing=!!ge,ee.sawRoot=!0,ee.tags.push(ee.tag),bt(ee,"onopentag",ee.tag),ge||(ee.state=ee.noscript||"script"!==ee.tagName.toLowerCase()?Be.TEXT:Be.SCRIPT,ee.tag=null,ee.tagName=""),ee.attribName=ee.attribValue="",ee.attribList.length=0}function fn(ee){if(!ee.tagName)return _n(ee,"Weird empty close tag."),ee.textNode+="</>",void(ee.state=Be.TEXT);if(ee.script){if("script"!==ee.tagName)return ee.script+="</"+ee.tagName+">",ee.tagName="",void(ee.state=Be.SCRIPT);bt(ee,"onscript",ee.script),ee.script=""}var ge=ee.tags.length,an=ee.tagName;ee.strict||(an=an[ee.looseCase]());for(var Dt=an;ge--&&ee.tags[ge].name!==Dt;)_n(ee,"Unexpected close tag");if(ge<0)return _n(ee,"Unmatched closing tag: "+ee.tagName),ee.textNode+="</"+ee.tagName+">",void(ee.state=Be.TEXT);ee.tagName=an;for(var to=ee.tags.length;to-- >ge;){var zi=ee.tag=ee.tags.pop();ee.tagName=ee.tag.name,bt(ee,"onclosetag",ee.tagName);var _o={};for(var ri in zi.ns)_o[ri]=zi.ns[ri];ee.opt.xmlns&&zi.ns!==(ee.tags[ee.tags.length-1]||ee).ns&&Object.keys(zi.ns).forEach(function(ie){bt(ee,"onclosenamespace",{prefix:ie,uri:zi.ns[ie]})})}0===ge&&(ee.closedRoot=!0),ee.tagName=ee.attribValue=ee.attribName="",ee.attribList.length=0,ee.state=Be.TEXT}function qo(ee){var Dt,ge=ee.entity,an=ge.toLowerCase(),jt="";return ee.ENTITIES[ge]?ee.ENTITIES[ge]:ee.ENTITIES[an]?ee.ENTITIES[an]:("#"===(ge=an).charAt(0)&&("x"===ge.charAt(1)?(ge=ge.slice(2),jt=(Dt=parseInt(ge,16)).toString(16)):(ge=ge.slice(1),jt=(Dt=parseInt(ge,10)).toString(10))),ge=ge.replace(/^0+/,""),isNaN(Dt)||jt.toLowerCase()!==ge?(_n(ee,"Invalid character entity"),"&"+ee.entity+";"):String.fromCodePoint(Dt))}function Fs(ee,ge){"<"===ge?(ee.state=Be.OPEN_WAKA,ee.startTagPosition=ee.position):Re(ge)||(_n(ee,"Non-whitespace before first tag."),ee.textNode=ge,ee.state=Be.TEXT)}function cr(ee,ge){var an="";return ge<ee.length&&(an=ee.charAt(ge)),an}Be=Ue.STATE,String.fromCodePoint||(ee=String.fromCharCode,ge=Math.floor,an=function(){var Dt=16384,jt=[],_o=-1,ri=arguments.length;if(!ri)return"";for(var Pe="";++_o<ri;){var ie=Number(arguments[_o]);if(!isFinite(ie)||ie<0||ie>1114111||ge(ie)!==ie)throw RangeError("Invalid code point: "+ie);ie<=65535?jt.push(ie):jt.push(55296+((ie-=65536)>>10),ie%1024+56320),(_o+1===ri||jt.length>Dt)&&(Pe+=ee.apply(null,jt),jt.length=0)}return Pe},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:an,configurable:!0,writable:!0}):String.fromCodePoint=an)}(Fn)},3502:(kn,Fn,yt)=>{var Ue=yt(3172),et=Ue.Buffer;function Xe(Qe,xt){for(var De in Qe)xt[De]=Qe[De]}function d(Qe,xt,De){return et(Qe,xt,De)}et.from&&et.alloc&&et.allocUnsafe&&et.allocUnsafeSlow?kn.exports=Ue:(Xe(Ue,Fn),Fn.Buffer=d),d.prototype=Object.create(et.prototype),Xe(et,d),d.from=function(Qe,xt,De){if("number"==typeof Qe)throw new TypeError("Argument must not be a number");return et(Qe,xt,De)},d.alloc=function(Qe,xt,De){if("number"!=typeof Qe)throw new TypeError("Argument must be a number");var Tt=et(Qe);return void 0!==xt?"string"==typeof De?Tt.fill(xt,De):Tt.fill(xt):Tt.fill(0),Tt},d.allocUnsafe=function(Qe){if("number"!=typeof Qe)throw new TypeError("Argument must be a number");return et(Qe)},d.allocUnsafeSlow=function(Qe){if("number"!=typeof Qe)throw new TypeError("Argument must be a number");return Ue.SlowBuffer(Qe)}},5398:(kn,Fn,yt)=>{var Ue=yt(6570);function et(){Ue.call(this)}et.prototype=new Ue,kn.exports=et,et.Stream=et,et.prototype.pipe=function(Xe,d){var Qe=this;function xt(dt){Xe.writable&&!1===Xe.write(dt)&&Qe.pause&&Qe.pause()}function De(){Qe.readable&&Qe.resume&&Qe.resume()}Qe.on("data",xt),Xe.on("drain",De),!Xe._isStdio&&(!d||!1!==d.end)&&(Qe.on("end",zt),Qe.on("close",en));var Tt=!1;function zt(){Tt||(Tt=!0,Xe.end())}function en(){Tt||(Tt=!0,"function"==typeof Xe.destroy&&Xe.destroy())}function Gt(dt){if(it(),!this.hasListeners("error"))throw dt}function it(){Qe.off("data",xt),Xe.off("drain",De),Qe.off("end",zt),Qe.off("close",en),Qe.off("error",Gt),Xe.off("error",Gt),Qe.off("end",it),Qe.off("close",it),Xe.off("end",it),Xe.off("close",it)}return Qe.on("error",Gt),Xe.on("error",Gt),Qe.on("end",it),Qe.on("close",it),Xe.on("end",it),Xe.on("close",it),Xe.emit("pipe",Qe),Xe}},3054:(kn,Fn,yt)=>{"use strict";var Ue=yt(3502).Buffer,et=Ue.isEncoding||function(Bt){switch((Bt=""+Bt)&&Bt.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Qe(Bt){var Rn;switch(this.encoding=function d(Bt){var Rn=function Xe(Bt){if(!Bt)return"utf8";for(var Rn;;)switch(Bt){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return Bt;default:if(Rn)return;Bt=(""+Bt).toLowerCase(),Rn=!0}}(Bt);if("string"!=typeof Rn&&(Ue.isEncoding===et||!et(Bt)))throw new Error("Unknown encoding: "+Bt);return Rn||Bt}(Bt),this.encoding){case"utf16le":this.text=it,this.end=dt,Rn=4;break;case"utf8":this.fillLast=zt,Rn=4;break;case"base64":this.text=Mt,this.end=bn,Rn=3;break;default:return this.write=Jn,void(this.end=yn)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Ue.allocUnsafe(Rn)}function xt(Bt){return Bt<=127?0:Bt>>5==6?2:Bt>>4==14?3:Bt>>3==30?4:Bt>>6==2?-1:-2}function zt(Bt){var Rn=this.lastTotal-this.lastNeed,Re=function Tt(Bt,Rn,Re){if(128!=(192&Rn[0]))return Bt.lastNeed=0,"\ufffd";if(Bt.lastNeed>1&&Rn.length>1){if(128!=(192&Rn[1]))return Bt.lastNeed=1,"\ufffd";if(Bt.lastNeed>2&&Rn.length>2&&128!=(192&Rn[2]))return Bt.lastNeed=2,"\ufffd"}}(this,Bt);return void 0!==Re?Re:this.lastNeed<=Bt.length?(Bt.copy(this.lastChar,Rn,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(Bt.copy(this.lastChar,Rn,0,Bt.length),void(this.lastNeed-=Bt.length))}function it(Bt,Rn){if((Bt.length-Rn)%2==0){var Re=Bt.toString("utf16le",Rn);if(Re){var qe=Re.charCodeAt(Re.length-1);if(qe>=55296&&qe<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=Bt[Bt.length-2],this.lastChar[1]=Bt[Bt.length-1],Re.slice(0,-1)}return Re}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=Bt[Bt.length-1],Bt.toString("utf16le",Rn,Bt.length-1)}function dt(Bt){var Rn=Bt&&Bt.length?this.write(Bt):"";return this.lastNeed?Rn+this.lastChar.toString("utf16le",0,this.lastTotal-this.lastNeed):Rn}function Mt(Bt,Rn){var Re=(Bt.length-Rn)%3;return 0===Re?Bt.toString("base64",Rn):(this.lastNeed=3-Re,this.lastTotal=3,1===Re?this.lastChar[0]=Bt[Bt.length-1]:(this.lastChar[0]=Bt[Bt.length-2],this.lastChar[1]=Bt[Bt.length-1]),Bt.toString("base64",Rn,Bt.length-Re))}function bn(Bt){var Rn=Bt&&Bt.length?this.write(Bt):"";return this.lastNeed?Rn+this.lastChar.toString("base64",0,3-this.lastNeed):Rn}function Jn(Bt){return Bt.toString(this.encoding)}function yn(Bt){return Bt&&Bt.length?this.write(Bt):""}Fn.s=Qe,Qe.prototype.write=function(Bt){if(0===Bt.length)return"";var Rn,Re;if(this.lastNeed){if(void 0===(Rn=this.fillLast(Bt)))return"";Re=this.lastNeed,this.lastNeed=0}else Re=0;return Re<Bt.length?Rn?Rn+this.text(Bt,Re):this.text(Bt,Re):Rn||""},Qe.prototype.end=function Gt(Bt){var Rn=Bt&&Bt.length?this.write(Bt):"";return this.lastNeed?Rn+"\ufffd":Rn},Qe.prototype.text=function en(Bt,Rn){var Re=function De(Bt,Rn,Re){var qe=Rn.length-1;if(qe<Re)return 0;var kt=xt(Rn[qe]);return kt>=0?(kt>0&&(Bt.lastNeed=kt-1),kt):--qe<Re||-2===kt?0:(kt=xt(Rn[qe]))>=0?(kt>0&&(Bt.lastNeed=kt-2),kt):--qe<Re||-2===kt?0:(kt=xt(Rn[qe]))>=0?(kt>0&&(2===kt?kt=0:Bt.lastNeed=kt-3),kt):0}(this,Bt,Rn);if(!this.lastNeed)return Bt.toString("utf8",Rn);this.lastTotal=Re;var qe=Bt.length-(Re-this.lastNeed);return Bt.copy(this.lastChar,0,qe),Bt.toString("utf8",Rn,qe)},Qe.prototype.fillLast=function(Bt){if(this.lastNeed<=Bt.length)return Bt.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);Bt.copy(this.lastChar,this.lastTotal-this.lastNeed,0,Bt.length),this.lastNeed-=Bt.length}},599:function(kn){(function(){kn.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},2269:function(kn){(function(){kn.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},3452:function(kn){(function(){var Fn,yt,Ue,et,Xe,d,Qe,xt={}.hasOwnProperty;Fn=function(De,...Tt){var zt,en,Gt,it;if(Xe(Object.assign))Object.assign.apply(null,arguments);else for(zt=0,Gt=Tt.length;zt<Gt;zt++)if(null!=(it=Tt[zt]))for(en in it)!xt.call(it,en)||(De[en]=it[en]);return De},Xe=function(De){return!!De&&"[object Function]"===Object.prototype.toString.call(De)},d=function(De){var Tt;return!!De&&("function"==(Tt=typeof De)||"object"===Tt)},Ue=function(De){return Xe(Array.isArray)?Array.isArray(De):"[object Array]"===Object.prototype.toString.call(De)},et=function(De){var Tt;if(Ue(De))return!De.length;for(Tt in De)if(xt.call(De,Tt))return!1;return!0},Qe=function(De){var Tt,zt;return d(De)&&(zt=Object.getPrototypeOf(De))&&(Tt=zt.constructor)&&"function"==typeof Tt&&Tt instanceof Tt&&Function.prototype.toString.call(Tt)===Function.prototype.toString.call(Object)},yt=function(De){return Xe(De.valueOf)?De.valueOf():De},kn.exports.assign=Fn,kn.exports.isFunction=Xe,kn.exports.isObject=d,kn.exports.isArray=Ue,kn.exports.isEmpty=et,kn.exports.isPlainObject=Qe,kn.exports.getValue=yt}).call(this)},6316:function(kn){(function(){kn.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},5968:function(kn,Fn,yt){(function(){var Ue;Ue=yt(2269),yt(8563),kn.exports=function(){class d{constructor(xt,De,Tt){if(this.parent=xt,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==De)throw new Error("Missing attribute name. "+this.debugInfo(De));this.name=this.stringify.name(De),this.value=this.stringify.attValue(Tt),this.type=Ue.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(xt){return this.options.writer.attribute(this,this.options.writer.filterOptions(xt))}debugInfo(xt){return null==(xt=xt||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+xt+"}, parent: <"+this.parent.name+">"}isEqualNode(xt){return!(xt.namespaceURI!==this.namespaceURI||xt.prefix!==this.prefix||xt.localName!==this.localName||xt.value!==this.value)}}return Object.defineProperty(d.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(d.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(d.prototype,"textContent",{get:function(){return this.value},set:function(Qe){return this.value=Qe||""}}),Object.defineProperty(d.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(d.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(d.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(d.prototype,"specified",{get:function(){return!0}}),d}.call(this)}).call(this)},1361:function(kn,Fn,yt){(function(){var Ue,Xe;Ue=yt(2269),Xe=yt(2182),kn.exports=class extends Xe{constructor(Qe,xt){if(super(Qe),null==xt)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=Ue.CData,this.value=this.stringify.cdata(xt)}clone(){return Object.create(this)}toString(Qe){return this.options.writer.cdata(this,this.options.writer.filterOptions(Qe))}}}).call(this)},2182:function(kn,Fn,yt){(function(){var et;et=yt(8563),kn.exports=function(){class Xe extends et{constructor(Qe){super(Qe),this.value=""}clone(){return Object.create(this)}substringData(Qe,xt){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(Qe){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(Qe,xt){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(Qe,xt){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(Qe,xt,De){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(Qe){return!(!super.isEqualNode(Qe)||Qe.data!==this.data)}}return Object.defineProperty(Xe.prototype,"data",{get:function(){return this.value},set:function(d){return this.value=d||""}}),Object.defineProperty(Xe.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(Xe.prototype,"textContent",{get:function(){return this.value},set:function(d){return this.value=d||""}}),Xe}.call(this)}).call(this)},2516:function(kn,Fn,yt){(function(){var Ue,et;Ue=yt(2269),et=yt(2182),kn.exports=class extends et{constructor(Qe,xt){if(super(Qe),null==xt)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=Ue.Comment,this.value=this.stringify.comment(xt)}clone(){return Object.create(this)}toString(Qe){return this.options.writer.comment(this,this.options.writer.filterOptions(Qe))}}}).call(this)},5806:function(kn,Fn,yt){(function(){var et,Xe;et=yt(9276),Xe=yt(3735),kn.exports=function(){class d{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new et,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(xt){return this.params.hasOwnProperty(xt)?this.params[xt]:null}canSetParameter(xt,De){return!0}setParameter(xt,De){return null!=De?this.params[xt]=De:delete this.params[xt]}}return Object.defineProperty(d.prototype,"parameterNames",{get:function(){return new Xe(Object.keys(this.defaultParams))}}),d}.call(this)}).call(this)},9276:function(kn){(function(){kn.exports=class{constructor(){}handleError(Ue){throw new Error(Ue)}}}).call(this)},9906:function(kn){(function(){kn.exports=class{hasFeature(Ue,et){return!0}createDocumentType(Ue,et,Xe){throw new Error("This DOM method is not implemented.")}createDocument(Ue,et,Xe){throw new Error("This DOM method is not implemented.")}createHTMLDocument(Ue){throw new Error("This DOM method is not implemented.")}getFeature(Ue,et){throw new Error("This DOM method is not implemented.")}}}).call(this)},3735:function(kn){(function(){kn.exports=function(){class yt{constructor(et){this.arr=et||[]}item(et){return this.arr[et]||null}contains(et){return-1!==this.arr.indexOf(et)}}return Object.defineProperty(yt.prototype,"length",{get:function(){return this.arr.length}}),yt}.call(this)}).call(this)},7274:function(kn,Fn,yt){(function(){var Ue,Xe;Xe=yt(8563),Ue=yt(2269),kn.exports=class extends Xe{constructor(Qe,xt,De,Tt,zt,en){if(super(Qe),null==xt)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==De)throw new Error("Missing DTD attribute name. "+this.debugInfo(xt));if(!Tt)throw new Error("Missing DTD attribute type. "+this.debugInfo(xt));if(!zt)throw new Error("Missing DTD attribute default. "+this.debugInfo(xt));if(0!==zt.indexOf("#")&&(zt="#"+zt),!zt.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(xt));if(en&&!zt.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(xt));this.elementName=this.stringify.name(xt),this.type=Ue.AttributeDeclaration,this.attributeName=this.stringify.name(De),this.attributeType=this.stringify.dtdAttType(Tt),en&&(this.defaultValue=this.stringify.dtdAttDefault(en)),this.defaultValueType=zt}toString(Qe){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(Qe))}}}).call(this)},2068:function(kn,Fn,yt){(function(){var Ue,Xe;Xe=yt(8563),Ue=yt(2269),kn.exports=class extends Xe{constructor(Qe,xt,De){if(super(Qe),null==xt)throw new Error("Missing DTD element name. "+this.debugInfo());De||(De="(#PCDATA)"),Array.isArray(De)&&(De="("+De.join(",")+")"),this.name=this.stringify.name(xt),this.type=Ue.ElementDeclaration,this.value=this.stringify.dtdElementValue(De)}toString(Qe){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(Qe))}}}).call(this)},8349:function(kn,Fn,yt){(function(){var Ue,Xe,d;({isObject:d}=yt(3452)),Xe=yt(8563),Ue=yt(2269),kn.exports=function(){class Qe extends Xe{constructor(De,Tt,zt,en){if(super(De),null==zt)throw new Error("Missing DTD entity name. "+this.debugInfo(zt));if(null==en)throw new Error("Missing DTD entity value. "+this.debugInfo(zt));if(this.pe=!!Tt,this.name=this.stringify.name(zt),this.type=Ue.EntityDeclaration,d(en)){if(!en.pubID&&!en.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(zt));if(en.pubID&&!en.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(zt));if(this.internal=!1,null!=en.pubID&&(this.pubID=this.stringify.dtdPubID(en.pubID)),null!=en.sysID&&(this.sysID=this.stringify.dtdSysID(en.sysID)),null!=en.nData&&(this.nData=this.stringify.dtdNData(en.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(zt))}else this.value=this.stringify.dtdEntityValue(en),this.internal=!0}toString(De){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(De))}}return Object.defineProperty(Qe.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(Qe.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(Qe.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(Qe.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(Qe.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(Qe.prototype,"xmlVersion",{get:function(){return null}}),Qe}.call(this)}).call(this)},3087:function(kn,Fn,yt){(function(){var Ue,Xe;Xe=yt(8563),Ue=yt(2269),kn.exports=function(){class d extends Xe{constructor(xt,De,Tt){if(super(xt),null==De)throw new Error("Missing DTD notation name. "+this.debugInfo(De));if(!Tt.pubID&&!Tt.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(De));this.name=this.stringify.name(De),this.type=Ue.NotationDeclaration,null!=Tt.pubID&&(this.pubID=this.stringify.dtdPubID(Tt.pubID)),null!=Tt.sysID&&(this.sysID=this.stringify.dtdSysID(Tt.sysID))}toString(xt){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(xt))}}return Object.defineProperty(d.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(d.prototype,"systemId",{get:function(){return this.sysID}}),d}.call(this)}).call(this)},4789:function(kn,Fn,yt){(function(){var Ue,Xe,d;({isObject:d}=yt(3452)),Xe=yt(8563),Ue=yt(2269),kn.exports=class extends Xe{constructor(xt,De,Tt,zt){super(xt),d(De)&&({version:De,encoding:Tt,standalone:zt}=De),De||(De="1.0"),this.type=Ue.Declaration,this.version=this.stringify.xmlVersion(De),null!=Tt&&(this.encoding=this.stringify.xmlEncoding(Tt)),null!=zt&&(this.standalone=this.stringify.xmlStandalone(zt))}toString(xt){return this.options.writer.declaration(this,this.options.writer.filterOptions(xt))}}}).call(this)},9195:function(kn,Fn,yt){(function(){var Ue,et,Xe,d,Qe,De,Tt,zt;({isObject:zt}=yt(3452)),Tt=yt(8563),Ue=yt(2269),et=yt(7274),d=yt(8349),Xe=yt(2068),Qe=yt(3087),De=yt(5264),kn.exports=function(){class en extends Tt{constructor(it,dt,Mt){var bn,Jn,yn,Bt;if(super(it),this.type=Ue.DocType,it.children)for(Jn=0,yn=(Bt=it.children).length;Jn<yn;Jn++)if((bn=Bt[Jn]).type===Ue.Element){this.name=bn.name;break}this.documentObject=it,zt(dt)&&({pubID:dt,sysID:Mt}=dt),null==Mt&&([Mt,dt]=[dt,Mt]),null!=dt&&(this.pubID=this.stringify.dtdPubID(dt)),null!=Mt&&(this.sysID=this.stringify.dtdSysID(Mt))}element(it,dt){var Mt;return Mt=new Xe(this,it,dt),this.children.push(Mt),this}attList(it,dt,Mt,bn,Jn){var yn;return yn=new et(this,it,dt,Mt,bn,Jn),this.children.push(yn),this}entity(it,dt){var Mt;return Mt=new d(this,!1,it,dt),this.children.push(Mt),this}pEntity(it,dt){var Mt;return Mt=new d(this,!0,it,dt),this.children.push(Mt),this}notation(it,dt){var Mt;return Mt=new Qe(this,it,dt),this.children.push(Mt),this}toString(it){return this.options.writer.docType(this,this.options.writer.filterOptions(it))}ele(it,dt){return this.element(it,dt)}att(it,dt,Mt,bn,Jn){return this.attList(it,dt,Mt,bn,Jn)}ent(it,dt){return this.entity(it,dt)}pent(it,dt){return this.pEntity(it,dt)}not(it,dt){return this.notation(it,dt)}up(){return this.root()||this.documentObject}isEqualNode(it){return!(!super.isEqualNode(it)||it.name!==this.name||it.publicId!==this.publicId||it.systemId!==this.systemId)}}return Object.defineProperty(en.prototype,"entities",{get:function(){var Gt,it,dt,Mt,bn;for(Mt={},it=0,dt=(bn=this.children).length;it<dt;it++)(Gt=bn[it]).type===Ue.EntityDeclaration&&!Gt.pe&&(Mt[Gt.name]=Gt);return new De(Mt)}}),Object.defineProperty(en.prototype,"notations",{get:function(){var Gt,it,dt,Mt,bn;for(Mt={},it=0,dt=(bn=this.children).length;it<dt;it++)(Gt=bn[it]).type===Ue.NotationDeclaration&&(Mt[Gt.name]=Gt);return new De(Mt)}}),Object.defineProperty(en.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(en.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(en.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),en}.call(this)}).call(this)},519:function(kn,Fn,yt){(function(){var Ue,et,Xe,Qe,xt,De,Tt;({isPlainObject:Tt}=yt(3452)),Xe=yt(9906),et=yt(5806),Qe=yt(8563),Ue=yt(2269),De=yt(5041),xt=yt(4354),kn.exports=function(){class zt extends Qe{constructor(Gt){super(null),this.name="#document",this.type=Ue.Document,this.documentURI=null,this.domConfig=new et,Gt||(Gt={}),Gt.writer||(Gt.writer=new xt),this.options=Gt,this.stringify=new De(Gt)}end(Gt){var it;return it={},Gt?Tt(Gt)&&(it=Gt,Gt=this.options.writer):Gt=this.options.writer,Gt.document(this,Gt.filterOptions(it))}toString(Gt){return this.options.writer.document(this,this.options.writer.filterOptions(Gt))}createElement(Gt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(Gt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(Gt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(Gt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(Gt,it){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(Gt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(Gt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(Gt){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(Gt,it){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(Gt,it){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(Gt,it){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(Gt,it){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(Gt){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(Gt){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(Gt,it,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(Gt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(Gt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(Gt,it,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(Gt,it,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(zt.prototype,"implementation",{value:new Xe}),Object.defineProperty(zt.prototype,"doctype",{get:function(){var en,Gt,it,dt;for(Gt=0,it=(dt=this.children).length;Gt<it;Gt++)if((en=dt[Gt]).type===Ue.DocType)return en;return null}}),Object.defineProperty(zt.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(zt.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(zt.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(zt.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===Ue.Declaration?this.children[0].encoding:null}}),Object.defineProperty(zt.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===Ue.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(zt.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===Ue.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(zt.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(zt.prototype,"origin",{get:function(){return null}}),Object.defineProperty(zt.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(zt.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(zt.prototype,"contentType",{get:function(){return null}}),zt}.call(this)}).call(this)},1105:function(kn,Fn,yt){(function(){var Ue,et,Xe,d,Qe,xt,De,Tt,zt,en,Gt,it,Mt,bn,Jn,yn,Bt,Rn,Re,qe,kt,xe,at={}.hasOwnProperty;({isObject:kt,isFunction:qe,isPlainObject:xe,getValue:Re}=yt(3452)),Ue=yt(2269),it=yt(519),Mt=yt(3352),d=yt(1361),Qe=yt(2516),Jn=yt(9942),Rn=yt(474),bn=yt(4666),en=yt(4789),Gt=yt(9195),xt=yt(7274),Tt=yt(8349),De=yt(2068),zt=yt(3087),Xe=yt(5968),Bt=yt(5041),yn=yt(4354),et=yt(6316),kn.exports=class{constructor(Ge,Lt,bt){var lt;this.name="?xml",this.type=Ue.Document,Ge||(Ge={}),lt={},Ge.writer?xe(Ge.writer)&&(lt=Ge.writer,Ge.writer=new yn):Ge.writer=new yn,this.options=Ge,this.writer=Ge.writer,this.writerOptions=this.writer.filterOptions(lt),this.stringify=new Bt(Ge),this.onDataCallback=Lt||function(){},this.onEndCallback=bt||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(Ge){var bt,lt,Wt,Mn,Dn,_n,Gn;switch(Ge.type){case Ue.CData:this.cdata(Ge.value);break;case Ue.Comment:this.comment(Ge.value);break;case Ue.Element:for(bt in lt={},_n=Ge.attribs)!at.call(_n,bt)||(lt[bt]=_n[bt].value);this.node(Ge.name,lt);break;case Ue.Dummy:this.dummy();break;case Ue.Raw:this.raw(Ge.value);break;case Ue.Text:this.text(Ge.value);break;case Ue.ProcessingInstruction:this.instruction(Ge.target,Ge.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+Ge.constructor.name)}for(Mn=0,Dn=(Gn=Ge.children).length;Mn<Dn;Mn++)this.createChildNode(Wt=Gn[Mn]),Wt.type===Ue.Element&&this.up();return this}dummy(){return this}node(Ge,Lt,bt){if(null==Ge)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(Ge));return this.openCurrent(),Ge=Re(Ge),null==Lt&&(Lt={}),Lt=Re(Lt),kt(Lt)||([bt,Lt]=[Lt,bt]),this.currentNode=new Mt(this,Ge,Lt),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=bt&&this.text(bt),this}element(Ge,Lt,bt){var lt,Wt,Mn,Dn,_n,Gn;if(this.currentNode&&this.currentNode.type===Ue.DocType)this.dtdElement(...arguments);else if(Array.isArray(Ge)||kt(Ge)||qe(Ge))for(Dn=this.options.noValidation,this.options.noValidation=!0,(Gn=new it(this.options).element("TEMP_ROOT")).element(Ge),this.options.noValidation=Dn,Wt=0,Mn=(_n=Gn.children).length;Wt<Mn;Wt++)this.createChildNode(lt=_n[Wt]),lt.type===Ue.Element&&this.up();else this.node(Ge,Lt,bt);return this}attribute(Ge,Lt){var bt;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(Ge));if(null!=Ge&&(Ge=Re(Ge)),kt(Ge))for(bt in Ge)!at.call(Ge,bt)||this.attribute(bt,Ge[bt]);else qe(Lt)&&(Lt=Lt.apply()),this.options.keepNullAttributes&&null==Lt?this.currentNode.attribs[Ge]=new Xe(this,Ge,""):null!=Lt&&(this.currentNode.attribs[Ge]=new Xe(this,Ge,Lt));return this}text(Ge){var Lt;return this.openCurrent(),Lt=new Rn(this,Ge),this.onData(this.writer.text(Lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(Ge){var Lt;return this.openCurrent(),Lt=new d(this,Ge),this.onData(this.writer.cdata(Lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(Ge){var Lt;return this.openCurrent(),Lt=new Qe(this,Ge),this.onData(this.writer.comment(Lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(Ge){var Lt;return this.openCurrent(),Lt=new Jn(this,Ge),this.onData(this.writer.raw(Lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(Ge,Lt){var bt,lt,Mn,Dn;if(this.openCurrent(),null!=Ge&&(Ge=Re(Ge)),null!=Lt&&(Lt=Re(Lt)),Array.isArray(Ge))for(bt=0,Mn=Ge.length;bt<Mn;bt++)this.instruction(lt=Ge[bt]);else if(kt(Ge))for(lt in Ge)!at.call(Ge,lt)||this.instruction(lt,Ge[lt]);else qe(Lt)&&(Lt=Lt.apply()),Dn=new bn(this,Ge,Lt),this.onData(this.writer.processingInstruction(Dn,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(Ge,Lt,bt){var lt;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return lt=new en(this,Ge,Lt,bt),this.onData(this.writer.declaration(lt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(Ge,Lt,bt){if(this.openCurrent(),null==Ge)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new Gt(this,Lt,bt),this.currentNode.rootNodeName=Ge,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(Ge,Lt){var bt;return this.openCurrent(),bt=new De(this,Ge,Lt),this.onData(this.writer.dtdElement(bt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(Ge,Lt,bt,lt,Wt){var Mn;return this.openCurrent(),Mn=new xt(this,Ge,Lt,bt,lt,Wt),this.onData(this.writer.dtdAttList(Mn,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(Ge,Lt){var bt;return this.openCurrent(),bt=new Tt(this,!1,Ge,Lt),this.onData(this.writer.dtdEntity(bt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(Ge,Lt){var bt;return this.openCurrent(),bt=new Tt(this,!0,Ge,Lt),this.onData(this.writer.dtdEntity(bt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(Ge,Lt){var bt;return this.openCurrent(),bt=new zt(this,Ge,Lt),this.onData(this.writer.dtdNotation(bt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){for(;this.currentLevel>=0;)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(Ge){var bt,lt,Wt;if(!Ge.isOpen){if(!this.root&&0===this.currentLevel&&Ge.type===Ue.Element&&(this.root=Ge),bt="",Ge.type===Ue.Element){for(lt in this.writerOptions.state=et.OpenTag,bt=this.writer.indent(Ge,this.writerOptions,this.currentLevel)+"<"+Ge.name,Wt=Ge.attribs)!at.call(Wt,lt)||(bt+=this.writer.attribute(Wt[lt],this.writerOptions,this.currentLevel));bt+=(Ge.children?">":"/>")+this.writer.endline(Ge,this.writerOptions,this.currentLevel),this.writerOptions.state=et.InsideTag}else this.writerOptions.state=et.OpenTag,bt=this.writer.indent(Ge,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+Ge.rootNodeName,Ge.pubID&&Ge.sysID?bt+=' PUBLIC "'+Ge.pubID+'" "'+Ge.sysID+'"':Ge.sysID&&(bt+=' SYSTEM "'+Ge.sysID+'"'),Ge.children?(bt+=" [",this.writerOptions.state=et.InsideTag):(this.writerOptions.state=et.CloseTag,bt+=">"),bt+=this.writer.endline(Ge,this.writerOptions,this.currentLevel);return this.onData(bt,this.currentLevel),Ge.isOpen=!0}}closeNode(Ge){var Lt;if(!Ge.isClosed)return"",this.writerOptions.state=et.CloseTag,Lt=Ge.type===Ue.Element?this.writer.indent(Ge,this.writerOptions,this.currentLevel)+"</"+Ge.name+">"+this.writer.endline(Ge,this.writerOptions,this.currentLevel):this.writer.indent(Ge,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(Ge,this.writerOptions,this.currentLevel),this.writerOptions.state=et.None,this.onData(Lt,this.currentLevel),Ge.isClosed=!0}onData(Ge,Lt){return this.documentStarted=!0,this.onDataCallback(Ge,Lt+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(Ge){return null==Ge?"":"node: <"+Ge+">"}ele(){return this.element(...arguments)}nod(Ge,Lt,bt){return this.node(Ge,Lt,bt)}txt(Ge){return this.text(Ge)}dat(Ge){return this.cdata(Ge)}com(Ge){return this.comment(Ge)}ins(Ge,Lt){return this.instruction(Ge,Lt)}dec(Ge,Lt,bt){return this.declaration(Ge,Lt,bt)}dtd(Ge,Lt,bt){return this.doctype(Ge,Lt,bt)}e(Ge,Lt,bt){return this.element(Ge,Lt,bt)}n(Ge,Lt,bt){return this.node(Ge,Lt,bt)}t(Ge){return this.text(Ge)}d(Ge){return this.cdata(Ge)}c(Ge){return this.comment(Ge)}r(Ge){return this.raw(Ge)}i(Ge,Lt){return this.instruction(Ge,Lt)}att(){return this.currentNode&&this.currentNode.type===Ue.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===Ue.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(Ge,Lt){return this.entity(Ge,Lt)}pent(Ge,Lt){return this.pEntity(Ge,Lt)}not(Ge,Lt){return this.notation(Ge,Lt)}}}).call(this)},4173:function(kn,Fn,yt){(function(){var Ue,Xe;Xe=yt(8563),Ue=yt(2269),kn.exports=class extends Xe{constructor(Qe){super(Qe),this.type=Ue.Dummy}clone(){return Object.create(this)}toString(Qe){return""}}}).call(this)},3352:function(kn,Fn,yt){(function(){var Ue,et,d,Qe,xt,De,Tt,zt={}.hasOwnProperty;({isObject:Tt,isFunction:De,getValue:xt}=yt(3452)),Qe=yt(8563),Ue=yt(2269),et=yt(5968),d=yt(5264),kn.exports=function(){class en extends Qe{constructor(it,dt,Mt){var bn,Jn,yn,Bt;if(super(it),null==dt)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(dt),this.type=Ue.Element,this.attribs={},this.schemaTypeInfo=null,null!=Mt&&this.attribute(Mt),it.type===Ue.Document&&(this.isRoot=!0,this.documentObject=it,it.rootObject=this,it.children))for(Jn=0,yn=(Bt=it.children).length;Jn<yn;Jn++)if((bn=Bt[Jn]).type===Ue.DocType){bn.name=this.name;break}}clone(){var dt,Mt,bn;for(dt in(Mt=Object.create(this)).isRoot&&(Mt.documentObject=null),Mt.attribs={},bn=this.attribs)!zt.call(bn,dt)||(Mt.attribs[dt]=bn[dt].clone());return Mt.children=[],this.children.forEach(function(Jn){var yn;return(yn=Jn.clone()).parent=Mt,Mt.children.push(yn)}),Mt}attribute(it,dt){var Mt;if(null!=it&&(it=xt(it)),Tt(it))for(Mt in it)!zt.call(it,Mt)||this.attribute(Mt,it[Mt]);else De(dt)&&(dt=dt.apply()),this.options.keepNullAttributes&&null==dt?this.attribs[it]=new et(this,it,""):null!=dt&&(this.attribs[it]=new et(this,it,dt));return this}removeAttribute(it){var Mt,bn;if(null==it)throw new Error("Missing attribute name. "+this.debugInfo());if(it=xt(it),Array.isArray(it))for(Mt=0,bn=it.length;Mt<bn;Mt++)delete this.attribs[it[Mt]];else delete this.attribs[it];return this}toString(it){return this.options.writer.element(this,this.options.writer.filterOptions(it))}att(it,dt){return this.attribute(it,dt)}a(it,dt){return this.attribute(it,dt)}getAttribute(it){return this.attribs.hasOwnProperty(it)?this.attribs[it].value:null}setAttribute(it,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode(it){return this.attribs.hasOwnProperty(it)?this.attribs[it]:null}setAttributeNode(it){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode(it){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(it){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS(it,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS(it,dt,Mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS(it,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS(it,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS(it){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(it,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute(it){return this.attribs.hasOwnProperty(it)}hasAttributeNS(it,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute(it,dt){return this.attribs.hasOwnProperty(it)?this.attribs[it].isId:dt}setIdAttributeNS(it,dt,Mt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode(it,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(it){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(it,dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(it){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(it){var dt,Mt,bn;if(!super.isEqualNode(it)||it.namespaceURI!==this.namespaceURI||it.prefix!==this.prefix||it.localName!==this.localName||it.attribs.length!==this.attribs.length)return!1;for(dt=Mt=0,bn=this.attribs.length-1;0<=bn?Mt<=bn:Mt>=bn;dt=0<=bn?++Mt:--Mt)if(!this.attribs[dt].isEqualNode(it.attribs[dt]))return!1;return!0}}return Object.defineProperty(en.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(en.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(en.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(en.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(en.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(en.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(en.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(en.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new d(this.attribs)),this.attributeMap}}),en}.call(this)}).call(this)},5264:function(kn){(function(){kn.exports=function(){class yt{constructor(et){this.nodes=et}clone(){return this.nodes=null}getNamedItem(et){return this.nodes[et]}setNamedItem(et){var Xe;return Xe=this.nodes[et.nodeName],this.nodes[et.nodeName]=et,Xe||null}removeNamedItem(et){var Xe;return Xe=this.nodes[et],delete this.nodes[et],Xe||null}item(et){return this.nodes[Object.keys(this.nodes)[et]]||null}getNamedItemNS(et,Xe){throw new Error("This DOM method is not implemented.")}setNamedItemNS(et){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(et,Xe){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(yt.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),yt}.call(this)}).call(this)},8563:function(kn,Fn,yt){(function(){var Ue,et,Xe,d,Qe,xt,De,Tt,Gt,it,dt,Mt,bn,Jn,yn,Bt,Rn={}.hasOwnProperty,Re=[].splice;({isObject:Bt,isFunction:yn,isEmpty:Jn,getValue:bn}=yt(3452)),Tt=null,Xe=null,d=null,Qe=null,xt=null,dt=null,Mt=null,it=null,De=null,et=null,Gt=null,Ue=null,kn.exports=function(){class qe{constructor(xe){this.parent=xe,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,Tt||(Tt=yt(3352),Xe=yt(1361),d=yt(2516),Qe=yt(4789),xt=yt(9195),dt=yt(9942),Mt=yt(474),it=yt(4666),De=yt(4173),et=yt(2269),Gt=yt(5112),yt(5264),Ue=yt(599))}setParent(xe){var Be,Ge,Lt,bt;for(this.parent=xe,xe&&(this.options=xe.options,this.stringify=xe.stringify),bt=[],Be=0,Ge=(Lt=this.children).length;Be<Ge;Be++)bt.push(Lt[Be].setParent(this));return bt}element(xe,at,Be){var Ge,bt,lt,Wt,Mn,Dn,_n,Gn;if(Mn=null,null===at&&null==Be&&([at,Be]=[{},null]),null==at&&(at={}),at=bn(at),Bt(at)||([Be,at]=[at,Be]),null!=xe&&(xe=bn(xe)),Array.isArray(xe))for(bt=0,Dn=xe.length;bt<Dn;bt++)Mn=this.element(xe[bt]);else if(yn(xe))Mn=this.element(xe.apply());else if(Bt(xe)){for(Wt in xe)if(Rn.call(xe,Wt))if(yn(Gn=xe[Wt])&&(Gn=Gn.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===Wt.indexOf(this.stringify.convertAttKey))Mn=this.attribute(Wt.substr(this.stringify.convertAttKey.length),Gn);else if(!this.options.separateArrayItems&&Array.isArray(Gn)&&Jn(Gn))Mn=this.dummy();else if(Bt(Gn)&&Jn(Gn))Mn=this.element(Wt);else if(this.options.keepNullNodes||null!=Gn)if(!this.options.separateArrayItems&&Array.isArray(Gn))for(lt=0,_n=Gn.length;lt<_n;lt++)(Ge={})[Wt]=Gn[lt],Mn=this.element(Ge);else Bt(Gn)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===Wt.indexOf(this.stringify.convertTextKey)?Mn=this.element(Gn):(Mn=this.element(Wt)).element(Gn):Mn=this.element(Wt,Gn);else Mn=this.dummy()}else Mn=this.options.keepNullNodes||null!==Be?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===xe.indexOf(this.stringify.convertTextKey)?this.text(Be):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===xe.indexOf(this.stringify.convertCDataKey)?this.cdata(Be):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===xe.indexOf(this.stringify.convertCommentKey)?this.comment(Be):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===xe.indexOf(this.stringify.convertRawKey)?this.raw(Be):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===xe.indexOf(this.stringify.convertPIKey)?this.instruction(xe.substr(this.stringify.convertPIKey.length),Be):this.node(xe,at,Be):this.dummy();if(null==Mn)throw new Error("Could not create any elements with: "+xe+". "+this.debugInfo());return Mn}insertBefore(xe,at,Be){var Ge,Lt,bt,lt,Wt;if(null!=xe&&xe.type)return lt=at,(bt=xe).setParent(this),lt?(Lt=children.indexOf(lt),Wt=children.splice(Lt),children.push(bt),Array.prototype.push.apply(children,Wt)):children.push(bt),bt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(xe));return Lt=this.parent.children.indexOf(this),Wt=this.parent.children.splice(Lt),Ge=this.parent.element(xe,at,Be),Array.prototype.push.apply(this.parent.children,Wt),Ge}insertAfter(xe,at,Be){var Ge,Lt,bt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(xe));return Lt=this.parent.children.indexOf(this),bt=this.parent.children.splice(Lt+1),Ge=this.parent.element(xe,at,Be),Array.prototype.push.apply(this.parent.children,bt),Ge}remove(){var xe;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return xe=this.parent.children.indexOf(this),Re.apply(this.parent.children,[xe,xe-xe+1].concat([])),this.parent}node(xe,at,Be){var Ge;return null!=xe&&(xe=bn(xe)),at||(at={}),at=bn(at),Bt(at)||([Be,at]=[at,Be]),Ge=new Tt(this,xe,at),null!=Be&&Ge.text(Be),this.children.push(Ge),Ge}text(xe){var at;return Bt(xe)&&this.element(xe),at=new Mt(this,xe),this.children.push(at),this}cdata(xe){var at;return at=new Xe(this,xe),this.children.push(at),this}comment(xe){var at;return at=new d(this,xe),this.children.push(at),this}commentBefore(xe){var Be,Ge;return Be=this.parent.children.indexOf(this),Ge=this.parent.children.splice(Be),this.parent.comment(xe),Array.prototype.push.apply(this.parent.children,Ge),this}commentAfter(xe){var Be,Ge;return Be=this.parent.children.indexOf(this),Ge=this.parent.children.splice(Be+1),this.parent.comment(xe),Array.prototype.push.apply(this.parent.children,Ge),this}raw(xe){var at;return at=new dt(this,xe),this.children.push(at),this}dummy(){return new De(this)}instruction(xe,at){var Be,Lt,bt,lt;if(null!=xe&&(xe=bn(xe)),null!=at&&(at=bn(at)),Array.isArray(xe))for(bt=0,lt=xe.length;bt<lt;bt++)this.instruction(Be=xe[bt]);else if(Bt(xe))for(Be in xe)!Rn.call(xe,Be)||this.instruction(Be,xe[Be]);else yn(at)&&(at=at.apply()),Lt=new it(this,xe,at),this.children.push(Lt);return this}instructionBefore(xe,at){var Ge,Lt;return Ge=this.parent.children.indexOf(this),Lt=this.parent.children.splice(Ge),this.parent.instruction(xe,at),Array.prototype.push.apply(this.parent.children,Lt),this}instructionAfter(xe,at){var Ge,Lt;return Ge=this.parent.children.indexOf(this),Lt=this.parent.children.splice(Ge+1),this.parent.instruction(xe,at),Array.prototype.push.apply(this.parent.children,Lt),this}declaration(xe,at,Be){var Ge,Lt;return Ge=this.document(),Lt=new Qe(Ge,xe,at,Be),0===Ge.children.length?Ge.children.unshift(Lt):Ge.children[0].type===et.Declaration?Ge.children[0]=Lt:Ge.children.unshift(Lt),Ge.root()||Ge}dtd(xe,at){var Ge,Lt,bt,lt,Wt,Mn,Dn,_n,Gn;for(Ge=this.document(),Lt=new xt(Ge,xe,at),bt=lt=0,Mn=(_n=Ge.children).length;lt<Mn;bt=++lt)if(_n[bt].type===et.DocType)return Ge.children[bt]=Lt,Lt;for(bt=Wt=0,Dn=(Gn=Ge.children).length;Wt<Dn;bt=++Wt)if(Gn[bt].isRoot)return Ge.children.splice(bt,0,Lt),Lt;return Ge.children.push(Lt),Lt}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var xe;for(xe=this;xe;){if(xe.type===et.Document)return xe.rootObject;if(xe.isRoot)return xe;xe=xe.parent}}document(){var xe;for(xe=this;xe;){if(xe.type===et.Document)return xe;xe=xe.parent}}end(xe){return this.document().end(xe)}prev(){var xe;if((xe=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[xe-1]}next(){var xe;if(-1===(xe=this.parent.children.indexOf(this))||xe===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[xe+1]}importDocument(xe){var at,Be,Ge,Lt,bt;if((Be=xe.root().clone()).parent=this,Be.isRoot=!1,this.children.push(Be),this.type===et.Document&&(Be.isRoot=!0,Be.documentObject=this,this.rootObject=Be,this.children))for(Ge=0,Lt=(bt=this.children).length;Ge<Lt;Ge++)if((at=bt[Ge]).type===et.DocType){at.name=Be.name;break}return this}debugInfo(xe){var at,Be;return null!=(xe=xe||this.name)||null!=(at=this.parent)&&at.name?null==xe?"parent: <"+this.parent.name+">":null!=(Be=this.parent)&&Be.name?"node: <"+xe+">, parent: <"+this.parent.name+">":"node: <"+xe+">":""}ele(xe,at,Be){return this.element(xe,at,Be)}nod(xe,at,Be){return this.node(xe,at,Be)}txt(xe){return this.text(xe)}dat(xe){return this.cdata(xe)}com(xe){return this.comment(xe)}ins(xe,at){return this.instruction(xe,at)}doc(){return this.document()}dec(xe,at,Be){return this.declaration(xe,at,Be)}e(xe,at,Be){return this.element(xe,at,Be)}n(xe,at,Be){return this.node(xe,at,Be)}t(xe){return this.text(xe)}d(xe){return this.cdata(xe)}c(xe){return this.comment(xe)}r(xe){return this.raw(xe)}i(xe,at){return this.instruction(xe,at)}u(){return this.up()}importXMLBuilder(xe){return this.importDocument(xe)}attribute(xe,at){throw new Error("attribute() applies to element nodes only.")}att(xe,at){return this.attribute(xe,at)}a(xe,at){return this.attribute(xe,at)}removeAttribute(xe){throw new Error("attribute() applies to element nodes only.")}replaceChild(xe,at){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(xe,at){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(xe){var Be;return this===xe?0:this.document()!==xe.document()?(Be=Ue.Disconnected|Ue.ImplementationSpecific,Math.random()<.5?Be|=Ue.Preceding:Be|=Ue.Following,Be):this.isAncestor(xe)?Ue.Contains|Ue.Preceding:this.isDescendant(xe)?Ue.Contains|Ue.Following:this.isPreceding(xe)?Ue.Preceding:Ue.Following}isSameNode(xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(xe){var at,Be,Ge;if(xe.nodeType!==this.nodeType||xe.children.length!==this.children.length)return!1;for(at=Be=0,Ge=this.children.length-1;0<=Ge?Be<=Ge:Be>=Ge;at=0<=Ge?++Be:--Be)if(!this.children[at].isEqualNode(xe.children[at]))return!1;return!0}getFeature(xe,at){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(xe,at,Be){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(xe){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(xe){return!!xe&&(xe===this||this.isDescendant(xe))}isDescendant(xe){var at,Ge,Lt,bt;for(Ge=0,Lt=(bt=this.children).length;Ge<Lt;Ge++)if(xe===(at=bt[Ge])||at.isDescendant(xe))return!0;return!1}isAncestor(xe){return xe.isDescendant(this)}isPreceding(xe){var at,Be;return at=this.treePosition(xe),Be=this.treePosition(this),-1!==at&&-1!==Be&&at<Be}isFollowing(xe){var at,Be;return at=this.treePosition(xe),Be=this.treePosition(this),-1!==at&&-1!==Be&&at>Be}treePosition(xe){var at,Be;return Be=0,at=!1,this.foreachTreeNode(this.document(),function(Ge){if(Be++,!at&&Ge===xe)return at=!0}),at?Be:-1}foreachTreeNode(xe,at){var Be,Ge,Lt,bt,lt;for(xe||(xe=this.document()),Ge=0,Lt=(bt=xe.children).length;Ge<Lt;Ge++){if(lt=at(Be=bt[Ge]))return lt;if(lt=this.foreachTreeNode(Be,at))return lt}}}return Object.defineProperty(qe.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(qe.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(qe.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(qe.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(qe.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new Gt(this.children)),this.childNodeList}}),Object.defineProperty(qe.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(qe.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(qe.prototype,"previousSibling",{get:function(){var kt;return kt=this.parent.children.indexOf(this),this.parent.children[kt-1]||null}}),Object.defineProperty(qe.prototype,"nextSibling",{get:function(){var kt;return kt=this.parent.children.indexOf(this),this.parent.children[kt+1]||null}}),Object.defineProperty(qe.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(qe.prototype,"textContent",{get:function(){var kt,xe,at,Be,Ge;if(this.nodeType===et.Element||this.nodeType===et.DocumentFragment){for(Ge="",xe=0,at=(Be=this.children).length;xe<at;xe++)(kt=Be[xe]).textContent&&(Ge+=kt.textContent);return Ge}return null},set:function(kt){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),qe}.call(this)}).call(this)},5112:function(kn){(function(){kn.exports=function(){class yt{constructor(et){this.nodes=et}clone(){return this.nodes=null}item(et){return this.nodes[et]||null}}return Object.defineProperty(yt.prototype,"length",{get:function(){return this.nodes.length||0}}),yt}.call(this)}).call(this)},4666:function(kn,Fn,yt){(function(){var Ue,et;Ue=yt(2269),et=yt(2182),kn.exports=class extends et{constructor(Qe,xt,De){if(super(Qe),null==xt)throw new Error("Missing instruction target. "+this.debugInfo());this.type=Ue.ProcessingInstruction,this.target=this.stringify.insTarget(xt),this.name=this.target,De&&(this.value=this.stringify.insValue(De))}clone(){return Object.create(this)}toString(Qe){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(Qe))}isEqualNode(Qe){return!(!super.isEqualNode(Qe)||Qe.target!==this.target)}}}).call(this)},9942:function(kn,Fn,yt){(function(){var Ue,et;Ue=yt(2269),et=yt(8563),kn.exports=class extends et{constructor(Qe,xt){if(super(Qe),null==xt)throw new Error("Missing raw text. "+this.debugInfo());this.type=Ue.Raw,this.value=this.stringify.raw(xt)}clone(){return Object.create(this)}toString(Qe){return this.options.writer.raw(this,this.options.writer.filterOptions(Qe))}}}).call(this)},7647:function(kn,Fn,yt){(function(){var Ue,et,d,Qe={}.hasOwnProperty;Ue=yt(2269),d=yt(3576),et=yt(6316),kn.exports=class extends d{constructor(De,Tt){super(Tt),this.stream=De}endline(De,Tt,zt){return De.isLastRootNode&&Tt.state===et.CloseTag?"":super.endline(De,Tt,zt)}document(De,Tt){var en,Gt,it,dt,Mt,bn,Jn,yn;for(en=Gt=0,dt=(bn=De.children).length;Gt<dt;en=++Gt)bn[en].isLastRootNode=en===De.children.length-1;for(Tt=this.filterOptions(Tt),yn=[],it=0,Mt=(Jn=De.children).length;it<Mt;it++)yn.push(this.writeChildNode(Jn[it],Tt,0));return yn}cdata(De,Tt,zt){return this.stream.write(super.cdata(De,Tt,zt))}comment(De,Tt,zt){return this.stream.write(super.comment(De,Tt,zt))}declaration(De,Tt,zt){return this.stream.write(super.declaration(De,Tt,zt))}docType(De,Tt,zt){var Gt,it,dt;if(zt||(zt=0),this.openNode(De,Tt,zt),Tt.state=et.OpenTag,this.stream.write(this.indent(De,Tt,zt)),this.stream.write("<!DOCTYPE "+De.root().name),De.pubID&&De.sysID?this.stream.write(' PUBLIC "'+De.pubID+'" "'+De.sysID+'"'):De.sysID&&this.stream.write(' SYSTEM "'+De.sysID+'"'),De.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(De,Tt,zt)),Tt.state=et.InsideTag,Gt=0,it=(dt=De.children).length;Gt<it;Gt++)this.writeChildNode(dt[Gt],Tt,zt+1);Tt.state=et.CloseTag,this.stream.write("]")}return Tt.state=et.CloseTag,this.stream.write(Tt.spaceBeforeSlash+">"),this.stream.write(this.endline(De,Tt,zt)),Tt.state=et.None,this.closeNode(De,Tt,zt)}element(De,Tt,zt){var dt,Mt,bn,Jn,yn,Bt,Re,qe,kt,xe,at,Be;if(zt||(zt=0),this.openNode(De,Tt,zt),Tt.state=et.OpenTag,Re=this.indent(De,Tt,zt)+"<"+De.name,Tt.pretty&&Tt.width>0)for(Bt in Jn=Re.length,kt=De.attribs)!Qe.call(kt,Bt)||(Jn+(qe=this.attribute(kt[Bt],Tt,zt)).length>Tt.width?(Be=this.indent(De,Tt,zt+1)+qe,Re+=this.endline(De,Tt,zt)+Be,Jn=Be.length):(Re+=Be=" "+qe,Jn+=Be.length));else for(Bt in xe=De.attribs)!Qe.call(xe,Bt)||(Re+=this.attribute(xe[Bt],Tt,zt));if(this.stream.write(Re),Mt=0===(dt=De.children.length)?null:De.children[0],0===dt||De.children.every(function(Ge){return(Ge.type===Ue.Text||Ge.type===Ue.Raw||Ge.type===Ue.CData)&&""===Ge.value}))Tt.allowEmpty?(this.stream.write(">"),Tt.state=et.CloseTag,this.stream.write("</"+De.name+">")):(Tt.state=et.CloseTag,this.stream.write(Tt.spaceBeforeSlash+"/>"));else if(!Tt.pretty||1!==dt||Mt.type!==Ue.Text&&Mt.type!==Ue.Raw&&Mt.type!==Ue.CData||null==Mt.value){for(this.stream.write(">"+this.endline(De,Tt,zt)),Tt.state=et.InsideTag,bn=0,yn=(at=De.children).length;bn<yn;bn++)this.writeChildNode(at[bn],Tt,zt+1);Tt.state=et.CloseTag,this.stream.write(this.indent(De,Tt,zt)+"</"+De.name+">")}else this.stream.write(">"),Tt.state=et.InsideTag,Tt.suppressPrettyCount++,this.writeChildNode(Mt,Tt,zt+1),Tt.suppressPrettyCount--,Tt.state=et.CloseTag,this.stream.write("</"+De.name+">");return this.stream.write(this.endline(De,Tt,zt)),Tt.state=et.None,this.closeNode(De,Tt,zt)}processingInstruction(De,Tt,zt){return this.stream.write(super.processingInstruction(De,Tt,zt))}raw(De,Tt,zt){return this.stream.write(super.raw(De,Tt,zt))}text(De,Tt,zt){return this.stream.write(super.text(De,Tt,zt))}dtdAttList(De,Tt,zt){return this.stream.write(super.dtdAttList(De,Tt,zt))}dtdElement(De,Tt,zt){return this.stream.write(super.dtdElement(De,Tt,zt))}dtdEntity(De,Tt,zt){return this.stream.write(super.dtdEntity(De,Tt,zt))}dtdNotation(De,Tt,zt){return this.stream.write(super.dtdNotation(De,Tt,zt))}}}).call(this)},4354:function(kn,Fn,yt){(function(){var et;et=yt(3576),kn.exports=class extends et{constructor(d){super(d)}document(d,Qe){var De,Tt,zt,en;for(Qe=this.filterOptions(Qe),zt="",De=0,Tt=(en=d.children).length;De<Tt;De++)zt+=this.writeChildNode(en[De],Qe,0);return Qe.pretty&&zt.slice(-Qe.newline.length)===Qe.newline&&(zt=zt.slice(0,-Qe.newline.length)),zt}}}).call(this)},5041:function(kn){(function(){var yt={}.hasOwnProperty;kn.exports=function(){class Ue{constructor(Xe){var d,Qe;for(d in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),Xe||(Xe={}),this.options=Xe,this.options.version||(this.options.version="1.0"),Qe=Xe.stringify||{})!yt.call(Qe,d)||(this[d]=Qe[d])}name(Xe){return this.options.noValidation?Xe:this.assertLegalName(""+Xe||"")}text(Xe){return this.options.noValidation?Xe:this.assertLegalChar(this.textEscape(""+Xe||""))}cdata(Xe){return this.options.noValidation?Xe:(Xe=(Xe=""+Xe||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(Xe))}comment(Xe){if(this.options.noValidation)return Xe;if((Xe=""+Xe||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+Xe);return this.assertLegalChar(Xe)}raw(Xe){return this.options.noValidation?Xe:""+Xe||""}attValue(Xe){return this.options.noValidation?Xe:this.assertLegalChar(this.attEscape(Xe=""+Xe||""))}insTarget(Xe){return this.options.noValidation?Xe:this.assertLegalChar(""+Xe||"")}insValue(Xe){if(this.options.noValidation)return Xe;if((Xe=""+Xe||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+Xe);return this.assertLegalChar(Xe)}xmlVersion(Xe){if(this.options.noValidation)return Xe;if(!(Xe=""+Xe||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+Xe);return Xe}xmlEncoding(Xe){if(this.options.noValidation)return Xe;if(!(Xe=""+Xe||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+Xe);return this.assertLegalChar(Xe)}xmlStandalone(Xe){return this.options.noValidation?Xe:Xe?"yes":"no"}dtdPubID(Xe){return this.options.noValidation?Xe:this.assertLegalChar(""+Xe||"")}dtdSysID(Xe){return this.options.noValidation?Xe:this.assertLegalChar(""+Xe||"")}dtdElementValue(Xe){return this.options.noValidation?Xe:this.assertLegalChar(""+Xe||"")}dtdAttType(Xe){return this.options.noValidation?Xe:this.assertLegalChar(""+Xe||"")}dtdAttDefault(Xe){return this.options.noValidation?Xe:this.assertLegalChar(""+Xe||"")}dtdEntityValue(Xe){return this.options.noValidation?Xe:this.assertLegalChar(""+Xe||"")}dtdNData(Xe){return this.options.noValidation?Xe:this.assertLegalChar(""+Xe||"")}assertLegalChar(Xe){var d,Qe;if(this.options.noValidation)return Xe;if("1.0"===this.options.version){if(d=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Xe=Xe.replace(d,this.options.invalidCharReplacement);else if(Qe=Xe.match(d))throw new Error(`Invalid character in string: ${Xe} at index ${Qe.index}`)}else if("1.1"===this.options.version)if(d=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Xe=Xe.replace(d,this.options.invalidCharReplacement);else if(Qe=Xe.match(d))throw new Error(`Invalid character in string: ${Xe} at index ${Qe.index}`);return Xe}assertLegalName(Xe){if(this.options.noValidation)return Xe;if(!(Xe=this.assertLegalChar(Xe)).match(/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/))throw new Error(`Invalid character in name: ${Xe}`);return Xe}textEscape(Xe){return this.options.noValidation?Xe:Xe.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}attEscape(Xe){return this.options.noValidation?Xe:Xe.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}}return Ue.prototype.convertAttKey="@",Ue.prototype.convertPIKey="?",Ue.prototype.convertTextKey="#text",Ue.prototype.convertCDataKey="#cdata",Ue.prototype.convertCommentKey="#comment",Ue.prototype.convertRawKey="#raw",Ue}.call(this)}).call(this)},474:function(kn,Fn,yt){(function(){var Ue,et;Ue=yt(2269),et=yt(2182),kn.exports=function(){class d extends et{constructor(xt,De){if(super(xt),null==De)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=Ue.Text,this.value=this.stringify.text(De)}clone(){return Object.create(this)}toString(xt){return this.options.writer.text(this,this.options.writer.filterOptions(xt))}splitText(xt){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(xt){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(d.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(d.prototype,"wholeText",{get:function(){var Qe,xt,De;for(De="",xt=this.previousSibling;xt;)De=xt.data+De,xt=xt.previousSibling;for(De+=this.data,Qe=this.nextSibling;Qe;)De+=Qe.data,Qe=Qe.nextSibling;return De}}),d}.call(this)}).call(this)},3576:function(kn,Fn,yt){(function(){var Ue,et,yn,Bt={}.hasOwnProperty;({assign:yn}=yt(3452)),Ue=yt(2269),yt(4789),yt(9195),yt(1361),yt(2516),yt(3352),yt(9942),yt(474),yt(4666),yt(4173),yt(7274),yt(2068),yt(8349),yt(3087),et=yt(6316),kn.exports=class{constructor(Re){var qe,kt,xe;for(qe in Re||(Re={}),this.options=Re,kt=Re.writer||{})!Bt.call(kt,qe)||(xe=kt[qe],this["_"+qe]=this[qe],this[qe]=xe)}filterOptions(Re){var qe,kt,xe,at,Be,Ge,Lt,bt,lt;return Re||(Re={}),Re=yn({},this.options,Re),(qe={writer:this}).pretty=Re.pretty||!1,qe.allowEmpty=Re.allowEmpty||!1,qe.indent=null!=(kt=Re.indent)?kt:"  ",qe.newline=null!=(xe=Re.newline)?xe:"\n",qe.offset=null!=(at=Re.offset)?at:0,qe.width=null!=(Be=Re.width)?Be:0,qe.dontPrettyTextNodes=null!=(Ge=null!=(Lt=Re.dontPrettyTextNodes)?Lt:Re.dontprettytextnodes)?Ge:0,qe.spaceBeforeSlash=null!=(bt=null!=(lt=Re.spaceBeforeSlash)?lt:Re.spacebeforeslash)?bt:"",!0===qe.spaceBeforeSlash&&(qe.spaceBeforeSlash=" "),qe.suppressPrettyCount=0,qe.user={},qe.state=et.None,qe}indent(Re,qe,kt){var xe;return!qe.pretty||qe.suppressPrettyCount?"":qe.pretty&&(xe=(kt||0)+qe.offset+1)>0?new Array(xe).join(qe.indent):""}endline(Re,qe,kt){return!qe.pretty||qe.suppressPrettyCount?"":qe.newline}attribute(Re,qe,kt){var xe;return this.openAttribute(Re,qe,kt),xe=qe.pretty&&qe.width>0?Re.name+'="'+Re.value+'"':" "+Re.name+'="'+Re.value+'"',this.closeAttribute(Re,qe,kt),xe}cdata(Re,qe,kt){var xe;return this.openNode(Re,qe,kt),qe.state=et.OpenTag,xe=this.indent(Re,qe,kt)+"<![CDATA[",qe.state=et.InsideTag,xe+=Re.value,qe.state=et.CloseTag,xe+="]]>"+this.endline(Re,qe,kt),qe.state=et.None,this.closeNode(Re,qe,kt),xe}comment(Re,qe,kt){var xe;return this.openNode(Re,qe,kt),qe.state=et.OpenTag,xe=this.indent(Re,qe,kt)+"\x3c!-- ",qe.state=et.InsideTag,xe+=Re.value,qe.state=et.CloseTag,xe+=" --\x3e"+this.endline(Re,qe,kt),qe.state=et.None,this.closeNode(Re,qe,kt),xe}declaration(Re,qe,kt){var xe;return this.openNode(Re,qe,kt),qe.state=et.OpenTag,xe=this.indent(Re,qe,kt)+"<?xml",qe.state=et.InsideTag,xe+=' version="'+Re.version+'"',null!=Re.encoding&&(xe+=' encoding="'+Re.encoding+'"'),null!=Re.standalone&&(xe+=' standalone="'+Re.standalone+'"'),qe.state=et.CloseTag,xe+=qe.spaceBeforeSlash+"?>",xe+=this.endline(Re,qe,kt),qe.state=et.None,this.closeNode(Re,qe,kt),xe}docType(Re,qe,kt){var at,Be,Ge,Lt;if(kt||(kt=0),this.openNode(Re,qe,kt),qe.state=et.OpenTag,Ge=this.indent(Re,qe,kt),Ge+="<!DOCTYPE "+Re.root().name,Re.pubID&&Re.sysID?Ge+=' PUBLIC "'+Re.pubID+'" "'+Re.sysID+'"':Re.sysID&&(Ge+=' SYSTEM "'+Re.sysID+'"'),Re.children.length>0){for(Ge+=" [",Ge+=this.endline(Re,qe,kt),qe.state=et.InsideTag,at=0,Be=(Lt=Re.children).length;at<Be;at++)Ge+=this.writeChildNode(Lt[at],qe,kt+1);qe.state=et.CloseTag,Ge+="]"}return qe.state=et.CloseTag,Ge+=qe.spaceBeforeSlash+">",Ge+=this.endline(Re,qe,kt),qe.state=et.None,this.closeNode(Re,qe,kt),Ge}element(Re,qe,kt){var Be,Ge,Lt,bt,lt,Wt,Mn,Dn,_n,Gn,jr,jn,lr,fn,qo,Fs,cr;if(kt||(kt=0),Gn=!1,this.openNode(Re,qe,kt),qe.state=et.OpenTag,jr=this.indent(Re,qe,kt)+"<"+Re.name,qe.pretty&&qe.width>0)for(_n in Wt=jr.length,lr=Re.attribs)!Bt.call(lr,_n)||(Wt+(jn=this.attribute(lr[_n],qe,kt)).length>qe.width?(cr=this.indent(Re,qe,kt+1)+jn,jr+=this.endline(Re,qe,kt)+cr,Wt=cr.length):(jr+=cr=" "+jn,Wt+=cr.length));else for(_n in fn=Re.attribs)!Bt.call(fn,_n)||(jr+=this.attribute(fn[_n],qe,kt));if(Lt=0===(Ge=Re.children.length)?null:Re.children[0],0===Ge||Re.children.every(function(ur){return(ur.type===Ue.Text||ur.type===Ue.Raw||ur.type===Ue.CData)&&""===ur.value}))qe.allowEmpty?(jr+=">",qe.state=et.CloseTag,jr+="</"+Re.name+">"+this.endline(Re,qe,kt)):(qe.state=et.CloseTag,jr+=qe.spaceBeforeSlash+"/>"+this.endline(Re,qe,kt));else if(!qe.pretty||1!==Ge||Lt.type!==Ue.Text&&Lt.type!==Ue.Raw&&Lt.type!==Ue.CData||null==Lt.value){if(qe.dontPrettyTextNodes)for(bt=0,Mn=(qo=Re.children).length;bt<Mn;bt++)if(((Be=qo[bt]).type===Ue.Text||Be.type===Ue.Raw||Be.type===Ue.CData)&&null!=Be.value){qe.suppressPrettyCount++,Gn=!0;break}for(jr+=">"+this.endline(Re,qe,kt),qe.state=et.InsideTag,lt=0,Dn=(Fs=Re.children).length;lt<Dn;lt++)jr+=this.writeChildNode(Be=Fs[lt],qe,kt+1);qe.state=et.CloseTag,jr+=this.indent(Re,qe,kt)+"</"+Re.name+">",Gn&&qe.suppressPrettyCount--,jr+=this.endline(Re,qe,kt),qe.state=et.None}else jr+=">",qe.state=et.InsideTag,qe.suppressPrettyCount++,Gn=!0,jr+=this.writeChildNode(Lt,qe,kt+1),qe.suppressPrettyCount--,Gn=!1,qe.state=et.CloseTag,jr+="</"+Re.name+">"+this.endline(Re,qe,kt);return this.closeNode(Re,qe,kt),jr}writeChildNode(Re,qe,kt){switch(Re.type){case Ue.CData:return this.cdata(Re,qe,kt);case Ue.Comment:return this.comment(Re,qe,kt);case Ue.Element:return this.element(Re,qe,kt);case Ue.Raw:return this.raw(Re,qe,kt);case Ue.Text:return this.text(Re,qe,kt);case Ue.ProcessingInstruction:return this.processingInstruction(Re,qe,kt);case Ue.Dummy:return"";case Ue.Declaration:return this.declaration(Re,qe,kt);case Ue.DocType:return this.docType(Re,qe,kt);case Ue.AttributeDeclaration:return this.dtdAttList(Re,qe,kt);case Ue.ElementDeclaration:return this.dtdElement(Re,qe,kt);case Ue.EntityDeclaration:return this.dtdEntity(Re,qe,kt);case Ue.NotationDeclaration:return this.dtdNotation(Re,qe,kt);default:throw new Error("Unknown XML node type: "+Re.constructor.name)}}processingInstruction(Re,qe,kt){var xe;return this.openNode(Re,qe,kt),qe.state=et.OpenTag,xe=this.indent(Re,qe,kt)+"<?",qe.state=et.InsideTag,xe+=Re.target,Re.value&&(xe+=" "+Re.value),qe.state=et.CloseTag,xe+=qe.spaceBeforeSlash+"?>",xe+=this.endline(Re,qe,kt),qe.state=et.None,this.closeNode(Re,qe,kt),xe}raw(Re,qe,kt){var xe;return this.openNode(Re,qe,kt),qe.state=et.OpenTag,xe=this.indent(Re,qe,kt),qe.state=et.InsideTag,xe+=Re.value,qe.state=et.CloseTag,xe+=this.endline(Re,qe,kt),qe.state=et.None,this.closeNode(Re,qe,kt),xe}text(Re,qe,kt){var xe;return this.openNode(Re,qe,kt),qe.state=et.OpenTag,xe=this.indent(Re,qe,kt),qe.state=et.InsideTag,xe+=Re.value,qe.state=et.CloseTag,xe+=this.endline(Re,qe,kt),qe.state=et.None,this.closeNode(Re,qe,kt),xe}dtdAttList(Re,qe,kt){var xe;return this.openNode(Re,qe,kt),qe.state=et.OpenTag,xe=this.indent(Re,qe,kt)+"<!ATTLIST",qe.state=et.InsideTag,xe+=" "+Re.elementName+" "+Re.attributeName+" "+Re.attributeType,"#DEFAULT"!==Re.defaultValueType&&(xe+=" "+Re.defaultValueType),Re.defaultValue&&(xe+=' "'+Re.defaultValue+'"'),qe.state=et.CloseTag,xe+=qe.spaceBeforeSlash+">"+this.endline(Re,qe,kt),qe.state=et.None,this.closeNode(Re,qe,kt),xe}dtdElement(Re,qe,kt){var xe;return this.openNode(Re,qe,kt),qe.state=et.OpenTag,xe=this.indent(Re,qe,kt)+"<!ELEMENT",qe.state=et.InsideTag,xe+=" "+Re.name+" "+Re.value,qe.state=et.CloseTag,xe+=qe.spaceBeforeSlash+">"+this.endline(Re,qe,kt),qe.state=et.None,this.closeNode(Re,qe,kt),xe}dtdEntity(Re,qe,kt){var xe;return this.openNode(Re,qe,kt),qe.state=et.OpenTag,xe=this.indent(Re,qe,kt)+"<!ENTITY",qe.state=et.InsideTag,Re.pe&&(xe+=" %"),xe+=" "+Re.name,Re.value?xe+=' "'+Re.value+'"':(Re.pubID&&Re.sysID?xe+=' PUBLIC "'+Re.pubID+'" "'+Re.sysID+'"':Re.sysID&&(xe+=' SYSTEM "'+Re.sysID+'"'),Re.nData&&(xe+=" NDATA "+Re.nData)),qe.state=et.CloseTag,xe+=qe.spaceBeforeSlash+">"+this.endline(Re,qe,kt),qe.state=et.None,this.closeNode(Re,qe,kt),xe}dtdNotation(Re,qe,kt){var xe;return this.openNode(Re,qe,kt),qe.state=et.OpenTag,xe=this.indent(Re,qe,kt)+"<!NOTATION",qe.state=et.InsideTag,xe+=" "+Re.name,Re.pubID&&Re.sysID?xe+=' PUBLIC "'+Re.pubID+'" "'+Re.sysID+'"':Re.pubID?xe+=' PUBLIC "'+Re.pubID+'"':Re.sysID&&(xe+=' SYSTEM "'+Re.sysID+'"'),qe.state=et.CloseTag,xe+=qe.spaceBeforeSlash+">"+this.endline(Re,qe,kt),qe.state=et.None,this.closeNode(Re,qe,kt),xe}openNode(Re,qe,kt){}closeNode(Re,qe,kt){}openAttribute(Re,qe,kt){}closeAttribute(Re,qe,kt){}}}).call(this)},7904:function(kn,Fn,yt){(function(){var Ue,et,Xe,d,Qe,xt,De,Tt,zt;({assign:Tt,isFunction:zt}=yt(3452)),Xe=yt(9906),d=yt(519),Qe=yt(1105),De=yt(4354),xt=yt(7647),Ue=yt(2269),et=yt(6316),kn.exports.create=function(en,Gt,it,dt){var Mt,bn;if(null==en)throw new Error("Root element needs a name.");return dt=Tt({},Gt,it,dt),bn=(Mt=new d(dt)).element(en),dt.headless||(Mt.declaration(dt),(null!=dt.pubID||null!=dt.sysID)&&Mt.dtd(dt)),bn},kn.exports.begin=function(en,Gt,it){return zt(en)&&([Gt,it]=[en,Gt],en={}),Gt?new Qe(en,Gt,it):new d(en)},kn.exports.stringWriter=function(en){return new De(en)},kn.exports.streamWriter=function(en,Gt){return new xt(en,Gt)},kn.exports.implementation=new Xe,kn.exports.nodeType=Ue,kn.exports.writerState=et}).call(this)}},kn=>{kn(kn.s=3595)}]);