var Gse=Object.defineProperty,$se=(Mn,kn,pt)=>kn in Mn?Gse(Mn,kn,{enumerable:!0,configurable:!0,writable:!0,value:pt}):Mn[kn]=pt,Di=(Mn,kn,pt)=>($se(Mn,"symbol"!=typeof kn?kn+"":kn,pt),pt);(self.webpackChunkojp_demo_app=self.webpackChunkojp_demo_app||[]).push([[179],{5985:(Mn,kn,pt)=>{"use strict";var Ye={};pt.r(Ye),pt.d(Ye,{DEBUG_LEVEL:()=>pf,DateHelpers:()=>ZA,Duration:()=>Gu,EMPTY_API_CONFIG:()=>bC,GeoPosition:()=>cs,GeoPositionBBOX:()=>m1,IS_NODE_CLI:()=>KN,JourneyService:()=>f1,Location:()=>fa,LocationInformationRequest:()=>jm,PtSituationElement:()=>iu,PublicTransportMode:()=>mC,SDK_VERSION:()=>a7,ServiceBooking:()=>_1,StopEvent:()=>_C,StopEventRequest:()=>cv,StopPoint:()=>mf,Trip:()=>wC,TripContinuousLeg:()=>b1,TripLeg:()=>nR,TripLocationPoint:()=>Um,TripRequest:()=>Hm,TripTimedLeg:()=>uv,XMLParser:()=>_7,XML_BuilderConfigOJPv1:()=>l7,XML_ConfigOJPv2:()=>e3,XML_Helpers:()=>c7,XML_ParserConfigOJPv1:()=>QN});var tt={};function Ue(n){return"function"==typeof n}function h(n){const e=n(i=>{Error.call(i),i.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}pt.r(tt),pt.d(tt,{hasBrowserEnv:()=>pR,hasStandardBrowserEnv:()=>mX,hasStandardBrowserWebWorkerEnv:()=>gX,navigator:()=>fR,origin:()=>_X});const dt=h(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function Ct(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class Se{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const a of e)a.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(Ue(i))try{i()}catch(a){t=a instanceof dt?a.errors:[a]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const a of r)try{nn(a)}catch(d){t=null!=t?t:[],d instanceof dt?t=[...t,...d.errors]:t.push(d)}}if(t)throw new dt(t)}}add(t){var e;if(t&&t!==this)if(this.closed)nn(t);else{if(t instanceof Se){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&Ct(e,t)}remove(t){const{_finalizers:e}=this;e&&Ct(e,t),t instanceof Se&&t._removeParent(this)}}Se.EMPTY=(()=>{const n=new Se;return n.closed=!0,n})();const Mt=Se.EMPTY;function $t(n){return n instanceof Se||n&&"closed"in n&&Ue(n.remove)&&Ue(n.add)&&Ue(n.unsubscribe)}function nn(n){Ue(n)?n():n.unsubscribe()}const jt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},rt={setTimeout(n,t,...e){const{delegate:i}=rt;return null!=i&&i.setTimeout?i.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=rt;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function ft(n){rt.setTimeout(()=>{const{onUnhandledError:t}=jt;if(!t)throw n;t(n)})}function Rt(){}const xn=Vt("C",void 0,void 0);function Vt(n,t,e){return{kind:n,value:t,error:e}}let En=null;function ke(n){if(jt.useDeprecatedSynchronousErrorHandling){const t=!En;if(t&&(En={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:i}=En;if(En=null,e)throw i}}else n()}class Ft extends Se{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,$t(t)&&t.add(this)):this.destination=tn}static create(t,e,i){return new qe(t,e,i)}next(t){this.isStopped?ct(function Rn(n){return Vt("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?ct(function ui(n){return Vt("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?ct(xn,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Te=Function.prototype.bind;function lt(n,t){return Te.call(n,t)}class Ve{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(i){Nt(i)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(i){Nt(i)}else Nt(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){Nt(e)}}}class qe extends Ft{constructor(t,e,i){let r;if(super(),Ue(t)||!t)r={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=i?i:void 0};else{let a;this&&jt.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&lt(t.next,a),error:t.error&&lt(t.error,a),complete:t.complete&&lt(t.complete,a)}):r=t}this.destination=new Ve(r)}}function Nt(n){jt.useDeprecatedSynchronousErrorHandling?function We(n){jt.useDeprecatedSynchronousErrorHandling&&En&&(En.errorThrown=!0,En.error=n)}(n):ft(n)}function ct(n,t){const{onStoppedNotification:e}=jt;e&&rt.setTimeout(()=>e(n,t))}const tn={closed:!0,next:Rt,error:function xt(n){throw n},complete:Rt},Pn="function"==typeof Symbol&&Symbol.observable||"@@observable";function vn(n){return n}function Kn(n){return 0===n.length?vn:1===n.length?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}let yi=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){const a=function qr(n){return n&&n instanceof Ft||function br(n){return n&&Ue(n.next)&&Ue(n.error)&&Ue(n.complete)}(n)&&$t(n)}(e)?e:new qe(e,i,r);return ke(()=>{const{operator:d,source:b}=this;a.add(d?d.call(a,b):b?this._subscribe(a):this._trySubscribe(a))}),a}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return new(i=Wn(i))((r,a)=>{const d=new qe({next:b=>{try{e(b)}catch(x){a(x),d.unsubscribe()}},error:a,complete:r});this.subscribe(d)})}_subscribe(e){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(e)}[Pn](){return this}pipe(...e){return Kn(e)(this)}toPromise(e){return new(e=Wn(e))((i,r)=>{let a;this.subscribe(d=>a=d,d=>r(d),()=>i(a))})}}return n.create=t=>new n(t),n})();function Wn(n){var t;return null!==(t=null!=n?n:jt.Promise)&&void 0!==t?t:Promise}const ds=h(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let On=(()=>{class n extends yi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const i=new ks(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new ds}next(e){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(e)}})}error(e){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:i,isStopped:r,observers:a}=this;return i||r?Mt:(this.currentObservers=null,a.push(e),new Se(()=>{this.currentObservers=null,Ct(a,e)}))}_checkFinalizedStatuses(e){const{hasError:i,thrownError:r,isStopped:a}=this;i?e.error(r):a&&e.complete()}asObservable(){const e=new yi;return e.source=this,e}}return n.create=(t,e)=>new ks(t,e),n})();class ks extends On{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:Mt}}function $s(n){return Ue(null==n?void 0:n.lift)}function Q(n){return t=>{if($s(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ce(n,t,e,i,r){return new dn(n,t,e,i,r)}class dn extends Ft{constructor(t,e,i,r,a,d){super(t),this.onFinalize=a,this.shouldUnsubscribe=d,this._next=e?function(b){try{e(b)}catch(x){t.error(x)}}:super._next,this._error=r?function(b){try{r(b)}catch(x){t.error(x)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(b){t.error(b)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function st(n,t){return Q((e,i)=>{let r=0;e.subscribe(Ce(i,a=>{i.next(n.call(t,a,r++))}))})}function Pa(n){return this instanceof Pa?(this.v=n,this):new Pa(n)}function Xu(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(n,t||[]),a=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),b("next"),b("throw"),b("return",function d(te){return function(se){return Promise.resolve(se).then(te,B)}}),r[Symbol.asyncIterator]=function(){return this},r;function b(te,se){i[te]&&(r[te]=function(me){return new Promise(function(ye,$e){a.push([te,me,ye,$e])>1||x(te,me)})},se&&(r[te]=se(r[te])))}function x(te,se){try{!function A(te){te.value instanceof Pa?Promise.resolve(te.value.v).then(O,B):X(a[0][2],te)}(i[te](se))}catch(me){X(a[0][3],me)}}function O(te){x("next",te)}function B(te){x("throw",te)}function X(te,se){te(se),a.shift(),a.length&&x(a[0][0],a[0][1])}}function Nd(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function lo(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],i=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(a){e[a]=n[a]&&function(d){return new Promise(function(b,x){!function r(a,d,b,x){Promise.resolve(x).then(function(A){a({value:A,done:b})},d)}(b,x,(d=n[a](d)).done,d.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Ge=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Le(n){return Ue(null==n?void 0:n.then)}function Je(n){return Ue(n[Pn])}function mt(n){return Symbol.asyncIterator&&Ue(null==n?void 0:n[Symbol.asyncIterator])}function nt(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Dt=function _t(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Et(n){return Ue(null==n?void 0:n[Dt])}function Yt(n){return Xu(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:i,done:r}=yield Pa(e.read());if(r)return yield Pa(void 0);yield yield Pa(i)}}finally{e.releaseLock()}})}function hn(n){return Ue(null==n?void 0:n.getReader)}function mn(n){if(n instanceof yi)return n;if(null!=n){if(Je(n))return function ai(n){return new yi(t=>{const e=n[Pn]();if(Ue(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Ge(n))return function mi(n){return new yi(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(Le(n))return function gi(n){return new yi(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,ft)})}(n);if(mt(n))return vr(n);if(Et(n))return function di(n){return new yi(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(hn(n))return function lr(n){return vr(Yt(n))}(n)}throw nt(n)}function vr(n){return new yi(t=>{(function Pi(n,t){var e,i,r,a;return function In(n,t,e,i){return new(e||(e=Promise))(function(a,d){function b(O){try{A(i.next(O))}catch(B){d(B)}}function x(O){try{A(i.throw(O))}catch(B){d(B)}}function A(O){O.done?a(O.value):function r(a){return a instanceof e?a:new e(function(d){d(a)})}(O.value).then(b,x)}A((i=i.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=Nd(n);!(i=yield e.next()).done;)if(t.next(i.value),t.closed)return}catch(d){r={error:d}}finally{try{i&&!i.done&&(a=e.return)&&(yield a.call(e))}finally{if(r)throw r.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function tr(n,t,e,i=0,r=!1){const a=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(a),!r)return a}function Ar(n,t,e=1/0){return Ue(t)?Ar((i,r)=>st((a,d)=>t(i,a,r,d))(mn(n(i,r))),e):("number"==typeof t&&(e=t),Q((i,r)=>function co(n,t,e,i,r,a,d,b){const x=[];let A=0,O=0,B=!1;const X=()=>{B&&!x.length&&!A&&t.complete()},te=me=>A<i?se(me):x.push(me),se=me=>{a&&t.next(me),A++;let ye=!1;mn(e(me,O++)).subscribe(Ce(t,$e=>{null==r||r($e),a?te($e):t.next($e)},()=>{ye=!0},void 0,()=>{if(ye)try{for(A--;x.length&&A<i;){const $e=x.shift();d?tr(t,d,()=>se($e)):se($e)}X()}catch($e){t.error($e)}}))};return n.subscribe(Ce(t,te,()=>{B=!0,X()})),()=>{null==b||b()}}(i,r,n,e)))}function Qo(n=1/0){return Ar(vn,n)}const uo=new yi(n=>n.complete());function Il(n){return n&&Ue(n.schedule)}function Vd(n){return n[n.length-1]}function Gh(n){return Ue(Vd(n))?n.pop():void 0}function cu(n){return Il(Vd(n))?n.pop():void 0}function Cf(n,t=0){return Q((e,i)=>{e.subscribe(Ce(i,r=>tr(i,n,()=>i.next(r),t),()=>tr(i,n,()=>i.complete(),t),r=>tr(i,n,()=>i.error(r),t)))})}function Yu(n,t=0){return Q((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function ya(n,t){if(!n)throw new Error("Iterable cannot be null");return new yi(e=>{tr(e,t,()=>{const i=n[Symbol.asyncIterator]();tr(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function es(n,t){return t?function $h(n,t){if(null!=n){if(Je(n))return function jd(n,t){return mn(n).pipe(Yu(t),Cf(t))}(n,t);if(Ge(n))return function Ml(n,t){return new yi(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}(n,t);if(Le(n))return function hl(n,t){return mn(n).pipe(Yu(t),Cf(t))}(n,t);if(mt(n))return ya(n,t);if(Et(n))return function Al(n,t){return new yi(e=>{let i;return tr(e,t,()=>{i=n[Dt](),tr(e,t,()=>{let r,a;try{({value:r,done:a}=i.next())}catch(d){return void e.error(d)}a?e.complete():e.next(r)},0,!0)}),()=>Ue(null==i?void 0:i.return)&&i.return()})}(n,t);if(hn(n))return function Ql(n,t){return ya(Yt(n),t)}(n,t)}throw nt(n)}(n,t):mn(n)}function Oo(...n){const t=cu(n),e=function ig(n,t){return"number"==typeof Vd(n)?n.pop():t}(n,1/0),i=n;return i.length?1===i.length?mn(i[0]):Qo(e)(es(i,t)):uo}function Rl(n={}){const{connector:t=(()=>new On),resetOnError:e=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return a=>{let d,b,x,A=0,O=!1,B=!1;const X=()=>{null==b||b.unsubscribe(),b=void 0},te=()=>{X(),d=x=void 0,O=B=!1},se=()=>{const me=d;te(),null==me||me.unsubscribe()};return Q((me,ye)=>{A++,!B&&!O&&X();const $e=x=null!=x?x:t();ye.add(()=>{A--,0===A&&!B&&!O&&(b=Ud(se,r))}),$e.subscribe(ye),!d&&A>0&&(d=new qe({next:ht=>$e.next(ht),error:ht=>{B=!0,X(),b=Ud(te,e,ht),$e.error(ht)},complete:()=>{O=!0,X(),b=Ud(te,i),$e.complete()}}),mn(me).subscribe(d))})(a)}}function Ud(n,t,...e){if(!0===t)return void n();if(!1===t)return;const i=new qe({next:()=>{i.unsubscribe(),n()}});return t(...e).subscribe(i)}function Ro(n){for(let t in n)if(n[t]===Ro)return t;throw Error("Could not find renamed property on target object.")}function rg(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function Cr(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Cr).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function ec(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const Wh=Ro({__forward_ref__:Ro});function Dr(n){return n.__forward_ref__=Dr,n.toString=function(){return Cr(this())},n}function $i(n){return uu(n)?n():n}function uu(n){return"function"==typeof n&&n.hasOwnProperty(Wh)&&n.__forward_ref__===Dr}class qt extends Error{constructor(t,e){super(function Hd(n,t){return`NG0${Math.abs(n)}${t?": "+t.trim():""}`}(t,e)),this.code=t}}function Gn(n){return"string"==typeof n?n:null==n?"":String(n)}function Ec(n,t){throw new qt(-201,!1)}function Lr(n,t){null==n&&function yo(n,t,e,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${e} ${i} ${t} <=Actual]`))}(t,n,null,"!=")}function wn(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Nn(n){return{providers:n.providers||[],imports:n.imports||[]}}function Ns(n){return Mc(n,is)||Mc(n,ml)}function Mc(n,t){return n.hasOwnProperty(t)?n[t]:null}function fl(n){return n&&(n.hasOwnProperty(Jh)||n.hasOwnProperty(Gd))?n[Jh]:null}const is=Ro({\u0275prov:Ro}),Jh=Ro({\u0275inj:Ro}),ml=Ro({ngInjectableDef:Ro}),Gd=Ro({ngInjectorDef:Ro});var Ei=(()=>((Ei=Ei||{})[Ei.Default=0]="Default",Ei[Ei.Host=1]="Host",Ei[Ei.Self=2]="Self",Ei[Ei.SkipSelf=4]="SkipSelf",Ei[Ei.Optional=8]="Optional",Ei))();let Ac;function Ts(n){const t=Ac;return Ac=n,t}function sb(n,t,e){const i=Ns(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&Ei.Optional?null:void 0!==t?t:void Ec(Cr(n))}function bs(n){return{toString:n}.toString()}var kl=(()=>((kl=kl||{})[kl.OnPush=0]="OnPush",kl[kl.Default=1]="Default",kl))(),oa=(()=>{return(n=oa||(oa={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",oa;var n})();const vo=(()=>"undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof global&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self)(),gl={},xo=[],Rc=Ro({\u0275cmp:Ro}),Af=Ro({\u0275dir:Ro}),$d=Ro({\u0275pipe:Ro}),La=Ro({\u0275mod:Ro}),Si=Ro({\u0275fac:Ro}),Vn=Ro({__NG_ELEMENT_ID__:Ro});let ag=0;function Jt(n){return bs(()=>{const e=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===kl.OnPush,directiveDefs:null,pipeDefs:null,standalone:e,dependencies:e&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||xo,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||oa.Emulated,id:"c"+ag++,styles:n.styles||xo,_:null,setInput:null,schemas:n.schemas||null,tView:null},a=n.dependencies,d=n.features;return r.inputs=Pf(n.inputs,i),r.outputs=Pf(n.outputs),d&&d.forEach(b=>b(r)),r.directiveDefs=a?()=>("function"==typeof a?a():a).map(Wd).filter(li):null,r.pipeDefs=a?()=>("function"==typeof a?a():a).map(Ds).filter(li):null,r})}function Wd(n){return ir(n)||Bs(n)}function li(n){return null!==n}function ii(n){return bs(()=>({type:n.type,bootstrap:n.bootstrap||xo,declarations:n.declarations||xo,imports:n.imports||xo,exports:n.exports||xo,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Pf(n,t){if(null==n)return gl;const e={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],a=r;Array.isArray(r)&&(a=r[1],r=r[0]),e[r]=i,t&&(t[r]=a)}return e}const cn=Jt;function Cs(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function ir(n){return n[Rc]||null}function Bs(n){return n[Af]||null}function Ds(n){return n[$d]||null}function sa(n,t){const e=n[La]||null;if(!e&&!0===t)throw new Error(`Type ${Cr(n)} does not have '\u0275mod' property.`);return e}function Ys(n){return Array.isArray(n)&&"object"==typeof n[1]}function zs(n){return Array.isArray(n)&&!0===n[1]}function ic(n){return 0!=(8&n.flags)}function qi(n){return 2==(2&n.flags)}function kc(n){return 1==(1&n.flags)}function Sa(n){return null!==n.template}function Of(n){return 0!=(256&n[2])}function Qu(n,t){return n.hasOwnProperty(Si)?n[Si]:null}class np{constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function ho(){return ug}function ug(n){return n.type.prototype.ngOnChanges&&(n.setInput=dg),Ga}function Ga(){const n=rp(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===gl)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function dg(n,t,e,i){const r=rp(n)||function hg(n,t){return n[ip]=t}(n,{previous:gl,current:null}),a=r.current||(r.current={}),d=r.previous,b=this.declaredInputs[e],x=d[b];a[b]=new np(x&&x.currentValue,t,d===gl),n[i]=t}ho.ngInherit=!0;const ip="__ngSimpleChanges__";function rp(n){return n[ip]||null}function Es(n){for(;Array.isArray(n);)n=n[0];return n}function Lc(n,t){return Es(t[n])}function Fa(n,t){return Es(t[n.index])}function lp(n,t){return n.data[t]}function rc(n,t){return n[t]}function aa(n,t){const e=t[n];return Ys(e)?e:e[0]}function cp(n){return 64==(64&n[2])}function oc(n,t){return null==t?null:n[t]}function jf(n){n[18]=0}function Oc(n,t){n[5]+=t;let e=n,i=n[3];for(;null!==i&&(1===t&&1===e[5]||-1===t&&0===e[5]);)i[5]+=t,e=i,i=i[3]}const Qi={lFrame:vg(null),bindingsEnabled:!0};function Uf(){return Qi.bindingsEnabled}function _n(){return Qi.lFrame.lView}function Rr(){return Qi.lFrame.tView}function Qn(n){return Qi.lFrame.contextLView=n,n[8]}function ei(n){return Qi.lFrame.contextLView=null,n}function vs(){let n=gb();for(;null!==n&&64===n.type;)n=n.parent;return n}function gb(){return Qi.lFrame.currentTNode}function $a(n,t){const e=Qi.lFrame;e.currentTNode=n,e.isParent=t}function mu(){return Qi.lFrame.isParent}function eh(){Qi.lFrame.isParent=!1}function Js(){const n=Qi.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function Ol(){return Qi.lFrame.bindingIndex}function yl(){return Qi.lFrame.bindingIndex++}function Wa(n){const t=Qi.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function yg(n,t){const e=Qi.lFrame;e.bindingIndex=e.bindingRootIndex=n,ac(t)}function ac(n){Qi.lFrame.currentDirectiveIndex=n}function Fn(n){const t=Qi.lFrame.currentDirectiveIndex;return-1===t?null:n[t]}function qf(){return Qi.lFrame.currentQueryIndex}function Gf(n){Qi.lFrame.currentQueryIndex=n}function jv(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function od(n,t,e){if(e&Ei.SkipSelf){let r=t,a=n;for(;!(r=r.parent,null!==r||e&Ei.Host||(r=jv(a),null===r||(a=a[15],10&r.type))););if(null===r)return!1;t=r,n=a}const i=Qi.lFrame=th();return i.currentTNode=t,i.lView=n,!0}function hp(n){const t=th(),e=n[1];Qi.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function th(){const n=Qi.lFrame,t=null===n?null:n.child;return null===t?vg(n):t}function vg(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function _b(){const n=Qi.lFrame;return Qi.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const $f=_b;function sd(){const n=_b();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function wo(){return Qi.lFrame.selectedIndex}function Is(n){Qi.lFrame.selectedIndex=n}function Yo(){const n=Qi.lFrame;return lp(n.tView,n.selectedIndex)}function gu(){Qi.lFrame.currentNamespace="svg"}function nh(){!function bb(){Qi.lFrame.currentNamespace=null}()}function ad(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){const a=n.data[e].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:b,ngAfterViewInit:x,ngAfterViewChecked:A,ngOnDestroy:O}=a;d&&(n.contentHooks||(n.contentHooks=[])).push(-e,d),b&&((n.contentHooks||(n.contentHooks=[])).push(e,b),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,b)),x&&(n.viewHooks||(n.viewHooks=[])).push(-e,x),A&&((n.viewHooks||(n.viewHooks=[])).push(e,A),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,A)),null!=O&&(n.destroyHooks||(n.destroyHooks=[])).push(e,O)}}function ih(n,t,e){wg(n,t,3,e)}function fp(n,t,e,i){(3&n[2])===e&&wg(n,t,e,i)}function Xf(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function wg(n,t,e,i){const a=null!=i?i:-1,d=t.length-1;let b=0;for(let x=void 0!==i?65535&n[18]:0;x<d;x++)if("number"==typeof t[x+1]){if(b=t[x],null!=i&&b>=i)break}else t[x]<0&&(n[18]+=65536),(b<a||-1==a)&&(Uv(n,e,t,x),n[18]=(4294901760&n[18])+x+2),x++}function Uv(n,t,e,i){const r=e[i]<0,a=e[i+1],b=n[r?-e[i]:e[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{a.call(b)}finally{}}}else try{a.call(b)}finally{}}class lc{constructor(t,e,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function ld(n,t,e){let i=0;for(;i<e.length;){const r=e[i];if("number"==typeof r){if(0!==r)break;i++;const a=e[i++],d=e[i++],b=e[i++];n.setAttribute(t,d,b,a)}else{const a=r,d=e[++i];Zf(a)?n.setProperty(t,a,d):n.setAttribute(t,a,d),i++}}return i}function uc(n){return 3===n||4===n||6===n}function Zf(n){return 64===n.charCodeAt(0)}function Na(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?e=r:0===e||vb(n,e,r,null,-1===e||2===e?t[++i]:null)}}return n}function vb(n,t,e,i,r){let a=0,d=n.length;if(-1===t)d=-1;else for(;a<n.length;){const b=n[a++];if("number"==typeof b){if(b===t){d=-1;break}if(b>t){d=a-1;break}}}for(;a<n.length;){const b=n[a];if("number"==typeof b)break;if(b===e){if(null===i)return void(null!==r&&(n[a+1]=r));if(i===n[a+1])return void(n[a+2]=r)}a++,null!==i&&a++,null!==r&&a++}-1!==d&&(n.splice(d,0,t),a=d+1),n.splice(a++,0,e),null!==i&&n.splice(a++,0,i),null!==r&&n.splice(a++,0,r)}function xb(n){return-1!==n}function cd(n){return 32767&n}function _u(n,t){let e=function Yf(n){return n>>16}(n),i=t;for(;e>0;)i=i[15],e--;return i}let mp=!0;function ud(n){const t=mp;return mp=n,t}let wb=0;const Ls={};function ah(n,t){const e=Wr(n,t);if(-1!==e)return e;const i=t[1];i.firstCreatePass&&(n.injectorIndex=t.length,dd(i.data,n),dd(t,null),dd(i.blueprint,null));const r=er(n,t),a=n.injectorIndex;if(xb(r)){const d=cd(r),b=_u(r,t),x=b[1].data;for(let A=0;A<8;A++)t[a+A]=b[d+A]|x[d+A]}return t[a+8]=r,a}function dd(n,t){n.push(0,0,0,0,0,0,0,0,t)}function Wr(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function er(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;null!==r;){if(i=fd(r),null===i)return-1;if(e++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return-1}function _p(n,t,e){!function Ta(n,t,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Vn)&&(i=e[Vn]),null==i&&(i=e[Vn]=wb++);const r=255&i;t.data[n+(r>>5)]|=1<<r}(n,t,e)}function bp(n,t,e){if(e&Ei.Optional||void 0!==n)return n;Ec()}function hd(n,t,e,i){if(e&Ei.Optional&&void 0===i&&(i=null),0==(e&(Ei.Self|Ei.Host))){const r=n[9],a=Ts(void 0);try{return r?r.get(t,i,e&Ei.Optional):sb(t,i,e&Ei.Optional)}finally{Ts(a)}}return bp(i,0,e)}function Jf(n,t,e,i=Ei.Default,r){if(null!==n){if(1024&t[2]){const d=function Qf(n,t,e,i,r){let a=n,d=t;for(;null!==a&&null!==d&&1024&d[2]&&!(256&d[2]);){const b=lh(a,d,e,i|Ei.Self,Ls);if(b!==Ls)return b;let x=a.parent;if(!x){const A=d[21];if(A){const O=A.get(e,Ls,i);if(O!==Ls)return O}x=fd(d),d=d[15]}a=x}return r}(n,t,e,i,Ls);if(d!==Ls)return d}const a=lh(n,t,e,i,Ls);if(a!==Ls)return a}return hd(t,e,i,r)}function lh(n,t,e,i,r){const a=function Kf(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(Vn)?n[Vn]:void 0;return"number"==typeof t?t>=0?255&t:Tg:t}(e);if("function"==typeof a){if(!od(t,n,i))return i&Ei.Host?bp(r,0,i):hd(t,e,i,r);try{const d=a(i);if(null!=d||i&Ei.Optional)return d;Ec()}finally{$f()}}else if("number"==typeof a){let d=null,b=Wr(n,t),x=-1,A=i&Ei.Host?t[16][6]:null;for((-1===b||i&Ei.SkipSelf)&&(x=-1===b?er(n,t):t[b+8],-1!==x&&pd(i,!1)?(d=t[1],b=cd(x),t=_u(x,t)):b=-1);-1!==b;){const O=t[1];if(ch(a,b,O.data)){const B=Fc(b,t,e,d,i,A);if(B!==Ls)return B}x=t[b+8],-1!==x&&pd(i,t[1].data[b+8]===A)&&ch(a,b,t)?(d=O,b=cd(x),t=_u(x,t)):b=-1}}return r}function Fc(n,t,e,i,r,a){const d=t[1],b=d.data[n+8],O=Fl(b,d,e,null==i?qi(b)&&mp:i!=d&&0!=(3&b.type),r&Ei.Host&&a===b);return null!==O?Ya(t,d,O,b):Ls}function Fl(n,t,e,i,r){const a=n.providerIndexes,d=t.data,b=1048575&a,x=n.directiveStart,O=a>>20,X=r?b+O:n.directiveEnd;for(let te=i?b:b+O;te<X;te++){const se=d[te];if(te<x&&e===se||te>=x&&se.type===e)return te}if(r){const te=d[x];if(te&&Sa(te)&&te.type===e)return x}return null}function Ya(n,t,e,i){let r=n[e];const a=t.data;if(function Qt(n){return n instanceof lc}(r)){const d=r;d.resolving&&function ni(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new qt(-200,`Circular dependency in DI detected for ${n}${e}`)}(function bo(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Gn(n)}(a[e]));const b=ud(d.canSeeViewProviders);d.resolving=!0;const x=d.injectImpl?Ts(d.injectImpl):null;od(n,i,Ei.Default);try{r=n[e]=d.factory(void 0,a,n,i),t.firstCreatePass&&e>=i.directiveStart&&function Po(n,t,e){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:a}=t.type.prototype;if(i){const d=ug(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,d),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,d)}r&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,r),a&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,a),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,a))}(e,a[e],t)}finally{null!==x&&Ts(x),ud(b),d.resolving=!1,$f()}}return r}function ch(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function pd(n,t){return!(n&Ei.Self||n&Ei.Host&&t)}class yu{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return Jf(this._tNode,this._lView,t,i,e)}}function Tg(){return new yu(vs(),_n())}function gr(n){return bs(()=>{const t=n.prototype.constructor,e=t[Si]||yp(t),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const a=r[Si]||yp(r);if(a&&a!==e)return a;r=Object.getPrototypeOf(r)}return a=>new a})}function yp(n){return uu(n)?()=>{const t=yp($i(n));return t&&t()}:Qu(n)}function fd(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[6]:null}function hs(n){return function bu(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const i=e.length;let r=0;for(;r<i;){const a=e[r];if(uc(a))break;if(0===a)r+=2;else if("number"==typeof a)for(r++;r<i&&"string"==typeof e[r];)r++;else{if(a===t)return e[r+1];r+=2}}}return null}(vs(),n)}const Nl="__parameters__";function xu(n,t,e){return bs(()=>{const i=function Nc(n){return function(...e){if(n){const i=n(...e);for(const r in i)this[r]=i[r]}}}(t);function r(...a){if(this instanceof r)return i.apply(this,a),this;const d=new r(...a);return b.annotation=d,b;function b(x,A,O){const B=x.hasOwnProperty(Nl)?x[Nl]:Object.defineProperty(x,Nl,{value:[]})[Nl];for(;B.length<=O;)B.push(null);return(B[O]=B[O]||[]).push(d),x}}return e&&(r.prototype=Object.create(e.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class en{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=wn({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Ba(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)?(t===n&&(t=n.slice(0,e)),Ba(i,t)):t!==n&&t.push(i)}return t}function dc(n,t){n.forEach(e=>Array.isArray(e)?dc(e,t):t(e))}function Ag(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function dh(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function xp(n,t){const e=[];for(let i=0;i<n;i++)e.push(t);return e}function za(n,t,e){let i=Bc(n,t);return i>=0?n[1|i]=e:(i=~i,function Ib(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(1===r)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;)n[r]=n[r-2],r--;n[t]=e,n[t+1]=i}}(n,i,t,e)),i}function Su(n,t){const e=Bc(n,t);if(e>=0)return n[1|e]}function Bc(n,t){return function Cu(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){const a=i+(r-i>>1),d=n[a<<e];if(t===d)return a<<e;d>t?r=a:i=a+1}return~(r<<e)}(n,t,1)}const Du={},wp="__NG_DI_FLAG__",Eu="ngTempTokenPath",zc=/\n/gm,pc="__source";let Ja;function Ca(n){const t=Ja;return Ja=n,t}function Gv(n,t=Ei.Default){if(void 0===Ja)throw new qt(-203,!1);return null===Ja?sb(n,void 0,t):Ja.get(n,t&Ei.Optional?null:void 0,t)}function Tt(n,t=Ei.Default){return(function If(){return Ac}()||Gv)($i(n),t)}function $o(n,t=Ei.Default){return"number"!=typeof t&&(t=0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)),Tt(n,t)}function om(n){const t=[];for(let e=0;e<n.length;e++){const i=$i(n[e]);if(Array.isArray(i)){if(0===i.length)throw new qt(900,!1);let r,a=Ei.Default;for(let d=0;d<i.length;d++){const b=i[d],x=Rb(b);"number"==typeof x?-1===x?r=b.token:a|=x:r=b}t.push(Tt(r,a))}else t.push(Tt(i))}return t}function ws(n,t){return n[wp]=t,n.prototype[wp]=t,n}function Rb(n){return n[wp]}const g=ws(xu("Optional"),8),S=ws(xu("SkipSelf"),4);var Jn=(()=>((Jn=Jn||{})[Jn.Important=1]="Important",Jn[Jn.DashCase=2]="DashCase",Jn))();const ur=new Map;let zr=0;const ss="__ngContext__";function vi(n,t){Ys(t)?(n[ss]=t[20],function Or(n){ur.set(n[20],n)}(t)):n[ss]=t}function jl(n,t){return undefined(n,t)}function _d(n){const t=n[3];return zs(t)?t[3]:t}function bd(n){return Iu(n[13])}function fc(n){return Iu(n[4])}function Iu(n){for(;null!==n&&!zs(n);)n=n[4];return n}function Sp(n,t,e,i,r){if(null!=i){let a,d=!1;zs(i)?a=i:Ys(i)&&(d=!0,i=i[0]);const b=Es(i);0===n&&null!==e?null==r?ow(t,e,b):gh(t,e,b,r||null,!0):1===n&&null!==e?gh(t,e,b,r||null,!0):2===n?function Tp(n,t,e){const i=Og(n,t);i&&function qD(n,t,e,i){n.removeChild(t,e,i)}(n,i,t,e)}(t,b,d):3===n&&t.destroyNode(b),null!=a&&function Cp(n,t,e,i,r){const a=e[7];a!==Es(e)&&Sp(t,n,i,a,r);for(let b=10;b<e.length;b++){const x=e[b];Fg(x[1],x,n,t,i,a)}}(t,n,a,e,r)}}function am(n,t,e){return n.createElement(t,e)}function yd(n,t){const e=n[9],i=e.indexOf(t),r=t[3];512&t[2]&&(t[2]&=-513,Oc(r,-1)),e.splice(i,1)}function Lb(n,t){if(n.length<=10)return;const e=10+t,i=n[e];if(i){const r=i[17];null!==r&&r!==n&&yd(r,i),t>0&&(n[e-1][4]=i[4]);const a=dh(n,10+t);!function tw(n,t){Fg(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(i[1],i);const d=a[19];null!==d&&d.detachView(a[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function Ob(n,t){if(!(128&t[2])){const e=t[11];e.destroyNode&&Fg(n,t,e,3,null,null),function Wv(n){let t=n[13];if(!t)return Fb(n[1],n);for(;t;){let e=null;if(Ys(t))e=t[13];else{const i=t[10];i&&(e=i)}if(!e){for(;t&&!t[4]&&t!==n;)Ys(t)&&Fb(t[1],t),t=t[3];null===t&&(t=n),Ys(t)&&Fb(t[1],t),e=t&&t[4]}t=e}}(t)}}function Fb(n,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function HD(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let i=0;i<e.length;i+=2){const r=t[e[i]];if(!(r instanceof lc)){const a=e[i+1];if(Array.isArray(a))for(let d=0;d<a.length;d+=2){const b=r[a[d]],x=a[d+1];try{x.call(b)}finally{}}else try{a.call(r)}finally{}}}}(n,t),function UD(n,t){const e=n.cleanup,i=t[7];let r=-1;if(null!==e)for(let a=0;a<e.length-1;a+=2)if("string"==typeof e[a]){const d=e[a+1],b="function"==typeof d?d(t):Es(t[d]),x=i[r=e[a+2]],A=e[a+3];"boolean"==typeof A?b.removeEventListener(e[a],x,A):A>=0?i[r=A]():i[r=-A].unsubscribe(),a+=2}else{const d=i[r=e[a+1]];e[a].call(d)}if(null!==i){for(let a=r+1;a<i.length;a++)(0,i[a])();t[7]=null}}(n,t),1===t[1].type&&t[11].destroy();const e=t[17];if(null!==e&&zs(t[3])){e!==t[3]&&yd(e,t);const i=t[19];null!==i&&i.detachView(n)}!function xr(n){ur.delete(n[20])}(t)}}function rw(n,t,e){return function Xv(n,t,e){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return e[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===oa.None||r===oa.Emulated)return null}return Fa(i,e)}(n,t.parent,e)}function gh(n,t,e,i,r){n.insertBefore(t,e,i,r)}function ow(n,t,e){n.appendChild(t,e)}function Zv(n,t,e,i,r){null!==i?gh(n,t,e,i,r):ow(n,t,e)}function Og(n,t){return n.parentNode(t)}function Yv(n,t,e){return Kv(n,t,e)}let zb,_h,Ep,Kv=function Jv(n,t,e){return 40&n.type?Fa(n,e):null};function lm(n,t,e,i){const r=rw(n,i,t),a=t[11],b=Yv(i.parent||t[6],i,t);if(null!=r)if(Array.isArray(e))for(let x=0;x<e.length;x++)Zv(a,r,e[x],b,!1);else Zv(a,r,e,b,!1)}function Vc(n,t){if(null!==t){const e=t.type;if(3&e)return Fa(t,n);if(4&e)return Bb(-1,n[t.index]);if(8&e){const i=t.child;if(null!==i)return Vc(n,i);{const r=n[t.index];return zs(r)?Bb(-1,r):Es(r)}}if(32&e)return jl(t,n)()||Es(n[t.index]);{const i=ca(n,t);return null!==i?Array.isArray(i)?i[0]:Vc(_d(n[16]),i):Vc(n,t.next)}}return null}function ca(n,t){return null!==t?n[16][6].projection[t.projection]:null}function Bb(n,t){const e=10+n+1;if(e<t.length){const i=t[e],r=i[1].firstChild;if(null!==r)return Vc(i,r)}return t[7]}function e0(n,t,e,i,r,a,d){for(;null!=e;){const b=i[e.index],x=e.type;if(d&&0===t&&(b&&vi(Es(b),i),e.flags|=4),64!=(64&e.flags))if(8&x)e0(n,t,e.child,i,r,a,!1),Sp(t,n,r,b,a);else if(32&x){const A=jl(e,i);let O;for(;O=A();)Sp(t,n,r,O,a);Sp(t,n,r,b,a)}else 16&x?t0(n,t,i,e,r,a):Sp(t,n,r,b,a);e=d?e.projectionNext:e.next}}function Fg(n,t,e,i,r,a){e0(e,i,n.firstChild,t,r,a,!1)}function t0(n,t,e,i,r,a){const d=e[16],x=d[6].projection[i.projection];if(Array.isArray(x))for(let A=0;A<x.length;A++)Sp(t,n,r,x[A],a);else e0(n,t,x,d[3],r,a,!0)}function aw(n,t,e){n.setAttribute(t,"style",e)}function n0(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function Dp(n){var t;return(null===(t=function r0(){if(void 0===zb&&(zb=null,vo.trustedTypes))try{zb=vo.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return zb}())||void 0===t?void 0:t.createHTML(n))||n}function zg(n){var t;return(null===(t=function Vb(){if(void 0===Ep&&(Ep=null,vo.trustedTypes))try{Ep=vo.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return Ep}())||void 0===t?void 0:t.createHTML(n))||n}class bh{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class cw extends bh{getTypeName(){return"HTML"}}class jg extends bh{getTypeName(){return"Style"}}class o0 extends bh{getTypeName(){return"Script"}}class jb extends bh{getTypeName(){return"URL"}}class ZD extends bh{getTypeName(){return"ResourceURL"}}function Qa(n){return n instanceof bh?n.changingThisBreaksApplicationSecurity:n}function mc(n,t){const e=function s0(n){return n instanceof bh&&n.getTypeName()||null}(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}class fw{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(Dp(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class YD{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const i=this.inertDocument.createElement("body");e.appendChild(i)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=Dp(t),e;const i=this.inertDocument.createElement("body");return i.innerHTML=Dp(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const d=e.item(r).name;("xmlns:ns1"===d||0===d.indexOf("ns1:"))&&t.removeAttribute(d)}let i=t.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const KD=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;function Ub(n){return(n=String(n)).match(KD)?n:"unsafe:"+n}function vd(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function Ug(...n){const t={};for(const e of n)for(const i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}const mw=vd("area,br,col,hr,img,wbr"),Hb=vd("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),l0=vd("rp,rt"),qb=Ug(mw,Ug(Hb,vd("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Ug(l0,vd("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Ug(l0,Hb)),Gb=vd("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),u0=Ug(Gb,vd("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),vd("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),bw=vd("script,style,template");class um{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,i=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!qb.hasOwnProperty(e))return this.sanitizedSomething=!0,!bw.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const i=t.attributes;for(let r=0;r<i.length;r++){const a=i.item(r),d=a.name,b=d.toLowerCase();if(!u0.hasOwnProperty(b)){this.sanitizedSomething=!0;continue}let x=a.value;Gb[b]&&(x=Ub(x)),this.buf.push(" ",d,'="',Hg(x),'"')}return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();qb.hasOwnProperty(e)&&!mw.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(Hg(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const Ip=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,yw=/([^\#-~ |!])/g;function Hg(n){return n.replace(/&/g,"&amp;").replace(Ip,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(yw,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let qg;function d0(n,t){let e=null;try{qg=qg||function jc(n){const t=new YD(n);return function JD(){try{return!!(new window.DOMParser).parseFromString(Dp(""),"text/html")}catch(n){return!1}}()?new fw(t):t}(n);let i=t?String(t):"";e=qg.getInertBodyElement(i);let r=5,a=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=a,a=e.innerHTML,e=qg.getInertBodyElement(i)}while(i!==a);return Dp((new um).sanitizeChildren(dm(e)||e))}finally{if(e){const i=dm(e)||e;for(;i.firstChild;)i.removeChild(i.firstChild)}}}function dm(n){return"content"in n&&function vw(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var fo=(()=>((fo=fo||{})[fo.NONE=0]="NONE",fo[fo.HTML=1]="HTML",fo[fo.STYLE=2]="STYLE",fo[fo.SCRIPT=3]="SCRIPT",fo[fo.URL=4]="URL",fo[fo.RESOURCE_URL=5]="RESOURCE_URL",fo))();function $b(n){const t=Mp();return t?zg(t.sanitize(fo.HTML,n)||""):mc(n,"HTML")?zg(Qa(n)):d0(function ps(){return void 0!==_h?_h:"undefined"!=typeof document?document:void 0}(),Gn(n))}function zo(n){const t=Mp();return t?t.sanitize(fo.URL,n)||"":mc(n,"URL")?Qa(n):Ub(Gn(n))}function Mp(){const n=_n();return n&&n[12]}const f0=new en("ENVIRONMENT_INITIALIZER"),Dw=new en("INJECTOR",-1),Ew=new en("INJECTOR_DEF_TYPES");class Iw{get(t,e=Du){if(e===Du){const i=new Error(`NullInjectorError: No provider for ${Cr(t)}!`);throw i.name="NullInjectorError",i}return e}}function Mw(...n){return{\u0275providers:xd(0,n)}}function xd(n,...t){const e=[],i=new Set;let r;return dc(t,a=>{const d=a;Ap(d,e,[],i)&&(r||(r=[]),r.push(d))}),void 0!==r&&hm(r,e),e}function hm(n,t){for(let e=0;e<n.length;e++){const{providers:r}=n[e];dc(r,a=>{t.push(a)})}}function Ap(n,t,e,i){if(!(n=$i(n)))return!1;let r=null,a=fl(n);const d=!a&&ir(n);if(a||d){if(d&&!d.standalone)return!1;r=n}else{const x=n.ngModule;if(a=fl(x),!a)return!1;r=x}const b=i.has(r);if(d){if(b)return!1;if(i.add(r),d.dependencies){const x="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const A of x)Ap(A,t,e,i)}}else{if(!a)return!1;{if(null!=a.imports&&!b){let A;i.add(r);try{dc(a.imports,O=>{Ap(O,t,e,i)&&(A||(A=[]),A.push(O))})}finally{}void 0!==A&&hm(A,t)}if(!b){const A=Qu(r)||(()=>new r);t.push({provide:r,useFactory:A,deps:xo},{provide:Ew,useValue:r,multi:!0},{provide:f0,useValue:()=>Tt(r),multi:!0})}const x=a.providers;null==x||b||dc(x,O=>{t.push(O)})}}return r!==n&&void 0!==n.providers}const Gg=Ro({provide:String,useValue:Ro});function Wb(n){return null!==n&&"object"==typeof n&&Gg in n}function yh(n){return"function"==typeof n}const b0=new en("Set Injector scope."),$g={},Xb={};let Zb;function Yb(){return void 0===Zb&&(Zb=new Iw),Zb}class wd{}class Jb extends wd{constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Qb(t,d=>this.processProvider(d)),this.records.set(Dw,Rp(void 0,this)),r.has("environment")&&this.records.set(wd,Rp(void 0,this));const a=this.records.get(b0);null!=a&&"string"==typeof a.value&&this.scopes.add(a.value),this.injectorDefTypes=new Set(this.get(Ew.multi,xo,Ei.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const e=Ca(this),i=Ts(void 0);try{return t()}finally{Ca(e),Ts(i)}}get(t,e=Du,i=Ei.Default){this.assertNotDestroyed();const r=Ca(this),a=Ts(void 0);try{if(!(i&Ei.SkipSelf)){let b=this.records.get(t);if(void 0===b){const x=function kw(n){return"function"==typeof n||"object"==typeof n&&n instanceof en}(t)&&Ns(t);b=x&&this.injectableDefInScope(x)?Rp(Kb(t),$g):null,this.records.set(t,b)}if(null!=b)return this.hydrate(t,b)}return(i&Ei.Self?Yb():this.parent).get(t,e=i&Ei.Optional&&e===Du?null:e)}catch(d){if("NullInjectorError"===d.name){if((d[Eu]=d[Eu]||[]).unshift(Cr(t)),r)throw d;return function m(n,t,e,i){const r=n[Eu];throw t[pc]&&r.unshift(t[pc]),n.message=function s(n,t,e,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=Cr(t);if(Array.isArray(t))r=t.map(Cr).join(" -> ");else if("object"==typeof t){let a=[];for(let d in t)if(t.hasOwnProperty(d)){let b=t[d];a.push(d+":"+("string"==typeof b?JSON.stringify(b):Cr(b)))}r=`{${a.join(", ")}}`}return`${e}${i?"("+i+")":""}[${r}]: ${n.replace(zc,"\n  ")}`}("\n"+n.message,r,e,i),n.ngTokenPath=r,n[Eu]=null,n}(d,t,"R3InjectorError",this.source)}throw d}finally{Ts(a),Ca(r)}}resolveInjectorInitializers(){const t=Ca(this),e=Ts(void 0);try{const i=this.get(f0.multi,xo,Ei.Self);for(const r of i)r()}finally{Ca(t),Ts(e)}}toString(){const t=[],e=this.records;for(const i of e.keys())t.push(Cr(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new qt(205,!1)}processProvider(t){let e=yh(t=$i(t))?t:$i(t&&t.provide);const i=function Rw(n){return Wb(n)?Rp(void 0,n.useValue):Rp(y0(n),$g)}(t);if(yh(t)||!0!==t.multi)this.records.get(e);else{let r=this.records.get(e);r||(r=Rp(void 0,$g,!0),r.factory=()=>om(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e){return e.value===$g&&(e.value=Xb,e.value=e.factory()),"object"==typeof e.value&&e.value&&function Pw(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=$i(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function Kb(n){const t=Ns(n),e=null!==t?t.factory:Qu(n);if(null!==e)return e;if(n instanceof en)throw new qt(204,!1);if(n instanceof Function)return function Aw(n){const t=n.length;if(t>0)throw xp(t,"?"),new qt(204,!1);const e=function ns(n){const t=n&&(n[is]||n[ml]);if(t){const e=function xa(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new qt(204,!1)}function y0(n,t,e){let i;if(yh(n)){const r=$i(n);return Qu(r)||Kb(r)}if(Wb(n))i=()=>$i(n.useValue);else if(function _0(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...om(n.deps||[]));else if(function g0(n){return!(!n||!n.useExisting)}(n))i=()=>Tt($i(n.useExisting));else{const r=$i(n&&(n.useClass||n.provide));if(!function rE(n){return!!n.deps}(n))return Qu(r)||Kb(r);i=()=>new r(...om(n.deps))}return i}function Rp(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function Wg(n){return!!n.\u0275providers}function Qb(n,t){for(const e of n)Array.isArray(e)?Qb(e,t):Wg(e)?Qb(e.\u0275providers,t):t(e)}class Ow{}class sE{resolveComponentFactory(t){throw function oE(n){const t=Error(`No component factory found for ${Cr(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let Pp=(()=>{class n{}return n.NULL=new sE,n})();function aE(){return kp(vs(),_n())}function kp(n,t){return new ci(Fa(n,t))}let ci=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=aE,n})();function lE(n){return n instanceof ci?n.nativeElement:n}class Lp{}let gc=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function Nw(){const n=_n(),e=aa(vs().index,n);return(Ys(e)?e:n)[11]}(),n})(),Bw=(()=>{class n{}return n.\u0275prov=wn({token:n,providedIn:"root",factory:()=>null}),n})();class vh{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const zw=new vh("14.3.0"),ey={};function ny(n){return n.ngOriginalError}class Mu{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&ny(t);for(;e&&ny(e);)e=ny(e);return e||null}}function Sd(n){return n instanceof Function?n():n}function iy(n,t,e){let i=n.length;for(;;){const r=n.indexOf(t,e);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const a=t.length;if(r+a===i||n.charCodeAt(r+a)<=32)return r}e=r+1}}const Op="ng-template";function gE(n,t,e){let i=0;for(;i<n.length;){let r=n[i++];if(e&&"class"===r){if(r=n[i],-1!==iy(r.toLowerCase(),t,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===t)return!0;return!1}}return!1}function Hw(n){return 4===n.type&&n.value!==Op}function Zg(n,t,e){return t===(4!==n.type||e?n.value:Op)}function _E(n,t,e){let i=4;const r=n.attrs||[],a=function x0(n){for(let t=0;t<n.length;t++)if(uc(n[t]))return t;return n.length}(r);let d=!1;for(let b=0;b<t.length;b++){const x=t[b];if("number"!=typeof x){if(!d)if(4&i){if(i=2|1&i,""!==x&&!Zg(n,x,e)||""===x&&1===t.length){if(Uc(i))return!1;d=!0}}else{const A=8&i?x:t[++b];if(8&i&&null!==n.attrs){if(!gE(n.attrs,A,e)){if(Uc(i))return!1;d=!0}continue}const B=qw(8&i?"class":x,r,Hw(n),e);if(-1===B){if(Uc(i))return!1;d=!0;continue}if(""!==A){let X;X=B>a?"":r[B+1].toLowerCase();const te=8&i?X:null;if(te&&-1!==iy(te,A,0)||2&i&&A!==X){if(Uc(i))return!1;d=!0}}}}else{if(!d&&!Uc(i)&&!Uc(x))return!1;if(d&&Uc(x))continue;d=!1,i=x|1&i}}return Uc(i)||d}function Uc(n){return 0==(1&n)}function qw(n,t,e,i){if(null===t)return-1;let r=0;if(i||!e){let a=!1;for(;r<t.length;){const d=t[r];if(d===n)return r;if(3===d||6===d)a=!0;else{if(1===d||2===d){let b=t[++r];for(;"string"==typeof b;)b=t[++r];continue}if(4===d)break;if(0===d){r+=4;continue}}r+=a?1:2}return-1}return function bE(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const i=n[e];if("number"==typeof i)return-1;if(i===t)return e;e++}return-1}(t,n)}function ry(n,t,e=!1){for(let i=0;i<t.length;i++)if(_E(n,t[i],e))return!0;return!1}function $w(n,t){e:for(let e=0;e<t.length;e++){const i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function Yg(n,t){return n?":not("+t.trim()+")":t}function w0(n){let t=n[0],e=1,i=2,r="",a=!1;for(;e<n.length;){let d=n[e];if("string"==typeof d)if(2&i){const b=n[++e];r+="["+d+(b.length>0?'="'+b+'"':"")+"]"}else 8&i?r+="."+d:4&i&&(r+=" "+d);else""!==r&&!Uc(d)&&(t+=Yg(a,r),r=""),i=d,a=a||!Uc(i);e++}return""!==r&&(t+=Yg(a,r)),t}const _r={};function pe(n){wl(Rr(),_n(),wo()+n,!1)}function wl(n,t,e,i){if(!i)if(3==(3&t[2])){const a=n.preOrderCheckHooks;null!==a&&ih(t,a,e)}else{const a=n.preOrderHooks;null!==a&&fp(t,a,0,e)}Is(e)}function C0(n,t=null,e=null,i){const r=oy(n,t,e,i);return r.resolveInjectorInitializers(),r}function oy(n,t=null,e=null,i,r=new Set){const a=[e||xo,Mw(n)];return i=i||("object"==typeof n?void 0:Cr(n)),new Jb(a,t||Yb(),i||null,r)}let Jo=(()=>{class n{static create(e,i){var r;if(Array.isArray(e))return C0({name:""},i,e,"");{const a=null!==(r=e.name)&&void 0!==r?r:"";return C0({name:a},e.parent,e.providers,a)}}}return n.THROW_IF_NOT_FOUND=Du,n.NULL=new Iw,n.\u0275prov=wn({token:n,providedIn:"any",factory:()=>Tt(Dw)}),n.__NG_ELEMENT_ID__=-1,n})();function ue(n,t=Ei.Default){const e=_n();return null===e?Tt(n,t):Jf(vs(),e,$i(n),t)}function bm(){throw new Error("invalid")}function ym(n,t){return n<<17|t<<2}function Gc(n){return n>>17&32767}function cy(n){return 2|n}function Ru(n){return(131068&n)>>2}function xm(n,t){return-131069&n|t<<2}function P0(n){return 1|n}function q0(n,t){const e=n.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const r=e[i],a=e[i+1];if(-1!==a){const d=n.data[a];Gf(r),d.contentQueries(2,t[a],a)}}}function Sm(n,t,e,i,r,a,d,b,x,A,O){const B=t.blueprint.slice();return B[0]=r,B[2]=76|i,(null!==O||n&&1024&n[2])&&(B[2]|=1024),jf(B),B[3]=B[15]=n,B[8]=e,B[10]=d||n&&n[10],B[11]=b||n&&n[11],B[12]=x||n&&n[12]||null,B[9]=A||n&&n[9]||null,B[6]=a,B[20]=function Bi(){return zr++}(),B[21]=O,B[16]=2==t.type?n[16]:B,B}function Sh(n,t,e,i,r){let a=n.data[t];if(null===a)a=function Tm(n,t,e,i,r){const a=gb(),d=mu(),x=n.data[t]=function Z0(n,t,e,i,r,a){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:a,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?a:a&&a.parent,e,t,i,r);return null===n.firstChild&&(n.firstChild=x),null!==a&&(d?null==a.child&&null!==x.parent&&(a.child=x):null===a.next&&(a.next=x)),x}(n,t,e,i,r),function Tn(){return Qi.lFrame.inI18n}()&&(a.flags|=64);else if(64&a.type){a.type=e,a.value=i,a.attrs=r;const d=function nd(){const n=Qi.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();a.injectorIndex=null===d?-1:d.injectorIndex}return $a(a,!0),a}function Td(n,t,e,i){if(0===e)return-1;const r=t.length;for(let a=0;a<e;a++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function by(n,t,e){hp(t);try{const i=n.viewQuery;null!==i&&Dy(1,i,e);const r=n.template;null!==r&&W0(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&q0(n,t),n.staticViewQueries&&Dy(2,n.viewQuery,e);const a=n.components;null!==a&&function $0(n,t){for(let e=0;e<t.length;e++)Cy(n,t[e])}(t,a)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[2]&=-5,sd()}}function Vp(n,t,e,i){const r=t[2];if(128!=(128&r)){hp(t);try{jf(t),function bg(n){return Qi.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&W0(n,t,e,2,i);const d=3==(3&r);if(d){const A=n.preOrderCheckHooks;null!==A&&ih(t,A,null)}else{const A=n.preOrderHooks;null!==A&&fp(t,A,0,null),Xf(t,0)}if(function l_(n){for(let t=bd(n);null!==t;t=fc(t)){if(!t[2])continue;const e=t[9];for(let i=0;i<e.length;i++){const r=e[i],a=r[3];0==(512&r[2])&&Oc(a,1),r[2]|=512}}}(t),function pS(n){for(let t=bd(n);null!==t;t=fc(t))for(let e=10;e<t.length;e++){const i=t[e],r=i[1];cp(i)&&Vp(r,i,r.template,i[8])}}(t),null!==n.contentQueries&&q0(n,t),d){const A=n.contentCheckHooks;null!==A&&ih(t,A)}else{const A=n.contentHooks;null!==A&&fp(t,A,1),Xf(t,1)}!function tS(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const r=e[i];if(r<0)Is(~r);else{const a=r,d=e[++i],b=e[++i];yg(d,a),b(2,t[a])}}}finally{Is(-1)}}(n,t);const b=n.components;null!==b&&function G0(n,t){for(let e=0;e<t.length;e++)$E(n,t[e])}(t,b);const x=n.viewQuery;if(null!==x&&Dy(2,x,i),d){const A=n.viewCheckHooks;null!==A&&ih(t,A)}else{const A=n.viewHooks;null!==A&&fp(t,A,2),Xf(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,Oc(t[3],-1))}finally{sd()}}}function W0(n,t,e,i,r){const a=wo(),d=2&i;try{Is(-1),d&&t.length>22&&wl(n,t,22,!1),e(i,r)}finally{Is(a)}}function nS(n,t,e){if(ic(t)){const r=t.directiveEnd;for(let a=t.directiveStart;a<r;a++){const d=n.data[a];d.contentQueries&&d.contentQueries(1,e[a],a)}}}function yy(n,t,e){!Uf()||(function UE(n,t,e,i){const r=e.directiveStart,a=e.directiveEnd;n.firstCreatePass||ah(e,t),vi(i,t);const d=e.initialInputs;for(let b=r;b<a;b++){const x=n.data[b],A=Sa(x);A&&uS(t,e,x);const O=Ya(t,n,b,e);vi(O,t),null!==d&&dS(0,b-r,O,x,0,d),A&&(aa(e.index,t)[8]=O)}}(n,t,e,Fa(e,t)),128==(128&e.flags)&&function HE(n,t,e){const i=e.directiveStart,r=e.directiveEnd,a=e.index,d=function rd(){return Qi.lFrame.currentDirectiveIndex}();try{Is(a);for(let b=i;b<r;b++){const x=n.data[b],A=t[b];ac(b),(null!==x.hostBindings||0!==x.hostVars||null!==x.hostAttrs)&&aS(x,A)}}finally{Is(-1),ac(d)}}(n,t,e))}function vy(n,t,e=Fa){const i=t.localNames;if(null!==i){let r=t.index+1;for(let a=0;a<i.length;a+=2){const d=i[a+1],b=-1===d?e(t,n):n[d];n[r++]=b}}}function X0(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=xy(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function xy(n,t,e,i,r,a,d,b,x,A){const O=22+i,B=O+r,X=function iS(n,t){const e=[];for(let i=0;i<t;i++)e.push(i<n?null:_r);return e}(O,B),te="function"==typeof A?A():A;return X[1]={type:n,blueprint:X,template:e,queries:null,viewQuery:b,declTNode:t,data:X.slice().fill(null,O),bindingStartIndex:O,expandoStartIndex:B,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof a?a():a,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:x,consts:te,incompleteFirstPass:!1}}function oS(n,t,e,i){const r=tx(t);null===e?r.push(i):(r.push(e),n.firstCreatePass&&d_(n).push(i,r.length-1))}function Y0(n,t,e){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(t,r):e[i]=[t,r]}return e}function J0(n,t){const i=t.directiveEnd,r=n.data,a=t.attrs,d=[];let b=null,x=null;for(let A=t.directiveStart;A<i;A++){const O=r[A],B=O.inputs,X=null===a||Hw(t)?null:hS(B,a);d.push(X),b=Y0(B,A,b),x=Y0(O.outputs,A,x)}null!==b&&(b.hasOwnProperty("class")&&(t.flags|=16),b.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=d,t.inputs=b,t.outputs=x}function js(n,t,e,i,r,a,d,b){const x=Fa(t,e);let O,A=t.inputs;!b&&null!=A&&(O=A[i])?(nx(n,e,O,i,r),qi(t)&&Sy(e,t.index)):3&t.type&&(i=function wy(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=d?d(r,t.value||"",i):r,a.setProperty(x,i,r))}function Sy(n,t){const e=aa(t,n);16&e[2]||(e[2]|=32)}function o_(n,t,e,i){let r=!1;if(Uf()){const a=function qE(n,t,e){const i=n.directiveRegistry;let r=null;if(i)for(let a=0;a<i.length;a++){const d=i[a];ry(e,d.selectors,!1)&&(r||(r=[]),_p(ah(e,t),n,d.type),Sa(d)?(lS(n,e),r.unshift(d)):r.push(d))}return r}(n,t,e),d=null===i?null:{"":-1};if(null!==a){r=!0,s_(e,n.data.length,a.length);for(let O=0;O<a.length;O++){const B=a[O];B.providersResolver&&B.providersResolver(B)}let b=!1,x=!1,A=Td(n,t,a.length,null);for(let O=0;O<a.length;O++){const B=a[O];e.mergedAttrs=Na(e.mergedAttrs,B.hostAttrs),Q0(n,e,t,A,B),cS(A,B,d),null!==B.contentQueries&&(e.flags|=8),(null!==B.hostBindings||null!==B.hostAttrs||0!==B.hostVars)&&(e.flags|=128);const X=B.type.prototype;!b&&(X.ngOnChanges||X.ngOnInit||X.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),b=!0),!x&&(X.ngOnChanges||X.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),x=!0),A++}J0(n,e)}d&&function GE(n,t,e){if(t){const i=n.localNames=[];for(let r=0;r<t.length;r+=2){const a=e[t[r+1]];if(null==a)throw new qt(-301,!1);i.push(t[r],a)}}}(e,i,d)}return e.mergedAttrs=Na(e.mergedAttrs,e.attrs),r}function K0(n,t,e,i,r,a){const d=a.hostBindings;if(d){let b=n.hostBindingOpCodes;null===b&&(b=n.hostBindingOpCodes=[]);const x=~t.index;(function jE(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(b)!=x&&b.push(x),b.push(i,r,d)}}function aS(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function lS(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function cS(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;Sa(t)&&(e[""]=n)}}function s_(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function Q0(n,t,e,i,r){n.data[i]=r;const a=r.factory||(r.factory=Qu(r.type)),d=new lc(a,Sa(r),ue);n.blueprint[i]=d,e[i]=d,K0(n,t,0,i,Td(n,e,r.hostVars,_r),r)}function uS(n,t,e){const i=Fa(t,n),r=X0(e),a=n[10],d=Cd(n,Sm(n,r,null,e.onPush?32:16,i,t,a,a.createRenderer(i,e),null,null,null));n[t.index]=d}function Xc(n,t,e,i,r,a){const d=Fa(n,t);!function a_(n,t,e,i,r,a,d){if(null==a)n.removeAttribute(t,r,e);else{const b=null==d?Gn(a):d(a,i||"",r);n.setAttribute(t,r,b,e)}}(t[11],d,a,n.value,e,i,r)}function dS(n,t,e,i,r,a){const d=a[t];if(null!==d){const b=i.setInput;for(let x=0;x<d.length;){const A=d[x++],O=d[x++],B=d[x++];null!==b?i.setInput(e,B,A,O):e[O]=B}}}function hS(n,t){let e=null,i=0;for(;i<t.length;){const r=t[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===e&&(e=[]),e.push(r,n[r],t[i+1])),i+=2}else i+=2;else i+=4}return e}function jp(n,t,e,i){return new Array(n,!0,!1,t,null,0,i,e,null,null)}function $E(n,t){const e=aa(t,n);if(cp(e)){const i=e[1];48&e[2]?Vp(i,e,i.template,e[8]):e[5]>0&&c_(e)}}function c_(n){for(let i=bd(n);null!==i;i=fc(i))for(let r=10;r<i.length;r++){const a=i[r];if(cp(a))if(512&a[2]){const d=a[1];Vp(d,a,d.template,a[8])}else a[5]>0&&c_(a)}const e=n[1].components;if(null!==e)for(let i=0;i<e.length;i++){const r=aa(e[i],n);cp(r)&&r[5]>0&&c_(r)}}function Cy(n,t){const e=aa(t,n),i=e[1];(function ex(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(i,e),by(i,e,e[8])}function Cd(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function u_(n){for(;n;){n[2]|=32;const t=_d(n);if(Of(n)&&!t)return n;n=t}return null}function ku(n,t,e,i=!0){const r=t[10];r.begin&&r.begin();try{Vp(n,t,n.template,e)}catch(d){throw i&&fS(t,d),d}finally{r.end&&r.end()}}function Dy(n,t,e){Gf(0),t(n,e)}function tx(n){return n[7]||(n[7]=[])}function d_(n){return n.cleanup||(n.cleanup=[])}function Dm(n,t,e){return(null===n||Sa(n))&&(e=function hb(n){for(;Array.isArray(n);){if("object"==typeof n[1])return n;n=n[0]}return null}(e[t.index])),e[11]}function fS(n,t){const e=n[9],i=e?e.get(Mu,null):null;i&&i.handleError(t)}function nx(n,t,e,i,r){for(let a=0;a<e.length;){const d=e[a++],b=e[a++],x=t[d],A=n.data[d];null!==A.setInput?A.setInput(x,r,i,b):x[b]=r}}function Dd(n,t,e){const i=Lc(t,n);!function Pb(n,t,e){n.setValue(t,e)}(n[11],i,e)}function Th(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,a=0;if(null!==t)for(let d=0;d<t.length;d++){const b=t[d];"number"==typeof b?a=b:1==a?r=ec(r,b):2==a&&(i=ec(i,b+": "+t[++d]+";"))}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function h_(n,t,e,i,r=!1){for(;null!==e;){const a=t[e.index];if(null!==a&&i.push(Es(a)),zs(a))for(let b=10;b<a.length;b++){const x=a[b],A=x[1].firstChild;null!==A&&h_(x[1],x,A,i)}const d=e.type;if(8&d)h_(n,t,e.child,i);else if(32&d){const b=jl(e,t);let x;for(;x=b();)i.push(x)}else if(16&d){const b=ca(t,e);if(Array.isArray(b))i.push(...b);else{const x=_d(t[16]);h_(x[1],x,b,i,!0)}}e=r?e.projectionNext:e.next}return i}class p_{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return h_(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(zs(t)){const e=t[8],i=e?e.indexOf(this):-1;i>-1&&(Lb(t,i),dh(e,i))}this._attachedToViewContainer=!1}Ob(this._lView[1],this._lView)}onDestroy(t){oS(this._lView[1],this._lView,null,t)}markForCheck(){u_(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){ku(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new qt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function $v(n,t){Fg(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new qt(902,!1);this._appRef=t}}class ZE extends p_{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;ku(t[1],t,t[8],!1)}checkNoChanges(){}get context(){return null}}class ix extends Pp{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=ir(t);return new Em(e,this.ngModule)}}function rx(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}class mS{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){const r=this.injector.get(t,ey,i);return r!==ey||e===ey?r:this.parentInjector.get(t,e,i)}}class Em extends Ow{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function yE(n){return n.map(w0).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return rx(this.componentDef.inputs)}get outputs(){return rx(this.componentDef.outputs)}create(t,e,i,r){let a=(r=r||this.ngModule)instanceof wd?r:null==r?void 0:r.injector;a&&null!==this.componentDef.getStandaloneInjector&&(a=this.componentDef.getStandaloneInjector(a)||a);const d=a?new mS(t,a):t,b=d.get(Lp,null);if(null===b)throw new qt(407,!1);const x=d.get(Bw,null),A=b.createRenderer(null,this.componentDef),O=this.componentDef.selectors[0][0]||"div",B=i?function rS(n,t,e){return n.selectRootElement(t,e===oa.ShadowDom)}(A,i,this.componentDef.encapsulation):am(A,O,function ox(n){const t=n.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(O)),X=this.componentDef.onPush?288:272,te=xy(0,null,null,1,0,null,null,null,null,null),se=Sm(null,te,null,X,null,null,b,A,x,d,null);let me,ye;hp(se);try{const $e=function bS(n,t,e,i,r,a){const d=e[1];e[22]=n;const x=Sh(d,22,2,"#host",null),A=x.mergedAttrs=t.hostAttrs;null!==A&&(Th(x,A,!0),null!==n&&(ld(r,n,A),null!==x.classes&&n0(r,n,x.classes),null!==x.styles&&aw(r,n,x.styles)));const O=i.createRenderer(n,t),B=Sm(e,X0(t),null,t.onPush?32:16,e[22],x,i,O,a||null,null,null);return d.firstCreatePass&&(_p(ah(x,e),d,t.type),lS(d,x),s_(x,e.length,1)),Cd(e,B),e[22]=B}(B,this.componentDef,se,b,A);if(B)if(i)ld(A,B,["ng-version",zw.full]);else{const{attrs:ht,classes:Qe}=function vE(n){const t=[],e=[];let i=1,r=2;for(;i<n.length;){let a=n[i];if("string"==typeof a)2===r?""!==a&&t.push(a,n[++i]):8===r&&e.push(a);else{if(!Uc(r))break;r=a}i++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);ht&&ld(A,B,ht),Qe&&Qe.length>0&&n0(A,B,Qe.join(" "))}if(ye=lp(te,22),void 0!==e){const ht=ye.projection=[];for(let Qe=0;Qe<this.ngContentSelectors.length;Qe++){const At=e[Qe];ht.push(null!=At?Array.from(At):null)}}me=function Ch(n,t,e,i){const r=e[1],a=function Ty(n,t,e){const i=vs();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),Q0(n,i,t,Td(n,t,1,null),e),J0(n,i));const r=Ya(t,n,i.directiveStart,i);vi(r,t);const a=Fa(i,t);return a&&vi(a,t),r}(r,e,t);if(n[8]=e[8]=a,null!==i)for(const b of i)b(a,t);if(t.contentQueries){const b=vs();t.contentQueries(1,a,b.directiveStart)}const d=vs();return!r.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(Is(d.index),K0(e[1],d,0,d.directiveStart,d.directiveEnd,t),aS(t,a)),a}($e,this.componentDef,se,[KE]),by(te,se,null)}finally{sd()}return new _S(this.componentType,me,kp(ye,se),se,ye)}}class _S extends class Lw{}{constructor(t,e,i,r,a){super(),this.location=i,this._rootLView=r,this._tNode=a,this.instance=e,this.hostView=this.changeDetectorRef=new ZE(r),this.componentType=t}setInput(t,e){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[t])){const a=this._rootLView;nx(a[1],a,r,t,e),Sy(a,this._tNode.index)}}get injector(){return new yu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function KE(){const n=vs();ad(_n()[1],n)}function Un(n){let t=function yS(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const i=[n];for(;t;){let r;if(Sa(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new qt(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);const d=n;d.inputs=sx(n.inputs),d.declaredInputs=sx(n.declaredInputs),d.outputs=sx(n.outputs);const b=r.hostBindings;b&&tI(n,b);const x=r.viewQuery,A=r.contentQueries;if(x&&QE(n,x),A&&eI(n,A),rg(n.inputs,r.inputs),rg(n.declaredInputs,r.declaredInputs),rg(n.outputs,r.outputs),Sa(r)&&r.data.animation){const O=n.data;O.animation=(O.animation||[]).concat(r.data.animation)}}const a=r.features;if(a)for(let d=0;d<a.length;d++){const b=a[d];b&&b.ngInherit&&b(n),b===Un&&(e=!1)}}t=Object.getPrototypeOf(t)}!function Ey(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=Na(r.hostAttrs,e=Na(e,r.hostAttrs))}}(i)}function sx(n){return n===gl?{}:n===xo?[]:n}function QE(n,t){const e=n.viewQuery;n.viewQuery=e?(i,r)=>{t(i,r),e(i,r)}:t}function eI(n,t){const e=n.contentQueries;n.contentQueries=e?(i,r,a)=>{t(i,r,a),e(i,r,a)}:t}function tI(n,t){const e=n.hostBindings;n.hostBindings=e?(i,r)=>{t(i,r),e(i,r)}:t}let Iy=null;function Up(){if(!Iy){const n=vo.Symbol;if(n&&n.iterator)Iy=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const i=t[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Iy=i)}}}return Iy}function f_(n){return!!Hp(n)&&(Array.isArray(n)||!(n instanceof Map)&&Up()in n)}function Hp(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Zc(n,t,e){return n[t]=e}function ja(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function Dh(n,t,e,i){const r=ja(n,t,e);return ja(n,t+1,i)||r}function si(n,t,e,i){const r=_n();return ja(r,yl(),t)&&(Rr(),Xc(Yo(),r,n,t,e,i)),si}function qp(n,t,e,i){return ja(n,yl(),e)?t+Gn(e)+i:_r}function Ou(n,t,e,i,r,a,d,b,x,A,O,B){const X=Ol();let te=function Hl(n,t,e,i,r,a){const d=Dh(n,t,e,i);return Dh(n,t+2,r,a)||d}(n,X,e,r,d,x);return te=ja(n,X+4,O)||te,Wa(5),te?t+Gn(e)+i+Gn(r)+a+Gn(d)+b+Gn(x)+A+Gn(O)+B:_r}function yt(n,t,e,i,r,a,d,b){const x=_n(),A=Rr(),O=n+22,B=A.firstCreatePass?function TS(n,t,e,i,r,a,d,b,x){const A=t.consts,O=Sh(t,n,4,d||null,oc(A,b));o_(t,e,O,oc(A,x)),ad(t,O);const B=O.tViews=xy(2,O,i,r,a,t.directiveRegistry,t.pipeRegistry,null,t.schemas,A);return null!==t.queries&&(t.queries.template(t,O),B.queries=t.queries.embeddedTView(O)),O}(O,A,x,t,e,i,r,a,d):A.data[O];$a(B,!1);const X=x[11].createComment("");lm(A,x,X,B),vi(X,x),Cd(x,x[O]=jp(X,x,X,B)),kc(B)&&yy(A,x,B),null!=d&&vy(x,B,b)}function el(n){return rc(function id(){return Qi.lFrame.contextLView}(),22+n)}function Pe(n,t,e){const i=_n();return ja(i,yl(),t)&&js(Rr(),Yo(),i,n,t,i[11],e,!1),Pe}function Ry(n,t,e,i,r){const d=r?"class":"style";nx(n,e,t.inputs[d],d,i)}function ne(n,t,e,i){const r=_n(),a=Rr(),d=22+n,b=r[11],x=r[d]=am(b,t,function Xa(){return Qi.lFrame.currentNamespace}()),A=a.firstCreatePass?function g_(n,t,e,i,r,a,d){const b=t.consts,A=Sh(t,n,2,r,oc(b,a));return o_(t,e,A,oc(b,d)),null!==A.attrs&&Th(A,A.attrs,!1),null!==A.mergedAttrs&&Th(A,A.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,A),A}(d,a,r,0,t,e,i):a.data[d];$a(A,!0);const O=A.mergedAttrs;null!==O&&ld(b,x,O);const B=A.classes;null!==B&&n0(b,x,B);const X=A.styles;return null!==X&&aw(b,x,X),64!=(64&A.flags)&&lm(a,r,x,A),0===function td(){return Qi.lFrame.elementDepthCount}()&&vi(x,r),function fb(){Qi.lFrame.elementDepthCount++}(),kc(A)&&(yy(a,r,A),nS(a,A,r)),null!==i&&vy(r,A),ne}function oe(){let n=vs();mu()?eh():(n=n.parent,$a(n,!1));const t=n;!function mg(){Qi.lFrame.elementDepthCount--}();const e=Rr();return e.firstCreatePass&&(ad(e,n),ic(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function ot(n){return 0!=(16&n.flags)}(t)&&Ry(e,t,_n(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Sg(n){return 0!=(32&n.flags)}(t)&&Ry(e,t,_n(),t.stylesWithoutHost,!1),oe}function rn(n,t,e,i){return ne(n,t,e,i),oe(),rn}function ji(n,t,e){const i=_n(),r=Rr(),a=n+22,d=r.firstCreatePass?function Py(n,t,e,i,r){const a=t.consts,d=oc(a,i),b=Sh(t,n,8,"ng-container",d);return null!==d&&Th(b,d,!0),o_(t,e,b,oc(a,r)),null!==t.queries&&t.queries.elementStart(t,b),b}(a,r,i,t,e):r.data[a];$a(d,!0);const b=i[a]=i[11].createComment("");return lm(r,i,b,d),vi(b,i),kc(d)&&(yy(r,i,d),nS(r,d,i)),null!=e&&vy(i,d),ji}function Zi(){let n=vs();const t=Rr();return mu()?eh():(n=n.parent,$a(n,!1)),t.firstCreatePass&&(ad(t,n),ic(n)&&t.queries.elementEnd(n)),Zi}function Wo(n,t,e){return ji(n,t,e),Zi(),Wo}function or(){return _n()}function $p(n){return!!n&&"function"==typeof n.then}function Wp(n){return!!n&&"function"==typeof n.subscribe}const ky=Wp;function Wt(n,t,e,i){const r=_n(),a=Rr(),d=vs();return Pm(a,r,r[11],d,n,t,0,i),Wt}function Eh(n,t){const e=vs(),i=_n(),r=Rr();return Pm(r,i,Dm(Fn(r.data),e,i),e,n,t),Eh}function Pm(n,t,e,i,r,a,d,b){const x=kc(i),O=n.firstCreatePass&&d_(n),B=t[8],X=tx(t);let te=!0;if(3&i.type||b){const ye=Fa(i,t),$e=b?b(ye):ye,ht=X.length,Qe=b?fn=>b(Es(fn[i.index])):i.index;let At=null;if(!b&&x&&(At=function lI(n,t,e,i){const r=n.cleanup;if(null!=r)for(let a=0;a<r.length-1;a+=2){const d=r[a];if(d===e&&r[a+1]===i){const b=t[7],x=r[a+2];return b.length>x?b[x]:null}"string"==typeof d&&(a+=2)}return null}(n,t,r,i.index)),null!==At)(At.__ngLastListenerFn__||At).__ngNextListenerFn__=a,At.__ngLastListenerFn__=a,te=!1;else{a=Ly(i,t,B,a,!1);const fn=e.listen($e,r,a);X.push(a,fn),O&&O.push(r,Qe,ht,ht+1)}}else a=Ly(i,t,B,a,!1);const se=i.outputs;let me;if(te&&null!==se&&(me=se[r])){const ye=me.length;if(ye)for(let $e=0;$e<ye;$e+=2){const qn=t[me[$e]][me[$e+1]].subscribe(a),Xn=X.length;X.push(a,qn),O&&O.push(r,i.index,Xn,-(Xn+1))}}}function lx(n,t,e,i){try{return!1!==e(i)}catch(r){return fS(n,r),!1}}function Ly(n,t,e,i,r){return function a(d){if(d===Function)return i;u_(2&n.flags?aa(n.index,t):t);let x=lx(t,0,i,d),A=a.__ngNextListenerFn__;for(;A;)x=lx(t,0,A,d)&&x,A=A.__ngNextListenerFn__;return r&&!1===x&&(d.preventDefault(),d.returnValue=!1),x}}function St(n=1){return function pp(n){return(Qi.lFrame.contextLView=function Wf(n,t){for(;n>0;)t=t[15],n--;return t}(n,Qi.lFrame.contextLView))[8]}(n)}function Oy(n,t){let e=null;const i=function Gw(n){const t=n.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(n);for(let r=0;r<t.length;r++){const a=t[r];if("*"!==a){if(null===i?ry(n,a,!0):$w(i,a))return r}else e=r}return e}function Rs(n){const t=_n()[16][6];if(!t.projection){const i=t.projection=xp(n?n.length:1,null),r=i.slice();let a=t.child;for(;null!==a;){const d=n?Oy(a,n):0;null!==d&&(r[d]?r[d].projectionNext=a:i[d]=a,r[d]=a),a=a.next}}}function Co(n,t=0,e){const i=_n(),r=Rr(),a=Sh(r,22+n,16,null,e||null);null===a.projection&&(a.projection=t),eh(),64!=(64&a.flags)&&function Ng(n,t,e){t0(t[11],0,t,e,rw(n,e,t),Yv(e.parent||t[6],e,t))}(r,i,a)}function Ir(n,t,e){return Fy(n,"",t,"",e),Ir}function Fy(n,t,e,i,r){const a=_n(),d=qp(a,t,e,i);return d!==_r&&js(Rr(),Yo(),a,n,d,a[11],r,!1),Fy}function hx(n,t,e,i,r){const a=n[e+1],d=null===t;let b=i?Gc(a):Ru(a),x=!1;for(;0!==b&&(!1===x||d);){const O=n[b+1];dI(n[b],t)&&(x=!0,n[b+1]=i?P0(O):cy(O)),b=i?Gc(O):Ru(O)}x&&(n[e+1]=i?cy(a):P0(a))}function dI(n,t){return null===n||null==t||(Array.isArray(n)?n[1]:n)===t||!(!Array.isArray(n)||"string"!=typeof t)&&Bc(n,t)>=0}function p(n,t,e){return P(n,t,e,!1),p}function _(n,t){return P(n,t,null,!0),_}function P(n,t,e,i){const r=_n(),a=Rr(),d=Wa(2);a.firstUpdatePass&&function R(n,t,e,i){const r=n.data;if(null===r[e+1]){const a=r[wo()],d=function I(n,t){return t>=n.expandoStartIndex}(n,e);(function be(n,t){return 0!=(n.flags&(t?16:32))})(a,i)&&null===t&&!d&&(t=!1),t=function D(n,t,e,i){const r=Fn(n);let a=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(e=G(e=j(null,n,t,e,i),t.attrs,i),a=null);else{const d=t.directiveStylingLast;if(-1===d||n[d]!==r)if(e=j(r,n,t,e,i),null===a){let x=function M(n,t,e){const i=e?t.classBindings:t.styleBindings;if(0!==Ru(i))return n[Gc(i)]}(n,t,i);void 0!==x&&Array.isArray(x)&&(x=j(null,n,t,x[1],i),x=G(x,t.attrs,i),function L(n,t,e,i){n[Gc(e?t.classBindings:t.styleBindings)]=i}(n,t,i,x))}else a=function V(n,t,e){let i;const r=t.directiveEnd;for(let a=1+t.directiveStylingLast;a<r;a++)i=G(i,n[a].hostAttrs,e);return G(i,t.attrs,e)}(n,t,i)}return void 0!==a&&(i?t.residualClasses=a:t.residualStyles=a),e}(r,a,t,i),function cI(n,t,e,i,r,a){let d=a?t.classBindings:t.styleBindings,b=Gc(d),x=Ru(d);n[i]=e;let O,A=!1;if(Array.isArray(e)){const B=e;O=B[1],(null===O||Bc(B,O)>0)&&(A=!0)}else O=e;if(r)if(0!==x){const X=Gc(n[b+1]);n[i+1]=ym(X,b),0!==X&&(n[X+1]=xm(n[X+1],i)),n[b+1]=function wh(n,t){return 131071&n|t<<17}(n[b+1],i)}else n[i+1]=ym(b,0),0!==b&&(n[b+1]=xm(n[b+1],i)),b=i;else n[i+1]=ym(x,0),0===b?b=i:n[x+1]=xm(n[x+1],i),x=i;A&&(n[i+1]=cy(n[i+1])),hx(n,O,i,!0),hx(n,O,i,!1),function uI(n,t,e,i,r){const a=r?n.residualClasses:n.residualStyles;null!=a&&"string"==typeof t&&Bc(a,t)>=0&&(e[i+1]=P0(e[i+1]))}(t,O,n,i,a),d=ym(b,x),a?t.classBindings=d:t.styleBindings=d}(r,a,t,e,d,i)}}(a,n,d,i),t!==_r&&ja(r,d,t)&&function J(n,t,e,i,r,a,d,b){if(!(3&t.type))return;const x=n.data,A=x[b+1];we(function uy(n){return 1==(1&n)}(A)?ce(x,t,e,r,Ru(A),d):void 0)||(we(a)||function vm(n){return 2==(2&n)}(A)&&(a=ce(x,null,e,r,b,d)),function Bg(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let a=-1===i.indexOf("-")?void 0:Jn.DashCase;null==r?n.removeStyle(e,i,a):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),a|=Jn.Important),n.setStyle(e,i,r,a))}}(i,d,Lc(wo(),e),r,a))}(a,a.data[wo()],r,r[11],n,r[d+1]=function _e(n,t){return null==n||("string"==typeof t?n+=t:"object"==typeof n&&(n=Cr(Qa(n)))),n}(t,e),i,d)}function j(n,t,e,i,r){let a=null;const d=e.directiveEnd;let b=e.directiveStylingLast;for(-1===b?b=e.directiveStart:b++;b<d&&(a=t[b],i=G(i,a.hostAttrs,r),a!==n);)b++;return null!==n&&(e.directiveStylingLast=b),i}function G(n,t,e){const i=e?1:2;let r=-1;if(null!==t)for(let a=0;a<t.length;a++){const d=t[a];"number"==typeof d?r=d:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),za(n,d,!!e||t[++a]))}return void 0===n?null:n}function ce(n,t,e,i,r,a){const d=null===t;let b;for(;r>0;){const x=n[r],A=Array.isArray(x),O=A?x[1]:x,B=null===O;let X=e[r+1];X===_r&&(X=B?xo:void 0);let te=B?Su(X,i):O===i?X:void 0;if(A&&!we(te)&&(te=Su(x,i)),we(te)&&(b=te,d))return b;const se=n[r+1];r=d?Gc(se):Ru(se)}if(null!==t){let x=a?t.residualClasses:t.residualStyles;null!=x&&(b=Su(x,i))}return b}function we(n){return void 0!==n}function Z(n,t=""){const e=_n(),i=Rr(),r=n+22,a=i.firstCreatePass?Sh(i,r,1,t,null):i.data[r],d=e[r]=function sm(n,t){return n.createText(t)}(e[11],t);lm(i,e,d,a),$a(a,!1)}function de(n){return De("",n,""),de}function De(n,t,e){const i=_n(),r=qp(i,n,t,e);return r!==_r&&Dd(i,wo(),r),De}function Be(n,t,e,i,r){const a=_n(),d=function ko(n,t,e,i,r,a){const b=Dh(n,Ol(),e,r);return Wa(2),b?t+Gn(e)+i+Gn(r)+a:_r}(a,n,t,e,i,r);return d!==_r&&Dd(a,wo(),d),Be}function it(n,t,e,i,r,a,d,b,x,A,O){const B=_n(),X=Ou(B,n,t,e,i,r,a,d,b,x,A,O);return X!==_r&&Dd(B,wo(),X),it}function dr(n,t,e){const i=_n();return ja(i,yl(),t)&&js(Rr(),Yo(),i,n,t,i[11],e,!0),dr}function Qs(n,t,e){const i=_n();if(ja(i,yl(),t)){const a=Rr(),d=Yo();js(a,d,i,n,t,Dm(Fn(a.data),d,i),e,!0)}return Qs}const Ia=void 0;var vc=["en",[["a","p"],["AM","PM"],Ia],[["AM","PM"],Ia,Ia],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ia,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ia,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Ia,"{1} 'at' {0}",Ia],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function yc(n){const e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===i?1:5}];let xc={};function Os(n){const t=function PS(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=_x(t);if(e)return e;const i=t.split("-")[0];if(e=_x(i),e)return e;if("en"===i)return vc;throw new qt(701,!1)}function _x(n){return n in xc||(xc[n]=vo.ng&&vo.ng.common&&vo.ng.common.locales&&vo.ng.common.locales[n]),xc[n]}var oi=(()=>((oi=oi||{})[oi.LocaleId=0]="LocaleId",oi[oi.DayPeriodsFormat=1]="DayPeriodsFormat",oi[oi.DayPeriodsStandalone=2]="DayPeriodsStandalone",oi[oi.DaysFormat=3]="DaysFormat",oi[oi.DaysStandalone=4]="DaysStandalone",oi[oi.MonthsFormat=5]="MonthsFormat",oi[oi.MonthsStandalone=6]="MonthsStandalone",oi[oi.Eras=7]="Eras",oi[oi.FirstDayOfWeek=8]="FirstDayOfWeek",oi[oi.WeekendRange=9]="WeekendRange",oi[oi.DateFormat=10]="DateFormat",oi[oi.TimeFormat=11]="TimeFormat",oi[oi.DateTimeFormat=12]="DateTimeFormat",oi[oi.NumberSymbols=13]="NumberSymbols",oi[oi.NumberFormats=14]="NumberFormats",oi[oi.CurrencyCode=15]="CurrencyCode",oi[oi.CurrencySymbol=16]="CurrencySymbol",oi[oi.CurrencyName=17]="CurrencyName",oi[oi.Currencies=18]="Currencies",oi[oi.Directionality=19]="Directionality",oi[oi.PluralCase=20]="PluralCase",oi[oi.ExtraData=21]="ExtraData",oi))();const Mh="en-US";let jy=Mh;function mI(n,t,e,i,r){if(n=$i(n),Array.isArray(n))for(let a=0;a<n.length;a++)mI(n[a],t,e,i,r);else{const a=Rr(),d=_n();let b=yh(n)?n:$i(n.provide),x=y0(n);const A=vs(),O=1048575&A.providerIndexes,B=A.directiveStart,X=A.providerIndexes>>20;if(yh(n)||!n.multi){const te=new lc(x,r,ue),se=_I(b,t,r?O:O+X,B);-1===se?(_p(ah(A,d),a,b),gI(a,n,t.length),t.push(b),A.directiveStart++,A.directiveEnd++,r&&(A.providerIndexes+=1048576),e.push(te),d.push(te)):(e[se]=te,d[se]=te)}else{const te=_I(b,t,O+X,B),se=_I(b,t,O,O+X),me=te>=0&&e[te],ye=se>=0&&e[se];if(r&&!ye||!r&&!me){_p(ah(A,d),a,b);const $e=function h6(n,t,e,i,r){const a=new lc(n,e,ue);return a.multi=[],a.index=t,a.componentProviders=0,_P(a,r,i&&!e),a}(r?d6:u6,e.length,r,i,x);!r&&ye&&(e[se].providerFactory=$e),gI(a,n,t.length,0),t.push(b),A.directiveStart++,A.directiveEnd++,r&&(A.providerIndexes+=1048576),e.push($e),d.push($e)}else gI(a,n,te>-1?te:se,_P(e[r?se:te],x,!r&&i));!r&&i&&ye&&e[se].componentProviders++}}}function gI(n,t,e,i){const r=yh(t),a=function iE(n){return!!n.useClass}(t);if(r||a){const x=(a?$i(t.useClass):t).prototype.ngOnDestroy;if(x){const A=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){const O=A.indexOf(e);-1===O?A.push(e,[i,x]):A[O+1].push(i,x)}else A.push(e,x)}}}function _P(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function _I(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function u6(n,t,e,i){return bI(this.multi,[])}function d6(n,t,e,i){const r=this.multi;let a;if(this.providerFactory){const d=this.providerFactory.componentProviders,b=Ya(e,e[1],this.providerFactory.index,i);a=b.slice(0,d),bI(r,a);for(let x=d;x<b.length;x++)a.push(b[x])}else a=[],bI(r,a);return a}function bI(n,t){for(let e=0;e<n.length;e++)t.push((0,n[e])());return t}function Mi(n,t=[]){return e=>{e.providersResolver=(i,r)=>function c6(n,t,e){const i=Rr();if(i.firstCreatePass){const r=Sa(n);mI(e,i.data,i.blueprint,r,!0),mI(t,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,t)}}class y_{}class bP{}class yP extends y_{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new ix(this);const i=sa(t);this._bootstrapComponents=Sd(i.bootstrap),this._r3Injector=oy(t,e,[{provide:y_,useValue:this},{provide:Pp,useValue:this.componentFactoryResolver}],Cr(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class yI extends bP{constructor(t){super(),this.moduleType=t}create(t){return new yP(this.moduleType,t)}}class f6 extends y_{constructor(t,e,i){super(),this.componentFactoryResolver=new ix(this),this.instance=null;const r=new Jb([...t,{provide:y_,useValue:this},{provide:Pp,useValue:this.componentFactoryResolver}],e||Yb(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function zS(n,t,e=null){return new f6(n,t,e).injector}let m6=(()=>{class n{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e.id)){const i=xd(0,e.type),r=i.length>0?zS([i],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e.id,r)}return this.cachedInjectors.get(e.id)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=wn({token:n,providedIn:"environment",factory:()=>new n(Tt(wd))}),n})();function vP(n){n.getStandaloneInjector=t=>t.get(m6).getOrCreateStandaloneInjector(n)}function Jc(n,t,e,i){return IP(_n(),Js(),n,t,e,i)}function EP(n,t,e,i,r){return function MP(n,t,e,i,r,a,d){const b=t+e;return Dh(n,b,r,a)?Zc(n,b+2,d?i.call(d,r,a):i(r,a)):Cx(n,b+2)}(_n(),Js(),n,t,e,i,r)}function Cx(n,t){const e=n[t];return e===_r?void 0:e}function IP(n,t,e,i,r,a){const d=t+e;return ja(n,d,r)?Zc(n,d+1,a?i.call(a,r):i(r)):Cx(n,d+1)}function Uy(n,t){const e=Rr();let i;const r=n+22;e.firstCreatePass?(i=function P6(n,t){if(t)for(let e=t.length-1;e>=0;e--){const i=t[e];if(n===i.name)return i}}(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(r,i.onDestroy)):i=e.data[r];const a=i.factory||(i.factory=Qu(i.type)),d=Ts(ue);try{const b=ud(!1),x=a();return ud(b),function ax(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}(e,_n(),r,x),x}finally{Ts(d)}}function Hy(n,t,e){const i=n+22,r=_n(),a=rc(r,i);return function Dx(n,t){return n[1].data[t].pure}(r,i)?IP(r,Js(),t,a.transform,e,a):a.transform(e)}function xI(n){return t=>{setTimeout(n,void 0,t)}}const Cn=class N6 extends On{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,i){var r,a,d;let b=t,x=e||(()=>null),A=i;if(t&&"object"==typeof t){const B=t;b=null===(r=B.next)||void 0===r?void 0:r.bind(B),x=null===(a=B.error)||void 0===a?void 0:a.bind(B),A=null===(d=B.complete)||void 0===d?void 0:d.bind(B)}this.__isAsync&&(x=xI(x),b&&(b=xI(b)),A&&(A=xI(A)));const O=super.subscribe({next:b,error:x,complete:A});return t instanceof Se&&t.add(O),O}};function B6(){return this._results[Up()]()}class v_{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Up(),i=v_.prototype;i[e]||(i[e]=B6)}get changes(){return this._changes||(this._changes=new Cn)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const i=this;i.dirty=!1;const r=Ba(t);(this._changesDetected=!function Db(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],a=t[i];if(e&&(r=e(r),a=e(a)),a!==r)return!1}return!0}(i._results,r,e))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let ls=(()=>{class n{}return n.__NG_ELEMENT_ID__=j6,n})();const z6=ls,V6=class extends z6{constructor(t,e,i){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(t,e){const i=this._declarationTContainer.tViews,r=Sm(this._declarationLView,i,t,16,null,i.declTNode,null,null,null,null,e||null);r[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(r[19]=d.createEmbeddedView(i)),by(i,r,t),new p_(r)}};function j6(){return VS(vs(),_n())}function VS(n,t){return 4&n.type?new V6(t,n,kp(n,t)):null}let Hs=(()=>{class n{}return n.__NG_ELEMENT_ID__=U6,n})();function U6(){return OP(vs(),_n())}const H6=Hs,kP=class extends H6{constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return kp(this._hostTNode,this._hostLView)}get injector(){return new yu(this._hostTNode,this._hostLView)}get parentInjector(){const t=er(this._hostTNode,this._hostLView);if(xb(t)){const e=_u(t,this._hostLView),i=cd(t);return new yu(e[1].data[i+8],e)}return new yu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=LP(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,i){let r,a;"number"==typeof i?r=i:null!=i&&(r=i.index,a=i.injector);const d=t.createEmbeddedView(e||{},a);return this.insert(d,r),d}createComponent(t,e,i,r,a){const d=t&&!function uh(n){return"function"==typeof n}(t);let b;if(d)b=e;else{const B=e||{};b=B.index,i=B.injector,r=B.projectableNodes,a=B.environmentInjector||B.ngModuleRef}const x=d?t:new Em(ir(t)),A=i||this.parentInjector;if(!a&&null==x.ngModule){const X=(d?A:this.parentInjector).get(wd,null);X&&(a=X)}const O=x.create(A,r,void 0,a);return this.insert(O.hostView,b),O}insert(t,e){const i=t._lView,r=i[1];if(function pg(n){return zs(n[3])}(i)){const O=this.indexOf(t);if(-1!==O)this.detach(O);else{const B=i[3],X=new kP(B,B[6],B[3]);X.detach(X.indexOf(t))}}const a=this._adjustIndex(e),d=this._lContainer;!function nw(n,t,e,i){const r=10+i,a=e.length;i>0&&(e[r-1][4]=t),i<a-10?(t[4]=e[r],Ag(e,10+i,t)):(e.push(t),t[4]=null),t[3]=e;const d=t[17];null!==d&&e!==d&&function iw(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(d,t);const b=t[19];null!==b&&b.insertView(n),t[2]|=64}(r,i,d,a);const b=Bb(a,d),x=i[11],A=Og(x,d[7]);return null!==A&&function kb(n,t,e,i,r,a){i[0]=r,i[6]=t,Fg(n,i,e,1,r,a)}(r,d[6],x,i,A,b),t.attachToViewContainerRef(),Ag(wI(d),a,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=LP(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),i=Lb(this._lContainer,e);i&&(dh(wI(this._lContainer),e),Ob(i[1],i))}detach(t){const e=this._adjustIndex(t,-1),i=Lb(this._lContainer,e);return i&&null!=dh(wI(this._lContainer),e)?new p_(i):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function LP(n){return n[8]}function wI(n){return n[8]||(n[8]=[])}function OP(n,t){let e;const i=t[n.index];if(zs(i))e=i;else{let r;if(8&n.type)r=Es(i);else{const a=t[11];r=a.createComment("");const d=Fa(n,t);gh(a,Og(a,d),r,function sw(n,t){return n.nextSibling(t)}(a,d),!1)}t[n.index]=e=jp(i,t,r,n),Cd(t,e)}return new kP(e,n,t)}class SI{constructor(t){this.queryList=t,this.matches=null}clone(){return new SI(this.queryList)}setDirty(){this.queryList.setDirty()}}class TI{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const i=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let a=0;a<i;a++){const d=e.getByIndex(a);r.push(this.queries[d.indexInDeclarationView].clone())}return new TI(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==VP(t,e).matches&&this.queries[e].setDirty()}}class FP{constructor(t,e,i=null){this.predicate=t,this.flags=e,this.read=i}}class CI{constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){const r=null!==e?e.length:0,a=this.getByIndex(i).embeddedTView(t,r);a&&(a.indexInDeclarationView=i,null!==e?e.push(a):e=[a])}return null!==e?new CI(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class DI{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new DI(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const a=i[r];this.matchTNodeWithReadOption(t,e,$6(e,a)),this.matchTNodeWithReadOption(t,e,Fl(e,t,a,!1,!1))}else i===ls?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,Fl(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===ci||r===Hs||r===ls&&4&e.type)this.addMatch(e.index,-2);else{const a=Fl(e,t,r,!1,!1);null!==a&&this.addMatch(e.index,a)}else this.addMatch(e.index,i)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function $6(n,t){const e=n.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1];return null}function X6(n,t,e,i){return-1===e?function W6(n,t){return 11&n.type?kp(n,t):4&n.type?VS(n,t):null}(t,n):-2===e?function Z6(n,t,e){return e===ci?kp(t,n):e===ls?VS(t,n):e===Hs?OP(t,n):void 0}(n,t,i):Ya(n,n[1],e,t)}function NP(n,t,e,i){const r=t[19].queries[i];if(null===r.matches){const a=n.data,d=e.matches,b=[];for(let x=0;x<d.length;x+=2){const A=d[x];b.push(A<0?null:X6(t,a[A],d[x+1],e.metadata.read))}r.matches=b}return r.matches}function EI(n,t,e,i){const r=n.queries.getByIndex(e),a=r.matches;if(null!==a){const d=NP(n,t,r,e);for(let b=0;b<a.length;b+=2){const x=a[b];if(x>0)i.push(d[b/2]);else{const A=a[b+1],O=t[-x];for(let B=10;B<O.length;B++){const X=O[B];X[17]===X[3]&&EI(X[1],X,A,i)}if(null!==O[9]){const B=O[9];for(let X=0;X<B.length;X++){const te=B[X];EI(te[1],te,A,i)}}}}}return i}function xi(n){const t=_n(),e=Rr(),i=qf();Gf(i+1);const r=VP(e,i);if(n.dirty&&function Qd(n){return 4==(4&n[2])}(t)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const a=r.crossesNgTemplate?EI(e,t,i,[]):NP(e,t,r,i);n.reset(a,lE),n.notifyOnChanges()}return!0}return!1}function mo(n,t,e){const i=Rr();i.firstCreatePass&&(zP(i,new FP(n,t,e),-1),2==(2&t)&&(i.staticViewQueries=!0)),BP(i,_n(),t)}function Uo(n,t,e,i){const r=Rr();if(r.firstCreatePass){const a=vs();zP(r,new FP(t,e,i),a.index),function J6(n,t){const e=n.contentQueries||(n.contentQueries=[]);t!==(e.length?e[e.length-1]:-1)&&e.push(n.queries.length-1,t)}(r,n),2==(2&e)&&(r.staticContentQueries=!0)}BP(r,_n(),e)}function wi(){return function Y6(n,t){return n[19].queries[t].queryList}(_n(),qf())}function BP(n,t,e){const i=new v_(4==(4&e));oS(n,t,i,i.destroy),null===t[19]&&(t[19]=new TI),t[19].queries.push(new SI(i))}function zP(n,t,e){null===n.queries&&(n.queries=new CI),n.queries.track(new DI(t,e))}function VP(n,t){return n.queries.getByIndex(t)}function Kp(n,t){return VS(n,t)}function US(...n){}const HS=new en("Application Initializer");let qS=(()=>{class n{constructor(e){this.appInits=e,this.resolve=US,this.reject=US,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const a=this.appInits[r]();if($p(a))e.push(a);else if(ky(a)){const d=new Promise((b,x)=>{a.subscribe({complete:b,error:x})});e.push(d)}}Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),0===e.length&&i(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(Tt(HS,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const $y=new en("AppId",{providedIn:"root",factory:function ok(){return`${PI()}${PI()}${PI()}`}});function PI(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const sk=new en("Platform Initializer"),GS=new en("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),ak=new en("appBootstrapListener"),Ah=new en("AnimationModuleType");let b5=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const Kc=new en("LocaleId",{providedIn:"root",factory:()=>$o(Kc,Ei.Optional|Ei.SkipSelf)||function y5(){return"undefined"!=typeof $localize&&$localize.locale||Mh}()});class x5{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}let kI=(()=>{class n{compileModuleSync(e){return new yI(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const i=this.compileModuleSync(e),a=Sd(sa(e).declarations).reduce((d,b)=>{const x=ir(b);return x&&d.push(new Em(x)),d},[]);return new x5(i,a)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const T5=(()=>Promise.resolve(0))();function LI(n){"undefined"==typeof Zone?T5.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Ui{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Cn(!1),this.onMicrotaskEmpty=new Cn(!1),this.onStable=new Cn(!1),this.onError=new Cn(!1),"undefined"==typeof Zone)throw new qt(908,!1);Zone.assertZonePatched();const r=this;if(r._nesting=0,r._outer=r._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const a=Zone.AsyncStackTaggingZoneSpec;r._inner=r._inner.fork(new a("Angular"))}Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&e,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function C5(){let n=vo.requestAnimationFrame,t=vo.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function I5(n){const t=()=>{!function E5(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(vo,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,FI(n),n.isCheckStableRunning=!0,OI(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),FI(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,r,a,d,b)=>{try{return uk(n),e.invokeTask(r,a,d,b)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===a.type||n.shouldCoalesceRunChangeDetection)&&t(),dk(n)}},onInvoke:(e,i,r,a,d,b,x)=>{try{return uk(n),e.invoke(r,a,d,b,x)}finally{n.shouldCoalesceRunChangeDetection&&t(),dk(n)}},onHasTask:(e,i,r,a)=>{e.hasTask(r,a),i===r&&("microTask"==a.change?(n._hasPendingMicrotasks=a.microTask,FI(n),OI(n)):"macroTask"==a.change&&(n.hasPendingMacrotasks=a.macroTask))},onHandleError:(e,i,r,a)=>(e.handleError(r,a),n.runOutsideAngular(()=>n.onError.emit(a)),!1)})}(r)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ui.isInAngularZone())throw new qt(909,!1)}static assertNotInAngularZone(){if(Ui.isInAngularZone())throw new qt(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){const a=this._inner,d=a.scheduleEventTask("NgZoneEvent: "+r,t,D5,US,US);try{return a.runTask(d,e,i)}finally{a.cancelTask(d)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}}const D5={};function OI(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function FI(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function uk(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function dk(n){n._nesting--,OI(n)}class M5{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Cn,this.onMicrotaskEmpty=new Cn,this.onStable=new Cn,this.onError=new Cn}run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}}const hk=new en(""),$S=new en("");let Ix,NI=(()=>{class n{constructor(e,i,r){this._ngZone=e,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Ix||(function A5(n){Ix=n}(r),r.addToWindow(i)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ui.assertNotInAngularZone(),LI(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())LI(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,r){let a=-1;i&&i>0&&(a=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==a),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:a,updateCb:r})}whenStable(e,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,i,r){return[]}}return n.\u0275fac=function(e){return new(e||n)(Tt(Ui),Tt(BI),Tt($S))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),BI=(()=>{class n{constructor(){this._applications=new Map}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){var r;return null!==(r=null==Ix?void 0:Ix.findTestabilityInTree(this,e,i))&&void 0!==r?r:null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),Rh=null;const pk=new en("AllowMultipleToken"),zI=new en("PlatformDestroyListeners");class fk{constructor(t,e){this.name=t,this.token=e}}function gk(n,t,e=[]){const i=`Platform: ${t}`,r=new en(i);return(a=[])=>{let d=VI();if(!d||d.injector.get(pk,!1)){const b=[...e,...a,{provide:r,useValue:!0}];n?n(b):function k5(n){if(Rh&&!Rh.get(pk,!1))throw new qt(400,!1);Rh=n;const t=n.get(bk);(function mk(n){const t=n.get(sk,null);t&&t.forEach(e=>e())})(n)}(function _k(n=[],t){return Jo.create({name:t,providers:[{provide:b0,useValue:"platform"},{provide:zI,useValue:new Set([()=>Rh=null])},...n]})}(b,i))}return function O5(n){const t=VI();if(!t)throw new qt(401,!1);return t}()}}function VI(){var n;return null!==(n=null==Rh?void 0:Rh.get(bk))&&void 0!==n?n:null}let bk=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const r=function vk(n,t){let e;return e="noop"===n?new M5:("zone.js"===n?void 0:n)||new Ui(t),e}(null==i?void 0:i.ngZone,function yk(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),a=[{provide:Ui,useValue:r}];return r.run(()=>{const d=Jo.create({providers:a,parent:this.injector,name:e.moduleType.name}),b=e.create(d),x=b.injector.get(Mu,null);if(!x)throw new qt(402,!1);return r.runOutsideAngular(()=>{const A=r.onError.subscribe({next:O=>{x.handleError(O)}});b.onDestroy(()=>{WS(this._modules,b),A.unsubscribe()})}),function xk(n,t,e){try{const i=e();return $p(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n.handleError(i)),i}}(x,r,()=>{const A=b.injector.get(qS);return A.runInitializers(),A.donePromise.then(()=>(function Ed(n){Lr(n,"Expected localeId to be defined"),"string"==typeof n&&(jy=n.toLowerCase().replace(/_/g,"-"))}(b.injector.get(Kc,Mh)||Mh),this._moduleDoBootstrap(b),b))})})}bootstrapModule(e,i=[]){const r=wk({},i);return function R5(n,t,e){const i=new yI(e);return Promise.resolve(i)}(0,0,e).then(a=>this.bootstrapModuleFactory(a,r))}_moduleDoBootstrap(e){const i=e.injector.get(Wy);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!e.instance.ngDoBootstrap)throw new qt(403,!1);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new qt(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const e=this._injector.get(zI,null);e&&(e.forEach(i=>i()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(Tt(Jo))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function wk(n,t){return Array.isArray(t)?t.reduce(wk,n):Object.assign(Object.assign({},n),t)}let Wy=(()=>{class n{constructor(e,i,r){this._zone=e,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const a=new yi(b=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{b.next(this._stable),b.complete()})}),d=new yi(b=>{let x;this._zone.runOutsideAngular(()=>{x=this._zone.onStable.subscribe(()=>{Ui.assertNotInAngularZone(),LI(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,b.next(!0))})})});const A=this._zone.onUnstable.subscribe(()=>{Ui.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{b.next(!1)}))});return()=>{x.unsubscribe(),A.unsubscribe()}});this.isStable=Oo(a,d.pipe(Rl()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,i){const r=e instanceof Ow;if(!this._injector.get(qS).done)throw!r&&function Ll(n){const t=ir(n)||Bs(n)||Ds(n);return null!==t&&t.standalone}(e),new qt(405,false);let d;d=r?e:this._injector.get(Pp).resolveComponentFactory(e),this.componentTypes.push(d.componentType);const b=function P5(n){return n.isBoundToModule}(d)?void 0:this._injector.get(y_),A=d.create(Jo.NULL,[],i||d.selector,b),O=A.location.nativeElement,B=A.injector.get(hk,null);return null==B||B.registerApplication(O),A.onDestroy(()=>{this.detachView(A.hostView),WS(this.components,A),null==B||B.unregisterApplication(O)}),this._loadComponent(A),A}tick(){if(this._runningTick)throw new qt(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;WS(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(ak,[]).concat(this._bootstrapListeners).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>WS(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new qt(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(e){return new(e||n)(Tt(Ui),Tt(wd),Tt(Mu))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function WS(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let Tk=!0,So=(()=>{class n{}return n.__NG_ELEMENT_ID__=B5,n})();function B5(n){return function z5(n,t,e){if(qi(n)&&!e){const i=aa(n.index,t);return new p_(i,i)}return 47&n.type?new p_(t[16],t):null}(vs(),_n(),16==(16&n))}class Mk{constructor(){}supports(t){return f_(t)}create(t){return new G5(t)}}const q5=(n,t)=>t;class G5{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||q5}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,i=this._removalsHead,r=0,a=null;for(;e||i;){const d=!i||e&&e.currentIndex<Rk(i,r,a)?e:i,b=Rk(d,r,a),x=d.currentIndex;if(d===i)r--,i=i._nextRemoved;else if(e=e._next,null==d.previousIndex)r++;else{a||(a=[]);const A=b-r,O=x-r;if(A!=O){for(let X=0;X<A;X++){const te=X<a.length?a[X]:a[X]=0,se=te+X;O<=se&&se<A&&(a[X]=te+1)}a[d.previousIndex]=O-A}}b!==x&&t(d,b,x)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!f_(t))throw new qt(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,a,d,e=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let b=0;b<this.length;b++)a=t[b],d=this._trackByFn(b,a),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,a,d,b)),Object.is(e.item,a)||this._addIdentityChange(e,a)):(e=this._mismatch(e,a,d,b),i=!0),e=e._next}else r=0,function Ul(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Up()]();let i;for(;!(i=e.next()).done;)t(i.value)}}(t,b=>{d=this._trackByFn(r,b),null!==e&&Object.is(e.trackById,d)?(i&&(e=this._verifyReinsertion(e,b,d,r)),Object.is(e.item,b)||this._addIdentityChange(e,b)):(e=this._mismatch(e,b,d,r),i=!0),e=e._next,r++}),this.length=r;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,i,r){let a;return null===t?a=this._itTail:(a=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,a,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,a,r)):t=this._addAfter(new $5(e,i),a,r),t}_verifyReinsertion(t,e,i,r){let a=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==a?t=this._reinsertAfter(a,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,a=t._nextRemoved;return null===r?this._removalsHead=a:r._nextRemoved=a,null===a?this._removalsTail=r:a._prevRemoved=r,this._insertAfter(t,e,i),this._addToMoves(t,i),t}_moveAfter(t,e,i){return this._unlink(t),this._insertAfter(t,e,i),this._addToMoves(t,i),t}_addAfter(t,e,i){return this._insertAfter(t,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,i){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new Ak),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,i=t._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Ak),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class $5{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class W5{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const e=t._prevDup,i=t._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class Ak{constructor(){this.map=new Map}put(t){const e=t.trackById;let i=this.map.get(e);i||(i=new W5,this.map.set(e,i)),i.add(t)}get(t,e){const r=this.map.get(t);return r?r.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Rk(n,t,e){const i=n.previousIndex;if(null===i)return i;let r=0;return e&&i<e.length&&(r=e[i]),i+t+r}class Pk{constructor(){}supports(t){return t instanceof Map||Hp(t)}create(){return new X5}}class X5{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||Hp(t)))throw new qt(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(i,r)=>{if(e&&e.key===r)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const a=this._getOrCreateRecordForKey(r,i);e=this._insertBeforeOrAppend(e,a)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const i=t._prev;return e._next=t,e._prev=i,t._prev=e,i&&(i._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const r=this._records.get(t);this._maybeAddToChanges(r,e);const a=r._prev,d=r._next;return a&&(a._next=d),d&&(d._prev=a),r._next=null,r._prev=null,r}const i=new Z5(t);return this._records.set(t,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(i=>e(t[i],i))}}class Z5{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function kk(){return new Ph([new Mk])}let Ph=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(null!=i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||kk()),deps:[[n,new S,new g]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(null!=i)return i;throw new qt(901,!1)}}return n.\u0275prov=wn({token:n,providedIn:"root",factory:kk}),n})();function Lk(){return new Mx([new Pk])}let Mx=(()=>{class n{constructor(e){this.factories=e}static create(e,i){if(i){const r=i.factories.slice();e=e.concat(r)}return new n(e)}static extend(e){return{provide:n,useFactory:i=>n.create(e,i||Lk()),deps:[[n,new S,new g]]}}find(e){const i=this.factories.find(r=>r.supports(e));if(i)return i;throw new qt(901,!1)}}return n.\u0275prov=wn({token:n,providedIn:"root",factory:Lk}),n})();const K5=gk(null,"core",[]);let Q5=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(Tt(Wy))},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({}),n})();function ef(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let YS=null;function kh(){return YS}const Oi=new en("DocumentToken");let GI=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:function(){return function ij(){return Tt(Ok)}()},providedIn:"platform"}),n})();const rj=new en("Location Initialized");let Ok=(()=>{class n extends GI{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return kh().getBaseHref(this._doc)}onPopState(e){const i=kh().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=kh().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,r){Fk()?this._history.pushState(e,i,r):this.location.hash=r}replaceState(e,i,r){Fk()?this._history.replaceState(e,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi))},n.\u0275prov=wn({token:n,factory:function(){return function oj(){return new Ok(Tt(Oi))}()},providedIn:"platform"}),n})();function Fk(){return!!window.history.pushState}function $I(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function Nk(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function tf(n){return n&&"?"!==n[0]?"?"+n:n}let w_=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:function(){return $o(zk)},providedIn:"root"}),n})();const Bk=new en("appBaseHref");let zk=(()=>{class n extends w_{constructor(e,i){var r,a,d;super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=null!==(d=null!==(r=null!=i?i:this._platformLocation.getBaseHrefFromDOM())&&void 0!==r?r:null===(a=$o(Oi).location)||void 0===a?void 0:a.origin)&&void 0!==d?d:""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return $I(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+tf(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,a){const d=this.prepareExternalUrl(r+tf(a));this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,a){const d=this.prepareExternalUrl(r+tf(a));this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Tt(GI),Tt(Bk,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),sj=(()=>{class n extends w_{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=$I(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,a){let d=this.prepareExternalUrl(r+tf(a));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,a){let d=this.prepareExternalUrl(r+tf(a));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,e)}}return n.\u0275fac=function(e){return new(e||n)(Tt(GI),Tt(Bk,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),JS=(()=>{class n{constructor(e){this._subject=new Cn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const i=this._locationStrategy.getBaseHref();this._baseHref=Nk(Vk(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){var e;null===(e=this._urlChangeSubscription)||void 0===e||e.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+tf(i))}normalize(e){return n.stripTrailingSlash(function lj(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,Vk(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+tf(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+tf(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){var i,r;null===(r=(i=this._locationStrategy).historyGo)||void 0===r||r.call(i,e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{var i;const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(null===(i=this._urlChangeSubscription)||void 0===i||i.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i,complete:r})}}return n.normalizeQueryParams=tf,n.joinWithSlash=$I,n.stripTrailingSlash=Nk,n.\u0275fac=function(e){return new(e||n)(Tt(w_))},n.\u0275prov=wn({token:n,factory:function(){return function aj(){return new JS(Tt(w_))}()},providedIn:"root"}),n})();function Vk(n){return n.replace(/\/index.html$/,"")}var ea=(()=>((ea=ea||{})[ea.Format=0]="Format",ea[ea.Standalone=1]="Standalone",ea))(),oo=(()=>((oo=oo||{})[oo.Narrow=0]="Narrow",oo[oo.Abbreviated=1]="Abbreviated",oo[oo.Wide=2]="Wide",oo[oo.Short=3]="Short",oo))(),Fs=(()=>((Fs=Fs||{})[Fs.Short=0]="Short",Fs[Fs.Medium=1]="Medium",Fs[Fs.Long=2]="Long",Fs[Fs.Full=3]="Full",Fs))(),Ji=(()=>((Ji=Ji||{})[Ji.Decimal=0]="Decimal",Ji[Ji.Group=1]="Group",Ji[Ji.List=2]="List",Ji[Ji.PercentSign=3]="PercentSign",Ji[Ji.PlusSign=4]="PlusSign",Ji[Ji.MinusSign=5]="MinusSign",Ji[Ji.Exponential=6]="Exponential",Ji[Ji.SuperscriptingExponent=7]="SuperscriptingExponent",Ji[Ji.PerMille=8]="PerMille",Ji[Ji.Infinity=9]="Infinity",Ji[Ji.NaN=10]="NaN",Ji[Ji.TimeSeparator=11]="TimeSeparator",Ji[Ji.CurrencyDecimal=12]="CurrencyDecimal",Ji[Ji.CurrencyGroup=13]="CurrencyGroup",Ji))();function KS(n,t){return zu(Os(n)[oi.DateFormat],t)}function QS(n,t){return zu(Os(n)[oi.TimeFormat],t)}function eT(n,t){return zu(Os(n)[oi.DateTimeFormat],t)}function Bu(n,t){const e=Os(n),i=e[oi.NumberSymbols][t];if(void 0===i){if(t===Ji.CurrencyDecimal)return e[oi.NumberSymbols][Ji.Decimal];if(t===Ji.CurrencyGroup)return e[oi.NumberSymbols][Ji.Group]}return i}function Uk(n){if(!n[oi.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[oi.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function zu(n,t){for(let e=t;e>-1;e--)if(void 0!==n[e])return n[e];throw new Error("Locale data API: locale data undefined")}function XI(n){const[t,e]=n.split(":");return{hours:+t,minutes:+e}}const xj=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Ax={},wj=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Ma=(()=>((Ma=Ma||{})[Ma.Short=0]="Short",Ma[Ma.ShortGMT=1]="ShortGMT",Ma[Ma.Long=2]="Long",Ma[Ma.Extended=3]="Extended",Ma))(),sr=(()=>((sr=sr||{})[sr.FullYear=0]="FullYear",sr[sr.Month=1]="Month",sr[sr.Date=2]="Date",sr[sr.Hours=3]="Hours",sr[sr.Minutes=4]="Minutes",sr[sr.Seconds=5]="Seconds",sr[sr.FractionalSeconds=6]="FractionalSeconds",sr[sr.Day=7]="Day",sr))(),Nr=(()=>((Nr=Nr||{})[Nr.DayPeriods=0]="DayPeriods",Nr[Nr.Days=1]="Days",Nr[Nr.Months=2]="Months",Nr[Nr.Eras=3]="Eras",Nr))();function Sj(n,t,e,i){let r=function Pj(n){if(Gk(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,a=1,d=1]=n.split("-").map(b=>+b);return tT(r,a-1,d)}const e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(xj))return function kj(n){const t=new Date(0);let e=0,i=0;const r=n[8]?t.setUTCFullYear:t.setFullYear,a=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));const d=Number(n[4]||0)-e,b=Number(n[5]||0)-i,x=Number(n[6]||0),A=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return a.call(t,d,b,x,A),t}(i)}const t=new Date(n);if(!Gk(t))throw new Error(`Unable to convert "${n}" into a date`);return t}(n);t=nf(e,t)||t;let b,d=[];for(;t;){if(b=wj.exec(t),!b){d.push(t);break}{d=d.concat(b.slice(1));const O=d.pop();if(!O)break;t=O}}let x=r.getTimezoneOffset();i&&(x=qk(i,x),r=function Rj(n,t,e){const i=e?-1:1,r=n.getTimezoneOffset();return function Aj(n,t){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+t),n}(n,i*(qk(t,r)-r))}(r,i,!0));let A="";return d.forEach(O=>{const B=function Mj(n){if(YI[n])return YI[n];let t;switch(n){case"G":case"GG":case"GGG":t=ms(Nr.Eras,oo.Abbreviated);break;case"GGGG":t=ms(Nr.Eras,oo.Wide);break;case"GGGGG":t=ms(Nr.Eras,oo.Narrow);break;case"y":t=da(sr.FullYear,1,0,!1,!0);break;case"yy":t=da(sr.FullYear,2,0,!0,!0);break;case"yyy":t=da(sr.FullYear,3,0,!1,!0);break;case"yyyy":t=da(sr.FullYear,4,0,!1,!0);break;case"Y":t=oT(1);break;case"YY":t=oT(2,!0);break;case"YYY":t=oT(3);break;case"YYYY":t=oT(4);break;case"M":case"L":t=da(sr.Month,1,1);break;case"MM":case"LL":t=da(sr.Month,2,1);break;case"MMM":t=ms(Nr.Months,oo.Abbreviated);break;case"MMMM":t=ms(Nr.Months,oo.Wide);break;case"MMMMM":t=ms(Nr.Months,oo.Narrow);break;case"LLL":t=ms(Nr.Months,oo.Abbreviated,ea.Standalone);break;case"LLLL":t=ms(Nr.Months,oo.Wide,ea.Standalone);break;case"LLLLL":t=ms(Nr.Months,oo.Narrow,ea.Standalone);break;case"w":t=ZI(1);break;case"ww":t=ZI(2);break;case"W":t=ZI(1,!0);break;case"d":t=da(sr.Date,1);break;case"dd":t=da(sr.Date,2);break;case"c":case"cc":t=da(sr.Day,1);break;case"ccc":t=ms(Nr.Days,oo.Abbreviated,ea.Standalone);break;case"cccc":t=ms(Nr.Days,oo.Wide,ea.Standalone);break;case"ccccc":t=ms(Nr.Days,oo.Narrow,ea.Standalone);break;case"cccccc":t=ms(Nr.Days,oo.Short,ea.Standalone);break;case"E":case"EE":case"EEE":t=ms(Nr.Days,oo.Abbreviated);break;case"EEEE":t=ms(Nr.Days,oo.Wide);break;case"EEEEE":t=ms(Nr.Days,oo.Narrow);break;case"EEEEEE":t=ms(Nr.Days,oo.Short);break;case"a":case"aa":case"aaa":t=ms(Nr.DayPeriods,oo.Abbreviated);break;case"aaaa":t=ms(Nr.DayPeriods,oo.Wide);break;case"aaaaa":t=ms(Nr.DayPeriods,oo.Narrow);break;case"b":case"bb":case"bbb":t=ms(Nr.DayPeriods,oo.Abbreviated,ea.Standalone,!0);break;case"bbbb":t=ms(Nr.DayPeriods,oo.Wide,ea.Standalone,!0);break;case"bbbbb":t=ms(Nr.DayPeriods,oo.Narrow,ea.Standalone,!0);break;case"B":case"BB":case"BBB":t=ms(Nr.DayPeriods,oo.Abbreviated,ea.Format,!0);break;case"BBBB":t=ms(Nr.DayPeriods,oo.Wide,ea.Format,!0);break;case"BBBBB":t=ms(Nr.DayPeriods,oo.Narrow,ea.Format,!0);break;case"h":t=da(sr.Hours,1,-12);break;case"hh":t=da(sr.Hours,2,-12);break;case"H":t=da(sr.Hours,1);break;case"HH":t=da(sr.Hours,2);break;case"m":t=da(sr.Minutes,1);break;case"mm":t=da(sr.Minutes,2);break;case"s":t=da(sr.Seconds,1);break;case"ss":t=da(sr.Seconds,2);break;case"S":t=da(sr.FractionalSeconds,1);break;case"SS":t=da(sr.FractionalSeconds,2);break;case"SSS":t=da(sr.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=iT(Ma.Short);break;case"ZZZZZ":t=iT(Ma.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=iT(Ma.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=iT(Ma.Long);break;default:return null}return YI[n]=t,t}(O);A+=B?B(r,e,x):"''"===O?"'":O.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),A}function tT(n,t,e){const i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function nf(n,t){const e=function cj(n){return Os(n)[oi.LocaleId]}(n);if(Ax[e]=Ax[e]||{},Ax[e][t])return Ax[e][t];let i="";switch(t){case"shortDate":i=KS(n,Fs.Short);break;case"mediumDate":i=KS(n,Fs.Medium);break;case"longDate":i=KS(n,Fs.Long);break;case"fullDate":i=KS(n,Fs.Full);break;case"shortTime":i=QS(n,Fs.Short);break;case"mediumTime":i=QS(n,Fs.Medium);break;case"longTime":i=QS(n,Fs.Long);break;case"fullTime":i=QS(n,Fs.Full);break;case"short":const r=nf(n,"shortTime"),a=nf(n,"shortDate");i=nT(eT(n,Fs.Short),[r,a]);break;case"medium":const d=nf(n,"mediumTime"),b=nf(n,"mediumDate");i=nT(eT(n,Fs.Medium),[d,b]);break;case"long":const x=nf(n,"longTime"),A=nf(n,"longDate");i=nT(eT(n,Fs.Long),[x,A]);break;case"full":const O=nf(n,"fullTime"),B=nf(n,"fullDate");i=nT(eT(n,Fs.Full),[O,B])}return i&&(Ax[e][t]=i),i}function nT(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return null!=t&&i in t?t[i]:e})),n}function Md(n,t,e="-",i,r){let a="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,a=e));let d=String(n);for(;d.length<t;)d="0"+d;return i&&(d=d.slice(d.length-t)),a+d}function da(n,t,e=0,i=!1,r=!1){return function(a,d){let b=function Cj(n,t){switch(n){case sr.FullYear:return t.getFullYear();case sr.Month:return t.getMonth();case sr.Date:return t.getDate();case sr.Hours:return t.getHours();case sr.Minutes:return t.getMinutes();case sr.Seconds:return t.getSeconds();case sr.FractionalSeconds:return t.getMilliseconds();case sr.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,a);if((e>0||b>-e)&&(b+=e),n===sr.Hours)0===b&&-12===e&&(b=12);else if(n===sr.FractionalSeconds)return function Tj(n,t){return Md(n,3).substring(0,t)}(b,t);const x=Bu(d,Ji.MinusSign);return Md(b,t,x,i,r)}}function ms(n,t,e=ea.Format,i=!1){return function(r,a){return function Dj(n,t,e,i,r,a){switch(e){case Nr.Months:return function hj(n,t,e){const i=Os(n),a=zu([i[oi.MonthsFormat],i[oi.MonthsStandalone]],t);return zu(a,e)}(t,r,i)[n.getMonth()];case Nr.Days:return function dj(n,t,e){const i=Os(n),a=zu([i[oi.DaysFormat],i[oi.DaysStandalone]],t);return zu(a,e)}(t,r,i)[n.getDay()];case Nr.DayPeriods:const d=n.getHours(),b=n.getMinutes();if(a){const A=function gj(n){const t=Os(n);return Uk(t),(t[oi.ExtraData][2]||[]).map(i=>"string"==typeof i?XI(i):[XI(i[0]),XI(i[1])])}(t),O=function _j(n,t,e){const i=Os(n);Uk(i);const a=zu([i[oi.ExtraData][0],i[oi.ExtraData][1]],t)||[];return zu(a,e)||[]}(t,r,i),B=A.findIndex(X=>{if(Array.isArray(X)){const[te,se]=X,me=d>=te.hours&&b>=te.minutes,ye=d<se.hours||d===se.hours&&b<se.minutes;if(te.hours<se.hours){if(me&&ye)return!0}else if(me||ye)return!0}else if(X.hours===d&&X.minutes===b)return!0;return!1});if(-1!==B)return O[B]}return function uj(n,t,e){const i=Os(n),a=zu([i[oi.DayPeriodsFormat],i[oi.DayPeriodsStandalone]],t);return zu(a,e)}(t,r,i)[d<12?0:1];case Nr.Eras:return function pj(n,t){return zu(Os(n)[oi.Eras],t)}(t,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(r,a,n,t,e,i)}}function iT(n){return function(t,e,i){const r=-1*i,a=Bu(e,Ji.MinusSign),d=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case Ma.Short:return(r>=0?"+":"")+Md(d,2,a)+Md(Math.abs(r%60),2,a);case Ma.ShortGMT:return"GMT"+(r>=0?"+":"")+Md(d,1,a);case Ma.Long:return"GMT"+(r>=0?"+":"")+Md(d,2,a)+":"+Md(Math.abs(r%60),2,a);case Ma.Extended:return 0===i?"Z":(r>=0?"+":"")+Md(d,2,a)+":"+Md(Math.abs(r%60),2,a);default:throw new Error(`Unknown zone width "${n}"`)}}}function Hk(n){return tT(n.getFullYear(),n.getMonth(),n.getDate()+(4-n.getDay()))}function ZI(n,t=!1){return function(e,i){let r;if(t){const a=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,d=e.getDate();r=1+Math.floor((d+a)/7)}else{const a=Hk(e),d=function Ij(n){const t=tT(n,0,1).getDay();return tT(n,0,1+(t<=4?4:11)-t)}(a.getFullYear()),b=a.getTime()-d.getTime();r=1+Math.round(b/6048e5)}return Md(r,n,Bu(i,Ji.MinusSign))}}function oT(n,t=!1){return function(e,i){return Md(Hk(e).getFullYear(),n,Bu(i,Ji.MinusSign),t)}}const YI={};function qk(n,t){n=n.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function Gk(n){return n instanceof Date&&!isNaN(n.valueOf())}function Zk(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const i=e.indexOf("="),[r,a]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(a)}return null}let rf=(()=>{class n{constructor(e,i,r,a){this._iterableDiffers=e,this._keyValueDiffers=i,this._ngEl=r,this._renderer=a,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(f_(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),e.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${Cr(i.item)}`);this._toggleClass(i.item,!0)}),e.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!0)):Object.keys(e).forEach(i=>this._toggleClass(i,!!e[i])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(i=>this._toggleClass(i,!1)):Object.keys(e).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(e,i){(e=e.trim())&&e.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(e){return new(e||n)(ue(Ph),ue(Mx),ue(ci),ue(gc))},n.\u0275dir=cn({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),n})();class $j{constructor(t,e,i,r){this.$implicit=t,this.ngForOf=e,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Sl=(()=>{class n{constructor(e,i,r){this._viewContainer=e,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const i=this._viewContainer;e.forEachOperation((r,a,d)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new $j(r.item,this._ngForOf,-1,-1),null===d?void 0:d);else if(null==d)i.remove(null===a?void 0:a);else if(null!==a){const b=i.get(a);i.move(b,d),Kk(b,r)}});for(let r=0,a=i.length;r<a;r++){const b=i.get(r).context;b.index=r,b.count=a,b.ngForOf=this._ngForOf}e.forEachIdentityChange(r=>{Kk(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(ue(Hs),ue(ls),ue(Ph))},n.\u0275dir=cn({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function Kk(n,t){n.context.$implicit=t.item}let Zo=(()=>{class n{constructor(e,i){this._viewContainer=e,this._context=new Xj,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){Qk("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){Qk("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,i){return!0}}return n.\u0275fac=function(e){return new(e||n)(ue(Hs),ue(ls))},n.\u0275dir=cn({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class Xj{constructor(){this.$implicit=null,this.ngIf=null}}function Qk(n,t){if(t&&!t.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${Cr(t)}'.`)}class nM{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}let Xy=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const i=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(e)}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),n})(),aT=(()=>{class n{constructor(e,i,r){this.ngSwitch=r,r._addCase(),this._view=new nM(e,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(e){return new(e||n)(ue(Hs),ue(ls),ue(Xy,9))},n.\u0275dir=cn({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),n})(),tL=(()=>{class n{constructor(e,i,r){this._ngEl=e,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,i){const[r,a]=e.split("."),d=-1===r.indexOf("-")?void 0:Jn.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,a?`${i}${a}`:i,d):this._renderer.removeStyle(this._ngEl.nativeElement,r,d)}_applyChanges(e){e.forEachRemovedItem(i=>this._setStyle(i.key,null)),e.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),e.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(Mx),ue(gc))},n.\u0275dir=cn({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),n})(),Px=(()=>{class n{constructor(e){this._viewContainerRef=e,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(e){if(e.ngTemplateOutlet||e.ngTemplateOutletInjector){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:r,ngTemplateOutletContext:a,ngTemplateOutletInjector:d}=this;this._viewRef=i.createEmbeddedView(r,a,d?{injector:d}:void 0)}else this._viewRef=null}else this._viewRef&&e.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(e){return new(e||n)(ue(Hs))},n.\u0275dir=cn({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[ho]}),n})();function Ad(n,t){return new qt(2100,!1)}class Jj{createSubscription(t,e){return t.subscribe({next:e,error:i=>{throw i}})}dispose(t){t.unsubscribe()}}class Kj{createSubscription(t,e){return t.then(e,i=>{throw i})}dispose(t){}}const Qj=new Kj,eU=new Jj;let kx=(()=>{class n{constructor(e){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=e}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,i=>this._updateLatestValue(e,i))}_selectStrategy(e){if($p(e))return Qj;if(Wp(e))return eU;throw Ad()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,i){e===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(ue(So,16))},n.\u0275pipe=Cs({name:"async",type:n,pure:!1,standalone:!0}),n})();const nU=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let nL=(()=>{class n{transform(e){if(null==e)return null;if("string"!=typeof e)throw Ad();return e.replace(nU,i=>i[0].toUpperCase()+i.slice(1).toLowerCase())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=Cs({name:"titlecase",type:n,pure:!0,standalone:!0}),n})();const rU=new en("DATE_PIPE_DEFAULT_TIMEZONE");let iL=(()=>{class n{constructor(e,i){this.locale=e,this.defaultTimezone=i}transform(e,i="mediumDate",r,a){var d;if(null==e||""===e||e!=e)return null;try{return Sj(e,i,a||this.locale,null!==(d=null!=r?r:this.defaultTimezone)&&void 0!==d?d:void 0)}catch(b){throw Ad()}}}return n.\u0275fac=function(e){return new(e||n)(ue(Kc,16),ue(rU,24))},n.\u0275pipe=Cs({name:"date",type:n,pure:!0,standalone:!0}),n})(),go=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({}),n})();const oL="browser";let yU=(()=>{class n{}return n.\u0275prov=wn({token:n,providedIn:"root",factory:()=>new vU(Tt(Oi),window)}),n})();class vU{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function xU(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const a=r.shadowRoot;if(a){const d=a.getElementById(t)||a.querySelector(`[name="${t}"]`);if(d)return d}r=i.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),i=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,a=this.offset();this.window.scrollTo(i-a[0],r-a[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=sL(this.window.history)||sL(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function sL(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class aL{}class aM extends class XU extends class nj{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function tj(n){YS||(YS=n)}(new aM)}onAndCancel(t,e,i){return t.addEventListener(e,i,!1),()=>{t.removeEventListener(e,i,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function ZU(){return Ox=Ox||document.querySelector("base"),Ox?Ox.getAttribute("href"):null}();return null==e?null:function YU(n){uT=uT||document.createElement("a"),uT.setAttribute("href",n);const t=uT.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){Ox=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Zk(document.cookie,t)}}let uT,Ox=null;const hL=new en("TRANSITION_ID"),KU=[{provide:HS,useFactory:function JU(n,t,e){return()=>{e.get(qS).donePromise.then(()=>{const i=kh(),r=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let a=0;a<r.length;a++)i.remove(r[a])})}},deps:[hL,Oi,Jo],multi:!0}];let eH=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();const dT=new en("EventManagerPlugins");let hT=(()=>{class n{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(r=>r.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,r){return this._findPluginFor(i).addEventListener(e,i,r)}addGlobalEventListener(e,i,r){return this._findPluginFor(i).addGlobalEventListener(e,i,r)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const r=this._plugins;for(let a=0;a<r.length;a++){const d=r[a];if(d.supports(e))return this._eventNameToPlugin.set(e,d),d}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(Tt(dT),Tt(Ui))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();class pL{constructor(t){this._doc=t}addGlobalEventListener(t,e,i){const r=kh().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,i)}}let fL=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),Fx=(()=>{class n extends fL{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,r){e.forEach(a=>{const d=this._doc.createElement("style");d.textContent=a,r.push(i.appendChild(d))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(mL),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(e,r,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(mL))}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();function mL(n){kh().remove(n)}const lM={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},cM=/%COMP%/g;function pT(n,t,e){for(let i=0;i<t.length;i++){let r=t[i];Array.isArray(r)?pT(n,r,e):(r=r.replace(cM,n),e.push(r))}return e}function bL(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let fT=(()=>{class n{constructor(e,i,r){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new uM(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case oa.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new sH(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(e),r}case 1:case oa.ShadowDom:return new aH(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const r=pT(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(Tt(hT),Tt(Fx),Tt($y))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();class uM{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(lM[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(vL(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(vL(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let i="string"==typeof t?document.querySelector(t):t;if(!i)throw new Error(`The selector "${t}" did not match any elements`);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;const a=lM[r];a?t.setAttributeNS(a,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){const r=lM[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(Jn.DashCase|Jn.Important)?t.style.setProperty(e,i,r&Jn.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&Jn.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t[e]=i}setValue(t,e){t.nodeValue=e}listen(t,e,i){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,bL(i)):this.eventManager.addEventListener(t,e,bL(i))}}function vL(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class sH extends uM{constructor(t,e,i,r){super(t),this.component=i;const a=pT(r+"-"+i.id,i.styles,[]);e.addStyles(a),this.contentAttr=function iH(n){return"_ngcontent-%COMP%".replace(cM,n)}(r+"-"+i.id),this.hostAttr=function rH(n){return"_nghost-%COMP%".replace(cM,n)}(r+"-"+i.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}}class aH extends uM{constructor(t,e,i,r){super(t),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const a=pT(r.id,r.styles,[]);for(let d=0;d<a.length;d++){const b=document.createElement("style");b.textContent=a[d],this.shadowRoot.appendChild(b)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let lH=(()=>{class n extends pL{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r){return e.addEventListener(i,r,!1),()=>this.removeEventListener(e,i,r)}removeEventListener(e,i,r){return e.removeEventListener(i,r)}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();const xL=["alt","control","meta","shift"],cH={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},uH={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let dH=(()=>{class n extends pL{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,i,r){const a=n.parseEventName(i),d=n.eventCallback(a.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>kh().onAndCancel(e,a.domEventName,d))}static parseEventName(e){const i=e.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const a=n._normalizeKey(i.pop());let d="",b=i.indexOf("code");if(b>-1&&(i.splice(b,1),d="code."),xL.forEach(A=>{const O=i.indexOf(A);O>-1&&(i.splice(O,1),d+=A+".")}),d+=a,0!=i.length||0===a.length)return null;const x={};return x.domEventName=r,x.fullKey=d,x}static matchEventFullKeyCode(e,i){let r=cH[e.key]||e.key,a="";return i.indexOf("code.")>-1&&(r=e.code,a="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),xL.forEach(d=>{d!==r&&(0,uH[d])(e)&&(a+=d+".")}),a+=r,a===i)}static eventCallback(e,i,r){return a=>{n.matchEventFullKeyCode(a,e)&&r.runGuarded(()=>i(a))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();const SL=[{provide:GS,useValue:oL},{provide:sk,useValue:function hH(){aM.makeCurrent()},multi:!0},{provide:Oi,useFactory:function fH(){return function XD(n){_h=n}(document),document},deps:[]}],mH=gk(K5,"browser",SL),TL=new en(""),CL=[{provide:$S,useClass:class QU{addToWindow(t){vo.getAngularTestability=(i,r=!0)=>{const a=t.findTestabilityInTree(i,r);if(null==a)throw new Error("Could not find testability for element.");return a},vo.getAllAngularTestabilities=()=>t.getAllTestabilities(),vo.getAllAngularRootElements=()=>t.getAllRootElements(),vo.frameworkStabilizers||(vo.frameworkStabilizers=[]),vo.frameworkStabilizers.push(i=>{const r=vo.getAllAngularTestabilities();let a=r.length,d=!1;const b=function(x){d=d||x,a--,0==a&&i(d)};r.forEach(function(x){x.whenStable(b)})})}findTestabilityInTree(t,e,i){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:i?kh().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}},deps:[]},{provide:hk,useClass:NI,deps:[Ui,BI,$S]},{provide:NI,useClass:NI,deps:[Ui,BI,$S]}],DL=[{provide:b0,useValue:"root"},{provide:Mu,useFactory:function pH(){return new Mu},deps:[]},{provide:dT,useClass:lH,multi:!0,deps:[Oi,Ui,GS]},{provide:dT,useClass:dH,multi:!0,deps:[Oi]},{provide:fT,useClass:fT,deps:[hT,Fx,$y]},{provide:Lp,useExisting:fT},{provide:fL,useExisting:Fx},{provide:Fx,useClass:Fx,deps:[Oi]},{provide:hT,useClass:hT,deps:[dT,Ui]},{provide:aL,useClass:eH,deps:[]},[]];let EL=(()=>{class n{constructor(e){}static withServerTransition(e){return{ngModule:n,providers:[{provide:$y,useValue:e.appId},{provide:hL,useExisting:$y},KU]}}}return n.\u0275fac=function(e){return new(e||n)(Tt(TL,12))},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[...DL,...CL],imports:[go,Q5]}),n})(),hM=(()=>{class n{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi))},n.\u0275prov=wn({token:n,factory:function(e){let i=null;return i=e?new e:function _H(){return new hM(Tt(Oi))}(),i},providedIn:"root"}),n})();"undefined"!=typeof window&&window;let mT=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:function(e){let i=null;return i=e?new(e||n):Tt(AL),i},providedIn:"root"}),n})(),AL=(()=>{class n extends mT{constructor(e){super(),this._doc=e}sanitize(e,i){if(null==i)return null;switch(e){case fo.NONE:return i;case fo.HTML:return mc(i,"HTML")?Qa(i):d0(this._doc,String(i)).toString();case fo.STYLE:return mc(i,"Style")?Qa(i):i;case fo.SCRIPT:if(mc(i,"Script"))return Qa(i);throw new Error("unsafe value used in a script context");case fo.URL:return mc(i,"URL")?Qa(i):Ub(String(i));case fo.RESOURCE_URL:if(mc(i,"ResourceURL"))return Qa(i);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function uw(n){return new cw(n)}(e)}bypassSecurityTrustStyle(e){return function dw(n){return new jg(n)}(e)}bypassSecurityTrustScript(e){return function hw(n){return new o0(n)}(e)}bypassSecurityTrustUrl(e){return function pw(n){return new jb(n)}(e)}bypassSecurityTrustResourceUrl(e){return function a0(n){return new ZD(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi))},n.\u0275prov=wn({token:n,factory:function(e){let i=null;return i=e?new e:function TH(n){return new AL(n.get(Oi))}(Tt(Jo)),i},providedIn:"root"}),n})();class RL{}const sf="*";function Aa(n,t){return{type:7,name:n,definitions:t,options:{}}}function Kr(n,t=null){return{type:4,styles:t,timings:n}}function PL(n,t=null){return{type:3,steps:n,options:t}}function kL(n,t=null){return{type:2,steps:n,options:t}}function bi(n){return{type:6,styles:n,offset:null}}function _o(n,t,e){return{type:0,name:n,styles:t,options:e}}function Nx(n){return{type:5,steps:n}}function jr(n,t,e=null){return{type:1,expr:n,animation:t,options:e}}function fM(n=null){return{type:9,options:n}}function mM(n,t,e=null){return{type:11,selector:n,animation:t,options:e}}function LL(n){Promise.resolve().then(n)}class Bx{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){LL(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class OL{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,i=0,r=0;const a=this.players.length;0==a?LL(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++e==a&&this._onFinish()}),d.onDestroy(()=>{++i==a&&this._onDestroy()}),d.onStart(()=>{++r==a&&this._onStart()})}),this.totalTime=this.players.reduce((d,b)=>Math.max(d,b.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((e,i)=>null===e||i.totalTime>e.totalTime?i:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}function FL(n){return new qt(3e3,!1)}function s8(){return"undefined"!=typeof window&&void 0!==window.document}function _M(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function Lm(n){switch(n.length){case 0:return new Bx;case 1:return n[0];default:return new OL(n)}}function NL(n,t,e,i,r=new Map,a=new Map){const d=[],b=[];let x=-1,A=null;if(i.forEach(O=>{const B=O.get("offset"),X=B==x,te=X&&A||new Map;O.forEach((se,me)=>{let ye=me,$e=se;if("offset"!==me)switch(ye=t.normalizePropertyName(ye,d),$e){case"!":$e=r.get(me);break;case sf:$e=a.get(me);break;default:$e=t.normalizeStyleValue(me,ye,$e,d)}te.set(ye,$e)}),X||b.push(te),A=te,x=B}),d.length)throw function XH(n){return new qt(3502,!1)}();return b}function bM(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&yM(e,"start",n)));break;case"done":n.onDone(()=>i(e&&yM(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&yM(e,"destroy",n)))}}function yM(n,t,e){const i=e.totalTime,a=vM(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==i?n.totalTime:i,!!e.disabled),d=n._data;return null!=d&&(a._data=d),a}function vM(n,t,e,i,r="",a=0,d){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:r,totalTime:a,disabled:!!d}}function Qc(n,t,e){let i=n.get(t);return i||n.set(t,i=e),i}function BL(n){const t=n.indexOf(":");return[n.substring(1,t),n.slice(t+1)]}let xM=(n,t)=>!1,zL=(n,t,e)=>[],VL=null;function wM(n){const t=n.parentNode||n.host;return t===VL?null:t}(_M()||"undefined"!=typeof Element)&&(s8()?(VL=(()=>document.documentElement)(),xM=(n,t)=>{for(;t;){if(t===n)return!0;t=wM(t)}return!1}):xM=(n,t)=>n.contains(t),zL=(n,t,e)=>{if(e)return Array.from(n.querySelectorAll(t));const i=n.querySelector(t);return i?[i]:[]});let S_=null,jL=!1;const UL=xM,HL=zL;let qL=(()=>{class n{validateStyleProperty(e){return function l8(n){S_||(S_=function c8(){return"undefined"!=typeof document?document.body:null}()||{},jL=!!S_.style&&"WebkitAppearance"in S_.style);let t=!0;return S_.style&&!function a8(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in S_.style,!t&&jL&&(t="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in S_.style)),t}(e)}matchesElement(e,i){return!1}containsElement(e,i){return UL(e,i)}getParentElement(e){return wM(e)}query(e,i,r){return HL(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,a,d,b=[],x){return new Bx(r,a)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),SM=(()=>{class n{}return n.NOOP=new qL,n})();const TM="ng-enter",gT="ng-leave",_T="ng-trigger",bT=".ng-trigger",$L="ng-animating",CM=".ng-animating";function af(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:DM(parseFloat(t[1]),t[2])}function DM(n,t){return"s"===t?1e3*n:n}function yT(n,t,e){return n.hasOwnProperty("duration")?n:function h8(n,t,e){let r,a=0,d="";if("string"==typeof n){const b=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===b)return t.push(FL()),{duration:0,delay:0,easing:""};r=DM(parseFloat(b[1]),b[2]);const x=b[3];null!=x&&(a=DM(parseFloat(x),b[4]));const A=b[5];A&&(d=A)}else r=n;if(!e){let b=!1,x=t.length;r<0&&(t.push(function DH(){return new qt(3100,!1)}()),b=!0),a<0&&(t.push(function EH(){return new qt(3101,!1)}()),b=!0),b&&t.splice(x,0,FL())}return{duration:r,delay:a,easing:d}}(n,t,e)}function zx(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function WL(n){const t=new Map;return Object.keys(n).forEach(e=>{t.set(e,n[e])}),t}function Om(n,t=new Map,e){if(e)for(let[i,r]of e)t.set(i,r);for(let[i,r]of n)t.set(i,r);return t}function ZL(n,t,e){return e?t+":"+e+";":""}function YL(n){let t="";for(let e=0;e<n.style.length;e++){const i=n.style.item(e);t+=ZL(0,i,n.style.getPropertyValue(i))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=ZL(0,g8(e),n.style[e]));n.setAttribute("style",t)}function Lh(n,t,e){n.style&&(t.forEach((i,r)=>{const a=IM(r);e&&!e.has(r)&&e.set(r,n.style[a]),n.style[a]=i}),_M()&&YL(n))}function T_(n,t){n.style&&(t.forEach((e,i)=>{const r=IM(i);n.style[r]=""}),_M()&&YL(n))}function Vx(n){return Array.isArray(n)?1==n.length?n[0]:kL(n):n}const EM=new RegExp("{{\\s*(.+?)\\s*}}","g");function JL(n){let t=[];if("string"==typeof n){let e;for(;e=EM.exec(n);)t.push(e[1]);EM.lastIndex=0}return t}function jx(n,t,e){const i=n.toString(),r=i.replace(EM,(a,d)=>{let b=t[d];return null==b&&(e.push(function MH(n){return new qt(3003,!1)}()),b=""),b.toString()});return r==i?n:r}function vT(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const m8=/-+([a-z0-9])/g;function IM(n){return n.replace(m8,(...t)=>t[1].toUpperCase())}function g8(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function eu(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw function AH(n){return new qt(3004,!1)}()}}function KL(n,t){return window.getComputedStyle(n)[t]}function w8(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function S8(n,t,e){if(":"==n[0]){const x=function T8(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push(function qH(n){return new qt(3016,!1)}()),"* => *"}}(n,e);if("function"==typeof x)return void t.push(x);n=x}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return e.push(function HH(n){return new qt(3015,!1)}()),t;const r=i[1],a=i[2],d=i[3];t.push(QL(r,d));"<"==a[0]&&!("*"==r&&"*"==d)&&t.push(QL(d,r))}(i,e,t)):e.push(n),e}const TT=new Set(["true","1"]),CT=new Set(["false","0"]);function QL(n,t){const e=TT.has(n)||CT.has(n),i=TT.has(t)||CT.has(t);return(r,a)=>{let d="*"==n||n==r,b="*"==t||t==a;return!d&&e&&"boolean"==typeof r&&(d=r?TT.has(n):CT.has(n)),!b&&i&&"boolean"==typeof a&&(b=a?TT.has(t):CT.has(t)),d&&b}}const C8=new RegExp("s*:selfs*,?","g");function MM(n,t,e,i){return new D8(n).build(t,e,i)}class D8{constructor(t){this._driver=t}build(t,e,i){const r=new M8(e);return this._resetContextStyleTimingState(r),eu(this,Vx(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,r=e.depCount=0;const a=[],d=[];return"@"==t.name.charAt(0)&&e.errors.push(function PH(){return new qt(3006,!1)}()),t.definitions.forEach(b=>{if(this._resetContextStyleTimingState(e),0==b.type){const x=b,A=x.name;A.toString().split(/\s*,\s*/).forEach(O=>{x.name=O,a.push(this.visitState(x,e))}),x.name=A}else if(1==b.type){const x=this.visitTransition(b,e);i+=x.queryCount,r+=x.depCount,d.push(x)}else e.errors.push(function kH(){return new qt(3007,!1)}())}),{type:7,name:t.name,states:a,transitions:d,queryCount:i,depCount:r,options:null}}visitState(t,e){const i=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const a=new Set,d=r||{};i.styles.forEach(b=>{b instanceof Map&&b.forEach(x=>{JL(x).forEach(A=>{d.hasOwnProperty(A)||a.add(A)})})}),a.size&&(vT(a.values()),e.errors.push(function LH(n,t){return new qt(3008,!1)}()))}return{type:0,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const i=eu(this,Vx(t.animation),e);return{type:1,matchers:w8(t.expr,e.errors),animation:i,queryCount:e.queryCount,depCount:e.depCount,options:C_(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(i=>eu(this,i,e)),options:C_(t.options)}}visitGroup(t,e){const i=e.currentTime;let r=0;const a=t.steps.map(d=>{e.currentTime=i;const b=eu(this,d,e);return r=Math.max(r,e.currentTime),b});return e.currentTime=r,{type:3,steps:a,options:C_(t.options)}}visitAnimate(t,e){const i=function R8(n,t){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return AM(yT(n,t).duration,0,"");const e=n;if(e.split(/\s+/).some(a=>"{"==a.charAt(0)&&"{"==a.charAt(1))){const a=AM(0,0,"");return a.dynamic=!0,a.strValue=e,a}const r=yT(e,t);return AM(r.duration,r.delay,r.easing)}(t.timings,e.errors);e.currentAnimateTimings=i;let r,a=t.styles?t.styles:bi({});if(5==a.type)r=this.visitKeyframes(a,e);else{let d=t.styles,b=!1;if(!d){b=!0;const A={};i.easing&&(A.easing=i.easing),d=bi(A)}e.currentTime+=i.duration+i.delay;const x=this.visitStyle(d,e);x.isEmptyStep=b,r=x}return e.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(t,e){const i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let b of r)"string"==typeof b?b===sf?i.push(b):e.errors.push(new qt(3002,!1)):i.push(WL(b));let a=!1,d=null;return i.forEach(b=>{if(b instanceof Map&&(b.has("easing")&&(d=b.get("easing"),b.delete("easing")),!a))for(let x of b.values())if(x.toString().indexOf("{{")>=0){a=!0;break}}),{type:6,styles:i,easing:d,offset:t.offset,containsDynamicStyles:a,options:null}}_validateStyleAst(t,e){const i=e.currentAnimateTimings;let r=e.currentTime,a=e.currentTime;i&&a>0&&(a-=i.duration+i.delay),t.styles.forEach(d=>{"string"!=typeof d&&d.forEach((b,x)=>{const A=e.collectedStyles.get(e.currentQuerySelector),O=A.get(x);let B=!0;O&&(a!=r&&a>=O.startTime&&r<=O.endTime&&(e.errors.push(function FH(n,t,e,i,r){return new qt(3010,!1)}()),B=!1),a=O.startTime),B&&A.set(x,{startTime:a,endTime:r}),e.options&&function f8(n,t,e){const i=t.params||{},r=JL(n);r.length&&r.forEach(a=>{i.hasOwnProperty(a)||e.push(function IH(n){return new qt(3001,!1)}())})}(b,e.options,e.errors)})})}visitKeyframes(t,e){const i={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(function NH(){return new qt(3011,!1)}()),i;let a=0;const d=[];let b=!1,x=!1,A=0;const O=t.steps.map($e=>{const ht=this._makeStyleAst($e,e);let Qe=null!=ht.offset?ht.offset:function A8(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(e instanceof Map&&e.has("offset")){const i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const e=n;t=parseFloat(e.get("offset")),e.delete("offset")}return t}(ht.styles),At=0;return null!=Qe&&(a++,At=ht.offset=Qe),x=x||At<0||At>1,b=b||At<A,A=At,d.push(At),ht});x&&e.errors.push(function BH(){return new qt(3012,!1)}()),b&&e.errors.push(function zH(){return new qt(3200,!1)}());const B=t.steps.length;let X=0;a>0&&a<B?e.errors.push(function VH(){return new qt(3202,!1)}()):0==a&&(X=1/(B-1));const te=B-1,se=e.currentTime,me=e.currentAnimateTimings,ye=me.duration;return O.forEach(($e,ht)=>{const Qe=X>0?ht==te?1:X*ht:d[ht],At=Qe*ye;e.currentTime=se+me.delay+At,me.duration=At,this._validateStyleAst($e,e),$e.offset=Qe,i.styles.push($e)}),i}visitReference(t,e){return{type:8,animation:eu(this,Vx(t.animation),e),options:C_(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:C_(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:C_(t.options)}}visitQuery(t,e){const i=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;const[a,d]=function E8(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(C8,"")),n=n.replace(/@\*/g,bT).replace(/@\w+/g,e=>bT+"-"+e.slice(1)).replace(/:animating/g,CM),[n,t]}(t.selector);e.currentQuerySelector=i.length?i+" "+a:a,Qc(e.collectedStyles,e.currentQuerySelector,new Map);const b=eu(this,Vx(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:11,selector:a,limit:r.limit||0,optional:!!r.optional,includeSelf:d,animation:b,originalSelector:t.selector,options:C_(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(function jH(){return new qt(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:yT(t.timings,e.errors,!0);return{type:12,animation:eu(this,Vx(t.animation),e),timings:i,options:null}}}class M8{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function C_(n){return n?(n=zx(n)).params&&(n.params=function I8(n){return n?zx(n):null}(n.params)):n={},n}function AM(n,t,e){return{duration:n,delay:t,easing:e}}function RM(n,t,e,i,r,a,d=null,b=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:r,delay:a,totalTime:r+a,easing:d,subTimeline:b}}class DT{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const L8=new RegExp(":enter","g"),F8=new RegExp(":leave","g");function PM(n,t,e,i,r,a=new Map,d=new Map,b,x,A=[]){return(new N8).buildKeyframes(n,t,e,i,r,a,d,b,x,A)}class N8{buildKeyframes(t,e,i,r,a,d,b,x,A,O=[]){A=A||new DT;const B=new kM(t,e,A,r,a,O,[]);B.options=x;const X=x.delay?af(x.delay):0;B.currentTimeline.delayNextStep(X),B.currentTimeline.setStyles([d],null,B.errors,x),eu(this,i,B);const te=B.timelines.filter(se=>se.containsAnimation());if(te.length&&b.size){let se;for(let me=te.length-1;me>=0;me--){const ye=te[me];if(ye.element===e){se=ye;break}}se&&!se.allowOnlyTimelineStyles()&&se.setStyles([b],null,B.errors,x)}return te.length?te.map(se=>se.buildKeyframes()):[RM(e,[],[],[],0,X,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const i=e.subInstructions.get(e.element);if(i){const r=e.createSubContext(t.options),a=e.currentTimeline.currentTime,d=this._visitSubInstructions(i,r,r.options);a!=d&&e.transformIntoNewTimeline(d)}e.previousNode=t}visitAnimateRef(t,e){const i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,i),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,i){var r;for(const a of t){const d=null==a?void 0:a.delay;if(d){const b="number"==typeof d?d:af(jx(d,null!==(r=null==a?void 0:a.params)&&void 0!==r?r:{},e.errors));i.delayNextStep(b)}}}_visitSubInstructions(t,e,i){let a=e.currentTimeline.currentTime;const d=null!=i.duration?af(i.duration):null,b=null!=i.delay?af(i.delay):null;return 0!==d&&t.forEach(x=>{const A=e.appendInstructionToTimeline(x,d,b);a=Math.max(a,A.duration+A.delay)}),a}visitReference(t,e){e.updateOptions(t.options,!0),eu(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const i=e.subContextCount;let r=e;const a=t.options;if(a&&(a.params||a.delay)&&(r=e.createSubContext(a),r.transformIntoNewTimeline(),null!=a.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=ET);const d=af(a.delay);r.delayNextStep(d)}t.steps.length&&(t.steps.forEach(d=>eu(this,d,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const i=[];let r=e.currentTimeline.currentTime;const a=t.options&&t.options.delay?af(t.options.delay):0;t.steps.forEach(d=>{const b=e.createSubContext(t.options);a&&b.delayNextStep(a),eu(this,d,b),r=Math.max(r,b.currentTimeline.currentTime),i.push(b.currentTimeline)}),i.forEach(d=>e.currentTimeline.mergeTimelineCollectedStyles(d)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const i=t.strValue;return yT(e.params?jx(i,e.params,e.errors):i,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const i=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());const a=t.style;5==a.type?this.visitKeyframes(a,e):(e.incrementTime(i.duration),this.visitStyle(a,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const a=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(a):i.setStyles(t.styles,a,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const i=e.currentAnimateTimings,r=e.currentTimeline.duration,a=i.duration,b=e.createSubContext().currentTimeline;b.easing=i.easing,t.styles.forEach(x=>{b.forwardTime((x.offset||0)*a),b.setStyles(x.styles,x.easing,e.errors,e.options),b.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(b),e.transformIntoNewTimeline(r+a),e.previousNode=t}visitQuery(t,e){const i=e.currentTimeline.currentTime,r=t.options||{},a=r.delay?af(r.delay):0;a&&(6===e.previousNode.type||0==i&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=ET);let d=i;const b=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=b.length;let x=null;b.forEach((A,O)=>{e.currentQueryIndex=O;const B=e.createSubContext(t.options,A);a&&B.delayNextStep(a),A===e.element&&(x=B.currentTimeline),eu(this,t.animation,B),B.currentTimeline.applyStylesToKeyframe(),d=Math.max(d,B.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(d),x&&(e.currentTimeline.mergeTimelineCollectedStyles(x),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const i=e.parentContext,r=e.currentTimeline,a=t.timings,d=Math.abs(a.duration),b=d*(e.currentQueryTotal-1);let x=d*e.currentQueryIndex;switch(a.duration<0?"reverse":a.easing){case"reverse":x=b-x;break;case"full":x=i.currentStaggerTime}const O=e.currentTimeline;x&&O.delayNextStep(x);const B=O.currentTime;eu(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=r.currentTime-B+(r.startTime-i.currentTimeline.startTime)}}const ET={};class kM{constructor(t,e,i,r,a,d,b,x){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=a,this.errors=d,this.timelines=b,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=ET,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=x||new IT(this._driver,e,0),b.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=af(i.duration)),null!=i.delay&&(r.delay=af(i.delay));const a=i.params;if(a){let d=r.params;d||(d=this.options.params={}),Object.keys(a).forEach(b=>{(!e||!d.hasOwnProperty(b))&&(d[b]=jx(a[b],d,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const i=t.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return t}createSubContext(t=null,e,i){const r=e||this.element,a=new kM(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return a.previousNode=this.previousNode,a.currentAnimateTimings=this.currentAnimateTimings,a.options=this._copyOptions(),a.updateOptions(t),a.currentQueryIndex=this.currentQueryIndex,a.currentQueryTotal=this.currentQueryTotal,a.parentContext=this,this.subContextCount++,a}transformIntoNewTimeline(t){return this.previousNode=ET,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){const r={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+t.delay,easing:""},a=new B8(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(a),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,r,a,d){let b=[];if(r&&b.push(this.element),t.length>0){t=(t=t.replace(L8,"."+this._enterClassName)).replace(F8,"."+this._leaveClassName);let A=this._driver.query(this.element,t,1!=i);0!==i&&(A=i<0?A.slice(A.length+i,A.length):A.slice(0,i)),b.push(...A)}return!a&&0==b.length&&d.push(function UH(n){return new qt(3014,!1)}()),b}}class IT{constructor(t,e,i,r){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1===this._keyframes.size&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new IT(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||sf),this._currentKeyframe.set(e,sf);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,r){var a;e&&this._previousKeyframe.set("easing",e);const d=r&&r.params||{},b=function z8(n,t){const e=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||t.keys();for(let a of i)e.set(a,sf)}else Om(r,e)}),e}(t,this._globalTimelineStyles);for(let[x,A]of b){const O=jx(A,d,i);this._pendingStyles.set(x,O),this._localTimelineStyles.has(x)||this._backFill.set(x,null!==(a=this._globalTimelineStyles.get(x))&&void 0!==a?a:sf),this._updateStyle(x,O)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{const r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((b,x)=>{const A=Om(b,new Map,this._backFill);A.forEach((O,B)=>{"!"===O?t.add(B):O===sf&&e.add(B)}),i||A.set("offset",x/this.duration),r.push(A)});const a=t.size?vT(t.values()):[],d=e.size?vT(e.values()):[];if(i){const b=r[0],x=new Map(b);b.set("offset",0),x.set("offset",1),r=[b,x]}return RM(this.element,r,a,d,this.duration,this.startTime,this.easing,!1)}}class B8 extends IT{constructor(t,e,i,r,a,d,b=!1){super(t,e,d.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=a,this._stretchStartingKeyframe=b,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const a=[],d=i+e,b=e/d,x=Om(t[0]);x.set("offset",0),a.push(x);const A=Om(t[0]);A.set("offset",nO(b)),a.push(A);const O=t.length-1;for(let B=1;B<=O;B++){let X=Om(t[B]);const te=X.get("offset");X.set("offset",nO((e+te*i)/d)),a.push(X)}i=d,e=0,r="",t=a}return RM(this.element,t,this.preStyleProps,this.postStyleProps,i,e,r,!0)}}function nO(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class LM{}const V8=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class j8 extends LM{normalizePropertyName(t,e){return IM(t)}normalizeStyleValue(t,e,i,r){let a="";const d=i.toString().trim();if(V8.has(e)&&0!==i&&"0"!==i)if("number"==typeof i)a="px";else{const b=i.match(/^[+-]?[\d\.]+([a-z]*)$/);b&&0==b[1].length&&r.push(function RH(n,t){return new qt(3005,!1)}())}return d+a}}function iO(n,t,e,i,r,a,d,b,x,A,O,B,X){return{type:0,element:n,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:a,toState:i,toStyles:d,timelines:b,queriedElements:x,preStyleProps:A,postStyleProps:O,totalTime:B,errors:X}}const OM={};class rO{constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,r){return function U8(n,t,e,i,r){return n.some(a=>a(t,e,i,r))}(this.ast.matchers,t,e,i,r)}buildStyles(t,e,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(null==t?void 0:t.toString())||r),r?r.buildStyles(e,i):new Map}build(t,e,i,r,a,d,b,x,A,O){var B;const X=[],te=this.ast.options&&this.ast.options.params||OM,me=this.buildStyles(i,b&&b.params||OM,X),ye=x&&x.params||OM,$e=this.buildStyles(r,ye,X),ht=new Set,Qe=new Map,At=new Map,fn="void"===r,qn={params:H8(ye,te),delay:null===(B=this.ast.options)||void 0===B?void 0:B.delay},Xn=O?[]:PM(t,e,this.ast.animation,a,d,me,$e,qn,A,X);let Ri=0;if(Xn.forEach(Ci=>{Ri=Math.max(Ci.duration+Ci.delay,Ri)}),X.length)return iO(e,this._triggerName,i,r,fn,me,$e,[],[],Qe,At,Ri,X);Xn.forEach(Ci=>{const ar=Ci.element,Gi=Qc(Qe,ar,new Set);Ci.preStyleProps.forEach(Pr=>Gi.add(Pr));const eo=Qc(At,ar,new Set);Ci.postStyleProps.forEach(Pr=>eo.add(Pr)),ar!==e&&ht.add(ar)});const Yi=vT(ht.values());return iO(e,this._triggerName,i,r,fn,me,$e,Xn,Yi,Qe,At,Ri)}}function H8(n,t){const e=zx(t);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(e[i]=n[i]);return e}class q8{constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){const i=new Map,r=zx(this.defaultParams);return Object.keys(t).forEach(a=>{const d=t[a];null!==d&&(r[a]=d)}),this.styles.styles.forEach(a=>{"string"!=typeof a&&a.forEach((d,b)=>{d&&(d=jx(d,r,e));const x=this.normalizer.normalizePropertyName(b,e);d=this.normalizer.normalizeStyleValue(b,x,d,e),i.set(x,d)})}),i}}class $8{constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,this.transitionFactories=[],this.states=new Map,e.states.forEach(r=>{this.states.set(r.name,new q8(r.style,r.options&&r.options.params||{},i))}),oO(this.states,"true","1"),oO(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new rO(t,r,this.states))}),this.fallbackTransition=function W8(n,t,e){return new rO(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(d,b)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,r){return this.transitionFactories.find(d=>d.match(t,e,i,r))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}}function oO(n,t,e){n.has(t)?n.has(e)||n.set(e,n.get(t)):n.has(e)&&n.set(t,n.get(e))}const X8=new DT;class Z8{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,e){const i=[],a=MM(this._driver,e,i,[]);if(i.length)throw function ZH(n){return new qt(3503,!1)}();this._animations.set(t,a)}_buildPlayer(t,e,i){const r=t.element,a=NL(0,this._normalizer,0,t.keyframes,e,i);return this._driver.animate(r,a,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){const r=[],a=this._animations.get(t);let d;const b=new Map;if(a?(d=PM(this._driver,e,a,TM,gT,new Map,new Map,i,X8,r),d.forEach(O=>{const B=Qc(b,O.element,new Map);O.postStyleProps.forEach(X=>B.set(X,null))})):(r.push(function YH(){return new qt(3300,!1)}()),d=[]),r.length)throw function JH(n){return new qt(3504,!1)}();b.forEach((O,B)=>{O.forEach((X,te)=>{O.set(te,this._driver.computeStyle(B,te,sf))})});const A=Lm(d.map(O=>{const B=b.get(O.element);return this._buildPlayer(O,new Map,B)}));return this._playersById.set(t,A),A.onDestroy(()=>this.destroy(t)),this.players.push(A),A}destroy(t){const e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);const i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){const e=this._playersById.get(t);if(!e)throw function KH(n){return new qt(3301,!1)}();return e}listen(t,e,i,r){const a=vM(e,"","","");return bM(this._getPlayer(t),i,a,r),()=>{}}command(t,e,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,e,r[0]||{});const a=this._getPlayer(t);switch(i){case"play":a.play();break;case"pause":a.pause();break;case"reset":a.reset();break;case"restart":a.restart();break;case"finish":a.finish();break;case"init":a.init();break;case"setPosition":a.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const sO="ng-animate-queued",FM="ng-animate-disabled",eq=[],aO={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},tq={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Vu="__ng_removed";class NM{constructor(t,e=""){this.namespaceId=e;const i=t&&t.hasOwnProperty("value");if(this.value=function oq(n){return null!=n?n:null}(i?t.value:t),i){const a=zx(t);delete a.value,this.options=a}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const i=this.options.params;Object.keys(e).forEach(r=>{null==i[r]&&(i[r]=e[r])})}}}const Ux="void",BM=new NM(Ux);class nq{constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,ju(e,this._hostClassName)}listen(t,e,i,r){if(!this._triggers.has(e))throw function QH(n,t){return new qt(3302,!1)}();if(null==i||0==i.length)throw function e8(n){return new qt(3303,!1)}();if(!function sq(n){return"start"==n||"done"==n}(i))throw function t8(n,t){return new qt(3400,!1)}();const a=Qc(this._elementListeners,t,[]),d={name:e,phase:i,callback:r};a.push(d);const b=Qc(this._engine.statesByElement,t,new Map);return b.has(e)||(ju(t,_T),ju(t,_T+"-"+e),b.set(e,BM)),()=>{this._engine.afterFlush(()=>{const x=a.indexOf(d);x>=0&&a.splice(x,1),this._triggers.has(e)||b.delete(e)})}}register(t,e){return!this._triggers.has(t)&&(this._triggers.set(t,e),!0)}_getTrigger(t){const e=this._triggers.get(t);if(!e)throw function n8(n){return new qt(3401,!1)}();return e}trigger(t,e,i,r=!0){const a=this._getTrigger(e),d=new zM(this.id,e,t);let b=this._engine.statesByElement.get(t);b||(ju(t,_T),ju(t,_T+"-"+e),this._engine.statesByElement.set(t,b=new Map));let x=b.get(e);const A=new NM(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&x&&A.absorbOptions(x.options),b.set(e,A),x||(x=BM),A.value!==Ux&&x.value===A.value){if(!function cq(n,t){const e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){const a=e[r];if(!t.hasOwnProperty(a)||n[a]!==t[a])return!1}return!0}(x.params,A.params)){const me=[],ye=a.matchStyles(x.value,x.params,me),$e=a.matchStyles(A.value,A.params,me);me.length?this._engine.reportError(me):this._engine.afterFlush(()=>{T_(t,ye),Lh(t,$e)})}return}const X=Qc(this._engine.playersByElement,t,[]);X.forEach(me=>{me.namespaceId==this.id&&me.triggerName==e&&me.queued&&me.destroy()});let te=a.matchTransition(x.value,A.value,t,A.params),se=!1;if(!te){if(!r)return;te=a.fallbackTransition,se=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:te,fromState:x,toState:A,player:d,isFallbackTransition:se}),se||(ju(t,sO),d.onStart(()=>{Zy(t,sO)})),d.onDone(()=>{let me=this.players.indexOf(d);me>=0&&this.players.splice(me,1);const ye=this._engine.playersByElement.get(t);if(ye){let $e=ye.indexOf(d);$e>=0&&ye.splice($e,1)}}),this.players.push(d),X.push(d),d}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const i=this._engine.driver.query(t,bT,!0);i.forEach(r=>{if(r[Vu])return;const a=this._engine.fetchNamespacesByElement(r);a.size?a.forEach(d=>d.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,i,r){const a=this._engine.statesByElement.get(t),d=new Map;if(a){const b=[];if(a.forEach((x,A)=>{if(d.set(A,x.value),this._triggers.has(A)){const O=this.trigger(t,A,Ux,r);O&&b.push(O)}}),b.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,d),i&&Lm(b).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){const r=new Set;e.forEach(a=>{const d=a.name;if(r.has(d))return;r.add(d);const x=this._triggers.get(d).fallbackTransition,A=i.get(d)||BM,O=new NM(Ux),B=new zM(this.id,d,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:d,transition:x,fromState:A,toState:O,player:B,isFallbackTransition:!0})})}}removeNode(t,e){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(i.totalAnimations){const a=i.players.length?i.playersByQueriedElement.get(t):[];if(a&&a.length)r=!0;else{let d=t;for(;d=d.parentNode;)if(i.statesByElement.get(d)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,e);else{const a=t[Vu];(!a||a===aO)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){ju(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const a=i.element,d=this._elementListeners.get(a);d&&d.forEach(b=>{if(b.name==i.triggerName){const x=vM(a,i.triggerName,i.fromState.value,i.toState.value);x._data=t,bM(i.player,b.phase,x,b.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{const a=i.transition.ast.depCount,d=r.transition.ast.depCount;return 0==a||0==d?a-d:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(i=>i.element===t)||e,e}}class iq{constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,a)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){const i=new nq(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let d=!1,b=this.driver.getParentElement(e);for(;b;){const x=r.get(b);if(x){const A=i.indexOf(x);i.splice(A+1,0,t),d=!0;break}b=this.driver.getParentElement(b)}d||i.unshift(t)}else i.push(t);return r.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let r=this._namespaceLookup[t];r&&r.register(e,i)&&this.totalAnimations++}destroy(t,e){if(!t)return;const i=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[t];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const a=this._fetchNamespace(r.namespaceId);a&&e.add(a)}return e}trigger(t,e,i,r){if(MT(e)){const a=this._fetchNamespace(t);if(a)return a.trigger(e,i,r),!0}return!1}insertNode(t,e,i,r){if(!MT(e))return;const a=e[Vu];if(a&&a.setForRemoval){a.setForRemoval=!1,a.setForMove=!0;const d=this.collectedLeaveElements.indexOf(e);d>=0&&this.collectedLeaveElements.splice(d,1)}if(t){const d=this._fetchNamespace(t);d&&d.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),ju(t,FM)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Zy(t,FM))}removeNode(t,e,i,r){if(MT(e)){const a=t?this._fetchNamespace(t):null;if(a?a.removeNode(e,r):this.markElementAsRemoved(t,e,!1,r),i){const d=this.namespacesByHostElement.get(e);d&&d.id!==t&&d.removeNode(e,r)}}else this._onRemovalComplete(e,r)}markElementAsRemoved(t,e,i,r,a){this.collectedLeaveElements.push(e),e[Vu]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:a}}listen(t,e,i,r,a){return MT(e)?this._fetchNamespace(t).listen(e,i,r,a):()=>{}}_buildInstruction(t,e,i,r,a){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,e,a)}destroyInnerAnimations(t){let e=this.driver.query(t,bT,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,CM,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Lm(this.players).onDone(()=>t());t()})}processLeaveNode(t){var e;const i=t[Vu];if(i&&i.setForRemoval){if(t[Vu]=aO,i.namespaceId){this.destroyInnerAnimations(t);const r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,i.setForRemoval)}!(null===(e=t.classList)||void 0===e)&&e.contains(FM)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)ju(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{e=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],e.length?Lm(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function i8(n){return new qt(3402,!1)}()}_flushAnimations(t,e){const i=new DT,r=[],a=new Map,d=[],b=new Map,x=new Map,A=new Map,O=new Set;this.disabledNodes.forEach(ti=>{O.add(ti);const Fi=this.driver.query(ti,".ng-animate-queued",!0);for(let Ni=0;Ni<Fi.length;Ni++)O.add(Fi[Ni])});const B=this.bodyNode,X=Array.from(this.statesByElement.keys()),te=uO(X,this.collectedEnterElements),se=new Map;let me=0;te.forEach((ti,Fi)=>{const Ni=TM+me++;se.set(Fi,Ni),ti.forEach(Hr=>ju(Hr,Ni))});const ye=[],$e=new Set,ht=new Set;for(let ti=0;ti<this.collectedLeaveElements.length;ti++){const Fi=this.collectedLeaveElements[ti],Ni=Fi[Vu];Ni&&Ni.setForRemoval&&(ye.push(Fi),$e.add(Fi),Ni.hasAnimation?this.driver.query(Fi,".ng-star-inserted",!0).forEach(Hr=>$e.add(Hr)):ht.add(Fi))}const Qe=new Map,At=uO(X,Array.from($e));At.forEach((ti,Fi)=>{const Ni=gT+me++;Qe.set(Fi,Ni),ti.forEach(Hr=>ju(Hr,Ni))}),t.push(()=>{te.forEach((ti,Fi)=>{const Ni=se.get(Fi);ti.forEach(Hr=>Zy(Hr,Ni))}),At.forEach((ti,Fi)=>{const Ni=Qe.get(Fi);ti.forEach(Hr=>Zy(Hr,Ni))}),ye.forEach(ti=>{this.processLeaveNode(ti)})});const fn=[],qn=[];for(let ti=this._namespaceList.length-1;ti>=0;ti--)this._namespaceList[ti].drainQueuedTransitions(e).forEach(Ni=>{const Hr=Ni.player,us=Ni.element;if(fn.push(Hr),this.collectedEnterElements.length){const El=us[Vu];if(El&&El.setForMove){if(El.previousTriggersValues&&El.previousTriggersValues.has(Ni.triggerName)){const Q_=El.previousTriggersValues.get(Ni.triggerName),Wu=this.statesByElement.get(Ni.element);if(Wu&&Wu.has(Ni.triggerName)){const zD=Wu.get(Ni.triggerName);zD.value=Q_,Wu.set(Ni.triggerName,zD)}}return void Hr.destroy()}}const su=!B||!this.driver.containsElement(B,us),Dl=Qe.get(us),au=se.get(us),_s=this._buildInstruction(Ni,i,au,Dl,su);if(_s.errors&&_s.errors.length)return void qn.push(_s);if(su)return Hr.onStart(()=>T_(us,_s.fromStyles)),Hr.onDestroy(()=>Lh(us,_s.toStyles)),void r.push(Hr);if(Ni.isFallbackTransition)return Hr.onStart(()=>T_(us,_s.fromStyles)),Hr.onDestroy(()=>Lh(us,_s.toStyles)),void r.push(Hr);const _V=[];_s.timelines.forEach(El=>{El.stretchStartingKeyframe=!0,this.disabledNodes.has(El.element)||_V.push(El)}),_s.timelines=_V,i.append(us,_s.timelines),d.push({instruction:_s,player:Hr,element:us}),_s.queriedElements.forEach(El=>Qc(b,El,[]).push(Hr)),_s.preStyleProps.forEach((El,Q_)=>{if(El.size){let Wu=x.get(Q_);Wu||x.set(Q_,Wu=new Set),El.forEach((zD,B2)=>Wu.add(B2))}}),_s.postStyleProps.forEach((El,Q_)=>{let Wu=A.get(Q_);Wu||A.set(Q_,Wu=new Set),El.forEach((zD,B2)=>Wu.add(B2))})});if(qn.length){const ti=[];qn.forEach(Fi=>{ti.push(function r8(n,t){return new qt(3505,!1)}())}),fn.forEach(Fi=>Fi.destroy()),this.reportError(ti)}const Xn=new Map,Ri=new Map;d.forEach(ti=>{const Fi=ti.element;i.has(Fi)&&(Ri.set(Fi,Fi),this._beforeAnimationBuild(ti.player.namespaceId,ti.instruction,Xn))}),r.forEach(ti=>{const Fi=ti.element;this._getPreviousPlayers(Fi,!1,ti.namespaceId,ti.triggerName,null).forEach(Hr=>{Qc(Xn,Fi,[]).push(Hr),Hr.destroy()})});const Yi=ye.filter(ti=>hO(ti,x,A)),Ci=new Map;cO(Ci,this.driver,ht,A,sf).forEach(ti=>{hO(ti,x,A)&&Yi.push(ti)});const Gi=new Map;te.forEach((ti,Fi)=>{cO(Gi,this.driver,new Set(ti),x,"!")}),Yi.forEach(ti=>{var Fi,Ni;const Hr=Ci.get(ti),us=Gi.get(ti);Ci.set(ti,new Map([...Array.from(null!==(Fi=null==Hr?void 0:Hr.entries())&&void 0!==Fi?Fi:[]),...Array.from(null!==(Ni=null==us?void 0:us.entries())&&void 0!==Ni?Ni:[])]))});const eo=[],Pr=[],gs={};d.forEach(ti=>{const{element:Fi,player:Ni,instruction:Hr}=ti;if(i.has(Fi)){if(O.has(Fi))return Ni.onDestroy(()=>Lh(Fi,Hr.toStyles)),Ni.disabled=!0,Ni.overrideTotalTime(Hr.totalTime),void r.push(Ni);let us=gs;if(Ri.size>1){let Dl=Fi;const au=[];for(;Dl=Dl.parentNode;){const _s=Ri.get(Dl);if(_s){us=_s;break}au.push(Dl)}au.forEach(_s=>Ri.set(_s,us))}const su=this._buildAnimation(Ni.namespaceId,Hr,Xn,a,Gi,Ci);if(Ni.setRealPlayer(su),us===gs)eo.push(Ni);else{const Dl=this.playersByElement.get(us);Dl&&Dl.length&&(Ni.parentPlayer=Lm(Dl)),r.push(Ni)}}else T_(Fi,Hr.fromStyles),Ni.onDestroy(()=>Lh(Fi,Hr.toStyles)),Pr.push(Ni),O.has(Fi)&&r.push(Ni)}),Pr.forEach(ti=>{const Fi=a.get(ti.element);if(Fi&&Fi.length){const Ni=Lm(Fi);ti.setRealPlayer(Ni)}}),r.forEach(ti=>{ti.parentPlayer?ti.syncPlayerEvents(ti.parentPlayer):ti.destroy()});for(let ti=0;ti<ye.length;ti++){const Fi=ye[ti],Ni=Fi[Vu];if(Zy(Fi,gT),Ni&&Ni.hasAnimation)continue;let Hr=[];if(b.size){let su=b.get(Fi);su&&su.length&&Hr.push(...su);let Dl=this.driver.query(Fi,CM,!0);for(let au=0;au<Dl.length;au++){let _s=b.get(Dl[au]);_s&&_s.length&&Hr.push(..._s)}}const us=Hr.filter(su=>!su.destroyed);us.length?aq(this,Fi,us):this.processLeaveNode(Fi)}return ye.length=0,eo.forEach(ti=>{this.players.push(ti),ti.onDone(()=>{ti.destroy();const Fi=this.players.indexOf(ti);this.players.splice(Fi,1)}),ti.play()}),eo}elementContainsData(t,e){let i=!1;const r=e[Vu];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(e)&&(i=!0),this.playersByQueriedElement.has(e)&&(i=!0),this.statesByElement.has(e)&&(i=!0),this._fetchNamespace(t).elementContainsData(e)||i}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,r,a){let d=[];if(e){const b=this.playersByQueriedElement.get(t);b&&(d=b)}else{const b=this.playersByElement.get(t);if(b){const x=!a||a==Ux;b.forEach(A=>{A.queued||!x&&A.triggerName!=r||d.push(A)})}}return(i||r)&&(d=d.filter(b=>!(i&&i!=b.namespaceId||r&&r!=b.triggerName))),d}_beforeAnimationBuild(t,e,i){const a=e.element,d=e.isRemovalTransition?void 0:t,b=e.isRemovalTransition?void 0:e.triggerName;for(const x of e.timelines){const A=x.element,O=A!==a,B=Qc(i,A,[]);this._getPreviousPlayers(A,O,d,b,e.toState).forEach(te=>{const se=te.getRealPlayer();se.beforeDestroy&&se.beforeDestroy(),te.destroy(),B.push(te)})}T_(a,e.fromStyles)}_buildAnimation(t,e,i,r,a,d){const b=e.triggerName,x=e.element,A=[],O=new Set,B=new Set,X=e.timelines.map(se=>{const me=se.element;O.add(me);const ye=me[Vu];if(ye&&ye.removedBeforeQueried)return new Bx(se.duration,se.delay);const $e=me!==x,ht=function lq(n){const t=[];return dO(n,t),t}((i.get(me)||eq).map(Xn=>Xn.getRealPlayer())).filter(Xn=>!!Xn.element&&Xn.element===me),Qe=a.get(me),At=d.get(me),fn=NL(0,this._normalizer,0,se.keyframes,Qe,At),qn=this._buildPlayer(se,fn,ht);if(se.subTimeline&&r&&B.add(me),$e){const Xn=new zM(t,b,me);Xn.setRealPlayer(qn),A.push(Xn)}return qn});A.forEach(se=>{Qc(this.playersByQueriedElement,se.element,[]).push(se),se.onDone(()=>function rq(n,t,e){let i=n.get(t);if(i){if(i.length){const r=i.indexOf(e);i.splice(r,1)}0==i.length&&n.delete(t)}return i}(this.playersByQueriedElement,se.element,se))}),O.forEach(se=>ju(se,$L));const te=Lm(X);return te.onDestroy(()=>{O.forEach(se=>Zy(se,$L)),Lh(x,e.toStyles)}),B.forEach(se=>{Qc(r,se,[]).push(te)}),te}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new Bx(t.duration,t.delay)}}class zM{constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i,this._player=new Bx,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>bM(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){Qc(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function MT(n){return n&&1===n.nodeType}function lO(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function cO(n,t,e,i,r){const a=[];e.forEach(x=>a.push(lO(x)));const d=[];i.forEach((x,A)=>{const O=new Map;x.forEach(B=>{const X=t.computeStyle(A,B,r);O.set(B,X),(!X||0==X.length)&&(A[Vu]=tq,d.push(A))}),n.set(A,O)});let b=0;return e.forEach(x=>lO(x,a[b++])),d}function uO(n,t){const e=new Map;if(n.forEach(b=>e.set(b,[])),0==t.length)return e;const r=new Set(t),a=new Map;function d(b){if(!b)return 1;let x=a.get(b);if(x)return x;const A=b.parentNode;return x=e.has(A)?A:r.has(A)?1:d(A),a.set(b,x),x}return t.forEach(b=>{const x=d(b);1!==x&&e.get(x).push(b)}),e}function ju(n,t){var e;null===(e=n.classList)||void 0===e||e.add(t)}function Zy(n,t){var e;null===(e=n.classList)||void 0===e||e.remove(t)}function aq(n,t,e){Lm(e).onDone(()=>n.processLeaveNode(t))}function dO(n,t){for(let e=0;e<n.length;e++){const i=n[e];i instanceof OL?dO(i.players,t):t.push(i)}}function hO(n,t,e){const i=e.get(n);if(!i)return!1;let r=t.get(n);return r?i.forEach(a=>r.add(a)):t.set(n,i),e.delete(n),!0}class AT{constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,a)=>{},this._transitionEngine=new iq(t,e,i),this._timelineEngine=new Z8(t,e,i),this._transitionEngine.onRemovalComplete=(r,a)=>this.onRemovalComplete(r,a)}registerTrigger(t,e,i,r,a){const d=t+"-"+r;let b=this._triggerCache[d];if(!b){const x=[],O=MM(this._driver,a,x,[]);if(x.length)throw function WH(n,t){return new qt(3404,!1)}();b=function G8(n,t,e){return new $8(n,t,e)}(r,O,this._normalizer),this._triggerCache[d]=b}this._transitionEngine.registerTrigger(e,r,b)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,r){this._transitionEngine.insertNode(t,e,i,r)}onRemove(t,e,i,r){this._transitionEngine.removeNode(t,e,r||!1,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,r){if("@"==i.charAt(0)){const[a,d]=BL(i);this._timelineEngine.command(a,e,d,r)}else this._transitionEngine.trigger(t,e,i,r)}listen(t,e,i,r,a){if("@"==i.charAt(0)){const[d,b]=BL(i);return this._timelineEngine.listen(d,e,b,a)}return this._transitionEngine.listen(t,e,i,r,a)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let dq=(()=>{class n{constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r,this._state=0;let a=n.initialStylesByElement.get(e);a||n.initialStylesByElement.set(e,a=new Map),this._initialStyles=a}start(){this._state<1&&(this._startStyles&&Lh(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Lh(this._element,this._initialStyles),this._endStyles&&(Lh(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(T_(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(T_(this._element,this._endStyles),this._endStyles=null),Lh(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function VM(n){let t=null;return n.forEach((e,i)=>{(function hq(n){return"display"===n||"position"===n})(i)&&(t=t||new Map,t.set(i,e))}),t}class pO{constructor(t,e,i,r){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){return t.animate(this._convertKeyframesToObject(e),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:KL(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const e="start"===t?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}}class pq{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,e){return!1}containsElement(t,e){return UL(t,e)}getParentElement(t){return wM(t)}query(t,e,i){return HL(t,e,i)}computeStyle(t,e,i){return window.getComputedStyle(t)[e]}animate(t,e,i,r,a,d=[]){const x={duration:i,delay:r,fill:0==r?"both":"forwards"};a&&(x.easing=a);const A=new Map,O=d.filter(te=>te instanceof pO);(function _8(n,t){return 0===n||0===t})(i,r)&&O.forEach(te=>{te.currentSnapshot.forEach((se,me)=>A.set(me,se))});let B=function p8(n){return n.length?n[0]instanceof Map?n:n.map(t=>WL(t)):[]}(e).map(te=>Om(te));B=function b8(n,t,e){if(e.size&&t.length){let i=t[0],r=[];if(e.forEach((a,d)=>{i.has(d)||r.push(d),i.set(d,a)}),r.length)for(let a=1;a<t.length;a++){let d=t[a];r.forEach(b=>d.set(b,KL(n,b)))}}return t}(t,B,A);const X=function uq(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=VM(t[0]),t.length>1&&(i=VM(t[t.length-1]))):t instanceof Map&&(e=VM(t)),e||i?new dq(n,e,i):null}(t,B);return new pO(t,B,x,X)}}let fq=(()=>{class n extends RL{constructor(e,i){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(i.body,{id:"0",encapsulation:oa.None,styles:[],data:{animation:[]}})}build(e){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(e)?kL(e):e;return fO(this._renderer,null,i,"register",[r]),new mq(i,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(Tt(Lp),Tt(Oi))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();class mq extends class CH{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new gq(this._id,t,e||{},this._renderer)}}class gq{constructor(t,e,i,r){this.id=t,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return fO(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function fO(n,t,e,i,r){return n.setProperty(t,`@@${e}:${i}`,r)}const mO="@.disabled";let _q=(()=>{class n{constructor(e,i,r){this.delegate=e,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(a,d)=>{const b=null==d?void 0:d.parentNode(a);b&&d.removeChild(b,a)}}createRenderer(e,i){const a=this.delegate.createRenderer(e,i);if(!(e&&i&&i.data&&i.data.animation)){let O=this._rendererCache.get(a);return O||(O=new gO("",a,this.engine,()=>this._rendererCache.delete(a)),this._rendererCache.set(a,O)),O}const d=i.id,b=i.id+"-"+this._currentId;this._currentId++,this.engine.register(b,e);const x=O=>{Array.isArray(O)?O.forEach(x):this.engine.registerTrigger(d,b,e,O.name,O)};return i.data.animation.forEach(x),new bq(this,b,a,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,i,r){e>=0&&e<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(a=>{const[d,b]=a;d(b)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(Tt(Lp),Tt(AT),Tt(Ui))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();class gO{constructor(t,e,i,r){this.namespaceId=t,this.delegate=e,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?a=>e.destroyNode(a):null}get data(){return this.delegate.data}destroy(){var t;this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),null===(t=this._onDestroy)||void 0===t||t.call(this)}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,r=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,i){this.engine.onRemove(this.namespaceId,e,this.delegate,i)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,r){this.delegate.setAttribute(t,e,i,r)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,r){this.delegate.setStyle(t,e,i,r)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){"@"==e.charAt(0)&&e==mO?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i){return this.delegate.listen(t,e,i)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class bq extends gO{constructor(t,e,i,r,a){super(e,i,r,a),this.factory=t,this.namespaceId=e}setProperty(t,e,i){"@"==e.charAt(0)?"."==e.charAt(1)&&e==mO?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i){if("@"==e.charAt(0)){const r=function yq(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let a=e.slice(1),d="";return"@"!=a.charAt(0)&&([a,d]=function vq(n){const t=n.indexOf(".");return[n.substring(0,t),n.slice(t+1)]}(a)),this.engine.listen(this.namespaceId,r,a,d,b=>{this.factory.scheduleListenerCallback(b._data||-1,i,b)})}return this.delegate.listen(t,e,i)}}let xq=(()=>{class n extends AT{constructor(e,i,r,a){super(e.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi),Tt(SM),Tt(LM),Tt(Wy))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();const _O=[{provide:RL,useClass:fq},{provide:LM,useFactory:function wq(){return new j8}},{provide:AT,useClass:xq},{provide:Lp,useFactory:function Sq(n,t,e){return new _q(n,t,e)},deps:[fT,AT,Ui]}],jM=[{provide:SM,useFactory:()=>new pq},{provide:Ah,useValue:"BrowserAnimations"},..._O],bO=[{provide:SM,useClass:qL},{provide:Ah,useValue:"NoopAnimations"},..._O];let Tq=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?bO:jM}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:jM,imports:[EL]}),n})();function fi(...n){return es(n,cu(n))}function Fm(n,t){return Ue(t)?Ar(n,t,1):Ar(n,1)}function Do(n,t){return Q((e,i)=>{let r=0;e.subscribe(Ce(i,a=>n.call(t,a,r++)&&i.next(a)))})}class yO{}class vO{}class lf{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const r=e.slice(0,i),a=r.toLowerCase(),d=e.slice(i+1).trim();this.maybeSetNormalizedName(r,a),this.headers.has(a)?this.headers.get(a).push(d):this.headers.set(a,[d])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let i=t[e];const r=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof lf?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new lf;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof lf?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":const a=t.value;if(a){let d=this.headers.get(e);if(!d)return;d=d.filter(b=>-1===a.indexOf(b)),0===d.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,d)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class Cq{encodeKey(t){return xO(t)}encodeValue(t){return xO(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const Eq=/%(\d[a-f0-9])/gi,Iq={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function xO(n){return encodeURIComponent(n).replace(Eq,(t,e)=>{var i;return null!==(i=Iq[e])&&void 0!==i?i:t})}function PT(n){return`${n}`}class cf{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new Cq,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Dq(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const a=r.indexOf("="),[d,b]=-1==a?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,a)),t.decodeValue(r.slice(a+1))],x=e.get(d)||[];x.push(b),e.set(d,x)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const i=t.fromObject[e],r=Array.isArray(i)?i.map(PT):[PT(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(i=>{const r=t[i];Array.isArray(r)?r.forEach(a=>{e.push({param:i,value:a,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new cf({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(PT(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const r=i.indexOf(PT(t.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class Mq{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function wO(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function SO(n){return"undefined"!=typeof Blob&&n instanceof Blob}function TO(n){return"undefined"!=typeof FormData&&n instanceof FormData}class Hx{constructor(t,e,i,r){let a;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function Aq(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,a=r):a=i,a&&(this.reportProgress=!!a.reportProgress,this.withCredentials=!!a.withCredentials,a.responseType&&(this.responseType=a.responseType),a.headers&&(this.headers=a.headers),a.context&&(this.context=a.context),a.params&&(this.params=a.params)),this.headers||(this.headers=new lf),this.context||(this.context=new Mq),this.params){const d=this.params.toString();if(0===d.length)this.urlWithParams=e;else{const b=e.indexOf("?");this.urlWithParams=e+(-1===b?"?":b<e.length-1?"&":"")+d}}else this.params=new cf,this.urlWithParams=e}serializeBody(){return null===this.body?null:wO(this.body)||SO(this.body)||TO(this.body)||function Rq(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof cf?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||TO(this.body)?null:SO(this.body)?this.body.type||null:wO(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof cf?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const i=t.method||this.method,r=t.url||this.url,a=t.responseType||this.responseType,d=void 0!==t.body?t.body:this.body,b=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,x=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let A=t.headers||this.headers,O=t.params||this.params;const B=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(A=Object.keys(t.setHeaders).reduce((X,te)=>X.set(te,t.setHeaders[te]),A)),t.setParams&&(O=Object.keys(t.setParams).reduce((X,te)=>X.set(te,t.setParams[te]),O)),new Hx(i,r,d,{params:O,headers:A,context:B,reportProgress:x,responseType:a,withCredentials:b})}}var ha=(()=>((ha=ha||{})[ha.Sent=0]="Sent",ha[ha.UploadProgress=1]="UploadProgress",ha[ha.ResponseHeader=2]="ResponseHeader",ha[ha.DownloadProgress=3]="DownloadProgress",ha[ha.Response=4]="Response",ha[ha.User=5]="User",ha))();class UM{constructor(t,e=200,i="OK"){this.headers=t.headers||new lf,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class HM extends UM{constructor(t={}){super(t),this.type=ha.ResponseHeader}clone(t={}){return new HM({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class kT extends UM{constructor(t={}){super(t),this.type=ha.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new kT({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class CO extends UM{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function qM(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let GM=(()=>{class n{constructor(e){this.handler=e}request(e,i,r={}){let a;if(e instanceof Hx)a=e;else{let x,A;x=r.headers instanceof lf?r.headers:new lf(r.headers),r.params&&(A=r.params instanceof cf?r.params:new cf({fromObject:r.params})),a=new Hx(e,i,void 0!==r.body?r.body:null,{headers:x,context:r.context,params:A,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const d=fi(a).pipe(Fm(x=>this.handler.handle(x)));if(e instanceof Hx||"events"===r.observe)return d;const b=d.pipe(Do(x=>x instanceof kT));switch(r.observe||"body"){case"body":switch(a.responseType){case"arraybuffer":return b.pipe(st(x=>{if(null!==x.body&&!(x.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return x.body}));case"blob":return b.pipe(st(x=>{if(null!==x.body&&!(x.body instanceof Blob))throw new Error("Response is not a Blob.");return x.body}));case"text":return b.pipe(st(x=>{if(null!==x.body&&"string"!=typeof x.body)throw new Error("Response is not a string.");return x.body}));default:return b.pipe(st(x=>x.body))}case"response":return b;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new cf).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,qM(r,i))}post(e,i,r={}){return this.request("POST",e,qM(r,i))}put(e,i,r={}){return this.request("PUT",e,qM(r,i))}}return n.\u0275fac=function(e){return new(e||n)(Tt(yO))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();class DO{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const EO=new en("HTTP_INTERCEPTORS");let Pq=(()=>{class n{intercept(e,i){return i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();const kq=/^\)\]\}',?\n/;let IO=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new yi(i=>{const r=this.xhrFactory.build();if(r.open(e.method,e.urlWithParams),e.withCredentials&&(r.withCredentials=!0),e.headers.forEach((te,se)=>r.setRequestHeader(te,se.join(","))),e.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const te=e.detectContentTypeHeader();null!==te&&r.setRequestHeader("Content-Type",te)}if(e.responseType){const te=e.responseType.toLowerCase();r.responseType="json"!==te?te:"text"}const a=e.serializeBody();let d=null;const b=()=>{if(null!==d)return d;const te=r.statusText||"OK",se=new lf(r.getAllResponseHeaders()),me=function Lq(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||e.url;return d=new HM({headers:se,status:r.status,statusText:te,url:me}),d},x=()=>{let{headers:te,status:se,statusText:me,url:ye}=b(),$e=null;204!==se&&($e=void 0===r.response?r.responseText:r.response),0===se&&(se=$e?200:0);let ht=se>=200&&se<300;if("json"===e.responseType&&"string"==typeof $e){const Qe=$e;$e=$e.replace(kq,"");try{$e=""!==$e?JSON.parse($e):null}catch(At){$e=Qe,ht&&(ht=!1,$e={error:At,text:$e})}}ht?(i.next(new kT({body:$e,headers:te,status:se,statusText:me,url:ye||void 0})),i.complete()):i.error(new CO({error:$e,headers:te,status:se,statusText:me,url:ye||void 0}))},A=te=>{const{url:se}=b(),me=new CO({error:te,status:r.status||0,statusText:r.statusText||"Unknown Error",url:se||void 0});i.error(me)};let O=!1;const B=te=>{O||(i.next(b()),O=!0);let se={type:ha.DownloadProgress,loaded:te.loaded};te.lengthComputable&&(se.total=te.total),"text"===e.responseType&&!!r.responseText&&(se.partialText=r.responseText),i.next(se)},X=te=>{let se={type:ha.UploadProgress,loaded:te.loaded};te.lengthComputable&&(se.total=te.total),i.next(se)};return r.addEventListener("load",x),r.addEventListener("error",A),r.addEventListener("timeout",A),r.addEventListener("abort",A),e.reportProgress&&(r.addEventListener("progress",B),null!==a&&r.upload&&r.upload.addEventListener("progress",X)),r.send(a),i.next({type:ha.Sent}),()=>{r.removeEventListener("error",A),r.removeEventListener("abort",A),r.removeEventListener("load",x),r.removeEventListener("timeout",A),e.reportProgress&&(r.removeEventListener("progress",B),null!==a&&r.upload&&r.upload.removeEventListener("progress",X)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(Tt(aL))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();const $M=new en("XSRF_COOKIE_NAME"),WM=new en("XSRF_HEADER_NAME");class MO{}let Oq=(()=>{class n{constructor(e,i,r){this.doc=e,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Zk(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi),Tt(GS),Tt($M))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),XM=(()=>{class n{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(e);const a=this.tokenService.getToken();return null!==a&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,a)})),i.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Tt(MO),Tt(WM))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),Fq=(()=>{class n{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(EO,[]);this.chain=i.reduceRight((r,a)=>new DO(r,a),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(Tt(vO),Tt(Jo))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),Nq=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:XM,useClass:Pq}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:$M,useValue:e.cookieName}:[],e.headerName?{provide:WM,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[XM,{provide:EO,useExisting:XM,multi:!0},{provide:MO,useClass:Oq},{provide:$M,useValue:"XSRF-TOKEN"},{provide:WM,useValue:"X-XSRF-TOKEN"}]}),n})(),Bq=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[GM,{provide:yO,useClass:Fq},IO,{provide:vO,useExisting:IO}],imports:[Nq.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})();const{isArray:zq}=Array,{getPrototypeOf:Vq,prototype:jq,keys:Uq}=Object;function AO(n){if(1===n.length){const t=n[0];if(zq(t))return{args:t,keys:null};if(function Hq(n){return n&&"object"==typeof n&&Vq(n)===jq}(t)){const e=Uq(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}const{isArray:qq}=Array;function ZM(n){return st(t=>function Gq(n,t){return qq(t)?n(...t):n(t)}(n,t))}function RO(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function PO(...n){const t=Gh(n),{args:e,keys:i}=AO(n),r=new yi(a=>{const{length:d}=e;if(!d)return void a.complete();const b=new Array(d);let x=d,A=d;for(let O=0;O<d;O++){let B=!1;mn(e[O]).subscribe(Ce(a,X=>{B||(B=!0,A--),b[O]=X},()=>x--,void 0,()=>{(!x||!B)&&(A||a.next(i?RO(i,b):b),a.complete())}))}});return t?r.pipe(ZM(t)):r}let kO=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return n.\u0275fac=function(e){return new(e||n)(ue(gc),ue(ci))},n.\u0275dir=cn({type:n}),n})(),D_=(()=>{class n extends kO{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,features:[Un]}),n})();const $l=new en("NgValueAccessor"),Wq={provide:$l,useExisting:Dr(()=>tu),multi:!0},Zq=new en("CompositionEventMode");let tu=(()=>{class n extends kO{constructor(e,i,r){super(e,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Xq(){const n=kh()?kh().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return n.\u0275fac=function(e){return new(e||n)(ue(gc),ue(ci),ue(Zq,8))},n.\u0275dir=cn({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,i){1&e&&Wt("input",function(a){return i._handleInput(a.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(a){return i._compositionEnd(a.target.value)})},features:[Mi([Wq]),Un]}),n})();function Nm(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function OO(n){return null!=n&&"number"==typeof n.length}const Ua=new en("NgValidators"),Bm=new en("NgAsyncValidators"),Jq=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Yy{static min(t){return function FO(n){return t=>{if(Nm(t.value)||Nm(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}(t)}static max(t){return function NO(n){return t=>{if(Nm(t.value)||Nm(n))return null;const e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}(t)}static required(t){return BO(t)}static requiredTrue(t){return zO(t)}static email(t){return function VO(n){return Nm(n.value)||Jq.test(n.value)?null:{email:!0}}(t)}static minLength(t){return function jO(n){return t=>Nm(t.value)||!OO(t.value)?null:t.value.length<n?{minlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function UO(n){return t=>OO(t.value)&&t.value.length>n?{maxlength:{requiredLength:n,actualLength:t.value.length}}:null}(t)}static pattern(t){return function HO(n){if(!n)return LT;let t,e;return"string"==typeof n?(e="","^"!==n.charAt(0)&&(e+="^"),e+=n,"$"!==n.charAt(n.length-1)&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(Nm(i.value))return null;const r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}(t)}static nullValidator(t){return null}static compose(t){return ZO(t)}static composeAsync(t){return YO(t)}}function BO(n){return Nm(n.value)?{required:!0}:null}function zO(n){return!0===n.value?null:{required:!0}}function LT(n){return null}function qO(n){return null!=n}function GO(n){return $p(n)?es(n):n}function $O(n){let t={};return n.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function WO(n,t){return t.map(e=>e(n))}function XO(n){return n.map(t=>function Kq(n){return!n.validate}(t)?t:e=>t.validate(e))}function ZO(n){if(!n)return null;const t=n.filter(qO);return 0==t.length?null:function(e){return $O(WO(e,t))}}function YM(n){return null!=n?ZO(XO(n)):null}function YO(n){if(!n)return null;const t=n.filter(qO);return 0==t.length?null:function(e){return PO(WO(e,t).map(GO)).pipe(st($O))}}function JM(n){return null!=n?YO(XO(n)):null}function JO(n,t){return null===n?[t]:Array.isArray(n)?[...n,t]:[n,t]}function KO(n){return n._rawValidators}function QO(n){return n._rawAsyncValidators}function KM(n){return n?Array.isArray(n)?n:[n]:[]}function OT(n,t){return Array.isArray(n)?n.includes(t):n===t}function eF(n,t){const e=KM(t);return KM(n).forEach(r=>{OT(e,r)||e.push(r)}),e}function tF(n,t){return KM(t).filter(e=>!OT(n,e))}class nF{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=YM(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=JM(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class nu extends nF{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Wl extends nF{get formDirective(){return null}get path(){return null}}class iF{constructor(t){this._cd=t}get isTouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.touched)}get isUntouched(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.untouched)}get isPristine(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pristine)}get isDirty(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.dirty)}get isValid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.valid)}get isInvalid(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.invalid)}get isPending(){var t,e;return!(null===(e=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===e||!e.pending)}get isSubmitted(){var t;return!(null===(t=this._cd)||void 0===t||!t.submitted)}}let Uu=(()=>{class n extends iF{constructor(e){super(e)}}return n.\u0275fac=function(e){return new(e||n)(ue(nu,2))},n.\u0275dir=cn({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,i){2&e&&_("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Un]}),n})(),rF=(()=>{class n extends iF{constructor(e){super(e)}}return n.\u0275fac=function(e){return new(e||n)(ue(Wl,10))},n.\u0275dir=cn({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(e,i){2&e&&_("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[Un]}),n})();const qx="VALID",NT="INVALID",Jy="PENDING",Gx="DISABLED";function nA(n){return(BT(n)?n.validators:n)||null}function sF(n){return Array.isArray(n)?YM(n):n||null}function iA(n,t){return(BT(t)?t.asyncValidators:n)||null}function aF(n){return Array.isArray(n)?JM(n):n||null}function BT(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}function lF(n,t,e){const i=n.controls;if(!(t?Object.keys(i):i).length)throw new qt(1e3,"");if(!i[e])throw new qt(1001,"")}function cF(n,t,e){n._forEachChild((i,r)=>{if(void 0===e[r])throw new qt(1002,"")})}class zT{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=sF(this._rawValidators),this._composedAsyncValidatorFn=aF(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===qx}get invalid(){return this.status===NT}get pending(){return this.status==Jy}get disabled(){return this.status===Gx}get enabled(){return this.status!==Gx}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=sF(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=aF(t)}addValidators(t){this.setValidators(eF(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(eF(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(tF(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(tF(t,this._rawAsyncValidators))}hasValidator(t){return OT(this._rawValidators,t)}hasAsyncValidator(t){return OT(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Jy,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Gx,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=qx,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===qx||this.status===Jy)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Gx:qx}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Jy,this._hasOwnPendingAsyncValidator=!0;const e=GO(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){let e=t;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Cn,this.statusChanges=new Cn}_calculateStatus(){return this._allControlsDisabled()?Gx:this.errors?NT:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Jy)?Jy:this._anyControlsHaveStatus(NT)?NT:qx}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){BT(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}class $x extends zT{constructor(t,e,i){super(nA(e),iA(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){cF(this,0,t),Object.keys(t).forEach(i=>{lF(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(i=>{const r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,a)=>{i=e(i,r,a)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}class uF extends $x{}function VT(n,t){return[...t.path,n]}function Wx(n,t){var e,i;rA(n,t),t.valueAccessor.writeValue(n.value),n.disabled&&(null===(i=(e=t.valueAccessor).setDisabledState)||void 0===i||i.call(e,!0)),function sG(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&dF(n,t)})}(n,t),function lG(n,t){const e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}(n,t),function aG(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&dF(n,t),"submit"!==n.updateOn&&n.markAsTouched()})}(n,t),function oG(n,t){if(t.valueAccessor.setDisabledState){const e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}(n,t)}function jT(n,t,e=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),HT(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function UT(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function rA(n,t){const e=KO(n);null!==t.validator?n.setValidators(JO(e,t.validator)):"function"==typeof e&&n.setValidators([e]);const i=QO(n);null!==t.asyncValidator?n.setAsyncValidators(JO(i,t.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();UT(t._rawValidators,r),UT(t._rawAsyncValidators,r)}function HT(n,t){let e=!1;if(null!==n){if(null!==t.validator){const r=KO(n);if(Array.isArray(r)&&r.length>0){const a=r.filter(d=>d!==t.validator);a.length!==r.length&&(e=!0,n.setValidators(a))}}if(null!==t.asyncValidator){const r=QO(n);if(Array.isArray(r)&&r.length>0){const a=r.filter(d=>d!==t.asyncValidator);a.length!==r.length&&(e=!0,n.setAsyncValidators(a))}}}const i=()=>{};return UT(t._rawValidators,i),UT(t._rawAsyncValidators,i),e}function dF(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function hF(n,t){rA(n,t)}function oA(n,t){if(!n.hasOwnProperty("model"))return!1;const e=n.model;return!!e.isFirstChange()||!Object.is(t,e.currentValue)}function fF(n,t){n._syncPendingControls(),t.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function sA(n,t){if(!t)return null;let e,i,r;return Array.isArray(t),t.forEach(a=>{a.constructor===tu?e=a:function dG(n){return Object.getPrototypeOf(n.constructor)===D_}(a)?i=a:r=a}),r||i||e||null}const pG={provide:Wl,useExisting:Dr(()=>Ky)},Xx=(()=>Promise.resolve())();let Ky=(()=>{class n extends Wl{constructor(e,i){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new Cn,this.form=new $x({},YM(e),JM(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Xx.then(()=>{const i=this._findContainer(e.path);e.control=i.registerControl(e.name,e.control),Wx(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Xx.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Xx.then(()=>{const i=this._findContainer(e.path),r=new $x({});hF(r,e),i.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Xx.then(()=>{const i=this._findContainer(e.path);i&&i.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,i){Xx.then(()=>{this.form.get(e.path).setValue(i)})}setValue(e){this.control.setValue(e)}onSubmit(e){var i;return this.submitted=!0,fF(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return n.\u0275fac=function(e){return new(e||n)(ue(Ua,10),ue(Bm,10))},n.\u0275dir=cn({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,i){1&e&&Wt("submit",function(a){return i.onSubmit(a)})("reset",function(){return i.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Mi([pG]),Un]}),n})();function mF(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}function gF(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const Hu=class extends zT{constructor(t=null,e,i){super(nA(e),iA(i,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),BT(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=gF(t)?t.value:t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){mF(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){mF(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){gF(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},gG={provide:nu,useExisting:Dr(()=>Oh)},yF=(()=>Promise.resolve())();let Oh=(()=>{class n extends nu{constructor(e,i,r,a,d){super(),this._changeDetectorRef=d,this.control=new Hu,this._registered=!1,this.update=new Cn,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=sA(0,a)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),oA(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Wx(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){yF.then(()=>{var i;this.control.setValue(e,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(e){const i=e.isDisabled.currentValue,r=0!==i&&ef(i);yF.then(()=>{var a;r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),null===(a=this._changeDetectorRef)||void 0===a||a.markForCheck()})}_getPath(e){return this._parent?VT(e,this._parent):[e]}}return n.\u0275fac=function(e){return new(e||n)(ue(Wl,9),ue(Ua,10),ue(Bm,10),ue($l,10),ue(So,8))},n.\u0275dir=cn({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Mi([gG]),Un,ho]}),n})(),vF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),n})(),wF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({}),n})();const aA=new en("NgModelWithFormControlWarning"),xG={provide:nu,useExisting:Dr(()=>Qy)};let Qy=(()=>{class n extends nu{constructor(e,i,r,a){super(),this._ngModelWarningConfig=a,this.update=new Cn,this._ngModelWarningSent=!1,this._setValidators(e),this._setAsyncValidators(i),this.valueAccessor=sA(0,r)}set isDisabled(e){}ngOnChanges(e){if(this._isControlChanged(e)){const i=e.form.previousValue;i&&jT(i,this,!1),Wx(this.form,this),this.form.updateValueAndValidity({emitEvent:!1})}oA(e,this.viewModel)&&(this.form.setValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.form&&jT(this.form,this,!1)}get path(){return[]}get control(){return this.form}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_isControlChanged(e){return e.hasOwnProperty("form")}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)(ue(Ua,10),ue(Bm,10),ue($l,10),ue(aA,8))},n.\u0275dir=cn({type:n,selectors:[["","formControl",""]],inputs:{form:["formControl","form"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},exportAs:["ngForm"],features:[Mi([xG]),Un,ho]}),n})();const wG={provide:Wl,useExisting:Dr(()=>E_)};let E_=(()=>{class n extends Wl{constructor(e,i){super(),this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Cn,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(HT(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return Wx(i,e),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){jT(e.control||null,e,!1),function hG(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){var i;return this.submitted=!0,fF(this.form,this.directives),this.ngSubmit.emit(e),"dialog"===(null===(i=null==e?void 0:e.target)||void 0===i?void 0:i.method)}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,r=this.form.get(e.path);i!==r&&(jT(i||null,e),(n=>n instanceof Hu)(r)&&(Wx(r,e),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);hF(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function cG(n,t){return HT(n,t)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){rA(this.form,this),this._oldForm&&HT(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(e){return new(e||n)(ue(Ua,10),ue(Bm,10))},n.\u0275dir=cn({type:n,selectors:[["","formGroup",""]],hostBindings:function(e,i){1&e&&Wt("submit",function(a){return i.onSubmit(a)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Mi([wG]),Un,ho]}),n})();const CG={provide:nu,useExisting:Dr(()=>uA)};let uA=(()=>{class n extends nu{constructor(e,i,r,a,d){super(),this._ngModelWarningConfig=d,this._added=!1,this.update=new Cn,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=sA(0,a)}set isDisabled(e){}ngOnChanges(e){this._added||this._setUpControl(),oA(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return VT(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return n._ngModelWarningSentOnce=!1,n.\u0275fac=function(e){return new(e||n)(ue(Wl,13),ue(Ua,10),ue(Bm,10),ue($l,10),ue(aA,8))},n.\u0275dir=cn({type:n,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Mi([CG]),Un,ho]}),n})();const DG={provide:$l,useExisting:Dr(()=>qT),multi:!0};function DF(n,t){return null==n?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${n}: ${t}`.slice(0,50))}let qT=(()=>{class n extends D_{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const r=DF(this._getOptionId(e),e);this.setProperty("value",r)}registerOnChange(e){this.onChange=i=>{this.value=this._getOptionValue(i),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const i of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(i),e))return i;return null}_getOptionValue(e){const i=function EG(n){return n.split(":")[0]}(e);return this._optionMap.has(i)?this._optionMap.get(i):e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(e,i){1&e&&Wt("change",function(a){return i.onChange(a.target.value)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[Mi([DG]),Un]}),n})(),dA=(()=>{class n{constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(DF(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(gc),ue(qT,9))},n.\u0275dir=cn({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),n})();const IG={provide:$l,useExisting:Dr(()=>hA),multi:!0};function EF(n,t){return null==n?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${n}: ${t}`.slice(0,50))}let hA=(()=>{class n extends D_{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let i;if(this.value=e,Array.isArray(e)){const r=e.map(a=>this._getOptionId(a));i=(a,d)=>{a._setSelected(r.indexOf(d.toString())>-1)}}else i=(r,a)=>{r._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(e){this.onChange=i=>{const r=[],a=i.selectedOptions;if(void 0!==a){const d=a;for(let b=0;b<d.length;b++){const A=this._getOptionValue(d[b].value);r.push(A)}}else{const d=i.options;for(let b=0;b<d.length;b++){const x=d[b];if(x.selected){const A=this._getOptionValue(x.value);r.push(A)}}}this.value=r,e(r)}}_registerOption(e){const i=(this._idCounter++).toString();return this._optionMap.set(i,e),i}_getOptionId(e){for(const i of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(i)._value,e))return i;return null}_getOptionValue(e){const i=function MG(n){return n.split(":")[0]}(e);return this._optionMap.has(i)?this._optionMap.get(i)._value:e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(e,i){1&e&&Wt("change",function(a){return i.onChange(a.target)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[Mi([IG]),Un]}),n})(),pA=(()=>{class n{constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(EF(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(EF(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(gc),ue(hA,9))},n.\u0275dir=cn({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),n})(),I_=(()=>{class n{constructor(){this._validator=LT}ngOnChanges(e){if(this.inputName in e){const i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):LT,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,features:[ho]}),n})();const PG={provide:Ua,useExisting:Dr(()=>fA),multi:!0},kG={provide:Ua,useExisting:Dr(()=>mA),multi:!0};let fA=(()=>{class n extends I_{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=ef,this.createValidator=e=>BO}enabled(e){return e}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(e,i){2&e&&si("required",i._enabled?"":null)},inputs:{required:"required"},features:[Mi([PG]),Un]}),n})(),mA=(()=>{class n extends fA{constructor(){super(...arguments),this.createValidator=e=>zO}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["input","type","checkbox","required","","formControlName",""],["input","type","checkbox","required","","formControl",""],["input","type","checkbox","required","","ngModel",""]],hostVars:1,hostBindings:function(e,i){2&e&&si("required",i._enabled?"":null)},features:[Mi([kG]),Un]}),n})(),FF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[wF]}),n})(),BG=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[FF]}),n})(),NF=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:aA,useValue:e.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[FF]}),n})();class BF extends zT{constructor(t,e,i){super(nA(e),iA(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(t){return this.controls[this._adjustIndex(t)]}push(t,e={}){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(t,e,i={}){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(t,e={}){let i=this._adjustIndex(t);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(t,e,i={}){let r=this._adjustIndex(t);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),e&&(this.controls.splice(r,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){cF(this,0,t),t.forEach((i,r)=>{lF(this,!1,r),this.at(r).setValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(t.forEach((i,r)=>{this.at(r)&&this.at(r).patchValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t=[],e={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(t=>t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_adjustIndex(t){return t<0?t+this.length:t}_syncPendingControls(){let t=this.controls.reduce((e,i)=>!!i._syncPendingControls()||e,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((e,i)=>{t(e,i)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}_find(t){var e;return null!==(e=this.at(t))&&void 0!==e?e:null}}function zF(n){return!!n&&(void 0!==n.asyncValidators||void 0!==n.validators||void 0!==n.updateOn)}let zG=(()=>{class n{constructor(){this.useNonNullable=!1}get nonNullable(){const e=new n;return e.useNonNullable=!0,e}group(e,i=null){const r=this._reduceControls(e);let a={};return zF(i)?a=i:null!==i&&(a.validators=i.validator,a.asyncValidators=i.asyncValidator),new $x(r,a)}record(e,i=null){const r=this._reduceControls(e);return new uF(r,i)}control(e,i,r){let a={};return this.useNonNullable?(zF(i)?a=i:(a.validators=i,a.asyncValidators=r),new Hu(e,Object.assign(Object.assign({},a),{nonNullable:!0}))):new Hu(e,i,r)}array(e,i,r){const a=e.map(d=>this._createControl(d));return new BF(a,i,r)}_reduceControls(e){const i={};return Object.keys(e).forEach(r=>{i[r]=this._createControl(e[r])}),i}_createControl(e){return e instanceof Hu||e instanceof zT?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:NF}),n})();class il extends On{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}const Zx=h(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function M_(...n){const t=cu(n),e=Gh(n),{args:i,keys:r}=AO(n);if(0===i.length)return es([],t);const a=new yi(function VG(n,t,e=vn){return i=>{VF(t,()=>{const{length:r}=n,a=new Array(r);let d=r,b=r;for(let x=0;x<r;x++)VF(t,()=>{const A=es(n[x],t);let O=!1;A.subscribe(Ce(i,B=>{a[x]=B,O||(O=!0,b--),b||i.next(e(a.slice()))},()=>{--d||i.complete()}))},i)},i)}}(i,t,r?d=>RO(r,d):vn));return e?a.pipe(ZM(e)):a}function VF(n,t,e){n?tr(e,n,t):t()}function Yx(...n){return function jG(){return Qo(1)}()(es(n,cu(n)))}function A_(n){return new yi(t=>{mn(n()).subscribe(t)})}function ev(n,t){const e=Ue(n)?n:()=>n,i=r=>r.error(e());return new yi(t?r=>t.schedule(i,0,r):i)}function gA(){return Q((n,t)=>{let e=null;n._refCount++;const i=Ce(t,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(e=null);const r=n._connection,a=e;e=null,r&&(!a||r===a)&&r.unsubscribe(),t.unsubscribe()});n.subscribe(i),i.closed||(e=n.connect())})}class _A extends yi{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,$s(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Se;const e=this.getSubject();t.add(this.source.subscribe(Ce(e,void 0,()=>{this._teardown(),e.complete()},i=>{this._teardown(),e.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Se.EMPTY)}return t}refCount(){return gA()(this)}}function rl(n,t){return Q((e,i)=>{let r=null,a=0,d=!1;const b=()=>d&&!r&&i.complete();e.subscribe(Ce(i,x=>{null==r||r.unsubscribe();let A=0;const O=a++;mn(n(x,O)).subscribe(r=Ce(i,B=>i.next(t?t(x,B,O,A++):B),()=>{r=null,b()}))},()=>{d=!0,b()}))})}function Ho(n){return n<=0?()=>uo:Q((t,e)=>{let i=0;t.subscribe(Ce(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function Ra(...n){const t=cu(n);return Q((e,i)=>{(t?Yx(n,e,t):Yx(n,e)).subscribe(i)})}function GT(n){return Q((t,e)=>{let i=!1;t.subscribe(Ce(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function jF(n=UG){return Q((t,e)=>{let i=!1;t.subscribe(Ce(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function UG(){return new Zx}function zm(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Do((r,a)=>n(r,a,i)):vn,Ho(1),e?GT(t):jF(()=>new Zx))}function qs(n,t,e){const i=Ue(n)||t||e?{next:n,error:t,complete:e}:n;return i?Q((r,a)=>{var d;null===(d=i.subscribe)||void 0===d||d.call(i);let b=!0;r.subscribe(Ce(a,x=>{var A;null===(A=i.next)||void 0===A||A.call(i,x),a.next(x)},()=>{var x;b=!1,null===(x=i.complete)||void 0===x||x.call(i),a.complete()},x=>{var A;b=!1,null===(A=i.error)||void 0===A||A.call(i,x),a.error(x)},()=>{var x,A;b&&(null===(x=i.unsubscribe)||void 0===x||x.call(i)),null===(A=i.finalize)||void 0===A||A.call(i)}))}):vn}function uf(n){return Q((t,e)=>{let a,i=null,r=!1;i=t.subscribe(Ce(e,void 0,void 0,d=>{a=mn(n(d,uf(n)(t))),i?(i.unsubscribe(),i=null,a.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,a.subscribe(e))})}function HG(n,t,e,i,r){return(a,d)=>{let b=e,x=t,A=0;a.subscribe(Ce(d,O=>{const B=A++;x=b?n(x,O,B):(b=!0,O),i&&d.next(x)},r&&(()=>{b&&d.next(x),d.complete()})))}}function UF(n,t){return Q(HG(n,t,arguments.length>=2,!0))}function bA(n){return n<=0?()=>uo:Q((t,e)=>{let i=[];t.subscribe(Ce(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function HF(n,t){const e=arguments.length>=2;return i=>i.pipe(n?Do((r,a)=>n(r,a,i)):vn,bA(1),e?GT(t):jF(()=>new Zx))}function qF(n,t=!1){return Q((e,i)=>{let r=0;e.subscribe(Ce(i,a=>{const d=n(a,r++);(d||t)&&i.next(a),!d&&i.complete()}))})}function Jx(n){return st(()=>n)}function $T(n){return Q((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}const Qr="primary",Kx=Symbol("RouteTitle");class qG{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function tv(n){return new qG(n)}function GG(n,t,e){const i=e.path.split("/");if(i.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||i.length<n.length))return null;const r={};for(let a=0;a<i.length;a++){const d=i[a],b=n[a];if(d.startsWith(":"))r[d.substring(1)]=b;else if(d!==b.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function Fh(n,t){const e=n?Object.keys(n):void 0,i=t?Object.keys(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let a=0;a<e.length;a++)if(r=e[a],!GF(n[r],t[r]))return!1;return!0}function GF(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),i=[...t].sort();return e.every((r,a)=>i[a]===r)}return n===t}function $F(n){return Array.prototype.concat.apply([],n)}function WF(n){return n.length>0?n[n.length-1]:null}function ol(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function Vm(n){return ky(n)?n:$p(n)?es(Promise.resolve(n)):fi(n)}const XG={exact:function YF(n,t,e){if(!P_(n.segments,t.segments)||!WT(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!n.children[i]||!YF(n.children[i],t.children[i],e))return!1;return!0},subset:JF},XF={exact:function ZG(n,t){return Fh(n,t)},subset:function YG(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>GF(n[e],t[e]))},ignored:()=>!0};function ZF(n,t,e){return XG[e.paths](n.root,t.root,e.matrixParams)&&XF[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function JF(n,t,e){return KF(n,t,t.segments,e)}function KF(n,t,e,i){if(n.segments.length>e.length){const r=n.segments.slice(0,e.length);return!(!P_(r,e)||t.hasChildren()||!WT(r,e,i))}if(n.segments.length===e.length){if(!P_(n.segments,e)||!WT(n.segments,e,i))return!1;for(const r in t.children)if(!n.children[r]||!JF(n.children[r],t.children[r],i))return!1;return!0}{const r=e.slice(0,n.segments.length),a=e.slice(n.segments.length);return!!(P_(n.segments,r)&&WT(n.segments,r,i)&&n.children[Qr])&&KF(n.children[Qr],t,a,i)}}function WT(n,t,e){return t.every((i,r)=>XF[e](n[r].parameters,i.parameters))}class R_{constructor(t,e,i){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=tv(this.queryParams)),this._queryParamMap}toString(){return QG.serialize(this)}}class to{constructor(t,e){this.segments=t,this.children=e,this.parent=null,ol(e,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return XT(this)}}class Qx{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=tv(this.parameters)),this._parameterMap}toString(){return nN(this)}}function P_(n,t){return n.length===t.length&&n.every((e,i)=>e.path===t[i].path)}let QF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:function(){return new vA},providedIn:"root"}),n})();class vA{parse(t){const e=new l$(t);return new R_(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${e1(t.root,!0)}`,i=function n$(n){const t=Object.keys(n).map(e=>{const i=n[e];return Array.isArray(i)?i.map(r=>`${ZT(e)}=${ZT(r)}`).join("&"):`${ZT(e)}=${ZT(i)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${e}${i}${"string"==typeof t.fragment?`#${function e$(n){return encodeURI(n)}(t.fragment)}`:""}`}}const QG=new vA;function XT(n){return n.segments.map(t=>nN(t)).join("/")}function e1(n,t){if(!n.hasChildren())return XT(n);if(t){const e=n.children[Qr]?e1(n.children[Qr],!1):"",i=[];return ol(n.children,(r,a)=>{a!==Qr&&i.push(`${a}:${e1(r,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function KG(n,t){let e=[];return ol(n.children,(i,r)=>{r===Qr&&(e=e.concat(t(i,r)))}),ol(n.children,(i,r)=>{r!==Qr&&(e=e.concat(t(i,r)))}),e}(n,(i,r)=>r===Qr?[e1(n.children[Qr],!1)]:[`${r}:${e1(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Qr]?`${XT(n)}/${e[0]}`:`${XT(n)}/(${e.join("//")})`}}function eN(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ZT(n){return eN(n).replace(/%3B/gi,";")}function xA(n){return eN(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function YT(n){return decodeURIComponent(n)}function tN(n){return YT(n.replace(/\+/g,"%20"))}function nN(n){return`${xA(n.path)}${function t$(n){return Object.keys(n).map(t=>`;${xA(t)}=${xA(n[t])}`).join("")}(n.parameters)}`}const i$=/^[^\/()?;=#]+/;function JT(n){const t=n.match(i$);return t?t[0]:""}const r$=/^[^=?&#]+/,s$=/^[^&#]+/;class l${constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new to([],{}):new to([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[Qr]=new to(t,e)),i}parseSegment(){const t=JT(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new qt(4009,!1);return this.capture(t),new Qx(YT(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=JT(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const r=JT(this.remaining);r&&(i=r,this.capture(i))}t[YT(e)]=YT(i)}parseQueryParam(t){const e=function o$(n){const t=n.match(r$);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const d=function a$(n){const t=n.match(s$);return t?t[0]:""}(this.remaining);d&&(i=d,this.capture(i))}const r=tN(e),a=tN(i);if(t.hasOwnProperty(r)){let d=t[r];Array.isArray(d)||(d=[d],t[r]=d),d.push(a)}else t[r]=a}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=JT(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new qt(4010,!1);let a;i.indexOf(":")>-1?(a=i.slice(0,i.indexOf(":")),this.capture(a),this.capture(":")):t&&(a=Qr);const d=this.parseChildren();e[a]=1===Object.keys(d).length?d[Qr]:new to([],d),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new qt(4011,!1)}}function wA(n){return n.segments.length>0?new to([],{[Qr]:n}):n}function KT(n){const t={};for(const i of Object.keys(n.children)){const a=KT(n.children[i]);(a.segments.length>0||a.hasChildren())&&(t[i]=a)}return function c$(n){if(1===n.numberOfChildren&&n.children[Qr]){const t=n.children[Qr];return new to(n.segments.concat(t.segments),t.children)}return n}(new to(n.segments,t))}function k_(n){return n instanceof R_}function h$(n,t,e,i,r){var a;if(0===e.length)return nv(t.root,t.root,t.root,i,r);const b=function oN(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new rN(!0,0,n);let t=0,e=!1;const i=n.reduce((r,a,d)=>{if("object"==typeof a&&null!=a){if(a.outlets){const b={};return ol(a.outlets,(x,A)=>{b[A]="string"==typeof x?x.split("/"):x}),[...r,{outlets:b}]}if(a.segmentPath)return[...r,a.segmentPath]}return"string"!=typeof a?[...r,a]:0===d?(a.split("/").forEach((b,x)=>{0==x&&"."===b||(0==x&&""===b?e=!0:".."===b?t++:""!=b&&r.push(b))}),r):[...r,a]},[]);return new rN(e,t,i)}(e);return b.toRoot()?nv(t.root,t.root,new to([],{}),i,r):function x(O){var B;const X=function f$(n,t,e,i){if(n.isAbsolute)return new iv(t.root,!0,0);if(-1===i)return new iv(e,e===t.root,0);return function sN(n,t,e){let i=n,r=t,a=e;for(;a>r;){if(a-=r,i=i.parent,!i)throw new qt(4005,!1);r=i.segments.length}return new iv(i,!1,r-a)}(e,i+(t1(n.commands[0])?0:1),n.numberOfDoubleDots)}(b,t,null===(B=n.snapshot)||void 0===B?void 0:B._urlSegment,O),te=X.processChildren?r1(X.segmentGroup,X.index,b.commands):TA(X.segmentGroup,X.index,b.commands);return nv(t.root,X.segmentGroup,te,i,r)}(null===(a=n.snapshot)||void 0===a?void 0:a._lastPathIndex)}function t1(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function n1(n){return"object"==typeof n&&null!=n&&n.outlets}function nv(n,t,e,i,r){let d,a={};i&&ol(i,(x,A)=>{a[A]=Array.isArray(x)?x.map(O=>`${O}`):`${x}`}),d=n===t?e:iN(n,t,e);const b=wA(KT(d));return new R_(b,a,r)}function iN(n,t,e){const i={};return ol(n.children,(r,a)=>{i[a]=r===t?e:iN(r,t,e)}),new to(n.segments,i)}class rN{constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&t1(i[0]))throw new qt(4003,!1);const r=i.find(n1);if(r&&r!==WF(i))throw new qt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class iv{constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}}function TA(n,t,e){if(n||(n=new to([],{})),0===n.segments.length&&n.hasChildren())return r1(n,t,e);const i=function g$(n,t,e){let i=0,r=t;const a={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return a;const d=n.segments[r],b=e[i];if(n1(b))break;const x=`${b}`,A=i<e.length-1?e[i+1]:null;if(r>0&&void 0===x)break;if(x&&A&&"object"==typeof A&&void 0===A.outlets){if(!lN(x,A,d))return a;i+=2}else{if(!lN(x,{},d))return a;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const a=new to(n.segments.slice(0,i.pathIndex),{});return a.children[Qr]=new to(n.segments.slice(i.pathIndex),n.children),r1(a,0,r)}return i.match&&0===r.length?new to(n.segments,{}):i.match&&!n.hasChildren()?CA(n,t,e):i.match?r1(n,0,r):CA(n,t,e)}function r1(n,t,e){if(0===e.length)return new to(n.segments,{});{const i=function m$(n){return n1(n[0])?n[0].outlets:{[Qr]:n}}(e),r={};return ol(i,(a,d)=>{"string"==typeof a&&(a=[a]),null!==a&&(r[d]=TA(n.children[d],t,a))}),ol(n.children,(a,d)=>{void 0===i[d]&&(r[d]=a)}),new to(n.segments,r)}}function CA(n,t,e){const i=n.segments.slice(0,t);let r=0;for(;r<e.length;){const a=e[r];if(n1(a)){const x=_$(a.outlets);return new to(i,x)}if(0===r&&t1(e[0])){i.push(new Qx(n.segments[t].path,aN(e[0]))),r++;continue}const d=n1(a)?a.outlets[Qr]:`${a}`,b=r<e.length-1?e[r+1]:null;d&&b&&t1(b)?(i.push(new Qx(d,aN(b))),r+=2):(i.push(new Qx(d,{})),r++)}return new to(i,{})}function _$(n){const t={};return ol(n,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[i]=CA(new to([],{}),0,e))}),t}function aN(n){const t={};return ol(n,(e,i)=>t[i]=`${e}`),t}function lN(n,t,e){return n==e.path&&Fh(t,e.parameters)}class df{constructor(t,e){this.id=t,this.url=e}}class DA extends df{constructor(t,e,i="imperative",r=null){super(t,e),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class L_ extends df{constructor(t,e,i){super(t,e),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class QT extends df{constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class cN extends df{constructor(t,e,i,r){super(t,e),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class b$ extends df{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class y$ extends df{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class v$ extends df{constructor(t,e,i,r,a){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=a,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class x$ extends df{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class w$ extends df{constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class S${constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class T${constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class C${constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class D${constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class E${constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class I${constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class uN{constructor(t,e,i){this.routerEvent=t,this.position=e,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class dN{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=EA(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){const e=EA(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=IA(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return IA(t,this._root).map(e=>e.value)}}function EA(n,t){if(n===t.value)return t;for(const e of t.children){const i=EA(n,e);if(i)return i}return null}function IA(n,t){if(n===t.value)return[t];for(const e of t.children){const i=IA(n,e);if(i.length)return i.unshift(t),i}return[]}class hf{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function rv(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class hN extends dN{constructor(t,e){super(t),this.snapshot=e,MA(this,t)}toString(){return this.snapshot.toString()}}function pN(n,t){const e=function A$(n,t){const d=new eC([],{},{},"",{},Qr,t,null,n.root,-1,{});return new mN("",new hf(d,[]))}(n,t),i=new il([new Qx("",{})]),r=new il({}),a=new il({}),d=new il({}),b=new il(""),x=new O_(i,r,d,b,a,Qr,t,e.root);return x.snapshot=e.root,new hN(new hf(x,[]),e)}class O_{constructor(t,e,i,r,a,d,b,x){var A,O;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=a,this.outlet=d,this.component=b,this.title=null!==(O=null===(A=this.data)||void 0===A?void 0:A.pipe(st(B=>B[Kx])))&&void 0!==O?O:fi(void 0),this._futureSnapshot=x}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(st(t=>tv(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(st(t=>tv(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function fN(n,t="emptyOnly"){const e=n.pathFromRoot;let i=0;if("always"!==t)for(i=e.length-1;i>=1;){const r=e[i],a=e[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(a.component)break;i--}}return function R$(n){return n.reduce((t,e)=>{var i;return{params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign(Object.assign(Object.assign({},e.data),t.resolve),null===(i=e.routeConfig)||void 0===i?void 0:i.data),e._resolvedData)}},{params:{},data:{},resolve:{}})}(e.slice(i))}class eC{constructor(t,e,i,r,a,d,b,x,A,O,B,X){var te;this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=a,this.outlet=d,this.component=b,this.title=null===(te=this.data)||void 0===te?void 0:te[Kx],this.routeConfig=x,this._urlSegment=A,this._lastPathIndex=O,this._correctedLastPathIndex=null!=X?X:O,this._resolve=B}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=tv(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=tv(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class mN extends dN{constructor(t,e){super(e),this.url=t,MA(this,e)}toString(){return gN(this._root)}}function MA(n,t){t.value._routerState=n,t.children.forEach(e=>MA(n,e))}function gN(n){const t=n.children.length>0?` { ${n.children.map(gN).join(", ")} } `:"";return`${n.value}${t}`}function AA(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,Fh(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),Fh(t.params,e.params)||n.params.next(e.params),function $G(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!Fh(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),Fh(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function RA(n,t){const e=Fh(n.params,t.params)&&function JG(n,t){return P_(n,t)&&n.every((e,i)=>Fh(e.parameters,t[i].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||RA(n.parent,t.parent))}function o1(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=t.value;const r=function k$(n,t,e){return t.children.map(i=>{for(const r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return o1(n,i,r);return o1(n,i)})}(n,t,e);return new hf(i,r)}{if(n.shouldAttach(t.value)){const a=n.retrieve(t.value);if(null!==a){const d=a.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(b=>o1(n,b)),d}}const i=function L$(n){return new O_(new il(n.url),new il(n.params),new il(n.queryParams),new il(n.fragment),new il(n.data),n.outlet,n.component,n)}(t.value),r=t.children.map(a=>o1(n,a));return new hf(i,r)}}const PA="ngNavigationCancelingError";function _N(n,t){const{redirectTo:e,navigationBehaviorOptions:i}=k_(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=bN(!1,0,t);return r.url=e,r.navigationBehaviorOptions=i,r}function bN(n,t,e){const i=new Error("NavigationCancelingError: "+(n||""));return i[PA]=!0,i.cancellationCode=t,e&&(i.url=e),i}function yN(n){return vN(n)&&k_(n.url)}function vN(n){return n&&n[PA]}class O${constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new s1,this.attachRef=null}}let s1=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(e,i){const r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){const i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new O$,this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const tC=!1;let kA=(()=>{class n{constructor(e,i,r,a,d){this.parentContexts=e,this.location=i,this.changeDetector=a,this.environmentInjector=d,this.activated=null,this._activatedRoute=null,this.activateEvents=new Cn,this.deactivateEvents=new Cn,this.attachEvents=new Cn,this.detachEvents=new Cn,this.name=r||Qr,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){var e;(null===(e=this.parentContexts.getContext(this.name))||void 0===e?void 0:e.outlet)===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new qt(4012,tC);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new qt(4012,tC);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new qt(4012,tC);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new qt(4013,tC);this._activatedRoute=e;const r=this.location,d=e._futureSnapshot.component,b=this.parentContexts.getOrCreateContext(this.name).children,x=new F$(e,b,r.injector);if(i&&function N$(n){return!!n.resolveComponentFactory}(i)){const A=i.resolveComponentFactory(d);this.activated=r.createComponent(A,r.length,x)}else this.activated=r.createComponent(d,{index:r.length,injector:x,environmentInjector:null!=i?i:this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)(ue(s1),ue(Hs),hs("name"),ue(So),ue(wd))},n.\u0275dir=cn({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),n})();class F${constructor(t,e,i){this.route=t,this.childContexts=e,this.parent=i}get(t,e){return t===O_?this.route:t===s1?this.childContexts:this.parent.get(t,e)}}let LA=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Jt({type:n,selectors:[["ng-component"]],standalone:!0,features:[vP],decls:1,vars:0,template:function(e,i){1&e&&rn(0,"router-outlet")},dependencies:[kA],encapsulation:2}),n})();function xN(n,t){var e;return n.providers&&!n._injector&&(n._injector=zS(n.providers,t,`Route: ${n.path}`)),null!==(e=n._injector)&&void 0!==e?e:t}function FA(n){const t=n.children&&n.children.map(FA),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==Qr&&(e.component=LA),e}function qu(n){return n.outlet||Qr}function wN(n,t){const e=n.filter(i=>qu(i)===t);return e.push(...n.filter(i=>qu(i)!==t)),e}function a1(n){var t;if(!n)return null;if(null!==(t=n.routeConfig)&&void 0!==t&&t._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const i=e.routeConfig;if(null!=i&&i._loadedInjector)return i._loadedInjector;if(null!=i&&i._injector)return i._injector}return null}class U${constructor(t,e,i,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r}activate(t){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),AA(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){const r=rv(e);t.children.forEach(a=>{const d=a.value.outlet;this.deactivateRoutes(a,r[d],i),delete r[d]}),ol(r,(a,d)=>{this.deactivateRouteAndItsChildren(a,i)})}deactivateRoutes(t,e,i){const r=t.value,a=e?e.value:null;if(r===a)if(r.component){const d=i.getContext(r.outlet);d&&this.deactivateChildRoutes(t,e,d.children)}else this.deactivateChildRoutes(t,e,i);else a&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,a=rv(t);for(const d of Object.keys(a))this.deactivateRouteAndItsChildren(a[d],r);if(i&&i.outlet){const d=i.outlet.detach(),b=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:b})}}deactivateRouteAndOutlet(t,e){const i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,a=rv(t);for(const d of Object.keys(a))this.deactivateRouteAndItsChildren(a[d],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(t,e,i){const r=rv(e);t.children.forEach(a=>{this.activateRoutes(a,r[a.value.outlet],i),this.forwardEvent(new I$(a.value.snapshot))}),t.children.length&&this.forwardEvent(new D$(t.value.snapshot))}activateRoutes(t,e,i){var r;const a=t.value,d=e?e.value:null;if(AA(a),a===d)if(a.component){const b=i.getOrCreateContext(a.outlet);this.activateChildRoutes(t,e,b.children)}else this.activateChildRoutes(t,e,i);else if(a.component){const b=i.getOrCreateContext(a.outlet);if(this.routeReuseStrategy.shouldAttach(a.snapshot)){const x=this.routeReuseStrategy.retrieve(a.snapshot);this.routeReuseStrategy.store(a.snapshot,null),b.children.onOutletReAttached(x.contexts),b.attachRef=x.componentRef,b.route=x.route.value,b.outlet&&b.outlet.attach(x.componentRef,x.route.value),AA(x.route.value),this.activateChildRoutes(t,null,b.children)}else{const x=a1(a.snapshot),A=null!==(r=null==x?void 0:x.get(Pp))&&void 0!==r?r:null;b.attachRef=null,b.route=a,b.resolver=A,b.injector=x,b.outlet&&b.outlet.activateWith(a,b.injector),this.activateChildRoutes(t,null,b.children)}}else this.activateChildRoutes(t,null,i)}}class SN{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class nC{constructor(t,e){this.component=t,this.route=e}}function H$(n,t,e){const i=n._root;return l1(i,t?t._root:null,e,[i.value])}function ov(n,t){const e=Symbol(),i=t.get(n,e);return i===e?"function"!=typeof n||function ob(n){return null!==Ns(n)}(n)?t.get(n):n:i}function l1(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const a=rv(t);return n.children.forEach(d=>{(function G$(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const a=n.value,d=t?t.value:null,b=e?e.getContext(n.value.outlet):null;if(d&&a.routeConfig===d.routeConfig){const x=function $$(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!P_(n.url,t.url);case"pathParamsOrQueryParamsChange":return!P_(n.url,t.url)||!Fh(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!RA(n,t)||!Fh(n.queryParams,t.queryParams);default:return!RA(n,t)}}(d,a,a.routeConfig.runGuardsAndResolvers);x?r.canActivateChecks.push(new SN(i)):(a.data=d.data,a._resolvedData=d._resolvedData),l1(n,t,a.component?b?b.children:null:e,i,r),x&&b&&b.outlet&&b.outlet.isActivated&&r.canDeactivateChecks.push(new nC(b.outlet.component,d))}else d&&c1(t,b,r),r.canActivateChecks.push(new SN(i)),l1(n,null,a.component?b?b.children:null:e,i,r)})(d,a[d.value.outlet],e,i.concat([d.value]),r),delete a[d.value.outlet]}),ol(a,(d,b)=>c1(d,e.getContext(b),r)),r}function c1(n,t,e){const i=rv(n),r=n.value;ol(i,(a,d)=>{c1(a,r.component?t?t.children.getContext(d):null:t,e)}),e.canDeactivateChecks.push(new nC(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function u1(n){return"function"==typeof n}function NA(n){return n instanceof Zx||"EmptyError"===(null==n?void 0:n.name)}const iC=Symbol("INITIAL_VALUE");function sv(){return rl(n=>M_(n.map(t=>t.pipe(Ho(1),Ra(iC)))).pipe(st(t=>{for(const e of t)if(!0!==e){if(e===iC)return iC;if(!1===e||e instanceof R_)return e}return!0}),Do(t=>t!==iC),Ho(1)))}function TN(n){return function $n(...n){return Kn(n)}(qs(t=>{if(k_(t))throw _N(0,t)}),st(t=>!0===t))}const BA={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function CN(n,t,e,i,r){const a=zA(n,t,e);return a.matched?function cW(n,t,e,i){const r=t.canMatch;return r&&0!==r.length?fi(r.map(d=>{const b=ov(d,n);return Vm(function K$(n){return n&&u1(n.canMatch)}(b)?b.canMatch(t,e):n.runInContext(()=>b(t,e)))})).pipe(sv(),TN()):fi(!0)}(i=xN(t,i),t,e).pipe(st(d=>!0===d?a:Object.assign({},BA))):fi(a)}function zA(n,t,e){var i;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},BA):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const a=(t.matcher||GG)(e,n,t);if(!a)return Object.assign({},BA);const d={};ol(a.posParams,(x,A)=>{d[A]=x.path});const b=a.consumed.length>0?Object.assign(Object.assign({},d),a.consumed[a.consumed.length-1].parameters):d;return{matched:!0,consumedSegments:a.consumed,remainingSegments:e.slice(a.consumed.length),parameters:b,positionalParamSegments:null!==(i=a.posParams)&&void 0!==i?i:{}}}function rC(n,t,e,i,r="corrected"){if(e.length>0&&function hW(n,t,e){return e.some(i=>oC(n,t,i)&&qu(i)!==Qr)}(n,e,i)){const d=new to(t,function dW(n,t,e,i){const r={};r[Qr]=i,i._sourceSegment=n,i._segmentIndexShift=t.length;for(const a of e)if(""===a.path&&qu(a)!==Qr){const d=new to([],{});d._sourceSegment=n,d._segmentIndexShift=t.length,r[qu(a)]=d}return r}(n,t,i,new to(e,n.children)));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:[]}}if(0===e.length&&function pW(n,t,e){return e.some(i=>oC(n,t,i))}(n,e,i)){const d=new to(n.segments,function uW(n,t,e,i,r,a){const d={};for(const b of i)if(oC(n,e,b)&&!r[qu(b)]){const x=new to([],{});x._sourceSegment=n,x._segmentIndexShift="legacy"===a?n.segments.length:t.length,d[qu(b)]=x}return Object.assign(Object.assign({},r),d)}(n,t,e,i,n.children,r));return d._sourceSegment=n,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:e}}const a=new to(n.segments,n.children);return a._sourceSegment=n,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:e}}function oC(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function DN(n,t,e,i){return!!(qu(n)===i||i!==Qr&&oC(t,e,n))&&("**"===n.path||zA(t,n,e).matched)}function EN(n,t,e){return 0===t.length&&!n.children[e]}const sC=!1;class aC{constructor(t){this.segmentGroup=t||null}}class IN{constructor(t){this.urlTree=t}}function d1(n){return ev(new aC(n))}function MN(n){return ev(new IN(n))}class _W{constructor(t,e,i,r,a){this.injector=t,this.configLoader=e,this.urlSerializer=i,this.urlTree=r,this.config=a,this.allowRedirects=!0}apply(){const t=rC(this.urlTree.root,[],[],this.config).segmentGroup,e=new to(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,e,Qr).pipe(st(a=>this.createUrlTree(KT(a),this.urlTree.queryParams,this.urlTree.fragment))).pipe(uf(a=>{if(a instanceof IN)return this.allowRedirects=!1,this.match(a.urlTree);throw a instanceof aC?this.noMatchError(a):a}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,Qr).pipe(st(r=>this.createUrlTree(KT(r),t.queryParams,t.fragment))).pipe(uf(r=>{throw r instanceof aC?this.noMatchError(r):r}))}noMatchError(t){return new qt(4002,sC)}createUrlTree(t,e,i){const r=wA(t);return new R_(r,e,i)}expandSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(t,e,i).pipe(st(a=>new to([],a))):this.expandSegment(t,i,e,i.segments,r,!0)}expandChildren(t,e,i){const r=[];for(const a of Object.keys(i.children))"primary"===a?r.unshift(a):r.push(a);return es(r).pipe(Fm(a=>{const d=i.children[a],b=wN(e,a);return this.expandSegmentGroup(t,b,d,a).pipe(st(x=>({segment:x,outlet:a})))}),UF((a,d)=>(a[d.outlet]=d.segment,a),{}),HF())}expandSegment(t,e,i,r,a,d){return es(i).pipe(Fm(b=>this.expandSegmentAgainstRoute(t,e,i,b,r,a,d).pipe(uf(A=>{if(A instanceof aC)return fi(null);throw A}))),zm(b=>!!b),uf((b,x)=>{if(NA(b))return EN(e,r,a)?fi(new to([],{})):d1(e);throw b}))}expandSegmentAgainstRoute(t,e,i,r,a,d,b){return DN(r,e,a,d)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,a,d):b&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,i,r,a,d):d1(e):d1(e)}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,a,d){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,r,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,a,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,i,r){const a=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?MN(a):this.lineralizeSegments(i,a).pipe(Ar(d=>{const b=new to(d,{});return this.expandSegment(t,b,e,d,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,i,r,a,d){const{matched:b,consumedSegments:x,remainingSegments:A,positionalParamSegments:O}=zA(e,r,a);if(!b)return d1(e);const B=this.applyRedirectCommands(x,r.redirectTo,O);return r.redirectTo.startsWith("/")?MN(B):this.lineralizeSegments(r,B).pipe(Ar(X=>this.expandSegment(t,e,i,X.concat(A),d,!1)))}matchSegmentAgainstRoute(t,e,i,r,a){return"**"===i.path?(t=xN(i,t),i.loadChildren?(i._loadedRoutes?fi({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(t,i)).pipe(st(b=>(i._loadedRoutes=b.routes,i._loadedInjector=b.injector,new to(r,{})))):fi(new to(r,{}))):CN(e,i,r,t).pipe(rl(({matched:d,consumedSegments:b,remainingSegments:x})=>{var A;return d?(t=null!==(A=i._injector)&&void 0!==A?A:t,this.getChildConfig(t,i,r).pipe(Ar(B=>{var X;const te=null!==(X=B.injector)&&void 0!==X?X:t,se=B.routes,{segmentGroup:me,slicedSegments:ye}=rC(e,b,x,se),$e=new to(me.segments,me.children);if(0===ye.length&&$e.hasChildren())return this.expandChildren(te,se,$e).pipe(st(fn=>new to(b,fn)));if(0===se.length&&0===ye.length)return fi(new to(b,{}));const ht=qu(i)===a;return this.expandSegment(te,$e,se,ye,ht?Qr:a,!0).pipe(st(At=>new to(b.concat(At.segments),At.children)))}))):d1(e)}))}getChildConfig(t,e,i){return e.children?fi({routes:e.children,injector:t}):e.loadChildren?void 0!==e._loadedRoutes?fi({routes:e._loadedRoutes,injector:e._loadedInjector}):function lW(n,t,e,i){const r=t.canLoad;return void 0===r||0===r.length?fi(!0):fi(r.map(d=>{const b=ov(d,n);return Vm(function X$(n){return n&&u1(n.canLoad)}(b)?b.canLoad(t,e):n.runInContext(()=>b(t,e)))})).pipe(sv(),TN())}(t,e,i).pipe(Ar(r=>r?this.configLoader.loadChildren(t,e).pipe(qs(a=>{e._loadedRoutes=a.routes,e._loadedInjector=a.injector})):function mW(n){return ev(bN(sC,3))}())):fi({routes:[],injector:t})}lineralizeSegments(t,e){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return fi(i);if(r.numberOfChildren>1||!r.children[Qr])return ev(new qt(4e3,sC));r=r.children[Qr]}}applyRedirectCommands(t,e,i){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,i)}applyRedirectCreateUrlTree(t,e,i,r){const a=this.createSegmentGroup(t,e.root,i,r);return new R_(a,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const i={};return ol(t,(r,a)=>{if("string"==typeof r&&r.startsWith(":")){const b=r.substring(1);i[a]=e[b]}else i[a]=r}),i}createSegmentGroup(t,e,i,r){const a=this.createSegments(t,e.segments,i,r);let d={};return ol(e.children,(b,x)=>{d[x]=this.createSegmentGroup(t,b,i,r)}),new to(a,d)}createSegments(t,e,i,r){return e.map(a=>a.path.startsWith(":")?this.findPosParam(t,a,r):this.findOrReturn(a,i))}findPosParam(t,e,i){const r=i[e.path.substring(1)];if(!r)throw new qt(4001,sC);return r}findOrReturn(t,e){let i=0;for(const r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}}class yW{}class wW{constructor(t,e,i,r,a,d,b,x){this.injector=t,this.rootComponentType=e,this.config=i,this.urlTree=r,this.url=a,this.paramsInheritanceStrategy=d,this.relativeLinkResolution=b,this.urlSerializer=x}recognize(){const t=rC(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,Qr).pipe(st(e=>{if(null===e)return null;const i=new eC([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Qr,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new hf(i,e),a=new mN(this.url,r);return this.inheritParamsAndData(a._root),a}))}inheritParamsAndData(t){const e=t.value,i=fN(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),t.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(t,e,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,e,i):this.processSegment(t,e,i,i.segments,r)}processChildren(t,e,i){return es(Object.keys(i.children)).pipe(Fm(r=>{const a=i.children[r],d=wN(e,r);return this.processSegmentGroup(t,d,a,r)}),UF((r,a)=>r&&a?(r.push(...a),r):null),qF(r=>null!==r),GT(null),HF(),st(r=>{if(null===r)return null;const a=AN(r);return function SW(n){n.sort((t,e)=>t.value.outlet===Qr?-1:e.value.outlet===Qr?1:t.value.outlet.localeCompare(e.value.outlet))}(a),a}))}processSegment(t,e,i,r,a){return es(e).pipe(Fm(d=>{var b;return this.processSegmentAgainstRoute(null!==(b=d._injector)&&void 0!==b?b:t,d,i,r,a)}),zm(d=>!!d),uf(d=>{if(NA(d))return EN(i,r,a)?fi([]):fi(null);throw d}))}processSegmentAgainstRoute(t,e,i,r,a){var d,b;if(e.redirectTo||!DN(e,i,r,a))return fi(null);let x;if("**"===e.path){const A=r.length>0?WF(r).parameters:{},O=PN(i)+r.length;x=fi({snapshot:new eC(r,A,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,LN(e),qu(e),null!==(b=null!==(d=e.component)&&void 0!==d?d:e._loadedComponent)&&void 0!==b?b:null,e,RN(i),O,ON(e),O),consumedSegments:[],remainingSegments:[]})}else x=CN(i,e,r,t).pipe(st(({matched:A,consumedSegments:O,remainingSegments:B,parameters:X})=>{var te,se;if(!A)return null;const me=PN(i)+O.length;return{snapshot:new eC(O,X,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,LN(e),qu(e),null!==(se=null!==(te=e.component)&&void 0!==te?te:e._loadedComponent)&&void 0!==se?se:null,e,RN(i),me,ON(e),me),consumedSegments:O,remainingSegments:B}}));return x.pipe(rl(A=>{var O,B;if(null===A)return fi(null);const{snapshot:X,consumedSegments:te,remainingSegments:se}=A;t=null!==(O=e._injector)&&void 0!==O?O:t;const me=null!==(B=e._loadedInjector)&&void 0!==B?B:t,ye=function TW(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(e),{segmentGroup:$e,slicedSegments:ht}=rC(i,te,se,ye.filter(At=>void 0===At.redirectTo),this.relativeLinkResolution);if(0===ht.length&&$e.hasChildren())return this.processChildren(me,ye,$e).pipe(st(At=>null===At?null:[new hf(X,At)]));if(0===ye.length&&0===ht.length)return fi([new hf(X,[])]);const Qe=qu(e)===a;return this.processSegment(me,ye,$e,ht,Qe?Qr:a).pipe(st(At=>null===At?null:[new hf(X,At)]))}))}}function CW(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function AN(n){const t=[],e=new Set;for(const i of n){if(!CW(i)){t.push(i);continue}const r=t.find(a=>i.value.routeConfig===a.value.routeConfig);void 0!==r?(r.children.push(...i.children),e.add(r)):t.push(i)}for(const i of e){const r=AN(i.children);t.push(new hf(i.value,r))}return t.filter(i=>!e.has(i))}function RN(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function PN(n){var t,e;let i=n,r=null!==(t=i._segmentIndexShift)&&void 0!==t?t:0;for(;i._sourceSegment;)i=i._sourceSegment,r+=null!==(e=i._segmentIndexShift)&&void 0!==e?e:0;return r-1}function LN(n){return n.data||{}}function ON(n){return n.resolve||{}}function FN(n){return"string"==typeof n.title||null===n.title}function VA(n){return rl(t=>{const e=n(t);return e?es(e).pipe(st(()=>t)):fi(t)})}let NN=(()=>{class n{buildTitle(e){var i;let r,a=e.root;for(;void 0!==a;)r=null!==(i=this.getResolvedTitleForRoute(a))&&void 0!==i?i:r,a=a.children.find(d=>d.outlet===Qr);return r}getResolvedTitleForRoute(e){return e.data[Kx]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:function(){return $o(BN)},providedIn:"root"}),n})(),BN=(()=>{class n extends NN{constructor(e){super(),this.title=e}updateTitle(e){const i=this.buildTitle(e);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(e){return new(e||n)(Tt(hM))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class kW{}class OW extends class LW{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const cC=new en("",{providedIn:"root",factory:()=>({})}),jA=new en("ROUTES");let UA=(()=>{class n{constructor(e,i){this.injector=e,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return fi(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const i=Vm(e.loadComponent()).pipe(qs(a=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=a}),$T(()=>{this.componentLoaders.delete(e)})),r=new _A(i,()=>new On).pipe(gA());return this.componentLoaders.set(e,r),r}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return fi({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const a=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(st(b=>{this.onLoadEndListener&&this.onLoadEndListener(i);let x,A,O=!1;Array.isArray(b)?A=b:(x=b.create(e).injector,A=$F(x.get(jA,[],Ei.Self|Ei.Optional)));return{routes:A.map(FA),injector:x}}),$T(()=>{this.childrenLoaders.delete(i)})),d=new _A(a,()=>new On).pipe(gA());return this.childrenLoaders.set(i,d),d}loadModuleFactoryOrRoutes(e){return Vm(e()).pipe(Ar(i=>i instanceof bP||Array.isArray(i)?fi(i):es(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(e){return new(e||n)(Tt(Jo),Tt(kI))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class NW{}class BW{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function zW(n){throw n}function VW(n,t,e){return t.parse("/")}const jW={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},UW={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function VN(){var n,t;const e=$o(QF),i=$o(s1),r=$o(JS),a=$o(Jo),d=$o(kI),b=null!==(n=$o(jA,{optional:!0}))&&void 0!==n?n:[],x=null!==(t=$o(cC,{optional:!0}))&&void 0!==t?t:{},A=$o(BN),O=$o(NN,{optional:!0}),B=$o(NW,{optional:!0}),X=$o(kW,{optional:!0}),te=new pa(null,e,i,r,a,d,$F(b));return B&&(te.urlHandlingStrategy=B),X&&(te.routeReuseStrategy=X),te.titleStrategy=null!=O?O:A,function HW(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(t.canceledNavigationResolution=n.canceledNavigationResolution)}(x,te),te}let pa=(()=>{class n{constructor(e,i,r,a,d,b,x){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=r,this.location=a,this.config=x,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new On,this.errorHandler=zW,this.malformedUriErrorHandler=VW,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>fi(void 0),this.urlHandlingStrategy=new BW,this.routeReuseStrategy=new OW,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=d.get(UA),this.configLoader.onLoadEndListener=X=>this.triggerEvent(new T$(X)),this.configLoader.onLoadStartListener=X=>this.triggerEvent(new S$(X)),this.ngModule=d.get(y_),this.console=d.get(b5);const B=d.get(Ui);this.isNgZoneEnabled=B instanceof Ui&&Ui.isInAngularZone(),this.resetConfig(x),this.currentUrlTree=function WG(){return new R_(new to([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=pN(this.currentUrlTree,this.rootComponentType),this.transitions=new il({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(Do(r=>0!==r.id),st(r=>Object.assign(Object.assign({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),rl(r=>{let a=!1,d=!1;return fi(r).pipe(qs(b=>{this.currentNavigation={id:b.id,initialUrl:b.rawUrl,extractedUrl:b.extractedUrl,trigger:b.source,extras:b.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),rl(b=>{const x=this.browserUrlTree.toString(),A=!this.navigated||b.extractedUrl.toString()!==x||x!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||A)&&this.urlHandlingStrategy.shouldProcessUrl(b.rawUrl))return jN(b.source)&&(this.browserUrlTree=b.extractedUrl),fi(b).pipe(rl(B=>{const X=this.transitions.getValue();return i.next(new DA(B.id,this.serializeUrl(B.extractedUrl),B.source,B.restoredState)),X!==this.transitions.getValue()?uo:Promise.resolve(B)}),function bW(n,t,e,i){return rl(r=>function gW(n,t,e,i,r){return new _W(n,t,e,i,r).apply()}(n,t,e,r.extractedUrl,i).pipe(st(a=>Object.assign(Object.assign({},r),{urlAfterRedirects:a}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),qs(B=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:B.urlAfterRedirects}),r.urlAfterRedirects=B.urlAfterRedirects}),function EW(n,t,e,i,r,a){return Ar(d=>function xW(n,t,e,i,r,a,d="emptyOnly",b="legacy"){return new wW(n,t,e,i,r,d,b,a).recognize().pipe(rl(x=>null===x?function vW(n){return new yi(t=>t.error(n))}(new yW):fi(x)))}(n,t,e,d.urlAfterRedirects,i.serialize(d.urlAfterRedirects),i,r,a).pipe(st(b=>Object.assign(Object.assign({},d),{targetSnapshot:b}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),qs(B=>{if(r.targetSnapshot=B.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!B.extras.skipLocationChange){const te=this.urlHandlingStrategy.merge(B.urlAfterRedirects,B.rawUrl);this.setBrowserUrl(te,B)}this.browserUrlTree=B.urlAfterRedirects}const X=new b$(B.id,this.serializeUrl(B.extractedUrl),this.serializeUrl(B.urlAfterRedirects),B.targetSnapshot);i.next(X)}));if(A&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:X,extractedUrl:te,source:se,restoredState:me,extras:ye}=b,$e=new DA(X,this.serializeUrl(te),se,me);i.next($e);const ht=pN(te,this.rootComponentType).snapshot;return fi(r=Object.assign(Object.assign({},b),{targetSnapshot:ht,urlAfterRedirects:te,extras:Object.assign(Object.assign({},ye),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=b.rawUrl,b.resolve(null),uo}),qs(b=>{const x=new y$(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot);this.triggerEvent(x)}),st(b=>r=Object.assign(Object.assign({},b),{guards:H$(b.targetSnapshot,b.currentSnapshot,this.rootContexts)})),function eW(n,t){return Ar(e=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:a,canDeactivateChecks:d}}=e;return 0===d.length&&0===a.length?fi(Object.assign(Object.assign({},e),{guardsResult:!0})):function tW(n,t,e,i){return es(n).pipe(Ar(r=>function aW(n,t,e,i,r){const a=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return a&&0!==a.length?fi(a.map(b=>{var x;const A=null!==(x=a1(t))&&void 0!==x?x:r,O=ov(b,A);return Vm(function J$(n){return n&&u1(n.canDeactivate)}(O)?O.canDeactivate(n,t,e,i):A.runInContext(()=>O(n,t,e,i))).pipe(zm())})).pipe(sv()):fi(!0)}(r.component,r.route,e,t,i)),zm(r=>!0!==r,!0))}(d,i,r,n).pipe(Ar(b=>b&&function W$(n){return"boolean"==typeof n}(b)?function nW(n,t,e,i){return es(t).pipe(Fm(r=>Yx(function rW(n,t){return null!==n&&t&&t(new C$(n)),fi(!0)}(r.route.parent,i),function iW(n,t){return null!==n&&t&&t(new E$(n)),fi(!0)}(r.route,i),function sW(n,t,e){const i=t[t.length-1],a=t.slice(0,t.length-1).reverse().map(d=>function q$(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(d)).filter(d=>null!==d).map(d=>A_(()=>fi(d.guards.map(x=>{var A;const O=null!==(A=a1(d.node))&&void 0!==A?A:e,B=ov(x,O);return Vm(function Y$(n){return n&&u1(n.canActivateChild)}(B)?B.canActivateChild(i,n):O.runInContext(()=>B(i,n))).pipe(zm())})).pipe(sv())));return fi(a).pipe(sv())}(n,r.path,e),function oW(n,t,e){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return fi(!0);const r=i.map(a=>A_(()=>{var d;const b=null!==(d=a1(t))&&void 0!==d?d:e,x=ov(a,b);return Vm(function Z$(n){return n&&u1(n.canActivate)}(x)?x.canActivate(t,n):b.runInContext(()=>x(t,n))).pipe(zm())}));return fi(r).pipe(sv())}(n,r.route,e))),zm(r=>!0!==r,!0))}(i,a,n,t):fi(b)),st(b=>Object.assign(Object.assign({},e),{guardsResult:b})))})}(this.ngModule.injector,b=>this.triggerEvent(b)),qs(b=>{if(r.guardsResult=b.guardsResult,k_(b.guardsResult))throw _N(0,b.guardsResult);const x=new v$(b.id,this.serializeUrl(b.extractedUrl),this.serializeUrl(b.urlAfterRedirects),b.targetSnapshot,!!b.guardsResult);this.triggerEvent(x)}),Do(b=>!!b.guardsResult||(this.restoreHistory(b),this.cancelNavigationTransition(b,"",3),!1)),VA(b=>{if(b.guards.canActivateChecks.length)return fi(b).pipe(qs(x=>{const A=new x$(x.id,this.serializeUrl(x.extractedUrl),this.serializeUrl(x.urlAfterRedirects),x.targetSnapshot);this.triggerEvent(A)}),rl(x=>{let A=!1;return fi(x).pipe(function IW(n,t){return Ar(e=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=e;if(!r.length)return fi(e);let a=0;return es(r).pipe(Fm(d=>function MW(n,t,e,i){const r=n.routeConfig,a=n._resolve;return void 0!==(null==r?void 0:r.title)&&!FN(r)&&(a[Kx]=r.title),function AW(n,t,e,i){const r=function RW(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return fi({});const a={};return es(r).pipe(Ar(d=>function PW(n,t,e,i){var r;const a=null!==(r=a1(t))&&void 0!==r?r:i,d=ov(n,a);return Vm(d.resolve?d.resolve(t,e):a.runInContext(()=>d(t,e)))}(n[d],t,e,i).pipe(zm(),qs(b=>{a[d]=b}))),bA(1),Jx(a),uf(d=>NA(d)?uo:ev(d)))}(a,n,t,i).pipe(st(d=>(n._resolvedData=d,n.data=fN(n,e).resolve,r&&FN(r)&&(n.data[Kx]=r.title),null)))}(d.route,i,n,t)),qs(()=>a++),bA(1),Ar(d=>a===r.length?fi(e):uo))})}(this.paramsInheritanceStrategy,this.ngModule.injector),qs({next:()=>A=!0,complete:()=>{A||(this.restoreHistory(x),this.cancelNavigationTransition(x,"",2))}}))}),qs(x=>{const A=new w$(x.id,this.serializeUrl(x.extractedUrl),this.serializeUrl(x.urlAfterRedirects),x.targetSnapshot);this.triggerEvent(A)}))}),VA(b=>{const x=A=>{var O;const B=[];(null===(O=A.routeConfig)||void 0===O?void 0:O.loadComponent)&&!A.routeConfig._loadedComponent&&B.push(this.configLoader.loadComponent(A.routeConfig).pipe(qs(X=>{A.component=X}),st(()=>{})));for(const X of A.children)B.push(...x(X));return B};return M_(x(b.targetSnapshot.root)).pipe(GT(),Ho(1))}),VA(()=>this.afterPreactivation()),st(b=>{const x=function P$(n,t,e){const i=o1(n,t._root,e?e._root:void 0);return new hN(i,t)}(this.routeReuseStrategy,b.targetSnapshot,b.currentRouterState);return r=Object.assign(Object.assign({},b),{targetRouterState:x})}),qs(b=>{this.currentUrlTree=b.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(b.urlAfterRedirects,b.rawUrl),this.routerState=b.targetRouterState,"deferred"===this.urlUpdateStrategy&&(b.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,b),this.browserUrlTree=b.urlAfterRedirects)}),((n,t,e)=>st(i=>(new U$(t,i.targetRouterState,i.currentRouterState,e).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,b=>this.triggerEvent(b)),qs({next(){a=!0},complete(){a=!0}}),$T(()=>{var b;a||d||this.cancelNavigationTransition(r,"",1),(null===(b=this.currentNavigation)||void 0===b?void 0:b.id)===r.id&&(this.currentNavigation=null)}),uf(b=>{var x;if(d=!0,vN(b)){yN(b)||(this.navigated=!0,this.restoreHistory(r,!0));const A=new QT(r.id,this.serializeUrl(r.extractedUrl),b.message,b.cancellationCode);if(i.next(A),yN(b)){const O=this.urlHandlingStrategy.merge(b.url,this.rawUrlTree),B={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||jN(r.source)};this.scheduleNavigation(O,"imperative",null,B,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{this.restoreHistory(r,!0);const A=new cN(r.id,this.serializeUrl(r.extractedUrl),b,null!==(x=r.targetSnapshot)&&void 0!==x?x:void 0);i.next(A);try{r.resolve(this.errorHandler(b))}catch(O){r.reject(O)}}return uo}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i="popstate"===e.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var r;const a={replaceUrl:!0},d=null!==(r=e.state)&&void 0!==r&&r.navigationId?e.state:null;if(d){const x=Object.assign({},d);delete x.navigationId,delete x.\u0275routerPageId,0!==Object.keys(x).length&&(a.state=x)}const b=this.parseUrl(e.url);this.scheduleNavigation(b,i,d,a)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){this.config=e.map(FA),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:r,queryParams:a,fragment:d,queryParamsHandling:b,preserveFragment:x}=i,A=r||this.routerState.root,O=x?this.currentUrlTree.fragment:d;let B=null;switch(b){case"merge":B=Object.assign(Object.assign({},this.currentUrlTree.queryParams),a);break;case"preserve":B=this.currentUrlTree.queryParams;break;default:B=a||null}return null!==B&&(B=this.removeEmptyProps(B)),h$(A,this.currentUrlTree,e,B,null!=O?O:null)}navigateByUrl(e,i={skipLocationChange:!1}){const r=k_(e)?e:this.parseUrl(e),a=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(a,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function qW(n){for(let t=0;t<n.length;t++){if(null==n[t])throw new qt(4008,false)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,e)}return i}isActive(e,i){let r;if(r=!0===i?Object.assign({},jW):!1===i?Object.assign({},UW):i,k_(e))return ZF(this.currentUrlTree,e,r);const a=this.parseUrl(e);return ZF(this.currentUrlTree,a,r)}removeEmptyProps(e){return Object.keys(e).reduce((i,r)=>{const a=e[r];return null!=a&&(i[r]=a),i},{})}processNavigations(){this.navigations.subscribe(e=>{var i;this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new L_(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,null===(i=this.titleStrategy)||void 0===i||i.updateTitle(this.routerState.snapshot),e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,r,a,d){var b,x;if(this.disposed)return Promise.resolve(!1);let A,O,B;d?(A=d.resolve,O=d.reject,B=d.promise):B=new Promise((se,me)=>{A=se,O=me});const X=++this.navigationId;let te;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),te=r&&r.\u0275routerPageId?r.\u0275routerPageId:a.replaceUrl||a.skipLocationChange?null!==(b=this.browserPageId)&&void 0!==b?b:0:(null!==(x=this.browserPageId)&&void 0!==x?x:0)+1):te=0,this.setTransition({id:X,targetPageId:te,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:a,resolve:A,reject:O,promise:B,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),B.catch(se=>Promise.reject(se))}setBrowserUrl(e,i){const r=this.urlSerializer.serialize(e),a=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",a):this.location.go(r,"",a)}restoreHistory(e,i=!1){var r,a;if("computed"===this.canceledNavigationResolution){const d=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)||0===d?this.currentUrlTree===(null===(a=this.currentNavigation)||void 0===a?void 0:a.finalUrl)&&0===d&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(d)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i,r){const a=new QT(e.id,this.serializeUrl(e.extractedUrl),i,r);this.triggerEvent(a),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return n.\u0275fac=function(e){bm()},n.\u0275prov=wn({token:n,factory:function(){return VN()},providedIn:"root"}),n})();function jN(n){return"imperative"!==n}let F_=(()=>{class n{constructor(e,i,r){this.router=e,this.route=i,this.locationStrategy=r,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.href=null,this.onChanges=new On,this.subscription=e.events.subscribe(a=>{a instanceof L_&&this.updateTargetUrlAndHref()})}set preserveFragment(e){this._preserveFragment=ef(e)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(e){this._skipLocationChange=ef(e)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(e){this._replaceUrl=ef(e)}get replaceUrl(){return this._replaceUrl}set routerLink(e){this.commands=null!=e?Array.isArray(e)?e:[e]:null}ngOnChanges(e){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(e,i,r,a,d){return!!(0!==e||i||r||a||d||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!1)}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return n.\u0275fac=function(e){return new(e||n)(ue(pa),ue(O_),ue(w_))},n.\u0275dir=cn({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(e,i){1&e&&Wt("click",function(a){return i.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),2&e&&si("target",i.target)("href",i.href,zo)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[ho]}),n})();class UN{}let WW=(()=>{class n{constructor(e,i,r,a,d){this.router=e,this.injector=r,this.preloadingStrategy=a,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(Do(e=>e instanceof L_),Fm(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){var r,a,d;const b=[];for(const x of i){x.providers&&!x._injector&&(x._injector=zS(x.providers,e,`Route: ${x.path}`));const A=null!==(r=x._injector)&&void 0!==r?r:e,O=null!==(a=x._loadedInjector)&&void 0!==a?a:A;x.loadChildren&&!x._loadedRoutes&&void 0===x.canLoad||x.loadComponent&&!x._loadedComponent?b.push(this.preloadConfig(A,x)):(x.children||x._loadedRoutes)&&b.push(this.processRoutes(O,null!==(d=x.children)&&void 0!==d?d:x._loadedRoutes))}return es(b).pipe(Qo())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(e,i):fi(null);const a=r.pipe(Ar(d=>{var b;return null===d?fi(void 0):(i._loadedRoutes=d.routes,i._loadedInjector=d.injector,this.processRoutes(null!==(b=d.injector)&&void 0!==b?b:e,d.routes))}));return i.loadComponent&&!i._loadedComponent?es([a,this.loader.loadComponent(i)]).pipe(Qo()):a})}}return n.\u0275fac=function(e){return new(e||n)(Tt(pa),Tt(kI),Tt(wd),Tt(UN),Tt(UA))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const qA=new en("");let HN=(()=>{class n{constructor(e,i,r={}){this.router=e,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof DA?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof L_&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof uN&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new uN(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){bm()},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();function av(n,t){return{\u0275kind:n,\u0275providers:t}}function GA(n){return[{provide:jA,multi:!0,useValue:n}]}function GN(){const n=$o(Jo);return t=>{var e,i;const r=n.get(Wy);if(t!==r.components[0])return;const a=n.get(pa),d=n.get($N);1===n.get($A)&&a.initialNavigation(),null===(e=n.get(WN,null,Ei.Optional))||void 0===e||e.setUpPreloading(),null===(i=n.get(qA,null,Ei.Optional))||void 0===i||i.init(),a.resetRootComponentType(r.componentTypes[0]),d.closed||(d.next(),d.unsubscribe())}}const $N=new en("",{factory:()=>new On}),$A=new en("",{providedIn:"root",factory:()=>1});const WN=new en("");function JW(n){return av(0,[{provide:WN,useExisting:WW},{provide:UN,useExisting:n}])}const XN=new en("ROUTER_FORROOT_GUARD"),KW=[JS,{provide:QF,useClass:vA},{provide:pa,useFactory:VN},s1,{provide:O_,useFactory:function qN(n){return n.routerState.root},deps:[pa]},UA];function QW(){return new fk("Router",pa)}let pC=(()=>{class n{constructor(e){}static forRoot(e,i){return{ngModule:n,providers:[KW,[],GA(e),{provide:XN,useFactory:i7,deps:[[pa,new g,new S]]},{provide:cC,useValue:i||{}},null!=i&&i.useHash?{provide:w_,useClass:sj}:{provide:w_,useClass:zk},{provide:qA,useFactory:()=>{const n=$o(pa),t=$o(yU),e=$o(cC);return e.scrollOffset&&t.setOffset(e.scrollOffset),new HN(n,t,e)}},null!=i&&i.preloadingStrategy?JW(i.preloadingStrategy).\u0275providers:[],{provide:fk,multi:!0,useFactory:QW},null!=i&&i.initialNavigation?r7(i):[],[{provide:ZN,useFactory:GN},{provide:ak,multi:!0,useExisting:ZN}]]}}static forChild(e){return{ngModule:n,providers:[GA(e)]}}}return n.\u0275fac=function(e){return new(e||n)(Tt(XN,8))},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[LA]}),n})();function i7(n){return"guarded"}function r7(n){return["disabled"===n.initialNavigation?av(3,[{provide:HS,multi:!0,useFactory:()=>{const t=$o(pa);return()=>{t.setUpLocationChangeListener()}}},{provide:$A,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?av(2,[{provide:$A,useValue:0},{provide:HS,multi:!0,deps:[Jo],useFactory:t=>{const e=t.get(rj,Promise.resolve());let i=!1;return()=>e.then(()=>new Promise(a=>{const d=t.get(pa),b=t.get($N);(function r(a){t.get(pa).events.pipe(Do(b=>b instanceof L_||b instanceof QT||b instanceof cN),st(b=>b instanceof L_||b instanceof QT&&(0===b.code||1===b.code)&&null),Do(b=>null!==b),Ho(1)).subscribe(()=>{a()})})(()=>{a(!0),i=!0}),d.afterPreactivation=()=>(a(!0),i||b.closed?fi(void 0):b),d.initialNavigation()}))}}]).\u0275providers:[]]}const ZN=new en(""),Sc="undefined"==typeof window||void 0===window.document||window.location.hostname.includes("github.io")?"PROD":"DEBUG",Mo=(()=>{const t=new URLSearchParams(document.location.search).get("v");if("1"===t)return"1.0";if("2"===t||document.location.hostname.includes("github.io"))return"2.0";const i=document.location.pathname;return i.startsWith("/ojp-demo-v2")?"2.0":i.startsWith("/beta-ojp-demo")?"1.0":"2.0"})(),YN="2.0"===Mo,fC=YN?"V2-PROD":"PROD",WA=(()=>{let n=[];return YN?n=["V2-PROD","V2-INT","V2-TEST"]:(n=["PROD","INT","TEST","LA Beta"],"DEBUG"===Sc&&n.push("OJP-SI")),n})(),Ps="OJP_DemoApp_Beta_OJP"+Mo,lv={stops:{LIR_Restriction_Type:"stop",minZoom:13,layer_ids:["stops-circle","stops-label"],click_layer_ids:"SAME_AS_LAYER_IDS"},addresses:{LIR_Restriction_Type:"address",minZoom:17,layer_ids:["address-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},topographic_places:{LIR_Restriction_Type:"topographicPlace",minZoom:12,layer_ids:["topographic-place-circle"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_cars:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["car_sharing"]},minZoom:12,layer_ids:["car-rental-icon","car-rental-text-number","car-rental-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_bicycles:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["bicycle_rental"]},minZoom:14,layer_ids:["bike-icon","bike-text-number","bike-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sharing_scooters:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["escooter_rental"]},minZoom:14,layer_ids:["scooter-icon","scooter-text-number","scooter-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},charging_stations:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["charging_station"]},minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},sbb_services:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["sbb_services"]},minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},pois_other:{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"shared_mobility",tags:["other"]},minZoom:12,layer_ids:["charging-station-icon","charging-station-text-number","charging-station-text-provider"],click_layer_ids:"SAME_AS_LAYER_IDS"},"pois-ALL":{LIR_Restriction_Type:"poi",LIR_POI_Type:{poiType:"poi",tags:["service","shopping","leisure","catering","public","parkride","accommodation"]},minZoom:16,layer_ids:["poi-all"],click_layer_ids:"SAME_AS_LAYER_IDS"}},XA=[{id:"raster-swisstopo-imagery",caption:"Aerial",tileURLs:["https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.swissimage/default/current/3857/{z}/{x}/{y}.jpeg"],minZoom:0,maxZoom:19,rasterOpacity:1,beforeLayerId:"road-label"},{id:"raster-swisstopo-pixelkarte",caption:"Swisstopo",tileURLs:["https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe/default/current/3857/{z}/{x}/{y}.jpeg"],rasterOpacity:.5,minZoom:0,maxZoom:19},{id:"raster-osm",caption:"OSM",tileURLs:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],rasterOpacity:.9,minZoom:0,maxZoom:19}];let p1=(()=>{class n{constructor(e){this.title=e,this.baseTitle=(()=>{const i=["OJP Demo"];return"DEBUG"===Sc&&i.push("BETA"),i.push("OJP "+Mo),i.join(" - ")})(),this.title.setTitle(this.baseTitle),this.bgMainClassName="undefined"==typeof window||void 0===window.document||window.location.hostname.includes("github.io")?"ojpv2-prod":"2.0"===Mo?"ojpv2-beta":"ojpv1-beta"}setTitle(e,i=this.baseTitle){this.title.setTitle(e+" | "+i)}getTitle(){return this.title.getTitle()}}return n.\u0275fac=function(e){return new(e||n)(Tt(hM))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function JN(n,t,e,i,r,a,d){try{var b=n[a](d),x=b.value}catch(A){return void e(A)}b.done?t(x):Promise.resolve(x).then(i,r)}function mr(n){return function(){var t=this,e=arguments;return new Promise(function(i,r){var a=n.apply(t,e);function d(x){JN(a,i,r,d,b,"next",x)}function b(x){JN(a,i,r,d,b,"throw",x)}d(void 0)})}}var s7=pt(9898),sl=pt.n(s7);const pf="undefined"==typeof window||void 0===window.document||window.location.hostname.includes("github.io")?"PROD":"DEBUG",a7="0.18.8",KN="undefined"!=typeof process&&process.versions&&process.versions.node,l7={ojpVersion:"1.0",defaultNS:"siri",mapNS:{ojp:"http://www.vdv.de/ojp",siri:"http://www.siri.org.uk/siri"}},QN={ojpVersion:"1.0",defaultNS:"ojp",mapNS:{ojp:"http://www.vdv.de/ojp",siri:"http://www.siri.org.uk/siri"}},e3={ojpVersion:"2.0",defaultNS:"ojp",mapNS:{ojp:"http://www.vdv.de/ojp",siri:"http://www.siri.org.uk/siri"}};class ZA{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t){return ZA.formatDate(t).substring(11,16)}static formatDistance(t){return t>1e3?(t/1e3).toFixed(1)+"km":t+"m"}}class c7{static prettyPrintXML(t){var e=(new DOMParser).parseFromString(t,"application/xml"),i=(new DOMParser).parseFromString(['<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">','  <xsl:strip-space elements="*"/>','  <xsl:template match="para[content-style][not(text())]">','    <xsl:value-of select="normalize-space(.)"/>',"  </xsl:template>",'  <xsl:template match="node()|@*">','    <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',"  </xsl:template>",'  <xsl:output indent="yes"/>',"</xsl:stylesheet>"].join("\n"),"application/xml");try{var r=new XSLTProcessor;r.importStylesheet(i);var a=r.transformToDocument(e);return(new XMLSerializer).serializeToString(a)}catch(b){return console.error("XML_Helpers.prettyPrintXML - fails, see TODO"),t}}}class mC{constructor(t,e,i,r){this.ptMode=t,this.subMode=e,this.name=i,this.shortName=r,this.isDemandMode=!1}static initWithServiceTreeNode(t){var e,i;const r=t.findChildNamed("Mode");if(null===r)return null;const a=r.findTextFromChildNamed("PtMode");if(null===a)return null;let d=null;const b=null!==(e=r.children.find(X=>X.name.toLowerCase().endsWith("submode")))&&void 0!==e?e:null;null!==b&&(d={key:b.name.replace("siri:",""),value:null!==(i=b.text)&&void 0!==i?i:"subMode text n/a"});const x=t.findTextFromChildNamed("Mode/Name/Text"),A=t.findTextFromChildNamed("Mode/ShortName/Text"),O=new mC(a,d,x,A),B=t.findTextFromChildNamed("Mode/siri:BusSubmode");return O.isDemandMode="demandAndResponseBus"===B||"unknown"===B,O}isRail(){return"rail"===this.ptMode}hasPrecisePolyline(){return!!this.isDemandMode||-1===["bus","tram"].indexOf(this.ptMode)}addToXMLNode(t,e){const i="ojp"===e.defaultNS?"":"ojp:",r="siri"===e.defaultNS?"":"siri:",a=t.ele(i+"Mode");a.ele(i+"PtMode",this.ptMode),this.subMode&&a.ele(r+this.subMode.key,this.subMode.value),this.name&&a.ele(i+"Name").ele(i+"Text",this.name),this.shortName&&a.ele(i+"ShortName").ele(i+"Text",this.shortName)}}class ff{constructor(t,e,i,r="StopPlace"){this.stopPlaceRef=t,this.stopPlaceName=e,this.topographicPlaceRef=i,this.stopType=r}static initWithLocationTreeNode(t){let e="StopPlace",i=t.findTextFromChildNamed("StopPlace/StopPlaceRef"),r=t.findTextFromChildNamed("StopPlace/StopPlaceName/Text"),a=t.findTextFromChildNamed("StopPlace/TopographicPlaceRef");return null===i&&(e="StopPoint",i=t.findTextFromChildNamed("StopPoint/siri:StopPointRef"),r=t.findTextFromChildNamed("StopPoint/StopPointName/Text"),a=t.findTextFromChildNamed("StopPoint/TopographicPlaceRef")),null===i&&(e="StopPoint",i=t.findTextFromChildNamed("siri:StopPointRef")),null===i?null:new ff(i,r,a,e)}static initWithServiceTreeNode(t,e){const i=t.findTextFromChildNamed(e+"StopPointRef"),r=t.findTextFromChildNamed(e+"Text/Text");return i&&r?new ff(i,r,null,"StopPlace"):null}}class f1{constructor(t,e,i,r){this.journeyRef=t,this.operatingDayRef=e,this.lineRef=null,this.directionRef=null,this.ptMode=i,this.operatorRef=r,this.originStopPlace=null,this.destinationStopPlace=null,this.productCategory=null,this.serviceLineNumber=null,this.journeyNumber=null,this.siriSituationIds=[],this.siriSituations=[],this.serviceAttributes={},this.hasCancellation=null,this.hasDeviation=null,this.isUnplanned=null}static initWithTreeNode(t,e){var i,r,a;const d="2.0"===e.ojpVersion,b=t.findChildNamed("Service");if(null===b)return null;const x=b.findTextFromChildNamed("JourneyRef"),A=mC.initWithServiceTreeNode(b),O=(()=>{let At=b.findTextFromChildNamed(d?"siri:OperatorRef":"OperatorRef");return null===At?"n/a OperatorRef":(At=At.replace("ojp:",""),At)})(),B=b.findTextFromChildNamed("OperatingDayRef");if(!(x&&A&&B))return null;const X=new f1(x,B,A,O);X.lineRef=b.findTextFromChildNamed("siri:LineRef"),X.directionRef=b.findTextFromChildNamed("siri:DirectionRef"),X.originStopPlace=ff.initWithServiceTreeNode(b,"Origin"),X.destinationStopPlace=ff.initWithServiceTreeNode(b,"Destination");const te=b.findChildNamed("ProductCategory");te&&(X.productCategory={name:null!==(i=te.findTextFromChildNamed("Name/Text"))&&void 0!==i?i:"n/a Name",shortName:null!==(r=te.findTextFromChildNamed("ShortName/Text"))&&void 0!==r?r:"n/a ShortName",productCategoryRef:null!==(a=te.findTextFromChildNamed("ProductCategoryRef"))&&void 0!==a?a:"n/a ProductCategoryRef"}),X.serviceLineNumber=b.findTextFromChildNamed((d?"PublishedServiceName":"PublishedLineName")+"/Text"),X.journeyNumber=d?b.findTextFromChildNamed("TrainNumber"):t.findTextFromChildNamed("Extension/PublishedJourneyNumber/Text"),X.siriSituationIds=[];const me=d?b.findChildNamed("SituationFullRefs"):b;me&&me.findChildrenNamed("SituationFullRef").forEach(At=>{const fn=At.findTextFromChildNamed("siri:SituationNumber");fn&&X.siriSituationIds.push(fn)}),X.serviceAttributes={},b.findChildrenNamed("Attribute").forEach(Qe=>{const At=Qe.findTextFromChildNamed("Code");if(null===At)return console.error("ERROR - cant find code for Attribute"),void console.log(Qe);const qn=Qe.findTextFromChildNamed(d?"UserText/Text":"Text/Text");if(null===qn)return console.error("ERROR - cant find code/text for Attribute"),void console.log(Qe);const Xn={code:At,text:qn,extra:{}};Qe.children.forEach(Ri=>{if(Ri.name.startsWith("siri:")){const Yi=Ri.name.split("siri:");if(2!==Yi.length)return;const ar=Ri.text;if(null===ar)return;Xn.extra[Yi[1]]=ar}}),X.serviceAttributes[At]=Xn});const ye=b.findChildNamed("Cancelled");ye&&(X.hasCancellation="true"===ye.text);const $e=b.findChildNamed("Deviation");$e&&(X.hasDeviation="true"===$e.text);const ht=b.findChildNamed("Unplanned");return ht&&(X.isUnplanned="true"===ht.text),X}formatServiceName(){var t,e,i,r;if(this.ptMode.isDemandMode)return null!==(t=this.serviceLineNumber)&&void 0!==t?t:"OnDemand";const a=[];return this.serviceLineNumber?(this.ptMode.isRail()||a.push(null!==(e=this.ptMode.shortName)&&void 0!==e?e:this.ptMode.ptMode),a.push(this.serviceLineNumber),a.push(null!==(i=this.journeyNumber)&&void 0!==i?i:"")):a.push(null!==(r=this.ptMode.shortName)&&void 0!==r?r:this.ptMode.ptMode),a.push("("+this.operatorRef+")"),a.join(" ")}addToXMLNode(t,e){const i="ojp"===e.defaultNS?"":"ojp:",r="siri"===e.defaultNS?"":"siri:",a="2.0"===e.ojpVersion,d=t.ele(i+"Service");if(d.ele(i+"JourneyRef",this.journeyRef),d.ele(i+"OperatingDayRef",this.operatingDayRef),this.lineRef&&d.ele(r+"LineRef",this.lineRef),this.directionRef&&d.ele(r+"DirectionRef",this.directionRef),this.ptMode.addToXMLNode(d,e),this.productCategory){const x=d.ele(i+"ProductCategory");x.ele("Name").ele("Text",this.productCategory.name),x.ele("ShortName").ele("Text",this.productCategory.shortName),x.ele("ProductCategoryRef",this.productCategory.productCategoryRef)}this.serviceLineNumber&&d.ele(i+(a?"PublishedServiceName":"PublishedLineName")).ele(i+"Text",this.serviceLineNumber),this.journeyNumber&&d.ele(i+"TrainNumber",this.journeyNumber);for(const x in this.serviceAttributes){const A=this.serviceAttributes[x],O=d.ele(i+"Attribute");O.ele(i+"UserText").ele(i+"Text",A.text),O.ele(i+"Code",A.code)}const b=(()=>"2.0"===e.ojpVersion||this.operatorRef.startsWith("ojp:")?this.operatorRef:"ojp:"+this.operatorRef)();d.ele(i+"OperatorRef",b)}}class cs{constructor(t,e){this.longitude=parseFloat(t.toFixed(6)),this.latitude=parseFloat(e.toFixed(6)),this.properties=null}static initWithStringCoords(t,e){if(null===t||null===e)return null;const i=parseFloat(t),r=parseFloat(e);return 0===i||0===r?null:new cs(i,r)}static initWithLocationTreeNode(t){const e=t.findTextFromChildNamed("GeoPosition/siri:Longitude"),i=t.findTextFromChildNamed("GeoPosition/siri:Latitude");return cs.initWithStringCoords(e,i)}static initWithFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates,a=new cs(e[0],e[1]);return a.properties=t.properties,a}asLngLat(){return[this.longitude,this.latitude]}asLatLngString(t=!0){let e="";return e=t?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,e}asPosition(){return[this.longitude,this.latitude]}distanceFrom(t){const i=(t.latitude-this.latitude)*Math.PI/180,r=(t.longitude-this.longitude)*Math.PI/180,a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),d=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return Math.round(6371*d*1e3)}}class gC{constructor(t){this.addressCode=t,this.addressName=null,this.topographicPlaceRef=null,this.topographicPlaceName=null,this.street=null,this.houseNumber=null,this.postCode=null}static initWithLocationTreeNode(t,e){const i="2.0"===e.ojpVersion,r=t.findChildNamed("Address");if(null===r)return null;const d=r.findTextFromChildNamed(i?"PublicCode":"AddressCode");if(null===d)return null;const b=new gC(d);return b.addressName=r.findTextFromChildNamed(i?"Name/Text":"AddressName/Text"),b.topographicPlaceRef=r.findTextFromChildNamed("TopographicPlaceRef"),b.topographicPlaceName=r.findTextFromChildNamed("TopographicPlaceName"),b.street=r.findTextFromChildNamed("Street"),b.houseNumber=r.findTextFromChildNamed("HouseNumber"),b.postCode=r.findTextFromChildNamed("PostCode"),b}}const YA={service:["atm","hairdresser"],shopping:["all","clothes","optician"],catering:["all"],accommodation:["all"]};class JA{constructor(t,e,i,r,a){this.code=t,this.name=e,this.category=i,this.subCategory=r,this.categoryTags=a}static initWithLocationTreeNode(t){const e=t.findChildNamed("PointOfInterest");if(null===e)return null;const i=e.findTextFromChildNamed("PointOfInterestCode"),r=e.findTextFromChildNamed("PointOfInterestName/Text");if(!i||!r)return null;const a=[];let d=null,b=null;return e.findChildrenNamed("PointOfInterestCategory").forEach(O=>{const B=O.findTextFromChildNamed("OsmTag/Value");B&&a.push(B);const X=O.findTextFromChildNamed("OsmTag/Tag");("POI_0"===X||"amenity"===X)&&(d=B),"POI_1"===X&&(b=B)}),null===d&&(console.error("PointOfInterest.initWithLocationTreeNode error - no category"),d="none"),new JA(i,r,d,b,a)}computePoiMapIcon(){const t="poi-unknown";return this.category in YA?this.subCategory&&YA[this.category].indexOf(this.subCategory)>-1?"poi-"+this.category+"-"+this.subCategory:YA[this.category].indexOf("all")>-1?"poi-"+this.category+"-all":t:t}}class KA{constructor(t,e){this.code=t,this.name=e}static initWithLocationTreeNode(t){const e=t.findTextFromChildNamed("TopographicPlace/TopographicPlaceCode"),i=t.findTextFromChildNamed("TopographicPlace/TopographicPlaceName/Text");return e&&i?new KA(e,i):null}}const u7=/^([0-9\.]+?),([0-9\.]+?)$/;class fa{constructor(){this.address=null,this.locationName=null,this.stopPlace=null,this.geoPosition=null,this.poi=null,this.topographicPlace=null,this.attributes={},this.probability=null,this.originSystem=null}static initWithTreeNode(t,e){const i=new fa;return i.address=gC.initWithLocationTreeNode(t,e),i.geoPosition=cs.initWithLocationTreeNode(t),i.locationName=t.findTextFromChildNamed("2.0"===e.ojpVersion?"Name/Text":"LocationName/Text"),i.poi=JA.initWithLocationTreeNode(t),i.stopPlace=ff.initWithLocationTreeNode(t),i.topographicPlace=KA.initWithLocationTreeNode(t),i.attributes=fa.computeAttributes(t),i}static initWithLocationResultTreeNode(t,e){const r=t.findChildNamed("2.0"===e.ojpVersion?"Place":"Location");if(null===r)return null;const a=fa.initWithTreeNode(r,e),d=t.findTextFromChildNamed("Probability");return d&&(a.probability=parseFloat(d)),a.originSystem=t.findTextFromChildNamed("OriginSystem"),a}static initWithStopPlaceRef(t,e=""){const i=new fa;return i.stopPlace=new ff(t,e,null),i}static initWithLngLat(t,e){const i=new fa;return i.geoPosition=new cs(t,e),i}static computeAttributes(t){const e={},i=t.findChildNamed("Attribute");i&&i.children.forEach(a=>{const d=a.name.split(":"),b=1===d.length?d[0]:d[1],x=a.computeText();null!==x&&(e[b]=x)});const r=t.findChildNamed("Extension/LocationExtensionStructure");return r&&r.children.forEach(a=>{e[a.name]=a.text}),e}static initWithFeature(t){var e,i,r,a;const d=cs.initWithFeature(t);if(null===d)return null;const b=t.properties;if(null===b)return null;const x=new fa;x.geoPosition=d,x.locationName=null!==(e=b.locationName)&&void 0!==e?e:null;const A=b["stopPlace.stopPlaceRef"];if(A){const B=null!==(i=b["stopPlace.stopPlaceName"])&&void 0!==i?i:null;x.stopPlace=new ff(A,B,null)}const O=b.addressCode;if(O){const B=new gC(O);B.addressName=null!==(r=b.addressName)&&void 0!==r?r:null,B.topographicPlaceRef=null!==(a=b.topographicPlaceRef)&&void 0!==a?a:null}return x}static initFromLiteralCoords(t){let e=t.trim();e=e.replace(/\(.+?\)/g,""),e=e.replace(/[^0-9\.,]/g,"");const i=e.match(u7);if(null===i)return null;let r=parseFloat(i[1]),a=parseFloat(i[2]);r>a&&(r=parseFloat(i[2]),a=parseFloat(i[1]));const d=fa.initWithLngLat(r,a),b=t.trim().match(/\(([^\)]*)\)?/);return null!==b&&(d.locationName=b[1]),d}asGeoJSONFeature(){var t,e,i,r,a,d,b,x,A,O,B,X,te,se,me;if(null===this.geoPosition)return null;const ye={};(null!==(e=null===(t=this.stopPlace)||void 0===t?void 0:t.stopPlaceRef)&&void 0!==e?e:null)&&(ye["stopPlace.stopPlaceRef"]=null!==(r=null===(i=this.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"",ye["stopPlace.stopPlaceName"]=null!==(d=null===(a=this.stopPlace)||void 0===a?void 0:a.stopPlaceName)&&void 0!==d?d:"",ye["stopPlace.topographicPlaceRef"]=null!==(x=null===(b=this.stopPlace)||void 0===b?void 0:b.topographicPlaceRef)&&void 0!==x?x:""),this.address&&(ye.addressCode=null!==(O=null===(A=this.address)||void 0===A?void 0:A.addressCode)&&void 0!==O?O:"",ye.addressName=null!==(X=null===(B=this.address)||void 0===B?void 0:B.addressName)&&void 0!==X?X:"",ye.topographicPlaceRef=null!==(se=null===(te=this.address)||void 0===te?void 0:te.topographicPlaceRef)&&void 0!==se?se:""),this.poi&&(ye["poi.name"]=this.poi.name,ye["poi.code"]=this.poi.code,ye["poi.category"]=this.poi.category,ye["poi.subcategory"]=this.poi.subCategory,ye["poi.osm.tags"]=this.poi.categoryTags.join(",")),ye.locationName=null!==(me=this.locationName)&&void 0!==me?me:"";for(let Qe in this.attributes)ye["OJP.Attr."+Qe]=this.attributes[Qe];return{type:"Feature",properties:ye,geometry:{type:"Point",coordinates:[this.geoPosition.longitude,this.geoPosition.latitude]}}}computeLocationName(t=!0){var e,i;return null!==(e=this.stopPlace)&&void 0!==e&&e.stopPlaceName?this.stopPlace.stopPlaceName:null!==(i=this.topographicPlace)&&void 0!==i&&i.name?this.topographicPlace.name:this.poi&&this.poi.name?this.poi.name:this.locationName?this.locationName:t&&this.geoPosition?this.geoPosition.asLatLngString():null}findClosestLocation(t){const e=this.geoPosition;if(null===e)return null;let i=null;return t.forEach(r=>{const a=r.geoPosition;if(null===a)return;const d=e.distanceFrom(a);(null===i||d<i.distance)&&(i={location:r,distance:d})}),i}getLocationType(){return this.stopPlace?"stop":this.poi?"poi":this.address?"address":this.topographicPlace?"topographicPlace":null}patchWithAnotherLocation(t){this.locationName=t.locationName,this.stopPlace=t.stopPlace,this.geoPosition=t.geoPosition}}class m1{constructor(t){Array.isArray(t)||(t=[t]),this.minLongitude=Math.min.apply(null,t.map(r=>r.longitude)),this.minLatitude=Math.min.apply(null,t.map(r=>r.latitude)),this.maxLongitude=Math.max.apply(null,t.map(r=>r.longitude)),this.maxLatitude=Math.max.apply(null,t.map(r=>r.latitude)),this.southWest=new cs(this.minLongitude,this.minLatitude),this.northEast=new cs(this.maxLongitude,this.maxLatitude),this.center=new cs((this.southWest.longitude+this.northEast.longitude)/2,(this.southWest.latitude+this.northEast.latitude)/2)}static initFromGeoPosition(t,e,i){const r=.1*e/7612,a=.1*i/11119,d=new cs(t.longitude-r/2,t.latitude-a/2),b=new cs(t.longitude+r/2,t.latitude+a/2);return new m1([d,b])}static initFromGeoJSONFeatures(t){const e=new m1([]);return t.forEach(i=>{var r;const a=null!==(r=i.bbox)&&void 0!==r?r:null;if(a){const d=new cs(a[0],a[1]);e.extend(d);const b=new cs(a[2],a[3]);e.extend(b)}else"LineString"===i.geometry.type&&i.geometry.coordinates.forEach(b=>{const x=new cs(b[0],b[1]);e.extend(x)})}),e}extend(t){Array.isArray(t)||(t=[t]),t.forEach(r=>{const a=Math.min(this.southWest.longitude,r.longitude),d=Math.min(this.southWest.latitude,r.latitude),b=Math.max(this.northEast.longitude,r.longitude),x=Math.max(this.northEast.latitude,r.latitude);this.southWest=new cs(a,d),this.northEast=new cs(b,x)}),this.center=new cs((this.southWest.longitude+this.northEast.longitude)/2,(this.southWest.latitude+this.northEast.latitude)/2),this.minLongitude=this.southWest.longitude,this.minLatitude=this.southWest.latitude,this.maxLongitude=this.northEast.longitude,this.maxLatitude=this.northEast.latitude}asFeatureBBOX(){return[this.southWest.longitude,this.southWest.latitude,this.northEast.longitude,this.northEast.latitude]}isValid(){return this.southWest.longitude!==1/0}containsGeoPosition(t){return!(t.longitude<this.southWest.longitude||t.latitude<this.southWest.latitude||t.longitude>this.northEast.longitude||t.latitude>this.northEast.latitude)}computeWidth(){const t=new cs(this.southWest.longitude,this.northEast.latitude);return(new cs(this.northEast.longitude,this.southWest.latitude).distanceFrom(this.southWest)+this.northEast.distanceFrom(t))/2}computeHeight(){const t=new cs(this.southWest.longitude,this.northEast.latitude);return(new cs(this.northEast.longitude,this.southWest.latitude).distanceFrom(this.northEast)+this.southWest.distanceFrom(t))/2}asPolygon(){const t=this.southWest,e=new cs(this.southWest.longitude,this.northEast.latitude),i=this.northEast,r=new cs(this.northEast.longitude,this.southWest.latitude);return{type:"Polygon",coordinates:[[t.asPosition(),e.asPosition(),i.asPosition(),r.asPosition(),t.asPosition()]]}}}class Gu{constructor(t,e){this.hours=t,this.minutes=e,this.totalMinutes=60*t+e}static initWithTreeNode(t,e="Duration"){const i=t.findTextFromChildNamed(e);return null===i?null:Gu.initFromDurationText(i)}static initFromDurationText(t){if(null===t)return null;let e=0;const i=(t=t.replace("PT","")).match(/([0-9]+?)H/);i&&(e=parseInt(i[1]));let r=0;const a=t.match(/([0-9]+?)M/);return a&&(r=parseInt(a[1])),new Gu(e,r)}static initFromTotalMinutes(t){const e=Math.floor(t/60);return new Gu(e,t-60*e)}formatDuration(){const t=[];return this.hours>0&&t.push(this.hours+"h "),t.push(this.minutes+"min"),t.join("")}plus(t){return Gu.initFromTotalMinutes(this.totalMinutes+t.totalMinutes)}asOJPFormattedText(){const t=[];return t.push("PT"),this.hours>0&&t.push(this.hours+"H"),t.push(this.minutes+"M"),t.join("")}}class QA{constructor(t){this.sourceType=t,this.countryRef=null,this.name=null,this.externalCode=null}static initWithSituationTreeNode(t){const e=t.findTextFromChildNamed("siri:Source/siri:SourceType");if(null===e)return console.log("ERROR - cant PtSituationSource.initFromSituationNode"),console.log(t),null;const i=new QA(e);return i.countryRef=t.findTextFromChildNamed("siri:Source/siri:CountryRef"),i.name=t.findTextFromChildNamed("siri:Source/siri:Name"),i.externalCode=t.findTextFromChildNamed("siri:Source/siri:ExternalCode"),i}}class iu{constructor(t,e,i,r,a,d,b,x,A,O,B,X,te){this.situationNumber=t,this.creationTime=e,this.countryRef=i,this.participantRef=r,this.version=a,this.source=d,this.progress=b,this.validityPeriods=x,this.alertCause=A,this.priority=O,this.scopeType=B,this.publishingActions=X,this.isPlanned=te,this.situationContent=null,this.treeNode=null}static initWithSituationTreeNode(t){var e,i,r,a;const d=t.findTextFromChildNamed("siri:SituationNumber"),b=t.findTextFromChildNamed("siri:CreationTime");if(null===b)return console.error("ERROR - creationTimeS is null","PtSituationElement.initFromSituationNode"),console.log(t),null;const x=new Date(b),A=null!==(e=t.findTextFromChildNamed("siri:CountryRef"))&&void 0!==e?e:"n/a CountryRef",O=null!==(i=t.findTextFromChildNamed("siri:ParticipantRef"))&&void 0!==i?i:"n/a ParticipantRef",B=t.findTextFromChildNamed("siri:Version");if(null===B)return console.error("ERROR - Version is NULL","PtSituationElement.initFromSituationNode"),console.log(t),null;const X=parseInt(B),te=QA.initWithSituationTreeNode(t),se=null!==(r=t.findTextFromChildNamed("siri:Progress"))&&void 0!==r?r:"n/a Progress",me=[];if(t.findChildrenNamed("siri:ValidityPeriod").forEach(Yi=>{const Ci=Yi.findTextFromChildNamed("siri:StartTime"),ar=Yi.findTextFromChildNamed("siri:EndTime");if(!Ci||!ar)return;const Gi={startDate:new Date(Ci),endDate:new Date(ar)};me.push(Gi)}),0===me.length)return console.error("initFromSituationNode: EMPTY <ValidityPeriod>"),console.log(d),console.log(t),null;const $e=null!==(a=t.findTextFromChildNamed("siri:AlertCause"))&&void 0!==a?a:"n/a AlertCause",ht=t.findTextFromChildNamed("siri:Priority");if(null===ht)return console.error("ERROR - Priority is NULL","PtSituationElement.initFromSituationNode"),console.log(t),null;const Qe=parseInt(ht),At=(()=>{const Yi=t.findTextFromChildNamed("siri:ScopeType");return"line"===Yi||"route"===Yi?"line":"stopPlace"===Yi||"stopPoint"===Yi?"stopPlace":"vehicleJourney"===Yi?"vehicleJourney":"unknown"})();if(!d||!te)return console.error("ERROR - cant init","PtSituationElement.initFromSituationNode"),console.log(t),null;const qn="true"===t.findTextFromChildNamed("siri:Planned"),Xn=iu.computePublishingActionsFromSituationNode(d,At,t),Ri=new iu(d,x,A,O,X,te,se,me,$e,Qe,At,Xn,qn);return Ri.treeNode=t,Ri.situationContent=this.computeSituationContent(t),0===Ri.publishingActions.length&&null===Ri.situationContent&&console.error("PtSituationElement.initFromSituationNode: NO publishing action found and also situationContent is null"),Ri}static computePublishingActionsFromSituationNode(t,e,i){const r=[],a=i.findChildNamed("siri:PublishingActions");return null===a||a.findChildrenNamed("siri:PublishingAction").forEach(b=>{const x=iu.computePublishingAction(t,e,b);if(null===x)return console.error("ERROR - cant compute PublishingAction","PtSituationElement.initFromSituationNode"),void console.log(b);r.push(x)}),r}static computePublishingAction(t,e,i){const r=i.findChildNamed("siri:PassengerInformationAction");if(null===r)return console.error("computePublishingAction: NO <PassengerInformationAction>"),console.log(t),console.log(i),null;const a=r.findTextFromChildNamed("siri:ActionRef"),d=r.findTextFromChildNamed("siri:OwnerRef"),b=[];r.findChildrenNamed("siri:Perspective").forEach(se=>{const me=se.text;me&&b.push(me)});let A=null;const O=i.findChildNamed("siri:PassengerInformationAction/siri:TextualContent"),B={};if(O){O.children.forEach(me=>{const ye=me.name.replace("siri:","").replace("Content","");if(ye in B||(B[ye]=[]),me.children.length>0){const $e=me.children[0].text;null!==$e&&B[ye].push($e.trim())}"DEBUG"===pf&&!["InfoLink"].includes(ye)&&me.children.length>1&&(console.log("computePublishingAction. mapTextualContent + "+ye+": first text property was used"),console.log(me))});const se=O.findChildNamed("siri:InfoLink");if(se){const me=se.findTextFromChildNamed("siri:Uri"),ye=se.findTextFromChildNamed("siri:Label");me&&ye&&(A={uri:me,label:ye})}}return{affects:iu.computeAffects(t,e,i),passengerInformation:{actionRef:a,ownerRef:d,perspectives:b,mapTextualContent:B,infoLink:A}}}static computeAffects(t,e,i){const r=[],a=i.findChildNamed("siri:PublishAtScope/siri:Affects/siri:Networks/siri:AffectedNetwork");if(a&&a.findChildrenNamed("siri:AffectedLine").forEach(b=>{var x;const A=iu.computeLineNetwork(b);if(null!==A&&("line"===e&&r.push({type:"entire-line",affect:A}),"stopPlace"===e)){const O=null!==(x=b.findTextFromChildNamed("siri:Direction/siri:DirectionRef"))&&void 0!==x?x:"n/a",B=b.findChildrenNamed("siri:StopPlaces/siri:AffectedStopPlace"),X=iu.computeAffectedStopPlaces(B);r.push({type:"partial-line",affect:{lineNetwork:A,directionRef:O,stopPlaces:X}})}}),"stopPlace"===e){const d=i.findChildNamed("siri:PublishAtScope/siri:Affects/siri:StopPlaces");if(d){const b=d.findChildrenNamed("siri:AffectedStopPlace");iu.computeAffectedStopPlaces(b).forEach(A=>{r.push({type:"stop",affect:A})})}}return"vehicleJourney"===e&&iu.computeAffectedJourneys(t,i).forEach(b=>{r.push({type:"vehicle-journey",affect:b})}),r}static computeLineNetwork(t){const e=t.findTextFromChildNamed("siri:AffectedOperator/siri:OperatorRef"),i=t.findTextFromChildNamed("siri:LineRef"),r=t.findTextFromChildNamed("siri:PublishedLineName");if(null===e||null===i||null===r)return console.log("ERROR: LineNetwork cant init"),console.log(t),null;const a=t.findChildrenNamed("siri:StopPlaces/siri:AffectedStopPlace");return{operator:{operatorRef:e},lineRef:i,publishedLineName:r,stopPlaces:iu.computeAffectedStopPlaces(a)}}static computeAffectedStopPlaces(t){const e=[];return t.forEach(i=>{const r=i.findTextFromChildNamed("siri:StopPlaceRef"),a=i.findTextFromChildNamed("siri:PlaceName");if(null===r||null===a)return console.log("ERROR: StopPlace cant init"),console.log(i),null;e.push({stopPlaceRef:r,placeName:a})}),e}static computeAffectedJourneys(t,e){const i=[];return e.findChildrenNamed("siri:PublishAtScope/siri:Affects/siri:VehicleJourneys/siri:AffectedVehicleJourney").forEach((a,d)=>{const b=a.findChildNamed("siri:FramedVehicleJourneyRef");if(null===b)return console.error("computeAffectedJourneys - NULL FramedVehicleJourneyRef"),console.log(t),void console.log(a);const x=b.findTextFromChildNamed("siri:DataFrameRef"),A=b.findTextFromChildNamed("siri:DatedVehicleJourneyRef");if(null===x||null===A)return console.error("computeAffectedJourneys - NULL FramedVehicleJourneyRef members"),console.log(t),void console.log(b);const O={dataFrameRef:x,datedVehicleJourneyRef:A},B=a.findTextFromChildNamed("siri:Operator/siri:OperatorRef");if(null===B)return console.error("computeAffectedJourneys - NULL operatorRef"),console.log(t),void console.log(a);let X=null;const te=a.findTextFromChildNamed("siri:Origins/siri:StopPlaceRef");null!==te&&(X={stopPlaceRef:te,placeName:a.findTextFromChildNamed("siri:Origins/siri:PlaceName")});let se=null;const me=a.findTextFromChildNamed("siri:Destinations/siri:StopPlaceRef");null!==me&&(se={stopPlaceRef:me,placeName:a.findTextFromChildNamed("siri:Destinations/siri:PlaceName")});const ye=a.findChildrenNamed("siri:Calls/siri:Call"),$e=[];ye.forEach(fn=>{const qn=fn.findTextFromChildNamed("siri:StopPlaceRef");null!==qn&&$e.push(qn)});const ht=a.findTextFromChildNamed("siri:LineRef"),Qe=a.findTextFromChildNamed("siri:PublishedLineName");i.push({framedVehicleJourneyRef:O,operator:{operatorRef:B},origin:X,destination:se,callStopsRef:$e,lineRef:ht,publishedLineName:Qe})}),i}isActive(t=new Date){var e;return null!==(null!==(e=this.validityPeriods.find(r=>r.startDate<t&&r.endDate>t))&&void 0!==e?e:null)}static computeSituationContent(t){const e=t.findTextFromChildNamed("siri:Summary");if(null===e)return null;const i=[];t.findChildrenNamed("siri:Description").forEach(x=>{const A=x.text;A&&i.push(A)});const a=[];return t.findChildrenNamed("siri:Detail").forEach(x=>{const A=x.text;A&&a.push(A)}),{summary:e,descriptions:i,details:a}}}class t3{static convertStopPointToStopPlace(t){if(!t.includes(":sloid:"))return t;const e=t.match(/^([^:]+?):([^:]+?):sloid:([^:]+?):([^:]+?):([^:]+?)$/);return null===e?t:"ch"===e[1]?"85"+e[3].padStart(5,"0").slice(-5):(console.log("convertStopPointToStopPlace: unhandled countryRef for "+t),console.log(e),t)}}class g1{constructor(t,e){if(this.timetableTime=t,this.estimatedTime=e,e){const i=(e.getTime()-t.getTime())/1e3;this.delayMinutes=Math.floor(i/60)}else this.delayMinutes=null}static initWithParentTreeNode(t,e){const i=t.findChildNamed(e);return null===i?null:g1.initWithContextTreeNode(i)}static initWithContextTreeNode(t){const e=t.findTextFromChildNamed("TimetabledTime");if(null===e)return null;const i=new Date(Date.parse(e));let r=null;const a=t.findTextFromChildNamed("EstimatedTime");return a&&(r=new Date(Date.parse(a))),new g1(i,r)}}class mf{constructor(t,e,i,r,a,d){this.stopPointType=t,this.location=e,this.arrivalData=i,this.departureData=r,this.plannedPlatform=a,this.actualPlatform=null,this.sequenceOrder=d,this.isNotServicedStop=null,this.siriSituationIds=[],this.siriSituations=[],this.vehicleAccessType=null,this.mapFareClassOccupancy={firstClass:null,secondClass:null}}static initWithTreeNode(t,e){const i=t.findTextFromChildNamed("siri:StopPointRef"),r=t.findTextFromChildNamed("StopPointName/Text");if(!i||!r)return null;const a=new fa;a.stopPlace=new ff(i,r,null);const d=g1.initWithParentTreeNode(t,"ServiceArrival"),b=g1.initWithParentTreeNode(t,"ServiceDeparture"),x=t.findTextFromChildNamed("PlannedQuay/Text"),A=t.findTextFromChildNamed("Order"),O=null===A?null:parseInt(A,10),B=new mf(e,a,d,b,x,O);B.actualPlatform=t.findTextFromChildNamed("EstimatedQuay/Text");const X=t.findChildNamed("NotServicedStop");return X&&(B.isNotServicedStop="true"===X.text),B.siriSituationIds=[],t.findChildrenNamed("SituationFullRef").forEach(se=>{const me=se.findTextFromChildNamed("siri:SituationNumber");me&&B.siriSituationIds.push(me)}),B.vehicleAccessType=t.findTextFromChildNamed("NameSuffix/Text"),B.mapFareClassOccupancy=mf.computeMapFareClassOccupancy(t),B}static computeMapFareClassOccupancy(t){const e={firstClass:null,secondClass:null};return t.findChildrenNamed("siri:ExpectedDepartureOccupancy").forEach(r=>{const a=(()=>{const b=r.findTextFromChildNamed("siri:FareClass");return"firstClass"===b?"firstClass":"secondClass"===b?"secondClass":null})();if(null===a)return console.error("computeMapFareClassOccupancy: unexpected fareClass"),void console.log(r);const d=(()=>{const b=r.findTextFromChildNamed("siri:OccupancyLevel");return"fewSeatsAvailable"===b?"fewSeatsAvailable":"manySeatsAvailable"===b?"manySeatsAvailable":"standingRoomOnly"===b?"standingRoomOnly":"unknown"===b?"unknown":null})();if(null===d)return console.error("computeMapFareClassOccupancy: unexpected occupancy level"),void console.log(r);e[a]=d}),e}}class _C{constructor(t,e){this.stopPoint=t,this.journeyService=e,this.prevStopPoints=[],this.nextStopPoints=[]}static initWithTreeNode(t,e){const i=t.findChildNamed("StopEvent");if(null===i)return null;const r=i.findChildNamed("ThisCall/CallAtStop");if(null===r)return null;const a=mf.initWithTreeNode(r,"Intermediate");if(null===a)return null;const d=f1.initWithTreeNode(i,e);if(null===d)return null;const b=new _C(a,d);return["PreviousCall","OnwardCall"].forEach(A=>{const B="PreviousCall"===A?b.prevStopPoints:b.nextStopPoints;i.findChildrenNamed(A).forEach(te=>{const se=te.findChildNamed("CallAtStop");if(null===se)return;const me=mf.initWithTreeNode(se,"Intermediate");me&&B.push(me)})}),b}patchStopEventLocations(t){let e=[this.stopPoint];["prev","next"].forEach(r=>{e=e.concat("prev"===r?this.prevStopPoints:this.nextStopPoints)}),e.forEach(r=>{var a,d;let b=null!==(d=null===(a=r.location.stopPlace)||void 0===a?void 0:a.stopPlaceRef)&&void 0!==d?d:null;null!==b?(b in t||(b=t3.convertStopPointToStopPlace(b)),b in t?r.location.patchWithAnotherLocation(t[b]):"DEBUG"===pf&&(console.error("StopEvent.patchLocation - no stopPlaceRef found in mapContextLocations"),console.log(r),console.log("location.stopPlace?.stopPlaceRef :"+b),console.log(t))):"DEBUG"===pf&&(console.error("StopEvent.patchStopEventLocations - no stopPlaceRef found in location"),console.log(r))})}patchSituations(t){this.stopPoint.siriSituations=[],this.stopPoint.siriSituationIds.concat(this.journeyService.siriSituationIds).forEach(i=>{var r;const a=null!==(r=t[i])&&void 0!==r?r:null;a&&this.stopPoint.siriSituations.push(a)})}}const bC={url:"n/a",authToken:null};var d7=pt(8472),n3=pt(7904);class eR{constructor(t,e,i,r){this.stageConfig=t,this.language=e,this.xmlConfig=i,this.requestorRef=r,this.serviceRequestNode=this.computeBaseServiceRequestNode(),this.requestInfo={requestDateTime:null,requestXML:null,responseDateTime:null,responseXML:null,parseDateTime:null,error:null},this.logRequests=!1,this.mockRequestXML=null,this.mockResponseXML=null}buildRequestXML(){return this.buildRequestNode(),this.serviceRequestNode.end({pretty:!0})}updateRequestXML(){this.requestInfo.requestXML=this.buildRequestXML()}fetchOJPResponse(){this.requestInfo.requestDateTime=new Date,this.requestInfo.requestXML=this.mockRequestXML?this.mockRequestXML:this.buildRequestXML();const t=this.stageConfig.url;this.logRequests&&(console.log("OJP Request: /POST - "+t),console.log(this.requestInfo.requestXML));const e={"Content-Type":"text/xml"};this.stageConfig.authToken&&(e.Authorization="Bearer "+this.stageConfig.authToken);const i={method:"POST",body:this.requestInfo.requestXML,headers:e};return new Promise(a=>{if(this.mockResponseXML)return this.requestInfo.responseXML=this.mockResponseXML,this.requestInfo.responseDateTime=new Date,void a(this.requestInfo);d7(t,i).then(d=>d.ok?d.text():(this.requestInfo.error={error:"FetchError",message:"HTTP ERROR - Status:"+d.status+" - URL:"+t},null)).then(d=>{null!==d&&(this.requestInfo.responseXML=d,this.requestInfo.responseDateTime=new Date),a(this.requestInfo)}).catch(d=>{this.requestInfo.error={error:"FetchError",message:d},a(this.requestInfo)})})}computeBaseServiceRequestNode(t=new Date){const e=n3.create("OJP",{version:"1.0",encoding:"utf-8"});for(const d in this.xmlConfig.mapNS)e.att(d===this.xmlConfig.defaultNS?"xmlns":"xmlns:"+d,this.xmlConfig.mapNS[d]);e.att("version",this.xmlConfig.ojpVersion);const i="siri"===this.xmlConfig.defaultNS?"":"siri:",r=e.ele("OJPRequest").ele(i+"ServiceRequest");r.ele(i+"ServiceRequestContext").ele(i+"Language",this.language);const a=t.toISOString();return r.ele(i+"RequestTimestamp",a),r.ele(i+"RequestorRef",this.requestorRef),r}buildRequestNode(){this.serviceRequestNode=this.computeBaseServiceRequestNode()}}var h7=pt(1503);class tR{constructor(t,e,i,r,a){this.name=t,this.parentName=e,this.attributes=i,this.children=r,this.text=a}findTextFromChildNamed(t){var e;const i=t.split("/");let r=this;return i.forEach((d,b)=>{r&&(r=r.findChildNamed(d))}),null!==(e=null==r?void 0:r.text)&&void 0!==e?e:null}findChildNamed(t){const e=t.split("/");let i=this;return e.forEach((r,a)=>{var d;i=null!==(d=null==i?void 0:i.children.find(x=>x.name===r))&&void 0!==d?d:null}),i}findChildrenNamed(t){t.includes("/")&&(console.error("ERROR - do you want to use more than one level for findChildrenNamed? Use findTextFromChildNamed."),console.log(t));const e=[];return this.children.forEach(i=>{i.name===t&&e.push(i)}),e}computeText(){const t=[];if(null===this.text){if(0===this.children.length)return null;this.children.forEach(e=>{const i=e.computeText();i&&t.push(i)})}else t.push(this.text);return t.join(" ")}}class yC{constructor(t){this.mapUriNS={},this.xmlParserConfig="2.0"===t.ojpVersion?e3:QN;for(const i in this.xmlParserConfig.mapNS)this.mapUriNS[this.xmlParserConfig.mapNS[i]]=i===this.xmlParserConfig.defaultNS?"":i;this.rootNode=new tR("root",null,{},[],null),this.currentNode=this.rootNode,this.stack=[]}resetNodes(){this.rootNode=new tR("root",null,{},[],null),this.currentNode=this.rootNode,this.stack=[]}parseXML(t){if(KN)Promise.resolve().then(pt.t.bind(pt,1503,19)).then(e=>{const i=e.default.createStream(!0,{trim:!0,xmlns:!0});this._parseXML(t,i)});else{const e=h7.createStream(!0,{trim:!0,xmlns:!0});this._parseXML(t,e)}}_parseXML(t,e){this.resetNodes(),e.on("opentag",i=>{this.onOpenTag(i)}),e.on("text",i=>{this.onText(i)}),e.on("closetag",i=>{this.onSaxCloseTag(i)}),e.on("error",i=>{this.onError(i)}),e.on("end",()=>{this.onEnd()}),e.write(t),e.end()}onOpenTag(t){const e=(()=>{var r;const a=[],d=null!==(r=this.mapUriNS[t.uri])&&void 0!==r?r:"";return""!==d&&a.push(d),a.push(t.local),a.join(":")})(),i=new tR(e,this.currentNode.name,t.attributes,[],null);this.currentNode.children.push(i),this.stack.push(i),this.currentNode=i}onText(t){this.currentNode.text=t}onSaxCloseTag(t){this.stack.pop(),this.onCloseTag(this.currentNode.name),this.currentNode=this.stack[this.stack.length-1]}onCloseTag(t){}onError(t){}onEnd(){}}class p7 extends yC{constructor(t){super(t),this.callback=null,this.locations=[]}parseXML(t){this.locations=[],super.parseXML(t)}onCloseTag(t){if(t===("2.0"===this.xmlParserConfig.ojpVersion?"PlaceResult":"Location")&&"OJPLocationInformationDelivery"===this.currentNode.parentName){const i=fa.initWithLocationResultTreeNode(this.currentNode,this.xmlParserConfig);i&&this.locations.push(i)}}onError(t){console.error("ERROR: SAX parser"),console.log(t),this.callback&&this.callback({locations:this.locations,message:"ERROR"})}onEnd(){this.callback&&this.callback({locations:this.locations,message:"LocationInformation.DONE"})}}class jm extends eR{constructor(t,e,i,r){super(t,e,i,r),this.locationName=null,this.stopPlaceRef=null,this.restrictionTypes=[],this.poiRestriction=null,this.numberOfResults=null,this.bboxWest=null,this.bboxNorth=null,this.bboxEast=null,this.bboxSouth=null,this.circleCenter=null,this.circleRadius=null,this.enableExtensions=!0}static initWithResponseMock(t,e,i){const r=new jm(bC,"en",e,i);return r.mockResponseXML=t,r}static initWithRequestMock(t,e,i,r){const a=new jm(e,"en",i,r);return a.mockRequestXML=t,a}static initWithLocationName(t,e,i,r,a,d,b=10){const x=new jm(t,e,i,r);return x.locationName=a,x.numberOfResults=b,null!==d&&(x.restrictionTypes=d),x}static initWithStopPlaceRef(t,e,i,r,a){const d=new jm(t,e,i,r);return d.stopPlaceRef=a,d}static initWithCircleLngLatRadius(t,e,i,r,a,d,b,x=[],A=1e3){const O=new jm(t,e,i,r);return O.circleCenter=new cs(a,d),O.circleRadius=b,O.restrictionTypes=x,O.numberOfResults=A,O}static initWithBBOXAndType(t,e,i,r,a,d,b,x,A,O=1e3,B=null){const X=new jm(t,e,i,r);return X.numberOfResults=O,X.bboxWest=a,X.bboxNorth=d,X.bboxEast=b,X.bboxSouth=x,X.restrictionTypes=A,X.poiRestriction=B,X}buildRequestNode(){var t,e,i,r,a,d,b;super.buildRequestNode();const x="siri"===this.xmlConfig.defaultNS?"":"siri:",A="ojp"===this.xmlConfig.defaultNS?"":"ojp:",O="2.0"===this.xmlConfig.ojpVersion,X=(new Date).toISOString(),te=this.serviceRequestNode.ele(A+"OJPLocationInformationRequest");te.ele(x+"RequestTimestamp",X);const se=O?"Name":"LocationName",me=null!==(t=this.locationName)&&void 0!==t?t:null;null!==me&&te.ele(A+"InitialInput").ele(A+se,me);const ye=null!==(e=this.stopPlaceRef)&&void 0!==e?e:null;if(ye){const Xn=te.ele(A+"PlaceRef");Xn.ele(O?x+"StopPointRef":A+"StopPlaceRef",ye),Xn.ele(A+se).ele(A+"Text","n/a")}const $e=null!==(i=this.bboxWest)&&void 0!==i?i:null,ht=null!==(r=this.bboxNorth)&&void 0!==r?r:null,Qe=null!==(a=this.bboxEast)&&void 0!==a?a:null,At=null!==(d=this.bboxSouth)&&void 0!==d?d:null;if($e&&ht&&Qe&&At){const Xn=te.ele(A+"InitialInput").ele(A+"GeoRestriction").ele(A+"Rectangle"),Ri=Xn.ele(A+"UpperLeft");Ri.ele(x+"Longitude",$e.toFixed(6)),Ri.ele(x+"Latitude",ht.toFixed(6));const Yi=Xn.ele(A+"LowerRight");Yi.ele(x+"Longitude",Qe.toFixed(6)),Yi.ele(x+"Latitude",At.toFixed(6))}if(null!==this.circleCenter&&null!==this.circleRadius){const Xn=te.ele(A+"InitialInput").ele(A+"GeoRestriction").ele(A+"Circle"),Ri=Xn.ele(A+"Center");Ri.ele(x+"Longitude",this.circleCenter.longitude.toFixed(6)),Ri.ele(x+"Latitude",this.circleCenter.latitude.toFixed(6)),Xn.ele(A+"Radius",this.circleRadius)}const fn=te.ele(A+"Restrictions");this.restrictionTypes.forEach(Xn=>{if(fn.ele(A+"Type",Xn),"poi"===Xn&&this.poiRestriction){const Yi=fn.ele(A+"PointOfInterestFilter").ele(A+"PointOfInterestCategory"),ar="shared_mobility"===this.poiRestriction.poiType?"amenity":"POI";this.poiRestriction.tags.forEach(Gi=>{const eo=Yi.ele(A+"OsmTag");eo.ele(A+"Tag",ar),eo.ele(A+"Value",Gi)})}});const qn=null!==(b=this.numberOfResults)&&void 0!==b?b:10;fn.ele(A+"NumberOfResults",qn),this.enableExtensions&&te.ele(x+"Extensions").ele(A+"ParamsExtension").ele(A+"PrivateModeFilter").ele(A+"Exclude","false")}fetchResponse(){var t=this;return mr(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{const r={locations:[],message:null};if(null!==t.requestInfo.error||null===t.requestInfo.responseXML)return r.message="ERROR",void i(r);const a=new p7(t.xmlConfig);a.callback=({locations:d,message:b})=>{r.locations=d,r.message=b,"LocationInformation.DONE"===b&&(t.requestInfo.parseDateTime=new Date),i(r)},a.parseXML(t.requestInfo.responseXML)})})()}fetchLocations(){var t=this;return mr(function*(){const e=yield t.fetchResponse();return new Promise(r=>{"LocationInformation.DONE"===e.message&&r(e.locations)})})()}}class f7 extends yC{constructor(t){super(t),this.callback=null,this.stopEvents=[],this.mapContextLocations={},this.mapContextSituations={}}reset(){this.stopEvents=[],this.mapContextLocations={},this.mapContextSituations={}}parseXML(t){this.reset(),super.parseXML(t)}onCloseTag(t){const e="2.0"===this.xmlParserConfig.ojpVersion;if("StopEventResult"===t){const i=_C.initWithTreeNode(this.currentNode,this.xmlParserConfig);i&&(i.patchStopEventLocations(this.mapContextLocations),i.patchSituations(this.mapContextSituations),this.stopEvents.push(i))}if("StopEventResponseContext"===t){const i=this.currentNode.findChildNamed("Places");i&&(this.mapContextLocations={},i.findChildrenNamed(e?"Place":"Location").forEach(b=>{var x,A;const O=fa.initWithTreeNode(b,this.xmlParserConfig),B=null!==(A=null===(x=O.stopPlace)||void 0===x?void 0:x.stopPlaceRef)&&void 0!==A?A:null;null!==B&&(this.mapContextLocations[B]=O)}));const r=this.currentNode.findChildNamed("Situations");r&&(this.mapContextSituations={},r.findChildrenNamed("PtSituation").forEach(d=>{const b=iu.initWithSituationTreeNode(d);b&&(this.mapContextSituations[b.situationNumber]=b)}))}}onEnd(){"DEBUG"===pf&&this.validateSituations(),this.callback&&this.callback({stopEvents:this.stopEvents,message:"StopEvent.DONE"})}validateSituations(){const t=Object.values(this.mapContextSituations);if(0===t.length)return;const e={};t.forEach(i=>{e[i.situationNumber]=!1}),this.stopEvents.forEach(i=>{i.stopPoint.siriSituations.forEach(r=>{r.situationNumber in e?e[r.situationNumber]=!0:(console.error("StopPoint has situation which can be found in context"),console.log(r.situationNumber),console.log(this.mapContextSituations),console.log("======================================================================"))})});for(const i in e)!1===e[i]&&(console.error("Situation "+i+" cant be map to any of the stop events"),console.log(this.mapContextSituations[i]),console.log(this.stopEvents),console.log("======================================================================"));this.stopEvents.forEach(i=>{i.stopPoint.siriSituationIds.forEach(r=>{r in e||(console.error("Situation "+r+" is in the stopEvent but cant be found in the context"),console.log(this.mapContextSituations),console.log(i.stopPoint),console.log("======================================================================"))})})}}class cv extends eR{constructor(t,e,i,r,a,d,b,x){super(t,e,i,r),this.stopPlaceRef=a,this.geoPosition=d,this.depArrTime=x,this.numberOfResults=10,this.stopEventType=b,this.includePreviousCalls=!0,this.includeOnwardCalls=!0,this.includeRealtimeData=!0,this.enableExtensions=!0,this.useRealTimeDataType="explanatory"}static Empty(t,e,i){return new cv(t,"en",e,i,null,null,"departure",new Date)}static initWithMock(t,e,i){const r=cv.Empty(bC,e,i);return r.mockResponseXML=t,r}static initWithRequestMock(t,e,i,r){const a=cv.Empty(e,i,r);return a.mockRequestXML=t,a}static initWithStopPlaceRef(t,e,i,r,a,d,b){return new cv(t,e,i,r,a,null,d,b)}buildRequestNode(){super.buildRequestNode();const t="siri"===this.xmlConfig.defaultNS?"":"siri:",e="ojp"===this.xmlConfig.defaultNS?"":"ojp:",i="2.0"===this.xmlConfig.ojpVersion,r=(new Date).toISOString(),a=this.serviceRequestNode.ele(e+"OJPStopEventRequest");a.ele(t+"RequestTimestamp",r);const d=a.ele(e+"Location");if(this.stopPlaceRef){const A=d.ele(e+"PlaceRef");A.ele(i?t+"StopPointRef":e+"StopPlaceRef",this.stopPlaceRef),A.ele(e+(i?"Name":"LocationName")).ele(e+"Text","n/a")}const b=this.depArrTime.toISOString();d.ele(e+"DepArrTime",b);const x=a.ele(e+"Params");x.ele(e+"IncludeAllRestrictedLines",!0),x.ele(e+"NumberOfResults",this.numberOfResults),x.ele(e+"StopEventType",this.stopEventType),x.ele(e+"IncludePreviousCalls",this.includePreviousCalls),x.ele(e+"IncludeOnwardCalls",this.includeOnwardCalls),i&&(x.ele(e+"IncludeRealtimeData",this.includeRealtimeData),x.ele(e+"UseRealtimeData",this.useRealTimeDataType)),this.enableExtensions&&a.ele(t+"Extensions").ele(e+"ParamsExtension").ele(e+"PrivateModeFilter").ele(e+"Exclude","false")}fetchResponse(){var t=this;return mr(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{const r={stopEvents:[],message:null};if(null!==t.requestInfo.error||null===t.requestInfo.responseXML)return r.message="ERROR",void i(r);const a=new f7(t.xmlConfig);a.callback=({stopEvents:d,message:b})=>{r.stopEvents=d,r.message=b,"StopEvent.DONE"===b&&(t.requestInfo.parseDateTime=new Date,i(r))},a.parseXML(t.requestInfo.responseXML)})})()}}class _1{constructor(t){this.bookingArrangements=t}static initWithLegTreeNode(t){const e=t.findChildNamed("Service/BookingArrangements");if(null===e)return null;const i=e.findChildrenNamed("BookingArrangement");if(0===i.length)return console.error("ERROR - no BookingArrangements nodes found"),null;const r=[];return i.forEach(d=>{const b=d.findTextFromChildNamed("BookingAgencyName/Text");let x=d.findTextFromChildNamed("InfoUrl");if(null===b||null===x||(x=x.trim(),x.length<2))return;"<"===x[0]&&(x=x.substring(1,x.length-1));var A=document.createElement("textarea");A.innerHTML=x.trim(),x=A.innerText;const O={agencyCode:b.trim(),agencyName:_1.computeAgencyName(b),infoURL:x};r.push(O)}),new _1(r)}static computeAgencyName(t){return(t=t.trim()).endsWith("_local.ch")?"local.ch":t.endsWith("_maps.google.ch")?"maps.google.com":t.endsWith("_openstreetmap.org")?"openstreetmap.org":"n/a catalog: "+t}}class nR{constructor(t,e,i,r){this.legType=t,this.legID=e,this.fromLocation=i,this.toLocation=r,this.legTrack=null,this.legDuration=null}patchLocations(t){[this.fromLocation,this.toLocation].forEach(e=>{var i;this.patchLocation(e,t),!e.geoPosition&&null!==(i=this.legTrack)&&void 0!==i&&i.hasGeoData&&(e===this.fromLocation?this.fromLocation.geoPosition=this.legTrack.fromGeoPosition():this.toLocation.geoPosition=this.legTrack.toGeoPosition())})}patchSituations(t){}patchLocation(t,e){var i,r;if(t.geoPosition)return;let a=null!==(r=null===(i=t.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null!==a?(a in e||(a=t3.convertStopPointToStopPlace(a)),a in e?t.patchWithAnotherLocation(e[a]):"DEBUG"===pf&&(console.error("TripLeg.patchLocation - no stopPlaceRef found in mapContextLocations"),console.log(t),console.log("location.stopPlace?.stopPlaceRef :"+a),console.log(e))):"DEBUG"===pf&&(console.error("TripLeg.patchLocation - no stopPlaceRef found in location"),console.log(t))}addToXMLNode(t,e){}}class vC{constructor(t,e){this.coordinates=t,this.bbox=e}static initWithTreeNode(t){const e=t.findChildNamed("LinkProjection");if(null===e)return null;const i=[];if(e.findChildrenNamed("Position").forEach(b=>{const x=b.findTextFromChildNamed("siri:Longitude"),A=b.findTextFromChildNamed("siri:Latitude");if(x&&A){const O=new cs(parseFloat(x),parseFloat(A));i.push(O)}}),i.length<2)return null;const a=new m1(i);return new vC(i,a)}computeLength(){let t=0;return this.coordinates.forEach((e,i)=>{0!==i&&(t+=e.distanceFrom(this.coordinates[i-1]))}),t}asGeoJSONFeature(){const t={type:"Feature",bbox:this.bbox.asFeatureBBOX(),properties:{},geometry:{type:"LineString",coordinates:[]}};return this.coordinates.forEach(e=>{t.geometry.coordinates.push([e.longitude,e.latitude])}),t}}class iR{constructor(t){this.sections=t}static initWithTreeNode(t,e){const i=t.findChildNamed("PathGuidance");if(null===i)return null;let r=[];return i.findChildrenNamed("PathGuidanceSection").forEach(b=>{const x=rR.initWithSectionTreeNode(b,e);x&&r.push(x)}),new iR(r)}}class rR{constructor(){this.trackSection=null,this.guidanceAdvice=null,this.turnAction=null}static initWithSectionTreeNode(t,e){const i=new rR,r=t.findChildNamed("TrackSection");return r&&(i.trackSection=oR.initWithTrackSectionTreeNode(r)),i.guidanceAdvice=t.findTextFromChildNamed("GuidanceAdvice"),i.turnAction=t.findTextFromChildNamed("2.0"===e.ojpVersion?"TurnDescription/Text":"TurnAction"),i}}class oR{constructor(){this.linkProjection=null,this.roadName=null,this.duration=null,this.length=null}static initWithTrackSectionTreeNode(t){const e=new oR;e.linkProjection=vC.initWithTreeNode(t),e.roadName=t.findTextFromChildNamed("RoadName"),e.duration=t.findTextFromChildNamed("Duration");const i=t.findTextFromChildNamed("Length");return null!==i&&(e.length=parseInt(i,10)),e}}class xC{constructor(t){this.trackSections=t;let e=0;this.hasGeoData=!1,t.forEach(i=>{i.linkProjection&&(this.hasGeoData=!0),i.duration&&(e+=i.duration.totalMinutes)}),this.duration=null,e>0&&(this.duration=Gu.initFromTotalMinutes(e))}plus(t){return null!==this.duration&&null!==t.duration&&(this.duration=this.duration.plus(t.duration)),this.trackSections=this.trackSections.concat(t.trackSections),this}static initWithLegTreeNode(t,e){const i=t.findChildNamed("LegTrack");if(null===i)return null;const r=[];return i.findChildrenNamed("TrackSection").forEach(b=>{const x=sR.initWithTreeNode(b,e);x&&r.push(x)}),new xC(r)}fromGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[0].linkProjection;return null===e?null:e.coordinates[0]}toGeoPosition(){if(0===this.trackSections.length)return null;const e=this.trackSections[this.trackSections.length-1].linkProjection;return null===e?null:e.coordinates[e.coordinates.length-1]}}class sR{constructor(t,e){this.fromLocation=t,this.toLocation=e,this.duration=null,this.length=null,this.linkProjection=null}static initWithTreeNode(t,e){const i="2.0"===e.ojpVersion,a=t.findChildNamed(i?"TrackSectionStart":"TrackStart"),b=t.findChildNamed(i?"TrackSectionEnd":"TrackEnd");if(!a||!b)return null;const x=fa.initWithTreeNode(a,e),A=fa.initWithTreeNode(b,e);if(!x||!A)return console.error("CANT instantiate TrackSection.initWithTreeNode"),console.log(t),null;const O=new sR(x,A);O.duration=Gu.initWithTreeNode(t);const B=vC.initWithTreeNode(t);O.linkProjection=B;const X=t.findTextFromChildNamed("Length");return null===X?B&&(O.length=B.computeLength()):O.length=parseInt(X,10),O}}class b1 extends nR{constructor(t,e,i,r,a){super(t,e,r,a),this.legTransportMode=null,this.legDistance=i,this.pathGuidance=null,this.walkDuration=null,this.serviceBooking=null,this.transferMode=null,this.continousLegService=null}static initWithTreeNode(t,e,i,r){var a,d,b;const x=e.findChildNamed(i);if(null===x)return null;const A=x.findChildNamed("LegStart"),O=x.findChildNamed("LegEnd");if(null===A||null===O)return null;const B=fa.initWithTreeNode(A,r),X=fa.initWithTreeNode(O,r);if(null===B||null===X)return null;let te=null!==(a=x.findTextFromChildNamed("Length"))&&void 0!==a?a:"0";const se=parseInt(te),me=new b1(i,t,se,B,X);return me.legDuration=Gu.initWithTreeNode(x),me.pathGuidance=iR.initWithTreeNode(x,r),me.legTransportMode=me.computeLegTransportModeFromTreeNode(x,i),me.transferMode=me.computeLegTransferModeFromTreeNode(x,r),("taxi"===me.legTransportMode||"others-drive-car"===me.legTransportMode)&&(me.serviceBooking=_1.initWithLegTreeNode(x)),me.legTrack=xC.initWithLegTreeNode(x,r),"TransferLeg"===i&&(me.walkDuration=Gu.initWithTreeNode(x,"WalkDuration")),"ContinuousLeg"===i&&(me.continousLegService={personalMode:null!==(d=x.findTextFromChildNamed("Service/PersonalMode"))&&void 0!==d?d:"other",personalModeOfOperation:null!==(b=x.findTextFromChildNamed("Service/PersonalModeOfOperation"))&&void 0!==b?b:"other"}),me}computeLegTransportModeFromTreeNode(t,e){let i=null;if("TransferLeg"===e)return null;if("ContinuousLeg"===e&&(i=t.findTextFromChildNamed("Service/IndividualMode"),null===i)){const d=[];["Service/PersonalMode","Service/PersonalModeOfOperation","Service/Mode/PtMode","Service/Mode/siri:RailSubmode","Service/Mode/siri:WaterSubmode"].forEach(x=>{const A=t.findTextFromChildNamed(x);null!==A&&d.push(A)}),i=d.join(".")}const r=t.findTextFromChildNamed("Service/BookingArrangements/BookingArrangement/BookingAgencyName/Text"),a=this.computeLegTransportModeFromString(i,r);return null===a&&(console.error("ERROR computeLegTransportModeFromString"),console.log("=> CANT handle mode --"+i+"--"),console.log(t)),a}computeLegTransferModeFromTreeNode(t,e){const a=t.findTextFromChildNamed("2.0"===e.ojpVersion?"TransferType":"TransferMode");return null===a?null:"walk"===a?"walk":"remainInVehicle"===a?"remainInVehicle":"changeWithinVehicle"===a?"changeWithinVehicle":(console.error("CANT map TransferMode from =="+a+"=="),null)}computeLegTransportModeFromString(t,e=null){return null===t?null:"walk"===t?"walk":"self-drive-car"===t?"self-drive-car":"cycle"===t?"cycle":"taxi"===t?-1!==(null==e?void 0:e.indexOf("_limousine_"))?"others-drive-car":"taxi":"car.own"===t?"self-drive-car":"car.own.rail.vehicleTunnelTransportRailService"===t?"car-shuttle-train":"car.own.water.localCarFerry"===t?"car-ferry":"foot.own"===t?"walk":null}isDriveCarLeg(){return"self-drive-car"===this.legTransportMode}isSharedMobility(){return null!==this.legTransportMode&&-1!==["cycle","bicycle_rental","car_sharing","escooter_rental"].indexOf(this.legTransportMode)}isWalking(){return"walk"===this.legTransportMode}isTaxi(){return"taxi"===this.legTransportMode||"others-drive-car"===this.legTransportMode}formatDistance(){return this.legDistance>1e3?(this.legDistance/1e3).toFixed(1)+" km":this.legDistance+" m"}addToXMLNode(t,e){var i,r,a;const d="ojp"===e.defaultNS?"":"ojp:",b="siri"===e.defaultNS?"":"siri:",x="2.0"===e.ojpVersion,O=t.ele(d+(x?"Leg":"TripLeg"));O.ele(d+(x?"Id":"LegId"),this.legID);const X=null!==(r=null===(i=this.legDuration)||void 0===i?void 0:i.asOJPFormattedText())&&void 0!==r?r:null;X&&O.ele(d+"Duration",X);const te=O.ele(d+this.legType);if("TransferLeg"===this.legType&&te.ele(d+"TransferType",null!==(a=this.transferMode)&&void 0!==a?a:"walk"),["From","To"].forEach(me=>{var ye;const $e="From"===me,Qe=te.ele(d+($e?"LegStart":"LegEnd")),At=$e?this.fromLocation:this.toLocation,fn=At.stopPlace;if(null===fn){if(At.geoPosition){const qn=Qe.ele(d+"GeoPosition");qn.ele(b+"Longitude",At.geoPosition.longitude),qn.ele(b+"Latitude",At.geoPosition.latitude),Qe.ele(d+"Name").ele(d+"Text",At.geoPosition.asLatLngString())}}else Qe.ele(b+"StopPointRef",fn.stopPlaceRef),Qe.ele(d+"Name").ele(d+"Text",null!==(ye=fn.stopPlaceName)&&void 0!==ye?ye:"n/a")}),"ContinuousLeg"===this.legType&&this.continousLegService){const me=te.ele(d+"Service");me.ele(d+"PersonalMode",this.continousLegService.personalMode),me.ele(d+"PersonalModeOfOperation",this.continousLegService.personalModeOfOperation)}X&&te.ele(d+"Duration",X),te.ele(d+"Length",this.legDistance)}}class uv extends nR{constructor(t,e,i,r,a=[]){super("TimedLeg",t,i.location,r.location),this.service=e,this.fromStopPoint=i,this.toStopPoint=r,this.intermediateStopPoints=a}static initWithTreeNode(t,e,i){const r="2.0"===i.ojpVersion,a=e.findChildNamed("TimedLeg");if(null===a)return null;const d=f1.initWithTreeNode(a,i);if(null===d)return null;const b=a.findChildNamed("LegBoard"),x=a.findChildNamed("LegAlight");if(null===b||null===x)return null;const A=mf.initWithTreeNode(b,"From"),O=mf.initWithTreeNode(x,"To");if(null===A||null===O)return null;const B=[];a.findChildrenNamed(r?"LegIntermediate":"LegIntermediates").forEach(me=>{const ye=mf.initWithTreeNode(me,"Intermediate");ye&&B.push(ye)});const se=new uv(t,d,A,O,B);return se.legTrack=xC.initWithLegTreeNode(a,i),se.legDuration=(()=>{var me,ye;const $e=Gu.initWithTreeNode(e);return null!==$e?$e:null!==(ye=null===(me=se.legTrack)||void 0===me?void 0:me.duration)&&void 0!==ye?ye:null})(),se}patchLocations(t){super.patchLocations(t),this.intermediateStopPoints.forEach(e=>{this.patchLocation(e.location,t)})}computeDepartureTime(){return this.computeStopPointTime(this.fromStopPoint.departureData)}computeArrivalTime(){return this.computeStopPointTime(this.toStopPoint.arrivalData)}computeStopPointTime(t){var e;return null===t?null:null!==(e=t.estimatedTime)&&void 0!==e?e:t.timetableTime}patchSituations(t){this.service.siriSituations=[],this.service.siriSituationIds.forEach(e=>{var i;const r=null!==(i=t[e])&&void 0!==i?i:null;r&&this.service.siriSituations.push(r)})}addToXMLNode(t,e){var i,r;const a="2.0"===e.ojpVersion,d="ojp"===e.defaultNS?"":"ojp:",b="siri"===e.defaultNS?"":"siri:",A=t.ele(d+(a?"Leg":"TripLeg"));A.ele(d+(a?"Id":"LegId"),this.legID);const B=null!==(r=null===(i=this.legDuration)||void 0===i?void 0:i.asOJPFormattedText())&&void 0!==r?r:null;B&&A.ele(d+"Duration",B);const X=A.ele(d+"TimedLeg"),te=["Arr","Dep"],se=(ye,$e)=>{var ht;const At=X.ele("From"===$e?d+"LegBoard":"To"===$e?d+"LegAlight":d+(a?"LegIntermediate":"LegIntermediates")),fn=ye.location.stopPlace;fn&&(At.ele(b+"StopPointRef",fn.stopPlaceRef),At.ele(d+"StopPointName").ele(d+"Text",null!==(ht=fn.stopPlaceName)&&void 0!==ht?ht:"n/a")),ye.vehicleAccessType&&At.ele(d+"NameSuffix").ele(d+"Text",ye.vehicleAccessType),ye.plannedPlatform&&At.ele(d+"PlannedQuay").ele(d+"Text",ye.plannedPlatform),ye.actualPlatform&&At.ele(d+"EstimatedQuay").ele(d+"Text",ye.actualPlatform),te.forEach(qn=>{const Xn="Arr"===qn,Ri=Xn?ye.arrivalData:ye.departureData;if(Ri){const Ci=At.ele(d+(Xn?"ServiceArrival":"ServiceDeparture"));Ci.ele(d+"TimetabledTime",Ri.timetableTime.toISOString()),Ri.estimatedTime&&Ci.ele(d+"EstimatedTime",Ri.estimatedTime.toISOString())}}),At.ele(d+"Order",me),me+=1};let me=1;se(this.fromStopPoint,"From"),this.intermediateStopPoints.forEach(ye=>{se(ye,"Intermediate")}),se(this.toStopPoint,"To"),this.service.addToXMLNode(X,e)}}class Um{constructor(t){this.location=t,this.minDuration=null,this.maxDuration=null,this.minDistance=null,this.maxDistance=null,this.customTransportMode=null,this.dwellTimeMinutes=null}static Empty(){const t=new fa;return new Um(t)}}class wC{constructor(t,e,i){this.id=t,this.legs=e,this.stats=i}static initFromTreeNode(t,e){var i;const r="2.0"===e.ojpVersion;let d=t.findTextFromChildNamed(r?"Id":"TripId");null===d&&(d="RandomTripId","DEBUG"===pf&&(console.error("Trip.initFromTreeNode: No Id node found for trip, assigning a random one"),console.log(t),console.log("=======================================")));const b=Gu.initFromDurationText(t.findTextFromChildNamed("Duration"));if(null===b)return null;const x=null!==(i=t.findTextFromChildNamed("Transfers"))&&void 0!==i?i:"0",A=t.findTextFromChildNamed("StartTime"),O=t.findTextFromChildNamed("EndTime");if(null===A||null===O)return null;const B=new Date(Date.parse(A)),X=new Date(Date.parse(O)),te=[];let se=0;if(t.findChildrenNamed(r?"Leg":"TripLeg").forEach(Yi=>{var Ci,ar;const Gi=class m7{static initWithTreeNode(t,e){const a=t.findTextFromChildNamed("2.0"===e.ojpVersion?"Id":"LegId");if(null===a)return null;const d=parseInt(a,10),b=b1.initWithTreeNode(d,t,"TransferLeg",e);if(b)return b;return uv.initWithTreeNode(d,t,e)||b1.initWithTreeNode(d,t,"ContinuousLeg",e)||null}}.initWithTreeNode(Yi,e);null!==Gi&&((null!==(ar=null===(Ci=Gi.legTrack)||void 0===Ci?void 0:Ci.trackSections)&&void 0!==ar?ar:[]).forEach(Pr=>{var gs;se+=null!==(gs=Pr.length)&&void 0!==gs?gs:0}),te.push(Gi))}),0===te.length)return console.error("Trip.initFromTreeNode no legs found ?"),console.log(t),null;let $e=0,ht="trip";const Qe=t.findTextFromChildNamed("Distance");null===Qe?(ht="legs-sum",$e=se):$e=parseInt(Qe);const At={duration:b,distanceMeters:$e,distanceSource:ht,transferNo:parseInt(x),startDatetime:B,endDatetime:X,isCancelled:null,isInfeasable:null,isUnplanned:null},fn=t.findChildNamed("Cancelled");fn&&(At.isCancelled="true"===fn.text);const qn=t.findChildNamed("Infeasible");qn&&(At.isInfeasable="true"===qn.text);const Xn=t.findChildNamed("Unplanned");return Xn&&(At.isUnplanned="true"===Xn.text),new wC(d,te,At)}computeDepartureTime(){var t;const e=this.legs.filter(d=>d instanceof uv);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),null;const r=e[0].fromStopPoint.departureData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}computeArrivalTime(){var t;const e=this.legs.filter(d=>d instanceof uv);if(0===e.length)return console.log("No TimedLeg found for this trip"),console.log(this),new Date;const r=e[e.length-1].toStopPoint.arrivalData;return null===r?null:null!==(t=r.estimatedTime)&&void 0!==t?t:r.timetableTime}asXMLNode(t){const e="ojp"===t.defaultNS?"":"ojp:",i=n3.create(e+"Trip");return i.ele(e+("1.0"===t.ojpVersion?"TripId":"Id"),this.id),i.ele(e+"Duration",this.stats.duration.asOJPFormattedText()),i.ele(e+"StartTime",this.stats.startDatetime.toISOString()),i.ele(e+"EndTime",this.stats.endDatetime.toISOString()),i.ele(e+"Transfers",this.stats.transferNo),i.ele(e+"Distance",this.stats.distanceMeters),this.legs.forEach(a=>{a.addToXMLNode(i,t)}),i}asXML(t){return this.asXMLNode(t).end({pretty:!0})}}class g7 extends yC{constructor(t){super(t),this.callback=null,this.trips=[],this.tripsNo=0,this.mapContextLocations={},this.mapContextSituations={}}reset(){this.trips=[],this.tripsNo=0,this.mapContextLocations={},this.mapContextSituations={}}parseXML(t){this.reset(),this.tripsNo=t.split("<TripResult>").length-1,0===this.tripsNo&&(this.tripsNo=t.split("<ojp:TripResult>").length-1),this.callback&&this.callback({trips:this.trips,tripsNo:this.tripsNo,message:"TripRequest.TripsNo"}),super.parseXML(t)}onCloseTag(t){const e="2.0"===this.xmlParserConfig.ojpVersion;if("Trip"===t&&"TripResult"===this.currentNode.parentName){const i=wC.initFromTreeNode(this.currentNode,this.xmlParserConfig);i&&(i.legs.forEach(r=>{r.patchLocations(this.mapContextLocations),r.patchSituations(this.mapContextSituations)}),this.trips.push(i),this.callback&&this.callback({tripsNo:this.tripsNo,trips:this.trips,message:"TripRequest.Trip"}))}if("TripResponseContext"===t){const i=this.currentNode.findChildNamed("Places");i&&(this.mapContextLocations={},i.findChildrenNamed(e?"Place":"Location").forEach(b=>{var x,A;const O=fa.initWithTreeNode(b,this.xmlParserConfig),B=null!==(A=null===(x=O.stopPlace)||void 0===x?void 0:x.stopPlaceRef)&&void 0!==A?A:null;null!==B&&(this.mapContextLocations[B]=O)}));const r=this.currentNode.findChildNamed("Situations");r&&(this.mapContextSituations={},r.findChildrenNamed("PtSituation").forEach(d=>{const b=iu.initWithSituationTreeNode(d);b&&(this.mapContextSituations[b.situationNumber]=b)}))}}onEnd(){"DEBUG"===pf&&this.validateSituations(),this.callback&&this.callback({tripsNo:this.tripsNo,trips:this.trips,message:"TripRequest.DONE"})}validateSituations(){const t=Object.values(this.mapContextSituations);if(0===t.length)return;const e={};t.forEach(i=>{e[i.situationNumber]=!1}),this.trips.forEach(i=>{i.legs.forEach(r=>{"TimedLeg"===r.legType&&r.service.siriSituations.forEach(d=>{d.situationNumber in e?e[d.situationNumber]=!0:(console.error("TimedLeg has situation which can be found in context"),console.log(d.situationNumber),console.log(this.mapContextSituations),console.log("======================================================================"))})})});for(const i in e)!1===e[i]&&(console.error("Situation "+i+" cant be map to any of the trips"),console.log(this.mapContextSituations[i]),console.log(this.trips),console.log("======================================================================"));this.trips.forEach(i=>{i.legs.forEach(r=>{if("TimedLeg"!==r.legType)return;const a=r;a.service.siriSituationIds.forEach(d=>{d in e||(console.error("Situation "+d+" is in the <Trip> but cant be found in the context"),console.log(this.mapContextSituations),console.log(i),console.log(a),console.log("======================================================================"))})})})}}class Hm extends eR{constructor(t,e,i,r,a,d,b=new Date,x="Dep",A=null,O=null,B=null,X=[]){super(t,e,i,r),this.fromTripLocation=a,this.toTripLocation=d,this.departureDate=b,this.tripRequestBoardingType=x,this.numberOfResults=A,this.numberOfResultsBefore=O,this.numberOfResultsAfter=B,this.publicTransportModes=X,this.modeType="monomodal",this.transportMode="public_transport",this.includeLegProjection=!0,this.viaLocations=[],this.enableExtensions=!0,this.useRealTimeDataType="explanatory",this.walkSpeedDeviation=null,this.response=null}static Empty(t,e){const i=Um.Empty();return new Hm(bC,"en",t,e,i,i,new Date,"Dep")}static initWithResponseMock(t,e,i){const r=Hm.Empty(e,i);return r.mockResponseXML=t,r}static initWithRequestMock(t,e,i){const r=Hm.Empty(e,i);return r.mockRequestXML=t,r.requestInfo.requestXML=t,r}static initWithStopRefs(t,e,i,r,a,d,b=new Date,x="Dep"){const A=fa.initWithStopPlaceRef(a),O=fa.initWithStopPlaceRef(d),B=new Um(A),X=new Um(O);return new Hm(t,e,i,r,B,X,b,x)}static initWithLocationsAndDate(t,e,i,r,a,d,b,x="Dep"){const A=new Um(a),O=new Um(d);return new Hm(t,e,i,r,A,O,b,x)}static initWithTripLocationsAndDate(t,e,i,r,a,d,b,x="Dep",A=!1,O="monomodal",B="public_transport",X=[],te=null,se=null,me=null,ye=[]){if(null===a||null===d||!a.location.geoPosition&&!a.location.stopPlace||!d.location.geoPosition&&!d.location.stopPlace)return null;const $e=new Hm(t,e,i,r,a,d,b,x,te,se,me,ye);return $e.includeLegProjection=A,$e.modeType=O,$e.transportMode=B,$e.viaLocations=X,$e}buildRequestNode(){super.buildRequestNode();const t="siri"===this.xmlConfig.defaultNS?"":"siri:",e="ojp"===this.xmlConfig.defaultNS?"":"ojp:",i="2.0"===this.xmlConfig.ojpVersion,r=this.serviceRequestNode.ele(e+"OJPTripRequest"),d=(new Date).toISOString();r.ele(t+"RequestTimestamp",d);const b=this.modeType,x="monomodal"===b,A=this.transportMode,O=i?"Name":"LocationName",B=["From","To"];B.forEach(ye=>{var $e,ht,Qe,At;const fn="From"===ye,qn=fn?this.fromTripLocation:this.toTripLocation,Xn=qn.location,Yi=r.ele(e+(fn?"Origin":"Destination")),Ci=Yi.ele(e+"PlaceRef");if(null!==($e=Xn.stopPlace)&&void 0!==$e&&$e.stopPlaceRef){const Gi=null!==(ht=Xn.locationName)&&void 0!==ht?ht:"n/a";let eo=null!==(At=null===(Qe=Xn.stopPlace)||void 0===Qe?void 0:Qe.stopPlaceRef)&&void 0!==At?At:"";Ci.ele(e+"StopPlaceRef",eo),Ci.ele(e+O).ele(e+"Text",Gi)}else if(Xn.geoPosition){const Gi=Ci.ele(e+"GeoPosition");Gi.ele(t+"Longitude",Xn.geoPosition.longitude),Gi.ele(t+"Latitude",Xn.geoPosition.latitude);const eo=Xn.geoPosition.asLatLngString();Ci.ele(e+O).ele(e+"Text",eo)}const ar=this.departureDate.toISOString();fn?"Dep"===this.tripRequestBoardingType&&Yi.ele(e+"DepArrTime",ar):"Arr"===this.tripRequestBoardingType&&Yi.ele(e+"DepArrTime",ar),x||"cycle"===A&&(()=>{if("mode_at_start"===b&&!fn||"mode_at_end"===b&&fn)return;const eo=Yi.ele(e+"IndividualTransportOptions");this.addAdditionalRestrictions(eo,qn)})()}),this.viaLocations.forEach(ye=>{var $e,ht,Qe;const At=r.ele(e+"Via"),fn=At.ele(e+"ViaPoint"),qn=ye.location.stopPlace;if(null===qn){const Xn=ye.location.geoPosition;if(null!==Xn){const Ri=fn.ele(e+"GeoPosition");Ri.ele(t+"Longitude",Xn.longitude),Ri.ele(t+"Latitude",Xn.latitude),fn.ele(e+O).ele(e+"Text",null!==($e=ye.location.computeLocationName())&&void 0!==$e?$e:"n/a")}}else fn.ele(e+"StopPlaceRef",qn.stopPlaceRef),fn.ele(e+O).ele(e+"Text",null!==(ht=qn.stopPlaceName)&&void 0!==ht?ht:null!==(Qe=ye.location.computeLocationName())&&void 0!==Qe?Qe:"n/a");null!==ye.dwellTimeMinutes&&At.ele(e+"DwellTime","PT"+ye.dwellTimeMinutes.toString()+"M")});const X=r.ele(e+"Params");if("public_transport"===this.transportMode&&this.publicTransportModes.length>0){const ye=X.ele(e+"ModeAndModeOfOperationFilter");ye.ele(e+"Exclude","false"),this.publicTransportModes.forEach($e=>{ye.ele(e+"PtMode",$e)})}i&&null!==this.walkSpeedDeviation&&X.ele(e+"WalkSpeed",this.walkSpeedDeviation),i?X.ele(e+"IncludeAllRestrictedLines","true"):X.ele(e+"PrivateModeFilter").ele(e+"Exclude","false"),null!==this.numberOfResults&&X.ele(e+"NumberOfResults",this.numberOfResults),null!==this.numberOfResultsBefore&&X.ele(e+"NumberOfResultsBefore",this.numberOfResultsBefore),null!==this.numberOfResultsAfter&&X.ele(e+"NumberOfResultsAfter",this.numberOfResultsAfter),X.ele(e+"IncludeTrackSections",!0),X.ele(e+"IncludeLegProjection",this.includeLegProjection),X.ele(e+"IncludeTurnDescription",!0),"public_transport"===this.transportMode&&X.ele(e+"IncludeIntermediateStops",!0);const me=-1!==["bicycle_rental","car_sharing","escooter_rental"].indexOf(A);if(x){if(-1!==["foot","walk","self-drive-car","cycle","taxi","others-drive-car"].indexOf(A)&&(i?X.ele(e+"ItModeToCover").ele(e+"PersonalMode",A):X.ele(e+"ItModesToCover",A)),i&&["car","car-ferry","car-shuttle-train","car_sharing","self-drive-car","others-drive-car"].includes(A)){const ht=X.ele(e+"ModeAndModeOfOperationFilter");ht.ele(t+"WaterSubmode","localCarFerry"),ht.ele(t+"RailSubmode","vehicleTunnelTransportRailService")}me&&X.ele(e+"Extension").ele(e+"ItModesToCover",A)}else if(me){const ye=X.ele(e+"Extension");B.forEach($e=>{const ht="From"===$e;if(ht&&"mode_at_end"===this.modeType||!ht&&"mode_at_start"===this.modeType)return;const Qe=ht?this.fromTripLocation:this.toTripLocation,fn=ye.ele(e+(ht?"Origin":"Destination"));this.addAdditionalRestrictions(fn,Qe)})}i&&X.ele(e+"UseRealtimeData",this.useRealTimeDataType)}addAdditionalRestrictions(t,e){const r="ojp"===this.xmlConfig.defaultNS?"":"ojp:";(null!==e.minDuration||null!==e.maxDuration||null!==e.minDistance||null!==e.maxDistance)&&("2.0"===this.xmlConfig.ojpVersion?e.customTransportMode&&t.ele(r+"ItModeAndModeOfOperation").ele(r+"PersonalMode",e.customTransportMode):e.customTransportMode&&t.ele(r+"Mode",e.customTransportMode),null!==e.minDuration&&t.ele(r+"MinDuration","PT"+e.minDuration+"M"),null!==e.maxDuration&&t.ele(r+"MaxDuration","PT"+e.maxDuration+"M"),null!==e.minDistance&&t.ele(r+"MinDistance",e.minDistance),null!==e.maxDistance&&t.ele(r+"MaxDistance",e.maxDistance))}fetchResponse(){var t=this;return mr(function*(){return yield t.fetchOJPResponse(),new Promise(i=>{t.parseTripRequestResponse(i)})})()}fetchResponseWithCallback(t){this.fetchOJPResponse().then(e=>{this.requestInfo=e,this.parseTripRequestResponse(t)})}parseTripRequestResponse(t){if(this.response=null,null!==this.requestInfo.error||null===this.requestInfo.responseXML){return void t({tripsNo:0,trips:[],message:"ERROR"})}const e=new g7(this.xmlConfig);e.callback=i=>{"TripRequest.Trip"===i.message&&1===i.trips.length&&(this.requestInfo.parseDateTime=new Date),this.response=i,t(i)},e.parseXML(this.requestInfo.responseXML)}}class _7 extends yC{constructor(){super(...arguments),this.callback=null}parseXML(t){super.parseXML(t)}onError(t){console.error("ERROR: SAX parser"),console.log(t),this.callback&&this.callback({message:"ERROR",rootNode:this.rootNode})}onEnd(){this.callback&&this.callback({message:"DONE",rootNode:this.rootNode})}}const bn=Ye;var y1={MapNS_Tags:{"OJPRequest.ServiceRequest":"siri","ServiceRequest.ServiceRequestContext":"siri","ServiceRequestContext.Language":"siri","ServiceRequest.RequestTimestamp":"siri","ServiceRequest.RequestorRef":"siri","OJPResponse.ServiceDelivery":"siri","ServiceDelivery.ResponseTimestamp":"siri","ServiceDelivery.ProducerRef":"siri","OJPTripRefineRequest.RequestTimestamp":"siri","OJPFareRequest.RequestTimestamp":"siri","OJPTripInfoRequest.RequestTimestamp":"siri","OJPTripRequest.RequestTimestamp":"siri","OJPTripDelivery.ResponseTimestamp":"siri","OJPTripDelivery.RequestMessageRef":"siri","OJPTripDelivery.DefaultLanguage":"siri","LegBoard.StopPointRef":"siri","LegIntermediate.StopPointRef":"siri","LegIntermediates.StopPointRef":"siri","LegAlight.StopPointRef":"siri","Mode.AirSubmode":"siri","Mode.BusSubmode":"siri","Mode.CoachSubmode":"siri","Mode.FunicularSubmode":"siri","Mode.MetroSubmode":"siri","Mode.TramSubmode":"siri","Mode.TelecabinSubmode":"siri","Mode.RailSubmode":"siri","Mode.WaterSubmode":"siri","Service.LineRef":"siri","Service.OperatorRef":"siri","Service.DirectionRef":"siri","TrackSectionStart.StopPointRef":"siri","TrackSectionEnd.StopPointRef":"siri","Position.Longitude":"siri","LegStart.StopPointRef":"siri","LegEnd.StopPointRef":"siri","OJPLocationInformationRequest.RequestTimestamp":"siri","UpperLeft.Longitude":"siri","UpperLeft.Latitude":"siri","LowerRight.Longitude":"siri","LowerRight.Latitude":"siri","GeoPosition.Longitude":"siri","GeoPosition.Latitude":"siri","OJPStopEventRequest.RequestTimestamp":"siri","PlaceRef.StopPointRef":"siri"},MapArrayTags:{"places.place":!0,"linkProjection.position":!0,"situationFullRefs.situationFullRef":!0,"situations.ptSituation":!0,"ptSituation.validityPeriod":!0,"publishingActions.publishingAction":!0,"publishingAction.passengerInformationAction":!0,"passengerInformationAction.textualContent":!0,"textualContent.descriptionContent":!0,"textualContent.consequenceContent":!0,"textualContent.recommendationContent":!0,"textualContent.remarkContent":!0,"textualContent.infoLink":!0,"service.attribute":!0,"trip.leg":!0,"timedLeg.legIntermediate":!0,"legTrack.trackSection":!0,"pointOfInterest.pointOfInterestCategory":!0,"place.mode":!0,"OJPLocationInformationDelivery.placeResult":!0,"stopEvent.previousCall":!0,"stopEvent.onwardCall":!0,"OJPFareDelivery.fareResult":!0,"fareResult.tripFareResult":!0,"tripFareResult.fareProduct":!0,"OJPTripInfoDelivery.tripInfoResult":!0,"tripInfoResult.previousCall":!0,"tripInfoResult.onwardCall":!0,"journeyTrack.trackSection":!0},MapModelKeepPropertiesXML:{OJPLocationInformationRequest:["requestTimestamp","initialInput","placeRef","restrictions"],OJPTripRequest:["requestTimestamp","origin","destination","via","params"],OJPStopEventRequest:["requestTimestamp","location","params"],OJPTripRefineRequest:["requestTimestamp","refineParams","tripResult"],OJPTripInfoRequest:["requestTimestamp","journeyRef","operatingDayRef","params"],geoPosition:["longitude","latitude"]},MapStringValues:{"stopPlace.stopPlaceRef":!0,"publishedServiceName.text":!0}};const T7=new RegExp("^[:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$");function o3(n,t){const e=[];let i=t.exec(n);for(;i;){const r=[];r.startIndex=t.lastIndex-i[0].length;const a=i.length;for(let d=0;d<a;d++)r.push(i[d]);e.push(r),i=t.exec(n)}return e}const aR=function(n){return!(null==T7.exec(n))},D7={allowBooleanAttributes:!1,unpairedTags:[]};function a3(n){return" "===n||"\t"===n||"\n"===n||"\r"===n}function l3(n,t){const e=t;for(;t<n.length;t++)if("?"==n[t]||" "==n[t]){const i=n.substr(e,t-e);if(t>5&&"xml"===i)return na("InvalidXml","XML declaration allowed only at the start of the document.",Xl(n,t));if("?"==n[t]&&">"==n[t+1]){t++;break}continue}return t}function c3(n,t){if(n.length>t+5&&"-"===n[t+1]&&"-"===n[t+2]){for(t+=3;t<n.length;t++)if("-"===n[t]&&"-"===n[t+1]&&">"===n[t+2]){t+=2;break}}else if(n.length>t+8&&"D"===n[t+1]&&"O"===n[t+2]&&"C"===n[t+3]&&"T"===n[t+4]&&"Y"===n[t+5]&&"P"===n[t+6]&&"E"===n[t+7]){let e=1;for(t+=8;t<n.length;t++)if("<"===n[t])e++;else if(">"===n[t]&&(e--,0===e))break}else if(n.length>t+9&&"["===n[t+1]&&"C"===n[t+2]&&"D"===n[t+3]&&"A"===n[t+4]&&"T"===n[t+5]&&"A"===n[t+6]&&"["===n[t+7])for(t+=8;t<n.length;t++)if("]"===n[t]&&"]"===n[t+1]&&">"===n[t+2]){t+=2;break}return t}function M7(n,t){let e="",i="",r=!1;for(;t<n.length;t++){if('"'===n[t]||"'"===n[t])""===i?i=n[t]:i!==n[t]||(i="");else if(">"===n[t]&&""===i){r=!0;break}e+=n[t]}return""===i&&{value:e,index:t,tagClosed:r}}const A7=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function u3(n,t){const e=o3(n,A7),i={};for(let r=0;r<e.length;r++){if(0===e[r][1].length)return na("InvalidAttr","Attribute '"+e[r][2]+"' has no space in starting.",v1(e[r]));if(void 0!==e[r][3]&&void 0===e[r][4])return na("InvalidAttr","Attribute '"+e[r][2]+"' is without value.",v1(e[r]));if(void 0===e[r][3]&&!t.allowBooleanAttributes)return na("InvalidAttr","boolean attribute '"+e[r][2]+"' is not allowed.",v1(e[r]));const a=e[r][2];if(!k7(a))return na("InvalidAttr","Attribute '"+a+"' is an invalid name.",v1(e[r]));if(i.hasOwnProperty(a))return na("InvalidAttr","Attribute '"+a+"' is repeated.",v1(e[r]));i[a]=1}return!0}function P7(n,t){if(";"===n[++t])return-1;if("#"===n[t])return function R7(n,t){let e=/\d/;for("x"===n[t]&&(t++,e=/[\da-fA-F]/);t<n.length;t++){if(";"===n[t])return t;if(!n[t].match(e))break}return-1}(n,++t);let e=0;for(;t<n.length;t++,e++)if(!(n[t].match(/\w/)&&e<20)){if(";"===n[t])break;return-1}return t}function na(n,t,e){return{err:{code:n,msg:t,line:e.line||e,col:e.col}}}function k7(n){return aR(n)}function L7(n){return aR(n)}function Xl(n,t){const e=n.substring(0,t).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function v1(n){return n.startIndex+n[1].length}const O7={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(n,t){return t},attributeValueProcessor:function(n,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(n,t,e){return n}};class x1{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){"__proto__"===t&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){"__proto__"===t.tagname&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}function N7(n,t){const e={};if("O"!==n[t+3]||"C"!==n[t+4]||"T"!==n[t+5]||"Y"!==n[t+6]||"P"!==n[t+7]||"E"!==n[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let i=1,r=!1,a=!1,d="";for(;t<n.length;t++)if("<"!==n[t]||a)if(">"===n[t]){if(a?"-"===n[t-1]&&"-"===n[t-2]&&(a=!1,i--):i--,0===i)break}else"["===n[t]?r=!0:d+=n[t];else{if(r&&V7(n,t)){let b,x;t+=7,[b,x,t]=B7(n,t+1),-1===x.indexOf("&")&&(e[q7(b)]={regx:RegExp(`&${b};`,"g"),val:x})}else if(r&&j7(n,t))t+=8;else if(r&&U7(n,t))t+=8;else if(r&&H7(n,t))t+=9;else{if(!z7)throw new Error("Invalid DOCTYPE");a=!0}i++,d=""}if(0!==i)throw new Error("Unclosed DOCTYPE")}return{entities:e,i:t}}function B7(n,t){let e="";for(;t<n.length&&"'"!==n[t]&&'"'!==n[t];t++)e+=n[t];if(e=e.trim(),-1!==e.indexOf(" "))throw new Error("External entites are not supported");const i=n[t++];let r="";for(;t<n.length&&n[t]!==i;t++)r+=n[t];return[e,r,t]}function z7(n,t){return"!"===n[t+1]&&"-"===n[t+2]&&"-"===n[t+3]}function V7(n,t){return"!"===n[t+1]&&"E"===n[t+2]&&"N"===n[t+3]&&"T"===n[t+4]&&"I"===n[t+5]&&"T"===n[t+6]&&"Y"===n[t+7]}function j7(n,t){return"!"===n[t+1]&&"E"===n[t+2]&&"L"===n[t+3]&&"E"===n[t+4]&&"M"===n[t+5]&&"E"===n[t+6]&&"N"===n[t+7]&&"T"===n[t+8]}function U7(n,t){return"!"===n[t+1]&&"A"===n[t+2]&&"T"===n[t+3]&&"T"===n[t+4]&&"L"===n[t+5]&&"I"===n[t+6]&&"S"===n[t+7]&&"T"===n[t+8]}function H7(n,t){return"!"===n[t+1]&&"N"===n[t+2]&&"O"===n[t+3]&&"T"===n[t+4]&&"A"===n[t+5]&&"T"===n[t+6]&&"I"===n[t+7]&&"O"===n[t+8]&&"N"===n[t+9]}function q7(n){if(aR(n))return n;throw new Error(`Invalid entity name ${n}`)}const G7=/^[-+]?0x[a-fA-F0-9]+$/,$7=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,W7={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};const Z7=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;function d3(n){return"function"==typeof n?n:Array.isArray(n)?t=>{for(const e of n)if("string"==typeof e&&t===e||e instanceof RegExp&&e.test(t))return!0}:()=>!1}class Q7{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xa2"},pound:{regex:/&(pound|#163);/g,val:"\xa3"},yen:{regex:/&(yen|#165);/g,val:"\xa5"},euro:{regex:/&(euro|#8364);/g,val:"\u20ac"},copyright:{regex:/&(copy|#169);/g,val:"\xa9"},reg:{regex:/&(reg|#174);/g,val:"\xae"},inr:{regex:/&(inr|#8377);/g,val:"\u20b9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,i)=>String.fromCharCode(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,i)=>String.fromCharCode(Number.parseInt(i,16))}},this.addExternalEntities=e9,this.parseXml=o9,this.parseTextData=t9,this.resolveNameSpace=n9,this.buildAttributesMap=r9,this.isItStopNode=c9,this.replaceEntitiesValue=a9,this.readStopNodeData=d9,this.saveTextToParentTag=l9,this.addChild=s9,this.ignoreAttributesFn=d3(this.options.ignoreAttributes)}}function e9(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const i=t[e];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:n[i]}}}function t9(n,t,e,i,r,a,d){if(void 0!==n&&(this.options.trimValues&&!i&&(n=n.trim()),n.length>0)){d||(n=this.replaceEntitiesValue(n));const b=this.options.tagValueProcessor(t,n,e,r,a);return null==b?n:typeof b!=typeof n||b!==n?b:this.options.trimValues||n.trim()===n?cR(n,this.options.parseTagValue,this.options.numberParseOptions):n}}function n9(n){if(this.options.removeNSPrefix){const t=n.split(":"),e="/"===n.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(n=e+t[1])}return n}const i9=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function r9(n,t,e){if(!0!==this.options.ignoreAttributes&&"string"==typeof n){const i=o3(n,i9),r=i.length,a={};for(let d=0;d<r;d++){const b=this.resolveNameSpace(i[d][1]);if(this.ignoreAttributesFn(b,t))continue;let x=i[d][4],A=this.options.attributeNamePrefix+b;if(b.length)if(this.options.transformAttributeName&&(A=this.options.transformAttributeName(A)),"__proto__"===A&&(A="#__proto__"),void 0!==x){this.options.trimValues&&(x=x.trim()),x=this.replaceEntitiesValue(x);const O=this.options.attributeValueProcessor(b,x,t);a[A]=null==O?x:typeof O!=typeof x||O!==x?O:cR(x,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(a[A]=!0)}if(!Object.keys(a).length)return;if(this.options.attributesGroupName){const d={};return d[this.options.attributesGroupName]=a,d}return a}}const o9=function(n){n=n.replace(/\r\n?/g,"\n");const t=new x1("!xml");let e=t,i="",r="";for(let a=0;a<n.length;a++)if("<"===n[a])if("/"===n[a+1]){const b=N_(n,">",a,"Closing Tag is not closed.");let x=n.substring(a+2,b).trim();if(this.options.removeNSPrefix){const B=x.indexOf(":");-1!==B&&(x=x.substr(B+1))}this.options.transformTagName&&(x=this.options.transformTagName(x)),e&&(i=this.saveTextToParentTag(i,e,r));const A=r.substring(r.lastIndexOf(".")+1);if(x&&-1!==this.options.unpairedTags.indexOf(x))throw new Error(`Unpaired tag can not be used as closing tag: </${x}>`);let O=0;A&&-1!==this.options.unpairedTags.indexOf(A)?(O=r.lastIndexOf(".",r.lastIndexOf(".")-1),this.tagsNodeStack.pop()):O=r.lastIndexOf("."),r=r.substring(0,O),e=this.tagsNodeStack.pop(),i="",a=b}else if("?"===n[a+1]){let b=lR(n,a,!1,"?>");if(!b)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,e,r),!(this.options.ignoreDeclaration&&"?xml"===b.tagName||this.options.ignorePiTags)){const x=new x1(b.tagName);x.add(this.options.textNodeName,""),b.tagName!==b.tagExp&&b.attrExpPresent&&(x[":@"]=this.buildAttributesMap(b.tagExp,r,b.tagName)),this.addChild(e,x,r)}a=b.closeIndex+1}else if("!--"===n.substr(a+1,3)){const b=N_(n,"--\x3e",a+4,"Comment is not closed.");if(this.options.commentPropName){const x=n.substring(a+4,b-2);i=this.saveTextToParentTag(i,e,r),e.add(this.options.commentPropName,[{[this.options.textNodeName]:x}])}a=b}else if("!D"===n.substr(a+1,2)){const b=N7(n,a);this.docTypeEntities=b.entities,a=b.i}else if("!["===n.substr(a+1,2)){const b=N_(n,"]]>",a,"CDATA is not closed.")-2,x=n.substring(a+9,b);i=this.saveTextToParentTag(i,e,r);let A=this.parseTextData(x,e.tagname,r,!0,!1,!0,!0);null==A&&(A=""),this.options.cdataPropName?e.add(this.options.cdataPropName,[{[this.options.textNodeName]:x}]):e.add(this.options.textNodeName,A),a=b+2}else{let b=lR(n,a,this.options.removeNSPrefix),x=b.tagName;const A=b.rawTagName;let O=b.tagExp,B=b.attrExpPresent,X=b.closeIndex;this.options.transformTagName&&(x=this.options.transformTagName(x)),e&&i&&"!xml"!==e.tagname&&(i=this.saveTextToParentTag(i,e,r,!1));const te=e;if(te&&-1!==this.options.unpairedTags.indexOf(te.tagname)&&(e=this.tagsNodeStack.pop(),r=r.substring(0,r.lastIndexOf("."))),x!==t.tagname&&(r+=r?"."+x:x),this.isItStopNode(this.options.stopNodes,r,x)){let se="";if(O.length>0&&O.lastIndexOf("/")===O.length-1)"/"===x[x.length-1]?(x=x.substr(0,x.length-1),r=r.substr(0,r.length-1),O=x):O=O.substr(0,O.length-1),a=b.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(x))a=b.closeIndex;else{const ye=this.readStopNodeData(n,A,X+1);if(!ye)throw new Error(`Unexpected end of ${A}`);a=ye.i,se=ye.tagContent}const me=new x1(x);x!==O&&B&&(me[":@"]=this.buildAttributesMap(O,r,x)),se&&(se=this.parseTextData(se,x,r,!0,B,!0,!0)),r=r.substr(0,r.lastIndexOf(".")),me.add(this.options.textNodeName,se),this.addChild(e,me,r)}else{if(O.length>0&&O.lastIndexOf("/")===O.length-1){"/"===x[x.length-1]?(x=x.substr(0,x.length-1),r=r.substr(0,r.length-1),O=x):O=O.substr(0,O.length-1),this.options.transformTagName&&(x=this.options.transformTagName(x));const se=new x1(x);x!==O&&B&&(se[":@"]=this.buildAttributesMap(O,r,x)),this.addChild(e,se,r),r=r.substr(0,r.lastIndexOf("."))}else{const se=new x1(x);this.tagsNodeStack.push(e),x!==O&&B&&(se[":@"]=this.buildAttributesMap(O,r,x)),this.addChild(e,se,r),e=se}i="",a=X}}else i+=n[a];return t.child};function s9(n,t,e){const i=this.options.updateTag(t.tagname,e,t[":@"]);!1===i||("string"==typeof i&&(t.tagname=i),n.addChild(t))}const a9=function(n){if(this.options.processEntities){for(let t in this.docTypeEntities){const e=this.docTypeEntities[t];n=n.replace(e.regx,e.val)}for(let t in this.lastEntities){const e=this.lastEntities[t];n=n.replace(e.regex,e.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const e=this.htmlEntities[t];n=n.replace(e.regex,e.val)}n=n.replace(this.ampEntity.regex,this.ampEntity.val)}return n};function l9(n,t,e,i){return n&&(void 0===i&&(i=0===t.child.length),void 0!==(n=this.parseTextData(n,t.tagname,e,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,i))&&""!==n&&t.add(this.options.textNodeName,n),n=""),n}function c9(n,t,e){const i="*."+e;for(const r in n){const a=n[r];if(i===a||t===a)return!0}return!1}function N_(n,t,e,i){const r=n.indexOf(t,e);if(-1===r)throw new Error(i);return r+t.length-1}function lR(n,t,e,i=">"){const r=function u9(n,t,e=">"){let i,r="";for(let a=t;a<n.length;a++){let d=n[a];if(i)d===i&&(i="");else if('"'===d||"'"===d)i=d;else if(d===e[0]){if(!e[1])return{data:r,index:a};if(n[a+1]===e[1])return{data:r,index:a}}else"\t"===d&&(d=" ");r+=d}}(n,t+1,i);if(!r)return;let a=r.data;const d=r.index,b=a.search(/\s/);let x=a,A=!0;-1!==b&&(x=a.substring(0,b),a=a.substring(b+1).trimStart());const O=x;if(e){const B=x.indexOf(":");-1!==B&&(x=x.substr(B+1),A=x!==r.data.substr(B+1))}return{tagName:x,tagExp:a,closeIndex:d,attrExpPresent:A,rawTagName:O}}function d9(n,t,e){const i=e;let r=1;for(;e<n.length;e++)if("<"===n[e])if("/"===n[e+1]){const a=N_(n,">",e,`${t} is not closed`);if(n.substring(e+2,a).trim()===t&&(r--,0===r))return{tagContent:n.substring(i,e),i:a};e=a}else if("?"===n[e+1])e=N_(n,"?>",e+1,"StopNode is not closed.");else if("!--"===n.substr(e+1,3))e=N_(n,"--\x3e",e+3,"StopNode is not closed.");else if("!["===n.substr(e+1,2))e=N_(n,"]]>",e,"StopNode is not closed.")-2;else{const a=lR(n,e,">");a&&((a&&a.tagName)===t&&"/"!==a.tagExp[a.tagExp.length-1]&&r++,e=a.closeIndex)}}function cR(n,t,e){if(t&&"string"==typeof n){const i=n.trim();return"true"===i||"false"!==i&&function X7(n,t={}){if(t=Object.assign({},W7,t),!n||"string"!=typeof n)return n;let e=n.trim();if(void 0!==t.skipLike&&t.skipLike.test(e))return n;if("0"===n)return 0;if(t.hex&&G7.test(e))return function K7(n,t){if(parseInt)return parseInt(n,t);if(Number.parseInt)return Number.parseInt(n,t);if(window&&window.parseInt)return window.parseInt(n,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}(e,16);if(-1!==e.search(/.+[eE].+/))return function Y7(n,t,e){if(!e.eNotation)return n;const i=t.match(Z7);if(i){let r=i[1]||"";const a=-1===i[3].indexOf("e")?"E":"e",d=i[2],b=r?n[d.length+1]===a:n[d.length]===a;return d.length>1&&b?n:1!==d.length||!i[3].startsWith(`.${a}`)&&i[3][0]!==a?e.leadingZeros&&!b?(t=(i[1]||"")+i[3],Number(t)):n:Number(t)}return n}(n,e,t);{const i=$7.exec(e);if(i){const r=i[1]||"",a=i[2];let d=function J7(n){return n&&-1!==n.indexOf(".")&&("."===(n=n.replace(/0+$/,""))?n="0":"."===n[0]?n="0"+n:"."===n[n.length-1]&&(n=n.substring(0,n.length-1))),n}(i[3]);const b=r?"."===n[a.length+1]:"."===n[a.length];if(!t.leadingZeros&&(a.length>1||1===a.length&&!b))return n;{const x=Number(e),A=String(x);if(0===x)return x;if(-1!==A.search(/[eE]/))return t.eNotation?x:n;if(-1!==e.indexOf("."))return"0"===A||A===d||A===`${r}${d}`?x:n;let O=a?d:e;return a?O===A||r+O===A?x:n:O===A||O===r+A?x:n}}return n}}(n,e)}return function C7(n){return void 0!==n}(n)?n:""}function h9(n,t){return h3(n,t)}function h3(n,t,e){let i;const r={};for(let a=0;a<n.length;a++){const d=n[a],b=p9(d);let x="";if(x=void 0===e?b:e+"."+b,b===t.textNodeName)void 0===i?i=d[b]:i+=""+d[b];else{if(void 0===b)continue;if(d[b]){let A=h3(d[b],t,x);const O=m9(A,t);d[":@"]?f9(A,d[":@"],x,t):1!==Object.keys(A).length||void 0===A[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(A).length&&(t.alwaysCreateTextNode?A[t.textNodeName]="":A=""):A=A[t.textNodeName],void 0!==r[b]&&r.hasOwnProperty(b)?(Array.isArray(r[b])||(r[b]=[r[b]]),r[b].push(A)):r[b]=t.isArray(b,x,O)?[A]:A}}}return"string"==typeof i?i.length>0&&(r[t.textNodeName]=i):void 0!==i&&(r[t.textNodeName]=i),r}function p9(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const i=t[e];if(":@"!==i)return i}}function f9(n,t,e,i){if(t){const r=Object.keys(t),a=r.length;for(let d=0;d<a;d++){const b=r[d];n[b]=i.isArray(b,e+"."+b,!0,!0)?[t[b]]:t[b]}}}function m9(n,t){const{textNodeName:e}=t,i=Object.keys(n).length;return!(0!==i&&(1!==i||!n[e]&&"boolean"!=typeof n[e]&&0!==n[e]))}class g9{constructor(t){this.externalEntities={},this.options=Object.assign({},O7,t)}parse(t,e){if("string"!=typeof t){if(!t.toString)throw new Error("XML data is accepted in String or Bytes[] form.");t=t.toString()}if(e){!0===e&&(e={});const a=function s3(n,t){t=Object.assign({},D7,t);const e=[];let i=!1,r=!1;"\ufeff"===n[0]&&(n=n.substr(1));for(let a=0;a<n.length;a++)if("<"===n[a]&&"?"===n[a+1]){if(a+=2,a=l3(n,a),a.err)return a}else{if("<"!==n[a]){if(a3(n[a]))continue;return na("InvalidChar","char '"+n[a]+"' is not expected.",Xl(n,a))}{let d=a;if(a++,"!"===n[a]){a=c3(n,a);continue}{let b=!1;"/"===n[a]&&(b=!0,a++);let x="";for(;a<n.length&&">"!==n[a]&&" "!==n[a]&&"\t"!==n[a]&&"\n"!==n[a]&&"\r"!==n[a];a++)x+=n[a];if(x=x.trim(),"/"===x[x.length-1]&&(x=x.substring(0,x.length-1),a--),!L7(x)){let B;return B=0===x.trim().length?"Invalid space after '<'.":"Tag '"+x+"' is an invalid name.",na("InvalidTag",B,Xl(n,a))}const A=M7(n,a);if(!1===A)return na("InvalidAttr","Attributes for '"+x+"' have open quote.",Xl(n,a));let O=A.value;if(a=A.index,"/"===O[O.length-1]){const B=a-O.length;O=O.substring(0,O.length-1);const X=u3(O,t);if(!0!==X)return na(X.err.code,X.err.msg,Xl(n,B+X.err.line));i=!0}else if(b){if(!A.tagClosed)return na("InvalidTag","Closing tag '"+x+"' doesn't have proper closing.",Xl(n,a));if(O.trim().length>0)return na("InvalidTag","Closing tag '"+x+"' can't have attributes or invalid starting.",Xl(n,d));if(0===e.length)return na("InvalidTag","Closing tag '"+x+"' has not been opened.",Xl(n,d));{const B=e.pop();if(x!==B.tagName){let X=Xl(n,B.tagStartPos);return na("InvalidTag","Expected closing tag '"+B.tagName+"' (opened in line "+X.line+", col "+X.col+") instead of closing tag '"+x+"'.",Xl(n,d))}0==e.length&&(r=!0)}}else{const B=u3(O,t);if(!0!==B)return na(B.err.code,B.err.msg,Xl(n,a-O.length+B.err.line));if(!0===r)return na("InvalidXml","Multiple possible root nodes found.",Xl(n,a));-1!==t.unpairedTags.indexOf(x)||e.push({tagName:x,tagStartPos:d}),i=!0}for(a++;a<n.length;a++)if("<"===n[a]){if("!"===n[a+1]){a++,a=c3(n,a);continue}if("?"!==n[a+1])break;if(a=l3(n,++a),a.err)return a}else if("&"===n[a]){const B=P7(n,a);if(-1==B)return na("InvalidChar","char '&' is not expected.",Xl(n,a));a=B}else if(!0===r&&!a3(n[a]))return na("InvalidXml","Extra text at the end",Xl(n,a));"<"===n[a]&&a--}}}return i?1==e.length?na("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",Xl(n,e[0].tagStartPos)):!(e.length>0)||na("InvalidXml","Invalid '"+JSON.stringify(e.map(a=>a.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):na("InvalidXml","Start tag expected.",1)}(t,e);if(!0!==a)throw Error(`${a.err.msg}:${a.err.line}:${a.err.col}`)}const i=new Q7(this.options);i.addExternalEntities(this.externalEntities);const r=i.parseXml(t);return this.options.preserveOrder||void 0===r?r:h9(r,this.options)}addEntity(t,e){if(-1!==e.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==t.indexOf("&")||-1!==t.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===e)throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=e}}function b9(n,t){let e="";return t.format&&t.indentBy.length>0&&(e="\n"),p3(n,t,"",e)}function p3(n,t,e,i){let r="",a=!1;for(let d=0;d<n.length;d++){const b=n[d],x=y9(b);if(void 0===x)continue;let A="";if(A=0===e.length?x:`${e}.${x}`,x===t.textNodeName){let se=b[x];v9(A,t)||(se=t.tagValueProcessor(x,se),se=m3(se,t)),a&&(r+=i),r+=se,a=!1;continue}if(x===t.cdataPropName){a&&(r+=i),r+=`<![CDATA[${b[x][0][t.textNodeName]}]]>`,a=!1;continue}if(x===t.commentPropName){r+=i+`\x3c!--${b[x][0][t.textNodeName]}--\x3e`,a=!0;continue}if("?"===x[0]){const se=f3(b[":@"],t);let ye=b[x][0][t.textNodeName];ye=0!==ye.length?" "+ye:"",r+=("?xml"===x?"":i)+`<${x}${ye}${se}?>`,a=!0;continue}let O=i;""!==O&&(O+=t.indentBy);const X=i+`<${x}${f3(b[":@"],t)}`,te=p3(b[x],t,A,O);-1!==t.unpairedTags.indexOf(x)?r+=t.suppressUnpairedNode?X+">":X+"/>":te&&0!==te.length||!t.suppressEmptyNode?te&&te.endsWith(">")?r+=X+`>${te}${i}</${x}>`:(r+=X+">",te&&""!==i&&(te.includes("/>")||te.includes("</"))?r+=i+t.indentBy+te+i:r+=te,r+=`</${x}>`):r+=X+"/>",a=!0}return r}function y9(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const i=t[e];if(n.hasOwnProperty(i)&&":@"!==i)return i}}function f3(n,t){let e="";if(n&&!t.ignoreAttributes)for(let i in n){if(!n.hasOwnProperty(i))continue;let r=t.attributeValueProcessor(i,n[i]);r=m3(r,t),e+=!0===r&&t.suppressBooleanAttributes?` ${i.substr(t.attributeNamePrefix.length)}`:` ${i.substr(t.attributeNamePrefix.length)}="${r}"`}return e}function v9(n,t){let e=(n=n.substr(0,n.length-t.textNodeName.length-1)).substr(n.lastIndexOf(".")+1);for(let i in t.stopNodes)if(t.stopNodes[i]===n||t.stopNodes[i]==="*."+e)return!0;return!1}function m3(n,t){if(n&&n.length>0&&t.processEntities)for(let e=0;e<t.entities.length;e++){const i=t.entities[e];n=n.replace(i.regex,i.val)}return n}const x9={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(n,t){return t},attributeValueProcessor:function(n,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function qm(n){this.options=Object.assign({},x9,n),!0===this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=d3(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=T9),this.processTextOrObjNode=w9,this.options.format?(this.indentate=S9,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function w9(n,t,e,i){const r=this.j2x(n,e+1,i.concat(t));return void 0!==n[this.options.textNodeName]&&1===Object.keys(n).length?this.buildTextValNode(n[this.options.textNodeName],t,r.attrStr,e):this.buildObjectNode(r.val,t,r.attrStr,e)}function S9(n){return this.options.indentBy.repeat(n)}function T9(n){return!(!n.startsWith(this.options.attributeNamePrefix)||n===this.options.textNodeName)&&n.substr(this.attrPrefixLen)}function g3(n,t){return function(){return n.apply(t,arguments)}}qm.prototype.build=function(n){return this.options.preserveOrder?b9(n,this.options):(Array.isArray(n)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(n={[this.options.arrayNodeName]:n}),this.j2x(n,0,[]).val)},qm.prototype.j2x=function(n,t,e){let i="",r="";const a=e.join(".");for(let d in n)if(Object.prototype.hasOwnProperty.call(n,d))if(void 0===n[d])this.isAttribute(d)&&(r+="");else if(null===n[d])this.isAttribute(d)||d===this.options.cdataPropName?r+="":r+="?"===d[0]?this.indentate(t)+"<"+d+"?"+this.tagEndChar:this.indentate(t)+"<"+d+"/"+this.tagEndChar;else if(n[d]instanceof Date)r+=this.buildTextValNode(n[d],d,"",t);else if("object"!=typeof n[d]){const b=this.isAttribute(d);if(b&&!this.ignoreAttributesFn(b,a))i+=this.buildAttrPairStr(b,""+n[d]);else if(!b)if(d===this.options.textNodeName){let x=this.options.tagValueProcessor(d,""+n[d]);r+=this.replaceEntitiesValue(x)}else r+=this.buildTextValNode(n[d],d,"",t)}else if(Array.isArray(n[d])){const b=n[d].length;let x="",A="";for(let O=0;O<b;O++){const B=n[d][O];if(void 0!==B)if(null===B)r+="?"===d[0]?this.indentate(t)+"<"+d+"?"+this.tagEndChar:this.indentate(t)+"<"+d+"/"+this.tagEndChar;else if("object"==typeof B)if(this.options.oneListGroup){const X=this.j2x(B,t+1,e.concat(d));x+=X.val,this.options.attributesGroupName&&B.hasOwnProperty(this.options.attributesGroupName)&&(A+=X.attrStr)}else x+=this.processTextOrObjNode(B,d,t,e);else if(this.options.oneListGroup){let X=this.options.tagValueProcessor(d,B);X=this.replaceEntitiesValue(X),x+=X}else x+=this.buildTextValNode(B,d,"",t)}this.options.oneListGroup&&(x=this.buildObjectNode(x,d,A,t)),r+=x}else if(this.options.attributesGroupName&&d===this.options.attributesGroupName){const b=Object.keys(n[d]),x=b.length;for(let A=0;A<x;A++)i+=this.buildAttrPairStr(b[A],""+n[d][b[A]])}else r+=this.processTextOrObjNode(n[d],d,t,e);return{attrStr:i,val:r}},qm.prototype.buildAttrPairStr=function(n,t){return t=this.options.attributeValueProcessor(n,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+n:" "+n+'="'+t+'"'},qm.prototype.buildObjectNode=function(n,t,e,i){if(""===n)return"?"===t[0]?this.indentate(i)+"<"+t+e+"?"+this.tagEndChar:this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar;{let r="</"+t+this.tagEndChar,a="";return"?"===t[0]&&(a="?",r=""),!e&&""!==e||-1!==n.indexOf("<")?!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===a.length?this.indentate(i)+`\x3c!--${n}--\x3e`+this.newLine:this.indentate(i)+"<"+t+e+a+this.tagEndChar+n+this.indentate(i)+r:this.indentate(i)+"<"+t+e+a+">"+n+r}},qm.prototype.closeTag=function(n){let t="";return-1!==this.options.unpairedTags.indexOf(n)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${n}`,t},qm.prototype.buildTextValNode=function(n,t,e,i){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${n}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(i)+`\x3c!--${n}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(i)+"<"+t+e+"?"+this.tagEndChar;{let r=this.options.tagValueProcessor(t,n);return r=this.replaceEntitiesValue(r),""===r?this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar:this.indentate(i)+"<"+t+e+">"+r+"</"+t+this.tagEndChar}},qm.prototype.replaceEntitiesValue=function(n){if(n&&n.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const e=this.options.entities[t];n=n.replace(e.regex,e.val)}return n};const{toString:C9}=Object.prototype,{getPrototypeOf:uR}=Object,SC=(n=Object.create(null),t=>{const e=C9.call(t);return n[e]||(n[e]=e.slice(8,-1).toLowerCase())}),Rd=n=>(n=n.toLowerCase(),t=>SC(t)===n),TC=n=>t=>typeof t===n,{isArray:dv}=Array,w1=TC("undefined");var n;const _3=Rd("ArrayBuffer"),I9=TC("string"),ru=TC("function"),b3=TC("number"),CC=n=>null!==n&&"object"==typeof n,DC=n=>{if("object"!==SC(n))return!1;const t=uR(n);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in n||Symbol.iterator in n)},A9=Rd("Date"),R9=Rd("File"),P9=Rd("Blob"),k9=Rd("FileList"),F9=Rd("URLSearchParams"),[N9,B9,z9,V9]=["ReadableStream","Request","Response","Headers"].map(Rd);function S1(n,t,{allOwnKeys:e=!1}={}){if(null==n)return;let i,r;if("object"!=typeof n&&(n=[n]),dv(n))for(i=0,r=n.length;i<r;i++)t.call(null,n[i],i,n);else{const a=e?Object.getOwnPropertyNames(n):Object.keys(n),d=a.length;let b;for(i=0;i<d;i++)b=a[i],t.call(null,n[b],b,n)}}function y3(n,t){t=t.toLowerCase();const e=Object.keys(n);let r,i=e.length;for(;i-- >0;)if(r=e[i],t===r.toLowerCase())return r;return null}const B_="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,v3=n=>!w1(n)&&n!==B_,X9=(n=>t=>n&&t instanceof n)("undefined"!=typeof Uint8Array&&uR(Uint8Array)),J9=Rd("HTMLFormElement"),x3=(({hasOwnProperty:n})=>(t,e)=>n.call(t,e))(Object.prototype),Q9=Rd("RegExp"),w3=(n,t)=>{const e=Object.getOwnPropertyDescriptors(n),i={};S1(e,(r,a)=>{let d;!1!==(d=t(r,a,n))&&(i[a]=d||r)}),Object.defineProperties(n,i)},sX=Rd("AsyncFunction"),S3=((n,t)=>{return n?setImmediate:t?(e=`axios@${Math.random()}`,i=[],B_.addEventListener("message",({source:r,data:a})=>{r===B_&&a===e&&i.length&&i.shift()()},!1),r=>{i.push(r),B_.postMessage(e,"*")}):e=>setTimeout(e);var e,i})("function"==typeof setImmediate,ru(B_.postMessage)),lX="undefined"!=typeof queueMicrotask?queueMicrotask.bind(B_):"undefined"!=typeof process&&process.nextTick||S3,on={isArray:dv,isArrayBuffer:_3,isBuffer:function D9(n){return null!==n&&!w1(n)&&null!==n.constructor&&!w1(n.constructor)&&ru(n.constructor.isBuffer)&&n.constructor.isBuffer(n)},isFormData:n=>{let t;return n&&("function"==typeof FormData&&n instanceof FormData||ru(n.append)&&("formdata"===(t=SC(n))||"object"===t&&ru(n.toString)&&"[object FormData]"===n.toString()))},isArrayBufferView:function E9(n){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer&&_3(n.buffer),t},isString:I9,isNumber:b3,isBoolean:n=>!0===n||!1===n,isObject:CC,isPlainObject:DC,isReadableStream:N9,isRequest:B9,isResponse:z9,isHeaders:V9,isUndefined:w1,isDate:A9,isFile:R9,isBlob:P9,isRegExp:Q9,isFunction:ru,isStream:n=>CC(n)&&ru(n.pipe),isURLSearchParams:F9,isTypedArray:X9,isFileList:k9,forEach:S1,merge:function dR(){const{caseless:n}=v3(this)&&this||{},t={},e=(i,r)=>{const a=n&&y3(t,r)||r;t[a]=DC(t[a])&&DC(i)?dR(t[a],i):DC(i)?dR({},i):dv(i)?i.slice():i};for(let i=0,r=arguments.length;i<r;i++)arguments[i]&&S1(arguments[i],e);return t},extend:(n,t,e,{allOwnKeys:i}={})=>(S1(t,(r,a)=>{n[a]=e&&ru(r)?g3(r,e):r},{allOwnKeys:i}),n),trim:n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:n=>(65279===n.charCodeAt(0)&&(n=n.slice(1)),n),inherits:(n,t,e,i)=>{n.prototype=Object.create(t.prototype,i),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:t.prototype}),e&&Object.assign(n.prototype,e)},toFlatObject:(n,t,e,i)=>{let r,a,d;const b={};if(t=t||{},null==n)return t;do{for(r=Object.getOwnPropertyNames(n),a=r.length;a-- >0;)d=r[a],(!i||i(d,n,t))&&!b[d]&&(t[d]=n[d],b[d]=!0);n=!1!==e&&uR(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},kindOf:SC,kindOfTest:Rd,endsWith:(n,t,e)=>{n=String(n),(void 0===e||e>n.length)&&(e=n.length);const i=n.indexOf(t,e-=t.length);return-1!==i&&i===e},toArray:n=>{if(!n)return null;if(dv(n))return n;let t=n.length;if(!b3(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=n[t];return e},forEachEntry:(n,t)=>{const i=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=i.next())&&!r.done;){const a=r.value;t.call(n,a[0],a[1])}},matchAll:(n,t)=>{let e;const i=[];for(;null!==(e=n.exec(t));)i.push(e);return i},isHTMLForm:J9,hasOwnProperty:x3,hasOwnProp:x3,reduceDescriptors:w3,freezeMethods:n=>{w3(n,(t,e)=>{if(ru(n)&&-1!==["arguments","caller","callee"].indexOf(e))return!1;if(ru(n[e])){if(t.enumerable=!1,"writable"in t)return void(t.writable=!1);t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},toObjectSet:(n,t)=>{const e={},i=r=>{r.forEach(a=>{e[a]=!0})};return dv(n)?i(n):i(String(n).split(t)),e},toCamelCase:n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,i,r){return i.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(n,t)=>null!=n&&Number.isFinite(n=+n)?n:t,findKey:y3,global:B_,isContextDefined:v3,isSpecCompliantForm:function rX(n){return!!(n&&ru(n.append)&&"FormData"===n[Symbol.toStringTag]&&n[Symbol.iterator])},toJSONObject:n=>{const t=new Array(10),e=(i,r)=>{if(CC(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[r]=i;const a=dv(i)?[]:{};return S1(i,(d,b)=>{const x=e(d,r+1);!w1(x)&&(a[b]=x)}),t[r]=void 0,a}}return i};return e(n,0)},isAsyncFn:sX,isThenable:n=>n&&(CC(n)||ru(n))&&ru(n.then)&&ru(n.catch),setImmediate:S3,asap:lX};function hv(n,t,e,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=n,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}on.inherits(hv,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:on.toJSONObject(this.config),code:this.code,status:this.status}}});const T3=hv.prototype,C3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{C3[n]={value:n}}),Object.defineProperties(hv,C3),Object.defineProperty(T3,"isAxiosError",{value:!0}),hv.from=(n,t,e,i,r,a)=>{const d=Object.create(T3);return on.toFlatObject(n,d,function(x){return x!==Error.prototype},b=>"isAxiosError"!==b),hv.call(d,n.message,t,e,i,r),d.cause=n,d.name=n.name,a&&Object.assign(d,a),d};const so=hv;function hR(n){return on.isPlainObject(n)||on.isArray(n)}function E3(n){return on.endsWith(n,"[]")?n.slice(0,-2):n}function I3(n,t,e){return n?n.concat(t).map(function(r,a){return r=E3(r),!e&&a?"["+r+"]":r}).join(e?".":""):t}const uX=on.toFlatObject(on,{},null,function(t){return/^is[A-Z]/.test(t)}),EC=function dX(n,t,e){if(!on.isObject(n))throw new TypeError("target must be an object");t=t||new FormData;const i=(e=on.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(me,ye){return!on.isUndefined(ye[me])})).metaTokens,r=e.visitor||O,a=e.dots,d=e.indexes,x=(e.Blob||"undefined"!=typeof Blob&&Blob)&&on.isSpecCompliantForm(t);if(!on.isFunction(r))throw new TypeError("visitor must be a function");function A(se){if(null===se)return"";if(on.isDate(se))return se.toISOString();if(!x&&on.isBlob(se))throw new so("Blob is not supported. Use a Buffer instead.");return on.isArrayBuffer(se)||on.isTypedArray(se)?x&&"function"==typeof Blob?new Blob([se]):Buffer.from(se):se}function O(se,me,ye){let $e=se;if(se&&!ye&&"object"==typeof se)if(on.endsWith(me,"{}"))me=i?me:me.slice(0,-2),se=JSON.stringify(se);else if(on.isArray(se)&&function cX(n){return on.isArray(n)&&!n.some(hR)}(se)||(on.isFileList(se)||on.endsWith(me,"[]"))&&($e=on.toArray(se)))return me=E3(me),$e.forEach(function(Qe,At){!on.isUndefined(Qe)&&null!==Qe&&t.append(!0===d?I3([me],At,a):null===d?me:me+"[]",A(Qe))}),!1;return!!hR(se)||(t.append(I3(ye,me,a),A(se)),!1)}const B=[],X=Object.assign(uX,{defaultVisitor:O,convertValue:A,isVisitable:hR});if(!on.isObject(n))throw new TypeError("data must be an object");return function te(se,me){if(!on.isUndefined(se)){if(-1!==B.indexOf(se))throw Error("Circular reference detected in "+me.join("."));B.push(se),on.forEach(se,function($e,ht){!0===(!(on.isUndefined($e)||null===$e)&&r.call(t,$e,on.isString(ht)?ht.trim():ht,me,X))&&te($e,me?me.concat(ht):[ht])}),B.pop()}}(n),t};function M3(n){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function A3(n,t){this._pairs=[],n&&EC(n,this,t)}const R3=A3.prototype;R3.append=function(t,e){this._pairs.push([t,e])},R3.toString=function(t){const e=t?function(i){return t.call(this,i,M3)}:M3;return this._pairs.map(function(r){return e(r[0])+"="+e(r[1])},"").join("&")};const P3=A3;function hX(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function k3(n,t,e){if(!t)return n;const i=e&&e.encode||hX;on.isFunction(e)&&(e={serialize:e});const r=e&&e.serialize;let a;if(a=r?r(t,e):on.isURLSearchParams(t)?t.toString():new P3(t,e).toString(i),a){const d=n.indexOf("#");-1!==d&&(n=n.slice(0,d)),n+=(-1===n.indexOf("?")?"?":"&")+a}return n}const L3=class pX{constructor(){this.handlers=[]}use(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){on.forEach(this.handlers,function(i){null!==i&&t(i)})}},O3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},fX={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:P3,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},pR="undefined"!=typeof window&&"undefined"!=typeof document,fR="object"==typeof navigator&&navigator||void 0,mX=pR&&(!fR||["ReactNative","NativeScript","NS"].indexOf(fR.product)<0),gX="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,_X=pR&&window.location.href||"http://localhost",Tl={...tt,...fX},F3=function xX(n){function t(e,i,r,a){let d=e[a++];if("__proto__"===d)return!0;const b=Number.isFinite(+d),x=a>=e.length;return d=!d&&on.isArray(r)?r.length:d,x?(r[d]=on.hasOwnProp(r,d)?[r[d],i]:i,!b):((!r[d]||!on.isObject(r[d]))&&(r[d]=[]),t(e,i,r[d],a)&&on.isArray(r[d])&&(r[d]=function vX(n){const t={},e=Object.keys(n);let i;const r=e.length;let a;for(i=0;i<r;i++)a=e[i],t[a]=n[a];return t}(r[d])),!b)}if(on.isFormData(n)&&on.isFunction(n.entries)){const e={};return on.forEachEntry(n,(i,r)=>{t(function yX(n){return on.matchAll(/\w+|\[(\w*)]/g,n).map(t=>"[]"===t[0]?"":t[1]||t[0])}(i),r,e,0)}),e}return null},mR={transitional:O3,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const i=e.getContentType()||"",r=i.indexOf("application/json")>-1,a=on.isObject(t);if(a&&on.isHTMLForm(t)&&(t=new FormData(t)),on.isFormData(t))return r?JSON.stringify(F3(t)):t;if(on.isArrayBuffer(t)||on.isBuffer(t)||on.isStream(t)||on.isFile(t)||on.isBlob(t)||on.isReadableStream(t))return t;if(on.isArrayBufferView(t))return t.buffer;if(on.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let b;if(a){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function bX(n,t){return EC(n,new Tl.classes.URLSearchParams,Object.assign({visitor:function(e,i,r,a){return Tl.isNode&&on.isBuffer(e)?(this.append(i,e.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},t))}(t,this.formSerializer).toString();if((b=on.isFileList(t))||i.indexOf("multipart/form-data")>-1){const x=this.env&&this.env.FormData;return EC(b?{"files[]":t}:t,x&&new x,this.formSerializer)}}return a||r?(e.setContentType("application/json",!1),function wX(n,t,e){if(on.isString(n))try{return(t||JSON.parse)(n),on.trim(n)}catch(i){if("SyntaxError"!==i.name)throw i}return(e||JSON.stringify)(n)}(t)):t}],transformResponse:[function(t){const e=this.transitional||mR.transitional,i=e&&e.forcedJSONParsing,r="json"===this.responseType;if(on.isResponse(t)||on.isReadableStream(t))return t;if(t&&on.isString(t)&&(i&&!this.responseType||r)){const d=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(b){if(d)throw"SyntaxError"===b.name?so.from(b,so.ERR_BAD_RESPONSE,this,null,this.response):b}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Tl.classes.FormData,Blob:Tl.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};on.forEach(["delete","get","head","post","put","patch"],n=>{mR.headers[n]={}});const gR=mR,SX=on.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),N3=Symbol("internals");function T1(n){return n&&String(n).trim().toLowerCase()}function IC(n){return!1===n||null==n?n:on.isArray(n)?n.map(IC):String(n)}function _R(n,t,e,i,r){if(on.isFunction(i))return i.call(this,t,e);if(r&&(t=e),on.isString(t)){if(on.isString(i))return-1!==t.indexOf(i);if(on.isRegExp(i))return i.test(t)}}class MC{constructor(t){t&&this.set(t)}set(t,e,i){const r=this;function a(b,x,A){const O=T1(x);if(!O)throw new Error("header name must be a non-empty string");const B=on.findKey(r,O);(!B||void 0===r[B]||!0===A||void 0===A&&!1!==r[B])&&(r[B||x]=IC(b))}const d=(b,x)=>on.forEach(b,(A,O)=>a(A,O,x));if(on.isPlainObject(t)||t instanceof this.constructor)d(t,e);else if(on.isString(t)&&(t=t.trim())&&!(n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim()))(t))d((n=>{const t={};let e,i,r;return n&&n.split("\n").forEach(function(d){r=d.indexOf(":"),e=d.substring(0,r).trim().toLowerCase(),i=d.substring(r+1).trim(),!(!e||t[e]&&SX[e])&&("set-cookie"===e?t[e]?t[e].push(i):t[e]=[i]:t[e]=t[e]?t[e]+", "+i:i)}),t})(t),e);else if(on.isHeaders(t))for(const[b,x]of t.entries())a(x,b,i);else null!=t&&a(e,t,i);return this}get(t,e){if(t=T1(t)){const i=on.findKey(this,t);if(i){const r=this[i];if(!e)return r;if(!0===e)return function CX(n){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=e.exec(n);)t[i[1]]=i[2];return t}(r);if(on.isFunction(e))return e.call(this,r,i);if(on.isRegExp(e))return e.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=T1(t)){const i=on.findKey(this,t);return!(!i||void 0===this[i]||e&&!_R(0,this[i],i,e))}return!1}delete(t,e){const i=this;let r=!1;function a(d){if(d=T1(d)){const b=on.findKey(i,d);b&&(!e||_R(0,i[b],b,e))&&(delete i[b],r=!0)}}return on.isArray(t)?t.forEach(a):a(t),r}clear(t){const e=Object.keys(this);let i=e.length,r=!1;for(;i--;){const a=e[i];(!t||_R(0,this[a],a,t,!0))&&(delete this[a],r=!0)}return r}normalize(t){const e=this,i={};return on.forEach(this,(r,a)=>{const d=on.findKey(i,a);if(d)return e[d]=IC(r),void delete e[a];const b=t?function EX(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,i)=>e.toUpperCase()+i)}(a):String(a).trim();b!==a&&delete e[a],e[b]=IC(r),i[b]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return on.forEach(this,(i,r)=>{null!=i&&!1!==i&&(e[r]=t&&on.isArray(i)?i.join(", "):i)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const i=new this(t);return e.forEach(r=>i.set(r)),i}static accessor(t){const i=(this[N3]=this[N3]={accessors:{}}).accessors,r=this.prototype;function a(d){const b=T1(d);i[b]||(function IX(n,t){const e=on.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(n,i+e,{value:function(r,a,d){return this[i].call(this,t,r,a,d)},configurable:!0})})}(r,d),i[b]=!0)}return on.isArray(t)?t.forEach(a):a(t),this}}MC.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),on.reduceDescriptors(MC.prototype,({value:n},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(i){this[e]=i}}}),on.freezeMethods(MC);const Pd=MC;function bR(n,t){const e=this||gR,i=t||e,r=Pd.from(i.headers);let a=i.data;return on.forEach(n,function(b){a=b.call(e,a,r.normalize(),t?t.status:void 0)}),r.normalize(),a}function B3(n){return!(!n||!n.__CANCEL__)}function z3(n,t,e){so.call(this,null==n?"canceled":n,so.ERR_CANCELED,t,e),this.name="CanceledError"}on.inherits(z3,so,{__CANCEL__:!0});const C1=z3;function V3(n,t,e){const i=e.config.validateStatus;e.status&&i&&!i(e.status)?t(new so("Request failed with status code "+e.status,[so.ERR_BAD_REQUEST,so.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e)):n(e)}const AC=(n,t,e=3)=>{let i=0;const r=function AX(n,t){n=n||10;const e=new Array(n),i=new Array(n);let d,r=0,a=0;return t=void 0!==t?t:1e3,function(x){const A=Date.now(),O=i[a];d||(d=A),e[r]=x,i[r]=A;let B=a,X=0;for(;B!==r;)X+=e[B++],B%=n;if(r=(r+1)%n,r===a&&(a=(a+1)%n),A-d<t)return;const te=O&&A-O;return te?Math.round(1e3*X/te):void 0}}(50,250);return function PX(n,t){let r,a,e=0,i=1e3/t;const d=(A,O=Date.now())=>{e=O,r=null,a&&(clearTimeout(a),a=null),n.apply(null,A)};return[(...A)=>{const O=Date.now(),B=O-e;B>=i?d(A,O):(r=A,a||(a=setTimeout(()=>{a=null,d(r)},i-B)))},()=>r&&d(r)]}(a=>{const d=a.loaded,b=a.lengthComputable?a.total:void 0,x=d-i,A=r(x);i=d,n({loaded:d,total:b,progress:b?d/b:void 0,bytes:x,rate:A||void 0,estimated:A&&b&&d<=b?(b-d)/A:void 0,event:a,lengthComputable:null!=b,[t?"download":"upload"]:!0})},e)},j3=(n,t)=>{const e=null!=n;return[i=>t[0]({lengthComputable:e,total:n,loaded:i}),t[1]]},U3=n=>(...t)=>on.asap(()=>n(...t)),LX=Tl.hasStandardBrowserEnv?((n,t)=>e=>(e=new URL(e,Tl.origin),n.protocol===e.protocol&&n.host===e.host&&(t||n.port===e.port)))(new URL(Tl.origin),Tl.navigator&&/(msie|trident)/i.test(Tl.navigator.userAgent)):()=>!0,OX=Tl.hasStandardBrowserEnv?{write(n,t,e,i,r,a){const d=[n+"="+encodeURIComponent(t)];on.isNumber(e)&&d.push("expires="+new Date(e).toGMTString()),on.isString(i)&&d.push("path="+i),on.isString(r)&&d.push("domain="+r),!0===a&&d.push("secure"),document.cookie=d.join("; ")},read(n){const t=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function H3(n,t,e){let i=!function FX(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(t);return n&&i||0==e?function NX(n,t){return t?n.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):n}(n,t):t}const q3=n=>n instanceof Pd?{...n}:n;function z_(n,t){t=t||{};const e={};function i(A,O,B,X){return on.isPlainObject(A)&&on.isPlainObject(O)?on.merge.call({caseless:X},A,O):on.isPlainObject(O)?on.merge({},O):on.isArray(O)?O.slice():O}function r(A,O,B,X){return on.isUndefined(O)?on.isUndefined(A)?void 0:i(void 0,A,0,X):i(A,O,0,X)}function a(A,O){if(!on.isUndefined(O))return i(void 0,O)}function d(A,O){return on.isUndefined(O)?on.isUndefined(A)?void 0:i(void 0,A):i(void 0,O)}function b(A,O,B){return B in t?i(A,O):B in n?i(void 0,A):void 0}const x={url:a,method:a,data:a,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,withXSRFToken:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:b,headers:(A,O,B)=>r(q3(A),q3(O),0,!0)};return on.forEach(Object.keys(Object.assign({},n,t)),function(O){const B=x[O]||r,X=B(n[O],t[O],O);on.isUndefined(X)&&B!==b||(e[O]=X)}),e}const G3=n=>{const t=z_({},n);let x,{data:e,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:a,headers:d,auth:b}=t;if(t.headers=d=Pd.from(d),t.url=k3(H3(t.baseURL,t.url,t.allowAbsoluteUrls),n.params,n.paramsSerializer),b&&d.set("Authorization","Basic "+btoa((b.username||"")+":"+(b.password?unescape(encodeURIComponent(b.password)):""))),on.isFormData(e))if(Tl.hasStandardBrowserEnv||Tl.hasStandardBrowserWebWorkerEnv)d.setContentType(void 0);else if(!1!==(x=d.getContentType())){const[A,...O]=x?x.split(";").map(B=>B.trim()).filter(Boolean):[];d.setContentType([A||"multipart/form-data",...O].join("; "))}if(Tl.hasStandardBrowserEnv&&(i&&on.isFunction(i)&&(i=i(t)),i||!1!==i&&LX(t.url))){const A=r&&a&&OX.read(a);A&&d.set(r,A)}return t},BX="undefined"!=typeof XMLHttpRequest&&function(n){return new Promise(function(e,i){const r=G3(n);let a=r.data;const d=Pd.from(r.headers).normalize();let O,B,X,te,se,{responseType:b,onUploadProgress:x,onDownloadProgress:A}=r;function me(){te&&te(),se&&se(),r.cancelToken&&r.cancelToken.unsubscribe(O),r.signal&&r.signal.removeEventListener("abort",O)}let ye=new XMLHttpRequest;function $e(){if(!ye)return;const Qe=Pd.from("getAllResponseHeaders"in ye&&ye.getAllResponseHeaders());V3(function(Xn){e(Xn),me()},function(Xn){i(Xn),me()},{data:b&&"text"!==b&&"json"!==b?ye.response:ye.responseText,status:ye.status,statusText:ye.statusText,headers:Qe,config:n,request:ye}),ye=null}ye.open(r.method.toUpperCase(),r.url,!0),ye.timeout=r.timeout,"onloadend"in ye?ye.onloadend=$e:ye.onreadystatechange=function(){!ye||4!==ye.readyState||0===ye.status&&(!ye.responseURL||0!==ye.responseURL.indexOf("file:"))||setTimeout($e)},ye.onabort=function(){!ye||(i(new so("Request aborted",so.ECONNABORTED,n,ye)),ye=null)},ye.onerror=function(){i(new so("Network Error",so.ERR_NETWORK,n,ye)),ye=null},ye.ontimeout=function(){let At=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";r.timeoutErrorMessage&&(At=r.timeoutErrorMessage),i(new so(At,(r.transitional||O3).clarifyTimeoutError?so.ETIMEDOUT:so.ECONNABORTED,n,ye)),ye=null},void 0===a&&d.setContentType(null),"setRequestHeader"in ye&&on.forEach(d.toJSON(),function(At,fn){ye.setRequestHeader(fn,At)}),on.isUndefined(r.withCredentials)||(ye.withCredentials=!!r.withCredentials),b&&"json"!==b&&(ye.responseType=r.responseType),A&&([X,se]=AC(A,!0),ye.addEventListener("progress",X)),x&&ye.upload&&([B,te]=AC(x),ye.upload.addEventListener("progress",B),ye.upload.addEventListener("loadend",te)),(r.cancelToken||r.signal)&&(O=Qe=>{!ye||(i(!Qe||Qe.type?new C1(null,n,ye):Qe),ye.abort(),ye=null)},r.cancelToken&&r.cancelToken.subscribe(O),r.signal&&(r.signal.aborted?O():r.signal.addEventListener("abort",O)));const ht=function MX(n){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}(r.url);ht&&-1===Tl.protocols.indexOf(ht)?i(new so("Unsupported protocol "+ht+":",so.ERR_BAD_REQUEST,n)):ye.send(a||null)})},zX=(n,t)=>{const{length:e}=n=n?n.filter(Boolean):[];if(t||e){let r,i=new AbortController;const a=function(A){if(!r){r=!0,b();const O=A instanceof Error?A:this.reason;i.abort(O instanceof so?O:new C1(O instanceof Error?O.message:O))}};let d=t&&setTimeout(()=>{d=null,a(new so(`timeout ${t} of ms exceeded`,so.ETIMEDOUT))},t);const b=()=>{n&&(d&&clearTimeout(d),d=null,n.forEach(A=>{A.unsubscribe?A.unsubscribe(a):A.removeEventListener("abort",a)}),n=null)};n.forEach(A=>A.addEventListener("abort",a));const{signal:x}=i;return x.unsubscribe=()=>on.asap(b),x}};function $3(n){this.wrapped=n}function D1(n){var t,e;function r(d,b){try{var x=n[d](b),A=x.value,O=A instanceof $3;Promise.resolve(O?A.wrapped:A).then(function(B){O?r("return"===d?"return":"next",B):a(x.done?"return":"normal",B)},function(B){r("throw",B)})}catch(B){a("throw",B)}}function a(d,b){switch(d){case"return":t.resolve({value:b,done:!0});break;case"throw":t.reject(b);break;default:t.resolve({value:b,done:!1})}(t=t.next)?r(t.key,t.arg):e=null}this._invoke=function i(d,b){return new Promise(function(x,A){var O={key:d,arg:b,resolve:x,reject:A,next:null};e?e=e.next=O:(t=e=O,r(d,b))})},"function"!=typeof n.return&&(this.return=void 0)}function W3(n){return function(){return new D1(n.apply(this,arguments))}}function pv(n){return new $3(n)}function X3(n,t){var e={},i=!1;function r(a,d){return i=!0,d=new Promise(function(b){b(n[a](d))}),{done:!1,value:t(d)}}return e["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},e.next=function(a){return i?(i=!1,a):r("next",a)},"function"==typeof n.throw&&(e.throw=function(a){if(i)throw i=!1,a;return r("throw",a)}),"function"==typeof n.return&&(e.return=function(a){return i?(i=!1,a):r("return",a)}),e}function yR(n){var t,e,i,r=2;for("undefined"!=typeof Symbol&&(e=Symbol.asyncIterator,i=Symbol.iterator);r--;){if(e&&null!=(t=n[e]))return t.call(n);if(i&&null!=(t=n[i]))return new RC(t.call(n));e="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function RC(n){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var i=e.done;return Promise.resolve(e.value).then(function(r){return{value:r,done:i}})}return(RC=function(i){this.s=i,this.n=i.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var r=this.s.return;return void 0===r?Promise.resolve({value:i,done:!0}):t(r.apply(this.s,arguments))},throw:function(i){var r=this.s.return;return void 0===r?Promise.reject(i):t(r.apply(this.s,arguments))}},new RC(n)}D1.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},D1.prototype.next=function(n){return this._invoke("next",n)},D1.prototype.throw=function(n){return this._invoke("throw",n)},D1.prototype.return=function(n){return this._invoke("return",n)};const VX=function*(n,t){let e=n.byteLength;if(!t||e<t)return void(yield n);let r,i=0;for(;i<e;)r=i+t,yield n.slice(i,r),i=r},jX=function(){var n=W3(function*(t,e){var a,i=!1,r=!1;try{for(var b,d=yR(UX(t));i=!(b=yield pv(d.next())).done;i=!1){const x=b.value;yield*X3(yR(VX(x,e)),pv)}}catch(x){r=!0,a=x}finally{try{i&&null!=d.return&&(yield pv(d.return()))}finally{if(r)throw a}}});return function(e,i){return n.apply(this,arguments)}}(),UX=function(){var n=W3(function*(t){if(t[Symbol.asyncIterator])return void(yield*X3(yR(t),pv));const e=t.getReader();try{for(;;){const{done:i,value:r}=yield pv(e.read());if(i)break;yield r}}finally{yield pv(e.cancel())}});return function(e){return n.apply(this,arguments)}}(),Z3=(n,t,e,i)=>{const r=jX(n,t);let d,a=0,b=x=>{d||(d=!0,i&&i(x))};return new ReadableStream({pull:x=>mr(function*(){try{const{done:A,value:O}=yield r.next();if(A)return b(),void x.close();let B=O.byteLength;if(e){let X=a+=B;e(X)}x.enqueue(new Uint8Array(O))}catch(A){throw b(A),A}})(),cancel:x=>(b(x),r.return())},{highWaterMark:2})},PC="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,Y3=PC&&"function"==typeof ReadableStream,HX=PC&&("function"==typeof TextEncoder?(n=>t=>n.encode(t))(new TextEncoder):function(){var n=mr(function*(t){return new Uint8Array(yield new Response(t).arrayBuffer())});return function(t){return n.apply(this,arguments)}}()),J3=(n,...t)=>{try{return!!n(...t)}catch(e){return!1}},qX=Y3&&J3(()=>{let n=!1;const t=new Request(Tl.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!t}),vR=Y3&&J3(()=>on.isReadableStream(new Response("").body)),kC={stream:vR&&(n=>n.body)};PC&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!kC[t]&&(kC[t]=on.isFunction(n[t])?e=>e[t]():(e,i)=>{throw new so(`Response type '${t}' is not supported`,so.ERR_NOT_SUPPORT,i)})})})(new Response);const GX=function(){var n=mr(function*(t){return null==t?0:on.isBlob(t)?t.size:on.isSpecCompliantForm(t)?(yield new Request(Tl.origin,{method:"POST",body:t}).arrayBuffer()).byteLength:on.isArrayBufferView(t)||on.isArrayBuffer(t)?t.byteLength:(on.isURLSearchParams(t)&&(t+=""),on.isString(t)?(yield HX(t)).byteLength:void 0)});return function(e){return n.apply(this,arguments)}}(),$X=function(){var n=mr(function*(t,e){const i=on.toFiniteNumber(t.getContentLength());return null==i?GX(e):i});return function(e,i){return n.apply(this,arguments)}}(),xR={http:null,xhr:BX,fetch:PC&&function(){var n=mr(function*(t){let{url:e,method:i,data:r,signal:a,cancelToken:d,timeout:b,onDownloadProgress:x,onUploadProgress:A,responseType:O,headers:B,withCredentials:X="same-origin",fetchOptions:te}=G3(t);O=O?(O+"").toLowerCase():"text";let me,se=zX([a,d&&d.toAbortSignal()],b);const ye=se&&se.unsubscribe&&(()=>{se.unsubscribe()});let $e;try{if(A&&qX&&"get"!==i&&"head"!==i&&0!==($e=yield $X(B,r))){let Xn,qn=new Request(e,{method:"POST",body:r,duplex:"half"});if(on.isFormData(r)&&(Xn=qn.headers.get("content-type"))&&B.setContentType(Xn),qn.body){const[Ri,Yi]=j3($e,AC(U3(A)));r=Z3(qn.body,65536,Ri,Yi)}}on.isString(X)||(X=X?"include":"omit");const ht="credentials"in Request.prototype;me=new Request(e,{...te,signal:se,method:i.toUpperCase(),headers:B.normalize().toJSON(),body:r,duplex:"half",credentials:ht?X:void 0});let Qe=yield fetch(me);const At=vR&&("stream"===O||"response"===O);if(vR&&(x||At&&ye)){const qn={};["status","statusText","headers"].forEach(Ci=>{qn[Ci]=Qe[Ci]});const Xn=on.toFiniteNumber(Qe.headers.get("content-length")),[Ri,Yi]=x&&j3(Xn,AC(U3(x),!0))||[];Qe=new Response(Z3(Qe.body,65536,Ri,()=>{Yi&&Yi(),ye&&ye()}),qn)}O=O||"text";let fn=yield kC[on.findKey(kC,O)||"text"](Qe,t);return!At&&ye&&ye(),yield new Promise((qn,Xn)=>{V3(qn,Xn,{data:fn,headers:Pd.from(Qe.headers),status:Qe.status,statusText:Qe.statusText,config:t,request:me})})}catch(ht){throw ye&&ye(),ht&&"TypeError"===ht.name&&/fetch/i.test(ht.message)?Object.assign(new so("Network Error",so.ERR_NETWORK,t,me),{cause:ht.cause||ht}):so.from(ht,ht&&ht.code,t,me)}});return function(t){return n.apply(this,arguments)}}()};on.forEach(xR,(n,t)=>{if(n){try{Object.defineProperty(n,"name",{value:t})}catch(e){}Object.defineProperty(n,"adapterName",{value:t})}});const Q3=n=>`- ${n}`,WX=n=>on.isFunction(n)||null===n||!1===n,eB_getAdapter=n=>{n=on.isArray(n)?n:[n];const{length:t}=n;let e,i;const r={};for(let a=0;a<t;a++){let d;if(e=n[a],i=e,!WX(e)&&(i=xR[(d=String(e)).toLowerCase()],void 0===i))throw new so(`Unknown adapter '${d}'`);if(i)break;r[d||"#"+a]=i}if(!i){const a=Object.entries(r).map(([b,x])=>`adapter ${b} `+(!1===x?"is not supported by the environment":"is not available in the build"));let d=t?a.length>1?"since :\n"+a.map(Q3).join("\n"):" "+Q3(a[0]):"as no adapter specified";throw new so("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return i};function wR(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new C1(null,n)}function tB(n){return wR(n),n.headers=Pd.from(n.headers),n.data=bR.call(n,n.transformRequest),-1!==["post","put","patch"].indexOf(n.method)&&n.headers.setContentType("application/x-www-form-urlencoded",!1),eB_getAdapter(n.adapter||gR.adapter)(n).then(function(i){return wR(n),i.data=bR.call(n,n.transformResponse,i),i.headers=Pd.from(i.headers),i},function(i){return B3(i)||(wR(n),i&&i.response&&(i.response.data=bR.call(n,n.transformResponse,i.response),i.response.headers=Pd.from(i.response.headers))),Promise.reject(i)})}const LC={};["object","boolean","number","function","string","symbol"].forEach((n,t)=>{LC[n]=function(i){return typeof i===n||"a"+(t<1?"n ":" ")+n}});const iB={};LC.transitional=function(t,e,i){function r(a,d){return"[Axios v1.8.3] Transitional option '"+a+"'"+d+(i?". "+i:"")}return(a,d,b)=>{if(!1===t)throw new so(r(d," has been removed"+(e?" in "+e:"")),so.ERR_DEPRECATED);return e&&!iB[d]&&(iB[d]=!0,console.warn(r(d," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(a,d,b)}},LC.spelling=function(t){return(e,i)=>(console.warn(`${i} is likely a misspelling of ${t}`),!0)};const OC={assertOptions:function XX(n,t,e){if("object"!=typeof n)throw new so("options must be an object",so.ERR_BAD_OPTION_VALUE);const i=Object.keys(n);let r=i.length;for(;r-- >0;){const a=i[r],d=t[a];if(d){const b=n[a],x=void 0===b||d(b,a,n);if(!0!==x)throw new so("option "+a+" must be "+x,so.ERR_BAD_OPTION_VALUE)}else if(!0!==e)throw new so("Unknown option "+a,so.ERR_BAD_OPTION)}},validators:LC},Nh=OC.validators;class FC{constructor(t){this.defaults=t,this.interceptors={request:new L3,response:new L3}}request(t,e){var i=this;return mr(function*(){try{return yield i._request(t,e)}catch(r){if(r instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const d=a.stack?a.stack.replace(/^.+\n/,""):"";try{r.stack?d&&!String(r.stack).endsWith(d.replace(/^.+\n.+\n/,""))&&(r.stack+="\n"+d):r.stack=d}catch(b){}}throw r}})()}_request(t,e){"string"==typeof t?(e=e||{}).url=t:e=t||{},e=z_(this.defaults,e);const{transitional:i,paramsSerializer:r,headers:a}=e;void 0!==i&&OC.assertOptions(i,{silentJSONParsing:Nh.transitional(Nh.boolean),forcedJSONParsing:Nh.transitional(Nh.boolean),clarifyTimeoutError:Nh.transitional(Nh.boolean)},!1),null!=r&&(on.isFunction(r)?e.paramsSerializer={serialize:r}:OC.assertOptions(r,{encode:Nh.function,serialize:Nh.function},!0)),void 0!==e.allowAbsoluteUrls||(e.allowAbsoluteUrls=void 0===this.defaults.allowAbsoluteUrls||this.defaults.allowAbsoluteUrls),OC.assertOptions(e,{baseUrl:Nh.spelling("baseURL"),withXsrfToken:Nh.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let d=a&&on.merge(a.common,a[e.method]);a&&on.forEach(["delete","get","head","post","put","patch","common"],se=>{delete a[se]}),e.headers=Pd.concat(d,a);const b=[];let x=!0;this.interceptors.request.forEach(function(me){"function"==typeof me.runWhen&&!1===me.runWhen(e)||(x=x&&me.synchronous,b.unshift(me.fulfilled,me.rejected))});const A=[];this.interceptors.response.forEach(function(me){A.push(me.fulfilled,me.rejected)});let O,X,B=0;if(!x){const se=[tB.bind(this),void 0];for(se.unshift.apply(se,b),se.push.apply(se,A),X=se.length,O=Promise.resolve(e);B<X;)O=O.then(se[B++],se[B++]);return O}X=b.length;let te=e;for(B=0;B<X;){const se=b[B++],me=b[B++];try{te=se(te)}catch(ye){me.call(this,ye);break}}try{O=tB.call(this,te)}catch(se){return Promise.reject(se)}for(B=0,X=A.length;B<X;)O=O.then(A[B++],A[B++]);return O}getUri(t){return k3(H3((t=z_(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}}on.forEach(["delete","get","head","options"],function(t){FC.prototype[t]=function(e,i){return this.request(z_(i||{},{method:t,url:e,data:(i||{}).data}))}}),on.forEach(["post","put","patch"],function(t){function e(i){return function(a,d,b){return this.request(z_(b||{},{method:t,headers:i?{"Content-Type":"multipart/form-data"}:{},url:a,data:d}))}}FC.prototype[t]=e(),FC.prototype[t+"Form"]=e(!0)});const NC=FC;class SR{constructor(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(a){e=a});const i=this;this.promise.then(r=>{if(!i._listeners)return;let a=i._listeners.length;for(;a-- >0;)i._listeners[a](r);i._listeners=null}),this.promise.then=r=>{let a;const d=new Promise(b=>{i.subscribe(b),a=b}).then(r);return d.cancel=function(){i.unsubscribe(a)},d},t(function(a,d,b){i.reason||(i.reason=new C1(a,d,b),e(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=i=>{t.abort(i)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new SR(function(r){t=r}),cancel:t}}}const ZX=SR,TR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(TR).forEach(([n,t])=>{TR[t]=n});const KX=TR,ma=function rB(n){const t=new NC(n),e=g3(NC.prototype.request,t);return on.extend(e,NC.prototype,t,{allOwnKeys:!0}),on.extend(e,t,null,{allOwnKeys:!0}),e.create=function(r){return rB(z_(n,r))},e}(gR);ma.Axios=NC,ma.CanceledError=C1,ma.CancelToken=ZX,ma.isCancel=B3,ma.VERSION="1.8.3",ma.toFormData=EC,ma.AxiosError=so,ma.Cancel=ma.CanceledError,ma.all=function(t){return Promise.all(t)},ma.spread=function YX(n){return function(e){return n.apply(null,e)}},ma.isAxiosError=function JX(n){return on.isObject(n)&&!0===n.isAxiosError},ma.mergeConfig=z_,ma.AxiosHeaders=Pd,ma.formToJSON=n=>F3(on.isHTMLForm(n)?new FormData(n):n),ma.getAdapter=eB_getAdapter,ma.HttpStatusCode=KX,ma.default=ma;const oB=ma,{AxiosHeaders:QX}=oB;var E1={};for(const n in y1.MapArrayTags){const t=n.split(".");if(2!==t.length){console.error("invalid OpenAPI_Dependencies.MapArrayTags key: "+n);continue}const e=t[0],i=t[1];e in E1||(E1[e]=[]),E1[e].push(i)}var eZ=n=>{if(n.startsWith("OJP"))return n;let t=n.replace(/[-_](.)/g,(e,i)=>i.toUpperCase());return t=t.replace(/^([A-Z])/,e=>e.toLowerCase()),t},tZ=(n,t)=>{const e=t.split(".");return e.length>=2&&e.slice(-2).join(".")in y1.MapArrayTags};function CR(n,t,e){if("object"==typeof n&&null!==n)if(Array.isArray(n))for(const i of n)CR(i,t,e);else for(const i in n){const r=t.slice();r.push(i),e(i,n[i],r),CR(n[i],r,e)}}function gf(n,t=""){const i=new g9({ignoreAttributes:!1,removeNSPrefix:!0,transformTagName:eZ,isArray:tZ}).parse(n);return CR(i,[t],(r,a,d)=>{var b;if("object"==typeof a){if(d.length>=2&&r in E1){const x=E1[r];Array.isArray(a)?a.forEach(A=>{x.forEach(O=>{null!=A[O]||(A[O]=[])})}):x.forEach(A=>{null!=a[A]||(a[A]=[])})}for(const x in a)"object"==typeof a[x]&&Object.keys(a[x]).includes("#text")&&(Object.keys(a[x]).filter(X=>"#text"!==X).forEach(X=>{a[x+X]=a[x][X]}),a[x]=a[x]["#text"]),(null!=(b=d.at(-1))?b:"")+"."+x in y1.MapStringValues&&(a[x]=String(a[x]))}}),i}var fv=class{constructor(n,t=null){Di(this,"longitude"),Di(this,"latitude"),Di(this,"properties");const e=[1/0,1/0],i=(()=>{if("number"==typeof n&&isNaN(n))return e;if("number"==typeof n&&null!==t)return[n,t];if("string"==typeof n){const r=n.split(",");return r.length<2?e:[parseFloat(r[1]),parseFloat(r[0])]}if(Array.isArray(n)&&n.length>1)return n;if("object"==typeof n){const r=n;if(r.hasOwnProperty("longitude")&&r.hasOwnProperty("latitude")){const d=n.latitude;return[Number(n.longitude),Number(d)]}}return e})();this.longitude=parseFloat(i[0].toFixed(6)),this.latitude=parseFloat(i[1].toFixed(6)),this.properties={}}isValid(){return this.longitude!==1/0&&this.latitude!==1/0}distanceFrom(n){const e=(n.latitude-this.latitude)*Math.PI/180,i=(n.longitude-this.longitude)*Math.PI/180,r=Math.sin(e/2)*Math.sin(e/2)+Math.cos(this.latitude*Math.PI/180)*Math.cos(n.latitude*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2),a=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r));return Math.round(6371*a*1e3)}asLatLngString(n=!0){let t="";return t=n?this.latitude.toFixed(6)+","+this.longitude.toFixed(6):this.latitude+","+this.longitude,t}asLngLat(){return[this.longitude,this.latitude]}},BC=class bV{constructor(t,e,i,r,a,d,b,x,A,O,B){Di(this,"id"),Di(this,"duration"),Di(this,"startTime"),Di(this,"endTime"),Di(this,"transfers"),Di(this,"leg"),Di(this,"cancelled"),Di(this,"delayed"),Di(this,"deviation"),Di(this,"infeasible"),Di(this,"unplanned"),this.id=t,this.duration=e,this.startTime=i,this.endTime=r,this.transfers=a,this.leg=d,this.cancelled=b,this.delayed=x,this.deviation=A,this.infeasible=O,this.unplanned=B}static initWithTripXML(t){const i=gf(t,"TripResult");return new bV(i.trip.id,i.trip.duration,i.trip.startTime,i.trip.endTime,i.trip.transfers,i.trip.leg,i.trip.cancelled,i.trip.delayed,i.trip.deviation,i.trip.infeasible,i.trip.unplanned)}},zC=class VD{constructor(t,e,i,r,a,d,b,x){Di(this,"stopPoint"),Di(this,"stopPlace"),Di(this,"topographicPlace"),Di(this,"pointOfInterest"),Di(this,"address"),Di(this,"name"),Di(this,"geoPosition"),Di(this,"mode"),Di(this,"placeType"),this.stopPoint=t,this.stopPlace=e,this.topographicPlace=i,this.pointOfInterest=r,this.address=a,this.name=d,this.geoPosition=b,this.mode=x,this.placeType=b.isValid()?"location":null,(t||e)&&(this.placeType="stop"),i&&(this.placeType="topographicPlace"),r&&(this.placeType="poi"),a&&(this.placeType="address")}static initWithXMLSchema(t){const e=new fv(t.geoPosition);return new VD(t.stopPoint,t.stopPlace,t.topographicPlace,t.pointOfInterest,t.address,t.name,e,t.mode)}static initWithCoords(t,e=null){const i=new fv(t,e);return new VD(void 0,void 0,void 0,void 0,void 0,{text:i.latitude+","+i.longitude},i,[])}static Empty(){const e=new fv("0,0");return new VD(void 0,void 0,void 0,void 0,void 0,{text:"n/a Empty"},e,[])}findClosestPlace(t){const e=this.geoPosition;let i=null;return t.forEach(r=>{const a=r.geoPosition;if(null===a)return;const d=e.distanceFrom(a);(null===i||d<i.distance)&&(i={object:r,distance:d})}),i}asStopPlaceRefOrCoords(){var i,r;const t=null!=(r=null==(i=this.stopPlace)?void 0:i.stopPlaceRef)?r:null;return null!==t?t:this.geoPosition.asLatLngString()}},nZ=class V2{constructor(t,e,i){Di(this,"place"),Di(this,"complete"),Di(this,"probability"),this.place=t,this.complete=e,this.probability=i}static initWithXMLSchema(t){const e=zC.initWithXMLSchema(t.place);return new V2(e,t.complete,t.probability)}static initWithXML(t){const i=gf(t,"PlaceResult"),a=zC.initWithXMLSchema(i.placeResult.place);return new V2(a,i.placeResult.complete,i.placeResult.probability)}},iZ=class yV{constructor(t,e){Di(this,"id"),Di(this,"stopEvent"),this.id=t,this.stopEvent=e}static initWithXML(t){const i=gf(t,"StopEventResult");return new yV(i.stopEventResult.id,i.stopEventResult.stopEvent)}},sB=class{static convertOJPv2Trip_to_v1Trip(n){const t=JSON.parse(JSON.stringify(n)),e={tripId:t.id,duration:t.duration,startTime:t.startTime,endTime:t.endTime,transfers:t.transfers,tripLeg:[]};return t.leg.forEach(i=>{const r={legId:i.id,duration:i.duration,timedLeg:void 0,transferLeg:i.transferLeg,continuousLeg:i.continuousLeg};i.timedLeg&&(r.timedLeg={legBoard:i.timedLeg.legBoard,legIntermediates:i.timedLeg.legIntermediate,legAlight:i.timedLeg.legAlight,service:{conventionalModeOfOperation:i.timedLeg.service.conventionalModeOfOperation,operatingDayRef:i.timedLeg.service.operatingDayRef,journeyRef:i.timedLeg.service.journeyRef,publicCode:i.timedLeg.service.publicCode,lineRef:i.timedLeg.service.lineRef,directionRef:i.timedLeg.service.directionRef,mode:i.timedLeg.service.mode,productCategory:i.timedLeg.service.productCategory,publishedLineName:i.timedLeg.service.publishedServiceName,trainNumber:i.timedLeg.service.trainNumber,attribute:i.timedLeg.service.attribute,operatorRef:i.timedLeg.service.operatorRef,destinationStopPointRef:i.timedLeg.service.destinationStopPointRef,destinationText:i.timedLeg.service.destinationText,unplanned:i.timedLeg.service.unplanned,cancelled:i.timedLeg.service.cancelled,deviation:i.timedLeg.service.deviation},legTrack:i.timedLeg.legTrack}),e.tripLeg.push(r)}),e}static cleanTripForFareRequest(n){n.tripLeg.forEach(t=>{if(t.continuousLeg&&(t.continuousLeg={legStart:{name:t.continuousLeg.legStart.name},legEnd:{name:t.continuousLeg.legEnd.name},service:{},duration:t.continuousLeg.duration}),t.transferLeg&&(t.transferLeg={transferType:t.transferLeg.transferType,legStart:{name:t.transferLeg.legStart.name},legEnd:{name:t.transferLeg.legEnd.name},duration:t.transferLeg.duration}),t.timedLeg){const e=t.timedLeg.legIntermediates.map(i=>({stopPointRef:i.stopPointRef,stopPointName:i.stopPointName,serviceArrival:i.serviceArrival,serviceDeparture:i.serviceDeparture}));t.timedLeg={legBoard:{stopPointRef:t.timedLeg.legBoard.stopPointRef,stopPointName:t.timedLeg.legBoard.stopPointName,serviceDeparture:t.timedLeg.legBoard.serviceDeparture},legIntermediates:e,legAlight:{stopPointRef:t.timedLeg.legAlight.stopPointRef,stopPointName:t.timedLeg.legAlight.stopPointName,serviceArrival:t.timedLeg.legAlight.serviceArrival},service:{operatingDayRef:t.timedLeg.service.operatingDayRef,journeyRef:t.timedLeg.service.journeyRef,lineRef:t.timedLeg.service.lineRef,directionRef:t.timedLeg.service.directionRef,mode:t.timedLeg.service.mode,publishedLineName:t.timedLeg.service.publishedLineName,attribute:[],operatorRef:t.timedLeg.service.operatorRef}}}})}},aB="0.20.23",mv={ojpVersion:"2.0",defaultNS:"ojp",mapNS:{ojp:"http://www.vdv.de/ojp",siri:"http://www.siri.org.uk/siri"}};function DR(n,t=[],e){if(null!==n&&"object"==typeof n&&!Array.isArray(n))for(const i in n)i.includes("@_")&&delete n[i];return Object.entries(n).reduce((i,[r,a])=>{const d=e(r,a,t),b=t.concat([d]);return i[d]=(()=>{if(a instanceof Object){if(!Array.isArray(a))return DR(a,b,e);a.forEach((x,A)=>{x instanceof Object&&(a[A]=DR(x,b,e))})}return a})(),i},{})}function gv(n,t=mv,e=null){return['<?xml version="1.0" encoding="utf-8"?>',lB(n,"OJP",t,b=>{const x=Object.keys(b);if("object"==typeof b&&1===x.length){const A=x[0].split(":");if(2===A.length){const O=x[0];b[A[1]]=b[O],delete b[O]}}e&&e(b)})].join("\n")}function lB(n,t="OJP",e=mv,i=null){const a=DR(JSON.parse(JSON.stringify(n)),[t],(O,B,X)=>{var ye,$e;let te=O.charAt(0).toUpperCase()+O.slice(1);const se=null!=(ye=y1.MapModelKeepPropertiesXML[O])?ye:null;null!==se&&"object"==typeof B&&Object.keys(B).forEach(Qe=>{se.includes(Qe)||delete B[Qe]});const me=null!=($e=X.at(-1))?$e:null;if(null!==me){const ht=me.replace(/^.*:/,"")+"."+te,Qe=(()=>{var fn;const At=null!=(fn=y1.MapNS_Tags[ht])?fn:"ojp";return e.defaultNS===At?"":At+":"})();null!==Qe&&(te=Qe+te)}return te});i&&i(a);const d=[];if("OJP"===t){const O=[];for(const X in e.mapNS)O.push((X===e.defaultNS?"xmlns":"xmlns:"+X)+'="'+e.mapNS[X]+'"');O.push('version="'+e.ojpVersion+'"'),d.push("<OJP "+O.join(" ")+">")}else d.push("<"+t+">");const x=new qm({format:!0,ignoreAttributes:!1,suppressEmptyNode:!0});return d.push(x.build(a)),d.push("</"+t+">"),d.join("\n")}var rZ=class vV{static formatDate(t){return[t.getFullYear(),"-",("00"+(t.getMonth()+1)).slice(-2),"-",("00"+t.getDate()).slice(-2)," ",("00"+t.getHours()).slice(-2),":",("00"+t.getMinutes()).slice(-2),":",("00"+t.getSeconds()).slice(-2)].join("")}static formatTimeHHMM(t=new Date){return vV.formatDate(t).substring(11,16)}static computeDelayMinutes(t,e){if(null===e)return null;const i="string"==typeof t?new Date(t):t,a=(("string"==typeof e?new Date(e):e).getTime()-i.getTime())/1e3;return Math.floor(a/60)}},ER=class{constructor(){Di(this,"requestInfo"),Di(this,"mockRequestXML"),Di(this,"mockResponseXML"),Di(this,"enableExtensions"),this.requestInfo={requestDateTime:null,requestXML:null,responseDateTime:null,responseXML:null,parseDateTime:null},this.mockRequestXML=null,this.mockResponseXML=null,this.enableExtensions=!0}},oZ=class tb extends ER{constructor(e,i){super(),Di(this,"requestTimestamp"),Di(this,"refineParams"),Di(this,"tripResult"),this.requestTimestamp=(new Date).toISOString(),this.refineParams=i,this.tripResult=e}static DefaultRequestParams(){return{numberOfResults:void 0,useRealtimeData:"explanatory",includeAllRestrictedLines:!0,includeIntermediateStops:!0}}static Default(){const i=tb.DefaultRequestParams();return new tb({},i)}static initWithRequestMock(e){const i=tb.Default();return i.mockRequestXML=e,i}static initWithResponseMock(e){const i=tb.Default();return i.mockResponseXML=e,i}static initWithTrip(e){const i={id:e.id,trip:e},r=tb.DefaultRequestParams();return new tb(i,r)}buildRequestXML(e,i,r){return gv({OJPRequest:{serviceRequest:{serviceRequestContext:{language:e},requestTimestamp:this.requestTimestamp,requestorRef:i,OJPTripRefineRequest:this}}},r)}},sZ=class nb extends ER{constructor(e,i){super(),Di(this,"requestTimestamp"),Di(this,"itemsWrapper"),this.requestTimestamp=e,this.itemsWrapper=i}static DefaultRequestParams(){return{fareAuthorityFilter:["ch:1:NOVA"],passengerCategory:["Adult"],travelClass:"second",traveller:[{age:25,passengerCategory:"Adult",entitlementProducts:{entitlementProduct:[{fareAuthorityRef:"ch:1:NOVA",entitlementProductRef:"HTA",entitlementProductName:"Halbtax-Abonnement"}]}}]}}static Default(){const i=(new Date).toISOString();return new nb(i,[])}static initWithRequestMock(e){const i=nb.Default();return i.mockRequestXML=e,i}static initWithResponseMock(e){const i=nb.Default();return i.mockResponseXML=e,i}static initWithOJPv1Trips(e){e.map(b=>{sB.cleanTripForFareRequest(b)});const r=(new Date).toISOString(),a=[];return e.forEach(b=>{const x={requestTimestamp:r,tripFareRequest:{trip:b},params:nb.DefaultRequestParams()};a.push(x)}),new nb(r,a)}static initWithOJPv2Trips(e){const i=[];return e.forEach(a=>{const d=sB.convertOJPv2Trip_to_v1Trip(a);i.push(d)}),nb.initWithOJPv1Trips(i)}buildRequestXML(e,i,r=mv){const a={OJPRequest:{serviceRequest:{serviceRequestContext:{language:e},requestTimestamp:this.requestTimestamp,requestorRef:i,OJPFareRequest:this.itemsWrapper}}};return"1.0"!==r.ojpVersion&&console.error("FareRequest.buildRequestXML() error - v1 XML_Config is missing"),gv(a,r,b=>{const x="siri"!==r.defaultNS?"siri:":"",A="ojp"!==r.defaultNS?"ojp:":"";b[x+"OJPRequest"][x+"ServiceRequest"][A+"OJPFareRequest"].forEach(B=>{B[A+"TripFareRequest"][A+"Trip"][A+"TripLeg"].forEach(te=>{if(A+"TimedLeg"in te){const se=te[A+"TimedLeg"][A+"Service"];se[A+"OperatorRef"]="ojp:"+se[x+"OperatorRef"],delete se[x+"OperatorRef"]}})})})}},VC=class ib extends ER{constructor(e,i,r){super(),Di(this,"requestTimestamp"),Di(this,"journeyRef"),Di(this,"operatingDayRef"),Di(this,"params"),this.requestTimestamp=(new Date).toISOString(),this.journeyRef=e,this.operatingDayRef=i,this.params=r}static DefaultRequestParams(){return{includeCalls:!0,includeService:!0,includeTrackProjection:!1,includePlacesContext:!0,includeSituationsContext:!0}}static Default(){return new ib("n/a","n/a",ib.DefaultRequestParams())}static initWithRequestMock(e){const i=ib.Default();return i.mockRequestXML=e,i}static initWithResponseMock(e){const i=ib.Default();return i.mockResponseXML=e,i}static initWithJourneyRef(e,i=new Date){const r=rZ.formatDate(i).substring(0,10),a=ib.DefaultRequestParams();return new ib(e,r,a)}buildRequestXML(e,i,r){return"1.0"===r.ojpVersion&&this.patchV1(),gv({OJPRequest:{serviceRequest:{serviceRequestContext:{language:e},requestTimestamp:this.requestTimestamp,requestorRef:i,OJPTripInfoRequest:this}}},r)}enableTrackProjection(){this.params&&(this.params.includeTrackProjection=!0)}patchV1(){this.params&&(this.params.includeSituationsContext=void 0)}},M1=class{constructor(n,t,e,i=mv){Di(this,"requestorRef"),Di(this,"httpConfig"),Di(this,"language"),Di(this,"xmlConfig"),this.requestorRef=n,this.httpConfig=t,this.language=e,this.xmlConfig=i}computeResponse(n){var t=this;return mr(function*(){const e=n.mockRequestXML?n.mockRequestXML:n.buildRequestXML(t.language,t.requestorRef,t.xmlConfig);n.requestInfo.requestDateTime=new Date,n.requestInfo.requestXML=e;const i=yield mr(function*(){return n.mockResponseXML?n.mockResponseXML:yield t.fetchResponse(e)})();return n.requestInfo.responseDateTime=new Date,n.requestInfo.responseXML=i,i})()}fetchResponse(n){var t=this;return mr(function*(){const e=new QX;e.set("Accept","application/xml"),e.set("Content-Type","application/xml"),null!==t.httpConfig.authToken&&e.set("Authorization","Bearer "+t.httpConfig.authToken);const i={method:"POST",url:t.httpConfig.url,headers:e};return t.httpConfig.url.startsWith("http://localhost")&&(i.method="GET"),"POST"===i.method&&(i.data=n),(yield oB.request(i)).data})()}fetchTripRequestResponse(n){var t=this;return mr(function*(){const e=yield t.computeResponse(n);try{return{ok:!0,value:gf(e,"OJP").OJP.OJPResponse.serviceDelivery.OJPTripDelivery}}catch(i){return{ok:!1,error:i instanceof Error?i:new Error("Unknown error")}}})()}fetchLocationInformationRequestResponse(n){var t=this;return mr(function*(){const e=yield t.computeResponse(n);try{return{ok:!0,value:gf(e,"OJP").OJP.OJPResponse.serviceDelivery.OJPLocationInformationDelivery}}catch(i){return{ok:!1,error:i instanceof Error?i:new Error("Unknown error")}}})()}fetchStopEventRequestResponse(n){var t=this;return mr(function*(){const e=yield t.computeResponse(n);try{return{ok:!0,value:gf(e,"OJP").OJP.OJPResponse.serviceDelivery.OJPStopEventDelivery}}catch(i){return{ok:!1,error:i instanceof Error?i:new Error("Unknown error")}}})()}fetchTripRefineRequestResponse(n){var t=this;return mr(function*(){const e=yield t.computeResponse(n);try{return{ok:!0,value:gf(e,"OJP").OJP.OJPResponse.serviceDelivery.OJPTripRefineDelivery}}catch(i){return{ok:!1,error:i instanceof Error?i:new Error("Unknown error")}}})()}fetchTripInfoRequestResponse(n){var t=this;return mr(function*(){const e=yield t.computeResponse(n);try{return{ok:!0,value:gf(e,"OJP").OJP.OJPResponse.serviceDelivery.OJPTripInfoDelivery}}catch(i){return{ok:!1,error:i instanceof Error?i:new Error("Unknown error")}}})()}fetchFareRequestResponse(n){var t=this;return mr(function*(){const e=yield t.computeResponse(n);try{return{ok:!0,value:gf(e,"OJP").OJP.OJPResponse.serviceDelivery.OJPFareDelivery}}catch(i){return{ok:!1,error:i instanceof Error?i:new Error("Unknown error")}}})()}fetchTrips(n){var t=this;return mr(function*(){var x;console.log("WARNING: deprecated method, it might be removed at a later version, use fetchTripRequestResponse() instead");const e=yield t.computeResponse(n),i="ojp"===t.xmlConfig.defaultNS?"":"ojp:",a=new RegExp("<"+i+"Trip\\b[^>]*>.*?<\\/"+i+"Trip>","gs"),d=null!=(x=e.match(a))?x:[],b=[];return d.forEach((A,O)=>{const B=BC.initWithTripXML(A);b.push(B)}),n.requestInfo.parseDateTime=new Date,b})()}fetchPlaceResults(n){var t=this;return mr(function*(){var a;console.log("WARNING: deprecated method, it might be removed at a later version, use fetchLocationInformationRequestResponse() instead");const i=null!=(a=(yield t.computeResponse(n)).match(/<PlaceResult\b[^>]*>.*?<\/PlaceResult>/gs))?a:[],r=[];return i.forEach((d,b)=>{const x=nZ.initWithXML(d);r.push(x)}),n.requestInfo.parseDateTime=new Date,r})()}fetchStopEvents(n){var t=this;return mr(function*(){var a;console.log("WARNING: deprecated method, it might be removed at a later version, use fetchStopEventRequestResponse() instead");const i=null!=(a=(yield t.computeResponse(n)).match(/<StopEventResult\b[^>]*>.*?<\/StopEventResult>/gs))?a:[],r=[];return i.forEach((d,b)=>{const x=iZ.initWithXML(d);r.push(x)}),n.requestInfo.parseDateTime=new Date,r})()}fetchTRR_Trips(n){var t=this;return mr(function*(){var a;console.log("WARNING: deprecated method, it might be removed at a later version, use fetchTripRefineRequestResponse() instead");const i=null!=(a=(yield t.computeResponse(n)).match(/<Trip\b[^>]*>.*?<\/Trip>/gs))?a:[],r=[];return i.forEach((d,b)=>{const x=BC.initWithTripXML(d);r.push(x)}),n.requestInfo.parseDateTime=new Date,r})()}};const cB={stages:{PROD:{url:"https://api.opentransportdata.swiss/ojp2020",authToken:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6Ijk0YTFhNjExYjM5ZjQ4MWNiMGI5MjFiNTgyNmM1ZGFjIiwiaCI6Im11cm11cjEyOCJ9"},INT:{url:"https://odpch-api.clients.liip.ch/ojp-passiv-int",authToken:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImJkOTNmYzA1ZGMwYzQwM2Q4MWYzMmFhNWMxNWZjMjU2IiwiaCI6Im11cm11cjEyOCJ9"},TEST:{url:"https://odpch-api.clients.liip.ch/ojp-test",authToken:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6ImZlYWJiMjEzZDcyZTRhYmM5N2RhYWJiZDM5YWZmZWIwIiwiaCI6Im11cm11cjEyOCJ9"},"V2-PROD":{url:"https://api.opentransportdata.swiss/ojp20",authToken:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6Ijk0YTFhNjExYjM5ZjQ4MWNiMGI5MjFiNTgyNmM1ZGFjIiwiaCI6Im11cm11cjEyOCJ9"},"V2-INT":{url:"https://odpch-api.clients.liip.ch/ojp20-beta",authToken:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6IjUzYzAyNWI2ZTRhNjQyOTM4NzMxMDRjNTg2ODEzNTYyIiwiaCI6Im11cm11cjEyOCJ9"},"V2-TEST":{url:"https://odpch-api.clients.liip.ch/ojp20-test",authToken:"eyJvcmciOiI2M2Q4ODhiMDNmZmRmODAwMDEzMDIwODkiLCJpZCI6IjUzYzAyNWI2ZTRhNjQyOTM4NzMxMDRjNTg2ODEzNTYyIiwiaCI6Im11cm11cjEyOCJ9"},"PROD-LB":{url:"https://tools.odpch.ch/tmp/cors-proxy?url=https://ojp.lb.prod.ojp.odpch.ch/ojp/ojp",authToken:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6Ijk0YTFhNjExYjM5ZjQ4MWNiMGI5MjFiNTgyNmM1ZGFjIiwiaCI6Im11cm11cjEyOCJ9"},"LA Beta":{url:"https://api.opentransportdata.swiss/ojp-la-aktiv",authToken:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6ImE5ZDFkYmI4YWVjMDRiYjFiZjA2ZmUyNmZmZTk2YTY2IiwiaCI6Im11cm11cjEyOCJ9"},"OJP-SI":{url:"https://dev.simo.si/OpenAPI/LinkingAlpsBetaPhase/OJP",authToken:null},"GR TEST":{url:"https://tools.odpch.ch/ojp-gr-api",authToken:null},"NOVA-INT":{url:"https://api.opentransportdata.swiss/ojpfare",authToken:"eyJvcmciOiI2NDA2NTFhNTIyZmEwNTAwMDEyOWJiZTEiLCJpZCI6ImU2ZDUyMmU0ODM1NDQ0YmM5OWM3ZjQ4MzI2ZWYxNzI3IiwiaCI6Im11cm11cjEyOCJ9"}}};class Bh{static formatMapboxLngLatAsLatLng(t){return t.lat.toFixed(6)+","+t.lng.toFixed(6)}static computePointLngLatFromFeature(t){if("Point"!==t.geometry.type)return null;const e=t.geometry.coordinates;return sl().LngLat.convert(e)}static bboxPxFromLngLatWidthPx(t,e,i,r=null){null===r&&(r=i);const a=t.project(e);return[[a.x-i/2,a.y+r/2],[a.x+i/2,a.y-r/2]]}static areBoundsInsideOtherBounds(t,e){return!(t.getWest()<e.getWest()||t.getNorth()>e.getNorth()||t.getEast()>e.getEast()||t.getSouth()<e.getSouth())}static queryNearbyFeaturesByLayerIDs(t,e,i){const r=Bh.bboxPxFromLngLatWidthPx(t,e,30),a=t.queryRenderedFeatures(r,{layers:i});let d=[],b=null;return a.forEach(x=>{const A=Bh.computePointLngLatFromFeature(x);if(null===A)return;const O=Math.round(e.distanceTo(A));null!==b&&O>b||(b=O,d.push({feature:x,distance:O}))}),d.sort((x,A)=>x.distance-A.distance),Bh.highlightBBOXPxOnMap(r,t),Bh.highlightLngLatOnMap(e,t),d}static highlightBBOXPxOnMap(t,e){const i=e.unproject(t[0]),r=e.unproject(t[1]),a=new(sl().LngLatBounds)(i,r),b={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[a.getSouthWest().toArray(),a.getSouthEast().toArray(),a.getNorthEast().toArray(),a.getNorthWest().toArray(),a.getSouthWest().toArray()]}},x="debug-highlight";e.getSource(x)||e.addSource(x,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const A=x+"-bbox";e.getLayer(A)||e.addLayer({id:A,type:"line",source:x,paint:{"line-color":"#630000","line-width":2}});const O=e.getSource(x);O.setData({type:"FeatureCollection",features:[b]}),setTimeout(()=>{O.setData({type:"FeatureCollection",features:[]})},500)}static highlightLngLatOnMap(t,e){const i={type:"Feature",properties:{},geometry:{type:"Point",coordinates:t.toArray()}},r="debug-highlight-layer-coord";e.getSource(r)||e.addSource(r,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const a=r+"-coords";e.getLayer(a)||e.addLayer({id:a,type:"circle",source:r,paint:{"circle-color":"#630000","circle-radius":4}});const d=e.getSource(r);d.setData({type:"FeatureCollection",features:[i]}),setTimeout(()=>{d.setData({type:"FeatureCollection",features:[]})},500)}}class aZ{constructor(t){this.map=t,this.container=null,this.debugCenterEl=null,this.debugZoomEl=null}onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",this.container.innerHTML=document.getElementById("map-debug-control").innerHTML,t.on("move",()=>{this.updateDebugCenter()}),t.on("zoom",()=>{this.updateDebugZoom()}),setTimeout(()=>{this.debugCenterEl=document.getElementById("map_debug_center"),this.debugZoomEl=document.getElementById("map_debug_zoom"),this.updateDebugZoom(),this.updateDebugCenter()},200),this.container}onRemove(){this.map=null,this.container=null}updateDebugZoom(){!this.map||!this.debugZoomEl||(this.debugZoomEl.innerText=this.map.getZoom().toFixed(2).toString())}updateDebugCenter(){if(!this.map||!this.debugCenterEl)return;const t=this.map.getCenter().toArray().map(e=>e.toFixed(6));this.debugCenterEl.innerText=t.join(",")}}class uB{static prettyPrintXML(t){const e=new DOMParser,i=e.parseFromString(t,"application/xml"),a=e.parseFromString('\n      <xsl:stylesheet version="2.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">\n        <xsl:strip-space elements="*"/>\n        <xsl:output indent="yes"/>\n        \n        \x3c!-- change to just text() to strip space in text nodes --\x3e\n        <xsl:template match="para[content-style][not(text())]">\n          <xsl:value-of select="normalize-space(.)"/>\n        </xsl:template>\n        <xsl:template match="node()|@*">\n          <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>\n        </xsl:template>\n      </xsl:stylesheet>\n    ',"application/xml");var d=new XSLTProcessor;d.importStylesheet(a);const b=d.transformToDocument(i);return(new XMLSerializer).serializeToString(b)}}class lZ{constructor(t,e){this._document=e;const i=this._textarea=this._document.createElement("textarea"),r=i.style;r.position="fixed",r.top=r.opacity="0",r.left="-999em",i.setAttribute("aria-hidden","true"),i.value=t,i.readOnly=!0,this._document.body.appendChild(i)}copy(){const t=this._textarea;let e=!1;try{if(t){const i=this._document.activeElement;t.select(),t.setSelectionRange(0,t.value.length),e=this._document.execCommand("copy"),i&&i.focus()}}catch(i){}return e}destroy(){const t=this._textarea;t&&(t.remove(),this._textarea=void 0)}}let IR,cZ=(()=>{class n{constructor(e){this._document=e}copy(e){const i=this.beginCopy(e),r=i.copy();return i.destroy(),r}beginCopy(e){return new lZ(e,this._document)}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();try{IR="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){IR=!1}let _v,ga=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?function bU(n){return n===oL}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!IR)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(Tt(GS))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const dB=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function hB(){if(_v)return _v;if("object"!=typeof document||!document)return _v=new Set(dB),_v;let n=document.createElement("input");return _v=new Set(dB.filter(t=>(n.setAttribute("type",t),n.type===t))),_v}let A1,V_,MR;function Gm(n){return function uZ(){if(null==A1&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>A1=!0}))}finally{A1=A1||!1}return A1}()?n:!!n.capture}function dZ(){if(null==V_){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return V_=!1,V_;if("scrollBehavior"in document.documentElement.style)V_=!0;else{const n=Element.prototype.scrollTo;V_=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return V_}function kd(){let n="undefined"!=typeof document&&document?document.activeElement:null;for(;n&&n.shadowRoot;){const t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function $m(n){return n.composedPath?n.composedPath()[0]:n.target}function AR(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}function al(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}class CZ extends Se{constructor(t,e){super()}schedule(t,e=0){return this}}const UC={setInterval(n,t,...e){const{delegate:i}=UC;return null!=i&&i.setInterval?i.setInterval(n,t,...e):setInterval(n,t,...e)},clearInterval(n){const{delegate:t}=UC;return((null==t?void 0:t.clearInterval)||clearInterval)(n)},delegate:void 0};class OR extends CZ{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){var i;if(this.closed)return this;this.state=t;const r=this.id,a=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(a,r,e)),this.pending=!0,this.delay=e,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(a,this.id,e),this}requestAsyncId(t,e,i=0){return UC.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;null!=e&&UC.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,i=!1;try{this.work(t)}catch(a){i=!0,r=a||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,Ct(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}const gB={now:()=>(gB.delegate||Date).now(),delegate:void 0};class R1{constructor(t,e=R1.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}R1.now=gB.now;class FR extends R1{constructor(t,e=R1.now){super(t,e),this.actions=[],this._active=!1}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}const HC=new FR(OR),DZ=HC;function zh(n,t=HC){return Q((e,i)=>{let r=null,a=null,d=null;const b=()=>{if(r){r.unsubscribe(),r=null;const A=a;a=null,i.next(A)}};function x(){const A=d+n,O=t.now();if(O<A)return r=this.schedule(void 0,A-O),void i.add(r);b()}e.subscribe(Ce(i,A=>{a=A,d=t.now(),r||(r=t.schedule(x,n),i.add(r))},()=>{b(),i.complete()},void 0,()=>{a=r=null}))})}function _B(n){return Do((t,e)=>n<=e)}function Wm(n,t=vn){return n=null!=n?n:EZ,Q((e,i)=>{let r,a=!0;e.subscribe(Ce(i,d=>{const b=t(d);(a||!n(r,b))&&(a=!1,r=b,i.next(d))}))})}function EZ(n,t){return n===t}function Mr(n){return Q((t,e)=>{mn(n).subscribe(Ce(e,()=>e.complete(),Rt)),!e.closed&&t.subscribe(e)})}function Ai(n){return null!=n&&"false"!=`${n}`}function yf(n,t=0){return function IZ(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):t}function qC(n){return Array.isArray(n)?n:[n]}function _a(n){return null==n?"":"string"==typeof n?n:`${n}px`}function H_(n){return n instanceof ci?n.nativeElement:n}function NR(n,t=/\s+/){const e=[];if(null!=n){const i=Array.isArray(n)?n:`${n}`.split(t);for(const r of i){const a=`${r}`.trim();a&&e.push(a)}}return e}let bB=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),yB=(()=>{class n{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,i)=>this._cleanupObserver(i))}observe(e){const i=H_(e);return new yi(r=>{const d=this._observeElement(i).subscribe(r);return()=>{d.unsubscribe(),this._unobserveElement(i)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const i=new On,r=this._mutationObserverFactory.create(a=>i.next(a));r&&r.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:r,stream:i,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:i,stream:r}=this._observedElements.get(e);i&&i.disconnect(),r.complete(),this._observedElements.delete(e)}}}return n.\u0275fac=function(e){return new(e||n)(Tt(bB))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),vB=(()=>{class n{constructor(e,i,r){this._contentObserver=e,this._elementRef=i,this._ngZone=r,this.event=new Cn,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(e){this._disabled=Ai(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=yf(e),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(zh(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){var e;null===(e=this._currentSubscription)||void 0===e||e.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(ue(yB),ue(ci),ue(Ui))},n.\u0275dir=cn({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),GC=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[bB]}),n})();const xB=new Set;let yv,MZ=(()=>{class n{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):RZ}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function AZ(n){if(!xB.has(n))try{yv||(yv=document.createElement("style"),yv.setAttribute("type","text/css"),document.head.appendChild(yv)),yv.sheet&&(yv.sheet.insertRule(`@media ${n} {body{ }}`,0),xB.add(n))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}return n.\u0275fac=function(e){return new(e||n)(Tt(ga))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function RZ(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let $C=(()=>{class n{constructor(e,i){this._mediaMatcher=e,this._zone=i,this._queries=new Map,this._destroySubject=new On}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return wB(qC(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let a=M_(wB(qC(e)).map(d=>this._registerQuery(d).observable));return a=Yx(a.pipe(Ho(1)),a.pipe(_B(1),zh(0))),a.pipe(st(d=>{const b={matches:!1,breakpoints:{}};return d.forEach(({matches:x,query:A})=>{b.matches=b.matches||x,b.breakpoints[A]=x}),b}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const i=this._mediaMatcher.matchMedia(e),a={observable:new yi(d=>{const b=x=>this._zone.run(()=>d.next(x));return i.addListener(b),()=>{i.removeListener(b)}}).pipe(Ra(i),st(({matches:d})=>({query:e,matches:d})),Mr(this._destroySubject)),mql:i};return this._queries.set(e,a),a}}return n.\u0275fac=function(e){return new(e||n)(Tt(MZ),Tt(Ui))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function wB(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function WC(n,t){return(n.getAttribute(t)||"").match(/\S+/g)||[]}const CB="cdk-describedby-message",XC="cdk-describedby-host";let BR=0,DB=(()=>{class n{constructor(e,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+BR++,this._document=e,this._id=$o($y)+"-"+BR++}describe(e,i,r){if(!this._canBeDescribed(e,i))return;const a=zR(i,r);"string"!=typeof i?(EB(i,this._id),this._messageRegistry.set(a,{messageElement:i,referenceCount:0})):this._messageRegistry.has(a)||this._createMessageElement(i,r),this._isElementDescribedByMessage(e,a)||this._addMessageReference(e,a)}removeDescription(e,i,r){var a;if(!i||!this._isElementNode(e))return;const d=zR(i,r);if(this._isElementDescribedByMessage(e,d)&&this._removeMessageReference(e,d),"string"==typeof i){const b=this._messageRegistry.get(d);b&&0===b.referenceCount&&this._deleteMessageElement(d)}0===(null===(a=this._messagesContainer)||void 0===a?void 0:a.childNodes.length)&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){var e;const i=this._document.querySelectorAll(`[${XC}="${this._id}"]`);for(let r=0;r<i.length;r++)this._removeCdkDescribedByReferenceIds(i[r]),i[r].removeAttribute(XC);null===(e=this._messagesContainer)||void 0===e||e.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(e,i){const r=this._document.createElement("div");EB(r,this._id),r.textContent=e,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(zR(e,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(e){var i,r;null===(r=null===(i=this._messageRegistry.get(e))||void 0===i?void 0:i.messageElement)||void 0===r||r.remove(),this._messageRegistry.delete(e)}_createMessagesContainer(){if(this._messagesContainer)return;const e="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${e}[platform="server"]`);for(let a=0;a<i.length;a++)i[a].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(e),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(e){const i=WC(e,"aria-describedby").filter(r=>0!=r.indexOf(CB));e.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(e,i){const r=this._messageRegistry.get(i);(function PZ(n,t,e){const i=WC(n,t);i.some(r=>r.trim()==e.trim())||(i.push(e.trim()),n.setAttribute(t,i.join(" ")))})(e,"aria-describedby",r.messageElement.id),e.setAttribute(XC,this._id),r.referenceCount++}_removeMessageReference(e,i){const r=this._messageRegistry.get(i);r.referenceCount--,function kZ(n,t,e){const r=WC(n,t).filter(a=>a!=e.trim());r.length?n.setAttribute(t,r.join(" ")):n.removeAttribute(t)}(e,"aria-describedby",r.messageElement.id),e.removeAttribute(XC)}_isElementDescribedByMessage(e,i){const r=WC(e,"aria-describedby"),a=this._messageRegistry.get(i),d=a&&a.messageElement.id;return!!d&&-1!=r.indexOf(d)}_canBeDescribed(e,i){if(!this._isElementNode(e))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),a=e.getAttribute("aria-label");return!(!r||a&&a.trim()===r)}_isElementNode(e){return e.nodeType===this._document.ELEMENT_NODE}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi),Tt(ga))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function zR(n,t){return"string"==typeof n?`${t||""}/${n}`:n}function EB(n,t){n.id||(n.id=`${CB}-${t}-${BR++}`)}class IB{constructor(t){this._items=t,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new On,this._typeaheadSubscription=Se.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new On,this.change=new On,t instanceof v_&&t.changes.subscribe(e=>{if(this._activeItem){const r=e.toArray().indexOf(this._activeItem);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r)}})}skipPredicate(t){return this._skipPredicateFn=t,this}withWrap(t=!0){return this._wrap=t,this}withVerticalOrientation(t=!0){return this._vertical=t,this}withHorizontalOrientation(t){return this._horizontal=t,this}withAllowedModifierKeys(t){return this._allowedModifierKeys=t,this}withTypeAhead(t=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(qs(e=>this._pressedLetters.push(e)),zh(t),Do(()=>this._pressedLetters.length>0),st(()=>this._pressedLetters.join(""))).subscribe(e=>{const i=this._getItemsArray();for(let r=1;r<i.length+1;r++){const a=(this._activeItemIndex+r)%i.length,d=i[a];if(!this._skipPredicateFn(d)&&0===d.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(a);break}}this._pressedLetters=[]}),this}withHomeAndEnd(t=!0){return this._homeAndEnd=t,this}setActiveItem(t){const e=this._activeItem;this.updateActiveItem(t),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(t){const e=t.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(a=>!t[a]||this._allowedModifierKeys.indexOf(a)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;default:return void((r||al(t,"shiftKey"))&&(t.key&&1===t.key.length?this._letterKeyStream.next(t.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],t.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(t){const e=this._getItemsArray(),i="number"==typeof t?t:e.indexOf(t),r=e[i];this._activeItem=null==r?null:r,this._activeItemIndex=i}_setActiveItemByDelta(t){this._wrap?this._setActiveInWrapMode(t):this._setActiveInDefaultMode(t)}_setActiveInWrapMode(t){const e=this._getItemsArray();for(let i=1;i<=e.length;i++){const r=(this._activeItemIndex+t*i+e.length)%e.length;if(!this._skipPredicateFn(e[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(t){this._setActiveItemByIndex(this._activeItemIndex+t,t)}_setActiveItemByIndex(t,e){const i=this._getItemsArray();if(i[t]){for(;this._skipPredicateFn(i[t]);)if(!i[t+=e])return;this.setActiveItem(t)}}_getItemsArray(){return this._items instanceof v_?this._items.toArray():this._items}}class MB extends IB{setActiveItem(t){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(t),this.activeItem&&this.activeItem.setActiveStyles()}}class VR extends IB{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(t){return this._origin=t,this}setActiveItem(t){super.setActiveItem(t),this.activeItem&&this.activeItem.focus(this._origin)}}let q_=(()=>{class n{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function OZ(n){return!!(n.offsetWidth||n.offsetHeight||"function"==typeof n.getClientRects&&n.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const i=function LZ(n){try{return n.frameElement}catch(t){return null}}(function HZ(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}(e));if(i&&(-1===RB(i)||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),a=RB(e);return e.hasAttribute("contenteditable")?-1!==a:!("iframe"===r||"object"===r||this._platform.WEBKIT&&this._platform.IOS&&!function jZ(n){let t=n.nodeName.toLowerCase(),e="input"===t&&n.type;return"text"===e||"password"===e||"select"===t||"textarea"===t}(e))&&("audio"===r?!!e.hasAttribute("controls")&&-1!==a:"video"===r?-1!==a&&(null!==a||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,i){return function UZ(n){return!function NZ(n){return function zZ(n){return"input"==n.nodeName.toLowerCase()}(n)&&"hidden"==n.type}(n)&&(function FZ(n){let t=n.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(n)||function BZ(n){return function VZ(n){return"a"==n.nodeName.toLowerCase()}(n)&&n.hasAttribute("href")}(n)||n.hasAttribute("contenteditable")||AB(n))}(e)&&!this.isDisabled(e)&&((null==i?void 0:i.ignoreVisibility)||this.isVisible(e))}}return n.\u0275fac=function(e){return new(e||n)(Tt(ga))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function AB(n){if(!n.hasAttribute("tabindex")||void 0===n.tabIndex)return!1;let t=n.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function RB(n){if(!AB(n))return null;const t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class PB{constructor(t,e,i,r,a=!1){this._element=t,this._checker=e,this._ngZone=i,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,a||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){const i=this._getFirstTabbableElement(e);return null==i||i.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){const e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const e=t.children;for(let i=e.length-1;i>=0;i--){const r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(Ho(1)).subscribe(t)}}let vv=(()=>{class n{constructor(e,i,r){this._checker=e,this._ngZone=i,this._document=r}create(e,i=!1){return new PB(e,this._checker,this._ngZone,this._document,i)}}return n.\u0275fac=function(e){return new(e||n)(Tt(q_),Tt(Ui),Tt(Oi))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),qZ=(()=>{class n{constructor(e,i,r){this._elementRef=e,this._focusTrapFactory=i,this._previouslyFocusedElement=null,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(e){this.focusTrap.enabled=Ai(e)}get autoCapture(){return this._autoCapture}set autoCapture(e){this._autoCapture=Ai(e)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}ngOnChanges(e){const i=e.autoCapture;i&&!i.firstChange&&this.autoCapture&&this.focusTrap.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=kd(),this.focusTrap.focusInitialElementWhenReady()}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(vv),ue(Oi))},n.\u0275dir=cn({type:n,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:["cdkTrapFocus","enabled"],autoCapture:["cdkTrapFocusAutoCapture","autoCapture"]},exportAs:["cdkTrapFocus"],features:[ho]}),n})();class GZ extends PB{constructor(t,e,i,r,a,d,b){super(t,e,i,r,b.defer),this._focusTrapManager=a,this._inertStrategy=d,this._focusTrapManager.register(this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._enabled?this._focusTrapManager.register(this):this._focusTrapManager.deregister(this)}destroy(){this._focusTrapManager.deregister(this),super.destroy()}_enable(){this._inertStrategy.preventFocus(this),this.toggleAnchors(!0)}_disable(){this._inertStrategy.allowFocus(this),this.toggleAnchors(!1)}}const $Z=new en("FOCUS_TRAP_INERT_STRATEGY");class WZ{constructor(){this._listener=null}preventFocus(t){this._listener&&t._document.removeEventListener("focus",this._listener,!0),this._listener=e=>this._trapFocus(t,e),t._ngZone.runOutsideAngular(()=>{t._document.addEventListener("focus",this._listener,!0)})}allowFocus(t){!this._listener||(t._document.removeEventListener("focus",this._listener,!0),this._listener=null)}_trapFocus(t,e){var i;const r=e.target,a=t._element;r&&!a.contains(r)&&(null===(i=r.closest)||void 0===i||!i.call(r,"div.cdk-overlay-pane"))&&setTimeout(()=>{t.enabled&&!a.contains(t._document.activeElement)&&t.focusFirstTabbableElement()})}}let XZ=(()=>{class n{constructor(){this._focusTrapStack=[]}register(e){this._focusTrapStack=this._focusTrapStack.filter(r=>r!==e);let i=this._focusTrapStack;i.length&&i[i.length-1]._disable(),i.push(e),e._enable()}deregister(e){e._disable();const i=this._focusTrapStack,r=i.indexOf(e);-1!==r&&(i.splice(r,1),i.length&&i[i.length-1]._enable())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),kB=(()=>{class n{constructor(e,i,r,a,d){this._checker=e,this._ngZone=i,this._focusTrapManager=r,this._document=a,this._inertStrategy=d||new WZ}create(e,i={defer:!1}){let r;return r="boolean"==typeof i?{defer:i}:i,new GZ(e,this._checker,this._ngZone,this._document,this._focusTrapManager,this._inertStrategy,r)}}return n.\u0275fac=function(e){return new(e||n)(Tt(q_),Tt(Ui),Tt(XZ),Tt(Oi),Tt($Z,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const JZ=new en("cdk-input-modality-detector-options"),KZ={ignoreKeys:[18,17,224,91,16]},xv=Gm({passive:!0,capture:!0});let QZ=(()=>{class n{constructor(e,i,r,a){this._platform=e,this._mostRecentTarget=null,this._modality=new il(null),this._lastTouchMs=0,this._onKeydown=d=>{var b,x;null!==(x=null===(b=this._options)||void 0===b?void 0:b.ignoreKeys)&&void 0!==x&&x.some(A=>A===d.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=$m(d))},this._onMousedown=d=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function ZZ(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(d)?"keyboard":"mouse"),this._mostRecentTarget=$m(d))},this._onTouchstart=d=>{!function YZ(n){const t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(d)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=$m(d)):this._modality.next("keyboard")},this._options=Object.assign(Object.assign({},KZ),a),this.modalityDetected=this._modality.pipe(_B(1)),this.modalityChanged=this.modalityDetected.pipe(Wm()),e.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,xv),r.addEventListener("mousedown",this._onMousedown,xv),r.addEventListener("touchstart",this._onTouchstart,xv)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,xv),document.removeEventListener("mousedown",this._onMousedown,xv),document.removeEventListener("touchstart",this._onTouchstart,xv))}}return n.\u0275fac=function(e){return new(e||n)(Tt(ga),Tt(Ui),Tt(Oi),Tt(JZ,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const eY=new en("liveAnnouncerElement",{providedIn:"root",factory:function tY(){return null}}),nY=new en("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let OB=(()=>{class n{constructor(e,i,r,a){this._ngZone=i,this._defaultOptions=a,this._document=r,this._liveElement=e||this._createLiveElement()}announce(e,...i){const r=this._defaultOptions;let a,d;return 1===i.length&&"number"==typeof i[0]?d=i[0]:[a,d]=i,this.clear(),clearTimeout(this._previousTimeout),a||(a=r&&r.politeness?r.politeness:"polite"),null==d&&r&&(d=r.duration),this._liveElement.setAttribute("aria-live",a),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(b=>this._currentResolve=b)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,"number"==typeof d&&(this._previousTimeout=setTimeout(()=>this.clear(),d)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){var e,i;clearTimeout(this._previousTimeout),null===(e=this._liveElement)||void 0===e||e.remove(),this._liveElement=null,null===(i=this._currentResolve)||void 0===i||i.call(this),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let a=0;a<i.length;a++)i[a].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),this._document.body.appendChild(r),r}}return n.\u0275fac=function(e){return new(e||n)(Tt(eY,8),Tt(Ui),Tt(Oi),Tt(nY,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const iY=new en("cdk-focus-monitor-default-options"),ZC=Gm({passive:!0,capture:!0});let Cl=(()=>{class n{constructor(e,i,r,a,d){this._ngZone=e,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new On,this._rootNodeFocusAndBlurListener=b=>{for(let A=$m(b);A;A=A.parentElement)"focus"===b.type?this._onFocus(b,A):this._onBlur(b,A)},this._document=a,this._detectionMode=(null==d?void 0:d.detectionMode)||0}monitor(e,i=!1){const r=H_(e);if(!this._platform.isBrowser||1!==r.nodeType)return fi(null);const a=function pZ(n){if(function hZ(){if(null==MR){const n="undefined"!=typeof document?document.head:null;MR=!(!n||!n.createShadowRoot&&!n.attachShadow)}return MR}()){const t=n.getRootNode?n.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),d=this._elementInfo.get(r);if(d)return i&&(d.checkChildren=!0),d.subject;const b={checkChildren:i,subject:new On,rootNode:a};return this._elementInfo.set(r,b),this._registerGlobalListeners(b),b.subject}stopMonitoring(e){const i=H_(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){const a=H_(e);a===this._getDocument().activeElement?this._getClosestElementsInfo(a).forEach(([b,x])=>this._originChanged(b,i,x)):(this._setOrigin(i),"function"==typeof a.focus&&a.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!(null==e||!e.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused","touch"===i),e.classList.toggle("cdk-keyboard-focused","keyboard"===i),e.classList.toggle("cdk-mouse-focused","mouse"===i),e.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,i){const r=this._elementInfo.get(i),a=$m(e);!r||!r.checkChildren&&i!==a||this._originChanged(i,this._getFocusOrigin(a),r)}_onBlur(e,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,ZC),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,ZC)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Mr(this._stopInputModalityDetector)).subscribe(a=>{this._setOrigin(a,!0)}))}_removeGlobalListeners(e){const i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,ZC),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,ZC),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){const i=[];return this._elementInfo.forEach((r,a)=>{(a===e||r.checkChildren&&a.contains(e))&&i.push([a,r])}),i}_isLastInteractionFromInputLabel(e){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===e||"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||e.disabled)return!1;const a=e.labels;if(a)for(let d=0;d<a.length;d++)if(a[d].contains(i))return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(Tt(Ui),Tt(ga),Tt(QZ),Tt(Oi,8),Tt(iY,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),rY=(()=>{class n{constructor(e,i){this._elementRef=e,this._focusMonitor=i,this._focusOrigin=null,this.cdkFocusChange=new Cn}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){const e=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(e,1===e.nodeType&&e.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>{this._focusOrigin=i,this.cdkFocusChange.emit(i)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(Cl))},n.\u0275dir=cn({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"]}),n})();const FB="cdk-high-contrast-black-on-white",NB="cdk-high-contrast-white-on-black",jR="cdk-high-contrast-active";let BB=(()=>{class n{constructor(e,i){this._platform=e,this._document=i,this._breakpointSubscription=$o($C).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,a=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),a){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(jR,FB,NB),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?e.add(jR,FB):2===i&&e.add(jR,NB)}}}return n.\u0275fac=function(e){return new(e||n)(Tt(ga),Tt(Oi))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),G_=(()=>{class n{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(e){return new(e||n)(Tt(BB))},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[GC]}),n})();const oY=["addListener","removeListener"],sY=["addEventListener","removeEventListener"],aY=["on","off"];function Ld(n,t,e,i){if(Ue(e)&&(i=e,e=void 0),i)return Ld(n,t,e).pipe(ZM(i));const[r,a]=function uY(n){return Ue(n.addEventListener)&&Ue(n.removeEventListener)}(n)?sY.map(d=>b=>n[d](t,b,e)):function lY(n){return Ue(n.addListener)&&Ue(n.removeListener)}(n)?oY.map(zB(n,t)):function cY(n){return Ue(n.on)&&Ue(n.off)}(n)?aY.map(zB(n,t)):[];if(!r&&Ge(n))return Ar(d=>Ld(d,t,e))(mn(n));if(!r)throw new TypeError("Invalid event target");return new yi(d=>{const b=(...x)=>d.next(1<x.length?x:x[0]);return r(b),()=>a(b)})}function zB(n,t){return e=>i=>n[e](t,i)}const P1={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame;const{delegate:i}=P1;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);const r=t(a=>{e=void 0,n(a)});return new Se(()=>null==e?void 0:e(r))},requestAnimationFrame(...n){const{delegate:t}=P1;return((null==t?void 0:t.requestAnimationFrame)||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:t}=P1;return((null==t?void 0:t.cancelAnimationFrame)||cancelAnimationFrame)(...n)},delegate:void 0};new class hY extends FR{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class dY extends OR{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=P1.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:a}=t;null!=e&&(null===(r=a[a.length-1])||void 0===r?void 0:r.id)!==e&&(P1.cancelAnimationFrame(e),t._scheduled=void 0)}});let UR,fY=1;const YC={};function VB(n){return n in YC&&(delete YC[n],!0)}const mY={setImmediate(n){const t=fY++;return YC[t]=!0,UR||(UR=Promise.resolve()),UR.then(()=>VB(t)&&n()),t},clearImmediate(n){VB(n)}},{setImmediate:gY,clearImmediate:_Y}=mY,JC={setImmediate(...n){const{delegate:t}=JC;return((null==t?void 0:t.setImmediate)||gY)(...n)},clearImmediate(n){const{delegate:t}=JC;return((null==t?void 0:t.clearImmediate)||_Y)(n)},delegate:void 0};new class yY extends FR{flush(t){this._active=!0;const e=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===e&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===e&&i.shift();)t.unsubscribe();throw r}}}(class bY extends OR{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=JC.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,e,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,e,i);const{actions:a}=t;null!=e&&(null===(r=a[a.length-1])||void 0===r?void 0:r.id)!==e&&(JC.clearImmediate(e),t._scheduled=void 0)}});function HR(n=0,t,e=DZ){let i=-1;return null!=t&&(Il(t)?e=t:i=t),new yi(r=>{let a=function wY(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;a<0&&(a=0);let d=0;return e.schedule(function(){r.closed||(r.next(d++),0<=i?this.schedule(void 0,i):r.complete())},a)})}function jB(n,t=HC){return function xY(n){return Q((t,e)=>{let i=!1,r=null,a=null,d=!1;const b=()=>{if(null==a||a.unsubscribe(),a=null,i){i=!1;const A=r;r=null,e.next(A)}d&&e.complete()},x=()=>{a=null,d&&e.complete()};t.subscribe(Ce(e,A=>{i=!0,r=A,a||mn(n(A)).subscribe(a=Ce(e,b,x))},()=>{d=!0,(!i||!a||a.closed)&&e.complete()}))})}(()=>HR(n,t))}const SY=new en("cdk-dir-doc",{providedIn:"root",factory:function TY(){return $o(Oi)}}),CY=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Xm=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new Cn,e){const r=e.documentElement?e.documentElement.dir:null;this.value=function DY(n){const t=(null==n?void 0:n.toLowerCase())||"";return"auto"===t&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?CY.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((e.body?e.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(Tt(SY,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),KC=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({}),n})(),UB=(()=>{class n{constructor(e,i,r){this._ngZone=e,this._platform=i,this._scrolled=new On,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new yi(i=>{this._globalSubscription||this._addGlobalListener();const r=e>0?this._scrolled.pipe(jB(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):fi()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){const r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(Do(a=>!a||r.indexOf(a)>-1))}getAncestorScrollContainers(e){const i=[];return this.scrollContainers.forEach((r,a)=>{this._scrollableContainsElement(a,e)&&i.push(a)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,i){let r=H_(i),a=e.getElementRef().nativeElement;do{if(r==a)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>Ld(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(Tt(Ui),Tt(ga),Tt(Oi,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Od=(()=>{class n{constructor(e,i,r){this._platform=e,this._change=new On,this._changeListener=a=>{this._change.next(a)},this._document=r,i.runOutsideAngular(()=>{if(e.isBrowser){const a=this._getWindow();a.addEventListener("resize",this._changeListener),a.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,i=this._getWindow(),r=e.documentElement,a=r.getBoundingClientRect();return{top:-a.top||e.body.scrollTop||i.scrollY||r.scrollTop||0,left:-a.left||e.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(jB(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(Tt(ga),Tt(Ui),Tt(Oi,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),$_=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({}),n})(),qR=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[KC,$_,KC,$_]}),n})();class GR{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class Vh extends GR{constructor(t,e,i,r){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.componentFactoryResolver=r}}class W_ extends GR{constructor(t,e,i,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class MY extends GR{constructor(t){super(),this.element=t instanceof ci?t.nativeElement:t}}class k1{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof Vh?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof W_?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof MY?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class AY extends k1{constructor(t,e,i,r,a){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=d=>{const b=d.element,x=this._document.createComment("dom-portal");b.parentNode.insertBefore(x,b),this.outletElement.appendChild(b),this._attachedPortal=d,super.setDisposeFn(()=>{x.parentNode&&x.parentNode.replaceChild(b,x)})},this._document=a}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||Jo.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);-1!==r&&e.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let jh=(()=>{class n extends k1{constructor(e,i,r){super(),this._componentFactoryResolver=e,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new Cn,this.attachDomPortal=a=>{const d=a.element,b=this._document.createComment("dom-portal");a.setAttachedHost(this),d.parentNode.insertBefore(b,d),this._getRootNode().appendChild(d),this._attachedPortal=a,super.setDisposeFn(()=>{b.parentNode&&b.parentNode.replaceChild(d,b)})},this._document=r}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const i=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,a=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),d=i.createComponent(a,i.length,e.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(d.hostView.rootNodes[0]),super.setDisposeFn(()=>d.destroy()),this._attachedPortal=e,this._attachedRef=d,this.attached.emit(d),d}attachTemplatePortal(e){e.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return n.\u0275fac=function(e){return new(e||n)(ue(Pp),ue(Hs),ue(Oi))},n.\u0275dir=cn({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[Un]}),n})(),ll=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({}),n})();class HB{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const i=this._customTokens.get(t);return void 0!==i?i:this._parentInjector.get(t,e)}}const qB=dZ();class RY{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=_a(-this._previousScrollPosition.left),t.style.top=_a(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,a=i.scrollBehavior||"",d=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),qB&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),qB&&(i.scrollBehavior=a,r.scrollBehavior=d)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}}class PY{constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class GB{enable(){}disable(){}attach(){}}function $R(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function $B(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class kY{constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();$R(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let LY=(()=>{class n{constructor(e,i,r,a){this._scrollDispatcher=e,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new GB,this.close=d=>new PY(this._scrollDispatcher,this._ngZone,this._viewportRuler,d),this.block=()=>new RY(this._viewportRuler,this._document),this.reposition=d=>new kY(this._scrollDispatcher,this._viewportRuler,this._ngZone,d),this._document=a}}return n.\u0275fac=function(e){return new(e||n)(Tt(UB),Tt(Od),Tt(Ui),Tt(Oi))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class X_{constructor(t){if(this.scrollStrategy=new GB,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const i of e)void 0!==t[i]&&(this[i]=t[i])}}}class OY{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}class Zm{constructor(t,e,i,r,a,d,b,x,A,O=!1){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=a,this._keyboardDispatcher=d,this._document=b,this._location=x,this._outsideClickDispatcher=A,this._animationsDisabled=O,this._backdropElement=null,this._backdropClick=new On,this._attachments=new On,this._detachments=new On,this._locationChanges=Se.EMPTY,this._backdropClickHandler=B=>this._backdropClick.next(B),this._backdropTransitionendHandler=B=>{this._disposeBackdrop(B.target)},this._keydownEvents=new On,this._outsidePointerEvents=new On,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Ho(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof(null==e?void 0:e.onDestroy)&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){var t;const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(t=this._host)||void 0===t||t.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=_a(this._config.width),t.height=_a(this._config.height),t.minWidth=_a(this._config.minWidth),t.minHeight=_a(this._config.minHeight),t.maxWidth=_a(this._config.maxWidth),t.maxHeight=_a(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),this._animationsDisabled||"undefined"==typeof requestAnimationFrame?this._backdropElement.classList.add(t):this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})})}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,e,i){const r=qC(e||[]).filter(a=>!!a);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Mr(Oo(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let wv=(()=>{class n{constructor(e,i){this._platform=i,this._document=e}ngOnDestroy(){var e;null===(e=this._containerElement)||void 0===e||e.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||AR()){const r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let a=0;a<r.length;a++)r[a].remove()}const i=this._document.createElement("div");i.classList.add(e),AR()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi),Tt(ga))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const WB="cdk-overlay-connected-position-bounding-box",FY=/([A-Za-z%]+)$/;class NY{constructor(t,e,i,r,a){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=a,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new On,this._resizeSubscription=Se.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(WB),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,a=[];let d;for(let b of this._preferredPositions){let x=this._getOriginPoint(t,r,b),A=this._getOverlayPoint(x,e,b),O=this._getOverlayFit(A,e,i,b);if(O.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(b,x);this._canFitWithFlexibleDimensions(O,A,i)?a.push({position:b,origin:x,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(x,b)}):(!d||d.overlayFit.visibleArea<O.visibleArea)&&(d={overlayFit:O,overlayPoint:A,originPoint:x,position:b,overlayRect:e})}if(a.length){let b=null,x=-1;for(const A of a){const O=A.boundingBoxRect.width*A.boundingBoxRect.height*(A.position.weight||1);O>x&&(x=O,b=A)}return this._isPushed=!1,void this._applyPosition(b.position,b.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(d.position,d.originPoint);this._applyPosition(d.position,d.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Z_(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(WB),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,e)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e,i){let r,a;if("center"==i.originX)r=t.left+t.width/2;else{const d=this._isRtl()?t.right:t.left,b=this._isRtl()?t.left:t.right;r="start"==i.originX?d:b}return e.left<0&&(r-=e.left),a="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,e.top<0&&(a-=e.top),{x:r,y:a}}_getOverlayPoint(t,e,i){let r,a;return r="center"==i.overlayX?-e.width/2:"start"===i.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,a="center"==i.overlayY?-e.height/2:"top"==i.overlayY?0:-e.height,{x:t.x+r,y:t.y+a}}_getOverlayFit(t,e,i,r){const a=ZB(e);let{x:d,y:b}=t,x=this._getOffset(r,"x"),A=this._getOffset(r,"y");x&&(d+=x),A&&(b+=A);let X=0-b,te=b+a.height-i.height,se=this._subtractOverflows(a.width,0-d,d+a.width-i.width),me=this._subtractOverflows(a.height,X,te),ye=se*me;return{visibleArea:ye,isCompletelyWithinViewport:a.width*a.height===ye,fitsInViewportVertically:me===a.height,fitsInViewportHorizontally:se==a.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){const r=i.bottom-e.y,a=i.right-e.x,d=XB(this._overlayRef.getConfig().minHeight),b=XB(this._overlayRef.getConfig().minWidth),A=t.fitsInViewportHorizontally||null!=b&&b<=a;return(t.fitsInViewportVertically||null!=d&&d<=r)&&A}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=ZB(e),a=this._viewportRect,d=Math.max(t.x+r.width-a.width,0),b=Math.max(t.y+r.height-a.height,0),x=Math.max(a.top-i.top-t.y,0),A=Math.max(a.left-i.left-t.x,0);let O=0,B=0;return O=r.width<=a.width?A||-d:t.x<this._viewportMargin?a.left-i.left-t.x:0,B=r.height<=a.height?x||-b:t.y<this._viewportMargin?a.top-i.top-t.y:0,this._previousPushAmount={x:O,y:B},{x:t.x+O,y:t.y+B}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new OY(t,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let a=0;a<e.length;a++)e[a].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){const i=this._viewportRect,r=this._isRtl();let a,d,b,O,B,X;if("top"===e.overlayY)d=t.y,a=i.height-d+this._viewportMargin;else if("bottom"===e.overlayY)b=i.height-t.y+2*this._viewportMargin,a=i.height-b+this._viewportMargin;else{const te=Math.min(i.bottom-t.y+i.top,t.y),se=this._lastBoundingBoxSize.height;a=2*te,d=t.y-te,a>se&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.y-se/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)X=i.width-t.x+this._viewportMargin,O=t.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)B=t.x,O=i.right-t.x;else{const te=Math.min(i.right-t.x+i.left,t.x),se=this._lastBoundingBoxSize.width;O=2*te,B=t.x-te,O>se&&!this._isInitialRender&&!this._growAfterOpen&&(B=t.x-se/2)}return{top:d,left:B,bottom:b,right:X,width:O,height:a}}_setBoundingBoxStyles(t,e){const i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const a=this._overlayRef.getConfig().maxHeight,d=this._overlayRef.getConfig().maxWidth;r.height=_a(i.height),r.top=_a(i.top),r.bottom=_a(i.bottom),r.width=_a(i.width),r.left=_a(i.left),r.right=_a(i.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",a&&(r.maxHeight=_a(a)),d&&(r.maxWidth=_a(d))}this._lastBoundingBoxSize=i,Z_(this._boundingBox.style,r)}_resetBoundingBoxStyles(){Z_(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Z_(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const i={},r=this._hasExactPosition(),a=this._hasFlexibleDimensions,d=this._overlayRef.getConfig();if(r){const O=this._viewportRuler.getViewportScrollPosition();Z_(i,this._getExactOverlayY(e,t,O)),Z_(i,this._getExactOverlayX(e,t,O))}else i.position="static";let b="",x=this._getOffset(e,"x"),A=this._getOffset(e,"y");x&&(b+=`translateX(${x}px) `),A&&(b+=`translateY(${A}px)`),i.transform=b.trim(),d.maxHeight&&(r?i.maxHeight=_a(d.maxHeight):a&&(i.maxHeight="")),d.maxWidth&&(r?i.maxWidth=_a(d.maxWidth):a&&(i.maxWidth="")),Z_(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},a=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(a=this._pushOverlayOnScreen(a,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(a.y+this._overlayRect.height)+"px":r.top=_a(a.y),r}_getExactOverlayX(t,e,i){let d,r={left:"",right:""},a=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(a=this._pushOverlayOnScreen(a,this._overlayRect,i)),d=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===d?r.right=this._document.documentElement.clientWidth-(a.x+this._overlayRect.width)+"px":r.left=_a(a.x),r}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:$B(t,i),isOriginOutsideView:$R(t,i),isOverlayClipped:$B(e,i),isOverlayOutsideView:$R(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&qC(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof ci)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}}function Z_(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function XB(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split(FY);return e&&"px"!==e?null:parseFloat(t)}return n||null}function ZB(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const YB="cdk-global-overlay-wrapper";class BY{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(YB),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:a,maxWidth:d,maxHeight:b}=i,x=!("100%"!==r&&"100vw"!==r||d&&"100%"!==d&&"100vw"!==d),A=!("100%"!==a&&"100vh"!==a||b&&"100%"!==b&&"100vh"!==b),O=this._xPosition,B=this._xOffset,X="rtl"===this._overlayRef.getConfig().direction;let te="",se="",me="";x?me="flex-start":"center"===O?(me="center",X?se=B:te=B):X?"left"===O||"end"===O?(me="flex-end",te=B):("right"===O||"start"===O)&&(me="flex-start",se=B):"left"===O||"start"===O?(me="flex-start",te=B):("right"===O||"end"===O)&&(me="flex-end",se=B),t.position=this._cssPosition,t.marginLeft=x?"0":te,t.marginTop=A?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=x?"0":se,e.justifyContent=me,e.alignItems=A?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(YB),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let zY=(()=>{class n{constructor(e,i,r,a){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=a}global(){return new BY}flexibleConnectedTo(e){return new NY(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(Tt(Od),Tt(Oi),Tt(ga),Tt(wv))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),JB=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),VY=(()=>{class n extends JB{constructor(e,i){super(e),this._ngZone=i,this._keydownListener=r=>{const a=this._attachedOverlays;for(let d=a.length-1;d>-1;d--)if(a[d]._keydownEvents.observers.length>0){const b=a[d]._keydownEvents;this._ngZone?this._ngZone.run(()=>b.next(r)):b.next(r);break}}}add(e){super.add(e),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi),Tt(Ui,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),jY=(()=>{class n extends JB{constructor(e,i,r){super(e),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=a=>{this._pointerDownEventTarget=$m(a)},this._clickListener=a=>{const d=$m(a),b="click"===a.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:d;this._pointerDownEventTarget=null;const x=this._attachedOverlays.slice();for(let A=x.length-1;A>-1;A--){const O=x[A];if(O._outsidePointerEvents.observers.length<1||!O.hasAttached())continue;if(O.overlayElement.contains(d)||O.overlayElement.contains(b))break;const B=O._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>B.next(a)):B.next(a)}}}add(e){if(super.add(e),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(e){e.addEventListener("pointerdown",this._pointerDownListener,!0),e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(e){return new(e||n)(Tt(Oi),Tt(ga),Tt(Ui,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),UY=0,Gs=(()=>{class n{constructor(e,i,r,a,d,b,x,A,O,B,X,te){this.scrollStrategies=e,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=a,this._keyboardDispatcher=d,this._injector=b,this._ngZone=x,this._document=A,this._directionality=O,this._location=B,this._outsideClickDispatcher=X,this._animationsModuleType=te}create(e){const i=this._createHostElement(),r=this._createPaneElement(i),a=this._createPortalOutlet(r),d=new X_(e);return d.direction=d.direction||this._directionality.value,new Zm(a,i,r,d,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(e){const i=this._document.createElement("div");return i.id="cdk-overlay-"+UY++,i.classList.add("cdk-overlay-pane"),e.appendChild(i),i}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(Wy)),new AY(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(Tt(LY),Tt(wv),Tt(Pp),Tt(zY),Tt(VY),Tt(Jo),Tt(Ui),Tt(Oi),Tt(Xm),Tt(JS),Tt(jY),Tt(Ah,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();const HY=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],KB=new en("cdk-connected-overlay-scroll-strategy");let QB=(()=>{class n{constructor(e){this.elementRef=e}}return n.\u0275fac=function(e){return new(e||n)(ue(ci))},n.\u0275dir=cn({type:n,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),n})(),ez=(()=>{class n{constructor(e,i,r,a,d){this._overlay=e,this._dir=d,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=Se.EMPTY,this._attachSubscription=Se.EMPTY,this._detachSubscription=Se.EMPTY,this._positionSubscription=Se.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new Cn,this.positionChange=new Cn,this.attach=new Cn,this.detach=new Cn,this.overlayKeydown=new Cn,this.overlayOutsideClick=new Cn,this._templatePortal=new W_(i,r),this._scrollStrategyFactory=a,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=Ai(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=Ai(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=Ai(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=Ai(e)}get push(){return this._push}set push(e){this._push=Ai(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=HY);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!al(i)&&(i.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{this.overlayOutsideClick.next(i)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),i=new X_({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(e){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return e.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(e),e}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof QB?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(qF(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(ue(Gs),ue(ls),ue(Hs),ue(KB),ue(Xm,8))},n.\u0275dir=cn({type:n,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[ho]}),n})();const GY={provide:KB,deps:[Gs],useFactory:function qY(n){return()=>n.scrollStrategies.reposition()}};let Tc=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[Gs,GY],imports:[KC,ll,qR,qR]}),n})();const $Y=["*",[["sbb-option"],["ng-container"],["sbb-option-hint"],["sbb-autocomplete-hint"]]],WY=["*","sbb-option, ng-container, sbb-option-hint, sbb-autocomplete-hint"];function XY(n,t){if(1&n&&rn(0,"sbb-pseudo-checkbox",2),2&n){const e=St();Pe("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function ZY(n,t){if(1&n&&(ne(0,"span",3),Z(1),oe()),2&n){const e=St();pe(1),De("(",e.group.label,")")}}const YY=["*"],JY=(new vh("14.1.7"),"undefined"!=typeof globalThis&&globalThis),KY="undefined"!=typeof window&&window,QY="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,WR=JY||"undefined"!=typeof global&&global||KY||QY,XR=function(n,...t){if(XR.translate){const i=XR.translate(n,t);n=i[0],t=i[1]}let e=rz(n[0],n.raw[0]);for(let i=1;i<n.length;i++)e+=t[i-1]+rz(n[i],n.raw[i]);return e};function rz(n,t){return":"===t.charAt(0)?n.substring(function eJ(n,t){for(let e=1,i=1;e<n.length;e++,i++)if("\\"===t[i])i++;else if(":"===n[e])return e;throw new Error(`Unterminated $localize metadata block in "${t}".`)}(n,t)+1):n}const ZR=new il("standard");function Y_(n){return class extends n{constructor(...t){super(...t),this.variant=ZR}get variantSnapshot(){return ZR.value}}}const nJ=new en("sbb-sanity-checks",{providedIn:"root",factory:function tJ(){return!0}});let Ur=(()=>{class n{constructor(e,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,ZR.next(this._document.documentElement.classList.contains("sbb-lean")?"lean":"standard"),e._applyBodyHighContrastModeCssClasses(),function iJ(){"function"!=typeof WR.$localize&&(WR.$localize=Object.assign(XR,WR.$localize))}(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!AR()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return n.\u0275fac=function(e){return new(e||n)(Tt(BB),Tt(nJ,8),Tt(Oi))},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({}),n})();function Zl(n){return class extends n{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=Ai(t)}}}function QC(n){return class extends n{constructor(...t){super(...t),this.errorState=!1}updateErrorState(){const t=this.errorState,a=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);a!==t&&(this.errorState=a,this.stateChanges.next())}}}function oz(n){return class extends n{constructor(...t){super(...t),this._isInitialized=!1,this._pendingSubscribers=[],this.initialized=new yi(e=>{this._isInitialized?this._notifySubscriber(e):this._pendingSubscribers.push(e)})}_markInitialized(){this._isInitialized=!0,this._pendingSubscribers.forEach(this._notifySubscriber),this._pendingSubscribers=null}_notifySubscriber(t){t.next(),t.complete()}}}function Sv(n,t=0){return class extends n{constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?yf(e):this.defaultTabIndex}}}class Ym{deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this._locale=t}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){const i=this.isValid(t),r=this.isValid(e);return i&&r?!this.compareDate(t,e):i===r}return t===e}clampDate(t,e,i){return e&&this.compareDate(t,e)<0?e:i&&this.compareDate(t,i)>0?i:t}}const eD=new en("sbb-date-formats"),rJ={dateInput:"EEEEEE, dd.MM.yyyy",dateInputPure:"dd.MM.yyyy",dateA11yLabel:"dd MM yyyy"},sz=new en("SBB_DATEPICKER_2DIGIT_YEAR_PIVOT"),oJ=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function YR(n,t){const e=Array(n);for(let i=0;i<n;i++)e[i]=t(i);return e}let az=(()=>{class n extends Ym{constructor(e,i){super(),this._locale=e,this._titleCasePipe=new nL,this._datePipe=new iL(e),this._yearPivot="number"==typeof i?i:(new Date).getFullYear()-1975}getYear(e){return e.getFullYear()}getMonth(e){return e.getMonth()}getDate(e){return e.getDate()}getDayOfWeek(e){return e.getDay()}getMonthName(e){return this._datePipe.transform(e,"LLLL")}getMonthNames(e){let i;switch(e){case"long":i="LLLL";break;case"narrow":i="LLLLL";break;default:i="LLL"}return YR(12,r=>this._datePipe.transform(new Date(2017,r,1),i))}getDateNames(){return YR(31,e=>this._datePipe.transform(new Date(2017,0,e+1),"d"))}getDayOfWeekNames(e){let i;switch(e){case"long":i="EEEE";break;case"narrow":i="EEEEE";break;default:i="EEE"}return YR(7,r=>this._datePipe.transform(new Date(2017,0,r+1),i))}getYearName(e){return this._datePipe.transform(e,"yyyy")}getFirstDayOfWeek(){return 1}getNumDaysInMonth(e){const i=new Date(0);return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.setHours(0,0,0,0),i.getDate()}clone(e){return new Date(e.valueOf())}createDate(e,i,r){if(i<0||i>11)throw Error(`Invalid month index "${i}". Month index has to be between 0 and 11.`);if(r<1)throw Error(`Invalid date "${r}". Date has to be greater than 0.`);const a=this._createDateWithOverflow(e,i,r);if(a.getMonth()!==i)throw Error(`Invalid date "${r}" for month with index "${i}".`);return a}today(){const e=new Date;return e.setHours(0,0,0,0),e}parse(e){return"number"==typeof e?new Date(e):"string"==typeof e?this._parseStringDate(e):null}format(e,i){if(!this.isValid(e))throw Error("NativeDateAdapter: Cannot format invalid date.");return this._titleCasePipe.transform(this._datePipe.transform(e,i))}addCalendarYears(e,i){return this.addCalendarMonths(e,12*i)}addCalendarMonths(e,i){const r=e.getMonth()+i,a=new Date(0);a.setFullYear(e.getFullYear(),r,1),a.setHours(0,0,0,0);const d=this.getNumDaysInMonth(a),b=this.clone(e);return b.setMonth(r,Math.min(d,e.getDate())),b}addCalendarDays(e,i){const r=this.clone(e);return r.setDate(r.getDate()+i),r}toIso8601(e){return this._datePipe.transform(e,"yyyy-MM-dd")}deserialize(e){if("string"==typeof e){if(!e)return null;if(oJ.test(e)){const i=new Date(e);if(this.isValid(i))return i}}return super.deserialize(e)}isDateInstance(e){return e instanceof Date}isValid(e){return!isNaN(e.valueOf())}invalid(){return new Date(NaN)}_parseStringDate(e){const i=/^(\w+,[ ]?)?(\d+)\.(\d+)\.(\d+)$/.exec(e);if(!i)return null;const r=this._createDateWithOverflow(+i[4],+i[3]-1,+i[2]);return this._normalizeYear(r)}_normalizeYear(e){if(e.getFullYear()<0||e.getFullYear()>=100)return e;const i=e.getFullYear()<=this._yearPivot?2e3:1900;return new Date(e.getFullYear()+i,e.getMonth(),e.getDate())}_createDateWithOverflow(e,i,r){const a=new Date(e,i,r);return e>=0&&e<100&&a.setFullYear(this.getYear(a)-1900),a}}return n.\u0275fac=function(e){return new(e||n)(Tt(Kc),Tt(sz,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),JR=(()=>{class n{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const tD=new en("SBB_OPTION_PARENT_COMPONENT"),sJ=Zl(class{});let aJ=0;const lz=new en("SbbOptgroup");let KR=(()=>{class n extends sJ{constructor(e){var i;super(),this._labelId="sbb-optgroup-label-"+aJ++,this._inert=null!==(i=null==e?void 0:e.inertGroups)&&void 0!==i&&i}}return n.\u0275fac=function(e){return new(e||n)(ue(tD,8))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-optgroup"]],hostAttrs:[1,"sbb-optgroup","sbb-menu-group"],hostVars:5,hostBindings:function(e,i){2&e&&(si("role",i._inert?null:"group")("aria-disabled",i._inert?null:i.disabled.toString())("aria-labelledby",i._inert?null:i._labelId),_("sbb-disabled",i.disabled))},inputs:{disabled:"disabled",label:"label"},exportAs:["sbbOptgroup"],features:[Mi([{provide:lz,useExisting:n}]),Un],ngContentSelectors:WY,decls:4,vars:2,consts:[[1,"sbb-label","sbb-optgroup-label",3,"id"]],template:function(e,i){1&e&&(Rs($Y),ne(0,"label",0),Z(1),Co(2),oe(),Co(3,1)),2&e&&(Pe("id",i._labelId),pe(1),De("",i.label," "))},encapsulation:2,changeDetection:0}),n})(),lJ=(()=>{class n{constructor(){this.state="unchecked",this.disabled=!1}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Jt({type:n,selectors:[["sbb-pseudo-checkbox"]],hostAttrs:[1,"sbb-pseudo-checkbox"],hostVars:6,hostBindings:function(e,i){2&e&&_("sbb-selection-disabled",i.disabled)("sbb-selection-checked","checked"===i.state)("sbb-selection-indeterminate","indeterminate"===i.state)},inputs:{state:"state",disabled:"disabled"},decls:4,vars:0,consts:[[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"]],template:function(e,i){1&e&&(ne(0,"div",0)(1,"span",1),gu(),ne(2,"svg",2),rn(3,"polyline",3),oe()()())},encapsulation:2,changeDetection:0}),n})(),cJ=0;class cz{constructor(t,e=!1){this.source=t,this.isUserInput=e}}let L1=(()=>{class n{constructor(e,i,r,a,d){this._element=e,this._document=i,this._changeDetectorRef=r,this._parent=a,this.group=d,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this._highlighted=!1,this.id="sbb-option-"+cJ++,this.onSelectionChange=new Cn,this._stateChanges=new On}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=Ai(e),this._changeDetectorRef.markForCheck()}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this.selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this.active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this.active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!al(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this.selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_highlight(e,i){if(void 0===this._originalInnerHtml)this._originalInnerHtml=this._element.nativeElement.innerHTML;else{if(e===this._highlightValue)return;this._highlighted&&(this._element.nativeElement.innerHTML=this._originalInnerHtml,this._highlighted=!1)}if(this._highlightValue=e,e&&this._originalInnerHtml){const r=i||(x=>x),a=(e=r(e)).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),d=new RegExp(`${a}+`,"i"),b=this._findAllTextNodesWithMatch(d,r);b.forEach(x=>this._highlightNode(x,d,r)),this._highlighted=!!b.length}}_findAllTextNodesWithMatch(e,i,r=this._element.nativeElement){const a=[],d=r.childNodes;for(let b=0;b<d.length;b++){const x=d[b];3===x.nodeType&&e.test(i(x.textContent||""))?a.push(x):x.childNodes.length&&a.push(...this._findAllTextNodesWithMatch(e,i,x))}return a}_highlightNode(e,i,r){const a=[],d=this._document;i.lastIndex=0;let x,b=e.textContent||"";do{if(x=r(b).match(i),!x){a.push(d.createTextNode(b));continue}x.index&&(a.push(d.createTextNode(b.substring(0,x.index))),b=b.substring(x.index));const O=d.createElement("strong");O.textContent=b.substring(0,x[0].length),a.push(O),b=b.substring(x[0].length)}while(x);const A=e.parentNode;a.forEach(O=>A.insertBefore(O,e)),A.removeChild(e)}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new cz(this,e))}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(Oi),ue(So),ue(tD,8),ue(lz,8))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-option"]],hostAttrs:["role","option",1,"sbb-option","sbb-menu-item","sbb-link-reset"],hostVars:12,hostBindings:function(e,i){1&e&&Wt("keydown",function(a){return i._handleKeydown(a)})("click",function(){return i._selectViaInteraction()}),2&e&&(dr("id",i.id),si("tabindex",i._getTabIndex())("aria-selected",i._getAriaSelected())("aria-disabled",i.disabled.toString()),_("sbb-selected",i.selected)("sbb-option-multiple",i.multiple)("sbb-focused",i.active)("sbb-disabled",i.disabled))},inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["sbbOption"],ngContentSelectors:YY,decls:3,vars:2,consts:[[3,"disabled","state",4,"ngIf"],["class","cdk-visually-hidden",4,"ngIf"],[3,"disabled","state"],[1,"cdk-visually-hidden"]],template:function(e,i){1&e&&(Rs(),yt(0,XY,1,2,"sbb-pseudo-checkbox",0),Co(1),yt(2,ZY,2,1,"span",1)),2&e&&(Pe("ngIf",i.multiple),pe(2),Pe("ngIf",i.group&&i.group._inert))},dependencies:[Zo,lJ],styles:[".sbb-option.sbb-menu-item{cursor:default}.sbb-pseudo-checkbox{display:inline-block;margin-right:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-bottom:calc(-0.3rem * var(--sbb-scaling-factor));overflow:hidden;line-height:0}.sbb-pseudo-checkbox .sbb-selection-container{margin:0}"],encapsulation:2,changeDetection:0}),n})();function uz(n,t,e,i){return n<e?n:n+t>e+i?Math.max(0,n-i+t):e}let dJ=0,hJ=(()=>{class n{constructor(){this.id="sbb-option-hint-"+dJ++}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["sbb-option-hint"]],hostAttrs:[1,"sbb-option-hint","sbb-label"],hostVars:1,hostBindings:function(e,i){2&e&&si("id",i.id)}}),n})(),nD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur]}),n})();const pJ=["*"];let iD;function O1(n){var t;return(null===(t=function fJ(){if(void 0===iD&&(iD=null,"undefined"!=typeof window)){const n=window;void 0!==n.trustedTypes&&(iD=n.trustedTypes.createPolicy("sbb-esta#angular",{createHTML:t=>t}))}return iD}())||void 0===t?void 0:t.createHTML(n))||n}function dz(n){return Error(`Unable to find icon with the name "${n}"`)}function hz(n){return Error(`The URL provided to SbbIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${n}".`)}function pz(n){return Error(`The literal provided to SbbIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${n}".`)}class Jm{constructor(t,e,i){this.url=t,this.svgText=e,this.options=i}}let gJ=(()=>{class n{constructor(e,i,r,a){this._httpClient=e,this._sanitizer=i,this._errorHandler=a,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["sbb-icons"],this._sbbCdnSupportedNamespaces=["kom","fpl"],this._document=r}addSvgIcon(e,i,r){return this.addSvgIconInNamespace("",e,i,r)}addSvgIconLiteral(e,i,r){return this.addSvgIconLiteralInNamespace("",e,i,r)}addSvgIconInNamespace(e,i,r,a){return this._addSvgIconConfig(e,i,new Jm(r,null,a))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,i,r,a){const d=this._sanitizer.sanitize(fo.HTML,r);if(!d)throw pz(r);const b=O1(d);return this._addSvgIconConfig(e,i,new Jm("",b,a))}addSvgIconSet(e,i){return this.addSvgIconSetInNamespace("",e,i)}addSvgIconSetLiteral(e,i){return this.addSvgIconSetLiteralInNamespace("",e,i)}addSvgIconSetInNamespace(e,i,r){return this._addSvgIconSetConfig(e,new Jm(i,null,r))}addSvgIconSetLiteralInNamespace(e,i,r){const a=this._sanitizer.sanitize(fo.HTML,i);if(!a)throw pz(i);const d=O1(a);return this._addSvgIconSetConfig(e,new Jm("",d,r))}registerFontClassAlias(e,i=e){return this._fontCssClassesByAlias.set(e,i),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const i=this._sanitizer.sanitize(fo.RESOURCE_URL,e);if(!i)throw hz(e);const r=this._cachedIconsByUrl.get(i);return r?fi(rD(r)):this._loadSvgIconFromConfig(new Jm(e,null)).pipe(qs(a=>this._cachedIconsByUrl.set(i,a)),st(a=>rD(a)))}getNamedSvgIcon(e,i=""){const r=fz(i,e);let a=this._svgIconConfigs.get(r);if(a)return this._getSvgFromConfig(a);if(a=this._getIconConfigFromResolvers(i,e),a)return this._svgIconConfigs.set(r,a),this._getSvgFromConfig(a);const d=this._iconSetConfigs.get(i);return d?this._getSvgFromIconSetConfigs(e,d):ev(dz(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?fi(rD(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(st(i=>rD(i)))}_getSvgFromIconSetConfigs(e,i){const r=this._extractIconWithNameFromAnySet(e,i);return r?fi(r):PO(i.filter(d=>!d.svgText).map(d=>this._loadSvgIconSetFromConfig(d).pipe(uf(b=>{const A=`Loading icon set URL: ${this._sanitizer.sanitize(fo.RESOURCE_URL,d.url)} failed: ${b.message}`;return this._errorHandler.handleError(new Error(A)),fi(null)})))).pipe(st(()=>{const d=this._extractIconWithNameFromAnySet(e,i);if(!d)throw dz(e);return d}))}_extractIconWithNameFromAnySet(e,i){for(let r=i.length-1;r>=0;r--){const a=i[r];if(a.svgText&&a.svgText.toString().indexOf(e)>-1){const d=this._svgElementFromConfig(a),b=this._extractSvgIconFromSet(d,e,a.options);if(b)return b}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(qs(i=>e.svgText=i),st(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?fi(null):this._fetchIcon(e).pipe(qs(i=>e.svgText=i))}_extractSvgIconFromSet(e,i,r){const a=e.querySelector(`[id="${i}"]`);if(!a)return null;const d=a.cloneNode(!0);if(d.removeAttribute("id"),"svg"===d.nodeName.toLowerCase())return this._setSvgAttributes(d,r);if("symbol"===d.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(d),r);const b=this._svgElementFromString(O1("<svg></svg>"));return b.appendChild(d),this._setSvgAttributes(b,r)}_svgElementFromString(e){const i=this._document.createElement("DIV");i.innerHTML=e;const r=i.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(e){const i=this._svgElementFromString(O1("<svg></svg>")),r=e.attributes;for(let a=0;a<r.length;a++){const{name:d,value:b}=r[a];"id"!==d&&i.setAttribute(d,b)}for(let a=0;a<e.childNodes.length;a++)e.childNodes[a].nodeType===this._document.ELEMENT_NODE&&i.appendChild(e.childNodes[a].cloneNode(!0));return i}_setSvgAttributes(e,i){return e.setAttribute("fit",""),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),i&&i.viewBox&&e.setAttribute("viewBox",i.viewBox),e}_fetchIcon(e){var i;const{url:r,options:a}=e,d=null!==(i=null==a?void 0:a.withCredentials)&&void 0!==i&&i;if(!this._httpClient)throw function mJ(){return Error("Could not find HttpClient provider for use with Sbb Angular icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==r)throw Error(`Cannot fetch icon from URL "${r}".`);const b=this._sanitizer.sanitize(fo.RESOURCE_URL,r);if(!b)throw hz(r);const x=this._inProgressUrlFetches.get(b);if(x)return x;const A=this._httpClient.get(b,{responseType:"text",withCredentials:d}).pipe(st(O=>O1(O)),$T(()=>this._inProgressUrlFetches.delete(b)),Rl());return this._inProgressUrlFetches.set(b,A),A}_addSvgIconConfig(e,i,r){return this._svgIconConfigs.set(fz(e,i),r),this}_addSvgIconSetConfig(e,i){const r=this._iconSetConfigs.get(e);return r?r.push(i):this._iconSetConfigs.set(e,[i]),this}_svgElementFromConfig(e){if(!e.svgElement){const i=this._svgElementFromString(e.svgText);this._setSvgAttributes(i,e.options),e.svgElement=i}return e.svgElement}_getIconConfigFromResolvers(e,i){for(let r=0;r<this._resolvers.length;r++){const a=this._resolvers[r](i,e);if(a)return _J(a)?new Jm(a.url,null,a.options):new Jm(a,null)}if(-1!==this._sbbCdnSupportedNamespaces.indexOf(e)){const r=this._sanitizer.bypassSecurityTrustResourceUrl(`https://icons.app.sbb.ch/${e}/${i}.svg`);return new Jm(r,null)}}}return n.\u0275fac=function(e){return new(e||n)(Tt(GM,8),Tt(mT),Tt(Oi,8),Tt(Mu))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function rD(n){return n.cloneNode(!0)}function fz(n,t){return n+":"+t}function _J(n){return!(!n.url||!n.options)}const bJ=new en("sbb-icon-location",{providedIn:"root",factory:function yJ(){const n=$o(Oi),t=n?n.location:null;return{getPathname:()=>t?t.pathname+t.search:""}}}),mz=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],vJ=mz.map(n=>`[${n}]`).join(", "),xJ=/^url\(['"]?#(.*?)['"]?\)$/;let cl=(()=>{class n{constructor(e,i,r,a,d){this._elementRef=e,this._iconRegistry=i,this._location=a,this._errorHandler=d,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=Se.EMPTY,r||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=Ai(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const i=this._cleanupFontValue(e);i!==this._fontSet&&(this._fontSet=i,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const i=this._cleanupFontValue(e);i!==this._fontIcon&&(this._fontIcon=i,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const i=e.split(":");switch(i.length){case 1:return["",i[0]];case 2:return i;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const i=this._location.getPathname();i!==this._previousPath&&(this._previousPath=i,this._prependPathToReferences(i))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const i=this._location.getPathname();this._previousPath=i,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(i),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let i=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();i--;){const r=e.childNodes[i];(1!==r.nodeType||"svg"===r.nodeName.toLowerCase())&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,i=(this.fontSet?[this._iconRegistry.classNameForFontAlias(this.fontSet)]:this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>e.classList.remove(r)),i.forEach(r=>e.classList.add(r)),this._previousFontSetClass=i,this.fontIcon!==this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const i=this._elementsWithExternalReferences;i&&i.forEach((r,a)=>{r.forEach(d=>{a.setAttribute(d.name,`url('${e}#${d.value}')`)})})}_cacheChildrenWithExternalReferences(e){const i=e.querySelectorAll(vJ),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let a=0;a<i.length;a++)mz.forEach(d=>{const b=i[a],x=b.getAttribute(d),A=x?x.match(xJ):null;if(A){let O=r.get(b);O||(O=[],r.set(b,O)),O.push({name:d,value:A[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[i,r]=this._splitIconName(e);i&&(this._svgNamespace=i),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,i).pipe(Ho(1)).subscribe(a=>this._setSvgElement(a),a=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${i}:${r}! ${a.message}`))})}}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(gJ),hs("aria-hidden"),ue(bJ),ue(Mu))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-icon"]],hostAttrs:["role","img",1,"sbb-icon","notranslate"],hostVars:5,hostBindings:function(e,i){2&e&&(si("data-sbb-icon-type",i._usingFontIcon()?"font":"svg")("data-sbb-icon-name",i._svgName||i.fontIcon)("data-sbb-icon-namespace",i._svgNamespace||i.fontSet),_("sbb-icon-inline",i.inline))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["sbbIcon"],ngContentSelectors:pJ,decls:1,vars:0,template:function(e,i){1&e&&(Rs(),Co(0))},styles:[".sbb-icon{background-repeat:no-repeat;display:inline-block;line-height:0;overflow:hidden}.sbb-icon svg:not(.color-immutable) [fill]:not([fill=none]){fill:currentColor}.sbb-icon svg:not(.color-immutable) [stroke]:not([stroke=none]){stroke:currentColor}.sbb-icon svg:not(.color-immutable)>:where(path,polygon,polyline):where(:not([stroke]):not([fill])),.sbb-icon svg:not(.color-immutable) :where(:not([stroke]):not([fill])) :where(path,polygon,polyline):where(:not([stroke]):not([fill])){fill:currentColor}.sbb-icon.sbb-icon-inline{vertical-align:middle;margin-block-start:calc(-.2666666667rem*var(--sbb-scaling-factor));margin-block-end:calc(-.1333333333rem*var(--sbb-scaling-factor))}:where(.sbb-icon-fit) .sbb-icon,.sbb-icon:where(.sbb-icon-fit),:where(.sbb-icon-fit,.sbb-icon-scaled) .sbb-icon svg,.sbb-icon:where(.sbb-icon-fit,.sbb-icon-scaled) svg{width:100%;height:100%}:where(.sbb-icon-scaled) .sbb-icon,.sbb-icon:where(.sbb-icon-scaled){width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default)}"],encapsulation:2,changeDetection:0}),n})(),Ss=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[Ur]}),n})();function wJ(n,t){}function SJ(n,t){}function TJ(n,t){1&n&&(ne(0,"button",1),rn(1,"sbb-icon",2),oe()),2&n&&Pe("aria-label",St().closeAriaLabel)}const CJ=["*"];class oD{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let gz=(()=>{class n extends k1{constructor(e,i,r,a,d,b,x,A){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=a,this._interactivityChecker=d,this._ngZone=b,this._overlayRef=x,this._focusMonitor=A,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=O=>{this._portalOutlet.hasAttached();const B=this._portalOutlet.attachDomPortal(O);return this._contentAttached(),B},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=kd(),a=this._elementRef.nativeElement;(!r||r===this._document.body||r===a||a.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=kd();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=kd())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(vv),ue(Oi,8),ue(oD),ue(q_),ue(Ui),ue(Zm),ue(Cl))},n.\u0275cmp=Jt({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&mo(jh,7),2&e){let r;xi(r=wi())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&si("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Un],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&yt(0,wJ,0,0,"ng-template",0)},dependencies:[jh],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class QR{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new On,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!al(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const _z=new en("DialogScrollStrategy"),DJ=new en("DialogData"),EJ=new en("DefaultDialogConfig"),MJ={provide:_z,deps:[Gs],useFactory:function IJ(n){return()=>n.scrollStrategies.block()}};let AJ=0,bz=(()=>{class n{constructor(e,i,r,a,d,b){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=a,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new On,this._afterOpenedAtThisLevel=new On,this._ariaHiddenElements=new Map,this.afterAllClosed=A_(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Ra(void 0))),this._scrollStrategy=b}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new oD;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+AJ++,i.id&&this.getDialogById(i.id);const a=this._getOverlayConfig(i),d=this._overlay.create(a),b=new QR(d,i),x=this._attachContainer(d,b,i);return b.containerInstance=x,this._attachDialogContent(e,b,x,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(b),b.closed.subscribe(()=>this._removeOpenDialog(b,!0)),this.afterOpened.next(b),b}closeAll(){e2(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){e2(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),e2(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new X_({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var a;const d=r.injector||(null===(a=r.viewContainerRef)||void 0===a?void 0:a.injector),b=[{provide:oD,useValue:r},{provide:QR,useValue:i},{provide:Zm,useValue:e}];let x;r.container?"function"==typeof r.container?x=r.container:(x=r.container.type,b.push(...r.container.providers(r))):x=gz;const A=new Vh(x,r.viewContainerRef,Jo.create({parent:d||this._injector,providers:b}),r.componentFactoryResolver);return e.attach(A).instance}_attachDialogContent(e,i,r,a){if(e instanceof ls){const d=this._createInjector(a,i,r,void 0);let b={$implicit:a.data,dialogRef:i};a.templateContext&&(b=Object.assign(Object.assign({},b),"function"==typeof a.templateContext?a.templateContext():a.templateContext)),r.attachTemplatePortal(new W_(e,null,b,d))}else{const d=this._createInjector(a,i,r,this._injector),b=r.attachComponentPortal(new Vh(e,a.viewContainerRef,d,a.componentFactoryResolver));i.componentInstance=b.instance}}_createInjector(e,i,r,a){var d;const b=e.injector||(null===(d=e.viewContainerRef)||void 0===d?void 0:d.injector),x=[{provide:DJ,useValue:e.data},{provide:QR,useValue:i}];return e.providers&&("function"==typeof e.providers?x.push(...e.providers(i,e,r)):x.push(...e.providers)),e.direction&&(!b||!b.get(Xm,null,Ei.Optional))&&x.push({provide:Xm,useValue:{value:e.direction,change:fi()}}),Jo.create({parent:b||a,providers:x})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((a,d)=>{a?d.setAttribute("aria-hidden",a):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const a=i[r];a!==e&&"SCRIPT"!==a.nodeName&&"STYLE"!==a.nodeName&&!a.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(a,a.getAttribute("aria-hidden")),a.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Tt(Gs),Tt(Jo),Tt(EJ,8),Tt(n,12),Tt(wv),Tt(_z))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();function e2(n,t){let e=n.length;for(;e--;)t(n[e])}let RJ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[bz,MJ],imports:[Tc,ll,G_,ll]}),n})();const Tv={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},PJ={dialogContainer:Aa("dialogContainer",[_o("void, exit",bi({opacity:0,transform:"scale(0.7)"})),_o("enter",bi({transform:"none"})),jr("* => enter",PL([Kr("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",bi({transform:"none",opacity:1})),mM("@*",fM(),{optional:!0})]),Tv),jr("* => void, * => exit",PL([Kr("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",bi({opacity:0})),mM("@*",fM(),{optional:!0})]),Tv)])};class F1{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.maxHeight="96vh",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.delayFocusTrap=!1,this.closeOnNavigation=!0,this.enterAnimationDuration=Tv.params.enterAnimationDuration,this.exitAnimationDuration=Tv.params.exitAnimationDuration}}let yz=(()=>{class n extends gz{constructor(e,i,r,a,d,b,x,A){super(e,i,r,a,d,b,x,A),this._animationStateChanged=new Cn,this._state="enter"}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_getAnimationState(){return{value:this._state,params:{enterAnimationDuration:this._config.enterAnimationDuration||Tv.params.enterAnimationDuration,exitAnimationDuration:this._config.exitAnimationDuration||Tv.params.exitAnimationDuration}}}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(vv),ue(Oi,8),ue(F1),ue(q_),ue(Ui),ue(Zm),ue(Cl))},n.\u0275cmp=Jt({type:n,selectors:[["ng-component"]],features:[Un],decls:0,vars:0,template:function(e,i){},encapsulation:2}),n})(),kJ=(()=>{class n extends yz{constructor(e,i,r,a,d,b,x,A,O){super(e,i,r,a,d,b,x,O),this._changeDetectorRef=A}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?this._openAnimationDone(i):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(vv),ue(Oi,8),ue(F1),ue(q_),ue(Ui),ue(Zm),ue(So),ue(Cl))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-dialog-container"],hostVars:6,hostBindings:function(e,i){1&e&&Eh("@dialogContainer.done",function(a){return i._onAnimationDone(a)})("@dialogContainer.start",function(a){return i._onAnimationStart(a)}),2&e&&(dr("id",i._config.id),si("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Qs("@dialogContainer",i._getAnimationState()))},features:[Un],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&yt(0,SJ,0,0,"ng-template",0)},dependencies:[jh],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-dialog-container{display:flex;flex-direction:column;border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);box-shadow:var(--sbb-box-shadow-below);width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .sbb-dialog-container{outline:solid .0666666667rem}.sbb-dialog-container>*:only-child:not(.sbb-dialog-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-dialog-content{display:block;padding:var(--sbb-dialog-padding);flex:1 1 auto;max-height:80vh;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-dialog-content>*:first-child{margin-top:0}.sbb-dialog-title{font-size:var(--sbb-font-size);padding:calc(1rem * var(--sbb-scaling-factor)) calc(2.6666666667rem * var(--sbb-scaling-factor)) calc(1rem * var(--sbb-scaling-factor)) var(--sbb-dialog-padding);flex:0 0 auto;display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(3.5333333333rem * var(--sbb-scaling-factor))}.sbb-dialog-title-close-button{position:absolute;right:calc(1.0666666667rem * var(--sbb-scaling-factor));cursor:pointer;line-height:0}.sbb-dialog-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}.sbb-dialog-actions{padding:calc(0.4666666667rem * var(--sbb-scaling-factor)) calc(1.0666666667rem * var(--sbb-scaling-factor));display:flex;flex:0 0 auto;flex-wrap:wrap;gap:var(--sbb-button-gap);align-items:center;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}.sbb-dialog-actions.sbb-dialog-actions-align-start,.sbb-dialog-actions[align=start],.sbb-dialog-actions[align=left]{justify-content:flex-start}.sbb-dialog-actions.sbb-dialog-actions-align-center,.sbb-dialog-actions[align=center]{justify-content:center}.sbb-dialog-actions.sbb-dialog-actions-align-end,.sbb-dialog-actions[align=end]{justify-content:flex-end}"],encapsulation:2,data:{animation:[PJ.dialogContainer]}}),n})();class sD{constructor(t,e,i){this.ref=t,this._containerInstance=i,this._afterOpened=new On,this._beforeClosed=new On,this._state=0,this.disableClose=e.disableClose,this.id=t.id,i._animationStateChanged.pipe(Do(r=>"opened"===r.state),Ho(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(Do(r=>"closed"===r.state),Ho(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Oo(this.backdropClick(),this.keydownEvents().pipe(Do(r=>27===r.keyCode&&!this.disableClose&&!al(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),vz(this,"keydown"===r.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(Do(e=>"closing"===e.state),Ho(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this.ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this.ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this.ref.backdropClick}keydownEvents(){return this.ref.keydownEvents}updatePosition(t){const e=this.ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this.ref.updatePosition(),this}updateSize(t="",e=""){return this.ref.updateSize(t,e),this}addPanelClass(t){return this.ref.addPanelClass(t),this}removePanelClass(t){return this.ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this.ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}function vz(n,t,e){return n._closeInteractionType=t,n.close(e)}const LJ=new en("SbbDialogData"),OJ=new en("sbb-dialog-default-options"),xz=new en("sbb-dialog-scroll-strategy"),NJ={provide:xz,deps:[Gs],useFactory:function FJ(n){return()=>n.scrollStrategies.block()}};let BJ=0,wz=(()=>{class n{constructor(e,i,r,a,d,b,x,A,O){this._overlay=e,this._defaultOptions=r,this._parentDialog=a,this._dialogRefConstructor=x,this._dialogContainerType=A,this._dialogDataToken=O,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new On,this._afterOpenedAtThisLevel=new On,this._idPrefix="sbb-dialog-",this.afterAllClosed=A_(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Ra(void 0))),this._scrollStrategy=b,this._dialog=i.get(bz)}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,i){let r;(i=Object.assign(Object.assign({},this._defaultOptions||new F1),i)).id=i.id||`${this._idPrefix}${BJ++}`,i.scrollStrategy=i.scrollStrategy||this._scrollStrategy(),i.backdropClass=i.backdropClass||"sbb-overlay-background";const a=this._dialog.open(e,Object.assign(Object.assign({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:F1,useValue:i},{provide:oD,useValue:i}]},templateContext:()=>({dialogRef:r,lightboxRef:r}),providers:(d,b,x)=>(r=new this._dialogRefConstructor(d,i,x),r.updatePosition(null==i?void 0:i.position),[{provide:this._dialogContainerType,useValue:x},{provide:this._dialogDataToken,useValue:b.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentInstance=a.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{const d=this.openDialogs.indexOf(r);d>-1&&(this.openDialogs.splice(d,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}}return n.\u0275fac=function(e){bm()},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),Cc=(()=>{class n extends wz{constructor(e,i,r,a,d,b){super(e,i,r,d,b,a,sD,kJ,LJ)}}return n.\u0275fac=function(e){return new(e||n)(Tt(Gs),Tt(Jo),Tt(OJ,8),Tt(xz),Tt(n,12),Tt(wv))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),zJ=0,vf=(()=>{class n{constructor(e,i,r){this._dialogRef=e,this._elementRef=i,this._dialog=r,this.ariaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this.type="button",this._canCloseInterceptor=()=>!0}ngOnInit(){this._dialogRef||(this._dialogRef=Sz(this._elementRef,this._dialog.openDialogs))}ngOnChanges(e){const i=e._sbbDialogClose||e._sbbDialogCloseResult;i&&(this.dialogResult=i.currentValue)}_onButtonClick(e){!this._canCloseInterceptor()||vz(this._dialogRef,0===e.screenX&&0===e.screenY?"keyboard":"mouse",this.dialogResult)}}return n.\u0275fac=function(e){return new(e||n)(ue(sD,8),ue(ci),ue(Cc))},n.\u0275dir=cn({type:n,selectors:[["","sbb-dialog-close",""],["","sbbDialogClose",""]],hostVars:2,hostBindings:function(e,i){1&e&&Wt("click",function(a){return i._onButtonClick(a)}),2&e&&si("aria-label",i.ariaLabel||null)("type",i.type)},inputs:{ariaLabel:["aria-label","ariaLabel"],type:"type",dialogResult:["sbb-dialog-close","dialogResult"],_sbbDialogClose:["sbbDialogClose","_sbbDialogClose"]},exportAs:["sbbDialogClose"],features:[ho]}),n})(),VJ=(()=>{class n{constructor(e,i,r,a){this._dialogRef=e,this._elementRef=i,this._dialog=r,this._changeDetectorRef=a,this.id="sbb-dialog-title-"+zJ++,this.closeAriaLabel=$localize`:Aria label to close a dialog@@sbbDialogCloseDialog:Close dialog`,this._closeEnabled=!0}ngOnInit(){this._dialogRef||(this._dialogRef=Sz(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const e=this._dialogRef._containerInstance;!e||(e._config.disableClose&&(this._closeEnabled=!1,this._changeDetectorRef.markForCheck()),e._ariaLabelledBy||(e._ariaLabelledBy=this.id))})}}return n.\u0275fac=function(e){return new(e||n)(ue(sD,8),ue(ci),ue(Cc),ue(So))},n.\u0275dir=cn({type:n,inputs:{id:"id",closeAriaLabel:"closeAriaLabel"}}),n})(),Km=(()=>{class n extends VJ{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275cmp=Jt({type:n,selectors:[["sbb-dialog-title"],["","sbb-dialog-title",""],["","sbbDialogTitle",""]],hostAttrs:[1,"sbb-dialog-title"],hostVars:1,hostBindings:function(e,i){2&e&&dr("id",i.id)},exportAs:["sbbDialogTitle"],features:[Un],ngContentSelectors:CJ,decls:2,vars:1,consts:[["sbb-dialog-close","","class","sbb-dialog-title-close-button sbb-button-reset-frameless",3,"aria-label",4,"ngIf"],["sbb-dialog-close","",1,"sbb-dialog-title-close-button","sbb-button-reset-frameless",3,"aria-label"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(Rs(),Co(0),yt(1,TJ,2,1,"button",0)),2&e&&(pe(1),Pe("ngIf",i._closeEnabled))},dependencies:[Zo,cl,vf],encapsulation:2,changeDetection:0}),n})(),Qm=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["","sbb-dialog-content",""],["sbb-dialog-content"],["","sbbDialogContent",""]],hostAttrs:[1,"sbb-dialog-content","sbb-scrollbar"]}),n})(),eg=(()=>{class n{constructor(){this.align="end"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["","sbb-dialog-actions",""],["sbb-dialog-actions"],["","sbbDialogActions",""]],hostAttrs:[1,"sbb-dialog-actions"],hostVars:6,hostBindings:function(e,i){2&e&&_("sbb-dialog-actions-align-start","start"===i.align)("sbb-dialog-actions-align-center","center"===i.align)("sbb-dialog-actions-align-end","end"===i.align)},inputs:{align:"align"}}),n})();function Sz(n,t){let e=n.nativeElement.parentElement;for(;e&&!e.classList.contains("sbb-dialog-container")&&!e.classList.contains("sbb-lightbox-container");)e=e.parentElement;return e?t.find(i=>i.id===e.id):null}let t2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[Cc,NJ],imports:[go,RJ,Tc,ll,Ur,Ss]}),n})();function jJ(n,t){if(1&n){const e=or();ne(0,"div",13)(1,"div")(2,"input",14),Wt("change",function(){return Qn(e),ei(St().toggleStripTags())}),oe()(),ne(3,"div")(4,"label",15),Z(5,"Remove "),ne(6,"mark"),Z(7,"<LinkProjection>"),oe()()()()}}let N1=(()=>{class n{constructor(e){this.clipboard=e,this.responseXML="loading TR...",this.isTripRequest=!1,this.requestXML="n/a",this.responseXML_Original="n/a",this.responseXML_Stripped="n/a",this.isStrippingTagsEnabled=!0}updateRequestData(e){if(this.requestXML=e.requestXML?uB.prettyPrintXML(e.requestXML):"n/a (error getting request XML)",e.responseXML){if(this.responseXML_Original=uB.prettyPrintXML(e.responseXML),this.isTripRequest){let i=this.responseXML_Original.replace(/<LinkProjection>.+?<\/LinkProjection>/gms,"");i=i.replace(/<ojp:LinkProjection>.+?<\/ojp:LinkProjection>/gms,""),this.responseXML_Stripped=i}this.updateResponseXML()}else this.responseXML="loading TR ... or TR is not fetched yet"}toggleStripTags(){this.isStrippingTagsEnabled=!this.isStrippingTagsEnabled,this.updateResponseXML()}updateResponseXML(){this.responseXML=this.isTripRequest&&this.isStrippingTagsEnabled?this.responseXML_Stripped:this.responseXML_Original}copyTextToClipboard(){this.clipboard.copy(this.responseXML)}}return n.\u0275fac=function(e){return new(e||n)(ue(cZ))},n.\u0275cmp=Jt({type:n,selectors:[["debug-xml-popover"]],decls:26,vars:3,consts:[["sbbDialogTitle",""],["sbbDialogContent","",1,"d-flex","flex-column","h-100"],[1,"flex-fill"],[1,"d-flex","flex-column","h-100"],[1,"mb-2"],[1,"flex-grow-1"],[1,"w-100","h-100"],[1,"mt-2","mb-2"],[1,"mt-2","mb-2","d-flex","gap-2","align-items-center"],[1,"btn","btn-primary","btn-sm",3,"click"],["class","d-flex gap-1",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],[1,"d-flex","gap-1"],["type","checkbox","checked","","id","stripTagsInput",1,"form-check-input",3,"change"],["for","stripTagsInput"]],template:function(e,i){1&e&&(ne(0,"div",0)(1,"strong"),Z(2,"Current Response XML"),oe()(),ne(3,"div",1)(4,"div",2)(5,"div",3)(6,"div",4),Z(7,"Request XML"),oe(),ne(8,"div",5)(9,"textarea",6),Z(10),oe()()()(),ne(11,"div",2)(12,"div",3)(13,"div",7),Z(14,"Response XML"),oe(),ne(15,"div",5)(16,"textarea",6),Z(17),oe()(),ne(18,"div",8)(19,"div")(20,"button",9),Wt("click",function(){return i.copyTextToClipboard()}),Z(21,"Copy to Clipboard"),oe()(),yt(22,jJ,8,0,"div",10),oe()()(),ne(23,"div",11)(24,"button",12),Z(25," Close "),oe()()()),2&e&&(pe(10),de(i.requestXML),pe(7),de(i.responseXML),pe(5),Pe("ngIf",!0===i.isTripRequest))},dependencies:[Zo,vf,Km,Qm,eg],encapsulation:2}),n})();const UJ=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#0000FF","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),HJ=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":14.5,"layout":{"text-field":"{stopPlace.stopPlaceName} \\n {stopPlace.stopPlaceRefLabel}","text-size":12,"text-justify":"left","text-anchor":"top-left","text-offset":[0.2,0.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),qJ=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#eb0000","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),GJ=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"circle","minzoom":0,"paint":{"circle-color":"#834333","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}'),$J=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-charging-station","icon-allow-overlap":true,"icon-size":0.5}}'),WJ=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"car-15","icon-allow-overlap":true,"icon-size":1.4}}'),XJ=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"bicycle-15","icon-allow-overlap":true,"icon-size":1.4}}'),ZJ=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":"poi-scooter","icon-allow-overlap":true,"icon-size":0.4}}'),aD=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","layout":{"text-field":"{sharedVehicle.itemsNo}","text-allow-overlap":true,"text-size":12,"text-offset":[0.7,-1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-color":["case",["==",["get","sharedVehicle.itemsNo"],0],"red","#006400"],"text-halo-width":1}}'),lD=JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":15,"layout":{"text-field":"{sharedVehicle.provider}","text-allow-overlap":true,"text-size":12,"text-offset":[0,1.2]},"paint":{"text-halo-color":"rgba(241, 231, 231, 1)","text-halo-width":1}}'),Tz={"stops-circle":UJ,"stops-label":HJ,"address-circle":qJ,"topographic-place-circle":GJ,"charging-station-icon":$J,"charging-station-text-number":aD,"charging-station-text-provider":lD,"car-rental-icon":WJ,"car-rental-text-number":aD,"car-rental-text-provider":lD,"bike-icon":XJ,"bike-text-number":aD,"bike-text-provider":lD,"scooter-icon":ZJ,"scooter-text-number":aD,"scooter-text-provider":lD,"poi-all":JSON.parse('{"id":"[LAYER_ID]","source":"[SOURCE_ID]","type":"symbol","minzoom":0,"layout":{"icon-image":["get","style.icon-image"],"icon-allow-overlap":true,"icon-size":0.4}}')};class B1{constructor(t,e,i,r,a){this.language=t,this.layerKey=e,this.map=i,this.restrictionType=r.LIR_Restriction_Type,this.restrictionPOI=r.LIR_POI_Type?r.LIR_POI_Type:null,this.minZoom=r.minZoom,this.features=[],this.mapSourceID=e+"-map-src",this.userTripService=a,this.isEnabled=!1,this.lastOJPRequest=null,this.addMapSourceAndLayers(),this.currentLocations=[]}addMapSourceAndLayers(){var t;this.map.addSource(this.mapSourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.layerKey in lv?(null!==(t=lv[this.layerKey].layer_ids)&&void 0!==t?t:[this.layerKey]).forEach(r=>{if(!(r in Tz))return void console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layer def for "+r);const d=JSON.parse(JSON.stringify(Tz[r]));d.id=r,d.source=this.mapSourceID,this.map.addLayer(d)}):console.error("ERROR - AppMapLayer.addMapSourceAndLayers no layers defined for "+this.layerKey)}shouldLoadNewFeatures(){return!(!this.isEnabled||this.map.getZoom()<this.minZoom)}refreshFeatures(){var t=this;return mr(function*(){var e;if(!t.shouldLoadNewFeatures())return void t.removeAllFeatures();const r="poi"===t.restrictionType&&"poi"===(null===(e=t.restrictionPOI)||void 0===e?void 0:e.poiType)?1e3:300,a=t.map.getBounds();if(null===a)return;const b="2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,x=bn.LocationInformationRequest.initWithBBOXAndType(t.userTripService.getStageConfig(),t.language,b,Ps,a.getWest(),a.getNorth(),a.getEast(),a.getSouth(),[t.restrictionType],r,t.restrictionPOI);x.enableExtensions="OJP-SI"!==t.userTripService.currentAppStage,t.lastOJPRequest=x;const A=lv[t.layerKey],O=yield x.fetchResponse();if("ERROR"===O.message)return console.log("AppMapLayer: "+t.layerKey+" backend ERROR"),void console.log(O);const B=[],X={};O.locations.forEach((se,me)=>{var ye,$e,ht,Qe,At;if(null===se.geoPosition)return;if("poi"===t.restrictionType&&"shared_mobility"===(null===(ye=t.restrictionPOI)||void 0===ye?void 0:ye.poiType)){const Yi=null!==($e=A.LIR_POI_Type)&&void 0!==$e?$e:null;if(null===Yi)return void B.push(se);const Ci=null!==(Qe=null===(ht=se.poi)||void 0===ht?void 0:ht.category)&&void 0!==Qe?Qe:null;if(null===Ci)return void B.push(se);if(!Yi.tags.includes(Ci))return void B.push(se)}const qn=se.geoPosition.asLatLngString();if(!(qn in X)){const Yi={type:"Feature",properties:{locations_idx:[]},geometry:{type:"Point",coordinates:se.geoPosition.asPosition()}};X[qn]=Yi}const Xn=null!==(At=X[qn])&&void 0!==At?At:null;null!==Xn&&null!==Xn.properties&&Xn.properties.locations_idx.push(me)}),"DEBUG"===Sc&&B.length>0&&(console.log("AppMapLayer.refreshFeatures -- discarded locations"),console.log(B),console.log("layer config"),console.log(A)),t.currentLocations=O.locations;const te=Object.values(X);te.forEach(se=>{if(null===se.properties)return;const me=se.properties.locations_idx,ye=[];me.forEach($e=>{var ht;const Qe=null!==(ht=O.locations[$e])&&void 0!==ht?ht:null;Qe&&ye.push(Qe)}),se.properties.locations_idx=me.join(","),t.annotateFeatureFromLocations(se,ye)}),t.setSourceFeatures(te)})()}removeAllFeatures(){0!==this.features.length&&this.setSourceFeatures([])}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceID).setData({type:"FeatureCollection",features:t})}annotateFeatureFromLocations(t,e){}handleMapClick(t){var e,i,r;if(!this.shouldLoadNewFeatures())return!1;const a=lv[this.layerKey];let d=null!==(e=a.click_layer_ids)&&void 0!==e?e:[];if(0===d.length)return!1;"SAME_AS_LAYER_IDS"===d&&(d=null!==(i=a.layer_ids)&&void 0!==i?i:[this.layerKey]);const b=Bh.queryNearbyFeaturesByLayerIDs(this.map,t.lngLat,d);if(0===b.length)return!1;const x=b[0];if(null===x.feature.properties)return!1;let A=null!==(r=x.feature.properties.locations_idx)&&void 0!==r?r:"";if(A=A.trim(),""===A)return!1;const O=[];A.split(",").forEach(te=>{var se;const me=parseInt(te,10),ye=null!==(se=this.currentLocations[me])&&void 0!==se?se:null;ye&&!(me in O)&&(O[me]=ye)});const X=Object.values(O);return 0!==X.length&&(this.showPopup(X),!0)}showPopup(t){var e,i;const r=t[0],a=null!==(i=null===(e=r.geoPosition)||void 0===e?void 0:e.asLngLat())&&void 0!==i?i:null;if(null===a)return;const d=this.computePopupHTML(t);if(null===d)return;const b=document.createElement("div");b.innerHTML=d;const x=new(sl().Popup)({focusAfterOpen:!1,maxWidth:"400px"});b.addEventListener("click",A=>{const B=A.target.getAttribute("data-endpoint-type");null!==B&&(this.userTripService.updateTripEndpoint(r,B,"MapPopupClick"),x.remove())}),x.setLngLat(a).setDOMContent(b).addTo(this.map)}computePopupHTML(t){var e,i,r,a;if(0===t.length)return null;const d=t[0],b=document.getElementById("map-endpoint-picker-popup");if(null===b)return null;let x=b.innerHTML;x=x.replace("[GEO_RESTRICTION_TYPE]",this.restrictionType);const A=null!==(a=null!==(i=null===(e=d.geoPosition)||void 0===e?void 0:e.properties)&&void 0!==i?i:null===(r=d.asGeoJSONFeature())||void 0===r?void 0:r.properties)&&void 0!==a?a:null;if(null==A)return x=x.replace("[GEOJSON_PROPERTIES_TABLE]","ERROR: cant read GeoJSON properties"),x;const O=[];for(let X in A){let te=A[X];if("string"==typeof te){const me=new String(te);me.startsWith("http")&&(te='<a href="'+me+'" target="_blank">'+me+"</a>")}O.push("<tr><td>"+X+"</td><td>"+te+"</td></tr>")}const B='<table class="table">'+O.join("")+"</table>";return x=x.replace("[GEOJSON_PROPERTIES_TABLE]",B),x}}class JJ extends B1{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=0;e.forEach((r,a)=>{"available"===this.computeLocationStatus(r)&&(i+=1)}),t.properties["sharedVehicle.itemsNo"]=i}computeLocationStatus(t){var e;const i=null!==(e=t.attributes.locationStatus)&&void 0!==e?e:null;if(null===i)return null;const r=i.toUpperCase();return"AVAILABALE"===r?"available":"OCCUPIED"===r?"occupied":"UNKNOWN"===r?"unknown":null}computePopupHTML(t){var e;const i=document.getElementById("map-poi-picker-popup");if(null===i||0===t.length)return null;const r=t[0];if(null===r.poi||"charging_station"!==r.poi.category)return null;const a=[];a.push('<tr><td style="width:50px;">Name</td><td>'+r.poi.name+" - "+r.locationName+"</td></tr>");let d=r.poi.code;d=d.replace(r.poi.name,""),d=d.replace(null!==(e=r.locationName)&&void 0!==e?e:"n/a",""),a.push("<tr><td>Code</td><td>"+d+"</td></tr>");const b=[];t.forEach((O,B)=>{var X;if(null===O.poi)return;const te=this.computeLocationStatus(O);if(null===te)return;const se=(()=>{let $e="bg-success";return"occupied"===te&&($e="bg-danger"),"unknown"===te&&($e="bg-secondary"),'<span class="badge rounded-pill '+$e+'">'+te.toUpperCase()+"</span>"})(),me=null!==(X=O.attributes.Code)&&void 0!==X?X:null;b.push("<li>"+se+" "+me+"</li>")}),a.push('<tr><td colspan="2"><p>Chargers ('+t.length+")</p><ul>"+b.join("")+"</ul></td></tr>");let x=i.innerHTML;x=x.replace("[POI_NAME]","Charging Station");const A='<table class="table popup-charging-station">'+a.join("")+"</table>";return x=x.replace("[GEOJSON_PROPERTIES_TABLE]",A),x}}class KJ extends B1{annotateFeatureFromLocations(t,e){null!==t.properties&&(0===e.length||null===e[0].poi||(t.properties["style.icon-image"]=e[0].poi.computePoiMapIcon()))}computePopupHTML(t){if(0===t.length)return null;const e=t[0];if(null===e.poi)return null;const i=document.getElementById("map-poi-picker-popup");if(null===i)return null;let r=i.innerHTML;r=r.replace("[POI_NAME]",e.poi.name);const a=[];a.push("<tr><td>Code</td><td>"+e.poi.code.substring(0,20)+"...</td></tr>"),a.push("<tr><td>Category</td><td>"+e.poi.category+"</td></tr>"),a.push("<tr><td>SubCategory</td><td>"+e.poi.subCategory+"</td></tr>");const d='<table class="table">'+a.join("")+"</table>";return r=r.replace("[GEOJSON_PROPERTIES_TABLE]",d),r}}class z1{constructor(t,e,i,r,a){this.poiType=t,this.vehicleType=e,this.provider=i,this.code=r,this.name=a,this.hireFacility=null,this.isFixedStation=!1,this.docksNo=null,this.vehiclesNo=null,this.vehicleName=null}static initFromLocation(t){var e,i,r;if(null===t.poi)return null;const a=t.poi.category,d=(()=>{var se;const me=null!==(se=t.attributes.Code)&&void 0!==se?se:null;return null!==me?me:t.poi.code})(),b=(()=>{if("bicycle_rental"===a){if("Publibike"===t.locationName)return["PubliBike","Bike"];if("Publiebike"===t.locationName)return["PubliBike","E-Bike"];if("Nextbike"===t.locationName)return["Nextbike","Bike"]}return d.startsWith("2em_cars")?["2EM Car Sharing","Car"]:d.startsWith("2em_cars_e")?["2EM Car Sharing","E-Car"]:d.startsWith("bird-")?["Bird","E-Scooter"]:d.startsWith("bolt_")?["Bolt","E-Scooter"]:d.startsWith("carvelo2go")?["Carvelo2go","E-CargoBike"]:d.startsWith("donkey_kreuzlingen")?["Regivelo.ch","Bike"]:d.startsWith("donkey_")?["Donkey Republic","Bike"]:d.startsWith("edrivecarsharing")?["E-drive Car Sharing","E-Car"]:d.startsWith("bird-platform-partner-jmfleetswl-")?["JM Fleets","E-Scooter"]:d.startsWith("liemobil_liechtenstein_ebike")?["LIEmobil","E-Bike"]:d.startsWith("lime_")?d.includes("_escooter")?["Lime","E-Scooter"]:["Lime","E-Bike"]:d.startsWith("mobility")?["Mobility","Car"]:d.startsWith("emobility")?["Mobility","E-Car"]:d.startsWith("nextbike_ch")?["Nextbike","Bike"]:d.startsWith("pickebike_")?d.includes("_emoped")?["Pick-e-Bike","E-Moped"]:["Pick-e-Bike","E-Bike"]:d.startsWith("share_birrer_ch")?["Share Birrer","E-Car"]:d.startsWith("sponticar")?["Sponti-Car","E-Car"]:d.startsWith("tier")?["TIER","E-Scooter"]:d.startsWith("tier_ebike")?["TIER","E-Bike"]:d.startsWith("voiscooters.com")?["VOI","E-Scooter"]:[null,"E-Scooter"]})(),x=b[0],A=b[1];if(null===x)return console.error("CANT DETECT provider"),console.log(t),null;const O="escooter_rental"===a?null!==(se=t.attributes.Text)&&void 0!==se?se:null:"2EM Car Sharing"===x?x:"bicycle_rental"===a||"car_sharing"===a?t.poi.name:null;var se;if(null===O)return console.error("CANT find name"),console.log(t),null;const B=new z1(a,A,x,d,O),X=null!==(e=t.attributes.num_docks_available)&&void 0!==e?e:null;null!==X&&(B.docksNo=parseInt(X,10));const te=null!==(i=t.attributes.num_vehicles_available)&&void 0!==i?i:null;return null!==te&&(B.isFixedStation=!0,B.vehiclesNo=parseInt(te,10)),B.hireFacility=null!==(r=t.attributes.HireFacility)&&void 0!==r?r:null,"2EM Car Sharing"===x&&(B.vehicleName=t.poi.name),B}computeProviderLabel(){return"2EM Car Sharing"===this.provider?"2EM Car":"Carvelo2go"===this.provider?"Carvelo":"E-drive Car Sharing"===this.provider?"E-drive":"Donkey Republic"===this.provider?"Donkey Rep.":this.provider}}class QJ extends B1{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;let i=null;e.forEach(a=>{const d=z1.initFromLocation(a);null!==d&&null!==d.vehiclesNo&&(null===i&&(i=0),i+=d.vehiclesNo)}),null!==i&&(t.properties["sharedVehicle.itemsNo"]=i);const r=z1.initFromLocation(e[0]);r&&(t.properties["sharedVehicle.provider"]=r.computeProviderLabel())}computePopupHTML(t){if(0===t.length)return null;const e=document.getElementById("map-poi-picker-popup");if(null===e)return null;let i=e.innerHTML;const r=[];if(t.forEach(O=>{const B=z1.initFromLocation(O);B&&r.push(B)}),0===r.length){const O=t[0];i=i.replace("[POI_NAME]","GENERIC SHARED MOBILITY");const B=[];for(let te in O.attributes){let se=O.attributes[te];if("string"==typeof se){const ye=new String(se);ye.startsWith("http")&&(se='<a href="'+ye+'" target="_blank">'+ye+"</a>")}B.push("<tr><td>"+te+"</td><td>"+se+"</td></tr>")}const X='<table class="table">'+B.join("")+"</table>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",X),null}const a=r[0];i=i.replace("[POI_NAME]",a.provider);const b=[];if(b.push('<tr><td style="width:75px;">Name</td><td>'+a.name+"</td></tr>"),b.push("<tr><td>Code</td><td>"+a.code+"</td></tr>"),a.isFixedStation){const O=[];r.forEach(B=>{let te=B.vehiclesNo+" "+B.vehicleType+(1===B.vehiclesNo?"":"s");null!==B.vehicleName&&(te+=" - "+B.vehicleName),O.push("<li>"+te+"</li>")}),b.push('<tr><td class="align-middle">Vehicles</td><td><ul>'+O.join("")+"</ul></td></tr>")}const A='<div class="popup-shared-mobility">'+['<table class="table">'+b.join("")+"</table>"].join("")+"</div>";return i=i.replace("[GEOJSON_PROPERTIES_TABLE]",A),i}}class eK extends B1{annotateFeatureFromLocations(t,e){if(null===t.properties||0===e.length)return;const i=e[0];if(null===i.stopPlace)return;const r=i.stopPlace.stopPlaceRef;t.properties["stopPlace.stopPlaceRef"]=r,t.properties["stopPlace.stopPlaceName"]=i.stopPlace.stopPlaceName;let a=r.slice();a.length>32&&(a=r.substring(0,32)+"..."),t.properties["stopPlace.stopPlaceRefLabel"]=a}computePopupHTML(t){var e,i;if(0===t.length)return null;const r=document.getElementById("map-endpoint-stop-picker-popup");if(null===r)return null;const a=t[0],d=a.computeLocationName(),b=null!==(i=null===(e=a.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&void 0!==i?i:null;if(null===d||null===b)return null;let x=r.innerHTML;return x=x.replace("[STOP_NAME]",d),x=x.replace("[STOP_ID]",b),x}}class Cz{static init(t,e,i,r,a){var d,b,x;return"stop"===r.LIR_Restriction_Type?new eK(t,e,i,r,a):(null===(d=r.LIR_POI_Type)||void 0===d?void 0:d.tags.includes("charging_station"))?new JJ(t,e,i,r,a):"shared_mobility"===(null===(b=r.LIR_POI_Type)||void 0===b?void 0:b.poiType)?new QJ(t,e,i,r,a):"poi"===(null===(x=r.LIR_POI_Type)||void 0===x?void 0:x.poiType)?new KJ(t,e,i,r,a):new B1(t,e,i,r,a)}}class tK{constructor(t,e,i,r){this.debugXmlPopover=e,this.prevMapBoundsHash="",this.map=t,this.layersData=[],this.userTripService=i,this.languageService=r}onAdd(t){this.map=t;const e=document.createElement("div");return e.className="mapboxgl-ctrl mapboxgl-ctrl-group map-control",e.innerHTML=document.getElementById("map-layers-legend-control").innerHTML,this.addLayers(e,t),this.addPOICompositeLayers(e,t),t.on("zoom",i=>{this.onZoomChanged(t)}),this.onZoomChanged(t),t.on("idle",i=>{this.handleMapIdleEvents(t)}),t.on("click",i=>{this.handleMapClickEvents(i,t)}),e}onRemove(){this.map=null}addLayers(t,e){t.querySelectorAll(".map-layer-data").forEach(i=>{var r;const a=i.getAttribute("data-map-layer-key");if(null===a)return;const d=i.querySelector(".map-layer-checkbox");if(null===d)return;const b=i.querySelector(".layer-xml-info"),x=null!==(r=lv[a])&&void 0!==r?r:null;if(null===x)return console.error("ERROR - MapLayersLegendControl - cant find layerKey "+a+" in APP_CONFIG"),d.disabled=!0,i.insertAdjacentHTML("beforeend",'<span class="badge bg-danger text-white">ERROR</span>'),void(b&&b.classList.add("d-none"));const A=Cz.init(this.languageService.language,a,e,x,this.userTripService);A.isEnabled=d.checked,b&&this.addLayerInfoClickHandler(b,A),d.addEventListener("change",B=>{A.isEnabled=d.checked,d.checked?A.refreshFeatures():A.removeAllFeatures()}),this.layersData.push({inputEls:[d],xmlInfoEl:b,layer:A})})}addLayerInfoClickHandler(t,e){t.addEventListener("click",i=>{const r=e.lastOJPRequest;if(r){const a=this.debugXmlPopover.open(N1,{position:{top:"20px"},width:"50vw",height:"90vh"});a.afterOpened().subscribe(()=>{a.componentInstance.updateRequestData(r.requestInfo)})}})}addPOICompositeLayers(t,e){t.querySelectorAll(".map-composite-pois").forEach(i=>{this.addPOICompositeLayer(i,e)})}addPOICompositeLayer(t,e){const i="pois-ALL",r=JSON.parse(JSON.stringify(lv[i])),a=[],d=[];t.querySelectorAll(".map-layer-poi").forEach(O=>{const B=O,X=B.getAttribute("data-osm-tag");null!==X&&(d.push(B),B.checked&&a.push(X),B.addEventListener("change",te=>{const se=[];d.forEach(me=>{const ye=me.getAttribute("data-osm-tag");me.checked&&ye&&se.push(ye)}),b.restrictionPOI&&(b.restrictionPOI.tags=se),b.isEnabled=se.length>0,b.refreshFeatures(),A.xmlInfoEl&&(b.isEnabled?A.xmlInfoEl.classList.remove("d-none"):A.xmlInfoEl.classList.add("d-none"))}))}),r.LIR_POI_Type={poiType:"poi",tags:a};const b=Cz.init(this.languageService.language,i,e,r,this.userTripService);b.isEnabled=a.length>0;const x=t.querySelector(".layer-xml-info");this.addLayerInfoClickHandler(x,b);const A={layer:b,inputEls:d,xmlInfoEl:x};this.layersData.push(A)}handleMapIdleEvents(t){const e=t.getBounds();if(null===e)return;const i=e.toString();this.prevMapBoundsHash!==i&&(this.prevMapBoundsHash=i,this.layersData.forEach(a=>{a.layer.refreshFeatures()}))}onZoomChanged(t){this.layersData.forEach(e=>{var i;const r=e.layer.minZoom,a=t.getZoom()<r;null===(i=e.inputEls)||void 0===i||i.forEach(d=>{d.disabled=a}),e.xmlInfoEl&&(a?e.xmlInfoEl.classList.add("d-none"):e.xmlInfoEl.classList.remove("d-none"))})}handleMapClickEvents(t,e){let i=!1;this.layersData.forEach(r=>{i||r.layer.handleMapClick(t)&&(i=!0)})}}class Yl{constructor(t,e,i,r,a,d){this.conventionalModeOfOperation=void 0,this.operatingDayRef=t,this.journeyRef=e,this.publicCode=void 0,this.lineRef=i,this.directionRef=void 0,this.mode=r,this.productCategory=void 0,this.publishedServiceName=a,this.trainNumber=void 0,this.attribute=d,this.operatorRef=void 0,this.destinationStopPointRef=void 0,this.destinationText=void 0,this.unplanned=void 0,this.cancelled=void 0,this.deviation=void 0}static initWithDatedJourneySchema(t){const e=new Yl(t.operatingDayRef,t.journeyRef,t.lineRef,t.mode,t.publishedServiceName,t.attribute);return e.conventionalModeOfOperation=t.conventionalModeOfOperation,e.publicCode=t.publicCode,e.directionRef=t.directionRef,e.productCategory=t.productCategory,e.trainNumber=t.trainNumber,e.operatorRef=t.operatorRef,e.destinationStopPointRef=t.destinationStopPointRef,e.destinationText=t.destinationText,e.unplanned=t.unplanned,e.cancelled=t.cancelled,e.deviation=t.deviation,e}static initWithLegacyTripTimedLegSchema(t){var e,i,r;const a=t.service,b=new Yl(a.operatingDayRef,a.journeyRef,a.lineRef,a.mode,a.publishedLineName,a.attribute);return b.conventionalModeOfOperation=a.conventionalModeOfOperation,b.publicCode=a.publicCode,b.directionRef=a.directionRef,b.productCategory=a.productCategory,b.trainNumber=null!==(r=null===(i=null===(e=t.extension)||void 0===e?void 0:e.publishedJourneyNumber)||void 0===i?void 0:i.text)&&void 0!==r?r:void 0,b.operatorRef=a.operatorRef,b.destinationStopPointRef=a.destinationStopPointRef,b.destinationText=a.destinationText,b.unplanned=a.unplanned,b.cancelled=a.cancelled,b.deviation=a.deviation,b}static initWithLegacyTripInfoResultSchema(t){var e,i,r,a;const d=null!==(e=t.service)&&void 0!==e?e:null;if(null===d)return null;const x=new Yl(d.operatingDayRef,d.journeyRef,d.lineRef,d.mode,d.publishedLineName,d.attribute);return x.conventionalModeOfOperation=d.conventionalModeOfOperation,x.publicCode=d.publicCode,x.directionRef=d.directionRef,x.productCategory=d.productCategory,x.trainNumber=null!==(a=null===(r=null===(i=t.extension)||void 0===i?void 0:i.publishedJourneyNumber)||void 0===r?void 0:r.text)&&void 0!==a?a:void 0,x.operatorRef=d.operatorRef,x.destinationStopPointRef=d.destinationStopPointRef,x.destinationText=d.destinationText,x.unplanned=d.unplanned,x.cancelled=d.cancelled,x.deviation=d.deviation,x}static initWithOJP_LegacyJourneyService(t){var e,i,r,a,d,b,x,A;const O=t.operatingDayRef,B=t.journeyRef,X=null!==(e=t.lineRef)&&void 0!==e?e:"n/a OJP_Legacy.JourneyService.lineRef",te={ptMode:t.ptMode.ptMode,name:{text:null!==(i=t.ptMode.name)&&void 0!==i?i:"n/a OJP_Legacy.mode.name"},shortName:{text:null!==(r=t.ptMode.shortName)&&void 0!==r?r:"n/a OJP_Legacy.mode.shortName"}},se={text:null!==(a=t.serviceLineNumber)&&void 0!==a?a:"n/a OJP_Legacy.JourneyService.serviceLineNumber"},me=Object.values(t.serviceAttributes).map($e=>({userText:{text:$e.text},code:$e.code})),ye=new Yl(O,B,X,te,se,me);return t.productCategory&&(ye.productCategory={name:{text:t.productCategory.name},shortName:{text:t.productCategory.shortName},productCategoryRef:null===(d=t.productCategory)||void 0===d?void 0:d.productCategoryRef}),t.journeyNumber&&(ye.trainNumber=t.journeyNumber),t.operatorRef&&(ye.operatorRef=t.operatorRef),t.destinationStopPlace&&(ye.destinationStopPointRef=t.destinationStopPlace.stopPlaceRef,t.destinationStopPlace.stopPlaceName&&(ye.destinationText={text:t.destinationStopPlace.stopPlaceName})),ye.unplanned=null!==(b=t.isUnplanned)&&void 0!==b?b:void 0,ye.cancelled=null!==(x=t.hasCancellation)&&void 0!==x?x:void 0,ye.deviation=null!==(A=t.hasDeviation)&&void 0!==A?A:void 0,ye}formatServiceName(){var t,e;const i=[],r=this.formatServiceLineName();return i.push(r),i.push(" - "),i.push(null!==(t=this.trainNumber)&&void 0!==t?t:""),i.push("("+(null!==(e=this.operatorRef)&&void 0!==e?e:"n/a operatorRef")+")"),i.join(" ")}formatServiceLineName(){var t,e,i,r;const a=[],d=this.publishedServiceName.text+"",b=null!==(e=null===(t=this.mode.shortName)||void 0===t?void 0:t.text)&&void 0!==e?e:null;if(null===b){const x=null!==(r=null===(i=this.mode.name)||void 0===i?void 0:i.text)&&void 0!==r?r:null;null!==x&&a.push(x)}else d.startsWith(b)||a.push(b);return a.push(this.publishedServiceName.text),a.join(" ")}isDemandMode(){var t;return"demandAndResponseBus"===this.mode.busSubmode||"unknown"===this.mode.busSubmode||"EV"===(null===(t=this.mode.shortName)||void 0===t?void 0:t.text)}hasPrecisePolyline(){return!!this.isDemandMode()||-1===["bus","tram"].indexOf(this.mode.ptMode)}computeLegColorType(){return"801"===this.operatorRef?"PostAuto":"rail"===this.mode.ptMode?"LongDistanceRail":this.isDemandMode()?"OnDemand":(()=>{var r;return"CC"===(null===(r=this.mode.shortName)||void 0===r?void 0:r.text)||"telecabin"===this.mode.ptMode})()?"Funicular":"Bus"}computeFormationServiceURL(){var t,e,i;const r=null!==(t=this.trainNumber)&&void 0!==t?t:null;if(null===r)return null;let a=null!==(e=this.operatorRef)&&void 0!==e?e:null;if(null===a)return null;a=(""+a).replace("ojp:","");const b=null!==(i={"ch:1:sboid:100015":"BLS",33:"BLS","ch:1:sboid:100001":"SBB",11:"SBB","ch:1:sboid:100301":"MBC",344:"MBC","ch:1:sboid:100012":"MBC",29:"MBC","ch:1:sboid:1100071":"MBC",7256:"MBC","ch:1:sboid:100566":"MBC",764:"MBC","ch:1:sboid:100049":"OeBB",68:"OeBB","ch:1:sboid:100053":"RhB",72:"RhB","ch:1:sboid:1100063":"RhB",7250:"RhB","ch:1:sboid:100061":"SOB",82:"SOB","ch:1:sboid:100018":"SOB",36:"SOB","ch:1:sboid:1100023":"SOB",7232:"SOB","ch:1:sboid:100046":"THURBO",65:"THURBO","ch:1:sboid:100034":"TPF",53:"TPF","ch:1:sboid:100945":"TPF",3004:"TPF","ch:1:sboid:101810":"TPF",7223:"TPF","ch:1:sboid:101265":"TRN",15301:"TRN","ch:1:sboid:1100067":"TRN",7255:"TRN","ch:1:sboid:101264":"TRN",15300:"TRN","ch:1:sboid:101240":"VDBB",9014:"VDBB","ch:1:sboid:100064":"ZB",86:"ZB","ch:1:sboid:1100025":"ZB",7234:"ZB"}[a])&&void 0!==i?i:null;return null===b?null:"https://opentdatach.github.io/train-formation-view/?number="+r+"&operator="+b}}const nK=["arrival","departure"];class no{static computeIconFilenameForService(t){var e,i,r,a,d,b;return"bus"===t.mode.ptMode?"picto-bus":"ATZ"===(null===(e=t.mode.shortName)||void 0===e?void 0:e.text)?"autozug":"rail"===t.mode.ptMode?"picto-railway":"tram"===t.mode.ptMode?"picto-tram":"CC"===(null===(i=t.mode.shortName)||void 0===i?void 0:i.text)?"picto-rack-railway":"FUN"===(null===(r=t.mode.shortName)||void 0===r?void 0:r.text)?"picto-funicular":"PB"===(null===(a=t.mode.shortName)||void 0===a?void 0:a.text)?"picto-cablecar":"GB"===(null===(d=t.mode.shortName)||void 0===d?void 0:d.text)?"picto-gondola":"SL"===(null===(b=t.mode.shortName)||void 0===b?void 0:b.text)?"picto-chairlift":"water"===t.mode.ptMode?"picto-boat":"demandAndResponseBus"===t.mode.busSubmode||"unknown"===t.mode.busSubmode?"car-sharing":"picto-bus-fallback"}static computeIconFilenameForLeg(t){if("TransferLeg"===t.legType)return"picto-walk";if("TimedLeg"===t.legType){const i=Yl.initWithOJP_LegacyJourneyService(t.service);return no.computeIconFilenameForService(i)}if("ContinuousLeg"===t.legType){const e=t;return e.isDriveCarLeg()?"car-sharing":e.isSharedMobility()?"velo-scooter-sharing":e.isTaxi()?"taxi":"car-shuttle-train"===e.legTransportMode?"autozug":"car-ferry"===e.legTransportMode?"ferry":"picto-walk"}return"picto-bus-fallback"}static isCar(t){return"self-drive-car"===t.legTransportMode}static updateLocationDataWithTime(t,e){var i,r;["arrival","departure"].forEach(d=>{const b="arrival"===d;b?t.arrText=e.arrival.timetableF:t.depText=e.departure.timetableF;const A=no.computeStopPointDelayText(d,e);null!==A&&(b?t.arrDelayText=A:t.depDelayText=A)}),t.platformText=e.platform.timetable,t.actualPlatformText=e.platform.realtime,null!==t.actualPlatformText&&t.platformText===t.actualPlatformText&&(t.actualPlatformText=null),t.geoPosition=null!==(r=null===(i=e.place)||void 0===i?void 0:i.geoPosition)&&void 0!==r?r:null,t.isNotServicedStop=!0===e.isNotServicedStop,t.occupancy={firstClassIcon:no.computeOccupancyLevelIcon(e.mapFareClassOccupancy,"firstClass"),firstClassText:no.computeOccupancyLevelText(e.mapFareClassOccupancy,"firstClass"),secondClassIcon:no.computeOccupancyLevelIcon(e.mapFareClassOccupancy,"secondClass"),secondClassText:no.computeOccupancyLevelText(e.mapFareClassOccupancy,"secondClass")},t.geoPosition=t.geoPosition}static computeStopPointDelayText(t,e){const r="arrival"===t?e.arrival:e.departure;if(null===r.timetable||null===r.realtime)return null;const a=(r.realtime.getTime()-r.timetable.getTime())/1e3;if(Math.abs(a)<.1)return null;const d=[];d.push(" "),a>0&&d.push("+");const b=Math.abs(a);if("DEBUG"===Sc){const A=Math.floor(b/60);A&&(d.push(""+A),d.push("'")),d.push(""+(b-60*A)),d.push('"')}else{const A=Math.floor(a/60);if(0===A)return null;d.push(""+A),d.push("'")}return d.join("")}static computeSituationsData(t,e){const i=[];return e.forEach(a=>{null!==a.situationContent&&i.push(a.situationContent),a.publishingActions.forEach(d=>{const b=d.passengerInformation.mapTextualContent,x={};x.summary="Summary"in b?b.Summary.join(". "):"Summary n/a",x.descriptions=[],"Description"in b&&(x.descriptions=b.Description),x.details=[],["Consequence","Duration","Reason","Recommendation","Remark"].forEach(B=>{B in b&&(x.details=x.details.concat(b[B]))});const O=d.passengerInformation.infoLink;O&&x.details.push(O.label),i.push(x)})}),i.map(a=>({summary:a.summary,descriptions:a.descriptions,safeDetails:a.details.map(b=>{b=b.replace("<a href",'<a target="_blank" href');const x=document.createElement("textarea");return x.innerHTML=b,t.bypassSecurityTrustHtml(x.value)})}))}static fetchGist(t){return mr(function*(){const e=t.match(/https:\/\/gist.github.com\/[^\/]+?\/([0-9a-z]*)/);null!==e&&(t=e[1]);const i="https://api.github.com/gists/"+t,a=(yield(yield fetch(i)).json()).files;for(const d in a){const b=a[d];if("XML"!==b.language)continue;let x=b.content;if(!0===b.truncated){const A=b.raw_url;console.log("GIST response truncated, fetching content from raw_url: "+A),x=yield(yield fetch(A)).text()}return x}return null})()}static computePlatformAssistanceIconPath(t){const e="PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===t?"platform_independent":"PLATFORM_ACCESS_WITH_ASSISTANCE"===t?"platform_help_driver":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===t?"platform_advance_notice":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===t?"platform_not_possible":"NO_DATA"===t?"platform_no_information":"ALTERNATIVE_TRANSPORT"===t?"platform_alternative_transport":null;return null===e?null:"assets/platform-assistance/"+e+".jpg"}static computePlatformAssistanceTooltip(t){return"PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===t?"Step-free access; level entry/exit.":"PLATFORM_ACCESS_WITH_ASSISTANCE"===t?"Step-free access; entry/exit through staff assistance, no prior registration necessary.":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===t?"Step-free access; entry/exit through staff assistance, advance registration required.":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===t?"Not usable for wheelchairs.":"ALTERNATIVE_TRANSPORT"===t?"By shuttle from/to the accessible stop, register in advance.":"No available information about vehicle access."}static computeOccupancyLevelIcon(t,e){var i;if(null===t)return null;const r=null!==(i=t[e])&&void 0!==i?i:null;return null===r?null:"unknown"===r?"fpl:utilization-none":"manySeatsAvailable"===r?"fpl:utilization-low":"fewSeatsAvailable"===r?"fpl:utilization-medium":"standingRoomOnly"===r?"fpl:utilization-high":null}static computeOccupancyLevelText(t,e){var i;const r="No forecast available";if(null===t)return r;const a=null!==(i=t[e])&&void 0!==i?i:null;return null===a?r:"manySeatsAvailable"===a?"Low occupancy":"fewSeatsAvailable"===a?"Medium occupancy":"standingRoomOnly"===a?"High occupancy":r}static computePlatformAssistance(t){return null===t?null:"PLATFORM_ACCESS_WITH_ASSISTANCE"===t?"PLATFORM_ACCESS_WITH_ASSISTANCE":"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED"===t?"PLATFORM_ACCESS_WITH_ASSISTANCE_WHEN_NOTIFIED":"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE"===t?"PLATFORM_NOT_WHEELCHAIR_ACCESSIBLE":"PLATFORM_ACCESS_WITHOUT_ASSISTANCE"===t?"PLATFORM_ACCESS_WITHOUT_ASSISTANCE":"NO_DATA"===t?"NO_DATA":"ALTERNATIVE_TRANSPORT"===t?"ALTERNATIVE_TRANSPORT":("DEBUG"===Sc&&console.log("StopPoint.computePlatformAssistance - cant compute platform from text:--"+t+"--"),null)}static convertOJP_LegacyStopPoint2StopPointCall(t){var e,i,r,a;const d={type:t.stopPointType,place:null,stopPointRef:null!==(i=null===(e=t.location.stopPlace)||void 0===e?void 0:e.stopPlaceRef)&&void 0!==i?i:"n/a stopPointRef",stopPointName:null!==(a=null===(r=t.location.stopPlace)||void 0===r?void 0:r.stopPlaceName)&&void 0!==a?a:"n/a stopPointName",platform:{timetable:t.plannedPlatform,realtime:t.actualPlatform},arrival:{timetable:null,realtime:null,timetableF:"",realtimeF:""},departure:{timetable:null,realtime:null,timetableF:"",realtimeF:""},vehicleAccessType:no.computePlatformAssistance(t.vehicleAccessType),mapFareClassOccupancy:t.mapFareClassOccupancy,isNotServicedStop:t.isNotServicedStop},b=t.location.geoPosition;return b&&(d.place=zC.initWithCoords(b.longitude,b.latitude)),nK.forEach(x=>{var A,O;const B="arrival"===x,X=B?t.arrivalData:t.departureData,te=null!==(A=null==X?void 0:X.timetableTime)&&void 0!==A?A:null,se=te?bn.DateHelpers.formatTimeHHMM(te):"",me=null!==(O=null==X?void 0:X.estimatedTime)&&void 0!==O?O:null,ye=me?bn.DateHelpers.formatTimeHHMM(me):"";B?(d.arrival.timetable=te,d.arrival.timetableF=se,d.arrival.realtime=me,d.arrival.realtimeF=ye):(d.departure.timetable=te,d.departure.timetableF=se,d.departure.realtime=me,d.departure.realtimeF=ye)}),d}static computeTripHash(t){const e=["From","To"],i=[];return t.legs.forEach((a,d)=>{var b,x;i.push(a.legType+d);const O=null!==(x=null===(b=a.legDuration)||void 0===b?void 0:b.asOJPFormattedText())&&void 0!==x?x:"duration_na";if(i.push(O),"TimedLeg"===a.legType){const B=a,X=B.service.formatServiceName();i.push(X),e.forEach(te=>{var se,me;const $e="From"===te?null===(se=B.fromStopPoint.departureData)||void 0===se?void 0:se.timetableTime:null===(me=B.toStopPoint.arrivalData)||void 0===me?void 0:me.timetableTime;if($e){const ht=bn.DateHelpers.formatTimeHHMM($e);i.push(ht)}})}}),i.join("_")}static formatDistance(t){return t>1e3?(t/1e3).toFixed(1)+"km":t+"m"}}var ba=(()=>(function(n){n.LegType="leg.type",n.DrawType="draw.type",n.PointType="point.type",n.LineType="line.type"}(ba||(ba={})),ba))();class iK{constructor(t){this.trip=t}computeBBOX(){var t,e;const i=new bn.GeoPositionBBOX([]),r=null===(t=this.computeFromLocation())||void 0===t?void 0:t.geoPosition;r?i.extend(r):(console.error("Trip.computeBBOX - cant computeFromLocation"),console.log(this));const a=null===(e=this.computeToLocation())||void 0===e?void 0:e.geoPosition;return a?i.extend(a):(console.error("Trip.computeBBOX - cant computeToLocation"),console.log(this)),this.trip.legs.forEach(d=>{new cD(d).computeGeoJSONFeatures().forEach(A=>{var O;const B=null!==(O=A.bbox)&&void 0!==O?O:null;null!==B&&(i.extend(new bn.GeoPosition(B[0],B[1])),i.extend(new bn.GeoPosition(B[2],B[3])))})}),i}computeFromLocation(){return 0===this.trip.legs.length?null:this.trip.legs[0].fromLocation}computeToLocation(){return 0===this.trip.legs.length?null:this.trip.legs[this.trip.legs.length-1].toLocation}}class cD{constructor(t,e=!1){this.leg=t,this.useBeeLine=e}computeGeoJSONFeatures(){let t=[];if(this.useBeeLine){const i=this.computeBeelineFeature();i&&t.push(i)}const e=this.computeLinePointFeatures();return t=t.concat(e),t=t.concat(this.computeLegGeoJSONFeatures()),t.forEach(i=>{i.properties&&(i.properties["leg.idx"]=this.leg.legID,i.properties[ba.LegType]=this.leg.legType)}),t}static shouldUseBeeline(t){const e=(()=>{if(null===t.legTrack)return!0;const i=t.legTrack.trackSections.map(a=>{var d,b;return null!==(b=null===(d=a.linkProjection)||void 0===d?void 0:d.coordinates.length)&&void 0!==b?b:0});return 0===i.length||0===i[0]})();if("ContinuousLeg"===t.legType||"TransferLeg"===t.legType){if(null===t.pathGuidance)return e;let r=!1;return t.pathGuidance.sections.forEach(a=>{var d;null!==(d=a.trackSection)&&void 0!==d&&d.linkProjection&&(r=!0)}),!1===r}return"TimedLeg"===t.legType?!Yl.initWithOJP_LegacyJourneyService(t.service).hasPrecisePolyline():e}computeBeelineFeature(){const t=this.computeBeelineGeoPositions();if(t.length<2)return null;const e=[];t.forEach(x=>{e.push(x.asPosition())});const i={};i[ba.DrawType]="Beeline";const a=this.computeLegLineType();i[ba.LineType]=a;const d=new bn.GeoPositionBBOX(t);return{type:"Feature",properties:i,geometry:{type:"LineString",coordinates:e},bbox:d.asFeatureBBOX()}}computeBeelineGeoPositions(){const t=[];return this.leg.fromLocation.geoPosition&&t.push(this.leg.fromLocation.geoPosition),"TimedLeg"===this.leg.legType&&this.leg.intermediateStopPoints.forEach(i=>{i.location.geoPosition&&t.push(i.location.geoPosition)}),this.leg.toLocation.geoPosition&&t.push(this.leg.toLocation.geoPosition),t}computeLegLineType(){if("ContinuousLeg"===this.leg.legType||"TransferLeg"===this.leg.legType){const e=this.leg;return e.isDriveCarLeg()?"Self-Drive Car":e.isSharedMobility()?"Shared Mobility":e.isTaxi()?"OnDemand":"TransferLeg"===this.leg.legType?"Transfer":"car-ferry"===e.legTransportMode?"Water":"Walk"}return"TimedLeg"===this.leg.legType?Yl.initWithOJP_LegacyJourneyService(this.leg.service).computeLegColorType():"Unknown"}computeLinePointFeatures(){const t=[],e=this.computeLegLineType();return this.computeLinePointsData().forEach(r=>{const d=r.feature;null!==d.properties&&(d.properties[ba.PointType]=r.type,d.properties[ba.DrawType]="LegPoint",d.properties[ba.LineType]=e,d.bbox=[d.geometry.coordinates[0],d.geometry.coordinates[1],d.geometry.coordinates[0],d.geometry.coordinates[1]],t.push(d))}),t}positionAsFeature(t){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}}computeLinePointsData(){var t,e;const i=[];return[this.leg.fromLocation,this.leg.toLocation].forEach(d=>{const b=d.asGeoJSONFeature();null!=b&&b.properties&&i.push({type:d===this.leg.fromLocation?"From":"To",feature:b})}),"TimedLeg"===this.leg.legType&&this.leg.intermediateStopPoints.forEach(b=>{const x=b.location.asGeoJSONFeature();null==x||!x.properties||i.push({type:"Intermediate",feature:x})}),("TransferLeg"===this.leg.legType||"ContinuousLeg"===this.leg.legType)&&(null!==(e=null===(t=this.leg.pathGuidance)||void 0===t?void 0:t.sections)&&void 0!==e?e:[]).forEach((x,A)=>{var O,B,X;const te=null!==(X=null===(B=null===(O=x.trackSection)||void 0===O?void 0:O.linkProjection)||void 0===B?void 0:B.coordinates)&&void 0!==X?X:[];if(0===te.length)return;const se=this.positionAsFeature(te[0].asPosition());i.push({type:"Intermediate",feature:se});const me=te[te.length-1].asPosition(),ye=this.positionAsFeature(me);i.push({type:"Intermediate",feature:ye})}),i}computeLegGeoJSONFeatures(){return"ContinuousLeg"===this.leg.legType||"TransferLeg"===this.leg.legType?this.computeContinousLegGeoJSONFeatures(this.leg):"TimedLeg"===this.leg.legType?this.computeTimedLegGeoJSONFeatures(this.leg):[]}computeContinousLegGeoJSONFeatures(t){var e,i;const r=[],d=(no.isCar(t),null===t.legTransportMode?"Guidance":["cycle","escooter_rental","bicycle_rental","charging_station"].includes(t.legTransportMode)?"Shared Mobility":["car","car_sharing","self-drive-car","taxi","others-drive-car","car-shuttle-train","car-ferry"].includes(t.legTransportMode)?"Self-Drive Car":"Guidance");if(null===(e=t.pathGuidance)||void 0===e||e.sections.forEach((b,x)=>{var A,O,B,X,te,se,me,ye,$e,ht;const Qe=null===(O=null===(A=b.trackSection)||void 0===A?void 0:A.linkProjection)||void 0===O?void 0:O.asGeoJSONFeature();null!=Qe&&Qe.properties&&(Qe.properties[ba.DrawType]="LegLine",Qe.properties[ba.LineType]=d,Qe.properties["PathGuidanceSection.idx"]=x,Qe.properties["PathGuidanceSection.TrackSection.RoadName"]=null!==(X=null===(B=b.trackSection)||void 0===B?void 0:B.roadName)&&void 0!==X?X:"",Qe.properties["PathGuidanceSection.TrackSection.Duration"]=null!==(se=null===(te=b.trackSection)||void 0===te?void 0:te.duration)&&void 0!==se?se:"",Qe.properties["PathGuidanceSection.TrackSection.Length"]=null!==(ye=null===(me=b.trackSection)||void 0===me?void 0:me.length)&&void 0!==ye?ye:"",Qe.properties["PathGuidanceSection.GuidanceAdvice"]=null!==($e=b.guidanceAdvice)&&void 0!==$e?$e:"",Qe.properties["PathGuidanceSection.TurnAction"]=null!==(ht=b.turnAction)&&void 0!==ht?ht:"",r.push(Qe))}),0===r.length&&(null===(i=t.legTrack)||void 0===i||i.trackSections.forEach(b=>{var x;const A=null===(x=b.linkProjection)||void 0===x?void 0:x.asGeoJSONFeature();null!=A&&A.properties&&(A.properties[ba.DrawType]="LegLine",A.properties[ba.LineType]=this.computeLegLineType(),r.push(A))})),0===r.length){const b=this.computeBeelineFeature();b&&r.push(b)}return r}computeTimedLegGeoJSONFeatures(t){var e,i;const r=[],d=Yl.initWithOJP_LegacyJourneyService(t.service).computeLegColorType();if(this.useBeeLine)return r;if((null!==(i=null===(e=t.legTrack)||void 0===e?void 0:e.trackSections)&&void 0!==i?i:[]).forEach(x=>{var A,O;const B=null!==(O=null===(A=x.linkProjection)||void 0===A?void 0:A.asGeoJSONFeature())&&void 0!==O?O:null;B&&r.push(B)}),0===r.length){const x=this.computeBeelineFeature();x&&r.push(x)}return r.forEach(x=>{x.properties&&(x.properties[ba.DrawType]="LegLine",x.properties[ba.LineType]=d)}),r}}let xf=(()=>{class n{constructor(){this.newMapBoundsRequested=new Cn,this.newMapCenterAndZoomRequested=new Cn,this.initialMapCenter=null,this.initialMapZoom=null}createMap(e){const i=new(sl().LngLatBounds)([[5.9559,45.818],[10.4921,47.8084]]),r=new(sl().Map)({container:e,style:"mapbox://styles/mapbox/light-v10",bounds:i,accessToken:"pk.eyJ1IjoidmFzaWxlIiwiYSI6ImNra2k2dWFkeDFrbG0ycXF0Nmg0Z2tsNXAifQ.nK-i-3cpWmji7HvK1Ilynw"});return this.initialMapCenter?(r.setCenter(this.initialMapCenter),this.initialMapZoom&&r.setZoom(this.initialMapZoom)):r.fitBounds(i,{padding:50,duration:0}),r}tryToCenterAndZoomToLocation(e,i=16){var r,a;if(null===e)return;const d=null!==(a=null===(r=e.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==a?a:null;null!==d&&this.newMapCenterAndZoomRequested.emit({lnglat:d,zoom:i})}zoomToTrip(e){const r=new iK(e).computeBBOX();if(!1===r.isValid())return;const d={bounds:new(sl().LngLatBounds)(r.asFeatureBBOX())};this.newMapBoundsRequested.emit(d)}zoomToBounds(e,i){var r,a;const d=i.bounds;if(d.getSouthWest().distanceTo(d.getNorthEast())<20)return void e.jumpTo({center:d.getCenter(),zoom:16});const A=null!==(r=i.padding)&&void 0!==r?r:{left:50,top:170,right:50,bottom:100},O=null!==(a=i.onlyIfOutside)&&void 0!==a&&a,B=e.getBounds();if(O&&B&&Bh.areBoundsInsideOtherBounds(d,B))return;const X=[d.getWest(),d.getSouth(),d.getEast(),d.getNorth()];e.fitBounds(X,{padding:A})}zoomToLocation(e,i){e.flyTo({center:i.lnglat,zoom:i.zoom})}addControls(e,i,r,a){const d=new(sl().NavigationControl)({showCompass:!1,visualizePitch:!1});e.addControl(d,"bottom-right");const b=new(sl().ScaleControl)({maxWidth:200,unit:"metric"});e.addControl(b);const x=new aZ(e);e.addControl(x,"top-left");const A=document.getElementById("mapTypeSelect");A&&A.addEventListener("change",()=>{this.mapTypeChanged(e,A.value)});const O=new tK(e,i,r,a);e.addControl(O,"top-right")}addRasterLayers(e){XA.forEach(i=>{e.addSource(i.id,{type:"raster",tiles:i.tileURLs,tileSize:256,minzoom:i.minZoom,maxzoom:i.maxZoom}),e.addLayer({id:i.id,source:i.id,type:"raster",paint:{"raster-opacity":i.rasterOpacity},layout:{visibility:"none"}},i.beforeLayerId)})}mapTypeChanged(e,i){XA.forEach(r=>{e.setLayoutProperty(r.id,"visibility","default"!==i&&r.id===i?"visible":"none")})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ia=(()=>{class n{constructor(e){this.mapService=e,this.embedQueryParams=new URLSearchParams,this.defaultsInited=new Cn,this.searchFormAfterDefaultsInited=new Cn,this.locationsUpdated=new Cn,this.geoLocationsUpdated=new Cn,this.tripsDataUpdated=new Cn,this.tripFaresUpdated=new Cn,this.activeTripSelected=new Cn,this.tripRequestFinished=new Cn,this.searchParamsReset=new Cn,this.queryParams=new URLSearchParams(document.location.search),this.fromTripLocation=null,this.toTripLocation=null,this.viaTripLocations=[],this.numberOfResults=5,this.numberOfResultsBefore=null,this.numberOfResultsAfter=null,this.publicTransportModesFilter=[],this.useRealTimeDataType="explanatory",this.walkSpeedDeviation=null,this.isViaEnabled=!1,this.isAdditionalRestrictionsEnabled=!1,this.currentBoardingType="Dep",this.tripModeType="monomodal",this.tripTransportMode="public_transport",this.journeyTripRequests=[],this.departureDate=this.computeInitialDate(),this.currentAppStage=fC,this.permalinkRelativeURL=null,this.prodURL=null,this.betaURL=null,this.betaV1URL=null,this.betaV2URL=null,this.betaURLText=null,this.sbbURL=null}initDefaults(e){var i,r,a,d,b,x,A;const B="2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,X=null!==(i=this.queryParams.get("stage"))&&void 0!==i?i:null;if(X){const Ci=this.computeAppStageFromString(X);Ci&&setTimeout(()=>{this.currentAppStage=Ci})}const te_Bern="8507000",te_Zurich="8503000",ye=null!==(r=this.queryParams.get("from"))&&void 0!==r?r:te_Bern,$e=null!==(a=this.queryParams.get("to"))&&void 0!==a?a:te_Zurich,ht=[],Qe=this.getStageConfig();null===Qe.authToken&&(console.error("WARNING: authorization not set for stage="+this.currentAppStage),console.log(Qe));const At=["From","To"];At.forEach(Ci=>{const ar="From"===Ci;let Gi=ar?ye:$e;if("OJP-SI"===this.currentAppStage&&(Gi=ar?"Bern":"Zurich"),"LA Beta"===this.currentAppStage){const Pr=Gi.match(/^[^\|]+?\|(.+?)$/);Pr?Gi=Pr[1]:console.error("ERROR LA Beta - CANT match stopPlaceRef")}const eo=bn.Location.initFromLiteralCoords(Gi);if(eo){const Pr=new Promise(gs=>{gs([eo])});ht.push(Pr)}else{let Pr=bn.LocationInformationRequest.initWithStopPlaceRef(Qe,e,B,Ps,Gi);"string"==typeof Gi&&/^[A-Z]/.test(Gi)&&(Pr=bn.LocationInformationRequest.initWithLocationName(Qe,e,B,Ps,Gi,[])),Pr.enableExtensions="OJP-SI"!==this.currentAppStage;const gs=Pr.fetchLocations();ht.push(gs)}});const fn=new bn.GeoPositionBBOX([]),qn=null!==(d=this.queryParams.get("via"))&&void 0!==d?d:null;(null===qn?[]:qn.split(";")).forEach(Ci=>{const ar=bn.Location.initFromLiteralCoords(Ci);if(ar){const Gi=new bn.TripLocationPoint(ar);this.viaTripLocations.push(Gi),ar.geoPosition&&fn.extend(ar.geoPosition)}else{const Gi=bn.LocationInformationRequest.initWithStopPlaceRef(Qe,e,B,Ps,Ci);Gi.enableExtensions="OJP-SI"!==this.currentAppStage;const eo=Gi.fetchLocations();ht.push(eo)}}),this.tripModeType="monomodal";const Ri=null!==(b=this.queryParams.get("mode_types"))&&void 0!==b?b:null;null!==Ri&&(this.tripModeType=Ri.split(";")[0]),this.tripTransportMode="public_transport";const Yi=null!==(x=this.queryParams.get("transport_modes"))&&void 0!==x?x:null;null!==Yi&&(this.tripTransportMode=Yi.split(";")[0]),this.publicTransportModesFilter=(()=>{var Ci;const ar=[],Gi=null!==(Ci=this.queryParams.get("public_transport_modes"))&&void 0!==Ci?Ci:null;return null===Gi||Gi.split(",").map(Pr=>Pr.toLowerCase().trim()).forEach(Pr=>{"bus"===Pr&&ar.push("bus"),["ship","water"].includes(Pr)&&ar.push("water"),["rail","train"].includes(Pr)&&ar.push("rail")}),ar})(),Promise.all(ht).then(Ci=>{var ar;At.forEach(eo=>{const Pr="From"===eo,gs=Pr?Ci[0]:Ci[1];if(0===gs.length)return;const ti=gs[0];Pr?this.fromTripLocation=new bn.TripLocationPoint(ti):this.toTripLocation=new bn.TripLocationPoint(ti),ti.geoPosition&&fn.extend(ti.geoPosition)});const Gi=null!==(ar=Ci[2])&&void 0!==ar?ar:null;if(null!==Gi){this.isViaEnabled=!0;const eo=Gi[0],Pr=new bn.TripLocationPoint(eo);this.viaTripLocations=[Pr],eo.geoPosition&&fn.extend(eo.geoPosition)}if(this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.updateURLs(),fn.isValid()&&(this.queryParams.has("from")||this.queryParams.has("to"))&&!this.mapService.initialMapCenter){const gs={bounds:new(sl().LngLatBounds)(fn.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(gs)}this.defaultsInited.emit()}),this.isAdditionalRestrictionsEnabled=["yes","true","1"].includes(null!==(A=this.queryParams.get("advanced"))&&void 0!==A?A:"n/a"),this.currentBoardingType=(()=>{var Ci;const ar=null!==(Ci=this.queryParams.get("time_type"))&&void 0!==Ci?Ci:null;return null===ar?"Dep":["arrival","arr"].includes(ar.toLowerCase())?"Arr":"Dep"})()}refetchEndpointsByName(e){const i=[],r=new Promise((d,b)=>{d(null)}),a=["From","To"];a.forEach(d=>{const A="From"===d?this.fromTripLocation:this.toTripLocation;if(null===A)return void i.push(r);const O=A.location.geoPosition;if(null===O)return void i.push(r);const B=bn.GeoPositionBBOX.initFromGeoPosition(O,200,200),X=this.getStageConfig(),se=(()=>{const $e=bn.LocationInformationRequest.initWithBBOXAndType(X,e,"2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,Ps,B.southWest.longitude,B.northEast.latitude,B.northEast.longitude,B.southWest.latitude,["stop"],300);return $e.enableExtensions="OJP-SI"!==this.currentAppStage,$e})().fetchLocations();i.push(se)}),Promise.all(i).then(d=>{a.forEach(b=>{const x="From"===b,A=x?d[0]:d[1];if(null===A)return;const O=x?this.fromTripLocation:this.toTripLocation;if(null===O)return void i.push(r);const B=O.location.findClosestLocation(A);null!==B&&(x?this.fromTripLocation=new bn.TripLocationPoint(B.location):this.toTripLocation=new bn.TripLocationPoint(B.location),this.updateURLs(),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit())})})}switchEndpoints(){const e=Object.assign({},this.fromTripLocation);this.fromTripLocation=Object.assign({},this.toTripLocation),this.toTripLocation=Object.assign({},e),this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updateURLs()}updateVia(){this.isViaEnabled=!this.isViaEnabled,this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updateURLs()}computeAppStageFromString(e){const i=Object.keys(cB.stages),r=i.map(b=>b.toLowerCase()),a=e.trim(),d=r.indexOf(a.toLowerCase());return-1!==d?i[d]:"PROD"}updateTripEndpoint(e,i,r){if("From"===i&&(this.fromTripLocation=e?new bn.TripLocationPoint(e):null),"To"===i&&(this.toTripLocation=e?new bn.TripLocationPoint(e):null),e&&"Via"===i){const a=new bn.TripLocationPoint(e);this.viaTripLocations=[a],this.isViaEnabled=!0}this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updateURLs()}updateViaPoint(e,i){this.viaTripLocations[i].location=e,this.locationsUpdated.emit(),this.geoLocationsUpdated.emit(),this.activeTripSelected.emit(null),this.searchParamsReset.emit(),this.updateURLs()}updateTrips(e){const i=this.massageTrips(e);this.tripsDataUpdated.emit(i)}selectActiveTrip(e){this.activeTripSelected.emit(e)}updateFares(e){this.tripFaresUpdated.emit(e)}updateURLs(){const e=new URLSearchParams;["From","To"].forEach(A=>{var O,B,X,te;const se="From"===A?this.fromTripLocation:this.toTripLocation,me=A.toLowerCase(),ye=null!==(B=null===(O=null==se?void 0:se.location.stopPlace)||void 0===O?void 0:O.stopPlaceRef)&&void 0!==B?B:null;if(ye)e.append(me,ye);else{let $e=null!==(te=null===(X=null==se?void 0:se.location.geoPosition)||void 0===X?void 0:X.asLatLngString(!0))&&void 0!==te?te:null;if($e){const Qe=null==se?void 0:se.location.computeLocationName(!1);Qe&&($e=$e+"("+Qe+")"),e.append(me,$e)}}});const r=[];this.viaTripLocations.forEach(A=>{var O,B;const X=A.location;if(X.stopPlace)r.push(X.stopPlace.stopPlaceRef);else{const te=null!==(B=null===(O=null==X?void 0:X.geoPosition)||void 0===O?void 0:O.asLatLngString(!0))&&void 0!==B?B:null;te&&r.push(te)}}),r.length>0&&e.append("via",r.join(";")),"monomodal"!==this.tripModeType&&e.append("mode_types",this.tripModeType),"public_transport"!==this.tripTransportMode&&e.append("transport_modes",this.tripTransportMode),this.publicTransportModesFilter.length>0&&e.append("public_transport_modes",this.publicTransportModesFilter.join(","));const a=new Date;if(Math.abs((a.getTime()-this.departureDate.getTime())/1e3/60)>5){const A=bn.DateHelpers.formatDate(this.departureDate);e.append("trip_datetime",A.substring(0,16))}if(this.currentAppStage!==fC){const A=this.currentAppStage.toLowerCase();e.append("stage",A)}this.isAdditionalRestrictionsEnabled&&e.append("advanced","yes"),this.permalinkRelativeURL=document.location.pathname.replace("/embed","")+"?"+e.toString(),this.updateLinkedURLs(e);const b=new URLSearchParams;["from","to"].forEach(A=>{const O=e.get(A);null!==O&&b.append(A,O)}),this.embedQueryParams=b}updateLinkedURLs(e){const i="2.0"===Mo,r=new URLSearchParams(e);i&&this.updateStageLinkedURL(r,i),this.prodURL="https://opentdatach.github.io/ojp-demo-app/search?"+r.toString();const a=new URLSearchParams(e);i&&this.updateStageLinkedURL(a,i),this.betaV1URL="https://tools.odpch.ch/beta-ojp-demo/search?"+a.toString();const d=new URLSearchParams(e);i||this.updateStageLinkedURL(d,i),this.betaV2URL="https://tools.odpch.ch/ojp-demo-v2/search?"+d.toString(),this.betaURL=i?this.betaV1URL:this.betaV2URL,this.betaURLText=i?"BETA-v1":"BETA-v2";const b=[];["from","to"].forEach(O=>{const B=e.get(O);if(null===B)return;const X=(()=>{var se;const me=O.charAt(0).toUpperCase()+O.slice(1)+" placeholder",$e="from"===O?this.fromTripLocation:this.toTripLocation;return null===$e?me:(null!==(se=$e.location.computeLocationName())&&void 0!==se?se:me)+" (OJP Demo)"})();b.push({value:B,type:"ID",label:X})});const A=new URLSearchParams;A.set("stops",JSON.stringify(b)),A.set("ref","OJP Demo"),this.sbbURL="https://www.sbb.ch/en?"+A.toString()}updateStageLinkedURL(e,i){const r=(()=>{if(i){if("V2-INT"===this.currentAppStage)return"INT";if("V2-TEST"===this.currentAppStage)return"TEST"}else{if("INT"===this.currentAppStage)return"V2-INT";if("TEST"===this.currentAppStage)return"V2-TEST"}return null})();return null===r?e.delete("stage"):e.set("stage",r),e}computeInitialDate(){var e;const i=new Date,r=null!==(e=this.queryParams.get("trip_datetime"))&&void 0!==e?e:null;if(null===r)return i;const a=Date.parse(r);return isNaN(a)?(console.error("CANT parse custom date string: "+r+", using current datetime instead"),i):new Date(a)}getStageConfig(e=this.currentAppStage){var i;const r=null!==(i=cB.stages[e])&&void 0!==i?i:null;return null===r?(console.error("ERROR - cant find stage"+e+" using PROD"),bn.EMPTY_API_CONFIG):r}updateAppStage(e){this.currentAppStage=e,this.updateURLs()}updateDepartureDateTime(e){this.departureDate=e,this.updateURLs()}updateTripMode(){this.updateURLs()}computeTripLocationsToUpdate(){const e=[];return["From","To"].forEach(r=>{const a="From"===r,d=a?this.fromTripLocation:this.toTripLocation;null!==d&&("mode_at_end"===this.tripModeType&&a||"mode_at_start"===this.tripModeType&&!a||e.push(d))}),e}updateTripLocationRestrictions(e,i,r,a){this.computeTripLocationsToUpdate().forEach(b=>{b.minDuration=e,b.maxDuration=i,b.minDistance=r,b.maxDistance=a})}updateTripLocationCustomMode(){this.computeTripLocationsToUpdate().forEach(i=>{i.customTransportMode="public_transport"===this.tripTransportMode?null:this.tripTransportMode})}updateParamsFromTrip(e){if(!(e.legs.length>0))return;const a=e.legs[e.legs.length-1];this.fromTripLocation=new bn.TripLocationPoint(e.legs[0].fromLocation),this.toTripLocation=new bn.TripLocationPoint(a.toLocation),this.viaTripLocations=[],this.tripModeType="monomodal",this.tripTransportMode="public_transport",this.geoLocationsUpdated.emit(),this.updateURLs()}massageTrips(e){const i=e.map(r=>{const a=r.legs.map(b=>({leg:b,info:{id:""+b.legID,comments:null}}));return{trip:r,fareResult:null,legsData:a,info:{comments:null}}});return this.sortTrips(i),this.mergeTripLegs(i),i}sortTrips(e){var i;if("monomodal"!==this.tripModeType||"public_transport"===this.tripTransportMode)return;const r=null!==(i=e.find(a=>{var d;return null!==(null!==(d=a.trip.legs.find(x=>"ContinuousLeg"===x.legType&&a.trip.legs[0].legTransportMode===this.tripTransportMode))&&void 0!==d?d:null)}))&&void 0!==i?i:null;if(r){const a=e.indexOf(r);e.splice(a,1),e.unshift(r),r.info.comments="APP-HACK - sortTrips - trips were re-sorted to promote the index-"+a+" trip first","DEBUG"===Sc&&console.log(r.info.comments)}}mergeTripLegs(e){e.forEach(i=>{const r=[];let a=-1;i.trip.legs.forEach((d,b)=>{const x={leg:d,info:{id:""+d.legID,comments:null}};if(b<=a)return;const A=b+1,O=b+2;if(O>=i.trip.legs.length)return void r.push(x);let B=!1;const X=i.trip.legs[A],te=i.trip.legs[O];if("TimedLeg"===d.legType&&"TransferLeg"===X.legType&&"TimedLeg"===te.legType){const se=X;("remainInVehicle"===se.transferMode||"changeWithinVehicle"===se.transferMode)&&(B=!0,a=O)}if(B){const se=this.mergeTimedLegs(d,te);x.leg=se,x.info.id=b+1+"-"+(O+1),x.info.comments="Timed legs were merged: "+x.info.id}r.push(x)}),i.trip.legs.length>0&&i.trip.legs.length!==r.length&&(i.info.comments="APP-HACK - mergeTripLegs - remainInVehicle usecase, before: "+i.trip.legs.length+", after: "+r.length+" legs","DEBUG"===Sc&&console.log(i.info.comments),i.legsData=r)})}mergeTimedLegs(e,i){let r=e.intermediateStopPoints.slice();e.toStopPoint.stopPointType="Intermediate",r.push(e.toStopPoint),r=r.concat(i.intermediateStopPoints.slice());const a=new bn.TripTimedLeg(e.legID,e.service,e.fromStopPoint,i.toStopPoint,r);return null!==e.legDuration&&null!==i.legDuration&&(a.legDuration=e.legDuration.plus(i.legDuration)),null!==e.legTrack&&null!==i.legTrack&&(a.legTrack=e.legTrack.plus(i.legTrack)),a}fetchFares(e){var i=this;return mr(function*(){if(0===i.journeyTripRequests.length||"monomodal"!==i.tripModeType||"public_transport"!==i.tripTransportMode)return;const r=i.journeyTripRequests[0].response;if(null===r)return;const a=r.trips,d=yield i.fetchFaresForTrips(e,a);i.updateFares(d)})()}fetchFaresForTrips(e,i){var r=this;return mr(function*(){const a=r.getStageConfig("NOVA-INT"),d=new M1(Ps,a,e,bn.XML_BuilderConfigOJPv1),b=[];i.forEach(O=>{const B=O.asXML(bn.XML_ConfigOJPv2),X=BC.initWithTripXML(B);b.push(X)});const x=sZ.initWithOJPv2Trips(b),A=yield d.fetchFareRequestResponse(x);return A.ok?A.value.fareResult:(console.log("ERROR: fetchFareRequestResponse"),console.log(A),[])})()}hasPublicTransport(){return"public_transport"===this.tripTransportMode}}return n.\u0275fac=function(e){return new(e||n)(Tt(xf))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const rK=["*"],oK=["tabListContainer"],sK=["tabList"],aK=["tabListInner"],lK=["nextPaginator"],cK=["previousPaginator"],pK=["sbb-tab-nav-bar",""];new en("SbbTabContent"),new en("SbbTabLabel"),new en("SBB_TAB"),Zl(class{}),new en("SBB_TAB_GROUP"),Aa("translateTab",[_o("hidden",bi({visibility:"hidden"})),jr("* => void, * => hidden",[bi({opacity:1}),Kr("{{animationDurationHide}} ease",bi({opacity:0}))]),jr("hidden => show",[bi({opacity:0,visibility:"visible"}),Kr("{{animationDuration}} ease",bi({opacity:1}))]),jr("void => show",Kr("0s"))]),new en("SBB_TABS_CONFIG"),Zl(class{});const n2=Gm({passive:!0}),gK=Y_(class{});let _K=(()=>{class n extends gK{constructor(e,i,r,a,d,b){super(),this._elementRef=e,this._changeDetectorRef=i,this._viewportRuler=r,this._ngZone=a,this._platform=d,this._animationMode=b,this._scrollShadowTrigger=new On,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new On,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new On,this._disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new Cn,this.indexFocused=new Cn,a.runOutsideAngular(()=>{Ld(e.nativeElement,"mouseleave").pipe(Mr(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get disablePagination(){return this._disablePagination}set disablePagination(e){this._disablePagination=Ai(e)}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){e=yf(e),this._selectedIndex!==e&&(this._selectedIndexChanged=!0,this._selectedIndex=e,this._keyManager&&this._keyManager.updateActiveItem(e))}ngAfterViewInit(){Ld(this._previousPaginator.nativeElement,"touchstart",n2).pipe(Mr(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),Ld(this._nextPaginator.nativeElement,"touchstart",n2).pipe(Mr(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){const e=this._viewportRuler.change(150),i=()=>this.updatePagination();this._keyManager=new VR(this._items).withHorizontalOrientation("ltr").withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(Ho(1)).subscribe(i),Oo(e,this._items.changes,this.variant).pipe(Mr(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),i()})})}),this._keyManager.change.pipe(Mr(this._destroyed)).subscribe(r=>{this.indexFocused.emit(r),this._setTabFocus(r)}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Do(r=>"standard"===r),rl(()=>Oo(Ld(this._tabListContainer.nativeElement,"scroll",n2),this._scrollShadowTrigger,e)),Ra(null),st(()=>this._calculateScrollState()),Wm(),Mr(this._destroyed)).subscribe(r=>this._applyScrollShadows(r))}),this._ngZone.runOutsideAngular(()=>{this.variant.pipe(Mr(this._destroyed)).subscribe(r=>{"lean"===r?this._tabListContainer.nativeElement.scrollLeft=0:this._tabList.nativeElement.style.removeProperty("transform")})})}ngAfterContentChecked(){this._tabLabelCount!==this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(e){if(!al(e))switch(e.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(e));break;default:this._keyManager.onKeydown(e)}}_onContentChanges(){const e=this._elementRef.nativeElement.textContent;e!==this._currentTextContent&&(this._currentTextContent=e||"",this._ngZone.run(()=>{this.updatePagination(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(e){!this._isValidIndex(e)||this.focusIndex===e||!this._keyManager||this._keyManager.setActiveItem(e)}_isValidIndex(e){if(!this._items)return!0;const i=this._items?this._items.toArray()[e]:null;return!!i&&!i.disabled}_setTabFocus(e){this._showPaginationControls&&this._scrollToLabel(e),this._items&&this._items.length&&(this._items.toArray()[e].focus(),this._tabListContainer.nativeElement.scrollLeft=0)}_updateTabScrollPosition(){this.disablePagination||"standard"===this.variantSnapshot||(this._tabList.nativeElement.style.transform=`translateX(${Math.round(-this.scrollDistance)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0))}get scrollDistance(){return this._scrollDistance}set scrollDistance(e){this._scrollTo(e)}_scrollHeader(e){return this._scrollTo(this._scrollDistance+("before"===e?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(e){this._stopInterval(),this._scrollHeader(e)}_scrollToLabel(e){if(this.disablePagination||"standard"===this.variantSnapshot)return;const i=this._items?this._items.toArray()[e]:null;if(!i)return;const r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:a,offsetWidth:d}=i.elementRef.nativeElement,x=a+d,A=this.scrollDistance,O=this.scrollDistance+r;a<A?this.scrollDistance-=A-a+60:x>O&&(this.scrollDistance+=x-O+60)}_checkPaginationEnabled(){if(this.disablePagination||"standard"===this.variantSnapshot)this._showPaginationControls=!1;else{const e=this._tabListInner.nativeElement.scrollWidth-this._elementRef.nativeElement.offsetWidth>1;e||(this.scrollDistance=0),e!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=e}}_checkScrollingControls(){this.disablePagination||"standard"===this.variantSnapshot?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0===this.scrollDistance,this._disableScrollAfter=this.scrollDistance===this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabListInner.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(e,i){i&&null!=i.button&&0!==i.button||(this._stopInterval(),HR(650,100).pipe(Mr(Oo(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:r,distance:a}=this._scrollHeader(e);(0===a||a>=r)&&this._stopInterval()}))}_scrollTo(e){if(this.disablePagination||"standard"===this.variantSnapshot)return{maxScrollDistance:0,distance:0};const i=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(i,e)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:i,distance:this._scrollDistance}}_calculateScrollState(){const e=this._tabListContainer.nativeElement;if(e.scrollWidth===e.offsetWidth)return"hidden";const i=0===e.scrollLeft;return i||e.scrollWidth-e.scrollLeft-e.offsetWidth<=1?i?"left":"right":"middle"}_applyScrollShadows(e){const i=this._elementRef.nativeElement;"hidden"===e||"left"===e?i.classList.remove("sbb-tab-header-left-shadow"):i.classList.add("sbb-tab-header-left-shadow"),"hidden"===e||"right"===e?i.classList.remove("sbb-tab-header-right-shadow"):i.classList.add("sbb-tab-header-right-shadow")}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(So),ue(Od),ue(Ui),ue(ga),ue(Ah,8))},n.\u0275dir=cn({type:n,inputs:{disablePagination:"disablePagination"},features:[Un]}),n})(),bK=0,Ez=(()=>{class n extends _K{constructor(e,i,r,a,d,b){super(e,r,a,i,d,b)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(Ra(null),Mr(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const e=this._items.toArray();for(let i=0;i<e.length;i++)if(e[i].active)return this.selectedIndex=i,this._changeDetectorRef.markForCheck(),void(this.tabPanel&&(this.tabPanel._activeTabId=e[i].id));this.selectedIndex=-1}_getRole(){return this.tabPanel?"tablist":this._elementRef.nativeElement.getAttribute("role")}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(Ui),ue(So),ue(Od),ue(ga),ue(Ah,8))},n.\u0275dir=cn({type:n,inputs:{tabPanel:"tabPanel"},features:[Un]}),n})(),uD=(()=>{class n extends Ez{constructor(e,i,r,a,d,b){super(e,i,r,a,d,b)}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(Ui),ue(So),ue(Od),ue(ga),ue(Ah,8))},n.\u0275cmp=Jt({type:n,selectors:[["","sbb-tab-nav-bar",""]],contentQueries:function(e,i,r){if(1&e&&Uo(r,dD,5),2&e){let a;xi(a=wi())&&(i._items=a)}},viewQuery:function(e,i){if(1&e&&(mo(oK,7),mo(sK,7),mo(aK,7),mo(lK,5),mo(cK,5)),2&e){let r;xi(r=wi())&&(i._tabListContainer=r.first),xi(r=wi())&&(i._tabList=r.first),xi(r=wi())&&(i._tabListInner=r.first),xi(r=wi())&&(i._nextPaginator=r.first),xi(r=wi())&&(i._previousPaginator=r.first)}},hostAttrs:[1,"sbb-tab-nav-bar","sbb-tab-header"],hostVars:3,hostBindings:function(e,i){2&e&&(si("role",i._getRole()),_("sbb-tab-header-pagination-controls-enabled",i._showPaginationControls&&"lean"===i.variantSnapshot))},exportAs:["sbbTabNavBar","sbbTabNav"],features:[Un],attrs:pK,ngContentSelectors:rK,decls:13,vars:8,consts:[["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-before","sbb-button-reset-frameless",3,"disabled","click","mousedown","touchend"],["previousPaginator",""],["svgIcon","kom:chevron-left-small",1,"sbb-tab-header-pagination-chevron"],[1,"sbb-tab-link-container","sbb-scrollbar",3,"keydown"],["tabListContainer",""],[1,"sbb-tab-list",3,"cdkObserveContent"],["tabList",""],[1,"sbb-tab-links"],["tabListInner",""],["aria-hidden","true","type","button","tabindex","-1",1,"sbb-tab-header-pagination","sbb-tab-header-pagination-after","sbb-button-reset-frameless",3,"disabled","mousedown","click","touchend"],["nextPaginator",""],["svgIcon","kom:chevron-right-small",1,"sbb-tab-header-pagination-chevron"]],template:function(e,i){1&e&&(Rs(),ne(0,"button",0,1),Wt("click",function(){return i._handlePaginatorClick("before")})("mousedown",function(a){return i._handlePaginatorPress("before",a)})("touchend",function(){return i._stopInterval()}),rn(2,"sbb-icon",2),oe(),ne(3,"div",3,4),Wt("keydown",function(a){return i._handleKeydown(a)}),ne(5,"div",5,6),Wt("cdkObserveContent",function(){return i._onContentChanges()}),ne(7,"div",7,8),Co(9),oe()()(),ne(10,"button",9,10),Wt("mousedown",function(a){return i._handlePaginatorPress("after",a)})("click",function(){return i._handlePaginatorClick("after")})("touchend",function(){return i._stopInterval()}),rn(12,"sbb-icon",11),oe()),2&e&&(_("sbb-tab-header-pagination-disabled",i._disableScrollBefore),Pe("disabled",i._disableScrollBefore||null),pe(5),_("_sbb-animation-noopable","NoopAnimations"===i._animationMode),pe(5),_("sbb-tab-header-pagination-disabled",i._disableScrollAfter),Pe("disabled",i._disableScrollAfter||null))},dependencies:[vB,cl],styles:['.sbb-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.sbb-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:2.1333333333rem;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;color:var(--sbb-color-granite);box-shadow:0 .1333333333rem .2666666667rem -.0666666667rem rgba(0,0,0,.2),0 .2666666667rem .3333333333rem rgba(0,0,0,.1411764706),0 .0666666667rem .6666666667rem rgba(0,0,0,.1215686275)}.sbb-tab-header-pagination::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-header-pagination::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-header-pagination::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}.sbb-tab-header-pagination-controls-enabled .sbb-tab-header-pagination{display:flex}.sbb-tab-header-pagination:hover:not(.sbb-tab-header-pagination-disabled){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-header-pagination::after{right:0;left:0}.sbb-tab-header-pagination.sbb-tab-header-pagination-after.sbb-tab-header-pagination-disabled::after{left:-.0666666667rem}.sbb-tab-header-pagination-disabled .sbb-tab-header-pagination-chevron{opacity:.4}.sbb-tab-header-pagination-disabled{box-shadow:none;cursor:default}.sbb-tab-list{flex-grow:1;position:relative;transition:transform var(--sbb-transition-duration-slow) var(--sbb-transition-timing-fast-start);will-change:transform}.sbb-tab-header{position:relative}:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{position:absolute;top:0;content:"";z-index:2;width:.8rem;height:calc(100% - .5rem);transition:transform var(--sbb-transition-duration-fast) var(--sbb-transition-timing-default);pointer-events:none}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-header::before,:where(html:not(.sbb-lean)) .sbb-tab-header::after{width:calc(1.6rem * var(--sbb-scaling-factor))}}:where(html:not(.sbb-lean)) .sbb-tab-header::before{left:0;transform:translateX(-100%);background:linear-gradient(270deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-left-shadow::before{transform:translateX(0)}:where(html:not(.sbb-lean)) .sbb-tab-header::after{right:0;transform:translateX(100%);background:linear-gradient(90deg, hsla(0deg, 0%, 100%, 0.37) 0, var(--sbb-color-background))}:where(html:not(.sbb-lean)) .sbb-tab-header.sbb-tab-header-right-shadow::after{transform:translateX(0)}.sbb-tab-links{display:flex;padding-top:calc(0.1333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tab-links{padding-top:0}:where(html.sbb-lean) .sbb-tab-links::after{content:"";width:100%;flex-grow:1;flex-shrink:1;border-bottom:var(--sbb-border-width) solid var(--sbb-color-graphite)}.sbb-tab-link-container{display:flex;position:relative;flex-grow:1;overflow-x:auto;z-index:1;padding-bottom:1.3333333333rem}:where(html.sbb-lean) .sbb-tab-link-container{overflow:hidden;padding-bottom:0}.sbb-tab-link{margin-right:2.1333333333rem;cursor:pointer;box-sizing:border-box;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;font-family:var(--sbb-font-light);font-size:1.3333333333rem;color:var(--sbb-color-text);line-height:1em;padding-bottom:1.3333333333rem;outline:none;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0)}.sbb-tab-link::after{content:"";display:block;position:absolute;bottom:0;height:0;margin:0 auto;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-text)}:where(html:not(.sbb-lean)) .sbb-tab-link::after{transition:width var(--sbb-transition-duration-default),left var(--sbb-transition-duration-default);left:0;right:0;width:0}:where(html.sbb-lean) .sbb-tab-link::after{left:var(--sbb-border-width-negative);right:var(--sbb-border-width-negative);border-color:var(--sbb-color-graphite)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-tab-link{margin-right:calc(2.8rem * var(--sbb-scaling-factor));font-size:calc(1.7333333333rem * var(--sbb-scaling-factor))}}:where(html.sbb-lean) .sbb-tab-link{font-size:var(--sbb-font-size);line-height:1.3333333333rem;padding:.4rem 1rem .6rem;background-color:var(--sbb-color-background);margin-right:0;border:var(--sbb-border-width) solid rgba(0,0,0,0);border-bottom:none;border-radius:var(--sbb-border-radius) var(--sbb-border-radius) 0 0}.sbb-tab-link:last-child{margin-right:0 !important}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-label-active::after{width:100%}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active{border-color:var(--sbb-color-graphite)}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active::after{display:none}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover){color:var(--sbb-color-call-to-action-hover)}.sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{border-bottom-color:var(--sbb-color-call-to-action-hover)}:where(html:not(.sbb-lean)) .sbb-tab-link:not(.sbb-tab-label-active):not(.sbb-tab-disabled):is(:focus,:hover)::after{width:100%}.sbb-tab-link.sbb-tab-label-active:is(:hover,:focus){color:currentColor;cursor:default}:where(html.sbb-lean) .sbb-tab-link.sbb-tab-label-active:focus-visible{outline:var(--sbb-border-width) solid var(--sbb-color-black);outline-offset:calc(-1*var(--sbb-border-width))}.sbb-tab-link.sbb-tab-disabled{color:var(--sbb-color-storm)}.sbb-tab-link.sbb-tab-disabled:is(:hover,:focus){cursor:default}:where(html:not(.sbb-lean)) .sbb-tab-link.sbb-tab-disabled::after{width:0 !important}.sbb-tab-link .sbb-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}:where(html.sbb-lean) .sbb-tab-link .sbb-badge:not(.sbb-badge-hidden){padding-right:.7333333333rem}:where(html.sbb-lean) .sbb-tab-link .sbb-badge-content{transform:scale(0.8)}[sbb-stretch-tabs] .sbb-tab-link{flex-basis:0;flex-grow:1}:where(html.sbb-lean) .sbb-tab-link{overflow:unset}.sbb-tab-link.sbb-tab-disabled{pointer-events:none}:is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){display:block;position:relative;overflow:hidden;transition:height var(--sbb-transition-duration-slow)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){border:var(--sbb-border-width) solid var(--sbb-color-graphite);border-top:none;background-color:var(--sbb-color-background)}:where(html.sbb-lean) :is(.sbb-tab-nav-panel,.sbb-tab-nav-bar-body){padding:1rem}'],encapsulation:2}),n})();const yK=Sv(Zl(class{}));let vK=(()=>{class n extends yK{constructor(e,i,r,a){super(),this._tabNavBar=e,this.elementRef=i,this._focusMonitor=a,this._isActive=!1,this.id="sbb-tab-link-"+bK++,this.tabIndex=parseInt(r,10)||0}get active(){return this._isActive}set active(e){const i=Ai(e);i!==this._isActive&&(this._isActive=i,this._tabNavBar.updateActiveLink())}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}_handleKeydown(e){this._tabNavBar.tabPanel&&32===e.keyCode&&this.elementRef.nativeElement.click()}_getAriaControls(){var e;return this._tabNavBar.tabPanel?null===(e=this._tabNavBar.tabPanel)||void 0===e?void 0:e.id:this.elementRef.nativeElement.getAttribute("aria-controls")}_getAriaSelected(){return this._tabNavBar.tabPanel?this.active?"true":"false":this.elementRef.nativeElement.getAttribute("aria-selected")}_getAriaCurrent(){return this.active&&!this._tabNavBar.tabPanel?"page":null}_getRole(){return this._tabNavBar.tabPanel?"tab":this.elementRef.nativeElement.getAttribute("role")}_getTabIndex(){return this._tabNavBar.tabPanel?this._isActive?0:-1:this.tabIndex}}return n.\u0275fac=function(e){return new(e||n)(ue(Ez),ue(ci),hs("tabindex"),ue(Cl))},n.\u0275dir=cn({type:n,inputs:{active:"active",id:"id"},features:[Un]}),n})(),dD=(()=>{class n extends vK{constructor(e,i,r,a){super(e,i,r,a)}}return n.\u0275fac=function(e){return new(e||n)(ue(uD),ue(ci),hs("tabindex"),ue(Cl))},n.\u0275dir=cn({type:n,selectors:[["","sbb-tab-link",""],["","sbbTabLink",""]],hostAttrs:[1,"sbb-tab-link","sbb-link-reset"],hostVars:11,hostBindings:function(e,i){1&e&&Wt("focus",function(){return i._handleFocus()})("keydown",function(a){return i._handleKeydown(a)}),2&e&&(si("aria-controls",i._getAriaControls())("aria-current",i._getAriaCurrent())("aria-disabled",i.disabled)("aria-selected",i._getAriaSelected())("id",i.id)("tabIndex",i._getTabIndex())("role",i._getRole()),_("sbb-tab-disabled",i.disabled)("sbb-tab-label-active",i.active))},inputs:{disabled:"disabled",tabIndex:"tabIndex"},exportAs:["sbbTabLink"],features:[Un]}),n})(),Iz=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,ll,GC,G_,$_,Ur,Ss]}),n})(),$u=(()=>{class n{constructor(){this.language=this.guessLanguage()}guessLanguage(){let i=new URLSearchParams(document.location.search).get("lang");if(null!==i){if(i=i.trim().toLowerCase(),"de"===i)return"de";if("en"===i)return"en";if("fr"===i)return"fr";if("it"===i)return"it"}const r={de:"de","de-DE":"de","de-AT":"de","de-CH":"de",en:"en","en-US":"en","en-GB":"en","en-AU":"en","en-CA":"en",fr:"fr","fr-FR":"fr","fr-CA":"fr","fr-BE":"fr","fr-CH":"fr",it:"it","it-IT":"it","it-CH":"it"},a=navigator.languages?navigator.languages:[navigator.language];for(const d of a){const b=d.split("-")[0];if(r[d])return r[d];if(r[b])return r[b]}return"en"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class xK{constructor(t=!1,e,i=!0,r){this._multiple=t,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new On,e&&e.length&&(t?e.forEach(a=>this._markSelected(a)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...t){this._verifyValueAssignment(t),t.forEach(i=>this._markSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}deselect(...t){this._verifyValueAssignment(t),t.forEach(i=>this._unmarkSelected(i));const e=this._hasQueuedChanges();return this._emitChangeEvent(),e}setSelection(...t){this._verifyValueAssignment(t);const e=this.selected,i=new Set(t);t.forEach(a=>this._markSelected(a)),e.filter(a=>!i.has(a)).forEach(a=>this._unmarkSelected(a));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(t){return this.isSelected(t)?this.deselect(t):this.select(t)}clear(t=!0){this._unmarkAll();const e=this._hasQueuedChanges();return t&&this._emitChangeEvent(),e}isSelected(t){if(this.compareWith){for(const e of this._selection)if(this.compareWith(e,t))return!0;return!1}return this._selection.has(t)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(t){this._multiple&&this.selected&&this._selected.sort(t)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(t){this.isSelected(t)||(this._multiple||this._unmarkAll(),this.isSelected(t)||this._selection.add(t),this._emitChanges&&this._selectedToEmit.push(t))}_unmarkSelected(t){this.isSelected(t)&&(this._selection.delete(t),this._emitChanges&&this._deselectedToEmit.push(t))}_unmarkAll(){this.isEmpty()||this._selection.forEach(t=>this._unmarkSelected(t))}_verifyValueAssignment(t){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}}let o2=(()=>{class n{constructor(){this._listeners=[]}notify(e,i){for(let r of this._listeners)r(e,i)}listen(e){return this._listeners.push(e),()=>{this._listeners=this._listeners.filter(i=>e!==i)}}ngOnDestroy(){this._listeners=[]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),wK=0;const s2=new en("CdkAccordion");let SK=(()=>{class n{constructor(){this._stateChanges=new On,this._openCloseAllActions=new On,this.id="cdk-accordion-"+wK++,this._multi=!1}get multi(){return this._multi}set multi(e){this._multi=Ai(e)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(e){this._stateChanges.next(e)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[Mi([{provide:s2,useExisting:n}]),ho]}),n})(),TK=0,CK=(()=>{class n{constructor(e,i,r){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=r,this._openCloseAllSubscription=Se.EMPTY,this.closed=new Cn,this.opened=new Cn,this.destroyed=new Cn,this.expandedChange=new Cn,this.id="cdk-accordion-child-"+TK++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((a,d)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===d&&this.id!==a&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(e){e=Ai(e),this._expanded!==e&&(this._expanded=e,this.expandedChange.emit(e),e?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){this._disabled=Ai(e)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}}return n.\u0275fac=function(e){return new(e||n)(ue(s2,12),ue(So),ue(o2))},n.\u0275dir=cn({type:n,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[Mi([{provide:s2,useValue:void 0}])]}),n})(),DK=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({}),n})();const EK=["body"];function IK(n,t){}const MK=[[["sbb-expansion-panel-header"]],"*"],AK=["sbb-expansion-panel-header","*"];function RK(n,t){1&n&&rn(0,"sbb-icon",5),2&n&&Pe("@indicatorRotate",St(2)._getExpandedState())}function PK(n,t){1&n&&rn(0,"sbb-icon",9)}function kK(n,t){1&n&&rn(0,"sbb-icon",10)}function LK(n,t){1&n&&(ji(0,6),yt(1,PK,1,0,"sbb-icon",7),yt(2,kK,1,0,"sbb-icon",8),Zi()),2&n&&(Pe("ngSwitch",St(2)._isExpanded()),pe(1),Pe("ngSwitchCase",!1),pe(1),Pe("ngSwitchCase",!0))}function OK(n,t){1&n&&(ne(0,"span",2),Uy(1,"async"),yt(2,RK,1,1,"sbb-icon",3),yt(3,LK,3,3,"ng-container",4),oe()),2&n&&(Pe("ngSwitch",Hy(1,3,St().panel.variant)),pe(2),Pe("ngSwitchCase","lean"),pe(1),Pe("ngSwitchCase","standard"))}const FK=["*"],a2=new en("SBB_ACCORDION"),Rz="225ms cubic-bezier(0.4,0.0,0.2,1)",Pz={indicatorRotate:Aa("indicatorRotate",[_o("collapsed, void",bi({transform:"rotate(90deg)"})),_o("expanded",bi({transform:"rotate(-90deg)"})),jr("expanded <=> collapsed, void => collapsed",Kr(Rz))]),bodyExpansion:Aa("bodyExpansion",[_o("collapsed, void",bi({height:"0px",visibility:"hidden"})),_o("expanded",bi({height:"*",visibility:"visible"})),jr("expanded <=> collapsed, void => collapsed",Kr(Rz))])},kz=new en("SBB_EXPANSION_PANEL");let NK=(()=>{class n{constructor(e,i){this._template=e,this._expansionPanel=i}}return n.\u0275fac=function(e){return new(e||n)(ue(ls),ue(kz,8))},n.\u0275dir=cn({type:n,selectors:[["ng-template","sbbExpansionPanelContent",""]]}),n})();const BK=Y_(CK);let zK=0,wf=(()=>{class n extends BK{constructor(e,i,r,a,d){super(i,r,a),this._viewContainerRef=e,this._hideToggle=!1,this.afterExpand=new Cn,this.afterCollapse=new Cn,this._inputChanges=new On,this._headerId="sbb-expansion-panel-header-"+zK++,this._bodyAnimationDone=new On,this.accordion=i,this._document=d,this._bodyAnimationDone.pipe(Wm((b,x)=>b.fromState===x.fromState&&b.toState===x.toState)).subscribe(b=>{"void"!==b.fromState&&("expanded"===b.toState?this.afterExpand.emit():"collapsed"===b.toState&&this.afterCollapse.emit())})}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=Ai(e)}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(Ra(null),Do(()=>this.expanded&&!this._portal),Ho(1)).subscribe(()=>{this._portal=new W_(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}}return n.\u0275fac=function(e){return new(e||n)(ue(Hs),ue(a2,12),ue(So),ue(o2),ue(Oi))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-expansion-panel"]],contentQueries:function(e,i,r){if(1&e&&Uo(r,NK,5),2&e){let a;xi(a=wi())&&(i._lazyContent=a.first)}},viewQuery:function(e,i){if(1&e&&mo(EK,5),2&e){let r;xi(r=wi())&&(i._body=r.first)}},hostAttrs:[1,"sbb-expansion-panel"],hostVars:2,hostBindings:function(e,i){2&e&&_("sbb-expanded",i.expanded)},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["sbbExpansionPanel"],features:[Mi([{provide:a2,useValue:void 0},{provide:kz,useExisting:n}]),Un,ho],ngContentSelectors:AK,decls:6,vars:4,consts:[["role","region",1,"sbb-expansion-panel-content",3,"id"],["body",""],[1,"sbb-expansion-panel-body","sbb-expansion-panel-horizontal-padding"],[3,"cdkPortalOutlet"]],template:function(e,i){1&e&&(Rs(MK),Co(0),ne(1,"div",0,1),Wt("@bodyExpansion.done",function(a){return i._bodyAnimationDone.next(a)}),ne(3,"div",2),Co(4,1),yt(5,IK,0,0,"ng-template",3),oe()()),2&e&&(pe(1),Pe("@bodyExpansion",i._getExpandedState())("id",i.id),si("aria-labelledby",i._headerId),pe(4),Pe("cdkPortalOutlet",i._portal))},dependencies:[jh],styles:['.sbb-expansion-panel{box-sizing:content-box;display:block;margin:0;transition:border-color var(--sbb-transition-fast-start);border:var(--sbb-border-width-thin) solid var(--sbb-color-milk)}.sbb-expansion-panel+.sbb-expansion-panel{margin-top:calc(var(--sbb-border-width-thin)*2)}.sbb-expansion-panel.sbb-expanded{border-color:var(--sbb-color-cloud)}.sbb-expansion-panel.sbb-expanded.sbb-expansion-panel-full-width{border-left-color:rgba(0,0,0,0);border-right-color:rgba(0,0,0,0);border-left-width:0;border-right-width:0;padding-left:var(--sbb-border-width-thin);padding-right:var(--sbb-border-width-thin)}.sbb-expansion-panel-horizontal-padding{padding-left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));padding-right:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin))}.sbb-expansion-panel-header{cursor:pointer;display:flex;align-items:center;position:relative;background-color:var(--sbb-color-milk);outline:none;padding-top:var(--sbb-expansion-panel-header-padding-top);padding-bottom:var(--sbb-expansion-panel-header-padding-bottom)}:where(html.sbb-lean) .sbb-expansion-panel-header{padding-bottom:calc(0.8rem - var(--sbb-border-width-thin))}.sbb-expansion-panel-header.sbb-expanded::after{content:"";display:block;position:absolute;height:0;bottom:0;width:calc(100% - var(--sbb-expansion-panel-padding-horizontal)*2 + var(--sbb-border-width-thin)*2);left:calc(var(--sbb-expansion-panel-padding-horizontal) - var(--sbb-border-width-thin));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-color-cloud)}.sbb-expansion-panel-header:is(.sbb-expanded,.sbb-expanded:is(:focus,:hover)){background:inherit}.sbb-expansion-panel-header.sbb-disabled{cursor:default;opacity:.75}.sbb-expansion-panel-header-indicator{flex:0 0 auto;line-height:0;height:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);margin-left:1.6rem;color:var(--sbb-color-black);margin-top:-0.5em;margin-bottom:-0.5em}:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%;padding:calc(0.2666666667rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin))}@media all and (min-width: 40.1875em)and (max-width: 64.0525em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.6666666667rem}}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{height:calc(2.1333333333rem * var(--sbb-scaling-factor));width:calc(2.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.4rem}}@media all and (min-width: 240.0625em){:where(html:not(.sbb-lean)) .sbb-expansion-panel-header-indicator{margin-left:2.9333333333rem}}.sbb-expansion-panel-header-content{display:flex;flex:1;overflow:hidden;font-family:var(--sbb-font-light);font-size:var(--sbb-font-size-large);line-height:var(--sbb-expansion-panel-line-height)}.sbb-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.sbb-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.sbb-expansion-panel-content.ng-animating,.sbb-expansion-panel:not(.sbb-expanded) .sbb-expansion-panel-content{overflow:hidden}.sbb-expansion-panel-body{font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:var(--sbb-divider-medium);padding-bottom:var(--sbb-divider-medium)}.sbb-expansion-panel-body>*:first-child{margin-top:0}'],encapsulation:2,data:{animation:[Pz.bodyExpansion]},changeDetection:0}),n})();const jK=Sv(class VK{});let V1=(()=>{class n extends jK{constructor(e,i,r,a,d,b){super(),this.panel=e,this._element=i,this._focusMonitor=r,this._changeDetectorRef=a,this._document=d,this._parentChangeSubscription=Se.EMPTY;const x=e.accordion?e.accordion._stateChanges.pipe(Do(A=>!!A.hideToggle)):uo;this.tabIndex=parseInt(b||"",10)||0,this._parentChangeSubscription=Oo(e.opened,e.closed,x,e._inputChanges.pipe(Do(A=>!(!A.hideToggle&&!A.disabled)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe(Do(()=>e._containsFocus())).subscribe(()=>r.focusVia(i,"program"))}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_keydown(e){switch(e.keyCode){case 32:case 13:!al(e)&&this._isFocused()&&(e.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e))}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}_isFocused(){var e;return(null===(e=this._document)||void 0===e?void 0:e.activeElement)===this._element.nativeElement}}return n.\u0275fac=function(e){return new(e||n)(ue(wf,1),ue(ci),ue(Cl),ue(So),ue(Oi),hs("tabindex"))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-expansion-panel-header"]],hostAttrs:["role","button",1,"sbb-expansion-panel-header","sbb-expansion-panel-horizontal-padding"],hostVars:9,hostBindings:function(e,i){1&e&&Wt("click",function(){return i._toggle()})("keydown",function(a){return i._keydown(a)}),2&e&&(si("id",i.panel._headerId)("tabindex",i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.disabled),_("sbb-expanded",i._isExpanded())("sbb-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},features:[Un],ngContentSelectors:FK,decls:3,vars:1,consts:[[1,"sbb-expansion-panel-header-content"],["class","sbb-expansion-panel-header-indicator sbb-icon-fit",3,"ngSwitch",4,"ngIf"],[1,"sbb-expansion-panel-header-indicator","sbb-icon-fit",3,"ngSwitch"],["svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],[3,"ngSwitch",4,"ngSwitchCase"],["svgIcon","kom:chevron-right-small"],[3,"ngSwitch"],["svgIcon","kom:plus-small",4,"ngSwitchCase"],["svgIcon","kom:minus-small",4,"ngSwitchCase"],["svgIcon","kom:plus-small"],["svgIcon","kom:minus-small"]],template:function(e,i){1&e&&(Rs(),ne(0,"span",0),Co(1),oe(),yt(2,OK,4,5,"span",1)),2&e&&(pe(2),Pe("ngIf",i._showToggle()))},dependencies:[Zo,Xy,aT,cl,kx],encapsulation:2,data:{animation:[Pz.indicatorRotate]},changeDetection:0}),n})(),hD=(()=>{class n extends SK{constructor(){super(...arguments),this._ownHeaders=new v_,this._hideToggle=!1}get hideToggle(){return this._hideToggle}set hideToggle(e){this._hideToggle=Ai(e)}ngAfterContentInit(){this._headers.changes.pipe(Ra(this._headers)).subscribe(e=>{this._ownHeaders.reset(e.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new VR(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(e){this._keyManager.onKeydown(e)}_handleHeaderFocus(e){this._keyManager.updateActiveItem(e)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["sbb-accordion"]],contentQueries:function(e,i,r){if(1&e&&Uo(r,V1,5),2&e){let a;xi(a=wi())&&(i._headers=a)}},hostAttrs:[1,"sbb-accordion"],inputs:{hideToggle:"hideToggle"},exportAs:["sbbAccordion"],features:[Mi([{provide:a2,useExisting:n}]),Un]}),n})(),Lz=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,DK,ll,Ur,Ss]}),n})();const Fd={Unknown:"#ffafcc",LongDistanceRail:"#D04D44",SBahn:"#0d6efd",Bus:"#0d6efd",PostAuto:"#EBBE24",OnDemand:"#D77D00",Funicular:"#8B4513",Walk:"#009933","Self-Drive Car":"#ff004f","Shared Mobility":"#871282",Guidance:"#6f0000",Transfer:"#088F8F",Water:"#005AB3"},UK=["arrival","departure"];class j1{constructor(t,e){this.calls=t,this.service=e,this.trackSectionsGeoPositions=[]}static initWithTripInfoDeliverySchema(t){var e,i,r,a,d;if(null===t)return null;if(0===t.tripInfoResult.length)return console.error("ERROR: TripInfoResult.initWithTripInfoDeliverySchema: empty tripInfoResult"),console.log(t),null;t.tripInfoResult.length>1&&(console.error("ERROR: TripInfoResult.initWithTripInfoDeliverySchema: more than 1 tripInfoResult? using first"),console.log(t));const b=t.tripInfoResult[0];if(!b.service)return console.error("ERROR: TripInfoResult.initWithTripInfoDeliverySchema: service is expected"),console.log(t),null;const x={};(null!==(r=null===(i=null===(e=t.tripInfoResponseContext)||void 0===e?void 0:e.places)||void 0===i?void 0:i.place)&&void 0!==r?r:[]).forEach(me=>{var ye,$e,ht,Qe;const At=zC.initWithXMLSchema(me),fn=null!==($e=null===(ye=At.stopPlace)||void 0===ye?void 0:ye.stopPlaceRef)&&void 0!==$e?$e:null;fn&&(x[fn]=At);const qn=null!==(Qe=null===(ht=At.stopPoint)||void 0===ht?void 0:ht.stopPointRef)&&void 0!==Qe?Qe:null;qn&&(x[qn]=At)});const O=[],B=b.previousCall.concat(b.onwardCall);B.forEach((me,ye)=>{var $e,ht,Qe,At,fn,qn,Xn;const Ri=null!==($e=x[me.stopPointRef])&&void 0!==$e?$e:null,Yi=0===ye?"From":ye===B.length-1?"To":"Intermediate",Ci=null!==(Qe=null===(ht=me.nameSuffix)||void 0===ht?void 0:ht.text)&&void 0!==Qe?Qe:null,ar=no.computePlatformAssistance(Ci),Gi={type:Yi,place:Ri,stopPointRef:me.stopPointRef,stopPointName:me.stopPointName.text,platform:{timetable:null!==(fn=null===(At=me.plannedQuay)||void 0===At?void 0:At.text)&&void 0!==fn?fn:null,realtime:null!==(Xn=null===(qn=me.plannedQuay)||void 0===qn?void 0:qn.text)&&void 0!==Xn?Xn:null},arrival:{timetable:null,realtime:null,timetableF:"",realtimeF:""},departure:{timetable:null,realtime:null,timetableF:"",realtimeF:""},vehicleAccessType:ar,mapFareClassOccupancy:null,isNotServicedStop:void 0===me.notServicedStop?null:me.notServicedStop};UK.forEach(eo=>{var Pr,gs,ti;const Fi="arrival"===eo,Ni=null!==(Pr=Fi?me.serviceArrival:me.serviceDeparture)&&void 0!==Pr?Pr:null,Hr=null!==(gs=null==Ni?void 0:Ni.timetabledTime)&&void 0!==gs?gs:null,us=Hr?new Date(Date.parse(Hr)):null,su=us?bn.DateHelpers.formatTimeHHMM(us):"",Dl=null!==(ti=null==Ni?void 0:Ni.estimatedTime)&&void 0!==ti?ti:null,au=Dl?new Date(Date.parse(Dl)):null,_s=au?bn.DateHelpers.formatTimeHHMM(au):"";Fi?(Gi.arrival.timetable=us,Gi.arrival.timetableF=su,Gi.arrival.realtime=au,Gi.arrival.realtimeF=_s):(Gi.departure.timetable=us,Gi.departure.timetableF=su,Gi.departure.realtime=au,Gi.departure.realtimeF=_s)}),O.push(Gi)});const X=(()=>{var me;if("2.0"!==Mo)return Yl.initWithLegacyTripInfoResultSchema(b);const $e=null!==(me=b.service)&&void 0!==me?me:null;return $e?Yl.initWithDatedJourneySchema($e):null})();if(null===X)return null;const te=new j1(O,X);return te.trackSectionsGeoPositions=[],(null!==(d=null===(a=b.journeyTrack)||void 0===a?void 0:a.trackSection)&&void 0!==d?d:[]).forEach(me=>{var ye,$e;const ht=[];(null!==($e=null===(ye=me.linkProjection)||void 0===ye?void 0:ye.position)&&void 0!==$e?$e:[]).forEach(At=>{const fn=new fv(At);fn.isValid()&&ht.push(fn)}),te.trackSectionsGeoPositions.push(ht)}),te}}let pD=(()=>{class n{constructor(){this.tripInfoResultUpdated=new Cn,this.locationSelected=new Cn}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const HK=["tooltip"];function qK(n,t){1&n&&Wo(0)}function GK(n,t){if(1&n&&(ji(0),yt(1,qK,1,0,"ng-container",7),Zi()),2&n){const e=t.ngIf;pe(1),Pe("ngTemplateOutlet",e)}}function $K(n,t){1&n&&Z(0),2&n&&de(St().message)}function WK(n,t){if(1&n){const e=or();ne(0,"button",8),Wt("click",function(){return Qn(e),ei(St().hide(0))}),rn(1,"sbb-icon",9),oe()}}function XK(n,t){1&n&&Co(0)}const ZK=["*"],l2="tooltip-panel",Oz=Gm({passive:!0}),Fz=new en("sbb-tooltip-scroll-strategy"),QK={provide:Fz,deps:[Gs],useFactory:function KK(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}},eQ=new en("sbb-tooltip-default-options",{providedIn:"root",factory:function tQ(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500,autoFocus:!0,restoreFocus:!0}}});class Nz{constructor(t){this.instance=t}}let nQ=(()=>{class n{constructor(e,i,r,a,d,b,x,A,O,B,X){this._overlay=e,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=a,this._ngZone=d,this._platform=b,this._ariaDescriber=x,this._focusMonitor=A,this._defaultOptions=B,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="sbb",this.trigger="hover",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this.tooltipPanelClass="",this._passiveListeners=[],this._destroyed=new On,this.opened=new Cn,this.dismissed=new Cn,this._scrollStrategy=O,this._document=X,null!=B&&B.touchGestures&&(this.touchGestures=B.touchGestures)}get disabled(){return this._disabled}set disabled(e){this._disabled=Ai(e),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=yf(e)}get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=yf(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(e){"string"==typeof this._message&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=e instanceof ls?e:null!=e?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),"string"==typeof this._message&&this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this._message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_preventClickBubbling(e){!this.disabled&&"click"===this.trigger&&e.stopPropagation()}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Do(()=>"hover"===this.trigger),Mr(this._destroyed)).subscribe(e=>{e?"keyboard"===e&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const e=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{e.removeEventListener(i,r,Oz)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),"string"==typeof this._message&&this._ariaDescriber.removeDescription(e,this._message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay){var i,r;if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const a=this._createOverlay();this._detach(),this._portal=this._portal||new Vh(this._tooltipComponent,this._viewContainerRef),this._tooltipInstance=a.attach(this._portal).instance,this._tooltipInstance._triggerElement=this._elementRef.nativeElement,this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay,this.message instanceof ls&&this._ariaDescriber.describe(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._tooltipInstance.afterShown().pipe(Mr(this._destroyed)).subscribe(()=>this.opened.emit(new Nz(this))),this._tooltipInstance.afterHidden().pipe(Mr(this._destroyed)).subscribe(()=>{this.dismissed.emit(new Nz(this)),this._detach()}),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),"click"===this.trigger?(this._tooltipInstance._config={autoFocus:null===(i=this._defaultOptions.autoFocus)||void 0===i||i,restoreFocus:null===(r=this._defaultOptions.restoreFocus)||void 0===r||r},this._tooltipInstance._initializeWithAttachedContent(),this._tooltipInstance._triggeredByClick=!0):(this._tooltipInstance._config=void 0,this._tooltipInstance._triggeredByClick=!1),this._tooltipInstance.show(e)}hide(e=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(e)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){var e;if(this._overlayRef)return this._overlayRef;const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=`${this._cssClassPrefix}-${l2}-`,a=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i).withPositions([{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetY:2},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top",offsetX:5,offsetY:2,panelClass:`${r}left`},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top",offsetX:-5,offsetY:2,panelClass:`${r}right`},{originX:"center",originY:"top",overlayX:"center",overlayY:"bottom",offsetY:-2},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",offsetX:5,offsetY:-2,panelClass:`${r}left`},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",offsetX:-5,offsetY:-2,panelClass:`${r}right`}]);return a.positionChanges.pipe(Mr(this._destroyed)).subscribe(d=>{this._updateCurrentPositionClass(d.connectionPair),this._tooltipInstance&&d.scrollableViewProperties.isOriginOutsideView&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({positionStrategy:a,panelClass:NR(this.tooltipPanelClass).concat(`${this._cssClassPrefix}-${l2}`),scrollStrategy:this._scrollStrategy()}),this._overlayRef.detachments().pipe(Mr(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.keydownEvents().pipe(Mr(this._destroyed)).subscribe(d=>{this._isTooltipVisible()&&27===d.keyCode&&!al(d)&&(d.preventDefault(),d.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._overlayRef.outsidePointerEvents().pipe(Mr(this._destroyed)).subscribe(()=>{var d;return null===(d=this._tooltipInstance)||void 0===d?void 0:d._handleBodyInteraction()}),!(null===(e=this._defaultOptions)||void 0===e)&&e.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&(this.message instanceof ls&&this._tooltipInstance&&this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._tooltipInstance._elementRef.nativeElement),this._overlayRef.detach()),this._tooltipInstance=null}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Ho(1),Mr(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_updateCurrentPositionClass(e){const{overlayY:i,originX:r,originY:a}=e;let d;if(d="center"===i?"start"===r?"left":"right":"bottom"===i&&"top"===a?"above":"below",d!==this._currentPosition){const b=this._overlayRef;if(b){const x=`${this._cssClassPrefix}-${l2}-`;b.removePanelClass(x+this._currentPosition),b.addPanelClass(x+d)}this._currentPosition=d}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||("click"===this.trigger?this._passiveListeners.push(["click",()=>this.show(0)]):this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{var r;const a=i.relatedTarget;(!a||null===(r=this._overlayRef)||void 0===r||!r.overlayElement.contains(a))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,Oz)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(e.clientX,e.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const e=this.touchGestures;if("off"!==e){const i=this._elementRef.nativeElement,r=i.style;("on"===e||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===e||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}}return n.\u0275fac=function(e){bm()},n.\u0275dir=cn({type:n,hostBindings:function(e,i){1&e&&Wt("click",function(a){return i._preventClickBubbling(a)})},inputs:{trigger:["sbbTooltipTrigger","trigger"],disabled:["sbbTooltipDisabled","disabled"],showDelay:["sbbTooltipShowDelay","showDelay"],hideDelay:["sbbTooltipHideDelay","hideDelay"],touchGestures:["sbbTooltipTouchGestures","touchGestures"],message:["sbbTooltip","message"],tooltipClass:["sbbTooltipClass","tooltipClass"],tooltipPanelClass:["sbbTooltipPanelClass","tooltipPanelClass"]},outputs:{opened:"opened",dismissed:"dismissed"}}),n})(),fD=(()=>{class n extends nQ{constructor(e,i,r,a,d,b,x,A,O,B,X){super(e,i,r,a,d,b,x,A,O,B,X),this._tooltipComponent=rQ}}return n.\u0275fac=function(e){return new(e||n)(ue(Gs),ue(ci),ue(UB),ue(Hs),ue(Ui),ue(ga),ue(DB),ue(Cl),ue(Fz),ue(eQ,8),ue(Oi))},n.\u0275dir=cn({type:n,selectors:[["","sbbTooltip",""]],hostVars:3,hostBindings:function(e,i){2&e&&(si("aria-expanded","click"===i.trigger?i._isTooltipVisible():null),_("sbb-tooltip-trigger","click"===i.trigger))},exportAs:["sbbTooltip"],features:[Un]}),n})(),iQ=(()=>{class n{constructor(e,i,r,a,d,b){this._elementRef=e,this._focusTrapFactory=i,this._changeDetectorRef=r,this._focusMonitor=a,this._visibility="initial",this._closeInteractionType=null,this._config={},this._closeOnInteraction=!1,this._elementFocusedBeforeDialogWasOpened=null,this._isVisible=!1,this._onShow=new On,this._onHide=new On,this._triggeredByClick=!1,this._animationsDisabled="NoopAnimations"===b,this._document=d}show(e){clearTimeout(this._hideTimeoutId),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._showTimeoutId=void 0,this._toggleVisibility(!0)},e)}hide(e){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0,this._markForCheck()},e)}afterShown(){return this._onShow}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onShow.complete(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){!this._triggeredByClick&&(!e||!this._triggerElement.contains(e))&&this.hide(this._mouseLeaveHideDelay)}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next(),e&&this.isVisible()&&this._config&&this._trapFocus(),!e&&!this.isVisible()&&this._restoreFocus()}_toggleVisibility(e){const i=this._tooltip.nativeElement,r=this._showAnimation,a=this._hideAnimation;if(i.classList.remove(e?a:r),i.classList.add(e?r:a),this._isVisible=e,e&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const d=getComputedStyle(i);("0s"===d.getPropertyValue("animation-duration")||"none"===d.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}e&&this._onShow.next(),this._animationsDisabled&&(i.classList.add("_sbb-animation-noopable"),this._finalizeAnimation(e))}_trapFocus(){var e;null!==(e=this._config)&&void 0!==e&&e.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){var e;const i=this._elementFocusedBeforeDialogWasOpened;if((null===(e=this._config)||void 0===e?void 0:e.restoreFocus)&&i&&"function"==typeof i.focus){const r=kd(),a=this._elementRef.nativeElement;(!r||r===this._document.body||r===a||a.contains(r))&&(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null)}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=kd())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=kd();return e===i||e.contains(i)}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(kB),ue(So),ue(Cl),ue(Oi,8),ue(Ah,8))},n.\u0275dir=cn({type:n}),n})(),rQ=(()=>{class n extends iQ{constructor(e,i,r,a,d,b,x){super(e,i,r,a,d,x),this._breakpointObserver=b,this._isHandset=this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait), (max-width: 1024.99px) and (orientation: landscape)"),this._showAnimation="sbb-tooltip-container-show",this._hideAnimation="sbb-tooltip-container-hide"}get _templateRef(){return this.message instanceof ls?this.message:null}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(kB),ue(So),ue(Cl),ue(Oi,8),ue($C),ue(Ah,8))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-tooltip-component"]],viewQuery:function(e,i){if(1&e&&mo(HK,7),2&e){let r;xi(r=wi())&&(i._tooltip=r.first)}},hostAttrs:["aria-hidden","true",1,"sbb-tooltip-component"],hostVars:2,hostBindings:function(e,i){1&e&&Wt("mouseleave",function(a){return i._handleMouseLeave(a)}),2&e&&p("zoom",i.isVisible()?1:null)},features:[Un],decls:9,vars:10,consts:[[1,"sbb-tooltip-container",3,"animationend"],["tooltip",""],[1,"sbb-tooltip",3,"ngClass"],[1,"sbb-tooltip-content"],[4,"ngIf","ngIfElse"],["stringMessage",""],["type","button","class","sbb-tooltip-icon sbb-tooltip-close-button sbb-icon-fit sbb-button-reset-frameless",3,"click",4,"ngIf"],[4,"ngTemplateOutlet"],["type","button",1,"sbb-tooltip-icon","sbb-tooltip-close-button","sbb-icon-fit","sbb-button-reset-frameless",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){if(1&e&&(ne(0,"div",0,1),Wt("animationend",function(a){return i._handleAnimationEnd(a)}),Uy(2,"async"),ne(3,"div",2)(4,"div",3),yt(5,GK,2,1,"ng-container",4),yt(6,$K,1,1,"ng-template",null,5,Kp),oe(),yt(8,WK,2,0,"button",6),oe()()),2&e){const r=el(7);let a;_("sbb-tooltip-handset",null==(a=Hy(2,8,i._isHandset))?null:a.matches),pe(3),_("sbb-tooltip-has-close-button",i._triggeredByClick),Pe("ngClass",i.tooltipClass),pe(2),Pe("ngIf",i._templateRef)("ngIfElse",r),pe(3),Pe("ngIf",i._triggeredByClick)}},dependencies:[rf,Zo,Px,cl,kx],styles:['.sbb-tooltip-component{display:block;filter:drop-shadow(0 var(--sbb-box-shadow-width) 0 var(--sbb-box-shadow-color))}.sbb-tooltip-container{height:100%;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);opacity:0}.sbb-tooltip-container._sbb-animation-noopable{animation:none;opacity:1}.sbb-tooltip-container::after,.sbb-tooltip-container::before{top:calc(.5*var(--sbb-border-width));left:0;right:0;margin-left:auto;margin-right:auto;content:"";height:var(--sbb-tooltip-content-arrow-size);width:var(--sbb-tooltip-content-arrow-size);position:absolute;pointer-events:none;transform:rotate(45deg);border:var(--sbb-border-width) solid rgba(0,0,0,0)}.sbb-tooltip-panel-above .sbb-tooltip-container::after,.sbb-tooltip-panel-above .sbb-tooltip-container::before{top:auto;bottom:calc(.5*var(--sbb-tooltip-shadow-arrow-size));transform:rotate(225deg)}.sbb-tooltip-panel-left .sbb-tooltip-container::after,.sbb-tooltip-panel-left .sbb-tooltip-container::before{margin-right:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-panel-right .sbb-tooltip-container::after,.sbb-tooltip-panel-right .sbb-tooltip-container::before{margin-left:var(--sbb-tooltip-arrow-horizontal-space)}.sbb-tooltip-container::before{border-color:var(--sbb-color-weak-accent);z-index:1}.sbb-tooltip-container::after{background-color:var(--sbb-tooltip-background-color);background-clip:padding-box;z-index:2;--sbb-tooltip-arrow-padding-offset: 0rem;clip-path:polygon(0 0, calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)) 0, 0 calc(var(--sbb-tooltip-content-arrow-size) - var(--sbb-tooltip-arrow-padding-offset)))}html.sbb-lean .sbb-tooltip-container::after{--sbb-tooltip-arrow-padding-offset: 0.0666666667rem}.sbb-tooltip-panel-above .sbb-tooltip-container{margin-bottom:calc(0.8rem * var(--sbb-scaling-factor))}@keyframes sbb-tooltip-container-show{0%{opacity:0}100%{opacity:1}}@keyframes sbb-tooltip-container-hide{0%{opacity:1}100%{opacity:0}}.sbb-tooltip-container-show{animation:sbb-tooltip-container-show var(--sbb-transition-duration-fast) cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip-container-hide{animation:sbb-tooltip-container-hide 75ms cubic-bezier(0, 0, 0.2, 1) forwards}.sbb-tooltip{max-width:calc(30.6666666667rem * var(--sbb-scaling-factor));padding:var(--sbb-tooltip-padding);position:relative;overflow:hidden;color:var(--sbb-color-granite);text-overflow:ellipsis;background-color:var(--sbb-tooltip-background-color);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);z-index:2}.cdk-high-contrast-active .sbb-tooltip{outline:solid 1px}.sbb-tooltip-panel-below .sbb-tooltip{margin-top:var(--sbb-tooltip-arrow-offset)}:where(html.sbb-lean) .sbb-tooltip{color:var(--sbb-color-text)}.sbb-tooltip-zero-padding{--sbb-tooltip-padding: 0}.sbb-tooltip-has-close-button{padding-right:calc(4.7333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-tooltip-has-close-button{padding-right:3.2rem}.sbb-tooltip-zero-padding .sbb-tooltip-has-close-button{padding-right:0}.sbb-tooltip-close-button{color:var(--sbb-color-weak-accent);position:absolute;width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);top:var(--sbb-tooltip-padding);right:var(--sbb-tooltip-padding);line-height:0}:where(html:not(.sbb-lean)) .sbb-tooltip-close-button{border:var(--sbb-border-width-thin) solid var(--sbb-color-storm);border-radius:50%}.sbb-tooltip-panel-non-interactive{pointer-events:none}'],encapsulation:2,changeDetection:0}),n})();const oQ=Zl(class{});let sQ=1,Bz=(()=>{class n extends oQ{constructor(){super(...arguments),this.id="sbb-tooltip-id-"+sQ++,this.trigger="click",this._destroyed=new On,this.svgIcon="kom:circle-question-mark-small",this.opened=new Cn,this.dismissed=new Cn}get hoverShowDelay(){return this._hoverShowDelay}set hoverShowDelay(e){this._hoverShowDelay=yf(e,0)}get hoverHideDelay(){return this._hoverHideDelay}set hoverHideDelay(e){this._hoverHideDelay=yf(e,0)}ngOnInit(){this._tooltip.opened.pipe(Mr(this._destroyed)).subscribe(e=>this.opened.emit(e)),this._tooltip.dismissed.pipe(Mr(this._destroyed)).subscribe(e=>this.dismissed.emit(e))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}show(){this._tooltip.show(0)}hide(){this._tooltip.hide(0)}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275cmp=Jt({type:n,selectors:[["sbb-tooltip"]],viewQuery:function(e,i){if(1&e&&mo(fD,7),2&e){let r;xi(r=wi())&&(i._tooltip=r.first)}},hostAttrs:[1,"sbb-tooltip-wrapper"],hostVars:2,hostBindings:function(e,i){2&e&&si("id",i.id)("aria-expanded",i._tooltip._isTooltipVisible())},inputs:{disabled:"disabled",id:"id",trigger:"trigger",hoverShowDelay:"hoverShowDelay",hoverHideDelay:"hoverHideDelay",svgIcon:"svgIcon",sbbTooltipClass:"sbbTooltipClass",sbbTooltipPanelClass:"sbbTooltipPanelClass"},outputs:{opened:"opened",dismissed:"dismissed"},features:[Un],ngContentSelectors:ZK,decls:5,vars:9,consts:[["type","button",1,"sbb-tooltip-icon","sbb-tooltip-trigger","sbb-icon-scaled","sbb-button-reset-frameless",3,"sbbTooltip","sbbTooltipTrigger","sbbTooltipShowDelay","sbbTooltipHideDelay","sbbTooltipClass","sbbTooltipPanelClass","click"],["tooltip","sbbTooltip"],[3,"svgIcon"],["tooltipTemplate",""]],template:function(e,i){if(1&e){const r=or();Rs(),ne(0,"button",0,1),Wt("click",function(){return Qn(r),ei(el(1).show(0))}),rn(2,"sbb-icon",2),oe(),yt(3,XK,1,0,"ng-template",null,3,Kp)}if(2&e){const r=el(1),a=el(4);_("sbb-tooltip-trigger-active",r._isTooltipVisible()),Pe("sbbTooltip",a)("sbbTooltipTrigger",i.trigger)("sbbTooltipShowDelay",i.hoverShowDelay)("sbbTooltipHideDelay",i.hoverHideDelay)("sbbTooltipClass",i.sbbTooltipClass)("sbbTooltipPanelClass",i.sbbTooltipPanelClass),pe(2),Pe("svgIcon",i.svgIcon)}},dependencies:[cl,fD],encapsulation:2,changeDetection:0}),n})(),zz=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[QK],imports:[G_,go,Tc,ll,Ur,Ss,$_]}),n})();function aQ(n,t){1&n&&Wo(0)}function lQ(n,t){if(1&n&&(ne(0,"div")(1,"span")(2,"del"),Z(3),oe()(),ne(4,"span",14)(5,"del"),Z(6),oe()()()),2&n){const e=St().$implicit;pe(3),de(e.arrText),pe(3),de(e.arrDelayText)}}function cQ(n,t){if(1&n&&(ne(0,"div")(1,"span"),Z(2),oe(),ne(3,"span",14),Z(4),oe()()),2&n){const e=St().$implicit;pe(2),de(e.arrText),pe(2),de(e.arrDelayText)}}function uQ(n,t){if(1&n&&(ne(0,"div")(1,"span")(2,"del"),Z(3),oe()(),ne(4,"span",14)(5,"del"),Z(6),oe()()()),2&n){const e=St().$implicit;pe(3),de(e.depText),pe(3),de(e.depDelayText)}}function dQ(n,t){if(1&n&&(ne(0,"div")(1,"span"),Z(2),oe(),ne(3,"span",14),Z(4),oe()()),2&n){const e=St().$implicit;pe(2),de(e.depText),pe(2),de(e.depDelayText)}}function hQ(n,t){1&n&&(ne(0,"span",15),Z(1,"not serviced"),oe())}function pQ(n,t){if(1&n&&(ne(0,"div")(1,"div"),Z(2),oe()()),2&n){const e=St(2).$implicit;pe(2),De("Pl. ",e.platformText,"")}}function fQ(n,t){if(1&n&&(ne(0,"div")(1,"div"),Z(2,"Pl. "),ne(3,"del"),Z(4),oe(),ne(5,"span",14),Z(6),oe()()()),2&n){const e=St(2).$implicit;pe(4),De(" ",e.platformText,""),pe(2),De(" ",e.actualPlatformText,"")}}function mQ(n,t){if(1&n&&(ne(0,"div",16),yt(1,pQ,3,1,"div",7),yt(2,fQ,7,2,"div",7),oe()),2&n){const e=St().$implicit;pe(1),Pe("ngIf",null===e.actualPlatformText),pe(1),Pe("ngIf",null!==e.actualPlatformText)}}function gQ(n,t){if(1&n&&(ne(0,"div"),rn(1,"img",17),oe()),2&n){const e=St().$implicit;pe(1),Ir("src",e.platformAssistanceIconPath,zo),Ir("sbbTooltip",e.platformAssistanceTooltip)}}function _Q(n,t){if(1&n){const e=or();ne(0,"tr",5),Wt("click",function(){const a=Qn(e).$implicit;return ei(St(2).zoomToLocation(a))}),ne(1,"td",6),yt(2,lQ,7,2,"div",7),yt(3,cQ,5,2,"div",7),oe(),ne(4,"td",6),yt(5,uQ,7,2,"div",7),yt(6,dQ,5,2,"div",7),oe(),ne(7,"td",8)(8,"div",9),Z(9),yt(10,hQ,2,0,"span",10),oe(),yt(11,mQ,3,2,"div",11),yt(12,gQ,2,2,"div",7),oe(),ne(13,"td",12)(14,"input",13),Wt("change",function(){const a=Qn(e).index;return ei(St(2).onRouteEndPointSelected(a))}),oe()()()}if(2&n){const e=t.$implicit,i=t.index,r=St(2);pe(2),Pe("ngIf",e.isNotServicedStop),pe(1),Pe("ngIf",!e.isNotServicedStop),pe(2),Pe("ngIf",e.isNotServicedStop),pe(1),Pe("ngIf",!e.isNotServicedStop),pe(3),De("",e.locationText," "),pe(1),Pe("ngIf",e.isNotServicedStop),pe(1),Pe("ngIf",null!==e.platformText),pe(1),Pe("ngIf",null!==e.platformAssistanceIconPath),pe(2),Pe("checked",r.selectedEndpointsIDx.includes(i))}}function bQ(n,t){if(1&n&&(ne(0,"table",2)(1,"thead")(2,"tr")(3,"th",3),Z(4,"Arr"),oe(),ne(5,"th",3),Z(6,"Dep"),oe(),ne(7,"th",3),Z(8,"Stop"),oe(),ne(9,"th",3),Z(10,"Route"),oe()()(),ne(11,"tbody"),yt(12,_Q,15,9,"tr",4),oe()()),2&n){const e=St();pe(12),Pe("ngForOf",e.stopPointsData)}}let yQ=(()=>{class n{constructor(){this.stopPointsData=[],this.locationSelected=new Cn,this.onExampleTripLocationsUpdated=new Cn,this.selectedEndpointsIDx=[]}ngOnInit(){this.selectedEndpointsIDx=[0,this.stopPointsData.length-1]}ngAfterViewInit(){this.emitSelectedEndpoints()}zoomToLocation(e){this.locationSelected.emit(e)}emitSelectedEndpoints(){this.stopPointsData.length<2||this.onExampleTripLocationsUpdated.emit(this.selectedEndpointsIDx)}onRouteEndPointSelected(e){2==this.selectedEndpointsIDx.length&&(this.selectedEndpointsIDx.push(e),this.selectedEndpointsIDx=this.selectedEndpointsIDx.slice(-2),this.emitSelectedEndpoints())}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Jt({type:n,selectors:[["service-stops"]],inputs:{stopPointsData:"stopPointsData"},outputs:{locationSelected:"locationSelected",onExampleTripLocationsUpdated:"onExampleTripLocationsUpdated"},decls:3,vars:1,consts:[[4,"ngTemplateOutlet"],["variant2",""],[1,"table","table-hover","mb-0"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"fit","stop-time","align-middle"],[4,"ngIf"],[1,"stop-info","d-flex","gap-2","align-items-center"],[1,"flex-grow-1"],["class","badge rounded-pill bg-danger fw-bolder",4,"ngIf"],["class","d-flex gap-2",4,"ngIf"],[1,"text-center"],["type","radio",1,"form-check-input",3,"checked","change"],[1,"time-delay"],[1,"badge","rounded-pill","bg-danger","fw-bolder"],[1,"d-flex","gap-2"],[1,"leg-platform-assistance",3,"src","sbbTooltip"]],template:function(e,i){1&e&&(yt(0,aQ,1,0,"ng-container",0),yt(1,bQ,13,1,"ng-template",null,1,Kp)),2&e&&Pe("ngTemplateOutlet",el(2))},dependencies:[Sl,Zo,Px,fD],styles:[".table[_ngcontent-%COMP%]   td.fit[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th.fit[_ngcontent-%COMP%]{white-space:nowrap;width:1%}.time-departure[_ngcontent-%COMP%]{font-weight:700;font-size:16px}.stop-info[_ngcontent-%COMP%]{font-size:16px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}.leg-platform-assistance[_ngcontent-%COMP%]{width:30px}"]}),n})();function vQ(n,t){if(1&n&&(ji(0),ne(1,"div"),Z(2," - "),ne(3,"a",9),Z(4,"Train Formation"),oe()(),Zi()),2&n){const e=St(2);pe(3),Pe("href",e.model.trainFormationURL,zo)}}function xQ(n,t){if(1&n){const e=or();ne(0,"div")(1,"div",1)(2,"div",2)(3,"div"),rn(4,"img",3),oe(),ne(5,"div",4),Z(6),oe(),ne(7,"div",5),Z(8),oe(),ne(9,"div",6),Z(10),oe(),yt(11,vQ,5,1,"ng-container",0),oe(),ne(12,"h2",7),Z(13),oe(),ne(14,"div"),Z(15),oe(),ne(16,"div",8),Z(17,"Example Trip: "),ne(18,"a",9),Z(19),oe()(),ne(20,"div",10)(21,"service-stops",11),Wt("locationSelected",function(r){return Qn(e),ei(St().onLocationSelected(r))})("onExampleTripLocationsUpdated",function(r){return Qn(e),ei(St().onExampleTripLocationsUpdated(r))}),oe()(),ne(22,"div",8),Z(23,"Permalink: "),ne(24,"a",9),Z(25),oe()()()()}if(2&n){const e=St();pe(4),Ir("src",e.model.serviceIconPath,zo),pe(2),de(e.model.serviceLineText),pe(2),de(e.model.serviceTripId),pe(2),De("(",e.model.serviceOperator,")"),pe(1),Pe("ngIf",e.model.trainFormationURL),pe(2),Be("",e.model.serviceFromText," \u2192 ",e.model.serviceToText,""),pe(2),De("Day: ",e.model.operatingDayRef,""),pe(3),Pe("href",e.model.journeyExampleURL,zo),pe(1),de(e.model.journeyExampleCaption),pe(2),Pe("stopPointsData",e.model.stopPointsData),pe(3),Pe("href",e.model.permalinkURL,zo),pe(1),de(e.model.journeyRef)}}let Vz=(()=>{class n{constructor(e,i,r){this.tripInfoService=e,this.userTripService=i,this.cdr=r,this.model={},this.model.tripInfoResult=null,this.model.stopPointsData=[]}ngOnInit(){this.tripInfoService.tripInfoResultUpdated.subscribe(e=>{this.updatePageModel(e)})}ngAfterViewInit(){}updatePageModel(e){var i,r,a,d;if(this.model.tripInfoResult=e,null===e)return;const b=null!==(i=e.service)&&void 0!==i?i:null;if(null===b||e.calls.length<2)return;const x=Yl.initWithDatedJourneySchema(b);this.model.journeyRef=b.journeyRef,this.model.operatingDayRef=null!==(r=b.operatingDayRef)&&void 0!==r?r:"n/a (serviceDay)",this.model.serviceFromText=e.calls[0].stopPointName,this.model.serviceToText=e.calls[e.calls.length-1].stopPointName,this.model.serviceLineText=x.formatServiceLineName(),this.model.serviceTripId=null!==(a=b.trainNumber)&&void 0!==a?a:"n/a (journeyNumber)",this.model.serviceOperator=null!==(d=b.operatorRef)&&void 0!==d?d:"n/a (operatorRef)";const B=no.computeIconFilenameForService(b);this.model.serviceIconPath="assets/pictograms/"+B+".png",this.model.stopPointsData=(()=>{const X=[];return e.calls.forEach(te=>{const se={locationText:te.stopPointName};no.updateLocationDataWithTime(se,te),se.platformAssistanceIconPath=no.computePlatformAssistanceIconPath(te.vehicleAccessType),se.platformAssistanceTooltip=no.computePlatformAssistanceTooltip(te.vehicleAccessType),X.push(se)}),X})(),this.model.trainFormationURL=x.computeFormationServiceURL()}onLocationSelected(e){this.tripInfoService.locationSelected.emit(e)}onExampleTripLocationsUpdated(e){if(null===this.model.tripInfoResult)return;if(2!=e.length)return console.error("ERROR: expected 2 items only"),void console.log(e);(e=e.slice()).sort((O,B)=>O-B);const i=this.model.tripInfoResult.calls,r=i[e[0]],a=i[e[1]],d=new URLSearchParams;d.set("from",r.stopPointRef),d.set("to",a.stopPointRef),this.userTripService.currentAppStage!==fC&&d.set("stage",this.userTripService.currentAppStage);const b=r.departure.timetable;if(b){const O=bn.DateHelpers.formatDate(b);d.append("trip_datetime",O.substring(0,16))}d.set("do_search","yes"),this.model.journeyExampleURL="./search?"+d.toString(),this.model.journeyExampleCaption=r.stopPointName+" -> "+a.stopPointName,this.updateURLs(),this.cdr.detectChanges()}updateURLs(){this.model.permalinkURL="./trip?ref="+this.model.journeyRef+"&stage="+this.userTripService.currentAppStage}}return n.\u0275fac=function(e){return new(e||n)(ue(pD),ue(ia),ue(So))},n.\u0275cmp=Jt({type:n,selectors:[["trip-info-result"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"px-3"],[1,"d-flex","align-items-center","gap-2","mt-3"],[1,"leg-icon",3,"src"],[1,"service-line-number"],[1,"service-trip-id"],[1,"service-operator"],[1,"mt-3"],[1,"mt-3","mb-2"],["target","_blank",3,"href"],[1,"p-1"],[3,"stopPointsData","locationSelected","onExampleTripLocationsUpdated"]],template:function(e,i){1&e&&yt(0,xQ,26,13,"div",0),2&e&&Pe("ngIf",null!==i.model.tripInfoResult)},dependencies:[Zo,yQ],styles:[".leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.service-line-number[_ngcontent-%COMP%]{font-size:20px;font-weight:700}"]}),n})();function wQ(n,t){1&n&&(ne(0,"div",6)(1,"div",7)(2,"span",8),Z(3,"Loading..."),oe()(),ne(4,"div"),Z(5,"fetching OJP TripInfoRequest ..."),oe()())}function SQ(n,t){if(1&n&&(ne(0,"div",9),Z(1),oe()),2&n){const e=St();pe(1),De(" ",e.model.errorMessage," ")}}let jz=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.tripInfoService=i,this.languageService=r,this.model={},this.model.title="TripInfoResult",this.model.errorMessage=null,this.model.isFetching=!1}fetchJourneyRef(e,i){var r=this;return mr(function*(){r.model.title="JourneyRef: "+e;const a=VC.initWithJourneyRef(e,i);a.enableTrackProjection();const d=r.createOJP_SDK_Instance();r.model.isFetching=!0;const b=yield d.fetchTripInfoRequestResponse(a);if(r.model.isFetching=!1,b.ok){const x=j1.initWithTripInfoDeliverySchema(b.value);r.tripInfoService.tripInfoResultUpdated.emit(x)}else console.error("fetchJourneyRef - error"),console.log(e),console.log(b),r.model.errorMessage="ERROR while fetching the TripInfoRequest, check console for more details.",r.tripInfoService.tripInfoResultUpdated.emit(null)})()}createOJP_SDK_Instance(){const e=this.userTripService.getStageConfig();return new M1(Ps,e,this.languageService.language,"2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1)}}return n.\u0275fac=function(e){return new(e||n)(ue(ia),ue(pD),ue($u))},n.\u0275cmp=Jt({type:n,selectors:[["trip-info-result-popover"]],decls:10,vars:3,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],["class","p-2 d-flex gap-2",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],[1,"p-2","d-flex","gap-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"],["role","alert",1,"alert","alert-danger"]],template:function(e,i){1&e&&(ne(0,"div",0),Z(1),oe(),ne(2,"div",1)(3,"div"),yt(4,wQ,6,0,"div",2),yt(5,SQ,2,1,"div",3),rn(6,"trip-info-result"),oe()(),ne(7,"div",4)(8,"button",5),Z(9," Close "),oe()()),2&e&&(pe(1),de(i.model.title),pe(3),Pe("ngIf",i.model.isFetching),pe(1),Pe("ngIf",i.model.errorMessage))},dependencies:[Zo,vf,Km,Qm,eg,Vz],encapsulation:2}),n})(),TQ=(()=>{class n{onClick(e){e.stopPropagation()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["","stopClickPropagation",""]],hostBindings:function(e,i){1&e&&Wt("click",function(a){return i.onClick(a)})}}),n})();function CQ(n,t){1&n&&(ne(0,"div")(1,"span",17),Z(2,"Cancelled"),oe()())}function DQ(n,t){1&n&&(ne(0,"div")(1,"span",18),Z(2,"Deviation"),oe()())}function EQ(n,t){1&n&&(ne(0,"div")(1,"span",18),Z(2,"Unplanned"),oe()())}function IQ(n,t){1&n&&(ji(0),ne(1,"div"),Z(2,"\u2022"),oe(),Zi())}function MQ(n,t){if(1&n){const e=or();ji(0),ne(1,"div",20)(2,"input",21),Wt("change",function(r){return Qn(e),ei(St(2).redrawTripLeg(r))}),oe(),ne(3,"label",22),Z(4,"LinkProjection"),oe()(),yt(5,IQ,3,0,"ng-container",4),Zi()}if(2&n){const e=St(2);pe(2),Pe("id",e.checkboxId)("name",e.checkboxId)("checked",e.isForceLinkProjection),pe(1),Pe("for",e.checkboxId),pe(2),Pe("ngIf",e.enableTRR)}}function AQ(n,t){if(1&n){const e=or();ji(0),ne(1,"div",24),Wt("click",function(){return Qn(e),ei(St(3).loadTRR_Popover())}),Z(2,"XML"),oe(),Zi()}}function RQ(n,t){if(1&n){const e=or();ji(0),ne(1,"div",19)(2,"div",23),Wt("click",function(){return Qn(e),ei(St(2).reloadTripLeg())}),Z(3,"Refresh"),oe(),yt(4,AQ,3,0,"ng-container",4),oe(),Zi()}if(2&n){const e=St(2);pe(4),Pe("ngIf",null==e.trrRequestInfo?null:e.trrRequestInfo.responseXML)}}function PQ(n,t){if(1&n&&(ne(0,"div",19),yt(1,MQ,6,5,"ng-container",4),yt(2,RQ,5,1,"ng-container",4),oe()),2&n){const e=St();pe(1),Pe("ngIf","TimedLeg"===(null==e.legData||null==e.legData.leg?null:e.legData.leg.legType)),pe(1),Pe("ngIf",e.enableTRR)}}function kQ(n,t){1&n&&Wo(0)}function LQ(n,t){1&n&&Wo(0)}function OQ(n,t){1&n&&Wo(0)}function FQ(n,t){if(1&n&&(ji(0),rn(1,"hr"),ne(2,"div"),Z(3,"Note: "),ne(4,"span"),Z(5),oe()(),Zi()),2&n){const e=St();pe(5),de(null==e.legData||null==e.legData.info?null:e.legData.info.comments)}}function NQ(n,t){if(1&n&&(ne(0,"div")(1,"div"),Z(2),oe()()),2&n){const e=St(3);pe(2),De(", Pl. ",e.legInfoDataModel.fromLocationData.platformText,"")}}function BQ(n,t){if(1&n&&(ne(0,"div")(1,"div"),Z(2,", Pl. "),ne(3,"del"),Z(4),oe(),ne(5,"span",30),Z(6),oe()()()),2&n){const e=St(3);pe(4),De(" ",e.legInfoDataModel.fromLocationData.platformText,""),pe(2),De(" ",e.legInfoDataModel.fromLocationData.actualPlatformText,"")}}function zQ(n,t){if(1&n&&(ne(0,"div"),yt(1,NQ,3,1,"div",4),yt(2,BQ,7,2,"div",4),oe()),2&n){const e=St(2);pe(1),Pe("ngIf",!e.legInfoDataModel.fromLocationData.actualPlatformText),pe(1),Pe("ngIf",e.legInfoDataModel.fromLocationData.actualPlatformText)}}function VQ(n,t){1&n&&(ne(0,"div")(1,"span",17),Z(2,"not serviced"),oe()())}function jQ(n,t){if(1&n&&(ji(0),ne(1,"div"),Z(2,"1."),oe(),ne(3,"div",35),rn(4,"sbb-icon",36),oe(),Zi()),2&n){const e=St(2);pe(4),Ir("svgIcon",e.legInfoDataModel.fromLocationData.occupancy.firstClassIcon),Ir("sbbTooltip",e.legInfoDataModel.fromLocationData.occupancy.firstClassText)}}function UQ(n,t){if(1&n&&(ji(0),ne(1,"div"),Z(2,"2."),oe(),ne(3,"div",35),rn(4,"sbb-icon",36),oe(),Zi()),2&n){const e=St(2);pe(4),Ir("svgIcon",e.legInfoDataModel.fromLocationData.occupancy.secondClassIcon),Ir("sbbTooltip",e.legInfoDataModel.fromLocationData.occupancy.secondClassText)}}function HQ(n,t){if(1&n&&(ji(0),rn(1,"img",37),Zi()),2&n){const e=St(2);pe(1),Ir("src",e.legInfoDataModel.fromLocationData.platformAssistanceIconPath,zo),Ir("sbbTooltip",e.legInfoDataModel.fromLocationData.platformAssistanceTooltip)}}function qQ(n,t){if(1&n&&(ne(0,"div"),Z(1),oe()),2&n){const e=St(2);pe(1),de(e.legInfoDataModel.fromLocationData.depText)}}function GQ(n,t){if(1&n&&(ne(0,"div")(1,"del"),Z(2),oe()()),2&n){const e=St(2);pe(2),de(e.legInfoDataModel.fromLocationData.depText)}}function $Q(n,t){1&n&&Wo(0)}function WQ(n,t){if(1&n&&(ne(0,"div")(1,"div"),Z(2),oe()()),2&n){const e=St(3);pe(2),De(", Pl. ",e.legInfoDataModel.toLocationData.platformText,"")}}function XQ(n,t){if(1&n&&(ne(0,"div")(1,"div"),Z(2,", Pl. "),ne(3,"del"),Z(4),oe(),ne(5,"span",30),Z(6),oe()()()),2&n){const e=St(3);pe(4),De(" ",e.legInfoDataModel.toLocationData.platformText,""),pe(2),De(" ",e.legInfoDataModel.toLocationData.actualPlatformText,"")}}function ZQ(n,t){if(1&n&&(ne(0,"div"),yt(1,WQ,3,1,"div",4),yt(2,XQ,7,2,"div",4),oe()),2&n){const e=St(2);pe(1),Pe("ngIf",!e.legInfoDataModel.toLocationData.actualPlatformText),pe(1),Pe("ngIf",e.legInfoDataModel.toLocationData.actualPlatformText)}}function YQ(n,t){1&n&&(ne(0,"div")(1,"span",17),Z(2,"not serviced"),oe()())}function JQ(n,t){if(1&n&&(ji(0),ne(1,"div"),Z(2,"1."),oe(),ne(3,"div",35),rn(4,"sbb-icon",36),oe(),Zi()),2&n){const e=St(2);pe(4),Ir("svgIcon",e.legInfoDataModel.toLocationData.occupancy.firstClassIcon),Ir("sbbTooltip",e.legInfoDataModel.toLocationData.occupancy.firstClassText)}}function KQ(n,t){if(1&n&&(ji(0),ne(1,"div"),Z(2,"2."),oe(),ne(3,"div",35),rn(4,"sbb-icon",36),oe(),Zi()),2&n){const e=St(2);pe(4),Ir("svgIcon",e.legInfoDataModel.toLocationData.occupancy.secondClassIcon),Ir("sbbTooltip",e.legInfoDataModel.toLocationData.occupancy.secondClassText)}}function QQ(n,t){if(1&n&&(ji(0),rn(1,"img",37),Zi()),2&n){const e=St(2);pe(1),Ir("src",e.legInfoDataModel.toLocationData.platformAssistanceIconPath,zo),Ir("sbbTooltip",e.legInfoDataModel.toLocationData.platformAssistanceTooltip)}}function eee(n,t){if(1&n&&(ne(0,"div"),Z(1),oe()),2&n){const e=St(2);pe(1),de(e.legInfoDataModel.toLocationData.arrText)}}function tee(n,t){if(1&n&&(ne(0,"div")(1,"del"),Z(2),oe()()),2&n){const e=St(2);pe(2),de(e.legInfoDataModel.toLocationData.arrText)}}function nee(n,t){if(1&n){const e=or();ne(0,"div",25)(1,"div",26),Wt("click",function(){return Qn(e),ei(St().zoomToEndpoint("From"))}),ne(2,"div",27)(3,"div"),Z(4),oe(),yt(5,zQ,3,2,"div",4),oe(),yt(6,VQ,3,0,"div",4),oe(),ne(7,"div",28)(8,"div",29)(9,"div",19),yt(10,jQ,5,2,"ng-container",4),yt(11,UQ,5,2,"ng-container",4),yt(12,HQ,2,2,"ng-container",4),oe(),yt(13,qQ,2,1,"div",4),yt(14,GQ,3,1,"div",4),ne(15,"div",30),Z(16),oe()()()(),ne(17,"div",31)(18,"div",32),rn(19,"div",33),oe(),yt(20,$Q,1,0,"ng-container",34),ne(21,"div",32),rn(22,"div",33),oe()(),ne(23,"div",25)(24,"div",26),Wt("click",function(){return Qn(e),ei(St().zoomToEndpoint("To"))}),ne(25,"div",27)(26,"div"),Z(27),oe(),yt(28,ZQ,3,2,"div",4),oe(),yt(29,YQ,3,0,"div",4),oe(),ne(30,"div",28)(31,"div",29)(32,"div",19),yt(33,JQ,5,2,"ng-container",4),yt(34,KQ,5,2,"ng-container",4),yt(35,QQ,2,2,"ng-container",4),oe(),yt(36,eee,2,1,"div",4),yt(37,tee,3,1,"div",4),ne(38,"div",30),Z(39),oe()()()()}if(2&n){const e=St(),i=el(29);pe(4),de(e.legInfoDataModel.fromLocationData.locationText),pe(1),Pe("ngIf",e.legInfoDataModel.fromLocationData.platformText),pe(1),Pe("ngIf",e.legInfoDataModel.fromLocationData.isNotServicedStop),pe(4),Pe("ngIf",e.legInfoDataModel.fromLocationData.occupancy.firstClassIcon),pe(1),Pe("ngIf",e.legInfoDataModel.fromLocationData.occupancy.secondClassIcon),pe(1),Pe("ngIf",null!==e.legInfoDataModel.fromLocationData.platformAssistanceIconPath),pe(1),Pe("ngIf",!e.legInfoDataModel.fromLocationData.isNotServicedStop),pe(1),Pe("ngIf",e.legInfoDataModel.fromLocationData.isNotServicedStop),pe(2),de(e.legInfoDataModel.fromLocationData.depDelayText),pe(4),Pe("ngTemplateOutlet",i),pe(7),de(e.legInfoDataModel.toLocationData.locationText),pe(1),Pe("ngIf",e.legInfoDataModel.toLocationData.platformText),pe(1),Pe("ngIf",e.legInfoDataModel.toLocationData.isNotServicedStop),pe(4),Pe("ngIf",e.legInfoDataModel.toLocationData.occupancy.firstClassIcon),pe(1),Pe("ngIf",e.legInfoDataModel.toLocationData.occupancy.secondClassIcon),pe(1),Pe("ngIf",null!==e.legInfoDataModel.toLocationData.platformAssistanceIconPath),pe(1),Pe("ngIf",!e.legInfoDataModel.toLocationData.isNotServicedStop),pe(1),Pe("ngIf",e.legInfoDataModel.toLocationData.isNotServicedStop),pe(2),de(e.legInfoDataModel.toLocationData.arrDelayText)}}function iee(n,t){if(1&n&&(ji(0),ne(1,"div",53),Z(2),oe(),Zi()),2&n){const e=St().$implicit;pe(2),de(e.streetName)}}function ree(n,t){if(1&n){const e=or();ji(0),ne(1,"tr",50),Wt("click",function(){const a=Qn(e).index;return ei(St(3).zoomToGuidanceSection(a))}),ne(2,"td",51),Z(3),oe(),ne(4,"td",52)(5,"div"),Z(6),oe(),yt(7,iee,3,1,"ng-container",4),oe(),ne(8,"td",51),Z(9),oe(),ne(10,"td",51),Z(11),oe()(),Zi()}if(2&n){const e=t.$implicit,i=t.index;pe(3),Be("",i+1,". ",e.advice,""),pe(3),de(e.turnDescription),pe(1),Pe("ngIf",""!==e.streetName),pe(2),de(e.lengthF),pe(2),de(e.durationF)}}function oee(n,t){if(1&n&&(ne(0,"div",42)(1,"div")(2,"button",43),Z(3),rn(4,"i",44)(5,"i",45),oe()(),ne(6,"div",46)(7,"table",47)(8,"thead")(9,"tr")(10,"th",48),Z(11,"Advice"),oe(),ne(12,"th",48),Z(13,"Description"),oe(),ne(14,"th",48),Z(15,"Length"),oe(),ne(16,"th",48),Z(17,"Duration"),oe()()(),ne(18,"tbody"),yt(19,ree,12,6,"ng-container",49),oe()()()()),2&n){const e=St(2);pe(2),si("data-bs-target","#"+e.legElementId)("aria-controls",e.legElementId),pe(1),De(" ",e.legInfoDataModel.guidanceRows.length," steps "),pe(3),Pe("id",e.legElementId),pe(13),Pe("ngForOf",e.legInfoDataModel.guidanceRows)}}function see(n,t){1&n&&(ne(0,"div"),rn(1,"div",54),oe())}function aee(n,t){if(1&n){const e=or();ne(0,"div",25)(1,"div",38)(2,"div",39)(3,"div",40),Wt("click",function(){return Qn(e),ei(St().zoomToEndpoint("From"))}),Z(4),oe(),yt(5,oee,20,5,"div",41),yt(6,see,2,0,"div",4),ne(7,"div",40),Wt("click",function(){return Qn(e),ei(St().zoomToEndpoint("To"))}),Z(8),oe()()(),ne(9,"div",28)(10,"div"),Z(11),oe()()()}if(2&n){const e=St();pe(4),de(e.legInfoDataModel.fromLocationData.locationText),pe(1),Pe("ngIf",e.legInfoDataModel.guidanceRows.length>0),pe(1),Pe("ngIf",0===e.legInfoDataModel.guidanceRows.length),pe(2),de(e.legInfoDataModel.toLocationData.locationText),pe(3),de(e.legInfoDataModel.durationText)}}function lee(n,t){if(1&n&&(ne(0,"li"),Z(1," Book on "),ne(2,"a",56),Z(3),oe()()),2&n){const e=t.$implicit;pe(2),Ir("href",e.infoURL,zo),pe(1),de(e.agencyName)}}function cee(n,t){if(1&n){const e=or();ne(0,"div",25)(1,"div",38)(2,"div",39)(3,"div",40),Wt("click",function(){return Qn(e),ei(St().zoomToEndpoint("From"))}),Z(4),oe(),ne(5,"ul",55),yt(6,lee,4,2,"li",49),oe(),ne(7,"div",40),Wt("click",function(){return Qn(e),ei(St().zoomToEndpoint("To"))}),Z(8),oe()()(),ne(9,"div",28)(10,"div"),Z(11),oe()()()}if(2&n){const e=St();pe(4),de(e.legInfoDataModel.fromLocationData.locationText),pe(2),Pe("ngForOf",e.legInfoDataModel.bookingArrangements),pe(2),de(e.legInfoDataModel.toLocationData.locationText),pe(3),de(e.legInfoDataModel.durationText)}}function uee(n,t){if(1&n&&(ji(0),Z(1," - "),ne(2,"a",56),Z(3,"Train Formation"),oe(),Zi()),2&n){const e=St(2);pe(2),Pe("href",e.legInfoDataModel.serviceFormationURL,zo)}}function dee(n,t){if(1&n&&(ji(0),ne(1,"div"),Z(2),oe(),ne(3,"span",66),Z(4),oe(),Zi()),2&n){const e=St(3);pe(2),De("",null==e.legInfoDataModel.servicePtMode||null==e.legInfoDataModel.servicePtMode.subMode?null:e.legInfoDataModel.servicePtMode.subMode.key," = "),pe(2),de(null==e.legInfoDataModel.servicePtMode||null==e.legInfoDataModel.servicePtMode.subMode?null:e.legInfoDataModel.servicePtMode.subMode.value)}}function hee(n,t){if(1&n&&(ne(0,"div",65)(1,"span",66),Z(2),oe(),yt(3,dee,5,2,"ng-container",4),oe()),2&n){const e=St(2);pe(2),de(null==e.legInfoDataModel.servicePtMode?null:e.legInfoDataModel.servicePtMode.ptMode),pe(1),Pe("ngIf",null!==(null==e.legInfoDataModel.servicePtMode?null:e.legInfoDataModel.servicePtMode.subMode))}}function pee(n,t){if(1&n&&(ne(0,"div")(1,"button",43),Z(2),rn(3,"i",44)(4,"i",45),oe()()),2&n){const e=St(2);pe(1),si("data-bs-target","#"+e.legElementId)("aria-controls",e.legElementId),pe(1),De(" ",e.legInfoDataModel.serviceIntermediaryStopsText," ")}}function fee(n,t){if(1&n&&(ne(0,"div",67)(1,"sbb-tooltip",68)(2,"div"),Z(3),oe()()()),2&n){const e=t.$implicit;pe(1),Ir("svgIcon",e.icon),pe(2),De(" ",e.caption," ")}}function mee(n,t){if(1&n&&(ji(0),ne(1,"div"),Z(2),oe(),Zi()),2&n){const e=St().$implicit;pe(2),De(" ",e.descriptions[0]," ")}}function gee(n,t){if(1&n&&(ne(0,"li"),Z(1),oe()),2&n){const e=t.$implicit;pe(1),De(" ",e," ")}}function _ee(n,t){if(1&n&&(ji(0),ne(1,"ul",72),yt(2,gee,2,1,"li",49),oe(),ne(3,"h6"),Z(4,"Detail"),oe(),Zi()),2&n){const e=St().$implicit;pe(2),Pe("ngForOf",e.descriptions)}}function bee(n,t){if(1&n&&(ne(0,"li"),rn(1,"div",73),oe()),2&n){const e=t.$implicit;pe(1),Pe("innerHTML",e,$b)}}function yee(n,t){if(1&n&&(ne(0,"div")(1,"sbb-tooltip",71)(2,"p")(3,"strong"),Z(4),oe()(),yt(5,mee,3,1,"ng-container",4),yt(6,_ee,5,1,"ng-container",4),ne(7,"ul",72),yt(8,bee,2,1,"li",49),oe()()()),2&n){const e=t.$implicit;pe(4),de(e.summary),pe(1),Pe("ngIf",1===e.descriptions.length),pe(1),Pe("ngIf",e.descriptions.length>1),pe(2),Pe("ngForOf",e.safeDetails)}}function vee(n,t){if(1&n&&(ne(0,"div",69)(1,"div",70),yt(2,yee,9,4,"div",49),oe()()),2&n){const e=St(2);pe(2),Pe("ngForOf",e.legInfoDataModel.situations)}}function xee(n,t){1&n&&(ne(0,"div")(1,"span",17),Z(2,"not serviced"),oe()())}function wee(n,t){if(1&n&&(ji(0),ne(1,"div"),Z(2,"1."),oe(),ne(3,"div",35),rn(4,"sbb-icon",36),oe(),Zi()),2&n){const e=St().$implicit;pe(4),Ir("svgIcon",e.occupancy.firstClassIcon),Ir("sbbTooltip",e.occupancy.firstClassText)}}function See(n,t){if(1&n&&(ji(0),ne(1,"div"),Z(2,"2."),oe(),ne(3,"div",35),rn(4,"sbb-icon",36),oe(),Zi()),2&n){const e=St().$implicit;pe(4),Ir("svgIcon",e.occupancy.secondClassIcon),Ir("sbbTooltip",e.occupancy.secondClassText)}}function Tee(n,t){if(1&n&&(ji(0),ne(1,"td",51),rn(2,"img",37),oe(),Zi()),2&n){const e=St().$implicit;pe(2),Ir("src",e.platformAssistanceIconPath,zo),Ir("sbbTooltip",e.platformAssistanceTooltip)}}function Cee(n,t){if(1&n&&(ne(0,"div"),Z(1),ne(2,"span",30),Z(3),oe()()),2&n){const e=St().$implicit;let i;pe(1),De("",null!==(i=e.arrText)&&void 0!==i?i:"\u2000"," "),pe(2),de(e.arrDelayText)}}function Dee(n,t){if(1&n&&(ne(0,"div")(1,"del"),Z(2),oe(),ne(3,"span",30),Z(4),oe()()),2&n){const e=St().$implicit;let i;pe(2),de(null!==(i=e.arrText)&&void 0!==i?i:"\u2000"),pe(2),de(e.arrDelayText)}}function Eee(n,t){if(1&n&&(ne(0,"div"),Z(1),ne(2,"span",30),Z(3),oe()()),2&n){const e=St().$implicit;pe(1),De("",e.depText," "),pe(2),de(e.depDelayText)}}function Iee(n,t){if(1&n&&(ne(0,"div")(1,"del"),Z(2),oe(),ne(3,"span",30),Z(4),oe()()),2&n){const e=St().$implicit;pe(2),de(e.depText),pe(2),de(e.depDelayText)}}function Mee(n,t){if(1&n){const e=or();ji(0),ne(1,"tr",50),Wt("click",function(){const a=Qn(e).index;return ei(St(2).zoomToIntermediaryPoint(a))}),ne(2,"td")(3,"div",70)(4,"div"),Z(5),oe(),yt(6,xee,3,0,"div",4),oe(),ne(7,"div",74),yt(8,wee,5,2,"ng-container",4),yt(9,See,5,2,"ng-container",4),oe()(),yt(10,Tee,3,2,"ng-container",4),ne(11,"td",51),yt(12,Cee,4,2,"div",4),yt(13,Dee,5,2,"div",4),oe(),ne(14,"td",75),yt(15,Eee,4,2,"div",4),yt(16,Iee,5,2,"div",4),oe()(),Zi()}if(2&n){const e=t.$implicit;pe(5),de(e.locationText),pe(1),Pe("ngIf",e.isNotServicedStop),pe(2),Pe("ngIf",e.occupancy.firstClassIcon),pe(1),Pe("ngIf",e.occupancy.secondClassIcon),pe(1),Pe("ngIf",null!==e.platformAssistanceIconPath),pe(2),Pe("ngIf",!e.isNotServicedStop),pe(1),Pe("ngIf",e.isNotServicedStop),pe(2),Pe("ngIf",!e.isNotServicedStop),pe(1),Pe("ngIf",e.isNotServicedStop)}}function Aee(n,t){if(1&n){const e=or();ne(0,"div",57)(1,"div")(2,"button",58),Wt("click",function(){return Qn(e),ei(St().loadTripInfoResultPopover())}),Z(3),oe()(),ne(4,"div"),Z(5),oe(),yt(6,uee,4,1,"ng-container",4),oe(),yt(7,hee,4,2,"div",59),ne(8,"div",60),yt(9,pee,5,3,"div",4),ne(10,"div",61)(11,"div",19),yt(12,fee,4,2,"div",62),oe()(),yt(13,vee,3,1,"div",63),oe(),ne(14,"div",64)(15,"table",47)(16,"tbody"),yt(17,Mee,17,9,"ng-container",49),oe()()()}if(2&n){const e=St();pe(3),de(e.legInfoDataModel.serviceInfo),pe(2),De(" to ",e.legInfoDataModel.serviceDestinationText,""),pe(1),Pe("ngIf",e.legInfoDataModel.serviceFormationURL),pe(1),Pe("ngIf",e.legInfoDataModel.debugServicePtMode),pe(2),Pe("ngIf",null!==e.legInfoDataModel.serviceIntermediaryStopsText),pe(3),Pe("ngForOf",e.legInfoDataModel.serviceAttributes),pe(1),Pe("ngIf",e.legInfoDataModel.hasSituations),pe(1),Pe("id",e.legElementId),pe(3),Pe("ngForOf",e.legInfoDataModel.intermediaryLocationsData)}}const Ree=function(n,t){return{"background-color":n,"border-color":t}};let Pee=(()=>{class n{constructor(e,i,r,a,d){this.mapService=e,this.router=i,this.popover=r,this.userTripService=a,this.sanitizer=d,this.legReloadRequest=new Cn,this.legMapRedrawRequest=new Cn,this.legElementId="n/a",this.legInfoDataModel={},this.isEmbed=-1!==this.router.url.indexOf("/embed/"),this.enableTRR="2.0"===Mo}ngOnInit(){void 0!==this.legData&&(this.legElementId="leg_"+this.legData.leg.legID,this.initLegInfo())}computeLegLeadingText(){if(void 0===this.legData)return"n/a";const e=this.legData.info.id+". ";if("TransferLeg"===this.legData.leg.legType){const i="Transfer",r=this.legData.leg;let a="";return r.walkDuration&&(a=" "+r.walkDuration.formatDuration()),e+i+a}if("ContinuousLeg"===this.legData.leg.legType){const r=this.computeLegLeadingTextContinousLeg(this.legData.leg);let a="";return this.legData.leg.legDuration&&(a=" "+this.legData.leg.legDuration.formatDuration()),e+r+" - "+a}if("TimedLeg"===this.legData.leg.legType){const i=this.legData.leg;let r=i.service.ptMode.name;null===r&&(r=i.service.ptMode.ptMode),i.service.ptMode.isDemandMode&&(r="OnDemand "+r);let a="";return this.legData.leg.legDuration&&(a=" "+this.legData.leg.legDuration.formatDuration()),e+r+" - "+a}return e+this.legData.leg.legType}computeLegLeadingTextContinousLeg(e){return"walk"===e.legTransportMode?"Walk":e.isDriveCarLeg()?"Drive":e.isSharedMobility()?"Ride":e.isTaxi()?"others-drive-car"===e.legTransportMode?"Limo":"Taxi":"car-shuttle-train"===e.legTransportMode?"Ride Autoverladezug":"car-ferry"===e.legTransportMode?"Use Ferry":"PLACEHOLDER - NEW MOT?"}computeLegPillClassName(){return this.legData?"ContinuousLeg"===this.legData.leg.legType?"continous-leg-pill":"TimedLeg"===this.legData.leg.legType?"timed-leg-pill":"TransferLeg"===this.legData.leg.legType?"transfer-leg-pill":"":""}zoomToLeg(){if(!this.legData)return;const i=new cD(this.legData.leg).computeGeoJSONFeatures(),r=bn.GeoPositionBBOX.initFromGeoJSONFeatures(i);if(!r.isValid())return console.error("Invalid BBOX for leg"),void console.log(this.legData);const d={bounds:new(sl().LngLatBounds)(r.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(d)}reloadTripLeg(){!this.legData||this.legReloadRequest.emit()}get checkboxId(){var e,i;return"lp_checkbox_"+(null!==(i=null===(e=this.legData)||void 0===e?void 0:e.leg.legID)&&void 0!==i?i:"n/a")}redrawTripLeg(e){this.legData&&void 0!==this.legIdx&&this.legMapRedrawRequest.emit({legIdx:this.legIdx,checked:e.target.checked})}computeLegColor(){const e=Fd.Unknown;if(!this.legData)return e;const i=this.legData.leg.legType;if("ContinuousLeg"===i||"TransferLeg"===i)return this.computeContinousLegColor(this.legData.leg);if("TimedLeg"===i){const d=Yl.initWithOJP_LegacyJourneyService(this.legData.leg.service).computeLegColorType();return Fd[d]}return e}computeContinousLegColor(e){return e.isDriveCarLeg()?Fd["Self-Drive Car"]:e.isSharedMobility()?Fd["Shared Mobility"]:"TransferLeg"===e.legType?Fd.Transfer:e.isTaxi()?Fd.OnDemand:"car-ferry"===e.legTransportMode?Fd.Water:Fd.Walk}initLegInfo(){var e,i,r,a;if(void 0===this.legData)return;const d=this.legData.leg;this.legInfoDataModel.legColor=this.computeLegColor(),this.legInfoDataModel.leadingText=this.computeLegLeadingText(),this.legInfoDataModel.guidanceRows=(()=>{var B,X;const te=[];return("ContinuousLeg"===d.legType||"TransferLeg"===d.legType)&&(null!==(X=null===(B=d.pathGuidance)||void 0===B?void 0:B.sections)&&void 0!==X?X:[]).forEach(ye=>{var $e,ht,Qe,At,fn,qn,Xn,Ri,Yi;if(null===ye.guidanceAdvice)return;const Ci=(()=>{var eo,Pr;const gs=bn.Duration.initFromDurationText(null!==(Pr=null===(eo=ye.trackSection)||void 0===eo?void 0:eo.duration)&&void 0!==Pr?Pr:null);if(null===gs)return"";const ti=gs.formatDuration();return"0min"===ti?"":ti})(),ar=null!==(Qe=null===(ht=null===($e=ye.trackSection)||void 0===$e?void 0:$e.linkProjection)||void 0===ht?void 0:ht.asGeoJSONFeature())&&void 0!==Qe?Qe:null,Gi={turnDescription:null!==(At=ye.turnAction)&&void 0!==At?At:"",advice:null!==(fn=ye.guidanceAdvice)&&void 0!==fn?fn:"",lengthF:no.formatDistance(null!==(Xn=null===(qn=ye.trackSection)||void 0===qn?void 0:qn.length)&&void 0!==Xn?Xn:0),durationF:Ci,streetName:null!==(Yi=null===(Ri=ye.trackSection)||void 0===Ri?void 0:Ri.roadName)&&void 0!==Yi?Yi:"",geojsonFeature:ar};te.push(Gi)}),te})();let b="TransferLeg"===d.legType;const x="ContinuousLeg"===d.legType;if(x){const B=d;b=B.isWalking(),b&&(this.legInfoDataModel.distanceText=no.formatDistance(B.legDistance))}this.legInfoDataModel.isWalking=b,this.legInfoDataModel.legTemplate=x&&d.isTaxi()?"taxi":"TimedLeg"===d.legType?"timed":"walk",this.legInfoDataModel.bookingArrangements=x?null===d.serviceBooking?[]:d.serviceBooking.bookingArrangements:[],this.legInfoDataModel.durationText=null!==(i=null===(e=d.legDuration)||void 0===e?void 0:e.formatDuration())&&void 0!==i?i:"";const A=no.computeIconFilenameForLeg(d);if(this.legInfoDataModel.legIconPath="assets/pictograms/"+A+".png",this.legInfoDataModel.isTimed="TimedLeg"===d.legType,this.legInfoDataModel.fromLocationData=this.computeLocationData(d,"From"),this.legInfoDataModel.toLocationData=this.computeLocationData(d,"To"),this.legInfoDataModel.intermediaryLocationsData=(()=>{const B=[];return"TimedLeg"!==d.legType||d.intermediateStopPoints.forEach(te=>{var se;const me={locationText:null!==(se=te.location.computeLocationName())&&void 0!==se?se:"n/a"},ye=no.convertOJP_LegacyStopPoint2StopPointCall(te);no.updateLocationDataWithTime(me,ye),B.push(me)}),B})(),this.legInfoDataModel.situations=(()=>{if("TimedLeg"!==d.legType)return[];const X=d.service.siriSituations,te=no.computeSituationsData(this.sanitizer,X);return"DEBUG"===Sc&&X.length>0&&0===te.length&&(console.error("ResultTripLegComponent.initLegInfo ERROR - have situations but cant extract data from them"),console.log(X),console.log("========================================================")),te})(),this.legInfoDataModel.hasSituations=this.legInfoDataModel.situations.length>0,"TimedLeg"===d.legType){const B=d,X=no.computePlatformAssistance(B.fromStopPoint.vehicleAccessType);this.legInfoDataModel.fromLocationData.platformAssistanceIconPath=no.computePlatformAssistanceIconPath(X),this.legInfoDataModel.fromLocationData.platformAssistanceTooltip=no.computePlatformAssistanceTooltip(X);const te=no.computePlatformAssistance(B.toStopPoint.vehicleAccessType);this.legInfoDataModel.toLocationData.platformAssistanceIconPath=no.computePlatformAssistanceIconPath(te),this.legInfoDataModel.toLocationData.platformAssistanceTooltip=no.computePlatformAssistanceTooltip(te),B.intermediateStopPoints.forEach((se,me)=>{var ye;const $e=null!==(ye=this.legInfoDataModel.intermediaryLocationsData[me])&&void 0!==ye?ye:null;if(null===$e)return;const ht=no.computePlatformAssistance(se.vehicleAccessType);$e.platformAssistanceIconPath=no.computePlatformAssistanceIconPath(ht),$e.platformAssistanceTooltip=no.computePlatformAssistanceTooltip(ht)})}var B,X;this.legInfoDataModel.serviceAttributes=this.computeServiceAttributeModel(d),this.legInfoDataModel.serviceDestinationText="TimedLeg"!==d.legType?null:null!==(X=null===(B=d.service.destinationStopPlace)||void 0===B?void 0:B.stopPlaceName)&&void 0!==X?X:"n/a",this.legInfoDataModel.serviceIntermediaryStopsText=(()=>{if("TimedLeg"!==d.legType)return null;const X=d.intermediateStopPoints.length;return 0===X?null:1===X?"1 stop":X+" stops"})();const O="TimedLeg"!==d.legType?null:Yl.initWithOJP_LegacyJourneyService(d.service);this.legInfoDataModel.serviceInfo=null!==(r=null==O?void 0:O.formatServiceName())&&void 0!==r?r:null,this.legInfoDataModel.serviceFormationURL=null!==(a=null==O?void 0:O.computeFormationServiceURL())&&void 0!==a?a:null,this.legInfoDataModel.serviceJourneyRef="TimedLeg"!==d.legType?null:d.service.journeyRef,this.legInfoDataModel.debugServicePtMode="DEBUG"===Sc,this.legInfoDataModel.servicePtMode="TimedLeg"!==d.legType?null:d.service.ptMode,this.legInfoDataModel.isCancelled="TimedLeg"===d.legType&&!0===d.service.hasCancellation,this.legInfoDataModel.hasDeviation="TimedLeg"===d.legType&&!0===d.service.hasDeviation,this.legInfoDataModel.isUnplanned="TimedLeg"===d.legType&&!0===d.service.isUnplanned}computeServiceAttributeModel(e){const i=[];if("TimedLeg"!==e.legType)return i;const r=e;for(const[a,d]of Object.entries(r.service.serviceAttributes)){const b=(()=>{const A="kom:circle-question-mark-medium";return"A__BA"===a?A:a.startsWith("A_")?"fpl:sa-"+a.replace(/A_*/,"").toLowerCase():A})();null!==b&&i.push({icon:b,caption:d.text})}return i}computeLocationData(e,i){var r;const a="From"===i,b={locationText:null!==(r=(a?e.fromLocation:e.toLocation).computeLocationName())&&void 0!==r?r:"",platformText:null,arrText:null,arrDelayText:null,depText:null,depDelayText:null};if("TimedLeg"===e.legType){const x=e,O=no.convertOJP_LegacyStopPoint2StopPointCall(a?x.fromStopPoint:x.toStopPoint);no.updateLocationDataWithTime(b,O)}return b}zoomToEndpoint(e){if(!this.legData)return;const r="From"===e?this.legData.leg.fromLocation:this.legData.leg.toLocation;r.geoPosition?this.mapService.tryToCenterAndZoomToLocation(r):(console.log("ERROR zoomToEndpoint - no location coords"),console.log(r))}zoomToIntermediaryPoint(e){const i=new bn.Location,r=this.legInfoDataModel.intermediaryLocationsData[e].geoPosition;r?(i.geoPosition=new bn.GeoPosition(r.longitude,r.latitude),this.mapService.tryToCenterAndZoomToLocation(i)):(console.log("ERROR zoomToIntermediaryPoint - no location coords"),console.log(i))}zoomToGuidanceSection(e){var i;const a=this.legInfoDataModel.guidanceRows[e].geojsonFeature;if(null===a){const d=(()=>{var b,x,A,O;return 0===e?null!==(x=null===(b=this.legData)||void 0===b?void 0:b.leg.fromLocation)&&void 0!==x?x:null:e===this.legInfoDataModel.guidanceRows.length-1&&null!==(O=null===(A=this.legData)||void 0===A?void 0:A.leg.toLocation)&&void 0!==O?O:null})();d&&this.mapService.tryToCenterAndZoomToLocation(d,18)}else{const d=null!==(i=a.bbox)&&void 0!==i?i:null;if(d){const b=new(sl().LngLatBounds)(d),x=b.getSouthWest().distanceTo(b.getSouthEast()),A=b.getNorthWest().distanceTo(b.getSouthWest());if(Math.max(x,A)<20){const B=b.getCenter(),X=bn.Location.initWithLngLat(B.lng,B.lat);this.mapService.tryToCenterAndZoomToLocation(X,18)}else this.mapService.newMapBoundsRequested.emit({bounds:b})}}}loadTripInfoResultPopover(){const e=this.legInfoDataModel.serviceJourneyRef;if(null===e)return void console.error("loadTripInfoResultPopover: cant fetch empty journeyRef");const i=this.popover.open(jz,{position:{top:"20px"},width:"50vw",height:"90vh",maxWidth:"700px"});i.afterOpened().subscribe(()=>{i.componentInstance.fetchJourneyRef(e,this.userTripService.departureDate)})}loadTRR_Popover(){var e;const i=null!==(e=this.trrRequestInfo)&&void 0!==e?e:null;if(null===i)return;const r=this.popover.open(N1,{position:{top:"20px"},width:"50vw",height:"90vh"});r.afterOpened().subscribe(()=>{r.componentInstance.updateRequestData(i)})}}return n.\u0275fac=function(e){return new(e||n)(ue(xf),ue(pa),ue(Cc),ue(ia),ue(mT))},n.\u0275cmp=Jt({type:n,selectors:[["result-trip-leg"]],inputs:{legData:"legData",legIdx:"legIdx",isForceLinkProjection:"isForceLinkProjection",trrRequestInfo:"trrRequestInfo"},outputs:{legReloadRequest:"legReloadRequest",legMapRedrawRequest:"legMapRedrawRequest"},decls:30,vars:18,consts:[[1,"card","card-trip-leg","p-3","mb-2",3,"click"],[1,"leg-header","mb-2","d-flex"],[1,"flex-grow-1","d-flex","gap-2"],["type","button",1,"btn","btn-primary","btn-sm","font-weight-bold",3,"ngStyle","click"],[4,"ngIf"],["class","d-flex gap-1 align-items-center",4,"ngIf"],[1,"leg-content","mb-2","d-flex","flex-row","align-items-center"],[1,"flex-grow-0","leg-left-side"],[1,"d-flex","flex-column","leg-icon-wrapper"],[1,"text-center"],[1,"leg-icon",3,"src"],[1,"flex-grow-1"],[4,"ngIf","ngIfThen"],["timedLegTemplate",""],["walkingLegTemplate",""],["taxiLegTemplate",""],["timedLegTemplateVariant2",""],[1,"badge","rounded-pill","bg-danger","fw-bolder"],[1,"badge","rounded-pill","bg-warning","fw-bolder"],[1,"d-flex","gap-1","align-items-center"],[1,"d-flex","gap-1"],["type","checkbox","stopClickPropagation","",1,"form-check-input",3,"id","name","checked","change"],["stopClickPropagation","",1,"form-check-label",3,"for"],[1,"badge","leg-pill","pill-hover","bg-primary",3,"click"],[1,"badge","leg-pill","pill-hover","bg-info","text-dark",3,"click"],[1,"d-flex","flex-row","align-items-center"],["stopClickPropagation","",1,"flex-grow-1","leg-location","location-hover",3,"click"],[1,"d-flex"],[1,"flex-grow-0","leg-time","leg-right-side"],[1,"d-flex","gap-2","align-items-center","leg-endpoint"],[1,"time-delay"],[1,"px-2"],[1,"d-flex","flex-row","align-items-center",2,"height","16px"],[1,"separator"],[4,"ngTemplateOutlet"],[1,"occupancy"],[3,"svgIcon","sbbTooltip"],[1,"leg-platform-assistance",3,"src","sbbTooltip"],[1,"flex-grow-1","leg-location"],[1,"d-flex","flex-column","leg-location"],["stopClickPropagation","",1,"location-hover",3,"click"],["class","p-2",4,"ngIf"],[1,"p-2"],["type","button","stopClickPropagation","","data-bs-toggle","collapse","aria-expanded","false",1,"btn","btn-primary","btn-sm","btn-collapse","collapsed"],[1,"bi","bi-chevron-down"],[1,"bi","bi-chevron-up"],[1,"py-4","collapse",3,"id"],[1,"table","table-hover","table-striped","table-stops","mb-0","align-middle"],["scope","col"],[4,"ngFor","ngForOf"],["stopClickPropagation","",1,"location-hover","leg-intermediate",3,"click"],[1,"fit"],[1,"guidance-description"],[1,"guidance-step-street"],[1,"border-bottom",2,"height","8px","margin-left","4px","margin-right","8px"],[1,"booking-arrangement"],["target","_blank",3,"href"],[1,"mb-2","d-flex","gap-1","align-items-center"],["stopClickPropagation","",1,"btn","btn-primary","btn-sm",3,"click"],["class","mb-2 ms-2 d-flex gap-1 service-pt-mode align-items-center",4,"ngIf"],[1,"ms-2","d-flex","gap-2","align-items-center"],[1,"service-attributes"],["class","service-attribute",4,"ngFor","ngForOf"],["class","mt-2",4,"ngIf"],[1,"py-2","collapse",3,"id"],[1,"mb-2","ms-2","d-flex","gap-1","service-pt-mode","align-items-center"],[1,"badge","rounded-pill","text-bg-secondary"],[1,"service-attribute"],["trigger","hover",1,"sbb-icon-fit",3,"svgIcon"],[1,"mt-2"],[1,"d-flex","gap-2"],["svgIcon","fpl:info"],[1,"tooltip-list"],[3,"innerHTML"],[1,"ps-1","d-flex","gap-1","align-items-center"],[1,"fit","stop-time"]],template:function(e,i){if(1&e&&(ne(0,"div",0),Wt("click",function(){return i.zoomToLeg()}),ne(1,"div",1)(2,"div",2)(3,"div")(4,"button",3),Wt("click",function(){return i.zoomToLeg()}),Z(5),oe()(),yt(6,CQ,3,0,"div",4),yt(7,DQ,3,0,"div",4),yt(8,EQ,3,0,"div",4),oe(),yt(9,PQ,3,2,"div",5),oe(),ne(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",9),rn(14,"img",10),oe(),ne(15,"div",9),Z(16),oe()()(),ne(17,"div",11),yt(18,kQ,1,0,"ng-container",12),yt(19,LQ,1,0,"ng-container",12),yt(20,OQ,1,0,"ng-container",12),oe()(),yt(21,FQ,6,1,"ng-container",4),oe(),yt(22,nee,40,19,"ng-template",null,13,Kp),yt(24,aee,12,5,"ng-template",null,14,Kp),yt(26,cee,12,4,"ng-template",null,15,Kp),yt(28,Aee,18,9,"ng-template",null,16,Kp)),2&e){const r=el(23),a=el(25),d=el(27);pe(4),Pe("ngStyle",EP(15,Ree,i.legInfoDataModel.legColor,i.legInfoDataModel.legColor)),pe(1),de(i.legInfoDataModel.leadingText),pe(1),Pe("ngIf",!0===i.legInfoDataModel.isCancelled),pe(1),Pe("ngIf",!0===i.legInfoDataModel.hasDeviation),pe(1),Pe("ngIf",!0===i.legInfoDataModel.isUnplanned),pe(1),Pe("ngIf",!1===i.isEmbed),pe(5),Ir("src",i.legInfoDataModel.legIconPath,zo),pe(2),de(i.legInfoDataModel.distanceText),pe(2),Pe("ngIf","walk"==i.legInfoDataModel.legTemplate)("ngIfThen",a),pe(1),Pe("ngIf","timed"==i.legInfoDataModel.legTemplate)("ngIfThen",r),pe(1),Pe("ngIf","taxi"==i.legInfoDataModel.legTemplate)("ngIfThen",d),pe(1),Pe("ngIf",null!==(null==i.legData||null==i.legData.info?null:i.legData.info.comments))}},dependencies:[Sl,Zo,Px,tL,cl,fD,Bz,TQ],styles:[".font-weight-bold[_ngcontent-%COMP%]{font-weight:700}.pill-hover[_ngcontent-%COMP%]:hover, .location-hover[_ngcontent-%COMP%]:hover{cursor:pointer}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}.leg-left-side[_ngcontent-%COMP%]{width:50px}.leg-icon[_ngcontent-%COMP%]{width:40px;height:40px}.leg-location[_ngcontent-%COMP%]{background-color:transparent;margin-left:4px}.leg-time-wrapper[_ngcontent-%COMP%]{background-color:transparent}.leg-time[_ngcontent-%COMP%]{font-size:15px}.time-delay[_ngcontent-%COMP%]{color:#c45f00}.booking-arrangement[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:4px}.booking-arrangement[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:0;padding-left:0}.leg-endpoint[_ngcontent-%COMP%]   .leg-platform-assistance[_ngcontent-%COMP%]{width:30px}.occupancy[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px}.leg-intermediate[_ngcontent-%COMP%]   .leg-platform-assistance[_ngcontent-%COMP%]{width:25px}.occupancy-icon[_ngcontent-%COMP%]{width:64px}.separator[_ngcontent-%COMP%]{width:100%;height:1px;background-color:#dee2e6}.btn-collapse.collapsed[_ngcontent-%COMP%]   .bi-chevron-down[_ngcontent-%COMP%]{display:inline}.btn-collapse[_ngcontent-%COMP%]   .bi-chevron-down[_ngcontent-%COMP%], .btn-collapse.collapsed[_ngcontent-%COMP%]   .bi-chevron-up[_ngcontent-%COMP%]{display:none}.btn-collapse[_ngcontent-%COMP%]   .bi-chevron-up[_ngcontent-%COMP%]{display:inline}.intermediary-stops[_ngcontent-%COMP%]{font-size:14px}.table-stops[_ngcontent-%COMP%]{font-size:13px}.table-stops[_ngcontent-%COMP%]   td.fit[_ngcontent-%COMP%], .table-stops[_ngcontent-%COMP%]   th.fit[_ngcontent-%COMP%]{white-space:nowrap;width:1%}.location-hover[_ngcontent-%COMP%]{cursor:pointer}.guidance-description[_ngcontent-%COMP%]{max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.guidance-step-street[_ngcontent-%COMP%]{font-size:12px}"]}),n})();function kee(n,t){1&n&&(ne(0,"div")(1,"span",7),Z(2,"Cancelled"),oe()())}function Lee(n,t){1&n&&(ne(0,"div")(1,"span",8),Z(2,"Infeasable"),oe()())}function Oee(n,t){1&n&&(ne(0,"div")(1,"span",8),Z(2,"Unplanned"),oe()())}function Fee(n,t){if(1&n){const e=or();ji(0),ne(1,"result-trip-leg",9),Wt("legReloadRequest",function(){return Qn(e),ei(St().reloadTripLegIdx())})("legMapRedrawRequest",function(r){return Qn(e),ei(St().redrawTripOnMap(r))}),oe(),Zi()}if(2&n){const e=t.$implicit,i=t.index,r=St();let a,d;pe(1),Pe("legData",e)("legIdx",i)("isForceLinkProjection",null!==(a=r.mapTrip&&r.mapTrip.legs[i].forceLinkProjection)&&void 0!==a&&a)("trrRequestInfo",null!==(d=r.trrRequestInfo)&&void 0!==d?d:void 0)}}function Nee(n,t){if(1&n&&(ne(0,"li"),Z(1),oe()),2&n){const e=t.$implicit;pe(1),it(" Legs ",e.fromTripLegIdRef,"-",e.toTripLegIdRef," : ",e.fareProduct[0].price," CHF (",e.fareProduct[0].fareProductName,", ",e.fareProduct[0].travelClass," class) ")}}let Bee=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.languageService=r,this.tripHeaderStats={},this.mapTrip=null,this.trrRequestInfo=null}ngOnInit(){var e;if(!this.tripData)return;this.initTripHeaderStats(this.tripData.trip),this.mapTrip={legs:[]},this.tripData.legsData.forEach(r=>{var a;const d=!cD.shouldUseBeeline(r.leg);null===(a=this.mapTrip)||void 0===a||a.legs.push({leg:r.leg,forceLinkProjection:d})});const i=0===this.idx;this.tripPanel&&i&&this.tripPanel.open(),null===(e=this.tripPanel)||void 0===e||e.afterExpand.subscribe(r=>{this.drawAndZoomToMapTrip()}),i&&this.drawAndZoomToMapTrip()}drawAndZoomToMapTrip(){!this.tripData||(this.userTripService.selectActiveTrip(this.mapTrip),this.mapService.zoomToTrip(this.tripData.trip))}initTripHeaderStats(e){var i;this.tripHeaderStats.title="Trip "+((null!==(i=this.idx)&&void 0!==i?i:0)+1),this.tripHeaderStats.isCancelled=!0===e.stats.isCancelled,this.tripHeaderStats.isInfeasable=!0===e.stats.isInfeasable,this.tripHeaderStats.isUnplanned=!0===e.stats.isUnplanned,this.tripHeaderStats.tripChangesInfo=0===e.stats.transferNo?"direct":1===e.stats.transferNo?e.stats.transferNo+" transfer":e.stats.transferNo+" transfers",this.tripHeaderStats.tripFromTime=bn.DateHelpers.formatTimeHHMM(e.stats.startDatetime),this.tripHeaderStats.tripToTime=bn.DateHelpers.formatTimeHHMM(e.stats.endDatetime);const r=n.getDayOffset(e.stats.endDatetime,e.stats.startDatetime);r>0&&(this.tripHeaderStats.tripToTime="(+"+r+"d) "+this.tripHeaderStats.tripToTime),this.tripHeaderStats.tripDurationS=e.stats.duration.formatDuration(),this.tripHeaderStats.tripDistanceS=(()=>{if("DEBUG"!==Sc)return no.formatDistance(e.stats.distanceMeters);const a="trip"===e.stats.distanceSource?"\u0394":"\u03a3";return no.formatDistance(e.stats.distanceMeters)+" "+a})()}static getDayOffset(e,i){return Math.ceil(Math.abs(new Date(Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate())).valueOf()-new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())).valueOf())/864e5)}reloadTripLegIdx(){var e=this;return mr(function*(){if(!e.tripData)return;const r="2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,a=e.tripData.trip.asXML(r),d=BC.initWithTripXML(a);d.leg=d.leg.filter(me=>me.timedLeg||me.transferLeg);const b=oZ.initWithTrip(d),x=e.userTripService.getStageConfig(),O=yield new M1(Ps,x,e.languageService.language).fetchTripRefineRequestResponse(b);if(!O.ok)return console.error("ERROR - fetchTripRefineRequestResponse"),console.log(b),void console.log(O);if(null===b.requestInfo.responseXML)return console.error("no responseXML"),void console.log(b);e.trrRequestInfo=b.requestInfo;const X=yield bn.TripRequest.initWithResponseMock(b.requestInfo.responseXML,r,Ps).fetchResponse();if(1!==X.trips.length)return console.error("Expected 1 trip in reponse"),void console.log(X);const te=X.trips[0],se=yield e.userTripService.fetchFaresForTrips(e.languageService.language,[te]);1===se.length?e.tripData.fareResult=se[0]:console.log("error: nova failed to return new fares, use old ones"),e.tripData.trip=te})()}redrawTripOnMap(e){!this.mapTrip||(this.mapTrip.legs[e.legIdx].forceLinkProjection=e.checked,this.userTripService.selectActiveTrip(this.mapTrip))}}return n.\u0275fac=function(e){return new(e||n)(ue(ia),ue(xf),ue($u))},n.\u0275cmp=Jt({type:n,selectors:[["journey-result-row"]],viewQuery:function(e,i){if(1&e&&mo(wf,7),2&e){let r;xi(r=wi())&&(i.tripPanel=r.first)}},inputs:{tripData:"tripData",idx:"idx"},decls:26,vars:12,consts:[[1,"mb-1",3,"hideToggle"],[1,"d-flex","justify-content-between","w-100","trip-info"],[1,"trip-info-header","d-flex","gap-1","align-items-center"],[4,"ngIf"],[1,"trip-info-header"],[4,"ngFor","ngForOf"],[1,"trip-fares"],[1,"badge","rounded-pill","bg-danger","fw-bolder"],[1,"badge","rounded-pill","bg-warning","fw-bolder","text-dark"],[3,"legData","legIdx","isForceLinkProjection","trrRequestInfo","legReloadRequest","legMapRedrawRequest"]],template:function(e,i){1&e&&(ne(0,"sbb-expansion-panel",0)(1,"sbb-expansion-panel-header")(2,"div",1)(3,"div")(4,"div",2)(5,"div"),Z(6),oe(),yt(7,kee,3,0,"div",3),yt(8,Lee,3,0,"div",3),yt(9,Oee,3,0,"div",3),ne(10,"div")(11,"span"),Z(12),oe()()(),ne(13,"div"),Z(14),oe()(),ne(15,"div",4)(16,"div"),Z(17),oe(),ne(18,"div"),Z(19),oe()()()(),ne(20,"div"),yt(21,Fee,2,4,"ng-container",5),oe(),ne(22,"div"),Z(23,"Price: "),ne(24,"ul",6),yt(25,Nee,2,5,"li",5),oe()()()),2&e&&(Pe("hideToggle",!0),pe(6),de(i.tripHeaderStats.title),pe(1),Pe("ngIf",!0===i.tripHeaderStats.isCancelled),pe(1),Pe("ngIf",!0===i.tripHeaderStats.isInfeasable),pe(1),Pe("ngIf",!0===i.tripHeaderStats.isUnplanned),pe(3),De(" - ",i.tripHeaderStats.tripChangesInfo,""),pe(2),Be("",i.tripHeaderStats.tripDurationS," - ",i.tripHeaderStats.tripDistanceS,""),pe(3),de(i.tripHeaderStats.tripFromTime),pe(2),de(i.tripHeaderStats.tripToTime),pe(2),Pe("ngForOf",null==i.tripData?null:i.tripData.legsData),pe(4),Pe("ngForOf",null==i.tripData||null==i.tripData.fareResult?null:i.tripData.fareResult.tripFareResult))},dependencies:[Sl,Zo,wf,V1,Pee],styles:[".trip-info[_ngcontent-%COMP%]{font-size:14px}.trip-info-header[_ngcontent-%COMP%]{font-size:16px}.trip-fares[_ngcontent-%COMP%]{margin-top:2px;margin-bottom:2px}.sbb-expanded[_ngcontent-%COMP%]{background-color:#fcfcfc}"]}),n})();function zee(n,t){1&n&&rn(0,"span",6)}function Vee(n,t){if(1&n){const e=or();ne(0,"div",2)(1,"div",3)(2,"button",4),Wt("click",function(){return Qn(e),ei(St().loadPreviousTrips())}),yt(3,zee,1,0,"span",5),Z(4," Earlier connections "),oe()()()}if(2&n){const e=St();pe(2),Pe("disabled",e.model.isFetchingPrevTrips),pe(1),Pe("ngIf",e.model.isFetchingPrevTrips)}}function jee(n,t){if(1&n&&rn(0,"journey-result-row",7),2&n){const i=t.index;Pe("tripData",t.$implicit)("idx",i)}}function Uee(n,t){1&n&&rn(0,"span",6)}function Hee(n,t){if(1&n){const e=or();ne(0,"div",2)(1,"div",3)(2,"button",4),Wt("click",function(){return Qn(e),ei(St().loadNextTrips())}),yt(3,Uee,1,0,"span",5),Z(4," Later connections "),oe()()()}if(2&n){const e=St();pe(2),Pe("disabled",e.model.isFetchingNextTrips),pe(1),Pe("ngIf",e.model.isFetchingNextTrips)}}let Uz=(()=>{class n{constructor(e,i,r){this.userTripService=e,this.mapService=i,this.languageService=r,this.model={tripsData:[],hasPagination:!1,isFetchingPrevTrips:!1,isFetchingNextTrips:!1},this.model.hasPagination=this.computeHasPagination(0)}computeHasPagination(e){return 0!==e&&this.userTripService.hasPublicTransport()}ngOnInit(){this.userTripService.tripsDataUpdated.subscribe(e=>{this.updatePageModel(e)}),this.userTripService.searchParamsReset.subscribe(()=>{this.updatePageModel([])}),this.userTripService.tripFaresUpdated.subscribe(e=>{this.model.tripsData.forEach(i=>{i.fareResult=null}),e.forEach(i=>{var r;const a=null!==(r=this.model.tripsData.find(d=>d.trip.id===i.resultId))&&void 0!==r?r:null;if(null===a)return console.error("ERROR - cant find fare for trip "+i.resultId),console.log(this.model.tripsData),void console.log(i);a.fareResult=i})})}loadPreviousTrips(){if(0===this.model.tripsData.length)return;const e=this.model.tripsData[0].trip.computeDepartureTime();null!==e&&(this.model.isFetchingPrevTrips=!0,this.loadTrips("NumberOfResultsBefore",e))}loadNextTrips(){if(0===this.model.tripsData.length)return;const i=this.model.tripsData[this.model.tripsData.length-1].trip.computeDepartureTime();null!==i&&(this.model.isFetchingNextTrips=!0,this.loadTrips("NumberOfResultsAfter",i))}loadTrips(e,i){const r=this.userTripService.isViaEnabled?this.userTripService.viaTripLocations:[],a=(()=>this.userTripService.hasPublicTransport()?this.userTripService.numberOfResults:null)();let d=null;"NumberOfResultsBefore"===e&&(d=a);let b=null;"NumberOfResultsAfter"===e&&(b=a);const x=this.userTripService.getStageConfig(),A="2.0"===Mo,B=bn.TripRequest.initWithTripLocationsAndDate(x,this.languageService.language,A?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,Ps,this.userTripService.fromTripLocation,this.userTripService.toTripLocation,i,this.userTripService.currentBoardingType,!0,this.userTripService.tripModeType,this.userTripService.tripTransportMode,r,null,d,b,this.userTripService.publicTransportModesFilter);null!==B&&(B.enableExtensions="OJP-SI"!==this.userTripService.currentAppStage,B.useRealTimeDataType=this.userTripService.useRealTimeDataType,A&&(B.walkSpeedDeviation=this.userTripService.walkSpeedDeviation),this.userTripService.journeyTripRequests=[B],B.fetchResponse().then(X=>{const te=X.trips;this.userTripService.updateTrips(te),this.userTripService.tripRequestFinished.emit(B.requestInfo),te.length>0?this.userTripService.fetchFares(this.languageService.language):this.userTripService.selectActiveTrip(null)}))}updatePageModel(e){this.model.tripsData=e,this.model.hasPagination=this.computeHasPagination(e.length),this.model.isFetchingPrevTrips=!1,this.model.isFetchingNextTrips=!1}}return n.\u0275fac=function(e){return new(e||n)(ue(ia),ue(xf),ue($u))},n.\u0275cmp=Jt({type:n,selectors:[["journey-results"]],decls:4,vars:3,consts:[["class","row",4,"ngIf"],[3,"tripData","idx",4,"ngFor","ngForOf"],[1,"row"],[1,"col","text-center","link-connection"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[3,"tripData","idx"]],template:function(e,i){1&e&&(yt(0,Vee,5,2,"div",0),ne(1,"sbb-accordion"),yt(2,jee,1,2,"journey-result-row",1),oe(),yt(3,Hee,5,2,"div",0)),2&e&&(Pe("ngIf",i.model.hasPagination),pe(2),Pe("ngForOf",i.model.tripsData),pe(1),Pe("ngIf",i.model.hasPagination))},dependencies:[Sl,Zo,hD,Bee],styles:[".link-connection[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}"]}),n})();class ou{static FilterBeelines(){return this.FilterByDrawType("Beeline")}static FilterWalkingLegs(){return["all",this.FilterByDrawType("LegLine"),this.FilterByLineTypes(["Guidance","Walk"])]}static FilterLegPoints(){return this.FilterByDrawType("LegPoint")}static ColorCaseByLegLineType(){const t=["case"];return Object.keys(Fd).forEach(i=>{t.push(["==",["get",ba.LineType],i]),t.push(Fd[i])}),t.push("#FF1493"),t}static FilterByDrawType(t){return["==",["get",ba.DrawType],t]}static FilterByPointType(t){return["==",["get",ba.PointType],t]}static FilterLegTracks(t){const e=["all",this.FilterByDrawType("LegLine")];if(t.length>0){const i=["!",this.FilterByLineTypes(["Guidance","Walk"])];e.push(i)}return e}static FilterByLineTypes(t){return["in",["get",ba.LineType],["literal",t]]}}const qee=JSON.parse('{"id":"ojp-trip-leg-beeline","type":"line","source":"[SOURCE]","filter":["[CASE_FILTER_BY_DRAW_TYPE]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":0.4,"line-color":["[CASE_COLOR_BY_LEG_TYPE]"]}}'),Gee=JSON.parse('{"id":"ojp-trip-timed-leg-point-circle","type":"circle","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegPoint]"],"layout":{},"paint":{"circle-radius":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",8,"OTHERWISE",2],"circle-color":["IF POINT_TYPE: TO","COLOR BY TIMED_LEG","OTHERWISE","#FFF"],"circle-stroke-color":["IF POINT_TYPE: TO","#FFF","OTHERWISE","COLOR BY TIMED_LEG"],"circle-stroke-width":["IF POINT_TYPE: FROM",4,"IF POINT_TYPE: TO",1,"OTHERWISE",3]}}'),$ee=JSON.parse('{"id":"ojp-trip-timed-leg-track","type":"line","source":"[SOURCE]","filter":["[FILTER BY DRAW_TYPE == TimedLegLine]"],"layout":{"line-join":"round","line-cap":"round","visibility":"visible"},"paint":{"line-width":4,"line-opacity":1,"line-color":["[CASE COLOR BY TIMED_LEG]"]}}'),Wee=JSON.parse('{"id":"ojp-trip-walking-leg-line","type":"line","source":"[SOURCE]","filter":["all","[FILTER BY DRAW_TYPE == ContinousLegLine]","[FILTER BY LINE_TYPE == Walk]"],"layout":{"line-cap":"round","line-join":"round"},"paint":{"line-color":"#009933","line-width":4,"line-dasharray":[0.2,2]}}');class Xee{constructor(t){this.mapSourceId="trip-data",this.features=[],this.map=t,this.addMapSourceAndLayers()}renderTrip(t){const e=this.computeGeoJSON(t);this.setSourceFeatures(e.features)}addMapSourceAndLayers(){this.map.addSource(this.mapSourceId,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const t=qee;t.filter=ou.FilterBeelines(),t.paint&&(t.paint["line-color"]=ou.ColorCaseByLegLineType());const e=ou.ColorCaseByLegLineType(),i=Gee;if(i.filter=ou.FilterLegPoints(),i.paint){const x=["case",ou.FilterByPointType("From"),4,ou.FilterByPointType("To"),8,2];i.paint["circle-radius"]=x;const A=["case",ou.FilterByPointType("To"),e,"#FFF"];i.paint["circle-color"]=A;const O=["case",ou.FilterByPointType("To"),"#FFF",e];i.paint["circle-stroke-color"]=O;const B=["case",ou.FilterByPointType("From"),4,ou.FilterByPointType("To"),1,3];i.paint["circle-stroke-width"]=B}const r=$ee;r.filter=ou.FilterLegTracks(["Guidance","Walk"]),r.paint&&(r.paint["line-color"]=ou.ColorCaseByLegLineType());const d=Wee;d.filter=ou.FilterWalkingLegs(),d.paint&&(d.paint["line-color"]=Fd.Walk),[t,r,d,i].forEach(x=>{const A=x;A.source=this.mapSourceId,this.map.addLayer(A)})}setSourceFeatures(t){this.features=t,this.map.getSource(this.mapSourceId).setData({type:"FeatureCollection",features:t})}computeGeoJSON(t){let e=[];const i=t.map(a=>a.leg);return i.forEach((a,d)=>{var b,x;const X=new cD(a,!t[d].forceLinkProjection).computeGeoJSONFeatures();if("TransferLeg"===a.legType&&1===X.length){const te=X[0].properties;if(te&&"Beeline"===te["draw.type"]){const se=null!==(b=i.at(d-1))&&void 0!==b?b:null,me=null!==(x=i.at(d+1))&&void 0!==x?x:null;(null==se?void 0:se.toLocation.geoPosition)&&(null==me?void 0:me.fromLocation.geoPosition)&&(X[0].geometry.coordinates=[null==se?void 0:se.toLocation.geoPosition.asPosition(),null==me?void 0:me.fromLocation.geoPosition.asPosition()])}}e=e.concat(X)}),{type:"FeatureCollection",features:e}}}let Zee=(()=>{class n{constructor(e,i,r,a){this.userTripService=e,this.languageService=i,this.mapService=r,this.debugXmlPopover=a,this.fromMarker=new(sl().Marker),this.toMarker=new(sl().Marker),["From","To"].forEach(b=>{var x=document.createElement("div");x.className="marker-journey-endpoint marker-journey-endpoint-"+b;const A=new(sl().Marker)({element:x,draggable:!0,anchor:"bottom"});A.on("dragend",O=>{this.handleMarkerDrag(A,b)}),"From"===b&&(this.fromMarker=A),"To"===b&&(this.toMarker=A)}),this.viaMarkers=[],this.mapLoadingPromise=null,this.popupContextMenu=new(sl().Popup)({focusAfterOpen:!1}),this.tripRenderController=null}ngOnInit(){this.userTripService.geoLocationsUpdated.subscribe(e=>{this.updateMarkers()}),this.userTripService.activeTripSelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var a,d;null===(a=this.tripRenderController)||void 0===a||a.renderTrip(null!==(d=null==e?void 0:e.legs)&&void 0!==d?d:[])})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToBounds(r,e)})}),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToLocation(r,e)})}),this.initMap()}ngAfterViewInit(){var e;null===(e=this.mapLoadingPromise)||void 0===e||e.then(i=>{i.resize()})}initMap(){const e=this.mapService.createMap("map_canvas");this.mapLoadingPromise=new Promise((i,r)=>{e.on("load",a=>{i(e),this.onMapLoad(e)})})}updateMarkers(){["From","To"].forEach(i=>{var r;const a="From"===i,d=a?this.userTripService.fromTripLocation:this.userTripService.toTripLocation;this.updateMarkerLocation(a?this.fromMarker:this.toMarker,null!==(r=null==d?void 0:d.location)&&void 0!==r?r:null)}),this.userTripService.isViaEnabled?this.userTripService.viaTripLocations.forEach((i,r)=>{var a;let d=null!==(a=this.viaMarkers[r])&&void 0!==a?a:null;null===d&&(d=this.createViaMarker(i.location,r),this.viaMarkers.push(d)),this.updateMarkerLocation(d,i.location)}):(this.viaMarkers.forEach(i=>{i.remove()}),this.viaMarkers=[])}handleMarkerDrag(e,i){const r=e.getLngLat();let a=bn.Location.initWithLngLat(r.lng,r.lat);this.userTripService.updateTripEndpoint(a,i,"MapDragend")}onMapLoad(e){this.mapService.addControls(e,this.debugXmlPopover,this.userTripService,this.languageService),e.on("contextmenu",i=>{this.showPickupPopup(e,i.lngLat)}),e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(a,d)=>{a?console.error(a):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),this.mapService.addRasterLayers(e),this.tripRenderController=new Xee(e)}showPickupPopup(e,i){let r=document.getElementById("map-endpoint-coords-picker-popup").innerHTML;const a=Bh.formatMapboxLngLatAsLatLng(i);r=r.replace("[PICKER_COORDS]",a);const d=document.createElement("div");d.innerHTML=r,d.addEventListener("click",b=>{const A=b.target.getAttribute("data-endpoint-type");if(null===A)return;const O=bn.Location.initWithLngLat(i.lng,i.lat);this.userTripService.updateTripEndpoint(O,A,"MapPopupClick"),this.popupContextMenu.remove()}),this.popupContextMenu.setLngLat(i).setDOMContent(d).addTo(e)}updateMarkerLocation(e,i){var r,a,d;const b=null!==(a=null===(r=null==i?void 0:i.geoPosition)||void 0===r?void 0:r.asLngLat())&&void 0!==a?a:null;if(null===b)return void e.remove();const x=void 0===e.getLngLat();e.setLngLat(b),x&&(null===(d=this.mapLoadingPromise)||void 0===d||d.then(A=>{e.addTo(A)}))}createViaMarker(e,i){var r;const a=document.createElement("div");a.className="marker-journey-endpoint marker-journey-endpoint-Via";let d=!1;null===(null===(r=e.geoPosition)||void 0===r?void 0:r.properties)&&(d=!0);const b=new(sl().Marker)({element:a,anchor:"bottom",draggable:d});return b.on("dragend",x=>{const A=b.getLngLat();let O=bn.Location.initWithLngLat(A.lng,A.lat);this.userTripService.updateViaPoint(O,i)}),b}}return n.\u0275fac=function(e){return new(e||n)(ue(ia),ue($u),ue(xf),ue(Cc))},n.\u0275cmp=Jt({type:n,selectors:[["app-map"]],decls:48,vars:0,consts:[["id","map_canvas",1,"map_wrapper","h-100"],[1,"d-none"],["id","map-endpoint-coords-picker-popup"],[1,"popup-picker","p-2"],[1,"popup-picker-header","mb-2"],[1,"popup-picker-body"],["type","button","data-endpoint-type","From",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","To",1,"btn","btn-primary","btn-sm"],["type","button","data-endpoint-type","Via",1,"btn","btn-primary","btn-sm"],["id","map-endpoint-stop-picker-popup"],["id","map-endpoint-picker-popup"],["id","map-poi-picker-popup"]],template:function(e,i){1&e&&(rn(0,"div",0),ne(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),Z(5," Coords: [PICKER_COORDS] "),oe(),ne(6,"div",5)(7,"button",6),Z(8,"From"),oe(),ne(9,"button",7),Z(10,"To"),oe(),ne(11,"button",8),Z(12,"Via"),oe()()()(),ne(13,"div",9)(14,"div",3)(15,"div",4),Z(16," [STOP_NAME] ([STOP_ID]) "),oe(),ne(17,"div",5)(18,"button",6),Z(19,"From"),oe(),ne(20,"button",7),Z(21,"To"),oe(),ne(22,"button",8),Z(23,"Via"),oe()()()(),ne(24,"div",10)(25,"div",3)(26,"div",4),Z(27," TYPE: [GEO_RESTRICTION_TYPE] "),oe(),ne(28,"div",5),Z(29," [GEOJSON_PROPERTIES_TABLE] "),ne(30,"button",6),Z(31,"From"),oe(),ne(32,"button",7),Z(33,"To"),oe(),ne(34,"button",8),Z(35,"Via"),oe()()()(),ne(36,"div",11)(37,"div",3)(38,"div",4),Z(39," [POI_NAME] "),oe(),ne(40,"div",5),Z(41," [GEOJSON_PROPERTIES_TABLE] "),ne(42,"button",6),Z(43,"From"),oe(),ne(44,"button",7),Z(45,"To"),oe(),ne(46,"button",8),Z(47,"Via"),oe()()()()())},styles:[".map_wrapper[_ngcontent-%COMP%]{border:1px solid #e5e5e5}.popup-picker-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:2px}"]}),n})();class mD{static computeExecutionTime(t,e){return null===t||null===e?0:(e.getTime()-t.getTime())/1e3}}function Yee(n,t){1&n&&rn(0,"span",10)}let Jee=(()=>{class n{constructor(e){this.userTripService=e,this.tripCustomRequestSaved=new Cn,this.tripCustomResponseSaved=new Cn,this.inputTripRequestXML="... loading",this.inputTripRequestResponseXML="Paste custom OJP TripRequest Response XML here...",this.isRunningTripRequest=!1}parseCustomRequestXML(){this.isRunningTripRequest=!0;const r=bn.TripRequest.initWithRequestMock(this.inputTripRequestXML,"2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,Ps);r.fetchResponse().then(a=>{if("ERROR"===a.message)return console.error("ERROR fetching OJP response"),void console.log(a);const d=r.requestInfo.responseXML;if(null===d)return console.error("ERROR parsing OJP response"),void console.log(r);this.tripCustomRequestSaved.emit(d)})}parseCustomResponseXML(){this.tripCustomResponseSaved.emit(this.inputTripRequestResponseXML)}}return n.\u0275fac=function(e){return new(e||n)(ue(ia))},n.\u0275cmp=Jt({type:n,selectors:[["input-xml-popover"]],outputs:{tripCustomRequestSaved:"tripCustomRequestSaved",tripCustomResponseSaved:"tripCustomResponseSaved"},decls:26,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptriprequest/"],["rows","10",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(ne(0,"div",0),Z(1,"Custom Trip Request / Response XML"),oe(),ne(2,"div",1)(3,"div")(4,"div",2)(5,"div"),Z(6,"Trip Request XML"),oe(),ne(7,"div")(8,"a",3),Z(9,"Cookbook opentransportdata.swiss"),oe()()(),ne(10,"textarea",4),Wt("ngModelChange",function(a){return i.inputTripRequestXML=a}),oe(),ne(11,"div",5)(12,"button",6),Wt("click",function(){return i.parseCustomRequestXML()}),yt(13,Yee,1,0,"span",7),Z(14," Execute OJPTripRequest "),oe()(),rn(15,"hr"),ne(16,"div",2)(17,"div"),Z(18,"Trip Request Response XML"),oe()(),ne(19,"textarea",4),Wt("ngModelChange",function(a){return i.inputTripRequestResponseXML=a}),oe(),ne(20,"div",5)(21,"button",6),Wt("click",function(){return i.parseCustomResponseXML()}),Z(22," Display Trips "),oe()()()(),ne(23,"div",8)(24,"button",9),Z(25," Close "),oe()()),2&e&&(pe(10),Pe("ngModel",i.inputTripRequestXML),pe(2),Pe("disabled",i.isRunningTripRequest),pe(1),Pe("ngIf",i.isRunningTripRequest),pe(6),Pe("ngModel",i.inputTripRequestResponseXML),pe(2),Pe("disabled",i.isRunningTripRequest))},dependencies:[Zo,tu,Uu,Oh,vf,Km,Qm,eg],encapsulation:2}),n})();const Kee=["input"],Qee=["*"],ete=new en("sbb-checkbox-default-options",{providedIn:"root",factory:function Hz(){return{clickAction:"check-indeterminate"}}});const tte={provide:Ua,useExisting:Dr(()=>nte),multi:!0};let nte=(()=>{class n extends mA{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["sbb-checkbox","required","","formControlName",""],["sbb-checkbox","required","","formControl",""],["sbb-checkbox","required","","ngModel",""]],features:[Mi([tte]),Un]}),n})(),ite=0;const rte={clickAction:"check-indeterminate"},ote={provide:$l,useExisting:Dr(()=>c2),multi:!0};class ste{}const ate=Sv(Zl(class{}));let qz=(()=>{class n extends ate{constructor(e,i,r,a,d){super(),this._elementRef=e,this._changeDetectorRef=i,this._focusMonitor=r,this._options=d,this.ariaLabel="",this.ariaLabelledby=null,this._uniqueId="sbb-checkbox-"+ ++ite,this.id=this._uniqueId,this.labelPosition="after",this.name=null,this.change=new Cn,this.indeterminateChange=new Cn,this._onTouched=()=>{},this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||rte,this.tabIndex=parseInt(a,10)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(e){this._required=Ai(e)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{e||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(e){const i=Ai(e);i!==this.checked&&(this._checked=i,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(e){const i=Ai(e);i!==this.disabled&&(this._disabled=i,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(e){const i=e!==this._indeterminate;this._indeterminate=Ai(e),i&&this.indeterminateChange.emit(this._indeterminate),this._syncIndeterminate(this._indeterminate)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(e){this.checked=!!e}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_getAriaChecked(){return this.checked?"true":this.indeterminate?"mixed":"false"}_emitChangeEvent(){const e=new ste;e.source=this,e.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(e)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_onInputClick(e){var i;const r=null===(i=this._options)||void 0===i?void 0:i.clickAction;e.stopPropagation(),this.disabled||"noop"===r?!this.disabled&&"noop"===r&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==r&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._emitChangeEvent())}focus(e,i){e?this._focusMonitor.focusVia(this._inputElement,e,i):this._inputElement.nativeElement.focus(i)}_onInteractionEvent(e){e.stopPropagation()}_syncIndeterminate(e){const i=this._inputElement;i&&(i.nativeElement.indeterminate=e)}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(So),ue(Cl),hs("tabindex"),ue(ete,8))},n.\u0275dir=cn({type:n,viewQuery:function(e,i){if(1&e&&mo(Kee,5),2&e){let r;xi(r=wi())&&(i._inputElement=r.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},features:[Un]}),n})(),c2=(()=>{class n extends qz{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275cmp=Jt({type:n,selectors:[["sbb-checkbox"]],hostAttrs:[1,"sbb-checkbox","sbb-selection-item"],hostVars:10,hostBindings:function(e,i){2&e&&(dr("id",i.id),si("tabindex",null)("aria-label",null)("aria-labelledby",null),_("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckbox"],features:[Mi([ote]),Un],ngContentSelectors:Qee,decls:11,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content",3,"cdkObserveContent"],[2,"display","none"]],template:function(e,i){1&e&&(Rs(),ne(0,"label",0)(1,"input",1,2),Wt("change",function(a){return i._onInteractionEvent(a)})("click",function(a){return i._onInputClick(a)}),oe(),ne(3,"div",3)(4,"span",4),gu(),ne(5,"svg",5),rn(6,"polyline",6),oe()()(),nh(),ne(7,"div",7),Wt("cdkObserveContent",function(){return i._onLabelTextChange()}),ne(8,"span",8),Z(9,"\xa0"),oe(),Co(10),oe()()),2&e&&(si("for",i.inputId),pe(1),Pe("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),si("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},dependencies:[vB],encapsulation:2,changeDetection:0}),n})(),Gz=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[GC,Ur]}),n})(),lte=(()=>{class n{constructor(e){var i,r;this.userTripService=e,this.embedHTMLs="n/a",this.fromLocationText="",this.toLocationText="",this.fromLocationChecked=!1,this.toLocationChecked=!0,this.fromLocationText=n.computeLocationText(null===(i=e.fromTripLocation)||void 0===i?void 0:i.location),this.toLocationText=n.computeLocationText(null===(r=e.toTripLocation)||void 0===r?void 0:r.location),this.updateEmbedHTML()}static computeLocationText(e){var i,r,a,d,b;if(!e)return"";const x=e.getLocationType();if("stop"===x)return e.computeLocationName()+"(stopRef "+(null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"")+")";const A=e.geoPosition;return A?(null!==(a=e.computeLocationName())&&void 0!==a?a:"")+"(coords "+(null!==(d=A.asLatLngString(!0))&&void 0!==d?d:"")+")":x+" - "+(null!==(b=e.computeLocationName())&&void 0!==b?b:"")}updateEmbedHTML(){const e=new URLSearchParams;["from","to"].forEach(a=>{const d=(()=>{if("from"===a?this.fromLocationChecked:this.toLocationChecked){const x=this.userTripService.embedQueryParams.get(a);if(null!==x)return x}return""})();e.append(a,d)});const i=document.location.pathname.replace("/search","/embed/search")+"?"+e.toString(),r=document.location.protocol+"//"+document.location.host+i;this.embedHTMLs='<iframe src="'+r+'" width="100%" height="100%" frameBorder="0"></iframe>'}}return n.\u0275fac=function(e){return new(e||n)(ue(ia))},n.\u0275cmp=Jt({type:n,selectors:[["embed-search-popover"]],decls:20,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[3,"ngModel","ngModelChange","change"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(ne(0,"div",0),Z(1,"Embed journey in another website"),oe(),ne(2,"div",1)(3,"div",2)(4,"p"),Z(5,"Select which journey endpoints should be prefilled:"),oe(),ne(6,"div")(7,"div")(8,"sbb-checkbox",3),Wt("ngModelChange",function(a){return i.fromLocationChecked=a})("change",function(){return i.updateEmbedHTML()}),Z(9),oe()(),ne(10,"div")(11,"sbb-checkbox",3),Wt("ngModelChange",function(a){return i.toLocationChecked=a})("change",function(){return i.updateEmbedHTML()}),Z(12),oe()()(),ne(13,"p"),Z(14,"Copy the following code in the target webpage"),oe(),ne(15,"textarea",4),Z(16),oe()()(),ne(17,"div",5)(18,"button",6),Z(19," Close "),oe()()),2&e&&(pe(8),Pe("ngModel",i.fromLocationChecked),pe(1),De("(From) ",i.fromLocationText,""),pe(2),Pe("ngModel",i.toLocationChecked),pe(1),De("(To) ",i.toLocationText,""),pe(4),de(i.embedHTMLs))},dependencies:[Uu,Oh,c2,vf,Km,Qm,eg],encapsulation:2}),n})(),ute=(()=>{class n{constructor(e){this.http=e}createIssue(e){var i=this;return mr(function*(){(new cf).set("rand",Date.now().toString());const d=i.http.post("https://tools.odpch.ch/github-proxy/ojp_sdk_issue",e);return yield function cte(n,t){const e="object"==typeof t;return new Promise((i,r)=>{const a=new qe({next:d=>{i(d),a.unsubscribe()},error:r,complete:()=>{e?i(t.defaultValue):r(new Zx)}});n.subscribe(a)})}(d)})()}}return n.\u0275fac=function(e){return new(e||n)(Tt(GM))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function dte(n,t){if(1&n&&(ji(0),ne(1,"option",21),Z(2),oe(),Zi()),2&n){const e=t.$implicit;pe(1),Pe("ngValue",e.key),pe(1),De(" ",e.caption," ")}}const u2=function(n){return{"is-invalid":n}};function hte(n,t){if(1&n&&(ji(0),ne(1,"div",8)(2,"div",9)(3,"label",10),Z(4,"Reporter"),oe(),rn(5,"input",11),ne(6,"div",12),Z(7,"Reporter is required"),oe()(),ne(8,"div")(9,"label",13),Z(10,"Project"),oe(),ne(11,"select",14),yt(12,dte,3,2,"ng-container",15),oe()()(),ne(13,"div",16)(14,"label",17),Z(15,"Issue Title"),oe(),rn(16,"input",18),ne(17,"div",12),Z(18,"Title is required"),oe()(),ne(19,"div",16)(20,"label",19),Z(21,"Issue Description"),oe(),rn(22,"textarea",20),ne(23,"div",12),Z(24,"Title is required"),oe()(),Zi()),2&n){const e=St();pe(5),Pe("ngClass",Jc(4,u2,e.f.issueReporter.invalid&&e.f.issueReporter.touched)),pe(7),Pe("ngForOf",e.model.projects),pe(4),Pe("ngClass",Jc(6,u2,e.f.issueTitle.invalid&&e.f.issueTitle.touched)),pe(6),Pe("ngClass",Jc(8,u2,e.f.issueDescription.invalid&&e.f.issueDescription.touched))}}function pte(n,t){if(1&n&&(ji(0),ne(1,"a",22),Z(2),oe(),Zi()),2&n){const e=St();pe(1),Pe("href",e.model.issueURL,zo),pe(1),de(e.model.issueURL)}}let fte=(()=>{class n{constructor(e,i){this.httpService=e,this.fb=i,this.requestInfo=null,this.model={issueButtonCaption:"Create Issue",issueCreationState:"IDLE",issueURL:null,projects:[{key:"ojp2_backend_issues",caption:"OJP 2.0 Backend Issues"},{key:"ojp_siri_sx_current",caption:"OJP DemoApp"}]},this.form=this.fb.group({issueReporter:["",Yy.required],issueTitle:["",Yy.required],issueDescription:["",Yy.required],projectId:["ojp2_backend_issues"]}),this.metadataRows=[]}ngOnInit(){}ngAfterViewInit(){}onSubmit(){var e=this;return mr(function*(){if(e.form.invalid)return void e.form.markAllAsTouched();const i=e.metadataRows.slice();i.unshift("reporter: "+e.form.controls.issueReporter.value.trim()),i.unshift("","","----","");const a=i.join("\n"),d=e.form.controls.issueDescription.value.trim()+a;e.setInputValue("issueDescription",d),yield e.createIssue()})()}get f(){return this.form.controls}createIssue(){var e=this;return mr(function*(){if(null===e.requestInfo||null===e.requestInfo.requestXML||null===e.requestInfo.responseXML)return;const d={title:e.form.controls.issueTitle.value.trim(),description:e.form.controls.issueDescription.value.trim(),requestXML:e.requestInfo.requestXML,responseXML:e.requestInfo.responseXML,projectKey:e.form.controls.projectId.value};e.model.issueCreationState="PROCESSING",e.model.issueButtonCaption="Creating Issue ...";const b=yield e.httpService.createIssue(d);e.model.issueCreationState="DONE",e.model.issueButtonCaption="Done",e.model.issueURL=b.issue_url})()}setInputValue(e,i){this.form.controls[e].setValue(i)}updateMetadataRows(e){const i=`${screen.width}x${screen.height} - ratio ${window.devicePixelRatio}x`,r=`${window.innerWidth}x${window.innerHeight}`,a=navigator.userAgent;this.metadataRows=["URL: "+e,"OJP version: "+Mo,"ojp-sdk-legacy version: "+bn.SDK_VERSION,"ojp-sdk-next version: "+aB,"viewport-resolution: "+r,"screen-resolution: "+i,"user-agent:"+a]}}return n.\u0275fac=function(e){return new(e||n)(ue(ute),ue(zG))},n.\u0275cmp=Jt({type:n,selectors:[["report-issue"]],decls:14,vars:5,consts:[["sbbDialogTitle",""],["sbbDialogContent","",1,"d-flex","flex-column","h-100"],["novalidate","",3,"formGroup","ngSubmit"],[4,"ngIf"],[1,"d-flex","gap-2","align-items-center"],["type","submit",1,"btn","btn-primary","btn-sm",3,"disabled"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],[1,"mb-3","d-flex","gap-2"],[1,"flex-grow-1"],["for","issueReporter",1,"form-label"],["type","text","id","issueReporter","formControlName","issueReporter",1,"form-control",3,"ngClass"],[1,"invalid-feedback"],["for","projectId",1,"form-label"],["id","projectId","formControlName","projectId",1,"form-control"],[4,"ngFor","ngForOf"],[1,"mb-3"],["for","issueTitle",1,"form-label"],["type","text","id","issueTitle","formControlName","issueTitle",1,"form-control",3,"ngClass"],["for","issueDescription",1,"form-label"],["id","issueDescription","rows","8","formControlName","issueDescription",1,"form-control",3,"ngClass"],[3,"ngValue"],["target","_blank",3,"href"]],template:function(e,i){1&e&&(ne(0,"div",0)(1,"strong"),Z(2,"Report new issue"),oe()(),ne(3,"div",1)(4,"form",2),Wt("ngSubmit",function(){return i.onSubmit()}),yt(5,hte,25,10,"ng-container",3),ne(6,"div",4)(7,"div")(8,"button",5),Z(9),oe()(),yt(10,pte,3,2,"ng-container",3),oe()()(),ne(11,"div",6)(12,"button",7),Z(13,"Close"),oe()()),2&e&&(pe(4),Pe("formGroup",i.form),pe(1),Pe("ngIf","DONE"!==i.model.issueCreationState),pe(3),Pe("disabled","IDLE"!==i.model.issueCreationState),pe(1),de(i.model.issueButtonCaption),pe(1),Pe("ngIf",null!==i.model.issueURL))},dependencies:[rf,Sl,Zo,vF,dA,pA,tu,qT,Uu,rF,E_,uA,vf,Km,Qm,eg],encapsulation:2}),n})();function mte(n,t){}const $z=new en("SbbNotificationToastData");class gD{constructor(){this.politeness="assertive",this.duration=0,this.data=null,this.verticalPosition="bottom",this.type="success"}}const gte={notificationState:Aa("state",[_o("void, hidden",bi({transform:"scale(0.8)",opacity:0})),_o("visible",bi({transform:"scale(1)",opacity:1})),jr("* => visible",Kr("150ms cubic-bezier(0, 0, 0.2, 1)")),jr("* => void, * => hidden",Kr("75ms cubic-bezier(0.4, 0.0, 1, 1)",bi({opacity:0})))])};let _te=(()=>{class n extends k1{constructor(e,i,r,a){super(),this._ngZone=e,this._elementRef=i,this._changeDetectorRef=r,this.config=a,this._destroyed=!1,this._onExit=new On,this._onEnter=new On,this._animationState="void",this.attachDomPortal=d=>{this._assertNotAttached();const b=this._portalOutlet.attachDomPortal(d);return this._afterPortalAttached(),b},this._role="assertive"!==a.politeness||a.announcementMessage?"off"===a.politeness?null:"status":"alert"}get _svgIcon(){switch(this.config.type){case"success":return"kom:tick-small";case"error":case"warn":return"kom:sign-exclamation-point-small";default:return"kom:circle-information-small"}}attachComponentPortal(e){this._assertNotAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}onAnimationEnd(e){const{fromState:i,toState:r}=e;if(("void"===r&&"void"!==i||"hidden"===r)&&this._completeExit(),"visible"===r){const a=this._onEnter;this._ngZone.run(()=>{a.next(),a.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("sbb-exit",""),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(Ho(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){const e=this._elementRef.nativeElement,i=this.config.panelClass;i&&(Array.isArray(i)?i.forEach(r=>e.classList.add(r)):e.classList.add(i)),e.classList.add("sbb-notification-toast-center")}_assertNotAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach notification content after content is already attached")}}return n.\u0275fac=function(e){return new(e||n)(ue(Ui),ue(ci),ue(So),ue(gD))},n.\u0275dir=cn({type:n,viewQuery:function(e,i){if(1&e&&mo(jh,7),2&e){let r;xi(r=wi())&&(i._portalOutlet=r.first)}},features:[Un]}),n})(),bte=(()=>{class n extends _te{_afterPortalAttached(){super._afterPortalAttached(),"top"===this.config.verticalPosition&&this._elementRef.nativeElement.classList.add("sbb-notification-toast-top")}}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275cmp=Jt({type:n,selectors:[["sbb-notification-toast-container"]],hostAttrs:[1,"sbb-notification-toast"],hostVars:10,hostBindings:function(e,i){1&e&&Eh("@state.done",function(a){return i.onAnimationEnd(a)}),2&e&&(si("role",i._role),Qs("@state",i._animationState),_("sbb-notification-toast-success","success"===i.config.type)("sbb-notification-toast-info","info"===i.config.type)("sbb-notification-toast-warn","warn"===i.config.type)("sbb-notification-toast-error","error"===i.config.type))},features:[Un],decls:6,vars:1,consts:[[1,"sbb-notification-toast-icon-wrapper","sbb-icon-fit"],[3,"svgIcon"],[1,"sbb-notification-toast-content"],["cdkPortalOutlet",""],["type","button",1,"sbb-notification-toast-icon-wrapper","sbb-notification-toast-icon-close-wrapper","sbb-icon-fit",3,"click"],["svgIcon","kom:cross-small"]],template:function(e,i){1&e&&(ne(0,"span",0),rn(1,"sbb-icon",1),oe(),ne(2,"div",2),yt(3,mte,0,0,"ng-template",3),oe(),ne(4,"button",4),Wt("click",function(){return i.exit()}),rn(5,"sbb-icon",5),oe()),2&e&&(pe(1),Pe("svgIcon",i._svgIcon))},dependencies:[jh,cl],styles:[".sbb-notification-toast{display:flex;min-height:calc(3.2rem * var(--sbb-scaling-factor));border-radius:var(--sbb-border-radius);color:var(--sbb-color-white);background-color:var(--sbb-color-background);font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);padding-top:calc(0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin));padding-bottom:calc(\n    0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin) - var(\n        --sbb-line-height\n      ) + var(--sbb-icon-size-default)\n  );margin:calc(1.3333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-notification-toast{padding-bottom:calc(\n      0.8rem * var(--sbb-scaling-factor) - var(--sbb-border-width-thin)\n    )}.sbb-notification-toast-mobile .sbb-notification-toast{margin:calc(0.5333333333rem * var(--sbb-scaling-factor));max-width:100%;min-width:0;width:100%}.sbb-notification-toast-mobile{width:100%}.sbb-notification-toast-error{background-color:var(--sbb-color-error)}:is(.sbb-notification-toast-error,.sbb-notification-toast-error :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-success{border:var(--sbb-border-width-thin) solid var(--sbb-color-green)}:is(.sbb-notification-toast-success,.sbb-notification-toast-success :is(a,button)){color:var(--sbb-color-green)}.sbb-notification-toast-info{border:var(--sbb-border-width-thin) solid var(--sbb-color-granite)}:is(.sbb-notification-toast-info,.sbb-notification-toast-info :is(a,button)){color:var(--sbb-color-granite)}.sbb-notification-toast-warn{background-color:var(--sbb-color-orange)}:is(.sbb-notification-toast-warn,.sbb-notification-toast-warn :is(a,button)){color:var(--sbb-color-white)}.sbb-notification-toast-content{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor));margin-right:calc(1.6rem * var(--sbb-scaling-factor))}.sbb-notification-toast-icon-wrapper{min-width:var(--sbb-icon-size-default);width:var(--sbb-icon-size-default);height:var(--sbb-icon-size-default);margin-left:calc(1.0666666667rem * var(--sbb-scaling-factor));border:none;background:none;padding:0;align-self:flex-start}.sbb-notification-toast-icon-close-wrapper{cursor:pointer;margin-left:auto;margin-right:calc(1.4666666667rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[gte.notificationState]}}),n})();const yte=Math.pow(2,31)-1;class d2{constructor(t,e){this._overlayRef=e,this._afterDismissed=new On,this._afterOpened=new On,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,yte))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._afterDismissed.next(null),this._afterDismissed.complete()}afterDismissed(){return this._afterDismissed.asObservable()}afterOpened(){return this.containerInstance._onEnter}}let vte=(()=>{class n{constructor(e,i){this.notificationToastRef=e,this.data=i}dismiss(){this.notificationToastRef.dismiss()}}return n.\u0275fac=function(e){return new(e||n)(ue(d2),ue($z))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-simple-notification"]],decls:2,vars:1,template:function(e,i){1&e&&(ne(0,"span"),Z(1),oe()),2&e&&(pe(1),de(i.data.message))},encapsulation:2,changeDetection:0}),n})(),h2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,ll,Tc,Ur,Ss]}),n})();const xte=new en("notification-default-options",{providedIn:"root",factory:function wte(){return new gD}});let p2=(()=>{class n{constructor(e,i,r,a,d,b){this._overlay=e,this._injector=i,this._live=r,this._breakpointObserver=a,this._parentNotification=d,this._defaultConfig=b,this._notificationRefAtThisLevel=null,this._simpleNotificationToastComponent=vte,this._notificationToastContainerComponent=bte,this._mobileDeviceCssClass="sbb-notification-toast-mobile"}get _openedNotificationRef(){const e=this._parentNotification;return e?e._openedNotificationRef:this._notificationRefAtThisLevel}set _openedNotificationRef(e){this._parentNotification?this._parentNotification._openedNotificationRef=e:this._notificationRefAtThisLevel=e}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i){const r=Object.assign(Object.assign({},this._defaultConfig),i);return r.data={message:e},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this._simpleNotificationToastComponent,r)}dismiss(){this._openedNotificationRef&&this._openedNotificationRef.dismiss()}ngOnDestroy(){this._notificationRefAtThisLevel&&this._notificationRefAtThisLevel.dismiss()}_attachNotificationToastContainer(e,i){var r;const a=null===(r=null==i?void 0:i.viewContainerRef)||void 0===r?void 0:r.injector,d=new HB(a||this._injector,new WeakMap([[gD,i]])),b=new Vh(this._notificationToastContainerComponent,i.viewContainerRef,d),x=e.attach(b);return x.instance.config=i,x.instance}_attach(e,i){const r=Object.assign(Object.assign(Object.assign({},new gD),this._defaultConfig),i),a=this._createOverlay(r),d=this._attachNotificationToastContainer(a,r),b=new d2(d,a);if(e instanceof ls){const x=new W_(e,null,{$implicit:r.data,notificationRef:b});b.instance=d.attachTemplatePortal(x)}else{const x=this._createInjector(r,b),A=new Vh(e,void 0,x),O=d.attachComponentPortal(A);b.instance=O.instance}return this._breakpointObserver.observe("(max-width: 642.99px) and (orientation: portrait)").pipe(Mr(a.detachments())).subscribe(x=>{const A=a.overlayElement.classList;x.matches?A.add(this._mobileDeviceCssClass):A.remove(this._mobileDeviceCssClass)}),this._animateNotification(b,r),this._openedNotificationRef=b,this._openedNotificationRef}_animateNotification(e,i){e.afterDismissed().subscribe(()=>{this._openedNotificationRef===e&&(this._openedNotificationRef=null),i.announcementMessage&&this._live.clear()}),this._openedNotificationRef?(this._openedNotificationRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedNotificationRef.dismiss()):e.containerInstance.enter(),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),i.announcementMessage&&this._live.announce(i.announcementMessage,i.politeness)}_createOverlay(e){const i=new X_,r=this._overlay.position().global();return r.centerHorizontally(),"top"===e.verticalPosition?r.top("0"):r.bottom("0"),i.positionStrategy=r,this._overlay.create(i)}_createInjector(e,i){var r;const a=null===(r=null==e?void 0:e.viewContainerRef)||void 0===r?void 0:r.injector;return new HB(a||this._injector,new WeakMap([[d2,i],[$z,e.data]]))}}return n.\u0275fac=function(e){return new(e||n)(Tt(Gs),Tt(Jo),Tt(OB),Tt($C),Tt(n,12),Tt(xte))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:h2}),n})();const Ste=["sbb-button",""];function Tte(n,t){1&n&&rn(0,"sbb-icon",2),2&n&&Pe("svgIcon",St().svgIcon)}function Cte(n,t){1&n&&rn(0,"sbb-icon",3),2&n&&Pe("svgIcon",St().svgIcon)}const Dte=["*"],Ete=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button","sbb-frameless-button","sbb-link"],Ite=["sbb-button","sbb-secondary-button","sbb-frameless-button","sbb-link"],Mte=["sbb-button","sbb-alt-button","sbb-secondary-button","sbb-ghost-button"],Wz={"sbb-button":"kom:arrow-right-small","sbb-secondary-button":"kom:arrow-right-small","sbb-frameless-button":"kom:plus-small","sbb-link":"kom:arrow-right-small"},Ate=Zl(Y_(class{constructor(n){this._elementRef=n}}));let f2=(()=>{class n extends Ate{constructor(e,i,r,a){super(e),this._focusMonitor=i,this._animationMode=r,this._contentObserver=a,this._hasIconIndicator=this._hasHostAttributes(...Ite),this._hasIconButtonClass=!1,this._iconRefs=new v_;for(const d of Ete)this._hasHostAttributes(d)&&(this._getHostElement().classList.add(d),d in Wz&&(this.svgIcon=Wz[d]));e.nativeElement.classList.add("sbb-button-base")}ngAfterContentInit(){var e,i;const r=null!==(i=null===(e=this._contentObserver)||void 0===e?void 0:e.observe(this._elementRef))&&void 0!==i?i:this._iconRefs.changes;this._isIconButton=null==r?void 0:r.pipe(Ra([]),st(()=>this._hasHostAttributes(...Mte)&&""===this._elementRef.nativeElement.textContent.trim()&&1===this._iconRefs.length)),this._isIconButton.subscribe(a=>this._hasIconButtonClass=a),this._leftIconVisible=M_([this.variant,this._isIconButton]).pipe(st(([a,d])=>!d&&"standard"===a&&this._hasIconIndicator)),this._rightIconVisible=M_([this.variant,this._isIconButton]).pipe(st(([a,d])=>!d&&("standard"===a&&this._hasIconIndicator||"lean"===a&&this._hasHostAttributes("sbb-link"))))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,i){e?this._focusMonitor.focusVia(this._getHostElement(),e,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_hasHostAttributes(...e){return e.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(Cl),ue(Ah,8),ue(yB,8))},n.\u0275cmp=Jt({type:n,selectors:[["button","sbb-button",""],["button","sbb-alt-button",""],["button","sbb-secondary-button",""],["button","sbb-ghost-button",""],["button","sbb-frameless-button",""],["button","sbb-link",""]],contentQueries:function(e,i,r){if(1&e&&Uo(r,cl,4,ci),2&e){let a;xi(a=wi())&&(i._iconRefs=a)}},hostVars:7,hostBindings:function(e,i){2&e&&(si("disabled",i.disabled||null),_("_sbb-animation-noopable","NoopAnimations"===i._animationMode)("sbb-disabled",i.disabled)("sbb-icon-button",i._hasIconButtonClass))},inputs:{disabled:"disabled",svgIcon:"svgIcon"},exportAs:["sbbButton"],features:[Un],attrs:Ste,ngContentSelectors:Dte,decls:5,vars:6,consts:[["class","sbb-button-indicator-icon sbb-button-left-icon",3,"svgIcon",4,"ngIf"],["class","sbb-button-indicator-icon sbb-button-right-icon",3,"svgIcon",4,"ngIf"],[1,"sbb-button-indicator-icon","sbb-button-left-icon",3,"svgIcon"],[1,"sbb-button-indicator-icon","sbb-button-right-icon",3,"svgIcon"]],template:function(e,i){1&e&&(Rs(),yt(0,Tte,1,1,"sbb-icon",0),Uy(1,"async"),Co(2),yt(3,Cte,1,1,"sbb-icon",1),Uy(4,"async")),2&e&&(Pe("ngIf",Hy(1,2,i._leftIconVisible)&&i.svgIcon),pe(3),Pe("ngIf",Hy(4,4,i._rightIconVisible)&&i.svgIcon))},dependencies:[Zo,cl,kx],encapsulation:2,changeDetection:0}),n})(),m2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur,Ss]}),n})();const Pte=["connectionContainer"];function kte(n,t){if(1&n&&(ji(0),ne(1,"span"),Z(2),oe(),Zi()),2&n){const e=St();pe(2),de(e.label)}}function Lte(n,t){1&n&&Co(0,1,["*ngSwitchCase","true"])}function Ote(n,t){1&n&&Co(0,2,["*ngIf","_hasErrors()"])}const Fte=["*",[["sbb-label"]],[["sbb-error"],["","sbbError",""]]],Nte=["*","sbb-label","sbb-error,[sbbError]"];let Bte=0;const Xz=new en("SbbError");let zte=(()=>{class n{constructor(e,i){this.id="sbb-error-"+Bte++,e||i.nativeElement.setAttribute("aria-live","polite")}}return n.\u0275fac=function(e){return new(e||n)(hs("aria-live"),ue(ci))},n.\u0275dir=cn({type:n,selectors:[["sbb-error"],["","sbbError",""]],hostAttrs:["aria-atomic","true",1,"sbb-error"],hostVars:1,hostBindings:function(e,i){2&e&&si("id",i.id)},inputs:{id:"id"},features:[Mi([{provide:Xz,useExisting:n}])]}),n})();class U1{}let H1=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275dir=cn({type:n,selectors:[["sbb-label"]],hostAttrs:[1,"sbb-label"]}),n})(),Vte=0;const _D=new en("SBB_FORM_FIELD");let Dv=(()=>{class n{constructor(e,i){this._elementRef=e,this._changeDetectorRef=i,this._destroyed=new On,this._labelId="sbb-form-field-label-"+Vte++}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(e){this._explicitFormFieldControl=e}getLabelId(){return this._hasLabel()||this.label?this._labelId:null}ngAfterContentInit(){this._validateControlChild();const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`sbb-form-field-type-${e.controlType}`),e.stateChanges.pipe(Ra(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(Mr(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._errorChildren.changes.pipe(Ra(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()})}ngAfterContentChecked(){this._validateControlChild()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(e){const i=this._control?this._control.ngControl:null;return i&&i[e]}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_hasErrors(){return!!(this._errorChildren&&this._errorChildren.length&&this._control.errorState)}_syncDescribedByIds(){if(this._control){const e=[];this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),this._errorChildren&&e.push(...this._errorChildren.map(i=>i.id)),this._control.setDescribedByIds(e)}}_validateControlChild(){}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(So))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-form-field"]],contentQueries:function(e,i,r){if(1&e&&(Uo(r,U1,5),Uo(r,U1,7),Uo(r,H1,5),Uo(r,H1,7),Uo(r,Xz,5)),2&e){let a;xi(a=wi())&&(i._controlNonStatic=a.first),xi(a=wi())&&(i._controlStatic=a.first),xi(a=wi())&&(i._labelChildNonStatic=a.first),xi(a=wi())&&(i._labelChildStatic=a.first),xi(a=wi())&&(i._errorChildren=a)}},viewQuery:function(e,i){if(1&e&&mo(Pte,7),2&e){let r;xi(r=wi())&&(i._connectionContainerRef=r.first)}},hostAttrs:[1,"sbb-form-field"],hostVars:20,hostBindings:function(e,i){2&e&&_("sbb-form-field-invalid",null==i._control?null:i._control.errorState)("sbb-form-field-disabled",null==i._control?null:i._control.disabled)("sbb-focused",null==i._control?null:i._control.focused)("ng-untouched",i._shouldForward("untouched"))("ng-touched",i._shouldForward("touched"))("ng-pristine",i._shouldForward("pristine"))("ng-dirty",i._shouldForward("dirty"))("ng-valid",i._shouldForward("valid"))("ng-invalid",i._shouldForward("invalid"))("ng-pending",i._shouldForward("pending"))},inputs:{label:"label"},exportAs:["sbbFormField"],features:[Mi([{provide:_D,useExisting:n}])],ngContentSelectors:Nte,decls:10,vars:9,consts:[[1,"sbb-form-field-wrapper"],[1,"sbb-form-field-label-wrapper",3,"click"],[1,"sbb-label","sbb-form-field-label",3,"id","ngSwitch"],[4,"ngSwitchCase"],[1,"sbb-form-field-input-wrapper"],["connectionContainer",""],[1,"sbb-form-field-error-wrapper"],[4,"ngIf"]],template:function(e,i){1&e&&(Rs(Fte),ne(0,"div",0)(1,"div",1),Wt("click",function(a){return i._control.onContainerClick&&i._control.onContainerClick(a)}),ne(2,"label",2),yt(3,kte,3,1,"ng-container",3),yt(4,Lte,1,0,"ng-content",3),oe()(),ne(5,"div",4,5),Co(7),oe(),ne(8,"div",6),yt(9,Ote,1,0,"ng-content",7),oe()()),2&e&&(pe(2),_("sbb-form-field-empty",i._control.empty),Pe("id",i._labelId)("ngSwitch",i._hasLabel()),si("for",i._control.id)("aria-owns",i._control.id),pe(1),Pe("ngSwitchCase",!1),pe(1),Pe("ngSwitchCase",!0),pe(5),Pe("ngIf",i._hasErrors()))},dependencies:[Zo,Xy,aT],styles:[".sbb-form-field{display:inline-block;position:relative;width:var(--sbb-form-field-width)}.sbb-form-field-short{width:33.333%}@media all and (min-width: 26.3125em){.sbb-form-field-short{width:25%}}@media all and (min-width: 64.0625em){.sbb-form-field-short{width:16.66666%}}.sbb-form-field-medium{width:100%}@media all and (min-width: 40.1875em){.sbb-form-field-medium{width:50%}}.sbb-form-field-long{width:100%}.sbb-form-field-wrapper{padding-bottom:calc(1.5333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-form-field-wrapper{padding-bottom:1.0666666667rem}.sbb-form-field-flexible-errors .sbb-form-field-wrapper{padding-bottom:0}.sbb-form-field-label-wrapper{margin-bottom:var(--sbb-form-label-wrapper-margin-bottom);padding-left:var(--sbb-form-label-wrapper-padding-left)}.sbb-form-field .sbb-input-element{width:100%;max-width:100%}.sbb-form-field textarea.sbb-input-element{resize:vertical;overflow:auto}.sbb-form-field textarea.sbb-input-element.cdk-textarea-autosize{resize:none}.sbb-form-field-error-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.sbb-form-field-flexible-errors .sbb-form-field-error-wrapper{position:relative}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) :is(.sbb-icon,.sbb-tooltip-icon),:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-icon svg{vertical-align:bottom;width:calc(1.0666666667rem * var(--sbb-scaling-factor));height:calc(1.0666666667rem * var(--sbb-scaling-factor))}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-icon:not(:hover):not(:focus){color:inherit}:is(.sbb-form-field-error-wrapper,.sbb-form-field-label-wrapper) .sbb-tooltip-trigger{margin-left:calc(0.5333333333rem * var(--sbb-scaling-factor))}.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap,.sbb-form-group-vertical{display:flex;gap:var(--sbb-divider-thin)}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap){align-items:flex-start}.sbb-form-group-wrap{flex-wrap:wrap}.sbb-form-group-center{justify-content:center}:is(.sbb-form-group,.sbb-form-group-center,.sbb-form-group-wrap):where(:not(.sbb-form-group-vertical)) :is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){margin-top:calc(var(--sbb-form-label-line-height) + var(--sbb-form-label-wrapper-margin-bottom))}.sbb-form-group-vertical{flex-direction:column}.sbb-form-group-vertical.sbb-form-group-center{justify-content:inherit;align-items:center}.sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button){width:var(--sbb-form-field-width)}:where(html:not(.sbb-lean)) .sbb-form-group-vertical>:is(.sbb-button,.sbb-alt-button,.sbb-secondary-button,.sbb-ghost-button,.sbb-icon-button) .sbb-button-right-icon{right:unset !important}"],encapsulation:2,changeDetection:0}),n})(),bD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur]}),n})();const Zz=Gm({passive:!0});let jte=(()=>{class n{constructor(e,i){this._platform=e,this._ngZone=i,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return uo;const i=H_(e),r=this._monitoredElements.get(i);if(r)return r.subject;const a=new On,d="cdk-text-field-autofilled",b=x=>{"cdk-text-field-autofill-start"!==x.animationName||i.classList.contains(d)?"cdk-text-field-autofill-end"===x.animationName&&i.classList.contains(d)&&(i.classList.remove(d),this._ngZone.run(()=>a.next({target:x.target,isAutofilled:!1}))):(i.classList.add(d),this._ngZone.run(()=>a.next({target:x.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{i.addEventListener("animationstart",b,Zz),i.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(i,{subject:a,unlisten:()=>{i.removeEventListener("animationstart",b,Zz)}}),a}stopMonitoring(e){const i=H_(e),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}}return n.\u0275fac=function(e){return new(e||n)(Tt(ga),Tt(Ui))},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),g2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({}),n})();const Yz=new en("SBB_INPUT_VALUE_ACCESSOR");let Ute=0;const Hte=["button","checkbox","file","hidden","image","radio","range","reset","submit"],qte=QC(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new On}});let J_=(()=>{class n extends qte{constructor(e,i,r,a,d,b,x,A,O){super(b,a,d,r),this._elementRef=e,this._platform=i,this.ngControl=r,this._autofillMonitor=A,this.focused=!1,this.controlType="sbb-input",this.autofilled=!1,this._disabled=!1,this.id="sbb-native-input-"+Ute++,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(te=>hB().has(te)),this._iOSKeyupListener=te=>{const se=te.target;!se.value&&0===se.selectionStart&&0===se.selectionEnd&&(se.setSelectionRange(1,1),se.setSelectionRange(0,0))};const B=this._elementRef.nativeElement,X=B.nodeName.toLowerCase();this._inputValueAccessor=x||B,this._previousNativeValue=this.value,i.IOS&&O.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isNativeSelect="select"===X,this._isTextarea="textarea"===X,this._isNativeSelect&&(this.controlType=B.multiple?"sbb-native-select-multiple":"sbb-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(e){this._disabled=Ai(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get required(){return this._required}set required(e){this._required=Ai(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&hB().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=Ai(e)}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()}),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_validateType(){Hte.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){const e=this._elementRef.nativeElement.validity;return e&&e.badInput}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(ga),ue(nu,10),ue(Ky,8),ue(E_,8),ue(JR),ue(Yz,10),ue(jte),ue(Ui))},n.\u0275dir=cn({type:n,selectors:[["input","sbbInput",""],["select","sbbInput",""],["textarea","sbbInput",""]],hostAttrs:[1,"sbb-input-element"],hostVars:9,hostBindings:function(e,i){1&e&&Wt("focus",function(){return i._focusChanged(!0)})("blur",function(){return i._focusChanged(!1)}),2&e&&(dr("disabled",i.disabled)("required",i.required),si("id",i.id)("name",i.name||null)("readonly",i.readonly&&!i._isNativeSelect||null)("aria-invalid",i.empty&&i.required?null:i.errorState)("aria-required",i.required)("placeholder",i.readonly?"-":i.placeholder||null)("tabindex",i.empty&&i.readonly?-1:null))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["sbbInput"],features:[Mi([{provide:U1,useExisting:n}]),Un,ho]}),n})(),Jz=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[g2,Ur,bD,g2,bD]}),n})();const Gte=["sbb-calendar-body",""];function $te(n,t){1&n&&rn(0,"td",4),2&n&&si("colspan",St(2).firstRowOffset)}function Wte(n,t){if(1&n){const e=or();ne(0,"td",5)(1,"button",6),Wt("click",function(){const a=Qn(e).$implicit;return ei(St(2).cellClicked(a))})("focus",function(r){const d=Qn(e).$implicit;return ei(St(2)._emitActiveDateChange(d,r))}),ne(2,"div",7),Z(3),oe()()()}if(2&n){const e=t.$implicit,i=t.index,r=St().index,a=St();p("width",100/a.numCols,"%"),si("data-sbb-row",r)("data-sbb-col",i),pe(1),_("sbb-calendar-body-disabled",!e.enabled)("sbb-calendar-body-active",a.isActiveCell(r,i))("sbb-calendar-body-range-background","range"===e.rangeBackground)("sbb-calendar-body-range-background-offset-start",null!==e.rangeBackground&&0===r&&a.firstRowOffset&&0===i)("sbb-calendar-body-selected-begin","begin"===e.rangeBackground)("sbb-calendar-body-selected-end","end"===e.rangeBackground)("sbb-calendar-body-selected",a.selectedValue===e.value)("sbb-calendar-body-today",a.todayValue===e.value),Pe("tabindex",a.isActiveCell(r,i)?0:-1),si("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",a.selectedValue===e.value)("aria-current",a.todayValue===e.value?"date":null),pe(2),de(e.displayValue)}}function Xte(n,t){if(1&n&&(ne(0,"tr",1),yt(1,$te,1,1,"td",2),yt(2,Wte,4,26,"td",3),oe()),2&n){const e=t.$implicit,i=t.index,r=St();pe(1),Pe("ngIf",0===i&&r.firstRowOffset),pe(1),Pe("ngForOf",e)}}function Zte(n,t){if(1&n&&(ne(0,"th")(1,"span",5),Z(2),oe(),ne(3,"span",6),Z(4),oe()()),2&n){const e=t.$implicit;pe(2),de(e.long),pe(2),de(e.narrow)}}function Yte(n,t){}function Jte(n,t){if(1&n){const e=or();ne(0,"button",3),Wt("click",function(){return Qn(e),ei(St().prevDay())}),rn(1,"sbb-icon",4),oe()}if(2&n){const e=St();Pe("disabled",e.disabled),si("aria-label",e.prevDayAriaLabel)}}function Kte(n,t){1&n&&rn(0,"sbb-datepicker-toggle")}function Qte(n,t){if(1&n){const e=or();ne(0,"button",5),Wt("click",function(){return Qn(e),ei(St().nextDay())}),rn(1,"sbb-icon",6),oe()}if(2&n){const e=St();Pe("disabled",e.disabled),si("aria-label",e.nextDayAriaLabel)}}const ene=["*"];class tne{constructor(t,e,i,r,a){this.value=t,this.displayValue=e,this.ariaLabel=i,this.enabled=r,this.rangeBackground=a}}let Kz=(()=>{class n{constructor(e,i){this._elementRef=e,this._ngZone=i,this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.selectedValueChange=new Cn,this.activeDateChange=new Cn}ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this.focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}cellClicked(e){!this.allowDisabledSelection&&!e.enabled||this.selectedValueChange.emit(e.value)}_emitActiveDateChange(e,i){e.enabled&&this.activeDateChange.emit(e.value)}get firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}isActiveCell(e,i){let r=e*this.numCols+i;return e&&(r-=this.firstRowOffset),r===this.activeCell}focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(Ho(1)).subscribe(()=>{setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector(".sbb-calendar-body-active");e&&e.focus()})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(Ui))},n.\u0275cmp=Jt({type:n,selectors:[["","sbb-calendar-body",""]],hostAttrs:["role","grid",1,"sbb-calendar-body"],hostVars:1,hostBindings:function(e,i){2&e&&si("aria-readonly",!0)},inputs:{label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell"},outputs:{selectedValueChange:"selectedValueChange",activeDateChange:"activeDateChange"},exportAs:["sbbCalendarBody"],attrs:Gte,decls:1,vars:1,consts:[["role","row",4,"ngFor","ngForOf"],["role","row"],["class","sbb-calendar-body-label",4,"ngIf"],["role","gridcell","class","sbb-calendar-body-cell-container",3,"width",4,"ngFor","ngForOf"],[1,"sbb-calendar-body-label"],["role","gridcell",1,"sbb-calendar-body-cell-container"],["type","button",1,"sbb-calendar-body-cell","sbb-button-reset-frameless",3,"tabindex","click","focus"],[1,"sbb-calendar-body-cell-content"]],template:function(e,i){1&e&&yt(0,Xte,3,2,"tr",0),2&e&&Pe("ngForOf",i.rows)},dependencies:[Sl,Zo],encapsulation:2,changeDetection:0}),n})();function K_(n){return Error(`SbbDatepicker: No provider found for ${n}.`)}class Qz{constructor(t,e){this.start=t,this.end=e}}const _2=new en("SBB_DATEPICKER");let e4=(()=>{class n{constructor(e,i,r,a,d){if(this._dateAdapter=e,this.locale=i,this._changeDetectorRef=r,this._dateFormats=a,this.selectedChange=new Cn,this.userSelection=new Cn,this.activeDateChange=new Cn,this.dateRange=null,!this._dateAdapter)throw K_("DateAdapter");if(!this._dateFormats)throw K_("SBB_DATE_FORMATS");d&&d.connected&&d.datepickerInput.value&&d.connected.datepickerInput.value?this.dateRange=new Qz(d.datepickerInput.value,d.connected.datepickerInput.value):d&&d.main&&d.datepickerInput.value&&d.main.datepickerInput.value&&(this.dateRange=new Qz(d.main.datepickerInput.value,d.datepickerInput.value));const b=this._dateAdapter.getFirstDayOfWeek(),x=this._dateAdapter.getDayOfWeekNames("narrow"),O=this._dateAdapter.getDayOfWeekNames("long").map((B,X)=>({long:B,narrow:x[X]}));this.weekdays=O.slice(b).concat(O.slice(0,b)),this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(e){const i=this._activeDate,r=this._getValidDateOrNull(this._dateAdapter.deserialize(e))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this.init()}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this.selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}ngAfterContentInit(){this.init()}dateSelected(e){if(this.selectedDate!==e){const i=this._getDateFromDayOfMonth(e);this.selectedChange.emit(i)}this.userSelection.emit()}_updateActiveDate(e){const i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(e),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}handleCalendarBodyKeydown(e){const i=this._activeDate;switch(e.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=e.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:return void((!this.dateFilter||this.dateFilter(this._activeDate))&&(this.dateSelected(this._dateAdapter.getDate(this._activeDate)),this.userSelection.emit(),e.preventDefault()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),e.preventDefault()}init(){this.selectedDate=this._getDateInCurrentMonth(this.selected),this.todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this.monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();const e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this.firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(e)-this._dateAdapter.getFirstDayOfWeek())%7,this._createWeekCells(),this._changeDetectorRef.markForCheck()}focusActiveCell(){this.sbbCalendarBody.focusActiveCell()}_focusActiveCellAfterViewChecked(){this.sbbCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromDayOfMonth(e){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),e)}_createWeekCells(){const e=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this.weeks=[[]];for(let r=0,a=this.firstWeekOffset;r<e;r++,a++){7===a&&(this.weeks.push([]),a=0);const d=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),b=this._shouldEnableDate(d),x=this._dateAdapter.format(d,this._dateFormats.dateA11yLabel),A=this._shouldApplyRangeBackground(d);this.weeks[this.weeks.length-1].push(new tne(r+1,i[r],x,b,A))}}_shouldApplyRangeBackground(e){return this.dateRange&&this.dateRange.start&&this.dateRange.end&&!this._dateAdapter.sameDate(this.dateRange.start,this.dateRange.end)?this._dateAdapter.compareDate(e,this.dateRange.start)>0&&this._dateAdapter.compareDate(e,this.dateRange.end)<0?"range":this._isRangeLimit(e):null}_isRangeLimit(e){return 0===this._dateAdapter.compareDate(e,this.dateRange.start)?"begin":0===this._dateAdapter.compareDate(e,this.dateRange.end)?"end":null}_shouldEnableDate(e){return!!e&&(!this.dateFilter||this.dateFilter(e))&&(!this.minDate||this._dateAdapter.compareDate(e,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(e,this.maxDate)<=0)}_getDateInCurrentMonth(e){return e&&this._hasSameMonthAndYear(e,this.activeDate)?this._dateAdapter.getDate(e):null}_hasSameMonthAndYear(e,i){return!(!e||!i||this._dateAdapter.getMonth(e)!==this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(e)!==this._dateAdapter.getYear(i))}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(ue(Ym,8),ue(Kc),ue(So),ue(eD,8),ue(_2,8))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-month-view"]],viewQuery:function(e,i){if(1&e&&mo(Kz,7),2&e){let r;xi(r=wi())&&(i.sbbCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection",activeDateChange:"activeDateChange"},exportAs:["sbbMonthView"],decls:7,vars:7,consts:[[1,"sbb-calendar-table"],[1,"sbb-calendar-table-header"],[4,"ngFor","ngForOf"],["colspan","7","aria-hidden","true",1,"sbb-calendar-table-header-divider"],["sbb-calendar-body","",3,"label","rows","todayValue","selectedValue","labelMinRequiredCells","activeCell","selectedValueChange","activeDateChange","keydown"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(e,i){1&e&&(ne(0,"table",0)(1,"thead",1)(2,"tr"),yt(3,Zte,5,2,"th",2),oe(),ne(4,"tr"),rn(5,"th",3),oe()(),ne(6,"tbody",4),Wt("selectedValueChange",function(a){return i.dateSelected(a)})("activeDateChange",function(a){return i._updateActiveDate(a)})("keydown",function(a){return i.handleCalendarBodyKeydown(a)}),oe()()),2&e&&(pe(3),Pe("ngForOf",i.weekdays),pe(3),Ir("label",i.monthLabel),Pe("rows",i.weeks)("todayValue",i.todayDate)("selectedValue",i.selectedDate)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1))},dependencies:[Sl,Kz],encapsulation:2,changeDetection:0}),n})(),nne=(()=>{class n{constructor(e,i,r){this._dateAdapter=e,this._labelSwitchToPreviousMonth=$localize`:Button label to switch to the previous month@@sbbDatepickerSwitchToPreviousMonth:Change to the previous month`,this._labelSwitchToNextMonth=$localize`:Button label to switch to the next month@@sbbDatepickerSwitchToNextMonth:Change to the next month`,this._labelSwitchToPreviousYear=$localize`:Button label to switch to the previous year@@sbbDatepickerSwitchToPreviousYear:Change to the previous year`,this._labelSwitchToNextYear=$localize`:Button label to switch to the next year@@sbbDatepickerSwitchToNextYear:Change to the next year`,this.calendar=i,this.calendar.stateChanges.subscribe(()=>r.markForCheck())}get monthText(){return this._dateAdapter.getMonthName(this.calendar.activeDate)}get yearText(){return this._dateAdapter.getYearName(this.calendar.activeDate)}previousMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextMonthClicked(){const e=this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1);this._assignActiveDate(e)}previousMonthEnabled(){return!this.calendar.minDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.minDate)}nextMonthEnabled(){return!this.calendar.maxDate||!this._isSameMonthView(this.calendar.activeDate,this.calendar.maxDate)}_isSameMonthView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(e)===this._dateAdapter.getMonth(i)}previousYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,-1);this._assignActiveDate(e)}nextYearClicked(){const e=this._dateAdapter.addCalendarYears(this.calendar.activeDate,1);this._assignActiveDate(e)}previousYearEnabled(){return!this.calendar.minDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.minDate)}nextYearEnabled(){return!this.calendar.maxDate||!this._isSameYearView(this.calendar.activeDate,this.calendar.maxDate)}_isSameYearView(e,i){return this._dateAdapter.getYear(e)===this._dateAdapter.getYear(i)}_assignActiveDate(e){this.calendar.activeDate=this.calendar.minDate&&this._dateAdapter.compareDate(this.calendar.minDate,e)>0?this.calendar.minDate:this.calendar.maxDate&&this._dateAdapter.compareDate(this.calendar.maxDate,e)<0?this.calendar.maxDate:e}}return n.\u0275fac=function(e){return new(e||n)(ue(Ym,8),ue(Dr(()=>y2)),ue(So))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-calendar-header"]],hostAttrs:[1,"sbb-calendar-header","sbb-icon-scaled"],exportAs:["sbbCalendarHeader"],decls:15,vars:12,consts:[[1,"sbb-calendar-controls"],[1,"sbb-calendar-controls-months"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-previous",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["aria-live","polite",1,"sbb-calendar-controls-label"],["type","button",1,"sbb-calendar-controls-button","sbb-calendar-controls-button-next",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"],[1,"sbb-calendar-controls-years"]],template:function(e,i){1&e&&(ne(0,"div",0)(1,"div",1)(2,"button",2),Wt("click",function(){return i.previousMonthClicked()}),rn(3,"sbb-icon",3),oe(),ne(4,"span",4),Z(5),oe(),ne(6,"button",5),Wt("click",function(){return i.nextMonthClicked()}),rn(7,"sbb-icon",6),oe()(),ne(8,"div",7)(9,"button",2),Wt("click",function(){return i.previousYearClicked()}),rn(10,"sbb-icon",3),oe(),ne(11,"span",4),Z(12),oe(),ne(13,"button",5),Wt("click",function(){return i.nextYearClicked()}),rn(14,"sbb-icon",6),oe()()()),2&e&&(pe(2),Pe("disabled",!i.previousMonthEnabled()),si("aria-label",i._labelSwitchToPreviousMonth),pe(2),si("aria-label",i.monthText),pe(1),de(i.monthText),pe(1),Pe("disabled",!i.nextMonthEnabled()),si("aria-label",i._labelSwitchToNextMonth),pe(3),Pe("disabled",!i.previousYearEnabled()),si("aria-label",i._labelSwitchToPreviousYear),pe(2),si("aria-label",i.yearText),pe(1),de(i.yearText),pe(1),Pe("disabled",!i.nextYearEnabled()),si("aria-label",i._labelSwitchToNextYear))},dependencies:[cl],encapsulation:2,changeDetection:0}),n})(),y2=(()=>{class n{constructor(e,i,r){if(this._dateAdapter=e,this._dateFormats=i,this._changeDetectorRef=r,this._moveFocusOnNextTick=!1,this.selectedChange=new Cn,this.userSelection=new Cn,this.stateChanges=new On,!this._dateAdapter)throw K_("DateAdapter");if(!this._dateFormats)throw K_("SBB_DATE_FORMATS")}get startAt(){return this._startAt}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get selected(){return this._selected}set selected(e){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get activeDate(){return this._clampedActiveDate}set activeDate(e){this._clampedActiveDate=this._dateAdapter.clampDate(e,this.minDate,this.maxDate),this.stateChanges.next()}ngAfterContentInit(){this.calendarHeaderPortal=new Vh(this.headerComponent||nne),this.activeDate=this.startAt||this._dateAdapter.today()}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this.stateChanges.complete()}ngOnChanges(e){const i=e.minDate&&!this._dateAdapter.sameDate(e.minDate.previousValue,e.minDate.currentValue)?e.minDate:void 0,r=e.maxDate&&!this._dateAdapter.sameDate(e.maxDate.previousValue,e.maxDate.currentValue)?e.maxDate:void 0,a=i||r||e.dateFilter;if(a&&!a.firstChange){const d=this._getCurrentViewComponent();d&&(this._changeDetectorRef.detectChanges(),d.init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent().focusActiveCell()}dateSelected(e){e&&!this._dateAdapter.sameDate(e,this.selected)&&this.selectedChange.emit(e)}userSelected(){this.userSelection.emit()}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}_getCurrentViewComponent(){return this.monthView}}return n.\u0275fac=function(e){return new(e||n)(ue(Ym,8),ue(eD,8),ue(So))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-calendar"]],viewQuery:function(e,i){if(1&e&&mo(e4,7),2&e){let r;xi(r=wi())&&(i.monthView=r.first)}},hostAttrs:[1,"sbb-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter"},outputs:{selectedChange:"selectedChange",userSelection:"userSelection"},exportAs:["sbbCalendar"],features:[ho],decls:3,vars:6,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"sbb-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","activeDateChange","selectedChange","userSelection"]],template:function(e,i){1&e&&(yt(0,Yte,0,0,"ng-template",0),ne(1,"div",1)(2,"sbb-month-view",2),Wt("activeDateChange",function(a){return i.activeDate=a})("selectedChange",function(a){return i.dateSelected(a)})("userSelection",function(){return i.userSelected()}),oe()()),2&e&&(Pe("cdkPortalOutlet",i.calendarHeaderPortal),pe(2),Pe("activeDate",i.activeDate)("selected",i.selected)("dateFilter",i.dateFilter)("maxDate",i.maxDate)("minDate",i.minDate))},dependencies:[jh,rY,e4],encapsulation:2,changeDetection:0}),n})(),ine=(()=>{class n{ngAfterViewInit(){this.calendar.focusActiveCell()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Jt({type:n,selectors:[["sbb-datepicker-content"]],viewQuery:function(e,i){if(1&e&&mo(y2,7),2&e){let r;xi(r=wi())&&(i.calendar=r.first)}},hostAttrs:[1,"sbb-datepicker-content"],exportAs:["sbbDatepickerContent"],decls:1,vars:10,consts:[["cdkTrapFocus","","role","dialog",1,"sbb-datepicker-content-container",3,"id","ngClass","startAt","minDate","maxDate","dateFilter","headerComponent","selected","selectedChange","userSelection"]],template:function(e,i){if(1&e&&(ne(0,"sbb-calendar",0),Wt("selectedChange",function(a){return i.datepicker.select(a)})("userSelection",function(){return i.datepicker.close()}),oe()),2&e){let r;Pe("id",i.datepicker.id)("ngClass",i.datepicker.panelClass)("startAt",i.datepicker.startAt)("minDate",i.datepicker.minDate)("maxDate",i.datepicker.maxDate)("dateFilter",i.datepicker.dateFilter)("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i.datepicker.selected),si("aria-modal",!0)("aria-labelledby",null!==(r=i._dialogLabelId)&&void 0!==r?r:void 0)}},dependencies:[rf,qZ,y2],styles:['.sbb-datepicker-content{position:relative;top:var(--sbb-datepicker-content-offset);font-size:var(--sbb-font-size)}.sbb-datepicker-panel-above .sbb-datepicker-content{top:auto;bottom:var(--sbb-datepicker-content-offset)}.sbb-datepicker-content::after{top:var(--sbb-datepicker-calendar-arrow-offset);left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width));content:"";height:var(--sbb-datepicker-calendar-arrow-width);width:var(--sbb-datepicker-calendar-arrow-width);position:absolute;pointer-events:none;transform:rotate(-135deg);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid rgba(0,0,0,0);border-right-color:var(--sbb-color-weak-accent);border-bottom-color:var(--sbb-color-weak-accent);clip-path:polygon(-0.4px 100%, 100% -0.4px, 100% 100%)}.sbb-datepicker-with-arrows .sbb-datepicker-content::after{left:calc(var(--sbb-datepicker-button-offset) + var(--sbb-border-width) + var(--sbb-icon-size-default) + var(--sbb-datepicker-button-gap))}.sbb-datepicker-panel-above .sbb-datepicker-content::after{top:auto;bottom:var(--sbb-datepicker-calendar-arrow-offset);transform:rotate(45deg);clip-path:var(--sbb-box-shadow-arrow-clip-path);box-shadow:var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-arrow-width) 0 var(--sbb-box-shadow-arrow-width) var(--sbb-box-shadow-color)}.sbb-calendar{display:block;max-width:100%;width:var(--sbb-datepicker-calendar-width);height:var(--sbb-datepicker-calendar-height);background-color:var(--sbb-color-background);border:var(--sbb-border-width) solid var(--sbb-color-weak-accent);border-radius:var(--sbb-border-radius);box-shadow:var(--sbb-box-shadow-below)}.sbb-calendar-header{display:block;border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls{display:flex;height:var(--sbb-datepicker-calendar-header-height);align-items:center}.sbb-calendar-controls-months,.sbb-calendar-controls-years{display:flex;height:var(--sbb-datepicker-calendar-header-height);flex:1 0 50%;text-align:center;position:relative}.sbb-calendar-controls-months::after{content:"";display:block;position:absolute;width:0;height:100%;top:0;right:0;border-right:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color)}.sbb-calendar-controls-button{background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;flex-grow:0;outline:0;padding-left:var(--sbb-datepicker-calendar-controls-padding);padding-right:var(--sbb-datepicker-calendar-controls-padding);height:var(--sbb-datepicker-calendar-header-height);cursor:pointer;color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-controls-button:is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-calendar-controls-button:disabled{cursor:default;opacity:0}.sbb-calendar-controls-button-previous{float:left;padding-right:0}.sbb-calendar-controls-button-next{float:right;padding-left:0}.sbb-calendar-controls-label{flex-grow:1;flex-shrink:1;font-family:var(--sbb-font-light);font-size:1.4rem;line-height:3.2;color:var(--sbb-datepicker-calendar-header-color)}@media all and (min-width: 40.1875em){:where(html:not(.sbb-lean)) .sbb-calendar-controls-label{font-size:var(--sbb-font-size-large)}}:where(html.sbb-lean) .sbb-calendar-controls-label{font-size:var(--sbb-font-size);line-height:2.4rem}.sbb-calendar-content{padding:0 var(--sbb-datepicker-calendar-table-content-padding-width)}.sbb-calendar-table{width:100%;border-spacing:0;border-collapse:collapse;margin:0;position:relative}.sbb-calendar-table :is(td,th){color:var(--sbb-color-weak-accent);font-size:var(--sbb-font-size);line-height:1.5}.sbb-calendar-table-header::after{content:"";display:block;position:absolute;top:calc(2.2rem * var(--sbb-scaling-factor));border-bottom:var(--sbb-border-width-thin) solid var(--sbb-datepicker-calendar-line-color);width:calc(100% + var(--sbb-datepicker-calendar-table-content-padding-width)*2);left:calc(var(--sbb-datepicker-calendar-table-content-padding-width)*-1)}.sbb-calendar-table-header tr th{font-family:var(--sbb-font-roman);font-weight:400;font-size:var(--sbb-font-size-small);text-transform:uppercase;padding:calc(0.4666666667rem * var(--sbb-scaling-factor));color:var(--sbb-datepicker-calendar-header-color)}.sbb-calendar-table-header-divider{height:calc(1rem * var(--sbb-scaling-factor))}.sbb-calendar-body-cell-container{position:relative;height:0;padding:0;line-height:0;text-align:center}.sbb-calendar-body-cell{position:relative;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0;cursor:pointer}.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end)::before{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color);width:100%;left:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end,.sbb-calendar-body-range-background-offset-start))::before{width:50%}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell:is(.sbb-calendar-body-selected-begin,.sbb-calendar-body-range-background-offset-start))::before{left:auto;right:0}:is(.sbb-calendar-body-cell-container:is(:last-child,:first-child)>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));content:"";background-color:var(--sbb-datepicker-calendar-table-range-bg-color)}:is(.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start)::after{border-radius:50% 0 0 50%}.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background::after{border-radius:0 50% 50% 0}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::before{display:none}:is(.sbb-calendar-body-cell-container:first-child:last-child>.sbb-calendar-body-cell.sbb-calendar-body-range-background,.sbb-calendar-body-cell-container:last-child>.sbb-calendar-body-cell:is(.sbb-calendar-body-range-background-offset-start,.sbb-calendar-body-selected-begin),.sbb-calendar-body-cell-container:first-child>.sbb-calendar-body-cell.sbb-calendar-body-selected-end,.sbb-calendar-body-cell.sbb-calendar-body-range-background-offset-start.sbb-calendar-body-selected-end)::after{border-radius:50%}.sbb-calendar-body-cell,.sbb-calendar-body-label{padding-top:var(--sbb-datepicker-calendar-body-cell-padding);padding-bottom:var(--sbb-datepicker-calendar-body-cell-padding)}.sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-cement);cursor:default}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled{color:var(--sbb-color-storm)}.sbb-calendar-body-cell.sbb-calendar-body-disabled::after{content:"";width:calc(2.1333333333rem * var(--sbb-scaling-factor));height:calc(0.0666666667rem * var(--sbb-scaling-factor));top:calc(1.6666666667rem * var(--sbb-scaling-factor));left:calc(50% - var(--sbb-datepicker-calendar-body-cell-disabled-offset));background-color:var(--sbb-color-cement);display:block;position:absolute;transform:rotate(-45deg)}:where(html.sbb-lean) .sbb-calendar-body-cell.sbb-calendar-body-disabled::after{background-color:var(--sbb-color-storm);width:1.6rem;top:1.2rem}.sbb-calendar-body-today{font-family:var(--sbb-font-bold);color:var(--sbb-color-black)}.sbb-calendar-body-cell-content{position:absolute;top:12.5%;left:12.5%;display:flex;align-items:center;justify-content:center;width:var(--sbb-datepicker-calendar-body-cell-size);height:var(--sbb-datepicker-calendar-body-cell-size);line-height:1;padding-left:calc(0.0666666667rem * var(--sbb-scaling-factor));padding-bottom:calc(0.0666666667rem * var(--sbb-scaling-factor));border:var(--sbb-border-width) solid rgba(0,0,0,0);border-radius:50%;z-index:1}.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled):is(:hover,:focus) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-call-to-action-hover);border-color:var(--sbb-color-call-to-action-hover)}:is(.sbb-calendar-body-cell:not(.sbb-calendar-body-disabled).sbb-calendar-body-selected,.sbb-calendar-body-selected-begin,.sbb-calendar-body-selected-end) .sbb-calendar-body-cell-content{background-color:var(--sbb-color-background);color:var(--sbb-color-weak-accent);border-color:var(--sbb-color-weak-accent)}'],encapsulation:2,changeDetection:0}),n})(),rne=(()=>{class n{constructor(e,i,r){this._changeDetectorRef=e,this._datepicker=i,this._labelShowCalendar=$localize`:Open calendar@@sbbDatepickerOpenCalendar:Show calendar`,this._stateChanges=Se.EMPTY;const a=Number(r);this.tabIndex=a||0===a?a:null}get disabled(){return void 0===this._disabled?this._datepicker.disabled:this._disabled}set disabled(e){this._disabled=Ai(e)}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}open(e){this._datepicker&&!this.disabled&&(this._datepicker.open(),e.stopPropagation())}_watchStateChanges(){const e=this._datepicker?this._datepicker.disabledChange:fi(),i=this._datepicker&&this._datepicker.datepickerInput?this._datepicker.datepickerInput.disabledChange:fi(),r=this._datepicker?Oo(this._datepicker.openedStream,this._datepicker.closedStream):fi();this._stateChanges.unsubscribe(),this._stateChanges=Oo(e,i,r).subscribe(()=>this._changeDetectorRef.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(ue(So),ue(_2),hs("tabindex"))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-datepicker-toggle"]],hostAttrs:[1,"sbb-datepicker-toggle"],hostVars:3,hostBindings:function(e,i){2&e&&(si("tabindex",null),_("sbb-datepicker-toggle-active",i._datepicker&&i._datepicker.opened))},inputs:{tabIndex:"tabIndex",disabled:"disabled"},features:[ho],decls:2,vars:3,consts:[["aria-haspopup","true","type","button",1,"sbb-datepicker-toggle-button","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:calendar-small"]],template:function(e,i){1&e&&(ne(0,"button",0),Wt("click",function(a){return i.open(a)}),rn(1,"sbb-icon",1),oe()),2&e&&(Pe("disabled",i.disabled),si("aria-label",i._labelShowCalendar)("tabindex",i.disabled?-1:i.tabIndex))},dependencies:[cl],encapsulation:2,changeDetection:0}),n})(),one=0;const t4=new en("sbb-datepicker-scroll-strategy"),ane={provide:t4,deps:[Gs],useFactory:function sne(n){return()=>n.scrollStrategies.reposition()}};let yD=(()=>{class n{constructor(e,i,r,a,d,b,x){if(this._overlay=e,this._ngZone=i,this._viewContainerRef=r,this._changeDetectorRef=a,this._scrollStrategy=d,this._dateAdapter=b,this.locale=x,this._arrows=!1,this._toggle=!0,this.openedStream=new Cn,this.closedStream=new Cn,this._opened=!1,this.id="sbb-datepicker-"+one++,this._validSelected=null,this.nextDayAriaLabel=$localize`:Next day button's aria-label@@sbbDatePickerNextDayAriaLabel:Next day`,this.prevDayAriaLabel=$localize`:Previous day button's aria-label@@sbbDatePickerPrevDayAriaLabel:Previous day`,this._focusedElementBeforeOpen=null,this._inputSubscription=Se.EMPTY,this._inputChangeSubscription=Se.EMPTY,this._connectedDatepickerSubscription=Se.EMPTY,this._posStrategySubscription=Se.EMPTY,this.disabledChange=new On,this.selectedChanged=new On,!this._dateAdapter)throw K_("DateAdapter");this._dateAdapter.setLocale(x)}get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.value:null)}set startAt(e){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(e))}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(e){const i=Ai(e);i!==this._disabled&&(this._disabled=i,this.disabledChange.next(i))}set connected(e){e!==this._connected&&this._connected&&(this._connected.main=null),e&&(e.main=this),this._connected=e}get connected(){return this._connected}get arrows(){return this._arrows}set arrows(e){this._arrows=Ai(e)}get arrowsVisible(){var e;return this.arrows&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get toggle(){return this._toggle}set toggle(e){this._toggle=Ai(e)}set notoggle(e){this._toggle=!Ai(e)}get toggleVisible(){var e;return this.toggle&&!(null!==(e=this.datepickerInput)&&void 0!==e&&e.readonly)}get opened(){return this._opened}set opened(e){Ai(e)?this.open():this.close()}get selected(){return this._validSelected}set selected(e){this._validSelected=e,this._changeDetectorRef.markForCheck()}get minDate(){return this.datepickerInput&&this.datepickerInput.min}get maxDate(){return this.datepickerInput&&this.datepickerInput.max}get dateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}get prevDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.minDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.minDate)>0)}get nextDayActive(){return this.arrowsVisible&&this.datepickerInput&&!!this.datepickerInput.value&&(!this.maxDate||this._dateAdapter.compareDate(this.datepickerInput.value,this.maxDate)<0)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._inputChangeSubscription.unsubscribe(),this._connectedDatepickerSubscription.unsubscribe(),this.disabledChange.complete(),this.popupRef&&(this._posStrategySubscription.unsubscribe(),this.popupRef.dispose(),this._popupComponentRef=null)}select(e){const i=this.selected;this.selected=e,this._dateAdapter.sameDate(i,this.selected)||this.selectedChanged.next(e)}nextDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,1),this.selectedChanged.next(this.selected))}prevDay(){this.selected&&(this.selected=this._dateAdapter.addCalendarDays(this.selected,-1),this.selectedChanged.next(this.selected))}registerInput(e){if(this.datepickerInput)throw Error("A SbbDatepicker can only be associated with a single input.");this.datepickerInput=e,this._inputSubscription=this.datepickerInput.valueChange.subscribe(i=>this.selected=i),this._inputChangeSubscription=Oo(this.datepickerInput.disabledChange,this.datepickerInput.readonlyChange).subscribe(()=>this._changeDetectorRef.markForCheck()),this._connectedDatepickerSubscription=Oo(this.openedStream.pipe(Jx("opened")),this.selectedChanged.pipe(Jx("selected")),this.closedStream.pipe(Jx("closed"))).pipe(function Rte(n,t=null){return t=null!=t?t:n,Q((e,i)=>{let r=[],a=0;e.subscribe(Ce(i,d=>{let b=null;a++%t==0&&r.push([]);for(const x of r)x.push(d),n<=x.length&&(b=null!=b?b:[],b.push(x));if(b)for(const x of b)Ct(r,x),i.next(x)},()=>{for(const d of r)i.next(d);i.complete()},void 0,()=>{r=null}))})}(3,1),Do(([i,r,a])=>!!this.connected&&!!this.datepickerInput.value&&"opened"===i&&"selected"===r&&"closed"===a&&(!this.connected.datepickerInput.value||this._dateAdapter.compareDate(this.datepickerInput.value,this.connected.datepickerInput.value)>0)),qs(()=>{this.connected.datepickerInput.value&&(this.connected.datepickerInput.value=null,this.connected.datepickerInput._cvaOnChange(null))})).subscribe(()=>this.connected.open())}open(){if(!this._opened&&!this.disabled){if(!this.datepickerInput)throw Error("Attempted to open an SbbDatepicker with no associated input.");this._focusedElementBeforeOpen=kd(),this._openAsPopup(),this._opened=!0,this.openedStream.emit()}}close(){if(!this._opened)return;this.popupRef&&this.popupRef.hasAttached()&&this.popupRef.detach(),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();const e=()=>{this._opened&&(this._opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus?(this._focusedElementBeforeOpen.focus(),setTimeout(e)):e()}_getPanelClasses(){return["sbb-datepicker-panel",this.arrows?"sbb-datepicker-with-arrows":"sbb-datepicker-no-arrows"]}_openAsPopup(){this._calendarPortal||(this._calendarPortal=new Vh(ine,this._viewContainerRef)),this.popupRef?this.popupRef.getConfig().panelClass=this._getPanelClasses():this._createPopup(),this.popupRef.hasAttached()||(this._popupComponentRef=this.popupRef.attach(this._calendarPortal),this._popupComponentRef.instance.datepicker=this,this._popupComponentRef.instance._dialogLabelId=this.datepickerInput.getOverlayLabelId(),this._ngZone.onStable.asObservable().pipe(Ho(1)).subscribe(()=>{this.popupRef.updatePosition()}))}_createPopup(){const e=new X_({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"sbb-overlay-transparent-backdrop",scrollStrategy:this._scrollStrategy(),panelClass:this._getPanelClasses()});this.popupRef=this._overlay.create(e),Oo(this.popupRef.backdropClick(),this.popupRef.detachments(),this.popupRef.keydownEvents().pipe(Do(i=>27===i.keyCode||this.datepickerInput&&i.altKey&&38===i.keyCode))).subscribe(()=>this.close())}_createPopupPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".sbb-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withPush(!1).withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}]);return this._posStrategySubscription=e.positionChanges.subscribe(i=>{"top"===i.connectionPair.originY?this.popupRef.hostElement.classList.add("sbb-datepicker-panel-above"):this.popupRef.hostElement.classList.remove("sbb-datepicker-panel-above")}),e}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}}return n.\u0275fac=function(e){return new(e||n)(ue(Gs),ue(Ui),ue(Hs),ue(So),ue(t4),ue(Ym,8),ue(Kc))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-datepicker"]],hostAttrs:[1,"sbb-datepicker"],hostVars:6,hostBindings:function(e,i){2&e&&_("sbb-datepicker-arrows-enabled",i.arrowsVisible)("sbb-datepicker-toggle-enabled",i.toggleVisible)("sbb-datepicker-disabled",i.disabled)},inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",disabled:"disabled",panelClass:"panelClass",connected:"connected",arrows:"arrows",toggle:"toggle",notoggle:"notoggle",opened:"opened",nextDayAriaLabel:"nextDayAriaLabel",prevDayAriaLabel:"prevDayAriaLabel"},outputs:{openedStream:"opened",closedStream:"closed"},exportAs:["sbbDatepicker"],features:[Mi([{provide:_2,useExisting:n}])],ngContentSelectors:ene,decls:4,vars:3,consts:[["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-left sbb-icon-scaled",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","class","sbb-datepicker-arrow-button sbb-datepicker-arrow-button-right sbb-icon-scaled",3,"disabled","click",4,"ngIf"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-left","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-left-small"],["type","button",1,"sbb-datepicker-arrow-button","sbb-datepicker-arrow-button-right","sbb-icon-scaled",3,"disabled","click"],["svgIcon","kom:chevron-small-right-small"]],template:function(e,i){1&e&&(Rs(),yt(0,Jte,2,2,"button",0),yt(1,Kte,1,0,"sbb-datepicker-toggle",1),Co(2),yt(3,Qte,2,2,"button",2)),2&e&&(Pe("ngIf",i.prevDayActive),pe(1),Pe("ngIf",i.toggleVisible),pe(2),Pe("ngIf",i.nextDayActive))},dependencies:[Zo,cl,rne],styles:[".sbb-datepicker{display:inline-block;position:relative;color:var(--sbb-color-weak-accent)}.sbb-form-field .sbb-datepicker{width:100%}.sbb-datepicker-disabled{color:var(--sbb-color-granite)}.sbb-datepicker>.sbb-date-input{width:100%}:is(.sbb-datepicker-toggle-enabled,.sbb-datepicker-arrows-enabled)>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled>.sbb-date-input{padding-right:var(--sbb-datepicker-toggle-or-arrows-padding)}.sbb-datepicker-arrows-enabled.sbb-datepicker-toggle-enabled>.sbb-date-input{padding-left:var(--sbb-datepicker-toggle-and-arrows-padding)}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button){background:none;max-width:none;min-width:0;padding:0;margin:0;border:none;position:absolute;top:50%;transform:translateY(-50%);outline:0;color:inherit;line-height:0}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled){cursor:pointer}:is(.sbb-datepicker-arrow-button,.sbb-datepicker-toggle-button):not(:disabled):is(:hover,:focus,:active){color:var(--sbb-color-call-to-action-hover)}.sbb-datepicker-arrow-button-left,.sbb-datepicker-toggle-button{left:var(--sbb-datepicker-button-offset)}.sbb-datepicker-arrows-enabled .sbb-datepicker-toggle-button{left:var(--sbb-datepicker-adjacent-button-offset)}.sbb-datepicker-arrow-button-right{right:var(--sbb-datepicker-button-offset)}"],encapsulation:2,changeDetection:0}),n})();class vD{constructor(t,e){this.target=t,this.targetElement=e,this.value=this.target.value}}const lne={provide:$l,useExisting:Dr(()=>q1),multi:!0},cne={provide:Ua,useExisting:Dr(()=>q1),multi:!0};let q1=(()=>{class n{constructor(e,i,r,a,d){if(this._elementRef=e,this._dateAdapter=i,this._dateFormats=r,this._datepicker=a,this._formField=d,this._disabled=!1,this._readonly=!1,this.dateChange=new Cn,this.dateInput=new Cn,this.inputBlurred=new Cn,this.valueChange=new Cn,this.disabledChange=new Cn,this.readonlyChange=new Cn,this._datepickerSubscription=Se.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{sbbDateParse:{text:this._elementRef.nativeElement.value}},this._minValidator=b=>{const x=this._getValidDateOrNull(this._dateAdapter.deserialize(b.value));return!this.min||!x||this._dateAdapter.compareDate(this.min,x)<=0?null:{sbbDateMin:{min:this.min,actual:x}}},this._maxValidator=b=>{const x=this._getValidDateOrNull(this._dateAdapter.deserialize(b.value));return!this.max||!x||this._dateAdapter.compareDate(this.max,x)>=0?null:{sbbDateMax:{max:this.max,actual:x}}},this._filterValidator=b=>{const x=this._getValidDateOrNull(this._dateAdapter.deserialize(b.value));return this._dateFilter&&x&&!this._dateFilter(x)?{sbbDateFilter:!0}:null},this._validator=Yy.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw K_("DateAdapter");if(!this._dateFormats)throw K_("SBB_DATE_FORMATS")}set dateFilter(e){this._dateFilter=e,this._validatorOnChange()}get dateFilter(){return this._dateFilter}get value(){return this._value}set value(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._getValidDateOrNull(e);const i=this.value;this._value=e,this._formatValue(e),this._dateAdapter.sameDate(i,e)||this.valueChange.emit(e)}get min(){return this._min||(this._datepicker&&this._datepicker.main&&this._datepicker.main.datepickerInput&&this._datepicker.main.datepickerInput.value?this._datepicker.main.datepickerInput.value:null)}set min(e){this._min=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get max(){return this._max}set max(e){this._max=this._getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get disabled(){return this._disabled}set disabled(e){const i=Ai(e),r=this._elementRef.nativeElement;this._disabled!==i&&(this._disabled=i,this.disabledChange.emit(i)),i&&r.blur&&r.blur()}get readonly(){return this._readonly}set readonly(e){this._readonly=Ai(e),this.readonlyChange.next(this._readonly)}ngOnInit(){!this._datepicker||(this._datepicker.registerInput(this),this._datepickerSubscription.unsubscribe(),this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(e=>{this.value=e,this._cvaOnChange(e),this._onTouched(),this.dateInput.emit(new vD(this,this._elementRef.nativeElement)),this.dateChange.emit(new vD(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this.valueChange.complete(),this.disabledChange.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}getConnectedOverlayOrigin(){return this._elementRef}writeValue(e){this.value=e}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){this._datepicker&&e.altKey&&40===e.keyCode&&(this._datepicker.open(),e.preventDefault())}_onInput(e){let i=this._dateAdapter.parse(e);this._lastValueValid=!i||this._dateAdapter.isValid(i),i=this._getValidDateOrNull(i),this._dateAdapter.sameDate(i,this._value)?this._validatorOnChange():(this._value=i,this._cvaOnChange(i),this.valueChange.emit(i),this.dateInput.emit(new vD(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new vD(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched(),this.inputBlurred.emit()}_formatValue(e){var i;const r=this._datepicker?this._dateFormats.dateInput:null!==(i=this._dateFormats.dateInputPure)&&void 0!==i?i:this._dateFormats.dateInput;this._elementRef.nativeElement.value=null!=e?this._dateAdapter.format(e,r):""}_getValidDateOrNull(e){return this._dateAdapter.isDateInstance(e)&&this._dateAdapter.isValid(e)?e:null}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(Ym,8),ue(eD,8),ue(yD,8),ue(_D,8))},n.\u0275dir=cn({type:n,selectors:[["input","sbbDateInput",""]],hostAttrs:[1,"sbb-date-input"],hostVars:5,hostBindings:function(e,i){1&e&&Wt("keydown",function(a){return i._onKeydown(a)})("input",function(a){return i._onInput(a.target.value)})("change",function(){return i._onChange()})("blur",function(){return i._onBlur()}),2&e&&(dr("disabled",i.disabled),si("aria-haspopup",i._datepicker?"dialog":null)("aria-owns",(null==i._datepicker?null:i._datepicker.opened)&&i._datepicker.id||null)("min",i.min?i._dateAdapter.toIso8601(i.min):null)("max",i.max?i._dateAdapter.toIso8601(i.max):null))},inputs:{dateFilter:"dateFilter",value:"value",min:"min",max:"max",disabled:"disabled",readonly:"readonly"},outputs:{dateChange:"dateChange",dateInput:"dateInput",inputBlurred:"inputBlurred"},exportAs:["sbbDateInput"],features:[Mi([lne,cne,{provide:Yz,useExisting:n}])]}),n})(),n4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[ane,{provide:Ym,useClass:az},{provide:eD,useValue:rJ}],imports:[go,ll,G_,Tc,Ur,Ss]}),n})();const une=["input"],dne=["*"];let hne=0;const pne={provide:$l,useExisting:Dr(()=>G1),multi:!0};class r4{constructor(t,e){this.source=t,this.value=e}}const o4=new en("SbbRadioGroup"),v2=new en("SbbRadioButton");let fne=(()=>{class n{constructor(e){this._changeDetector=e,this.change=new Cn,this._value=null,this._name="sbb-radio-group-"+hne++,this._selected=null,this._isInitialized=!1,this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{}}get name(){return this._name}set name(e){this._name=e,this._updateRadioButtonNames()}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}get selected(){return this._selected}set selected(e){this._selected=e,this.value=e?e.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(e){this._disabled=Ai(e),this._markRadiosForCheck()}get required(){return this._required}set required(e){this._required=Ai(e),this._markRadiosForCheck()}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}ngAfterContentInit(){this._isInitialized=!0}_touch(){this._onTouched&&this._onTouched()}_emitChangeEvent(){this._isInitialized&&this.change.emit(new r4(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(e=>e._markForCheck())}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetector.markForCheck()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(e=>{e.name=this.name,e._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(i=>{i.checked=this.value===i.value,i.checked&&(this._selected=i)}))}}return n.\u0275fac=function(e){return new(e||n)(ue(So))},n.\u0275dir=cn({type:n,contentQueries:function(e,i,r){if(1&e&&Uo(r,v2,5),2&e){let a;xi(a=wi())&&(i._radios=a)}},hostAttrs:[1,"sbb-radio-group-base"],inputs:{name:"name",value:"value",selected:"selected",disabled:"disabled",required:"required"},outputs:{change:"change"}}),n})(),G1=(()=>{class n extends fne{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275dir=cn({type:n,selectors:[["sbb-radio-group"]],contentQueries:function(e,i,r){if(1&e&&Uo(r,v2,5),2&e){let a;xi(a=wi())&&(i._radios=a)}},hostAttrs:["role","radiogroup",1,"sbb-radio-group"],exportAs:["sbbRadioGroup"],features:[Mi([pne,{provide:o4,useExisting:n}]),Un]}),n})();const gne=Sv(class mne{});let _ne=0,bne=(()=>{class n extends gne{constructor(e,i,r,a,d,b){super(),this._elementRef=i,this._changeDetector=r,this._focusMonitor=a,this._radioDispatcher=d,this._uniqueId="sbb-radio-button-"+ ++_ne,this.id=this._uniqueId,this.change=new Cn,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=e,b&&(this.tabIndex=yf(b,0)),this._removeUniqueSelectionListener=d.listen((x,A)=>{x!==this.id&&A===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(e){const i=Ai(e);this._checked!==i&&(this._checked=i,i&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!i&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),i&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(e){this._setDisabled(Ai(e))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(e){this._required=Ai(e)}get inputId(){return`${this.id||this._uniqueId}-input`}focus(e,i){i?this._focusMonitor.focusVia(this._inputElement,i,e):this._inputElement.nativeElement.focus(e)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngDoCheck(){this._updateTabIndex()}ngAfterViewInit(){this._updateTabIndex(),this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{!e&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new r4(this,this._value))}_onInputClick(e){e.stopPropagation()}_onInputChange(e){null==e||e.stopPropagation();const i=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),i&&this.radioGroup._emitChangeEvent())}_setDisabled(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}_updateTabIndex(){var e;const i=this.radioGroup;let r;if(r=i&&i.selected&&!this.disabled?i.selected===this?this.tabIndex:-1:this.tabIndex,r!==this._previousTabIndex){const a=null===(e=this._inputElement)||void 0===e?void 0:e.nativeElement;a&&(a.setAttribute("tabindex",r+""),this._previousTabIndex=r)}}}return n.\u0275fac=function(e){bm()},n.\u0275dir=cn({type:n,viewQuery:function(e,i){if(1&e&&mo(une,5),2&e){let r;xi(r=wi())&&(i._inputElement=r.first)}},hostVars:1,hostBindings:function(e,i){2&e&&si("id",i.id)},inputs:{id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],checked:"checked",value:"value",disabled:"disabled",required:"required"},outputs:{change:"change"},features:[Un]}),n})(),xD=(()=>{class n extends bne{constructor(e,i,r,a,d,b){super(e,i,r,a,d,b)}}return n.\u0275fac=function(e){return new(e||n)(ue(o4,8),ue(ci),ue(So),ue(Cl),ue(o2),hs("tabindex"))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-radio-button"]],hostAttrs:[1,"sbb-radio-button","sbb-selection-item"],hostVars:9,hostBindings:function(e,i){1&e&&Wt("focus",function(){return i._inputElement.nativeElement.focus()}),2&e&&(si("tabindex",null)("id",i.id)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),_("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbRadioButton"],features:[Mi([{provide:v2,useExisting:n}]),Un],ngContentSelectors:dne,decls:9,vars:11,consts:[[1,"sbb-selection-item-label"],["type","radio",1,"sbb-selection-input","sbb-radio-input","sbb-transparent-parent-overlay",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],[1,"sbb-selection-content"],[2,"display","none"]],template:function(e,i){1&e&&(Rs(),ne(0,"label",0)(1,"input",1,2),Wt("change",function(a){return i._onInputChange(a)})("click",function(a){return i._onInputClick(a)}),oe(),ne(3,"div",3),rn(4,"div",4),oe(),ne(5,"div",5)(6,"span",6),Z(7,"\xa0"),oe(),Co(8),oe()()),2&e&&(si("for",i.inputId),pe(1),Pe("id",i.inputId)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex)("required",i.required),si("name",i.name)("value",i.value)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),x2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[Ur]}),n})();const yne=/[0-9]{3,4}/,vne=/([0-9]{1,2})[.:,\-;_hH]?([0-9]{1,2})?/,xne=/([0-9]{1,2})([0-9]{2})/;let a4=(()=>{class n{constructor(e,i,r,a,d){this._elementRef=e,this._renderer=i,this._control=r,this._input=d,this._document=a,this.placeholder="HH:MM"}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=null!=e?e:"HH:MM",this._input&&(this._input.placeholder=this._placeholder)}_onBlur(e){const i=this._validateInput(e);if(!i||i.length<=2)return;const r=this._parseHour(i[1]),a=this._parseMinute(i[2]);if(this._control&&this._control.control)this._control.control.setValue(`${r}:${a}`);else{this._renderer.setProperty(this._elementRef.nativeElement,"value",`${r}:${a}`);const d=this._document.createEvent("Event");d.initEvent("input",!0,!0),this._elementRef.nativeElement.dispatchEvent(d)}}_validateInput(e){return yne.test(e)?e.match(xne):e?e.match(vne):null}_parseHour(e){return e.length>1?e:"0"+e}_parseMinute(e){return(e=e||"00").length>1?e:"0"+e}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(gc),ue(nu,10),ue(Oi),ue(J_,8))},n.\u0275dir=cn({type:n,selectors:[["input","sbbTimeInput",""]],hostAttrs:["type","text","pattern","[0-9]*","inputmode","numeric",1,"sbb-time-input","sbb-input-element"],hostVars:1,hostBindings:function(e,i){1&e&&Wt("blur",function(a){return i._onBlur(a.target.value)}),2&e&&si("placeholder",i.placeholder)},inputs:{placeholder:"placeholder"},exportAs:["sbbTimeInput"]}),n})(),l4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[Ur]}),n})();function c4(n,t){return t?e=>Yx(t.pipe(Ho(1),function wne(){return Q((n,t)=>{n.subscribe(Ce(t,Rt))})}()),e.pipe(c4(n))):Ar((e,i)=>n(e,i).pipe(Ho(1),Jx(e)))}const Tne=["panel"];function Cne(n,t){if(1&n&&(ne(0,"div",0,1),Co(2),oe()),2&n){const e=t.id,i=St();Pe("id",i.id)("ngClass",i._classList),si("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}const Dne=["*"];let Ene=0;class Ine{constructor(t,e){this.source=t,this.option=e}}const u4=new en("sbb-autocomplete-default-options",{providedIn:"root",factory:function Mne(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1}}});let d4=(()=>{class n{constructor(e,i,r,a){this._changeDetectorRef=e,this._elementRef=i,this._activeOptionChanges=Se.EMPTY,this._visibleClass="sbb-autocomplete-visible",this._hiddenClass="sbb-autocomplete-hidden",this._showPanel=new il(!1),this._isOpen=!1,this.displayWith=null,this.localeNormalizer=null,this.optionSelected=new Cn,this.opened=new Cn,this.closed=new Cn,this.optionActivated=new Cn,this._classList={},this._showHintIfNoOptions=!1,this.id="sbb-autocomplete-"+Ene++,this.inertGroups=(null==a?void 0:a.SAFARI)||!1,this._autoActiveFirstOption=!!r.autoActiveFirstOption,this._autoSelectActiveOption=!!r.autoSelectActiveOption}get showPanel(){return this._showPanel.value}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(e){this._autoActiveFirstOption=Ai(e)}get autoSelectActiveOption(){return this._autoSelectActiveOption}set autoSelectActiveOption(e){this._autoSelectActiveOption=Ai(e)}set classList(e){this._classList=e&&e.length?NR(e).reduce((i,r)=>(i[r]=!0,i),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=""}get showHintIfNoOptions(){return this._showHintIfNoOptions}set showHintIfNoOptions(e){this._showHintIfNoOptions=Ai(e)}ngAfterContentInit(){this._keyManager=new MB(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this._showPanel.next(!!this.options.length||!!this.hints.length&&this.showHintIfNoOptions),this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const i=new Ine(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}}return n.\u0275fac=function(e){return new(e||n)(ue(So),ue(ci),ue(u4),ue(ga))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-autocomplete"]],contentQueries:function(e,i,r){if(1&e&&(Uo(r,L1,5),Uo(r,KR,5),Uo(r,hJ,5)),2&e){let a;xi(a=wi())&&(i.options=a),xi(a=wi())&&(i.optionGroups=a),xi(a=wi())&&(i.hints=a)}},viewQuery:function(e,i){if(1&e&&(mo(ls,7),mo(Tne,5)),2&e){let r;xi(r=wi())&&(i.template=r.first),xi(r=wi())&&(i.panel=r.first)}},hostAttrs:[1,"sbb-autocomplete"],inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",localeNormalizer:"localeNormalizer",autoActiveFirstOption:"autoActiveFirstOption",autoSelectActiveOption:"autoSelectActiveOption",panelWidth:"panelWidth",classList:["class","classList"],showHintIfNoOptions:"showHintIfNoOptions"},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["sbbAutocomplete"],features:[Mi([{provide:tD,useExisting:n}])],ngContentSelectors:Dne,decls:1,vars:0,consts:[["role","listbox",1,"sbb-panel","sbb-panel-padded","sbb-autocomplete-panel","sbb-scrollbar",3,"id","ngClass"],["panel",""]],template:function(e,i){1&e&&(Rs(),yt(0,Cne,3,4,"ng-template"))},dependencies:[rf],styles:[".sbb-autocomplete-visible{visibility:visible}.sbb-autocomplete-hidden{visibility:hidden;padding:0 !important}:where(html:not(.sbb-lean)) .sbb-autocomplete-panel .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,changeDetection:0}),n})();const h4=new en("sbb-autocomplete-scroll-strategy"),Rne={provide:h4,deps:[Gs],useFactory:function Ane(n){return()=>n.scrollStrategies.reposition()}};let wD=(()=>{class n{constructor(e,i,r,a,d,b,x,A,O,B){this._element=e,this._overlay=i,this._viewContainerRef=r,this._zone=a,this._changeDetectorRef=d,this._formField=x,this._document=A,this._viewportRuler=O,this._defaults=B,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._viewportSubscription=Se.EMPTY,this._positionSubscription=Se.EMPTY,this._highlightSubscription=Se.EMPTY,this._connectedElementClassSubscription=Se.EMPTY,this._inputValue=new il(""),this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new On,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="sbb-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=A_(()=>{const X=this.autocomplete?this.autocomplete.options:null;return X?X.changes.pipe(Ra(X),rl(()=>Oo(...X.map(te=>te.onSelectionChange)))):this._zone.onStable.pipe(Ho(1),rl(()=>this.optionSelections))}),this._scrollStrategy=b}get autocomplete(){return this._autocomplete}set autocomplete(e){if(this._autocomplete=e,this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),!e)return;const i=e.options?fi(null):this._zone.onStable.pipe(Ho(1));this._highlightSubscription=i.pipe(rl(()=>M_([this._inputValue,e.options.changes.pipe(Ra(e.options.toArray()))])),Do(r=>!!r[1]&&!!r[1].length)).subscribe(([r,a])=>{a.forEach(d=>d._highlight(r,this.autocomplete.localeNormalizer))}),this._connectedElementClassSubscription=this.autocomplete._showPanel.pipe(Wm(),Do(r=>!r)).subscribe(()=>{this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")})}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(e){this._autocompleteDisabled=Ai(e)}ngAfterViewInit(){const e=this._getWindow();void 0!==e&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();void 0!==e&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._highlightSubscription.unsubscribe(),this._connectedElementClassSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay()}closePanel(){!this._overlayAttached||(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above"),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return Oo(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Do(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Do(()=>this._overlayAttached)):fi()).pipe(st(e=>e instanceof cz?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return Oo(Ld(this._document,"click"),Ld(this._document,"auxclick"),Ld(this._document,"touchend")).pipe(Do(e=>{const i=$m(e),r=this._formField?this._formField._elementRef.nativeElement:null,a=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&i!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!r||!r.contains(i))&&(!a||!a.contains(i))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(i)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const i=e.keyCode,r=al(e);if(27===i&&!r&&e.preventDefault(),this.activeOption&&13===i&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const a=this.autocomplete._keyManager.activeItem,d=38===i||40===i;9===i||d&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):d&&this._canOpen()&&this.openPanel(),(d||this.autocomplete._keyManager.activeItem!==a)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){const i=e.target;let r=i.value;"number"===i.type&&(r=""===r?null:parseFloat(r)),this._previousValue!==r&&(this._previousValue=r,this._pendingAutoselectedOption=null,this._onChange(r),this._inputValue.next(i.value),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay()):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_updateSize(){var e;null===(e=this._overlayRef)||void 0===e||e.updateSize({width:this._getPanelWidth()})}_subscribeToClosingActions(){const e=this._zone.onStable.pipe(Ho(1)),i=this.autocomplete.options.changes.pipe(qs(()=>this._positionStrategy.reapplyLastPosition()),function Sne(n,t=HC){const e=HR(n,t);return c4(()=>e)}(0));return Oo(e,i).pipe(rl(()=>(this._zone.run(()=>{const r=this.panelOpen;if(this._resetActiveItem(),this.autocomplete._setVisibility(),this._changeDetectorRef.detectChanges(),this.panelOpen){const a=this.autocomplete.panel.nativeElement.scrollTop;this._overlayRef.updatePosition(),this.autocomplete.panel.nativeElement.scrollTop=a}r!==this.panelOpen&&(this.panelOpen?this.autocomplete.opened.emit():this.autocomplete.closed.emit())}),this.panelClosingActions)),Ho(1)).subscribe(r=>this._setValueAndClose(r))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const i=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(null!=i?i:"")}_updateNativeInputValue(e){this._formField&&this._formField._control?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e,this._inputValue.next(e)}_setValueAndClose(e){const i=e?e.source:this._pendingAutoselectedOption;i&&(this._clearPreviousSelectedOption(i),this._assignOptionValue(i.value),this._onChange(i.value),this.autocomplete._emitSelectEvent(i),this._element.nativeElement.focus()),this.closePanel()}_clearPreviousSelectedOption(e){this.autocomplete.options.forEach(i=>{i!==e&&i.selected&&i.deselect()})}_attachOverlay(){var e;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new W_(this.autocomplete.template,this._viewContainerRef,{id:null===(e=this._formField)||void 0===e?void 0:e.getLabelId()}),i=this._overlay.create(this._getOverlayConfig()),this._overlayRef=i,this._positionStrategy&&(this._positionSubscription.unsubscribe(),this._positionSubscription=M_([this._positionStrategy.positionChanges,this.autocomplete._showPanel]).subscribe(([a,d])=>{this.autocomplete.panel&&d&&(this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel"),"top"===a.connectionPair.originY?(this.autocomplete.panel.nativeElement.classList.add("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.autocomplete.panel.nativeElement.classList.remove("sbb-panel-above"),this._getConnectedElement().nativeElement.classList.remove("sbb-input-with-open-panel-above")))})),this._handleOverlayEvents(i),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})})),i&&!i.hasAttached()&&(i.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const r=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&r!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var e;return new X_({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),panelClass:NR(null===(e=this._defaults)||void 0===e?void 0:e.overlayPanelClass).concat("sbb-overlay-panel"),minHeight:0})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!0).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],r=this._aboveClass,a=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:r},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:r}];let d;d="above"===this.position?a:"below"===this.position?i:[...i,...a],e.withPositions(d)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;e.autoActiveFirstOption?e._keyManager.setFirstItemActive():e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}_scrollToOption(e){const i=this.autocomplete,r=function uJ(n,t,e){if(e.length){const i=t.toArray(),r=e.toArray();let a=0;for(let d=0;d<n+1;d++)i[d].group&&i[d].group===r[a]&&a++;return a}return 0}(e,i.options,i.optionGroups);if(0===e&&1===r)i._setScrollTop(0);else if(i.panel){const a=i.options.toArray()[e];if(a){const d=a._getHostElement(),b=uz(d.offsetTop,d.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(b)}}}_handleOverlayEvents(e){e.keydownEvents().subscribe(i=>{var r;(27===i.keyCode&&!al(i)||38===i.keyCode&&al(i,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(null!==(r=this._valueBeforeAutoSelection)&&void 0!==r?r:""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),i.stopPropagation(),i.preventDefault())}),e.outsidePointerEvents().subscribe()}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(Gs),ue(Hs),ue(Ui),ue(So),ue(h4),ue(_D,9),ue(Oi,8),ue(Od),ue(u4,8))},n.\u0275dir=cn({type:n,selectors:[["input","sbbAutocomplete",""]],hostAttrs:[1,"sbb-autocomplete-trigger"],hostVars:9,hostBindings:function(e,i){1&e&&Wt("focusin",function(){return i._handleFocus()})("blur",function(){return i._onTouched()})("input",function(a){return i._handleInput(a)})("keydown",function(a){return i._handleKeydown(a)})("click",function(){return i._handleClick()}),2&e&&(si("autocomplete",i.autocompleteAttribute)("role",i.autocompleteDisabled?null:"combobox")("aria-autocomplete",i.autocompleteDisabled?null:"list")("aria-activedescendant",i.panelOpen&&i.activeOption?i.activeOption.id:null)("aria-expanded",i.autocompleteDisabled?null:i.panelOpen.toString())("aria-owns",i.autocompleteDisabled||!i.panelOpen||null==i.autocomplete?null:i.autocomplete.id)("aria-haspopup",i.autocompleteDisabled?null:"listbox"),_("sbb-focused",i.panelOpen))},inputs:{autocomplete:["sbbAutocomplete","autocomplete"],position:["sbbAutocompletePosition","position"],connectedTo:["sbbAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["sbbAutocompleteDisabled","autocompleteDisabled"]},exportAs:["sbbAutocompleteTrigger"],features:[Mi([{provide:$l,useExisting:Dr(()=>n),multi:!0}]),ho]}),n})(),p4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[Rne],imports:[go,G_,Tc,Ur,nD,nD,Tc]}),n})();function Pne(n,t){if(1&n&&(ne(0,"b"),Z(1),oe()),2&n){const e=St().$implicit;pe(1),De("(",e.originSystem,")")}}function kne(n,t){if(1&n&&(ne(0,"sbb-option",11),Z(1),yt(2,Pne,2,1,"b",12),oe()),2&n){const e=t.$implicit,i=t.index;Pe("value",St(2).$implicit[0]+"."+i),pe(1),De(" ",e.computeLocationName()," "),pe(1),Pe("ngIf",null==e?null:e.originSystem)}}function Lne(n,t){if(1&n&&(ne(0,"sbb-optgroup",9),yt(1,kne,3,3,"sbb-option",10),oe()),2&n){const e=St().$implicit,i=St();Pe("label",e[1]),pe(1),Pe("ngForOf",i.mapLookupLocations[e[0]])}}function One(n,t){if(1&n&&(ji(0),yt(1,Lne,2,2,"sbb-optgroup",8),Zi()),2&n){const e=t.$implicit,i=St();pe(1),Pe("ngIf",i.mapLookupLocations[e[0]].length>0)}}let Fne=(()=>{class n{constructor(e,i,r){this.mapService=e,this.userTripService=i,this.languageService=r,this.shouldFetchNewData=!0,this.inputControl=new Hu("",[Yy.required]),this.placeholder="",this.endpointType="From",this.inputValue="",this.selectedLocation=new Cn,this.mapLookupLocations={},this.resetMapLocations(),this.optionLocationTypes=[["stop","Stops"],["poi","POIs"],["topographicPlace","Topographic Places"],["address","Addresses"]]}ngOnInit(){this.inputControl.valueChanges.pipe(zh(500),Wm()).subscribe(e=>{if(null===e||!this.shouldFetchNewData)return;if(0===e.trim().length)return void this.selectedLocation.emit(null);if(e.length<1)return;const i=bn.Location.initFromLiteralCoords(e);if(i)return this.resetMapLocations(),void this.handleCoordsPick(i);this.fetchJourneyPoints(e)})}ngOnChanges(e){if("inputValue"in e){const i=e.inputValue.currentValue;if(""===i)return;this.inputControl.setValue(i,{emitEvent:!1})}}onOpenAutocomplete(){this.shouldFetchNewData=!0}onOptionSelected(e){this.shouldFetchNewData=!1;const i=e.option.value.split(".");if(2!==i.length)return;const r=i[0],a=parseInt(i[1],10),d=this.mapLookupLocations[r][a],b=d.computeLocationName();this.inputControl.setValue(b),this.selectedLocation.emit(d)}fetchJourneyPoints(e){var i=this;return mr(function*(){const r=i.userTripService.getStageConfig(),b=bn.LocationInformationRequest.initWithLocationName(r,i.languageService.language,"2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,Ps,e,[]);b.enableExtensions="OJP-SI"!==i.userTripService.currentAppStage;const x=yield b.fetchResponse();i.resetMapLocations(),x.locations.forEach(A=>{const O=A.getLocationType();null!==O&&i.mapLookupLocations[O].push(A)})})()}handleTapOnMapButton(){const e=(()=>{var i,r,a,d;if("From"===this.endpointType)return null!==(r=null===(i=this.userTripService.fromTripLocation)||void 0===i?void 0:i.location)&&void 0!==r?r:null;if("To"===this.endpointType)return null!==(d=null===(a=this.userTripService.toTripLocation)||void 0===a?void 0:a.location)&&void 0!==d?d:null;if("Via"===this.endpointType){const b=this.userTripService.viaTripLocations;if(b.length>0)return b[0].location}return null})();this.mapService.tryToCenterAndZoomToLocation(e)}handleCoordsPick(e){const i=e.geoPosition;if(null===i)return;const r=i.asLatLngString(!1);this.inputControl.setValue(r),this.selectedLocation.emit(e)}resetMapLocations(){this.mapLookupLocations={address:[],poi:[],stop:[],topographicPlace:[]}}}return n.\u0275fac=function(e){return new(e||n)(ue(xf),ue(ia),ue($u))},n.\u0275cmp=Jt({type:n,selectors:[["journey-point-input"]],inputs:{placeholder:"placeholder",endpointType:"endpointType",inputValue:"inputValue"},outputs:{selectedLocation:"selectedLocation"},features:[ho],decls:11,vars:5,consts:[[1,"w-100","trip-endpoint"],[1,"endpoint-label",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","12","height","12","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["sbbInput","","type","text",1,"trip-endpoint",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected","opened"],["journeyPoint","sbbAutocomplete"],[4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[4,"ngIf"]],template:function(e,i){if(1&e&&(ne(0,"sbb-form-field",0)(1,"div",1),Wt("click",function(){return i.handleTapOnMapButton()}),gu(),ne(2,"svg",2),rn(3,"path",3),oe(),Z(4),oe(),nh(),rn(5,"input",4),ne(6,"sbb-error"),Z(7,"Mandatory field, please complete."),oe()(),ne(8,"sbb-autocomplete",5,6),Wt("optionSelected",function(a){return i.onOptionSelected(a)})("opened",function(){return i.onOpenAutocomplete()}),yt(10,One,2,1,"ng-container",7),oe()),2&e){const r=el(9);pe(4),De(" ",i.placeholder," "),pe(1),Pe("placeholder",i.placeholder)("formControl",i.inputControl)("sbbAutocomplete",r),pe(5),Pe("ngForOf",i.optionLocationTypes)}},dependencies:[Sl,Zo,tu,Uu,Qy,L1,KR,d4,wD,Dv,zte,J_],styles:[".endpoint-label[_ngcontent-%COMP%]{font-size:12px}.endpoint-label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),n})();class SD{static parseNumber(t){const e=parseFloat(t);return isNaN(e)?null:e}}const Nne=["panel"];function Bne(n,t){if(1&n&&(ne(0,"span",7),Z(1),oe()),2&n){const e=St();pe(1),de(e.readonly?"-":e.placeholder||"\xa0")}}function zne(n,t){if(1&n&&(ne(0,"span",8)(1,"span"),Z(2),oe()()),2&n){const e=St();pe(2),de(e.triggerValue||"\xa0")}}function Vne(n,t){1&n&&rn(0,"sbb-icon",9)}function jne(n,t){1&n&&rn(0,"sbb-icon",10)}function Une(n,t){if(1&n){const e=or();ne(0,"div",11,12),Wt("@transformPanel.done",function(r){return Qn(e),ei(St()._panelDoneAnimatingStream.next(r.toState))})("keydown",function(r){return Qn(e),ei(St()._handleKeydown(r))}),Co(2),oe()}if(2&n){const e=St();p("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),_("sbb-select-multiple",e.multiple),Pe("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),si("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const Hne=["*"],qne={transformPanel:Aa("transformPanel",[_o("void",bi({opacity:0})),_o("showing",bi({opacity:1})),_o("showing-multiple",bi({opacity:1})),jr("void => *",Kr("120ms cubic-bezier(0, 0, 0.2, 1)")),jr("* => void",Kr("100ms 25ms linear",bi({opacity:0})))])};let f4=0;const m4=new en("sbb-select-scroll-strategy"),$ne=new en("SBB_SELECT_CONFIG"),Wne={provide:m4,deps:[Gs],useFactory:function Gne(n){return()=>n.scrollStrategies.reposition()}};class Xne{constructor(t,e){this.source=t,this.value=e}}const Zne=Sv(Zl(QC(Y_(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new On}}))));let Yne=(()=>{class n extends Zne{constructor(e,i,r,a,d,b,x,A,O,B,X,te,se){var me;super(a,b,x,O),this._viewportRuler=e,this._changeDetectorRef=i,this._ngZone=r,this._elementRef=d,this._parentFormField=A,this.ngControl=O,this._liveAnnouncer=te,this._defaultOptions=se,this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"}],this._panelOpen=!1,this._compareWith=(ye,$e)=>ye===$e,this._uid="sbb-select-"+f4++,this._triggerAriaLabelledBy=null,this._destroy=new On,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="sbb-select-value-"+f4++,this._panelDoneAnimatingStream=new On,this._overlayPanelClass=(null===(me=this._defaultOptions)||void 0===me?void 0:me.overlayPanelClass)||"sbb-overlay-panel",this._focused=!1,this.controlType="sbb-select",this._multiple=!1,this._readonly=!1,this.ariaLabel="",this.optionSelectionChanges=A_(()=>{const ye=this.options;return ye?ye.changes.pipe(Ra(ye),rl(()=>Oo(...ye.map($e=>$e.onSelectionChange)))):this._ngZone.onStable.pipe(Ho(1),rl(()=>this.optionSelectionChanges))}),this.openedChange=new Cn,this._openedStream=this.openedChange.pipe(Do(ye=>ye),st(()=>{})),this._closedStream=this.openedChange.pipe(Do(ye=>!ye),st(()=>{})),this.selectionChange=new Cn,this.valueChange=new Cn,this.ngControl&&(this.ngControl.valueAccessor=this),null!=(null==se?void 0:se.typeaheadDebounceInterval)&&(this._typeaheadDebounceInterval=se.typeaheadDebounceInterval),this._scrollStrategyFactory=X,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(B,10)||0,this.id=this.id,this._overlayOrigin=new QB(d)}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){var e,i,r,a;return null!==(a=null!==(e=this._required)&&void 0!==e?e:null===(r=null===(i=this.ngControl)||void 0===i?void 0:i.control)||void 0===r?void 0:r.hasValidator(Yy.required))&&void 0!==a&&a}set required(e){this._required=Ai(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=Ai(e)}get readonly(){return this._readonly}set readonly(e){this._readonly=Ai(e),this.stateChanges.next()}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){this._assignValue(e)&&this._onChange(e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=yf(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new xK(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(Wm(),Mr(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen)),this._viewportRuler.change().pipe(Mr(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(Mr(this._destroy)).subscribe(e=>{e.added.forEach(i=>i.select()),e.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(Ra(null),Mr(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby(),i=this.ngControl;if(e!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?r.setAttribute("aria-labelledby",e):r.removeAttribute("aria-labelledby")}this.ngControl&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(e){(e.disabled||e.userAriaDescribedBy)&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck(),this._triggerRect=this._elementRef.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this._elementRef.nativeElement).fontSize||"0",10),this._ngZone.onStable.pipe(Ho(1)).subscribe(()=>{this._triggerFontSize&&this.overlayDir.overlayRef&&this.overlayDir.overlayRef.overlayElement&&(this.overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`),this._calculateOverlayPosition()}))}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation("ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this._assignValue(e)}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){var e,i;return this.multiple?(null===(e=this._selectionModel)||void 0===e?void 0:e.selected)||[]:null===(i=this._selectionModel)||void 0===i?void 0:i.selected[0]}get triggerValue(){return this.empty?"":this._multiple?this._selectionModel.selected.map(i=>i.viewValue).join(", "):this._selectionModel.selected[0].viewValue}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const i=e.keyCode,r=40===i||38===i||37===i||39===i,a=13===i||32===i,d=this._keyManager;if(!d.isTyping()&&a&&!al(e)||(this.multiple||e.altKey)&&r)e.preventDefault(),this.open();else if(!this.multiple){const b=this.selected;d.onKeydown(e);const x=this.selected;x&&b!==x&&this._liveAnnouncer.announce(x.viewValue,1e4)}}_handleOpenKeydown(e){const i=this._keyManager,r=e.keyCode,a=40===r||38===r,d=i.isTyping();if(a&&e.altKey)e.preventDefault(),this.close();else if(d||13!==r&&32!==r||!i.activeItem||al(e))if(!d&&this._multiple&&65===r&&e.ctrlKey){e.preventDefault();const b=this.options.some(x=>!x.disabled&&!x.selected);this.options.forEach(x=>{x.disabled||(b?x.select():x.deselect())})}else{const b=i.activeItemIndex;i.onKeydown(e),this._multiple&&a&&e.shiftKey&&i.activeItem&&i.activeItemIndex!==b&&i.activeItem._selectViaInteraction()}else e.preventDefault(),i.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this.overlayDir.positionChange.pipe(Ho(1)).subscribe(e=>{"top"===e.connectionPair.originY?(this.panel.nativeElement.classList.add("sbb-panel-above"),this._elementRef.nativeElement.classList.add("sbb-input-with-open-panel-above")):(this.panel.nativeElement.classList.remove("sbb-panel-above"),this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above")),this._changeDetectorRef.detectChanges(),this._positioningSettled()})}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(e);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(e){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return null!=r.value&&this._compareWith(r.value,e)}catch(a){return!1}});return i&&this._selectionModel.select(i),i}_assignValue(e){return!!(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e,!0)}_initKeyManager(){this._keyManager=new MB(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation("ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(Mr(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(Mr(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=Oo(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(Mr(e)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),Oo(...this.options.map(i=>i._stateChanges)).pipe(Mr(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,i){const r=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(r!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),i&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),i&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),r!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,e):e.indexOf(i)-e.indexOf(r)),this.stateChanges.next()}}_propagateChanges(e){let i=null;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:e,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(new Xne(this,i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0&&!this.readonly}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(i?i+" ":"")+this.ariaLabelledby:i}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const i=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let r=(i?i+" ":"")+this._valueId;return this.ariaLabelledby&&(r+=" "+this.ariaLabelledby),r}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this.overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),e||this._elementRef.nativeElement.classList.remove("sbb-input-with-open-panel-above"),this.openedChange.emit(e)}_getOverlayMinWidth(){var e;return null===(e=this._triggerRect)||void 0===e?void 0:e.width}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}_calculateOverlayScroll(e,i,r){const a=e._getHostElement().offsetHeight,d=e._getHostElement().offsetTop;return Math.min(Math.max(0,d-i+a/2),r)}_scrollOptionIntoView(e){if(0===e)this.panel.nativeElement.scrollTop=0;else{const i=this.options.toArray()[e];if(i){const r=i._getHostElement();this.panel.nativeElement.scrollTop=uz(r.offsetTop,r.offsetHeight,this.panel.nativeElement.scrollTop,this.panel.nativeElement.offsetHeight)}}}_positioningSettled(){this.panel.nativeElement.scrollTop=this._scrollTop}_calculateOverlayPosition(){if(!this.panel)return;const e=this.panel.nativeElement.clientHeight,r=this.panel.nativeElement.scrollHeight-e,a=this._selectionModel.selected[0];this._scrollTop=this.empty||-1===this.options.toArray().indexOf(a)?0:this._calculateOverlayScroll(a,e/2,r)}}return n.\u0275fac=function(e){return new(e||n)(ue(Od),ue(So),ue(Ui),ue(JR),ue(ci),ue(Ky,8),ue(E_,8),ue(_D,8),ue(nu,10),hs("tabindex"),ue(m4),ue(OB),ue($ne,8))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-select"]],contentQueries:function(e,i,r){if(1&e&&(Uo(r,L1,5),Uo(r,KR,5)),2&e){let a;xi(a=wi())&&(i.options=a),xi(a=wi())&&(i.optionGroups=a)}},viewQuery:function(e,i){if(1&e&&(mo(Nne,5),mo(ez,5)),2&e){let r;xi(r=wi())&&(i.panel=r.first),xi(r=wi())&&(i.overlayDir=r.first)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"sbb-select","sbb-input-element"],hostVars:26,hostBindings:function(e,i){1&e&&Wt("click",function(){return i.toggle()})("keydown",function(a){return i._handleKeydown(a)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&e&&(si("id",i.id)("tabindex",i.readonly?-1:i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-owns",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),_("sbb-disabled",i.disabled)("sbb-select-invalid",i.errorState)("sbb-select-required",i.required)("sbb-select-empty",i.empty)("sbb-select-multiple",i.multiple)("sbb-readonly",i.readonly)("sbb-focused",i.focused)("sbb-input-with-open-panel",i.panelOpen))},inputs:{disabled:"disabled",tabIndex:"tabIndex",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",readonly:"readonly",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},exportAs:["sbbSelect"],features:[Mi([{provide:U1,useExisting:n},{provide:tD,useExisting:n}]),Un,ho],ngContentSelectors:Hne,decls:8,vars:20,consts:[["aria-hidden","true",1,"sbb-select-value",3,"ngSwitch"],["class","sbb-select-placeholder",4,"ngSwitchCase"],["class","sbb-select-value-text",4,"ngSwitchCase"],[3,"ngSwitch"],["class","sbb-icon-scaled sbb-select-arrow-icon","svgIcon","kom:chevron-small-down-small",4,"ngSwitchCase"],["class","sbb-icon-scaled sbb-select-arrow-icon sbb-select-arrow-icon-lean","svgIcon","kom:chevron-right-small",4,"ngSwitchCase"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayFlexibleDimensions","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayWidth","cdkConnectedOverlayOffsetX","cdkConnectedOverlayOffsetY","cdkConnectedOverlayMinHeight","backdropClick","attach","detach"],[1,"sbb-select-placeholder"],[1,"sbb-select-value-text"],["svgIcon","kom:chevron-small-down-small",1,"sbb-icon-scaled","sbb-select-arrow-icon"],["svgIcon","kom:chevron-right-small",1,"sbb-icon-scaled","sbb-select-arrow-icon","sbb-select-arrow-icon-lean"],["role","listbox","tabindex","-1",1,"sbb-panel","sbb-panel-padded","sbb-select-panel","sbb-scrollbar",3,"ngClass","keydown"],["panel",""]],template:function(e,i){1&e&&(Rs(),ne(0,"div",0),yt(1,Bne,2,1,"span",1),yt(2,zne,3,1,"span",2),oe(),ji(3,3),Uy(4,"async"),yt(5,Vne,1,0,"sbb-icon",4),yt(6,jne,1,0,"sbb-icon",5),Zi(),yt(7,Une,3,12,"ng-template",6),Wt("backdropClick",function(){return i.close()})("attach",function(){return i._onAttached()})("detach",function(){return i.close()})),2&e&&(_("sbb-select-value-empty",i.empty),Pe("ngSwitch",i.empty),si("id",i._valueId),pe(1),Pe("ngSwitchCase",!0),pe(1),Pe("ngSwitchCase",!1),pe(1),Pe("ngSwitch",Hy(4,18,i.variant)),pe(2),Pe("ngSwitchCase","standard"),pe(1),Pe("ngSwitchCase","lean"),pe(1),Pe("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",i._overlayOrigin)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayWidth",i._getOverlayMinWidth())("cdkConnectedOverlayOffsetX",0)("cdkConnectedOverlayOffsetY",i._offsetY)("cdkConnectedOverlayMinHeight",30))},dependencies:[rf,Xy,aT,ez,cl,kx],styles:[".sbb-select{display:inline-block;cursor:pointer;position:relative;text-align:left;padding-right:calc(2.9333333333rem * var(--sbb-scaling-factor))}:where(html.sbb-lean) .sbb-select{padding-right:2.5333333333rem}.sbb-select:is([readonly],.sbb-readonly){cursor:default}.sbb-form-field .sbb-select,.sbb-table th.sbb-header-cell.sbb-table-filter .sbb-select{display:block}.sbb-select-value{overflow:hidden;text-overflow:ellipsis}:where(html.sbb-lean) .sbb-select-value-empty{color:var(--sbb-color-storm)}.sbb-select-arrow-icon{position:absolute;top:50%;transform:translateY(-50%);right:calc(0.6rem * var(--sbb-scaling-factor));color:var(--sbb-color-granite)}:where(html.sbb-lean) .sbb-select-arrow-icon{right:.4rem}.sbb-select:is([readonly],.sbb-readonly) .sbb-select-arrow-icon{display:none}.sbb-select-arrow-icon>svg{transition:transform 120ms cubic-bezier(0, 0, 0.2, 1)}.sbb-input-with-open-panel .sbb-select-arrow-icon>svg{transform:rotate(180deg)}.sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(90deg)}.sbb-input-with-open-panel .sbb-icon.sbb-select-arrow-icon-lean>svg{transform:rotate(-90deg)}.sbb-select-panel :is(.sbb-menu-group+.sbb-menu-group,.sbb-menu-item+.sbb-menu-group,.sbb-menu-group+.sbb-menu-item){border-top:none}:where(html:not(.sbb-lean)) .sbb-select-panel.sbb-select-multiple .sbb-menu-group .sbb-menu-item{padding-left:calc(0.9333333333rem * var(--sbb-scaling-factor))}"],encapsulation:2,data:{animation:[qne.transformPanel]},changeDetection:0}),n})(),g4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[Wne],imports:[go,Tc,Ur,Ss,nD,nD,Tc]}),n})();function Jne(n,t){if(1&n&&(ne(0,"sbb-option",18),Z(1),oe()),2&n){const e=t.$implicit,i=St(2);Pe("value",e.modeType),pe(1),de(i.computeTripModeTypeText(e.modeType))}}function Kne(n,t){if(1&n){const e=or();ne(0,"div")(1,"sbb-form-field",4)(2,"sbb-label"),Z(3,"Mono-/Multi-modal"),oe(),ne(4,"sbb-select",5),Wt("ngModelChange",function(r){return Qn(e),ei(St().userTripService.tripModeType=r)})("selectionChange",function(){return Qn(e),ei(St().onTripModeChange())}),yt(5,Jne,2,2,"sbb-option",6),oe()()()}if(2&n){const e=St();pe(4),Pe("ngModel",e.userTripService.tripModeType),pe(1),Pe("ngForOf",e.tripTransportModeData)}}function Qne(n,t){if(1&n&&(ne(0,"sbb-option",18),Z(1),oe()),2&n){const e=t.$implicit,i=St();Pe("value",e),pe(1),de(i.computeTripTransportModeText(e))}}function eie(n,t){1&n&&rn(0,"sbb-icon",19)}function tie(n,t){1&n&&rn(0,"sbb-icon",20)}function nie(n,t){if(1&n){const e=or();ji(0),ne(1,"div",13)(2,"div",3)(3,"sbb-checkbox",14),Wt("ngModelChange",function(r){return Qn(e),ei(St().isFilterMinDurationEnabled=r)})("change",function(){return Qn(e),ei(St().updateAdditionalRestrictions())}),Z(4," MinDuration "),oe()(),ne(5,"div"),rn(6,"input",21),Z(7," minutes "),oe()(),ne(8,"div",13)(9,"div",3)(10,"sbb-checkbox",14),Wt("ngModelChange",function(r){return Qn(e),ei(St().isFilterMaxDurationEnabled=r)})("change",function(){return Qn(e),ei(St().updateAdditionalRestrictions())}),Z(11," MaxDuration "),oe()(),ne(12,"div"),rn(13,"input",21),Z(14," minutes "),oe()(),ne(15,"div",13)(16,"div",3)(17,"sbb-checkbox",14),Wt("ngModelChange",function(r){return Qn(e),ei(St().isFilterMinDistanceEnabled=r)})("change",function(){return Qn(e),ei(St().updateAdditionalRestrictions())}),Z(18," MinDistance "),oe()(),ne(19,"div"),rn(20,"input",22),Z(21," meters "),oe()(),ne(22,"div",13)(23,"div",3)(24,"sbb-checkbox",14),Wt("ngModelChange",function(r){return Qn(e),ei(St().isFilterMaxDistanceEnabled=r)})("change",function(){return Qn(e),ei(St().updateAdditionalRestrictions())}),Z(25," MaxDistance "),oe()(),ne(26,"div"),rn(27,"input",22),Z(28," meters "),oe()(),Zi()}if(2&n){const e=St();pe(3),Pe("ngModel",e.isFilterMinDurationEnabled),pe(3),Pe("formControl",e.filterMinDurationControl),pe(4),Pe("ngModel",e.isFilterMaxDurationEnabled),pe(3),Pe("formControl",e.filterMaxDurationControl),pe(4),Pe("ngModel",e.isFilterMinDistanceEnabled),pe(3),Pe("formControl",e.filterMinDistanceControl),pe(4),Pe("ngModel",e.isFilterMaxDistanceEnabled),pe(3),Pe("formControl",e.filterMaxDistanceControl)}}function iie(n,t){if(1&n&&(ne(0,"sbb-radio-button",18),Z(1),oe()),2&n){const e=t.$implicit;Pe("value",e),pe(1),De(" ",e," ")}}function rie(n,t){if(1&n){const e=or();ji(0),ne(1,"div",23)(2,"div"),Z(3,"UseRealTimeData"),oe(),ne(4,"div")(5,"sbb-radio-group",24),Wt("ngModelChange",function(r){return Qn(e),ei(St().selectedUseRealTimeDataType=r)})("change",function(){return Qn(e),ei(St().updateAdditionalRestrictions())}),yt(6,iie,2,2,"sbb-radio-button",6),oe()()(),Zi()}if(2&n){const e=St();pe(5),Pe("ngModel",e.selectedUseRealTimeDataType),pe(1),Pe("ngForOf",e.useRealTimeDataTypes)}}function oie(n,t){if(1&n&&(ji(0),ne(1,"sbb-radio-button",18),Z(2),oe(),Zi()),2&n){const e=t.$implicit;pe(1),Pe("value",e),pe(1),De(" ",e," % ")}}function sie(n,t){if(1&n){const e=or();ji(0),ne(1,"div",25)(2,"div",26),Z(3,"Deviation from average walking speed in percent. (100% == average)"),oe(),ne(4,"div",27)(5,"sbb-radio-group",24),Wt("ngModelChange",function(r){return Qn(e),ei(St().walkSpeedDeviation=r)})("change",function(){return Qn(e),ei(St().updateAdditionalRestrictions())}),yt(6,oie,3,2,"ng-container",28),oe()()(),Zi()}if(2&n){const e=St();pe(5),Pe("ngModel",e.walkSpeedDeviation),pe(1),Pe("ngForOf",e.walkSpeedDeviationValues)}}const aie=function(n){return{show:n}},_4="2.0"===Mo,TD=_4?"foot":"walk",CD=_4?"car":"self-drive-car",lie=[{modeType:"monomodal",transportModes:["public_transport",TD,"cycle",CD,"bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start",transportModes:[TD,"cycle","bicycle_rental","escooter_rental","taxi","others-drive-car"]},{modeType:"mode_at_end",transportModes:[TD,"bicycle_rental","escooter_rental","car_sharing","taxi","others-drive-car"]},{modeType:"mode_at_start_end",transportModes:[TD,"bicycle_rental","escooter_rental"]}];let cie=(()=>{class n{constructor(e){this.userTripService=e,this.filterMinDurationControl=new Hu(""),this.filterMaxDurationControl=new Hu(""),this.filterMinDistanceControl=new Hu(""),this.filterMaxDistanceControl=new Hu(""),this.tripTransportModeData=lie,this.tripTransportModes=JSON.parse(JSON.stringify(this.tripTransportModeData[0].transportModes)),this.prevTransportMode="public_transport",this.settingsCollapseID="mode_custom_mode_settings_NOT_READY_YET",this.filterMinDurationControl.setValue("2",{emitEvent:!1}),this.filterMaxDurationControl.setValue("30",{emitEvent:!1}),this.filterMinDistanceControl.setValue("100",{emitEvent:!1}),this.filterMaxDistanceControl.setValue("10000",{emitEvent:!1}),this.isFilterMinDurationEnabled=!0,this.isFilterMaxDurationEnabled=!0,this.isFilterMinDistanceEnabled=!0,this.isFilterMaxDistanceEnabled=!0,this.isNumberOfResultsEnabled=!0,this.isNumberOfResultsBeforeEnabled=!1,this.isNumberOfResultsAfterEnabled=!1,this.numberOfResults=5,this.numberOfResultsBefore=1,this.numberOfResultsAfter=4,this.walkSpeedDeviation=100,this.walkSpeedDeviationValues=[50,75,100,150,200,400],this.mapPublicTransportModesFilter={},this.mapPublicTransportModesFilter.rail=!1,this.mapPublicTransportModesFilter.bus=!1,this.mapPublicTransportModesFilter.water=!1,this.mapPublicTransportModesFilter.tram=!1,this.isV1="1.0"===Mo,this.useRealTimeDataTypes=["full","explanatory","none"],this.selectedUseRealTimeDataType=this.userTripService.useRealTimeDataType}ngOnInit(){var e;const i=null!==(e=this.tripTransportModeData.find(r=>r.modeType===this.userTripService.tripModeType))&&void 0!==e?e:this.tripTransportModeData[0];this.tripTransportModes=JSON.parse(JSON.stringify(i.transportModes)),this.prevTransportMode=this.userTripService.tripTransportMode,this.userTripService.defaultsInited.subscribe(r=>{this.userTripService.updateTripLocationCustomMode();const a="monomodal"===this.userTripService.tripModeType;a||(this.userTripService.isAdditionalRestrictionsEnabled=!0,this.updateAdditionalRestrictions()),a&&this.userTripService.tripTransportMode===CD&&(this.numberOfResults=0,this.userTripService.numberOfResults=0),this.userTripService.publicTransportModesFilter.length>0&&(this.userTripService.isAdditionalRestrictionsEnabled=!0,this.userTripService.publicTransportModesFilter.forEach(b=>{"bus"===b&&(this.mapPublicTransportModesFilter.bus=!0),"rail"===b&&(this.mapPublicTransportModesFilter.rail=!0),"water"===b&&(this.mapPublicTransportModesFilter.water=!0),"tram"===b&&(this.mapPublicTransportModesFilter.tram=!0)})),this.userTripService.searchFormAfterDefaultsInited.emit()}),this.filterMinDurationControl.valueChanges.pipe(zh(200)).subscribe(r=>{this.updateAdditionalRestrictions()}),this.filterMaxDurationControl.valueChanges.pipe(zh(200)).subscribe(r=>{this.updateAdditionalRestrictions()}),this.filterMinDistanceControl.valueChanges.pipe(zh(200)).subscribe(r=>{this.updateAdditionalRestrictions()}),this.filterMaxDistanceControl.valueChanges.pipe(zh(200)).subscribe(r=>{this.updateAdditionalRestrictions()}),this.settingsCollapseID="mode_custom_mode_settings_0"}updateAdditionalRestrictions(){let e=null,i=null,r=null,a=null,d=5,b=null,x=null;this.userTripService.publicTransportModesFilter=[],this.userTripService.walkSpeedDeviation=null,this.userTripService.isAdditionalRestrictionsEnabled&&(this.isFilterMinDurationEnabled&&(e=SD.parseNumber(this.filterMinDurationControl.value)),this.isFilterMaxDurationEnabled&&(i=SD.parseNumber(this.filterMaxDurationControl.value)),this.isFilterMinDistanceEnabled&&(r=SD.parseNumber(this.filterMinDistanceControl.value)),this.isFilterMaxDistanceEnabled&&(a=SD.parseNumber(this.filterMaxDistanceControl.value)),d=this.isNumberOfResultsEnabled?this.numberOfResults:null,this.isNumberOfResultsBeforeEnabled&&(b=this.numberOfResultsBefore),this.isNumberOfResultsAfterEnabled&&(x=this.numberOfResultsAfter),["bus","tram","rail","water"].forEach(O=>{!0===this.mapPublicTransportModesFilter[O]&&this.userTripService.publicTransportModesFilter.push(O)}),this.userTripService.walkSpeedDeviation=this.walkSpeedDeviation),this.userTripService.updateTripLocationRestrictions(e,i,r,a),this.userTripService.numberOfResults=d,this.userTripService.numberOfResultsAfter=x,this.userTripService.numberOfResultsBefore=b,this.userTripService.useRealTimeDataType=this.selectedUseRealTimeDataType,this.userTripService.updateURLs()}onTripModeChange(){var e;const i=this.userTripService.tripModeType,r=null!==(e=this.tripTransportModeData.find(d=>d.modeType===i))&&void 0!==e?e:null;null!==r&&("monomodal"!==i&&(this.userTripService.isAdditionalRestrictionsEnabled||(this.userTripService.isAdditionalRestrictionsEnabled=!0),this.updateAdditionalRestrictions()),this.tripTransportModes=JSON.parse(JSON.stringify(r.transportModes)),-1!==this.tripTransportModes.indexOf(this.userTripService.tripTransportMode)||(this.userTripService.tripTransportMode=this.tripTransportModes[0]),this.userTripService.updateTripMode(),this.userTripService.updateTripLocationCustomMode())}onTransportModeChange(){const e=this.userTripService.tripTransportMode===CD;e&&(this.numberOfResults=0,this.userTripService.numberOfResults=0),this.prevTransportMode===CD&&!e&&(this.numberOfResults=5,this.userTripService.numberOfResults=5),this.userTripService.updateTripMode(),this.userTripService.updateTripLocationCustomMode(),this.prevTransportMode=this.userTripService.tripTransportMode}computeTripModeTypeText(e){var i;return null!==(i={monomodal:"Monomodal",mode_at_start:"Mode at Start",mode_at_end:"Mode at End",mode_at_start_end:"Mode at Start & End"}[e])&&void 0!==i?i:"n/a"}computeTripTransportModeText(e){var i;return null!==(i={public_transport:"Public Transport",walk:"Walking",cycle:"Own Bicycle",escooter_rental:"eScooter Sharing",car_sharing:"Car Sharing","self-drive-car":"Own Car",bicycle_rental:"Bicycle Sharing",charging_station:"Charging Stations",taxi:"Taxi","others-drive-car":"Limousine","car-shuttle-train":"Autoverlad",car:"Car","car-ferry":"Ferry",foot:"Foot (walking)"}[e])&&void 0!==i?i:"n/a"}toggleAdditionalRestrictions(){this.userTripService.isAdditionalRestrictionsEnabled=!this.userTripService.isAdditionalRestrictionsEnabled,this.updateAdditionalRestrictions()}}return n.\u0275fac=function(e){return new(e||n)(ue(ia))},n.\u0275cmp=Jt({type:n,selectors:[["trip-mode-type"]],decls:47,vars:25,consts:[[1,"trip-mot-type-container"],[1,"d-flex","gap-1","align-items-center","via-mot"],[4,"ngIf"],[1,"flex-grow-1"],[1,"w-100"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"mobility-settings"],["sbb-secondary-button","","type","button","data-bs-toggle","collapse","aria-expanded","false",3,"disabled","click"],["svgIcon","kom:filter-small",4,"ngIf"],["svgIcon","kom:filter-x-small",4,"ngIf"],[1,"mobility-settings-left-v2","endpoint-settings-wrapper","collapse",3,"ngClass","id"],[1,"endpoint-settings"],[1,"d-flex","align-items-center","mb-2"],["value","single-checkbox",3,"ngModel","ngModelChange","change"],["sbbInput","",2,"width","50px",3,"ngModel","ngModelChange","change"],[1,"d-flex","gap-2","align-items-center","mb-2"],[3,"ngModel","ngModelChange","change"],[3,"value"],["svgIcon","kom:filter-small"],["svgIcon","kom:filter-x-small"],["sbbInput","",2,"width","50px",3,"formControl"],["sbbInput","",2,"width","70px",3,"formControl"],[1,"d-flex","gap-2","align-items-center","mb-3"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange","change"],[1,"mb-2"],[1,"mb-1"],[1,"d-flex","gap-2","align-items-center"],[4,"ngFor","ngForOf"]],template:function(e,i){1&e&&(ne(0,"div",0)(1,"div",1),yt(2,Kne,6,2,"div",2),ne(3,"div",3)(4,"sbb-form-field",4)(5,"sbb-label"),Z(6,"Mode of Transport"),oe(),ne(7,"sbb-select",5),Wt("ngModelChange",function(a){return i.userTripService.tripTransportMode=a})("selectionChange",function(){return i.onTransportModeChange()}),yt(8,Qne,2,2,"sbb-option",6),oe()()(),ne(9,"div",7)(10,"button",8),Wt("click",function(){return i.toggleAdditionalRestrictions()}),yt(11,eie,1,0,"sbb-icon",9),yt(12,tie,1,0,"sbb-icon",10),oe()()(),ne(13,"div",11)(14,"div",12),yt(15,nie,29,8,"ng-container",2),ne(16,"div",13)(17,"div",3)(18,"sbb-checkbox",14),Wt("ngModelChange",function(a){return i.isNumberOfResultsEnabled=a})("change",function(){return i.updateAdditionalRestrictions()}),Z(19," NumberOfResults "),oe()(),ne(20,"div")(21,"input",15),Wt("ngModelChange",function(a){return i.numberOfResults=a})("change",function(){return i.updateAdditionalRestrictions()}),oe()()(),ne(22,"div",13)(23,"div",3)(24,"sbb-checkbox",14),Wt("ngModelChange",function(a){return i.isNumberOfResultsBeforeEnabled=a})("change",function(){return i.updateAdditionalRestrictions()}),Z(25," NumberOfResultsBefore "),oe()(),ne(26,"div")(27,"input",15),Wt("ngModelChange",function(a){return i.numberOfResultsBefore=a})("change",function(){return i.updateAdditionalRestrictions()}),oe()()(),ne(28,"div",13)(29,"div",3)(30,"sbb-checkbox",14),Wt("ngModelChange",function(a){return i.isNumberOfResultsAfterEnabled=a})("change",function(){return i.updateAdditionalRestrictions()}),Z(31," NumberOfResultsAfter "),oe()(),ne(32,"div")(33,"input",15),Wt("ngModelChange",function(a){return i.numberOfResultsAfter=a})("change",function(){return i.updateAdditionalRestrictions()}),oe()()(),yt(34,rie,7,2,"ng-container",2),ne(35,"div",16)(36,"div"),Z(37,"Travel only with"),oe(),ne(38,"sbb-checkbox",17),Wt("ngModelChange",function(a){return i.mapPublicTransportModesFilter.rail=a})("change",function(){return i.updateAdditionalRestrictions()}),Z(39,"train"),oe(),ne(40,"sbb-checkbox",17),Wt("ngModelChange",function(a){return i.mapPublicTransportModesFilter.bus=a})("change",function(){return i.updateAdditionalRestrictions()}),Z(41,"bus"),oe(),ne(42,"sbb-checkbox",17),Wt("ngModelChange",function(a){return i.mapPublicTransportModesFilter.tram=a})("change",function(){return i.updateAdditionalRestrictions()}),Z(43,"tram"),oe(),ne(44,"sbb-checkbox",17),Wt("ngModelChange",function(a){return i.mapPublicTransportModesFilter.water=a})("change",function(){return i.updateAdditionalRestrictions()}),Z(45,"boat"),oe()(),yt(46,sie,7,2,"ng-container",2),oe()()()),2&e&&(pe(2),Pe("ngIf",i.isV1),pe(5),Pe("ngModel",i.userTripService.tripTransportMode),pe(1),Pe("ngForOf",i.tripTransportModes),pe(2),Pe("disabled","monomodal"!==i.userTripService.tripModeType),si("data-bs-target","#"+i.settingsCollapseID)("aria-controls",i.settingsCollapseID),pe(1),Pe("ngIf",!i.userTripService.isAdditionalRestrictionsEnabled),pe(1),Pe("ngIf",i.userTripService.isAdditionalRestrictionsEnabled),pe(1),Ir("id",i.settingsCollapseID),Pe("ngClass",Jc(23,aie,i.userTripService.isAdditionalRestrictionsEnabled)),pe(2),Pe("ngIf",i.isV1),pe(3),Pe("ngModel",i.isNumberOfResultsEnabled),pe(3),Pe("ngModel",i.numberOfResults),pe(3),Pe("ngModel",i.isNumberOfResultsBeforeEnabled),pe(3),Pe("ngModel",i.numberOfResultsBefore),pe(3),Pe("ngModel",i.isNumberOfResultsAfterEnabled),pe(3),Pe("ngModel",i.numberOfResultsAfter),pe(1),Pe("ngIf",!i.isV1),pe(4),Pe("ngModel",i.mapPublicTransportModesFilter.rail),pe(2),Pe("ngModel",i.mapPublicTransportModesFilter.bus),pe(2),Pe("ngModel",i.mapPublicTransportModesFilter.tram),pe(2),Pe("ngModel",i.mapPublicTransportModesFilter.water),pe(2),Pe("ngIf",!i.isV1))},dependencies:[rf,Sl,Zo,tu,Uu,Oh,Qy,L1,f2,c2,Dv,H1,cl,J_,xD,G1,Yne],styles:[".trip-mot-type-container[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.mobility-settings[_ngcontent-%COMP%]{margin-top:3px}.mobility-settings-left-v2[_ngcontent-%COMP%]{margin-left:10px}.endpoint-settings[_ngcontent-%COMP%]{margin-bottom:18px;margin-left:12px;margin-right:12px;padding:0 14px;border-color:#cacaca;border-style:solid;border-width:0 1px 1px 1px;border-radius:2px}"]}),n})();function uie(n,t){1&n&&Wo(0)}function die(n,t){1&n&&rn(0,"sbb-icon",37)}function hie(n,t){1&n&&rn(0,"sbb-icon",38)}function pie(n,t){1&n&&(ji(0),rn(1,"trip-mode-type"),Zi())}function fie(n,t){if(1&n&&(ne(0,"sbb-radio-button",39),Z(1),oe()),2&n){const e=t.$implicit;Pe("value",e),pe(1),de(e)}}function mie(n,t){if(1&n){const e=or();ne(0,"sbb-radio-button",43),Wt("change",function(r){return Qn(e),ei(St(3).onChangeStageAPI(r))}),Z(1),oe()}if(2&n){const e=t.$implicit,i=St(3);Pe("value",e)("checked",i.userTripService.currentAppStage==e),pe(1),De(" ",e," ")}}function gie(n,t){if(1&n&&(ne(0,"div",40)(1,"div")(2,"sbb-radio-group",41),yt(3,mie,2,3,"sbb-radio-button",42),oe()()()),2&n){const e=St(2);pe(3),Pe("ngForOf",e.appStageOptions)}}function _ie(n,t){1&n&&rn(0,"span",44)}function bie(n,t){if(1&n){const e=or();ne(0,"div",45)(1,"button",46),Wt("click",function(){return Qn(e),ei(St(2).loadInputTripXMLPopover())}),Z(2," Debug XML "),oe()()}}const yie=function(n){return{show:n}};function vie(n,t){if(1&n){const e=or();ne(0,"div",6)(1,"div",7)(2,"journey-point-input",8),Wt("selectedLocation",function(r){return Qn(e),ei(St().onLocationSelected(r,"From"))}),oe()(),ne(3,"div",9)(4,"button",10),Wt("click",function(){return Qn(e),ei(St().toggleViaState())}),yt(5,die,1,0,"sbb-icon",11),yt(6,hie,1,0,"sbb-icon",12),oe()()(),ne(7,"div",13)(8,"div",14)(9,"div",7)(10,"journey-point-input",8),Wt("selectedLocation",function(r){return Qn(e),ei(St().onLocationSelected(r,"Via"))}),oe()(),ne(11,"div",15)(12,"sbb-form-field",16)(13,"sbb-label"),Z(14,"Dwell Time (mins)"),oe(),rn(15,"input",17),oe()()()(),yt(16,pie,2,0,"ng-container",18),ne(17,"div",6)(18,"div",7)(19,"journey-point-input",8),Wt("selectedLocation",function(r){return Qn(e),ei(St().onLocationSelected(r,"To"))}),oe()(),ne(20,"div",9)(21,"button",19),Wt("click",function(){return Qn(e),ei(St().swapEndpoints())}),rn(22,"sbb-icon",20),oe()()(),ne(23,"div",21)(24,"div")(25,"sbb-form-field",22)(26,"sbb-datepicker",23)(27,"input",24),Wt("ngModelChange",function(r){return Qn(e),ei(St().searchDate=r)})("dateChange",function(){return Qn(e),ei(St().onChangeDateTime())}),oe()()()(),ne(28,"div",25)(29,"sbb-form-field",26)(30,"input",27),Wt("ngModelChange",function(r){return Qn(e),ei(St().searchTime=r)})("change",function(){return Qn(e),ei(St().onChangeDateTime())}),oe()()(),ne(31,"div")(32,"button",19),Wt("click",function(){return Qn(e),ei(St().resetDateTime())}),rn(33,"sbb-icon",28),oe()(),ne(34,"div")(35,"sbb-radio-group",29),Wt("ngModelChange",function(r){return Qn(e),ei(St().userTripService.currentBoardingType=r)}),yt(36,fie,2,2,"sbb-radio-button",30),oe()()(),yt(37,gie,4,1,"div",31),ne(38,"div",32)(39,"div",33)(40,"button",34),Wt("click",function(){return Qn(e),ei(St().handleTapOnSearch())}),yt(41,_ie,1,0,"span",35),Z(42," Search Journeys "),oe()(),yt(43,bie,3,0,"div",36),oe()}if(2&n){const e=St();pe(2),Pe("endpointType","From")("inputValue",e.fromLocationText)("placeholder","From"),pe(3),Pe("ngIf",!e.userTripService.isViaEnabled),pe(1),Pe("ngIf",e.userTripService.isViaEnabled),pe(1),Pe("ngClass",Jc(22,yie,e.userTripService.isViaEnabled)),pe(3),Pe("endpointType","Via")("inputValue",e.viaText)("placeholder","Via"),pe(5),Pe("formControl",e.viaDwellTime),pe(1),Pe("ngIf",!e.isEmbed),pe(3),Pe("endpointType","To")("inputValue",e.toLocationText)("placeholder","To"),pe(8),Pe("ngModel",e.searchDate),pe(3),Pe("ngModel",e.searchTime),pe(5),Pe("ngModel",e.userTripService.currentBoardingType),pe(1),Pe("ngForOf",e.tripRequestBoardingTypes),pe(1),Pe("ngIf",!1===e.isEmbed),pe(3),Pe("disabled",e.shouldDisableSearchButton()),pe(1),Pe("ngIf",e.isSearching),pe(2),Pe("ngIf",!e.isEmbed)}}function xie(n,t){if(1&n){const e=or();ji(0),ne(1,"div",49),Wt("click",function(){return Qn(e),ei(St(2).reportIssueXMLPopover())}),ne(2,"span",50),Z(3,"Report Issue"),oe()(),ne(4,"div",49),Wt("click",function(){return Qn(e),ei(St(2).showRequestXMLPopover())}),ne(5,"span",51),Z(6,"XML"),oe()(),Zi()}}function wie(n,t){if(1&n&&(ne(0,"div")(1,"span",52),Z(2),oe()()),2&n){const e=St(2);pe(2),de(e.requestDurationF)}}function Sie(n,t){if(1&n){const e=or();ji(0),ne(1,"div")(2,"a",53),Z(3,"SBB"),oe()(),ne(4,"div",54),Z(5," | "),oe(),ne(6,"div")(7,"a",53),Z(8),oe()(),ne(9,"div",54),Z(10," | "),oe(),ne(11,"div")(12,"a",53),Z(13,"PROD"),oe()(),ne(14,"div",54),Z(15," | "),oe(),ne(16,"div")(17,"a",53),Z(18,"Permalink"),oe()(),ne(19,"div",54),Z(20," | "),oe(),ne(21,"div")(22,"a",55),Wt("click",function(){return Qn(e),ei(St(2).loadEmbedHTMLPopover())}),Z(23,"Embed"),oe()(),Zi()}if(2&n){const e=St(2);pe(2),Ir("href",e.userTripService.sbbURL,zo),pe(5),Ir("href",e.userTripService.betaURL,zo),pe(1),de(e.userTripService.betaURLText),pe(4),Ir("href",e.userTripService.prodURL,zo),pe(5),Ir("href",e.userTripService.permalinkRelativeURL,zo)}}function Tie(n,t){if(1&n&&(ne(0,"div",47)(1,"div",1)(2,"div",48),yt(3,xie,7,0,"ng-container",18),yt(4,wie,3,1,"div",18),yt(5,Sie,24,5,"ng-container",18),oe()()()),2&n){const e=St();pe(3),Pe("ngIf",null!==e.currentRequestInfo),pe(1),Pe("ngIf",null!==e.requestDurationF),pe(1),Pe("ngIf",null!==e.userTripService.permalinkRelativeURL)}}function Cie(n,t){if(1&n&&(ne(0,"div",47)(1,"div",1)(2,"div",56)(3,"div")(4,"a",53),Z(5,"Open in OJP Demo App"),oe()()()()()),2&n){const e=St();pe(4),Ir("href",e.userTripService.permalinkRelativeURL,zo)}}function Die(n,t){if(1&n&&(ne(0,"div",47)(1,"div",1)(2,"div"),Z(3," Content from "),ne(4,"a",53),Z(5),oe()()()()),2&n){const e=St();pe(4),Ir("href",e.gistURL,zo),pe(1),de(e.gistURL)}}let b4=(()=>{class n{constructor(e,i,r,a,d,b){this.notificationToast=e,this.popover=i,this.router=r,this.languageService=a,this.userTripService=d,this.breakpointObserver=b,this.isSmallScreen=!1,this.viaDwellTime=new Hu(""),this.appStageOptions=[];const x=this.userTripService.departureDate;this.searchDate=x,this.searchTime=bn.DateHelpers.formatTimeHHMM(x),this.fromLocationText="",this.toLocationText="",this.viaText="",this.appStageOptions=WA,this.isSearching=!1,this.requestDurationF=null,this.currentRequestInfo=null,this.lastCustomTripRequestXML=null,this.useMocks=!1,this.headerText="Search",this.tripRequestBoardingTypes=["Dep","Arr"];const A=new URLSearchParams(document.location.search);this.useMocks="yes"===A.get("use_mocks"),this.isEmbed=-1!==this.router.url.indexOf("/embed/"),this.gistURL=null}ngOnInit(){this.useMocks?this.initLocationsFromMocks():(this.userTripService.locationsUpdated.subscribe(e=>{this.updateLocationTexts(),this.updateViaDwellTime()}),this.userTripService.tripsDataUpdated.subscribe(e=>{e.length>0?this.collapseSearchPanel():this.expandSearchPanel()}),this.userTripService.searchParamsReset.subscribe(()=>{this.expandSearchPanel(),this.requestDurationF=null,this.currentRequestInfo=null}),this.userTripService.searchFormAfterDefaultsInited.subscribe(e=>{this.customInitFromParams()}),this.userTripService.tripRequestFinished.subscribe(e=>{const i=mD.computeExecutionTime(e.requestDateTime,e.responseDateTime),r=mD.computeExecutionTime(e.responseDateTime,e.parseDateTime);this.requestDurationF=(i+r).toFixed(2)+" sec",this.currentRequestInfo=e}),this.viaDwellTime.valueChanges.pipe(zh(300)).subscribe(e=>{this.updateViaDwellTime()}),this.userTripService.initDefaults(this.languageService.language),this.breakpointObserver.observe(["(min-width: 600px) and (max-width: 959.98px)","(max-width: 599.98px)"]).subscribe(e=>{this.isSmallScreen=e.matches}))}updateViaDwellTime(){if(0===this.userTripService.viaTripLocations.length)return;let e=Number(this.viaDwellTime.value);e=isNaN(e)?null:e,this.userTripService.viaTripLocations[0].dwellTimeMinutes=e}customInitFromParams(){var e;const i=new URLSearchParams(document.location.search);if(null!==(e=i.get("do_search"))&&void 0!==e&&e)return void this.handleTapOnSearch();const a=i.get("gist");a&&this.initFromGistRef(a)}updateLocationTexts(){var e;const r=[];["From","To"].forEach(d=>{var b,x;const A="From"===d?this.userTripService.fromTripLocation:this.userTripService.toTripLocation,O=null!==(b=null==A?void 0:A.location)&&void 0!==b?b:null;if(null===O)return;let B=null!==(x=O.computeLocationName())&&void 0!==x?x:"";"From"===d?this.fromLocationText=B.trim():this.toLocationText=B.trim(),r.push(B)}),this.userTripService.viaTripLocations.length>0&&(this.viaText=null!==(e=this.userTripService.viaTripLocations[0].location.computeLocationName())&&void 0!==e?e:"Name n/a");const a=[];a.push(""===this.fromLocationText?"From Location":this.fromLocationText),a.push("-"),a.push(""===this.toLocationText?"To Location":this.toLocationText),this.headerText=a.join(" ")}initLocationsFromMocks(){var e=this;return mr(function*(){const r=yield(yield fetch("/path/to/mock")).text();e.initFromMockXML(r)})()}initFromMockXML(e){var i=this;return mr(function*(){const d=bn.TripRequest.initWithResponseMock(e,"2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,Ps);d.fetchResponseWithCallback(b=>{"TripRequest.TripsNo"===b.message&&"DEBUG"===Sc&&console.log("DEBUG: TripsNo => "+b.tripsNo),"TripRequest.Trip"===b.message&&("DEBUG"===Sc&&console.log("DEBUG: New Trip => "+b.trips.length+"/"+b.tripsNo),1===b.trips.length&&i.handleCustomTripResponse(b.trips,d,!1)),"TripRequest.DONE"===b.message&&(i.collapseSearchPanel(),i.userTripService.massageTrips(b.trips),i.handleCustomTripResponse(b.trips,d,!0))})})()}initFromGistRef(e){var i=this;return mr(function*(){const r=yield no.fetchGist(e);null!==r?(i.gistURL="https://gist.github.com/"+e,i.initFromMockXML(r)):console.error("initFromGistRef: cant fetch gist XML")})()}onLocationSelected(e,i){this.userTripService.updateTripEndpoint(e,i,"SearchForm")}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value),this.userTripService.refetchEndpointsByName(this.languageService.language)}onChangeDateTime(){this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}computeFormDepartureDate(){const e=this.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),a=parseInt(i[1]);e.setHours(r),e.setMinutes(a)}return e}shouldDisableSearchButton(){return!!this.isSearching}handleTapOnSearch(){var e=this;return mr(function*(){const i="monomodal"===e.userTripService.tripModeType&&"public_transport"===e.userTripService.tripTransportMode;e.userTripService.updateDepartureDateTime(e.computeFormDepartureDate());const a=e.computeTripRequest(!i);if(null===a)return void e.notificationToast.open("Please check from/to input points",{type:"error",verticalPosition:"top"});e.notificationToast.dismiss(),e.isSearching=!0;const d=yield a.fetchResponse();if(e.isSearching=!1,e.logResponseTime(a.requestInfo,"DEBUG TR - 1st request"),"ERROR"===d.message)return e.notificationToast.open("ParseTripsXMLError",{type:"error",verticalPosition:"top"}),e.userTripService.journeyTripRequests=[],e.requestDurationF=null,e.userTripService.updateTrips([]),void e.userTripService.selectActiveTrip(null);const b=d.trips;if(e.userTripService.journeyTripRequests=[a],e.userTripService.tripRequestFinished.emit(a.requestInfo),e.userTripService.updateTrips(b),!(b.length>0))return e.notificationToast.open("No trips found",{type:"info",verticalPosition:"top"}),void e.userTripService.selectActiveTrip(null);e.userTripService.fetchFares(e.languageService.language);const A={};if(b.forEach(te=>{const se=no.computeTripHash(te);A[se]=te}),!i)return;const B=e.computeTripRequest(!0);if(null===B)return;const X=yield B.fetchResponse();e.logResponseTime(B.requestInfo,"DEBUG TR - 2nd request"),X.trips.forEach(te=>{var se;const me=no.computeTripHash(te),ye=null!==(se=A[me])&&void 0!==se?se:null;ye&&ye.legs.forEach(($e,ht)=>{if($e.legTrack){const At=te.legs[ht];At.legTrack&&($e.legTrack=At.legTrack)}if("ContinuousLeg"===$e.legType||"TransferLeg"===$e.legType){const At=$e,fn=te.legs[ht];At.pathGuidance&&fn.pathGuidance&&(At.pathGuidance=fn.pathGuidance)}})}),X.trips.length===d.trips.length&&(e.userTripService.journeyTripRequests=[B],e.userTripService.tripRequestFinished.emit(B.requestInfo)),e.userTripService.updateTrips(b)})()}logResponseTime(e,i){if("DEBUG"!==Sc)return;const d=(mD.computeExecutionTime(e.requestDateTime,e.responseDateTime)+mD.computeExecutionTime(e.responseDateTime,e.parseDateTime)).toFixed(2)+" sec";console.log(i+": "+d)}expandSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.open()}collapseSearchPanel(){var e;null===(e=this.searchPanel)||void 0===e||e.close()}loadInputTripXMLPopover(){const e=this.popover.open(Jee,{position:{top:"20px"},width:"50vw"});e.afterOpened().subscribe(()=>{var i;const r=e.componentInstance,a=this.computeTripRequest();a&&(a.updateRequestXML(),r.inputTripRequestXML=null!==(i=a.requestInfo.requestXML)&&void 0!==i?i:"n/a");const d=b=>{this.lastCustomTripRequestXML=r.inputTripRequestXML;const O=bn.TripRequest.initWithResponseMock(b,"2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,Ps);O.fetchResponse().then(B=>{r.inputTripRequestResponseXML=b,e.close(),this.userTripService.massageTrips(B.trips),this.handleCustomTripResponse(B.trips,O,!0)})};r.tripCustomRequestSaved.subscribe(d),r.tripCustomResponseSaved.subscribe(d)})}handleCustomTripResponse(e,i,r){this.requestDurationF="USER XML",this.isSearching=!1,this.userTripService.tripRequestFinished.emit(i.requestInfo),this.userTripService.journeyTripRequests=[i],this.userTripService.updateTrips(e),this.updateSearchForm(e)}updateSearchForm(e){0!==e.length&&(this.userTripService.updateParamsFromTrip(e[0]),this.updateLocationTexts())}swapEndpoints(){this.userTripService.switchEndpoints()}loadEmbedHTMLPopover(){this.popover.open(lte,{position:{top:"20px"}}).afterOpened().subscribe(()=>{})}toggleViaState(){this.userTripService.updateVia()}resetDateTime(){const e=new Date;this.searchDate=e,this.searchTime=bn.DateHelpers.formatTimeHHMM(e),this.userTripService.updateDepartureDateTime(this.computeFormDepartureDate())}showRequestXMLPopover(){const e=this.popover.open(N1,{position:{top:"20px"},width:"50vw",height:"90vh"});e.afterOpened().subscribe(()=>{if(this.currentRequestInfo){const i=e.componentInstance;i.isTripRequest=!0,i.updateRequestData(this.currentRequestInfo)}})}reportIssueXMLPopover(){const i=this.popover.open(fte,{position:{top:"20px"},width:this.isSmallScreen?"90vw":"50vw"});i.afterOpened().subscribe(()=>{if(this.currentRequestInfo){const a=i.componentInstance;a.requestInfo=this.currentRequestInfo;const d="2.0"===Mo,b=d?"[TR issue] ":"[OJP v1.0][TR issue] ";this.userTripService.updateURLs();const x=d?this.userTripService.betaV2URL:this.userTripService.betaV1URL;if(null===x)return;a.setInputValue("issueTitle",b),a.updateMetadataRows(x)}})}computeTripRequest(e=!1){const i="2.0"===Mo,r=i?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,a=this.userTripService.getStageConfig(),b=bn.TripRequest.initWithTripLocationsAndDate(a,this.languageService.language,r,Ps,this.userTripService.fromTripLocation,this.userTripService.toTripLocation,this.userTripService.departureDate,this.userTripService.currentBoardingType,e,this.userTripService.tripModeType,this.userTripService.tripTransportMode,this.userTripService.isViaEnabled?this.userTripService.viaTripLocations:[],this.userTripService.numberOfResults,this.userTripService.numberOfResultsBefore,this.userTripService.numberOfResultsAfter,this.userTripService.publicTransportModesFilter);return null!==b&&(b.enableExtensions="OJP-SI"!==this.userTripService.currentAppStage,b.useRealTimeDataType=this.userTripService.useRealTimeDataType,i&&(b.walkSpeedDeviation=this.userTripService.walkSpeedDeviation)),b}}return n.\u0275fac=function(e){return new(e||n)(ue(p2),ue(Cc),ue(pa),ue($u),ue(ia),ue($C))},n.\u0275cmp=Jt({type:n,selectors:[["app-search-form"]],viewQuery:function(e,i){if(1&e&&mo(wf,7),2&e){let r;xi(r=wi())&&(i.searchPanel=r.first)}},decls:12,vars:6,consts:[[1,"row","mb-1"],[1,"col"],[3,"expanded"],[4,"ngTemplateOutlet"],["searchContent",""],["class","row mb-2",4,"ngIf"],[1,"d-flex","align-items-center"],[1,"flex-grow-1","journey-endpoint"],[3,"endpointType","inputValue","placeholder","selectedLocation"],[1,"right-button"],["sbb-secondary-button","","data-bs-toggle","collapse","data-bs-target","#viaContainer","aria-controls","viaContainer","aria-expanded","false",1,"btn-collapse","collapsed",3,"click"],["svgIcon","kom:plus-medium",4,"ngIf"],["svgIcon","kom:minus-medium",4,"ngIf"],["id","viaContainer",1,"collapse",3,"ngClass"],[1,"d-flex","gap-2","align-items-center"],[1,"via-dwell-time"],[1,"sbb-form-field-long"],["type","text","sbbInput","","placeholder","0",3,"formControl"],[4,"ngIf"],["sbb-secondary-button","","aria-expanded","false",3,"click"],["svgIcon","kom:arrow-change-horizontal-medium"],[1,"d-flex","align-items-center","gap-2"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"width","70px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],["svgIcon","kom:arrow-circle-reset-small"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["class","mb-2 d-flex",4,"ngIf"],[1,"d-flex"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","ms-auto",4,"ngIf"],["svgIcon","kom:plus-medium"],["svgIcon","kom:minus-medium"],[3,"value"],[1,"mb-2","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"row","mb-2"],[1,"d-flex","gap-1","flex-row-reverse"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-warning","text-dark"],[1,"layer-xml-info","badge","bg-info","text-dark"],[1,"badge","bg-success"],["target","_blank",3,"href"],["clas","text-center"],["target","_blank","role","button",1,"text-decoration-underline",3,"click"],[1,"d-flex","flex-row-reverse"]],template:function(e,i){if(1&e&&(ne(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Z(5),oe(),yt(6,uie,1,0,"ng-container",3),oe()()()(),yt(7,vie,44,24,"ng-template",null,4,Kp),yt(9,Tie,6,3,"div",5),yt(10,Cie,6,1,"div",5),yt(11,Die,6,2,"div",5)),2&e){const r=el(8);pe(3),Pe("expanded",!0),pe(2),de(i.headerText),pe(1),Pe("ngTemplateOutlet",r),pe(3),Pe("ngIf",!i.isEmbed),pe(1),Pe("ngIf",i.isEmbed&&null!==i.userTripService.permalinkRelativeURL),pe(1),Pe("ngIf",null!==i.gistURL)}},dependencies:[rf,Sl,Zo,Px,tu,Uu,Oh,Qy,hD,wf,V1,f2,yD,q1,Dv,H1,cl,J_,xD,G1,a4,Fne,cie],styles:[".debug-xml[_ngcontent-%COMP%]:hover{cursor:pointer}.right-button[_ngcontent-%COMP%]{margin-left:5px;margin-top:10px}.via-dwell-time[_ngcontent-%COMP%]{margin-top:6px}.via-dwell-time[_ngcontent-%COMP%]   sbb-form-field[_ngcontent-%COMP%]{width:120px}"]}),n})();function Eie(n,t){if(1&n&&(ji(0),ne(1,"option",52),Z(2),oe(),Zi()),2&n){const e=t.$implicit;pe(1),Ir("value",e.id),pe(1),de(e.caption)}}function Iie(n,t){1&n&&(ne(0,"div",53)(1,"div",7)(2,"div"),rn(3,"input",23),oe(),ne(4,"div")(5,"span",20),Z(6,"Topographic Places (z12+)"),oe()(),ne(7,"div")(8,"span",21),Z(9,"XML"),oe()()()())}let w2=(()=>{class n{constructor(){this.model={sdkVersionText:"ojp-sdk-legacy: "+bn.SDK_VERSION+" - ojp-sdk-next: "+aB+" - OJP API "+Mo,lastUpdate:"21.July 2025",isTopograhicPlaceMapLayerEnabled:"DEBUG"===Sc,changelogURL:"https://github.com/openTdataCH/ojp-demo-app-src/blob/main/CHANGELOG.md",rasterLayers:XA}}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Jt({type:n,selectors:[["web-footer"]],decls:144,vars:5,consts:[[1,"d-none"],["id","map-debug-control"],[1,"d-flex","gap-2","align-items-center"],[1,"fw-bold"],["id","mapTypeSelect",1,"form-select","form-select-sm"],["value","default"],[4,"ngFor","ngForOf"],[1,"d-flex","gap-1"],["id","map_debug_zoom"],["id","map_debug_center"],["id","map-layers-legend-control"],[1,"map-layers-legend-wrapper"],[1,"d-flex","flex-row"],[1,"flex-grow-1","map-layers-header"],["href","#map_layers_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_body",1,"content-collapse","align-middle"],[1,"bi","bi-plus-circle"],[1,"bi","bi-dash-circle"],["id","map_layers_body",1,"collapse","show"],["data-map-layer-key","stops",1,"map-layer-data","mb-2"],["type","checkbox","checked","",1,"map-layer-checkbox","align-middle"],[1,"layer-text"],[1,"layer-xml-info","badge","bg-info","text-dark"],["data-map-layer-key","addresses",1,"map-layer-data","mb-2"],["type","checkbox",1,"map-layer-checkbox","align-middle"],["class","map-layer-data mb-2","data-map-layer-key","topographic_places",4,"ngIf"],[1,"flex-grow-1"],["href","#map_layers_mobility_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_mobility_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_mobility_body",1,"collapse","mb-2",2,"margin-left","8px"],["data-map-layer-key","sharing_cars",1,"map-layer-data"],["data-map-layer-key","sharing_bicycles",1,"map-layer-data"],["data-map-layer-key","sharing_scooters",1,"map-layer-data"],["data-map-layer-key","charging_stations",1,"map-layer-data"],[1,"map-composite-pois"],["href","#map_layers_pois_body","data-bs-toggle","collapse","aria-expanded","true","aria-controls","map_layers_pois_body",1,"content-collapse","collapsed","align-middle"],["id","map_layers_pois_body",1,"collapse","mb-2",2,"margin-left","8px"],["type","checkbox","data-osm-tag","service",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","shopping",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","leisure",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","catering",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","public",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","parkride",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","accommodation",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","sbb_services",1,"map-layer-poi","align-middle"],["type","checkbox","data-osm-tag","other",1,"map-layer-poi","align-middle"],[1,"row","bg-ojp-blue","text-white"],[1,"bg-ojp-primary","w-100",2,"height","5px"],[1,"col"],[1,"footer"],["href","https://opentransportdata.swiss/en/","target","_blank"],[1,"d-none","d-md-block"],["target","_blank",3,"href"],[1,"row",2,"height","16px"],[3,"value"],["data-map-layer-key","topographic_places",1,"map-layer-data","mb-2"]],template:function(e,i){1&e&&(ne(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),Z(4,"Map:"),oe(),ne(5,"select",4)(6,"option",5),Z(7,"Default"),oe(),yt(8,Eie,3,2,"ng-container",6),oe()(),ne(9,"div",7)(10,"div",3),Z(11,"Zoom:"),oe(),ne(12,"div",8),Z(13,"n/a"),oe()(),ne(14,"div",7)(15,"div",3),Z(16,"Center:"),oe(),ne(17,"div",9),Z(18,"n/a"),oe()()(),ne(19,"div",10)(20,"div",11)(21,"div",12)(22,"div",13),Z(23,"Toggle Map Layers"),oe(),ne(24,"div")(25,"a",14),rn(26,"i",15)(27,"i",16),oe()()(),ne(28,"div",17)(29,"div",18)(30,"div",7)(31,"div"),rn(32,"input",19),oe(),ne(33,"div")(34,"span",20),Z(35,"Stops (z13+)"),oe()(),ne(36,"div")(37,"span",21),Z(38,"XML"),oe()()()(),ne(39,"div",22)(40,"div",7)(41,"div"),rn(42,"input",23),oe(),ne(43,"div")(44,"span",20),Z(45,"Addresses (z17+)"),oe()(),ne(46,"div")(47,"span",21),Z(48,"XML"),oe()()()(),yt(49,Iie,10,0,"div",24),ne(50,"div",12)(51,"div",25),Z(52,"Shared Mobility"),oe(),ne(53,"div")(54,"a",26),rn(55,"i",15)(56,"i",16),oe()()(),ne(57,"div",27)(58,"div",28),rn(59,"input",23),ne(60,"span",20),Z(61,"Shared Cars (z12+)"),oe(),ne(62,"span",21),Z(63,"XML"),oe()(),ne(64,"div",29),rn(65,"input",23),ne(66,"span",20),Z(67,"Shared Bicycles (z14+)"),oe(),ne(68,"span",21),Z(69,"XML"),oe()(),ne(70,"div",30),rn(71,"input",23),ne(72,"span",20),Z(73,"Shared Scooters (z14+)"),oe(),ne(74,"span",21),Z(75,"XML"),oe()(),ne(76,"div",31),rn(77,"input",23),ne(78,"span",20),Z(79,"Charging Stations (z12+)"),oe(),ne(80,"span",21),Z(81,"XML"),oe()()(),ne(82,"div",32)(83,"div",12)(84,"div",25),Z(85,"Other POIs (z16+) "),ne(86,"span",21),Z(87,"XML"),oe()(),ne(88,"div")(89,"a",33),rn(90,"i",15)(91,"i",16),oe()()(),ne(92,"div",34)(93,"div"),rn(94,"input",35),ne(95,"span",20),Z(96,"Service"),oe()(),ne(97,"div"),rn(98,"input",36),ne(99,"span",20),Z(100,"Shopping"),oe()(),ne(101,"div"),rn(102,"input",37),ne(103,"span",20),Z(104,"Leisure"),oe()(),ne(105,"div"),rn(106,"input",38),ne(107,"span",20),Z(108,"Catering"),oe()(),ne(109,"div"),rn(110,"input",39),ne(111,"span",20),Z(112,"Public"),oe()(),ne(113,"div"),rn(114,"input",40),ne(115,"span",20),Z(116,"Parkride"),oe()(),ne(117,"div"),rn(118,"input",41),ne(119,"span",20),Z(120,"Accommodation"),oe()(),ne(121,"div"),rn(122,"input",42),ne(123,"span",20),Z(124,"SBB Services"),oe()(),ne(125,"div"),rn(126,"input",43),ne(127,"span",20),Z(128,"Other"),oe()()()()()()()(),ne(129,"div",44),rn(130,"div",45),ne(131,"div",46)(132,"div",47)(133,"div"),Z(134," \xa9 "),ne(135,"a",48),Z(136,"Open-Data-Plattform Mobilit\xe4t Schweiz"),oe(),Z(137," 2021 - 2025 "),oe(),ne(138,"div",49),Z(139," Last Update: "),ne(140,"a",50),Z(141),oe(),Z(142),oe()()()(),rn(143,"div",51)),2&e&&(pe(8),Pe("ngForOf",i.model.rasterLayers),pe(41),Pe("ngIf",i.model.isTopograhicPlaceMapLayerEnabled),pe(91),Ir("href",i.model.changelogURL,zo),pe(1),de(i.model.lastUpdate),pe(1),De(" - ",i.model.sdkVersionText," "))},dependencies:[Sl,Zo,dA,pA],encapsulation:2}),n})(),S2=(()=>{class n{constructor(e){this.appService=e,this.model={headerText:this.appService.baseTitle}}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)(ue(p1))},n.\u0275cmp=Jt({type:n,selectors:[["web-header"]],decls:21,vars:3,consts:[[1,"row"],[1,"col","nav-main","bg-ojp-blue"],[1,"d-flex","flex-row","align-items-center","justify-content-between"],[1,"d-flex","flex-column","gap-2","mt-2","mb-1"],[1,"navbar-brand","text-white",3,"routerLink"],[1,"d-none","d-md-block"],["src","assets/opentransportdata.swiss.header-icons.svg","height","23"],[1,"d-none","d-md-flex"],[1,"nav-item"],["href","https://github.com/openTdataCH/ojp-demo-app-src",1,"nav-link"],["href","https://github.com/openTdataCH/ojp-demo-app-src/blob/main/docs/README.md",1,"nav-link"],["href","https://opentransportdata.swiss/en/cookbook/open-journey-planner-ojp/",1,"nav-link"],[1,"bg-ojp-primary","w-100",2,"height","10px"]],template:function(e,i){1&e&&(ne(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"a",4),Z(6),oe()(),ne(7,"div",5)(8,"a",4),rn(9,"img",6),oe()()(),ne(10,"div",7)(11,"div",8)(12,"a",9),Z(13,"Source Code"),oe()(),ne(14,"div",8)(15,"a",10),Z(16,"Docs"),oe()(),ne(17,"div",8)(18,"a",11),Z(19,"OJP Cookbook"),oe()()()()(),rn(20,"div",12),oe()),2&e&&(pe(5),Pe("routerLink","../search"),pe(1),de(i.model.headerText),pe(2),Pe("routerLink","../search"))},dependencies:[F_],encapsulation:2}),n})();const y4=function(n){return{stage:n}};let Mie=(()=>{class n{constructor(e,i){this.appService=e,this.userTripService=i}ngOnInit(){this.appService.setTitle("TripRequest")}}return n.\u0275fac=function(e){return new(e||n)(ue(p1),ue(ia))},n.\u0275cmp=Jt({type:n,selectors:[["journey-search"]],decls:19,vars:11,consts:[[1,"d-flex","flex-column","vh-100","overflow-hidden"],[1,"ms-2"],["sbb-tab-nav-bar",""],["sbb-tab-link","",3,"active"],["sbb-tab-link","",3,"active","routerLink","queryParams"],[1,"flex-grow-1","d-flex","flex-column","overflow-hidden","p-3"],[1,"d-flex","gap-2","flex-grow-1","overflow-hidden"],[1,"d-flex","flex-column","overflow-x-hidden","overflow-y-auto",2,"width","600px"],[1,"flex-shrink-0"],[1,"flex-grow-1","overflow-x-hidden","overflow-y-scroll"],[1,"flex-grow-1","h-100"]],template:function(e,i){1&e&&(ne(0,"div",0),rn(1,"web-header",1),ne(2,"nav",2)(3,"a",3),Z(4,"Journey Search"),oe(),ne(5,"a",4),Z(6,"Station Board"),oe(),ne(7,"a",4),Z(8,"Trip Info"),oe()(),ne(9,"div",5)(10,"div",6)(11,"div",7)(12,"div",8),rn(13,"app-search-form"),oe(),ne(14,"div",9),rn(15,"journey-results"),oe()(),ne(16,"div",10),rn(17,"app-map"),oe()()(),rn(18,"web-footer",1),oe()),2&e&&(pe(3),Pe("active","true"),pe(2),Pe("active","false")("routerLink","../board")("queryParams",Jc(7,y4,i.userTripService.currentAppStage)),pe(2),Pe("active","false")("routerLink","../trip")("queryParams",Jc(9,y4,i.userTripService.currentAppStage)))},dependencies:[F_,uD,dD,Uz,Zee,b4,w2,S2],styles:[".wrapper-results-content[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:scroll}"]}),n})();const Aie=JSON.parse('{"id":"ojp-service-track-line","type":"line","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"LineString"]],"layout":{"line-join":"round","line-cap":"round"},"paint":{"line-width":4,"line-opacity":1,"line-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"]}}'),Rie=JSON.parse('{"id":"ojp-service-track-stop","type":"circle","source":"[SOURCE_ID]","filter":["all",["==",["geometry-type"],"Point"]],"layout":{},"paint":{"circle-radius":["case",["==",["get","point-size"],"large"],6,4],"circle-color":["case",["==",["get","line-type"],"prev"],"#D3D3D3","#3D69CA"],"circle-stroke-color":"#FFF","circle-stroke-width":["case",["==",["get","point-size"],"large"],3,1]}}');class v4{constructor(t){this.map=t,this.sourceID="stop-event-service-data",this.geojsonFeatures=[],this.addMapLayers(t)}addMapLayers(t){t.addSource(this.sourceID,{type:"geojson",data:{type:"FeatureCollection",features:[]}});const i=Aie;i.source=this.sourceID,t.addLayer(i);const r=Rie;r.source=this.sourceID,t.addLayer(r)}drawStopEvent(t){var e;const i=b=>{const x=[];return b.forEach(A=>{var O;const B=null!==(O=A.location.geoPosition)&&void 0!==O?O:null;B&&x.push(new fv(B.longitude,B.latitude))}),x},r=i(t.prevStopPoints),a=i(t.nextStopPoints),d=i([t.stopPoint]);this.drawStopPositions(r,a,null!==(e=d[0])&&void 0!==e?e:null,[])}drawTripInfoResult(t){const e=(()=>{const r=[];return t.calls.forEach(a=>{a.place&&r.push(a.place.geoPosition)}),r})(),i=0===t.trackSectionsGeoPositions.length?[]:(t.trackSectionsGeoPositions.length>1&&console.error("WARNING - MultLineString not yet implemented, using first"),t.trackSectionsGeoPositions[0]);this.drawStopPositions([],e,null,i)}drawStopPositions(t,e,i,r){this.geojsonFeatures=[];const a=r.length>0,d={prev:[],next:[]},b={prev:[],next:[]};a&&r.forEach(O=>{d.next.push(O.asLngLat())});const x=["prev","next"];if(x.forEach(O=>{const B="prev"===O,X=B?t:e;X.forEach((te,se)=>{const me=te.asLngLat();a||d[O].push(me);const ht={"point-type":O};ht["point-size"]=B?0===se?"large":"normal":se===X.length-1?"large":"normal",b[O].push({type:"Feature",properties:ht,geometry:{type:"Point",coordinates:me}})})}),i){const O=i.asLngLat();a||(d.prev.push(O),d.next.unshift(O)),b.next.push({type:"Feature",properties:{"point-type":"next","point-size":"large"},geometry:{type:"Point",coordinates:O}})}x.forEach(O=>{const B=d[O];B.length<2||(this.geojsonFeatures.push({type:"Feature",properties:{"line-type":O},geometry:{type:"LineString",coordinates:B}}),this.geojsonFeatures=this.geojsonFeatures.concat(b[O]))}),this.udateStopEventSource({type:"FeatureCollection",features:this.geojsonFeatures})}resetStopEventLayers(){this.geojsonFeatures=[],this.udateStopEventSource({type:"FeatureCollection",features:[]})}udateStopEventSource(t){const e=this.map.getSource(this.sourceID);if(null===e)return console.error("ERROR - cant find the source "+this.sourceID),void console.log(this.map.getStyle());e.setData(t)}}let T2=(()=>{class n{constructor(){this.stationBoardDataUpdated=new Cn,this.stationBoardEntrySelected=new Cn,this.stationOnMapClicked=new Cn,this.searchDate=new Date}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Pie=(()=>{class n{constructor(e,i,r,a,d){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.stationBoardService=a,this.languageService=d,this.mapLoadingPromise=null,this.stopEventServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToLocation(r,e)})}),this.stationBoardService.stationBoardEntrySelected.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.updateMapForEntry(e)})})}initMap(){const e=this.mapService.createMap("map_canvas_station_board");this.mapLoadingPromise=new Promise((i,r)=>{e.on("load",a=>{i(e),this.onMapLoad(e)})})}onMapLoad(e){this.mapService.addControls(e,this.debugXmlPopover,this.userTripService,this.languageService),this.addMapListeners(e),this.mapService.addRasterLayers(e),this.stopEventServiceRenderer=new v4(e)}updateMapForEntry(e){var i,r;null===e?null===(i=this.stopEventServiceRenderer)||void 0===i||i.resetStopEventLayers():null===(r=this.stopEventServiceRenderer)||void 0===r||r.drawStopEvent(e)}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(a,d)=>{a?console.error(a):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),e.on("click",i=>{const r=Bh.queryNearbyFeaturesByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);r.length>0&&this.stationBoardService.stationOnMapClicked.emit(r[0].feature)})}}return n.\u0275fac=function(e){return new(e||n)(ue(ia),ue(xf),ue(Cc),ue(T2),ue($u))},n.\u0275cmp=Jt({type:n,selectors:[["station-board-map"]],decls:1,vars:0,consts:[["id","map_canvas_station_board",1,"map_wrapper","h-100"]],template:function(e,i){1&e&&rn(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{border:1px solid #e5e5e5}"]}),n})();const kie=["stationBoardWrapper"];function Lie(n,t){if(1&n&&(ne(0,"div")(1,"div"),Z(2),oe()()),2&n){const e=St(2).$implicit;pe(2),De("Pl. ",e.stopPlatform,"")}}function Oie(n,t){if(1&n&&(ne(0,"div")(1,"div"),Z(2,"Pl. "),ne(3,"del"),Z(4),oe(),Z(5),oe()()),2&n){const e=St(2).$implicit;pe(4),De(" ",e.stopPlatform,""),pe(1),De(" ",e.stopPlatformActual,"")}}function Fie(n,t){if(1&n&&(ne(0,"div",17),yt(1,Lie,3,1,"div",15),yt(2,Oie,6,2,"div",15),oe()),2&n){const e=St().$implicit;pe(1),Pe("ngIf",!e.stopPlatformActual),pe(1),Pe("ngIf",e.stopPlatformActual)}}function Nie(n,t){1&n&&(ne(0,"div")(1,"span",18),Z(2,"Cancelled"),oe()())}function Bie(n,t){1&n&&(ne(0,"div")(1,"span",19),Z(2,"Deviation"),oe()())}function zie(n,t){1&n&&(ne(0,"div")(1,"span",19),Z(2,"Unplanned"),oe()())}function Vie(n,t){if(1&n&&(ne(0,"div")(1,"div",20),Z(2),oe()()),2&n){const e=St().$implicit,i=St();pe(2),de(i.formatStopEventTime(e,"stopTime"))}}function jie(n,t){if(1&n&&(ne(0,"div")(1,"del"),Z(2),oe()()),2&n){const e=St(2).$implicit,i=St();pe(2),de(e.mapStationBoardTime[i.stationBoardType].stopTime)}}function Uie(n,t){if(1&n&&(ne(0,"div"),yt(1,jie,3,1,"div",15),ne(2,"div",20),Z(3),oe(),ne(4,"div",21),Z(5),oe()()),2&n){const e=St().$implicit,i=St();pe(1),Pe("ngIf",i.hasDelayDifferentTime(e)),pe(2),de(i.formatStopEventTime(e,"stopTimeActual")),pe(2),de(i.formatStopEventTime(e,"stopDelayText"))}}function Hie(n,t){if(1&n&&(ji(0),ne(1,"div"),Z(2),oe(),Zi()),2&n){const e=St().$implicit;pe(2),De(" ",e.descriptions[0]," ")}}function qie(n,t){if(1&n&&(ne(0,"li"),Z(1),oe()),2&n){const e=t.$implicit;pe(1),De(" ",e," ")}}function Gie(n,t){if(1&n&&(ji(0),ne(1,"ul",24),yt(2,qie,2,1,"li",22),oe(),ne(3,"h6"),Z(4,"Detail"),oe(),Zi()),2&n){const e=St().$implicit;pe(2),Pe("ngForOf",e.descriptions)}}function $ie(n,t){if(1&n&&(ne(0,"li"),rn(1,"div",25),oe()),2&n){const e=t.$implicit;pe(1),Pe("innerHTML",e,$b)}}function Wie(n,t){if(1&n&&(ne(0,"div")(1,"sbb-tooltip",23)(2,"p")(3,"strong"),Z(4),oe()(),yt(5,Hie,3,1,"ng-container",15),yt(6,Gie,5,1,"ng-container",15),ne(7,"ul",24),yt(8,$ie,2,1,"li",22),oe()()()),2&n){const e=t.$implicit;pe(4),de(e.summary),pe(1),Pe("ngIf",1===e.descriptions.length),pe(1),Pe("ngIf",e.descriptions.length>1),pe(2),Pe("ngForOf",e.safeDetails)}}function Xie(n,t){if(1&n&&(ne(0,"div")(1,"div",14),yt(2,Wie,9,4,"div",22),oe()()),2&n){const e=St().$implicit;pe(2),Pe("ngForOf",e.situations)}}const Zie=function(n){return{"item-selected":n}};function Yie(n,t){if(1&n){const e=or();ne(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),Z(5),oe(),ne(6,"div",7),Z(7),oe()(),ne(8,"div",8)(9,"div",9),Z(10),oe(),ne(11,"div",10)(12,"button",11),Wt("click",function(){const a=Qn(e).$implicit;return ei(St().loadTripInfoResultPopover(a.journeyRef))}),Z(13),oe()(),yt(14,Fie,3,2,"div",12),ne(15,"div",13)(16,"span"),Z(17),oe(),Z(18," - "),ne(19,"span"),Z(20),oe()(),ne(21,"div",14),yt(22,Nie,3,0,"div",15),yt(23,Bie,3,0,"div",15),yt(24,zie,3,0,"div",15),oe()(),ne(25,"div",16),yt(26,Vie,3,1,"div",15),yt(27,Uie,6,3,"div",15),oe(),yt(28,Xie,3,1,"div",15),oe()()()}if(2&n){const e=t.$implicit,i=t.index,r=St();Pe("ngClass",Jc(15,Zie,i===r.selectedIDx)),si("data-index",i),pe(5),de(e.serviceLineNumber),pe(2),de(e.tripNumber),pe(3),de(e.tripHeading),pe(3),de(e.serviceInfo),pe(1),Pe("ngIf",e.stopPlatform),pe(3),De("Operator: ",e.tripOperator,""),pe(3),De("Type: ",e.servicePtMode,""),pe(2),Pe("ngIf",!0===e.isCancelled),pe(1),Pe("ngIf",!0===e.hasDeviation),pe(1),Pe("ngIf",!0===e.isUnplanned),pe(2),Pe("ngIf",!r.hasDelay(e)),pe(1),Pe("ngIf",r.hasDelay(e)),pe(1),Pe("ngIf",r.hasSituations(e))}}let x4=(()=>{class n{constructor(e,i,r){this.stationBoardService=e,this.tripInfoResultPopover=i,this.sanitizer=r,this.stopEventsData=[],this.selectedIDx=null,this.stationBoardType="Departures"}ngOnInit(){this.stationBoardService.stationBoardDataUpdated.subscribe(e=>{this.stationBoardType=e.type;const i=e.items;this.stopEventsData=[],i.forEach(r=>{const a=this.computeStationBoardModel(r);this.stopEventsData.push(a)}),i.length>0?this.selectDataRowAtIndex(0):this.stationBoardService.stationBoardEntrySelected.emit(null)})}ngAfterViewInit(){var e;(null===(e=this.stationBoardWrapperRef)||void 0===e?void 0:e.nativeElement).addEventListener("click",i=>{var r,a;const d=i.target;if(null===d)return;const b=null!==(a=null===(r=d.closest(".card-item"))||void 0===r?void 0:r.getAttribute("data-index"))&&void 0!==a?a:null;if(null===b)return;const x=parseInt(b,10);this.selectedIDx!==x&&this.selectDataRowAtIndex(x)})}selectDataRowAtIndex(e){this.selectedIDx=e,this.stationBoardService.stationBoardEntrySelected.emit(this.stopEventsData[e].stopEvent)}hasDelay(e){const i=e.mapStationBoardTime[this.stationBoardType];return!!i&&i.hasDelay}hasDelayDifferentTime(e){const i=e.mapStationBoardTime[this.stationBoardType];return!!i&&i.hasDelayDifferentTime}formatStopEventTime(e,i){const r=e.mapStationBoardTime[this.stationBoardType];return null===r?null:r[i]}hasSituations(e){return e.situations.length>0}computeServiceLineNumber(e){var i;const r=null!==(i=e.journeyService.ptMode.shortName)&&void 0!==i?i:"N/A";return e.journeyService.serviceLineNumber||r}computeStopTime(e){return null===e?null:bn.DateHelpers.formatTimeHHMM(e)}computeDelayTime(e,i){var r;const d="Arrivals"===i?e.arrivalData:e.departureData,b=null!==(r=null==d?void 0:d.delayMinutes)&&void 0!==r?r:null;if(null===b)return null;if(0===b)return"ON TIME";const x=[];return x.push(" "),x.push(b>0?"+":""),x.push(""+b),x.push("'"),x.join("")}computeStopTimeData(e,i){var r;const d="Arrivals"===i?e.arrivalData:e.departureData;if(null===d)return null;const b=null!==d.delayMinutes,x=bn.DateHelpers.formatTimeHHMM(d.timetableTime),A=d.estimatedTime?bn.DateHelpers.formatTimeHHMM(d.estimatedTime):"n/a",O=!!d.estimatedTime&&x!==A,B=this.computeStopTime(d.timetableTime);return null===B?null:{stopTime:B,stopTimeActual:this.computeStopTime(null!==(r=d.estimatedTime)&&void 0!==r?r:null),stopDelayText:this.computeDelayTime(e,i),hasDelay:b,hasDelayDifferentTime:O}}computeStationBoardModel(e){var i,r,a;const d=this.computeServiceLineNumber(e),b=null!==(i=e.journeyService.ptMode.shortName)&&void 0!==i?i:"N/A",x=this.computeStopTimeData(e.stopPoint,"Arrivals"),A=this.computeStopTimeData(e.stopPoint,"Departures"),O=e.stopPoint.plannedPlatform===e.stopPoint.actualPlatform?null:e.stopPoint.actualPlatform,B=!0===e.journeyService.hasCancellation,X=!0===e.journeyService.hasDeviation,te=!0===e.journeyService.isUnplanned;return{stopEvent:e,serviceLineNumber:d,servicePtMode:b,serviceInfo:Yl.initWithOJP_LegacyJourneyService(e.journeyService).formatServiceName(),journeyRef:e.journeyService.journeyRef,tripNumber:e.journeyService.journeyNumber,tripHeading:null!==(a=null===(r=e.journeyService.destinationStopPlace)||void 0===r?void 0:r.stopPlaceName)&&void 0!==a?a:"N/A",tripOperator:e.journeyService.operatorRef,mapStationBoardTime:{Arrivals:x,Departures:A},stopPlatform:e.stopPoint.plannedPlatform,stopPlatformActual:O,situations:no.computeSituationsData(this.sanitizer,e.stopPoint.siriSituations),isCancelled:B,hasDeviation:X,isUnplanned:te}}loadTripInfoResultPopover(e){const i=this.tripInfoResultPopover.open(jz,{position:{top:"20px"}});i.afterOpened().subscribe(()=>{i.componentInstance.fetchJourneyRef(e,this.stationBoardService.searchDate)})}}return n.\u0275fac=function(e){return new(e||n)(ue(T2),ue(Cc),ue(mT))},n.\u0275cmp=Jt({type:n,selectors:[["station-board-result"]],viewQuery:function(e,i){if(1&e&&mo(kie,5),2&e){let r;xi(r=wi())&&(i.stationBoardWrapperRef=r.first)}},decls:3,vars:1,consts:[["stationBoardWrapper",""],["class","card card card-item mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"card","card","card-item","mb-2",3,"ngClass"],[1,"card-body"],[1,"d-flex","dep-content","align-items-center"],[1,"service-line-number-wrapper"],[1,"service-line-number","text-center"],[1,"trip-info","text-center"],[1,"flex-fill","dep-center"],[1,"trip-heading"],[1,"d-flex"],[1,"btn","btn-primary","btn-sm",3,"click"],["class","stop-platform-text",4,"ngIf"],[1,"trip-debug"],[1,"d-flex","gap-2"],[4,"ngIf"],[1,"text-center"],[1,"stop-platform-text"],[1,"badge","rounded-pill","bg-danger","fw-bolder"],[1,"badge","rounded-pill","bg-warning","fw-bolder","text-dark"],[1,"departure-time"],[1,"departure-delay"],[4,"ngFor","ngForOf"],["trigger","hover","svgIcon","fpl:info"],[1,"tooltip-list"],[3,"innerHTML"]],template:function(e,i){1&e&&(ne(0,"div",null,0),yt(2,Yie,29,17,"div",1),oe()),2&e&&(pe(2),Pe("ngForOf",i.stopEventsData))},dependencies:[rf,Sl,Zo,Bz],styles:[".service-line-number-wrapper[_ngcontent-%COMP%]{padding:0 16px 0 4px}.service-line-number[_ngcontent-%COMP%]{font-size:24px}.service-pt-mode[_ngcontent-%COMP%]{font-size:12px}.trip-heading[_ngcontent-%COMP%]{margin-top:2px;font-size:20px}.trip-info[_ngcontent-%COMP%]{font-size:12px}.stop-platform-wrapper[_ngcontent-%COMP%]{margin-right:4px}.stop-platform-text[_ngcontent-%COMP%]{font-size:14px}.stop-platform[_ngcontent-%COMP%]{font-size:18px}.departure-time[_ngcontent-%COMP%]{width:80px;font-size:20px}.departure-delay[_ngcontent-%COMP%]{color:#c45f00}.trip-debug[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-size:12px}.card-item[_ngcontent-%COMP%]{cursor:pointer}.item-selected[_ngcontent-%COMP%]{background-color:#f5f5f5}.tooltip-list[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px}"]}),n})();function Jie(n,t){if(1&n&&(ne(0,"sbb-option",5),Z(1),oe()),2&n){const e=t.$implicit,i=St();Pe("value",e.stopPlaceRef),pe(1),De(" ",i.renderLookupName(e)," ")}}let w4=(()=>{class n{constructor(e,i){this.userTripService=e,this.languageService=i,this.locationSelected=new Cn,this.searchInputControl=new Hu(""),this.stopLookups=[n.AroundMeStopLookup],this.currentStopLookup=null,this.isBusySearching=!1,this.hackIgnoreInputChangesFlag=!1}static get AroundMeStopLookup(){return{stopPlaceRef:"AROUND_ME",stopName:"Current Location",special_type:"around_me",location:null}}ngOnInit(){this.searchInputControl.valueChanges.pipe(zh(500),Wm()).subscribe(e=>{this.onInputChangeAfterIdle()})}renderLookupName(e){let i=e.stopName;return e.distance&&(i+=" ("+e.distance+" m)"),i}onInputChangeAfterIdle(){const e=this.searchInputControl.value.trim();this.hackIgnoreInputChangesFlag?this.hackIgnoreInputChangesFlag=!1:0!==e.length?e.length<3||this.fetchLookupLocations(e):this.stopLookups=[n.AroundMeStopLookup]}fetchLookupLocations(e){var i=this;return mr(function*(){i.isBusySearching=!0;const a="2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,b=i.userTripService.getStageConfig(),x=bn.LocationInformationRequest.initWithLocationName(b,i.languageService.language,a,Ps,e,["stop"]);x.enableExtensions="OJP-SI"!==i.userTripService.currentAppStage;const A=yield x.fetchResponse();i.parseLocations(A.locations),i.isBusySearching=!1})()}parseLocations(e,i=null){this.stopLookups=[],e.forEach(r=>{var a;const d=null===(a=r.stopPlace)||void 0===a?void 0:a.stopPlaceRef;if(null===d)return;const x={stopPlaceRef:d,stopName:null!==r.locationName?r.locationName:r.computeLocationName(),location:r};r.geoPosition&&i&&(x.distance=r.geoPosition.distanceFrom(i)),this.stopLookups.push(x)}),i&&this.stopLookups.sort((r,a)=>null==r.distance||null==a.distance?0:r.distance-a.distance),this.stopLookups=this.stopLookups.slice(0,10)}onStopLookupSelected(e){var i;const r=e.option.value;let a=null!==(i=this.stopLookups.find(b=>b.stopPlaceRef===r))&&void 0!==i?i:null;if(null===a)return void console.log("WHOOPS - cant find the stop for: "+r);if("around_me"===a.special_type)return void this.handleGeolocationLookup();this.currentStopLookup=a,this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(a.stopName);const d=a.location;d&&this.locationSelected.emit(d)}handleGeolocationLookup(){navigator.geolocation?(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue("... looking up location"),navigator.geolocation.getCurrentPosition(e=>{this.handleNewGeoPosition(e,i=>{var r;const a=new bn.GeoPosition(e.coords.longitude,e.coords.latitude);this.parseLocations(i,a),null===(r=this.autocompleteInputTrigger)||void 0===r||r.openPanel()})})):console.log("no navigator.geolocation enabled")}handleNewGeoPosition(e,i){var r=this;return mr(function*(){const b=e.coords.longitude-.025,x=e.coords.longitude+.025,A=e.coords.latitude+.025,O=e.coords.latitude-.025,X="2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,te=r.userTripService.getStageConfig(),se=bn.LocationInformationRequest.initWithBBOXAndType(te,r.languageService.language,X,Ps,b,A,x,O,["stop"],300);se.enableExtensions="OJP-SI"!==r.userTripService.currentAppStage;const me=yield se.fetchResponse();i(me.locations)})()}updateLocationText(e){var i,r;const a=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceName)&&void 0!==r?r:null;null!==a&&(this.hackIgnoreInputChangesFlag=!0,this.searchInputControl.setValue(a))}}return n.\u0275fac=function(e){return new(e||n)(ue(ia),ue($u))},n.\u0275cmp=Jt({type:n,selectors:[["station-board-input"]],viewQuery:function(e,i){if(1&e&&mo(wD,7),2&e){let r;xi(r=wi())&&(i.autocompleteInputTrigger=r.first)}},outputs:{locationSelected:"locationSelected"},decls:6,vars:4,consts:[["label","Station",1,"w-100"],["sbbInput","","type","text",3,"placeholder","formControl","sbbAutocomplete"],[3,"optionSelected"],["autocompleteTemplate","sbbAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,i){if(1&e&&(ne(0,"div")(1,"sbb-form-field",0),rn(2,"input",1),oe(),ne(3,"sbb-autocomplete",2,3),Wt("optionSelected",function(a){return i.onStopLookupSelected(a)}),yt(5,Jie,2,2,"sbb-option",4),oe()()),2&e){const r=el(4);pe(2),Pe("placeholder","Type to search for stations")("formControl",i.searchInputControl)("sbbAutocomplete",r),pe(3),Pe("ngForOf",i.stopLookups)}},dependencies:[Sl,tu,Uu,Qy,L1,d4,wD,Dv,J_],encapsulation:2}),n})();function Kie(n,t){1&n&&rn(0,"span",12)}let Qie=(()=>{class n{constructor(e){this.userTripService=e,this.customRequestSaved=new Cn,this.customResponseSaved=new Cn,this.customRequestXMLs="... wait",this.customResponseXMLs="Paste custom OJP StopEventRequest Response XML here...",this.isRunningRequest=!1}parseCustomRequestXML(){this.isRunningRequest=!0;const i="2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,r=this.userTripService.getStageConfig(),a=bn.StopEventRequest.initWithRequestMock(this.customRequestXMLs,r,i,Ps);a.fetchResponse().then(d=>{this.isRunningRequest=!1;const b=a.requestInfo.responseXML;null!==b?this.customRequestSaved.emit(b):console.log("ERROR - no response from StopEventRequest")})}parseCustomResponseXML(){this.customResponseSaved.emit(this.customResponseXMLs)}}return n.\u0275fac=function(e){return new(e||n)(ue(ia))},n.\u0275cmp=Jt({type:n,selectors:[["custom-stop-event-popover"]],outputs:{customRequestSaved:"customRequestSaved",customResponseSaved:"customResponseSaved"},decls:26,vars:4,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojp-stopeventservice/"],["rows","10",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(ne(0,"div",0),Z(1,"Custom StopEvent Request / Response XML"),oe(),ne(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),Z(6,"StopEvent Request XML"),oe(),ne(7,"div")(8,"a",4),Z(9,"Cookbook opentransportdata.swiss"),oe()()(),ne(10,"textarea",5),Wt("ngModelChange",function(a){return i.customRequestXMLs=a}),oe(),ne(11,"div",6)(12,"button",7),Wt("click",function(){return i.parseCustomRequestXML()}),yt(13,Kie,1,0,"span",8),Z(14," Execute OJP StopEvent Request "),oe()(),rn(15,"hr"),ne(16,"div",3)(17,"div"),Z(18,"StopEvent Request Response XML"),oe()(),ne(19,"textarea",5),Wt("ngModelChange",function(a){return i.customResponseXMLs=a}),oe(),ne(20,"div",6)(21,"button",9),Wt("click",function(){return i.parseCustomResponseXML()}),Z(22," Display StopEvents "),oe()()()(),ne(23,"div",10)(24,"button",11),Z(25," Close "),oe()()),2&e&&(pe(10),Pe("ngModel",i.customRequestXMLs),pe(2),Pe("disabled",i.isRunningRequest),pe(1),Pe("ngIf",i.isRunningRequest),pe(6),Pe("ngModel",i.customResponseXMLs))},dependencies:[Zo,tu,Uu,Oh,vf,Km,Qm,eg],encapsulation:2}),n})(),ere=(()=>{class n{constructor(){this.embedHTMLs="n/a"}updateEmbedHTML(e){var i,r;const a=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:"n/a",d=document.location.pathname.replace("/board","/embed/board")+"?stop_id="+a,b=document.location.protocol+"//"+document.location.host+d;this.embedHTMLs='<iframe src="'+b+'" width="100%" height="100%" frameBorder="0"></iframe>'}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Jt({type:n,selectors:[["embed-station-board-popover"]],decls:11,vars:1,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],["rows","7",1,"w-100"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"]],template:function(e,i){1&e&&(ne(0,"div",0),Z(1,"Embed journey in another website"),oe(),ne(2,"div",1)(3,"div",2)(4,"p"),Z(5,"Copy the following code in the target webpage"),oe(),ne(6,"textarea",3),Z(7),oe()()(),ne(8,"div",4)(9,"button",5),Z(10," Close "),oe()()),2&e&&(pe(7),de(i.embedHTMLs))},dependencies:[vf,Km,Qm,eg],encapsulation:2}),n})();function tre(n,t){if(1&n&&(ne(0,"sbb-radio-button",26),Z(1),oe()),2&n){const e=t.$implicit;Pe("value",e),pe(1),De(" ",e," ")}}function nre(n,t){if(1&n){const e=or();ne(0,"div",23)(1,"div")(2,"sbb-radio-group",24),Wt("ngModelChange",function(r){return Qn(e),ei(St().stationBoardType=r)})("change",function(){return Qn(e),ei(St().onTypeChanged())}),yt(3,tre,2,2,"sbb-radio-button",25),oe()()()}if(2&n){const e=St();pe(2),Pe("ngModel",e.stationBoardType),pe(1),Pe("ngForOf",e.stationBoardTypes)}}function ire(n,t){if(1&n&&(ne(0,"sbb-radio-button",26),Z(1),oe()),2&n){const e=t.$implicit;Pe("value",e),pe(1),De(" ",e," ")}}function rre(n,t){if(1&n){const e=or();ji(0),ne(1,"div",27)(2,"div"),Z(3,"UseRealTimeData"),oe(),ne(4,"div")(5,"sbb-radio-group",28),Wt("ngModelChange",function(r){return Qn(e),ei(St().userTripService.useRealTimeDataType=r)}),yt(6,ire,2,2,"sbb-radio-button",25),oe()()(),Zi()}if(2&n){const e=St();pe(5),Pe("ngModel",e.userTripService.useRealTimeDataType),pe(1),Pe("ngForOf",e.useRealTimeDataTypes)}}function ore(n,t){if(1&n){const e=or();ne(0,"sbb-radio-button",30),Wt("change",function(r){return Qn(e),ei(St(2).onChangeStageAPI(r))}),Z(1),oe()}if(2&n){const e=t.$implicit;Pe("value",e),pe(1),De(" ",e," ")}}function sre(n,t){if(1&n){const e=or();ne(0,"div",23)(1,"div")(2,"sbb-radio-group",28),Wt("ngModelChange",function(r){return Qn(e),ei(St().userTripService.currentAppStage=r)}),yt(3,ore,2,2,"sbb-radio-button",29),oe()()()}if(2&n){const e=St();pe(2),Pe("ngModel",e.userTripService.currentAppStage),pe(1),Pe("ngForOf",e.appStageOptions)}}function are(n,t){1&n&&rn(0,"span",31)}function lre(n,t){if(1&n){const e=or();ne(0,"div",32)(1,"button",33),Wt("click",function(){return Qn(e),ei(St().loadCustomXMLPopover())}),Z(2," Custom XML "),oe()()}}function cre(n,t){if(1&n&&(ne(0,"div",0)(1,"div",1)(2,"div",34)(3,"div")(4,"a",35),Z(5,"Open in OJP Demo App"),oe()()()()()),2&n){const e=St();pe(4),Ir("href",e.permalinkRelativeURL,zo)}}function ure(n,t){if(1&n){const e=or();ji(0),ne(1,"div",37),Wt("click",function(){return Qn(e),ei(St(2).showRequestXmlPopover())}),ne(2,"span",38),Z(3,"XML"),oe()(),ne(4,"div"),Z(5,"|"),oe(),Zi()}}function dre(n,t){if(1&n&&(ji(0),ne(1,"div")(2,"a",35),Z(3),oe()(),ne(4,"div"),Z(5,"|"),oe(),ne(6,"div")(7,"a",35),Z(8,"PROD"),oe()(),ne(9,"div"),Z(10,"|"),oe(),Zi()),2&n){const e=St(2);pe(2),Ir("href",e.mapURLs.beta,zo),pe(1),de(e.userTripService.betaURLText),pe(4),Ir("href",e.mapURLs.prodv1,zo)}}function hre(n,t){if(1&n){const e=or();ji(0),ne(1,"div"),Z(2,"|"),oe(),ne(3,"div")(4,"a",39),Wt("click",function(){return Qn(e),ei(St(2).loadEmbedHTMLPopover())}),Z(5,"Embed"),oe()(),Zi()}}function pre(n,t){if(1&n&&(ne(0,"div",0)(1,"div",1)(2,"div",36),yt(3,ure,6,0,"ng-container",16),yt(4,dre,11,3,"ng-container",16),ne(5,"div")(6,"a",35),Z(7,"Permalink"),oe()(),yt(8,hre,6,0,"ng-container",16),oe()()()),2&n){const e=St();pe(3),Pe("ngIf",(null==e.currentRequestInfo?null:e.currentRequestInfo.requestXML)&&!e.isEmbed),pe(1),Pe("ngIf",null!==e.searchLocation),pe(2),Ir("href",e.permalinkRelativeURL,zo),pe(2),Pe("ngIf",null!==e.searchLocation)}}let S4=(()=>{class n{constructor(e,i,r,a,d,b,x,A,O){this.notificationToast=e,this.debugXmlPopover=i,this.customXmlPopover=r,this.mapService=a,this.stationBoardService=d,this.languageService=b,this.userTripService=x,this.embedHTMLPopover=A,this.router=O,this.headerText="Search",this.useMocks=!1,this.queryParams=new URLSearchParams(document.location.search),this.appStageOptions=WA,this.stationBoardTypes=["Departures","Arrivals"],this.stationBoardType=this.computeStationBoardType(),this.searchLocation=null,this.stationBoardService.searchDate=this.computeSearchDateTime(),this.searchTime=bn.DateHelpers.formatTimeHHMM(this.stationBoardService.searchDate),this.isSearching=!1,this.permalinkRelativeURL="",this.mapURLs={},this.updateURLs(),this.currentRequestInfo=null;const B=new URLSearchParams(document.location.search);this.useMocks="yes"===B.get("use_mocks"),this.isEmbed=-1!==this.router.url.indexOf("/embed/"),this.headerText=this.stationBoardType,this.isV1="1.0"===Mo,this.useRealTimeDataTypes=["full","explanatory","none"]}get searchDate(){return this.stationBoardService.searchDate}set searchDate(e){this.stationBoardService.searchDate=e}ngOnInit(){const e=this.queryParams.get("stage");if(e){const r=this.computeAppStageFromString(e);r&&setTimeout(()=>{this.userTripService.updateAppStage(r)})}const i=this.queryParams.get("stop_id");i&&(this.updateCurrentRequestData(i),this.fetchStopEventsForStopRef(i),this.lookupStopPlaceRef(i)),this.stationBoardService.stationOnMapClicked.subscribe(r=>{this.handleMapClick(r)}),this.customInitFromParams()}customInitFromParams(){if(this.useMocks&&this.useMocks&&"localhost"===document.location.hostname)return void this.fetchStopEventFromMocks();const e=this.queryParams.get("gist");e&&this.initFromGistRef(e)}initFromGistRef(e){var i=this;return mr(function*(){const r=yield no.fetchGist(e);null!==r?i.initFromMockXML(r):console.error("initFromGistRef: cant fetch gist XML")})()}computeAppStageFromString(e){const i=this.appStageOptions.map(d=>d.toLowerCase()),r=e.trim(),a=i.indexOf(r.toLowerCase());return-1!==a?this.appStageOptions[a]:null}onLocationSelected(e){var i,r;const a=null!==(r=null===(i=e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;a&&this.updateCurrentRequestData(a),this.searchLocation=e,this.mapService.tryToCenterAndZoomToLocation(e),this.updateURLs(),this.updateHeaderText(),this.resetResultList()}onDateTimeChanged(){const e=this.searchTime.split(":");if(2===e.length){const i=parseInt(e[0],10),r=parseInt(e[1],10);this.stationBoardService.searchDate.setHours(i),this.stationBoardService.searchDate.setMinutes(r)}this.updateURLs()}onTypeChanged(){this.updateURLs(),this.updateHeaderText()}isSearchButtonDisabled(){return!(!this.isSearching&&null!==this.searchLocation)}searchButtonClicked(){var e,i,r;this.notificationToast.dismiss();const a=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;null!==a?this.fetchStopEventsForStopRef(a):console.error("ERROR - no stopPlaceRef available")}computeSearchDateTime(){let e=new Date;const i=this.queryParams.get("day");i&&(e=new Date(Date.parse(i)));const r=this.queryParams.get("time"),a=new Date;let d=a.getHours(),b=a.getMinutes();if(r){const x=r.split(":");2===x.length&&(d=parseInt(x[0],10),b=parseInt(x[1],10))}return e.setHours(d),e.setMinutes(b),e}computeStationBoardType(){return"arr"===this.queryParams.get("type")?"Arrivals":"Departures"}updateURLs(){var e,i,r;const a=new URLSearchParams;"Arrivals"===this.stationBoardType&&a.set("type","arr");const d=null!==(r=null===(i=null===(e=this.searchLocation)||void 0===e?void 0:e.stopPlace)||void 0===i?void 0:i.stopPlaceRef)&&void 0!==r?r:null;d&&a.set("stop_id",d);const b=this.stationBoardService.searchDate,x=new Date;if(Math.abs((x.getTime()-b.getTime())/1e3/60)>5){const O=bn.DateHelpers.formatDate(new Date),B=bn.DateHelpers.formatDate(b),X=O.substring(0,10),te=B.substring(0,10);te!==X&&a.set("day",te);const se=O.substring(11,16),me=B.substring(11,16);se!==me&&a.set("time",me)}if(this.userTripService.currentAppStage!==fC){const O=this.userTripService.currentAppStage.toLowerCase();a.append("stage",O)}this.permalinkRelativeURL=document.location.pathname.replace("/embed","")+"?"+a.toString(),this.updateLinkedURLs(a)}updateLinkedURLs(e){const i="2.0"===Mo,r=new URLSearchParams(e);i&&this.userTripService.updateStageLinkedURL(r,i),this.mapURLs.prodv1="https://opentdatach.github.io/ojp-demo-app/board?"+r.toString();const a=new URLSearchParams(e);i&&this.userTripService.updateStageLinkedURL(a,i),this.mapURLs.betav1="https://tools.odpch.ch/beta-ojp-demo/board?"+a.toString();const d=new URLSearchParams(e);i||this.userTripService.updateStageLinkedURL(d,i),this.mapURLs.betav2="https://tools.odpch.ch/ojp-demo-v2/board?"+d.toString(),this.mapURLs.beta=i?this.mapURLs.betav1:this.mapURLs.betav2,this.userTripService.betaURLText=i?"BETA-v1":"BETA-v2"}fetchStopEventsForStopRef(e){const i=this.computeStopEventRequest(e);i.enableExtensions="OJP-SI"!==this.userTripService.currentAppStage,i.fetchResponse().then(r=>{this.currentRequestInfo=i.requestInfo,this.parseStopEvents(r.stopEvents)})}fetchStopEventFromMocks(){var e=this;return mr(function*(){const r=yield(yield fetch("/path/to/mock.xml")).text();e.initFromMockXML(r)})()}initFromMockXML(e){bn.StopEventRequest.initWithMock(e,"2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,Ps).fetchResponse().then(d=>{if(d.stopEvents.length>0){const x=d.stopEvents[0].stopPoint.location;x&&this.onLocationSelected(x)}this.parseStopEvents(d.stopEvents)})}computeStopEventRequest(e){const r="2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,a="Arrivals"===this.stationBoardType?"arrival":"departure",d=this.computeStopBoardDate(),b=this.userTripService.getStageConfig(),x=bn.StopEventRequest.initWithStopPlaceRef(b,this.languageService.language,r,Ps,e,a,d);return x.useRealTimeDataType=this.userTripService.useRealTimeDataType,x.updateRequestXML(),x}parseStopEvents(e){var i;e.length>0&&(null===(i=this.searchPanel)||void 0===i||i.close(),this.updateHeaderText()),this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:e})}lookupStopPlaceRef(e){var i=this;return mr(function*(){const a="2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,d=i.userTripService.getStageConfig(),b=bn.LocationInformationRequest.initWithStopPlaceRef(d,i.languageService.language,a,Ps,e);b.enableExtensions="OJP-SI"!==i.userTripService.currentAppStage;const x=yield b.fetchResponse();if(0===x.locations.length)return void console.error("ERROR - cant find stopPlaceRef with ID: "+e);const A=x.locations[0];i.searchLocation=A,i.mapService.tryToCenterAndZoomToLocation(A),i.updateURLs(),i.updateHeaderText(),i.autocompleteInputComponent&&i.autocompleteInputComponent.updateLocationText(A)})()}updateHeaderText(){if(null===this.searchLocation)return;const e=this.searchLocation.computeLocationName();null!==e&&(this.headerText=this.stationBoardType+" "+e)}handleMapClick(e){var i;const r=bn.Location.initWithFeature(e);null!==r&&(this.searchLocation=r,this.autocompleteInputComponent&&this.autocompleteInputComponent.updateLocationText(r),this.resetResultList(),this.updateURLs(),null===(i=this.searchPanel)||void 0===i||i.open())}resetResultList(){this.stationBoardService.stationBoardDataUpdated.emit({type:this.stationBoardType,items:[]})}computeStopBoardDate(){const e=this.stationBoardService.searchDate,i=this.searchTime.split(":");if(2===i.length){const r=parseInt(i[0]),a=parseInt(i[1]);e.setHours(r),e.setMinutes(a)}return e}showRequestXmlPopover(){const e=this.debugXmlPopover.open(N1,{position:{top:"20px"},width:"50vw",height:"90vh"});e.afterOpened().subscribe(()=>{this.currentRequestInfo&&e.componentInstance.updateRequestData(this.currentRequestInfo)})}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value),this.updateURLs()}loadCustomXMLPopover(){const e=this.customXmlPopover.open(Qie,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{var i,r;this.notificationToast.dismiss();const a=e.componentInstance;if(null===this.currentRequestInfo){const b=this.computeStopEventRequest("8503000");this.currentRequestInfo=b.requestInfo}a.customRequestXMLs=null!==(r=null===(i=this.currentRequestInfo)||void 0===i?void 0:i.requestXML)&&void 0!==r?r:"n/a",a.customRequestSaved.subscribe(d=>{e.close(),this.handleCustomResponse(d)}),a.customResponseSaved.subscribe(d=>{e.close(),this.handleCustomResponse(d)})})}handleCustomResponse(e){null!==this.currentRequestInfo&&(this.currentRequestInfo.responseDateTime=new Date,this.currentRequestInfo.responseXML=e,bn.StopEventRequest.initWithMock(e,"2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,Ps).fetchResponse().then(d=>{const b=d.stopEvents;b.length>0?(this.mapService.tryToCenterAndZoomToLocation(b[0].stopPoint.location),this.parseStopEvents(d.stopEvents)):this.notificationToast.open("No StopEvents found",{type:"error",verticalPosition:"top"})}))}updateCurrentRequestData(e){const i=this.computeStopEventRequest(e);this.currentRequestInfo=i.requestInfo}loadEmbedHTMLPopover(){const e=this.embedHTMLPopover.open(ere,{position:{top:"20px"}});e.afterOpened().subscribe(()=>{this.searchLocation&&e.componentInstance.updateEmbedHTML(this.searchLocation)})}resetDateTime(){const e=new Date;this.searchDate=e,this.searchTime=bn.DateHelpers.formatTimeHHMM(e),this.stationBoardService.searchDate=e}}return n.\u0275fac=function(e){return new(e||n)(ue(p2),ue(Cc),ue(Cc),ue(xf),ue(T2),ue($u),ue(ia),ue(Cc),ue(pa))},n.\u0275cmp=Jt({type:n,selectors:[["station-board-search"]],viewQuery:function(e,i){if(1&e&&(mo(wf,7),mo(w4,5)),2&e){let r;xi(r=wi())&&(i.searchPanel=r.first),xi(r=wi())&&(i.autocompleteInputComponent=r.first)}},decls:31,vars:12,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],[3,"locationSelected"],["class","mb-3 d-flex",4,"ngIf"],[1,"d-flex","align-items-center","gap-2"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[2,"width","70px"],["label","Time"],["sbbInput","","sbbTimeInput","",3,"ngModel","ngModelChange","change"],["sbb-secondary-button","","aria-expanded","false",3,"click"],["svgIcon","kom:arrow-circle-reset-small"],[4,"ngIf"],[1,"d-flex"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["class","ms-auto",4,"ngIf"],["class","row mb-2",4,"ngIf"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"d-flex","gap-2","align-items-center","mb-3"],[1,"sbb-radio-group-horizontal",3,"ngModel","ngModelChange"],[3,"value","change",4,"ngFor","ngForOf"],[3,"value","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"d-flex","flex-row-reverse"],["target","_blank",3,"href"],[1,"d-flex","flex-row-reverse","gap-2"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],["target","_blank","role","button",1,"text-decoration-underline",3,"click"]],template:function(e,i){1&e&&(ne(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Z(5),oe(),ne(6,"div",3)(7,"div",4)(8,"station-board-input",5),Wt("locationSelected",function(a){return i.onLocationSelected(a)}),oe()()(),yt(9,nre,4,2,"div",6),ne(10,"div",7)(11,"div")(12,"sbb-form-field",8)(13,"sbb-datepicker",9)(14,"input",10),Wt("ngModelChange",function(a){return i.searchDate=a})("dateChange",function(){return i.onDateTimeChanged()}),oe()()()(),ne(15,"div",11)(16,"sbb-form-field",12)(17,"input",13),Wt("ngModelChange",function(a){return i.searchTime=a})("change",function(){return i.onDateTimeChanged()}),oe()()(),ne(18,"div")(19,"button",14),Wt("click",function(){return i.resetDateTime()}),rn(20,"sbb-icon",15),oe()()(),yt(21,rre,7,2,"ng-container",16),yt(22,sre,4,2,"div",6),ne(23,"div",17)(24,"div",18)(25,"button",19),Wt("click",function(){return i.searchButtonClicked()}),yt(26,are,1,0,"span",20),Z(27," Search "),oe()(),yt(28,lre,3,0,"div",21),oe()()()()(),yt(29,cre,6,1,"div",22),yt(30,pre,9,4,"div",22)),2&e&&(pe(3),Pe("expanded",!0),pe(2),de(i.headerText),pe(4),Pe("ngIf",!i.isEmbed),pe(5),Pe("ngModel",i.searchDate),pe(3),Pe("ngModel",i.searchTime),pe(4),Pe("ngIf",!i.isV1),pe(1),Pe("ngIf",!i.isEmbed),pe(3),Pe("disabled",i.isSearchButtonDisabled()),pe(1),Pe("ngIf",i.isSearching),pe(2),Pe("ngIf",!i.isEmbed),pe(1),Pe("ngIf",i.isEmbed),pe(1),Pe("ngIf",!i.isEmbed))},dependencies:[Sl,Zo,tu,Uu,Oh,hD,wf,V1,f2,yD,q1,Dv,cl,J_,xD,G1,a4,w4],styles:[".xml-info[_ngcontent-%COMP%]{cursor:pointer}"]}),n})();const T4=function(n){return{stage:n}};let fre=(()=>{class n{constructor(e,i){this.appService=e,this.userTripService=i}ngOnInit(){this.appService.setTitle("StopEventRequest")}}return n.\u0275fac=function(e){return new(e||n)(ue(p1),ue(ia))},n.\u0275cmp=Jt({type:n,selectors:[["station-board"]],decls:19,vars:11,consts:[[1,"d-flex","flex-column","vh-100","overflow-hidden"],[1,"ms-2"],["sbb-tab-nav-bar",""],["sbb-tab-link","",3,"active","routerLink","queryParams"],["sbb-tab-link","",3,"active"],[1,"flex-grow-1","d-flex","flex-column","overflow-hidden","p-3"],[1,"d-flex","gap-2","flex-grow-1","overflow-hidden"],[1,"d-flex","flex-column","overflow-x-hidden","overflow-y-auto",2,"width","600px"],[1,"flex-shrink-0"],[1,"flex-grow-1","overflow-x-hidden","overflow-y-scroll"],[1,"flex-grow-1","h-100"]],template:function(e,i){1&e&&(ne(0,"div",0),rn(1,"web-header",1),ne(2,"nav",2)(3,"a",3),Z(4,"Journey Search"),oe(),ne(5,"a",4),Z(6,"Station Board"),oe(),ne(7,"a",3),Z(8,"Trip Info"),oe()(),ne(9,"div",5)(10,"div",6)(11,"div",7)(12,"div",8),rn(13,"station-board-search"),oe(),ne(14,"div",9),rn(15,"station-board-result"),oe()(),ne(16,"div",10),rn(17,"station-board-map"),oe()()(),rn(18,"web-footer",1),oe()),2&e&&(pe(3),Pe("active","false")("routerLink","../search")("queryParams",Jc(7,T4,i.userTripService.currentAppStage)),pe(2),Pe("active","true"),pe(2),Pe("active","false")("routerLink","../trip")("queryParams",Jc(9,T4,i.userTripService.currentAppStage)))},dependencies:[F_,uD,dD,Pie,x4,S4,w2,S2],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})(),mre=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Jt({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(ne(0,"div",0)(1,"div",1)(2,"div",2),rn(3,"app-search-form")(4,"journey-results"),oe()()())},dependencies:[Uz,b4],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})(),gre=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Jt({type:n,selectors:[["embed-search"]],decls:5,vars:0,consts:[[1,"container"],[1,"row","app-root"],[1,"col"]],template:function(e,i){1&e&&(ne(0,"div",0)(1,"div",1)(2,"div",2),rn(3,"station-board-search")(4,"station-board-result"),oe()()())},dependencies:[x4,S4],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;padding:8px}"]}),n})(),_re=(()=>{class n{constructor(e,i,r,a,d){this.userTripService=e,this.mapService=i,this.debugXmlPopover=r,this.tripInfoService=a,this.languageService=d,this.mapLoadingPromise=null,this.journeyServiceRenderer=null}ngOnInit(){this.initMap(),this.mapService.newMapCenterAndZoomRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToLocation(r,e)})}),this.tripInfoService.tripInfoResultUpdated.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{var a,d;null===e?null===(a=this.journeyServiceRenderer)||void 0===a||a.resetStopEventLayers():(null===(d=this.journeyServiceRenderer)||void 0===d||d.drawTripInfoResult(e),this.zoomToJourneyService())})}),this.mapService.newMapBoundsRequested.subscribe(e=>{var i;null===(i=this.mapLoadingPromise)||void 0===i||i.then(r=>{this.mapService.zoomToBounds(r,e)})}),this.tripInfoService.locationSelected.subscribe(e=>{var i,r;const a=null!==(i=e.geoPosition)&&void 0!==i?i:null;null!==a&&(null===(r=this.mapLoadingPromise)||void 0===r||r.then(d=>{this.mapService.zoomToLocation(d,{lnglat:a.asLngLat(),zoom:16})}))})}initMap(){const e=this.mapService.createMap("map_canvas_trip_info");this.mapLoadingPromise=new Promise((i,r)=>{e.on("load",a=>{i(e),this.onMapLoad(e)})})}zoomToJourneyService(){var e,i;const r=null!==(i=null===(e=this.journeyServiceRenderer)||void 0===e?void 0:e.geojsonFeatures)&&void 0!==i?i:[];if(r.length<2)return;const a=bn.GeoPositionBBOX.initFromGeoJSONFeatures(r);if(!a.isValid())return console.error("Invalid BBOX for features"),void console.log(r);const b={bounds:new(sl().LngLatBounds)(a.asFeatureBBOX())};this.mapService.newMapBoundsRequested.emit(b)}onMapLoad(e){this.mapService.addControls(e,this.debugXmlPopover,this.userTripService,this.languageService),this.addMapListeners(e),this.mapService.addRasterLayers(e),this.journeyServiceRenderer=new v4(e)}addMapListeners(e){e.on("styleimagemissing",i=>{e.loadImage("./assets/map-style-icons/"+i.id+".png",(a,d)=>{a?console.error(a):!e.hasImage(i.id)&&d&&e.addImage(i.id,d)})}),e.on("click",i=>{const r=Bh.queryNearbyFeaturesByLayerIDs(e,i.lngLat,["stops-circle","stops-label"]);r.length>0&&console.log(r[0])})}}return n.\u0275fac=function(e){return new(e||n)(ue(ia),ue(xf),ue(Cc),ue(pD),ue($u))},n.\u0275cmp=Jt({type:n,selectors:[["trip-info-map"]],decls:1,vars:0,consts:[["id","map_canvas_trip_info",1,"map_wrapper","h-100"]],template:function(e,i){1&e&&rn(0,"div",0)},styles:[".map_wrapper[_ngcontent-%COMP%]{border:1px solid #e5e5e5}"]}),n})();function bre(n,t){1&n&&rn(0,"span",12)}let yre=(()=>{class n{constructor(e,i){this.userTripService=e,this.languageService=i,this.customRequestSaved=new Cn,this.customResponseSaved=new Cn,this.customRequestXMLs="... wait",this.customResponseXMLs="Paste custom OJP TripInfoRequest Response XML here...",this.isRunningRequest=!1}parseCustomRequestXML(){var e=this;return mr(function*(){e.isRunningRequest=!0;const i=VC.initWithRequestMock(e.customRequestXMLs),r=e.createOJP_SDK_Instance();e.isRunningRequest=!0,yield r.fetchTripInfoRequestResponse(i),e.isRunningRequest=!1,null!==i.requestInfo.responseXML?e.customRequestSaved.emit(i.requestInfo):console.log("ERROR - no response from StopEventRequest")})()}parseCustomResponseXML(){this.customResponseSaved.emit(this.customResponseXMLs)}createOJP_SDK_Instance(){const e=this.userTripService.getStageConfig();return new M1(Ps,e,this.languageService.language)}}return n.\u0275fac=function(e){return new(e||n)(ue(ia),ue($u))},n.\u0275cmp=Jt({type:n,selectors:[["custom-trip-info-popover"]],outputs:{customRequestSaved:"customRequestSaved",customResponseSaved:"customResponseSaved"},decls:26,vars:4,consts:[["sbbDialogTitle",""],["sbbDialogContent",""],[2,"width","500px"],[1,"d-flex","justify-content-between"],["target","_blank","href","https://opentransportdata.swiss/en/cookbook/ojptripinforequest/"],["rows","10",1,"w-100",3,"ngModel","ngModelChange"],[1,"d-flex"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["sbbDialogActions",""],["type","button","sbbDialogClose","",1,"btn","btn-secondary"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(ne(0,"div",0),Z(1,"Custom TripInfo Request / Response XML"),oe(),ne(2,"div",1)(3,"div",2)(4,"div",3)(5,"div"),Z(6,"TripInfo Request XML"),oe(),ne(7,"div")(8,"a",4),Z(9,"Cookbook opentransportdata.swiss"),oe()()(),ne(10,"textarea",5),Wt("ngModelChange",function(a){return i.customRequestXMLs=a}),oe(),ne(11,"div",6)(12,"button",7),Wt("click",function(){return i.parseCustomRequestXML()}),yt(13,bre,1,0,"span",8),Z(14," Execute OJP TripInfo Request "),oe()(),rn(15,"hr"),ne(16,"div",3)(17,"div"),Z(18,"TripInfo Request Response XML"),oe()(),ne(19,"textarea",5),Wt("ngModelChange",function(a){return i.customResponseXMLs=a}),oe(),ne(20,"div",6)(21,"button",9),Wt("click",function(){return i.parseCustomResponseXML()}),Z(22," Display TripInfo "),oe()()()(),ne(23,"div",10)(24,"button",11),Z(25," Close "),oe()()),2&e&&(pe(10),Pe("ngModel",i.customRequestXMLs),pe(2),Pe("disabled",i.isRunningRequest),pe(1),Pe("ngIf",i.isRunningRequest),pe(6),Pe("ngModel",i.customResponseXMLs))},dependencies:[Zo,tu,Uu,Oh,vf,Km,Qm,eg],encapsulation:2}),n})();function vre(n,t){if(1&n){const e=or();ne(0,"div",20),Wt("click",function(){return Qn(e),ei(St().showRequestXmlPopover())}),ne(1,"span",21),Z(2,"XML"),oe()()}}function xre(n,t){if(1&n){const e=or();ne(0,"sbb-radio-button",22),Wt("change",function(r){return Qn(e),ei(St().onChangeStageAPI(r))}),Z(1),oe()}if(2&n){const e=t.$implicit,i=St();Pe("value",e)("checked",i.userTripService.currentAppStage==e),pe(1),De(" ",e," ")}}function wre(n,t){1&n&&rn(0,"span",23)}let Sre=(()=>{class n{constructor(e,i,r,a,d,b){this.notificationToast=e,this.debugXmlPopover=i,this.customXmlPopover=r,this.tripInfoService=a,this.languageService=d,this.userTripService=b,this.headerText="Search Trip Info",this.useMocks=!1,this.queryParams=new URLSearchParams(document.location.search),this.model={journeyRef:"",journeyDateTime:new Date,appStageOptions:WA,isSearching:!1,permalinkURLAddress:""},this.updatePermalinkURLAddress(),this.currentRequestInfo=null;const x=new URLSearchParams(document.location.search);this.useMocks="yes"===x.get("use_mocks")}ngOnInit(){const e=this.queryParams.get("stage");if(e){const i=this.computeAppStageFromString(e);i&&setTimeout(()=>{this.userTripService.updateAppStage(i)})}this.tripInfoService.tripInfoResultUpdated.subscribe(i=>{var r;null!==i&&(null===(r=this.searchPanel)||void 0===r||r.close())}),this.initFromUserVars()}initFromUserVars(){const e=this.queryParams.get("ref");if(e){this.model.journeyRef=e;const i=this.queryParams.get("day");i&&(this.model.journeyDateTime=new Date(i)),this.fetchTripInfo()}this.useMocks&&this.useMocks&&"localhost"===document.location.hostname&&this.fetchTripInfoRequestFromMocks()}computeAppStageFromString(e){const i=this.model.appStageOptions.map(d=>d.toLowerCase()),r=e.trim(),a=i.indexOf(r.toLowerCase());return-1!==a?this.model.appStageOptions[a]:null}onDateTimeChanged(){this.updatePermalinkURLAddress()}isSearchButtonDisabled(){return!!this.model.isSearching}searchButtonClicked(){this.notificationToast.dismiss(),this.fetchTripInfo()}updatePermalinkURLAddress(){const e=new URLSearchParams;e.set("ref",this.model.journeyRef);const i=bn.DateHelpers.formatDate(this.model.journeyDateTime).substring(0,10);e.set("day",i);const r=document.location.pathname+"?"+e.toString();this.model.permalinkURLAddress=r}fetchTripInfo(){var e=this;return mr(function*(){e.userTripService.getStageConfig();const r=VC.initWithJourneyRef(e.model.journeyRef,e.model.journeyDateTime);r.enableTrackProjection();const a=e.createOJP_SDK_Instance();e.model.isSearching=!0;const d=yield a.fetchTripInfoRequestResponse(r);if(e.model.isSearching=!1,d.ok){const b=j1.initWithTripInfoDeliverySchema(d.value);e.parseTripInfo(r.requestInfo,b)}else e.notificationToast.open("Invalid TripInfoRequest result: "+d.error.message,{type:"error",verticalPosition:"top"}),console.log(e.model.journeyRef),console.log(d)})()}fetchTripInfoRequestFromMocks(){var e=this;return mr(function*(){const r=yield(yield fetch("/path/to/mock.xml")).text();yield e.handleCustomResponse(r)})()}showRequestXmlPopover(){const e=this.debugXmlPopover.open(N1,{position:{top:"20px"},width:"50vw",height:"90vh"});e.afterOpened().subscribe(()=>{this.currentRequestInfo&&e.componentInstance.updateRequestData(this.currentRequestInfo)})}parseTripInfo(e,i){this.currentRequestInfo=e,this.tripInfoService.tripInfoResultUpdated.emit(i)}onChangeStageAPI(e){this.userTripService.updateAppStage(e.value)}loadCustomXMLPopover(){var e=this;const i=this.customXmlPopover.open(yre,{position:{top:"20px"}});i.afterOpened().subscribe(()=>{var r,a;this.notificationToast.dismiss();const d=i.componentInstance;d.customRequestXMLs=null!==(a=null===(r=this.currentRequestInfo)||void 0===r?void 0:r.requestXML)&&void 0!==a?a:"n/a",d.customRequestSaved.subscribe(function(){var b=mr(function*(x){i.close(),e.currentRequestInfo=x,x.requestXML&&(yield e.handleCustomResponse(x.requestXML))});return function(x){return b.apply(this,arguments)}}()),d.customResponseSaved.subscribe(b=>{i.close(),this.handleCustomResponse(b)})})}handleCustomResponse(e){var i=this;return mr(function*(){const r=VC.initWithResponseMock(e);r.enableTrackProjection();const d=yield i.createOJP_SDK_Instance().fetchTripInfoRequestResponse(r);if(d.ok){const b=j1.initWithTripInfoDeliverySchema(d.value);i.parseTripInfo(r.requestInfo,b)}else i.notificationToast.open("Invalid TripInfoRequest result: "+d.error.message,{type:"error",verticalPosition:"top"}),console.log(i.model),console.log(d)})()}createOJP_SDK_Instance(){const i="2.0"===Mo?bn.XML_ConfigOJPv2:bn.XML_BuilderConfigOJPv1,r=this.userTripService.getStageConfig();return new M1(Ps,r,this.languageService.language,i)}}return n.\u0275fac=function(e){return new(e||n)(ue(p2),ue(Cc),ue(Cc),ue(pD),ue($u),ue(ia))},n.\u0275cmp=Jt({type:n,selectors:[["trip-info-search"]],viewQuery:function(e,i){if(1&e&&mo(wf,7),2&e){let r;xi(r=wi())&&(i.searchPanel=r.first)}},decls:30,vars:8,consts:[[1,"row","mb-2"],[1,"col"],[3,"expanded"],[1,"d-flex","align-items-center"],[1,"flex-grow-1"],[1,"sbb-form-field-long"],["sbbInput","","placeholder","type a JourneyRef","value","",3,"ngModel","ngModelChange"],["class","xml-info",3,"click",4,"ngIf"],[1,"d-flex"],["label","Choose Day"],["arrows",""],["sbbInput","","sbbDateInput","",3,"ngModel","ngModelChange","dateChange"],[1,"mb-3","d-flex"],[1,"sbb-radio-group-horizontal"],[3,"value","checked","change",4,"ngFor","ngForOf"],[2,"margin-right","4px"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],[1,"ms-auto"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"xml-info",3,"click"],[1,"layer-xml-info","badge","bg-info","text-dark"],[3,"value","checked","change"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(e,i){1&e&&(ne(0,"div",0)(1,"div",1)(2,"sbb-accordion")(3,"sbb-expansion-panel",2)(4,"sbb-expansion-panel-header"),Z(5),oe(),ne(6,"div",3)(7,"div",4)(8,"sbb-form-field",5)(9,"sbb-label"),Z(10,"Journey Ref"),oe(),ne(11,"input",6),Wt("ngModelChange",function(a){return i.model.journeyRef=a}),oe()()(),yt(12,vre,3,0,"div",7),oe(),ne(13,"div",8)(14,"div")(15,"sbb-form-field",9)(16,"sbb-datepicker",10)(17,"input",11),Wt("ngModelChange",function(a){return i.model.journeyDateTime=a})("dateChange",function(){return i.onDateTimeChanged()}),oe()()()()(),ne(18,"div",12)(19,"div")(20,"sbb-radio-group",13),yt(21,xre,2,3,"sbb-radio-button",14),oe()()(),ne(22,"div",8)(23,"div",15)(24,"button",16),Wt("click",function(){return i.searchButtonClicked()}),yt(25,wre,1,0,"span",17),Z(26," Search "),oe()(),ne(27,"div",18)(28,"button",19),Wt("click",function(){return i.loadCustomXMLPopover()}),Z(29," Custom XML "),oe()()()()()()()),2&e&&(pe(3),Pe("expanded",!0),pe(2),de(i.headerText),pe(6),Pe("ngModel",i.model.journeyRef),pe(1),Pe("ngIf",null==i.currentRequestInfo?null:i.currentRequestInfo.requestXML),pe(5),Pe("ngModel",i.model.journeyDateTime),pe(4),Pe("ngForOf",i.model.appStageOptions),pe(3),Pe("disabled",i.isSearchButtonDisabled()),pe(1),Pe("ngIf",i.model.isSearching))},dependencies:[Sl,Zo,tu,Uu,Oh,hD,wf,V1,yD,q1,Dv,H1,J_,xD,G1],styles:[".xml-info[_ngcontent-%COMP%]{cursor:pointer;margin-left:5px}"]}),n})();const C4=function(n){return{stage:n}},Tre=[{path:"embed/search",component:mre},{path:"embed/board",component:gre},{path:"search",component:Mie},{path:"board",component:fre},{path:"trip",component:(()=>{class n{constructor(e,i){this.appService=e,this.userTripService=i}ngOnInit(){this.appService.setTitle("TripInfoRequest")}}return n.\u0275fac=function(e){return new(e||n)(ue(p1),ue(ia))},n.\u0275cmp=Jt({type:n,selectors:[["trip-info"]],decls:19,vars:11,consts:[[1,"d-flex","flex-column","vh-100","overflow-hidden"],[1,"ms-2"],["sbb-tab-nav-bar",""],["sbb-tab-link","",3,"active","routerLink","queryParams"],["sbb-tab-link","",3,"active"],[1,"flex-grow-1","d-flex","flex-column","overflow-hidden","p-3"],[1,"d-flex","gap-2","flex-grow-1","overflow-hidden"],[1,"d-flex","flex-column","overflow-x-hidden","overflow-y-auto",2,"width","600px"],[1,"flex-shrink-0"],[1,"flex-grow-1","overflow-x-hidden","overflow-y-scroll"],[1,"flex-grow-1","h-100"]],template:function(e,i){1&e&&(ne(0,"div",0),rn(1,"web-header",1),ne(2,"nav",2)(3,"a",3),Z(4,"Journey Search"),oe(),ne(5,"a",3),Z(6,"Station Board"),oe(),ne(7,"a",4),Z(8,"Trip Info"),oe()(),ne(9,"div",5)(10,"div",6)(11,"div",7)(12,"div",8),rn(13,"trip-info-search"),oe(),ne(14,"div",9),rn(15,"trip-info-result"),oe()(),ne(16,"div",10),rn(17,"trip-info-map"),oe()()(),rn(18,"web-footer",1),oe()),2&e&&(pe(3),Pe("active","false")("routerLink","../search")("queryParams",Jc(7,C4,i.userTripService.currentAppStage)),pe(2),Pe("active","false")("routerLink","../board")("queryParams",Jc(9,C4,i.userTripService.currentAppStage)),pe(2),Pe("active","true"))},dependencies:[F_,uD,dD,_re,Sre,Vz,w2,S2],styles:[".app-root[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #CACACA;margin-left:calc(-.5 * var(--bs-gutter-x));margin-right:calc(-.5 * var(--bs-gutter-x));padding:8px}"]}),n})()},{path:"searchOJP-Demo",redirectTo:"/search",pathMatch:"full"},{path:"",redirectTo:"/search",pathMatch:"full"}];let Cre=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[pC.forRoot(Tre),pC]}),n})(),Dre=(()=>{class n{constructor(e){this.appService=e}ngOnInit(){document.body.classList.add(this.appService.bgMainClassName)}}return n.\u0275fac=function(e){return new(e||n)(ue(p1))},n.\u0275cmp=Jt({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(e,i){1&e&&rn(0,"router-outlet")},dependencies:[kA],encapsulation:2}),n})();Aa("showDismiss",[_o("void, dismissed",bi({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),_o("visible",bi({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),jr("void => visible",Kr("0.25s cubic-bezier(0.4,0.0,0.2,1)")),jr("visible => dismissed",Kr("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]);let D4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,pC,Ur,Ss]}),n})();Zl(class{});let C2=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[G_,Ur]}),n})();Aa("transformMenu",[_o("void",bi({opacity:0})),_o("enter-usermenu",bi({width:"{{width}}",maxHeight:"100%"}),{params:{width:"288px"}}),jr("void => enter",Kr("120ms cubic-bezier(0, 0, 0.2, 1)",bi({opacity:1}))),jr("enter => void",Kr("100ms linear",bi({opacity:0}))),jr("void => enter-usermenu",Kr("300ms cubic-bezier(.785,.135,.15,.86)",Nx([bi({width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)",offset:0}),bi({width:"{{width}}",height:"*",opacity:1,maxHeight:"100%",offset:1})]))),jr("enter-usermenu => void",Kr("300ms cubic-bezier(.785,.135,.15,.86)",bi({opacity:0,width:"var(--sbb-menu-trigger-width)",height:"var(--sbb-menu-trigger-height)"})))]),new en("SbbMenuContent"),new en("SBB_MENU_PANEL"),Zl(class{}),new en("sbb-menu-default-options",{providedIn:"root",factory:function Rre(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}}),new en("sbb-menu-inherited-trigger-context");const Lre={provide:new en("sbb-menu-scroll-strategy"),deps:[Gs],useFactory:function kre(n){return()=>n.scrollStrategies.reposition()}};Gm({passive:!0}),Y_(class{});let DD=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[Lre],imports:[go,Tc,ll,Ur,Ss,$_]}),n})(),E4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur,DD,Ss]}),n})();new en("recaptcha-settings");let I4=(()=>{class n{get nativeWindow(){return function Nre(){return window}()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();const Bre=new en("recaptcha-language"),zre=new en("recaptcha-base-url"),Vre=new en("recaptcha-nonce-tag");let jre=(()=>{class n{constructor(e,i,r,a,d){this._windowRef=e,this._language=r||null,this._baseUrl=a||null,this._nonce=d||null,this._document=i,this._init(),this.ready=n._ready.pipe(Do(b=>!!b))}_init(){if(n._ready)return;this._windowRef.nativeWindow.ng2recaptchaloaded=()=>{n._ready.next(grecaptcha)},n._ready=new il(null);const e=this._document.createElement("script");e.innerHTML="",e.src=`${this._baseUrl||"https://www.google.com/recaptcha/api.js"}?render=explicit&onload=ng2recaptchaloaded${this._language?"&hl="+this._language:""}`,this._nonce&&(e.nonce=this._nonce),e.async=!0,e.defer=!0,this._document.head.appendChild(e)}}return n._ready=null,n.\u0275fac=function(e){return new(e||n)(Tt(I4),Tt(Oi),Tt(Bre,8),Tt(zre,8),Tt(Vre,8))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),M4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[jre,I4],imports:[go,Ur]}),n})();const Ure=["*",[["sbb-checkbox-panel-subtitle"]],[["sbb-checkbox-panel-warning"]],[["sbb-checkbox-panel-note"]]],Hre=["*","sbb-checkbox-panel-subtitle","sbb-checkbox-panel-warning","sbb-checkbox-panel-note"],qre={provide:$l,useExisting:Dr(()=>Gre),multi:!0};let Gre=(()=>{class n extends qz{}return n.\u0275fac=function(){let t;return function(i){return(t||(t=gr(n)))(i||n)}}(),n.\u0275cmp=Jt({type:n,selectors:[["sbb-checkbox-panel"]],hostAttrs:[1,"sbb-checkbox-panel","sbb-selection-panel-item","sbb-checkbox","sbb-selection-item"],hostVars:8,hostBindings:function(e,i){2&e&&(dr("id",i.id),si("tabindex",null),_("sbb-selection-indeterminate",i.indeterminate)("sbb-selection-checked",i.checked)("sbb-selection-disabled",i.disabled))},inputs:{tabIndex:"tabIndex"},exportAs:["sbbCheckboxPanel"],features:[Mi([qre]),Un],ngContentSelectors:Hre,decls:16,vars:12,consts:[[1,"sbb-selection-item-label"],["type","checkbox",1,"cdk-visually-hidden","sbb-selection-input","sbb-checkbox-input","sbb-transparent-parent-overlay",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],[1,"sbb-selection-container"],[1,"sbb-selection-container-checked"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","focusable","false"],["fill","none","fill-rule","evenodd","stroke","#000","stroke-width","1","points","6 12 10 16 19 7.01"],[1,"sbb-selection-content"],[1,"sbb-selection-inner-content"],[2,"display","none"]],template:function(e,i){1&e&&(Rs(Ure),ne(0,"label",0)(1,"input",1,2),Wt("change",function(a){return i._onInteractionEvent(a)})("click",function(a){return i._onInputClick(a)}),oe(),ne(3,"span",3)(4,"span",4),gu(),ne(5,"svg",5),rn(6,"polyline",6),oe()()(),nh(),ne(7,"span",7)(8,"span",8)(9,"span",9),Z(10,"\xa0"),oe(),ne(11,"span"),Co(12),oe(),Co(13,1),oe(),Co(14,2),Co(15,3),oe()()),2&e&&(si("for",i.inputId),pe(1),Pe("id",i.inputId)("required",i.required)("checked",i.checked)("disabled",i.disabled)("tabIndex",i.tabIndex),si("value",i.value)("name",i.name)("aria-label",i.ariaLabel||null)("aria-labelledby",i.ariaLabelledby)("aria-checked",i._getAriaChecked())("aria-describedby",i.ariaDescribedby))},encapsulation:2,changeDetection:0}),n})(),A4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur]}),n})();new en("SBB_CHIP_LIST"),new en("SBB_CHIP"),new en("SbbChipRemove"),new en("SbbChipTrailingIcon"),Sv(class Wre{constructor(t){this._elementRef=t}},-1);const N4=new en("sbb-chips-default-options");QC(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new On}});let B4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[{provide:N4,useValue:{separatorKeyCodes:[13]}}],imports:[go,Ur,Ss]}),n})();new en("FILE_SELECTOR_OPTIONS");const ra={TEXT:["text/*"],IMAGE:["image/*"],IMAGE_JPG:["image/jpeg","image/pjpeg"],IMAGE_PNG:["image/png"],IMAGE_SVG:["image/svg+xml"],IMAGE_GIF:["image/gif"],AUDIO:["audio/*"],AUDIO_MP4:["audio/mp4"],AUDIO_MP3:["audio/mpeg","audio/mp3"],AUDIO_OGG:["audio/ogg"],AUDIO_WAVE:["audio/wave"],AUDIO_WAV:["audio/wav","audio/x-wav","audio/x-pn-wav","audio/webm"],VIDEO:["video/*"],VIDEO_MP4:["video/mp4"],VIDEO_MPEG:["video/mpeg"],VIDEO_OGG:["video/ogg"],VIDEO_MOV:["video/quicktime"],VIDEO_WEBM:["video/webm"],VIDEO_AVI:["video/x-msvideo"],VIDEO_WMV:["video/x-ms-wmv"],PDF:["application/pdf"],MS_WORD_DOC:["application/msword","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],MS_EXCEL:["application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.ms-excel.sheet.macroEnabled.12","application/vnd.ms-excel.template.macroEnabled.12","application/vnd.ms-excel.addin.macroEnabled.12","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],MS_POWERPOINT:["application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/vnd.ms-powerpoint.addin.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.presentation.macroEnabled.12","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],ZIP:["application/x-gtar","application/x-gcompress","application/compress","application/x-tar","application/x-rar-compressed","application/octet-stream","application/x-zip-compressed","application/zip-compressed","application/x-7z-compressed","application/gzip","application/zip","application/x-bzip2"]};(new Map).set("doc",[...ra.MS_WORD_DOC,...ra.MS_EXCEL,...ra.MS_POWERPOINT]).set("audio",[...ra.AUDIO_MP4,...ra.AUDIO_MP3,...ra.AUDIO_OGG,...ra.AUDIO_WAVE,...ra.AUDIO_WAV]).set("image",[...ra.IMAGE_GIF,...ra.IMAGE_JPG,...ra.IMAGE_PNG,...ra.IMAGE_SVG]).set("pdf",ra.PDF).set("video",[...ra.VIDEO_MP4,...ra.VIDEO_MPEG,...ra.VIDEO_OGG,...ra.VIDEO_MOV,...ra.VIDEO_WEBM,...ra.VIDEO_AVI,...ra.VIDEO_WMV]).set("zip",ra.ZIP),Zl(class{constructor(n){this._elementRef=n}});let z4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur,Ss]}),n})();new en("SBB_HEADER"),Aa("menu",[_o("open",bi({left:0})),_o("void",bi({left:-305,visibility:"hidden"})),jr("open => void, void => open",[Kr("0.3s ease-in-out")])]);const hoe={provide:new en("sbb-header-menu-scroll-strategy"),deps:[Gs],useFactory:function doe(n){return()=>n.scrollStrategies.reposition()}};Gm({passive:!0}),Zl(class{});let V4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[hoe],imports:[go,GC,Tc,ll,Ur,Ss]}),n})();function poe(n,t){}function foe(n,t){}class E2{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0}}let moe=(()=>{class n extends k1{constructor(e,i,r,a,d,b,x,A){super(),this._elementRef=e,this._focusTrapFactory=i,this._config=a,this._interactivityChecker=d,this._ngZone=b,this._overlayRef=x,this._focusMonitor=A,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=O=>{this._portalOutlet.hasAttached();const B=this._portalOutlet.attachDomPortal(O);return this._contentAttached(),B},this._ariaLabelledBy=this._config.ariaLabelledBy||null,this._document=r}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();const i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{e.removeEventListener("blur",r),e.removeEventListener("mousedown",r),e.removeAttribute("tabindex")};e.addEventListener("blur",r),e.addEventListener("mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(){const e=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||e.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const e=this._config.restoreFocus;let i=null;if("string"==typeof e?i=this._document.querySelector(e):"boolean"==typeof e?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&"function"==typeof i.focus){const r=kd(),a=this._elementRef.nativeElement;(!r||r===this._document.body||r===a||a.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,i=kd();return e===i||e.contains(i)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=kd())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(vv),ue(Oi,8),ue(E2),ue(q_),ue(Ui),ue(Zm),ue(Cl))},n.\u0275cmp=Jt({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(e,i){if(1&e&&mo(jh,7),2&e){let r;xi(r=wi())&&(i._portalOutlet=r.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(e,i){2&e&&si("id",i._config.id||null)("role",i._config.role)("aria-modal",i._config.ariaModal)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null)},features:[Un],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&yt(0,poe,0,0,"ng-template",0)},dependencies:[jh],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2}),n})();class I2{constructor(t,e){this.overlayRef=t,this.config=e,this.closed=new On,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{27===i.keyCode&&!this.disableClose&&!al(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})})}close(t,e){if(this.containerInstance){const i=this.closed;this.containerInstance._closeInteractionType=(null==e?void 0:e.focusOrigin)||"program",this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const j4=new en("DialogScrollStrategy"),goe=new en("DialogData"),_oe=new en("DefaultDialogConfig"),yoe={provide:j4,deps:[Gs],useFactory:function boe(n){return()=>n.scrollStrategies.block()}};let voe=0,xoe=(()=>{class n{constructor(e,i,r,a,d,b){this._overlay=e,this._injector=i,this._defaultOptions=r,this._parentDialog=a,this._overlayContainer=d,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new On,this._afterOpenedAtThisLevel=new On,this._ariaHiddenElements=new Map,this.afterAllClosed=A_(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(Ra(void 0))),this._scrollStrategy=b}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}open(e,i){const r=this._defaultOptions||new E2;(i=Object.assign(Object.assign({},r),i)).id=i.id||"cdk-dialog-"+voe++,i.id&&this.getDialogById(i.id);const a=this._getOverlayConfig(i),d=this._overlay.create(a),b=new I2(d,i),x=this._attachContainer(d,b,i);return b.containerInstance=x,this._attachDialogContent(e,b,x,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(b),b.closed.subscribe(()=>this._removeOpenDialog(b,!0)),this.afterOpened.next(b),b}closeAll(){M2(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){M2(this._openDialogsAtThisLevel,e=>{!1===e.config.closeOnDestroy&&this._removeOpenDialog(e,!1)}),M2(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){const i=new X_({positionStrategy:e.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){var a;const d=r.injector||(null===(a=r.viewContainerRef)||void 0===a?void 0:a.injector),b=[{provide:E2,useValue:r},{provide:I2,useValue:i},{provide:Zm,useValue:e}];let x;r.container?"function"==typeof r.container?x=r.container:(x=r.container.type,b.push(...r.container.providers(r))):x=moe;const A=new Vh(x,r.viewContainerRef,Jo.create({parent:d||this._injector,providers:b}),r.componentFactoryResolver);return e.attach(A).instance}_attachDialogContent(e,i,r,a){if(e instanceof ls){const d=this._createInjector(a,i,r,void 0);let b={$implicit:a.data,dialogRef:i};a.templateContext&&(b=Object.assign(Object.assign({},b),"function"==typeof a.templateContext?a.templateContext():a.templateContext)),r.attachTemplatePortal(new W_(e,null,b,d))}else{const d=this._createInjector(a,i,r,this._injector),b=r.attachComponentPortal(new Vh(e,a.viewContainerRef,d,a.componentFactoryResolver));i.componentInstance=b.instance}}_createInjector(e,i,r,a){var d;const b=e.injector||(null===(d=e.viewContainerRef)||void 0===d?void 0:d.injector),x=[{provide:goe,useValue:e.data},{provide:I2,useValue:i}];return e.providers&&("function"==typeof e.providers?x.push(...e.providers(i,e,r)):x.push(...e.providers)),e.direction&&(!b||!b.get(Xm,null,Ei.Optional))&&x.push({provide:Xm,useValue:{value:e.direction,change:fi()}}),Jo.create({parent:b||a,providers:x})}_removeOpenDialog(e,i){const r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((a,d)=>{a?d.setAttribute("aria-hidden",a):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){const a=i[r];a!==e&&"SCRIPT"!==a.nodeName&&"STYLE"!==a.nodeName&&!a.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(a,a.getAttribute("aria-hidden")),a.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}}return n.\u0275fac=function(e){return new(e||n)(Tt(Gs),Tt(Jo),Tt(_oe,8),Tt(n,12),Tt(wv),Tt(j4))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})();function M2(n,t){let e=n.length;for(;e--;)t(n[e])}let woe=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[xoe,yoe],imports:[Tc,ll,G_,ll]}),n})();const ED={params:{enterAnimationDuration:"150ms",exitAnimationDuration:"75ms"}},Soe={lightboxContainer:Aa("lightboxContainer",[_o("void, exit",bi({opacity:0,transform:"scale(0.7)"})),_o("enter",bi({transform:"none"})),jr("* => enter",Kr("{{enterAnimationDuration}} cubic-bezier(0, 0, 0.2, 1)",bi({transform:"none",opacity:1})),ED),jr("* => void, * => exit",Kr("{{exitAnimationDuration}} cubic-bezier(0.4, 0.0, 0.2, 1)",bi({opacity:0})),ED)])};let Toe=(()=>{class n extends yz{constructor(e,i,r,a,d,b,x,A,O,B){var X;super(e,i,r,a,d,b,x,O),this._changeDetectorRef=A,this._viewportRuler=B,this._destroyed=new On,null===(X=this._viewportRuler)||void 0===X||X.change().pipe(Mr(this._destroyed),Ra(null)).subscribe(()=>{this._height=this._viewportRuler.getViewportSize().height})}_onAnimationDone({toState:e,totalTime:i}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===e&&this._animationStateChanged.next({state:"closed",totalTime:i})}_onAnimationStart({toState:e,totalTime:i}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}ngOnDestroy(){super.ngOnDestroy(),this._destroyed.next(),this._destroyed.complete()}}return n.\u0275fac=function(e){return new(e||n)(ue(ci),ue(vv),ue(Oi,8),ue(F1),ue(q_),ue(Ui),ue(Zm),ue(So),ue(Cl),ue(Od))},n.\u0275cmp=Jt({type:n,selectors:[["sbb-lightbox-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"sbb-lightbox-container"],hostVars:8,hostBindings:function(e,i){1&e&&Eh("@lightboxContainer.done",function(a){return i._onAnimationDone(a)})("@lightboxContainer.start",function(a){return i._onAnimationStart(a)}),2&e&&(dr("id",i._config.id),si("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),Qs("@lightboxContainer",i._getAnimationState()),p("height",i._height,"px"))},features:[Un],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,i){1&e&&yt(0,foe,0,0,"ng-template",0)},dependencies:[jh],styles:[".sbb-overlay-background{background-color:var(--sbb-color-white-alpha70);align-items:center}.sbb-lightbox-container{display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;outline:0;background-color:var(--sbb-color-background);width:100%;height:100vh}.cdk-high-contrast-active .sbb-lightbox-container{outline:solid .0666666667rem}.sbb-lightbox-container>*:only-child:not(.sbb-lightbox-content){width:100%;height:100%;display:flex;flex-direction:column}.sbb-lightbox-content{display:block;padding:var(--sbb-divider-big) var(--sbb-lightbox-padding-horizontal);flex:1 1 auto;overflow:auto;-webkit-overflow-scrolling:touch}.sbb-lightbox-content>*:first-child{margin-top:0}.sbb-lightbox-title{padding:calc(1.4rem * var(--sbb-scaling-factor)) 3.7333333333rem calc(1.1333333333rem * var(--sbb-scaling-factor)) 1.3333333333rem;flex:0 0 auto;font-size:var(--sbb-font-size);line-height:var(--sbb-line-height);display:block;position:relative;box-shadow:var(--sbb-box-shadow-horizontal-border-top);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-height:calc(4.2666666667rem * var(--sbb-scaling-factor))}@media all and (min-width: 40.1875em){.sbb-lightbox-title{padding-left:1.6rem;padding-right:4rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title{padding-left:calc(5.3333333333rem * var(--sbb-scaling-factor));padding-right:calc(6.1333333333rem * var(--sbb-scaling-factor))}}@media all and (min-width: 160.0625em)and (max-width: 240.0525em){:where(html:not(.sbb-lean)) .sbb-lightbox-title{padding-top:1.8666666667rem;padding-bottom:1.8666666667rem}}.sbb-lightbox-title-close-button{position:absolute;right:1.3333333333rem;cursor:pointer;line-height:0;color:var(--sbb-color-storm);outline:0}.sbb-lightbox-title-close-button:is(:hover,:focus){color:var(--sbb-color-call-to-action-hover)}@media all and (min-width: 40.1875em){.sbb-lightbox-title-close-button{right:1.6rem}}@media all and (min-width: 64.0625em){.sbb-lightbox-title-close-button{right:calc(3.7333333333rem * var(--sbb-scaling-factor))}}.sbb-lightbox-actions{padding:var(--sbb-lightbox-actions-padding-vertical) var(--sbb-lightbox-padding-horizontal);display:flex;flex:0 0 auto;flex-flow:column wrap;gap:var(--sbb-button-gap);align-items:center;justify-content:space-between;box-sizing:content-box;box-shadow:var(--sbb-box-shadow-horizontal-border-bottom)}@media all and (min-width: 40.1875em){.sbb-lightbox-actions{flex-direction:row}}"],encapsulation:2,data:{animation:[Soe.lightboxContainer]}}),n})();class Coe extends sD{constructor(t,e,i){super(t,e,i),this.closeRequest=new On,t.overlayRef.keydownEvents().pipe(Do(r=>27===r.keyCode&&!!this.disableClose&&!al(r))).subscribe(()=>this.closeRequest.next(null)),t.overlayRef.detachments().subscribe(()=>{this.closeRequest.complete()})}updatePosition(){return this}updateSize(){return this}}const Doe=new en("SbbLightboxData"),Eoe=new en("sbb-lightbox-default-options"),U4=new en("sbb-lightbox-scroll-strategy"),Moe={provide:U4,deps:[Gs],useFactory:function Ioe(n){return()=>n.scrollStrategies.block()}};let Aoe=0,Roe=(()=>{class n extends wz{constructor(e,i,r,a,d,b){super(e,i,r,d,b,a,Coe,Toe,Doe),this._idPrefix="sbb-lightbox-"}get openLightboxes(){return this.openDialogs}open(e,i){const r=Object.assign(Object.assign({},i),{width:"100vw",minWidth:"100vw",maxWidth:"100vw",height:"auto",minHeight:"auto",maxHeight:"none"});return r.id=r.id||`${this._idPrefix}${Aoe++}`,super.open(e,r)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}getLightboxById(e){return this.getDialogById(e)}}return n.\u0275fac=function(e){return new(e||n)(Tt(Gs),Tt(Jo),Tt(Eoe,8),Tt(U4),Tt(n,12),Tt(wv))},n.\u0275prov=wn({token:n,factory:n.\u0275fac}),n})(),H4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[Roe,Moe],imports:[go,woe,t2,Tc,ll,Ur,Ss]}),n})(),q4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur]}),n})();Aa("showDismiss",[_o("void, dismissed",bi({height:0,paddingTop:0,paddingBottom:0,borderTopWidth:0,borderBottomWidth:0})),_o("visible",bi({height:"*",paddingTop:"*",paddingBottom:"*",borderTopWidth:"*",borderBottomWidth:"*"})),jr("visible => dismissed",Kr("0.25s cubic-bezier(0.4,0.0,0.2,1)"))]),Y_(class{});let G4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur,Ss]}),n})();new en("SBB_PAGINATOR_DEFAULT_OPTIONS"),Zl(oz(class{}));let $4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,pC,Ur,Ss]}),n})(),Foe=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[KC]}),n})();Aa("stepTransition",[jr("* => previous, * => next",[bi({opacity:1}),Kr("150ms ease",bi({opacity:0}))]),jr("previous => current, next => current",[bi({opacity:0}),Kr("500ms ease",bi({opacity:1}))]),jr("void => current",Kr("0s"))]);let W4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,ll,Foe,Ur,Ss]}),n})(),X4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur,x2]}),n})();Aa("growShrink",[_o("void",bi({opacity:0,width:"0px"})),_o("open",bi({opacity:1,width:"*"})),jr("void => *",Kr("300ms ease")),jr("* => void",Kr("300ms 25ms linear"))]);const joe={provide:new en("sbb-select-scroll-strategy"),deps:[Gs],useFactory:function Voe(n){return()=>n.scrollStrategies.reposition()}};["start","center","end"].map(n=>({originX:n,originY:"top",overlayX:n,overlayY:"top"}));let Z4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({providers:[joe],imports:[go,ll,Tc,Ur,m2,Ss]}),n})();new en("SBB_SIDEBAR_CONTAINER"),Aa("transform",[_o("open, open-instant",bi({transform:"none",visibility:"visible"})),_o("void",bi({"box-shadow":"none",visibility:"hidden"})),jr("void => open-instant",Kr("0ms")),jr("void <=> open, open-instant => void",Kr("300ms cubic-bezier(0.785, 0.135, 0.15, 0.86)"))]);let Y4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,$_,Ur,Ss,$_]}),n})(),J4=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur,Ss]}),n})(),nse=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[qR]}),n})();new en("SBB_SORT_DEFAULT_OPTIONS"),oz(Zl(class{}));const Av="225ms cubic-bezier(0.4,0.0,0.2,1)";Aa("indicator",[_o("active-asc, asc",bi({transform:"scaleY(-1)"})),_o("active-desc, desc",bi({transform:"scaleY(1)"})),jr("active-asc <=> active-desc",Kr(Av)),jr("asc <=> desc",Kr("0ms"))]),Aa("arrowOpacity",[_o("desc-to-active, asc-to-active, active",bi({opacity:1})),_o("desc-to-hint, asc-to-hint, hint",bi({opacity:.54})),_o("hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void",bi({opacity:0})),jr("* => asc, * => desc, * => active, * => hint, * => void",Kr("0ms")),jr("* <=> *",Kr(Av))]),Aa("arrowPosition",[jr("* => desc-to-hint, * => desc-to-active",Kr(Av,Nx([bi({transform:"translateY(-25%)"}),bi({transform:"translateY(0)"})]))),jr("* => hint-to-desc, * => active-to-desc",Kr(Av,Nx([bi({transform:"translateY(0)"}),bi({transform:"translateY(25%)"})]))),jr("* => asc-to-hint, * => asc-to-active",Kr(Av,Nx([bi({transform:"translateY(25%)"}),bi({transform:"translateY(0)"})]))),jr("* => hint-to-asc, * => active-to-asc",Kr(Av,Nx([bi({transform:"translateY(0)"}),bi({transform:"translateY(-25%)"})]))),_o("desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active",bi({transform:"translateY(0)"})),_o("hint-to-desc, active-to-desc, desc",bi({transform:"translateY(-25%)"})),_o("hint-to-asc, active-to-asc, asc",bi({transform:"translateY(25%)"}))]),Aa("allowChildren",[jr("* <=> *",[mM("@*",fM(),{optional:!0})])]),Zl(class{}),Gm({passive:!0});let uV=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[nse,go,Ur]}),n})(),dV=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur,C2]}),n})();QC(class{constructor(n,t,e,i){this._defaultErrorStateMatcher=n,this._parentForm=t,this._parentFormGroup=e,this.ngControl=i,this.stateChanges=new On}});let hV=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,g2,Ur]}),n})(),pV=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur]}),n})();const fV="225ms cubic-bezier(0.785, 0.135, 0.15, 0.86)";Aa("translateHeight",[_o("void",bi({height:0,paddingTop:0,paddingBottom:0})),_o("auto",bi({height:"*",paddingTop:"*",paddingBottom:"*"})),jr("fixed => auto, initial => auto, * => void",[bi({height:"{{currentHeight}}px"}),Kr(fV)]),jr("void => fixed, void => auto",Kr(fV)),jr("void => initial",Kr(0))]);let mV=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,ll,Ur,Ss]}),n})();Y_(class{});let gV=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[go,Ur,Ss,DD]}),n})();const jse=[Lz,D4,p4,C2,E4,m2,M4,Gz,A4,B4,n4,t2,z4,bD,V4,Ss,Jz,H4,q4,DD,G4,h2,$4,W4,x2,X4,Z4,g4,Y4,J4,uV,Iz,dV,hV,pV,l4,mV,zz,gV];let Use=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n}),n.\u0275inj=Nn({imports:[jse,Lz,D4,p4,C2,E4,m2,M4,Gz,A4,B4,n4,t2,z4,bD,V4,Ss,Jz,H4,q4,DD,G4,h2,$4,W4,x2,X4,Z4,g4,Y4,J4,uV,Iz,dV,hV,pV,l4,mV,zz,gV]}),n})(),Hse=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=ii({type:n,bootstrap:[Dre]}),n.\u0275inj=Nn({imports:[go,EL,Tq,Bq,Cre,BG,NF,Use]}),n})();(function N5(){Tk=!1})(),mH().bootstrapModule(Hse).catch(n=>console.error(n))},5343:(Mn,kn)=>{"use strict";kn.byteLength=function Se(ft){var Rt=Ct(ft),ui=Rt[1];return 3*(Rt[0]+ui)/4-ui},kn.toByteArray=function $t(ft){var Rt,We,xn=Ct(ft),ui=xn[0],Rn=xn[1],Vt=new tt(function Mt(ft,Rt,xn){return 3*(Rt+xn)/4-xn}(0,ui,Rn)),En=0,ke=Rn>0?ui-4:ui;for(We=0;We<ke;We+=4)Rt=Ye[ft.charCodeAt(We)]<<18|Ye[ft.charCodeAt(We+1)]<<12|Ye[ft.charCodeAt(We+2)]<<6|Ye[ft.charCodeAt(We+3)],Vt[En++]=Rt>>16&255,Vt[En++]=Rt>>8&255,Vt[En++]=255&Rt;return 2===Rn&&(Rt=Ye[ft.charCodeAt(We)]<<2|Ye[ft.charCodeAt(We+1)]>>4,Vt[En++]=255&Rt),1===Rn&&(Rt=Ye[ft.charCodeAt(We)]<<10|Ye[ft.charCodeAt(We+1)]<<4|Ye[ft.charCodeAt(We+2)]>>2,Vt[En++]=Rt>>8&255,Vt[En++]=255&Rt),Vt},kn.fromByteArray=function rt(ft){for(var Rt,xn=ft.length,ui=xn%3,Rn=[],En=0,ke=xn-ui;En<ke;En+=16383)Rn.push(jt(ft,En,En+16383>ke?ke:En+16383));return 1===ui?Rn.push(pt[(Rt=ft[xn-1])>>2]+pt[Rt<<4&63]+"=="):2===ui&&Rn.push(pt[(Rt=(ft[xn-2]<<8)+ft[xn-1])>>10]+pt[Rt>>4&63]+pt[Rt<<2&63]+"="),Rn.join("")};for(var pt=[],Ye=[],tt="undefined"!=typeof Uint8Array?Uint8Array:Array,Ue="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,dt=Ue.length;h<dt;++h)pt[h]=Ue[h],Ye[Ue.charCodeAt(h)]=h;function Ct(ft){var Rt=ft.length;if(Rt%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var xn=ft.indexOf("=");return-1===xn&&(xn=Rt),[xn,xn===Rt?0:4-xn%4]}function nn(ft){return pt[ft>>18&63]+pt[ft>>12&63]+pt[ft>>6&63]+pt[63&ft]}function jt(ft,Rt,xn){for(var Rn=[],Vt=Rt;Vt<xn;Vt+=3)Rn.push(nn((ft[Vt]<<16&16711680)+(ft[Vt+1]<<8&65280)+(255&ft[Vt+2])));return Rn.join("")}Ye["-".charCodeAt(0)]=62,Ye["_".charCodeAt(0)]=63},3172:(Mn,kn,pt)=>{"use strict";var Ye=pt(5343),tt=pt(8461),Ue="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;kn.Buffer=Se,kn.SlowBuffer=function Vt(Oe){return+Oe!=Oe&&(Oe=0),Se.alloc(+Oe)},kn.INSPECT_MAX_BYTES=50;var h=2147483647;function Ct(Oe){if(Oe>h)throw new RangeError('The value "'+Oe+'" is invalid for option "size"');var ae=new Uint8Array(Oe);return Object.setPrototypeOf(ae,Se.prototype),ae}function Se(Oe,ae,he){if("number"==typeof Oe){if("string"==typeof ae)throw new TypeError('The "string" argument must be of type string. Received type number');return jt(Oe)}return Mt(Oe,ae,he)}function Mt(Oe,ae,he){if("string"==typeof Oe)return function rt(Oe,ae){if(("string"!=typeof ae||""===ae)&&(ae="utf8"),!Se.isEncoding(ae))throw new TypeError("Unknown encoding: "+ae);var he=0|En(Oe,ae),Ze=Ct(he),kt=Ze.write(Oe,ae);return kt!==he&&(Ze=Ze.slice(0,kt)),Ze}(Oe,ae);if(ArrayBuffer.isView(Oe))return function Rt(Oe){if(Hi(Oe,Uint8Array)){var ae=new Uint8Array(Oe);return xn(ae.buffer,ae.byteOffset,ae.byteLength)}return ft(Oe)}(Oe);if(null==Oe)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Oe);if(Hi(Oe,ArrayBuffer)||Oe&&Hi(Oe.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(Hi(Oe,SharedArrayBuffer)||Oe&&Hi(Oe.buffer,SharedArrayBuffer)))return xn(Oe,ae,he);if("number"==typeof Oe)throw new TypeError('The "value" argument must not be of type number. Received type number');var Ze=Oe.valueOf&&Oe.valueOf();if(null!=Ze&&Ze!==Oe)return Se.from(Ze,ae,he);var kt=function ui(Oe){if(Se.isBuffer(Oe)){var ae=0|Rn(Oe.length),he=Ct(ae);return 0===he.length||Oe.copy(he,0,0,ae),he}return void 0!==Oe.length?"number"!=typeof Oe.length||Ao(Oe.length)?Ct(0):ft(Oe):"Buffer"===Oe.type&&Array.isArray(Oe.data)?ft(Oe.data):void 0}(Oe);if(kt)return kt;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof Oe[Symbol.toPrimitive])return Se.from(Oe[Symbol.toPrimitive]("string"),ae,he);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Oe)}function $t(Oe){if("number"!=typeof Oe)throw new TypeError('"size" argument must be of type number');if(Oe<0)throw new RangeError('The value "'+Oe+'" is invalid for option "size"')}function jt(Oe){return $t(Oe),Ct(Oe<0?0:0|Rn(Oe))}function ft(Oe){for(var ae=Oe.length<0?0:0|Rn(Oe.length),he=Ct(ae),Ze=0;Ze<ae;Ze+=1)he[Ze]=255&Oe[Ze];return he}function xn(Oe,ae,he){if(ae<0||Oe.byteLength<ae)throw new RangeError('"offset" is outside of buffer bounds');if(Oe.byteLength<ae+(he||0))throw new RangeError('"length" is outside of buffer bounds');var Ze;return Ze=void 0===ae&&void 0===he?new Uint8Array(Oe):void 0===he?new Uint8Array(Oe,ae):new Uint8Array(Oe,ae,he),Object.setPrototypeOf(Ze,Se.prototype),Ze}function Rn(Oe){if(Oe>=h)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+h.toString(16)+" bytes");return 0|Oe}function En(Oe,ae){if(Se.isBuffer(Oe))return Oe.length;if(ArrayBuffer.isView(Oe)||Hi(Oe,ArrayBuffer))return Oe.byteLength;if("string"!=typeof Oe)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Oe);var he=Oe.length,Ze=arguments.length>2&&!0===arguments[2];if(!Ze&&0===he)return 0;for(var kt=!1;;)switch(ae){case"ascii":case"latin1":case"binary":return he;case"utf8":case"utf-8":return Ce(Oe).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*he;case"hex":return he>>>1;case"base64":return Ht(Oe).length;default:if(kt)return Ze?-1:Ce(Oe).length;ae=(""+ae).toLowerCase(),kt=!0}}function ke(Oe,ae,he){var Ze=!1;if((void 0===ae||ae<0)&&(ae=0),ae>this.length||((void 0===he||he>this.length)&&(he=this.length),he<=0)||(he>>>=0)<=(ae>>>=0))return"";for(Oe||(Oe="utf8");;)switch(Oe){case"hex":return yi(this,ae,he);case"utf8":case"utf-8":return tn(this,ae,he);case"ascii":return $n(this,ae,he);case"latin1":case"binary":return Kn(this,ae,he);case"base64":return ct(this,ae,he);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Wn(this,ae,he);default:if(Ze)throw new TypeError("Unknown encoding: "+Oe);Oe=(Oe+"").toLowerCase(),Ze=!0}}function We(Oe,ae,he){var Ze=Oe[ae];Oe[ae]=Oe[he],Oe[he]=Ze}function Ft(Oe,ae,he,Ze,kt){if(0===Oe.length)return-1;if("string"==typeof he?(Ze=he,he=0):he>2147483647?he=2147483647:he<-2147483648&&(he=-2147483648),Ao(he=+he)&&(he=kt?0:Oe.length-1),he<0&&(he=Oe.length+he),he>=Oe.length){if(kt)return-1;he=Oe.length-1}else if(he<0){if(!kt)return-1;he=0}if("string"==typeof ae&&(ae=Se.from(ae,Ze)),Se.isBuffer(ae))return 0===ae.length?-1:Te(Oe,ae,he,Ze,kt);if("number"==typeof ae)return ae&=255,"function"==typeof Uint8Array.prototype.indexOf?kt?Uint8Array.prototype.indexOf.call(Oe,ae,he):Uint8Array.prototype.lastIndexOf.call(Oe,ae,he):Te(Oe,[ae],he,Ze,kt);throw new TypeError("val must be string, number or Buffer")}function Te(Oe,ae,he,Ze,kt){var yr,Bt=1,In=Oe.length,hr=ae.length;if(void 0!==Ze&&("ucs2"===(Ze=String(Ze).toLowerCase())||"ucs-2"===Ze||"utf16le"===Ze||"utf-16le"===Ze)){if(Oe.length<2||ae.length<2)return-1;Bt=2,In/=2,hr/=2,he/=2}function kr(Dc,ul){return 1===Bt?Dc[ul]:Dc.readUInt16BE(ul*Bt)}if(kt){var lo=-1;for(yr=he;yr<In;yr++)if(kr(Oe,yr)===kr(ae,-1===lo?0:yr-lo)){if(-1===lo&&(lo=yr),yr-lo+1===hr)return lo*Bt}else-1!==lo&&(yr-=yr-lo),lo=-1}else for(he+hr>In&&(he=In-hr),yr=he;yr>=0;yr--){for(var Eo=!0,Jl=0;Jl<hr;Jl++)if(kr(Oe,yr+Jl)!==kr(ae,Jl)){Eo=!1;break}if(Eo)return yr}return-1}function lt(Oe,ae,he,Ze){he=Number(he)||0;var kt=Oe.length-he;Ze?(Ze=Number(Ze))>kt&&(Ze=kt):Ze=kt;var Bt=ae.length;Ze>Bt/2&&(Ze=Bt/2);for(var In=0;In<Ze;++In){var hr=parseInt(ae.substr(2*In,2),16);if(Ao(hr))return In;Oe[he+In]=hr}return In}function Ve(Oe,ae,he,Ze){return ao(Ce(ae,Oe.length-he),Oe,he,Ze)}function qe(Oe,ae,he,Ze){return ao(function dn(Oe){for(var ae=[],he=0;he<Oe.length;++he)ae.push(255&Oe.charCodeAt(he));return ae}(ae),Oe,he,Ze)}function Nt(Oe,ae,he,Ze){return ao(Ht(ae),Oe,he,Ze)}function xt(Oe,ae,he,Ze){return ao(function st(Oe,ae){for(var he,Ze,Bt=[],In=0;In<Oe.length&&!((ae-=2)<0);++In)Ze=(he=Oe.charCodeAt(In))>>8,Bt.push(he%256),Bt.push(Ze);return Bt}(ae,Oe.length-he),Oe,he,Ze)}function ct(Oe,ae,he){return Ye.fromByteArray(0===ae&&he===Oe.length?Oe:Oe.slice(ae,he))}function tn(Oe,ae,he){he=Math.min(Oe.length,he);for(var Ze=[],kt=ae;kt<he;){var kr,yr,lo,Eo,Bt=Oe[kt],In=null,hr=Bt>239?4:Bt>223?3:Bt>191?2:1;if(kt+hr<=he)switch(hr){case 1:Bt<128&&(In=Bt);break;case 2:128==(192&(kr=Oe[kt+1]))&&(Eo=(31&Bt)<<6|63&kr)>127&&(In=Eo);break;case 3:yr=Oe[kt+2],128==(192&(kr=Oe[kt+1]))&&128==(192&yr)&&(Eo=(15&Bt)<<12|(63&kr)<<6|63&yr)>2047&&(Eo<55296||Eo>57343)&&(In=Eo);break;case 4:yr=Oe[kt+2],lo=Oe[kt+3],128==(192&(kr=Oe[kt+1]))&&128==(192&yr)&&128==(192&lo)&&(Eo=(15&Bt)<<18|(63&kr)<<12|(63&yr)<<6|63&lo)>65535&&Eo<1114112&&(In=Eo)}null===In?(In=65533,hr=1):In>65535&&(Ze.push((In-=65536)>>>10&1023|55296),In=56320|1023&In),Ze.push(In),kt+=hr}return function vn(Oe){var ae=Oe.length;if(ae<=4096)return String.fromCharCode.apply(String,Oe);for(var he="",Ze=0;Ze<ae;)he+=String.fromCharCode.apply(String,Oe.slice(Ze,Ze+=4096));return he}(Ze)}function $n(Oe,ae,he){var Ze="";he=Math.min(Oe.length,he);for(var kt=ae;kt<he;++kt)Ze+=String.fromCharCode(127&Oe[kt]);return Ze}function Kn(Oe,ae,he){var Ze="";he=Math.min(Oe.length,he);for(var kt=ae;kt<he;++kt)Ze+=String.fromCharCode(Oe[kt]);return Ze}function yi(Oe,ae,he){var Ze=Oe.length;(!ae||ae<0)&&(ae=0),(!he||he<0||he>Ze)&&(he=Ze);for(var kt="",Bt=ae;Bt<he;++Bt)kt+=pi[Oe[Bt]];return kt}function Wn(Oe,ae,he){for(var Ze=Oe.slice(ae,he),kt="",Bt=0;Bt<Ze.length-1;Bt+=2)kt+=String.fromCharCode(Ze[Bt]+256*Ze[Bt+1]);return kt}function br(Oe,ae,he){if(Oe%1!=0||Oe<0)throw new RangeError("offset is not uint");if(Oe+ae>he)throw new RangeError("Trying to access beyond buffer length")}function qr(Oe,ae,he,Ze,kt,Bt){if(!Se.isBuffer(Oe))throw new TypeError('"buffer" argument must be a Buffer instance');if(ae>kt||ae<Bt)throw new RangeError('"value" argument is out of bounds');if(he+Ze>Oe.length)throw new RangeError("Index out of range")}function ds(Oe,ae,he,Ze,kt,Bt){if(he+Ze>Oe.length)throw new RangeError("Index out of range");if(he<0)throw new RangeError("Index out of range")}function On(Oe,ae,he,Ze,kt){return ae=+ae,he>>>=0,kt||ds(Oe,0,he,4),tt.write(Oe,ae,he,Ze,23,4),he+4}function ks(Oe,ae,he,Ze,kt){return ae=+ae,he>>>=0,kt||ds(Oe,0,he,8),tt.write(Oe,ae,he,Ze,52,8),he+8}kn.kMaxLength=h,!(Se.TYPED_ARRAY_SUPPORT=function dt(){try{var Oe=new Uint8Array(1),ae={foo:function(){return 42}};return Object.setPrototypeOf(ae,Uint8Array.prototype),Object.setPrototypeOf(Oe,ae),42===Oe.foo()}catch(he){return!1}}())&&"undefined"!=typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Se.prototype,"parent",{enumerable:!0,get:function(){if(Se.isBuffer(this))return this.buffer}}),Object.defineProperty(Se.prototype,"offset",{enumerable:!0,get:function(){if(Se.isBuffer(this))return this.byteOffset}}),Se.poolSize=8192,Se.from=function(Oe,ae,he){return Mt(Oe,ae,he)},Object.setPrototypeOf(Se.prototype,Uint8Array.prototype),Object.setPrototypeOf(Se,Uint8Array),Se.alloc=function(Oe,ae,he){return function nn(Oe,ae,he){return $t(Oe),Oe<=0?Ct(Oe):void 0!==ae?"string"==typeof he?Ct(Oe).fill(ae,he):Ct(Oe).fill(ae):Ct(Oe)}(Oe,ae,he)},Se.allocUnsafe=function(Oe){return jt(Oe)},Se.allocUnsafeSlow=function(Oe){return jt(Oe)},Se.isBuffer=function(ae){return null!=ae&&!0===ae._isBuffer&&ae!==Se.prototype},Se.compare=function(ae,he){if(Hi(ae,Uint8Array)&&(ae=Se.from(ae,ae.offset,ae.byteLength)),Hi(he,Uint8Array)&&(he=Se.from(he,he.offset,he.byteLength)),!Se.isBuffer(ae)||!Se.isBuffer(he))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(ae===he)return 0;for(var Ze=ae.length,kt=he.length,Bt=0,In=Math.min(Ze,kt);Bt<In;++Bt)if(ae[Bt]!==he[Bt]){Ze=ae[Bt],kt=he[Bt];break}return Ze<kt?-1:kt<Ze?1:0},Se.isEncoding=function(ae){switch(String(ae).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Se.concat=function(ae,he){if(!Array.isArray(ae))throw new TypeError('"list" argument must be an Array of Buffers');if(0===ae.length)return Se.alloc(0);var Ze;if(void 0===he)for(he=0,Ze=0;Ze<ae.length;++Ze)he+=ae[Ze].length;var kt=Se.allocUnsafe(he),Bt=0;for(Ze=0;Ze<ae.length;++Ze){var In=ae[Ze];if(Hi(In,Uint8Array))Bt+In.length>kt.length?Se.from(In).copy(kt,Bt):Uint8Array.prototype.set.call(kt,In,Bt);else{if(!Se.isBuffer(In))throw new TypeError('"list" argument must be an Array of Buffers');In.copy(kt,Bt)}Bt+=In.length}return kt},Se.byteLength=En,Se.prototype._isBuffer=!0,Se.prototype.swap16=function(){var ae=this.length;if(ae%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var he=0;he<ae;he+=2)We(this,he,he+1);return this},Se.prototype.swap32=function(){var ae=this.length;if(ae%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var he=0;he<ae;he+=4)We(this,he,he+3),We(this,he+1,he+2);return this},Se.prototype.swap64=function(){var ae=this.length;if(ae%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var he=0;he<ae;he+=8)We(this,he,he+7),We(this,he+1,he+6),We(this,he+2,he+5),We(this,he+3,he+4);return this},Se.prototype.toLocaleString=Se.prototype.toString=function(){var ae=this.length;return 0===ae?"":0===arguments.length?tn(this,0,ae):ke.apply(this,arguments)},Se.prototype.equals=function(ae){if(!Se.isBuffer(ae))throw new TypeError("Argument must be a Buffer");return this===ae||0===Se.compare(this,ae)},Se.prototype.inspect=function(){var ae="",he=kn.INSPECT_MAX_BYTES;return ae=this.toString("hex",0,he).replace(/(.{2})/g,"$1 ").trim(),this.length>he&&(ae+=" ... "),"<Buffer "+ae+">"},Ue&&(Se.prototype[Ue]=Se.prototype.inspect),Se.prototype.compare=function(ae,he,Ze,kt,Bt){if(Hi(ae,Uint8Array)&&(ae=Se.from(ae,ae.offset,ae.byteLength)),!Se.isBuffer(ae))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof ae);if(void 0===he&&(he=0),void 0===Ze&&(Ze=ae?ae.length:0),void 0===kt&&(kt=0),void 0===Bt&&(Bt=this.length),he<0||Ze>ae.length||kt<0||Bt>this.length)throw new RangeError("out of range index");if(kt>=Bt&&he>=Ze)return 0;if(kt>=Bt)return-1;if(he>=Ze)return 1;if(this===ae)return 0;for(var In=(Bt>>>=0)-(kt>>>=0),hr=(Ze>>>=0)-(he>>>=0),kr=Math.min(In,hr),yr=this.slice(kt,Bt),lo=ae.slice(he,Ze),Eo=0;Eo<kr;++Eo)if(yr[Eo]!==lo[Eo]){In=yr[Eo],hr=lo[Eo];break}return In<hr?-1:hr<In?1:0},Se.prototype.includes=function(ae,he,Ze){return-1!==this.indexOf(ae,he,Ze)},Se.prototype.indexOf=function(ae,he,Ze){return Ft(this,ae,he,Ze,!0)},Se.prototype.lastIndexOf=function(ae,he,Ze){return Ft(this,ae,he,Ze,!1)},Se.prototype.write=function(ae,he,Ze,kt){if(void 0===he)kt="utf8",Ze=this.length,he=0;else if(void 0===Ze&&"string"==typeof he)kt=he,Ze=this.length,he=0;else{if(!isFinite(he))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");he>>>=0,isFinite(Ze)?(Ze>>>=0,void 0===kt&&(kt="utf8")):(kt=Ze,Ze=void 0)}var Bt=this.length-he;if((void 0===Ze||Ze>Bt)&&(Ze=Bt),ae.length>0&&(Ze<0||he<0)||he>this.length)throw new RangeError("Attempt to write outside buffer bounds");kt||(kt="utf8");for(var In=!1;;)switch(kt){case"hex":return lt(this,ae,he,Ze);case"utf8":case"utf-8":return Ve(this,ae,he,Ze);case"ascii":case"latin1":case"binary":return qe(this,ae,he,Ze);case"base64":return Nt(this,ae,he,Ze);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return xt(this,ae,he,Ze);default:if(In)throw new TypeError("Unknown encoding: "+kt);kt=(""+kt).toLowerCase(),In=!0}},Se.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Se.prototype.slice=function(ae,he){var Ze=this.length;(ae=~~ae)<0?(ae+=Ze)<0&&(ae=0):ae>Ze&&(ae=Ze),(he=void 0===he?Ze:~~he)<0?(he+=Ze)<0&&(he=0):he>Ze&&(he=Ze),he<ae&&(he=ae);var kt=this.subarray(ae,he);return Object.setPrototypeOf(kt,Se.prototype),kt},Se.prototype.readUintLE=Se.prototype.readUIntLE=function(ae,he,Ze){ae>>>=0,he>>>=0,Ze||br(ae,he,this.length);for(var kt=this[ae],Bt=1,In=0;++In<he&&(Bt*=256);)kt+=this[ae+In]*Bt;return kt},Se.prototype.readUintBE=Se.prototype.readUIntBE=function(ae,he,Ze){ae>>>=0,he>>>=0,Ze||br(ae,he,this.length);for(var kt=this[ae+--he],Bt=1;he>0&&(Bt*=256);)kt+=this[ae+--he]*Bt;return kt},Se.prototype.readUint8=Se.prototype.readUInt8=function(ae,he){return ae>>>=0,he||br(ae,1,this.length),this[ae]},Se.prototype.readUint16LE=Se.prototype.readUInt16LE=function(ae,he){return ae>>>=0,he||br(ae,2,this.length),this[ae]|this[ae+1]<<8},Se.prototype.readUint16BE=Se.prototype.readUInt16BE=function(ae,he){return ae>>>=0,he||br(ae,2,this.length),this[ae]<<8|this[ae+1]},Se.prototype.readUint32LE=Se.prototype.readUInt32LE=function(ae,he){return ae>>>=0,he||br(ae,4,this.length),(this[ae]|this[ae+1]<<8|this[ae+2]<<16)+16777216*this[ae+3]},Se.prototype.readUint32BE=Se.prototype.readUInt32BE=function(ae,he){return ae>>>=0,he||br(ae,4,this.length),16777216*this[ae]+(this[ae+1]<<16|this[ae+2]<<8|this[ae+3])},Se.prototype.readIntLE=function(ae,he,Ze){ae>>>=0,he>>>=0,Ze||br(ae,he,this.length);for(var kt=this[ae],Bt=1,In=0;++In<he&&(Bt*=256);)kt+=this[ae+In]*Bt;return kt>=(Bt*=128)&&(kt-=Math.pow(2,8*he)),kt},Se.prototype.readIntBE=function(ae,he,Ze){ae>>>=0,he>>>=0,Ze||br(ae,he,this.length);for(var kt=he,Bt=1,In=this[ae+--kt];kt>0&&(Bt*=256);)In+=this[ae+--kt]*Bt;return In>=(Bt*=128)&&(In-=Math.pow(2,8*he)),In},Se.prototype.readInt8=function(ae,he){return ae>>>=0,he||br(ae,1,this.length),128&this[ae]?-1*(255-this[ae]+1):this[ae]},Se.prototype.readInt16LE=function(ae,he){ae>>>=0,he||br(ae,2,this.length);var Ze=this[ae]|this[ae+1]<<8;return 32768&Ze?4294901760|Ze:Ze},Se.prototype.readInt16BE=function(ae,he){ae>>>=0,he||br(ae,2,this.length);var Ze=this[ae+1]|this[ae]<<8;return 32768&Ze?4294901760|Ze:Ze},Se.prototype.readInt32LE=function(ae,he){return ae>>>=0,he||br(ae,4,this.length),this[ae]|this[ae+1]<<8|this[ae+2]<<16|this[ae+3]<<24},Se.prototype.readInt32BE=function(ae,he){return ae>>>=0,he||br(ae,4,this.length),this[ae]<<24|this[ae+1]<<16|this[ae+2]<<8|this[ae+3]},Se.prototype.readFloatLE=function(ae,he){return ae>>>=0,he||br(ae,4,this.length),tt.read(this,ae,!0,23,4)},Se.prototype.readFloatBE=function(ae,he){return ae>>>=0,he||br(ae,4,this.length),tt.read(this,ae,!1,23,4)},Se.prototype.readDoubleLE=function(ae,he){return ae>>>=0,he||br(ae,8,this.length),tt.read(this,ae,!0,52,8)},Se.prototype.readDoubleBE=function(ae,he){return ae>>>=0,he||br(ae,8,this.length),tt.read(this,ae,!1,52,8)},Se.prototype.writeUintLE=Se.prototype.writeUIntLE=function(ae,he,Ze,kt){ae=+ae,he>>>=0,Ze>>>=0,kt||qr(this,ae,he,Ze,Math.pow(2,8*Ze)-1,0);var In=1,hr=0;for(this[he]=255&ae;++hr<Ze&&(In*=256);)this[he+hr]=ae/In&255;return he+Ze},Se.prototype.writeUintBE=Se.prototype.writeUIntBE=function(ae,he,Ze,kt){ae=+ae,he>>>=0,Ze>>>=0,kt||qr(this,ae,he,Ze,Math.pow(2,8*Ze)-1,0);var In=Ze-1,hr=1;for(this[he+In]=255&ae;--In>=0&&(hr*=256);)this[he+In]=ae/hr&255;return he+Ze},Se.prototype.writeUint8=Se.prototype.writeUInt8=function(ae,he,Ze){return ae=+ae,he>>>=0,Ze||qr(this,ae,he,1,255,0),this[he]=255&ae,he+1},Se.prototype.writeUint16LE=Se.prototype.writeUInt16LE=function(ae,he,Ze){return ae=+ae,he>>>=0,Ze||qr(this,ae,he,2,65535,0),this[he]=255&ae,this[he+1]=ae>>>8,he+2},Se.prototype.writeUint16BE=Se.prototype.writeUInt16BE=function(ae,he,Ze){return ae=+ae,he>>>=0,Ze||qr(this,ae,he,2,65535,0),this[he]=ae>>>8,this[he+1]=255&ae,he+2},Se.prototype.writeUint32LE=Se.prototype.writeUInt32LE=function(ae,he,Ze){return ae=+ae,he>>>=0,Ze||qr(this,ae,he,4,4294967295,0),this[he+3]=ae>>>24,this[he+2]=ae>>>16,this[he+1]=ae>>>8,this[he]=255&ae,he+4},Se.prototype.writeUint32BE=Se.prototype.writeUInt32BE=function(ae,he,Ze){return ae=+ae,he>>>=0,Ze||qr(this,ae,he,4,4294967295,0),this[he]=ae>>>24,this[he+1]=ae>>>16,this[he+2]=ae>>>8,this[he+3]=255&ae,he+4},Se.prototype.writeIntLE=function(ae,he,Ze,kt){if(ae=+ae,he>>>=0,!kt){var Bt=Math.pow(2,8*Ze-1);qr(this,ae,he,Ze,Bt-1,-Bt)}var In=0,hr=1,kr=0;for(this[he]=255&ae;++In<Ze&&(hr*=256);)ae<0&&0===kr&&0!==this[he+In-1]&&(kr=1),this[he+In]=(ae/hr>>0)-kr&255;return he+Ze},Se.prototype.writeIntBE=function(ae,he,Ze,kt){if(ae=+ae,he>>>=0,!kt){var Bt=Math.pow(2,8*Ze-1);qr(this,ae,he,Ze,Bt-1,-Bt)}var In=Ze-1,hr=1,kr=0;for(this[he+In]=255&ae;--In>=0&&(hr*=256);)ae<0&&0===kr&&0!==this[he+In+1]&&(kr=1),this[he+In]=(ae/hr>>0)-kr&255;return he+Ze},Se.prototype.writeInt8=function(ae,he,Ze){return ae=+ae,he>>>=0,Ze||qr(this,ae,he,1,127,-128),ae<0&&(ae=255+ae+1),this[he]=255&ae,he+1},Se.prototype.writeInt16LE=function(ae,he,Ze){return ae=+ae,he>>>=0,Ze||qr(this,ae,he,2,32767,-32768),this[he]=255&ae,this[he+1]=ae>>>8,he+2},Se.prototype.writeInt16BE=function(ae,he,Ze){return ae=+ae,he>>>=0,Ze||qr(this,ae,he,2,32767,-32768),this[he]=ae>>>8,this[he+1]=255&ae,he+2},Se.prototype.writeInt32LE=function(ae,he,Ze){return ae=+ae,he>>>=0,Ze||qr(this,ae,he,4,2147483647,-2147483648),this[he]=255&ae,this[he+1]=ae>>>8,this[he+2]=ae>>>16,this[he+3]=ae>>>24,he+4},Se.prototype.writeInt32BE=function(ae,he,Ze){return ae=+ae,he>>>=0,Ze||qr(this,ae,he,4,2147483647,-2147483648),ae<0&&(ae=4294967295+ae+1),this[he]=ae>>>24,this[he+1]=ae>>>16,this[he+2]=ae>>>8,this[he+3]=255&ae,he+4},Se.prototype.writeFloatLE=function(ae,he,Ze){return On(this,ae,he,!0,Ze)},Se.prototype.writeFloatBE=function(ae,he,Ze){return On(this,ae,he,!1,Ze)},Se.prototype.writeDoubleLE=function(ae,he,Ze){return ks(this,ae,he,!0,Ze)},Se.prototype.writeDoubleBE=function(ae,he,Ze){return ks(this,ae,he,!1,Ze)},Se.prototype.copy=function(ae,he,Ze,kt){if(!Se.isBuffer(ae))throw new TypeError("argument should be a Buffer");if(Ze||(Ze=0),!kt&&0!==kt&&(kt=this.length),he>=ae.length&&(he=ae.length),he||(he=0),kt>0&&kt<Ze&&(kt=Ze),kt===Ze||0===ae.length||0===this.length)return 0;if(he<0)throw new RangeError("targetStart out of bounds");if(Ze<0||Ze>=this.length)throw new RangeError("Index out of range");if(kt<0)throw new RangeError("sourceEnd out of bounds");kt>this.length&&(kt=this.length),ae.length-he<kt-Ze&&(kt=ae.length-he+Ze);var Bt=kt-Ze;return this===ae&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(he,Ze,kt):Uint8Array.prototype.set.call(ae,this.subarray(Ze,kt),he),Bt},Se.prototype.fill=function(ae,he,Ze,kt){if("string"==typeof ae){if("string"==typeof he?(kt=he,he=0,Ze=this.length):"string"==typeof Ze&&(kt=Ze,Ze=this.length),void 0!==kt&&"string"!=typeof kt)throw new TypeError("encoding must be a string");if("string"==typeof kt&&!Se.isEncoding(kt))throw new TypeError("Unknown encoding: "+kt);if(1===ae.length){var Bt=ae.charCodeAt(0);("utf8"===kt&&Bt<128||"latin1"===kt)&&(ae=Bt)}}else"number"==typeof ae?ae&=255:"boolean"==typeof ae&&(ae=Number(ae));if(he<0||this.length<he||this.length<Ze)throw new RangeError("Out of range index");if(Ze<=he)return this;var In;if(he>>>=0,Ze=void 0===Ze?this.length:Ze>>>0,ae||(ae=0),"number"==typeof ae)for(In=he;In<Ze;++In)this[In]=ae;else{var hr=Se.isBuffer(ae)?ae:Se.from(ae,kt),kr=hr.length;if(0===kr)throw new TypeError('The value "'+ae+'" is invalid for argument "value"');for(In=0;In<Ze-he;++In)this[In+he]=hr[In%kr]}return this};var $s=/[^+/0-9A-Za-z-_]/g;function Ce(Oe,ae){ae=ae||1/0;for(var he,Ze=Oe.length,kt=null,Bt=[],In=0;In<Ze;++In){if((he=Oe.charCodeAt(In))>55295&&he<57344){if(!kt){if(he>56319){(ae-=3)>-1&&Bt.push(239,191,189);continue}if(In+1===Ze){(ae-=3)>-1&&Bt.push(239,191,189);continue}kt=he;continue}if(he<56320){(ae-=3)>-1&&Bt.push(239,191,189),kt=he;continue}he=65536+(kt-55296<<10|he-56320)}else kt&&(ae-=3)>-1&&Bt.push(239,191,189);if(kt=null,he<128){if((ae-=1)<0)break;Bt.push(he)}else if(he<2048){if((ae-=2)<0)break;Bt.push(he>>6|192,63&he|128)}else if(he<65536){if((ae-=3)<0)break;Bt.push(he>>12|224,he>>6&63|128,63&he|128)}else{if(!(he<1114112))throw new Error("Invalid code point");if((ae-=4)<0)break;Bt.push(he>>18|240,he>>12&63|128,he>>6&63|128,63&he|128)}}return Bt}function Ht(Oe){return Ye.toByteArray(function Q(Oe){if((Oe=(Oe=Oe.split("=")[0]).trim().replace($s,"")).length<2)return"";for(;Oe.length%4!=0;)Oe+="=";return Oe}(Oe))}function ao(Oe,ae,he,Ze){for(var kt=0;kt<Ze&&!(kt+he>=ae.length||kt>=Oe.length);++kt)ae[kt+he]=Oe[kt];return kt}function Hi(Oe,ae){return Oe instanceof ae||null!=Oe&&null!=Oe.constructor&&null!=Oe.constructor.name&&Oe.constructor.name===ae.name}function Ao(Oe){return Oe!=Oe}var pi=function(){for(var Oe="0123456789abcdef",ae=new Array(256),he=0;he<16;++he)for(var Ze=16*he,kt=0;kt<16;++kt)ae[Ze+kt]=Oe[he]+Oe[kt];return ae}()},8472:function(Mn,kn){var Ue,pt="undefined"!=typeof self?self:this,Ye=function(){function Ue(){this.fetch=!1,this.DOMException=pt.DOMException}return Ue.prototype=pt,new Ue}();Ue=Ye,function(dt){var Ct_searchParams="URLSearchParams"in Ue,Ct_iterable="Symbol"in Ue&&"iterator"in Symbol,Ct_blob="FileReader"in Ue&&"Blob"in Ue&&function(){try{return new Blob,!0}catch(ct){return!1}}(),Ct_formData="FormData"in Ue,Ct_arrayBuffer="ArrayBuffer"in Ue;if(Ct_arrayBuffer)var Mt=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],$t=ArrayBuffer.isView||function(ct){return ct&&Mt.indexOf(Object.prototype.toString.call(ct))>-1};function nn(ct){if("string"!=typeof ct&&(ct=String(ct)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(ct))throw new TypeError("Invalid character in header field name");return ct.toLowerCase()}function jt(ct){return"string"!=typeof ct&&(ct=String(ct)),ct}function rt(ct){var tn={next:function(){var Pn=ct.shift();return{done:void 0===Pn,value:Pn}}};return Ct_iterable&&(tn[Symbol.iterator]=function(){return tn}),tn}function ft(ct){this.map={},ct instanceof ft?ct.forEach(function(tn,Pn){this.append(Pn,tn)},this):Array.isArray(ct)?ct.forEach(function(tn){this.append(tn[0],tn[1])},this):ct&&Object.getOwnPropertyNames(ct).forEach(function(tn){this.append(tn,ct[tn])},this)}function Rt(ct){if(ct.bodyUsed)return Promise.reject(new TypeError("Already read"));ct.bodyUsed=!0}function xn(ct){return new Promise(function(tn,Pn){ct.onload=function(){tn(ct.result)},ct.onerror=function(){Pn(ct.error)}})}function ui(ct){var tn=new FileReader,Pn=xn(tn);return tn.readAsArrayBuffer(ct),Pn}function En(ct){if(ct.slice)return ct.slice(0);var tn=new Uint8Array(ct.byteLength);return tn.set(new Uint8Array(ct)),tn.buffer}function ke(){return this.bodyUsed=!1,this._initBody=function(ct){this._bodyInit=ct,ct?"string"==typeof ct?this._bodyText=ct:Ct_blob&&Blob.prototype.isPrototypeOf(ct)?this._bodyBlob=ct:Ct_formData&&FormData.prototype.isPrototypeOf(ct)?this._bodyFormData=ct:Ct_searchParams&&URLSearchParams.prototype.isPrototypeOf(ct)?this._bodyText=ct.toString():Ct_arrayBuffer&&Ct_blob&&function Se(ct){return ct&&DataView.prototype.isPrototypeOf(ct)}(ct)?(this._bodyArrayBuffer=En(ct.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Ct_arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(ct)||$t(ct))?this._bodyArrayBuffer=En(ct):this._bodyText=ct=Object.prototype.toString.call(ct):this._bodyText="",this.headers.get("content-type")||("string"==typeof ct?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Ct_searchParams&&URLSearchParams.prototype.isPrototypeOf(ct)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Ct_blob&&(this.blob=function(){var ct=Rt(this);if(ct)return ct;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?Rt(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(ui)}),this.text=function(){var ct=Rt(this);if(ct)return ct;if(this._bodyBlob)return function Rn(ct){var tn=new FileReader,Pn=xn(tn);return tn.readAsText(ct),Pn}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function Vt(ct){for(var tn=new Uint8Array(ct),Pn=new Array(tn.length),vn=0;vn<tn.length;vn++)Pn[vn]=String.fromCharCode(tn[vn]);return Pn.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Ct_formData&&(this.formData=function(){return this.text().then(lt)}),this.json=function(){return this.text().then(JSON.parse)},this}ft.prototype.append=function(ct,tn){ct=nn(ct),tn=jt(tn);var Pn=this.map[ct];this.map[ct]=Pn?Pn+", "+tn:tn},ft.prototype.delete=function(ct){delete this.map[nn(ct)]},ft.prototype.get=function(ct){return ct=nn(ct),this.has(ct)?this.map[ct]:null},ft.prototype.has=function(ct){return this.map.hasOwnProperty(nn(ct))},ft.prototype.set=function(ct,tn){this.map[nn(ct)]=jt(tn)},ft.prototype.forEach=function(ct,tn){for(var Pn in this.map)this.map.hasOwnProperty(Pn)&&ct.call(tn,this.map[Pn],Pn,this)},ft.prototype.keys=function(){var ct=[];return this.forEach(function(tn,Pn){ct.push(Pn)}),rt(ct)},ft.prototype.values=function(){var ct=[];return this.forEach(function(tn){ct.push(tn)}),rt(ct)},ft.prototype.entries=function(){var ct=[];return this.forEach(function(tn,Pn){ct.push([Pn,tn])}),rt(ct)},Ct_iterable&&(ft.prototype[Symbol.iterator]=ft.prototype.entries);var We=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Te(ct,tn){var Pn=(tn=tn||{}).body;if(ct instanceof Te){if(ct.bodyUsed)throw new TypeError("Already read");this.url=ct.url,this.credentials=ct.credentials,tn.headers||(this.headers=new ft(ct.headers)),this.method=ct.method,this.mode=ct.mode,this.signal=ct.signal,!Pn&&null!=ct._bodyInit&&(Pn=ct._bodyInit,ct.bodyUsed=!0)}else this.url=String(ct);if(this.credentials=tn.credentials||this.credentials||"same-origin",(tn.headers||!this.headers)&&(this.headers=new ft(tn.headers)),this.method=function Ft(ct){var tn=ct.toUpperCase();return We.indexOf(tn)>-1?tn:ct}(tn.method||this.method||"GET"),this.mode=tn.mode||this.mode||null,this.signal=tn.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&Pn)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Pn)}function lt(ct){var tn=new FormData;return ct.trim().split("&").forEach(function(Pn){if(Pn){var vn=Pn.split("="),$n=vn.shift().replace(/\+/g," "),Kn=vn.join("=").replace(/\+/g," ");tn.append(decodeURIComponent($n),decodeURIComponent(Kn))}}),tn}function Ve(ct){var tn=new ft;return ct.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(vn){var $n=vn.split(":"),Kn=$n.shift().trim();if(Kn){var yi=$n.join(":").trim();tn.append(Kn,yi)}}),tn}function qe(ct,tn){tn||(tn={}),this.type="default",this.status=void 0===tn.status?200:tn.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in tn?tn.statusText:"OK",this.headers=new ft(tn.headers),this.url=tn.url||"",this._initBody(ct)}Te.prototype.clone=function(){return new Te(this,{body:this._bodyInit})},ke.call(Te.prototype),ke.call(qe.prototype),qe.prototype.clone=function(){return new qe(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new ft(this.headers),url:this.url})},qe.error=function(){var ct=new qe(null,{status:0,statusText:""});return ct.type="error",ct};var Nt=[301,302,303,307,308];qe.redirect=function(ct,tn){if(-1===Nt.indexOf(tn))throw new RangeError("Invalid status code");return new qe(null,{status:tn,headers:{location:ct}})},dt.DOMException=Ue.DOMException;try{new dt.DOMException}catch(ct){dt.DOMException=function(tn,Pn){this.message=tn,this.name=Pn;var vn=Error(tn);this.stack=vn.stack},dt.DOMException.prototype=Object.create(Error.prototype),dt.DOMException.prototype.constructor=dt.DOMException}function xt(ct,tn){return new Promise(function(Pn,vn){var $n=new Te(ct,tn);if($n.signal&&$n.signal.aborted)return vn(new dt.DOMException("Aborted","AbortError"));var Kn=new XMLHttpRequest;function yi(){Kn.abort()}Kn.onload=function(){var Wn={status:Kn.status,statusText:Kn.statusText,headers:Ve(Kn.getAllResponseHeaders()||"")};Wn.url="responseURL"in Kn?Kn.responseURL:Wn.headers.get("X-Request-URL"),Pn(new qe("response"in Kn?Kn.response:Kn.responseText,Wn))},Kn.onerror=function(){vn(new TypeError("Network request failed"))},Kn.ontimeout=function(){vn(new TypeError("Network request failed"))},Kn.onabort=function(){vn(new dt.DOMException("Aborted","AbortError"))},Kn.open($n.method,$n.url,!0),"include"===$n.credentials?Kn.withCredentials=!0:"omit"===$n.credentials&&(Kn.withCredentials=!1),"responseType"in Kn&&Ct_blob&&(Kn.responseType="blob"),$n.headers.forEach(function(Wn,br){Kn.setRequestHeader(br,Wn)}),$n.signal&&($n.signal.addEventListener("abort",yi),Kn.onreadystatechange=function(){4===Kn.readyState&&$n.signal.removeEventListener("abort",yi)}),Kn.send(void 0===$n._bodyInit?null:$n._bodyInit)})}xt.polyfill=!0,Ue.fetch||(Ue.fetch=xt,Ue.Headers=ft,Ue.Request=Te,Ue.Response=qe),dt.Headers=ft,dt.Request=Te,dt.Response=qe,dt.fetch=xt,Object.defineProperty(dt,"__esModule",{value:!0})}({}),Ye.fetch.ponyfill=!0,delete Ye.fetch.polyfill;var tt=Ye;(kn=tt.fetch).default=tt.fetch,kn.fetch=tt.fetch,kn.Headers=tt.Headers,kn.Request=tt.Request,kn.Response=tt.Response,Mn.exports=kn},6570:Mn=>{function kn(Ye){if(Ye)return function pt(Ye){for(var tt in kn.prototype)Ye[tt]=kn.prototype[tt];return Ye}(Ye)}Mn.exports=kn,kn.prototype.on=kn.prototype.addEventListener=function(Ye,tt){return this._callbacks=this._callbacks||{},(this._callbacks[Ye]=this._callbacks[Ye]||[]).push(tt),this},kn.prototype.once=function(Ye,tt){var Ue=this;function h(){Ue.off(Ye,h),tt.apply(this,arguments)}return this._callbacks=this._callbacks||{},h.fn=tt,this.on(Ye,h),this},kn.prototype.off=kn.prototype.removeListener=kn.prototype.removeAllListeners=kn.prototype.removeEventListener=function(Ye,tt){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var Ue=this._callbacks[Ye];if(!Ue)return this;if(1==arguments.length)return delete this._callbacks[Ye],this;for(var h,dt=0;dt<Ue.length;dt++)if((h=Ue[dt])===tt||h.fn===tt){Ue.splice(dt,1);break}return this},kn.prototype.emit=function(Ye){this._callbacks=this._callbacks||{};var tt=[].slice.call(arguments,1),Ue=this._callbacks[Ye];if(Ue)for(var h=0,dt=(Ue=Ue.slice(0)).length;h<dt;++h)Ue[h].apply(this,tt);return this},kn.prototype.listeners=function(Ye){return this._callbacks=this._callbacks||{},this._callbacks[Ye]||[]},kn.prototype.hasListeners=function(Ye){return!!this.listeners(Ye).length}},8461:(Mn,kn)=>{kn.read=function(pt,Ye,tt,Ue,h){var dt,Ct,Se=8*h-Ue-1,Mt=(1<<Se)-1,$t=Mt>>1,nn=-7,jt=tt?h-1:0,rt=tt?-1:1,ft=pt[Ye+jt];for(jt+=rt,dt=ft&(1<<-nn)-1,ft>>=-nn,nn+=Se;nn>0;dt=256*dt+pt[Ye+jt],jt+=rt,nn-=8);for(Ct=dt&(1<<-nn)-1,dt>>=-nn,nn+=Ue;nn>0;Ct=256*Ct+pt[Ye+jt],jt+=rt,nn-=8);if(0===dt)dt=1-$t;else{if(dt===Mt)return Ct?NaN:1/0*(ft?-1:1);Ct+=Math.pow(2,Ue),dt-=$t}return(ft?-1:1)*Ct*Math.pow(2,dt-Ue)},kn.write=function(pt,Ye,tt,Ue,h,dt){var Ct,Se,Mt,$t=8*dt-h-1,nn=(1<<$t)-1,jt=nn>>1,rt=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,ft=Ue?0:dt-1,Rt=Ue?1:-1,xn=Ye<0||0===Ye&&1/Ye<0?1:0;for(Ye=Math.abs(Ye),isNaN(Ye)||Ye===1/0?(Se=isNaN(Ye)?1:0,Ct=nn):(Ct=Math.floor(Math.log(Ye)/Math.LN2),Ye*(Mt=Math.pow(2,-Ct))<1&&(Ct--,Mt*=2),(Ye+=Ct+jt>=1?rt/Mt:rt*Math.pow(2,1-jt))*Mt>=2&&(Ct++,Mt/=2),Ct+jt>=nn?(Se=0,Ct=nn):Ct+jt>=1?(Se=(Ye*Mt-1)*Math.pow(2,h),Ct+=jt):(Se=Ye*Math.pow(2,jt-1)*Math.pow(2,h),Ct=0));h>=8;pt[tt+ft]=255&Se,ft+=Rt,Se/=256,h-=8);for(Ct=Ct<<h|Se,$t+=h;$t>0;pt[tt+ft]=255&Ct,ft+=Rt,Ct/=256,$t-=8);pt[tt+ft-Rt]|=128*xn}},9898:function(Mn){Mn.exports=function(){"use strict";var kn,pt,Ye;function tt(h,dt){if(kn)if(pt){var Ct="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+kn+")(sharedChunk); ("+pt+")(sharedChunk); self.onerror = null;",Se={};kn(Se),Ye=dt(Se),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Ye.workerUrl=window.URL.createObjectURL(new Blob([Ct],{type:"text/javascript"})))}else pt=dt;else kn=dt}return tt(0,function(h){function dt(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Ct,Se={},Mt={};function $t(){if(Ct)return Mt;Ct=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.setMatrixArrayType=function(_){Mt.ARRAY_TYPE=o=_},Mt.toRadian=function(_){return _*p},Mt.equals=function(_,f){return Math.abs(_-f)<=u*Math.max(1,Math.abs(_),Math.abs(f))},Mt.RANDOM=Mt.ARRAY_TYPE=Mt.EPSILON=void 0;var u=1e-6;Mt.EPSILON=u;var o="undefined"!=typeof Float32Array?Float32Array:Array;Mt.ARRAY_TYPE=o;var l=Math.random;Mt.RANDOM=l;var p=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var _=0,f=arguments.length;f--;)_+=arguments[f]*arguments[f];return Math.sqrt(_)}),Mt}var nn,jt={};function rt(){if(nn)return jt;function u(f){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(y){return typeof y}:function(y){return y&&"function"==typeof Symbol&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y})(f)}nn=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.create=function(){var f=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f},jt.clone=function(f){var y=new o.ARRAY_TYPE(4);return y[0]=f[0],y[1]=f[1],y[2]=f[2],y[3]=f[3],y},jt.copy=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[3],f},jt.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f},jt.fromValues=function(f,y,T,E){var P=new o.ARRAY_TYPE(4);return P[0]=f,P[1]=y,P[2]=T,P[3]=E,P},jt.set=function(f,y,T,E,P){return f[0]=y,f[1]=T,f[2]=E,f[3]=P,f},jt.transpose=function(f,y){if(f===y){var T=y[1];f[1]=y[2],f[2]=T}else f[0]=y[0],f[1]=y[2],f[2]=y[1],f[3]=y[3];return f},jt.invert=function(f,y){var T=y[0],E=y[1],P=y[2],w=y[3],I=T*w-P*E;return I?(f[0]=w*(I=1/I),f[1]=-E*I,f[2]=-P*I,f[3]=T*I,f):null},jt.adjoint=function(f,y){var T=y[0];return f[0]=y[3],f[1]=-y[1],f[2]=-y[2],f[3]=T,f},jt.determinant=function(f){return f[0]*f[3]-f[2]*f[1]},jt.multiply=p,jt.rotate=function(f,y,T){var E=y[0],P=y[1],w=y[2],I=y[3],R=Math.sin(T),D=Math.cos(T);return f[0]=E*D+w*R,f[1]=P*D+I*R,f[2]=E*-R+w*D,f[3]=P*-R+I*D,f},jt.scale=function(f,y,T){var E=y[1],P=y[2],w=y[3],I=T[0],R=T[1];return f[0]=y[0]*I,f[1]=E*I,f[2]=P*R,f[3]=w*R,f},jt.fromRotation=function(f,y){var T=Math.sin(y),E=Math.cos(y);return f[0]=E,f[1]=T,f[2]=-T,f[3]=E,f},jt.fromScaling=function(f,y){return f[0]=y[0],f[1]=0,f[2]=0,f[3]=y[1],f},jt.str=function(f){return"mat2("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"},jt.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3])},jt.LDU=function(f,y,T,E){return f[2]=E[2]/E[0],T[0]=E[0],T[1]=E[1],T[3]=E[3]-f[2]*T[1],[f,y,T]},jt.add=function(f,y,T){return f[0]=y[0]+T[0],f[1]=y[1]+T[1],f[2]=y[2]+T[2],f[3]=y[3]+T[3],f},jt.subtract=_,jt.exactEquals=function(f,y){return f[0]===y[0]&&f[1]===y[1]&&f[2]===y[2]&&f[3]===y[3]},jt.equals=function(f,y){var T=f[0],E=f[1],P=f[2],w=f[3],I=y[0],R=y[1],D=y[2],M=y[3];return Math.abs(T-I)<=o.EPSILON*Math.max(1,Math.abs(T),Math.abs(I))&&Math.abs(E-R)<=o.EPSILON*Math.max(1,Math.abs(E),Math.abs(R))&&Math.abs(P-D)<=o.EPSILON*Math.max(1,Math.abs(P),Math.abs(D))&&Math.abs(w-M)<=o.EPSILON*Math.max(1,Math.abs(w),Math.abs(M))},jt.multiplyScalar=function(f,y,T){return f[0]=y[0]*T,f[1]=y[1]*T,f[2]=y[2]*T,f[3]=y[3]*T,f},jt.multiplyScalarAndAdd=function(f,y,T,E){return f[0]=y[0]+T[0]*E,f[1]=y[1]+T[1]*E,f[2]=y[2]+T[2]*E,f[3]=y[3]+T[3]*E,f},jt.sub=jt.mul=void 0;var o=function(f,y){if(f&&f.__esModule)return f;if(null===f||"object"!==u(f)&&"function"!=typeof f)return{default:f};var T=l(void 0);if(T&&T.has(f))return T.get(f);var E={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in f)if("default"!==w&&Object.prototype.hasOwnProperty.call(f,w)){var I=P?Object.getOwnPropertyDescriptor(f,w):null;I&&(I.get||I.set)?Object.defineProperty(E,w,I):E[w]=f[w]}return E.default=f,T&&T.set(f,E),E}($t());function l(f){if("function"!=typeof WeakMap)return null;var y=new WeakMap,T=new WeakMap;return(l=function(E){return E?T:y})(f)}function p(f,y,T){var E=y[0],P=y[1],w=y[2],I=y[3],R=T[0],D=T[1],M=T[2],L=T[3];return f[0]=E*R+w*D,f[1]=P*R+I*D,f[2]=E*M+w*L,f[3]=P*M+I*L,f}function _(f,y,T){return f[0]=y[0]-T[0],f[1]=y[1]-T[1],f[2]=y[2]-T[2],f[3]=y[3]-T[3],f}return jt.mul=p,jt.sub=_,jt}var ft,Rt={};function xn(){if(ft)return Rt;function u(f){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(y){return typeof y}:function(y){return y&&"function"==typeof Symbol&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y})(f)}ft=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.create=function(){var f=new o.ARRAY_TYPE(6);return o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[4]=0,f[5]=0),f[0]=1,f[3]=1,f},Rt.clone=function(f){var y=new o.ARRAY_TYPE(6);return y[0]=f[0],y[1]=f[1],y[2]=f[2],y[3]=f[3],y[4]=f[4],y[5]=f[5],y},Rt.copy=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[3],f[4]=y[4],f[5]=y[5],f},Rt.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=0,f[5]=0,f},Rt.fromValues=function(f,y,T,E,P,w){var I=new o.ARRAY_TYPE(6);return I[0]=f,I[1]=y,I[2]=T,I[3]=E,I[4]=P,I[5]=w,I},Rt.set=function(f,y,T,E,P,w,I){return f[0]=y,f[1]=T,f[2]=E,f[3]=P,f[4]=w,f[5]=I,f},Rt.invert=function(f,y){var T=y[0],E=y[1],P=y[2],w=y[3],I=y[4],R=y[5],D=T*w-E*P;return D?(f[0]=w*(D=1/D),f[1]=-E*D,f[2]=-P*D,f[3]=T*D,f[4]=(P*R-w*I)*D,f[5]=(E*I-T*R)*D,f):null},Rt.determinant=function(f){return f[0]*f[3]-f[1]*f[2]},Rt.multiply=p,Rt.rotate=function(f,y,T){var E=y[0],P=y[1],w=y[2],I=y[3],R=y[4],D=y[5],M=Math.sin(T),L=Math.cos(T);return f[0]=E*L+w*M,f[1]=P*L+I*M,f[2]=E*-M+w*L,f[3]=P*-M+I*L,f[4]=R,f[5]=D,f},Rt.scale=function(f,y,T){var E=y[1],P=y[2],w=y[3],I=y[4],R=y[5],D=T[0],M=T[1];return f[0]=y[0]*D,f[1]=E*D,f[2]=P*M,f[3]=w*M,f[4]=I,f[5]=R,f},Rt.translate=function(f,y,T){var E=y[0],P=y[1],w=y[2],I=y[3],R=y[4],D=y[5],M=T[0],L=T[1];return f[0]=E,f[1]=P,f[2]=w,f[3]=I,f[4]=E*M+w*L+R,f[5]=P*M+I*L+D,f},Rt.fromRotation=function(f,y){var T=Math.sin(y),E=Math.cos(y);return f[0]=E,f[1]=T,f[2]=-T,f[3]=E,f[4]=0,f[5]=0,f},Rt.fromScaling=function(f,y){return f[0]=y[0],f[1]=0,f[2]=0,f[3]=y[1],f[4]=0,f[5]=0,f},Rt.fromTranslation=function(f,y){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=y[0],f[5]=y[1],f},Rt.str=function(f){return"mat2d("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+")"},Rt.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],1)},Rt.add=function(f,y,T){return f[0]=y[0]+T[0],f[1]=y[1]+T[1],f[2]=y[2]+T[2],f[3]=y[3]+T[3],f[4]=y[4]+T[4],f[5]=y[5]+T[5],f},Rt.subtract=_,Rt.multiplyScalar=function(f,y,T){return f[0]=y[0]*T,f[1]=y[1]*T,f[2]=y[2]*T,f[3]=y[3]*T,f[4]=y[4]*T,f[5]=y[5]*T,f},Rt.multiplyScalarAndAdd=function(f,y,T,E){return f[0]=y[0]+T[0]*E,f[1]=y[1]+T[1]*E,f[2]=y[2]+T[2]*E,f[3]=y[3]+T[3]*E,f[4]=y[4]+T[4]*E,f[5]=y[5]+T[5]*E,f},Rt.exactEquals=function(f,y){return f[0]===y[0]&&f[1]===y[1]&&f[2]===y[2]&&f[3]===y[3]&&f[4]===y[4]&&f[5]===y[5]},Rt.equals=function(f,y){var T=f[0],E=f[1],P=f[2],w=f[3],I=f[4],R=f[5],D=y[0],M=y[1],L=y[2],V=y[3],j=y[4],G=y[5];return Math.abs(T-D)<=o.EPSILON*Math.max(1,Math.abs(T),Math.abs(D))&&Math.abs(E-M)<=o.EPSILON*Math.max(1,Math.abs(E),Math.abs(M))&&Math.abs(P-L)<=o.EPSILON*Math.max(1,Math.abs(P),Math.abs(L))&&Math.abs(w-V)<=o.EPSILON*Math.max(1,Math.abs(w),Math.abs(V))&&Math.abs(I-j)<=o.EPSILON*Math.max(1,Math.abs(I),Math.abs(j))&&Math.abs(R-G)<=o.EPSILON*Math.max(1,Math.abs(R),Math.abs(G))},Rt.sub=Rt.mul=void 0;var o=function(f,y){if(f&&f.__esModule)return f;if(null===f||"object"!==u(f)&&"function"!=typeof f)return{default:f};var T=l(void 0);if(T&&T.has(f))return T.get(f);var E={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in f)if("default"!==w&&Object.prototype.hasOwnProperty.call(f,w)){var I=P?Object.getOwnPropertyDescriptor(f,w):null;I&&(I.get||I.set)?Object.defineProperty(E,w,I):E[w]=f[w]}return E.default=f,T&&T.set(f,E),E}($t());function l(f){if("function"!=typeof WeakMap)return null;var y=new WeakMap,T=new WeakMap;return(l=function(E){return E?T:y})(f)}function p(f,y,T){var E=y[0],P=y[1],w=y[2],I=y[3],R=y[4],D=y[5],M=T[0],L=T[1],V=T[2],j=T[3],G=T[4],$=T[5];return f[0]=E*M+w*L,f[1]=P*M+I*L,f[2]=E*V+w*j,f[3]=P*V+I*j,f[4]=E*G+w*$+R,f[5]=P*G+I*$+D,f}function _(f,y,T){return f[0]=y[0]-T[0],f[1]=y[1]-T[1],f[2]=y[2]-T[2],f[3]=y[3]-T[3],f[4]=y[4]-T[4],f[5]=y[5]-T[5],f}return Rt.mul=p,Rt.sub=_,Rt}var ui,Rn={};function Vt(){if(ui)return Rn;function u(f){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(y){return typeof y}:function(y){return y&&"function"==typeof Symbol&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y})(f)}ui=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.create=function(){var f=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f},Rn.fromMat4=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[4],f[4]=y[5],f[5]=y[6],f[6]=y[8],f[7]=y[9],f[8]=y[10],f},Rn.clone=function(f){var y=new o.ARRAY_TYPE(9);return y[0]=f[0],y[1]=f[1],y[2]=f[2],y[3]=f[3],y[4]=f[4],y[5]=f[5],y[6]=f[6],y[7]=f[7],y[8]=f[8],y},Rn.copy=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[3],f[4]=y[4],f[5]=y[5],f[6]=y[6],f[7]=y[7],f[8]=y[8],f},Rn.fromValues=function(f,y,T,E,P,w,I,R,D){var M=new o.ARRAY_TYPE(9);return M[0]=f,M[1]=y,M[2]=T,M[3]=E,M[4]=P,M[5]=w,M[6]=I,M[7]=R,M[8]=D,M},Rn.set=function(f,y,T,E,P,w,I,R,D,M){return f[0]=y,f[1]=T,f[2]=E,f[3]=P,f[4]=w,f[5]=I,f[6]=R,f[7]=D,f[8]=M,f},Rn.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},Rn.transpose=function(f,y){if(f===y){var T=y[1],E=y[2],P=y[5];f[1]=y[3],f[2]=y[6],f[3]=T,f[5]=y[7],f[6]=E,f[7]=P}else f[0]=y[0],f[1]=y[3],f[2]=y[6],f[3]=y[1],f[4]=y[4],f[5]=y[7],f[6]=y[2],f[7]=y[5],f[8]=y[8];return f},Rn.invert=function(f,y){var T=y[0],E=y[1],P=y[2],w=y[3],I=y[4],R=y[5],D=y[6],M=y[7],L=y[8],V=L*I-R*M,j=-L*w+R*D,G=M*w-I*D,$=T*V+E*j+P*G;return $?(f[0]=V*($=1/$),f[1]=(-L*E+P*M)*$,f[2]=(R*E-P*I)*$,f[3]=j*$,f[4]=(L*T-P*D)*$,f[5]=(-R*T+P*w)*$,f[6]=G*$,f[7]=(-M*T+E*D)*$,f[8]=(I*T-E*w)*$,f):null},Rn.adjoint=function(f,y){var T=y[0],E=y[1],P=y[2],w=y[3],I=y[4],R=y[5],D=y[6],M=y[7],L=y[8];return f[0]=I*L-R*M,f[1]=P*M-E*L,f[2]=E*R-P*I,f[3]=R*D-w*L,f[4]=T*L-P*D,f[5]=P*w-T*R,f[6]=w*M-I*D,f[7]=E*D-T*M,f[8]=T*I-E*w,f},Rn.determinant=function(f){var y=f[3],T=f[4],E=f[5],P=f[6],w=f[7],I=f[8];return f[0]*(I*T-E*w)+f[1]*(-I*y+E*P)+f[2]*(w*y-T*P)},Rn.multiply=p,Rn.translate=function(f,y,T){var E=y[0],P=y[1],w=y[2],I=y[3],R=y[4],D=y[5],M=y[6],L=y[7],V=y[8],j=T[0],G=T[1];return f[0]=E,f[1]=P,f[2]=w,f[3]=I,f[4]=R,f[5]=D,f[6]=j*E+G*I+M,f[7]=j*P+G*R+L,f[8]=j*w+G*D+V,f},Rn.rotate=function(f,y,T){var E=y[0],P=y[1],w=y[2],I=y[3],R=y[4],D=y[5],M=y[6],L=y[7],V=y[8],j=Math.sin(T),G=Math.cos(T);return f[0]=G*E+j*I,f[1]=G*P+j*R,f[2]=G*w+j*D,f[3]=G*I-j*E,f[4]=G*R-j*P,f[5]=G*D-j*w,f[6]=M,f[7]=L,f[8]=V,f},Rn.scale=function(f,y,T){var E=T[0],P=T[1];return f[0]=E*y[0],f[1]=E*y[1],f[2]=E*y[2],f[3]=P*y[3],f[4]=P*y[4],f[5]=P*y[5],f[6]=y[6],f[7]=y[7],f[8]=y[8],f},Rn.fromTranslation=function(f,y){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=y[0],f[7]=y[1],f[8]=1,f},Rn.fromRotation=function(f,y){var T=Math.sin(y),E=Math.cos(y);return f[0]=E,f[1]=T,f[2]=0,f[3]=-T,f[4]=E,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},Rn.fromScaling=function(f,y){return f[0]=y[0],f[1]=0,f[2]=0,f[3]=0,f[4]=y[1],f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},Rn.fromMat2d=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=0,f[3]=y[2],f[4]=y[3],f[5]=0,f[6]=y[4],f[7]=y[5],f[8]=1,f},Rn.fromQuat=function(f,y){var T=y[0],E=y[1],P=y[2],w=y[3],I=T+T,R=E+E,D=P+P,M=T*I,L=E*I,V=E*R,j=P*I,G=P*R,$=P*D,H=w*I,Y=w*R,J=w*D;return f[0]=1-V-$,f[3]=L-J,f[6]=j+Y,f[1]=L+J,f[4]=1-M-$,f[7]=G-H,f[2]=j-Y,f[5]=G+H,f[8]=1-M-V,f},Rn.normalFromMat4=function(f,y){var T=y[0],E=y[1],P=y[2],w=y[3],I=y[4],R=y[5],D=y[6],M=y[7],L=y[8],V=y[9],j=y[10],G=y[11],$=y[12],H=y[13],Y=y[14],J=y[15],ce=T*R-E*I,we=T*D-P*I,_e=T*M-w*I,be=E*D-P*R,Z=E*M-w*R,de=P*M-w*D,De=L*H-V*$,Be=L*Y-j*$,je=L*J-G*$,Xe=V*Y-j*H,it=V*J-G*H,at=j*J-G*Y,et=ce*at-we*it+_e*Xe+be*je-Z*Be+de*De;return et?(f[0]=(R*at-D*it+M*Xe)*(et=1/et),f[1]=(D*je-I*at-M*Be)*et,f[2]=(I*it-R*je+M*De)*et,f[3]=(P*it-E*at-w*Xe)*et,f[4]=(T*at-P*je+w*Be)*et,f[5]=(E*je-T*it-w*De)*et,f[6]=(H*de-Y*Z+J*be)*et,f[7]=(Y*_e-$*de-J*we)*et,f[8]=($*Z-H*_e+J*ce)*et,f):null},Rn.projection=function(f,y,T){return f[0]=2/y,f[1]=0,f[2]=0,f[3]=0,f[4]=-2/T,f[5]=0,f[6]=-1,f[7]=1,f[8]=1,f},Rn.str=function(f){return"mat3("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+")"},Rn.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8])},Rn.add=function(f,y,T){return f[0]=y[0]+T[0],f[1]=y[1]+T[1],f[2]=y[2]+T[2],f[3]=y[3]+T[3],f[4]=y[4]+T[4],f[5]=y[5]+T[5],f[6]=y[6]+T[6],f[7]=y[7]+T[7],f[8]=y[8]+T[8],f},Rn.subtract=_,Rn.multiplyScalar=function(f,y,T){return f[0]=y[0]*T,f[1]=y[1]*T,f[2]=y[2]*T,f[3]=y[3]*T,f[4]=y[4]*T,f[5]=y[5]*T,f[6]=y[6]*T,f[7]=y[7]*T,f[8]=y[8]*T,f},Rn.multiplyScalarAndAdd=function(f,y,T,E){return f[0]=y[0]+T[0]*E,f[1]=y[1]+T[1]*E,f[2]=y[2]+T[2]*E,f[3]=y[3]+T[3]*E,f[4]=y[4]+T[4]*E,f[5]=y[5]+T[5]*E,f[6]=y[6]+T[6]*E,f[7]=y[7]+T[7]*E,f[8]=y[8]+T[8]*E,f},Rn.exactEquals=function(f,y){return f[0]===y[0]&&f[1]===y[1]&&f[2]===y[2]&&f[3]===y[3]&&f[4]===y[4]&&f[5]===y[5]&&f[6]===y[6]&&f[7]===y[7]&&f[8]===y[8]},Rn.equals=function(f,y){var T=f[0],E=f[1],P=f[2],w=f[3],I=f[4],R=f[5],D=f[6],M=f[7],L=f[8],V=y[0],j=y[1],G=y[2],$=y[3],H=y[4],Y=y[5],J=y[6],ce=y[7],we=y[8];return Math.abs(T-V)<=o.EPSILON*Math.max(1,Math.abs(T),Math.abs(V))&&Math.abs(E-j)<=o.EPSILON*Math.max(1,Math.abs(E),Math.abs(j))&&Math.abs(P-G)<=o.EPSILON*Math.max(1,Math.abs(P),Math.abs(G))&&Math.abs(w-$)<=o.EPSILON*Math.max(1,Math.abs(w),Math.abs($))&&Math.abs(I-H)<=o.EPSILON*Math.max(1,Math.abs(I),Math.abs(H))&&Math.abs(R-Y)<=o.EPSILON*Math.max(1,Math.abs(R),Math.abs(Y))&&Math.abs(D-J)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(J))&&Math.abs(M-ce)<=o.EPSILON*Math.max(1,Math.abs(M),Math.abs(ce))&&Math.abs(L-we)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(we))},Rn.sub=Rn.mul=void 0;var o=function(f,y){if(f&&f.__esModule)return f;if(null===f||"object"!==u(f)&&"function"!=typeof f)return{default:f};var T=l(void 0);if(T&&T.has(f))return T.get(f);var E={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in f)if("default"!==w&&Object.prototype.hasOwnProperty.call(f,w)){var I=P?Object.getOwnPropertyDescriptor(f,w):null;I&&(I.get||I.set)?Object.defineProperty(E,w,I):E[w]=f[w]}return E.default=f,T&&T.set(f,E),E}($t());function l(f){if("function"!=typeof WeakMap)return null;var y=new WeakMap,T=new WeakMap;return(l=function(E){return E?T:y})(f)}function p(f,y,T){var E=y[0],P=y[1],w=y[2],I=y[3],R=y[4],D=y[5],M=y[6],L=y[7],V=y[8],j=T[0],G=T[1],$=T[2],H=T[3],Y=T[4],J=T[5],ce=T[6],we=T[7],_e=T[8];return f[0]=j*E+G*I+$*M,f[1]=j*P+G*R+$*L,f[2]=j*w+G*D+$*V,f[3]=H*E+Y*I+J*M,f[4]=H*P+Y*R+J*L,f[5]=H*w+Y*D+J*V,f[6]=ce*E+we*I+_e*M,f[7]=ce*P+we*R+_e*L,f[8]=ce*w+we*D+_e*V,f}function _(f,y,T){return f[0]=y[0]-T[0],f[1]=y[1]-T[1],f[2]=y[2]-T[2],f[3]=y[3]-T[3],f[4]=y[4]-T[4],f[5]=y[5]-T[5],f[6]=y[6]-T[6],f[7]=y[7]-T[7],f[8]=y[8]-T[8],f}return Rn.mul=p,Rn.sub=_,Rn}var En,ke={};function We(){if(En)return ke;function u(w){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"==typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I})(w)}En=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.create=function(){var w=new o.ARRAY_TYPE(16);return o.ARRAY_TYPE!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0),w[0]=1,w[5]=1,w[10]=1,w[15]=1,w},ke.clone=function(w){var I=new o.ARRAY_TYPE(16);return I[0]=w[0],I[1]=w[1],I[2]=w[2],I[3]=w[3],I[4]=w[4],I[5]=w[5],I[6]=w[6],I[7]=w[7],I[8]=w[8],I[9]=w[9],I[10]=w[10],I[11]=w[11],I[12]=w[12],I[13]=w[13],I[14]=w[14],I[15]=w[15],I},ke.copy=function(w,I){return w[0]=I[0],w[1]=I[1],w[2]=I[2],w[3]=I[3],w[4]=I[4],w[5]=I[5],w[6]=I[6],w[7]=I[7],w[8]=I[8],w[9]=I[9],w[10]=I[10],w[11]=I[11],w[12]=I[12],w[13]=I[13],w[14]=I[14],w[15]=I[15],w},ke.fromValues=function(w,I,R,D,M,L,V,j,G,$,H,Y,J,ce,we,_e){var be=new o.ARRAY_TYPE(16);return be[0]=w,be[1]=I,be[2]=R,be[3]=D,be[4]=M,be[5]=L,be[6]=V,be[7]=j,be[8]=G,be[9]=$,be[10]=H,be[11]=Y,be[12]=J,be[13]=ce,be[14]=we,be[15]=_e,be},ke.set=function(w,I,R,D,M,L,V,j,G,$,H,Y,J,ce,we,_e,be){return w[0]=I,w[1]=R,w[2]=D,w[3]=M,w[4]=L,w[5]=V,w[6]=j,w[7]=G,w[8]=$,w[9]=H,w[10]=Y,w[11]=J,w[12]=ce,w[13]=we,w[14]=_e,w[15]=be,w},ke.identity=p,ke.transpose=function(w,I){if(w===I){var R=I[1],D=I[2],M=I[3],L=I[6],V=I[7],j=I[11];w[1]=I[4],w[2]=I[8],w[3]=I[12],w[4]=R,w[6]=I[9],w[7]=I[13],w[8]=D,w[9]=L,w[11]=I[14],w[12]=M,w[13]=V,w[14]=j}else w[0]=I[0],w[1]=I[4],w[2]=I[8],w[3]=I[12],w[4]=I[1],w[5]=I[5],w[6]=I[9],w[7]=I[13],w[8]=I[2],w[9]=I[6],w[10]=I[10],w[11]=I[14],w[12]=I[3],w[13]=I[7],w[14]=I[11],w[15]=I[15];return w},ke.invert=function(w,I){var R=I[0],D=I[1],M=I[2],L=I[3],V=I[4],j=I[5],G=I[6],$=I[7],H=I[8],Y=I[9],J=I[10],ce=I[11],we=I[12],_e=I[13],be=I[14],Z=I[15],de=R*j-D*V,De=R*G-M*V,Be=R*$-L*V,je=D*G-M*j,Xe=D*$-L*j,it=M*$-L*G,at=H*_e-Y*we,et=H*be-J*we,It=H*Z-ce*we,Xt=Y*be-J*_e,vt=Y*Z-ce*_e,yn=J*Z-ce*be,ln=de*yn-De*vt+Be*Xt+je*It-Xe*et+it*at;return ln?(w[0]=(j*yn-G*vt+$*Xt)*(ln=1/ln),w[1]=(M*vt-D*yn-L*Xt)*ln,w[2]=(_e*it-be*Xe+Z*je)*ln,w[3]=(J*Xe-Y*it-ce*je)*ln,w[4]=(G*It-V*yn-$*et)*ln,w[5]=(R*yn-M*It+L*et)*ln,w[6]=(be*Be-we*it-Z*De)*ln,w[7]=(H*it-J*Be+ce*De)*ln,w[8]=(V*vt-j*It+$*at)*ln,w[9]=(D*It-R*vt-L*at)*ln,w[10]=(we*Xe-_e*Be+Z*de)*ln,w[11]=(Y*Be-H*Xe-ce*de)*ln,w[12]=(j*et-V*Xt-G*at)*ln,w[13]=(R*Xt-D*et+M*at)*ln,w[14]=(_e*De-we*je-be*de)*ln,w[15]=(H*je-Y*De+J*de)*ln,w):null},ke.adjoint=function(w,I){var R=I[0],D=I[1],M=I[2],L=I[3],V=I[4],j=I[5],G=I[6],$=I[7],H=I[8],Y=I[9],J=I[10],ce=I[11],we=I[12],_e=I[13],be=I[14],Z=I[15];return w[0]=j*(J*Z-ce*be)-Y*(G*Z-$*be)+_e*(G*ce-$*J),w[1]=-(D*(J*Z-ce*be)-Y*(M*Z-L*be)+_e*(M*ce-L*J)),w[2]=D*(G*Z-$*be)-j*(M*Z-L*be)+_e*(M*$-L*G),w[3]=-(D*(G*ce-$*J)-j*(M*ce-L*J)+Y*(M*$-L*G)),w[4]=-(V*(J*Z-ce*be)-H*(G*Z-$*be)+we*(G*ce-$*J)),w[5]=R*(J*Z-ce*be)-H*(M*Z-L*be)+we*(M*ce-L*J),w[6]=-(R*(G*Z-$*be)-V*(M*Z-L*be)+we*(M*$-L*G)),w[7]=R*(G*ce-$*J)-V*(M*ce-L*J)+H*(M*$-L*G),w[8]=V*(Y*Z-ce*_e)-H*(j*Z-$*_e)+we*(j*ce-$*Y),w[9]=-(R*(Y*Z-ce*_e)-H*(D*Z-L*_e)+we*(D*ce-L*Y)),w[10]=R*(j*Z-$*_e)-V*(D*Z-L*_e)+we*(D*$-L*j),w[11]=-(R*(j*ce-$*Y)-V*(D*ce-L*Y)+H*(D*$-L*j)),w[12]=-(V*(Y*be-J*_e)-H*(j*be-G*_e)+we*(j*J-G*Y)),w[13]=R*(Y*be-J*_e)-H*(D*be-M*_e)+we*(D*J-M*Y),w[14]=-(R*(j*be-G*_e)-V*(D*be-M*_e)+we*(D*G-M*j)),w[15]=R*(j*J-G*Y)-V*(D*J-M*Y)+H*(D*G-M*j),w},ke.determinant=function(w){var I=w[0],R=w[1],D=w[2],M=w[3],L=w[4],V=w[5],j=w[6],G=w[7],$=w[8],H=w[9],Y=w[10],J=w[11],ce=w[12],we=w[13],_e=w[14],be=w[15];return(I*V-R*L)*(Y*be-J*_e)-(I*j-D*L)*(H*be-J*we)+(I*G-M*L)*(H*_e-Y*we)+(R*j-D*V)*($*be-J*ce)-(R*G-M*V)*($*_e-Y*ce)+(D*G-M*j)*($*we-H*ce)},ke.multiply=_,ke.translate=function(w,I,R){var D,M,L,V,j,G,$,H,Y,J,ce,we,_e=R[0],be=R[1],Z=R[2];return I===w?(w[12]=I[0]*_e+I[4]*be+I[8]*Z+I[12],w[13]=I[1]*_e+I[5]*be+I[9]*Z+I[13],w[14]=I[2]*_e+I[6]*be+I[10]*Z+I[14],w[15]=I[3]*_e+I[7]*be+I[11]*Z+I[15]):(M=I[1],L=I[2],V=I[3],j=I[4],G=I[5],$=I[6],H=I[7],Y=I[8],J=I[9],ce=I[10],we=I[11],w[0]=D=I[0],w[1]=M,w[2]=L,w[3]=V,w[4]=j,w[5]=G,w[6]=$,w[7]=H,w[8]=Y,w[9]=J,w[10]=ce,w[11]=we,w[12]=D*_e+j*be+Y*Z+I[12],w[13]=M*_e+G*be+J*Z+I[13],w[14]=L*_e+$*be+ce*Z+I[14],w[15]=V*_e+H*be+we*Z+I[15]),w},ke.scale=function(w,I,R){var D=R[0],M=R[1],L=R[2];return w[0]=I[0]*D,w[1]=I[1]*D,w[2]=I[2]*D,w[3]=I[3]*D,w[4]=I[4]*M,w[5]=I[5]*M,w[6]=I[6]*M,w[7]=I[7]*M,w[8]=I[8]*L,w[9]=I[9]*L,w[10]=I[10]*L,w[11]=I[11]*L,w[12]=I[12],w[13]=I[13],w[14]=I[14],w[15]=I[15],w},ke.rotate=function(w,I,R,D){var M,L,V,j,G,$,H,Y,J,ce,we,_e,be,Z,de,De,Be,je,Xe,it,at,et,It,Xt,vt=D[0],yn=D[1],ln=D[2],Kt=Math.hypot(vt,yn,ln);return Kt<o.EPSILON?null:(vt*=Kt=1/Kt,yn*=Kt,ln*=Kt,M=Math.sin(R),L=Math.cos(R),G=I[1],$=I[2],H=I[3],J=I[5],ce=I[6],we=I[7],be=I[9],Z=I[10],de=I[11],De=vt*vt*(V=1-L)+L,Xe=vt*yn*V-ln*M,it=yn*yn*V+L,at=ln*yn*V+vt*M,et=vt*ln*V+yn*M,It=yn*ln*V-vt*M,Xt=ln*ln*V+L,w[0]=(j=I[0])*De+(Y=I[4])*(Be=yn*vt*V+ln*M)+(_e=I[8])*(je=ln*vt*V-yn*M),w[1]=G*De+J*Be+be*je,w[2]=$*De+ce*Be+Z*je,w[3]=H*De+we*Be+de*je,w[4]=j*Xe+Y*it+_e*at,w[5]=G*Xe+J*it+be*at,w[6]=$*Xe+ce*it+Z*at,w[7]=H*Xe+we*it+de*at,w[8]=j*et+Y*It+_e*Xt,w[9]=G*et+J*It+be*Xt,w[10]=$*et+ce*It+Z*Xt,w[11]=H*et+we*It+de*Xt,I!==w&&(w[12]=I[12],w[13]=I[13],w[14]=I[14],w[15]=I[15]),w)},ke.rotateX=function(w,I,R){var D=Math.sin(R),M=Math.cos(R),L=I[4],V=I[5],j=I[6],G=I[7],$=I[8],H=I[9],Y=I[10],J=I[11];return I!==w&&(w[0]=I[0],w[1]=I[1],w[2]=I[2],w[3]=I[3],w[12]=I[12],w[13]=I[13],w[14]=I[14],w[15]=I[15]),w[4]=L*M+$*D,w[5]=V*M+H*D,w[6]=j*M+Y*D,w[7]=G*M+J*D,w[8]=$*M-L*D,w[9]=H*M-V*D,w[10]=Y*M-j*D,w[11]=J*M-G*D,w},ke.rotateY=function(w,I,R){var D=Math.sin(R),M=Math.cos(R),L=I[0],V=I[1],j=I[2],G=I[3],$=I[8],H=I[9],Y=I[10],J=I[11];return I!==w&&(w[4]=I[4],w[5]=I[5],w[6]=I[6],w[7]=I[7],w[12]=I[12],w[13]=I[13],w[14]=I[14],w[15]=I[15]),w[0]=L*M-$*D,w[1]=V*M-H*D,w[2]=j*M-Y*D,w[3]=G*M-J*D,w[8]=L*D+$*M,w[9]=V*D+H*M,w[10]=j*D+Y*M,w[11]=G*D+J*M,w},ke.rotateZ=function(w,I,R){var D=Math.sin(R),M=Math.cos(R),L=I[0],V=I[1],j=I[2],G=I[3],$=I[4],H=I[5],Y=I[6],J=I[7];return I!==w&&(w[8]=I[8],w[9]=I[9],w[10]=I[10],w[11]=I[11],w[12]=I[12],w[13]=I[13],w[14]=I[14],w[15]=I[15]),w[0]=L*M+$*D,w[1]=V*M+H*D,w[2]=j*M+Y*D,w[3]=G*M+J*D,w[4]=$*M-L*D,w[5]=H*M-V*D,w[6]=Y*M-j*D,w[7]=J*M-G*D,w},ke.fromTranslation=function(w,I){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=I[0],w[13]=I[1],w[14]=I[2],w[15]=1,w},ke.fromScaling=function(w,I){return w[0]=I[0],w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=I[1],w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=I[2],w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},ke.fromRotation=function(w,I,R){var D,M,L,V=R[0],j=R[1],G=R[2],$=Math.hypot(V,j,G);return $<o.EPSILON?null:(V*=$=1/$,j*=$,G*=$,D=Math.sin(I),M=Math.cos(I),w[0]=V*V*(L=1-M)+M,w[1]=j*V*L+G*D,w[2]=G*V*L-j*D,w[3]=0,w[4]=V*j*L-G*D,w[5]=j*j*L+M,w[6]=G*j*L+V*D,w[7]=0,w[8]=V*G*L+j*D,w[9]=j*G*L-V*D,w[10]=G*G*L+M,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w)},ke.fromXRotation=function(w,I){var R=Math.sin(I),D=Math.cos(I);return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=D,w[6]=R,w[7]=0,w[8]=0,w[9]=-R,w[10]=D,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},ke.fromYRotation=function(w,I){var R=Math.sin(I),D=Math.cos(I);return w[0]=D,w[1]=0,w[2]=-R,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=R,w[9]=0,w[10]=D,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},ke.fromZRotation=function(w,I){var R=Math.sin(I),D=Math.cos(I);return w[0]=D,w[1]=R,w[2]=0,w[3]=0,w[4]=-R,w[5]=D,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},ke.fromRotationTranslation=f,ke.fromQuat2=function(w,I){var R=new o.ARRAY_TYPE(3),D=-I[0],M=-I[1],L=-I[2],V=I[3],j=I[4],G=I[5],$=I[6],H=I[7],Y=D*D+M*M+L*L+V*V;return Y>0?(R[0]=2*(j*V+H*D+G*L-$*M)/Y,R[1]=2*(G*V+H*M+$*D-j*L)/Y,R[2]=2*($*V+H*L+j*M-G*D)/Y):(R[0]=2*(j*V+H*D+G*L-$*M),R[1]=2*(G*V+H*M+$*D-j*L),R[2]=2*($*V+H*L+j*M-G*D)),f(w,I,R),w},ke.getTranslation=function(w,I){return w[0]=I[12],w[1]=I[13],w[2]=I[14],w},ke.getScaling=y,ke.getRotation=function(w,I){var R=new o.ARRAY_TYPE(3);y(R,I);var D=1/R[0],M=1/R[1],L=1/R[2],V=I[0]*D,j=I[1]*M,G=I[2]*L,$=I[4]*D,H=I[5]*M,Y=I[6]*L,J=I[8]*D,ce=I[9]*M,we=I[10]*L,_e=V+H+we,be=0;return _e>0?(be=2*Math.sqrt(_e+1),w[3]=.25*be,w[0]=(Y-ce)/be,w[1]=(J-G)/be,w[2]=(j-$)/be):V>H&&V>we?(be=2*Math.sqrt(1+V-H-we),w[3]=(Y-ce)/be,w[0]=.25*be,w[1]=(j+$)/be,w[2]=(J+G)/be):H>we?(be=2*Math.sqrt(1+H-V-we),w[3]=(J-G)/be,w[0]=(j+$)/be,w[1]=.25*be,w[2]=(Y+ce)/be):(be=2*Math.sqrt(1+we-V-H),w[3]=(j-$)/be,w[0]=(J+G)/be,w[1]=(Y+ce)/be,w[2]=.25*be),w},ke.fromRotationTranslationScale=function(w,I,R,D){var M=I[0],L=I[1],V=I[2],j=I[3],G=M+M,$=L+L,H=V+V,Y=M*G,J=M*$,ce=M*H,we=L*$,_e=L*H,be=V*H,Z=j*G,de=j*$,De=j*H,Be=D[0],je=D[1],Xe=D[2];return w[0]=(1-(we+be))*Be,w[1]=(J+De)*Be,w[2]=(ce-de)*Be,w[3]=0,w[4]=(J-De)*je,w[5]=(1-(Y+be))*je,w[6]=(_e+Z)*je,w[7]=0,w[8]=(ce+de)*Xe,w[9]=(_e-Z)*Xe,w[10]=(1-(Y+we))*Xe,w[11]=0,w[12]=R[0],w[13]=R[1],w[14]=R[2],w[15]=1,w},ke.fromRotationTranslationScaleOrigin=function(w,I,R,D,M){var L=I[0],V=I[1],j=I[2],G=I[3],$=L+L,H=V+V,Y=j+j,J=L*$,ce=L*H,we=L*Y,_e=V*H,be=V*Y,Z=j*Y,de=G*$,De=G*H,Be=G*Y,je=D[0],Xe=D[1],it=D[2],at=M[0],et=M[1],It=M[2],Xt=(1-(_e+Z))*je,vt=(ce+Be)*je,yn=(we-De)*je,ln=(ce-Be)*Xe,Kt=(1-(J+Z))*Xe,Gt=(be+de)*Xe,Hn=(we+De)*it,gn=(be-de)*it,Dn=(1-(J+_e))*it;return w[0]=Xt,w[1]=vt,w[2]=yn,w[3]=0,w[4]=ln,w[5]=Kt,w[6]=Gt,w[7]=0,w[8]=Hn,w[9]=gn,w[10]=Dn,w[11]=0,w[12]=R[0]+at-(Xt*at+ln*et+Hn*It),w[13]=R[1]+et-(vt*at+Kt*et+gn*It),w[14]=R[2]+It-(yn*at+Gt*et+Dn*It),w[15]=1,w},ke.fromQuat=function(w,I){var R=I[0],D=I[1],M=I[2],L=I[3],V=R+R,j=D+D,G=M+M,$=R*V,H=D*V,Y=D*j,J=M*V,ce=M*j,we=M*G,_e=L*V,be=L*j,Z=L*G;return w[0]=1-Y-we,w[1]=H+Z,w[2]=J-be,w[3]=0,w[4]=H-Z,w[5]=1-$-we,w[6]=ce+_e,w[7]=0,w[8]=J+be,w[9]=ce-_e,w[10]=1-$-Y,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},ke.frustum=function(w,I,R,D,M,L,V){var j=1/(R-I),G=1/(M-D),$=1/(L-V);return w[0]=2*L*j,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=2*L*G,w[6]=0,w[7]=0,w[8]=(R+I)*j,w[9]=(M+D)*G,w[10]=(V+L)*$,w[11]=-1,w[12]=0,w[13]=0,w[14]=V*L*2*$,w[15]=0,w},ke.perspectiveNO=T,ke.perspectiveZO=function(w,I,R,D,M){var L,V=1/Math.tan(I/2);return w[0]=V/R,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=V,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,null!=M&&M!==1/0?(w[10]=M*(L=1/(D-M)),w[14]=M*D*L):(w[10]=-1,w[14]=-D),w},ke.perspectiveFromFieldOfView=function(w,I,R,D){var M=Math.tan(I.upDegrees*Math.PI/180),L=Math.tan(I.downDegrees*Math.PI/180),V=Math.tan(I.leftDegrees*Math.PI/180),j=Math.tan(I.rightDegrees*Math.PI/180),G=2/(V+j),$=2/(M+L);return w[0]=G,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=$,w[6]=0,w[7]=0,w[8]=-(V-j)*G*.5,w[9]=(M-L)*$*.5,w[10]=D/(R-D),w[11]=-1,w[12]=0,w[13]=0,w[14]=D*R/(R-D),w[15]=0,w},ke.orthoNO=E,ke.orthoZO=function(w,I,R,D,M,L,V){var j=1/(I-R),G=1/(D-M),$=1/(L-V);return w[0]=-2*j,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*G,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=$,w[11]=0,w[12]=(I+R)*j,w[13]=(M+D)*G,w[14]=L*$,w[15]=1,w},ke.lookAt=function(w,I,R,D){var M,L,V,j,G,$,H,Y,J,ce,we=I[0],_e=I[1],be=I[2],Z=D[0],de=D[1],De=D[2],Be=R[0],je=R[1],Xe=R[2];return Math.abs(we-Be)<o.EPSILON&&Math.abs(_e-je)<o.EPSILON&&Math.abs(be-Xe)<o.EPSILON?p(w):(H=we-Be,Y=_e-je,J=be-Xe,M=de*(J*=ce=1/Math.hypot(H,Y,J))-De*(Y*=ce),L=De*(H*=ce)-Z*J,V=Z*Y-de*H,(ce=Math.hypot(M,L,V))?(M*=ce=1/ce,L*=ce,V*=ce):(M=0,L=0,V=0),j=Y*V-J*L,G=J*M-H*V,$=H*L-Y*M,(ce=Math.hypot(j,G,$))?(j*=ce=1/ce,G*=ce,$*=ce):(j=0,G=0,$=0),w[0]=M,w[1]=j,w[2]=H,w[3]=0,w[4]=L,w[5]=G,w[6]=Y,w[7]=0,w[8]=V,w[9]=$,w[10]=J,w[11]=0,w[12]=-(M*we+L*_e+V*be),w[13]=-(j*we+G*_e+$*be),w[14]=-(H*we+Y*_e+J*be),w[15]=1,w)},ke.targetTo=function(w,I,R,D){var M=I[0],L=I[1],V=I[2],j=D[0],G=D[1],$=D[2],H=M-R[0],Y=L-R[1],J=V-R[2],ce=H*H+Y*Y+J*J;ce>0&&(H*=ce=1/Math.sqrt(ce),Y*=ce,J*=ce);var we=G*J-$*Y,_e=$*H-j*J,be=j*Y-G*H;return(ce=we*we+_e*_e+be*be)>0&&(we*=ce=1/Math.sqrt(ce),_e*=ce,be*=ce),w[0]=we,w[1]=_e,w[2]=be,w[3]=0,w[4]=Y*be-J*_e,w[5]=J*we-H*be,w[6]=H*_e-Y*we,w[7]=0,w[8]=H,w[9]=Y,w[10]=J,w[11]=0,w[12]=M,w[13]=L,w[14]=V,w[15]=1,w},ke.str=function(w){return"mat4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+", "+w[4]+", "+w[5]+", "+w[6]+", "+w[7]+", "+w[8]+", "+w[9]+", "+w[10]+", "+w[11]+", "+w[12]+", "+w[13]+", "+w[14]+", "+w[15]+")"},ke.frob=function(w){return Math.hypot(w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])},ke.add=function(w,I,R){return w[0]=I[0]+R[0],w[1]=I[1]+R[1],w[2]=I[2]+R[2],w[3]=I[3]+R[3],w[4]=I[4]+R[4],w[5]=I[5]+R[5],w[6]=I[6]+R[6],w[7]=I[7]+R[7],w[8]=I[8]+R[8],w[9]=I[9]+R[9],w[10]=I[10]+R[10],w[11]=I[11]+R[11],w[12]=I[12]+R[12],w[13]=I[13]+R[13],w[14]=I[14]+R[14],w[15]=I[15]+R[15],w},ke.subtract=P,ke.multiplyScalar=function(w,I,R){return w[0]=I[0]*R,w[1]=I[1]*R,w[2]=I[2]*R,w[3]=I[3]*R,w[4]=I[4]*R,w[5]=I[5]*R,w[6]=I[6]*R,w[7]=I[7]*R,w[8]=I[8]*R,w[9]=I[9]*R,w[10]=I[10]*R,w[11]=I[11]*R,w[12]=I[12]*R,w[13]=I[13]*R,w[14]=I[14]*R,w[15]=I[15]*R,w},ke.multiplyScalarAndAdd=function(w,I,R,D){return w[0]=I[0]+R[0]*D,w[1]=I[1]+R[1]*D,w[2]=I[2]+R[2]*D,w[3]=I[3]+R[3]*D,w[4]=I[4]+R[4]*D,w[5]=I[5]+R[5]*D,w[6]=I[6]+R[6]*D,w[7]=I[7]+R[7]*D,w[8]=I[8]+R[8]*D,w[9]=I[9]+R[9]*D,w[10]=I[10]+R[10]*D,w[11]=I[11]+R[11]*D,w[12]=I[12]+R[12]*D,w[13]=I[13]+R[13]*D,w[14]=I[14]+R[14]*D,w[15]=I[15]+R[15]*D,w},ke.exactEquals=function(w,I){return w[0]===I[0]&&w[1]===I[1]&&w[2]===I[2]&&w[3]===I[3]&&w[4]===I[4]&&w[5]===I[5]&&w[6]===I[6]&&w[7]===I[7]&&w[8]===I[8]&&w[9]===I[9]&&w[10]===I[10]&&w[11]===I[11]&&w[12]===I[12]&&w[13]===I[13]&&w[14]===I[14]&&w[15]===I[15]},ke.equals=function(w,I){var R=w[0],D=w[1],M=w[2],L=w[3],V=w[4],j=w[5],G=w[6],$=w[7],H=w[8],Y=w[9],J=w[10],ce=w[11],we=w[12],_e=w[13],be=w[14],Z=w[15],de=I[0],De=I[1],Be=I[2],je=I[3],Xe=I[4],it=I[5],at=I[6],et=I[7],It=I[8],Xt=I[9],vt=I[10],yn=I[11],ln=I[12],Kt=I[13],Gt=I[14],Hn=I[15];return Math.abs(R-de)<=o.EPSILON*Math.max(1,Math.abs(R),Math.abs(de))&&Math.abs(D-De)<=o.EPSILON*Math.max(1,Math.abs(D),Math.abs(De))&&Math.abs(M-Be)<=o.EPSILON*Math.max(1,Math.abs(M),Math.abs(Be))&&Math.abs(L-je)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(je))&&Math.abs(V-Xe)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(Xe))&&Math.abs(j-it)<=o.EPSILON*Math.max(1,Math.abs(j),Math.abs(it))&&Math.abs(G-at)<=o.EPSILON*Math.max(1,Math.abs(G),Math.abs(at))&&Math.abs($-et)<=o.EPSILON*Math.max(1,Math.abs($),Math.abs(et))&&Math.abs(H-It)<=o.EPSILON*Math.max(1,Math.abs(H),Math.abs(It))&&Math.abs(Y-Xt)<=o.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Xt))&&Math.abs(J-vt)<=o.EPSILON*Math.max(1,Math.abs(J),Math.abs(vt))&&Math.abs(ce-yn)<=o.EPSILON*Math.max(1,Math.abs(ce),Math.abs(yn))&&Math.abs(we-ln)<=o.EPSILON*Math.max(1,Math.abs(we),Math.abs(ln))&&Math.abs(_e-Kt)<=o.EPSILON*Math.max(1,Math.abs(_e),Math.abs(Kt))&&Math.abs(be-Gt)<=o.EPSILON*Math.max(1,Math.abs(be),Math.abs(Gt))&&Math.abs(Z-Hn)<=o.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Hn))},ke.sub=ke.mul=ke.ortho=ke.perspective=void 0;var o=function(w,I){if(w&&w.__esModule)return w;if(null===w||"object"!==u(w)&&"function"!=typeof w)return{default:w};var R=l(void 0);if(R&&R.has(w))return R.get(w);var D={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var L in w)if("default"!==L&&Object.prototype.hasOwnProperty.call(w,L)){var V=M?Object.getOwnPropertyDescriptor(w,L):null;V&&(V.get||V.set)?Object.defineProperty(D,L,V):D[L]=w[L]}return D.default=w,R&&R.set(w,D),D}($t());function l(w){if("function"!=typeof WeakMap)return null;var I=new WeakMap,R=new WeakMap;return(l=function(D){return D?R:I})(w)}function p(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function _(w,I,R){var D=I[0],M=I[1],L=I[2],V=I[3],j=I[4],G=I[5],$=I[6],H=I[7],Y=I[8],J=I[9],ce=I[10],we=I[11],_e=I[12],be=I[13],Z=I[14],de=I[15],De=R[0],Be=R[1],je=R[2],Xe=R[3];return w[0]=De*D+Be*j+je*Y+Xe*_e,w[1]=De*M+Be*G+je*J+Xe*be,w[2]=De*L+Be*$+je*ce+Xe*Z,w[3]=De*V+Be*H+je*we+Xe*de,w[4]=(De=R[4])*D+(Be=R[5])*j+(je=R[6])*Y+(Xe=R[7])*_e,w[5]=De*M+Be*G+je*J+Xe*be,w[6]=De*L+Be*$+je*ce+Xe*Z,w[7]=De*V+Be*H+je*we+Xe*de,w[8]=(De=R[8])*D+(Be=R[9])*j+(je=R[10])*Y+(Xe=R[11])*_e,w[9]=De*M+Be*G+je*J+Xe*be,w[10]=De*L+Be*$+je*ce+Xe*Z,w[11]=De*V+Be*H+je*we+Xe*de,w[12]=(De=R[12])*D+(Be=R[13])*j+(je=R[14])*Y+(Xe=R[15])*_e,w[13]=De*M+Be*G+je*J+Xe*be,w[14]=De*L+Be*$+je*ce+Xe*Z,w[15]=De*V+Be*H+je*we+Xe*de,w}function f(w,I,R){var D=I[0],M=I[1],L=I[2],V=I[3],j=D+D,G=M+M,$=L+L,H=D*j,Y=D*G,J=D*$,ce=M*G,we=M*$,_e=L*$,be=V*j,Z=V*G,de=V*$;return w[0]=1-(ce+_e),w[1]=Y+de,w[2]=J-Z,w[3]=0,w[4]=Y-de,w[5]=1-(H+_e),w[6]=we+be,w[7]=0,w[8]=J+Z,w[9]=we-be,w[10]=1-(H+ce),w[11]=0,w[12]=R[0],w[13]=R[1],w[14]=R[2],w[15]=1,w}function y(w,I){var R=I[4],D=I[5],M=I[6],L=I[8],V=I[9],j=I[10];return w[0]=Math.hypot(I[0],I[1],I[2]),w[1]=Math.hypot(R,D,M),w[2]=Math.hypot(L,V,j),w}function T(w,I,R,D,M){var L,V=1/Math.tan(I/2);return w[0]=V/R,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=V,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,null!=M&&M!==1/0?(w[10]=(M+D)*(L=1/(D-M)),w[14]=2*M*D*L):(w[10]=-1,w[14]=-2*D),w}function E(w,I,R,D,M,L,V){var j=1/(I-R),G=1/(D-M),$=1/(L-V);return w[0]=-2*j,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*G,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=2*$,w[11]=0,w[12]=(I+R)*j,w[13]=(M+D)*G,w[14]=(V+L)*$,w[15]=1,w}function P(w,I,R){return w[0]=I[0]-R[0],w[1]=I[1]-R[1],w[2]=I[2]-R[2],w[3]=I[3]-R[3],w[4]=I[4]-R[4],w[5]=I[5]-R[5],w[6]=I[6]-R[6],w[7]=I[7]-R[7],w[8]=I[8]-R[8],w[9]=I[9]-R[9],w[10]=I[10]-R[10],w[11]=I[11]-R[11],w[12]=I[12]-R[12],w[13]=I[13]-R[13],w[14]=I[14]-R[14],w[15]=I[15]-R[15],w}return ke.perspective=T,ke.ortho=E,ke.mul=_,ke.sub=P,ke}var Ft,Te={},lt={};function Ve(){if(Ft)return lt;function u(M){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(L){return typeof L}:function(L){return L&&"function"==typeof Symbol&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L})(M)}Ft=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.create=p,lt.clone=function(M){var L=new o.ARRAY_TYPE(3);return L[0]=M[0],L[1]=M[1],L[2]=M[2],L},lt.length=_,lt.fromValues=function(M,L,V){var j=new o.ARRAY_TYPE(3);return j[0]=M,j[1]=L,j[2]=V,j},lt.copy=function(M,L){return M[0]=L[0],M[1]=L[1],M[2]=L[2],M},lt.set=function(M,L,V,j){return M[0]=L,M[1]=V,M[2]=j,M},lt.add=function(M,L,V){return M[0]=L[0]+V[0],M[1]=L[1]+V[1],M[2]=L[2]+V[2],M},lt.subtract=f,lt.multiply=y,lt.divide=T,lt.ceil=function(M,L){return M[0]=Math.ceil(L[0]),M[1]=Math.ceil(L[1]),M[2]=Math.ceil(L[2]),M},lt.floor=function(M,L){return M[0]=Math.floor(L[0]),M[1]=Math.floor(L[1]),M[2]=Math.floor(L[2]),M},lt.min=function(M,L,V){return M[0]=Math.min(L[0],V[0]),M[1]=Math.min(L[1],V[1]),M[2]=Math.min(L[2],V[2]),M},lt.max=function(M,L,V){return M[0]=Math.max(L[0],V[0]),M[1]=Math.max(L[1],V[1]),M[2]=Math.max(L[2],V[2]),M},lt.round=function(M,L){return M[0]=Math.round(L[0]),M[1]=Math.round(L[1]),M[2]=Math.round(L[2]),M},lt.scale=function(M,L,V){return M[0]=L[0]*V,M[1]=L[1]*V,M[2]=L[2]*V,M},lt.scaleAndAdd=function(M,L,V,j){return M[0]=L[0]+V[0]*j,M[1]=L[1]+V[1]*j,M[2]=L[2]+V[2]*j,M},lt.distance=E,lt.squaredDistance=P,lt.squaredLength=w,lt.negate=function(M,L){return M[0]=-L[0],M[1]=-L[1],M[2]=-L[2],M},lt.inverse=function(M,L){return M[0]=1/L[0],M[1]=1/L[1],M[2]=1/L[2],M},lt.normalize=function(M,L){var V=L[0],j=L[1],G=L[2],$=V*V+j*j+G*G;return $>0&&($=1/Math.sqrt($)),M[0]=L[0]*$,M[1]=L[1]*$,M[2]=L[2]*$,M},lt.dot=I,lt.cross=function(M,L,V){var j=L[0],G=L[1],$=L[2],H=V[0],Y=V[1],J=V[2];return M[0]=G*J-$*Y,M[1]=$*H-j*J,M[2]=j*Y-G*H,M},lt.lerp=function(M,L,V,j){var G=L[0],$=L[1],H=L[2];return M[0]=G+j*(V[0]-G),M[1]=$+j*(V[1]-$),M[2]=H+j*(V[2]-H),M},lt.hermite=function(M,L,V,j,G,$){var H=$*$,Y=H*(2*$-3)+1,J=H*($-2)+$,ce=H*($-1),we=H*(3-2*$);return M[0]=L[0]*Y+V[0]*J+j[0]*ce+G[0]*we,M[1]=L[1]*Y+V[1]*J+j[1]*ce+G[1]*we,M[2]=L[2]*Y+V[2]*J+j[2]*ce+G[2]*we,M},lt.bezier=function(M,L,V,j,G,$){var H=1-$,Y=H*H,J=$*$,ce=Y*H,we=3*$*Y,_e=3*J*H,be=J*$;return M[0]=L[0]*ce+V[0]*we+j[0]*_e+G[0]*be,M[1]=L[1]*ce+V[1]*we+j[1]*_e+G[1]*be,M[2]=L[2]*ce+V[2]*we+j[2]*_e+G[2]*be,M},lt.random=function(M,L){L=L||1;var V=2*o.RANDOM()*Math.PI,j=2*o.RANDOM()-1,G=Math.sqrt(1-j*j)*L;return M[0]=Math.cos(V)*G,M[1]=Math.sin(V)*G,M[2]=j*L,M},lt.transformMat4=function(M,L,V){var j=L[0],G=L[1],$=L[2],H=V[3]*j+V[7]*G+V[11]*$+V[15];return M[0]=(V[0]*j+V[4]*G+V[8]*$+V[12])/(H=H||1),M[1]=(V[1]*j+V[5]*G+V[9]*$+V[13])/H,M[2]=(V[2]*j+V[6]*G+V[10]*$+V[14])/H,M},lt.transformMat3=function(M,L,V){var j=L[0],G=L[1],$=L[2];return M[0]=j*V[0]+G*V[3]+$*V[6],M[1]=j*V[1]+G*V[4]+$*V[7],M[2]=j*V[2]+G*V[5]+$*V[8],M},lt.transformQuat=function(M,L,V){var j=V[0],G=V[1],$=V[2],H=L[0],Y=L[1],J=L[2],ce=G*J-$*Y,we=$*H-j*J,_e=j*Y-G*H,be=G*_e-$*we,Z=$*ce-j*_e,de=j*we-G*ce,De=2*V[3];return we*=De,_e*=De,Z*=2,de*=2,M[0]=H+(ce*=De)+(be*=2),M[1]=Y+we+Z,M[2]=J+_e+de,M},lt.rotateX=function(M,L,V,j){var G=[],$=[];return G[0]=L[0]-V[0],G[1]=L[1]-V[1],G[2]=L[2]-V[2],$[0]=G[0],$[1]=G[1]*Math.cos(j)-G[2]*Math.sin(j),$[2]=G[1]*Math.sin(j)+G[2]*Math.cos(j),M[0]=$[0]+V[0],M[1]=$[1]+V[1],M[2]=$[2]+V[2],M},lt.rotateY=function(M,L,V,j){var G=[],$=[];return G[0]=L[0]-V[0],G[1]=L[1]-V[1],G[2]=L[2]-V[2],$[0]=G[2]*Math.sin(j)+G[0]*Math.cos(j),$[1]=G[1],$[2]=G[2]*Math.cos(j)-G[0]*Math.sin(j),M[0]=$[0]+V[0],M[1]=$[1]+V[1],M[2]=$[2]+V[2],M},lt.rotateZ=function(M,L,V,j){var G=[],$=[];return G[0]=L[0]-V[0],G[1]=L[1]-V[1],G[2]=L[2]-V[2],$[0]=G[0]*Math.cos(j)-G[1]*Math.sin(j),$[1]=G[0]*Math.sin(j)+G[1]*Math.cos(j),$[2]=G[2],M[0]=$[0]+V[0],M[1]=$[1]+V[1],M[2]=$[2]+V[2],M},lt.angle=function(M,L){var V=M[0],j=M[1],G=M[2],$=L[0],H=L[1],Y=L[2],J=Math.sqrt(V*V+j*j+G*G)*Math.sqrt($*$+H*H+Y*Y),ce=J&&I(M,L)/J;return Math.acos(Math.min(Math.max(ce,-1),1))},lt.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M},lt.str=function(M){return"vec3("+M[0]+", "+M[1]+", "+M[2]+")"},lt.exactEquals=function(M,L){return M[0]===L[0]&&M[1]===L[1]&&M[2]===L[2]},lt.equals=function(M,L){var V=M[0],j=M[1],G=M[2],$=L[0],H=L[1],Y=L[2];return Math.abs(V-$)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs($))&&Math.abs(j-H)<=o.EPSILON*Math.max(1,Math.abs(j),Math.abs(H))&&Math.abs(G-Y)<=o.EPSILON*Math.max(1,Math.abs(G),Math.abs(Y))},lt.forEach=lt.sqrLen=lt.len=lt.sqrDist=lt.dist=lt.div=lt.mul=lt.sub=void 0;var o=function(M,L){if(M&&M.__esModule)return M;if(null===M||"object"!==u(M)&&"function"!=typeof M)return{default:M};var V=l(void 0);if(V&&V.has(M))return V.get(M);var j={},G=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var $ in M)if("default"!==$&&Object.prototype.hasOwnProperty.call(M,$)){var H=G?Object.getOwnPropertyDescriptor(M,$):null;H&&(H.get||H.set)?Object.defineProperty(j,$,H):j[$]=M[$]}return j.default=M,V&&V.set(M,j),j}($t());function l(M){if("function"!=typeof WeakMap)return null;var L=new WeakMap,V=new WeakMap;return(l=function(j){return j?V:L})(M)}function p(){var M=new o.ARRAY_TYPE(3);return o.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0),M}function _(M){return Math.hypot(M[0],M[1],M[2])}function f(M,L,V){return M[0]=L[0]-V[0],M[1]=L[1]-V[1],M[2]=L[2]-V[2],M}function y(M,L,V){return M[0]=L[0]*V[0],M[1]=L[1]*V[1],M[2]=L[2]*V[2],M}function T(M,L,V){return M[0]=L[0]/V[0],M[1]=L[1]/V[1],M[2]=L[2]/V[2],M}function E(M,L){return Math.hypot(L[0]-M[0],L[1]-M[1],L[2]-M[2])}function P(M,L){var V=L[0]-M[0],j=L[1]-M[1],G=L[2]-M[2];return V*V+j*j+G*G}function w(M){var L=M[0],V=M[1],j=M[2];return L*L+V*V+j*j}function I(M,L){return M[0]*L[0]+M[1]*L[1]+M[2]*L[2]}lt.sub=f,lt.mul=y,lt.div=T,lt.dist=E,lt.sqrDist=P,lt.len=_,lt.sqrLen=w;var R,D=(R=p(),function(M,L,V,j,G,$){var H,Y;for(L||(L=3),V||(V=0),Y=j?Math.min(j*L+V,M.length):M.length,H=V;H<Y;H+=L)R[0]=M[H],R[1]=M[H+1],R[2]=M[H+2],G(R,R,$),M[H]=R[0],M[H+1]=R[1],M[H+2]=R[2];return M});return lt.forEach=D,lt}var qe,Nt,xt={};function ct(){if(qe)return xt;function u(D){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(M){return typeof M}:function(M){return M&&"function"==typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(D)}qe=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.create=p,xt.clone=function(D){var M=new o.ARRAY_TYPE(4);return M[0]=D[0],M[1]=D[1],M[2]=D[2],M[3]=D[3],M},xt.fromValues=function(D,M,L,V){var j=new o.ARRAY_TYPE(4);return j[0]=D,j[1]=M,j[2]=L,j[3]=V,j},xt.copy=function(D,M){return D[0]=M[0],D[1]=M[1],D[2]=M[2],D[3]=M[3],D},xt.set=function(D,M,L,V,j){return D[0]=M,D[1]=L,D[2]=V,D[3]=j,D},xt.add=function(D,M,L){return D[0]=M[0]+L[0],D[1]=M[1]+L[1],D[2]=M[2]+L[2],D[3]=M[3]+L[3],D},xt.subtract=_,xt.multiply=f,xt.divide=y,xt.ceil=function(D,M){return D[0]=Math.ceil(M[0]),D[1]=Math.ceil(M[1]),D[2]=Math.ceil(M[2]),D[3]=Math.ceil(M[3]),D},xt.floor=function(D,M){return D[0]=Math.floor(M[0]),D[1]=Math.floor(M[1]),D[2]=Math.floor(M[2]),D[3]=Math.floor(M[3]),D},xt.min=function(D,M,L){return D[0]=Math.min(M[0],L[0]),D[1]=Math.min(M[1],L[1]),D[2]=Math.min(M[2],L[2]),D[3]=Math.min(M[3],L[3]),D},xt.max=function(D,M,L){return D[0]=Math.max(M[0],L[0]),D[1]=Math.max(M[1],L[1]),D[2]=Math.max(M[2],L[2]),D[3]=Math.max(M[3],L[3]),D},xt.round=function(D,M){return D[0]=Math.round(M[0]),D[1]=Math.round(M[1]),D[2]=Math.round(M[2]),D[3]=Math.round(M[3]),D},xt.scale=function(D,M,L){return D[0]=M[0]*L,D[1]=M[1]*L,D[2]=M[2]*L,D[3]=M[3]*L,D},xt.scaleAndAdd=function(D,M,L,V){return D[0]=M[0]+L[0]*V,D[1]=M[1]+L[1]*V,D[2]=M[2]+L[2]*V,D[3]=M[3]+L[3]*V,D},xt.distance=T,xt.squaredDistance=E,xt.length=P,xt.squaredLength=w,xt.negate=function(D,M){return D[0]=-M[0],D[1]=-M[1],D[2]=-M[2],D[3]=-M[3],D},xt.inverse=function(D,M){return D[0]=1/M[0],D[1]=1/M[1],D[2]=1/M[2],D[3]=1/M[3],D},xt.normalize=function(D,M){var L=M[0],V=M[1],j=M[2],G=M[3],$=L*L+V*V+j*j+G*G;return $>0&&($=1/Math.sqrt($)),D[0]=L*$,D[1]=V*$,D[2]=j*$,D[3]=G*$,D},xt.dot=function(D,M){return D[0]*M[0]+D[1]*M[1]+D[2]*M[2]+D[3]*M[3]},xt.cross=function(D,M,L,V){var j=L[0]*V[1]-L[1]*V[0],G=L[0]*V[2]-L[2]*V[0],$=L[0]*V[3]-L[3]*V[0],H=L[1]*V[2]-L[2]*V[1],Y=L[1]*V[3]-L[3]*V[1],J=L[2]*V[3]-L[3]*V[2],ce=M[0],we=M[1],_e=M[2],be=M[3];return D[0]=we*J-_e*Y+be*H,D[1]=-ce*J+_e*$-be*G,D[2]=ce*Y-we*$+be*j,D[3]=-ce*H+we*G-_e*j,D},xt.lerp=function(D,M,L,V){var j=M[0],G=M[1],$=M[2],H=M[3];return D[0]=j+V*(L[0]-j),D[1]=G+V*(L[1]-G),D[2]=$+V*(L[2]-$),D[3]=H+V*(L[3]-H),D},xt.random=function(D,M){var L,V,j,G,$,H;M=M||1;do{$=(L=2*o.RANDOM()-1)*L+(V=2*o.RANDOM()-1)*V}while($>=1);do{H=(j=2*o.RANDOM()-1)*j+(G=2*o.RANDOM()-1)*G}while(H>=1);var Y=Math.sqrt((1-$)/H);return D[0]=M*L,D[1]=M*V,D[2]=M*j*Y,D[3]=M*G*Y,D},xt.transformMat4=function(D,M,L){var V=M[0],j=M[1],G=M[2],$=M[3];return D[0]=L[0]*V+L[4]*j+L[8]*G+L[12]*$,D[1]=L[1]*V+L[5]*j+L[9]*G+L[13]*$,D[2]=L[2]*V+L[6]*j+L[10]*G+L[14]*$,D[3]=L[3]*V+L[7]*j+L[11]*G+L[15]*$,D},xt.transformQuat=function(D,M,L){var V=M[0],j=M[1],G=M[2],$=L[0],H=L[1],Y=L[2],J=L[3],ce=J*V+H*G-Y*j,we=J*j+Y*V-$*G,_e=J*G+$*j-H*V,be=-$*V-H*j-Y*G;return D[0]=ce*J+be*-$+we*-Y-_e*-H,D[1]=we*J+be*-H+_e*-$-ce*-Y,D[2]=_e*J+be*-Y+ce*-H-we*-$,D[3]=M[3],D},xt.zero=function(D){return D[0]=0,D[1]=0,D[2]=0,D[3]=0,D},xt.str=function(D){return"vec4("+D[0]+", "+D[1]+", "+D[2]+", "+D[3]+")"},xt.exactEquals=function(D,M){return D[0]===M[0]&&D[1]===M[1]&&D[2]===M[2]&&D[3]===M[3]},xt.equals=function(D,M){var L=D[0],V=D[1],j=D[2],G=D[3],$=M[0],H=M[1],Y=M[2],J=M[3];return Math.abs(L-$)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs($))&&Math.abs(V-H)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(H))&&Math.abs(j-Y)<=o.EPSILON*Math.max(1,Math.abs(j),Math.abs(Y))&&Math.abs(G-J)<=o.EPSILON*Math.max(1,Math.abs(G),Math.abs(J))},xt.forEach=xt.sqrLen=xt.len=xt.sqrDist=xt.dist=xt.div=xt.mul=xt.sub=void 0;var o=function(D,M){if(D&&D.__esModule)return D;if(null===D||"object"!==u(D)&&"function"!=typeof D)return{default:D};var L=l(void 0);if(L&&L.has(D))return L.get(D);var V={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in D)if("default"!==G&&Object.prototype.hasOwnProperty.call(D,G)){var $=j?Object.getOwnPropertyDescriptor(D,G):null;$&&($.get||$.set)?Object.defineProperty(V,G,$):V[G]=D[G]}return V.default=D,L&&L.set(D,V),V}($t());function l(D){if("function"!=typeof WeakMap)return null;var M=new WeakMap,L=new WeakMap;return(l=function(V){return V?L:M})(D)}function p(){var D=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0,D[3]=0),D}function _(D,M,L){return D[0]=M[0]-L[0],D[1]=M[1]-L[1],D[2]=M[2]-L[2],D[3]=M[3]-L[3],D}function f(D,M,L){return D[0]=M[0]*L[0],D[1]=M[1]*L[1],D[2]=M[2]*L[2],D[3]=M[3]*L[3],D}function y(D,M,L){return D[0]=M[0]/L[0],D[1]=M[1]/L[1],D[2]=M[2]/L[2],D[3]=M[3]/L[3],D}function T(D,M){return Math.hypot(M[0]-D[0],M[1]-D[1],M[2]-D[2],M[3]-D[3])}function E(D,M){var L=M[0]-D[0],V=M[1]-D[1],j=M[2]-D[2],G=M[3]-D[3];return L*L+V*V+j*j+G*G}function P(D){return Math.hypot(D[0],D[1],D[2],D[3])}function w(D){var M=D[0],L=D[1],V=D[2],j=D[3];return M*M+L*L+V*V+j*j}xt.sub=_,xt.mul=f,xt.div=y,xt.dist=T,xt.sqrDist=E,xt.len=P,xt.sqrLen=w;var I,R=(I=p(),function(D,M,L,V,j,G){var $,H;for(M||(M=4),L||(L=0),H=V?Math.min(V*M+L,D.length):D.length,$=L;$<H;$+=M)I[0]=D[$],I[1]=D[$+1],I[2]=D[$+2],I[3]=D[$+3],j(I,I,G),D[$]=I[0],D[$+1]=I[1],D[$+2]=I[2],D[$+3]=I[3];return D});return xt.forEach=R,xt}function tn(){if(Nt)return Te;function u(de){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(De){return typeof De}:function(De){return De&&"function"==typeof Symbol&&De.constructor===Symbol&&De!==Symbol.prototype?"symbol":typeof De})(de)}Nt=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.create=T,Te.identity=function(de){return de[0]=0,de[1]=0,de[2]=0,de[3]=1,de},Te.setAxisAngle=E,Te.getAxisAngle=function(de,De){var Be=2*Math.acos(De[3]),je=Math.sin(Be/2);return je>o.EPSILON?(de[0]=De[0]/je,de[1]=De[1]/je,de[2]=De[2]/je):(de[0]=1,de[1]=0,de[2]=0),Be},Te.getAngle=function(de,De){var Be=L(de,De);return Math.acos(2*Be*Be-1)},Te.multiply=P,Te.rotateX=function(de,De,Be){Be*=.5;var je=De[0],Xe=De[1],it=De[2],at=De[3],et=Math.sin(Be),It=Math.cos(Be);return de[0]=je*It+at*et,de[1]=Xe*It+it*et,de[2]=it*It-Xe*et,de[3]=at*It-je*et,de},Te.rotateY=function(de,De,Be){Be*=.5;var je=De[0],Xe=De[1],it=De[2],at=De[3],et=Math.sin(Be),It=Math.cos(Be);return de[0]=je*It-it*et,de[1]=Xe*It+at*et,de[2]=it*It+je*et,de[3]=at*It-Xe*et,de},Te.rotateZ=function(de,De,Be){Be*=.5;var je=De[0],Xe=De[1],it=De[2],at=De[3],et=Math.sin(Be),It=Math.cos(Be);return de[0]=je*It+Xe*et,de[1]=Xe*It-je*et,de[2]=it*It+at*et,de[3]=at*It-it*et,de},Te.calculateW=function(de,De){var Be=De[0],je=De[1],Xe=De[2];return de[0]=Be,de[1]=je,de[2]=Xe,de[3]=Math.sqrt(Math.abs(1-Be*Be-je*je-Xe*Xe)),de},Te.exp=w,Te.ln=I,Te.pow=function(de,De,Be){return I(de,De),M(de,de,Be),w(de,de),de},Te.slerp=R,Te.random=function(de){var De=o.RANDOM(),Be=o.RANDOM(),je=o.RANDOM(),Xe=Math.sqrt(1-De),it=Math.sqrt(De);return de[0]=Xe*Math.sin(2*Math.PI*Be),de[1]=Xe*Math.cos(2*Math.PI*Be),de[2]=it*Math.sin(2*Math.PI*je),de[3]=it*Math.cos(2*Math.PI*je),de},Te.invert=function(de,De){var Be=De[0],je=De[1],Xe=De[2],it=De[3],at=Be*Be+je*je+Xe*Xe+it*it,et=at?1/at:0;return de[0]=-Be*et,de[1]=-je*et,de[2]=-Xe*et,de[3]=it*et,de},Te.conjugate=function(de,De){return de[0]=-De[0],de[1]=-De[1],de[2]=-De[2],de[3]=De[3],de},Te.fromMat3=D,Te.fromEuler=function(de,De,Be,je){var Xe=.5*Math.PI/180;De*=Xe,Be*=Xe,je*=Xe;var it=Math.sin(De),at=Math.cos(De),et=Math.sin(Be),It=Math.cos(Be),Xt=Math.sin(je),vt=Math.cos(je);return de[0]=it*It*vt-at*et*Xt,de[1]=at*et*vt+it*It*Xt,de[2]=at*It*Xt-it*et*vt,de[3]=at*It*vt+it*et*Xt,de},Te.str=function(de){return"quat("+de[0]+", "+de[1]+", "+de[2]+", "+de[3]+")"},Te.setAxes=Te.sqlerp=Te.rotationTo=Te.equals=Te.exactEquals=Te.normalize=Te.sqrLen=Te.squaredLength=Te.len=Te.length=Te.lerp=Te.dot=Te.scale=Te.mul=Te.add=Te.set=Te.copy=Te.fromValues=Te.clone=void 0;var o=y($t()),l=y(Vt()),p=y(Ve()),_=y(ct());function f(de){if("function"!=typeof WeakMap)return null;var De=new WeakMap,Be=new WeakMap;return(f=function(je){return je?Be:De})(de)}function y(de,De){if(de&&de.__esModule)return de;if(null===de||"object"!==u(de)&&"function"!=typeof de)return{default:de};var Be=f(De);if(Be&&Be.has(de))return Be.get(de);var je={},Xe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var it in de)if("default"!==it&&Object.prototype.hasOwnProperty.call(de,it)){var at=Xe?Object.getOwnPropertyDescriptor(de,it):null;at&&(at.get||at.set)?Object.defineProperty(je,it,at):je[it]=de[it]}return je.default=de,Be&&Be.set(de,je),je}function T(){var de=new o.ARRAY_TYPE(4);return o.ARRAY_TYPE!=Float32Array&&(de[0]=0,de[1]=0,de[2]=0),de[3]=1,de}function E(de,De,Be){Be*=.5;var je=Math.sin(Be);return de[0]=je*De[0],de[1]=je*De[1],de[2]=je*De[2],de[3]=Math.cos(Be),de}function P(de,De,Be){var je=De[0],Xe=De[1],it=De[2],at=De[3],et=Be[0],It=Be[1],Xt=Be[2],vt=Be[3];return de[0]=je*vt+at*et+Xe*Xt-it*It,de[1]=Xe*vt+at*It+it*et-je*Xt,de[2]=it*vt+at*Xt+je*It-Xe*et,de[3]=at*vt-je*et-Xe*It-it*Xt,de}function w(de,De){var Be=De[0],je=De[1],Xe=De[2],it=De[3],at=Math.sqrt(Be*Be+je*je+Xe*Xe),et=Math.exp(it),It=at>0?et*Math.sin(at)/at:0;return de[0]=Be*It,de[1]=je*It,de[2]=Xe*It,de[3]=et*Math.cos(at),de}function I(de,De){var Be=De[0],je=De[1],Xe=De[2],it=De[3],at=Math.sqrt(Be*Be+je*je+Xe*Xe),et=at>0?Math.atan2(at,it)/at:0;return de[0]=Be*et,de[1]=je*et,de[2]=Xe*et,de[3]=.5*Math.log(Be*Be+je*je+Xe*Xe+it*it),de}function R(de,De,Be,je){var Xe,it,at,et,It,Xt=De[0],vt=De[1],yn=De[2],ln=De[3],Kt=Be[0],Gt=Be[1],Hn=Be[2],gn=Be[3];return(it=Xt*Kt+vt*Gt+yn*Hn+ln*gn)<0&&(it=-it,Kt=-Kt,Gt=-Gt,Hn=-Hn,gn=-gn),1-it>o.EPSILON?(Xe=Math.acos(it),at=Math.sin(Xe),et=Math.sin((1-je)*Xe)/at,It=Math.sin(je*Xe)/at):(et=1-je,It=je),de[0]=et*Xt+It*Kt,de[1]=et*vt+It*Gt,de[2]=et*yn+It*Hn,de[3]=et*ln+It*gn,de}function D(de,De){var Be,je=De[0]+De[4]+De[8];if(je>0)Be=Math.sqrt(je+1),de[3]=.5*Be,de[0]=(De[5]-De[7])*(Be=.5/Be),de[1]=(De[6]-De[2])*Be,de[2]=(De[1]-De[3])*Be;else{var Xe=0;De[4]>De[0]&&(Xe=1),De[8]>De[3*Xe+Xe]&&(Xe=2);var it=(Xe+1)%3,at=(Xe+2)%3;Be=Math.sqrt(De[3*Xe+Xe]-De[3*it+it]-De[3*at+at]+1),de[Xe]=.5*Be,de[3]=(De[3*it+at]-De[3*at+it])*(Be=.5/Be),de[it]=(De[3*it+Xe]+De[3*Xe+it])*Be,de[at]=(De[3*at+Xe]+De[3*Xe+at])*Be}return de}Te.clone=_.clone,Te.fromValues=_.fromValues,Te.copy=_.copy,Te.set=_.set,Te.add=_.add,Te.mul=P;var M=_.scale;Te.scale=M;var L=_.dot;Te.dot=L,Te.lerp=_.lerp;var V=_.length;Te.length=V,Te.len=V;var j=_.squaredLength;Te.squaredLength=j,Te.sqrLen=j;var G=_.normalize;Te.normalize=G,Te.exactEquals=_.exactEquals,Te.equals=_.equals;var $,H,Y,J=($=p.create(),H=p.fromValues(1,0,0),Y=p.fromValues(0,1,0),function(de,De,Be){var je=p.dot(De,Be);return je<-.999999?(p.cross($,H,De),p.len($)<1e-6&&p.cross($,Y,De),p.normalize($,$),E(de,$,Math.PI),de):je>.999999?(de[0]=0,de[1]=0,de[2]=0,de[3]=1,de):(p.cross($,De,Be),de[0]=$[0],de[1]=$[1],de[2]=$[2],de[3]=1+je,G(de,de))});Te.rotationTo=J;var ce,we,_e=(ce=T(),we=T(),function(de,De,Be,je,Xe,it){return R(ce,De,Xe,it),R(we,Be,je,it),R(de,ce,we,2*it*(1-it)),de});Te.sqlerp=_e;var be,Z=(be=l.create(),function(de,De,Be,je){return be[0]=Be[0],be[3]=Be[1],be[6]=Be[2],be[1]=je[0],be[4]=je[1],be[7]=je[2],be[2]=-De[0],be[5]=-De[1],be[8]=-De[2],G(de,D(de,be))});return Te.setAxes=Z,Te}var Pn,vn={};var Kn,yi,Wn={};function br(){if(Kn)return Wn;function u(D){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(M){return typeof M}:function(M){return M&&"function"==typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(D)}Kn=1,Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.create=p,Wn.clone=function(D){var M=new o.ARRAY_TYPE(2);return M[0]=D[0],M[1]=D[1],M},Wn.fromValues=function(D,M){var L=new o.ARRAY_TYPE(2);return L[0]=D,L[1]=M,L},Wn.copy=function(D,M){return D[0]=M[0],D[1]=M[1],D},Wn.set=function(D,M,L){return D[0]=M,D[1]=L,D},Wn.add=function(D,M,L){return D[0]=M[0]+L[0],D[1]=M[1]+L[1],D},Wn.subtract=_,Wn.multiply=f,Wn.divide=y,Wn.ceil=function(D,M){return D[0]=Math.ceil(M[0]),D[1]=Math.ceil(M[1]),D},Wn.floor=function(D,M){return D[0]=Math.floor(M[0]),D[1]=Math.floor(M[1]),D},Wn.min=function(D,M,L){return D[0]=Math.min(M[0],L[0]),D[1]=Math.min(M[1],L[1]),D},Wn.max=function(D,M,L){return D[0]=Math.max(M[0],L[0]),D[1]=Math.max(M[1],L[1]),D},Wn.round=function(D,M){return D[0]=Math.round(M[0]),D[1]=Math.round(M[1]),D},Wn.scale=function(D,M,L){return D[0]=M[0]*L,D[1]=M[1]*L,D},Wn.scaleAndAdd=function(D,M,L,V){return D[0]=M[0]+L[0]*V,D[1]=M[1]+L[1]*V,D},Wn.distance=T,Wn.squaredDistance=E,Wn.length=P,Wn.squaredLength=w,Wn.negate=function(D,M){return D[0]=-M[0],D[1]=-M[1],D},Wn.inverse=function(D,M){return D[0]=1/M[0],D[1]=1/M[1],D},Wn.normalize=function(D,M){var L=M[0],V=M[1],j=L*L+V*V;return j>0&&(j=1/Math.sqrt(j)),D[0]=M[0]*j,D[1]=M[1]*j,D},Wn.dot=function(D,M){return D[0]*M[0]+D[1]*M[1]},Wn.cross=function(D,M,L){var V=M[0]*L[1]-M[1]*L[0];return D[0]=D[1]=0,D[2]=V,D},Wn.lerp=function(D,M,L,V){var j=M[0],G=M[1];return D[0]=j+V*(L[0]-j),D[1]=G+V*(L[1]-G),D},Wn.random=function(D,M){M=M||1;var L=2*o.RANDOM()*Math.PI;return D[0]=Math.cos(L)*M,D[1]=Math.sin(L)*M,D},Wn.transformMat2=function(D,M,L){var V=M[0],j=M[1];return D[0]=L[0]*V+L[2]*j,D[1]=L[1]*V+L[3]*j,D},Wn.transformMat2d=function(D,M,L){var V=M[0],j=M[1];return D[0]=L[0]*V+L[2]*j+L[4],D[1]=L[1]*V+L[3]*j+L[5],D},Wn.transformMat3=function(D,M,L){var V=M[0],j=M[1];return D[0]=L[0]*V+L[3]*j+L[6],D[1]=L[1]*V+L[4]*j+L[7],D},Wn.transformMat4=function(D,M,L){var V=M[0],j=M[1];return D[0]=L[0]*V+L[4]*j+L[12],D[1]=L[1]*V+L[5]*j+L[13],D},Wn.rotate=function(D,M,L,V){var j=M[0]-L[0],G=M[1]-L[1],$=Math.sin(V),H=Math.cos(V);return D[0]=j*H-G*$+L[0],D[1]=j*$+G*H+L[1],D},Wn.angle=function(D,M){var L=D[0],V=D[1],j=M[0],G=M[1],$=Math.sqrt(L*L+V*V)*Math.sqrt(j*j+G*G);return Math.acos(Math.min(Math.max($&&(L*j+V*G)/$,-1),1))},Wn.zero=function(D){return D[0]=0,D[1]=0,D},Wn.str=function(D){return"vec2("+D[0]+", "+D[1]+")"},Wn.exactEquals=function(D,M){return D[0]===M[0]&&D[1]===M[1]},Wn.equals=function(D,M){var L=D[0],V=D[1],j=M[0],G=M[1];return Math.abs(L-j)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(j))&&Math.abs(V-G)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(G))},Wn.forEach=Wn.sqrLen=Wn.sqrDist=Wn.dist=Wn.div=Wn.mul=Wn.sub=Wn.len=void 0;var o=function(D,M){if(D&&D.__esModule)return D;if(null===D||"object"!==u(D)&&"function"!=typeof D)return{default:D};var L=l(void 0);if(L&&L.has(D))return L.get(D);var V={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in D)if("default"!==G&&Object.prototype.hasOwnProperty.call(D,G)){var $=j?Object.getOwnPropertyDescriptor(D,G):null;$&&($.get||$.set)?Object.defineProperty(V,G,$):V[G]=D[G]}return V.default=D,L&&L.set(D,V),V}($t());function l(D){if("function"!=typeof WeakMap)return null;var M=new WeakMap,L=new WeakMap;return(l=function(V){return V?L:M})(D)}function p(){var D=new o.ARRAY_TYPE(2);return o.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0),D}function _(D,M,L){return D[0]=M[0]-L[0],D[1]=M[1]-L[1],D}function f(D,M,L){return D[0]=M[0]*L[0],D[1]=M[1]*L[1],D}function y(D,M,L){return D[0]=M[0]/L[0],D[1]=M[1]/L[1],D}function T(D,M){return Math.hypot(M[0]-D[0],M[1]-D[1])}function E(D,M){var L=M[0]-D[0],V=M[1]-D[1];return L*L+V*V}function P(D){return Math.hypot(D[0],D[1])}function w(D){var M=D[0],L=D[1];return M*M+L*L}Wn.len=P,Wn.sub=_,Wn.mul=f,Wn.div=y,Wn.dist=T,Wn.sqrDist=E,Wn.sqrLen=w;var I,R=(I=p(),function(D,M,L,V,j,G){var $,H;for(M||(M=2),L||(L=0),H=V?Math.min(V*M+L,D.length):D.length,$=L;$<H;$+=M)I[0]=D[$],I[1]=D[$+1],j(I,I,G),D[$]=I[0],D[$+1]=I[1];return D});return Wn.forEach=R,Wn}var ds,On,ks,$s,Q=function qr(){if(yi)return Se;function u(D){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(M){return typeof M}:function(M){return M&&"function"==typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(D)}yi=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.vec4=Se.vec3=Se.vec2=Se.quat2=Se.quat=Se.mat4=Se.mat3=Se.mat2d=Se.mat2=Se.glMatrix=void 0;var o=R($t());Se.glMatrix=o;var l=R(rt());Se.mat2=l;var p=R(xn());Se.mat2d=p;var _=R(Vt());Se.mat3=_;var f=R(We());Se.mat4=f;var y=R(tn());Se.quat=y;var T=R(function $n(){if(Pn)return vn;function u(R){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(D){return typeof D}:function(D){return D&&"function"==typeof Symbol&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D})(R)}Pn=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.create=function(){var R=new o.ARRAY_TYPE(8);return o.ARRAY_TYPE!=Float32Array&&(R[0]=0,R[1]=0,R[2]=0,R[4]=0,R[5]=0,R[6]=0,R[7]=0),R[3]=1,R},vn.clone=function(R){var D=new o.ARRAY_TYPE(8);return D[0]=R[0],D[1]=R[1],D[2]=R[2],D[3]=R[3],D[4]=R[4],D[5]=R[5],D[6]=R[6],D[7]=R[7],D},vn.fromValues=function(R,D,M,L,V,j,G,$){var H=new o.ARRAY_TYPE(8);return H[0]=R,H[1]=D,H[2]=M,H[3]=L,H[4]=V,H[5]=j,H[6]=G,H[7]=$,H},vn.fromRotationTranslationValues=function(R,D,M,L,V,j,G){var $=new o.ARRAY_TYPE(8);$[0]=R,$[1]=D,$[2]=M,$[3]=L;var H=.5*V,Y=.5*j,J=.5*G;return $[4]=H*L+Y*M-J*D,$[5]=Y*L+J*R-H*M,$[6]=J*L+H*D-Y*R,$[7]=-H*R-Y*D-J*M,$},vn.fromRotationTranslation=y,vn.fromTranslation=function(R,D){return R[0]=0,R[1]=0,R[2]=0,R[3]=1,R[4]=.5*D[0],R[5]=.5*D[1],R[6]=.5*D[2],R[7]=0,R},vn.fromRotation=function(R,D){return R[0]=D[0],R[1]=D[1],R[2]=D[2],R[3]=D[3],R[4]=0,R[5]=0,R[6]=0,R[7]=0,R},vn.fromMat4=function(R,D){var M=l.create();p.getRotation(M,D);var L=new o.ARRAY_TYPE(3);return p.getTranslation(L,D),y(R,M,L),R},vn.copy=T,vn.identity=function(R){return R[0]=0,R[1]=0,R[2]=0,R[3]=1,R[4]=0,R[5]=0,R[6]=0,R[7]=0,R},vn.set=function(R,D,M,L,V,j,G,$,H){return R[0]=D,R[1]=M,R[2]=L,R[3]=V,R[4]=j,R[5]=G,R[6]=$,R[7]=H,R},vn.getDual=function(R,D){return R[0]=D[4],R[1]=D[5],R[2]=D[6],R[3]=D[7],R},vn.setDual=function(R,D){return R[4]=D[0],R[5]=D[1],R[6]=D[2],R[7]=D[3],R},vn.getTranslation=function(R,D){var M=D[4],L=D[5],V=D[6],j=D[7],G=-D[0],$=-D[1],H=-D[2],Y=D[3];return R[0]=2*(M*Y+j*G+L*H-V*$),R[1]=2*(L*Y+j*$+V*G-M*H),R[2]=2*(V*Y+j*H+M*$-L*G),R},vn.translate=function(R,D,M){var L=D[0],V=D[1],j=D[2],G=D[3],$=.5*M[0],H=.5*M[1],Y=.5*M[2],J=D[4],ce=D[5],we=D[6],_e=D[7];return R[0]=L,R[1]=V,R[2]=j,R[3]=G,R[4]=G*$+V*Y-j*H+J,R[5]=G*H+j*$-L*Y+ce,R[6]=G*Y+L*H-V*$+we,R[7]=-L*$-V*H-j*Y+_e,R},vn.rotateX=function(R,D,M){var L=-D[0],V=-D[1],j=-D[2],G=D[3],$=D[4],H=D[5],Y=D[6],J=D[7],ce=$*G+J*L+H*j-Y*V,we=H*G+J*V+Y*L-$*j,_e=Y*G+J*j+$*V-H*L,be=J*G-$*L-H*V-Y*j;return l.rotateX(R,D,M),R[4]=ce*(G=R[3])+be*(L=R[0])+we*(j=R[2])-_e*(V=R[1]),R[5]=we*G+be*V+_e*L-ce*j,R[6]=_e*G+be*j+ce*V-we*L,R[7]=be*G-ce*L-we*V-_e*j,R},vn.rotateY=function(R,D,M){var L=-D[0],V=-D[1],j=-D[2],G=D[3],$=D[4],H=D[5],Y=D[6],J=D[7],ce=$*G+J*L+H*j-Y*V,we=H*G+J*V+Y*L-$*j,_e=Y*G+J*j+$*V-H*L,be=J*G-$*L-H*V-Y*j;return l.rotateY(R,D,M),R[4]=ce*(G=R[3])+be*(L=R[0])+we*(j=R[2])-_e*(V=R[1]),R[5]=we*G+be*V+_e*L-ce*j,R[6]=_e*G+be*j+ce*V-we*L,R[7]=be*G-ce*L-we*V-_e*j,R},vn.rotateZ=function(R,D,M){var L=-D[0],V=-D[1],j=-D[2],G=D[3],$=D[4],H=D[5],Y=D[6],J=D[7],ce=$*G+J*L+H*j-Y*V,we=H*G+J*V+Y*L-$*j,_e=Y*G+J*j+$*V-H*L,be=J*G-$*L-H*V-Y*j;return l.rotateZ(R,D,M),R[4]=ce*(G=R[3])+be*(L=R[0])+we*(j=R[2])-_e*(V=R[1]),R[5]=we*G+be*V+_e*L-ce*j,R[6]=_e*G+be*j+ce*V-we*L,R[7]=be*G-ce*L-we*V-_e*j,R},vn.rotateByQuatAppend=function(R,D,M){var L=M[0],V=M[1],j=M[2],G=M[3],$=D[0],H=D[1],Y=D[2],J=D[3];return R[0]=$*G+J*L+H*j-Y*V,R[1]=H*G+J*V+Y*L-$*j,R[2]=Y*G+J*j+$*V-H*L,R[3]=J*G-$*L-H*V-Y*j,R[4]=($=D[4])*G+(J=D[7])*L+(H=D[5])*j-(Y=D[6])*V,R[5]=H*G+J*V+Y*L-$*j,R[6]=Y*G+J*j+$*V-H*L,R[7]=J*G-$*L-H*V-Y*j,R},vn.rotateByQuatPrepend=function(R,D,M){var L=D[0],V=D[1],j=D[2],G=D[3],$=M[0],H=M[1],Y=M[2],J=M[3];return R[0]=L*J+G*$+V*Y-j*H,R[1]=V*J+G*H+j*$-L*Y,R[2]=j*J+G*Y+L*H-V*$,R[3]=G*J-L*$-V*H-j*Y,R[4]=L*(J=M[7])+G*($=M[4])+V*(Y=M[6])-j*(H=M[5]),R[5]=V*J+G*H+j*$-L*Y,R[6]=j*J+G*Y+L*H-V*$,R[7]=G*J-L*$-V*H-j*Y,R},vn.rotateAroundAxis=function(R,D,M,L){if(Math.abs(L)<o.EPSILON)return T(R,D);var V=Math.hypot(M[0],M[1],M[2]);L*=.5;var j=Math.sin(L),G=j*M[0]/V,$=j*M[1]/V,H=j*M[2]/V,Y=Math.cos(L),J=D[0],ce=D[1],we=D[2],_e=D[3];R[0]=J*Y+_e*G+ce*H-we*$,R[1]=ce*Y+_e*$+we*G-J*H,R[2]=we*Y+_e*H+J*$-ce*G,R[3]=_e*Y-J*G-ce*$-we*H;var be=D[4],Z=D[5],de=D[6],De=D[7];return R[4]=be*Y+De*G+Z*H-de*$,R[5]=Z*Y+De*$+de*G-be*H,R[6]=de*Y+De*H+be*$-Z*G,R[7]=De*Y-be*G-Z*$-de*H,R},vn.add=function(R,D,M){return R[0]=D[0]+M[0],R[1]=D[1]+M[1],R[2]=D[2]+M[2],R[3]=D[3]+M[3],R[4]=D[4]+M[4],R[5]=D[5]+M[5],R[6]=D[6]+M[6],R[7]=D[7]+M[7],R},vn.multiply=E,vn.scale=function(R,D,M){return R[0]=D[0]*M,R[1]=D[1]*M,R[2]=D[2]*M,R[3]=D[3]*M,R[4]=D[4]*M,R[5]=D[5]*M,R[6]=D[6]*M,R[7]=D[7]*M,R},vn.lerp=function(R,D,M,L){var V=1-L;return P(D,M)<0&&(L=-L),R[0]=D[0]*V+M[0]*L,R[1]=D[1]*V+M[1]*L,R[2]=D[2]*V+M[2]*L,R[3]=D[3]*V+M[3]*L,R[4]=D[4]*V+M[4]*L,R[5]=D[5]*V+M[5]*L,R[6]=D[6]*V+M[6]*L,R[7]=D[7]*V+M[7]*L,R},vn.invert=function(R,D){var M=I(D);return R[0]=-D[0]/M,R[1]=-D[1]/M,R[2]=-D[2]/M,R[3]=D[3]/M,R[4]=-D[4]/M,R[5]=-D[5]/M,R[6]=-D[6]/M,R[7]=D[7]/M,R},vn.conjugate=function(R,D){return R[0]=-D[0],R[1]=-D[1],R[2]=-D[2],R[3]=D[3],R[4]=-D[4],R[5]=-D[5],R[6]=-D[6],R[7]=D[7],R},vn.normalize=function(R,D){var M=I(D);if(M>0){M=Math.sqrt(M);var L=D[0]/M,V=D[1]/M,j=D[2]/M,G=D[3]/M,$=D[4],H=D[5],Y=D[6],J=D[7],ce=L*$+V*H+j*Y+G*J;R[0]=L,R[1]=V,R[2]=j,R[3]=G,R[4]=($-L*ce)/M,R[5]=(H-V*ce)/M,R[6]=(Y-j*ce)/M,R[7]=(J-G*ce)/M}return R},vn.str=function(R){return"quat2("+R[0]+", "+R[1]+", "+R[2]+", "+R[3]+", "+R[4]+", "+R[5]+", "+R[6]+", "+R[7]+")"},vn.exactEquals=function(R,D){return R[0]===D[0]&&R[1]===D[1]&&R[2]===D[2]&&R[3]===D[3]&&R[4]===D[4]&&R[5]===D[5]&&R[6]===D[6]&&R[7]===D[7]},vn.equals=function(R,D){var M=R[0],L=R[1],V=R[2],j=R[3],G=R[4],$=R[5],H=R[6],Y=R[7],J=D[0],ce=D[1],we=D[2],_e=D[3],be=D[4],Z=D[5],de=D[6],De=D[7];return Math.abs(M-J)<=o.EPSILON*Math.max(1,Math.abs(M),Math.abs(J))&&Math.abs(L-ce)<=o.EPSILON*Math.max(1,Math.abs(L),Math.abs(ce))&&Math.abs(V-we)<=o.EPSILON*Math.max(1,Math.abs(V),Math.abs(we))&&Math.abs(j-_e)<=o.EPSILON*Math.max(1,Math.abs(j),Math.abs(_e))&&Math.abs(G-be)<=o.EPSILON*Math.max(1,Math.abs(G),Math.abs(be))&&Math.abs($-Z)<=o.EPSILON*Math.max(1,Math.abs($),Math.abs(Z))&&Math.abs(H-de)<=o.EPSILON*Math.max(1,Math.abs(H),Math.abs(de))&&Math.abs(Y-De)<=o.EPSILON*Math.max(1,Math.abs(Y),Math.abs(De))},vn.sqrLen=vn.squaredLength=vn.len=vn.length=vn.dot=vn.mul=vn.setReal=vn.getReal=void 0;var o=f($t()),l=f(tn()),p=f(We());function _(R){if("function"!=typeof WeakMap)return null;var D=new WeakMap,M=new WeakMap;return(_=function(L){return L?M:D})(R)}function f(R,D){if(R&&R.__esModule)return R;if(null===R||"object"!==u(R)&&"function"!=typeof R)return{default:R};var M=_(D);if(M&&M.has(R))return M.get(R);var L={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in R)if("default"!==j&&Object.prototype.hasOwnProperty.call(R,j)){var G=V?Object.getOwnPropertyDescriptor(R,j):null;G&&(G.get||G.set)?Object.defineProperty(L,j,G):L[j]=R[j]}return L.default=R,M&&M.set(R,L),L}function y(R,D,M){var L=.5*M[0],V=.5*M[1],j=.5*M[2],G=D[0],$=D[1],H=D[2],Y=D[3];return R[0]=G,R[1]=$,R[2]=H,R[3]=Y,R[4]=L*Y+V*H-j*$,R[5]=V*Y+j*G-L*H,R[6]=j*Y+L*$-V*G,R[7]=-L*G-V*$-j*H,R}function T(R,D){return R[0]=D[0],R[1]=D[1],R[2]=D[2],R[3]=D[3],R[4]=D[4],R[5]=D[5],R[6]=D[6],R[7]=D[7],R}function E(R,D,M){var L=D[0],V=D[1],j=D[2],G=D[3],$=M[4],H=M[5],Y=M[6],J=M[7],ce=D[4],we=D[5],_e=D[6],be=D[7],Z=M[0],de=M[1],De=M[2],Be=M[3];return R[0]=L*Be+G*Z+V*De-j*de,R[1]=V*Be+G*de+j*Z-L*De,R[2]=j*Be+G*De+L*de-V*Z,R[3]=G*Be-L*Z-V*de-j*De,R[4]=L*J+G*$+V*Y-j*H+ce*Be+be*Z+we*De-_e*de,R[5]=V*J+G*H+j*$-L*Y+we*Be+be*de+_e*Z-ce*De,R[6]=j*J+G*Y+L*H-V*$+_e*Be+be*De+ce*de-we*Z,R[7]=G*J-L*$-V*H-j*Y+be*Be-ce*Z-we*de-_e*De,R}vn.getReal=l.copy,vn.setReal=l.copy,vn.mul=E;var P=l.dot;vn.dot=P;var w=l.length;vn.length=w,vn.len=w;var I=l.squaredLength;return vn.squaredLength=I,vn.sqrLen=I,vn}());Se.quat2=T;var E=R(br());Se.vec2=E;var P=R(Ve());Se.vec3=P;var w=R(ct());function I(D){if("function"!=typeof WeakMap)return null;var M=new WeakMap,L=new WeakMap;return(I=function(V){return V?L:M})(D)}function R(D,M){if(D&&D.__esModule)return D;if(null===D||"object"!==u(D)&&"function"!=typeof D)return{default:D};var L=I(M);if(L&&L.has(D))return L.get(D);var V={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in D)if("default"!==G&&Object.prototype.hasOwnProperty.call(D,G)){var $=j?Object.getOwnPropertyDescriptor(D,G):null;$&&($.get||$.set)?Object.defineProperty(V,G,$):V[G]=D[G]}return V.default=D,L&&L.set(D,V),V}return Se.vec4=w,Se}(),dn=dt(function(){if(On)return ds;function u(o,l,p,_){this.cx=3*o,this.bx=3*(p-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(_-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=l,this.p2x=p,this.p2y=_}return On=1,ds=u,u.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,l){if(void 0===l&&(l=1e-6),o<0)return 0;if(o>1)return 1;for(var p=o,_=0;_<8;_++){var f=this.sampleCurveX(p)-o;if(Math.abs(f)<l)return p;var y=this.sampleCurveDerivativeX(p);if(Math.abs(y)<1e-6)break;p-=f/y}var T=0,E=1;for(p=o,_=0;_<20&&(f=this.sampleCurveX(p),!(Math.abs(f-o)<l));_++)o>f?T=p:E=p,p=.5*(E-T)+T;return p},solve:function(o,l){return this.sampleCurveY(this.solveCurveX(o,l))}},ds}());function st(){if($s)return ks;function u(o,l){this.x=o,this.y=l}return $s=1,ks=u,u.prototype={clone:function(){return new u(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,l){return this.clone()._rotateAround(o,l)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var l=o.x-this.x,p=o.y-this.y;return l*l+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,l){return Math.atan2(this.x*l-this.y*o,this.x*o+this.y*l)},_matMult:function(o){var l=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=l,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var l=Math.cos(o),p=Math.sin(o),_=p*this.x+l*this.y;return this.x=l*this.x-p*this.y,this.y=_,this},_rotateAround:function(o,l){var p=Math.cos(o),_=Math.sin(o),f=l.y+_*(this.x-l.x)+p*(this.y-l.y);return this.x=l.x+p*(this.x-l.x)-_*(this.y-l.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},u.convert=function(o){return o instanceof u?o:Array.isArray(o)?new u(o[0],o[1]):o},ks}var Ht=dt(st());function ao(u,o){if(Array.isArray(u)){if(!Array.isArray(o)||u.length!==o.length)return!1;for(let l=0;l<u.length;l++)if(!ao(u[l],o[l]))return!1;return!0}if("object"==typeof u&&null!==u&&null!==o){if("object"!=typeof o||Object.keys(u).length!==Object.keys(o).length)return!1;for(const l in u)if(!ao(u[l],o[l]))return!1;return!0}return u===o}const Hi=Math.PI/180,Ao=180/Math.PI;function pi(u){return u*Hi}function Oe(u){return u*Ao}const ae=[[0,0],[1,0],[1,1],[0,1]];function he(u){if(u<=0)return 0;if(u>=1)return 1;const o=u*u,l=o*u;return 4*(u<.5?l:3*(u-o)+l-.75)}function Ze(u,o,l,p){const _=new dn(u,o,l,p);return function(f){return _.solve(f)}}const kt=Ze(.25,.1,.25,1);function Bt(u,o,l){return Math.min(l,Math.max(o,u))}function In(u,o,l){return(l=Bt((l-u)/(o-u),0,1))*l*(3-2*l)}function hr(u,o,l){const p=l-o,_=((u-o)%p+p)%p+o;return _===o?l:_}function kr(u,o,l){if(!u.length)return l(null,[]);let p=u.length;const _=new Array(u.length);let f=null;u.forEach((y,T)=>{o(y,(E,P)=>{E&&(f=E),_[T]=P,0==--p&&l(f,_)})})}function yr(u,...o){for(const l of o)for(const p in l)u[p]=l[p];return u}let lo=1;function Eo(){return lo++}function Jl(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))}function Dc(u,o){u.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function ul(u,o){return-1!==u.indexOf(o,u.length-o.length)}function Pa(u,o,l){const p={};for(const _ in u)p[_]=o.call(this,u[_],_,u);return p}function Xu(u,o,l){const p={};for(const _ in u)o.call(this,u[_],_,u)&&(p[_]=u[_]);return p}function dl(u){return Array.isArray(u)?u.map(dl):"object"==typeof u&&u?Pa(u,dl):u}const Nd={};function Ki(u){Nd[u]||("undefined"!=typeof console&&console.warn(u),Nd[u]=!0)}function Kl(u,o,l){return(l.y-u.y)*(o.x-u.x)>(o.y-u.y)*(l.x-u.x)}function Bd(u){let o=0;for(let l,p,_=0,f=u.length,y=f-1;_<f;y=_++)l=u[_],p=u[y],o+=(p.x-l.x)*(l.y+p.y);return o}function Ha([u,o,l]){const p=pi(o+90),_=pi(l);return{x:u*Math.cos(p)*Math.sin(_),y:u*Math.sin(p)*Math.sin(_),z:u*Math.cos(_),azimuthal:o,polar:l}}function Zu(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Uh(u){const o={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,p,_,f)=>{const y=_||f;return o[p]=!y||y.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let Hh=null;function zd(u,o){return[u[4*o],u[4*o+1],u[4*o+2],u[4*o+3]]}function qh(u,o,l,p){for(;o<l;){const _=o+l>>1;u[_]<p?o=_+1:l=_}return o}function gt(u,o,l,p){for(;o<l;){const _=o+l>>1;u[_]<=p?o=_+1:l=_}return o}function le(u){return u>0?1/(1.001-u):1+u}function fe(u){return u>0?1-1/(1.001-u):-u}const Me={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Me.API_URL)return null;try{const u=new URL(Me.API_URL);return"api.mapbox.cn"===u.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===u.hostname?"https://events.mapbox.com/events/v2":null}catch(u){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ge(u){return Me.API_URL_REGEX.test(u)}function Le(u){return Me.API_SPRITE_REGEX.test(u)}let Je,mt,nt,_t,Dt,Et;function Yt(){return null==Je&&(Je=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),Je}const hn={now:()=>void 0!==_t?_t:performance.now(),setNow(u){_t=u},restoreNow(){_t=void 0},frame(u){const o=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(u,o=0){const{width:l,height:p}=u;Dt||(Dt=document.createElement("canvas"));const _=Dt.getContext("2d",{willReadFrequently:!0});if(!_)throw new Error("failed to create canvas 2d context");return(l>Dt.width||p>Dt.height)&&(Dt.width=l,Dt.height=p),_.clearRect(-o,-o,l+2*o,p+2*o),_.drawImage(u,0,0,l,p),_.getImageData(-o,-o,l+2*o,p+2*o)},resolveURL:u=>(mt||(mt=document.createElement("a")),mt.href=u,mt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==nt&&(nt=window.matchMedia("(prefers-reduced-motion: reduce)")),nt.matches)},hasCanvasFingerprintNoise(){if(void 0!==Et)return Et;if(!Yt())return Et=!1,!1;const u=new OffscreenCanvas(85,1),o=u.getContext("2d",{willReadFrequently:!0});let l=0;for(let _=0;_<u.width;++_)o.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,o.fillRect(_,0,1,1);const p=o.getImageData(0,0,u.width,u.height);l=0;for(let _=0;_<p.data.length;++_)if(_%4!=3&&l++!==p.data[_])return Et=!0,!0;return Et=!1,!1}};function mn(u,o){const l=u.indexOf("?");if(l<0)return`${u}?${new URLSearchParams(o).toString()}`;const p=new URLSearchParams(u.slice(l));for(const _ in o)p.set(_,o[_]);return`${u.slice(0,l)}?${p.toString()}`}function ai(u,o={persistentParams:[]}){const l=u.indexOf("?");if(l<0)return u;const p=new URLSearchParams,_=new URLSearchParams(u.slice(l));for(const y of o.persistentParams){const T=_.get(y);T&&p.set(y,T)}const f=p.toString();return`${u.slice(0,l)}${f.length>0?`?${f}`:""}`}const mi="mapbox-tiles";let gi=500,di=50;const vr=["language","worldview","jobid"];let lr,Pi;function tr(){try{return caches}catch(u){}}function co(){const u=tr();u&&null==lr&&(lr=u.open(mi))}let Ar=1/0;const Qo={supported:!1,testSupport:function(u){!lu&&Ws&&(Il?Gh(u):uo=u)}};let uo,Ws,lu=!1,Il=!1;const Vd="undefined"!=typeof self?self:{};function Gh(u){const o=u.createTexture();u.bindTexture(u.TEXTURE_2D,o);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Ws),u.isContextLost())return;Qo.supported=!0}catch(l){}u.deleteTexture(o),lu=!0}Vd.document&&(Ws=Vd.document.createElement("img"),Ws.onload=function(){uo&&Gh(uo),uo=null,Il=!0},Ws.onerror=function(){lu=!0,uo=null},Ws.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const cu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(cu);class ig extends Error{constructor(o,l,p){401===l&&Ge(p)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=p}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Cf=Zu()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Yu=function(u,o){if(!(/^file:/.test(l=u.url)||/^file:/.test(Cf())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(p,_){const f=new AbortController,y=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Cf(),referrerPolicy:p.referrerPolicy,signal:f.signal});let T=!1,E=!1;const P=(w=y.url).indexOf("sku=")>0&&Ge(w);var w;"json"===p.type&&y.headers.set("Accept","application/json");const I=(D,M,L)=>{if(E)return;if(D&&"SecurityError"!==D.message&&Ki(D.toString()),M&&L)return R(M);const V=Date.now();fetch(y).then(j=>{if(j.ok){const G=P?j.clone():null;return R(j,G,V)}return _(new ig(j.statusText,j.status,p.url))}).catch(j=>{"AbortError"!==j.name&&_(new Error(`${j.message} ${p.url}`))})},R=(D,M,L)=>{("arrayBuffer"===p.type?D.arrayBuffer():"json"===p.type?D.json():D.text()).then(V=>{E||(M&&L&&function(j,G,$){if(co(),null==lr)return;const H=Uh(G.headers.get("Cache-Control")||"");if(H["no-store"])return;const Y={status:G.status,statusText:G.statusText,headers:new Headers};G.headers.forEach((we,_e)=>Y.headers.set(_e,we)),H["max-age"]&&Y.headers.set("Expires",new Date($+1e3*H["max-age"]).toUTCString());const J=Y.headers.get("Expires");if(!J||new Date(J).getTime()-$<42e4)return;let ce=ai(j.url,{persistentParams:vr});if(206===G.status){const we=j.headers.get("Range");if(!we)return;Y.status=200,ce=mn(ce,{range:we})}!function(we,_e){if(void 0===Pi)try{new Response(new ReadableStream),Pi=!0}catch(be){Pi=!1}Pi?_e(we.body):we.blob().then(_e)}(G,we=>{const _e=new Response(200!==(be=G.status)&&404!==be&&[101,103,204,205,304].includes(be)?null:we,Y);var be;co(),null!=lr&&lr.then(Z=>Z.put(ce,_e)).catch(Z=>Ki(Z.message))})}(y,M,L),T=!0,_(null,V,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(V=>{E||_(new Error(V.message))})};return P?function(D,M){if(co(),null==lr)return M(null);lr.then(L=>{let V=ai(D.url,{persistentParams:vr});const j=D.headers.get("Range");j&&(V=mn(V,{range:j})),L.match(V).then(G=>{const $=function(H){if(!H)return!1;const Y=new Date(H.headers.get("Expires")||0),J=Uh(H.headers.get("Cache-Control")||"");return Y>Date.now()&&!J["no-cache"]}(G);L.delete(V),$&&L.put(V,G.clone()),M(null,G,$)}).catch(M)}).catch(M)}(y,I):I(null,null),{cancel:()=>{E=!0,T||f.abort()}}}(u,o);if(Zu()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,o,void 0,!0)}var l;return function(p,_){const f=new XMLHttpRequest;f.open(p.method||"GET",p.url,!0),"arrayBuffer"===p.type&&(f.responseType="arraybuffer");for(const y in p.headers)f.setRequestHeader(y,p.headers[y]);return"json"===p.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===p.credentials,f.onerror=()=>{_(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let y=f.response;if("json"===p.type)try{y=JSON.parse(f.response)}catch(T){return _(T)}_(null,y,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else _(new ig(f.statusText,f.status,p.url))},f.send(p.body),{cancel:()=>f.abort()}}(u,o)},jd=function(u,o){return Yu(yr(u,{type:"arrayBuffer"}),o)};function hl(u){const o=document.createElement("a");return o.href=u,o.protocol===location.protocol&&o.host===location.host}const Ml="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Al,ya;Al=[],ya=0;const Ql=function(u,o){if(Qo.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),ya>=Me.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:u,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return Al.push(f),f}ya++;let l=!1;const p=()=>{if(!l)for(l=!0,ya--;Al.length&&ya<Me.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Al.shift(),{requestParameters:y,callback:T,cancelled:E}=f;E||(f.cancel=Ql(y,T).cancel)}},_=jd(u,(f,y,T,E)=>{p(),f?o(f):y&&(self.createImageBitmap?function(P,w){const I=new Blob([new Uint8Array(P)],{type:"image/png"});createImageBitmap(I).then(R=>{w(null,R)}).catch(R=>{w(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(P,w)=>o(P,w,T,E)):function(P,w){const I=new Image;I.onload=()=>{w(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=Ml})},I.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new Blob([new Uint8Array(P)],{type:"image/png"});I.src=P.byteLength?URL.createObjectURL(R):Ml}(y,(P,w)=>o(P,w,T,E)))});return{cancel:()=>{_.cancel(),p()}}};var $h,es,Oo,Rl={exports:{}},Ud={exports:{}},Ro={exports:{}},Cr=dt(function(){if(Oo)return Rl.exports;Oo=1;var u=($h||($h=1,Ud.exports=function(l,p){var _,f,y,T,E,P,w,I;for(f=l.length-(_=3&l.length),y=p,E=3432918353,P=461845907,I=0;I<f;)w=255&l.charCodeAt(I)|(255&l.charCodeAt(++I))<<8|(255&l.charCodeAt(++I))<<16|(255&l.charCodeAt(++I))<<24,++I,y=27492+(65535&(T=5*(65535&(y=(y^=w=(65535&(w=(w=(65535&w)*E+(((w>>>16)*E&65535)<<16)&4294967295)<<15|w>>>17))*P+(((w>>>16)*P&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(w=0,_){case 3:w^=(255&l.charCodeAt(I+2))<<16;case 2:w^=(255&l.charCodeAt(I+1))<<8;case 1:y^=w=(65535&(w=(w=(65535&(w^=255&l.charCodeAt(I)))*E+(((w>>>16)*E&65535)<<16)&4294967295)<<15|w>>>17))*P+(((w>>>16)*P&65535)<<16)&4294967295}return y^=l.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Ud.exports),o=(es||(es=1,Ro.exports=function(l,p){for(var _,f=l.length,y=p^f,T=0;f>=4;)_=1540483477*(65535&(_=255&l.charCodeAt(T)|(255&l.charCodeAt(++T))<<8|(255&l.charCodeAt(++T))<<16|(255&l.charCodeAt(++T))<<24))+((1540483477*(_>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),f-=4,++T;switch(f){case 3:y^=(255&l.charCodeAt(T+2))<<16;case 2:y^=(255&l.charCodeAt(T+1))<<8;case 1:y=1540483477*(65535&(y^=255&l.charCodeAt(T)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),Ro.exports);return Rl.exports=u,Rl.exports.murmur3=u,Rl.exports.murmur2=o,Rl.exports}());class ec{constructor(o,...l){yr(this,l[0]||{}),this.type=o}}class Wh extends ec{constructor(o,l={}){super("error",yr({error:o},l))}}function Dr(u,o,l){l[u]&&-1!==l[u].indexOf(o)||(l[u]=l[u]||[],l[u].push(o))}function $i(u,o,l){if(l&&l[u]){const p=l[u].indexOf(o);-1!==p&&l[u].splice(p,1)}}class uu{on(o,l){return this._listeners=this._listeners||{},Dr(o,l,this._listeners),this}off(o,l){return $i(o,l,this._listeners),$i(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Dr(o,l,this._oneTimeListeners),this):new Promise(p=>this.once(o,p))}fire(o,l){const p="string"==typeof o?new ec(o,l):o,_=p.type;if(this.listens(_)){p.target=this;const f=this._listeners&&this._listeners[_]?this._listeners[_].slice():[];for(const E of f)E.call(this,p);const y=this._oneTimeListeners&&this._oneTimeListeners[_]?this._oneTimeListeners[_].slice():[];for(const E of y)$i(_,E,this._oneTimeListeners),E.call(this,p);const T=this._eventedParent;T&&(yr(p,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),T.fire(p))}else p instanceof Wh&&console.error(p.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var rb,qt={},Hd=function(){if(rb)return qt;rb=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(f){return(f=Math.round(f))<0?0:f>255?255:f}function l(f){return o("%"===f[f.length-1]?parseFloat(f)/100*255:parseInt(f))}function p(f){return(y="%"===f[f.length-1]?parseFloat(f)/100:parseFloat(f))<0?0:y>1?1:y;var y}function _(f,y,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?f+(y-f)*T*6:2*T<1?y:3*T<2?f+(y-f)*(2/3-T)*6:f}try{qt.parseCSSColor=function(f){var y,T=f.replace(/ /g,"").toLowerCase();if(T in u)return u[T].slice();if("#"===T[0])return 4===T.length?(y=parseInt(T.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:7===T.length&&(y=parseInt(T.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var E=T.indexOf("("),P=T.indexOf(")");if(-1!==E&&P+1===T.length){var w=T.substr(0,E),I=T.substr(E+1,P-(E+1)).split(","),R=1;switch(w){case"rgba":if(4!==I.length)return null;R=p(I.pop());case"rgb":return 3!==I.length?null:[l(I[0]),l(I[1]),l(I[2]),R];case"hsla":if(4!==I.length)return null;R=p(I.pop());case"hsl":if(3!==I.length)return null;var D=(parseFloat(I[0])%360+360)%360/360,M=p(I[1]),L=p(I[2]),V=L<=.5?L*(M+1):L+M-L*M,j=2*L-V;return[o(255*_(j,V,D+1/3)),o(255*_(j,V,D)),o(255*_(j,V,D-1/3)),R];default:return null}}return null}}catch(f){}return qt}();class Gn{constructor(o,l,p,_=1){this.r=o,this.g=l,this.b=p,this.a=_}static parse(o){if(!o)return;if(o instanceof Gn)return o;if("string"!=typeof o)return;const l=Hd.parseCSSColor(o);return l?new Gn(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,p,_]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(p)},${_})`}toRenderColor(o){const{r:l,g:p,b:_,a:f}=this;return new bo(o,l,p,_,f)}}class bo{constructor(o,l,p,_,f){if(o){const y=o.image.height,T=y*y;l=0===f?0:l/f*(y-1),p=0===f?0:p/f*(y-1),_=0===f?0:_/f*(y-1);const E=Math.floor(l),P=Math.floor(p),w=Math.floor(_),I=Math.ceil(l),R=Math.ceil(p),D=Math.ceil(_),M=l-E,L=p-P,V=_-w,j=o.image.data,G=4*(E+P*T+w*y),$=4*(E+P*T+D*y),H=4*(E+R*T+w*y),Y=4*(E+R*T+D*y),J=4*(I+P*T+w*y),ce=4*(I+P*T+D*y),we=4*(I+R*T+w*y),_e=4*(I+R*T+D*y);if(G<0||_e>=j.length)throw new Error("out of range");this.r=ni(ni(ni(j[G],j[$],V),ni(j[H],j[Y],V),L),ni(ni(j[J],j[ce],V),ni(j[we],j[_e],V),L),M)/255*f,this.g=ni(ni(ni(j[G+1],j[$+1],V),ni(j[H+1],j[Y+1],V),L),ni(ni(j[J+1],j[ce+1],V),ni(j[we+1],j[_e+1],V),L),M)/255*f,this.b=ni(ni(ni(j[G+2],j[$+2],V),ni(j[H+2],j[Y+2],V),L),ni(ni(j[J+2],j[ce+2],V),ni(j[we+2],j[_e+2],V),L),M)/255*f,this.a=f}else this.r=l,this.g=p,this.b=_,this.a=f}toArray(){const{r:o,g:l,b:p,a:_}=this;return 0===_?[0,0,0,0]:[255*o/_,255*l/_,255*p/_,_]}toArray01(){const{r:o,g:l,b:p,a:_}=this;return 0===_?[0,0,0,0]:[o/_,l/_,p/_,_]}toArray01Scaled(o){const{r:l,g:p,b:_,a:f}=this;return 0===f?[0,0,0]:[l/f*o,p/f*o,_/f*o]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:p,a:_}=this;return[o,l,p,_]}toArray01Linear(){const{r:o,g:l,b:p,a:_}=this;return 0===_?[0,0,0,0]:[Math.pow(o/_,2.2),Math.pow(l/_,2.2),Math.pow(p/_,2.2),_]}}function ni(u,o,l){return u*(1-l)+o*l}function Df(u,o,l){return u.map((p,_)=>ni(p,o[_],l))}Gn.black=new Gn(0,0,0,1),Gn.white=new Gn(1,1,1,1),Gn.transparent=new Gn(0,0,0,0),Gn.red=new Gn(1,0,0,1),Gn.blue=new Gn(0,0,1,1);var Ju=Object.freeze({__proto__:null,array:Df,color:function(u,o,l){return new Gn(ni(u.r,o.r,l),ni(u.g,o.g,l),ni(u.b,o.b,l),ni(u.a,o.a,l))},number:ni});function Ec(u,...o){for(const l of o)for(const p in l)u[p]=l[p];return u}class ts extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}class og{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[p,_]of l)this.bindings[p]=_}concat(o){return new og(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Pl={kind:"null"},An={kind:"number"},ki={kind:"string"},nr={kind:"boolean"},qa={kind:"color"},va={kind:"object"},cr={kind:"value"},Ef={kind:"collator"},Xh={kind:"formatted"},qd={kind:"resolvedImage"};function ka(u,o){return{kind:"array",itemType:u,N:o}}function Lr(u){if("array"===u.kind){const o=Lr(u.itemType);return"number"==typeof u.N?`array<${o}, ${u.N}>`:"value"===u.itemType.kind?"array":`array<${o}>`}return u.kind}const yo=[Pl,An,ki,nr,qa,Xh,va,ka(cr),qd];function Zh(u,o){if("error"===o.kind)return null;if("array"===u.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!Zh(u.itemType,o.itemType))&&("number"!=typeof u.N||u.N===o.N))return null}else{if(u.kind===o.kind)return null;if("value"===u.kind)for(const l of yo)if(!Zh(l,o))return null}return`Expected ${Lr(u)} but found ${Lr(o)} instead.`}function Yh(u,o){return o.some(l=>l.kind===u.kind)}function Ic(u,o){return o.some(l=>"null"===l?null===u:"array"===l?Array.isArray(u):"object"===l?u&&!Array.isArray(u)&&"object"==typeof u:l===typeof u)}class wn{constructor(o,l,p){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class pl{constructor(o,l,p,_,f){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=p,this.fontStack=_,this.textColor=f}}class Nn{constructor(o){this.sections=o}static fromString(o){return new Nn([new pl(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.namePrimary.length)}static factory(o){return o instanceof Nn?o:Nn.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.namePrimary]);continue}o.push(l.text);const p={};l.fontStack&&(p["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(p["font-scale"]=l.scale),l.textColor&&(p["text-color"]=["rgba"].concat(l.textColor.toRenderColor(null).toArray())),o.push(p)}return o}}class Ns{constructor(o){this.namePrimary=o.namePrimary,o.nameSecondary&&(this.nameSecondary=o.nameSecondary),this.available=o.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(o,l){return o?new Ns({namePrimary:o,nameSecondary:l,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function ob(u,o,l,p){return"number"==typeof u&&u>=0&&u<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===p||"number"==typeof p&&p>=0&&p<=1?null:`Invalid rgba value [${[u,o,l,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof p?[u,o,l,p]:[u,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Mc(u){if(null===u||"string"==typeof u||"boolean"==typeof u||"number"==typeof u||u instanceof Gn||u instanceof wn||u instanceof Nn||u instanceof Ns)return!0;if(Array.isArray(u)){for(const o of u)if(!Mc(o))return!1;return!0}if("object"==typeof u){for(const o in u)if(!Mc(u[o]))return!1;return!0}return!1}function ns(u){if(null===u)return Pl;if("string"==typeof u)return ki;if("boolean"==typeof u)return nr;if("number"==typeof u)return An;if(u instanceof Gn)return qa;if(u instanceof wn)return Ef;if(u instanceof Nn)return Xh;if(u instanceof Ns)return qd;if(Array.isArray(u)){const o=u.length;let l;for(const p of u){const _=ns(p);if(l){if(l===_)continue;l=cr;break}l=_}return ka(l||cr,o)}return va}function xa(u){const o=typeof u;return null===u?"":"string"===o||"number"===o||"boolean"===o?String(u):u instanceof Gn||u instanceof Nn||u instanceof Ns?u.toString():JSON.stringify(u)}class fl{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Mc(o[1]))return l.error("invalid value");const p=o[1];let _=ns(p);const f=l.expectedType;return"array"!==_.kind||0!==_.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(_=f),new fl(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Gn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Nn?this.value.serialize():this.value}}class is{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Jh={string:ki,number:An,boolean:nr,object:va};class ml{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let p,_=1;const f=o[0];if("array"===f){let T,E;if(o.length>2){const P=o[1];if("string"!=typeof P||!(P in Jh)||"object"===P)return l.error('The item type argument of "array" must be one of string, number, boolean',1);T=Jh[P],_++}else T=cr;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);E=o[2],_++}p=ka(T,E)}else p=Jh[f];const y=[];for(;_<o.length;_++){const T=l.parse(o[_],_,cr);if(!T)return null;y.push(T)}return new ml(p,y)}evaluate(o){for(let l=0;l<this.args.length;l++){const p=this.args[l].evaluate(o);if(!Zh(this.type,ns(p)))return p;if(l===this.args.length-1)throw new is(`The expression ${JSON.stringify(this.args[l].serialize())} evaluated to ${Lr(ns(p))} but was expected to be of type ${Lr(this.type)}.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const p=o.itemType;if("string"===p.kind||"number"===p.kind||"boolean"===p.kind){l.push(p.kind);const _=o.N;("number"==typeof _||this.args.length>1)&&l.push(_)}}return l.concat(this.args.map(p=>p.serialize()))}}class Gd{constructor(o){this.type=Xh,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const p=o[1];if(!Array.isArray(p)&&"object"==typeof p)return l.error("First argument must be an image or text section.");const _=[];let f=!1;for(let y=1;y<=o.length-1;++y){const T=o[y];if(f&&"object"==typeof T&&!Array.isArray(T)){f=!1;let E=null;if(T["font-scale"]&&(E=l.parseObjectValue(T["font-scale"],y,"font-scale",An),!E))return null;let P=null;if(T["text-font"]&&(P=l.parseObjectValue(T["text-font"],y,"text-font",ka(ki)),!P))return null;let w=null;if(T["text-color"]&&(w=l.parseObjectValue(T["text-color"],y,"text-color",qa),!w))return null;const I=_[_.length-1];I.scale=E,I.font=P,I.textColor=w}else{const E=l.parse(o[y],y,cr);if(!E)return null;const P=E.type.kind;if("string"!==P&&"value"!==P&&"null"!==P&&"resolvedImage"!==P)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,_.push({content:E,scale:null,font:null,textColor:null})}}return new Gd(_)}evaluate(o){return new Nn(this.sections.map(l=>{const p=l.content.evaluate(o);return ns(p)===qd?new pl("",p,null,null,null):new pl(xa(p),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const p={};l.scale&&(p["font-scale"]=l.scale.serialize()),l.font&&(p["text-font"]=l.font.serialize()),l.textColor&&(p["text-color"]=l.textColor.serialize()),o.push(p)}return o}}class Ei{constructor(o,l){this.type=qd,this.inputPrimary=o,this.inputSecondary=l}static parse(o,l){if(o.length<2)return l.error("Expected two or more arguments.");const p=l.parse(o[1],1,ki);if(!p)return l.error("No image name provided.");if(2===o.length)return new Ei(p);const _=l.parse(o[2],1,ki);return _?new Ei(p,_):l.error("Secondary image variant is not a string.")}evaluate(o){const l=Ns.fromString(this.inputPrimary.evaluate(o),this.inputSecondary?this.inputSecondary.evaluate(o):void 0);return l&&o.availableImages&&(l.available=o.availableImages.indexOf(l.namePrimary)>-1,l.nameSecondary&&l.available&&o.availableImages&&(l.available=o.availableImages.indexOf(l.nameSecondary)>-1)),l}eachChild(o){o(this.inputPrimary),this.inputSecondary&&o(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ac(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":null===u?"null":typeof u}const If={"to-boolean":nr,"to-color":qa,"to-number":An,"to-string":ki};class Ts{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const p=o[0],_=[];let f=Pl;if("to-array"===p){if(!Array.isArray(o[1]))return null;const y=o[1].length;if(l.expectedType){if("array"!==l.expectedType.kind)return l.error(`Expected ${l.expectedType.kind} but found array.`);f=ka(l.expectedType.itemType,y)}else{if(!(y>0&&Mc(o[1][0])))return null;f=ka(ns(o[1][0]),y)}for(let T=0;T<y;T++){const E=o[1][T];let P;if("array"===Ac(E))P=l.parse(E,void 0,f.itemType);else{const w=Ac(E);if(w!==f.itemType.kind)return l.error(`Expected ${f.itemType.kind} but found ${w}.`);P=l.registry.literal.parse(["literal",void 0===E?null:E],l)}if(!P)return null;_.push(P)}}else{if(("to-boolean"===p||"to-string"===p)&&2!==o.length)return l.error("Expected one argument.");f=If[p];for(let y=1;y<o.length;y++){const T=l.parse(o[y],y,cr);if(!T)return null;_.push(T)}}return new Ts(f,_)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let l,p;for(const _ of this.args){if(l=_.evaluate(o),p=null,l instanceof Gn)return l;if("string"==typeof l){const f=o.parseColor(l);if(f)return f}else if(Array.isArray(l)&&(p=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:ob(l[0],l[1],l[2],l[3]),!p))return new Gn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new is(p||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const p of this.args){if(l=p.evaluate(o),null===l)return 0;const _=Number(l);if(!isNaN(_))return _}throw new is(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Nn.fromString(xa(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?Ns.fromString(xa(this.args[0].evaluate(o))):"array"===this.type.kind?this.args.map(l=>l.evaluate(o)):xa(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Gd([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ei(this.args[0]).serialize();const o="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}const sb=["Unknown","Point","LineString","Polygon"];class Rv{constructor(o,l){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=o,this.options=l}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?sb[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(o){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:p,y:_}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(p*l-o[0])+this.featureDistanceData.bearing[1]*(_*l-o[1])}return 0}parseColor(o){let l=this._parseColorCache[o];return l||(l=this._parseColorCache[o]=Gn.parse(o)),l}getConfig(o){return this.options?this.options.get(o):null}}class bs{constructor(o,l,p,_,f){this.name=o,this.type=l,this._evaluate=p,this.args=_,this._overloadIndex=f}evaluate(o){if(!this._evaluate){const l=bs.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const p=o[0],_=bs.definitions[p];if(!_)return l.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(_)?_[0]:_.type,y=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,T=[];let E=null,P=-1;for(const[w,I]of y){if(Array.isArray(w)&&w.length!==o.length-1)continue;T.push(w),P++,E=new kv(l.registry,l.path,null,l.scope,void 0,l._scope,l.options);const R=[];let D=!1;for(let M=1;M<o.length;M++){const L=o[M],V=Array.isArray(w)?w[M-1]:w.type,j=E.parse(L,1+R.length,V);if(!j){D=!0;break}R.push(j)}if(!D)if(Array.isArray(w)&&w.length!==R.length)E.error(`Expected ${w.length} arguments, but found ${R.length} instead.`);else{for(let M=0;M<R.length;M++){const L=Array.isArray(w)?w[M]:w.type,V=R[M];E.concat(M+1).checkSubtype(L,V.type)}if(0===E.errors.length)return new bs(p,f,I,R,P)}}if(1===T.length)l.errors.push(...E.errors);else{const w=(T.length?T:y.map(([R])=>R)).map(kl).join(" | "),I=[];for(let R=1;R<o.length;R++){const D=l.parse(o[R],1+I.length);if(!D)return null;I.push(Lr(D.type))}l.error(`Expected arguments of type ${w}, but found (${I.join(", ")}) instead.`)}return null}static register(o,l){bs.definitions=l;for(const p in l)o[p]=bs}}function kl(u){return Array.isArray(u)?`(${u.map(Lr).join(", ")})`:`(${Lr(u.type)}...)`}class sg{constructor(o,l,p){this.type=Ef,this.locale=p,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const p=o[1];if("object"!=typeof p||Array.isArray(p))return l.error("Collator options argument must be an object.");const _=void 0===p["case-sensitive"]?l.parse(!1,1,nr):l.parseObjectValue(p["case-sensitive"],1,"case-sensitive",nr);if(!_)return null;const f=void 0===p["diacritic-sensitive"]?l.parse(!1,1,nr):l.parseObjectValue(p["diacritic-sensitive"],1,"diacritic-sensitive",nr);if(!f)return null;let y=null;return p.locale&&(y=l.parseObjectValue(p.locale,1,"locale",ki),!y)?null:new sg(_,f,y)}evaluate(o){return new wn(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}function Pv(u,o,l=0,p=u.length-1,_=vo){for(;p>l;){if(p-l>600){const E=p-l+1,P=o-l+1,w=Math.log(E),I=.5*Math.exp(2*w/3),R=.5*Math.sqrt(w*I*(E-I)/E)*(P-E/2<0?-1:1);Pv(u,o,Math.max(l,Math.floor(o-P*I/E+R)),Math.min(p,Math.floor(o+(E-P)*I/E+R)),_)}const f=u[o];let y=l,T=p;for(oa(u,l,o),_(u[p],f)>0&&oa(u,l,p);y<T;){for(oa(u,y,T),y++,T--;_(u[y],f)<0;)y++;for(;_(u[T],f)>0;)T--}0===_(u[l],f)?oa(u,l,T):(T++,oa(u,T,p)),T<=o&&(l=T+1),o<=T&&(p=T-1)}}function oa(u,o,l){const p=u[o];u[o]=u[l],u[l]=p}function vo(u,o){return u<o?-1:u>o?1:0}function Z1(u){let o=0;for(let l,p,_=0,f=u.length,y=f-1;_<f;y=_++)l=u[_],p=u[y],o+=(p.x-l.x)*(l.y+p.y);return o}function Mf(u,o){u[0]=Math.min(u[0],o[0]),u[1]=Math.min(u[1],o[1]),u[2]=Math.max(u[2],o[0]),u[3]=Math.max(u[3],o[1])}function gl(u,o){return!(u[0]<=o[0]||u[2]>=o[2]||u[1]<=o[1]||u[3]>=o[3])}function xo(u,o,l){const p=u[0]-o[0],_=u[1]-o[1],f=u[0]-l[0],y=u[1]-l[1];return p*y-f*_==0&&p*f<=0&&_*y<=0}function Rc(u,o,l=!1){let p=!1;for(let T=0,E=o.length;T<E;T++){const P=o[T];for(let w=0,I=P.length,R=I-1;w<I;R=w++){const D=P[R],M=P[w];if(xo(u,D,M))return l;(f=D)[1]>(_=u)[1]!=(y=M)[1]>_[1]&&_[0]<(y[0]-f[0])*(_[1]-f[1])/(y[1]-f[1])+f[0]&&(p=!p)}}var _,f,y;return p}function Af(u,o,l,p){const _=p[0]-l[0],f=p[1]-l[1],y=(u[0]-l[0])*f-_*(u[1]-l[1]),T=(o[0]-l[0])*f-_*(o[1]-l[1]);return y>0&&T<0||y<0&&T>0}function $d(u,o,l,p){return(_=[p[0]-l[0],p[1]-l[1]])[0]*(f=[o[0]-u[0],o[1]-u[1]])[1]-_[1]*f[0]!=0&&!(!Af(u,o,l,p)||!Af(l,p,u,o));var _,f}const La=8192;function Si(u,o){const l=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,_=Math.pow(2,o.z);return[Math.round(l*_*La),Math.round(p*_*La)]}function Vn(u,o){for(let l=0;l<o.length;l++)if(Rc(u,o[l]))return!0;return!1}function ag(u,o,l){for(const p of l)for(let _=0,f=p.length,y=f-1;_<f;y=_++)if($d(u,o,p[y],p[_]))return!0;return!1}function Jt(u,o){for(let l=0;l<u.length;++l)if(!Rc(u[l],o))return!1;for(let l=0;l<u.length-1;++l)if(ag(u[l],u[l+1],o))return!1;return!0}function lg(u,o){for(let l=0;l<o.length;l++)if(Jt(u,o[l]))return!0;return!1}function Wd(u,o,l){const p=[];for(let _=0;_<u.length;_++){const f=[];for(let y=0;y<u[_].length;y++){const T=Si(u[_][y],l);Mf(o,T),f.push(T)}p.push(f)}return p}function li(u,o,l){const p=[];for(let _=0;_<u.length;_++){const f=Wd(u[_],o,l);p.push(f)}return p}function ii(u,o,l,p){if(u[0]<l[0]||u[0]>l[2]){const _=.5*p;let f=u[0]-l[0]>_?-p:l[0]-u[0]>_?p:0;0===f&&(f=u[0]-l[2]>_?-p:l[2]-u[0]>_?p:0),u[0]+=f}Mf(o,u)}function Rf(u,o,l,p){const _=Math.pow(2,p.z)*La,f=[p.x*La,p.y*La],y=[];if(!u)return y;for(const T of u)for(const E of T){const P=[E.x+f[0],E.y+f[1]];ii(P,o,l,_),y.push(P)}return y}function Pf(u,o,l,p){const _=Math.pow(2,p.z)*La,f=[p.x*La,p.y*La],y=[];if(!u)return y;for(const E of u){const P=[];for(const w of E){const I=[w.x+f[0],w.y+f[1]];Mf(o,I),P.push(I)}y.push(P)}if(o[2]-o[0]<=_/2){(T=o)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const E of y)for(const P of E)ii(P,o,l,_)}var T;return y}class cn{constructor(o,l){this.type=nr,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Mc(o[1])){const p=o[1];if("FeatureCollection"===p.type)for(let _=0;_<p.features.length;++_){const f=p.features[_].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new cn(p,p.features[_].geometry)}else if("Feature"===p.type){const _=p.geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new cn(p,p.geometry)}else if("Polygon"===p.type||"MultiPolygon"===p.type)return new cn(p,p)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,p){const _=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if("Polygon"===p.type){const T=Wd(p.coordinates,f,y),E=Rf(l.geometry(),_,f,y);if(!gl(_,f))return!1;for(const P of E)if(!Rc(P,T))return!1}if("MultiPolygon"===p.type){const T=li(p.coordinates,f,y),E=Rf(l.geometry(),_,f,y);if(!gl(_,f))return!1;for(const P of E)if(!Vn(P,T))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,p){const _=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if("Polygon"===p.type){const T=Wd(p.coordinates,f,y),E=Pf(l.geometry(),_,f,y);if(!gl(_,f))return!1;for(const P of E)if(!Jt(P,T))return!1}if("MultiPolygon"===p.type){const T=li(p.coordinates,f,y),E=Pf(l.geometry(),_,f,y);if(!gl(_,f))return!1;for(const P of E)if(!lg(P,T))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Cs={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ir=1/298.257223563,Bs=ir*(2-ir),Ds=Math.PI/180;class Ll{static fromTile(o,l,p){const _=Math.PI*(1-2*(o+.5)/Math.pow(2,l)),f=Math.atan(.5*(Math.exp(_)-Math.exp(-_)))/Ds;return new Ll(f,p)}static get units(){return Cs}constructor(o,l){if(void 0===o)throw new Error("No latitude given.");if(l&&!Cs[l])throw new Error(`Unknown unit ${l}. Use one of: ${Object.keys(Cs).join(", ")}`);const p=6378.137*Ds*(l?Cs[l]:1),_=Math.cos(o*Ds),f=1/(1-Bs*(1-_*_)),y=Math.sqrt(f);this.kx=p*y*_,this.ky=p*y*f*(1-Bs)}distance(o,l){const p=Io(o[0]-l[0])*this.kx,_=(o[1]-l[1])*this.ky;return Math.sqrt(p*p+_*_)}bearing(o,l){const p=Io(l[0]-o[0])*this.kx;return Math.atan2(p,(l[1]-o[1])*this.ky)/Ds}destination(o,l,p){const _=p*Ds;return this.offset(o,Math.sin(_)*l,Math.cos(_)*l)}offset(o,l,p){return[o[0]+l/this.kx,o[1]+p/this.ky]}lineDistance(o){let l=0;for(let p=0;p<o.length-1;p++)l+=this.distance(o[p],o[p+1]);return l}area(o){let l=0;for(let p=0;p<o.length;p++){const _=o[p];for(let f=0,y=_.length,T=y-1;f<y;T=f++)l+=Io(_[f][0]-_[T][0])*(_[f][1]+_[T][1])*(p?-1:1)}return Math.abs(l)/2*this.kx*this.ky}along(o,l){let p=0;if(l<=0)return o[0];for(let _=0;_<o.length-1;_++){const f=o[_],y=o[_+1],T=this.distance(f,y);if(p+=T,p>l)return _l(f,y,(l-(p-T))/T)}return o[o.length-1]}pointToSegmentDistance(o,l,p){let[_,f]=l,y=Io(p[0]-_)*this.kx,T=(p[1]-f)*this.ky;if(0!==y||0!==T){const E=(Io(o[0]-_)*this.kx*y+(o[1]-f)*this.ky*T)/(y*y+T*T);E>1?(_=p[0],f=p[1]):E>0&&(_+=y/this.kx*E,f+=T/this.ky*E)}return y=Io(o[0]-_)*this.kx,T=(o[1]-f)*this.ky,Math.sqrt(y*y+T*T)}pointOnLine(o,l){let p=1/0,_=o[0][0],f=o[0][1],y=0,T=0;for(let E=0;E<o.length-1;E++){let P=o[E][0],w=o[E][1],I=Io(o[E+1][0]-P)*this.kx,R=(o[E+1][1]-w)*this.ky,D=0;0===I&&0===R||(D=(Io(l[0]-P)*this.kx*I+(l[1]-w)*this.ky*R)/(I*I+R*R),D>1?(P=o[E+1][0],w=o[E+1][1]):D>0&&(P+=I/this.kx*D,w+=R/this.ky*D)),I=Io(l[0]-P)*this.kx,R=(l[1]-w)*this.ky;const M=I*I+R*R;M<p&&(p=M,_=P,f=w,y=E,T=D)}return{point:[_,f],index:y,t:Math.max(0,Math.min(1,T))}}lineSlice(o,l,p){let _=this.pointOnLine(p,o),f=this.pointOnLine(p,l);if(_.index>f.index||_.index===f.index&&_.t>f.t){const P=_;_=f,f=P}const y=[_.point],T=_.index+1,E=f.index;!sa(p[T],y[0])&&T<=E&&y.push(p[T]);for(let P=T+1;P<=E;P++)y.push(p[P]);return sa(p[E],f.point)||y.push(f.point),y}lineSliceAlong(o,l,p){let _=0;const f=[];for(let y=0;y<p.length-1;y++){const T=p[y],E=p[y+1],P=this.distance(T,E);if(_+=P,_>o&&0===f.length&&f.push(_l(T,E,(o-(_-P))/P)),_>=l)return f.push(_l(T,E,(l-(_-P))/P)),f;_>o&&f.push(E)}return f}bufferPoint(o,l){const p=l/this.ky,_=l/this.kx;return[o[0]-_,o[1]-p,o[0]+_,o[1]+p]}bufferBBox(o,l){const p=l/this.ky,_=l/this.kx;return[o[0]-_,o[1]-p,o[2]+_,o[3]+p]}insideBBox(o,l){return Io(o[0]-l[0])>=0&&Io(o[0]-l[2])<=0&&o[1]>=l[1]&&o[1]<=l[3]}}function sa(u,o){return u[0]===o[0]&&u[1]===o[1]}function _l(u,o,l){const p=Io(o[0]-u[0]);return[u[0]+p*l,u[1]+(o[1]-u[1])*l]}function Io(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class Ku{constructor(o=[],l=((p,_)=>p<_?-1:p>_?1:0)){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:p}=this,_=l[o];for(;o>0;){const f=o-1>>1,y=l[f];if(p(_,y)>=0)break;l[o]=y,o=f}l[o]=_}_down(o){const{data:l,compare:p}=this,_=this.length>>1,f=l[o];for(;o<_;){let y=1+(o<<1);const T=y+1;if(T<this.length&&p(l[T],l[y])<0&&(y=T),p(l[y],f)>=0)break;l[o]=l[y],o=y}l[o]=f}}var an=8192;function du(u,o){return o.dist-u.dist}function wa(u){const o=[1/0,1/0,-1/0,-1/0];if(o.length!==u.length)return!1;for(let l=0;l<o.length;l++)if(o[l]!==u[l])return!1;return!0}function Zn(u){return u[1]-u[0]+1}function Wi(u,o){const l=u[1]>=u[0]&&u[1]<o;return l||console.warn("Distance Expression: Index is out of range"),l}function Fo(u,o){if(u[0]>u[1])return[null,null];const l=Zn(u);if(o){if(2===l)return[u,null];const p=Math.floor(l/2);return[[u[0],u[0]+p],[u[0]+p,u[1]]]}{if(1===l)return[u,null];const p=Math.floor(l/2)-1;return[[u[0],u[0]+p],[u[0]+p+1,u[1]]]}}function Go(u,o){const l=[1/0,1/0,-1/0,-1/0];if(!Wi(o,u.length))return l;for(let p=o[0];p<=o[1];++p)Mf(l,u[p]);return l}function tc(u){const o=[1/0,1/0,-1/0,-1/0];for(let l=0;l<u.length;++l)for(let p=0;p<u[l].length;++p)Mf(o,u[l][p]);return o}function rs(u,o,l){if(wa(u)||wa(o))return NaN;let p=0,_=0;return u[2]<o[0]&&(p=o[0]-u[2]),u[0]>o[2]&&(p=u[0]-o[2]),u[1]>o[3]&&(_=u[1]-o[3]),u[3]<o[1]&&(_=o[1]-u[3]),l.distance([0,0],[p,_])}function hu(u){return 360*u-180}function os(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Xs(u,o){const l=Math.pow(2,o.z),p=(u.y/an+o.y)/l;return[hu((u.x/an+o.x)/l),os(p)]}function Xd(u,o){const l=[];for(let p=0;p<u.length;++p)l.push(Xs(u[p],o));return l}function pr(u,o,l){const p=l.pointOnLine(o,u).point;return l.distance(u,p)}function Zd(u,o,l,p,_){const f=l.slice(p[0],p[1]+1);let y=1/0;for(let T=o[0];T<=o[1];++T)if(0===(y=Math.min(y,pr(u[T],f,_))))return 0;return y}function Pc(u,o,l,p,_){const f=Math.min(_.pointToSegmentDistance(u,l,p),_.pointToSegmentDistance(o,l,p)),y=Math.min(_.pointToSegmentDistance(l,u,o),_.pointToSegmentDistance(p,u,o));return Math.min(f,y)}function Lf(u,o,l,p,_){if(!Wi(o,u.length)||!Wi(p,l.length))return NaN;let f=1/0;for(let y=o[0];y<o[1];++y)for(let T=p[0];T<p[1];++T){if($d(u[y],u[y+1],l[T],l[T+1]))return 0;f=Math.min(f,Pc(u[y],u[y+1],l[T],l[T+1],_))}return f}function pu(u,o,l,p,_){if(!Wi(o,u.length)||!Wi(p,l.length))return NaN;let f=1/0;for(let y=o[0];y<=o[1];++y)for(let T=p[0];T<=p[1];++T)if(0===(f=Math.min(f,_.distance(u[y],l[T]))))return f;return f}function Zs(u,o,l){if(Rc(u,o,!0))return 0;let p=1/0;for(const _ of o){const f=_.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(_[0]!==_[f-1]&&0===(p=Math.min(p,l.pointToSegmentDistance(u,_[f-1],_[0])))||0===(p=Math.min(p,pr(u,_,l))))return p}return p}function Yd(u,o,l,p){if(!Wi(o,u.length))return NaN;for(let f=o[0];f<=o[1];++f)if(Rc(u[f],l,!0))return 0;let _=1/0;for(let f=o[0];f<o[1];++f)for(const y of l)for(let T=0,E=y.length,P=E-1;T<E;P=T++){if($d(u[f],u[f+1],y[P],y[T]))return 0;_=Math.min(_,Pc(u[f],u[f+1],y[P],y[T],p))}return _}function fu(u,o){for(const l of u)for(let p=0;p<=l.length-1;++p)if(Rc(l[p],o,!0))return!0;return!1}function bl(u,o,l,p=1/0){const _=tc(u),f=tc(o);if(p!==1/0&&rs(_,f,l)>=p)return p;if(gl(_,f)){if(fu(u,o))return 0}else if(fu(o,u))return 0;let y=p;for(const T of u)for(let E=0,P=T.length,w=P-1;E<P;w=E++)for(const I of o)for(let R=0,D=I.length,M=D-1;R<D;M=R++){if($d(T[w],T[E],I[M],I[R]))return 0;y=Math.min(y,Pc(T[w],T[E],I[M],I[R],l))}return y}function nc(u,o,l,p,_,f,y){if(null===f||null===y)return;const T=rs(Go(p,f),Go(_,y),l);T<o&&u.push({dist:T,range1:f,range2:y})}function Kh(u,o,l,p,_=1/0){let f=Math.min(p.distance(u[0],l[0][0]),_);if(0===f)return f;const y=new Ku([{dist:0,range1:[0,u.length-1],range2:[0,0]}],du),T=o?50:100,E=tc(l);for(;y.length;){const P=y.pop();if(P.dist>=f)continue;const w=P.range1;if(Zn(w)<=T){if(!Wi(w,u.length))return NaN;if(o){const I=Yd(u,w,l,p);if(0===(f=Math.min(f,I)))return f}else for(let I=w[0];I<=w[1];++I){const R=Zs(u[I],l,p);if(0===(f=Math.min(f,R)))return f}}else{const I=Fo(w,o);if(null!==I[0]){const R=rs(Go(u,I[0]),E,p);R<f&&y.push({dist:R,range1:I[0],range2:[0,0]})}if(null!==I[1]){const R=rs(Go(u,I[1]),E,p);R<f&&y.push({dist:R,range1:I[1],range2:[0,0]})}}}return f}function To(u,o,l,p,_,f=1/0){let y=Math.min(f,_.distance(u[0],l[0]));if(0===y)return y;const T=new Ku([{dist:0,range1:[0,u.length-1],range2:[0,l.length-1]}],du),E=o?50:100,P=p?50:100;for(;T.length;){const w=T.pop();if(w.dist>=y)continue;const I=w.range1,R=w.range2;if(Zn(I)<=E&&Zn(R)<=P){if(!Wi(I,u.length)||!Wi(R,l.length))return NaN;if(o&&p?y=Math.min(y,Lf(u,I,l,R,_)):o||p?o&&!p?y=Math.min(y,Zd(l,R,u,I,_)):!o&&p&&(y=Math.min(y,Zd(u,I,l,R,_))):y=Math.min(y,pu(u,I,l,R,_)),0===y)return y}else{const D=Fo(I,o),M=Fo(R,p);nc(T,y,_,u,l,D[0],M[0]),nc(T,y,_,u,l,D[0],M[1]),nc(T,y,_,u,l,D[1],M[0]),nc(T,y,_,u,l,D[1],M[1])}}return y}function Jd(u,o,l,p,_=1/0){let f=_;const y=Go(u,[0,u.length-1]);for(const T of l)if(!(f!==1/0&&rs(y,Go(T,[0,T.length-1]),p)>=f)&&(f=Math.min(f,To(u,o,T,!0,p,f)),0===f))return f;return f}function Qh(u,o,l,p,_=1/0){let f=_;const y=Go(u,[0,u.length-1]);for(const T of l){if(f!==1/0&&rs(y,tc(T),p)>=f)continue;const E=Kh(u,o,T,p,f);if(isNaN(E))return E;if(0===(f=Math.min(f,E)))return f}return f}function Ys(u){return"Point"===u||"MultiPoint"===u||"LineString"===u||"MultiLineString"===u||"Polygon"===u||"MultiPolygon"===u}class zs{constructor(o,l){this.type=An,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'distance' expression requires either one argument, but found ' ${o.length-1} instead.`);if(Mc(o[1])){const p=o[1];if("FeatureCollection"===p.type){for(let _=0;_<p.features.length;++_)if(Ys(p.features[_].geometry.type))return new zs(p,p.features[_].geometry)}else if("Feature"===p.type){if(Ys(p.geometry.type))return new zs(p,p.geometry)}else if(Ys(p.type))return new zs(p,p)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(o){const l=o.geometry(),p=o.canonicalID();if(null!=l&&null!=p){if("Point"===o.geometryType())return function(_,f,y){const T=[];for(const P of _)for(const w of P)T.push(Xs(w,f));const E=new Ll(T[0][1],"meters");return"Point"===y.type||"MultiPoint"===y.type||"LineString"===y.type?To(T,!1,"Point"===y.type?[y.coordinates]:y.coordinates,"LineString"===y.type,E):"MultiLineString"===y.type?Jd(T,!1,y.coordinates,E):"Polygon"===y.type||"MultiPolygon"===y.type?Qh(T,!1,"Polygon"===y.type?[y.coordinates]:y.coordinates,E):null}(l,p,this.geometries);if("LineString"===o.geometryType())return function(_,f,y){const T=[];for(const P of _){const w=[];for(const I of P)w.push(Xs(I,f));T.push(w)}const E=new Ll(T[0][0][1],"meters");if("Point"===y.type||"MultiPoint"===y.type||"LineString"===y.type)return Jd("Point"===y.type?[y.coordinates]:y.coordinates,"LineString"===y.type,T,E);if("MultiLineString"===y.type){let P=1/0;for(let w=0;w<y.coordinates.length;w++){const I=Jd(y.coordinates[w],!0,T,E,P);if(isNaN(I))return I;if(0===(P=Math.min(P,I)))return P}return P}if("Polygon"===y.type||"MultiPolygon"===y.type){let P=1/0;for(let w=0;w<T.length;w++){const I=Qh(T[w],!0,"Polygon"===y.type?[y.coordinates]:y.coordinates,E,P);if(isNaN(I))return I;if(0===(P=Math.min(P,I)))return P}return P}return null}(l,p,this.geometries);if("Polygon"===o.geometryType())return function(_,f,y){const T=[];for(const P of function(w,I){const R=w.length;if(R<=1)return[w];const D=[];let M,L;for(let V=0;V<R;V++){const j=Z1(w[V]);0!==j&&(w[V].area=Math.abs(j),void 0===L&&(L=j<0),L===j<0?(M&&D.push(M),M=[w[V]]):M.push(w[V]))}return M&&D.push(M),D}(_)){const w=[];for(let I=0;I<P.length;++I)w.push(Xd(P[I],f));T.push(w)}const E=new Ll(T[0][0][0][1],"meters");if("Point"===y.type||"MultiPoint"===y.type||"LineString"===y.type)return Qh("Point"===y.type?[y.coordinates]:y.coordinates,"LineString"===y.type,T,E);if("MultiLineString"===y.type){let P=1/0;for(let w=0;w<y.coordinates.length;w++){const I=Qh(y.coordinates[w],!0,T,E,P);if(isNaN(I))return I;if(0===(P=Math.min(P,I)))return P}return P}return"Polygon"===y.type||"MultiPolygon"===y.type?function(P,w,I){let R=1/0;for(const D of P)for(const M of w){const L=bl(D,M,I,R);if(isNaN(L))return L;if(0===(R=Math.min(R,L)))return R}return R}("Polygon"===y.type?[y.coordinates]:y.coordinates,T,E):null}(l,p,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ic(u,o){switch(u){case"string":return xa(o);case"number":return+o;case"boolean":return!!o;case"color":return Gn.parse(o);case"formatted":return Nn.fromString(xa(o));case"resolvedImage":return Ns.fromString(xa(o))}return o}function qi(u,o,l,p){return void 0!==p&&(u=p*Math.round(u/p)),void 0!==o&&u<o&&(u=o),void 0!==l&&u>l&&(u=l),u}class kc{constructor(o,l,p){this.type=o,this.key=l,this.scope=p}static parse(o,l){let p=l.expectedType;if(null==p&&(p=cr),o.length<2||o.length>3)return l.error("Invalid number of arguments for 'config' expression.");const _=l.parse(o[1],1);if(!(_ instanceof fl))return l.error("Key name of 'config' expression must be a string literal.");if(o.length>=3){const f=l.parse(o[2],2);return f instanceof fl?new kc(p,xa(_.value),xa(f.value)):l.error("Scope of 'config' expression must be a string literal.")}return new kc(p,xa(_.value))}evaluate(o){const l=[this.key,this.scope,o.scope].filter(Boolean).join("\x1f"),p=o.getConfig(l);if(!p)return null;const{type:_,value:f,values:y,minValue:T,maxValue:E,stepValue:P}=p,w=p.default.evaluate(o);let I=w;if(f){const R=o.scope;o.scope=(R||"").split("\x1f").slice(1).join("\x1f"),I=f.evaluate(o),o.scope=R}return _&&(I=ic(_,I)),void 0===I||void 0===T&&void 0===E&&void 0===P||("number"==typeof I?I=qi(I,T,E,P):Array.isArray(I)&&(I=I.map(R=>"number"==typeof R?qi(R,T,E,P):R))),void 0!==f&&void 0!==I&&y&&!y.includes(I)&&(I=w,_&&(I=ic(_,I))),(_&&_!==this.type||void 0!==I&&ns(I)!==this.type)&&(I=ic(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){const o=["config",this.key];return this.scope&&o.concat(this.key),o}}function Sa(u){if(u instanceof bs&&("get"===u.name&&1===u.args.length||"feature-state"===u.name||"has"===u.name&&1===u.args.length||"properties"===u.name||"geometry-type"===u.name||"id"===u.name||/^filter-/.test(u.name))||u instanceof cn||u instanceof zs)return!1;let o=!0;return u.eachChild(l=>{o&&!Sa(l)&&(o=!1)}),o}function Of(u){if(u instanceof bs&&"feature-state"===u.name)return!1;let o=!0;return u.eachChild(l=>{o&&!Of(l)&&(o=!1)}),o}function Ff(u){if(u instanceof kc)return new Set([u.key]);let o=new Set;return u.eachChild(l=>{o=new Set([...o,...Ff(l)])}),o}function Kd(u,o){if(u instanceof bs&&o.indexOf(u.name)>=0)return!1;let l=!0;return u.eachChild(p=>{l&&!Kd(p,o)&&(l=!1)}),l}class Gr{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const p=o[1];return l.scope.has(p)?new Gr(p,l.scope.get(p)):l.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ab{constructor(o,l=[],p,_=new og,f=[],y,T){this.registry=o,this.path=l,this.key=l.map(E=>"string"==typeof E?`['${E}']`:`[${E}]`).join(""),this.scope=_,this.errors=f,this.expectedType=p,this._scope=y,this.options=T}parse(o,l,p,_,f={}){return l||p?this.concat(l,null,p,_)._parse(o,f):this._parse(o,f)}parseObjectValue(o,l,p,_,f,y={}){return this.concat(l,p,_,f)._parse(o,y)}_parse(o,l){function p(_,f,y){return"assert"===y?new ml(f,[_]):"coerce"===y?new Ts(f,[_]):_}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _="string"==typeof o[0]?this.registry[o[0]]:void 0;if(_){let f=_.parse(o,this);if(!f)return null;if(this.expectedType){const y=this.expectedType,T=f.type;if("string"!==y.kind&&"number"!==y.kind&&"boolean"!==y.kind&&"object"!==y.kind&&"array"!==y.kind||"value"!==T.kind)if("color"!==y.kind&&"formatted"!==y.kind&&"resolvedImage"!==y.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(y,T))return null}else f=p(f,y,l.typeAnnotation||"coerce");else f=p(f,y,l.typeAnnotation||"assert")}if(!(f instanceof fl)&&"resolvedImage"!==f.type.kind&&lb(f)){const y=new Rv(this._scope,this.options);try{f=new fl(f.type,f.evaluate(y))}catch(T){return this.error(T.message),null}}return f}return Ts.parse(["to-array",o],this)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,p,_){let f="number"==typeof o?this.path.concat(o):this.path;f="string"==typeof l?f.concat(l):f;const y=_?this.scope.concat(_):this.scope;return new ab(this.registry,f,p||null,y,this.errors,this._scope,this.options)}error(o,...l){const p=`${this.key}${l.map(_=>`[${_}]`).join("")}`;this.errors.push(new ts(p,o))}checkSubtype(o,l){const p=Zh(o,l);return p&&this.error(p),p}}var kv=ab;function lb(u){if(u instanceof Gr)return lb(u.boundExpression);if(u instanceof bs&&"error"===u.name||u instanceof sg||u instanceof cn||u instanceof zs||u instanceof kc)return!1;const o=u instanceof Ts||u instanceof ml;let l=!0;return u.eachChild(p=>{l=o?l&&lb(p):l&&p instanceof fl}),!!l&&Sa(u)&&Kd(u,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function cg(u,o){const l=u.length-1;let p,_,f=0,y=l,T=0;for(;f<=y;)if(T=Math.floor((f+y)/2),p=u[T],_=u[T+1],p<=o){if(T===l||o<_)return T;f=T+1}else{if(!(p>o))throw new is("Input is not a number.");y=T-1}return 0}class Nf{constructor(o,l,p){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[_,f]of p)this.labels.push(_),this.outputs.push(f)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const p=l.parse(o[1],1,An);if(!p)return null;const _=[];let f=null;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);for(let y=1;y<o.length;y+=2){const T=1===y?-1/0:o[y],E=o[y+1],P=y,w=y+1;if("number"!=typeof T)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(_.length&&_[_.length-1][0]>=T)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const I=l.parse(E,w,f);if(!I)return null;f=f||I.type,_.push([T,I])}return new Nf(f,p,_)}evaluate(o){const l=this.labels,p=this.outputs;if(1===l.length)return p[0].evaluate(o);const _=this.input.evaluate(o);if(_<=l[0])return p[0].evaluate(o);const f=l.length;return _>=l[f-1]?p[f-1].evaluate(o):p[cg(l,_)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}const Fv=4/29,ep=6/29,Nv=3*ep*ep,J1=Math.PI/180,K1=180/Math.PI;function cb(u){return u>.008856451679035631?Math.pow(u,1/3):u/Nv+Fv}function Bf(u){return u>ep?u*u*u:Nv*(u-Fv)}function tp(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function ub(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Bv(u){const o=ub(u.r),l=ub(u.g),p=ub(u.b),_=cb((.4124564*o+.3575761*l+.1804375*p)/.95047),f=cb((.2126729*o+.7151522*l+.072175*p)/1);return{l:116*f-16,a:500*(_-f),b:200*(f-cb((.0193339*o+.119192*l+.9503041*p)/1.08883)),alpha:u.a}}function zv(u){let o=(u.l+16)/116,l=isNaN(u.a)?o:o+u.a/500,p=isNaN(u.b)?o:o-u.b/200;return o=1*Bf(o),l=.95047*Bf(l),p=1.08883*Bf(p),new Gn(tp(3.2404542*l-1.5371385*o-.4985314*p),tp(-.969266*l+1.8760108*o+.041556*p),tp(.0556434*l-.2040259*o+1.0572252*p),u.alpha)}function Qu(u,o,l){const p=o-u;return u+l*(p>180||p<-180?p-360*Math.round(p/360):p)}const np={forward:Bv,reverse:zv,interpolate:function(u,o,l){return{l:ni(u.l,o.l,l),a:ni(u.a,o.a,l),b:ni(u.b,o.b,l),alpha:ni(u.alpha,o.alpha,l)}}},ho={forward:function(u){const{l:o,a:l,b:p}=Bv(u),_=Math.atan2(p,l)*K1;return{h:_<0?_+360:_,c:Math.sqrt(l*l+p*p),l:o,alpha:u.a}},reverse:function(u){const o=u.h*J1,l=u.c;return zv({l:u.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:u.alpha})},interpolate:function(u,o,l){return{h:Qu(u.h,o.h,l),c:ni(u.c,o.c,l),l:ni(u.l,o.l,l),alpha:ni(u.alpha,o.alpha,l)}}};var ug=Object.freeze({__proto__:null,hcl:ho,lab:np});class Ga{constructor(o,l,p,_,f){this.type=o,this.operator=l,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[y,T]of f)this.labels.push(y),this.outputs.push(T)}static interpolationFactor(o,l,p,_){let f=0;if("exponential"===o.name)f=dg(l,o.base,p,_);else if("linear"===o.name)f=dg(l,1,p,_);else if("cubic-bezier"===o.name){const y=o.controlPoints;f=new dn(y[0],y[1],y[2],y[3]).solve(dg(l,1,p,_))}return f}static parse(o,l){let[p,_,f,...y]=o;if(!Array.isArray(_)||0===_.length)return l.error("Expected an interpolation type expression.",1);if("linear"===_[0])_={name:"linear"};else if("exponential"===_[0]){const P=_[1];if("number"!=typeof P)return l.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:P}}else{if("cubic-bezier"!==_[0])return l.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const P=_.slice(1);if(4!==P.length||P.some(w=>"number"!=typeof w||w<0||w>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:P}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(f=l.parse(f,2,An),!f)return null;const T=[];let E=null;"interpolate-hcl"===p||"interpolate-lab"===p?E=qa:l.expectedType&&"value"!==l.expectedType.kind&&(E=l.expectedType);for(let P=0;P<y.length;P+=2){const w=y[P],I=y[P+1],R=P+3,D=P+4;if("number"!=typeof w)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(T.length&&T[T.length-1][0]>=w)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const M=l.parse(I,D,E);if(!M)return null;E=E||M.type,T.push([w,M])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Ga(E,p,_,f,T):l.error(`Type ${Lr(E)} is not interpolatable.`)}evaluate(o){const l=this.labels,p=this.outputs;if(1===l.length)return p[0].evaluate(o);const _=this.input.evaluate(o);if(_<=l[0])return p[0].evaluate(o);const f=l.length;if(_>=l[f-1])return p[f-1].evaluate(o);const y=cg(l,_),T=Ga.interpolationFactor(this.interpolation,_,l[y],l[y+1]),E=p[y].evaluate(o),P=p[y+1].evaluate(o);return"interpolate"===this.operator?Ju[this.type.kind.toLowerCase()](E,P,T):"interpolate-hcl"===this.operator?ho.reverse(ho.interpolate(ho.forward(E),ho.forward(P),T)):np.reverse(np.interpolate(np.forward(E),np.forward(P),T))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let p=0;p<this.labels.length;p++)l.push(this.labels[p],this.outputs[p].serialize());return l}}function dg(u,o,l,p){const _=p-l,f=u-l;return 0===_?0:1===o?f/_:(Math.pow(o,f)-1)/(Math.pow(o,_)-1)}class ip{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let p=null;const _=l.expectedType;_&&"value"!==_.kind&&(p=_);const f=[];for(const T of o.slice(1)){const E=l.parse(T,1+f.length,p,void 0,{typeAnnotation:"omit"});if(!E)return null;p=p||E.type,f.push(E)}const y=_&&f.some(T=>Zh(_,T.type));return new ip(y?cr:p,f)}evaluate(o){let l,p=null,_=0;for(const f of this.args){if(_++,p=f.evaluate(o),p&&p instanceof Ns&&!p.available&&(l||(l=p),p=null,_===this.args.length))return l;if(null!==p)break}return p}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class rp{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const p=[];for(let f=1;f<o.length-1;f+=2){const y=o[f];if("string"!=typeof y)return l.error(`Expected string, but found ${typeof y} instead.`,f);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",f);const T=l.parse(o[f+1],f+1);if(!T)return null;p.push([y,T])}const _=l.parse(o[o.length-1],o.length-1,l.expectedType,p);return _?new rp(p,_):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,p]of this.bindings)o.push(l,p.serialize());return o.push(this.result.serialize()),o}}class hg{constructor(o,l,p){this.type=o,this.index=l,this.input=p}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=l.parse(o[1],1,An),_=l.parse(o[2],2,ka(l.expectedType||cr));return p&&_?new hg(_.type.itemType,p,_):null}evaluate(o){const l=this.index.evaluate(o),p=this.input.evaluate(o);if(l<0)throw new is(`Array index out of bounds: ${l} < 0.`);if(l>p.length-1)throw new is(`Array index out of bounds: ${l} > ${p.length-1}.`);if(l===Math.floor(l))return p[l];const _=Math.floor(l),f=Math.ceil(l),y=p[_],T=p[f];if("number"!=typeof y||"number"!=typeof T)throw new is(`Cannot interpolate between non-number values at index ${l}.`);const E=l-_;return y*(1-E)+T*E}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class op{constructor(o,l){this.type=nr,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=l.parse(o[1],1,cr),_=l.parse(o[2],2,cr);return p&&_?Yh(p.type,[nr,ki,An,Pl,cr])?new op(p,_):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(p.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(null==p)return!1;if(!Ic(l,["boolean","string","number","null"]))throw new is(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(ns(l))} instead.`);if(!Ic(p,["string","array"]))throw new is(`Expected second argument to be of type array or string, but found ${Lr(ns(p))} instead.`);return p.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class zf{constructor(o,l,p){this.type=An,this.needle=o,this.haystack=l,this.fromIndex=p}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=l.parse(o[1],1,cr),_=l.parse(o[2],2,cr);if(!p||!_)return null;if(!Yh(p.type,[nr,ki,An,Pl,cr]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(p.type)} instead`);if(4===o.length){const f=l.parse(o[3],3,An);return f?new zf(p,_,f):null}return new zf(p,_)}evaluate(o){const l=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(!Ic(l,["boolean","string","number","null"]))throw new is(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(ns(l))} instead.`);if(!Ic(p,["string","array"]))throw new is(`Expected second argument to be of type array or string, but found ${Lr(ns(p))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(o);return p.indexOf(l,_)}return p.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Oa{constructor(o,l,p,_,f,y){this.inputType=o,this.type=l,this.input=p,this.cases=_,this.outputs=f,this.otherwise=y}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let p,_;l.expectedType&&"value"!==l.expectedType.kind&&(_=l.expectedType);const f={},y=[];for(let P=2;P<o.length-1;P+=2){let w=o[P];const I=o[P+1];Array.isArray(w)||(w=[w]);const R=l.concat(P);if(0===w.length)return R.error("Expected at least one branch label.");for(const M of w){if("number"!=typeof M&&"string"!=typeof M)return R.error("Branch labels must be numbers or strings.");if("number"==typeof M&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof M&&Math.floor(M)!==M)return R.error("Numeric branch labels must be integer values.");if(p){if(R.checkSubtype(p,ns(M)))return null}else p=ns(M);if(void 0!==f[String(M)])return R.error("Branch labels must be unique.");f[String(M)]=y.length}const D=l.parse(I,P,_);if(!D)return null;_=_||D.type,y.push(D)}const T=l.parse(o[1],1,cr);if(!T)return null;const E=l.parse(o[o.length-1],o.length-1,_);return E?"value"!==T.type.kind&&l.concat(1).checkSubtype(p,T.type)?null:new Oa(p,_,T,f,y,E):null}evaluate(o){const l=this.input.evaluate(o);return(ns(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),p=[],_={};for(const y of l){const T=_[this.cases[y]];void 0===T?(_[this.cases[y]]=p.length,p.push([this.cases[y],[y]])):p[T][1].push(y)}const f=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,T]of p)o.push(1===T.length?f(T[0]):T.map(f)),o.push(this.outputs[y].serialize());return o.push(this.otherwise.serialize()),o}}class ed{constructor(o,l,p){this.type=o,this.branches=l,this.otherwise=p}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let p;l.expectedType&&"value"!==l.expectedType.kind&&(p=l.expectedType);const _=[];for(let y=1;y<o.length-1;y+=2){const T=l.parse(o[y],y,nr);if(!T)return null;const E=l.parse(o[y+1],y+1,p);if(!E)return null;_.push([T,E]),p=p||E.type}const f=l.parse(o[o.length-1],o.length-1,p);return f?new ed(p,_,f):null}evaluate(o){for(const[l,p]of this.branches)if(l.evaluate(o))return p.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,p]of this.branches)o(l),o(p);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}class Vf{constructor(o,l,p,_){this.type=o,this.input=l,this.beginIndex=p,this.endIndex=_}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=l.parse(o[1],1,cr),_=l.parse(o[2],2,An);if(!p||!_)return null;if(!Yh(p.type,[ka(cr),ki,cr]))return l.error(`Expected first argument to be of type array or string, but found ${Lr(p.type)} instead`);if(4===o.length){const f=l.parse(o[3],3,An);return f?new Vf(p.type,p,_,f):null}return new Vf(p.type,p,_)}evaluate(o){const l=this.input.evaluate(o),p=this.beginIndex.evaluate(o);if(!Ic(l,["string","array"]))throw new is(`Expected first argument to be of type array or string, but found ${Lr(ns(l))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(o);return l.slice(p,_)}return l.slice(p)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function sp(u,o){return"=="===u||"!="===u?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function db(u,o,l,p){return 0===p.compare(o,l)}function ap(u,o,l){const p="=="!==u&&"!="!==u;return class xV{constructor(f,y,T){this.type=nr,this.lhs=f,this.rhs=y,this.collator=T,this.hasUntypedArgument="value"===f.type.kind||"value"===y.type.kind}static parse(f,y){if(3!==f.length&&4!==f.length)return y.error("Expected two or three arguments.");const T=f[0];let E=y.parse(f[1],1,cr);if(!E)return null;if(!sp(T,E.type))return y.concat(1).error(`"${T}" comparisons are not supported for type '${Lr(E.type)}'.`);let P=y.parse(f[2],2,cr);if(!P)return null;if(!sp(T,P.type))return y.concat(2).error(`"${T}" comparisons are not supported for type '${Lr(P.type)}'.`);if(E.type.kind!==P.type.kind&&"value"!==E.type.kind&&"value"!==P.type.kind)return y.error(`Cannot compare types '${Lr(E.type)}' and '${Lr(P.type)}'.`);p&&("value"===E.type.kind&&"value"!==P.type.kind?E=new ml(P.type,[E]):"value"!==E.type.kind&&"value"===P.type.kind&&(P=new ml(E.type,[P])));let w=null;if(4===f.length){if("string"!==E.type.kind&&"string"!==P.type.kind&&"value"!==E.type.kind&&"value"!==P.type.kind)return y.error("Cannot use collator to compare non-string types.");if(w=y.parse(f[3],3,Ef),!w)return null}return new xV(E,P,w)}evaluate(f){const y=this.lhs.evaluate(f),T=this.rhs.evaluate(f);if(p&&this.hasUntypedArgument){const E=ns(y),P=ns(T);if(E.kind!==P.kind||"string"!==E.kind&&"number"!==E.kind)throw new is(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${E.kind}, ${P.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const E=ns(y),P=ns(T);if("string"!==E.kind||"string"!==P.kind)return o(f,y,T)}return this.collator?l(f,y,T,this.collator.evaluate(f)):o(f,y,T)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[u];return this.eachChild(y=>{f.push(y.serialize())}),f}}}const Es=ap("==",function(u,o,l){return o===l},db),hb=ap("!=",function(u,o,l){return o!==l},function(u,o,l,p){return!db(0,o,l,p)}),Vv=ap("<",function(u,o,l){return o<l},function(u,o,l,p){return p.compare(o,l)<0}),Lc=ap(">",function(u,o,l){return o>l},function(u,o,l,p){return p.compare(o,l)>0}),Fa=ap("<=",function(u,o,l){return o<=l},function(u,o,l,p){return p.compare(o,l)<=0}),pb=ap(">=",function(u,o,l){return o>=l},function(u,o,l,p){return p.compare(o,l)>=0});class lp{constructor(o,l,p,_,f,y){this.type=ki,this.number=o,this.locale=l,this.currency=p,this.unit=_,this.minFractionDigits=f,this.maxFractionDigits=y}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const p=l.parse(o[1],1,An);if(!p)return null;const _=o[2];if("object"!=typeof _||Array.isArray(_))return l.error("NumberFormat options argument must be an object.");let f=null;if(_.locale&&(f=l.parseObjectValue(_.locale,2,"locale",ki),!f))return null;let y=null;if(_.currency&&(y=l.parseObjectValue(_.currency,2,"currency",ki),!y))return null;let T=null;if(_.unit&&(T=l.parseObjectValue(_.unit,2,"unit",ki),!T))return null;let E=null;if(_["min-fraction-digits"]&&(E=l.parseObjectValue(_["min-fraction-digits"],2,"min-fraction-digits",An),!E))return null;let P=null;return _["max-fraction-digits"]&&(P=l.parseObjectValue(_["max-fraction-digits"],2,"max-fraction-digits",An),!P)?null:new lp(p,f,y,T,E,P)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class rc{constructor(o){this.type=An,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const p=l.parse(o[1],1);return p?"array"!==p.type.kind&&"string"!==p.type.kind&&"value"!==p.type.kind?l.error(`Expected argument of type string or array, but found ${Lr(p.type)} instead.`):new rc(p):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new is(`Expected value to be of type string or array, but found ${Lr(ns(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}function aa(u){return function(){u=1831565813+(u|=0)|0;let o=Math.imul(u^u>>>15,1|u);return o=o+Math.imul(o^o>>>7,61|o)^o,((o^o>>>14)>>>0)/4294967296}}const Qd={"==":Es,"!=":hb,">":Lc,"<":Vv,">=":pb,"<=":Fa,array:ml,at:hg,boolean:ml,case:ed,coalesce:ip,collator:sg,format:Gd,image:Ei,in:op,"index-of":zf,interpolate:Ga,"interpolate-hcl":Ga,"interpolate-lab":Ga,length:rc,let:rp,literal:fl,match:Oa,number:ml,"number-format":lp,object:ml,slice:Vf,step:Nf,string:ml,"to-boolean":Ts,"to-color":Ts,"to-number":Ts,"to-string":Ts,var:Gr,within:cn,distance:zs,config:kc};function cp(u,[o,l,p,_]){o=o.evaluate(u),l=l.evaluate(u),p=p.evaluate(u);const f=_?_.evaluate(u):1,y=ob(o,l,p,f);if(y)throw new is(y);return new Gn(o/255*f,l/255*f,p/255*f,f)}function pg(u,[o,l,p,_]){o=o.evaluate(u),l=l.evaluate(u),p=p.evaluate(u);const f=_?_.evaluate(u):1,y=(w=l,I=p,R=f,"number"==typeof(P=o)&&P>=0&&P<=360?"number"==typeof w&&w>=0&&w<=100&&"number"==typeof I&&I>=0&&I<=100?void 0===R||"number"==typeof R&&R>=0&&R<=1?null:`Invalid hsla value [${[P,w,I,R].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof R?[P,w,I,R]:[P,w,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof R?[P,w,I,R]:[P,w,I]).join(", ")}]: 'h' must be between 0 and 360.`);var P,w,I,R;if(y)throw new is(y);const T=`hsla(${o}, ${l}%, ${p}%, ${f})`,E=Gn.parse(T);if(!E)throw new is(`Failed to parse HSLA color: ${T}`);return E}function oc(u,o){return u in o}function jf(u,o){const l=o[u];return void 0===l?null:l}function Oc(u){return{type:u}}function Qi(u){return{result:"success",value:u}}function sc(u){return{result:"error",value:u}}function fg(u,o){return!!u&&!!u.parameters&&u.parameters.indexOf(o)>-1}function td(u){return"data-driven"===u["property-type"]}function fb(u){return fg(u.expression,"measure-light")}function mg(u){return fg(u.expression,"zoom")}function Uf(u){return!!u.expression&&u.expression.interpolated}function gg(u){return"object"==typeof u&&null!==u&&!Array.isArray(u)}function mb(u){return u}function _n(u,o){const l="color"===o.type,p=u.stops&&"object"==typeof u.stops[0][0],_=p||!(p||void 0!==u.property),f=u.type||(Uf(o)?"exponential":"interval");if(l&&((u=Ec({},u)).stops&&(u.stops=u.stops.map(P=>[P[0],Gn.parse(P[1])])),u.default=Gn.parse(u.default?u.default:o.default)),u.colorSpace&&"rgb"!==u.colorSpace&&!ug[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let y,T,E;if("exponential"===f)y=vs;else if("interval"===f)y=ei;else if("categorical"===f){y=Qn,T=Object.create(null);for(const P of u.stops)T[P[0]]=P[1];E=typeof u.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);y=gb}if(p){const P={},w=[];for(let D=0;D<u.stops.length;D++){const M=u.stops[D],L=M[0].zoom;void 0===P[L]&&(P[L]={zoom:L,type:u.type,property:u.property,default:u.default,stops:[]},w.push(L)),P[L].stops.push([M[0].value,M[1]])}const I=[];for(const D of w)I.push([P[D].zoom,_n(P[D],o)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Ga.interpolationFactor.bind(void 0,R),zoomStops:I.map(D=>D[0]),evaluate:({zoom:D},M)=>vs({stops:I,base:u.base},o,D).evaluate(D,M)}}if(_){const P="exponential"===f?{name:"exponential",base:void 0!==u.base?u.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Ga.interpolationFactor.bind(void 0,P),zoomStops:u.stops.map(w=>w[0]),evaluate:({zoom:w})=>y(u,o,w,T,E)}}return{kind:"source",evaluate(P,w){const I=w&&w.properties?w.properties[u.property]:void 0;return void 0===I?Rr(u.default,o.default):y(u,o,I,T,E)}}}function Rr(u,o,l){return void 0!==u?u:void 0!==o?o:void 0!==l?l:void 0}function Qn(u,o,l,p,_){return Rr(typeof l===_?p[l]:void 0,u.default,o.default)}function ei(u,o,l){if("number"!==Ac(l))return Rr(u.default,o.default);const p=u.stops.length;if(1===p||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[p-1][0])return u.stops[p-1][1];const _=cg(u.stops.map(f=>f[0]),l);return u.stops[_][1]}function vs(u,o,l){const p=void 0!==u.base?u.base:1;if("number"!==Ac(l))return Rr(u.default,o.default);const _=u.stops.length;if(1===_||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[_-1][0])return u.stops[_-1][1];const f=cg(u.stops.map(w=>w[0]),l),y=function(w,I,R,D){const M=D-R,L=w-R;return 0===M?0:1===I?L/M:(Math.pow(I,L)-1)/(Math.pow(I,M)-1)}(l,p,u.stops[f][0],u.stops[f+1][0]),T=u.stops[f][1],E=u.stops[f+1][1];let P=Ju[o.type]||mb;if(u.colorSpace&&"rgb"!==u.colorSpace){const w=ug[u.colorSpace];P=(I,R)=>w.reverse(w.interpolate(w.forward(I),w.forward(R),y))}return"function"==typeof T.evaluate?{evaluate(...w){const I=T.evaluate.apply(void 0,w),R=E.evaluate.apply(void 0,w);if(void 0!==I&&void 0!==R)return P(I,R,y)}}:P(T,E,y)}function gb(u,o,l){return"color"===o.type?l=Gn.parse(l):"formatted"===o.type?l=Nn.fromString(l.toString()):"resolvedImage"===o.type?l=Ns.fromString(l.toString()):Ac(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),Rr(l,u.default,o.default)}bs.register(Qd,{error:[{kind:"error"},[ki],(u,[o])=>{throw new is(o.evaluate(u))}],typeof:[ki,[cr],(u,[o])=>Lr(ns(o.evaluate(u)))],"to-rgba":[ka(An,4),[qa],(u,[o])=>o.evaluate(u).toRenderColor(null).toArray()],rgb:[qa,[An,An,An],cp],rgba:[qa,[An,An,An,An],cp],hsl:[qa,[An,An,An],pg],hsla:[qa,[An,An,An,An],pg],has:{type:nr,overloads:[[[ki],(u,[o])=>oc(o.evaluate(u),u.properties())],[[ki,va],(u,[o,l])=>oc(o.evaluate(u),l.evaluate(u))]]},get:{type:cr,overloads:[[[ki],(u,[o])=>jf(o.evaluate(u),u.properties())],[[ki,va],(u,[o,l])=>jf(o.evaluate(u),l.evaluate(u))]]},"feature-state":[cr,[ki],(u,[o])=>jf(o.evaluate(u),u.featureState||{})],properties:[va,[],u=>u.properties()],"geometry-type":[ki,[],u=>u.geometryType()],id:[cr,[],u=>u.id()],zoom:[An,[],u=>u.globals.zoom],pitch:[An,[],u=>u.globals.pitch||0],"distance-from-center":[An,[],u=>u.distanceFromCenter()],"measure-light":[An,[ki],(u,[o])=>u.measureLight(o.evaluate(u))],"heatmap-density":[An,[],u=>u.globals.heatmapDensity||0],"line-progress":[An,[],u=>u.globals.lineProgress||0],"raster-value":[An,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[An,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[An,[],u=>u.globals.skyRadialProgress||0],accumulated:[cr,[],u=>void 0===u.globals.accumulated?null:u.globals.accumulated],"+":[An,Oc(An),(u,o)=>{let l=0;for(const p of o)l+=p.evaluate(u);return l}],"*":[An,Oc(An),(u,o)=>{let l=1;for(const p of o)l*=p.evaluate(u);return l}],"-":{type:An,overloads:[[[An,An],(u,[o,l])=>o.evaluate(u)-l.evaluate(u)],[[An],(u,[o])=>-o.evaluate(u)]]},"/":[An,[An,An],(u,[o,l])=>o.evaluate(u)/l.evaluate(u)],"%":[An,[An,An],(u,[o,l])=>o.evaluate(u)%l.evaluate(u)],ln2:[An,[],()=>Math.LN2],pi:[An,[],()=>Math.PI],e:[An,[],()=>Math.E],"^":[An,[An,An],(u,[o,l])=>Math.pow(o.evaluate(u),l.evaluate(u))],sqrt:[An,[An],(u,[o])=>Math.sqrt(o.evaluate(u))],log10:[An,[An],(u,[o])=>Math.log(o.evaluate(u))/Math.LN10],ln:[An,[An],(u,[o])=>Math.log(o.evaluate(u))],log2:[An,[An],(u,[o])=>Math.log(o.evaluate(u))/Math.LN2],sin:[An,[An],(u,[o])=>Math.sin(o.evaluate(u))],cos:[An,[An],(u,[o])=>Math.cos(o.evaluate(u))],tan:[An,[An],(u,[o])=>Math.tan(o.evaluate(u))],asin:[An,[An],(u,[o])=>Math.asin(o.evaluate(u))],acos:[An,[An],(u,[o])=>Math.acos(o.evaluate(u))],atan:[An,[An],(u,[o])=>Math.atan(o.evaluate(u))],min:[An,Oc(An),(u,o)=>Math.min(...o.map(l=>l.evaluate(u)))],max:[An,Oc(An),(u,o)=>Math.max(...o.map(l=>l.evaluate(u)))],abs:[An,[An],(u,[o])=>Math.abs(o.evaluate(u))],round:[An,[An],(u,[o])=>{const l=o.evaluate(u);return l<0?-Math.round(-l):Math.round(l)}],floor:[An,[An],(u,[o])=>Math.floor(o.evaluate(u))],ceil:[An,[An],(u,[o])=>Math.ceil(o.evaluate(u))],"filter-==":[nr,[ki,cr],(u,[o,l])=>u.properties()[o.value]===l.value],"filter-id-==":[nr,[cr],(u,[o])=>u.id()===o.value],"filter-type-==":[nr,[ki],(u,[o])=>u.geometryType()===o.value],"filter-<":[nr,[ki,cr],(u,[o,l])=>{const p=u.properties()[o.value],_=l.value;return typeof p==typeof _&&p<_}],"filter-id-<":[nr,[cr],(u,[o])=>{const l=u.id(),p=o.value;return typeof l==typeof p&&l<p}],"filter->":[nr,[ki,cr],(u,[o,l])=>{const p=u.properties()[o.value],_=l.value;return typeof p==typeof _&&p>_}],"filter-id->":[nr,[cr],(u,[o])=>{const l=u.id(),p=o.value;return typeof l==typeof p&&l>p}],"filter-<=":[nr,[ki,cr],(u,[o,l])=>{const p=u.properties()[o.value],_=l.value;return typeof p==typeof _&&p<=_}],"filter-id-<=":[nr,[cr],(u,[o])=>{const l=u.id(),p=o.value;return typeof l==typeof p&&l<=p}],"filter->=":[nr,[ki,cr],(u,[o,l])=>{const p=u.properties()[o.value],_=l.value;return typeof p==typeof _&&p>=_}],"filter-id->=":[nr,[cr],(u,[o])=>{const l=u.id(),p=o.value;return typeof l==typeof p&&l>=p}],"filter-has":[nr,[cr],(u,[o])=>o.value in u.properties()],"filter-has-id":[nr,[],u=>null!==u.id()&&void 0!==u.id()],"filter-type-in":[nr,[ka(ki)],(u,[o])=>o.value.indexOf(u.geometryType())>=0],"filter-id-in":[nr,[ka(cr)],(u,[o])=>o.value.indexOf(u.id())>=0],"filter-in-small":[nr,[ki,ka(cr)],(u,[o,l])=>l.value.indexOf(u.properties()[o.value])>=0],"filter-in-large":[nr,[ki,ka(cr)],(u,[o,l])=>function(p,_,f,y){for(;f<=y;){const T=f+y>>1;if(_[T]===p)return!0;_[T]>p?y=T-1:f=T+1}return!1}(u.properties()[o.value],l.value,0,l.value.length-1)],all:{type:nr,overloads:[[[nr,nr],(u,[o,l])=>o.evaluate(u)&&l.evaluate(u)],[Oc(nr),(u,o)=>{for(const l of o)if(!l.evaluate(u))return!1;return!0}]]},any:{type:nr,overloads:[[[nr,nr],(u,[o,l])=>o.evaluate(u)||l.evaluate(u)],[Oc(nr),(u,o)=>{for(const l of o)if(l.evaluate(u))return!0;return!1}]]},"!":[nr,[nr],(u,[o])=>!o.evaluate(u)],"is-supported-script":[nr,[ki],(u,[o])=>{const l=u.globals&&u.globals.isSupportedScript;return!l||l(o.evaluate(u))}],upcase:[ki,[ki],(u,[o])=>o.evaluate(u).toUpperCase()],downcase:[ki,[ki],(u,[o])=>o.evaluate(u).toLowerCase()],concat:[ki,Oc(cr),(u,o)=>o.map(l=>xa(l.evaluate(u))).join("")],"resolved-locale":[ki,[Ef],(u,[o])=>o.evaluate(u).resolvedLocale()],random:[An,[An,An,cr],(u,o)=>{const[l,p,_]=o.map(y=>y.evaluate(u));if(l>p||l===p)return l;let f;if("string"==typeof _)f=function(y){let T=0;if(0===y.length)return T;for(let E=0;E<y.length;E++)T=(T<<5)-T+y.charCodeAt(E),T|=0;return T}(_);else{if("number"!=typeof _)throw new is(`Invalid seed input: ${_}`);f=_}return l+aa(f)()*(p-l)}]});class nd{constructor(o,l,p,_){var f;this.expression=o,this._warningHistory={},this._evaluator=new Rv(p,_),this._defaultValue=l?"color"===(f=l).type&&(gg(f.default)||Array.isArray(f.default))?new Gn(0,0,0,0):"color"===f.type?Gn.parse(f.default)||null:void 0===f.default?null:f.default:null,this._enumValues=l&&"enum"===l.type?l.values:null,this.configDependencies=Ff(o)}evaluateWithoutErrorHandling(o,l,p,_,f,y,T,E){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=p,this._evaluator.canonical=_||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,p,_,f,y,T,E){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=E||null;try{const P=this.expression.evaluate(this._evaluator);if(null==P||"number"==typeof P&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new is(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,"undefined"!=typeof console&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function $a(u){return Array.isArray(u)&&u.length>0&&"string"==typeof u[0]&&u[0]in Qd}function mu(u,o,l,p){const _=new kv(Qd,[],o?function(y){const T={color:qa,string:ki,number:An,enum:ki,boolean:nr,formatted:Xh,resolvedImage:qd};return"array"===y.type?ka(T[y.value]||cr,y.length):T[y.type]}(o):void 0,void 0,void 0,l,p),f=_.parse(u,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return f?Qi(new nd(f,o,l,p)):sc(_.errors)}class eh{constructor(o,l,p){this.kind=o,this._styleExpression=l,this.isLightConstant=p,this.isStateDependent="constant"!==o&&!Of(l.expression),this.configDependencies=Ff(l.expression)}evaluateWithoutErrorHandling(o,l,p,_,f,y){return this._styleExpression.evaluateWithoutErrorHandling(o,l,p,_,f,y)}evaluate(o,l,p,_,f,y){return this._styleExpression.evaluate(o,l,p,_,f,y)}}class Hf{constructor(o,l,p,_,f){this.kind=o,this.zoomStops=p,this._styleExpression=l,this.isStateDependent="camera"!==o&&!Of(l.expression),this.isLightConstant=f,this.configDependencies=Ff(l.expression),this.interpolationType=_}evaluateWithoutErrorHandling(o,l,p,_,f,y){return this._styleExpression.evaluateWithoutErrorHandling(o,l,p,_,f,y)}evaluate(o,l,p,_,f,y){return this._styleExpression.evaluate(o,l,p,_,f,y)}interpolationFactor(o,l,p){return this.interpolationType?Ga.interpolationFactor(this.interpolationType,o,l,p):0}}function id(u,o,l,p){if("error"===(u=mu(u,o,l,p)).result)return u;const _=u.value.expression,f=Sa(_);if(!f&&!td(o))return sc([new ts("","data expressions not supported")]);const y=Kd(_,["zoom","pitch","distance-from-center"]);if(!y&&!mg(o))return sc([new ts("","zoom expressions not supported")]);const T=Kd(_,["measure-light"]);if(!T&&!fb(o))return sc([new ts("","measure-light expression not supported")]);const E=Kd(_,["line-progress"]);if(!E&&!fg(o.expression,"line-progress"))return sc([new ts("","line-progress expression not supported")]);const P=o.expression&&o.expression.relaxZoomRestriction,w=up(_);return w||y||P?w instanceof ts?sc([w]):w instanceof Ga&&!Uf(o)?sc([new ts("",'"interpolate" expressions cannot be used with this property')]):Qi(w?new Hf(f&&E?"camera":"composite",u.value,w.labels,w instanceof Ga?w.interpolation:void 0,T):new eh(f&&E?"constant":"source",u.value,T)):sc([new ts("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class _g{constructor(o,l){this._parameters=o,this._specification=l,Ec(this,_n(this._parameters,this._specification))}static deserialize(o){return new _g(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function up(u){let o=null;if(u instanceof rp)o=up(u.result);else if(u instanceof ip){for(const l of u.args)if(o=up(l),o)break}else(u instanceof Nf||u instanceof Ga)&&u.input instanceof bs&&"zoom"===u.input.name&&(o=u);return o instanceof ts||u.eachChild(l=>{const p=up(l);p instanceof ts?o=p:o&&p&&o!==p&&(o=new ts("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}var Js,Ol,yl=dt(function(){if(Ol)return Js;Ol=1,Js=o;function o(l,p,_){var f=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var y=new Int32Array(this.arrayBuffer);l=y[0],this.d=(p=y[1])+2*(_=y[2]);for(var T=0;T<this.d*this.d;T++){var E=y[3+T],P=y[3+T+1];f.push(E===P?null:y.subarray(E,P))}var w=y[3+f.length+1];this.keys=y.subarray(y[3+f.length],w),this.bboxes=y.subarray(w),this.insert=this._insertReadonly}else{this.d=p+2*_;for(var I=0;I<this.d*this.d;I++)f.push([]);this.keys=[],this.bboxes=[]}this.n=p,this.extent=l,this.padding=_,this.scale=p/l,this.uid=0;var R=_/p*l;this.min=-R,this.max=l+R}return o.prototype.insert=function(l,p,_,f,y){this._forEachCell(p,_,f,y,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(f),this.bboxes.push(y)},o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},o.prototype._insertCell=function(l,p,_,f,y,T){this.cells[y].push(T)},o.prototype.query=function(l,p,_,f,y){var T=this.min,E=this.max;if(l<=T&&p<=T&&E<=_&&E<=f&&!y)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(l,p,_,f,this._queryCell,P,{},y),P},o.prototype._queryCell=function(l,p,_,f,y,T,E,P){var w=this.cells[y];if(null!==w)for(var I=this.keys,R=this.bboxes,D=0;D<w.length;D++){var M=w[D];if(void 0===E[M]){var L=4*M;(P?P(R[L+0],R[L+1],R[L+2],R[L+3]):l<=R[L+2]&&p<=R[L+3]&&_>=R[L+0]&&f>=R[L+1])?(E[M]=!0,T.push(I[M])):E[M]=!1}}},o.prototype._forEachCell=function(l,p,_,f,y,T,E,P){for(var w=this._convertToCellCoord(l),I=this._convertToCellCoord(p),R=this._convertToCellCoord(_),D=this._convertToCellCoord(f),M=w;M<=R;M++)for(var L=I;L<=D;L++){var V=this.d*L+M;if((!P||P(this._convertFromCellCoord(M),this._convertFromCellCoord(L),this._convertFromCellCoord(M+1),this._convertFromCellCoord(L+1)))&&y.call(this,l,p,_,f,V,T,E,P))return}},o.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},o.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,p=3+this.cells.length+1+1,_=0,f=0;f<this.cells.length;f++)_+=this.cells[f].length;var y=new Int32Array(p+_+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var T=p,E=0;E<l.length;E++){var P=l[E];y[3+E]=T,y.set(P,T),T+=P.length}return y[3+l.length]=T,y.set(this.keys,T),y[3+l.length+1]=T+=this.keys.length,y.set(this.bboxes,T),T+=this.bboxes.length,y.buffer},Js}());const Wa={};function Tn(u,o,l={}){Object.defineProperty(u,"_classRegistryKey",{value:o,writable:!1}),Wa[o]={klass:u,omit:l.omit||[]}}Tn(Object,"Object"),yl.serialize=function(u,o){const l=u.toArrayBuffer();return o&&o.add(l),{buffer:l}},yl.deserialize=function(u){return new yl(u.buffer)},Object.defineProperty(yl,"name",{value:"Grid"}),Tn(yl,"Grid"),Tn(Gn,"Color"),Tn(Error,"Error"),Tn(Nn,"Formatted"),Tn(pl,"FormattedSection"),Tn(ig,"AJAXError"),Tn(Ns,"ResolvedImage"),Tn(_g,"StylePropertyFunction"),Tn(nd,"StyleExpression",{omit:["_evaluator"]}),Tn(Hf,"ZoomDependentExpression"),Tn(eh,"ZoomConstantExpression"),Tn(bs,"CompoundExpression",{omit:["_evaluate"]});for(const u in Qd)Wa[Qd[u]._classRegistryKey]||Tn(Qd[u],`Expression${u}`);function dp(u){return u&&"undefined"!=typeof ArrayBuffer&&(u instanceof ArrayBuffer||u.constructor&&"ArrayBuffer"===u.constructor.name)}function yg(u){return self.ImageBitmap&&u instanceof ImageBitmap}function rd(u,o){if(null==u||"boolean"==typeof u||"number"==typeof u||"string"==typeof u||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(dp(u)||yg(u))return o&&o.add(u),u;if(ArrayBuffer.isView(u)){const l=u;return o&&o.add(l.buffer),l}if(u instanceof ImageData)return o&&o.add(u.data.buffer),u;if(Array.isArray(u)){const l=[];for(const p of u)l.push(rd(p,o));return l}if(u instanceof Map){const l={$name:"Map"};for(const[p,_]of u.entries())l[p]=rd(_);return l}if(u instanceof Set){const l={$name:"Set"};let p=0;for(const _ of u.values())l[++p]=rd(_);return l}if("object"==typeof u){const l=u.constructor,p=l._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${p}`);const _=l.serialize?l.serialize(u,o):{};if(!l.serialize){for(const f in u)u.hasOwnProperty(f)&&(Wa[p].omit.indexOf(f)>=0||(_[f]=rd(u[f],o)));u instanceof Error&&(_.message=u.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==p&&(_.$name=p),_}throw new Error("can't serialize object of type "+typeof u)}function ac(u){if(null==u||"boolean"==typeof u||"number"==typeof u||"string"==typeof u||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||dp(u)||yg(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(ac);if("object"==typeof u){const o=u.$name||"Object";if("Map"===o){const _=new Map;for(const f of Object.keys(u))"$name"!==f&&_.set(f,ac(u[f]));return _}if("Set"===o){const _=new Set;for(const f of Object.keys(u))"$name"!==f&&_.add(ac(u[f]));return _}const{klass:l}=Wa[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(u);const p=Object.create(l.prototype);for(const _ of Object.keys(u))"$name"!==_&&(p[_]=ac(u[_]));return p}throw new Error("can't deserialize object of type "+typeof u)}const Fn_Latin_1_Supplement=u=>u>=128&&u<=255,Fn_Arabic=u=>u>=1536&&u<=1791,Fn_Arabic_Supplement=u=>u>=1872&&u<=1919,Fn_Arabic_Extended_A=u=>u>=2208&&u<=2303,Fn_Hangul_Jamo=u=>u>=4352&&u<=4607,Fn_Unified_Canadian_Aboriginal_Syllabics=u=>u>=5120&&u<=5759,Fn_Khmer=u=>u>=6016&&u<=6143,Fn_Unified_Canadian_Aboriginal_Syllabics_Extended=u=>u>=6320&&u<=6399,Fn_General_Punctuation=u=>u>=8192&&u<=8303,Fn_Letterlike_Symbols=u=>u>=8448&&u<=8527,Fn_Number_Forms=u=>u>=8528&&u<=8591,Fn_Miscellaneous_Technical=u=>u>=8960&&u<=9215,Fn_Control_Pictures=u=>u>=9216&&u<=9279,Fn_Optical_Character_Recognition=u=>u>=9280&&u<=9311,Fn_Enclosed_Alphanumerics=u=>u>=9312&&u<=9471,Fn_Geometric_Shapes=u=>u>=9632&&u<=9727,Fn_Miscellaneous_Symbols=u=>u>=9728&&u<=9983,Fn_Miscellaneous_Symbols_and_Arrows=u=>u>=11008&&u<=11263,Fn_CJK_Radicals_Supplement=u=>u>=11904&&u<=12031,Fn_Kangxi_Radicals=u=>u>=12032&&u<=12255,Fn_Ideographic_Description_Characters=u=>u>=12272&&u<=12287,Fn_CJK_Symbols_and_Punctuation=u=>u>=12288&&u<=12351,Fn_Hiragana=u=>u>=12352&&u<=12447,Fn_Katakana=u=>u>=12448&&u<=12543,Fn_Bopomofo=u=>u>=12544&&u<=12591,Fn_Hangul_Compatibility_Jamo=u=>u>=12592&&u<=12687,Fn_Kanbun=u=>u>=12688&&u<=12703,Fn_Bopomofo_Extended=u=>u>=12704&&u<=12735,Fn_CJK_Strokes=u=>u>=12736&&u<=12783,Fn_Katakana_Phonetic_Extensions=u=>u>=12784&&u<=12799,Fn_Enclosed_CJK_Letters_and_Months=u=>u>=12800&&u<=13055,Fn_CJK_Compatibility=u=>u>=13056&&u<=13311,Fn_CJK_Unified_Ideographs_Extension_A=u=>u>=13312&&u<=19903,Fn_Yijing_Hexagram_Symbols=u=>u>=19904&&u<=19967,Fn_CJK_Unified_Ideographs=u=>u>=19968&&u<=40959,Fn_Yi_Syllables=u=>u>=40960&&u<=42127,Fn_Yi_Radicals=u=>u>=42128&&u<=42191,Fn_Hangul_Jamo_Extended_A=u=>u>=43360&&u<=43391,Fn_Hangul_Syllables=u=>u>=44032&&u<=55215,Fn_Hangul_Jamo_Extended_B=u=>u>=55216&&u<=55295,Fn_Private_Use_Area=u=>u>=57344&&u<=63743,Fn_CJK_Compatibility_Ideographs=u=>u>=63744&&u<=64255,Fn_Arabic_Presentation_Forms_A=u=>u>=64336&&u<=65023,Fn_Vertical_Forms=u=>u>=65040&&u<=65055,Fn_CJK_Compatibility_Forms=u=>u>=65072&&u<=65103,Fn_Small_Form_Variants=u=>u>=65104&&u<=65135,Fn_Arabic_Presentation_Forms_B=u=>u>=65136&&u<=65279,Fn_Halfwidth_and_Fullwidth_Forms=u=>u>=65280&&u<=65519,Fn_Osage=u=>u>=66736&&u<=66815,Fn_CJK_Unified_Ideographs_Extension_B=u=>u>=131072&&u<=173791;function qf(u){for(const o of u)if(od(o.charCodeAt(0)))return!0;return!1}function Gf(u){for(const o of u)if(!jv(o.charCodeAt(0)))return!1;return!0}function jv(u){return!(Fn_Arabic(u)||Fn_Arabic_Supplement(u)||Fn_Arabic_Extended_A(u)||Fn_Arabic_Presentation_Forms_A(u)||Fn_Arabic_Presentation_Forms_B(u))}function od(u){return!(746!==u&&747!==u&&(u<4352||!(Fn_Bopomofo_Extended(u)||Fn_Bopomofo(u)||Fn_CJK_Compatibility_Forms(u)&&!(u>=65097&&u<=65103)||Fn_CJK_Compatibility_Ideographs(u)||Fn_CJK_Compatibility(u)||Fn_CJK_Radicals_Supplement(u)||Fn_CJK_Strokes(u)||!(!Fn_CJK_Symbols_and_Punctuation(u)||u>=12296&&u<=12305||u>=12308&&u<=12319||12336===u)||Fn_CJK_Unified_Ideographs_Extension_A(u)||Fn_CJK_Unified_Ideographs(u)||Fn_Enclosed_CJK_Letters_and_Months(u)||Fn_Hangul_Compatibility_Jamo(u)||Fn_Hangul_Jamo_Extended_A(u)||Fn_Hangul_Jamo_Extended_B(u)||Fn_Hangul_Jamo(u)||Fn_Hangul_Syllables(u)||Fn_Hiragana(u)||Fn_Ideographic_Description_Characters(u)||Fn_Kanbun(u)||Fn_Kangxi_Radicals(u)||Fn_Katakana_Phonetic_Extensions(u)||Fn_Katakana(u)&&12540!==u||!(!Fn_Halfwidth_and_Fullwidth_Forms(u)||65288===u||65289===u||65293===u||u>=65306&&u<=65310||65339===u||65341===u||65343===u||u>=65371&&u<=65503||65507===u||u>=65512&&u<=65519)||!(!Fn_Small_Form_Variants(u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Fn_Unified_Canadian_Aboriginal_Syllabics(u)||Fn_Unified_Canadian_Aboriginal_Syllabics_Extended(u)||Fn_Vertical_Forms(u)||Fn_Yijing_Hexagram_Symbols(u)||Fn_Yi_Syllables(u)||Fn_Yi_Radicals(u))))}function hp(u){return!(od(u)||(o=u,Fn_Latin_1_Supplement(o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||Fn_General_Punctuation(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||Fn_Letterlike_Symbols(o)||Fn_Number_Forms(o)||Fn_Miscellaneous_Technical(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||Fn_Control_Pictures(o)&&9251!==o||Fn_Optical_Character_Recognition(o)||Fn_Enclosed_Alphanumerics(o)||Fn_Geometric_Shapes(o)||Fn_Miscellaneous_Symbols(o)&&!(o>=9754&&o<=9759)||Fn_Miscellaneous_Symbols_and_Arrows(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Fn_CJK_Symbols_and_Punctuation(o)||Fn_Katakana(o)||Fn_Private_Use_Area(o)||Fn_CJK_Compatibility_Forms(o)||Fn_Small_Form_Variants(o)||Fn_Halfwidth_and_Fullwidth_Forms(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function th(u){return u>=1424&&u<=2303||Fn_Arabic_Presentation_Forms_A(u)||Fn_Arabic_Presentation_Forms_B(u)}function vg(u,o){return!(!o&&th(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Fn_Khmer(u))}function _b(u){for(const o of u)if(th(o.charCodeAt(0)))return!0;return!1}const $f="deferred",sd="loading",pp="loaded";let Wf=null,wo="unavailable",Is=null;const Yo=function(u){u&&"string"==typeof u&&u.indexOf("NetworkError")>-1&&(wo="error"),Wf&&Wf(u)};function gu(){xg.fire(new ec("pluginStateChange",{pluginStatus:wo,pluginURL:Is}))}const xg=new uu,nh=function(){return wo},bb=function(){if(wo!==$f||!Is)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");wo=sd,gu(),Is&&jd({url:Is},u=>{u?Yo(u):(wo=pp,gu())})},Xa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>wo===pp||null!=Xa.applyArabicShaping,isLoading:()=>wo===sd,setState(u){wo=u.pluginStatus,Is=u.pluginURL},isParsed:()=>null!=Xa.applyArabicShaping&&null!=Xa.processBidirectionalText&&null!=Xa.processStyledBidirectionalText,getPluginURL:()=>Is};class Po{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(o){return function(l,p){for(const _ of l)if(!vg(_.charCodeAt(0),p))return!1;return!0}(o,Xa.isLoaded())}}class ad{constructor(o,l,p,_){this.property=o,this.value=l,this.expression=function(f,y,T,E){if(gg(f))return new _g(f,y);if($a(f)||Array.isArray(f)&&f.length>0){const P=id(f,y,T,E);if("error"===P.result)throw new Error(P.value.map(w=>`${w.key}: ${w.message}`).join(", "));return P.value}{let P=f;return"string"==typeof f&&"color"===y.type&&(P=Gn.parse(f)),{kind:"constant",configDependencies:new Set,evaluate:()=>P}}}(void 0===l?o.specification.default:l,o.specification,p,_)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,p){return this.property.possiblyEvaluate(this,o,l,p)}}class ih{constructor(o,l,p){this.property=o,this.value=new ad(o,void 0,l,p)}transitioned(o,l){return new Xf(this.property,this.value,l,yr({},o.transition,this.transition),o.now)}untransitioned(){return new Xf(this.property,this.value,null,{},0)}}class fp{constructor(o,l,p){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues),this._scope=l,this._options=p,this.configDependencies=new Set}getValue(o){return dl(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new ih(this._values[o].property,this._scope,this._options)),this._values[o].value=new ad(this._values[o].property,null===l?void 0:dl(l),this._scope,this._options),this._values[o].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].value.expression.configDependencies]))}setTransitionOrValue(o,l){l&&(this._options=l);const p=this._properties.properties;if(o)for(const _ in o){const f=o[_];if(ul(_,"-transition")){const y=_.slice(0,-11);p[y]&&this.setTransition(y,f)}else p.hasOwnProperty(_)&&this.setValue(_,f)}}getTransition(o){return dl(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new ih(this._values[o].property)),this._values[o].transition=dl(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const p=this.getValue(l);void 0!==p&&(o[l]=p);const _=this.getTransition(l);void 0!==_&&(o[`${l}-transition`]=_)}return o}transitioned(o,l){const p=new wg(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(o,l._values[_]);return p}untransitioned(){const o=new wg(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class Xf{constructor(o,l,p,_,f){const y=_.delay||0,T=_.duration||0;f=f||0,this.property=o,this.value=l,this.begin=f+y,this.end=this.begin+T,o.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(o,l,p){const _=o.now||0,f=this.value.possiblyEvaluate(o,l,p),y=this.prior;if(y){if(_>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(_<this.begin)return y.possiblyEvaluate(o,l,p);{const T=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(o,l,p),f,he(T))}}return f}}class wg{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,p){const _=new lc(this._properties);for(const f of Object.keys(this._values))_._values[f]=this._values[f].possiblyEvaluate(o,l,p);return _}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Uv{constructor(o,l,p){this._properties=o,this._values=Object.create(o.defaultPropertyValues),this._scope=l,this._options=p,this.configDependencies=new Set}getValue(o){return dl(this._values[o].value)}setValue(o,l){this._values[o]=new ad(this._values[o].property,null===l?void 0:dl(l),this._scope,this._options),this._values[o].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[o].expression.configDependencies]))}serialize(){const o={};for(const l of Object.keys(this._values)){const p=this.getValue(l);void 0!==p&&(o[l]=p)}return o}possiblyEvaluate(o,l,p){const _=new lc(this._properties);for(const f of Object.keys(this._values))_._values[f]=this._values[f].possiblyEvaluate(o,l,p);return _}}class Za{constructor(o,l,p){this.property=o,this.value=l,this.parameters=p}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,p,_){return this.property.evaluate(this.value,this.parameters,o,l,p,_)}}class lc{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class Qt{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,p){const _=Ju[this.specification.type];return _?_(o,l,p):o}}class Bn{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,p,_){return new Za(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},p,_)}:o.expression,l)}interpolate(o,l,p){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new Za(this,{kind:"constant",value:void 0},o.parameters);const _=Ju[this.specification.type];return _?new Za(this,{kind:"constant",value:_(o.value.value,l.value.value,p)},o.parameters):o}evaluate(o,l,p,_,f,y){return"constant"===o.kind?o.value:o.evaluate(l,p,_,f,y)}}class cc{constructor(o){this.specification=o}possiblyEvaluate(o,l,p,_){return!!o.expression.evaluate(l,null,{},p,_)}interpolate(){return!1}}class $r{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new Po(0,{});for(const p in o){const _=o[p];_.specification.overridable&&this.overridableProperties.push(p);const f=this.defaultPropertyValues[p]=new ad(_,void 0),y=this.defaultTransitionablePropertyValues[p]=new ih(_);this.defaultTransitioningPropertyValues[p]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[p]=f.possiblyEvaluate(l)}}}Tn(Bn,"DataDrivenProperty"),Tn(Qt,"DataConstantProperty"),Tn(cc,"ColorRampProperty");var ot=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,90],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"rain":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Sg(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function rh(u){if(Array.isArray(u))return u.map(rh);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const o={};for(const l in u)o[l]=rh(u[l]);return o}return Sg(u)}function yb(u){if(!0===u||!1===u)return!0;if(!Array.isArray(u)||0===u.length)return!1;switch(u[0]){case"has":return u.length>=2&&"$id"!==u[1]&&"$type"!==u[1];case"in":return u.length>=3&&("string"!=typeof u[1]||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==u.length||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const o of u.slice(1))if(!yb(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function ld(u,o="",l=null,p="fill"){if(null==u)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yb(u)||(u=Yf(u));const _=u;let f=!0;try{f=function(w){if(!Na(w))return w;let I=rh(w);return Zf(I),I=uc(I),I}(_)}catch(w){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(_,null,2)}\n        `)}let y=null,T=null;if("background"!==p&&"sky"!==p&&"slot"!==p){T=ot[`filter_${p}`];const w=mu(f,T,o,l);if("error"===w.result)throw new Error(w.value.map(I=>`${I.key}: ${I.message}`).join(", "));y=(I,R,D)=>w.value.evaluate(I,R,{},D)}let E=null,P=null;if(f!==_){const w=mu(_,T,o,l);if("error"===w.result)throw new Error(w.value.map(I=>`${I.key}: ${I.message}`).join(", "));E=(I,R,D,M,L)=>w.value.evaluate(I,R,{},D,void 0,void 0,M,L),P=!Sa(w.value.expression)}return{filter:y,dynamicFilter:E||void 0,needGeometry:cd(f),needFeature:!!P}}function uc(u){if(!Array.isArray(u))return u;const o=function(l){if(vb.has(l[0]))for(let p=1;p<l.length;p++)if(Na(l[p]))return!0;return l}(u);return!0===o?o:o.map(l=>uc(l))}function Zf(u){let o=!1;const l=[];if("case"===u[0]){for(let p=1;p<u.length-1;p+=2)o=o||Na(u[p]),l.push(u[p+1]);l.push(u[u.length-1])}else if("match"===u[0]){o=o||Na(u[1]);for(let p=2;p<u.length-1;p+=2)l.push(u[p+1]);l.push(u[u.length-1])}else if("step"===u[0]){o=o||Na(u[1]);for(let p=1;p<u.length-1;p+=2)l.push(u[p+1])}o&&(u.length=0,u.push("any",...l));for(let p=1;p<u.length;p++)Zf(u[p])}function Na(u){if(!Array.isArray(u))return!1;if("pitch"===(o=u[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<u.length;l++)if(Na(u[l]))return!0;return!1}const vb=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function xb(u,o){return u<o?-1:u>o?1:0}function cd(u){if(!Array.isArray(u))return!1;if("within"===u[0]||"distance"===u[0])return!0;for(let o=1;o<u.length;o++)if(cd(u[o]))return!0;return!1}function Yf(u){if(!u)return!0;const o=u[0];return u.length<=1?"any"!==o:"=="===o?_u(u[1],u[2],"=="):"!="===o?oh(_u(u[1],u[2],"==")):"<"===o||">"===o||"<="===o||">="===o?_u(u[1],u[2],o):"any"===o?(l=u.slice(1),["any"].concat(l.map(Yf))):"all"===o?["all"].concat(u.slice(1).map(Yf)):"none"===o?["all"].concat(u.slice(1).map(Yf).map(oh)):"in"===o?mp(u[1],u.slice(2)):"!in"===o?oh(mp(u[1],u.slice(2))):"has"===o?ud(u[1]):"!has"!==o||oh(ud(u[1]));var l}function _u(u,o,l){switch(u){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,u,o]}}function mp(u,o){if(0===o.length)return!1;switch(u){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",u,["literal",o.sort(xb)]]:["filter-in-small",u,["literal",o]]}}function ud(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function oh(u){return["!",u]}function gp(u,o){return o?`${u}\x1f${o}`:u}const wb="-transition",Ls=new Set(["fill","line","background","hillshade","raster"]);class Ta extends uu{constructor(o,l,p,_,f){if(super(),this.id=o.id,this.fqid=gp(this.id,p),this.type=o.type,this.scope=p,this.lut=_,this.options=f,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==o.type){if(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type&&"background"!==o.type&&"sky"!==o.type&&"slot"!==o.type){this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter;const y=mu(this.filter,ot[`filter_${o.type}`]);"error"!==y.result&&(this.configDependencies=new Set([...this.configDependencies,...y.value.configDependencies]))}if(o.slot&&(this.slot=o.slot),l.layout&&(this._unevaluatedLayout=new Uv(l.layout,this.scope,f),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),l.paint){this._transitionablePaint=new fp(l.paint,this.scope,f);for(const y in o.paint)this.setPaintProperty(y,o.paint[y]);for(const y in o.layout)this.setLayoutProperty(y,o.layout[y]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new lc(l.paint)}}}onAdd(o){}onRemove(o){}isDraped(o){return!this.is3D()&&Ls.has(this.type)}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l){if("custom"===this.type&&"visibility"===o)return void(this.visibility=l);const p=this._unevaluatedLayout;p._properties.properties[o]&&(p.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...p.configDependencies]),"visibility"===o&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(o){return ul(o,wb)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l){const p=this._transitionablePaint,_=p._properties.properties;if(ul(o,wb)){const I=o.slice(0,-11);return _[I]&&p.setTransition(I,l||void 0),!1}if(!_[o])return!1;const f=p._values[o],y=f.value.isDataDriven(),T=f.value;p.setValue(o,l),this.configDependencies=new Set([...this.configDependencies,...p.configDependencies]),this._handleSpecialPaintPropertyUpdate(o);const E=p._values[o].value,P=E.isDataDriven(),w=ul(o,"pattern")||"line-dasharray"===o;return P||y||w||this._handleOverridablePaintPropertyUpdate(o,T,E)}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getDefaultProgramParams(o,l,p){return null}_handleOverridablePaintPropertyUpdate(o,l,p){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){return Xu({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(o,l)=>!(void 0===o||"layout"===l&&!Object.keys(o).length||"paint"===l&&!Object.keys(o).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof Za&&td(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(o){this._filterCompiled||(this._featureFilter=ld(this.filter,this.scope,o),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(o){this._stats&&("shadow"===o.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(o){}queryIntersectsFeature(o,l,p,_,f,y,T,E,P){}queryIntersectsMatchingFeature(o,l,p,_){}}const ah={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class dd{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Wr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.add(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...o){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...o){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function er(u,o=1){let l=0,p=0;return{members:u.map(_=>{const f=ah[_.type].BYTES_PER_ELEMENT,y=l=_p(l,Math.max(o,f)),T=_.components||1;return p=Math.max(p,f),l+=f*T,{name:_.name,type:_.type,components:T,offset:y}}),size:_p(l,Math.max(p,o)),alignment:o}}function _p(u,o){return Math.ceil(u/o)*o}class bu extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const p=this.length;return this.resize(p+1),this.emplace(p,o,l)}emplace(o,l,p){const _=2*o;return this.int16[_+0]=l,this.int16[_+1]=p,o}}bu.prototype.bytesPerElement=4,Tn(bu,"StructArrayLayout2i4");class bp extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,l,p)}emplace(o,l,p,_){const f=3*o;return this.int16[f+0]=l,this.int16[f+1]=p,this.int16[f+2]=_,o}}bp.prototype.bytesPerElement=6,Tn(bp,"StructArrayLayout3i6");class hd extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,p,_){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,p,_)}emplace(o,l,p,_,f){const y=4*o;return this.int16[y+0]=l,this.int16[y+1]=p,this.int16[y+2]=_,this.int16[y+3]=f,o}}hd.prototype.bytesPerElement=8,Tn(hd,"StructArrayLayout4i8");class Jf extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,p,_,f)}emplace(o,l,p,_,f,y){const T=5*o;return this.int16[T+0]=l,this.int16[T+1]=p,this.int16[T+2]=_,this.int16[T+3]=f,this.int16[T+4]=y,o}}Jf.prototype.bytesPerElement=10,Tn(Jf,"StructArrayLayout5i10");class lh extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y,T){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,p,_,f,y,T)}emplace(o,l,p,_,f,y,T,E){const P=6*o,w=12*o,I=3*o;return this.int16[P+0]=l,this.int16[P+1]=p,this.uint8[w+4]=_,this.uint8[w+5]=f,this.uint8[w+6]=y,this.uint8[w+7]=T,this.float32[I+2]=E,o}}lh.prototype.bytesPerElement=12,Tn(lh,"StructArrayLayout2i4ub1f12");class Fc extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p,_){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,p,_)}emplace(o,l,p,_,f){const y=4*o;return this.float32[y+0]=l,this.float32[y+1]=p,this.float32[y+2]=_,this.float32[y+3]=f,o}}Fc.prototype.bytesPerElement=16,Tn(Fc,"StructArrayLayout4f16");class Fl extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,l,p)}emplace(o,l,p,_){const f=3*o;return this.float32[f+0]=l,this.float32[f+1]=p,this.float32[f+2]=_,o}}Fl.prototype.bytesPerElement=12,Tn(Fl,"StructArrayLayout3f12");class Ya extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,p,_,f)}emplace(o,l,p,_,f,y){const T=6*o,E=3*o;return this.uint16[T+0]=l,this.uint16[T+1]=p,this.uint16[T+2]=_,this.uint16[T+3]=f,this.float32[E+2]=y,o}}Ya.prototype.bytesPerElement=12,Tn(Ya,"StructArrayLayout4ui1f12");class Kf extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,p,_){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,p,_)}emplace(o,l,p,_,f){const y=4*o;return this.uint16[y+0]=l,this.uint16[y+1]=p,this.uint16[y+2]=_,this.uint16[y+3]=f,o}}Kf.prototype.bytesPerElement=8,Tn(Kf,"StructArrayLayout4ui8");class ch extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,p,_,f,y)}emplace(o,l,p,_,f,y,T){const E=6*o;return this.int16[E+0]=l,this.int16[E+1]=p,this.int16[E+2]=_,this.int16[E+3]=f,this.int16[E+4]=y,this.int16[E+5]=T,o}}ch.prototype.bytesPerElement=12,Tn(ch,"StructArrayLayout6i12");class pd extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y,T,E,P,w,I,R){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,p,_,f,y,T,E,P,w,I,R)}emplace(o,l,p,_,f,y,T,E,P,w,I,R,D){const M=12*o;return this.int16[M+0]=l,this.int16[M+1]=p,this.int16[M+2]=_,this.int16[M+3]=f,this.uint16[M+4]=y,this.uint16[M+5]=T,this.uint16[M+6]=E,this.uint16[M+7]=P,this.int16[M+8]=w,this.int16[M+9]=I,this.int16[M+10]=R,this.int16[M+11]=D,o}}pd.prototype.bytesPerElement=24,Tn(pd,"StructArrayLayout4i4ui4i24");class yu extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,p,_,f,y)}emplace(o,l,p,_,f,y,T){const E=10*o,P=5*o;return this.int16[E+0]=l,this.int16[E+1]=p,this.int16[E+2]=_,this.float32[P+2]=f,this.float32[P+3]=y,this.float32[P+4]=T,o}}yu.prototype.bytesPerElement=20,Tn(yu,"StructArrayLayout3i3f20");class Tg extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}Tg.prototype.bytesPerElement=4,Tn(Tg,"StructArrayLayout1ul4");class gr extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const p=this.length;return this.resize(p+1),this.emplace(p,o,l)}emplace(o,l,p){const _=2*o;return this.uint16[_+0]=l,this.uint16[_+1]=p,o}}gr.prototype.bytesPerElement=4,Tn(gr,"StructArrayLayout2ui4");class yp extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y,T,E,P,w,I,R,D){const M=this.length;return this.resize(M+1),this.emplace(M,o,l,p,_,f,y,T,E,P,w,I,R,D)}emplace(o,l,p,_,f,y,T,E,P,w,I,R,D,M){const L=20*o,V=10*o;return this.int16[L+0]=l,this.int16[L+1]=p,this.int16[L+2]=_,this.int16[L+3]=f,this.int16[L+4]=y,this.float32[V+3]=T,this.float32[V+4]=E,this.float32[V+5]=P,this.float32[V+6]=w,this.int16[L+14]=I,this.uint32[V+8]=R,this.uint16[L+18]=D,this.uint16[L+19]=M,o}}yp.prototype.bytesPerElement=40,Tn(yp,"StructArrayLayout5i4f1i1ul2ui40");class Qf extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y,T){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,p,_,f,y,T)}emplace(o,l,p,_,f,y,T,E){const P=8*o;return this.int16[P+0]=l,this.int16[P+1]=p,this.int16[P+2]=_,this.int16[P+4]=f,this.int16[P+5]=y,this.int16[P+6]=T,this.int16[P+7]=E,o}}Qf.prototype.bytesPerElement=16,Tn(Qf,"StructArrayLayout3i2i2i16");class fd extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,p,_,f)}emplace(o,l,p,_,f,y){const T=4*o,E=8*o;return this.float32[T+0]=l,this.float32[T+1]=p,this.float32[T+2]=_,this.int16[E+6]=f,this.int16[E+7]=y,o}}fd.prototype.bytesPerElement=16,Tn(fd,"StructArrayLayout2f1f2i16");class hs extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y){const T=this.length;return this.resize(T+1),this.emplace(T,o,l,p,_,f,y)}emplace(o,l,p,_,f,y,T){const E=20*o,P=5*o;return this.uint8[E+0]=l,this.uint8[E+1]=p,this.float32[P+1]=_,this.float32[P+2]=f,this.float32[P+3]=y,this.float32[P+4]=T,o}}hs.prototype.bytesPerElement=20,Tn(hs,"StructArrayLayout2ub4f20");class Xr extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,o,l,p)}emplace(o,l,p,_){const f=3*o;return this.uint16[f+0]=l,this.uint16[f+1]=p,this.uint16[f+2]=_,o}}Xr.prototype.bytesPerElement=6,Tn(Xr,"StructArrayLayout3ui6");class Nl extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y,T,E,P,w,I,R,D,M,L,V,j,G,$,H,Y){const J=this.length;return this.resize(J+1),this.emplace(J,o,l,p,_,f,y,T,E,P,w,I,R,D,M,L,V,j,G,$,H,Y)}emplace(o,l,p,_,f,y,T,E,P,w,I,R,D,M,L,V,j,G,$,H,Y,J){const ce=30*o,we=15*o,_e=60*o;return this.int16[ce+0]=l,this.int16[ce+1]=p,this.int16[ce+2]=_,this.float32[we+2]=f,this.float32[we+3]=y,this.uint16[ce+8]=T,this.uint16[ce+9]=E,this.uint32[we+5]=P,this.uint32[we+6]=w,this.uint32[we+7]=I,this.uint16[ce+16]=R,this.uint16[ce+17]=D,this.uint16[ce+18]=M,this.float32[we+10]=L,this.float32[we+11]=V,this.uint8[_e+48]=j,this.uint8[_e+49]=G,this.uint8[_e+50]=$,this.uint32[we+13]=H,this.int16[ce+28]=Y,this.uint8[_e+58]=J,o}}Nl.prototype.bytesPerElement=60,Tn(Nl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class vu extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y,T,E,P,w,I,R,D,M,L,V,j,G,$,H,Y,J,ce,we,_e,be,Z,de,De,Be,je,Xe){const it=this.length;return this.resize(it+1),this.emplace(it,o,l,p,_,f,y,T,E,P,w,I,R,D,M,L,V,j,G,$,H,Y,J,ce,we,_e,be,Z,de,De,Be,je,Xe)}emplace(o,l,p,_,f,y,T,E,P,w,I,R,D,M,L,V,j,G,$,H,Y,J,ce,we,_e,be,Z,de,De,Be,je,Xe,it){const at=20*o,et=40*o,It=80*o;return this.float32[at+0]=l,this.float32[at+1]=p,this.int16[et+4]=_,this.int16[et+5]=f,this.int16[et+6]=y,this.int16[et+7]=T,this.int16[et+8]=E,this.int16[et+9]=P,this.int16[et+10]=w,this.int16[et+11]=I,this.int16[et+12]=R,this.uint16[et+13]=D,this.uint16[et+14]=M,this.uint16[et+15]=L,this.uint16[et+16]=V,this.uint16[et+17]=j,this.uint16[et+18]=G,this.uint16[et+19]=$,this.uint16[et+20]=H,this.uint16[et+21]=Y,this.uint16[et+22]=J,this.uint16[et+23]=ce,this.uint16[et+24]=we,this.uint16[et+25]=_e,this.uint16[et+26]=be,this.uint16[et+27]=Z,this.uint32[at+14]=de,this.float32[at+15]=De,this.float32[at+16]=Be,this.float32[at+17]=je,this.float32[at+18]=Xe,this.uint8[It+76]=it,o}}vu.prototype.bytesPerElement=80,Tn(vu,"StructArrayLayout2f9i15ui1ul4f1ub80");class md extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}md.prototype.bytesPerElement=4,Tn(md,"StructArrayLayout1f4");class Nc extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f){const y=this.length;return this.resize(y+1),this.emplace(y,o,l,p,_,f)}emplace(o,l,p,_,f,y){const T=5*o;return this.float32[T+0]=l,this.float32[T+1]=p,this.float32[T+2]=_,this.float32[T+3]=f,this.float32[T+4]=y,o}}Nc.prototype.bytesPerElement=20,Tn(Nc,"StructArrayLayout5f20");class xu extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y,T){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,p,_,f,y,T)}emplace(o,l,p,_,f,y,T,E){const P=7*o;return this.float32[P+0]=l,this.float32[P+1]=p,this.float32[P+2]=_,this.float32[P+3]=f,this.float32[P+4]=y,this.float32[P+5]=T,this.float32[P+6]=E,o}}xu.prototype.bytesPerElement=28,Tn(xu,"StructArrayLayout7f28");class Cg extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y,T,E,P,w,I){const R=this.length;return this.resize(R+1),this.emplace(R,o,l,p,_,f,y,T,E,P,w,I)}emplace(o,l,p,_,f,y,T,E,P,w,I,R){const D=11*o;return this.float32[D+0]=l,this.float32[D+1]=p,this.float32[D+2]=_,this.float32[D+3]=f,this.float32[D+4]=y,this.float32[D+5]=T,this.float32[D+6]=E,this.float32[D+7]=P,this.float32[D+8]=w,this.float32[D+9]=I,this.float32[D+10]=R,o}}Cg.prototype.bytesPerElement=44,Tn(Cg,"StructArrayLayout11f44");class Sb extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y,T,E,P){const w=this.length;return this.resize(w+1),this.emplace(w,o,l,p,_,f,y,T,E,P)}emplace(o,l,p,_,f,y,T,E,P,w){const I=9*o;return this.float32[I+0]=l,this.float32[I+1]=p,this.float32[I+2]=_,this.float32[I+3]=f,this.float32[I+4]=y,this.float32[I+5]=T,this.float32[I+6]=E,this.float32[I+7]=P,this.float32[I+8]=w,o}}Sb.prototype.bytesPerElement=36,Tn(Sb,"StructArrayLayout9f36");class en extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,p,_){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,p,_)}emplace(o,l,p,_,f){const y=6*o;return this.uint32[3*o+0]=l,this.uint16[y+2]=p,this.uint16[y+3]=_,this.uint16[y+4]=f,o}}en.prototype.bytesPerElement=12,Tn(en,"StructArrayLayout1ul3ui12");class Tb extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}Tb.prototype.bytesPerElement=2,Tn(Tb,"StructArrayLayout1ui2");class em extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const p=this.length;return this.resize(p+1),this.emplace(p,o,l)}emplace(o,l,p){const _=2*o;return this.float32[_+0]=l,this.float32[_+1]=p,o}}em.prototype.bytesPerElement=8,Tn(em,"StructArrayLayout2f8");class tm extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y,T,E,P,w,I,R,D,M,L,V){const j=this.length;return this.resize(j+1),this.emplace(j,o,l,p,_,f,y,T,E,P,w,I,R,D,M,L,V)}emplace(o,l,p,_,f,y,T,E,P,w,I,R,D,M,L,V,j){const G=16*o;return this.float32[G+0]=l,this.float32[G+1]=p,this.float32[G+2]=_,this.float32[G+3]=f,this.float32[G+4]=y,this.float32[G+5]=T,this.float32[G+6]=E,this.float32[G+7]=P,this.float32[G+8]=w,this.float32[G+9]=I,this.float32[G+10]=R,this.float32[G+11]=D,this.float32[G+12]=M,this.float32[G+13]=L,this.float32[G+14]=V,this.float32[G+15]=j,o}}tm.prototype.bytesPerElement=64,Tn(tm,"StructArrayLayout16f64");class Dg extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,p,_,f,y,T){const E=this.length;return this.resize(E+1),this.emplace(E,o,l,p,_,f,y,T)}emplace(o,l,p,_,f,y,T,E){const P=10*o,w=5*o;return this.uint16[P+0]=l,this.uint16[P+1]=p,this.uint16[P+2]=_,this.uint16[P+3]=f,this.float32[w+2]=y,this.float32[w+3]=T,this.float32[w+4]=E,o}}Dg.prototype.bytesPerElement=20,Tn(Dg,"StructArrayLayout4ui3f20");class Eg extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.int16[1*o+0]=l,o}}Eg.prototype.bytesPerElement=2,Tn(Eg,"StructArrayLayout1i2");class Ig extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint8[1*o+0]=l,o}}Ig.prototype.bytesPerElement=1,Tn(Ig,"StructArrayLayout1ub1");class Hv extends dd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Hv.prototype.size=40;class wu extends yp{get(o){return new Hv(this,o)}}Tn(wu,"CollisionBoxArray");class nm extends dd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}nm.prototype.size=60;class Cb extends Nl{get(o){return new nm(this,o)}}Tn(Cb,"PlacedSymbolArray");class Ms extends dd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(o){this._structArray.uint32[this._pos4+14]=o}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(o){this._structArray.float32[this._pos4+18]=o}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Ms.prototype.size=80;class vp extends vu{get(o){return new Ms(this,o)}}Tn(vp,"SymbolInstanceArray");class uh extends md{getoffsetX(o){return this.float32[1*o+0]}}Tn(uh,"GlyphOffsetArray");class Mg extends bu{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}Tn(Mg,"SymbolLineVertexArray");class Db extends dd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Db.prototype.size=12;class Ba extends en{get(o){return new Db(this,o)}}Tn(Ba,"FeatureIndexArray");class dc extends gr{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}Tn(dc,"FillExtrusionCentroidArray");class Ag extends dd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Ag.prototype.size=6;class dh extends bp{get(o){return new Ag(this,o)}}Tn(dh,"FillExtrusionWallArray");const xp=er([{name:"a_pos",components:2,type:"Int16"}],4),Eb=er([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class No{constructor(o=[]){this.segments=o}_prepareSegment(o,l,p,_){let f=this.segments[this.segments.length-1];return o>No.MAX_VERTEX_ARRAY_LENGTH&&Ki(`Max vertices per segment is ${No.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!f||f.vertexLength+o>No.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==_)&&(f={vertexOffset:l,primitiveOffset:p,vertexLength:0,primitiveLength:0},void 0!==_&&(f.sortKey=_),this.segments.push(f)),f}prepareSegment(o,l,p,_){return this._prepareSegment(o,l.length,p.length,_)}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,p,_){return new No([{vertexOffset:o,primitiveOffset:l,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function Ib(u,o){return 256*(u=Bt(Math.floor(u),0,255))+Bt(Math.floor(o),0,255)}No.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tn(No,"SegmentVector");const Q1=er([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ew=er([{name:"a_dash",components:4,type:"Uint16"}]);class hh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(o,l,p,_){this.ids.push(za(o)),this.positions.push(l,p,_)}eachPosition(o,l){const p=za(o);let _=0,f=this.ids.length-1;for(;_<f;){const y=_+f>>1;this.ids[y]>=p?f=y:_=y+1}for(;this.ids[_]===p;)l(this.positions[3*_],this.positions[3*_+1],this.positions[3*_+2]),_++}static serialize(o,l){const p=new Float64Array(o.ids),_=new Uint32Array(o.positions);return Su(p,_,0,p.length-1),l&&(l.add(p.buffer),l.add(_.buffer)),{ids:p,positions:_}}static deserialize(o){const l=new hh;let p;l.ids=o.ids,l.positions=o.positions;for(const _ of l.ids)_!==p&&l.uniqueIds.push(_),p=_;return l.indexed=!0,l}}function za(u){const o=+u;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Cr(String(u))}function Su(u,o,l,p){for(;l<p;){const _=u[l+p>>1];let f=l-1,y=p+1;for(;;){do{f++}while(u[f]<_);do{y--}while(u[y]>_);if(f>=y)break;Bc(u,f,y),Bc(o,3*f,3*y),Bc(o,3*f+1,3*y+1),Bc(o,3*f+2,3*y+2)}y-l<p-y?(Su(u,o,l,y),l=y+1):(Su(u,o,y+1,p),p=y)}}function Bc(u,o,l){const p=u[o];u[o]=u[l],u[l]=p}Tn(hh,"FeaturePositionMap");class Tu{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}set(o,l,p){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Cu extends Tu{constructor(o){super(o),this.current=0}set(o,l,p){this.fetchUniformLocation(o,l)&&this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))}}class xs extends Tu{constructor(o){super(o),this.current=0}set(o,l,p){this.fetchUniformLocation(o,l)&&this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))}}class hc extends Tu{constructor(o){super(o),this.current=[0,0]}set(o,l,p){this.fetchUniformLocation(o,l)&&(p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1])))}}class Rg extends Tu{constructor(o){super(o),this.current=[0,0,0]}set(o,l,p){this.fetchUniformLocation(o,l)&&(p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2])))}}class im extends Tu{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,p){this.fetchUniformLocation(o,l)&&(p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3])))}}class Pg extends Tu{constructor(o){super(o),this.current=Gn.transparent.toRenderColor(null)}set(o,l,p){this.fetchUniformLocation(o,l)&&(p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a)))}}const Mb=new Float32Array(16);class gd extends Tu{constructor(o){super(o),this.current=Mb}set(o,l,p){if(this.fetchUniformLocation(o,l)){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(let _=1;_<16;_++)if(p[_]!==this.current[_]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}}}}const rm=new Float32Array(9),qv=new Float32Array(4);class Du extends Tu{constructor(o){super(o),this.current=qv}set(o,l,p){if(this.fetchUniformLocation(o,l))for(let _=0;_<4;_++)if(p[_]!==this.current[_]){this.current=p,this.gl.uniformMatrix2fv(this.location,!1,p);break}}}function wp(u){return[Ib(255*u.r,255*u.g),Ib(255*u.b,255*u.a)]}class Eu{constructor(o,l,p,_){this.value=o,this.uniformNames=l.map(f=>`u_${f}`),this.type=p,this.context=_}setUniform(o,l,p,_,f){const y=_.constantOr(this.value);l.set(o,f,y instanceof Gn?y.toRenderColor(this.context.lut):y)}getBinding(o,l){return"color"===this.type?new Pg(o):new xs(o)}}class ph{constructor(o,l){this.uniformNames=l.map(p=>`u_${p}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,l,p,_,f){const y="u_pattern"===f||"u_dash"===f?this.pattern:"u_pixel_ratio"===f?this.pixelRatio:null;y&&l.set(o,f,y)}getBinding(o,l){return"u_pattern"===l||"u_dash"===l?new im(o):new xs(o)}}class zc{constructor(o,l,p,_){this.expression=o,this.type=p,this.maxValue=0,this.paintVertexAttributes=l.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===p?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(o,l,p,_,f,y,T){const E=this.paintVertexArray.length,P=this.expression.evaluate(new Po(0,{brightness:y}),l,{},f,_,T);this.paintVertexArray.resize(o),this._setPaintValue(E,o,P,this.context)}updatePaintArray(o,l,p,_,f,y,T){const E=this.expression.evaluate({zoom:0,brightness:T},p,_,void 0,f);this._setPaintValue(o,l,E,this.context)}_setPaintValue(o,l,p,_){if("color"===this.type){const f=wp(p.toRenderColor(_.lut));for(let y=o;y<l;y++)this.paintVertexArray.emplace(y,f[0],f[1])}else{for(let f=o;f<l;f++)this.paintVertexArray.emplace(f,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bl{constructor(o,l,p,_,f,y){this.expression=o,this.uniformNames=l.map(T=>`u_${T}_t`),this.type=p,this.useIntegerZoom=_,this.context=f,this.maxValue=0,this.paintVertexAttributes=l.map(T=>({name:`a_${T}`,type:"Float32",components:"color"===p?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(o,l,p,_,f,y,T){const E=this.expression.evaluate(new Po(this.context.zoom,{brightness:y}),l,{},f,_,T),P=this.expression.evaluate(new Po(this.context.zoom+1,{brightness:y}),l,{},f,_,T),w=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(w,o,E,P,this.context)}updatePaintArray(o,l,p,_,f,y,T){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:T},p,_,void 0,f),P=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T},p,_,void 0,f);this._setPaintValue(o,l,E,P,this.context)}_setPaintValue(o,l,p,_,f){if("color"===this.type){const y=wp(p.toRenderColor(f.lut)),T=wp(p.toRenderColor(f.lut));for(let E=o;E<l;E++)this.paintVertexArray.emplace(E,y[0],y[1],T[0],T[1])}else{for(let y=o;y<l;y++)this.paintVertexArray.emplace(y,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,p,_,f){const y=this.useIntegerZoom?Math.floor(p.zoom):p.zoom,T=Bt(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);l.set(o,f,T)}getBinding(o,l){return new xs(o)}}class pc{constructor(o,l,p,_,f){this.expression=o,this.layerId=f,this.paintVertexAttributes=("array"===p?ew:Q1).members;for(let y=0;y<l.length;++y);this.paintVertexArray=new _}populatePaintArray(o,l,p,_){const f=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(f,o,l.patterns&&l.patterns[this.layerId],p)}updatePaintArray(o,l,p,_,f,y,T){this._setPaintValues(o,l,p.patterns&&p.patterns[this.layerId],y)}_setPaintValues(o,l,p,_){if(!_||!p)return;const f=_[p];if(!f)return;const{tl:y,br:T,pixelRatio:E}=f;for(let P=o;P<l;P++)this.paintVertexArray.emplace(P,y[0],y[1],T[0],T[1],E)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ja{constructor(o,l,p=(()=>!0)){this.binders={},this._buffers=[],this.context=l;const _=[];for(const f in o.paint._values){const y=o.paint.get(f);if(!p(f)||!(y instanceof Za&&td(y.property.specification)))continue;const T=Tt(f,o.type),E=y.value,P=y.property.specification.type,w=!!y.property.useIntegerZoom,I="line-dasharray"===f||f.endsWith("pattern"),R="line-dasharray"===f&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==E.kind||R)if("source"===E.kind||R||I){const D=om(f,P,"source");this.binders[f]=I?new pc(E,T,P,D,o.id):new zc(E,T,P,D),_.push(`/a_${f}`)}else{const D=om(f,P,"composite");this.binders[f]=new Bl(E,T,P,w,l,D),_.push(`/z_${f}`)}else this.binders[f]=I?new ph(E.value,T):new Eu(E.value,T,P,l),_.push(`/u_${f}`)}this.cacheKey=_.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof zc||l instanceof Bl?l.maxValue:0}populatePaintArrays(o,l,p,_,f,y,T){for(const E in this.binders){const P=this.binders[E];P.context=this.context,(P instanceof zc||P instanceof Bl||P instanceof pc)&&P.populatePaintArray(o,l,p,_,f,y,T)}}setConstantPatternPositions(o){for(const l in this.binders){const p=this.binders[l];p instanceof ph&&p.setConstantPatternPositions(o)}}updatePaintArrays(o,l,p,_,f,y,T,E){let P=!1;const w=Object.keys(o),I=0!==w.length,R=I?w:l.uniqueIds;this.context.lut=f.lut;for(const D in this.binders){const M=this.binders[D];if(M.context=this.context,(M instanceof zc||M instanceof Bl||M instanceof pc)&&(!0===M.expression.isStateDependent||!1===M.expression.isLightConstant)){const L=f.paint.get(D);M.expression=L.value;for(const V of R){const j=o[V.toString()];l.eachPosition(V,(G,$,H)=>{const Y=_.feature(G);M.updatePaintArray($,H,Y,j,y,T,E)})}if(!I)for(const V of p.uniqueIds){const j=o[V.toString()];p.eachPosition(V,(G,$,H)=>{const Y=_.feature(G);M.updatePaintArray($,H,Y,j,y,T,E)})}P=!0}}return P}defines(){const o=[];for(const l in this.binders){const p=this.binders[l];(p instanceof Eu||p instanceof ph)&&o.push(...p.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof zc||p instanceof Bl||p instanceof pc)for(let _=0;_<p.paintVertexAttributes.length;_++)o.push(p.paintVertexAttributes[_].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof Eu||p instanceof ph||p instanceof Bl)for(const _ of p.uniformNames)o.push(_)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const p in this.binders){const _=this.binders[p];if(_ instanceof Eu||_ instanceof ph||_ instanceof Bl)for(const f of _.uniformNames)l.push({name:f,property:p,binding:_.getBinding(o,f)})}return l}setUniforms(o,l,p,_,f){for(const{name:y,property:T,binding:E}of p)this.binders[T].setUniform(o,E,f,_.get(T),y)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const l=this.binders[o];(l instanceof zc||l instanceof Bl||l instanceof pc)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(o){for(const l in this.binders){const p=this.binders[l];(p instanceof zc||p instanceof Bl||p instanceof pc)&&p.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof zc||l instanceof Bl||l instanceof pc)&&l.destroy()}}}class Ca{constructor(o,l,p=(()=>!0)){this.programConfigurations={};for(const _ of o)this.programConfigurations[_.id]=new Ja(_,l,p);this.needsUpload=!1,this._featureMap=new hh,this._featureMapWithoutIds=new hh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(o,l,p,_,f,y,T,E){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(o,l,_,f,y,T,E);void 0!==l.id?this._featureMap.add(l.id,p,this._bufferOffset,o):(this._featureMapWithoutIds.add(this._idlessCounter,p,this._bufferOffset,o),this._idlessCounter+=1),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,p,_,f,y){for(const T of p)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(o,this._featureMap,this._featureMapWithoutIds,l,T,_,f,y||0)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const Gv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Tt(u,o){return Gv[u]||[u.replace(`${o}-`,"").replace(/-/g,"_")]}const Ab={"line-pattern":{source:Ya,composite:Ya},"fill-pattern":{source:Ya,composite:Ya},"fill-extrusion-pattern":{source:Ya,composite:Ya},"line-dasharray":{source:Kf,composite:Kf}},$o={color:{source:em,composite:Fc},number:{source:md,composite:em}};function om(u,o,l){const p=Ab[u];return p&&p[l]||$o[o][l]}Tn(Eu,"ConstantBinder"),Tn(ph,"PatternConstantBinder"),Tn(zc,"SourceExpressionBinder"),Tn(pc,"PatternCompositeBinder"),Tn(Bl,"CompositeExpressionBinder"),Tn(Ja,"ProgramConfiguration",{omit:["_buffers"]}),Tn(Ca,"ProgramConfigurationSet");const ws=an/Math.PI/2,c=64,g=[c,32,16],v=-ws,S=ws;function C(u,o,l,p=ws){return l=pi(l),[u*Math.sin(l)*p,-o*p,u*Math.cos(l)*p]}function k(u,o,l){return C(Math.cos(pi(u)),Math.sin(pi(u)),o,l)}const F=6371008.8,z=2*Math.PI*F;class N{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new N(hr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,p=this.lat*l,_=o.lat*l,f=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((o.lng-this.lng)*l);return F*Math.acos(Math.min(f,1))}toBounds(o=0){const l=360*o/40075017,p=l/Math.cos(Math.PI/180*this.lat);return new U({lng:this.lng-p,lat:this.lat-l},{lng:this.lng+p,lat:this.lat+l})}toEcef(o){return k(this.lat,this.lng,ws+o*ws/F)}static convert(o){if(o instanceof N)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new N(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new N(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class U{constructor(o,l){if(o)if(l)this.setSouthWest(o).setNorthEast(l);else if(4===o.length){const p=o;this.setSouthWest([p[0],p[1]]).setNorthEast([p[2],p[3]])}else{const p=o;this.setSouthWest(p[0]).setNorthEast(p[1])}}setNorthEast(o){return this._ne=o instanceof N?new N(o.lng,o.lat):N.convert(o),this}setSouthWest(o){return this._sw=o instanceof N?new N(o.lng,o.lat):N.convert(o),this}extend(o){const l=this._sw,p=this._ne;let _,f;if(o instanceof N)_=o,f=o;else{if(!(o instanceof U))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(U.convert(o)):this.extend(N.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(N.convert(o)):this;if(_=o._sw,f=o._ne,!_||!f)return this}return l||p?(l.lng=Math.min(_.lng,l.lng),l.lat=Math.min(_.lat,l.lat),p.lng=Math.max(f.lng,p.lng),p.lat=Math.max(f.lat,p.lat)):(this._sw=new N(_.lng,_.lat),this._ne=new N(f.lng,f.lat)),this}getCenter(){return new N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new N(this.getWest(),this.getNorth())}getSouthEast(){return new N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:p}=N.convert(o);let _=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&_}static convert(o){if(o)return o instanceof U?o:new U(o)}}function ee(u){return z*Math.cos(u*Math.PI/180)}function K(u){return(180+u)/360}function re(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function ie(u,o){return u/ee(o)}function ge(u){return 360*u-180}function xe(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function ve(u,o){return u*ee(xe(o))}const Ee=85.051129;function Ae(u){return Math.cos(pi(Bt(u,-Ee,Ee)))}function Ie(u,o){const l=Bt(o,0,25.5),p=Math.pow(2,l);return Ae(u)*z/(512*p)}function Re(u){return 1/Math.cos(u*Math.PI/180)}function Fe(u,o=0){const l=Math.exp(Math.PI*(1-(u.y+o/an)/(1<<u.z)*2));return 80150034*l/(l*l+1)/an/(1<<u.z)}class He{constructor(o,l,p=0){this.x=+o,this.y=+l,this.z=+p}static fromLngLat(o,l=0){const p=N.convert(o);return new He(K(p.lng),re(p.lat),ie(l,p.lat))}toLngLat(){return new N(ge(this.x),xe(this.y))}toAltitude(){return ve(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/z*Re(xe(this.y))}}function ze(u,o,l,p,_,f,y,T,E){const P=(o+p)/2,w=(l+_)/2,I=new Ht(P,w);T(I),function(R,D,M,L,V,j){const G=M-V,$=L-j;return Math.abs((L-D)*G-(M-R)*$)/Math.hypot(G,$)}(I.x,I.y,f.x,f.y,y.x,y.y)>=E?(ze(u,o,l,P,w,f,I,T,E),ze(u,P,w,p,_,I,y,T,E)):u.push(y)}function Ne(u,o,l){let p=u[0],_=p.x,f=p.y;o(p);const y=[p];for(let T=1;T<u.length;T++){const E=u[T],{x:P,y:w}=E;o(E),ze(y,_,f,P,w,p,E,o,l),_=P,f=w,p=E}return y}function ut(u,o,l,p){if(p(o,l)){const _=o.add(l)._mult(.5);ut(u,o,_,p),ut(u,_,l,p)}else u.push(l)}function wt(u,o){let l=u[0];const p=[l];for(let _=1;_<u.length;_++){const f=u[_];ut(p,l,f,o),l=f}return p}const zt=Math.pow(2,14)-1,Zt=-zt-1;function sn(u,o){const l=Math.round(u.x*o),p=Math.round(u.y*o);return u.x=Bt(l,Zt,zt),u.y=Bt(p,Zt,zt),(l<u.x||l>u.x+1||p<u.y||p>u.y+1)&&Ki("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function Ke(u,o,l){const p=u.loadGeometry(),_=u.extent,f=an/_;if(o&&l&&l.projection.isReprojectedInTileSpace){const y=1<<o.z,{scale:T,x:E,y:P,projection:w}=l,I=R=>{const D=ge((o.x+R.x/_)/y),M=xe((o.y+R.y/_)/y),L=w.project(D,M);R.x=(L.x*T-E)*_,R.y=(L.y*T-P)*_};for(let R=0;R<p.length;R++)if(1!==u.type)p[R]=Ne(p[R],I,1);else{const D=[];for(const M of p[R])M.x<0||M.x>=_||M.y<0||M.y>=_||(I(M),D.push(M));p[R]=D}}for(const y of p)for(const T of y)sn(T,f);return p}function Pt(u,o){return{type:u.type,id:u.id,properties:u.properties,geometry:o?Ke(u):[]}}function bt(u,o,l,p,_){u.emplaceBack(2*o+(p+1)/2,2*l+(_+1)/2)}function Ot(u,o,l){u.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class Ut{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new bu,this.indexArray=new Xr,this.segments=new No,this.programConfigurations=new Ca(o.layers,{zoom:o.zoom,lut:o.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}updateFootprints(o,l){}populate(o,l,p,_){const f=this.layers[0],y=[];let T=null;"circle"===f.type&&(T=f.layout.get("circle-sort-key"));for(const{feature:P,id:w,index:I,sourceLayerIndex:R}of o){const D=this.layers[0]._featureFilter.needGeometry,M=Pt(P,D);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),M,p))continue;const L=T?T.evaluate(M,{},p):void 0,V={id:w,properties:P.properties,type:P.type,sourceLayerIndex:R,index:I,geometry:D?M.geometry:Ke(P,p,_),patterns:{},sortKey:L};y.push(V)}T&&y.sort((P,w)=>P.sortKey-w.sortKey);let E=null;"globe"===_.projection.name&&(this.globeExtVertexArray=new ch,E=_.projection);for(const P of y){const{geometry:w,index:I,sourceLayerIndex:R}=P,D=o[I].feature;this.addFeature(P,w,I,l.availableImages,p,E,l.brightness),l.featureIndex.insert(D,w,I,R,this.index)}}update(o,l,p,_,f){const y=0!==Object.keys(o).length;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(o,l,y?this.stateDependentLayers:this.layers,p,_,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,xp.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,Eb.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,p,_,f,y,T){for(const E of l)for(const P of E){const w=P.x,I=P.y;if(w<0||w>=an||I<0||I>=an)continue;if(y){const M=y.projectTilePoint(w,I,f),L=y.upVector(f,w,I),V=this.globeExtVertexArray;Ot(V,M,L),Ot(V,M,L),Ot(V,M,L),Ot(V,M,L)}const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),D=R.vertexLength;bt(this.layoutVertexArray,w,I,-1,-1),bt(this.layoutVertexArray,w,I,1,-1),bt(this.layoutVertexArray,w,I,1,1),bt(this.layoutVertexArray,w,I,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,{},_,f,T)}}function Lt(u,o){for(let l=0;l<u.length;l++)if(Xi(o,u[l]))return!0;for(let l=0;l<o.length;l++)if(Xi(u,o[l]))return!0;return!!Sn(u,o)}function un(u,o,l){return!!Xi(u,o)||!!pn(o,u,l)}function Ln(u,o){if(1===u.length)return Jn(o,u[0]);for(let l=0;l<o.length;l++){const p=o[l];for(let _=0;_<p.length;_++)if(Xi(u,p[_]))return!0}for(let l=0;l<u.length;l++)if(Jn(o,u[l]))return!0;for(let l=0;l<o.length;l++)if(Sn(u,o[l]))return!0;return!1}function zn(u,o,l){if(u.length>1){if(Sn(u,o))return!0;for(let p=0;p<o.length;p++)if(pn(o[p],u,l))return!0}for(let p=0;p<u.length;p++)if(pn(u[p],o,l))return!0;return!1}function Sn(u,o){if(0===u.length||0===o.length)return!1;for(let l=0;l<u.length-1;l++){const p=u[l],_=u[l+1];for(let f=0;f<o.length-1;f++)if(jn(p,_,o[f],o[f+1]))return!0}return!1}function jn(u,o,l,p){return Kl(u,l,p)!==Kl(o,l,p)&&Kl(u,o,l)!==Kl(u,o,p)}function pn(u,o,l){const p=l*l;if(1===o.length)return u.distSqr(o[0])<p;for(let _=1;_<o.length;_++)if(Yn(u,o[_-1],o[_])<p)return!0;return!1}function Yn(u,o,l){const p=o.distSqr(l);if(0===p)return u.distSqr(o);const _=((u.x-o.x)*(l.x-o.x)+(u.y-o.y)*(l.y-o.y))/p;return u.distSqr(_<0?o:_>1?l:l.sub(o)._mult(_)._add(o))}function Jn(u,o){let l,p,_,f=!1;for(let y=0;y<u.length;y++){l=u[y];for(let T=0,E=l.length-1;T<l.length;E=T++)p=l[T],_=l[E],p.y>o.y!=_.y>o.y&&o.x<(_.x-p.x)*(o.y-p.y)/(_.y-p.y)+p.x&&(f=!f)}return f}function Xi(u,o){let l=!1;for(let p=0,_=u.length-1;p<u.length;_=p++){const f=u[p],y=u[_];f.y>o.y!=y.y>o.y&&o.x<(y.x-f.x)*(o.y-f.y)/(y.y-f.y)+f.x&&(l=!l)}return l}function Br(u,o,l,p,_){for(const y of u)if(o<=y.x&&l<=y.y&&p>=y.x&&_>=y.y)return!0;const f=[new Ht(o,l),new Ht(o,_),new Ht(p,_),new Ht(p,l)];if(u.length>2)for(const y of f)if(Xi(u,y))return!0;for(let y=0;y<u.length-1;y++)if(rr(u[y],u[y+1],f))return!0;return!1}function rr(u,o,l){const p=l[0],_=l[2];if(u.x<p.x&&o.x<p.x||u.x>_.x&&o.x>_.x||u.y<p.y&&o.y<p.y||u.y>_.y&&o.y>_.y)return!1;const f=Kl(u,o,l[0]);return f!==Kl(u,o,l[1])||f!==Kl(u,o,l[2])||f!==Kl(u,o,l[3])}function Zr(u,o,l,p,_,f){let y=o.y-u.y,T=u.x-o.x;if(f=f||0){const E=y*y+T*T;if(0===E)return!0;const P=Math.sqrt(E);y/=P,T/=P}return!((l.x-u.x)*y+(l.y-u.y)*T-f<0||(p.x-u.x)*y+(p.y-u.y)*T-f<0||(_.x-u.x)*y+(_.y-u.y)*T-f<0)}function ur(u,o,l,p,_,f,y){return!(Zr(u,o,p,_,f,y)||Zr(o,l,p,_,f,y)||Zr(l,u,p,_,f,y)||Zr(p,_,u,o,l,y)||Zr(_,f,u,o,l,y)||Zr(f,p,u,o,l,y))}function zr(u,o,l){const p=o.paint.get(u).value;return"constant"===p.kind?p.value:l.programConfigurations.get(o.id).getMaxValue(u)}function Bi(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Or(u,o,l,p,_){if(!o[0]&&!o[1])return u;const f=Ht.convert(o)._mult(_);"viewport"===l&&f._rotate(-p);const y=[];for(let T=0;T<u.length;T++)y.push(u[T].sub(f));return y}function Er(u,o,l,p){const _=Ht.convert(u)._mult(p);return"viewport"===o&&_._rotate(-l),_}let xr,po;Tn(Ut,"CircleBucket",{omit:["layers"]});var Vr,Da={exports:{}},Ka=(Vr||(Vr=1,function(l){function p(f,y,T){var E=_(256*f,256*(y=Math.pow(2,T)-y-1),T),P=_(256*(f+1),256*(y+1),T);return E[0]+","+E[1]+","+P[0]+","+P[1]}function _(f,y,T){var E=2*Math.PI*6378137/256/Math.pow(2,T);return[f*E-2*Math.PI*6378137/2,y*E-2*Math.PI*6378137/2]}l.getURL=function(f,y,T,E,P,w){return w=w||{},f+"?"+["bbox="+p(T,E,P),"format="+(w.format||"image/png"),"service="+(w.service||"WMS"),"version="+(w.version||"1.1.1"),"request="+(w.request||"GetMap"),"srs="+(w.srs||"EPSG:3857"),"width="+(w.width||256),"height="+(w.height||256),"layers="+y].join("&")},l.getTileBBox=p,l.getMercCoords=_,Object.defineProperty(l,"__esModule",{value:!0})}(Da.exports)),Da.exports);class ss{constructor(o,l,p){this.z=o,this.x=l,this.y=p,this.key=fr(0,o,o,l,p)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const p=Ka.getTileBBox(this.x,this.y,this.z),_=function(f,y,T){let E,P="";for(let w=f;w>0;w--)E=1<<w-1,P+=(y&E?1:0)+(T&E?2:0);return P}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",_).replace("{bbox-epsg-3857}",p)}toString(){return`${this.z}/${this.x}/${this.y}`}}class vi{constructor(o,l){this.wrap=o,this.canonical=l,this.key=fr(o,l.z,l.z,l.x,l.y)}}class zi{constructor(o,l,p,_,f){this.overscaledZ=o,this.wrap=l,this.canonical=new ss(p,+_,+f),this.key=0===l&&o===p?this.canonical.key:fr(l,o,p,_,f)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new zi(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zi(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return fr(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const p=this.canonical.z-o;return fr(this.wrap*+l,o,o,this.canonical.x>>p,this.canonical.y>>p)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.z<this.canonical.z&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new zi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new zi(l,this.wrap,l,p,_),new zi(l,this.wrap,l,p+1,_),new zi(l,this.wrap,l,p,_+1),new zi(l,this.wrap,l,p+1,_+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new zi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new zi(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new vi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function fr(u,o,l,p,_){const f=1<<Math.min(l,22);let y=f*(_%f)+p%f;return u&&l<22&&(y+=f*f*((u<0?-2*u-1:2*u)%(1<<2*(22-l)))),16*(32*y+l)+(o-l)}const Yr=[u=>{let o=u.canonical.x-1,l=u.wrap;return o<0&&(o=(1<<u.canonical.z)-1,l--),new zi(u.overscaledZ,l,u.canonical.z,o,u.canonical.y)},u=>{let o=u.canonical.x+1,l=u.wrap;return o===1<<u.canonical.z&&(o=0,l++),new zi(u.overscaledZ,l,u.canonical.z,o,u.canonical.y)},u=>new zi(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(0===u.canonical.y?1<<u.canonical.z:u.canonical.y)-1),u=>new zi(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];Tn(ss,"CanonicalTileID"),Tn(zi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Bo=er([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:io}=Bo,As=er([{name:"a_pos_3",components:3,type:"Int16"}]);var zl=er([{name:"a_pos",type:"Int16",components:2}]);class Va{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,p){const _=Q.vec3.dot(l,this.dir);if(Math.abs(_)<1e-6)return!1;const f=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/_;return p[0]=this.pos[0]+this.dir[0]*f,p[1]=this.pos[1]+this.dir[1]*f,p[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(o,l,p){if(Q.vec3.equals(this.pos,o)||0===l)return p[0]=p[1]=p[2]=0,!1;const[_,f,y]=this.dir,T=this.pos[0]-o[0],E=this.pos[1]-o[1],P=this.pos[2]-o[2],w=_*_+f*f+y*y,I=2*(T*_+E*f+P*y),R=I*I-4*w*(T*T+E*E+P*P-l*l);if(R<0){const D=Math.max(-I/2,0),M=T+_*D,L=E+f*D,V=P+y*D,j=Math.hypot(M,L,V);return p[0]=M*l/j,p[1]=L*l/j,p[2]=V*l/j,!1}{const D=(-I-Math.sqrt(R))/(2*w);if(D<0){const M=Math.hypot(T,E,P);return p[0]=T*l/M,p[1]=E*l/M,p[2]=P*l/M,!1}return p[0]=T+_*D,p[1]=E+f*D,p[2]=P+y*D,!0}}}class Ea{constructor(o,l,p,_,f){this.TL=o,this.TR=l,this.BR=p,this.BL=_,this.horizon=f}static fromInvProjectionMatrix(o,l,p){const _=[-1,1,1],f=[1,1,1],y=[1,-1,1],T=[-1,-1,1],E=Q.vec3.transformMat4(_,_,o),P=Q.vec3.transformMat4(f,f,o),w=Q.vec3.transformMat4(y,y,o),I=Q.vec3.transformMat4(T,T,o);return new Ea(E,P,w,I,l/p)}}function vl(u,o,l){let p=1/0,_=-1/0;const f=[];for(const y of u){Q.vec3.sub(f,y,o);const T=Q.vec3.dot(f,l);p=Math.min(p,T),_=Math.max(_,T)}return[p,_]}function Vl(u,o){let l=!0;for(let p=0;p<u.planes.length;p++){const _=u.planes[p];let f=0;for(let y=0;y<o.length;y++)f+=Q.vec3.dot(_,o[y])+_[3]>=0;if(0===f)return 0;f!==o.length&&(l=!1)}return l?2:1}function la(u,o){for(const l of u.projections){const p=vl(o,u.points[0],l.axis);if(l.projection[1]<p[0]||l.projection[0]>p[1])return 0}return 1}function jl(u,o){let l=0;const p=[0,0,0,0];for(let _=0;_<u.length;_++)p[0]=u[_][0],p[1]=u[_][1],p[2]=u[_][2],p[3]=1,Q.vec4.dot(p,o)>=0&&l++;return l}class xl{constructor(o,l){this.points=o||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=wr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Q.vec3.sub([],this.points[2],this.points[3]),Q.vec3.sub([],this.points[0],this.points[3]),Q.vec3.sub([],this.points[4],this.points[0]),Q.vec3.sub([],this.points[5],this.points[1]),Q.vec3.sub([],this.points[6],this.points[2]),Q.vec3.sub([],this.points[7],this.points[3])];for(const p of this.frustumEdges){const _=[0,-p[2],p[1]],f=[p[2],0,-p[0]];this.projections.push({axis:_,projection:vl(this.points,this.points[0],_)}),this.projections.push({axis:f,projection:vl(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(o,l,p,_){const f=Math.pow(2,p),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const w=Q.vec4.transformMat4([],P,o),I=1/w[3]/l*f;return Q.vec4.mul(w,w,[I,I,_?1/w[3]:I,I])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const w=Q.vec3.sub([],y[P[0]],y[P[1]]),I=Q.vec3.sub([],y[P[2]],y[P[1]]),R=Q.vec3.normalize([],Q.vec3.cross([],w,I)),D=-Q.vec3.dot(R,y[P[1]]);return R.concat(D)}),E=[];for(let P=0;P<y.length;P++)E.push([y[P][0],y[P][1],y[P][2]]);return new xl(E,T)}intersectsPrecise(o,l,p){for(let _=0;_<l.length;_++)if(!jl(o,l[_]))return 0;for(let _=0;_<this.planes.length;_++)if(!jl(o,this.planes[_]))return 0;for(const _ of p)for(const f of this.frustumEdges){const y=Q.vec3.cross([],_,f),T=Q.vec3.length(y);if(0===T)continue;Q.vec3.scale(y,y,1/T);const E=vl(this.points,this.points[0],y),P=vl(o,this.points[0],y);if(E[0]>P[1]||P[0]>E[1])return 0}return 1}containsPoint(o){for(const l of this.planes){const p=l[3];if(Q.vec3.dot([l[0],l[1],l[2]],o)+p<0)return!1}return!0}}class wr{static fromPoints(o){const l=[1/0,1/0,1/0],p=[-1/0,-1/0,-1/0];for(const _ of o)Q.vec3.min(l,l,_),Q.vec3.max(p,p,_);return new wr(l,p)}static fromTileIdAndHeight(o,l,p){const _=1<<o.canonical.z,f=o.canonical.x,y=o.canonical.y;return new wr([f/_,y/_,l],[(f+1)/_,(y+1)/_,p])}static applyTransform(o,l){const p=o.getCorners();for(let _=0;_<p.length;++_)Q.vec3.transformMat4(p[_],p[_],l);return wr.fromPoints(p)}static applyTransformFast(o,l){const p=[l[12],l[13],l[14]],_=[...p];for(let f=0;f<3;f++)for(let y=0;y<3;y++){const T=l[4*y+f],E=T*o.min[y],P=T*o.max[y];p[f]+=Math.min(E,P),_[f]+=Math.max(E,P)}return new wr(p,_)}static projectAabbCorners(o,l){const p=o.getCorners();for(let _=0;_<p.length;++_)Q.vec3.transformMat4(p[_],p[_],l);return p}constructor(o,l){this.min=o,this.max=l,this.center=Q.vec3.scale([],Q.vec3.add([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],p=Q.vec3.clone(this.min),_=Q.vec3.clone(this.max);for(let f=0;f<l.length;f++)p[f]=l[f]?this.min[f]:this.center[f],_[f]=l[f]?this.center[f]:this.max[f];return _[2]=this.max[2],new wr(p,_)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){return this.intersectsAabb(o.bounds)?Vl(o,this.getCorners()):0}intersectsFlat(o){return this.intersectsAabb(o.bounds)?Vl(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(o,l){return l||this.intersects(o)?la(o,this.getCorners()):0}intersectsPreciseFlat(o,l){return l||this.intersectsFlat(o)?la(o,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(o){for(let l=0;l<3;++l)if(this.min[l]>o.max[l]||o.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(o){return!(this.min[0]>o.max[0]||o.min[0]>this.max[0]||this.min[1]>o.max[1]||o.min[1]>this.max[1])}encapsulate(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o.min[l]),this.max[l]=Math.max(this.max[l],o.max[l])}encapsulatePoint(o){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],o[l]),this.max[l]=Math.max(this.max[l],o[l])}closestPoint(o){return[Math.max(Math.min(this.max[0],o[0]),this.min[0]),Math.max(Math.min(this.max[1],o[1]),this.min[1]),Math.max(Math.min(this.max[2],o[2]),this.min[2])]}}function fh(u){return u*ws/F}Tn(wr,"Aabb");const _d=[new wr([v,v,v],[S,S,S]),new wr([v,v,v],[0,0,S]),new wr([0,v,v],[S,0,S]),new wr([v,0,v],[0,S,S]),new wr([0,0,v],[S,S,S])];function mh(u,o,l,p=!0){const _=Q.vec3.scale([],u._camera.position,u.worldSize),f=[o,l,1,1];Q.vec4.transformMat4(f,f,u.pixelMatrixInverse),Q.vec4.scale(f,f,1/f[3]);const y=Q.vec3.sub([],f,_),T=Q.vec3.normalize([],y),E=u.globeMatrix,P=[E[12],E[13],E[14]],w=Q.vec3.sub([],P,_),I=Q.vec3.length(w),R=Q.vec3.normalize([],w),D=u.worldSize/(2*Math.PI),M=Q.vec3.dot(R,T),L=Math.asin(D/I);if(L<Math.acos(M)){if(!p)return null;const Z=[],de=[];Q.vec3.scale(Z,T,I/M),Q.vec3.normalize(de,Q.vec3.sub(de,Z,w)),Q.vec3.normalize(T,Q.vec3.add(T,w,Q.vec3.scale(T,de,Math.tan(L)*I)))}const V=[];new Va(_,T).closestPointOnSphere(P,D,V);const j=Q.vec3.normalize([],zd(E,0)),G=Q.vec3.normalize([],zd(E,1)),$=Q.vec3.normalize([],zd(E,2)),H=Q.vec3.dot(j,V),Y=Q.vec3.dot(G,V),J=Q.vec3.dot($,V),ce=Oe(Math.asin(-Y/D));let we=Oe(Math.atan2(H,J));we=u.center.lng+function(Z,de){const De=(de-Z+180)%360-180;return De<-180?De+360:De}(u.center.lng,we);const _e=K(we),be=Bt(re(ce),0,1);return new He(_e,be)}class kg{constructor(o,l,p){this.a=Q.vec3.sub([],o,p),this.b=Q.vec3.sub([],l,p),this.center=p;const _=Q.vec3.normalize([],this.a),f=Q.vec3.normalize([],this.b);this.angle=Math.acos(Q.vec3.dot(_,f))}}function bd(u,o){if(0===u.angle)return null;let l;return l=0===u.a[o]?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[o]/u.a[o]/Math.sin(u.angle)-1/Math.tan(u.angle)),l<0||l>1?null:function(p,_,f,y){const T=Math.sin(f);return p*(Math.sin((1-y)*f)/T)+_*(Math.sin(y*f)/T)}(u.a[o],u.b[o],u.angle,Bt(l,0,1))+u.center[o]}function fc(u){if(u.z<=1)return _d[u.z+2*u.y+u.x];const o=Pb(sm(u));return wr.fromPoints(o)}function Iu(u,o,l){return Q.vec3.scale(u,u,1-l),Q.vec3.scaleAndAdd(u,u,o,l)}function jD(u,o,l){for(const p of u)Q.vec3.transformMat4(p,p,o),Q.vec3.scale(p,p,l)}function Sp(u,o,l,p){const _=o/u.worldSize,f=u.globeMatrix;if(l.z<=1){const _e=fc(l).getCorners();return jD(_e,f,_),wr.fromPoints(_e)}const y=sm(l,p),T=Pb(y,ws+fh(u._tileCoverLift));jD(T,f,_);const E=Number.MAX_VALUE,P=[-E,-E,-E],w=[E,E,E];if(y.contains(u.center)){for(const Z of T)Q.vec3.min(w,w,Z),Q.vec3.max(P,P,Z);P[2]=0;const _e=u.point,be=[_e.x*_,_e.y*_,0];return Q.vec3.min(w,w,be),Q.vec3.max(P,P,be),new wr(w,P)}if(u._tileCoverLift>0){for(const _e of T)Q.vec3.min(w,w,_e),Q.vec3.max(P,P,_e);return new wr(w,P)}const I=[f[12]*_,f[13]*_,f[14]*_],R=y.getCenter(),D=Bt(u.center.lat,-Ee,Ee),M=Bt(R.lat,-Ee,Ee),L=K(u.center.lng),V=re(D);let j=L-K(R.lng);const G=V-re(M);j>.5?j-=1:j<-.5&&(j+=1);let $=0;if(Math.abs(j)>Math.abs(G))$=j>=0?1:3;else{$=G>=0?0:2;const _e=[f[4]*_,f[5]*_,f[6]*_],be=-Math.sin(pi(G>=0?y.getSouth():y.getNorth()))*ws;Q.vec3.scaleAndAdd(I,I,_e,be)}const H=T[$],Y=T[($+1)%4],J=new kg(H,Y,I),ce=[bd(J,0)||H[0],bd(J,1)||H[1],bd(J,2)||H[2]],we=yd(u.zoom);if(we>0){const _e=function({x:Z,y:de,z:De},Be,je,Xe,it){const at=1/(1<<De);let et=Z*at,It=et+at,Xt=de*at,vt=Xt+at,yn=0;const ln=(et+It)/2-Xe;return ln>.5?yn=-1:ln<-.5&&(yn=1),et=((et+yn)*Be-(Xe*=Be))*je+Xe,It=((It+yn)*Be-Xe)*je+Xe,Xt=(Xt*Be-(it*=Be))*je+it,vt=(vt*Be-it)*je+it,[[et,vt,0],[It,vt,0],[It,Xt,0],[et,Xt,0]]}(l,o,u._pixelsPerMercatorPixel,L,V);for(let Z=0;Z<T.length;Z++)Iu(T[Z],_e[Z],we);const be=Q.vec3.add([],_e[$],_e[($+1)%4]);Q.vec3.scale(be,be,.5),Iu(ce,be,we)}for(const _e of T)Q.vec3.min(w,w,_e),Q.vec3.max(P,P,_e);return w[2]=Math.min(H[2],Y[2]),Q.vec3.min(w,w,ce),Q.vec3.max(P,P,ce),new wr(w,P)}function sm({x:u,y:o,z:l},p=!1){const _=1/(1<<l),f=new N(ge(u*_),o===(1<<l)-1&&p?-90:xe((o+1)*_)),y=new N(ge((u+1)*_),0===o&&p?90:xe(o*_));return new U(f,y)}function Pb(u,o=ws){const l=pi(u.getNorth()),p=pi(u.getSouth()),_=Math.cos(l),f=Math.cos(p),y=Math.sin(l),T=Math.sin(p),E=u.getWest(),P=u.getEast();return[C(f,T,E,o),C(f,T,P,o),C(_,y,P,o),C(_,y,E,o)]}function Lg(u,o,l,p){const _=1<<l.z,f=(u/an+l.x)/_;return k(xe((o/an+l.y)/_),ge(f),p)}function am({min:u,max:o}){return 16383/Math.max(o[0]-u[0],o[1]-u[1],o[2]-u[2])}const tw=new Float64Array(16);function kb(u){const o=am(u),l=Q.mat4.fromScaling(tw,[o,o,o]);return Q.mat4.translate(l,l,Q.vec3.negate([],u.min))}function $v(u){const o=Q.mat4.fromTranslation(tw,u.min),l=1/am(u);return Q.mat4.scale(o,o,[l,l,l])}function Wv(u){const o=an/(2*Math.PI);return u/(2*Math.PI)/o}function nw(u,o){return an/(512*Math.pow(2,u))*am(fc(o))}function iw(u,o,l,p,_){const f=Wv(l),y=[u,o,-l/(2*Math.PI)],T=Q.mat4.identity(new Float64Array(16));return Q.mat4.translate(T,T,y),Q.mat4.scale(T,T,[f,f,f]),Q.mat4.rotateX(T,T,pi(-_)),Q.mat4.rotateY(T,T,pi(-p)),T}function yd(u){return In(5,6,u)}function Lb(u,o){const l=k(o.lat,o.lng),p=function(f){const y=k(f._center.lat,f._center.lng),T=Q.vec3.fromValues(0,1,0);let E=Q.vec3.cross([],T,y);const P=Q.mat4.fromRotation([],-f.angle,y);E=Q.vec3.transformMat4(E,E,P),Q.mat4.fromRotation(P,-f._pitch,E);const w=Q.vec3.normalize([],y);return Q.vec3.scale(w,w,fh(f.cameraToCenterDistance/f.pixelsPerMeter)),Q.vec3.transformMat4(w,w,P),Q.vec3.add([],y,w)}(u),_=Q.vec3.subtract([],p,l);return Q.vec3.angle(_,l)}function Ob(u,o){return Lb(u,o)>Math.PI/2*1.01}const Fb=pi(85),UD=Math.cos(Fb),HD=Math.sin(Fb),rw=Q.mat4.create(),Xv=u=>{const o=[];return"map"===u.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===u.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o};function gh(u,o,l,p,_,f,y,T,E){if(f&&u.queryGeometry.isAboveHorizon)return!1;f&&(E*=u.pixelToTileUnitsFactor);const P=u.tileID.canonical,w=l.projection.upVectorScale(P,l.center.lat,l.worldSize).metersToTile;for(const I of o)for(const R of I){const D=R.add(T),M=_&&l.elevation?l.elevation.exaggeration()*_.getElevationAt(D.x,D.y,!0):0,L=l.projection.projectTilePoint(D.x,D.y,P);if(M>0){const $=l.projection.upVector(P,D.x,D.y);L.x+=$[0]*w*M,L.y+=$[1]*w*M,L.z+=$[2]*w*M}const V=f?D:ow(L.x,L.y,L.z,p),j=f?u.tilespaceRays.map($=>j2($,M)):u.queryGeometry.screenGeometry,G=Q.vec4.transformMat4([],[L.x,L.y,L.z,1],p);if(!y&&f?E*=G[3]/l.cameraToCenterDistance:y&&!f&&(E*=l.cameraToCenterDistance/G[3]),f){const $=xe((R.y/an+P.y)/(1<<P.z));E/=l.projection.pixelsPerMeter($,1)/ie(1,$)}if(un(j,V,E))return!0}return!1}function ow(u,o,l,p){const _=Q.vec4.transformMat4([],[u,o,l,1],p);return new Ht(_[0]/_[3],_[1]/_[3])}const Zv=Q.vec3.fromValues(0,0,0),qD=Q.vec3.fromValues(0,0,1);function j2(u,o){const l=Q.vec3.create();return Zv[2]=o,u.intersectsPlane(Zv,qD,l),new Ht(l[0],l[1])}class Og extends Ut{}let sw,Yv,Jv,Kv;function Nb(u,{width:o,height:l},p,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==o*l*p)throw new RangeError("mismatched image size")}else _=new Uint8Array(o*l*p);return u.width=o,u.height=l,u.data=_,u}function Qv(u,o,l){const{width:p,height:_}=o;p===u.width&&_===u.height||(lm(u,o,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,p),height:Math.min(u.height,_)},l,null),u.width=p,u.height=_,u.data=o.data)}function lm(u,o,l,p,_,f,y,T){if(0===_.width||0===_.height)return o;if(_.width>u.width||_.height>u.height||l.x>u.width-_.width||l.y>u.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>o.width||_.height>o.height||p.x>o.width-_.width||p.y>o.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const E=u.data,P=o.data,w=4===f&&T;for(let I=0;I<_.height;I++){const R=((l.y+I)*u.width+l.x)*f,D=((p.y+I)*o.width+p.x)*f;if(w)for(let M=0;M<_.width;M++){const L=R+M*f+3,V=D+M*f;P[V+0]=255,P[V+1]=255,P[V+2]=255,P[V+3]=E[L]}else if(y)for(let M=0;M<_.width;M++){const L=R+M*f,V=D+M*f,j=E[L+3],G=new Gn(E[L+0]/255*j,E[L+1]/255*j,E[L+2]/255*j,j).toRenderColor(y).toArray();P[V+0]=G[0],P[V+1]=G[1],P[V+2]=G[2],P[V+3]=G[3]}else for(let M=0;M<_.width*f;M++)P[D+M]=E[R+M]}return o}Tn(Og,"HeatmapBucket",{omit:["layers"]});class Vc{constructor(o,l){Nb(this,o,1,l)}resize(o){Qv(this,new Vc(o),1)}clone(){return new Vc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,p,_,f){lm(o,l,p,_,f,1,null)}}class ca{constructor(o,l){Nb(this,o,4,l)}resize(o){Qv(this,new ca(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new ca({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,p,_,f,y,T){lm(o,l,p,_,f,4,y,T)}}class Bb{constructor(o,l){this.width=o.width,this.height=o.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}function Tp(u){const o={},l=u.resolution||256,p=u.clips?u.clips.length:1,_=u.image||new ca({width:l,height:p}),f=(y,T,E)=>{o[u.evaluationKey]=E;const P=u.expression.evaluate(o);P&&(_.data[y+T+0]=Math.floor(255*P.r/P.a),_.data[y+T+1]=Math.floor(255*P.g/P.a),_.data[y+T+2]=Math.floor(255*P.b/P.a),_.data[y+T+3]=Math.floor(255*P.a))};if(u.clips)for(let y=0,T=0;y<p;++y,T+=4*l)for(let E=0,P=0;E<l;E++,P+=4){const w=E/(l-1),{start:I,end:R}=u.clips[y];f(T,P,I*(1-w)+R*w)}else for(let y=0,T=0;y<l;y++,T+=4)f(0,T,y/(l-1));return _}Tn(Vc,"AlphaImage"),Tn(ca,"RGBAImage");const e0=er([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fg}=e0;function Ng(u,o,l=2){const p=o&&o.length,_=p?o[0]*l:u.length;let f=t0(u,0,_,l,!0);const y=[];if(!f||f.next===f.prev)return y;let T,E,P;if(p&&(f=function(w,I,R,D){const M=[];for(let L=0,V=I.length;L<V;L++){const j=t0(w,I[L]*D,L<V-1?I[L+1]*D:w.length,D,!1);j===j.next&&(j.steiner=!0),M.push(WD(j))}M.sort(Dp);for(let L=0;L<M.length;L++)R=GD(M[L],R);return R}(u,o,f,l)),u.length>80*l){T=1/0,E=1/0;let w=-1/0,I=-1/0;for(let R=l;R<_;R+=l){const D=u[R],M=u[R+1];D<T&&(T=D),M<E&&(E=M),D>w&&(w=D),M>I&&(I=M)}P=Math.max(w-T,I-E),P=0!==P?32767/P:0}return Bg(f,y,l,T,E,P,0),y}function t0(u,o,l,p,_){let f;if(_===function(y,T,E,P){let w=0;for(let I=T,R=E-P;I<E;I+=P)w+=(y[R]-y[I])*(y[I+1]+y[R+1]),R=I;return w}(u,o,l,p)>0)for(let y=o;y<l;y+=p)f=cw(y/p|0,u[y],u[y+1],f);else for(let y=l-p;y>=o;y-=p)f=cw(y/p|0,u[y],u[y+1],f);return f&&Ep(f,f.next)&&(jg(f),f=f.next),f}function Cp(u,o){if(!u)return u;o||(o=u);let l,p=u;do{if(l=!1,p.steiner||!Ep(p,p.next)&&0!==ps(p.prev,p,p.next))p=p.next;else{if(jg(p),p=o=p.prev,p===p.next)break;l=!0}}while(l||p!==o);return o}function Bg(u,o,l,p,_,f,y){if(!u)return;!y&&f&&function(E,P,w,I){let R=E;do{0===R.z&&(R.z=lw(R.x,R.y,P,w,I)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next}while(R!==E);R.prevZ.nextZ=null,R.prevZ=null,function(D){let M,L=1;do{let V,j=D;D=null;let G=null;for(M=0;j;){M++;let $=j,H=0;for(let J=0;J<L&&(H++,$=$.nextZ,$);J++);let Y=L;for(;H>0||Y>0&&$;)0!==H&&(0===Y||!$||j.z<=$.z)?(V=j,j=j.nextZ,H--):(V=$,$=$.nextZ,Y--),G?G.nextZ=V:D=V,V.prevZ=G,G=V;j=$}G.nextZ=null,L*=2}while(M>1)}(R)}(u,p,_,f);let T=u;for(;u.prev!==u.next;){const E=u.prev,P=u.next;if(f?n0(u,p,_,f):aw(u))o.push(E.i,u.i,P.i),jg(u),u=P.next,T=P.next;else if((u=P)===T){y?1===y?Bg(u=zb(Cp(u),o),o,l,p,_,f,2):2===y&&r0(u,o,l,p,_,f):Bg(Cp(u),o,l,p,_,f,1);break}}}function aw(u){const o=u.prev,l=u,p=u.next;if(ps(o,l,p)>=0)return!1;const _=o.x,f=l.x,y=p.x,T=o.y,E=l.y,P=p.y,w=_<f?_<y?_:y:f<y?f:y,I=T<E?T<P?T:P:E<P?E:P,R=_>f?_>y?_:y:f>y?f:y,D=T>E?T>P?T:P:E>P?E:P;let M=p.next;for(;M!==o;){if(M.x>=w&&M.x<=R&&M.y>=I&&M.y<=D&&_h(_,T,f,E,y,P,M.x,M.y)&&ps(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function n0(u,o,l,p){const _=u.prev,f=u,y=u.next;if(ps(_,f,y)>=0)return!1;const T=_.x,E=f.x,P=y.x,w=_.y,I=f.y,R=y.y,D=T<E?T<P?T:P:E<P?E:P,M=w<I?w<R?w:R:I<R?I:R,L=T>E?T>P?T:P:E>P?E:P,V=w>I?w>R?w:R:I>R?I:R,j=lw(D,M,o,l,p),G=lw(L,V,o,l,p);let $=u.prevZ,H=u.nextZ;for(;$&&$.z>=j&&H&&H.z<=G;){if($.x>=D&&$.x<=L&&$.y>=M&&$.y<=V&&$!==_&&$!==y&&_h(T,w,E,I,P,R,$.x,$.y)&&ps($.prev,$,$.next)>=0||($=$.prevZ,H.x>=D&&H.x<=L&&H.y>=M&&H.y<=V&&H!==_&&H!==y&&_h(T,w,E,I,P,R,H.x,H.y)&&ps(H.prev,H,H.next)>=0))return!1;H=H.nextZ}for(;$&&$.z>=j;){if($.x>=D&&$.x<=L&&$.y>=M&&$.y<=V&&$!==_&&$!==y&&_h(T,w,E,I,P,R,$.x,$.y)&&ps($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;H&&H.z<=G;){if(H.x>=D&&H.x<=L&&H.y>=M&&H.y<=V&&H!==_&&H!==y&&_h(T,w,E,I,P,R,H.x,H.y)&&ps(H.prev,H,H.next)>=0)return!1;H=H.nextZ}return!0}function zb(u,o){let l=u;do{const p=l.prev,_=l.next.next;!Ep(p,_)&&Vb(p,l,l.next,_)&&cm(p,_)&&cm(_,p)&&(o.push(p.i,l.i,_.i),jg(l),jg(l.next),l=u=_),l=l.next}while(l!==u);return Cp(l)}function r0(u,o,l,p,_,f){let y=u;do{let T=y.next.next;for(;T!==y.prev;){if(y.i!==T.i&&XD(y,T)){let E=bh(y,T);return y=Cp(y,y.next),E=Cp(E,E.next),Bg(y,o,l,p,_,f,0),void Bg(E,o,l,p,_,f,0)}T=T.next}y=y.next}while(y!==u)}function Dp(u,o){return u.x-o.x}function GD(u,o){const l=function(_,f){let y=f;const T=_.x,E=_.y;let P,w=-1/0;do{if(E<=y.y&&E>=y.next.y&&y.next.y!==y.y){const L=y.x+(E-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(L<=T&&L>w&&(w=L,P=y.x<y.next.x?y:y.next,L===T))return P}y=y.next}while(y!==f);if(!P)return null;const I=P,R=P.x,D=P.y;let M=1/0;y=P;do{if(T>=y.x&&y.x>=R&&T!==y.x&&_h(E<D?T:w,E,R,D,E<D?w:T,E,y.x,y.y)){const L=Math.abs(E-y.y)/(T-y.x);cm(y,_)&&(L<M||L===M&&(y.x>P.x||y.x===P.x&&$D(P,y)))&&(P=y,M=L)}y=y.next}while(y!==I);return P}(u,o);if(!l)return o;const p=bh(l,u);return Cp(p,p.next),Cp(l,l.next)}function $D(u,o){return ps(u.prev,u,o.prev)<0&&ps(o.next,u,u.next)<0}function lw(u,o,l,p,_){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-l)*_|0)|u<<8))|u<<4))|u<<2))|u<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-p)*_|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function WD(u){let o=u,l=u;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==u);return l}function _h(u,o,l,p,_,f,y,T){return(_-y)*(o-T)>=(u-y)*(f-T)&&(u-y)*(p-T)>=(l-y)*(o-T)&&(l-y)*(f-T)>=(_-y)*(p-T)}function XD(u,o){return u.next.i!==o.i&&u.prev.i!==o.i&&!function(l,p){let _=l;do{if(_.i!==l.i&&_.next.i!==l.i&&_.i!==p.i&&_.next.i!==p.i&&Vb(_,_.next,l,p))return!0;_=_.next}while(_!==l);return!1}(u,o)&&(cm(u,o)&&cm(o,u)&&function(l,p){let _=l,f=!1;const y=(l.x+p.x)/2,T=(l.y+p.y)/2;do{_.y>T!=_.next.y>T&&_.next.y!==_.y&&y<(_.next.x-_.x)*(T-_.y)/(_.next.y-_.y)+_.x&&(f=!f),_=_.next}while(_!==l);return f}(u,o)&&(ps(u.prev,u,o.prev)||ps(u,o.prev,o))||Ep(u,o)&&ps(u.prev,u,u.next)>0&&ps(o.prev,o,o.next)>0)}function ps(u,o,l){return(o.y-u.y)*(l.x-o.x)-(o.x-u.x)*(l.y-o.y)}function Ep(u,o){return u.x===o.x&&u.y===o.y}function Vb(u,o,l,p){const _=Vg(ps(u,o,l)),f=Vg(ps(u,o,p)),y=Vg(ps(l,p,u)),T=Vg(ps(l,p,o));return _!==f&&y!==T||!(0!==_||!zg(u,l,o))||!(0!==f||!zg(u,p,o))||!(0!==y||!zg(l,u,p))||!(0!==T||!zg(l,o,p))}function zg(u,o,l){return o.x<=Math.max(u.x,l.x)&&o.x>=Math.min(u.x,l.x)&&o.y<=Math.max(u.y,l.y)&&o.y>=Math.min(u.y,l.y)}function Vg(u){return u>0?1:u<0?-1:0}function cm(u,o){return ps(u.prev,u,u.next)<0?ps(u,o,u.next)>=0&&ps(u,u.prev,o)>=0:ps(u,o,u.prev)<0||ps(u,u.next,o)<0}function bh(u,o){const l=o0(u.i,u.x,u.y),p=o0(o.i,o.x,o.y),_=u.next,f=o.prev;return u.next=o,o.prev=u,l.next=_,_.prev=l,p.next=l,l.prev=p,f.next=p,p.prev=f,p}function cw(u,o,l,p){const _=o0(u,o,l);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function jg(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function o0(u,o,l){return{i:u,x:o,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function jb(u,o){const l=u.length;if(l<=1)return[u];const p=[];let _,f;for(let y=0;y<l;y++){const T=Bd(u[y]);0!==T&&(u[y].area=Math.abs(T),void 0===f&&(f=T<0),f===T<0?(_&&p.push(_),_=[u[y]]):_.push(u[y]))}if(_&&p.push(_),o>1)for(let y=0;y<p.length;y++)p[y].length<=o||(Pv(p[y],o,1,p[y].length-1,ZD),p[y]=p[y].slice(0,o));return p}function ZD(u,o){return o.area-u.area}function Qa(u,o,l){const p=l.patternDependencies;let _=!1;for(const f of o){const y=f.paint.get(`${u}-pattern`);y.isConstant()||(_=!0);const T=y.constantOr(null);T&&(_=!0,p[T]=!0)}return _}function mc(u,o,l,p,_){const f=_.patternDependencies;for(const y of o){const T=y.paint.get(`${u}-pattern`).value;if("constant"!==T.kind){let E=T.evaluate({zoom:p},l,{},_.availableImages);E=E&&E.name?E.name:E,f[E]=!0,l.patterns[y.id]=E}}return l}class s0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new bu,this.indexArray=new Xr,this.indexArray2=new gr,this.programConfigurations=new Ca(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new No,this.segments2=new No,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}updateFootprints(o,l){}populate(o,l,p,_){this.hasPattern=Qa("fill",this.layers,l);const f=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:T,id:E,index:P,sourceLayerIndex:w}of o){const I=this.layers[0]._featureFilter.needGeometry,R=Pt(T,I);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),R,p))continue;const D=f?f.evaluate(R,{},p,l.availableImages):void 0,M={id:E,properties:T.properties,type:T.type,sourceLayerIndex:w,index:P,geometry:I?R.geometry:Ke(T,p,_),patterns:{},sortKey:D};y.push(M)}f&&y.sort((T,E)=>T.sortKey-E.sortKey);for(const T of y){const{geometry:E,index:P,sourceLayerIndex:w}=T;if(this.hasPattern){const I=mc("fill",this.layers,T,this.zoom,l);this.patternFeatures.push(I)}else this.addFeature(T,E,P,p,{},l.availableImages,l.brightness);l.featureIndex.insert(o[P].feature,E,P,w,this.index)}}update(o,l,p,_,f){const y=0!==Object.keys(o).length;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(o,l,y?this.stateDependentLayers:this.layers,p,_,f)}addFeatures(o,l,p,_,f,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,l,p,_,y)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Fg),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,p,_,f,y=[],T){for(const E of jb(l,500)){let P=0;for(const L of E)P+=L.length;const w=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),I=w.vertexLength,R=[],D=[];for(const L of E){if(0===L.length)continue;L!==E[0]&&D.push(R.length/2);const V=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),j=V.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(j+L.length-1,j),R.push(L[0].x),R.push(L[0].y);for(let G=1;G<L.length;G++)this.layoutVertexArray.emplaceBack(L[G].x,L[G].y),this.indexArray2.emplaceBack(j+G-1,j+G),R.push(L[G].x),R.push(L[G].y);V.vertexLength+=L.length,V.primitiveLength+=L.length}const M=Ng(R,D);for(let L=0;L<M.length;L+=3)this.indexArray.emplaceBack(I+M[L],I+M[L+1],I+M[L+2]);w.vertexLength+=P,w.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,f,y,_,T)}}let uw,dw,hw,pw;Tn(s0,"FillBucket",{omit:["layers","patternFeatures"]});class a0{constructor(o,l,p,_){if(this.triangleCount=l.length/3,this.min=new Ht(0,0),this.max=new Ht(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===o.length)return;const[f,y]=[o[0].clone(),o[0].clone()];for(let I=1;I<o.length;++I){const R=o[I];f.x=Math.min(f.x,R.x),f.y=Math.min(f.y,R.y),y.x=Math.max(y.x,R.x),y.y=Math.max(y.y,R.y)}if(_){const I=Math.ceil(Math.max(y.x-f.x,y.y-f.y)/_);p=Math.max(p,I)}if(0===p)return;this.min=f,this.max=y;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const E=Math.max(T.x,T.y)/p;this.cellsX=Math.max(1,Math.ceil(T.x/E)),this.cellsY=Math.max(1,Math.ceil(T.y/E)),this.xScale=1/E,this.yScale=1/E;const P=[];for(let I=0;I<this.triangleCount;I++){const R=o[l[3*I+0]].sub(this.min),D=o[l[3*I+1]].sub(this.min),M=o[l[3*I+2]].sub(this.min),L=jc(Math.floor(Math.min(R.x,D.x,M.x)),this.xScale,this.cellsX),V=jc(Math.floor(Math.max(R.x,D.x,M.x)),this.xScale,this.cellsX),j=jc(Math.floor(Math.min(R.y,D.y,M.y)),this.yScale,this.cellsY),G=jc(Math.floor(Math.max(R.y,D.y,M.y)),this.yScale,this.cellsY),$=new Ht(0,0),H=new Ht(0,0),Y=new Ht(0,0),J=new Ht(0,0);for(let ce=j;ce<=G;++ce){$.y=H.y=ce*E,Y.y=J.y=(ce+1)*E;for(let we=L;we<=V;++we)$.x=Y.x=we*E,H.x=J.x=(we+1)*E,(ur(R,D,M,$,H,J)||ur(R,D,M,$,J,Y))&&P.push({cellIdx:ce*this.cellsX+we,triIdx:I})}}if(0===P.length)return;P.sort((I,R)=>I.cellIdx-R.cellIdx||I.triIdx-R.triIdx);let w=0;for(;w<P.length;){const I=P[w].cellIdx,R={start:this.payload.length,len:0};for(;w<P.length&&P[w].cellIdx===I;)++R.len,this.payload.push(P[w++].triIdx);this.cells[I]=R}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(o,l){if(0===this.triangleCount||0===this.cells.length||o.x>this.max.x||this.min.x>o.x||o.y>this.max.y||this.min.y>o.y)return;const p=jc(o.x-this.min.x,this.xScale,this.cellsX),_=jc(o.y-this.min.y,this.yScale,this.cellsY),f=this.cells[_*this.cellsX+p];if(f){this._lazyInitLookup();for(let y=0;y<f.len;y++){const T=this.payload[f.start+y],E=Math.floor(T/8),P=1<<T%8;if(!(this.lookup[E]&P)&&(this.lookup[E]|=P,l.push(T),l.length===this.triangleCount))return}}}query(o,l,p){if(0===this.triangleCount||0===this.cells.length||o.x>this.max.x||this.min.x>l.x||o.y>this.max.y||this.min.y>l.y)return;this._lazyInitLookup();const _=jc(o.x-this.min.x,this.xScale,this.cellsX),f=jc(l.x-this.min.x,this.xScale,this.cellsX),y=jc(o.y-this.min.y,this.yScale,this.cellsY),T=jc(l.y-this.min.y,this.yScale,this.cellsY);for(let E=y;E<=T;E++)for(let P=_;P<=f;P++){const w=this.cells[E*this.cellsX+P];if(w)for(let I=0;I<w.len;I++){const R=this.payload[w.start+I],D=Math.floor(R/8),M=1<<R%8;if(!(this.lookup[D]&M)&&(this.lookup[D]|=M,p.push(R),p.length===this.triangleCount))return}}}}function jc(u,o,l){return Math.max(0,Math.min(l-1,Math.floor(u*o)))}Tn(a0,"TriangleGridIndex");class fw{constructor(o){this.zoom=o.zoom,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.footprints=[]}updateFootprints(o,l){for(const p of this.footprints)l.push({footprint:p,id:o})}populate(o,l,p,_){const f=[];for(const{feature:y,id:T,index:E,sourceLayerIndex:P}of o){const w=this.layers[0]._featureFilter.needGeometry,I=Pt(y,w);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),I,p))continue;const R={id:T,properties:y.properties,type:y.type,sourceLayerIndex:P,index:E,geometry:w?I.geometry:Ke(y,p,_),patterns:{}};f.push(R)}for(const y of f){const{geometry:T,index:E,sourceLayerIndex:P}=y;this.addFeature(y,T,E,p,{},l.availableImages,l.brightness),l.featureIndex.insert(o[E].feature,T,E,P,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(o){}update(o,l,p,_,f){}destroy(){}addFeature(o,l,p,_,f,y=[],T){for(const E of jb(l,2)){const P=[],w=[],I=[],R=new Ht(1/0,1/0),D=new Ht(-1/0,-1/0);for(const V of E)if(0!==V.length){V!==E[0]&&I.push(w.length/2);for(let j=0;j<V.length;j++)w.push(V[j].x),w.push(V[j].y),P.push(V[j]),R.x=Math.min(R.x,V[j].x),R.y=Math.min(R.y,V[j].y),D.x=Math.max(D.x,V[j].x),D.y=Math.max(D.y,V[j].y)}const M=Ng(w,I),L=new a0(P,M,8,256);this.footprints.push({vertices:P,indices:M,grid:L,min:R,max:D})}}}Tn(fw,"ClipBucket",{omit:["layers"]});const YD=er([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),JD=er([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),KD=er([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ub=er([{name:"a_join_normal_inside",components:3,type:"Int16"}]),vd=er([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Ug=er([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:mw}=YD;var Hb,l0,gw,QD,_w,qb,Gb,c0={};function eE(){if(l0)return Hb;l0=1;var u=st();function o(_,f,y,T,E){this.properties={},this.extent=y,this.type=0,this._pbf=_,this._geometry=-1,this._keys=T,this._values=E,_.readFields(l,this,f)}function l(_,f,y){1==_?f.id=y.readVarint():2==_?function(T,E){for(var P=T.readVarint()+T.pos;T.pos<P;){var w=E._keys[T.readVarint()],I=E._values[T.readVarint()];E.properties[w]=I}}(y,f):3==_?f.type=y.readVarint():4==_&&(f._geometry=y.pos)}function p(_){for(var f,y,T=0,E=0,P=_.length,w=P-1;E<P;w=E++)T+=((y=_[w]).x-(f=_[E]).x)*(f.y+y.y);return T}return Hb=o,o.types=["Unknown","Point","LineString","Polygon"],o.prototype.loadGeometry=function(){var _=this._pbf;_.pos=this._geometry;for(var f,y=_.readVarint()+_.pos,T=1,E=0,P=0,w=0,I=[];_.pos<y;){if(E<=0){var R=_.readVarint();T=7&R,E=R>>3}if(E--,1===T||2===T)P+=_.readSVarint(),w+=_.readSVarint(),1===T&&(f&&I.push(f),f=[]),f.push(new u(P,w));else{if(7!==T)throw new Error("unknown command "+T);f&&f.push(f[0].clone())}}return f&&I.push(f),I},o.prototype.bbox=function(){var _=this._pbf;_.pos=this._geometry;for(var f=_.readVarint()+_.pos,y=1,T=0,E=0,P=0,w=1/0,I=-1/0,R=1/0,D=-1/0;_.pos<f;){if(T<=0){var M=_.readVarint();y=7&M,T=M>>3}if(T--,1===y||2===y)(E+=_.readSVarint())<w&&(w=E),E>I&&(I=E),(P+=_.readSVarint())<R&&(R=P),P>D&&(D=P);else if(7!==y)throw new Error("unknown command "+y)}return[w,R,I,D]},o.prototype.toGeoJSON=function(_,f,y){var T,E,P=this.extent*Math.pow(2,y),w=this.extent*_,I=this.extent*f,R=this.loadGeometry(),D=o.types[this.type];function M(j){for(var G=0;G<j.length;G++){var $=j[G];j[G]=[360*($.x+w)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+I)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(T=0;T<R.length;T++)L[T]=R[T][0];M(R=L);break;case 2:for(T=0;T<R.length;T++)M(R[T]);break;case 3:for(R=function(j){var G=j.length;if(G<=1)return[j];for(var $,H,Y=[],J=0;J<G;J++){var ce=p(j[J]);0!==ce&&(void 0===H&&(H=ce<0),H===ce<0?($&&Y.push($),$=[j[J]]):$.push(j[J]))}return $&&Y.push($),Y}(R),T=0;T<R.length;T++)for(E=0;E<R[T].length;E++)M(R[T][E])}1===R.length?R=R[0]:D="Multi"+D;var V={type:"Feature",geometry:{type:D,coordinates:R},properties:this.properties};return"id"in this&&(V.id=this.id),V},Hb}function u0(){if(QD)return gw;QD=1;var u=eE();function o(p,_){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=p,this._keys=[],this._values=[],this._features=[],p.readFields(l,this,_),this.length=this._features.length}function l(p,_,f){15===p?_.version=f.readVarint():1===p?_.name=f.readString():5===p?_.extent=f.readVarint():2===p?_._features.push(f.pos):3===p?_._keys.push(f.readString()):4===p&&_._values.push(function(y){for(var T=null,E=y.readVarint()+y.pos;y.pos<E;){var P=y.readVarint()>>3;T=1===P?y.readString():2===P?y.readFloat():3===P?y.readDouble():4===P?y.readVarint64():5===P?y.readVarint():6===P?y.readSVarint():7===P?y.readBoolean():null}return T}(f))}return gw=o,o.prototype.feature=function(p){if(p<0||p>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[p];var _=this._pbf.readVarint()+this._pbf.pos;return new u(this._pbf,_,this.extent,this._keys,this._values)},gw}function bw(){return Gb||(Gb=1,c0.VectorTile=function(){if(qb)return _w;qb=1;var u=u0();function o(l,p,_){if(3===l){var f=new u(_,_.readVarint()+_.pos);f.length&&(p[f.name]=f)}}return _w=function(l,p){this.layers=l.readFields(o,{},p)}}(),c0.VectorTileFeature=eE(),c0.VectorTileLayer=u0()),c0}var um=bw();class Ip extends Ht{constructor(o,l,p){super(o,l),this.z=p}}class yw extends Ip{constructor(o,l,p,_){super(o,l,p),this.w=_}}function Hg(u,o,l,p){const _=[],f=0===p?(y,T,E,P,w,I)=>{y.push(new Ht(I,E+(I-T)/(P-T)*(w-E)))}:(y,T,E,P,w,I)=>{y.push(new Ht(T+(I-E)/(w-E)*(P-T),I))};for(const y of u){const T=[];for(const E of y){if(E.length<=2)continue;const P=[];for(let R=0;R<E.length-1;R++){const D=E[R].x,M=E[R].y,L=E[R+1].x,V=E[R+1].y,j=0===p?D:M,G=0===p?L:V;j<o?G>o&&f(P,D,M,L,V,o):j>l?G<l&&f(P,D,M,L,V,l):P.push(E[R]),G<o&&j>=o&&f(P,D,M,L,V,o),G>l&&j<=l&&f(P,D,M,L,V,l)}let w=E[E.length-1];const I=0===p?w.x:w.y;I>=o&&I<=l&&P.push(w),P.length&&(w=P[P.length-1],P[0].x===w.x&&P[0].y===w.y||P.push(P[0]),T.push(P))}T.length&&_.push(T)}return _}function qg(u,o,l,p){const _="x"===l?"y":"x",f=(p-u[l])/(o[l]-u[l]);u[_]=u[_]+(o[_]-u[_])*f,u[l]=p,u.hasOwnProperty("z")&&(u.z=ni(u.z,o.z,f)),u.hasOwnProperty("w")&&(u.w=ni(u.w,o.w,f))}function d0(u,o,l,p){const _=l,f=p;for(const y of["x","y"]){let T=u,E=o;T[y]>=E[y]&&(T=o,E=u),T[y]<_&&E[y]>_&&qg(T,E,y,_),T[y]<f&&E[y]>f&&qg(E,T,y,f)}}const dm=Number.MAX_SAFE_INTEGER;function vw(u,o,l,p){return u.order<o||u.order===dm||!(u.clipMask&l)||(_=p,0!==(f=u.clipScope).length&&void 0===f.find(y=>y===_));var _,f}function fo(u,o){return u.x-o.x||u.y-o.y}function $b(u,o){return 0===fo(u.min,o.min)&&0===fo(u.max,o.max)}function h0(u,o){return!(u.min.x>o.max.x||u.max.x<o.min.x||u.min.y>o.max.y||u.max.y<o.min.y)}function zo(u,o){if(u.length!==o.length)return!1;for(let l=0;l<u.length;l++)if(u[l].sourceId!==o[l].sourceId||!$b(u[l],o[l])||u[l].order!==o[l].order||u[l].clipMask!==o[l].clipMask||!ao(u[l].clipScope,o[l].clipScope))return!1;return!0}function p0(u,o,l){const p=1/an,_=1/(1<<l.canonical.z),f=(o.x*p+l.canonical.x)*_+l.wrap,y=(o.y*p+l.canonical.y)*_;return{min:new Ht((u.x*p+l.canonical.x)*_+l.wrap,(u.y*p+l.canonical.y)*_),max:new Ht(f,y)}}function tE(u,o,l){const p=1<<l.canonical.z,_=((o.x-l.wrap)*p-l.canonical.x)*an,f=(o.y*p-l.canonical.y)*an;return{min:new Ht(((u.x-l.wrap)*p-l.canonical.x)*an,(u.y*p-l.canonical.y)*an),max:new Ht(_,f)}}function xw(u,o,l,p,_,f,y){const T=u.indices,E=u.vertices,P=[];for(let w=p;w<p+_;w+=3){const I=o[l[w+0]+f],R=o[l[w+1]+f],D=o[l[w+2]+f],M=Math.min(I.x,R.x,D.x),L=Math.max(I.x,R.x,D.x),V=Math.min(I.y,R.y,D.y),j=Math.max(I.y,R.y,D.y);P.length=0,u.grid.query(new Ht(M,V),new Ht(L,j),P);for(let G=0;G<P.length;G++){const $=P[G];if(ur(E[T[3*$+0]],E[T[3*$+1]],E[T[3*$+2]],I,R,D,y))return!0}}return!1}function ww(u,o,l,p){if(!u||!l)return!1;let _=u.vertices;if(!o.canonical.equals(p.canonical)||o.wrap!==p.wrap){if(l.vertices.length<u.vertices.length)return ww(l,p,u,o);const f=o.canonical,y=p.canonical,T=Math.pow(2,y.z-f.z);_=u.vertices.map(E=>new Ht((E.x+f.x*an)*T-y.x*an,(E.y+f.y*an)*T-y.y*an))}return xw(l,_,u.indices,0,u.indices.length,0,0)}function Sw(u,o,l,p){const _=Math.pow(2,p.z-l.z);return new Ht((u+l.x*an)*_-p.x*an,(o+l.y*an)*_-p.y*an)}function Tw(u,o){const l=[];o.grid.queryPoint(u,l);const p=o.indices,_=o.vertices;for(let f=0;f<l.length;f++){const y=l[f];if(Xi([_[p[3*y+0]],_[p[3*y+1]],_[p[3*y+2]]],u))return!0}return!1}const Cw=[new Ht(0,0),new Ht(an,0),new Ht(an,an),new Ht(0,an)];function nE(u,o){const l=[];let p=[];if(!o||u.length<2)return[u];if(2===u.length)return rr(u[0],u[1],Cw)?[u]:[];for(let _=0;_<u.length+2;_++){const f=u[_%u.length],y=u[(_+1)%u.length],T=rr(0===_?u[u.length-1]:u[(_-1)%u.length],f,Cw),E=rr(f,y,Cw),P=T||E;P&&p.push(f),P&&E||p.length>0&&(p.length>1&&l.push(p),p=[])}return p.length>1&&l.push(p),l}const Mp=um.VectorTileFeature.types,f0=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Dw=["fill-extrusion-flood-light-ground-radius"],Ew=Math.pow(2,13),Iw=Math.pow(2,15)-1,Mw=new Ht(0,1),xd=2147483648;function hm(u,o,l,p,_,f,y,T){u.emplaceBack((o<<1)+y,(l<<1)+f,(Math.floor(p*Ew)<<1)+_,Math.round(T))}function Ap(u,o,l){u.emplaceBack(o.x*an,o.y*an,l?1:0)}function m0(u,o,l,p,_,f){u.emplaceBack(o.x,o.y,(l.x<<1)+p,(l.y<<1)+_,f)}function Gg(u,o,l){u.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class Wb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class g0{constructor(){this.centroidXY=new Ht(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ht(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ht(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ht(this.max.x-this.min.x,this.max.y-this.min.y)}}class _0{constructor(){this.acc=new Ht(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(o,l){o.min.x===Number.MAX_VALUE&&(o.min.x=o.max.x=l.x,o.min.y=o.max.y=l.y)}appendEdge(o,l,p){this.accCount++,this.acc._add(l);let _=!!this.borders;l.x<o.min.x?(o.min.x=l.x,_=!0):l.x>o.max.x&&(o.max.x=l.x,_=!0),l.y<o.min.y?(o.min.y=l.y,_=!0):l.y>o.max.y&&(o.max.y=l.y,_=!0),((0===l.x||l.x===an)&&l.x===p.x)!=((0===l.y||l.y===an)&&l.y===p.y)&&this.processBorderOverlap(l,p),_&&this.checkBorderIntersection(l,p)}checkBorderIntersection(o,l){l.x<0!=o.x<0&&this.addBorderIntersection(0,ni(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>an!=o.x>an&&this.addBorderIntersection(1,ni(l.y,o.y,(an-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,ni(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>an!=o.y>an&&this.addBorderIntersection(3,ni(l.x,o.x,(an-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const p=this.borders[o];l<p[0]&&(p[0]=l),l>p[1]&&(p[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const p=0===o.x?0:1;this.addBorderIntersection(p,l.y),this.addBorderIntersection(p,o.y)}else{const p=0===o.y?2:3;this.addBorderIntersection(p,l.x),this.addBorderIntersection(p,o.x)}}centroid(){return 0===this.accCount?new Ht(0,0):new Ht(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0):0}}function yh(u,o){const l=u.add(o)._unit(),p=Bt(u.x*l.x+u.y*l.y,-1,1);var _,f,y;return y=Math.acos(p),Math.min(4,Math.max(-4,Math.tan(y)))/4*Iw*((_=u).x*(f=o).y-_.y*f.x<0?-1:1)}const iE=[u=>u.x<0,u=>u.x>an,u=>u.y<0,u=>u.y>an];function b0(u,o,l,p){const _=[4];if(0===p)return _;l._mult(p);const f=u.sub(l),y=o.sub(l),T=[u,o,f,y];for(let E=0;E<4;E++)for(const P of T)if(iE[E](P)){_.push(E);break}return _}class $g{constructor(o){this.vertexArray=new Jf,this.indexArray=new Xr,this.programConfigurations=new Ca(o.layers,{zoom:o.zoom,lut:o.lut},l=>Dw.includes(l)),this._segments=new No,this.hiddenByLandmarkVertexArray=new Ig,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new No}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(o,l,p,_=!1){const f=o.length;if(f>2){let y=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let E;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const P=o[0],w=o[1];E=yh(P.sub(o[f-1])._perp()._unit(),w.sub(P)._perp()._unit())}for(let P=0;P<f;P++){const w=P===f-1?0:P+1,I=o[P],R=o[w],D=o[w===f-1?0:w+1],M=R.sub(I)._perp()._unit(),L=yh(M,D.sub(R)._perp()._unit()),V=E,j=L;if(Jb(I,R,l)||_&&Kb(I,l)&&Kb(R,l)){E=L;continue}const G=T.vertexLength;m0(this.vertexArray,I,R,1,1,V),m0(this.vertexArray,I,R,1,0,V),m0(this.vertexArray,I,R,0,1,j),m0(this.vertexArray,I,R,0,0,j),T.vertexLength+=4;const $=b0(I,R,M,p);for(const H of $)this._segmentToGroundQuads[y].push({id:G,region:H}),this._segmentToRegionTriCounts[y][H]+=2,T.primitiveLength+=2;E=L}}}prepareBorderSegments(){if(!this.hasData())return;const o=this._segments.get(),l=o.length;for(let p=0;p<l;p++)this._segmentToGroundQuads[p].sort((_,f)=>_.region-f.region);for(let p=0;p<l;p++){const _=this._segmentToGroundQuads[p],f=o[p],y=this._segmentToRegionTriCounts[p];y.reduce((E,P)=>E+P,0);let T=0;for(let E=0;E<=4;E++){const P=y[E];if(0!==P){let w=this.regionSegments[E];w||(w=this.regionSegments[E]=new No);const I={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+T,vertexLength:f.vertexLength,primitiveLength:P};w.get().push(I)}T+=P}for(let E=0;E<_.length;E++){const P=_[E].id;this.indexArray.emplaceBack(P,P+1,P+3),this.indexArray.emplaceBack(P,P+3,P+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(o,l,p,_,f,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,o,l,p,_,f,y)}upload(o){this.hasData()&&(this.vertexBuffer=o.createVertexBuffer(this.vertexArray,JD.members),this.indexBuffer=o.createIndexBuffer(this.indexArray))}uploadPaintProperties(o){this.hasData()&&this.programConfigurations.upload(o)}update(o,l,p,_,f,y){this.hasData()&&this.programConfigurations.updatePaintArrays(o,l,p,_,f,y)}updateHiddenByLandmark(o){if(!this.hasData())return;const l=o.groundVertexCount+o.groundVertexArrayOffset;if(0===o.groundVertexCount)return;const p=o.flags&xd?1:0;for(let _=o.groundVertexArrayOffset;_<l;++_)this.hiddenByLandmarkVertexArray.emplace(_,p);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(o){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=o.createVertexBuffer(this.hiddenByLandmarkVertexArray,vd.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let o=0;o<=4;o++){const l=this.regionSegments[o];l&&l.destroy()}}}}class Xb{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Xr,this.footprintVertices=new bu,this.footprintSegments=[],this.layoutVertexArray=new hd,this.centroidVertexArray=new dc,this.wallVertexArray=new dh,this.indexArray=new Xr,this.programConfigurations=new Ca(o.layers,{zoom:o.zoom,lut:o.lut},l=>f0.includes(l)),this.segments=new No,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new $g(o),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(o,l){}populate(o,l,p,_){this.features=[],this.hasPattern=Qa("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Fe(p),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:f,id:y,index:T,sourceLayerIndex:E}of o){const P=this.layers[0]._featureFilter.needGeometry,w=Pt(f,P);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),w,p))continue;const I={id:y,sourceLayerIndex:E,index:T,geometry:P?w.geometry:Ke(f,p,_),properties:f.properties,type:f.type,patterns:{}},R=this.layoutVertexArray.length,D="Polygon"===Mp[I.type];if(this.hasPattern)this.features.push(mc("fill-extrusion",this.layers,I,this.zoom,l));else if(this.wallMode)for(const M of I.geometry)for(const L of nE(M,D))this.addFeature(I,[L],T,p,{},l.availableImages,_,l.brightness);else this.addFeature(I,I.geometry,T,p,{},l.availableImages,_,l.brightness);l.featureIndex.insert(f,I.geometry,T,E,this.index,R)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(o,l,p,_,f,y){for(const T of this.features){const E="Polygon"===Mp[T.type],{geometry:P}=T;if(this.wallMode)for(const w of P)for(const I of nE(w,E))this.addFeature(T,[I],T.index,l,p,_,f,y);else this.addFeature(T,P,T.index,l,p,_,f,y)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(o,l,p,_,f){const y=0!==Object.keys(o).length;if(y&&!this.stateDependentLayers.length)return;const T=y?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(o,l,T,p,_,f),this.groundEffect.update(o,l,T,p,_,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,mw),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.wallVertexBuffer=o.createVertexBuffer(this.wallVertexArray,Ub.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,Ug.members,!0)),this.groundEffect.upload(o)),this.groundEffect.uploadPaintProperties(o),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){this.groundEffect.uploadHiddenByLandmark(o),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,KD.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,p,_,f,y,T,E){const P=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,w=[new Ht(0,0),new Ht(an,an)],I=T.projection,R="globe"===I.name,D=this.wallMode||"Polygon"===Mp[o.type],M=new _0;M.centroidDataIndex=this.centroidData.length;const L=new g0,V=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},_)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},_);let G;if(L.height=j,L.vertexArrayOffset=this.layoutVertexArray.length,L.groundVertexArrayOffset=this.groundEffect.vertexArray.length,R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ch),this.wallMode){if(R)return void Ki("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==l.length)return;G=function(be){const Z=be[0].x===be[be.length-1].x&&be[0].y===be[be.length-1].y;(function(Kt){let Gt=0;const Hn=Kt.length;for(let gn=0;gn<Hn;gn++)Gt+=(Kt[(gn+1)%Hn].x-Kt[gn].x)*(Kt[(gn+1)%Hn].y+Kt[gn].y);return Gt>=0})(be)||(be=be.reverse());const De={geometry:[],joinNormals:[],indices:[]},Be=[],je=[],Xe=[];let it=be.length;if(it<(Z?3:2))return De;for(;it>=2&&be[it-1].equals(be[it-2]);)it--;let at,et,It,Xt,vt,yn=0;for(;yn<it-1&&be[yn].equals(be[yn+1]);)yn++;Z&&(at=be[it-2],vt=be[yn].sub(at)._unit()._perp());for(let Kt=yn;Kt<it;Kt++){if(It=Kt===it-1?Z?be[yn+1]:void 0:be[Kt+1],It&&be[Kt].equals(It))continue;vt&&(Xt=vt),at&&(et=at),at=be[Kt],vt=It?It.sub(at)._unit()._perp():Xt,Xt=Xt||vt;let Gt=Xt.add(vt);0===Gt.x&&0===Gt.y||Gt._unit();const Hn=Gt.x*vt.x+Gt.y*vt.y,gn=0!==Hn?1/Hn:1/0,Dn=Xt.x*vt.y-Xt.y*vt.x>0;let hi="miter";const Ti=2;"miter"===hi&&gn>Ti&&(hi="bevel"),"bevel"===hi&&(gn>100&&(hi="flipbevel"),gn<Ti&&(hi="miter"));const Ii=(_i,Vi,Li,Jr)=>{const Fr=new Ht(_i.x,_i.y),ri=new Ht(_i.x,_i.y);Fr.x+=Vi.x*Jr,Fr.y+=Vi.y*Jr,ri.x-=Vi.x*Math.max(Li,1),ri.y-=Vi.y*Math.max(Li,1),Xe.push(Vi),Be.push(Fr),je.push(ri)};if("miter"===hi)Gt._mult(gn),Ii(at,Gt,0,0);else if("flipbevel"===hi)Gt=vt.mult(-1),Ii(at,Gt,0,0),Ii(at,Gt.mult(-1),0,0);else{const _i=-Math.sqrt(gn*gn-1),Vi=Dn?_i:0,Li=Dn?0:_i;et&&Ii(at,Xt,Vi,Li),It&&Ii(at,vt,Vi,Li)}}De.geometry=[...Be,...je.reverse(),Be[0]],De.joinNormals=[...Xe,...Xe.reverse(),Xe[Xe.length-1]];const ln=De.geometry.length-1;for(let Kt=0;Kt<ln/2;Kt++)if(Kt+1<ln/2){let Gt=Kt,Hn=Kt+1,gn=ln-1-Kt,Dn=ln-2-Kt;Gt=0===Gt?ln-1:Gt-1,Hn=0===Hn?ln-1:Hn-1,gn=0===gn?ln-1:gn-1,Dn=0===Dn?ln-1:Dn-1,De.indices.push(gn),De.indices.push(Hn),De.indices.push(Gt),De.indices.push(gn),De.indices.push(Dn),De.indices.push(Hn)}return De}(l[0]),l=[G.geometry]}const $=(be,Z)=>be<(Z.length-1)/2||be===Z.length-1,H=this.wallMode?[l]:jb(l,500);for(let be=H.length-1;be>=0;be--){const Z=H[be];(0===Z.length||(Y=Z[0]).every(de=>de.x<=0)||Y.every(de=>de.x>=an)||Y.every(de=>de.y<=0)||Y.every(de=>de.y>=an))&&H.splice(be,1)}var Y;let J;if(R)J=Rp(H,w,_);else{J=[];for(const be of H)J.push({polygon:be,bounds:w})}const ce=D?this.edgeRadius:0,we=ce>0&&this.zoom<17,_e=(be,Z)=>{if(0===be.length)return!1;const de=be[be.length-1];return Z.x===de.x&&Z.y===de.y};for(const{polygon:be,bounds:Z}of J){let de=0,De=0;for(const it of be)D&&!it[0].equals(it[it.length-1])&&it.push(it[0]),De+=D?it.length-1:it.length;const Be=this.segments.prepareSegment((D?5:4)*De,this.layoutVertexArray,this.indexArray);L.footprintSegIdx<0&&(L.footprintSegIdx=this.footprintSegments.length),L.polygonSegIdx<0&&(L.polygonSegIdx=this.polygonSegments.length);const je={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Xe=new Wb;if(Xe.vertexOffset=this.footprintVertices.length,Xe.indexOffset=3*this.footprintIndices.length,Xe.ringIndices=[],D){const it=[],at=[];de=Be.vertexLength;for(let It=0;It<be.length;It++){const Xt=be[It];Xt.length&&0!==It&&at.push(it.length/2);const vt=[];let yn,ln;yn=Xt[1].sub(Xt[0])._perp()._unit(),Xe.ringIndices.push(Xt.length-1);for(let Kt=1;Kt<Xt.length;Kt++){const Gt=Xt[Kt],Hn=Xt[Kt===Xt.length-1?1:Kt+1],gn=Gt.clone();if(ce){ln=Hn.sub(Gt)._perp()._unit();const Dn=yn.add(ln)._unit(),hi=ce*Math.min(4,1/(yn.x*Dn.x+yn.y*Dn.y));gn.x+=hi*Dn.x,gn.y+=hi*Dn.y,gn.x=Math.round(gn.x),gn.y=Math.round(gn.y),yn=ln}if(!V||0!==ce&&!we||_e(vt,gn)||vt.push(gn),hm(this.layoutVertexArray,gn.x,gn.y,0,0,1,1,0),this.wallMode){const Dn=$(Kt,Xt);Ap(this.wallVertexArray,G.joinNormals[Kt],!Dn)}Be.vertexLength++,this.footprintVertices.emplaceBack(Gt.x,Gt.y),it.push(Gt.x,Gt.y),R&&Gg(this.layoutVertexExtArray,I.projectTilePoint(gn.x,gn.y,_),I.upVector(_,gn.x,gn.y))}V&&(0===ce||we)&&(0!==vt.length&&_e(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,Z,P))}const et=this.wallMode?G.indices:Ng(it,at);for(let It=0;It<et.length;It+=3)this.footprintIndices.emplaceBack(Xe.vertexOffset+et[It+0],Xe.vertexOffset+et[It+1],Xe.vertexOffset+et[It+2]),this.indexArray.emplaceBack(de+et[It],de+et[It+2],de+et[It+1]),Be.primitiveLength++;Xe.indexCount+=et.length,Xe.vertexCount+=this.footprintVertices.length-Xe.vertexOffset}for(let it=0;it<be.length;it++){const at=be[it];M.startRing(L,at[0]);let et=at.length>4&&Aw(at[at.length-2],at[0],at[1]),It=ce?Yb(at[at.length-2],at[0],at[1],ce):0;const Xt=[];let vt,yn,ln;yn=at[1].sub(at[0])._perp()._unit();let Kt=!0;for(let Gt=1,Hn=0;Gt<at.length;Gt++){let gn=at[Gt-1],Dn=at[Gt];const hi=at[Gt===at.length-1?1:Gt+1];if(M.appendEdge(L,Dn,gn),Jb(Dn,gn,Z)){ce&&(yn=hi.sub(Dn)._perp()._unit(),Kt=!Kt);continue}const Ti=Dn.sub(gn)._perp(),Ii=Ti.x/(Math.abs(Ti.x)+Math.abs(Ti.y)),_i=Ti.y>0?1:0,Vi=gn.dist(Dn);if(Hn+Vi>32768&&(Hn=0),ce){ln=hi.sub(Dn)._perp()._unit();let ri=wd(gn,Dn,hi,Zb(yn,ln),ce);isNaN(ri)&&(ri=0);const Sr=Dn.sub(gn)._unit();gn=gn.add(Sr.mult(It))._round(),Dn=Dn.add(Sr.mult(-ri))._round(),It=ri,yn=ln,V&&this.zoom>=17&&(_e(Xt,gn)||Xt.push(gn),_e(Xt,Dn)||Xt.push(Dn))}const Li=Be.vertexLength,Jr=at.length>4&&Aw(gn,Dn,hi);let Fr=Rw(Hn,et,Kt);if(hm(this.layoutVertexArray,gn.x,gn.y,Ii,_i,0,0,Fr),hm(this.layoutVertexArray,gn.x,gn.y,Ii,_i,0,1,Fr),this.wallMode){const ri=$(Gt-1,at),Sr=G.joinNormals[Gt-1];Ap(this.wallVertexArray,Sr,ri),Ap(this.wallVertexArray,Sr,ri)}if(Hn+=Vi,Fr=Rw(Hn,Jr,!Kt),et=Jr,hm(this.layoutVertexArray,Dn.x,Dn.y,Ii,_i,0,0,Fr),hm(this.layoutVertexArray,Dn.x,Dn.y,Ii,_i,0,1,Fr),this.wallMode){const ri=$(Gt,at),Sr=G.joinNormals[Gt];Ap(this.wallVertexArray,Sr,ri),Ap(this.wallVertexArray,Sr,ri)}if(Be.vertexLength+=4,this.indexArray.emplaceBack(Li+0,Li+1,Li+2),this.indexArray.emplaceBack(Li+1,Li+3,Li+2),Be.primitiveLength+=2,ce){const ri=de+(1===Gt?at.length-2:Gt-2),Sr=1===Gt?de:ri+1;if(this.indexArray.emplaceBack(Li+1,ri,Li+3),this.indexArray.emplaceBack(ri,Sr,Li+3),Be.primitiveLength+=2,void 0===vt&&(vt=Li),!Jb(hi,at[Gt],Z)){const Tr=Gt===at.length-1?vt:Be.vertexLength;this.indexArray.emplaceBack(Li+2,Li+3,Tr),this.indexArray.emplaceBack(Li+3,Tr+1,Tr),this.indexArray.emplaceBack(Li+3,Sr,Tr+1),Be.primitiveLength+=3}Kt=!Kt}if(R){const ri=this.layoutVertexExtArray,Sr=I.projectTilePoint(gn.x,gn.y,_),Tr=I.projectTilePoint(Dn.x,Dn.y,_),ro=I.upVector(_,gn.x,gn.y),Vo=I.upVector(_,Dn.x,Dn.y);Gg(ri,Sr,ro),Gg(ri,Sr,ro),Gg(ri,Tr,Vo),Gg(ri,Tr,Vo)}}D&&(de+=at.length-1),V&&ce&&this.zoom>=17&&(0!==Xt.length&&_e(Xt,Xt[0])&&Xt.pop(),this.groundEffect.addData(Xt,Z,P,ce>0))}this.footprintSegments.push(Xe),je.triangleCount=this.indexArray.length-je.triangleArrayOffset,this.polygonSegments.push(je),++L.footprintSegLen,++L.polygonSegLen}if(L.vertexCount=this.layoutVertexArray.length-L.vertexArrayOffset,L.groundVertexCount=this.groundEffect.vertexArray.length-L.groundVertexArrayOffset,0!==L.vertexCount){if(L.centroidXY=M.borders?Mw:this.encodeCentroid(M,L),this.centroidData.push(L),M.borders){this.featuresOnBorder.push(M);const be=this.featuresOnBorder.length-1;for(let Z=0;Z<M.borders.length;Z++)M.borders[Z][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Z].push(be)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,f,y,_,E),this.groundEffect.addPaintPropertiesData(o,p,f,y,_,E),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let o=0;o<this.borderFeatureIndices.length;o++)this.borderFeatureIndices[o].sort((l,p)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[p].borders[o][0])}splitToSubtiles(){const o=[];for(let T=0;T<this.centroidData.length;T++){const E=this.centroidData[T],P=+(E.min.y+E.max.y>an),w=2*P+(+(E.min.x+E.max.x>an)^P);for(let I=0;I<E.polygonSegLen;I++){const R=E.polygonSegIdx+I;o.push({centroidIdx:T,subtile:w,polygonSegmentIdx:R,triangleSegmentIdx:this.polygonSegments[R].triangleSegIdx})}}const l=new Xr;o.sort((T,E)=>T.triangleSegmentIdx===E.triangleSegmentIdx?T.subtile-E.subtile:T.triangleSegmentIdx-E.triangleSegmentIdx);let p=0,_=0,f=0;for(const T of o){if(T.triangleSegmentIdx!==p)break;f++}const y=o.length;for(;_!==o.length;){p=o[_].triangleSegmentIdx;let T=0,E=_,P=_;for(let w=E;w<f&&o[w].subtile===T;w++)P++;for(;E!==f;){const w=o[E];T=w.subtile;const I=this.centroidData[w.centroidIdx].min.clone(),R=this.centroidData[w.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[p].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[p].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let M=E;M<P;M++){const L=o[M],V=this.polygonSegments[L.polygonSegmentIdx],j=this.centroidData[L.centroidIdx].min,G=this.centroidData[L.centroidIdx].max,$=this.indexArray.uint16;for(let H=V.triangleArrayOffset;H<V.triangleArrayOffset+V.triangleCount;H++)l.emplaceBack($[3*H],$[3*H+1],$[3*H+2]);D.primitiveLength+=V.triangleCount,I.x=Math.min(I.x,j.x),I.y=Math.min(I.y,j.y),R.x=Math.max(R.x,G.x),R.y=Math.max(R.y,G.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:I,max:R}),E=P;for(let M=E;M<f&&o[M].subtile===o[E].subtile;M++)P++}_=f;for(let w=_;w<y&&o[w].triangleSegmentIdx===o[_].triangleSegmentIdx;w++)f++}l._trim(),this.indexArray=l}getVisibleSegments(o,l,p){const _=new No;if(this.wallMode){for(const L of this.triangleSubSegments)_.segments.push(L.segment);return _}let f=0,y=0;const T=1<<o.canonical.z;if(l){const L=l.getMinMaxForTile(o);L&&(f=L.min,y=L.max)}y+=this.maxHeight;const E=o.toUnwrapped();let P;const w=[E.canonical.x/T+E.wrap,E.canonical.y/T],I=[(E.canonical.x+1)/T+E.wrap,(E.canonical.y+1)/T],R=(L,V,j)=>[L[0]*(1-j[0])+V[0]*j[0],L[1]*(1-j[1])+V[1]*j[1]],D=[],M=[];for(const L of this.triangleSubSegments){D[0]=L.min.x/an,D[1]=L.min.y/an,M[0]=L.max.x/an,M[1]=L.max.y/an;const V=R(w,I,D),j=R(w,I,M);if(0===new wr([V[0],V[1],f],[j[0],j[1],y]).intersectsPrecise(p)){P&&(_.segments.push(P),P=void 0);continue}const G=L.segment;P&&P.vertexOffset!==G.vertexOffset&&(_.segments.push(P),P=void 0),P?(P.vertexLength+=G.vertexLength,P.primitiveLength+=G.primitiveLength):P={vertexOffset:G.vertexOffset,primitiveLength:G.primitiveLength,vertexLength:G.vertexLength,primitiveOffset:G.primitiveOffset,sortKey:void 0,vaos:{}}}return P&&_.segments.push(P),_}encodeCentroid(o,l){const p=o.centroid(),_=l.span(),f=Math.min(7,Math.round(_.x*this.tileToMeter/10)),y=Math.min(7,Math.round(_.y*this.tileToMeter/10));return new Ht(Bt(p.x,1,8191)<<3|f,Bt(p.y,1,8191)<<3|y)}encodeBorderCentroid(o){if(!o.borders)return new Ht(0,0);const l=o.borders,p=Number.MAX_VALUE;if(l[0][0]!==p||l[1][0]!==p){const _=l[0][0]!==p?0:1;return new Ht(6|(l[0][0]!==p?0:65528),(l[_][0]+l[_][1])/2<<3|6)}{const _=l[2][0]!==p?2:3;return new Ht((l[_][0]+l[_][1])/2<<3|6,6|(l[2][0]!==p?0:65528))}}showCentroid(o){const l=this.centroidData[o.centroidDataIndex];l.flags&=xd,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(o){this.groundEffect.updateHiddenByLandmark(o);const l=o.vertexArrayOffset,p=o.vertexCount+o.vertexArrayOffset,_=o.flags&xd?Mw:o.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==_.y||f!==_.x){for(let y=l;y<p;++y)this.centroidVertexArray.emplace(y,_.x,_.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.centroidData)this.writeCentroidToBuffer(o)}updateReplacement(o,l,p){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const _=l.getReplacementRegionsForTile(o.toUnwrapped());if(zo(this.activeReplacements,_))return;if(this.activeReplacements=_,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const f=[];for(const y of this.activeReplacements){if(y.order<p)continue;const T=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-o.canonical.z));for(const E of this.centroidData)if(!(E.flags&xd||y.min.x>E.max.x||E.min.x>y.max.x||y.min.y>E.max.y||E.min.y>y.max.y))for(let P=0;P<E.footprintSegLen;P++){const w=this.footprintSegments[E.footprintSegIdx+P];if(f.length=0,rE(this.footprintVertices,w.vertexOffset,w.vertexCount,y.footprintTileId.canonical,o.canonical,f),xw(y.footprint,f,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-T)){E.flags|=xd;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(o,l,p){let _=!1;for(let f=0;f<p.footprintSegLen;f++){const y=this.footprintSegments[p.footprintSegIdx+f];let T=0;for(const E of y.ringIndices){for(let P=T,w=E+T-1;P<E+T;w=P++){const I=this.footprintVertices.int16[2*(P+y.vertexOffset)+0],R=this.footprintVertices.int16[2*(P+y.vertexOffset)+1],D=this.footprintVertices.int16[2*(w+y.vertexOffset)+1];R>l!=D>l&&o<(this.footprintVertices.int16[2*(w+y.vertexOffset)+0]-I)*(l-R)/(D-R)+I&&(_=!_)}T=E}}return _}getHeightAtTileCoord(o,l){let p=Number.NEGATIVE_INFINITY,_=!0;const f=4*(o+an)*an+(l+an);if(this.partLookup.hasOwnProperty(f)){const y=this.partLookup[f];return y?{height:y.height,hidden:!!(y.flags&xd)}:void 0}for(const y of this.centroidData)o>y.max.x||y.min.x>o||l>y.max.y||y.min.y>l||this.footprintContainsPoint(o,l,y)&&y&&y.height>p&&(p=y.height,this.partLookup[f]=y,_=!!(y.flags&xd));if(p!==Number.NEGATIVE_INFINITY)return{height:p,hidden:_};this.partLookup[f]=void 0}}function Zb(u,o){const l=u.add(o)._unit();return u.x*l.x+u.y*l.y}function Yb(u,o,l,p){const _=o.sub(u)._perp()._unit(),f=l.sub(o)._perp()._unit();return wd(u,o,l,Zb(_,f),p)}function wd(u,o,l,p,_){const f=Math.sqrt(1-p*p);return Math.min(u.dist(o)/3,o.dist(l)/3,_*f/p)}function Jb(u,o,l){return u.x<l[0].x&&o.x<l[0].x||u.x>l[1].x&&o.x>l[1].x||u.y<l[0].y&&o.y<l[0].y||u.y>l[1].y&&o.y>l[1].y}function Kb(u,o){return u.x<o[0].x||u.x>o[1].x||u.y<o[0].y||u.y>o[1].y}function Aw(u,o,l){if(u.x<0||u.x>=an||o.x<0||o.x>=an||l.x<0||l.x>=an)return!1;const p=l.sub(o),_=p.perp(),f=u.sub(o);return(p.x*f.x+p.y*f.y)/Math.sqrt((p.x*p.x+p.y*p.y)*(f.x*f.x+f.y*f.y))>-.866&&_.x*f.x+_.y*f.y<0}function Rw(u,o,l){const p=o?2|u:-3&u;return l?1|p:-2&p}function y0(){const u=Math.PI/32,o=Math.tan(u),l=F;return l*Math.sqrt(1+2*o*o)-l}function Rp(u,o,l){const p=1<<l.z,_=ge(l.x/p),f=ge((l.x+1)/p),y=xe(l.y/p),T=xe((l.y+1)/p);return function(E,P,w,I,R=0,D){const M=[];if(!E.length||!w||!I)return M;const L=(J,ce)=>{for(const we of J)M.push({polygon:we,bounds:ce})},V=Math.ceil(Math.log2(w)),j=Math.ceil(Math.log2(I)),G=V-j,$=[];for(let J=0;J<Math.abs(G);J++)$.push(G>0?0:1);for(let J=0;J<Math.min(V,j);J++)$.push(0),$.push(1);let H=E;if(H=Hg(H,P[0].y-R,P[1].y+R,1),H=Hg(H,P[0].x-R,P[1].x+R,0),!H.length)return M;const Y=[];for($.length?Y.push({polygons:H,bounds:P,depth:0}):L(H,P);Y.length;){const J=Y.pop(),ce=J.depth,we=$[ce],_e=J.bounds[0],be=J.bounds[1],Z=0===we?_e.x:_e.y,de=0===we?be.x:be.y,De=D?D(we,Z,de):.5*(Z+de),Be=Hg(J.polygons,Z-R,De+R,we),je=Hg(J.polygons,De-R,de+R,we);if(Be.length){const Xe=[_e,new Ht(0===we?De:be.x,1===we?De:be.y)];$.length>ce+1?Y.push({polygons:Be,bounds:Xe,depth:ce+1}):L(Be,Xe)}if(je.length){const Xe=[new Ht(0===we?De:_e.x,1===we?De:_e.y),be];$.length>ce+1?Y.push({polygons:je,bounds:Xe,depth:ce+1}):L(je,Xe)}}return M}(u,o,Math.ceil((f-_)/11.25),Math.ceil((y-T)/11.25),1,(E,P,w)=>{if(0===E)return.5*(P+w);{const I=xe((l.y+P/an)/p);return(re(.5*(xe((l.y+w/an)/p)+I))*p-l.y)*an}})}function rE(u,o,l,p,_,f){const y=Math.pow(2,p.z-_.z);for(let T=0;T<l;T++){let E=u.int16[2*(T+o)+0],P=u.int16[2*(T+o)+1];E=(E+_.x*an)*y-p.x*an,P=(P+_.y*an)*y-p.y*an,f.push(new Ht(E,P))}}let Pw,kw;function Wg(u,o){return u.x*o.x+u.y*o.y}function Qb(u,o){if(1===u.length){let l=0;const p=o[l++];let _;for(;!_||p.equals(_);)if(_=o[l++],!_)return 1/0;for(;l<o.length;l++){const f=o[l],y=u[0],T=_.sub(p),E=f.sub(p),P=y.sub(p),w=Wg(T,T),I=Wg(T,E),R=Wg(E,E),D=Wg(P,T),M=Wg(P,E),L=w*R-I*I,V=(R*D-I*M)/L,j=(w*M-I*D)/L,G=p.z*(1-V-j)+_.z*V+f.z*j;if(isFinite(G))return G}return 1/0}{let l=1/0;for(const p of o)l=Math.min(l,p.z);return l}}function Lw(u,o,l,p,_,f,y,T){const E=y*_.getElevationAt(u,o,!0,!0),P=0!==f[0],w=P?0===f[1]?y*(f[0]/7-450):y*function(I,R,D){const M=Math.floor(R[0]/8),L=Math.floor(R[1]/8),V=10*(R[0]-8*M),j=10*(R[1]-8*L),G=I.getElevationAt(M,L,!0,!0),$=I.getMeterToDEM(D),H=Math.floor(.5*(V*$-1)),Y=Math.floor(.5*(j*$-1)),J=I.tileCoordToPixel(M,L),ce=2*H+1,we=2*Y+1,_e=(at=ce,et=we,[(je=I).getElevationAtPixel(Xe=J.x-H,it=J.y-Y,!0),je.getElevationAtPixel(Xe+et,it,!0),je.getElevationAtPixel(Xe,it+et,!0),je.getElevationAtPixel(Xe+at,it+et,!0)]),be=Math.abs(_e[0]-_e[1]),Z=Math.abs(_e[2]-_e[3]),de=Math.abs(_e[0]-_e[2])+Math.abs(_e[1]-_e[3]),De=Math.min(.25,.5*$*(be+Z)/ce),Be=Math.min(.25,.5*$*de/we);var je,Xe,it,at,et;return G+Math.max(De*V,Be*j)}(_,f,T):E;return{base:E+(0===l?-1:l),top:P?Math.max(w+p,E+l+2):E+p}}Tn(Xb,"FillExtrusionBucket",{omit:["layers","features"]}),Tn(g0,"PartData"),Tn(Wb,"FootprintSegment"),Tn(_0,"BorderCentroidData"),Tn($g,"GroundEffect");const Ow=er([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),oE=er([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:Fw}=Ow,U2=er([{name:"a_packed",components:4,type:"Float32"}]),{members:sE}=U2,Pp=er([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:aE}=Pp;class kp{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new Vc({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const p=this.getKey(o,l);return this.positions[p]}trim(){const o=this.width,l=this.height=Jl(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,p){const _=[];let f=o.length%2==1?-o[o.length-1]*p:0,y=o[0]*p,T=!0;_.push({left:f,right:y,isDash:T,zeroLength:0===o[0]});let E=o[0];for(let P=1;P<o.length;P++){T=!T;const w=o[P];f=E*p,E+=w,y=E*p,_.push({left:f,right:y,isDash:T,zeroLength:0===w})}return _}addRoundDash(o,l,p){const _=l/2;for(let f=-p;f<=p;f++){const y=this.width*(this.nextRow+p+f);let T=0,E=o[T];for(let P=0;P<this.width;P++){P/E.right>1&&(E=o[++T]);const w=Math.abs(P-E.left),I=Math.abs(P-E.right),R=Math.min(w,I);let D;const M=f/p*(_+1);if(E.isDash){const L=_-Math.abs(M);D=Math.sqrt(R*R+L*L)}else D=_-Math.sqrt(R*R+M*M);this.image.data[y+P]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(o,l){for(let E=o.length-1;E>=0;--E){const P=o[E],w=o[E+1];P.zeroLength?o.splice(E,1):w&&w.isDash===P.isDash&&(w.left=P.left,o.splice(E,1))}const p=o[0],_=o[o.length-1];p.isDash===_.isDash&&(p.left=_.left-this.width,_.right=p.right+this.width);const f=this.width*this.nextRow;let y=0,T=o[y];for(let E=0;E<this.width;E++){E/T.right>1&&(T=o[++y]);const P=Math.abs(E-T.left),w=Math.abs(E-T.right),I=Math.min(P,w);this.image.data[f+E]=Math.max(0,Math.min(255,(T.isDash?I:-I)+l+128))}}addDash(o,l){const p=this.getKey(o,l);if(this.positions[p])return this.positions[p];const _="round"===l,f=_?7:0,y=2*f+1;if(this.nextRow+y>this.height)return Ki("LineAtlas out of space"),null;0===o.length&&o.push(1);let T=0;for(let w=0;w<o.length;w++)o[w]<0&&(Ki("Negative value is found in line dasharray, replacing values with 0"),o[w]=0),T+=o[w];if(0!==T){const w=this.width/T,I=this.getDashRanges(o,this.width,w);_?this.addRoundDash(I,w,f):this.addRegularDash(I,"square"===l?.5*w:0)}const E=this.nextRow+f;this.nextRow+=y;const P={tl:[E,f],br:[T,0]};return this.positions[p]=P,P}}Tn(kp,"LineAtlas");const ci=um.VectorTileFeature.types,lE=Math.cos(Math.PI/180*37.5),H2=Math.cos(Math.PI/180*5);class Lp{constructor(o){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=o.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new lh,this.layoutVertexArray2=new Fc,this.patternVertexArray=new Fl,this.indexArray=new Xr,this.programConfigurations=new Ca(o.layers,{zoom:o.zoom,lut:o.lut}),this.segments=new No,this.maxLineLength=0,this.zOffsetVertexArray=new md,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.tessellationStep=o.tessellationStep?o.tessellationStep:128}updateFootprints(o,l){}populate(o,l,p,_){this.hasPattern=Qa("line",this.layers,l);const f=this.layers[0].layout.get("line-sort-key");this.hasZOffset=!this.layers[0].isDraped();const y=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&"none"===y&&Ki(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const T=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&void 0!==T;const E=[];for(const{feature:R,id:D,index:M,sourceLayerIndex:L}of o){const V=this.layers[0]._featureFilter.needGeometry,j=Pt(R,V);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),j,p))continue;const G=f?f.evaluate(j,{},p):void 0,$={id:D,properties:R.properties,type:R.type,sourceLayerIndex:L,index:M,geometry:V?j.geometry:Ke(R,p,_),patterns:{},sortKey:G};E.push($)}f&&E.sort((R,D)=>R.sortKey-D.sortKey);const{lineAtlas:P,featureIndex:w}=l,I=this.addConstantDashes(P);for(const R of E){const{geometry:D,index:M,sourceLayerIndex:L}=R;if(I&&this.addFeatureDashes(R,P),this.hasPattern){const V=mc("line",this.layers,R,this.zoom,l);this.patternFeatures.push(V)}else this.addFeature(R,D,M,p,P.positions,l.availableImages,l.brightness);w.insert(o[M].feature,D,M,L,this.index)}}addConstantDashes(o){let l=!1;for(const p of this.layers){const _=p.paint.get("line-dasharray").value,f=p.layout.get("line-cap").value;if("constant"!==_.kind||"constant"!==f.kind)l=!0;else{const y=f.value,T=_.value;if(!T)continue;o.addDash(T,y)}}return l}addFeatureDashes(o,l){const p=this.zoom;for(const _ of this.layers){const f=_.paint.get("line-dasharray").value,y=_.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===y.kind)continue;let T,E;if("constant"===f.kind){if(T=f.value,!T)continue}else T=f.evaluate({zoom:p},o);E="constant"===y.kind?y.value:y.evaluate({zoom:p},o),l.addDash(T,E),o.patterns[_.id]=l.getKey(T,E)}}update(o,l,p,_,f){const y=0!==Object.keys(o).length;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(o,l,y?this.stateDependentLayers:this.layers,p,_,f)}addFeatures(o,l,p,_,f,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,l,p,_,y)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,sE)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=o.createVertexBuffer(this.patternVertexArray,aE)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,oE.members,!0)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Fw),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,p,_,f,y,T){const E=this.layers[0].layout,P=E.get("line-join").evaluate(o,{}),w=E.get("line-cap").evaluate(o,{}),I=E.get("line-miter-limit"),R=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(o),this.lineFeature=o,this.zOffsetValue=E.get("line-z-offset").value;for(const D of l)this.addLine(D,o,_,P,w,I,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,f,y,_,T)}addLine(o,l,p,_,f,y,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const E="none"===_;if(this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let $=0;$<o.length-1;$++)this.totalDistance+=o[$].dist(o[$+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P="Polygon"===ci[l.type];let w=o.length;for(;w>=2&&o[w-1].equals(o[w-2]);)w--;let I=0;for(;I<w-1&&o[I].equals(o[I+1]);)I++;if(w<(P?3:2))return;"bevel"===_&&(y=1.05);const R=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let D,M,L,V,j,G;this.e1=this.e2=-1,P&&(D=o[w-2],j=o[I].sub(D)._unit()._perp());for(let $=I;$<w;$++){if(L=$===w-1?P?o[I+1]:void 0:o[$+1],L&&o[$].equals(L))continue;j&&(V=j),D&&(M=D),D=o[$],G=this.hasZOffset?this.evaluateElevationValue(M?M.dist(D):0):null,j=L?L.sub(D)._unit()._perp():V,V=V||j;const H=M&&L;let Y=H?_:P||E?"butt":f;const J=V.x*j.x+V.y*j.y;if(E){const Be=function(je){if(je.patternJoinNone){const Xe=je.segmentPoints.length/2,it=je.lineSoFar-je.segmentStart;for(let at=0;at<Xe;++at){const et=je.segmentPoints[2*at+1],It=Math.round(je.segmentPoints[2*at])+.5+.25*et;je.patternVertexArray.emplaceBack(It,it,je.segmentStart),je.patternVertexArray.emplaceBack(It,it,je.segmentStart)}je.segmentPoints.length=0}je.e1=je.e2=-1};if(H&&J<H2){this.updateDistance(M,D),this.addCurrentVertex(D,V,1,1,R,G),Be(this),this.addCurrentVertex(D,j,-1,-1,R,G);continue}if(M){if(!L){this.updateDistance(M,D),this.addCurrentVertex(D,V,1,1,R,G),Be(this);continue}Y="miter"}}let ce=V.add(j);0===ce.x&&0===ce.y||ce._unit();const we=ce.x*j.x+ce.y*j.y,_e=0!==we?1/we:1/0,be=2*Math.sqrt(2-2*we),Z=we<lE&&M&&L,de=V.x*j.y-V.y*j.x>0,De=this.overscaling<=16?15*an/(512*this.overscaling):0;if(H&&"round"===Y)if(_e<T)Y="miter";else if(_e<=2){const Be=gc(D,-10,8202);Y=this.hasZOffset&&(Be||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===Y&&_e>y&&(Y="bevel"),"bevel"===Y&&(_e>2&&(Y="flipbevel"),_e<y&&(Y="miter")),M&&!("miter"===Y&&Z)&&this.updateDistance(M,D),"miter"===Y)if(Z){const Be=D.dist(M);if(Be>2*De){const Xe=D.sub(D.sub(M)._mult(De/Be)._round());this.updateDistance(M,Xe),this.addCurrentVertex(Xe,V,0,0,R,G),M=Xe}this.updateDistance(M,D),ce._mult(_e),this.addCurrentVertex(D,ce,0,0,R,G);const je=D.dist(L);if(je>2*De){const Xe=D.add(L.sub(D)._mult(De/je)._round());this.updateDistance(D,Xe),this.addCurrentVertex(Xe,j,0,0,R,G),D=Xe}}else ce._mult(_e),this.addCurrentVertex(D,ce,0,0,R,G);else if("flipbevel"===Y){if(_e>100)ce=j.mult(-1);else{const Be=_e*V.add(j).mag()/V.sub(j).mag();ce._perp()._mult(Be*(de?-1:1))}this.addCurrentVertex(D,ce,0,0,R,G),this.addCurrentVertex(D,ce.mult(-1),0,0,R,G)}else if("bevel"===Y||"fakeround"===Y){null!=G&&M&&this.addCurrentVertex(D,V,-1,-1,R,G);const Be=D.dist(M)<=2*De&&"bevel"!==Y,je=ce.mult(de?1:-1);je._mult(_e);const Xe=j.mult(de?-1:1),it=V.mult(de?-1:1),at=this.evaluateElevationValue(this.distance);if(null==G&&(this.addHalfVertex(D,je.x,je.y,!1,!de,0,R,at),Be||this.addHalfVertex(D,je.x+2*it.x,je.y+2*it.y,!1,de,0,R,at)),"fakeround"===Y){const et=Math.round(180*be/Math.PI/20);this.addHalfVertex(D,it.x,it.y,!1,de,0,R,at);for(let It=0;It<et;It++){let Xt=It/et;if(.5!==Xt){const yn=Xt-.5;Xt+=Xt*yn*(Xt-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*yn*yn+(.848013+J*(.215638*J-1.06021)))}const vt=Xe.sub(it)._mult(Xt)._add(it)._unit();this.addHalfVertex(D,vt.x,vt.y,!1,de,0,R,at)}this.addHalfVertex(D,Xe.x,Xe.y,!1,de,0,R,at)}Be||null!=G||this.addHalfVertex(D,je.x+2*Xe.x,je.y+2*Xe.y,!1,de,0,R,at),null!=G&&L&&this.addCurrentVertex(D,j,1,1,R,G)}else"butt"===Y?this.addCurrentVertex(D,ce,0,0,R,G):"square"===Y?(M||this.addCurrentVertex(D,ce,-1,-1,R,G),this.addCurrentVertex(D,ce,0,0,R,G),M&&this.addCurrentVertex(D,ce,1,1,R,G)):"round"===Y&&(M&&(this.addCurrentVertex(D,V,0,0,R,G),this.addCurrentVertex(D,V,1,1,R,G,!0)),L&&(this.addCurrentVertex(D,j,-1,-1,R,G,!0),this.addCurrentVertex(D,j,0,0,R,G)))}}addVerticesTo(o,l,p,_,f,y,T,E,P,w){const I=(l.w-o.w)/this.tessellationStep|0;let R=0;const D=this.scaledDistance;if(I>1){this.lineSoFar=o.w;const L=(l.x-o.x)/I,V=(l.y-o.y)/I,j=(l.z-o.z)/I,G=(l.w-o.w)/I;for(let $=1;$<I;++$){o.x+=L,o.y+=V,o.z+=j,this.lineSoFar+=G,R+=G;const H=this.evaluateElevationValue(this.prevDistance+R);this.scaledDistance=(this.prevDistance+R)/this.totalDistance,this.addHalfVertex(o,p,_,w,!1,T,P,H),this.addHalfVertex(o,f,y,w,!0,-E,P,H)}}this.lineSoFar=l.w,this.scaledDistance=D;const M=this.evaluateElevationValue(this.distance);this.addHalfVertex(l,p,_,w,!1,T,P,M),this.addHalfVertex(l,f,y,w,!0,-E,P,M)}evaluateElevationValue(o){return this.hasZOffset?"constant"===this.zOffsetValue.kind?this.zOffsetValue.value:(this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+o)/this.totalFeatureLength):Ki(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0):void 0}addCurrentVertex(o,l,p,_,f,y,T=!1){const E=l.x+l.y*p,P=l.y-l.x*p,w=l.y*_-l.x,I=-l.y-l.x*_;if(null!=y){const D=8202,M=y,L=new yw(o.x,o.y,M,this.lineSoFar),V=gc(o,-10,D),j=this.lineSoFar,G=this.distance;if(this.currentVertex)if(V){const $=this.currentVertexIsOutside,H=this.currentVertex,Y=new yw(o.x,o.y,M,this.lineSoFar);if(d0(H,Y,-10,D),!gc(Y,-10,D)){if($){this.e1=this.e2=-1,this.distance-=H.dist(L),this.lineSoFar=H.w;const J=this.evaluateElevationValue(H.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(H,E,P,T,!1,p,f,J),this.addHalfVertex(H,w,I,T,!0,-_,f,J),this.prevDistance=this.distance}this.distance=this.prevDistance+H.dist(Y),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(H,Y,E,P,w,I,p,_,f,T),this.distance=G,this.scaledDistance=this.distance/this.totalDistance}}else{const $=this.currentVertex;if(this.currentVertexIsOutside){d0($,L,-10,D),this.e1=this.e2=-1,this.distance-=$.dist(L),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=$.w;const H=this.evaluateElevationValue($.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($,E,P,T,!1,p,f,H),this.addHalfVertex($,w,I,T,!0,-_,f,H),this.prevDistance=this.distance,this.distance=G,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo($,L,E,P,w,I,p,_,f,T)}else V||(this.addHalfVertex(o,E,P,T,!1,p,f,y),this.addHalfVertex(o,w,I,T,!0,-_,f,y));this.currentVertex=L,this.currentVertexIsOutside=V,this.lineSoFar=j}else this.addHalfVertex(o,E,P,T,!1,p,f,y),this.addHalfVertex(o,w,I,T,!0,-_,f,y)}addHalfVertex({x:o,y:l},p,_,f,y,T,E,P){this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((o<<1)+(f?1:0),(l<<1)+(y?1:0),Math.round(63*p)+128,Math.round(63*_)+128,1+(0===T?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),E.primitiveLength++),y?this.e2=w:this.e1=w,null!=P&&this.zOffsetVertexArray.emplaceBack(P)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(o,l){this.prevDistance=this.distance,this.distance+=o.dist(l),this.updateScaledDistance()}}function gc(u,o,l){return u.x<o||u.x>l||u.y<o||u.y>l}let Nw,Bw;function vh(u,o,l){return o*(an/(u.tileSize*Math.pow(2,l-u.tileID.overscaledZ)))}Tn(Lp,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const zw=(u,o,l)=>(1-l)*u+l*o;function ey(u,o){return 1/vh(u,1,o.tileZoom)}function ty(u,o,l,p){return u.translatePosMatrix(p||o.tileID.projMatrix,o,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const Vw=u=>{const o=[];ny(u)&&o.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT");const l=u.paint.get("line-trim-offset");0===l[0]&&0===l[1]||o.push("RENDER_LINE_TRIM_OFFSET"),0!==u.paint.get("line-border-width").constantOr(1)&&o.push("RENDER_LINE_BORDER");const p="none"===u.layout.get("line-join").constantOr("miter"),_=!!u.paint.get("line-pattern").constantOr(1);return p&&_&&o.push("LINE_JOIN_NONE"),o};function ny(u){const o=u.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}let Mu;const jw=()=>Mu||(Mu={layout:Nw||(Nw=new $r({"line-cap":new Bn(ot.layout_line["line-cap"]),"line-join":new Bn(ot.layout_line["line-join"]),"line-miter-limit":new Qt(ot.layout_line["line-miter-limit"]),"line-round-limit":new Qt(ot.layout_line["line-round-limit"]),"line-sort-key":new Bn(ot.layout_line["line-sort-key"]),"line-z-offset":new Bn(ot.layout_line["line-z-offset"]),"line-elevation-reference":new Qt(ot.layout_line["line-elevation-reference"]),"line-cross-slope":new Qt(ot.layout_line["line-cross-slope"]),visibility:new Qt(ot.layout_line.visibility)})),paint:Bw||(Bw=new $r({"line-opacity":new Bn(ot.paint_line["line-opacity"]),"line-color":new Bn(ot.paint_line["line-color"]),"line-translate":new Qt(ot.paint_line["line-translate"]),"line-translate-anchor":new Qt(ot.paint_line["line-translate-anchor"]),"line-width":new Bn(ot.paint_line["line-width"]),"line-gap-width":new Bn(ot.paint_line["line-gap-width"]),"line-offset":new Bn(ot.paint_line["line-offset"]),"line-blur":new Bn(ot.paint_line["line-blur"]),"line-dasharray":new Bn(ot.paint_line["line-dasharray"]),"line-pattern":new Bn(ot.paint_line["line-pattern"]),"line-gradient":new cc(ot.paint_line["line-gradient"]),"line-trim-offset":new Qt(ot.paint_line["line-trim-offset"]),"line-trim-fade-range":new Qt(ot.paint_line["line-trim-fade-range"]),"line-trim-color":new Qt(ot.paint_line["line-trim-color"]),"line-emissive-strength":new Qt(ot.paint_line["line-emissive-strength"]),"line-border-width":new Bn(ot.paint_line["line-border-width"]),"line-border-color":new Bn(ot.paint_line["line-border-color"]),"line-occlusion-opacity":new Qt(ot.paint_line["line-occlusion-opacity"])}))},Mu);class cE extends Bn{possiblyEvaluate(o,l){return l=new Po(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition}),super.possiblyEvaluate(o,l)}evaluate(o,l,p,_){return l=yr({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(o,l,p,_)}}let Xg;function Uw(u,o){return o>0?o+2*u:u}const uE=er([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),dE=er([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),hE=er([{name:"a_projected_pos",components:4,type:"Float32"}],4);er([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const pm=er([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Sd=er([{name:"a_texb",components:2,type:"Uint16"}]),pE=er([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),fE=er([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);er([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const mE=er([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),q2=er([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);er([{name:"triangle",components:3,type:"Uint16"}]),er([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),er([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),er([{type:"Float32",name:"offsetX"}]),er([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const Au=128;function iy(u,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new Po(u+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:p,interpolationType:_}=l;let f=0;for(;f<p.length&&p[f]<=u;)f++;f=Math.max(0,f-1);let y=f;for(;y<p.length&&p[y]<u+1;)y++;y=Math.min(p.length-1,y);const T=p[f],E=p[y];return"composite"===l.kind?{kind:"composite",minZoom:T,maxZoom:E,interpolationType:_}:{kind:"camera",minZoom:T,maxZoom:E,minSize:l.evaluate(new Po(T)),maxSize:l.evaluate(new Po(E)),interpolationType:_}}}function v0(u,{uSize:o,uSizeT:l},{lowerSize:p,upperSize:_}){return"source"===u.kind?p/Au:"composite"===u.kind?ni(p/Au,_/Au,l):o}function Op(u,o,l=1){let p=0,_=0;if("constant"===u.kind)_=u.layoutSize*l;else if("source"!==u.kind){const{interpolationType:f,minZoom:y,maxZoom:T}=u,E=f?Bt(Ga.interpolationFactor(f,o,y,T),0,1):0;"camera"===u.kind?_=ni(u.minSize,u.maxSize,E)*l:p=E*l}return{uSizeT:p,uSize:_}}var gE=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Au,evaluateSizeForFeature:v0,evaluateSizeForZoom:Op,getSizeData:iy});function Hw(u,o,l){return u.sections.forEach(p=>{p.text=function(_,f,y){const T=f.layout.get("text-transform").evaluate(y,{});return"uppercase"===T?_=_.toLocaleUpperCase():"lowercase"===T&&(_=_.toLocaleLowerCase()),Xa.applyArabicShaping&&(_=Xa.applyArabicShaping(_)),_}(p.text,o,l)}),u}const Zg={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function _E(u){return"\ufe36"===u||"\ufe48"===u||"\ufe38"===u||"\ufe44"===u||"\ufe42"===u||"\ufe3e"===u||"\ufe3c"===u||"\ufe3a"===u||"\ufe18"===u||"\ufe40"===u||"\ufe10"===u||"\ufe13"===u||"\ufe14"===u||"\uff40"===u||"\uffe3"===u||"\ufe11"===u||"\ufe12"===u}function Uc(u){return"\ufe35"===u||"\ufe47"===u||"\ufe37"===u||"\ufe43"===u||"\ufe41"===u||"\ufe3d"===u||"\ufe3b"===u||"\ufe39"===u||"\ufe17"===u||"\ufe3f"===u}var qw,ry,Gw,x0={};function $w(){if(Gw)return ry;Gw=1,ry=o;var u=function bE(){return qw||(qw=1,x0.read=function(u,o,l,p,_){var f,y,T=8*_-p-1,E=(1<<T)-1,P=E>>1,w=-7,I=l?_-1:0,R=l?-1:1,D=u[o+I];for(I+=R,f=D&(1<<-w)-1,D>>=-w,w+=T;w>0;f=256*f+u[o+I],I+=R,w-=8);for(y=f&(1<<-w)-1,f>>=-w,w+=p;w>0;y=256*y+u[o+I],I+=R,w-=8);if(0===f)f=1-P;else{if(f===E)return y?NaN:1/0*(D?-1:1);y+=Math.pow(2,p),f-=P}return(D?-1:1)*y*Math.pow(2,f-p)},x0.write=function(u,o,l,p,_,f){var y,T,E,P=8*f-_-1,w=(1<<P)-1,I=w>>1,R=23===_?Math.pow(2,-24)-Math.pow(2,-77):0,D=p?0:f-1,M=p?1:-1,L=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(T=isNaN(o)?1:0,y=w):(y=Math.floor(Math.log(o)/Math.LN2),o*(E=Math.pow(2,-y))<1&&(y--,E*=2),(o+=y+I>=1?R/E:R*Math.pow(2,1-I))*E>=2&&(y++,E/=2),y+I>=w?(T=0,y=w):y+I>=1?(T=(o*E-1)*Math.pow(2,_),y+=I):(T=o*Math.pow(2,I-1)*Math.pow(2,_),y=0));_>=8;u[l+D]=255&T,D+=M,T/=256,_-=8);for(y=y<<_|T,P+=_;P>0;u[l+D]=255&y,D+=M,y/=256,P-=8);u[l+D-M]|=128*L}),x0}();function o(H){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(H)?H:new Uint8Array(H||0),this.pos=0,this.type=0,this.length=this.buf.length}o.Varint=0,o.Fixed64=1,o.Bytes=2,o.Fixed32=5;var l=4294967296,p=1/l,_="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function f(H){return H.type===o.Bytes?H.readVarint()+H.pos:H.pos+1}function T(H,Y,J){var ce=Y<=16383?1:Y<=2097151?2:Y<=268435455?3:Math.floor(Math.log(Y)/(7*Math.LN2));J.realloc(ce);for(var we=J.pos-1;we>=H;we--)J.buf[we+ce]=J.buf[we]}function E(H,Y){for(var J=0;J<H.length;J++)Y.writeVarint(H[J])}function P(H,Y){for(var J=0;J<H.length;J++)Y.writeSVarint(H[J])}function w(H,Y){for(var J=0;J<H.length;J++)Y.writeFloat(H[J])}function I(H,Y){for(var J=0;J<H.length;J++)Y.writeDouble(H[J])}function R(H,Y){for(var J=0;J<H.length;J++)Y.writeBoolean(H[J])}function D(H,Y){for(var J=0;J<H.length;J++)Y.writeFixed32(H[J])}function M(H,Y){for(var J=0;J<H.length;J++)Y.writeSFixed32(H[J])}function L(H,Y){for(var J=0;J<H.length;J++)Y.writeFixed64(H[J])}function V(H,Y){for(var J=0;J<H.length;J++)Y.writeSFixed64(H[J])}function j(H,Y){return(H[Y]|H[Y+1]<<8|H[Y+2]<<16)+16777216*H[Y+3]}function G(H,Y,J){H[J]=Y,H[J+1]=Y>>>8,H[J+2]=Y>>>16,H[J+3]=Y>>>24}function $(H,Y){return(H[Y]|H[Y+1]<<8|H[Y+2]<<16)+(H[Y+3]<<24)}return o.prototype={destroy:function(){this.buf=null},readFields:function(H,Y,J){for(J=J||this.length;this.pos<J;){var ce=this.readVarint(),we=ce>>3,_e=this.pos;this.type=7&ce,H(we,Y,this),this.pos===_e&&this.skip(ce)}return Y},readMessage:function(H,Y){return this.readFields(H,Y,this.readVarint()+this.pos)},readFixed32:function(){var H=j(this.buf,this.pos);return this.pos+=4,H},readSFixed32:function(){var H=$(this.buf,this.pos);return this.pos+=4,H},readFixed64:function(){var H=j(this.buf,this.pos)+j(this.buf,this.pos+4)*l;return this.pos+=8,H},readSFixed64:function(){var H=j(this.buf,this.pos)+$(this.buf,this.pos+4)*l;return this.pos+=8,H},readFloat:function(){var H=u.read(this.buf,this.pos,!0,23,4);return this.pos+=4,H},readDouble:function(){var H=u.read(this.buf,this.pos,!0,52,8);return this.pos+=8,H},readVarint:function(H){var Y,J,ce=this.buf;return Y=127&(J=ce[this.pos++]),J<128?Y:(Y|=(127&(J=ce[this.pos++]))<<7,J<128?Y:(Y|=(127&(J=ce[this.pos++]))<<14,J<128?Y:(Y|=(127&(J=ce[this.pos++]))<<21,J<128?Y:function(we,_e,be){var Z,de,De=be.buf;if(Z=(112&(de=De[be.pos++]))>>4,de<128||(Z|=(127&(de=De[be.pos++]))<<3,de<128)||(Z|=(127&(de=De[be.pos++]))<<10,de<128)||(Z|=(127&(de=De[be.pos++]))<<17,de<128)||(Z|=(127&(de=De[be.pos++]))<<24,de<128)||(Z|=(1&(de=De[be.pos++]))<<31,de<128))return function y(H,Y,J){return J?4294967296*Y+(H>>>0):4294967296*(Y>>>0)+(H>>>0)}(we,Z,_e);throw new Error("Expected varint not more than 10 bytes")}(Y|=(15&(J=ce[this.pos]))<<28,H,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var H=this.readVarint();return H%2==1?(H+1)/-2:H/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var H=this.readVarint()+this.pos,Y=this.pos;return this.pos=H,H-Y>=12&&_?_.decode(this.buf.subarray(Y,H)):function(J,ce,we){for(var _e="",be=ce;be<we;){var Z,de,De,Be=J[be],je=null,Xe=Be>239?4:Be>223?3:Be>191?2:1;if(be+Xe>we)break;1===Xe?Be<128&&(je=Be):2===Xe?128==(192&(Z=J[be+1]))&&(je=(31&Be)<<6|63&Z)<=127&&(je=null):3===Xe?(de=J[be+2],128==(192&(Z=J[be+1]))&&128==(192&de)&&((je=(15&Be)<<12|(63&Z)<<6|63&de)<=2047||je>=55296&&je<=57343)&&(je=null)):4===Xe&&(de=J[be+2],De=J[be+3],128==(192&(Z=J[be+1]))&&128==(192&de)&&128==(192&De)&&((je=(15&Be)<<18|(63&Z)<<12|(63&de)<<6|63&De)<=65535||je>=1114112)&&(je=null)),null===je?(je=65533,Xe=1):je>65535&&(je-=65536,_e+=String.fromCharCode(je>>>10&1023|55296),je=56320|1023&je),_e+=String.fromCharCode(je),be+=Xe}return _e}(this.buf,Y,H)},readBytes:function(){var H=this.readVarint()+this.pos,Y=this.buf.subarray(this.pos,H);return this.pos=H,Y},readPackedVarint:function(H,Y){if(this.type!==o.Bytes)return H.push(this.readVarint(Y));var J=f(this);for(H=H||[];this.pos<J;)H.push(this.readVarint(Y));return H},readPackedSVarint:function(H){if(this.type!==o.Bytes)return H.push(this.readSVarint());var Y=f(this);for(H=H||[];this.pos<Y;)H.push(this.readSVarint());return H},readPackedBoolean:function(H){if(this.type!==o.Bytes)return H.push(this.readBoolean());var Y=f(this);for(H=H||[];this.pos<Y;)H.push(this.readBoolean());return H},readPackedFloat:function(H){if(this.type!==o.Bytes)return H.push(this.readFloat());var Y=f(this);for(H=H||[];this.pos<Y;)H.push(this.readFloat());return H},readPackedDouble:function(H){if(this.type!==o.Bytes)return H.push(this.readDouble());var Y=f(this);for(H=H||[];this.pos<Y;)H.push(this.readDouble());return H},readPackedFixed32:function(H){if(this.type!==o.Bytes)return H.push(this.readFixed32());var Y=f(this);for(H=H||[];this.pos<Y;)H.push(this.readFixed32());return H},readPackedSFixed32:function(H){if(this.type!==o.Bytes)return H.push(this.readSFixed32());var Y=f(this);for(H=H||[];this.pos<Y;)H.push(this.readSFixed32());return H},readPackedFixed64:function(H){if(this.type!==o.Bytes)return H.push(this.readFixed64());var Y=f(this);for(H=H||[];this.pos<Y;)H.push(this.readFixed64());return H},readPackedSFixed64:function(H){if(this.type!==o.Bytes)return H.push(this.readSFixed64());var Y=f(this);for(H=H||[];this.pos<Y;)H.push(this.readSFixed64());return H},skip:function(H){var Y=7&H;if(Y===o.Varint)for(;this.buf[this.pos++]>127;);else if(Y===o.Bytes)this.pos=this.readVarint()+this.pos;else if(Y===o.Fixed32)this.pos+=4;else{if(Y!==o.Fixed64)throw new Error("Unimplemented type: "+Y);this.pos+=8}},writeTag:function(H,Y){this.writeVarint(H<<3|Y)},realloc:function(H){for(var Y=this.length||16;Y<this.pos+H;)Y*=2;if(Y!==this.length){var J=new Uint8Array(Y);J.set(this.buf),this.buf=J,this.length=Y}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(H){this.realloc(4),G(this.buf,H,this.pos),this.pos+=4},writeSFixed32:function(H){this.realloc(4),G(this.buf,H,this.pos),this.pos+=4},writeFixed64:function(H){this.realloc(8),G(this.buf,-1&H,this.pos),G(this.buf,Math.floor(H*p),this.pos+4),this.pos+=8},writeSFixed64:function(H){this.realloc(8),G(this.buf,-1&H,this.pos),G(this.buf,Math.floor(H*p),this.pos+4),this.pos+=8},writeVarint:function(H){(H=+H||0)>268435455||H<0?function(Y,J){var ce,we,_e,Z;if(Y>=0?(ce=Y%4294967296|0,we=Y/4294967296|0):(we=~(-Y/4294967296),4294967295^(ce=~(-Y%4294967296))?ce=ce+1|0:(ce=0,we=we+1|0)),Y>=0x10000000000000000||Y<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");J.realloc(10),_e=ce,(Z=J).buf[Z.pos++]=127&_e|128,_e>>>=7,Z.buf[Z.pos++]=127&_e|128,_e>>>=7,Z.buf[Z.pos++]=127&_e|128,_e>>>=7,Z.buf[Z.pos++]=127&_e|128,Z.buf[Z.pos]=127&(_e>>>=7),function(_e,be){var Z=(7&_e)<<4;be.buf[be.pos++]|=Z|((_e>>>=3)?128:0),_e&&(be.buf[be.pos++]=127&_e|((_e>>>=7)?128:0),_e&&(be.buf[be.pos++]=127&_e|((_e>>>=7)?128:0),_e&&(be.buf[be.pos++]=127&_e|((_e>>>=7)?128:0),_e&&(be.buf[be.pos++]=127&_e|((_e>>>=7)?128:0),_e&&(be.buf[be.pos++]=127&_e)))))}(we,J)}(H,this):(this.realloc(4),this.buf[this.pos++]=127&H|(H>127?128:0),H<=127||(this.buf[this.pos++]=127&(H>>>=7)|(H>127?128:0),H<=127||(this.buf[this.pos++]=127&(H>>>=7)|(H>127?128:0),H<=127||(this.buf[this.pos++]=H>>>7&127))))},writeSVarint:function(H){this.writeVarint(H<0?2*-H-1:2*H)},writeBoolean:function(H){this.writeVarint(Boolean(H))},writeString:function(H){H=String(H),this.realloc(4*H.length),this.pos++;var Y=this.pos;this.pos=function(ce,we,_e){for(var be,Z,de=0;de<we.length;de++){if((be=we.charCodeAt(de))>55295&&be<57344){if(!Z){be>56319||de+1===we.length?(ce[_e++]=239,ce[_e++]=191,ce[_e++]=189):Z=be;continue}if(be<56320){ce[_e++]=239,ce[_e++]=191,ce[_e++]=189,Z=be;continue}be=Z-55296<<10|be-56320|65536,Z=null}else Z&&(ce[_e++]=239,ce[_e++]=191,ce[_e++]=189,Z=null);be<128?ce[_e++]=be:(be<2048?ce[_e++]=be>>6|192:(be<65536?ce[_e++]=be>>12|224:(ce[_e++]=be>>18|240,ce[_e++]=be>>12&63|128),ce[_e++]=be>>6&63|128),ce[_e++]=63&be|128)}return _e}(this.buf,H,this.pos);var J=this.pos-Y;J>=128&&T(Y,J,this),this.pos=Y-1,this.writeVarint(J),this.pos+=J},writeFloat:function(H){this.realloc(4),u.write(this.buf,H,this.pos,!0,23,4),this.pos+=4},writeDouble:function(H){this.realloc(8),u.write(this.buf,H,this.pos,!0,52,8),this.pos+=8},writeBytes:function(H){var Y=H.length;this.writeVarint(Y),this.realloc(Y);for(var J=0;J<Y;J++)this.buf[this.pos++]=H[J]},writeRawMessage:function(H,Y){this.pos++;var J=this.pos;H(Y,this);var ce=this.pos-J;ce>=128&&T(J,ce,this),this.pos=J-1,this.writeVarint(ce),this.pos+=ce},writeMessage:function(H,Y,J){this.writeTag(H,o.Bytes),this.writeRawMessage(Y,J)},writePackedVarint:function(H,Y){Y.length&&this.writeMessage(H,E,Y)},writePackedSVarint:function(H,Y){Y.length&&this.writeMessage(H,P,Y)},writePackedBoolean:function(H,Y){Y.length&&this.writeMessage(H,R,Y)},writePackedFloat:function(H,Y){Y.length&&this.writeMessage(H,w,Y)},writePackedDouble:function(H,Y){Y.length&&this.writeMessage(H,I,Y)},writePackedFixed32:function(H,Y){Y.length&&this.writeMessage(H,D,Y)},writePackedSFixed32:function(H,Y){Y.length&&this.writeMessage(H,M,Y)},writePackedFixed64:function(H,Y){Y.length&&this.writeMessage(H,L,Y)},writePackedSFixed64:function(H,Y){Y.length&&this.writeMessage(H,V,Y)},writeBytesField:function(H,Y){this.writeTag(H,o.Bytes),this.writeBytes(Y)},writeFixed32Field:function(H,Y){this.writeTag(H,o.Fixed32),this.writeFixed32(Y)},writeSFixed32Field:function(H,Y){this.writeTag(H,o.Fixed32),this.writeSFixed32(Y)},writeFixed64Field:function(H,Y){this.writeTag(H,o.Fixed64),this.writeFixed64(Y)},writeSFixed64Field:function(H,Y){this.writeTag(H,o.Fixed64),this.writeSFixed64(Y)},writeVarintField:function(H,Y){this.writeTag(H,o.Varint),this.writeVarint(Y)},writeSVarintField:function(H,Y){this.writeTag(H,o.Varint),this.writeSVarint(Y)},writeStringField:function(H,Y){this.writeTag(H,o.Bytes),this.writeString(Y)},writeFloatField:function(H,Y){this.writeTag(H,o.Fixed32),this.writeFloat(Y)},writeDoubleField:function(H,Y){this.writeTag(H,o.Fixed64),this.writeDouble(Y)},writeBooleanField:function(H,Y){this.writeVarintField(H,Boolean(Y))}},ry}var Yg=dt($w());function yE(u,o,l){o.glyphs=[],1===u&&l.readMessage(vE,o)}function vE(u,o,l){if(3===u){const{id:p,bitmap:_,width:f,height:y,left:T,top:E,advance:P}=l.readMessage(_r,{});o.glyphs.push({id:p,bitmap:new Vc({width:f+6,height:y+6},_),metrics:{width:f,height:y,left:T,top:E,advance:P}})}else 4===u?o.ascender=l.readSVarint():5===u&&(o.descender=l.readSVarint())}function _r(u,o,l){1===u?o.id=l.readVarint():2===u?o.bitmap=l.readBytes():3===u?o.width=l.readVarint():4===u?o.height=l.readVarint():5===u?o.left=l.readSVarint():6===u?o.top=l.readSVarint():7===u&&(o.advance=l.readVarint())}const wl={horizontal:1,vertical:2,horizontalOnly:3};class fm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const p=new fm;return p.scale=o||1,p.fontStack=l,p}static forImage(o){const l=new fm;return l.imageName=o,l}}class mm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const p=new mm;for(let _=0;_<o.sections.length;_++){const f=o.sections[_];f.image?p.addImageSection(f):p.addTextSection(f,l)}return p}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCodePoint(o){return this.text.codePointAt(o)}verticalizePunctuation(o){this.text=function(l,p){let _="";for(let f=0;f<l.length;f++){const y=l.charCodeAt(f+1)||null,T=l.charCodeAt(f-1)||null;_+=!p&&(y&&hp(y)&&!Zg[l[f+1]]||T&&hp(T)&&!Zg[l[f-1]])||!Zg[l[f]]?l[f]:Zg[l[f]]}return _}(this.text,o)}trim(){let o=0;for(let p=0;p<this.text.length&&Jg[this.text.charCodeAt(p)];p++)o++;let l=this.text.length;for(let p=this.text.length-1;p>=0&&p>=o&&Jg[this.text.charCodeAt(p)];p--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const p=new mm;return p.text=this.text.substring(o,l),p.sectionIndex=this.sectionIndex.slice(o,l),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(fm.forText(o.scale,o.fontStack||l));const p=this.sections.length-1;for(let _=0;_<o.text.length;++_)this.sectionIndex.push(p)}addImageSection(o){const l=o.image?o.image.namePrimary:"";if(0===l.length)return void Ki("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(fm.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Ki("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function S0(u,o,l,p,_,f,y,T,E,P,w,I,R,D,M){const L=mm.fromFeature(u,_);I===wl.vertical&&L.verticalizePunctuation(R);let V=[];const j=function(J,ce,we,_e,be,Z){if(!J)return[];const de=[],De=function(it,at,et,It,Xt,vt){let yn=0;for(let ln=0;ln<it.length();ln++){const Kt=it.getSection(ln);yn+=T0(it.getCodePoint(ln),Kt,It,Xt,at,vt)}return yn/Math.max(1,Math.ceil(yn/et))}(J,ce,we,_e,be,Z),Be=J.text.indexOf("\u200b")>=0;let je=0;for(let it=0;it<J.length();it++){const at=J.getSection(it),et=J.getCodePoint(it);if(Jg[et]||(je+=T0(et,at,_e,be,ce,Z)),it<J.length()-1){const It=!((Xe=et)<11904||!(Fn_Bopomofo_Extended(Xe)||Fn_Bopomofo(Xe)||Fn_CJK_Compatibility_Forms(Xe)||Fn_CJK_Compatibility_Ideographs(Xe)||Fn_CJK_Compatibility(Xe)||Fn_CJK_Radicals_Supplement(Xe)||Fn_CJK_Strokes(Xe)||Fn_CJK_Symbols_and_Punctuation(Xe)||Fn_CJK_Unified_Ideographs_Extension_A(Xe)||Fn_CJK_Unified_Ideographs(Xe)||Fn_Enclosed_CJK_Letters_and_Months(Xe)||Fn_Halfwidth_and_Fullwidth_Forms(Xe)||Fn_Hiragana(Xe)||Fn_Ideographic_Description_Characters(Xe)||Fn_Kangxi_Radicals(Xe)||Fn_Katakana_Phonetic_Extensions(Xe)||Fn_Katakana(Xe)||Fn_Vertical_Forms(Xe)||Fn_Yi_Radicals(Xe)||Fn_Yi_Syllables(Xe)));(xE[et]||It||at.imageName)&&de.push(SE(it+1,je,De,de,wE(et,J.getCodePoint(it+1),It&&Be),!1))}}var Xe;return C0(SE(J.length(),je,De,de,0,!0))}(L,P,f,o,p,D),{processBidirectionalText:G,processStyledBidirectionalText:$}=Xa;if(G&&1===L.sections.length){const J=G(L.toString(),j);for(const ce of J){const we=new mm;we.text=ce,we.sections=L.sections;for(let _e=0;_e<ce.length;_e++)we.sectionIndex.push(0);V.push(we)}}else if($){const J=$(L.text,L.sectionIndex,j);for(const ce of J){const we=new mm;we.text=ce[0],we.sectionIndex=ce[1],we.sections=L.sections,V.push(we)}}else V=function(J,ce){const we=[],_e=J.text;let be=0;for(const Z of ce)we.push(J.substring(be,Z)),be=Z;return be<_e.length&&we.push(J.substring(be,_e.length)),we}(L,j);const H=[],Y={positionedLines:H,text:L.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(J,ce,we,_e,be,Z,de,De,Be,je,Xe,it){let at=0,et=0,It=0;const Xt="right"===De?1:"left"===De?0:.5;let vt=!1;for(const gn of be){const Dn=gn.getSections();for(const hi of Dn){if(hi.imageName)continue;const Ti=ce[hi.fontStack];if(Ti&&(vt=void 0!==Ti.ascender&&void 0!==Ti.descender,!vt))break}if(!vt)break}let yn=0;for(const gn of be){gn.trim();const Dn=gn.getMaxScale(),hi=24*(Dn-1),Ti={positionedGlyphs:[],lineOffset:0};J.positionedLines[yn]=Ti;const Ii=Ti.positionedGlyphs;let _i=0;if(!gn.length()){et+=Z,++yn;continue}let Vi=0,Li=0;for(let Fr=0;Fr<gn.length();Fr++){const ri=gn.getSection(Fr),Sr=gn.getSectionIndex(Fr),Tr=gn.getCodePoint(Fr);let ro=ri.scale,Vo=null,Ko=null,jo=null,Lo=24,Xo=0;const as=!(Be===wl.horizontal||!Xe&&!od(Tr)||Xe&&(Jg[Tr]||(ln=Tr,Fn_Arabic(ln)||Fn_Arabic_Supplement(ln)||Fn_Arabic_Extended_A(ln)||Fn_Arabic_Presentation_Forms_A(ln)||Fn_Arabic_Presentation_Forms_B(ln))));if(ri.imageName){const Us=_e[ri.imageName];if(!Us)continue;jo=ri.imageName,J.iconsInText=J.iconsInText||!0,Ko=Us.paddedRect;const dr=Us.displaySize;ro=24*ro/it,Vo={width:dr[0],height:dr[1],left:0,top:-3,advance:as?dr[1]:dr[0],localGlyph:!1},Xo=vt?-Vo.height*ro:24*Dn-17-dr[1]*ro,Lo=Vo.advance;const Qs=(as?dr[0]:dr[1])*ro-24*Dn;Qs>0&&Qs>_i&&(_i=Qs)}else{const Us=we[ri.fontStack];if(!Us)continue;Us[Tr]&&(Ko=Us[Tr]);const dr=ce[ri.fontStack];if(!dr)continue;const Qs=dr.glyphs[Tr];if(!Qs)continue;if(Vo=Qs.metrics,Lo=8203!==Tr?24:0,vt){const Ia=void 0!==dr.ascender?Math.abs(dr.ascender):0,yc=void 0!==dr.descender?Math.abs(dr.descender):0,vc=(Ia+yc)*ro;Vi<vc&&(Vi=vc,Li=(Ia-yc)/2*ro),Xo=-Ia*ro}else Xo=24*(Dn-ro)-17}as?(J.verticalizable=!0,Ii.push({glyph:Tr,imageName:jo,x:at,y:et+Xo,vertical:as,scale:ro,localGlyph:Vo.localGlyph,fontStack:ri.fontStack,sectionIndex:Sr,metrics:Vo,rect:Ko}),at+=Lo*ro+je):(Ii.push({glyph:Tr,imageName:jo,x:at,y:et+Xo,vertical:as,scale:ro,localGlyph:Vo.localGlyph,fontStack:ri.fontStack,sectionIndex:Sr,metrics:Vo,rect:Ko}),at+=Vo.advance*ro+je)}0!==Ii.length&&(It=Math.max(at-je,It),vt?Jo(Ii,Xt,_i,Li,Z*Dn/2):Jo(Ii,Xt,_i,0,Z/2)),at=0;const Jr=Z*Dn+_i;Ti.lineOffset=Math.max(_i,hi),et+=Jr,++yn}var ln;const Kt=et,{horizontalAlign:Gt,verticalAlign:Hn}=oy(de);(function(gn,Dn,hi,Ti,Ii,_i){const Vi=(Dn-hi)*Ii,Li=-_i*Ti;for(const Jr of gn)for(const Fr of Jr.positionedGlyphs)Fr.x+=Vi,Fr.y+=Li})(J.positionedLines,Xt,Gt,Hn,It,Kt),J.top+=-Hn*Kt,J.bottom=J.top+Kt,J.left+=-Gt*It,J.right=J.left+It,J.hasBaseline=vt}(Y,o,l,p,V,y,T,E,I,P,R,M),!function(J){for(const ce of J)if(0!==ce.positionedGlyphs.length)return!1;return!0}(H)&&Y}const Jg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function T0(u,o,l,p,_,f){if(o.imageName){const y=p[o.imageName];return y?y.displaySize[0]*o.scale*24/f+_:0}{const y=l[o.fontStack],T=y&&y.glyphs[u];return T?T.metrics.advance*o.scale+_:0}}function Ww(u,o,l,p){const _=Math.pow(u-o,2);return p?u<o?_/2:2*_:_+Math.abs(l)*l}function wE(u,o,l){let p=0;return 10===u&&(p-=1e4),l&&(p+=150),40!==u&&65288!==u||(p+=50),41!==o&&65289!==o||(p+=50),p}function SE(u,o,l,p,_,f){let y=null,T=Ww(o,l,_,f);for(const E of p){const P=Ww(o-E.x,l,_,f)+E.badness;P<=T&&(y=E,T=P)}return{index:u,x:o,priorBreak:y,badness:T}}function C0(u){return u?C0(u.priorBreak).concat(u.index):[]}function oy(u){let o=.5,l=.5;switch(u){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function Jo(u,o,l,p,_){if(!(o||l||p||_))return;const f=u.length-1,y=u[f],T=(y.x+y.metrics.advance*y.scale)*o;for(let E=0;E<=f;E++)u[E].x-=T,u[E].y+=l+p+_}function TE(u,o,l,p){const{horizontalAlign:_,verticalAlign:f}=oy(p),y=l[0]-u.displaySize[0]*_,T=l[1]-u.displaySize[1]*f;return{imagePrimary:u,imageSecondary:o,top:T,bottom:T+u.displaySize[1],left:y,right:y+u.displaySize[0]}}function sy(u,o,l,p,_,f){const y=u.imagePrimary;let T;if(y.content){const V=y.content,j=y.pixelRatio||1;T=[V[0]/j,V[1]/j,y.displaySize[0]-V[2]/j,y.displaySize[1]-V[3]/j]}const E=o.left*f,P=o.right*f;let w,I,R,D;"width"===l||"both"===l?(D=_[0]+E-p[3],I=_[0]+P+p[1]):(D=_[0]+(E+P-y.displaySize[0])/2,I=D+y.displaySize[0]);const M=o.top*f,L=o.bottom*f;return"height"===l||"both"===l?(w=_[1]+M-p[0],R=_[1]+L+p[2]):(w=_[1]+(M+L-y.displaySize[1])/2,R=w+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:w,right:I,bottom:R,left:D,collisionPadding:T}}class Hc extends Ht{constructor(o,l,p,_,f){super(o,l),this.angle=_,this.z=p,void 0!==f&&(this.segment=f)}clone(){return new Hc(this.x,this.y,this.z,this.angle,this.segment)}}function Xw(u,o,l,p,_){if(void 0===o.segment)return!0;let f=o,y=o.segment+1,T=0;for(;T>-l/2;){if(y--,y<0)return!1;T-=u[y].dist(f),f=u[y]}T+=u[y].dist(u[y+1]),y++;const E=[];let P=0;for(;T<l/2;){const w=u[y],I=u[y+1];if(!I)return!1;let R=u[y-1].angleTo(w)-w.angleTo(I);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:T,angleDelta:R}),P+=R;T-E[0].distance>p;)P-=E.shift().angleDelta;if(P>_)return!1;y++,T+=w.dist(I)}return!0}function CE(u){let o=0;for(let l=0;l<u.length-1;l++)o+=u[l].dist(u[l+1]);return o}function DE(u,o,l){return u?.6*o*l:0}function EE(u,o){return Math.max(u?u.right-u.left:0,o?o.right-o.left:0)}function IE(u,o,l,p,_,f){const y=DE(l,_,f),T=EE(l,p)*f;let E=0;const P=CE(u)/2;for(let w=0;w<u.length-1;w++){const I=u[w],R=u[w+1],D=I.dist(R);if(E+D>P){const M=(P-E)/D,L=ni(I.x,R.x,M),V=ni(I.y,R.y,M),j=new Hc(L,V,0,R.angleTo(I),w);return!y||Xw(u,j,T,y,o)?j:void 0}E+=D}}function Zw(u,o,l,p,_,f,y,T,E){const P=DE(p,f,y),w=EE(p,_),I=w*y,R=0===u[0].x||u[0].x===E||0===u[0].y||u[0].y===E;return o-I<o/4&&(o=I+o/4),ME(u,R?o/2*T%o:(w/2+2*f)*y*T%o,o,P,l,I,R,!1,E)}function ME(u,o,l,p,_,f,y,T,E){const P=f/2,w=CE(u);let I=0,R=o-l,D=[];for(let M=0;M<u.length-1;M++){const L=u[M],V=u[M+1],j=L.dist(V),G=V.angleTo(L);for(;R+l<I+j;){R+=l;const $=(R-I)/j,H=ni(L.x,V.x,$),Y=ni(L.y,V.y,$);if(H>=0&&H<E&&Y>=0&&Y<E&&R-P>=0&&R+P<=w){const J=new Hc(H,Y,0,G,M);p&&!Xw(u,J,f,p,_)||D.push(J)}}I+=j}return T||D.length||y||(D=ME(u,I/2,l,p,_,f,y,!0,E)),D}function Yw(u,o,l,p,_){const f=[];for(let y=0;y<u.length;y++){const T=u[y];let E;for(let P=0;P<T.length-1;P++){let w=T[P],I=T[P+1];w.x<o&&I.x<o||(w.x<o?w=new Ht(o,w.y+(o-w.x)/(I.x-w.x)*(I.y-w.y))._round():I.x<o&&(I=new Ht(o,w.y+(o-w.x)/(I.x-w.x)*(I.y-w.y))._round()),w.y<l&&I.y<l||(w.y<l?w=new Ht(w.x+(l-w.y)/(I.y-w.y)*(I.x-w.x),l)._round():I.y<l&&(I=new Ht(w.x+(l-w.y)/(I.y-w.y)*(I.x-w.x),l)._round()),w.x>=p&&I.x>=p||(w.x>=p?w=new Ht(p,w.y+(p-w.x)/(I.x-w.x)*(I.y-w.y))._round():I.x>=p&&(I=new Ht(p,w.y+(p-w.x)/(I.x-w.x)*(I.y-w.y))._round()),w.y>=_&&I.y>=_||(w.y>=_?w=new Ht(w.x+(_-w.y)/(I.y-w.y)*(I.x-w.x),_)._round():I.y>=_&&(I=new Ht(w.x+(_-w.y)/(I.y-w.y)*(I.x-w.x),_)._round()),E&&w.equals(E[E.length-1])||(E=[w],f.push(E)),E.push(I)))))}}return f}function Fp(u){let o=0,l=0;for(const y of u)o+=y.w*y.h,l=Math.max(l,y.w);u.sort((y,T)=>T.h-y.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let _=0,f=0;for(const y of u)for(let T=p.length-1;T>=0;T--){const E=p[T];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,f=Math.max(f,y.y+y.h),_=Math.max(_,y.x+y.w),y.w===E.w&&y.h===E.h){const P=p.pop();T<p.length&&(p[T]=P)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(p.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:_,h:f,fill:o/(_*f)||0}}Tn(Hc,"Anchor");class ay{constructor(o,{pixelRatio:l,version:p,stretchX:_,stretchY:f,content:y},T){this.paddedRect=o,this.pixelRatio=l,this.stretchX=_,this.stretchY=f,this.content=y,this.version=p,this.padding=T}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class Qg{constructor(o,l,p){const _={},f={};this.haveRenderCallbacks=[];const y=[];this.addImages(o,_,1,y),this.addImages(l,f,2,y);const{w:T,h:E}=Fp(y),P=new ca({width:T||1,height:E||1});for(const w in o){const I=o[w],R=_[w].paddedRect;ca.copy(I.data,P,{x:0,y:0},{x:R.x+1,y:R.y+1},I.data,p,I.sdf)}for(const w in l){const I=l[w],R=f[w].paddedRect;let D=f[w].padding;const M=R.x+D,L=R.y+D,V=I.data.width,j=I.data.height;D=D>1?D-1:D,ca.copy(I.data,P,{x:0,y:0},{x:M,y:L},I.data,p),ca.copy(I.data,P,{x:0,y:j-D},{x:M,y:L-D},{width:V,height:D},p),ca.copy(I.data,P,{x:0,y:0},{x:M,y:L+j},{width:V,height:D},p),ca.copy(I.data,P,{x:V-D,y:0},{x:M-D,y:L},{width:D,height:j},p),ca.copy(I.data,P,{x:0,y:0},{x:M+V,y:L},{width:D,height:j},p),ca.copy(I.data,P,{x:V-D,y:j-D},{x:M-D,y:L-D},{width:D,height:D},p),ca.copy(I.data,P,{x:0,y:j-D},{x:M+V,y:L-D},{width:D,height:D},p),ca.copy(I.data,P,{x:0,y:0},{x:M+V,y:L+j},{width:D,height:D},p),ca.copy(I.data,P,{x:V-D,y:0},{x:M-D,y:L+j},{width:D,height:D},p)}this.image=P,this.iconPositions=_,this.patternPositions=f}addImages(o,l,p,_){for(const f in o){const y=o[f],T={x:0,y:0,w:y.data.width+2*p,h:y.data.height+2*p};_.push(T),l[f]=new ay(T,y,p),y.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(o,l,p){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(_=>o.hasImage(_,p)),o.dispatchRenderCallbacks(this.haveRenderCallbacks,p);for(const _ in o.getUpdatedImages(p))this.patchUpdatedImage(this.iconPositions[_],o.getImage(_,p),l),this.patchUpdatedImage(this.patternPositions[_],o.getImage(_,p),l)}patchUpdatedImage(o,l,p){if(!o||!l||o.version===l.version)return;o.version=l.version;const[_,f]=o.tl;p.update(l.data,{position:{x:_,y:f}})}}Tn(ay,"ImagePosition"),Tn(Qg,"ImageAtlas");const e_=1e20;function D0(u,o,l,p,_,f,y,T,E){for(let P=o;P<o+p;P++)Jw(u,l*f+P,f,_,y,T,E);for(let P=l;P<l+_;P++)Jw(u,P*f+o,1,p,y,T,E)}function Jw(u,o,l,p,_,f,y){f[0]=0,y[0]=-e_,y[1]=e_,_[0]=u[o];for(let T=1,E=0,P=0;T<p;T++){_[T]=u[o+T*l];const w=T*T;do{const I=f[E];P=(_[T]-_[I]+w-I*I)/(T-I)/2}while(P<=y[E]&&--E>-1);E++,f[E]=T,y[E]=P,y[E+1]=e_}for(let T=0,E=0;T<p;T++){for(;y[E+1]<T;)E++;const P=f[E],w=T-P;u[o+T*l]=_[P]+w*w}}const E0={none:0,ideographs:1,all:2};class gm{constructor(o,l,p){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=p,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o,l){this.urls[l]=o}getGlyphs(o,l,p){const _=[],f=this.urls[l]||Me.GLYPHS_URL;for(const y in o)for(const T of o[y])_.push({stack:y,id:T});kr(_,({stack:y,id:T},E)=>{let P=this.entries[y];P||(P=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=P.glyphs[T];if(void 0!==w)return void E(null,{stack:y,id:T,glyph:w});if(w=this._tinySDF(P,y,T),w)return P.glyphs[T]=w,void E(null,{stack:y,id:T,glyph:w});const I=Math.floor(T/256);if(256*I>65535)return Ki("glyphs > 65535 not supported"),void E(null,{stack:y,id:T,glyph:w});if(P.ranges[I])return void E(null,{stack:y,id:T,glyph:w});let R=P.requests[I];R||(R=P.requests[I]=[],gm.loadGlyphRange(y,I,f,this.requestManager,(D,M)=>{if(M){P.ascender=M.ascender,P.descender=M.descender;for(const L in M.glyphs)this._doesCharSupportLocalGlyph(+L)||(P.glyphs[+L]=M.glyphs[+L]);P.ranges[I]=!0}for(const L of R)L(D,M);delete P.requests[I]})),R.push((D,M)=>{D?E(D):M&&E(null,{stack:y,id:T,glyph:M.glyphs[T]||null})})},(y,T)=>{if(y)p(y);else if(T){const E={};for(const{stack:P,id:w,glyph:I}of T)void 0===E[P]&&(E[P]={}),void 0===E[P].glyphs&&(E[P].glyphs={}),E[P].glyphs[w]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},E[P].ascender=this.entries[P].ascender,E[P].descender=this.entries[P].descender;p(null,E)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==E0.none&&(this.localGlyphMode===E0.all?!!this.localFontFamily:!!this.localFontFamily&&(Fn_CJK_Unified_Ideographs(o)||Fn_Hangul_Syllables(o)||Fn_Hiragana(o)||Fn_Katakana(o)||Fn_CJK_Symbols_and_Punctuation(o)||Fn_CJK_Unified_Ideographs_Extension_A(o)||Fn_CJK_Unified_Ideographs_Extension_B(o)||Fn_Osage(o)))}_tinySDF(o,l,p){const _=this.localFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let f=o.tinySDF;if(!f){let L="400";/bold/i.test(l)?L="900":/medium/i.test(l)?L="500":/light/i.test(l)&&(L="200"),f=o.tinySDF=new gm.TinySDF({fontFamily:_,fontWeight:L,fontSize:48,buffer:6,radius:16}),f.fontWeight=L}if(this.localGlyphs[f.fontWeight][p])return this.localGlyphs[f.fontWeight][p];const y=String.fromCodePoint(p),{data:T,width:E,height:P,glyphWidth:w,glyphHeight:I,glyphLeft:R,glyphTop:D,glyphAdvance:M}=f.draw(y);return this.localGlyphs[f.fontWeight][p]={id:p,bitmap:new Vc({width:E,height:P},T),metrics:{width:w/2,height:I/2,left:R/2,top:D/2-27,advance:M/2,localGlyph:!0}}}}gm.loadGlyphRange=function(u,o,l,p,_){const f=256*o,y=f+255,T=p.transformRequest(p.normalizeGlyphsURL(l).replace("{fontstack}",u).replace("{range}",`${f}-${y}`),cu.Glyphs);jd(T,(E,P)=>{if(E)_(E);else if(P){const w={},I=new Yg(P).readFields(yE,{});for(const R of I.glyphs)w[R.id]=R;_(null,{glyphs:w,ascender:I.ascender,descender:I.descender})}})},gm.TinySDF=class{constructor({fontSize:u=24,buffer:o=3,radius:l=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:f="normal",fontStyle:y="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=l;const T=this.size=u+4*o,E=this._createCanvas(T),P=this.ctx=E.getContext("2d",{willReadFrequently:!0});P.font=`${y} ${f} ${u}px ${_}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(u){const o=document.createElement("canvas");return o.width=o.height=u,o}draw(u){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:f}=this.ctx.measureText(u),y=Math.ceil(l),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-_))),E=Math.min(this.size-this.buffer,y+Math.ceil(p)),P=T+2*this.buffer,w=E+2*this.buffer,I=Math.max(P*w,0),R=new Uint8ClampedArray(I),D={data:R,width:P,height:w,glyphWidth:T,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:o};if(0===T||0===E)return D;const{ctx:M,buffer:L,gridInner:V,gridOuter:j}=this;M.clearRect(L,L,T,E),M.fillText(u,L,L+y);const G=M.getImageData(L,L,T,E);j.fill(e_,0,I),V.fill(0,0,I);for(let $=0;$<E;$++)for(let H=0;H<T;H++){const Y=G.data[4*($*T+H)+3]/255;if(0===Y)continue;const J=($+L)*P+H+L;if(1===Y)j[J]=0,V[J]=e_;else{const ce=.5-Y;j[J]=ce>0?ce*ce:0,V[J]=ce<0?ce*ce:0}}D0(j,0,0,P,w,P,this.f,this.v,this.z),D0(V,L,L,T,E,P,this.f,this.v,this.z);for(let $=0;$<I;$++){const H=Math.sqrt(j[$])-Math.sqrt(V[$]);R[$]=Math.round(255-255*(H/this.radius+this.cutoff))}return D}};function I0(u,o,l,p,_=1){const f=[],y=u.imagePrimary,T=y.pixelRatio,E=y.paddedRect.w-2,P=y.paddedRect.h-2,w=(u.right-u.left)*_,I=(u.bottom-u.top)*_,R=y.stretchX||[[0,E]],D=y.stretchY||[[0,P]],M=(de,De)=>de+De[1]-De[0],L=R.reduce(M,0),V=D.reduce(M,0),j=E-L,G=P-V;let $=0,H=L,Y=0,J=V,ce=0,we=j,_e=0,be=G;if(y.content&&p){const de=y.content;$=ly(R,0,de[0]),Y=ly(D,0,de[1]),H=ly(R,de[0],de[2]),J=ly(D,de[1],de[3]),ce=de[0]-$,_e=de[1]-Y,we=de[2]-de[0]-H,be=de[3]-de[1]-J}const Z=(de,De,Be,je)=>{const Xe=t_(de.stretch-$,H,w,u.left*_),it=_m(de.fixed-ce,we,de.stretch,L),at=t_(De.stretch-Y,J,I,u.top*_),et=_m(De.fixed-_e,be,De.stretch,V),It=t_(Be.stretch-$,H,w,u.left*_),Xt=_m(Be.fixed-ce,we,Be.stretch,L),vt=t_(je.stretch-Y,J,I,u.top*_),yn=_m(je.fixed-_e,be,je.stretch,V),ln=new Ht(Xe,at),Kt=new Ht(It,at),Gt=new Ht(It,vt),Hn=new Ht(Xe,vt),gn=new Ht(it/T,et/T),Dn=new Ht(Xt/T,yn/T),hi=o*Math.PI/180;if(hi){const Jr=Math.sin(hi),Fr=Math.cos(hi),ri=[Fr,-Jr,Jr,Fr];ln._matMult(ri),Kt._matMult(ri),Hn._matMult(ri),Gt._matMult(ri)}const Ti=de.stretch+de.fixed,Ii=Be.stretch+Be.fixed,_i=De.stretch+De.fixed,Vi=je.stretch+je.fixed,Li=u.imageSecondary;return{tl:ln,tr:Kt,bl:Hn,br:Gt,texPrimary:{x:y.paddedRect.x+1+Ti,y:y.paddedRect.y+1+_i,w:Ii-Ti,h:Vi-_i},texSecondary:Li?{x:Li.paddedRect.x+1+Ti,y:Li.paddedRect.y+1+_i,w:Ii-Ti,h:Vi-_i}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gn,pixelOffsetBR:Dn,minFontScaleX:we/T/w,minFontScaleY:be/T/I,isSDF:l}};if(p&&(y.stretchX||y.stretchY)){const de=M0(R,j,L),De=M0(D,G,V);for(let Be=0;Be<de.length-1;Be++){const je=de[Be],Xe=de[Be+1];for(let it=0;it<De.length-1;it++)f.push(Z(je,De[it],Xe,De[it+1]))}}else f.push(Z({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:P+1}));return f}function ly(u,o,l){let p=0;for(const _ of u)p+=Math.max(o,Math.min(l,_[1]))-Math.max(o,Math.min(l,_[0]));return p}function M0(u,o,l){const p=[{fixed:-1,stretch:0}];for(const[_,f]of u){const y=p[p.length-1];p.push({fixed:_-y.stretch,stretch:y.stretch}),p.push({fixed:_-y.stretch,stretch:y.stretch+(f-_)})}return p.push({fixed:o+1,stretch:l}),p}function t_(u,o,l,p){return u/o*l+p}function _m(u,o,l,p){return u-o*l/p}function G2(u,o,l,p){const _=o+u.positionedLines[p].lineOffset;return 0===p?l+_/2:l+(_+(o+u.positionedLines[p-1].lineOffset))/2}function A0(u,o=1,l=!1){let p=1/0,_=1/0,f=-1/0,y=-1/0;const T=u[0];for(let D=0;D<T.length;D++){const M=T[D];(!D||M.x<p)&&(p=M.x),(!D||M.y<_)&&(_=M.y),(!D||M.x>f)&&(f=M.x),(!D||M.y>y)&&(y=M.y)}const E=Math.min(f-p,y-_);let P=E/2;const w=new Ku([],AE);if(0===E)return new Ht(p,_);for(let D=p;D<f;D+=E)for(let M=_;M<y;M+=E)w.push(new n_(D+P,M+P,P,u));let I=function(D){let M=0,L=0,V=0;const j=D[0];for(let G=0,$=j.length,H=$-1;G<$;H=G++){const Y=j[G],J=j[H],ce=Y.x*J.y-J.x*Y.y;L+=(Y.x+J.x)*ce,V+=(Y.y+J.y)*ce,M+=3*ce}return new n_(L/M,V/M,0,D)}(u),R=w.length;for(;w.length;){const D=w.pop();(D.d>I.d||!I.d)&&(I=D,l&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,R)),D.max-I.d<=o||(P=D.h/2,w.push(new n_(D.p.x-P,D.p.y-P,P,u)),w.push(new n_(D.p.x+P,D.p.y-P,P,u)),w.push(new n_(D.p.x-P,D.p.y+P,P,u)),w.push(new n_(D.p.x+P,D.p.y+P,P,u)),R+=4)}return l&&(console.log(`num probes: ${R}`),console.log(`best distance: ${I.d}`)),I.p}function AE(u,o){return o.max-u.max}class n_{constructor(o,l,p,_){this.p=new Ht(o,l),this.h=p,this.d=function(f,y){let T=!1,E=1/0;for(let P=0;P<y.length;P++){const w=y[P];for(let I=0,R=w.length,D=R-1;I<R;D=I++){const M=w[I],L=w[D];M.y>f.y!=L.y>f.y&&f.x<(L.x-M.x)*(f.y-M.y)/(L.y-M.y)+M.x&&(T=!T),E=Math.min(E,Yn(f,M,L))}}return(T?1:-1)*Math.sqrt(E)}(this.p,_),this.max=this.d+this.h*Math.SQRT2}}const ue=Number.POSITIVE_INFINITY,bm=Math.sqrt(2);function R0(u,[o,l]){let p=0,_=0;if(l===ue){o<0&&(o=0);const f=o/bm;switch(u){case"top-right":case"top-left":_=f-7;break;case"bottom-right":case"bottom-left":_=7-f;break;case"bottom":_=7-o;break;case"top":_=o-7}switch(u){case"top-right":case"bottom-right":p=-f;break;case"top-left":case"bottom-left":p=f;break;case"left":p=o;break;case"right":p=-o}}else{switch(o=Math.abs(o),l=Math.abs(l),u){case"top-right":case"top-left":case"top":_=l-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-l}switch(u){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}}return[p,_]}function ym(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gc(u,o,l,p,_,f,y,T,E,P,w,I,R,D,M){let L=f.textMaxSize.evaluate(o,{},I);void 0===L?L=y*f.textScaleFactor:L*=f.textScaleFactor;const V=u.layers[0].layout,j=V.get("icon-offset").evaluate(o,{},I),G=Ru(l.horizontal)||l.vertical,$="globe"===R.name,Y=y*f.textScaleFactor/24,J=u.tilePixelRatio*L/24,ce=(je=u.overscaling,u.zoom>18&&je>2&&(je>>=1),Math.max(an/(512*je),1)*V.get("symbol-spacing")),we=V.get("text-padding")*u.tilePixelRatio,_e=V.get("icon-padding")*u.tilePixelRatio,be=pi(V.get("text-max-angle")),Z="map"===V.get("text-rotation-alignment")&&"point"!==V.get("symbol-placement"),de="map"===V.get("icon-rotation-alignment")&&"point"!==V.get("symbol-placement"),De=V.get("symbol-placement"),Be=ce/2;var je;const Xe=V.get("icon-text-fit").evaluate(o,{},I),it=V.get("icon-text-fit-padding").evaluate(o,{},I),at="none"!==Xe;let et;!1===u.hasAnyIconTextFit&&at&&(u.hasAnyIconTextFit=!0),p&&at&&(u.allowVerticalPlacement&&l.vertical&&(et=sy(p,l.vertical,Xe,it,j,Y)),G&&(p=sy(p,G,Xe,it,j,Y)));const It=(Xt,vt,yn)=>{if(vt.x<0||vt.x>=an||vt.y<0||vt.y>=an)return;let ln=null;if($){const{x:Kt,y:Gt,z:Hn}=R.projectTilePoint(vt.x,vt.y,yn);ln={anchor:new Hc(Kt,Gt,Hn,0,void 0),up:R.upVector(yn,vt.x,vt.y)}}!function(Kt,Gt,Hn,gn,Dn,hi,Ti,Ii,_i,Vi,Li,Jr,Fr,ri,Sr,Tr,ro,Vo,Ko,jo,Lo,Xo,as,Us,dr,Qs,Ia){const yc=Kt.addToLineVertexArray(Gt,gn);let vc,xc,Zp,Os,Vy,gx,_x,hI=0,oi=0,PS=0,kS=0,bx=-1,Mh=-1;const Fu={};let b_=Cr("");const Nu=Hn?Hn.anchor:Gt,fs="none"!==_i.layout.get("icon-text-fit").evaluate(Lo,{},dr);let LS=0,jy=0;if(void 0===_i._unevaluatedLayout.getValue("text-radial-offset")?[LS,jy]=_i.layout.get("text-offset").evaluate(Lo,{},dr).map(tl=>24*tl):(LS=24*_i.layout.get("text-radial-offset").evaluate(Lo,{},dr),jy=ue),Kt.allowVerticalPlacement&&Dn.vertical){const tl=Dn.vertical;if(Sr)gx=uy(tl),Ii&&(_x=uy(Ii));else{const nl=_i.layout.get("text-rotate").evaluate(Lo,{},dr)+90;Zp=xm(Vi,Nu,Gt,Li,Jr,Fr,tl,ri,nl,Tr),Ii&&(Os=xm(Vi,Nu,Gt,Li,Jr,Fr,Ii,Vo,nl))}}if(hi){const tl=_i.layout.get("icon-rotate").evaluate(Lo,{},dr),nl=I0(hi,tl,as,fs,Xo.iconScaleFactor),Yp=Ii?I0(Ii,tl,as,fs,Xo.iconScaleFactor):void 0;xc=xm(Vi,Nu,Gt,Li,Jr,Fr,hi,Vo,tl),hI=4*nl.length;const FS=Kt.iconSizeData;let Jp=null;"source"===FS.kind?(Jp=[Au*_i.layout.get("icon-size").evaluate(Lo,{},dr)*Xo.iconScaleFactor],Jp[0]>wh&&Ki(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${vm}. Reduce your "icon-size".`)):"composite"===FS.kind&&(Jp=[Au*Xo.compositeIconSizes[0].evaluate(Lo,{},dr)*Xo.iconScaleFactor,Au*Xo.compositeIconSizes[1].evaluate(Lo,{},dr)*Xo.iconScaleFactor],(Jp[0]>wh||Jp[1]>wh)&&Ki(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${vm}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,nl,Jp,jo,Ko,Lo,!1,Hn,Gt,yc.lineStartIndex,yc.lineLength,-1,Us,dr,Qs,Ia),bx=Kt.icon.placedSymbolArray.length-1,Yp&&(oi=4*Yp.length,Kt.addSymbols(Kt.icon,Yp,Jp,jo,Ko,Lo,wl.vertical,Hn,Gt,yc.lineStartIndex,yc.lineLength,-1,Us,dr,Qs,Ia),Mh=Kt.icon.placedSymbolArray.length-1)}for(const tl in Dn.horizontal){const nl=Dn.horizontal[tl];vc||(b_=Cr(nl.text),Sr?Vy=uy(nl):vc=xm(Vi,Nu,Gt,Li,Jr,Fr,nl,ri,_i.layout.get("text-rotate").evaluate(Lo,{},dr),Tr));const Yp=1===nl.positionedLines.length;if(PS+=cy(Kt,Hn,Gt,nl,Ti,_i,Sr,Lo,Tr,yc,Dn.vertical?wl.horizontal:wl.horizontalOnly,Yp?Object.keys(Dn.horizontal):[tl],Fu,bx,Xo,Us,dr,Qs),Yp)break}Dn.vertical&&(kS+=cy(Kt,Hn,Gt,Dn.vertical,Ti,_i,Sr,Lo,Tr,yc,wl.vertical,["vertical"],Fu,Mh,Xo,Us,dr,Qs));let Ed=-1;const yx=(tl,nl)=>tl?Math.max(tl,nl):nl;Ed=yx(Vy,Ed),Ed=yx(gx,Ed),Ed=yx(_x,Ed);const OS=Ed>-1?1:0;Kt.glyphOffsetArray.length>=65535&&Ki("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Lo.sortKey&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,Lo.sortKey),Kt.symbolInstances.emplaceBack(Gt.x,Gt.y,Nu.x,Nu.y,Nu.z,Fu.right>=0?Fu.right:-1,Fu.center>=0?Fu.center:-1,Fu.left>=0?Fu.left:-1,Fu.vertical>=0?Fu.vertical:-1,bx,Mh,b_,void 0!==vc?vc:Kt.collisionBoxArray.length,void 0!==vc?vc+1:Kt.collisionBoxArray.length,void 0!==Zp?Zp:Kt.collisionBoxArray.length,void 0!==Zp?Zp+1:Kt.collisionBoxArray.length,void 0!==xc?xc:Kt.collisionBoxArray.length,void 0!==xc?xc+1:Kt.collisionBoxArray.length,Os||Kt.collisionBoxArray.length,Os?Os+1:Kt.collisionBoxArray.length,Li,PS,kS,hI,oi,OS,0,LS,jy,Ed,0,fs?1:0)}(u,vt,ln,Xt,l,p,_,et,u.layers[0],u.collisionBoxArray,o.index,o.sourceLayerIndex,u.index,we,Z,E,0,_e,de,j,o,f,P,w,I,D,M)};if("line"===De)for(const Xt of Yw(o.geometry,0,0,an,an)){const vt=Zw(Xt,ce,be,l.vertical||G,p,24,J,u.overscaling,an);for(const yn of vt)G&&P0(u,G.text,Be,yn)||It(Xt,yn,I)}else if("line-center"===De){for(const Xt of o.geometry)if(Xt.length>1){const vt=IE(Xt,be,l.vertical||G,p,24,J);vt&&It(Xt,vt,I)}}else if("Polygon"===o.type)for(const Xt of jb(o.geometry,0)){const vt=A0(Xt,16);It(Xt[0],new Hc(vt.x,vt.y,0,0,void 0),I)}else if("LineString"===o.type)for(const Xt of o.geometry)It(Xt,new Hc(Xt[0].x,Xt[0].y,0,0,void 0),I);else if("Point"===o.type)for(const Xt of o.geometry)for(const vt of Xt)It([vt],new Hc(vt.x,vt.y,0,0,void 0),I)}const vm=255,wh=vm*Au;function cy(u,o,l,p,_,f,y,T,E,P,w,I,R,D,M,L,V,j){const G=function(Y,J,ce,we,_e,be,Z,de){const De=[];if(0===J.positionedLines.length)return De;const Be=we.layout.get("text-rotate").evaluate(be,{})*Math.PI/180,je=function(It){const Xt=It[0],vt=It[1],yn=Xt*vt;return yn>0?[Xt,-vt]:yn<0?[-Xt,vt]:0===Xt?[vt,Xt]:[vt,-Xt]}(ce);let Xe=Math.abs(J.top-J.bottom);for(const It of J.positionedLines)Xe-=It.lineOffset;const it=J.positionedLines.length,at=Xe/it;let et=J.top-ce[1];for(let It=0;It<it;++It){const Xt=J.positionedLines[It];et=G2(J,at,et,It);for(const vt of Xt.positionedGlyphs){if(!vt.rect)continue;const yn=vt.rect||{};let ln=4,Kt=!0,Gt=1,Hn=0;if(vt.imageName){const jo=Z[vt.imageName];if(!jo)continue;if(jo.sdf){Ki("SDF images are not supported in formatted text and will be ignored.");continue}Kt=!1,Gt=jo.pixelRatio,ln=1/Gt}const gn=(_e||de)&&vt.vertical,Dn=vt.metrics.advance*vt.scale/2,hi=vt.metrics,Ti=vt.rect;if(null===Ti)continue;de&&J.verticalizable&&(Hn=vt.imageName?Dn-vt.metrics.width*vt.scale/2:0);const Ii=_e?[vt.x+Dn,vt.y]:[0,0];let _i=[0,0],Vi=[0,0],Li=!1;_e||(gn?(Vi=[vt.x+Dn+je[0],vt.y+je[1]-Hn],Li=!0):_i=[vt.x+Dn+ce[0],vt.y+ce[1]-Hn]);const Jr=Ti.w*vt.scale/(Gt*(vt.localGlyph?2:1)),Fr=Ti.h*vt.scale/(Gt*(vt.localGlyph?2:1));let ri,Sr,Tr,ro;if(gn){const jo=vt.y-et,Lo=new Ht(-Dn,Dn-jo),Xo=-Math.PI/2,as=new Ht(...Vi);ri=new Ht(-Dn+_i[0],_i[1]),ri._rotateAround(Xo,Lo)._add(as),ri.x+=-jo+Dn,ri.y-=(hi.left-ln)*vt.scale;const Us=vt.imageName?hi.advance*vt.scale:24*vt.scale,dr=String.fromCodePoint(vt.glyph);_E(dr)?ri.x+=(1-ln)*vt.scale:Uc(dr)?ri.x+=Us-hi.height*vt.scale+(-ln-1)*vt.scale:ri.x+=vt.imageName||hi.width+2*ln===Ti.w&&hi.height+2*ln===Ti.h?(Us-Fr)/2:(Us-(hi.height+2*ln)*vt.scale)/2,Sr=new Ht(ri.x,ri.y-Jr),Tr=new Ht(ri.x+Fr,ri.y),ro=new Ht(ri.x+Fr,ri.y-Jr)}else{const jo=(hi.left-ln)*vt.scale-Dn+_i[0],Lo=(-hi.top-ln)*vt.scale+_i[1],Xo=jo+Jr,as=Lo+Fr;ri=new Ht(jo,Lo),Sr=new Ht(Xo,Lo),Tr=new Ht(jo,as),ro=new Ht(Xo,as)}if(Be){let jo;jo=_e?new Ht(0,0):Li?new Ht(je[0],je[1]):new Ht(ce[0],ce[1]),ri._rotateAround(Be,jo),Sr._rotateAround(Be,jo),Tr._rotateAround(Be,jo),ro._rotateAround(Be,jo)}const Vo=new Ht(0,0),Ko=new Ht(0,0);De.push({tl:ri,tr:Sr,bl:Tr,br:ro,texPrimary:yn,texSecondary:void 0,writingMode:J.writingMode,glyphOffset:Ii,sectionIndex:vt.sectionIndex,isSDF:Kt,pixelOffsetTL:Vo,pixelOffsetBR:Ko,minFontScaleX:0,minFontScaleY:0})}}return De}(0,p,E,f,y,T,_,u.allowVerticalPlacement),$=u.textSizeData;let H=null;"source"===$.kind?(H=[Au*f.layout.get("text-size").evaluate(T,{},V)*M.textScaleFactor],H[0]>wh&&Ki(`${u.layerIds[0]}: Value for "text-size" is >= ${vm}. Reduce your "text-size".`)):"composite"===$.kind&&(H=[Au*M.compositeTextSizes[0].evaluate(T,{},V)*M.textScaleFactor,Au*M.compositeTextSizes[1].evaluate(T,{},V)*M.textScaleFactor],(H[0]>wh||H[1]>wh)&&Ki(`${u.layerIds[0]}: Value for "text-size" is >= ${vm}. Reduce your "text-size".`)),u.addSymbols(u.text,G,H,E,y,T,w,o,l,P.lineStartIndex,P.lineLength,D,L,V,j,!1);for(const Y of I)R[Y]=u.text.placedSymbolArray.length-1;return 4*G.length}function Ru(u){for(const o in u)return u[o];return null}function xm(u,o,l,p,_,f,y,T,E,P){let w=y.top,I=y.bottom,R=y.left,D=y.right;const M=y.collisionPadding;if(M&&(R-=M[0],w-=M[1],D+=M[2],I+=M[3]),E){const L=new Ht(R,w),V=new Ht(D,w),j=new Ht(R,I),G=new Ht(D,I),$=pi(E);let H=new Ht(0,0);P&&(H=new Ht(P[0],P[1])),L._rotateAround($,H),V._rotateAround($,H),j._rotateAround($,H),G._rotateAround($,H),R=Math.min(L.x,V.x,j.x,G.x),D=Math.max(L.x,V.x,j.x,G.x),w=Math.min(L.y,V.y,j.y,G.y),I=Math.max(L.y,V.y,j.y,G.y)}return u.emplaceBack(o.x,o.y,o.z,l.x,l.y,R,w,D,I,T,p,_,f),u.length-1}function uy(u){u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const o=u.bottom-u.top;return o>0?Math.max(10,o):null}function P0(u,o,l,p){const _=u.compareText;if(o in _){const f=_[o];for(let y=f.length-1;y>=0;y--)if(p.dist(f[y])<l)return!0}else _[o]=[];return _[o].push(p),!1}function RE(u,o){const l=u.fovAboveCenter,p=u.elevation?u.elevation.getMinElevationBelowMSL()*o:0,_=(u._camera.position[2]*u.worldSize-p)/Math.cos(u._pitch),f=Math.sin(l)*_/Math.sin(Math.max(Math.PI/2-u._pitch-l,.01));let y=Math.sin(u._pitch)*f+_;const T=_*(1/u._horizonShift);return u.elevation&&0!==u.elevation.exaggeration()||(y*=1+Math.max(u.zoom-17,0)),Math.min(1.01*y,T)}function wm(u,o){if(!o.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:o};const l=Math.pow(2,-u.z),p=u.x*l,_=(u.x+1)*l,f=u.y*l,y=(u.y+1)*l,T=ge(p),E=ge(_),P=xe(f),w=xe(y),I=o.project(T,P),R=o.project(E,P),D=o.project(E,w),M=o.project(T,w);let L=Math.min(I.x,R.x,D.x,M.x),V=Math.min(I.y,R.y,D.y,M.y),j=Math.max(I.x,R.x,D.x,M.x),G=Math.max(I.y,R.y,D.y,M.y);const $=l/16;function H(J,ce,we,_e,be,Z){const de=(we+be)/2,De=(_e+Z)/2,Be=o.project(ge(de),xe(De)),je=Math.max(0,L-Be.x,V-Be.y,Be.x-j,Be.y-G);L=Math.min(L,Be.x),j=Math.max(j,Be.x),V=Math.min(V,Be.y),G=Math.max(G,Be.y),je>$&&(H(J,Be,we,_e,de,De),H(Be,ce,de,De,be,Z))}H(I,R,p,f,_,f),H(R,D,_,f,_,y),H(D,M,_,y,p,y),H(M,I,p,y,p,f),L-=$,V-=$,j+=$,G+=$;const Y=1/Math.max(j-L,G-V);return{scale:Y,x:L*Y,y:V*Y,x2:j*Y,y2:G*Y,projection:o}}function PE(u,{x:o,y:l},p=0){return new Ht(((o-p)*u.scale-u.x)*an,(l*u.scale-u.y)*an)}const dy=Q.mat4.identity(new Float32Array(16));class $c{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new N(0,0)}projectTilePoint(o,l,p){return{x:o,y:l,z:0}}locationPoint(o,l,p=!0){return o._coordinatePoint(o.locationCoordinate(l),p)}pixelsPerMeter(o,l){return ie(1,o)*l}pixelSpaceConversion(o,l,p){return 1}farthestPixelDistance(o){return RE(o,o.pixelsPerMeter)}pointCoordinate(o,l,p,_){const f=o.horizonLineFromTop(!1),y=new Ht(l,Math.max(f,p));return o.rayIntersectionCoordinate(o.pointRayIntersection(y,_))}pointCoordinate3D(o,l,p){const _=new Ht(l,p);if(o.elevation)return o.elevation.pointCoordinate(_);{const f=this.pointCoordinate(o,_.x,_.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(o,l){if(o.elevation&&o.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(o,l.x,l.y);const p=o.horizonLineFromTop();return l.y<p}createInversionMatrix(o,l){return dy}createTileMatrix(o,l,p){let _,f,y;const T=p.canonical,E=Q.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=wm(T,this);_=1,f=P.x+p.wrap*P.scale,y=P.y,Q.mat4.scale(E,E,[_/P.scale,_/P.scale,o.pixelsPerMeter/l])}else _=l/o.zoomScale(T.z),f=(T.x+Math.pow(2,T.z)*p.wrap)*_,y=T.y*_;return Q.mat4.translate(E,E,[f,y,0]),Q.mat4.scale(E,E,[_/an,_/an,1]),E}upVector(o,l,p){return[0,0,1]}upVectorScale(o,l,p){return{metersToTile:1}}}class k0 extends $c{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,p]=this.parallels=o.parallels||[29.5,45.5],_=Math.sin(pi(l));this.n=(_+Math.sin(pi(p)))/2,this.c=1+_*(2*this.n-_),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:p,c:_,r0:f}=this,y=pi(o-this.center[0]),T=pi(l),E=Math.sqrt(_-2*p*Math.sin(T))/p;return{x:E*Math.sin(y*p),y:E*Math.cos(y*p)-f,z:0}}unproject(o,l){const{n:p,c:_,r0:f}=this,y=f+l;let T=Math.atan2(o,Math.abs(y))*Math.sign(y);y*p<0&&(T-=Math.PI*Math.sign(o)*Math.sign(y));const E=pi(this.center[0])*p;T=hr(T,-Math.PI-E,Math.PI-E);const P=Bt(Oe(T/p)+this.center[0],-180,180),w=Math.asin(Bt((_-(o*o+y*y)*p*p)/(2*p),-1,1)),I=Bt(Oe(w),-Ee,Ee);return new N(P,I)}}const Np=1.340264,Bp=-.081106,hy=893e-6,i_=.003796,py=Math.sqrt(3)/2;class kE extends $c{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const p=Math.asin(py*Math.sin(l)),_=p*p,f=_*_*_;return{x:.5*(o*Math.cos(p)/(py*(Np+3*Bp*_+f*(7*hy+9*i_*_)))/Math.PI+.5),y:1-.5*(p*(Np+Bp*_+f*(hy+i_*_))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let p=l=(2*(1-l)-1)*Math.PI,_=p*p,f=_*_*_;for(let w,I,R,D=0;D<12&&(I=p*(Np+Bp*_+f*(hy+i_*_))-l,R=Np+3*Bp*_+f*(7*hy+9*i_*_),w=I/R,p=Bt(p-w,-Math.PI/3,Math.PI/3),_=p*p,f=_*_*_,!(Math.abs(w)<1e-12));++D);const y=py*o*(Np+3*Bp*_+f*(7*hy+9*i_*_))/Math.cos(p),T=Math.asin(Math.sin(p)/py),E=Bt(180*y/Math.PI,-180,180),P=Bt(180*T/Math.PI,-Ee,Ee);return new N(E,P)}}class LE extends $c{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const p=360*(o-.5),_=Bt(360*(.5-l),-Ee,Ee);return new N(p,_)}}const zp=Math.PI/2;function L0(u){return Math.tan((zp+u)/2)}class OE extends $c{constructor(o){super(o),this.center=o.center||[0,30];const[l,p]=this.parallels=o.parallels||[30,30];let _=pi(l),f=pi(p);this.southernCenter=_+f<0,this.southernCenter&&(_=-_,f=-f);const y=Math.cos(_),T=L0(_);this.n=_===f?Math.sin(_):Math.log(y/Math.cos(f))/Math.log(L0(f)/T),this.f=y*Math.pow(L0(_),this.n)/this.n}project(o,l){l=pi(l),this.southernCenter&&(l=-l),o=pi(o-this.center[0]);const p=1e-6,{n:_,f}=this;f>0?l<-zp+p&&(l=-zp+p):l>zp-p&&(l=zp-p);const y=f/Math.pow(L0(l),_);let T=y*Math.sin(_*o),E=f-y*Math.cos(_*o);return T=.5*(T/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:T,y:this.southernCenter?E:1-E,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:p,f:_}=this,f=_-l,y=Math.sign(f),T=Math.sign(p)*Math.sqrt(o*o+f*f);let E=Math.atan2(o,Math.abs(f))*y;f*p<0&&(E-=Math.PI*Math.sign(o)*y);const P=Bt(Oe(E/p)+this.center[0],-180,180),w=Bt(Oe(2*Math.atan(Math.pow(_/T,1/p))-zp),-Ee,Ee);return new N(P,this.southernCenter?-w:w)}}class FE extends $c{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:K(o),y:re(l),z:0}}unproject(o,l){const p=ge(o),_=xe(l);return new N(p,_)}}const O0=pi(Ee);class Kw extends $c{project(o,l){const p=(l=pi(l))*l,_=p*p;return{x:.5*((o=pi(o))*(.8707-.131979*p+_*(_*(.003971*p-.001529*_)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+p*(.015085+_*(.028874*p-.044475-.005916*_)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let p=l=(2*(1-l)-1)*Math.PI,_=25,f=0,y=p*p;do{y=p*p;const P=y*y;f=(p*(1.007226+y*(.015085+P*(.028874*y-.044475-.005916*P)))-l)/(1.007226+y*(.045255+P*(.259866*y-.311325-.005916*11*P))),p=Bt(p-f,-O0,O0)}while(Math.abs(f)>1e-6&&--_>0);y=p*p;const T=Bt(Oe(o/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=Oe(p);return new N(T,E)}}const Qw=pi(Ee);class F0 extends $c{project(o,l){l=pi(l),o=pi(o);const p=Math.cos(l),_=2/Math.PI,f=Math.acos(p*Math.cos(o/2)),y=Math.sin(f)/f,T=.5*(o*_+2*p*Math.sin(o/2)/y)||0,E=.5*(l+Math.sin(l)/y)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(o,l){let p=o=(2*o-.5)*Math.PI,_=l=(2*(1-l)-1)*Math.PI,f=25;const y=1e-6;let T=0,E=0;do{const P=Math.cos(_),w=Math.sin(_),I=2*w*P,R=w*w,D=P*P,M=Math.cos(p/2),L=Math.sin(p/2),V=2*M*L,j=L*L,G=1-D*M*M,$=G?1/G:0,H=G?Math.acos(P*M)*Math.sqrt(1/G):0,Y=.5*(2*H*P*L+2*p/Math.PI)-o,J=.5*(H*w+_)-l,ce=.5*$*(D*j+H*P*M*R)+1/Math.PI,we=$*(V*I/4-H*w*L),_e=.125*$*(I*L-H*w*D*V),be=.5*$*(R*M+H*j*P)+.5,Z=we*_e-be*ce;T=(J*we-Y*be)/Z,E=(Y*_e-J*ce)/Z,p=Bt(p-T,-Math.PI,Math.PI),_=Bt(_-E,-Qw,Qw)}while((Math.abs(T)>y||Math.abs(E)>y)&&--f>0);return new N(Oe(p),Oe(_))}}class NE extends $c{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(pi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:p,cosPhi:_}=this;return{x:pi(o)*_*p+.5,y:-Math.sin(pi(l))/_*p+.5,z:0}}unproject(o,l){const{scale:p,cosPhi:_}=this,f=-(l-.5)/p,y=Bt(Oe((o-.5)/p)/_,-180,180),T=Math.asin(Bt(f*_,-1,1)),E=Bt(Oe(T),-Ee,Ee);return new N(y,E)}}class $2 extends FE{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,l,p){const _=Lg(o,l,p),f=kb(fc(p));return Q.vec3.transformMat4(_,_,f),{x:_[0],y:_[1],z:_[2]}}locationPoint(o,l){const p=k(l.lat,l.lng),_=Q.vec3.normalize([],p),f=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude,y=ie(1,0)*an*f;Q.vec3.scaleAndAdd(p,p,_,y);const T=Q.mat4.identity(new Float64Array(16));return Q.mat4.multiply(T,o.pixelMatrix,o.globeMatrix),Q.vec3.transformMat4(p,p,T),new Ht(p[0],p[1])}pixelsPerMeter(o,l){return ie(1,0)*l}pixelSpaceConversion(o,l,p){const _=ie(1,o)*l,f=ni(ie(1,45)*l,_,p);return this.pixelsPerMeter(o,l)/f}createTileMatrix(o,l,p){const _=$v(fc(p.canonical));return Q.mat4.multiply(new Float64Array(16),o.globeMatrix,_)}createInversionMatrix(o,l){const{center:p}=o,_=kb(fc(l));return Q.mat4.rotateY(_,_,pi(p.lng)),Q.mat4.rotateX(_,_,pi(p.lat)),Q.mat4.scale(_,_,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(_)}pointCoordinate(o,l,p,_){return mh(o,l,p,!0)||new He(0,0)}pointCoordinate3D(o,l,p){const _=this.pointCoordinate(o,l,p,0);return[_.x,_.y,_.z]}isPointAboveHorizon(o,l){return!mh(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(_,f){const y=_.cameraToCenterDistance,T=_._centerAltitude*f,E=_._camera,P=_._camera.forward(),w=Q.vec3.add([],Q.vec3.scale([],P,-y),[0,0,T]),I=_.worldSize/(2*Math.PI),R=[0,0,-I],D=_.width/_.height,M=Math.tan(_.fovAboveCenter),L=Q.vec3.scale([],E.up(),M),V=Q.vec3.scale([],E.right(),M*D),j=Q.vec3.normalize([],Q.vec3.add([],Q.vec3.add([],P,L),V)),G=[];let $;if(new Va(w,j).closestPointOnSphere(R,I,G)){const H=Q.vec3.add([],G,R),Y=Q.vec3.sub([],H,w);$=Math.cos(_.fovAboveCenter)*Q.vec3.length(Y)}else{const H=Q.vec3.sub([],w,R),Y=Q.vec3.sub([],R,w);Q.vec3.normalize(Y,Y);const J=Q.vec3.length(H)-I;$=Math.sqrt(J*(J+2*I));const ce=Math.acos($/(I+J))-Math.acos(Q.vec3.dot(P,Y));$*=Math.cos(ce)}return 1.01*$}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),p=yd(o.zoom);if(p>0){const _=RE(o,ie(1,o.center.lat)*o.worldSize),f=o.worldSize/(2*Math.PI),y=Math.max(o.width,o.height)/o.worldSize*Math.PI;return ni(l,_+f*(1-Math.cos(y)),Math.pow(p,10))}return l}upVector(o,l,p){return Lg(l,p,o,1)}upVectorScale(o){return{metersToTile:fh(am(fc(o)))}}}function BE(u){const o=u.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(u.name){case"mercator":return new FE(u);case"equirectangular":return new LE(u);case"naturalEarth":return new Kw(u);case"equalEarth":return new kE(u);case"winkelTripel":return new F0(u);case"albers":return l?new NE(u):new k0(u);case"lambertConformalConic":return l?new NE(u):new OE(u);case"globe":return new $2(u)}throw new Error(`Invalid projection name: ${u.name}`)}const W2=um.VectorTileFeature.types,X2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function N0(u,o,l,p,_,f,y,T,E,P,w,I,R){const D=T?Math.min(wh,Math.round(T[0])):0,M=T?Math.min(wh,Math.round(T[1])):0;u.emplaceBack(o,l,Math.round(32*p),Math.round(32*_),f,y,(D<<1)+(E?1:0),M,16*P,16*w,256*I,256*R)}function B0(u,o,l){u.emplaceBack(o,l)}function z0(u,o,l,p,_,f,y){u.emplaceBack(o,l,p,_,f,y)}function V0(u,o,l,p,_){u.emplaceBack(o,l,p,_),u.emplaceBack(o,l,p,_),u.emplaceBack(o,l,p,_),u.emplaceBack(o,l,p,_)}function Z2(u){for(const o of u.sections)if(_b(o.text))return!0;return!1}class Pu{constructor(o){this.layoutVertexArray=new pd,this.indexArray=new Xr,this.programConfigurations=o,this.segments=new No,this.dynamicLayoutVertexArray=new Fc,this.opacityVertexArray=new Tg,this.placedSymbolArray=new Cb,this.iconTransitioningVertexArray=new gr,this.globeExtVertexArray=new yu,this.zOffsetVertexArray=new md}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(o,l,p,_,f){this.isEmpty()||(p&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,uE.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,hE.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,X2,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=o.createVertexBuffer(this.iconTransitioningVertexArray,Sd.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,dE.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=o.createVertexBuffer(this.zOffsetVertexArray,pm.members,!0)),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Tn(Pu,"SymbolBuffers");class r_{constructor(o,l,p){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new p,this.segments=new No,this.collisionVertexArray=new hs,this.collisionVertexArrayExt=new Fc}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,pE.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,fE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Tn(r_,"CollisionBuffers");class fy{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.lut=o.lut,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Q.mat4.identity([]),this.placementViewportMatrix=Q.mat4.identity([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=iy(this.zoom,l["text-size"]),this.iconSizeData=iy(this.zoom,l["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),f=p.get("symbol-z-order");this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==_.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=p.get("text-writing-mode").map(y=>wl[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=o.sourceID,this.projection=o.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=p.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Pu(new Ca(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("text")||o.startsWith("symbol"))),this.icon=new Pu(new Ca(this.layers,{zoom:this.zoom,lut:this.lut},o=>o.startsWith("icon")||o.startsWith("symbol"))),this.glyphOffsetArray=new uh,this.lineVertexArray=new Mg,this.symbolInstances=new vp}calculateGlyphDependencies(o,l,p,_,f){for(const y of o){const T=y.codePointAt(0);if(void 0===T)break;if(l[T]=!0,_&&f&&T<=65535){const E=Zg[y];E&&(l[E.charCodeAt(0)]=!0)}}}updateFootprints(o,l){}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const p=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);return!zo(this.activeReplacements,p)&&(this.activeReplacements=p,!0)}populate(o,l,p,_){const f=this.layers[0],y=f.layout,T="globe"===this.projection.name,E=y.get("text-font"),P=y.get("text-field"),w=y.get("icon-image"),I=("constant"!==P.value.kind||P.value.value instanceof Nn&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&("constant"!==E.value.kind||E.value.value.length>0),R="constant"!==w.value.kind||!!w.value.value||Object.keys(w.parameters).length>0,D=y.get("symbol-sort-key");if(this.features=[],!I&&!R)return;const M=l.iconDependencies,L=l.glyphDependencies,V=l.availableImages,j=new Po(this.zoom);for(const{feature:G,id:$,index:H,sourceLayerIndex:Y}of o){const J=f._featureFilter.needGeometry,ce=Pt(G,J);if(!f._featureFilter.filter(j,ce,p))continue;if(J||(ce.geometry=Ke(G,p,_)),T&&1!==G.type&&p.z<=5){const Z=ce.geometry,de=.98078528056,De=(Be,je)=>{const Xe=Lg(Be.x,Be.y,p,1),it=Lg(je.x,je.y,p,1);return Q.vec3.dot(Xe,it)<de};for(let Be=0;Be<Z.length;Be++)Z[Be]=wt(Z[Be],De)}let we,_e;if(I){const Z=f.getValueAndResolveTokens("text-field",ce,p,V),de=Nn.factory(Z);Z2(de)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===nh()||this.hasRTLText&&Xa.isParsed())&&(we=Hw(de,f,ce))}if(R){const Z=f.getValueAndResolveTokens("icon-image",ce,p,V);_e=Z instanceof Ns?Z:Ns.fromString(Z)}if(!we&&!_e)continue;const be=this.sortFeaturesByKey?D.evaluate(ce,{},p):void 0;if(this.features.push({id:$,text:we,icon:_e,index:H,sourceLayerIndex:Y,geometry:ce.geometry,properties:G.properties,type:W2[G.type],sortKey:be}),_e&&(M[_e.namePrimary]=!0,_e.nameSecondary&&(M[_e.nameSecondary]=!0)),we){const Z=E.evaluate(ce,{},p).join(","),de="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(wl.vertical)>=0;for(const De of we.sections)if(De.image)M[De.image.namePrimary]=!0;else{const Be=qf(we.toString()),je=De.fontStack||Z,Xe=L[je]=L[je]||{};this.calculateGlyphDependencies(De.text,Xe,de,this.allowVerticalPlacement,Be)}}}"line"===y.get("symbol-placement")&&(this.features=function(G){const $={},H={},Y=[];let J=0;function ce(Z){Y.push(G[Z]),J++}function we(Z,de,De){const Be=H[Z];return delete H[Z],H[de]=Be,Y[Be].geometry[0].pop(),Y[Be].geometry[0]=Y[Be].geometry[0].concat(De[0]),Be}function _e(Z,de,De){const Be=$[de];return delete $[de],$[Z]=Be,Y[Be].geometry[0].shift(),Y[Be].geometry[0]=De[0].concat(Y[Be].geometry[0]),Be}function be(Z,de,De){const Be=De?de[0][de[0].length-1]:de[0][0];return`${Z}:${Be.x}:${Be.y}`}for(let Z=0;Z<G.length;Z++){const de=G[Z],De=de.geometry,Be=de.text?de.text.toString():null;if(!Be){ce(Z);continue}const je=be(Be,De),Xe=be(Be,De,!0);if(je in H&&Xe in $&&H[je]!==$[Xe]){const it=_e(je,Xe,De),at=we(je,Xe,Y[it].geometry);delete $[je],delete H[Xe],H[be(Be,Y[at].geometry,!0)]=at,Y[it].geometry=null}else je in H?we(je,Xe,De):Xe in $?_e(je,Xe,De):(ce(Z),$[je]=J-1,H[Xe]=J-1)}return Y.filter(Z=>Z.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,$)=>G.sortKey-$.sortKey)}update(o,l,p,_,f){const y=0!==Object.keys(o).length;if(y&&!this.stateDependentLayers.length)return;const T=y?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(o,l,T,p,_,f),this.icon.programConfigurations.updatePaintArrays(o,l,T,p,_,f)}updateZOffset(){const o=(f,y,T)=>{p+=y,p>f.length&&f.resize(p);for(let E=-y;E<0;E++)f.emplace(E+p,T)},l=(f,y,T)=>{_+=y,_>f.length&&f.resize(_);for(let E=-y;E<0;E++)f.emplace(E+_,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let p=0,_=0;for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:E,numIconVertices:P}=y,w=y.zOffset,I=P>0;if((T>0||E>0)&&(o(this.text.zOffsetVertexArray,T,w),o(this.text.zOffsetVertexArray,E,w)),I){const{placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:D}=y;R>=0&&l(this.icon.zOffsetVertexArray,P,w),D>=0&&l(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,w)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=BE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const p=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:_,y:f}of l)this.lineVertexArray.emplaceBack(_,f);return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(o,l,p,_,f,y,T,E,P,w,I,R,D,M,L,V){const j=o.indexArray,G=o.layoutVertexArray,$=o.globeExtVertexArray,H=o.segments.prepareSegment(4*l.length,G,j,this.canOverlap?y.sortKey:void 0),Y=this.glyphOffsetArray.length,J=H.vertexLength,ce=this.allowVerticalPlacement&&T===wl.vertical?Math.PI/2:0,we=y.text&&y.text.sections;for(let be=0;be<l.length;be++){const{tl:Z,tr:de,bl:De,br:Be,texPrimary:je,texSecondary:Xe,pixelOffsetTL:it,pixelOffsetBR:at,minFontScaleX:et,minFontScaleY:It,glyphOffset:Xt,isSDF:vt,sectionIndex:yn}=l[be],ln=H.vertexLength,Kt=Xt[1];if(N0(G,P.x,P.y,Z.x,Kt+Z.y,je.x,je.y,p,vt,it.x,it.y,et,It),N0(G,P.x,P.y,de.x,Kt+de.y,je.x+je.w,je.y,p,vt,at.x,it.y,et,It),N0(G,P.x,P.y,De.x,Kt+De.y,je.x,je.y+je.h,p,vt,it.x,at.y,et,It),N0(G,P.x,P.y,Be.x,Kt+Be.y,je.x+je.w,je.y+je.h,p,vt,at.x,at.y,et,It),E){const{x:Gt,y:Hn,z:gn}=E.anchor,[Dn,hi,Ti]=E.up;z0($,Gt,Hn,gn,Dn,hi,Ti),z0($,Gt,Hn,gn,Dn,hi,Ti),z0($,Gt,Hn,gn,Dn,hi,Ti),z0($,Gt,Hn,gn,Dn,hi,Ti),V0(o.dynamicLayoutVertexArray,Gt,Hn,gn,ce)}else V0(o.dynamicLayoutVertexArray,P.x,P.y,P.z,ce);if(V){const Gt=Xe||je;B0(o.iconTransitioningVertexArray,Gt.x,Gt.y),B0(o.iconTransitioningVertexArray,Gt.x+Gt.w,Gt.y),B0(o.iconTransitioningVertexArray,Gt.x,Gt.y+Gt.h),B0(o.iconTransitioningVertexArray,Gt.x+Gt.w,Gt.y+Gt.h)}j.emplaceBack(ln,ln+1,ln+2),j.emplaceBack(ln+1,ln+2,ln+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xt[0]),be!==l.length-1&&yn===l[be+1].sectionIndex||o.programConfigurations.populatePaintArrays(G.length,y,y.index,{},D,M,L,we&&we[yn])}const _e=E?E.anchor:P;o.placedSymbolArray.emplaceBack(_e.x,_e.y,_e.z,P.x,P.y,Y,this.glyphOffsetArray.length-Y,J,w,I,P.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],T,0,!1,0,R,0)}_commitLayoutVertex(o,l,p,_,f,y,T){o.emplaceBack(l,p,_,f,y,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(o,l,p,_,f,y,T){const E=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),P=E.vertexLength,w=T.tileAnchorX,I=T.tileAnchorY;for(let D=0;D<4;D++)p.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(p.collisionVertexArrayExt,l,o.padding,T.zOffset),this._commitLayoutVertex(p.layoutVertexArray,_,f,y,w,I,new Ht(o.x1,o.y1)),this._commitLayoutVertex(p.layoutVertexArray,_,f,y,w,I,new Ht(o.x2,o.y1)),this._commitLayoutVertex(p.layoutVertexArray,_,f,y,w,I,new Ht(o.x2,o.y2)),this._commitLayoutVertex(p.layoutVertexArray,_,f,y,w,I,new Ht(o.x1,o.y2)),E.vertexLength+=4;const R=p.indexArray;R.emplaceBack(P,P+1),R.emplaceBack(P+1,P+2),R.emplaceBack(P+2,P+3),R.emplaceBack(P+3,P),E.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,p,_,f,y){for(let T=_;T<f;T++){const E=p.get(T),P=this.getSymbolInstanceTextSize(o,y,l,T);this._addCollisionDebugVertices(E,P,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(o,l,p,_,f,y){for(let T=_;T<f;T++){const E=p.get(T),P=this.getSymbolInstanceIconSize(o,l,y.placedIconSymbolIndex);this._addCollisionDebugVertices(E,P,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(o,l,p){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new r_(Qf,mE.members,gr),this.iconCollisionBox=new r_(Qf,mE.members,gr);const _=Op(this.iconSizeData,o),f=Op(this.textSizeData,o,p);for(let y=0;y<this.symbolInstances.length;y++){const T=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(f,o,l,T.textBoxStartIndex,T.textBoxEndIndex,T),this._addTextDebugCollisionBoxes(f,o,l,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T),this._addIconDebugCollisionBoxes(_,o,l,T.iconBoxStartIndex,T.iconBoxEndIndex,T),this._addIconDebugCollisionBoxes(_,o,l,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T)}}getSymbolInstanceTextSize(o,l,p,_){const f=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:_),y=v0(this.textSizeData,o,f)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(o,l,p){const _=this.icon.placedSymbolArray.get(p),f=v0(this.iconSizeData,o,_);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(o,l,p,_){o.emplaceBack(l,-p,-p,_),o.emplaceBack(l,p,-p,_),o.emplaceBack(l,p,p,_),o.emplaceBack(l,-p,p,_)}_updateTextDebugCollisionBoxes(o,l,p,_,f,y,T){for(let E=_;E<f;E++){const P=p.get(E),w=this.getSymbolInstanceTextSize(o,y,l,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,P.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(o,l,p,_,f,y,T){for(let E=_;E<f;E++){const P=p.get(E),w=this.getSymbolInstanceIconSize(o,l,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,P.padding,y.zOffset)}}updateCollisionDebugBuffers(o,l,p,_){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=Op(this.iconSizeData,o,_),y=Op(this.textSizeData,o,p);for(let T=0;T<this.symbolInstances.length;T++){const E=this.symbolInstances.get(T);this._updateTextDebugCollisionBoxes(y,o,l,E.textBoxStartIndex,E.textBoxEndIndex,E,p),this._updateTextDebugCollisionBoxes(y,o,l,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,p),this._updateIconDebugCollisionBoxes(f,o,l,E.iconBoxStartIndex,E.iconBoxEndIndex,E,_),this._updateIconDebugCollisionBoxes(f,o,l,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,_)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,p,_,f,y,T,E,P){const w={};if(l<p){const{x1:I,y1:R,x2:D,y2:M,padding:L,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:G,tileAnchorX:$,tileAnchorY:H,featureIndex:Y}=o.get(l);w.textBox={x1:I,y1:R,x2:D,y2:M,padding:L,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:G,tileAnchorX:$,tileAnchorY:H},w.textFeatureIndex=Y}if(_<f){const{x1:I,y1:R,x2:D,y2:M,padding:L,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:G,tileAnchorX:$,tileAnchorY:H,featureIndex:Y}=o.get(_);w.verticalTextBox={x1:I,y1:R,x2:D,y2:M,padding:L,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:G,tileAnchorX:$,tileAnchorY:H},w.verticalTextFeatureIndex=Y}if(y<T){const{x1:I,y1:R,x2:D,y2:M,padding:L,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:G,tileAnchorX:$,tileAnchorY:H,featureIndex:Y}=o.get(y);w.iconBox={x1:I,y1:R,x2:D,y2:M,padding:L,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:G,tileAnchorX:$,tileAnchorY:H},w.iconFeatureIndex=Y}if(E<P){const{x1:I,y1:R,x2:D,y2:M,padding:L,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:G,tileAnchorX:$,tileAnchorY:H,featureIndex:Y}=o.get(E);w.verticalIconBox={x1:I,y1:R,x2:D,y2:M,padding:L,projectedAnchorX:V,projectedAnchorY:j,projectedAnchorZ:G,tileAnchorX:$,tileAnchorY:H},w.verticalIconFeatureIndex=Y}return w}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const p=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(o,l){const p=o.placedSymbolArray.get(l),_=p.vertexStartIndex+4*p.numGlyphs;for(let f=p.vertexStartIndex;f<_;f+=4)o.indexArray.emplaceBack(f,f+1,f+2),o.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),p=Math.cos(o),_=[],f=[],y=[];for(let T=0;T<this.symbolInstances.length;++T){y.push(T);const E=this.symbolInstances.get(T);_.push(0|Math.round(l*E.tileAnchorX+p*E.tileAnchorY)),f.push(E.featureIndex)}return y.sort((T,E)=>_[T]-_[E]||f[E]-f[T]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let o=0;o<this.symbolInstances.length;++o)this.symbolInstanceIndexesSortedZOffset.push(o)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((o,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(o).zOffset)}addToSortKeyRanges(o,l){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===l?p.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const p=this.symbolInstances.get(l);this.featureSortOrder.push(p.featureIndex);const{rightJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:P}=p;_>=0&&this.addIndicesForPlacedSymbol(this.text,_),f>=0&&f!==_&&this.addIndicesForPlacedSymbol(this.text,f),y>=0&&y!==f&&y!==_&&this.addIndicesForPlacedSymbol(this.text,y),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let j0,my,gy;Tn(fy,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),fy.addDynamicAttributes=V0;class _y{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Pl,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tn(_y,"FormatSectionOverride",{omit:["defaultValue"]});const U0=()=>gy||(gy={layout:j0||(j0=new $r({"symbol-placement":new Qt(ot.layout_symbol["symbol-placement"]),"symbol-spacing":new Qt(ot.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qt(ot.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Bn(ot.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qt(ot.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Qt(ot.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Qt(ot.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Qt(ot.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Qt(ot.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qt(ot.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qt(ot.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bn(ot.layout_symbol["icon-size"]),"icon-size-scale-range":new Qt(ot.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Bn(ot.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bn(ot.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bn(ot.layout_symbol["icon-image"]),"icon-rotate":new Bn(ot.layout_symbol["icon-rotate"]),"icon-padding":new Qt(ot.layout_symbol["icon-padding"]),"icon-keep-upright":new Qt(ot.layout_symbol["icon-keep-upright"]),"icon-offset":new Bn(ot.layout_symbol["icon-offset"]),"icon-anchor":new Bn(ot.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qt(ot.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qt(ot.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qt(ot.layout_symbol["text-rotation-alignment"]),"text-field":new Bn(ot.layout_symbol["text-field"]),"text-font":new Bn(ot.layout_symbol["text-font"]),"text-size":new Bn(ot.layout_symbol["text-size"]),"text-size-scale-range":new Qt(ot.layout_symbol["text-size-scale-range"]),"text-max-width":new Bn(ot.layout_symbol["text-max-width"]),"text-line-height":new Bn(ot.layout_symbol["text-line-height"]),"text-letter-spacing":new Bn(ot.layout_symbol["text-letter-spacing"]),"text-justify":new Bn(ot.layout_symbol["text-justify"]),"text-radial-offset":new Bn(ot.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qt(ot.layout_symbol["text-variable-anchor"]),"text-anchor":new Bn(ot.layout_symbol["text-anchor"]),"text-max-angle":new Qt(ot.layout_symbol["text-max-angle"]),"text-writing-mode":new Qt(ot.layout_symbol["text-writing-mode"]),"text-rotate":new Bn(ot.layout_symbol["text-rotate"]),"text-padding":new Qt(ot.layout_symbol["text-padding"]),"text-keep-upright":new Qt(ot.layout_symbol["text-keep-upright"]),"text-transform":new Bn(ot.layout_symbol["text-transform"]),"text-offset":new Bn(ot.layout_symbol["text-offset"]),"text-allow-overlap":new Qt(ot.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Qt(ot.layout_symbol["text-ignore-placement"]),"text-optional":new Qt(ot.layout_symbol["text-optional"]),visibility:new Qt(ot.layout_symbol.visibility)})),paint:my||(my=new $r({"icon-opacity":new Bn(ot.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Bn(ot.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Bn(ot.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Bn(ot.paint_symbol["text-emissive-strength"]),"icon-color":new Bn(ot.paint_symbol["icon-color"]),"icon-halo-color":new Bn(ot.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bn(ot.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bn(ot.paint_symbol["icon-halo-blur"]),"icon-translate":new Qt(ot.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qt(ot.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Bn(ot.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Bn(ot.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Bn(ot.paint_symbol["text-occlusion-opacity"]),"text-color":new Bn(ot.paint_symbol["text-color"],{runtimeType:qa,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Bn(ot.paint_symbol["text-halo-color"]),"text-halo-width":new Bn(ot.paint_symbol["text-halo-width"]),"text-halo-blur":new Bn(ot.paint_symbol["text-halo-blur"]),"text-translate":new Qt(ot.paint_symbol["text-translate"]),"text-translate-anchor":new Qt(ot.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Qt(ot.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Qt(ot.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Qt(ot.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Qt(ot.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Bn(ot.paint_symbol["symbol-z-offset"])}))},gy);class Wc extends Ta{constructor(o,l,p,_){super(o,U0(),l,p,_),this._colorAdjustmentMatrix=Q.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==o.paint&&("icon-occlusion-opacity"in o.paint||"text-occlusion-opacity"in o.paint)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const f of p)_.indexOf(f)<0&&_.push(f);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(o,l,p,_){return this._saturation===o&&this._contrast===l&&this._brightnessMin===p&&this._brightnessMax===_||(this._colorAdjustmentMatrix=function(f,y,T,E){f=fe(f),y=le(y);const P=Q.mat4.create(),w=f/3,I=1-2*w,R=[I,w,w,0,w,I,w,0,w,w,I,0,0,0,0,1],D=.5-.5*y,M=E-T;return Q.mat4.multiply(P,[M,0,0,0,0,M,0,0,0,0,M,0,T,T,T,1],[y,0,0,0,0,y,0,0,0,0,y,0,D,D,D,1]),Q.mat4.multiply(P,P,R),P}(o,l,p,_),this._saturation=o,this._contrast=l,this._brightnessMin=p,this._brightnessMax=_),this._colorAdjustmentMatrix}getValueAndResolveTokens(o,l,p,_){const f=this.layout.get(o).evaluate(l,{},p,_),y=this._unevaluatedLayout._values[o];return y.isDataDriven()||$a(y.value)||!f?f:(T=l.properties,f.replace(/{([^{}]+)}/g,(P,w)=>w in T?String(T[w]):""));var T}createBucket(o){return new fy(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of U0().paint.overridableProperties){if(!Wc.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),p=new _y(l),_=new nd(p,l.property.specification,this.scope,this.options);let f=null;f="constant"===l.value.kind||"source"===l.value.kind?new eh("source",_):new Hf("composite",_,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new Za(l.property,f,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,p){return!(!this.layout||l.isDataDriven()||p.isDataDriven())&&Wc.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const p=o.get("text-field"),_=U0().paint.properties[l];let f=!1;const y=T=>{for(const E of T)if(_.overrides&&_.overrides.hasOverride(E))return void(f=!0)};if("constant"===p.value.kind&&p.value.value instanceof Nn)y(p.value.value.sections);else if("source"===p.value.kind){const T=P=>{f||(P instanceof fl&&ns(P.value)===Xh?y(P.value.sections):P instanceof Gd?y(P.sections):P.eachChild(T))},E=p.value;E._styleExpression&&T(E._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(o,l,p){return{config:new Ja(this,{zoom:l,lut:p}),overrideFog:!1}}}let H0,eS,tS,q0;var G0=er([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function $0(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Sm(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Sh{constructor(o,l,p,_){this.context=o,this.format=p,this.useMipmap=_&&_.useMipmap,this.texture=o.gl.createTexture(),this.update(l,{premultiply:_&&_.premultiply})}update(o,l){const p=o&&o instanceof HTMLVideoElement&&0===o.width?o.videoWidth:o.width,_=o&&o instanceof HTMLVideoElement&&0===o.height?o.videoHeight:o.height,{context:f}=this,{gl:y}=f,{x:T,y:E}=l&&l.position?l.position:{x:0,y:0},P=Math.max(T+p,this.size?this.size[0]:0),w=Math.max(E+_,this.size?this.size[1]:0);!this.size||this.size[0]===P&&this.size[1]===w||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!l||!1!==l.premultiply));const I=o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||ImageBitmap&&o instanceof ImageBitmap;if(!this.size&&P>0&&w>0){const R=this.useMipmap?Math.floor(Math.log2(Math.max(P,w)))+1:1;y.texStorage2D(y.TEXTURE_2D,R,this.format,P,w),this.size=[P,w]}if(this.size)if(I)y.texSubImage2D(y.TEXTURE_2D,0,T,E,$0(this.format),Sm(this.format),o);else{const R=o.data;R&&y.texSubImage2D(y.TEXTURE_2D,0,T,E,p,_,$0(this.format),Sm(this.format),R)}this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(o,l,p=!1){const{context:_}=this,{gl:f}=_;f.bindTexture(f.TEXTURE_2D,this.texture),o!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!p?o===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),l!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(o,l,p,_){const{context:f}=this,{gl:y}=f;y.bindTexture(y.TEXTURE_2D,this.texture),l!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,l),this.magFilter=l),o!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?o===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:o),this.minFilter=o),p!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,p),this.wrapS=p),_!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,_),this.wrapT=_)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class Tm{constructor(o,l){this.context=o,this.texture=l}bind(o,l){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),o!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,o),this.minFilter=o),l!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,l),this.wrapS=l)}}function Td(u,o,l,p,_,f,y,T){const E=[u,o,1,l,p,1,_,f,1],P=[y,T,1],w=Q.mat3.adjoint([],E),[I,R,D]=Q.vec3.transformMat3(P,P,w);return Q.mat3.multiply(E,E,[I,0,0,0,R,0,0,0,D])}function by(u,o,l,p,_,f,y,T){const E=function(P,w,I,R,D,M,L,V){const j=Td(0,0,1,0,1,1,0,1),G=Td(P,w,I,R,D,M,L,V),$=Q.mat3.adjoint([],j);return Q.mat3.multiply(G,G,$)}(u,o,l,p,_,f,y,T);return[E[2]/E[8]/an,E[5]/E[8]/an]}function Vp(u){return[u[0],Math.min(Math.max(u[1],-Ee),Ee)]}class W0 extends uu{constructor(o,l,p,_){super(),this.id=o,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(_),this.options=l,this._dirty=!1}load(o,l){if(this._loaded=l||!1,this.fire(new ec("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return o&&(this.coordinates=o),this._loaded=!0,void this._finishLoading();this._imageRequest=Ql(this.map._requestManager.transformRequest(this.url,cu.Image),(p,_)=>{this._imageRequest=null,this._loaded=!0,p?this.fire(new Wh(p)):_&&(this.image=_ instanceof HTMLImageElement?hn.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}setTexture(o){if(!(o.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Tm(this.map.painter.context,o.handle),this.width=o.dimensions[0],this.height=o.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ec("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(o){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Tm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(o){if(this.coordinates=o,this._boundsArray=void 0,this._unsupportedCoords=!1,!o.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=o[0][1],p=o[0][1];for(const f of o)f[1]>p&&(p=f[1]),f[1]<l&&(l=f[1]);const _=(p+l)/2;if(_>Ee?this.onNorthPole=!0:_<-Ee&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=o.map(He.fromLngLat);this.tileID=function(y){let T=1/0,E=1/0,P=-1/0,w=-1/0;for(const L of y)T=Math.min(T,L.x),E=Math.min(E,L.y),P=Math.max(P,L.x),w=Math.max(w,L.y);const I=Math.max(P-T,w-E),R=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),D=Math.pow(2,R);let M=Math.floor((T+P)/2*D);return M>1&&(M-=1),new ss(R,M,Math.floor((E+w)/2*D))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ec("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(o){for(const j in this.tiles){const G=this.tiles[j];"loaded"!==G.state&&(G.state="loaded",G.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const l=wm(new ss(0,0,0),this.map.transform.projection),p=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){const G=j[1].x-j[0].x,$=j[1].y-j[0].y,H=j[2].x-j[1].x,Y=j[2].y-j[1].y,J=j[3].x-j[2].x,ce=j[3].y-j[2].y,we=j[0].x-j[3].x,_e=j[0].y-j[3].y,be=G*Y-H*$,Z=H*ce-J*Y,de=J*_e-we*ce,De=we*$-G*_e;return be>0&&Z>0&&de>0&&De>0||be<0&&Z<0&&de<0&&De<0}(p))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const _=wm(this.tileID,this.map.transform.projection),[f,y,T,E]=this.coordinates.map(j=>{const G=_.projection.project(j[0],j[1]);return PE(_,G)._round()});this.perspectiveTransform=by(f.x,f.y,y.x,y.y,T.x,T.y,E.x,E.y);const P=this._boundsArray=new hd;P.emplaceBack(f.x,f.y,0,0),P.emplaceBack(y.x,y.y,an,0),P.emplaceBack(E.x,E.y,0,an),P.emplaceBack(T.x,T.y,an,an),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=o.createVertexBuffer(P,G0.members),this.boundsSegments=No.simpleSegment(0,0,4,2);const w=[],I=[Vp((R=this.coordinates)[0]),Vp(R[1]),Vp(R[2]),Vp(R[3])];var R;const[D,M,L,V]=function(j){let G=j[0][0],$=G,H=j[0][1],Y=H;for(let J=1;J<j.length;J++)j[J][0]<G?G=j[J][0]:j[J][0]>$&&($=j[J][0]),j[J][1]<H?H=j[J][1]:j[J][1]>Y&&(Y=j[J][1]);return[G,H,$-G,Y-H]}(I);{const j=new hd,[G,$,H,Y]=function(it){let at=it[0].x,et=at,It=it[0].y,Xt=It;for(let vt=1;vt<it.length;vt++)it[vt].x<at?at=it[vt].x:it[vt].x>et&&(et=it[vt].x),it[vt].y<It?It=it[vt].y:it[vt].y>Xt&&(Xt=it[vt].y);return[at,It,et-at,Xt-It]}(p),J=it=>[(it.x-G)/H,(it.y-$)/Y],[ce,we,_e,be]=p.map(J),Z=function(it,at,et,It,Xt,vt,yn,ln){const Kt=Td(0,0,1,0,1,1,0,1),Gt=Td(it,at,et,It,Xt,vt,yn,ln),Hn=Q.mat3.adjoint([],Gt);return Q.mat3.multiply(Kt,Kt,Hn)}(ce[0],ce[1],we[0],we[1],_e[0],_e[1],be[0],be[1]);this.elevatedGlobePerspectiveTransform=by(ce[0],ce[1],we[0],we[1],_e[0],_e[1],be[0],be[1]);const de=(it,at)=>{w.push(it.lng);const et=Math.round((it.lng-D)/L*an),It=Math.round((it.lat-M)/V*an),Xt=J(at),vt=Q.vec3.transformMat3([],[Xt[0],Xt[1],1],Z),yn=Math.round(vt[0]/vt[2]*an),ln=Math.round(vt[1]/vt[2]*an);j.emplaceBack(et,It,yn,ln)},De=p[3].x-p[0].x,Be=p[3].y-p[0].y,je=p[2].x-p[1].x,Xe=p[2].y-p[1].y;for(let it=0;it<65;it++){const at=it/64,et=[p[0].x+at*De,p[0].y+at*Be],It=[p[1].x+at*je,p[1].y+at*Xe],Xt=It[0]-et[0],vt=It[1]-et[1];for(let yn=0;yn<65;yn++){const ln=yn/64,Kt={x:et[0]+Xt*ln,y:et[1]+vt*ln,z:0};de(l.projection.unproject(Kt.x,Kt.y),Kt)}}this.elevatedGlobeVertexBuffer=o.createVertexBuffer(j,G0.members)}{this.maxLongitudeTriangleSize=0;let j=[],G=new Xr;const $=(H,Y,J)=>{G.emplaceBack(H,Y,J);const ce=w[H],we=w[Y],_e=w[J],be=Math.min(Math.min(ce,we),_e),Z=Math.max(Math.max(ce,we),_e)-be;Z>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Z),j.push(be+Z/2)};for(let H=0;H<64;H++)for(let Y=0;Y<64;Y++){const J=65*H+Y,ce=J+1,we=J+65,_e=we+1;$(J,we,ce),$(ce,we,_e)}[j,G]=function(H,Y){const J=Array.from({length:H.length},(_e,be)=>be);J.sort((_e,be)=>H[_e]-H[be]);const ce=[],we=new Xr;for(let _e=0;_e<J.length;_e++){const be=J[_e];ce.push(H[be]);const Z=3*be,de=Z+1;we.emplaceBack(Y.uint16[Z],Y.uint16[de],Y.uint16[de+1])}return[ce,we]}(j,G),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=o.createIndexBuffer(G)}this.elevatedGlobeSegments=No.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,L/an,0,V/an,0,0,M,D,0])}prepare(){const o=0!==Object.keys(this.tiles).length;if(this.tileID&&!o)return;const l=this.map.painter.context,p=l.gl;!this._dirty||this.texture instanceof Tm||(this.texture?this.texture.update(this.image):(this.texture=new Sh(l,this.image,p.RGBA8),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this._dirty=!1),o&&this._prepareData(l)}loadTile(o,l){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},l(null)):(o.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(o){const l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;const p=this.elevatedGlobeTrianglesCenterLongitudes;let _=(f=o+180)+360*Math.round((p[0]-f)/360);var f;const y=new No,T=(I,R)=>{y.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:l.segments[0].vertexLength,primitiveLength:R,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(p[0]-_)<=E){const I=gt(p,0,p.length,_+E);return I===p.length||T(I,qh(p,I+1,p.length,_+360-E)-I),y}_<p[0]&&(_+=360);const P=qh(p,0,p.length,_-E);if(P===p.length)return T(0,p.length),y;T(0,P-0);const w=gt(p,P+1,p.length,_+E);return w!==p.length&&T(w,p.length-w),y}}const nS=(Math.pow(256,2)-1)/16907520;class yy extends Ta{constructor(o,l,p,_){super(o,{layout:tS||(tS=new $r({visibility:new Qt(ot.layout_raster.visibility)})),paint:q0||(q0=new $r({"raster-opacity":new Qt(ot.paint_raster["raster-opacity"]),"raster-color":new cc(ot.paint_raster["raster-color"]),"raster-color-mix":new Qt(ot.paint_raster["raster-color-mix"]),"raster-color-range":new Qt(ot.paint_raster["raster-color-range"]),"raster-hue-rotate":new Qt(ot.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qt(ot.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qt(ot.paint_raster["raster-brightness-max"]),"raster-saturation":new Qt(ot.paint_raster["raster-saturation"]),"raster-contrast":new Qt(ot.paint_raster["raster-contrast"]),"raster-resampling":new Qt(ot.paint_raster["raster-resampling"]),"raster-fade-duration":new Qt(ot.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Qt(ot.paint_raster["raster-emissive-strength"]),"raster-array-band":new Qt(ot.paint_raster["raster-array-band"]),"raster-elevation":new Qt(ot.paint_raster["raster-elevation"])}))},l,p,_),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(o){return!(o&&o._source instanceof W0&&(o._source.onNorthPole||o._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(o){"raster-color"!==o&&"raster-color-range"!==o||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(o){if(!this.hasColorMap()||!this._curRampRange)return;const l=this._transitionablePaint._values["raster-color"].value.expression,[p,_]=o||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(p)&&isNaN(_)||p===this._curRampRange[0]&&_===this._curRampRange[1]||(this.colorRamp=Tp({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:p,end:_}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[p,_])}}let vy,X0,xy,iS,zE;class rS extends Ta{constructor(o,l,p,_){super(o,{layout:vy||(vy=new $r({visibility:new Qt(ot["layout_raster-particle"].visibility)})),paint:X0||(X0=new $r({"raster-particle-array-band":new Qt(ot["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Qt(ot["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new cc(ot["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Qt(ot["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Qt(ot["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Qt(ot["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Qt(ot["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Qt(ot["paint_raster-particle"]["raster-particle-elevation"])}))},l,p,_),this._updateColorRamp(),this.lastInvalidatedAt=hn.now()}onRemove(o){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(o){return!1}_handleSpecialPaintPropertyUpdate(o){"raster-particle-color"!==o&&"raster-particle-max-speed"!==o||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===o&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const o=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Tp({expression:o,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=hn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class oS extends Ta{constructor(o,l){super(o,{},l,null),this.implementation=o,o.slot&&(this.slot=o.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(o){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}function Z0(u,o,l){const p=[0,0,1],_=Q.quat.identity([]);return Q.quat.rotateY(_,_,l?-pi(u)+Math.PI:pi(u)),Q.quat.rotateX(_,_,-pi(o)),Q.vec3.transformQuat(p,p,_),Q.vec3.normalize(p,p)}function Y0(u,o){const l=wy(u.projection,u.zoom,u.width,u.height),p=function(f,y,T,E,P){const w=new N(T.lng-180*js,T.lat),I=new N(T.lng+180*js,T.lat),R=f.project(w.lng,w.lat),D=f.project(I.lng,I.lat),M=-Math.atan2(D.y-R.y,D.x-R.x),L=He.fromLngLat(T);L.y=Bt(L.y,-1+js,1-js);const V=L.toLngLat(),j=f.project(V.lng,V.lat),G=He.fromLngLat(V);G.x+=js;const $=G.toLngLat(),H=f.project($.lng,$.lat),Y=sS(H.x-j.x,H.y-j.y,M),J=He.fromLngLat(V);J.y+=js;const ce=J.toLngLat(),we=f.project(ce.lng,ce.lat),_e=sS(we.x-j.x,we.y-j.y,M),be=Math.abs(Y.x)/Math.abs(_e.y),Z=Q.mat4.identity([]);Q.mat4.rotateZ(Z,Z,-M*(1-(P?0:E)));const de=Q.mat4.identity([]);return Q.mat4.scale(de,de,[1,1-(1-be)*E,1]),de[4]=-_e.x/_e.y*E,Q.mat4.rotateZ(de,de,M),Q.mat4.multiply(de,Z,de),de}(u.projection,0,u.center,l,o),_=J0(u);return Q.mat4.scale(p,p,[_,_,1]),p}function J0(u){const o=u.projection,l=wy(u.projection,u.zoom,u.width,u.height),p=Sy(o,u.center),_=Sy(o,N.convert(o.center));return Math.pow(2,p*l+(1-l)*_)}function wy(u,o,l,p,_=1/0){const f=u.range;if(!f)return 0;const y=Math.min(_,Math.max(l,p)),T=Math.log(y/1024)/Math.LN2;return In(f[0]+T,f[1]+T,o)}const js=1/4e4;function Sy(u,o){const l=Bt(o.lat,-Ee,Ee),p=new N(o.lng-180*js,l),_=new N(o.lng+180*js,l),f=u.project(p.lng,l),y=u.project(_.lng,l),T=He.fromLngLat(p),E=He.fromLngLat(_),P=y.x-f.x,w=y.y-f.y,I=E.x-T.x,R=E.y-T.y,D=Math.sqrt((I*I+R*R)/(P*P+w*w));return Math.log(D)/Math.LN2}function sS(u,o,l){const p=Math.cos(l),_=Math.sin(l);return{x:u*p-o*_,y:u*_+o*p}}function VE(u,o,l){Q.mat4.identity(u),Q.mat4.rotateZ(u,u,pi(o[2])),Q.mat4.rotateX(u,u,pi(o[0])),Q.mat4.rotateY(u,u,pi(o[1])),Q.mat4.scale(u,u,l),Q.mat4.multiply(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ty(u,o,l,p,_,f,y,T){const E=[l[0]-o[0],l[1]-o[1],0],P=[p[0]-o[0],p[1]-o[1],0];if(Q.vec3.length(E)<1e-12||Q.vec3.length(P)<1e-12)return Q.quat.identity(u);const w=Q.vec3.cross([],E,P);Q.vec3.normalize(w,w),Q.vec3.subtract(P,p,o),E[2]=(f-_)*T,P[2]=(y-_)*T;const I=E;return Q.vec3.cross(I,E,P),Q.vec3.normalize(I,I),Q.quat.rotationTo(u,w,I)}function o_(u,o,l=!1){const p=yd(o.zoom),_=function(f,y,T){const E=y.worldSize,P=[f[12],f[13],f[14]],w=xe(P[1]/E),I=ge(P[0]/E),R=Q.mat4.identity([]),D=ie(1,w)*E,M=ie(1,0)*E*Ie(w,y.zoom),L=1/Wv(E);let V=M*L;if(T){const H=wy(y.projection,y.zoom,y.width,y.height,1024);V=L*y.projection.pixelSpaceConversion(y.center.lat,E,H)}const j=k(w,I);Q.vec3.add(j,j,Q.vec3.scale([],Q.vec3.normalize([],j),D*V*P[2]));const G=function(H){const Y=[H[0],H[1],H[2]];let J=[0,1,0];const ce=Q.vec3.cross([],J,Y);return Q.vec3.cross(J,Y,ce),0===Q.vec3.squaredLength(J)&&(J=[0,1,0],Q.vec3.cross(ce,Y,J)),Q.vec3.normalize(ce,ce),Q.vec3.normalize(J,J),Q.vec3.normalize(Y,Y),[ce[0],ce[1],ce[2],0,J[0],J[1],J[2],0,Y[0],Y[1],Y[2],0,H[0],H[1],H[2],1]}(j);Q.mat4.scale(R,R,[V,V,V*D]),Q.mat4.translate(R,R,[-P[0],-P[1],-P[2]]);const $=Q.mat4.multiply([],y.globeMatrix,G);return Q.mat4.multiply($,$,R),Q.mat4.multiply($,$,f),$}(u,o,l);return p>0?function(y,T,E){const P=(M,L,V)=>{const j=Q.vec3.length(M),G=Q.vec3.length(L),$=Iu(M,L,V);return Q.vec3.scale($,$,1/Q.vec3.length($)*ni(j,G,V))},w=P([y[0],y[1],y[2]],[T[0],T[1],T[2]],E),I=P([y[4],y[5],y[6]],[T[4],T[5],T[6]],E),R=P([y[8],y[9],y[10]],[T[8],T[9],T[10]],E),D=Iu([y[12],y[13],y[14]],[T[12],T[13],T[14]],E);return[w[0],w[1],w[2],0,I[0],I[1],I[2],0,R[0],R[1],R[2],0,D[0],D[1],D[2],1]}(_,function(y,T){const E=T.worldSize,P=ie(1,0)*E*Ie(T.center.lat,T.zoom)/Wv(E),w=ie(1,T.center.lat)*E,I=Q.mat4.identity([]);return Q.mat4.rotateY(I,I,pi(T.center.lng)),Q.mat4.rotateX(I,I,pi(T.center.lat)),Q.mat4.translate(I,I,[0,0,ws]),Q.mat4.scale(I,I,[P,P,P*w]),Q.mat4.translate(I,I,[T.point.x-.5*E,T.point.y-.5*E,0]),Q.mat4.multiply(I,I,y),Q.mat4.multiply(I,T.globeMatrix,I)}(u,o),p):_}function K0(u,o,l,p){const _=wr.projectAabbCorners(p,l);let f=Number.MAX_VALUE,y=-1;for(let P=0;P<_.length;++P){const w=_[P];w[0]=(.5*w[0]+.5)*o.width,w[1]=(.5-.5*w[1])*o.height,w[2]<f&&(y=P,f=w[2])}const T=P=>new Ht(_[P][0],_[P][1]);let E;switch(y){case 0:case 6:E=[T(1),T(5),T(4),T(7),T(3),T(2),T(1)];break;case 1:case 7:E=[T(0),T(4),T(5),T(6),T(2),T(3),T(0)];break;case 3:case 5:E=[T(1),T(0),T(4),T(7),T(6),T(2),T(1)];break;default:E=[T(1),T(5),T(6),T(7),T(3),T(0),T(1)]}if(Lt(u,E))return f}const jE=er([{name:"a_pos_3f",components:3,type:"Float32"}]),UE=er([{name:"a_color_3f",components:3,type:"Float32"}]),HE=er([{name:"a_color_4f",components:4,type:"Float32"}]),aS=er([{name:"a_uv_2f",components:2,type:"Float32"}]),qE=er([{name:"a_normal_3f",components:3,type:"Float32"}]),lS=er([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),GE=er([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),cS={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class s_{constructor(o,l,p,_){this.message=(o?`${o}: `:"")+p,_&&(this.identifier=_),null!=l&&l.__line__&&(this.line=l.__line__)}}function Q0(u,o){const l=-1===u.indexOf("://");try{return new URL(u,l&&o?"http://example.com":void 0),!0}catch(p){return!1}}class uS{constructor(o,l){this.feature=o,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Xc{constructor(){this.instancedDataArray=new tm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class a_{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=o.projection,this.index=o.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(o,l){}populate(o,l,p,_){this.tileToMeter=Fe(p);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:T,index:E,sourceLayerIndex:P}of o){const w=null!=T?T:y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0,I=Pt(y,f);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),I,p))continue;const R={id:w,sourceLayerIndex:P,index:E,geometry:f?I.geometry:Ke(y,p,_),properties:y.properties,type:y.type,patterns:{}},D=this.addFeature(R,R.geometry,I);D&&l.featureIndex.insert(y,R.geometry,E,P,this.index,this.instancesPerModel[D].instancedDataArray.length,256)}this.lookup=null}update(o,l,p,_){for(const f in this.instancesPerModel){const y=this.instancesPerModel[f];for(const T in o)y.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(y.features[y.idToFeaturesIndex[T]],o[T],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let o=!1;for(const l in this.instancesPerModel){const p=this.instancesPerModel[l];for(const _ of p.features){const f=this.layers[0],y=_.feature,T=this.canonical,E=f.paint.get("model-rotation").evaluate(y,{},T),P=f.paint.get("model-scale").evaluate(y,{},T),w=f.paint.get("model-translation").evaluate(y,{},T);Q.vec3.exactEquals(_.rotation,E)&&Q.vec3.exactEquals(_.scale,P)&&Q.vec3.exactEquals(_.translation,w)||(this.evaluate(_,_.featureStates,p,!0),o=!0)}}return o}updateReplacement(o,l,p,_){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const f=l.getReplacementRegionsForTile(o.toUnwrapped(),!0);if(zo(this.activeReplacements,f))return!1;this.activeReplacements=f;let y=!1;for(const T in this.instancesPerModel){const E=this.instancesPerModel[T],P=E.instancedDataArray;for(const w of E.features){const I=w.instancedDataOffset,R=w.instancedDataCount;for(let D=0;D<R;D++){const M=16*(D+I);let L=P.float32[M+0];const V=L>an;L=V?L-an:L;const j=Math.floor(L),G=P.float32[M+1];let $=!1;for(const H of this.activeReplacements)if(!vw(H,p,cS.Model,_)&&!(H.min.x>j||j>H.max.x||H.min.y>G||G>H.max.y)&&($=Tw(Sw(j,G,o.canonical,H.footprintTileId.canonical),H.footprint),$))break;P.float32[M]=$?L+an:L,y=y||$!==V}}}return y}isEmpty(){for(const o in this.instancesPerModel)if(0!==this.instancesPerModel[o].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(o){if(!this.uploaded)for(const l in this.instancesPerModel){const p=this.instancesPerModel[l];p.instancedDataArray.length<0||0===p.instancedDataArray.length||(p.instancedDataBuffer?p.instancedDataBuffer.updateData(p.instancedDataArray):p.instancedDataBuffer=o.createVertexBuffer(p.instancedDataArray,lS.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const l in this.instancesPerModel){const p=this.instancesPerModel[l];0!==p.instancedDataArray.length&&p.instancedDataBuffer&&p.instancedDataBuffer.destroy()}const o=this.layers[0].modelManager;if(o&&this.modelUris)for(const l of this.modelUris)o.removeModel(l,"")}addFeature(o,l,p){const _=this.layers[0],f=_.layout.get("model-id").evaluate(p,{},this.canonical);if(!f)return Ki(`modelId is not evaluated for layer ${_.id} and it is not going to get rendered.`),f;Q0(f,!1)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new Xc);const y=this.instancesPerModel[f],T=y.instancedDataArray,E=new uS(p,T.length);for(const P of l)for(const w of P){if(w.x<0||w.x>=an||w.y<0||w.y>=an)continue;const I=(this.lookupDim-1)/an,R=this.lookupDim*(w.y*I|0)+w.x*I|0;if(this.lookup){if(0!==this.lookup[R])continue;this.lookup[R]=1}this.instanceCount++;const D=T.length;T.resize(D+1),y.instancesEvaluatedElevation.push(0),T.float32[16*D]=w.x,T.float32[16*D+1]=w.y}return E.instancedDataCount=y.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(o.id&&(y.idToFeaturesIndex[o.id]=y.features.length),y.features.push(E),this.evaluate(E,{},y,!1)),f}getModelUris(){return this.modelUris}evaluate(o,l,p,_){const f=this.layers[0],y=o.feature,T=this.canonical,E=o.rotation=f.paint.get("model-rotation").evaluate(y,l,T),P=o.scale=f.paint.get("model-scale").evaluate(y,l,T),w=o.translation=f.paint.get("model-translation").evaluate(y,l,T),I=f.paint.get("model-color").evaluate(y,l,T);I.a=f.paint.get("model-color-mix-intensity").evaluate(y,l,T);const R=[];this.maxVerticalOffset<w[2]&&(this.maxVerticalOffset=w[2]),this.maxScale=Math.max(Math.max(this.maxScale,P[0]),Math.max(P[1],P[2])),VE(R,E,P);const D=Math.round(100*I.a)+I.b/1.05;for(let M=0;M<o.instancedDataCount;++M){const L=o.instancedDataOffset+M,V=16*L,j=p.instancedDataArray.float32;let G=0;_&&(G=j[V+6]-p.instancesEvaluatedElevation[L]);const $=0|j[V+1];j[V]=(0|j[V])+I.r/1.05,j[V+1]=$+I.g/1.05,j[V+2]=D,j[V+3]=1/(T.z>10?this.tileToMeter:Fe(T,$)),j[V+4]=w[0],j[V+5]=w[1],j[V+6]=w[2]+G,j[V+7]=R[0],j[V+8]=R[1],j[V+9]=R[2],j[V+10]=R[4],j[V+11]=R[5],j[V+12]=R[6],j[V+13]=R[8],j[V+14]=R[9],j[V+15]=R[10],p.instancesEvaluatedElevation[L]=w[2]}}}let dS,hS;Tn(a_,"ModelBucket",{omit:["layers"]}),Tn(Xc,"PerModelAttributes"),Tn(uS,"ModelFeature");const jp={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function pS(u,o,l,p,_,f,y,T,E,P=!1){const w=l.zoom,I=l.project(p),R=Ie(p.lat,w),D=1/R;Q.mat4.identity(u),Q.mat4.translate(u,u,[I.x+y[0]*D,I.y+y[1]*D,y[2]]);let M=1,L=1;const V=l.worldSize;if(P){if("mercator"===l.projection.name){let H=0;l.elevation&&(H=l.elevation.getAtPointOrZero(new He(I.x/V,I.y/V),0));const Y=Q.vec4.transformMat4([],[I.x,I.y,H,1],l.projMatrix)[3]/l.cameraToCenterDistance;M=Y,L=Y*Ie(l.center.lat,w)}else if("globe"===l.projection.name){const H=o_(u,l),Y=Q.mat4.multiply([],l.projMatrix,H),J=[0,0,0,1];Q.vec4.transformMat4(J,J,Y);const ce=J[3]/l.cameraToCenterDistance,we=yd(w),_e=l.projection.pixelsPerMeter(p.lat,V)*Ie(p.lat,w),be=l.projection.pixelsPerMeter(l.center.lat,V)*Ie(l.center.lat,w);M=ce/ni(_e,Ae(l.center.lat),we),L=ce*R/_e,M*=be,L*=be}}else M=D;Q.mat4.scale(u,u,[M,M,L]);const j=[...u],G=o.orientation,$=[];if(VE($,[G[0]+_[0],G[1]+_[1],G[2]+_[2]],f),Q.mat4.multiply(u,j,$),T&&l.elevation){let H=0;const Y=[];if(E&&l.elevation){H=function(we,_e,be,Z,de){const De=_e.elevation;if(!De)return 0;const Be=wr.projectAabbCorners(be,Z),je=ie(1,de.lat)*_e.worldSize,Xe=function(Hn,gn){const Dn=[0,0,1],hi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ti of hi){const Ii=Hn[Ti.corners[0]],_i=Hn[Ti.corners[1]],Vi=Hn[Ti.corners[2]],Li=[_i[0]-Ii[0],_i[1]-Ii[1],gn*(_i[2]-Ii[2])],Jr=Q.vec3.cross(Li,Li,[Vi[0]-Ii[0],Vi[1]-Ii[1],gn*(Vi[2]-Ii[2])]);Q.vec3.normalize(Jr,Jr),Ti.dotProductWithUp=Q.vec3.dot(Jr,Dn)}return hi.sort((Ti,Ii)=>Ti.dotProductWithUp-Ii.dotProductWithUp),hi[0].corners}(Be,je),it=Be[Xe[0]],at=Be[Xe[1]],et=Be[Xe[2]],It=Be[Xe[3]],Xt=De.getAtPointOrZero(new He(it[0]/_e.worldSize,it[1]/_e.worldSize),0),vt=De.getAtPointOrZero(new He(at[0]/_e.worldSize,at[1]/_e.worldSize),0),yn=De.getAtPointOrZero(new He(et[0]/_e.worldSize,et[1]/_e.worldSize),0),ln=De.getAtPointOrZero(new He(It[0]/_e.worldSize,It[1]/_e.worldSize),0),Kt=(Xt+ln)/2,Gt=(vt+yn)/2;return Kt>Gt?vt<yn?Ty(we,at,It,it,vt,ln,Xt,je):Ty(we,et,it,It,yn,Xt,ln,je):Xt<ln?Ty(we,it,at,et,Xt,vt,yn,je):Ty(we,It,et,at,ln,yn,vt,je),Math.max(Kt,Gt)}(Y,l,o.aabb,u,p);const J=Q.mat4.fromQuat([],Y),ce=Q.mat4.multiply([],J,$);Q.mat4.multiply(u,j,ce)}else H=l.elevation.getAtPointOrZero(new He(I.x/V,I.y/V),0);0!==H&&(u[14]+=H)}}function l_(u,o,l=!1){u.uploaded||(u.gfxTexture=new Sh(o,u.image,l?o.gl.R8:o.gl.RGBA8,{useMipmap:u.sampler.minFilter>=o.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function $E(u,o,l){u.indexBuffer=o.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=o.createVertexBuffer(u.vertexArray,jE.members,!1,!0),u.normalArray&&(u.normalBuffer=o.createVertexBuffer(u.normalArray,qE.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=o.createVertexBuffer(u.texcoordArray,aS.members,!1,!0)),u.colorArray&&(u.colorBuffer=o.createVertexBuffer(u.colorArray,(12===u.colorArray.bytesPerElement?UE:HE).members,!1,!0)),u.featureArray&&(u.pbrBuffer=o.createVertexBuffer(u.featureArray,GE.members,!0)),u.segments=No.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const p=u.material;p.pbrMetallicRoughness.baseColorTexture&&l_(p.pbrMetallicRoughness.baseColorTexture,o),p.pbrMetallicRoughness.metallicRoughnessTexture&&l_(p.pbrMetallicRoughness.metallicRoughnessTexture,o),p.normalTexture&&l_(p.normalTexture,o),p.occlusionTexture&&l_(p.occlusionTexture,o,l),p.emissionTexture&&l_(p.emissionTexture,o)}function c_(u,o,l){if(u.meshes)for(const p of u.meshes)$E(p,o,l);if(u.children)for(const p of u.children)c_(p,o,l)}function Cy(u){if(u.meshes)for(const o of u.meshes)o.indexArray.destroy(),o.vertexArray.destroy(),o.colorArray&&o.colorArray.destroy(),o.normalArray&&o.normalArray.destroy(),o.texcoordArray&&o.texcoordArray.destroy(),o.featureArray&&o.featureArray.destroy();if(u.children)for(const o of u.children)Cy(o)}function ex(u){if(u.meshes)for(const l of u.meshes)l.vertexBuffer&&(l.vertexBuffer.destroy(),l.indexBuffer.destroy(),l.normalBuffer&&l.normalBuffer.destroy(),l.texcoordBuffer&&l.texcoordBuffer.destroy(),l.colorBuffer&&l.colorBuffer.destroy(),l.pbrBuffer&&l.pbrBuffer.destroy(),l.segments.destroy(),l.material&&((o=l.material).pbrMetallicRoughness.baseColorTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture&&o.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),o.pbrMetallicRoughness.metallicRoughnessTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&o.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),o.normalTexture&&o.normalTexture.gfxTexture&&o.normalTexture.gfxTexture.destroy(),o.emissionTexture&&o.emissionTexture.gfxTexture&&o.emissionTexture.gfxTexture.destroy(),o.occlusionTexture&&o.occlusionTexture.gfxTexture&&o.occlusionTexture.gfxTexture.destroy()));var o;if(u.children)for(const l of u.children)ex(l)}class Cd{constructor(o,l,p){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=p}static create(o,l,p){const _=p||o.findDEMTileFor(l);if(!_||!_.dem)return;const f=_.dem,y=_.tileID,T=1<<l.canonical.z-y.canonical.z;return new Cd(_,f.dim/an/T,[(l.canonical.x/T-y.canonical.x)*f.dim,(l.canonical.y/T-y.canonical.y)*f.dim])}tileCoordToPixel(o,l){const p=l*this._scale+this._offset[1],_=Math.floor(o*this._scale+this._offset[0]),f=Math.floor(p);return new Ht(_,f)}getElevationAt(o,l,p,_){const f=o*this._scale+this._offset[0],y=l*this._scale+this._offset[1],T=Math.floor(f),E=Math.floor(y),P=this._dem;return _=!!_,p?ni(ni(P.get(T,E,_),P.get(T,E+1,_),y-E),ni(P.get(T+1,E,_),P.get(T+1,E+1,_),y-E),f-T):P.get(T,E,_)}getElevationAtPixel(o,l,p){return this._dem.get(o,l,!!p)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*ie(1,o)*this._dem.stride}}const u_=new Float32Array(262144),ku=new Uint8Array(262144);function WE(u){let o=0;if(u.meshes)for(const l of u.meshes)o=Math.max(o,l.aabb.max[2]);if(u.children)for(const l of u.children)o=Math.max(o,WE(l));return o}function Dy(u,o,l){if(u.meshes)for(const p of u.meshes){if(p.aabb.min[0]===1/0)continue;const _=wr.applyTransform(p.aabb,u.matrix);l.insert(o,_.min[0],_.min[1],_.max[0],_.max[1])}if(u.children)for(const p of u.children)Dy(p,o,l)}const XE=["","wall","door","roof","window","lamp","logo"];class tx{constructor(o){this.node=o,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:o.id,geometry:[],properties:{height:WE(o)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new wr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let o=0;const l=new wr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const p of this.node.meshes)this.node.lightMeshIndex!==o&&(p.transformedAabb=wr.applyTransformFast(p.aabb,this.node.matrix),l.encapsulate(p.transformedAabb)),o++;this.aabb=l}return this.aabb}}class d_{constructor(o,l,p,_,f,y,T){this.id=p,this.layers=o,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=jp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,_&&(this.modelTraits|=jp.HasMapboxMeshFeatures),f&&(this.modelTraits|=jp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const E of l)this.nodesInfo.push(new tx(E)),Dy(E,T.featureIndexArray.length,T.grid),T.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,T.bucketLayerIDs.length-1,0)}updateFootprints(o,l){for(const p of this.getNodesInfo()){const _=p.node;_.footprint&&l.push({footprint:_.footprint,id:o})}}update(o){const l=0!==Object.keys(o).length;if(l&&!this.stateDependentLayers.length)return;const p=l?this.stateDependentLayers:this.layers;for(const _ of p)this.evaluate(_,o)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(o){if(!this.needsUpload)return;const l=this.getNodesInfo();for(const p of l){const _=p.node;this.uploaded?this.updatePbrBuffer(_):c_(_,o,!0)}for(const p of l)Cy(p.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(o){let l=!1;if(!o.meshes)return l;for(const p of o.meshes)p.pbrBuffer&&(p.pbrBuffer.updateData(p.featureArray),l=!0);return l}needsReEvaluation(o,l,p){const _=o.transform.projectionOptions,f=o.style.getBrightness(),y=this.brightness!==f;return!!(!this.uploaded||this.dirty||_.name!==this.projection.name||Dm(p.paint.get("model-color").value,y)||Dm(p.paint.get("model-color-mix-intensity").value,y)||Dm(p.paint.get("model-roughness").value,y)||Dm(p.paint.get("model-emissive-strength").value,y)||Dm(p.paint.get("model-height-based-emissive-strength-multiplier").value,y))&&(this.projection=_,this.brightness=f,!0)}evaluateScale(o,l){if(o.transform.zoom===this.zoom)return;this.zoom=o.transform.zoom;const p=this.getNodesInfo(),_=this.id.canonical;for(const f of p){const y=f.feature;f.evaluatedScale=l.paint.get("model-scale").evaluate(y,{},_)}}evaluate(o,l){const p=this.getNodesInfo();for(const _ of p){if(!_.node.meshes)continue;const f=_.feature,y=l&&l[f.id],T=_.node.meshes&&_.node.meshes[0].featureData,E=_.evaluatedColor[2],P=_.evaluatedRMEA[2],w=this.id.canonical;if(_.hasTranslucentParts=!1,T){for(let I=0;I<XE.length;I++){const R=XE[I];R.length&&(f.properties.part=R);const D=o.paint.get("model-color").evaluate(f,y,w).toRenderColor(null),M=o.paint.get("model-color-mix-intensity").evaluate(f,y,w);_.evaluatedColor[I]=[D.r,D.g,D.b,M],_.evaluatedRMEA[I][0]=o.paint.get("model-roughness").evaluate(f,y,w),_.evaluatedRMEA[I][2]=o.paint.get("model-emissive-strength").evaluate(f,y,w),_.evaluatedRMEA[I][3]=D.a,_.emissionHeightBasedParams[I]=o.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,y,w),!_.hasTranslucentParts&&D.a<1&&(_.hasTranslucentParts=!0)}delete f.properties.part,nx(_,E!==_.evaluatedColor[2]||P!==_.evaluatedRMEA[2],this.modelTraits)}else _.evaluatedRMEA[0][2]=o.paint.get("model-emissive-strength").evaluate(f,y,w);_.evaluatedScale=o.paint.get("model-scale").evaluate(f,y,w),this.updatePbrBuffer(_.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(o,l,p,_){const f=o.findDEMTileFor(p);if(f&&(f.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const y=Cd.create(o,p,f);if(!y)return;this.modelTraits&jp.HasMapboxMeshFeatures&&this.updateDEM(o,y,p,_);for(const T of this.getNodesInfo()){const E=T.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const P=E.footprint.vertices;let w=y.getElevationAt(P[0].x,P[0].y,!0,!0);for(let I=1;I<P.length;I++)w=Math.min(w,y.getElevationAt(P[I].x,P[I].y,!0,!0));E.elevation=w}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=l}}updateDEM(o,l,p,_){let f=l._dem._modifiedForSources[_];if(void 0===f&&(l._dem._modifiedForSources[_]=[],f=l._dem._modifiedForSources[_]),f.includes(p.canonical))return;const y=l._dem.dim;f.push(p.canonical);let T=!1;for(const E of this.getNodesInfo()){const P=E.node;if(!P.footprint||!P.footprint.grid)continue;const w=P.footprint.grid,I=l.tileCoordToPixel(w.min.x,w.min.y),R=l.tileCoordToPixel(w.max.x,w.max.y),D=Math.min(Math.min(y-R.y,I.x),Math.min(I.y,y-R.x));if(D<0)continue;const M=Bt(D,2,5);let L=Math.max(0,I.x-M),V=Math.max(0,I.y-M),j=Math.min(R.x+M,y-1),G=Math.min(R.y+M,y-1);for(let J=V;J<=G;++J)for(let ce=L;ce<=j;++ce)ku[J*y+ce]=255;let $=0,H=0;for(let J=0;J<w.cellsY;++J)for(let ce=0;ce<w.cellsX;++ce){if(!w.cells[J*w.cellsX+ce])continue;const we=l.tileCoordToPixel(w.min.x+ce/w.xScale,w.min.y+J/w.yScale),_e=l.tileCoordToPixel(w.min.x+(ce+1)/w.xScale,w.min.y+(J+1)/w.yScale);for(let be=we.y;be<=Math.min(_e.y+1,y-1);++be)for(let Z=we.x;Z<=Math.min(_e.x+1,y-1);++Z)255===ku[be*y+Z]&&(ku[be*y+Z]=0,$+=l.getElevationAtPixel(Z,be),H++)}const Y=$/H;L=Math.max(1,I.x-M),V=Math.max(1,I.y-M),j=Math.min(R.x+M,y-2),G=Math.min(R.y+M,y-2),T=!0;for(let J=V;J<=G;++J)for(let ce=L;ce<=j;++ce)0===ku[J*y+ce]&&(u_[J*y+ce]=l._dem.set(ce,J,Y));for(let J=1;J<M;++J){L=Math.max(1,I.x-J),V=Math.max(1,I.y-J),j=Math.min(R.x+J,y-2),G=Math.min(R.y+J,y-2);for(let ce=V;ce<=G;++ce)for(let we=L;we<=j;++we){const _e=ce*y+we;if(255===ku[_e]){let be=0,Z=0,de=-1,De=-1;for(let Be=-1;Be<=1;++Be)for(let je=-1;je<=1;++je){const Xe=(ce+Be)*y+we+je;if(ku[Xe]>=J)continue;const it=u_[Xe],at=Math.abs(it);at>Z&&(be=it,Z=at,de=je,De=Be)}if(Z>.1){const Be=1-(J+.5*Math.abs(de*De))/M;let je=l._dem.get(we,ce)+be*Be;const Xe=l._dem.get(we+de,ce+De),it=l._dem.get(we-de,ce-De,!0);(je-Xe)*(je-it)>0&&(je=(Xe+it)/2),u_[_e]=l._dem.set(we,ce,je),ku[_e]=J}}}}}T&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=hn.now())}getNodesInfo(){return this.nodesInfo}destroy(){const o=this.getNodesInfo();for(const l of o)Cy(l.node),ex(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(o,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const p=l.getReplacementRegionsForTile(o.toUnwrapped()),_=this.getNodesInfo();for(let f=0;f<this.nodesInfo.length;f++){const y=_[f].node;_[f].hiddenByReplacement=!!y.footprint&&!p.find(T=>T.footprint===y.footprint)}}getHeightAtTileCoord(o,l){const p=this.getNodesInfo(),_=[],f=[0,0,0],y=Q.mat4.identity([]);for(let T=0;T<this.nodesInfo.length;T++){const E=p[T],P=E.node.meshes[0],w=P.transformedAabb;if(o<w.min[0]||l<w.min[1]||o>w.max[0]||l>w.max[1])continue;if(!0===E.node.hidden)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};Q.mat4.invert(y,E.node.matrix),f[0]=o,f[1]=l,Q.vec3.transformMat4(f,f,y);const I=(f[0]-P.aabb.min[0])/(P.aabb.max[0]-P.aabb.min[0])*64|0,R=64*Math.min(63,(f[1]-P.aabb.min[1])/(P.aabb.max[1]-P.aabb.min[1])*64|0)+Math.min(63,I),D=P.heightmap[R];if(!(D<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:D,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new Ht(o,l),new Ht(o,l),_),_.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function Dm(u,o){return!u.isLightConstant&&o}function fS(u,o,l,p,_,f,y,T){let E=(61440&o|(61440&o)>>4)>>8,P=(3840&o|(3840&o)>>4)>>4,w=240&o|(240&o)>>4;l[3]>0&&(E=ni(E,255*l[0],l[3]),P=ni(P,255*l[1],l[3]),w=ni(w,255*l[2],l[3]));const I=E<<8|P,R=w<<8|Math.floor(255*p[3]),D=function(J){const ce=Bt(J,0,2);return Math.min(Math.round(.5*ce*255),255)}(p[2])<<8|15*p[0]<<4|15*p[1],M=Bt(_[0],0,1),L=Bt(_[1],0,1),V=Bt(_[2],0,1),j=Bt(_[3],0,1);let G,$,H,Y;if(M!==L&&y!==f&&L!==M){const J=y-f;$=1/(J*(L-M)),H=-(f+J*M)/(J*(L-M));const ce=Bt(_[4],-1,1);Y=Math.pow(10,ce),G=255*V<<8|255*j}else G=65535,$=0,H=1,Y=1;if(u.emplaceBack(I,R,D,G,$,H,Y),T){const J=T.length;T.clear();for(let ce=0;ce<J;ce++)T.emplaceBack(I,R,D,G,$,H,Y)}}function nx(u,o,l){const p=u.node;let _=0;const f=l&jp.HasMeshoptCompression;for(const y of p.meshes){if(p.lights&&p.lightMeshIndex===_||!y.featureData)continue;y.featureArray=new Dg,y.featureArray.reserve(y.featureData.length);let T=o;for(const E of y.featureData){const P=f?65535&E:E>>16&65535,w=f?E>>16&65535:65535&E,I=(15&w)<8?15&w:0,R=u.evaluatedRMEA[I],D=u.evaluatedColor[I],M=u.emissionHeightBasedParams[I];let L;if(T&&2===I&&p.lights&&(L=new Dg,L.resize(10*p.lights.length)),fS(y.featureArray,P,D,R,M,y.aabb.min[2],y.aabb.max[2],L),L&&T){T=!1;const V=p.meshes[p.lightMeshIndex];V.featureArray=L,V.featureArray._trim()}}y.featureArray._trim(),_++}}Tn(d_,"Tiled3dModelBucket",{omit:["layers"]}),Tn(tx,"Tiled3dModelFeature");const Dd=["id","tile","layer","source","sourceLayer","state"];class Th{constructor(o,l,p,_,f){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=p,this._y=_,this.properties=o.properties,this.id=f}clone(){const o=new Th(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(o.state={...this.state}),this.layer&&(o.layer={...this.layer}),this.namespace&&(o.namespace=this.namespace),o}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const l of Dd)void 0!==this[l]&&(o[l]=this[l]);return o}}function h_(u,o,l,p){const _=1<<u.z;o.lat=xe((p/an+u.y)/_),o.lng=ge((l/an+u.x)/_)}const p_={circle:class extends Ta{constructor(u,o,l,p){super(u,{layout:xr||(xr=new $r({"circle-sort-key":new Bn(ot.layout_circle["circle-sort-key"]),visibility:new Qt(ot.layout_circle.visibility)})),paint:po||(po=new $r({"circle-radius":new Bn(ot.paint_circle["circle-radius"]),"circle-color":new Bn(ot.paint_circle["circle-color"]),"circle-blur":new Bn(ot.paint_circle["circle-blur"]),"circle-opacity":new Bn(ot.paint_circle["circle-opacity"]),"circle-translate":new Qt(ot.paint_circle["circle-translate"]),"circle-translate-anchor":new Qt(ot.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qt(ot.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qt(ot.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bn(ot.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bn(ot.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bn(ot.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Qt(ot.paint_circle["circle-emissive-strength"])}))},o,l,p)}createBucket(u){return new Ut(u)}queryRadius(u){const o=u;return zr("circle-radius",this,o)+zr("circle-stroke-width",this,o)+Bi(this.paint.get("circle-translate"))}queryIntersectsFeature(u,o,l,p,_,f,y,T){const E=Er(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return gh(u,p,f,y,T,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,P)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,o,l){const p=Xv(this);return{config:new Ja(this,{zoom:o,lut:l}),defines:p,overrideFog:!1}}},heatmap:class extends Ta{createBucket(u){return new Og(u)}constructor(u,o,l,p){super(u,{layout:sw||(sw=new $r({visibility:new Qt(ot.layout_heatmap.visibility)})),paint:Yv||(Yv=new $r({"heatmap-radius":new Bn(ot.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bn(ot.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qt(ot.paint_heatmap["heatmap-intensity"]),"heatmap-color":new cc(ot.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qt(ot.paint_heatmap["heatmap-opacity"])}))},o,l,p),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){"heatmap-color"===u&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Tp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(u){return zr("heatmap-radius",this,u)}queryIntersectsFeature(u,o,l,p,_,f,y,T){const E=this.paint.get("heatmap-radius").evaluate(o,l);return gh(u,p,f,y,T,!0,!0,new Ht(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,o,l){return"heatmap"===u?{config:new Ja(this,{zoom:o,lut:l}),overrideFog:!1}:{}}},hillshade:class extends Ta{constructor(u,o,l,p){super(u,{layout:Jv||(Jv=new $r({visibility:new Qt(ot.layout_hillshade.visibility)})),paint:Kv||(Kv=new $r({"hillshade-illumination-direction":new Qt(ot.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qt(ot.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qt(ot.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qt(ot.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qt(ot.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qt(ot.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Qt(ot.paint_hillshade["hillshade-emissive-strength"])}))},o,l,p)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,o,l){return{overrideFog:!1}}},fill:class extends Ta{constructor(u,o,l,p){super(u,{layout:uw||(uw=new $r({"fill-sort-key":new Bn(ot.layout_fill["fill-sort-key"]),visibility:new Qt(ot.layout_fill.visibility),"fill-elevation-reference":new Qt(ot.layout_fill["fill-elevation-reference"])})),paint:dw||(dw=new $r({"fill-antialias":new Qt(ot.paint_fill["fill-antialias"]),"fill-opacity":new Bn(ot.paint_fill["fill-opacity"]),"fill-color":new Bn(ot.paint_fill["fill-color"]),"fill-outline-color":new Bn(ot.paint_fill["fill-outline-color"]),"fill-translate":new Qt(ot.paint_fill["fill-translate"]),"fill-translate-anchor":new Qt(ot.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bn(ot.paint_fill["fill-pattern"]),"fill-emissive-strength":new Qt(ot.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Bn(ot.paint_fill["fill-z-offset"])}))},o,l,p)}getProgramIds(){const u=this.paint.get("fill-pattern"),o=u&&u.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(u,o,l){return{config:new Ja(this,{zoom:o,lut:l}),overrideFog:!1}}recalculate(u,o){super.recalculate(u,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new s0(u)}queryRadius(){return Bi(this.paint.get("fill-translate"))}queryIntersectsFeature(u,o,l,p,_,f){return!u.queryGeometry.isAboveHorizon&&Ln(Or(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),p)}isTileClipped(){return!0}is3D(){return 0!==this.paint.get("fill-z-offset").constantOr(1)}},"fill-extrusion":class extends Ta{constructor(u,o,l,p){super(u,{layout:Pw||(Pw=new $r({visibility:new Qt(ot["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Qt(ot["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:kw||(kw=new $r({"fill-extrusion-opacity":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bn(ot["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bn(ot["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Bn(ot["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bn(ot["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Bn(ot["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Bn(ot["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Bn(ot["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Bn(ot["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Qt(ot["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},o,l,p),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new Xb(u)}queryRadius(){return Bi(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,o,l,p,_,f,y,T,E){const P=Er(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),w=this.paint.get("fill-extrusion-height").evaluate(o,l),I=this.paint.get("fill-extrusion-base").evaluate(o,l),R=[0,0],D=T&&f.elevation,M=f.elevation?f.elevation.exaggeration():1,L=u.tile.getBucket(this);if(D&&L instanceof Xb){const H=L.centroidVertexArray,Y=E+1;Y<H.length&&(R[0]=H.geta_centroid_pos0(Y),R[1]=H.geta_centroid_pos1(Y))}if(0===R[0]&&1===R[1])return!1;"globe"===f.projection.name&&(p=Rp([p],[new Ht(0,0),new Ht(an,an)],u.tileID.canonical).map(H=>H.polygon).flat());const V=D?T:null,[j,G]=(Y=p,J=I,ce=w,we=P,_e=y,be=V,Z=R,de=M,De=f.center.lat,"globe"===(H=f).projection.name?function(je,Xe,it,at,et,It,Xt,vt,yn,ln,Kt){const Gt=[],Hn=[],gn=je.projection.upVectorScale(Kt,je.center.lat,je.worldSize).metersToTile,Dn=[0,0,0,1],hi=[0,0,0,1],Ti=(_i,Vi,Li,Jr)=>{_i[0]=Vi,_i[1]=Li,_i[2]=Jr,_i[3]=1},Ii=y0();it>0&&(it+=Ii),at+=Ii;for(const _i of Xe){const Vi=[],Li=[];for(const Jr of _i){const Fr=Jr.x+et.x,ri=Jr.y+et.y,Sr=je.projection.projectTilePoint(Fr,ri,Kt),Tr=je.projection.upVector(Kt,Jr.x,Jr.y);let ro=it,Vo=at;if(Xt){const Ko=Lw(Fr,ri,it,at,Xt,vt,yn,ln);ro+=Ko.base,Vo+=Ko.top}0!==it?Ti(Dn,Sr.x+Tr[0]*gn*ro,Sr.y+Tr[1]*gn*ro,Sr.z+Tr[2]*gn*ro):Ti(Dn,Sr.x,Sr.y,Sr.z),Ti(hi,Sr.x+Tr[0]*gn*Vo,Sr.y+Tr[1]*gn*Vo,Sr.z+Tr[2]*gn*Vo),Q.vec3.transformMat4(Dn,Dn,It),Q.vec3.transformMat4(hi,hi,It),Vi.push(new Ip(Dn[0],Dn[1],Dn[2])),Li.push(new Ip(hi[0],hi[1],hi[2]))}Gt.push(Vi),Hn.push(Li)}return[Gt,Hn]}(H,Y,J,ce,we,_e,be,Z,de,De,u.tileID.canonical):be?function(je,Xe,it,at,et,It,Xt,vt,yn){const ln=[],Kt=[],Gt=[0,0,0,1];for(const Hn of je){const gn=[],Dn=[];for(const hi of Hn){const Ti=hi.x+at.x,Ii=hi.y+at.y,_i=Lw(Ti,Ii,Xe,it,It,Xt,vt,yn);Gt[0]=Ti,Gt[1]=Ii,Gt[2]=_i.base,Gt[3]=1,Q.vec4.transformMat4(Gt,Gt,et),Gt[3]=Math.max(Gt[3],1e-5);const Vi=new Ip(Gt[0]/Gt[3],Gt[1]/Gt[3],Gt[2]/Gt[3]);Gt[0]=Ti,Gt[1]=Ii,Gt[2]=_i.top,Gt[3]=1,Q.vec4.transformMat4(Gt,Gt,et),Gt[3]=Math.max(Gt[3],1e-5);const Li=new Ip(Gt[0]/Gt[3],Gt[1]/Gt[3],Gt[2]/Gt[3]);gn.push(Vi),Dn.push(Li)}ln.push(gn),Kt.push(Dn)}return[ln,Kt]}(Y,J,ce,we,_e,be,Z,de,De):function(je,Xe,it,at,et){const It=[],Xt=[],vt=et[8]*Xe,yn=et[9]*Xe,ln=et[10]*Xe,Kt=et[11]*Xe,Gt=et[8]*it,Hn=et[9]*it,gn=et[10]*it,Dn=et[11]*it;for(const hi of je){const Ti=[],Ii=[];for(const _i of hi){const Vi=_i.x+at.x,Li=_i.y+at.y,Jr=et[0]*Vi+et[4]*Li+et[12],Fr=et[1]*Vi+et[5]*Li+et[13],ri=et[2]*Vi+et[6]*Li+et[14],Sr=et[3]*Vi+et[7]*Li+et[15],Tr=Jr+vt,ro=Fr+yn,Vo=ri+ln,Ko=Math.max(Sr+Kt,1e-5),jo=Jr+Gt,Lo=Fr+Hn,Xo=ri+gn,as=Math.max(Sr+Dn,1e-5);Ti.push(new Ip(Tr/Ko,ro/Ko,Vo/Ko)),Ii.push(new Ip(jo/as,Lo/as,Xo/as))}It.push(Ti),Xt.push(Ii)}return[It,Xt]}(Y,J,ce,we,_e)),$=u.queryGeometry;var H,Y,J,ce,we,_e,be,Z,de,De;return function(H,Y,J){let ce=1/0;Ln(J,Y)&&(ce=Qb(J,Y[0]));for(let we=0;we<Y.length;we++){const _e=Y[we],be=H[we];for(let Z=0;Z<_e.length-1;Z++){const de=_e[Z],De=[de,_e[Z+1],be[Z+1],be[Z],de];Lt(J,De)&&(ce=Math.min(ce,Qb(J,De)))}}return ce!==1/0&&ce}(j,G,$.isPointQuery()?$.screenBounds:$.screenGeometry)}},line:class extends Ta{constructor(u,o,l,p){const _=jw();super(u,_,o,l,p),_.layout&&(this.layout=new lc(_.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(u){if("line-gradient"===u){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Nf,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,o){super.recalculate(u,o),this.paint._values["line-floorwidth"]=(()=>{if(Xg)return Xg;const l=jw();return Xg=new cE(l.paint.properties["line-width"].specification),Xg.useIntegerZoom=!0,Xg})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new Lp(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,o,l){const p=Vw(this);return{config:new Ja(this,{zoom:o,lut:l}),defines:p,overrideFog:!1}}queryRadius(u){const o=u,l=Uw(zr("line-width",this,o),zr("line-gap-width",this,o)),p=zr("line-offset",this,o);return l/2+Math.abs(p)+Bi(this.paint.get("line-translate"))}queryIntersectsFeature(u,o,l,p,_,f){if(u.queryGeometry.isAboveHorizon)return!1;const y=Or(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),T=u.pixelToTileUnitsFactor/2*Uw(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),E=this.paint.get("line-offset").evaluate(o,l);return E&&(p=function(P,w){const I=[],R=new Ht(0,0);for(let D=0;D<P.length;D++){const M=P[D],L=[];for(let V=0;V<M.length;V++){const j=M[V],G=M[V+1],$=0===V?R:j.sub(M[V-1])._unit()._perp(),H=V===M.length-1?R:G.sub(j)._unit()._perp(),Y=$._add(H)._unit();Y._mult(1/(Y.x*H.x+Y.y*H.y)),L.push(Y._mult(w)._add(j))}I.push(L)}return I}(p,E*u.pixelToTileUnitsFactor)),function(P,w,I){for(let R=0;R<w.length;R++){const D=w[R];if(P.length>=3)for(let M=0;M<D.length;M++)if(Xi(P,D[M]))return!0;if(zn(P,D,I))return!0}return!1}(y,p,T)}isTileClipped(){return!0}isDraped(u){const o=this.layout.get("line-z-offset"),l=o.isConstant()&&!o.constantOr(0),p=this.layout.get("line-elevation-reference");return!("sea"===p||"ground"===p)&&(l||"none"!==p)}},symbol:Wc,background:class extends Ta{constructor(u,o,l,p){super(u,{layout:H0||(H0=new $r({visibility:new Qt(ot.layout_background.visibility)})),paint:eS||(eS=new $r({"background-pitch-alignment":new Qt(ot.paint_background["background-pitch-alignment"]),"background-color":new Qt(ot.paint_background["background-color"]),"background-pattern":new Qt(ot.paint_background["background-pattern"]),"background-opacity":new Qt(ot.paint_background["background-opacity"]),"background-emissive-strength":new Qt(ot.paint_background["background-emissive-strength"])}))},o,l,p)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,o,l){return{overrideFog:!1}}is3D(){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:yy,"raster-particle":rS,sky:class extends Ta{constructor(u,o,l,p){super(u,{layout:xy||(xy=new $r({visibility:new Qt(ot.layout_sky.visibility)})),paint:iS||(iS=new $r({"sky-type":new Qt(ot.paint_sky["sky-type"]),"sky-atmosphere-sun":new Qt(ot.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Qt(ot.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Qt(ot.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Qt(ot.paint_sky["sky-gradient-radius"]),"sky-gradient":new cc(ot.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Qt(ot.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Qt(ot.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Qt(ot.paint_sky["sky-opacity"])}))},o,l,p),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){"sky-gradient"===u?this._updateColorRamp():"sky-atmosphere-sun"!==u&&"sky-atmosphere-halo-color"!==u&&"sky-atmosphere-color"!==u&&"sky-atmosphere-sun-intensity"!==u||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Tp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(u,o){if("atmosphere"===this.paint.get("sky-type")){const p=this.paint.get("sky-atmosphere-sun"),_=!p,f=u.style.light,y=f.properties.get("position");return _&&"viewport"===f.properties.get("anchor")&&Ki("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),_?Z0(y.azimuthal,90-y.polar,o):Z0(p[0],90-p[1],o)}const l=this.paint.get("sky-gradient-center");return Z0(l[0],90-l[1],o)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return"atmosphere"===u?["skyboxCapture","skybox"]:"gradient"===u?["skyboxGradient"]:null}},slot:class extends Ta{constructor(u,o,l,p){super(u,{paint:zE||(zE=new $r({}))},o,null)}},model:class extends Ta{constructor(u,o,l,p){super(u,{layout:dS||(dS=new $r({visibility:new Qt(ot.layout_model.visibility),"model-id":new Bn(ot.layout_model["model-id"])})),paint:hS||(hS=new $r({"model-opacity":new Qt(ot.paint_model["model-opacity"]),"model-rotation":new Bn(ot.paint_model["model-rotation"]),"model-scale":new Bn(ot.paint_model["model-scale"]),"model-translation":new Bn(ot.paint_model["model-translation"]),"model-color":new Bn(ot.paint_model["model-color"]),"model-color-mix-intensity":new Bn(ot.paint_model["model-color-mix-intensity"]),"model-type":new Qt(ot.paint_model["model-type"]),"model-cast-shadows":new Qt(ot.paint_model["model-cast-shadows"]),"model-receive-shadows":new Qt(ot.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Qt(ot.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Bn(ot.paint_model["model-emissive-strength"]),"model-roughness":new Bn(ot.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Bn(ot.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Qt(ot.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Qt(ot.paint_model["model-front-cutoff"])}))},o,l,p),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new a_(u)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof d_?8191:0}queryIntersectsFeature(u,o,l,p,_,f){if(!this.modelManager)return!1;const y=this.modelManager,T=u.tile.getBucket(this);if(!(T&&T instanceof a_))return!1;const E=T;for(const P in E.instancesPerModel){const w=E.instancesPerModel[P],I=void 0!==o.id?o.id:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0;if(w.idToFeaturesIndex.hasOwnProperty(I)){const R=w.features[w.idToFeaturesIndex[I]],D=y.getModel(P,this.scope);if(!D)return!1;let M=Q.mat4.create();const L=new N(0,0),V=E.canonical;let j=Number.MAX_VALUE;for(let G=0;G<R.instancedDataCount;++G){const $=16*(R.instancedDataOffset+G),H=w.instancedDataArray.float32,Y=[H[$+4],H[$+5],H[$+6]];h_(V,L,H[$],0|H[$+1]),pS(M,D,f,L,R.rotation,R.scale,Y,!1,!1,!1),"globe"===f.projection.name&&(M=o_(M,f));const J=Q.mat4.multiply([],f.projMatrix,M),ce=u.queryGeometry,we=K0(ce.isPointQuery()?ce.screenBounds:ce.screenGeometry,f,J,D.aabb);null!=we&&(j=Math.min(we,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(u,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven()||"model-color"!==u&&"model-color-mix-intensity"!==u&&"model-rotation"!==u&&"model-scale"!==u&&"model-translation"!==u&&"model-emissive-strength"!==u)}_isPropertyZoomDependent(u){const o=this._transitionablePaint._values[u];return null!=o&&null!=o.value&&null!=o.value.expression&&o.value.expression instanceof Hf}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(u,o,l,p){const _=u.tile,f=_.getBucket(this);let y=null,T=Number.MAX_VALUE;if(!(f&&f instanceof d_))return{queryFeature:y,intersectionZ:T};const E=f.getNodesInfo()[o];if(E.hiddenByReplacement||!E.node.meshes||!l.filter(new Po(_.tileID.overscaledZ),E.feature,_.tileID.canonical))return{queryFeature:y,intersectionZ:T};const P=E.node,w=p.calculatePosMatrix(_.tileID.toUnwrapped(),p.worldSize),I=E.evaluatedScale;let R=0;p.elevation&&P.elevation&&(R=P.elevation*p.elevation.exaggeration()),Q.mat4.translate(w,w,[(P.anchor?P.anchor[0]:0)*(I[0]-1),(P.anchor?P.anchor[1]:0)*(I[1]-1),R]),Q.mat4.scale(w,w,I);const D=u.queryGeometry,M=D.isPointQuery()?D.screenBounds:D.screenGeometry,L=function(H){const Y=Q.mat4.multiply([],w,H.matrix);Q.mat4.multiply(Y,p.expandedFarZProjMatrix,Y);for(let J=0;J<H.meshes.length;++J){const ce=H.meshes[J];if(J===H.lightMeshIndex)continue;const we=K0(M,p,Y,ce.aabb);null!=we&&(T=Math.min(we,T))}if(H.children)for(const J of H.children)L(J)};if(L(P),T===Number.MAX_VALUE)return{queryFeature:y,intersectionZ:T};const V=new N(0,0);h_(_.tileID.canonical,V,E.node.anchor[0],E.node.anchor[1]);const{z:j,x:G,y:$}=_.tileID.canonical;return y=new Th({},j,G,$,E.feature.id),y.properties=E.feature.properties,y.geometry={type:"Point",coordinates:[V.lng,V.lat]},y.layer={...this.serialize(),id:this.fqid},y.state={},y.tile=_.tileID.canonical,{queryFeature:y,intersectionZ:T}}},clip:class extends Ta{constructor(u,o,l,p){super(u,{layout:hw||(hw=new $r({"clip-layer-types":new Qt(ot.layout_clip["clip-layer-types"]),"clip-layer-scope":new Qt(ot.layout_clip["clip-layer-scope"])})),paint:pw||(pw=new $r({}))},o,l,p)}recalculate(u,o){super.recalculate(u,o)}createBucket(u){return new fw(u)}isTileClipped(){return!0}is3D(){return!0}}};class ZE{constructor(o){this._callback=o,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ix{constructor(){this.tasks={},this.taskQueue=[],Dc(["process"],this),this.invoker=new ZE(this.process),this.nextId=0}add(o,l){const p=this.nextId++,_=function({type:f,isSymbolTile:y,zoom:T}){return T=T||0,"message"===f?0:"maybePrepare"!==f||y?"parseTile"!==f||y?"parseTile"===f&&y?300-T:"maybePrepare"===f&&y?400-T:500:200-T:100-T}(l);if(0===_){try{o()}finally{}return null}return this.tasks[p]={fn:o,metadata:l,priority:_,id:p},this.taskQueue.push(p),this.invoker.trigger(),{cancel:()=>{delete this.tasks[p]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(p=>!!this.tasks[p]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let _=0;_<this.taskQueue.length;_++){const f=this.tasks[this.taskQueue[_]];f.priority<l&&(l=f.priority,o=_)}if(null===o)return null;const p=this.taskQueue[o];return this.taskQueue.splice(o,1),p}remove(){this.invoker.remove()}}class rx{constructor(o,l,p){this.target=o,this.parent=l,this.mapId=p,this.callbacks={},this.cancelCallbacks={},Dc(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new ix}send(o,l,p,_,f=!1,y){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);p&&(p.metadata=y,this.callbacks[T]=p);const E=new Set;return this.target.postMessage({id:T,type:o,hasCallback:!!p,targetMapId:_,mustQueue:f,sourceMapId:this.mapId,data:rd(l,E)},E),{cancel:()=>{p&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:_,sourceMapId:this.mapId})}}}receive(o){const l=o.data,p=l.id;if(p&&(!l.targetMapId||this.mapId===l.targetMapId))if("<cancel>"===l.type){const _=this.cancelCallbacks[p];delete this.cancelCallbacks[p],_&&_.cancel()}else if(l.mustQueue||Zu()){const _=this.callbacks[p],f=this.scheduler.add(()=>this.processTask(p,l),_&&_.metadata||{type:"message"});f&&(this.cancelCallbacks[p]=f)}else this.processTask(p,l)}processTask(o,l){if(delete this.cancelCallbacks[o],"<response>"===l.type){const p=this.callbacks[o];delete this.callbacks[o],p&&(l.error?p(ac(l.error)):p(null,ac(l.data)))}else{const p=new Set,_=l.hasCallback?(y,T)=>{this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:y?rd(y):null,data:rd(T,p)},p)}:()=>{},f=ac(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,f,_);else if(this.parent.getWorkerSource){const y=l.type.split(".");this.parent.getWorkerSource(l.sourceMapId,y[0],f.source,f.scope)[y[1]](f,_)}else _(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let ox=(()=>{class u{constructor(l,p){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=Eo();const _=this.workerPool.acquire(this.id);for(let f=0;f<_.length;f++){const y=new u.Actor(_[f],p,this.id);y.name=`Worker ${f}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,p,_){kr(this.actors,(f,y)=>{f.send(l,p,y)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}return u.Actor=rx,u})();class mS{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const p=this.toIdx(o,l);return{min:this.minimums[p],max:this.maximums[p]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function Em(u,o,l,p){let _=0,f=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(p[y])<1e-15){if(l[y]<u[y]||l[y]>o[y])return null}else{const T=1/p[y];let E=(u[y]-l[y])*T,P=(o[y]-l[y])*T;if(E>P){const w=E;E=P,P=w}if(E>_&&(_=E),P<f&&(f=P),_>f)return null}return _}function gS(u,o,l,p,_,f,y,T,E,P,w){const I=p-u,R=_-o,D=f-l,M=y-u,L=T-o,V=E-l,j=w[1]*V-w[2]*L,G=w[2]*M-w[0]*V,$=w[0]*L-w[1]*M,H=I*j+R*G+D*$;if(Math.abs(H)<1e-15)return null;const Y=1/H,J=P[0]-u,ce=P[1]-o,we=P[2]-l,_e=(J*j+ce*G+we*$)*Y;if(_e<0||_e>1)return null;const be=ce*D-we*R,Z=we*I-J*D,de=J*R-ce*I,De=(w[0]*be+w[1]*Z+w[2]*de)*Y;return De<0||_e+De>1?null:(M*be+L*Z+V*de)*Y}function YE(u,o,l){return(u-o)/(l-o)}function _S(u,o,l,p,_,f,y,T,E){const P=1<<l,w=f-p,I=y-_,R=(u+1)/P*w+p,D=(o+0)/P*I+_,M=(o+1)/P*I+_;T[0]=(u+0)/P*w+p,T[1]=D,E[0]=R,E[1]=M}class JE{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(f){const y=Math.ceil(Math.log2(f.dim/8)),T=[];let E=Math.ceil(Math.pow(2,y));const P=1/E,w=(D,M,L,V,j)=>{const G=V?1:0,$=(D+1)*L-G,H=M*L,Y=(M+1)*L-G;j[0]=D*L,j[1]=H,j[2]=$,j[3]=Y};let I=new mS(E);const R=[];for(let D=0;D<E*E;D++){w(D%E,Math.floor(D/E),P,!1,R);const M=Ch(R[0],R[1],f),L=Ch(R[2],R[1],f),V=Ch(R[2],R[3],f),j=Ch(R[0],R[3],f);I.minimums.push(Math.min(M,L,V,j)),I.maximums.push(Math.max(M,L,V,j)),I.leaves.push(1)}for(T.push(I),E/=2;E>=1;E/=2){const D=T[T.length-1];I=new mS(E);for(let M=0;M<E*E;M++){w(M%E,Math.floor(M/E),2,!0,R);const L=D.getElevation(R[0],R[1]),V=D.getElevation(R[2],R[1]),j=D.getElevation(R[2],R[3]),G=D.getElevation(R[0],R[3]),$=D.isLeaf(R[0],R[1]),H=D.isLeaf(R[2],R[1]),Y=D.isLeaf(R[2],R[3]),J=D.isLeaf(R[0],R[3]),ce=Math.min(L.min,V.min,j.min,G.min),we=Math.max(L.max,V.max,j.max,G.max),_e=$&&H&&Y&&J;I.maximums.push(we),I.minimums.push(ce),I.leaves.push(we-ce<=5&&_e?1:0)}T.push(I)}return T}(this.dem),p=l.length-1,_=l[p];this._addNode(_.minimums[0],_.maximums[0],_.leaves[0]),this._construct(l,0,0,p,0)}raycastRoot(o,l,p,_,f,y,T=1){return Em([o,l,-100],[p,_,this.maximums[0]*T],f,y)}raycast(o,l,p,_,f,y,T=1){if(!this.nodeCount)return null;const E=this.raycastRoot(o,l,p,_,f,y,T);if(null==E)return null;const P=[],w=[],I=[],R=[],D=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:M,t:L,nodex:V,nodey:j,depth:G}=D.pop();if(this.leaves[M]){_S(V,j,G,o,l,p,_,I,R);const H=1<<G,Y=(V+0)/H,J=(V+1)/H,ce=(j+0)/H,we=(j+1)/H,_e=Ch(Y,ce,this.dem)*T,be=Ch(J,ce,this.dem)*T,Z=Ch(J,we,this.dem)*T,de=Ch(Y,we,this.dem)*T,De=gS(I[0],I[1],_e,R[0],I[1],be,R[0],R[1],Z,f,y),Be=gS(R[0],R[1],Z,I[0],R[1],de,I[0],I[1],_e,f,y),je=Math.min(null!==De?De:Number.MAX_VALUE,null!==Be?Be:Number.MAX_VALUE);if(je!==Number.MAX_VALUE)return je;{const Xe=Q.vec3.scaleAndAdd([],f,y,L);if(bS(_e,be,de,Z,YE(Xe[0],I[0],R[0]),YE(Xe[1],I[1],R[1]))>=Xe[2])return L}continue}let $=0;for(let H=0;H<this._siblingOffset.length;H++){_S((V<<1)+this._siblingOffset[H][0],(j<<1)+this._siblingOffset[H][1],G+1,o,l,p,_,I,R),I[2]=-100,R[2]=this.maximums[this.childOffsets[M]+H]*T;const Y=Em(I,R,f,y);if(null!=Y){const J=Y;P[H]=J;let ce=!1;for(let we=0;we<$&&!ce;we++)J>=P[w[we]]&&(w.splice(we,0,H),ce=!0);ce||(w[$]=H),$++}}for(let H=0;H<$;H++){const Y=w[H];D.push({idx:this.childOffsets[M]+Y,t:P[Y],nodex:(V<<1)+this._siblingOffset[Y][0],nodey:(j<<1)+this._siblingOffset[Y][1],depth:G+1})}}return null}_addNode(o,l,p){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(p),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,p,_,f){if(1===o[_].isLeaf(l,p))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const y=_-1,T=o[y];let E=0,P=0;for(let w=0;w<this._siblingOffset.length;w++){const I=2*l+this._siblingOffset[w][0],R=2*p+this._siblingOffset[w][1],D=T.getElevation(I,R),M=T.isLeaf(I,R),L=this._addNode(D.min,D.max,M);M&&(E|=1<<w),P||(P=L)}for(let w=0;w<this._siblingOffset.length;w++)E&1<<w||this._construct(o,2*l+this._siblingOffset[w][0],2*p+this._siblingOffset[w][1],y,P+w)}}function bS(u,o,l,p,_,f){return ni(ni(u,l,f),ni(o,p,f),_)}function Ch(u,o,l){const p=l.dim,_=Bt(u*p-.5,0,p-1),f=Bt(o*p-.5,0,p-1),y=Math.floor(_),T=Math.floor(f),E=Math.min(y+1,p-1),P=Math.min(T+1,p-1);return bS(l.get(y,T),l.get(E,T),l.get(y,P),l.get(E,P),_-y,f-T)}const KE={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function yS(u,o,l){return(256*u*256+256*o+l)/10-1e4}function Un(u,o,l){return 256*u+o+l/256-32768}class Ey{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,p,_=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(p&&"mapbox"!==p&&"terrarium"!==p)return void Ki(`"${p}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const f=this.dim=l.height-2,y=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=_,this._modifiedForSources={},!_){for(let E=0;E<f;E++)y[this._idx(-1,E)]=y[this._idx(0,E)],y[this._idx(f,E)]=y[this._idx(f-1,E)],y[this._idx(E,-1)]=y[this._idx(E,0)],y[this._idx(E,f)]=y[this._idx(E,f-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(f,-1)]=y[this._idx(f-1,0)],y[this._idx(-1,f)]=y[this._idx(0,f-1)],y[this._idx(f,f)]=y[this._idx(f-1,f-1)]}const T="terrarium"===p?Un:yS;for(let E=0;E<y.length;++E){const P=4*E;this.floatView[E]=T(this.pixels[P],this.pixels[P+1],this.pixels[P+2])}this._timestamp=hn.now()}_buildQuadTree(){this._tree=new JE(this)}get(o,l,p=!1){p&&(o=Bt(o,-1,this.dim),l=Bt(l,-1,this.dim));const _=this._idx(o,l);return this.floatView[_]}set(o,l,p){const _=this._idx(o,l),f=this.floatView[_];return this.floatView[_]=p,p-f}static getUnpackVector(o){return KE[o]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}static pack(o,l){const p=[0,0,0,0],_=Ey.getUnpackVector(l);let f=Math.floor((o+_[3])/_[2]);return p[2]=f%256,f=Math.floor(f/256),p[1]=f%256,f=Math.floor(f/256),p[0]=f,p}getPixels(){return new Bb({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,p){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let _=l*this.dim,f=l*this.dim+this.dim,y=p*this.dim,T=p*this.dim+this.dim;switch(l){case-1:_=f-1;break;case 1:f=_+1}switch(p){case-1:y=T-1;break;case 1:T=y+1}const E=-l*this.dim,P=-p*this.dim;for(let w=y;w<T;w++)for(let I=_;I<f;I++){const R=4*this._idx(I,w),D=4*this._idx(I+E,w+P);this.pixels[R+0]=o.pixels[D+0],this.pixels[R+1]=o.pixels[D+1],this.pixels[R+2]=o.pixels[D+2],this.pixels[R+3]=o.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function sx(u,o,l){var p,_;1===u?o.headerLength=l.readFixed32():2===u?o.x=l.readVarint():3===u?o.y=l.readVarint():4===u?o.z=l.readVarint():5===u&&o.layers.push((p=l,_=l.readVarint()+l.pos,p.readFields(iI,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},_)))}function QE(u,o,l){var p,_;1===u?(o.delta_filter=(p=l,_=l.readVarint()+l.pos,p.readFields(eI,{blockSize:0},_)),o.filter="delta_filter"):2===u?(l.readVarint(),o.filter="zigzag_filter"):3===u?(l.readVarint(),o.filter="bitshuffle_filter"):4===u&&(l.readVarint(),o.filter="byteshuffle_filter")}function eI(u,o,l){1===u&&(o.blockSize=l.readVarint())}function tI(u,o,l){1===u?(l.readVarint(),o.codec="gzip_data"):2===u?(l.readVarint(),o.codec="jpeg_image"):3===u?(l.readVarint(),o.codec="webp_image"):4===u&&(l.readVarint(),o.codec="png_image")}function nI(u,o,l){let p=0,_=0;var f,y;1===u?o.firstByte=l.readFixed64():2===u?o.lastByte=l.readFixed64():3===u?o.filters.push((f=l,y=l.readVarint()+l.pos,f.readFields(QE,{},y))):4===u?o.codec=function(f,y){return f.readFields(tI,{},y)}(l,l.readVarint()+l.pos):5===u?_=l.readFloat():6===u?p=l.readFloat():7===u?o.bands.push(l.readString()):8===u?o.offset=l.readDouble():9===u&&(o.scale=l.readDouble()),0===o.offset&&(o.offset=_),0===o.scale&&(o.scale=p)}function iI(u,o,l){var p,_;1===u?o.version=l.readVarint():2===u?o.name=l.readString():3===u?o.units=l.readString():4===u?o.tileSize=l.readVarint():5===u?o.buffer=l.readVarint():6===u?o.pixelFormat=l.readVarint():7===u&&o.dataIndex.push((p=l,_=l.readVarint()+l.pos,p.readFields(nI,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},_)))}function rI(u,o,l){if(2===u)p=l,_=l.readVarint()+l.pos,p.readFields(Iy,o,_);else if(3===u)throw new Error("Not implemented");var p,_}function Iy(u,o,l){if(1===u){let p=0;const _=l.readVarint()+l.pos;for(;l.pos<_;)o[p++]=l.readVarint()}}Tn(Ey,"DEMData"),Tn(JE,"DemMinMaxQuadTree",{omit:["dem"]});class Up{constructor(o){this.capacity=o,this.cache=new Map}get(o){if(!this.cache.has(o))return;const l=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,l),l}put(o,l){this.cache.has(o)?this.cache.delete(o):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(o,l)}}function Y2(u,o){if(4!==o.length)throw new Error(`Expected data of dimension 4 but got ${o.length}.`);let l=o[3];for(let p=2;p>=1;p--){const _=1===p?1:0,f=2===p?1:0;for(let y=0;y<o[0];y++){const T=o[1]*y;for(let E=_;E<o[1];E++){const P=o[2]*(E+T);for(let w=f;w<o[2];w++){const I=o[3]*(w+P);for(let R=0;R<o[3];R++){const D=I+R;u[D]+=u[D-l]}}}}l*=o[p]}return u}function f_(u){for(let o=0,l=u.length;o<l;o++)u[o]=u[o]>>>1^-(1&u[o]);return u}function oI(u,o){switch(o){case"uint32":return u;case"uint16":for(let l=0;l<u.length;l+=2){const p=u[l],_=u[l+1];u[l]=(240&p)>>4|(61440&p)>>8|(240&_)<<4|61440&_,u[l+1]=15&p|(3840&p)>>4|(15&_)<<8|(3840&_)<<4}return u;case"uint8":for(let l=0;l<u.length;l+=4){const p=u[l],_=u[l+1],f=u[l+2],y=u[l+3];u[l+0]=(192&p)>>6|(192&_)>>4|(192&f)>>2|192&y,u[l+1]=(48&p)>>4|(48&_)>>2|48&f|(48&y)<<2,u[l+2]=(12&p)>>2|12&_|(12&f)<<2|(12&y)<<4,u[l+3]=3&p|(3&_)<<2|(3&f)<<4|(3&y)<<6}return u;default:throw new Error(`Invalid pixel format, "${o}"`)}}var Ul=Uint8Array,Hp=Uint16Array,sI=Int32Array,Zc=new Ul([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Im=new Ul([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ja=new Ul([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Dh=function(u,o){for(var l=new Hp(31),p=0;p<31;++p)l[p]=o+=1<<u[p-1];var _=new sI(l[30]);for(p=1;p<30;++p)for(var f=l[p];f<l[p+1];++f)_[f]=f-l[p]<<5|p;return{b:l,r:_}},m_=Dh(Zc,2),Hl=m_.b,si=m_.r;Hl[28]=258,si[258]=28;for(var Mm=Dh(Im,0).b,qp=new Hp(32768),ko=0;ko<32768;++ko){var Yc=(43690&ko)>>1|(21845&ko)<<1;qp[ko]=((65280&(Yc=(61680&(Yc=(52428&Yc)>>2|(13107&Yc)<<2))>>4|(3855&Yc)<<4))>>8|(255&Yc)<<8)>>1}var Lu=function(u,o,l){for(var p=u.length,_=0,f=new Hp(o);_<p;++_)u[_]&&++f[u[_]-1];var y,T=new Hp(o);for(_=1;_<o;++_)T[_]=T[_-1]+f[_-1]<<1;y=new Hp(1<<o);var E=15-o;for(_=0;_<p;++_)if(u[_])for(var P=_<<4|u[_],w=o-u[_],I=T[u[_]-1]++<<w,R=I|(1<<w)-1;I<=R;++I)y[qp[I]>>E]=P;return y},Ou=new Ul(288);for(ko=0;ko<144;++ko)Ou[ko]=8;for(ko=144;ko<256;++ko)Ou[ko]=9;for(ko=256;ko<280;++ko)Ou[ko]=7;for(ko=280;ko<288;++ko)Ou[ko]=8;var Gp=new Ul(32);for(ko=0;ko<32;++ko)Gp[ko]=5;var Am=Lu(Ou,9),Rm=Lu(Gp,5),My=function(u){for(var o=u[0],l=1;l<u.length;++l)u[l]>o&&(o=u[l]);return o},_c=function(u,o,l){var p=o/8|0;return(u[p]|u[p+1]<<8)>>(7&o)&l},Ay=function(u,o){var l=o/8|0;return(u[l]|u[l+1]<<8|u[l+2]<<16)>>(7&o)},vS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],bc=function(u,o,l){var p=new Error(o||vS[u]);if(p.code=u,Error.captureStackTrace&&Error.captureStackTrace(p,bc),!l)throw p;return p},xS=new Ul(0),wS="undefined"!=typeof TextDecoder&&new TextDecoder;try{wS.decode(xS,{stream:!0})}catch(u){}const SS={gzip_data:"gzip"};class ql extends Error{constructor(o){super(o),this.name="MRTError"}}const aI={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},TS={uint32:1,uint16:2,uint8:4},yt={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let ax;class el{constructor(o=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=o}getLayer(o){const l=this.layers[o];if(!l)throw new ql(`Layer '${o}' not found`);return l}getHeaderLength(o){const l=new Uint8Array(o),p=new DataView(o);if(13!==l[0])throw new ql("File is not a valid MRT.");return p.getUint32(1,!0)}parseHeader(o){const l=new Uint8Array(o),p=this.getHeaderLength(o);if(l.length<p)throw new ql(`Expected header with length >= ${p} but got buffer of length ${l.length}`);const _=new ax(l.subarray(0,p)).readFields(sx,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==_.x||this.y!==_.y||this.z!==_.z))throw new ql(`Invalid attempt to parse header ${_.z}/${_.x}/${_.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=_.x,this.y=_.y,this.z=_.z;for(const f of _.layers)this.layers[f.name]=new Pe(f,{cacheSize:this._cacheSize});return this}createDecodingTask(o){const l=[],p=this.getLayer(o.layerName);for(let _ of o.blockIndices){const f=p.dataIndex[_],y=f.firstByte-o.firstByte,T=f.lastByte-o.firstByte;if(p._blocksInProgress.has(_))continue;const E={layerName:p.name,firstByte:y,lastByte:T,pixelFormat:p.pixelFormat,blockIndex:_,blockShape:[f.bands.length].concat(p.bandShape),buffer:p.buffer,codec:f.codec.codec,filters:f.filters.map(P=>P.filter)};p._blocksInProgress.add(_),l.push(E)}return new Ry(l,()=>{l.forEach(_=>p._blocksInProgress.delete(_.blockIndex))},(_,f)=>{if(l.forEach(y=>p._blocksInProgress.delete(y.blockIndex)),_)throw _;f.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class Pe{constructor({version:o,name:l,units:p,tileSize:_,pixelFormat:f,buffer:y,dataIndex:T},E){if(this.version=o,1!==this.version)throw new ql(`Cannot parse raster layer encoded with MRT version ${o}`);this.name=l,this.units=p,this.tileSize=_,this.buffer=y,this.pixelFormat=aI[f],this.dataIndex=T,this.bandShape=[_+2*y,_+2*y,TS[this.pixelFormat]],this._decodedBlocks=new Up(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return TS[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:o})=>o).flat()}processDecodedData(o){const l=o.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.put(l,o.data)}getBlockForBand(o){let l=0;switch(typeof o){case"string":for(const[p,_]of this.dataIndex.entries()){for(const[f,y]of _.bands.entries())if(y===o)return{bandIndex:l+f,blockIndex:p,blockBandIndex:f};l+=_.bands.length}break;case"number":for(const[p,_]of this.dataIndex.entries()){if(o>=l&&o<l+_.bands.length)return{bandIndex:o,blockIndex:p,blockBandIndex:o-l};l+=_.bands.length}break;default:throw new ql(`Invalid band \`${JSON.stringify(o)}\`. Expected string or integer.`)}throw new ql(`Band not found: ${JSON.stringify(o)}`)}getDataRange(o){let l=1/0,p=-1/0;const _=[],f=new Set;for(const y of o){const{blockIndex:T}=this.getBlockForBand(y);if(T<0)throw new ql(`Invalid band: ${JSON.stringify(y)}`);const E=this.dataIndex[T];_.includes(T)||_.push(T),f.add(T),l=Math.min(l,E.firstByte),p=Math.max(p,E.lastByte)}if(f.size>this.cacheSize)throw new ql(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:l,lastByte:p,blockIndices:_}}hasBand(o){const{blockIndex:l}=this.getBlockForBand(o);return l>=0}hasDataForBand(o){const{blockIndex:l}=this.getBlockForBand(o);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(o){const{blockIndex:l,blockBandIndex:p}=this.getBlockForBand(o),_=this._decodedBlocks.get(l.toString());if(!_)throw new ql(`Data for band ${JSON.stringify(o)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[l],y=this.bandShape.reduce((P,w)=>P*w,1),T=p*y,E=_.subarray(T,T+y);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}el.setPbf=function(u){ax=u};class Ry{constructor(o,l,p){this.tasks=o,this._onCancel=l,this._onComplete=p,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(o,l){this._finalized||(this._onComplete(o,l),this._finalized=!0)}}el.performDecoding=function(u,o){const l=new Uint8Array(u);return Promise.all(o.tasks.map(p=>{const{layerName:_,firstByte:f,lastByte:y,pixelFormat:T,blockShape:E,blockIndex:P,filters:w,codec:I}=p,R=l.subarray(f,y+1),D=new Uint32Array(E[0]*E[1]*E[2]);let M;if("gzip_data"!==I)throw new ql(`Unhandled codec: ${I}`);return M=function(L,V){if(!globalThis.DecompressionStream&&"gzip_data"===V)return Promise.resolve(((H=function(ce){31==ce[0]&&139==ce[1]&&8==ce[2]||bc(6,"invalid gzip data");var we=ce[3],_e=10;4&we&&(_e+=2+(ce[10]|ce[11]<<8));for(var be=(we>>3&1)+(we>>4&1);be>0;be-=!ce[_e++]);return _e+(2&we)}($=L))+8>$.length&&bc(6,"invalid gzip data"),function(ce,we,_e,be){var Z=ce.length;if(!Z||we.f&&!we.l)return _e||new Ul(0);var de=!_e,De=de||2!=we.i,Be=we.i;de&&(_e=new Ul(3*Z));var je,Xe,it=function(Zp){var Os=_e.length;if(Zp>Os){var Vy=new Ul(Math.max(2*Os,Zp));Vy.set(_e),_e=Vy}},at=we.f||0,et=we.p||0,It=we.b||0,Xt=we.l,vt=we.d,yn=we.m,ln=we.n,Kt=8*Z;do{if(!Xt){at=_c(ce,et,1);var Gt=_c(ce,et+1,3);if(et+=3,!Gt){var Hn=ce[(ri=4+((et+7)/8|0))-4]|ce[ri-3]<<8,gn=ri+Hn;if(gn>Z){Be&&bc(0);break}De&&it(It+Hn),_e.set(ce.subarray(ri,gn),It),we.b=It+=Hn,we.p=et=8*gn,we.f=at;continue}if(1==Gt)Xt=Am,vt=Rm,yn=9,ln=5;else if(2==Gt){var Dn=_c(ce,et,31)+257,hi=_c(ce,et+10,15)+4,Ti=Dn+_c(ce,et+5,31)+1;et+=14;for(var Ii=new Ul(Ti),_i=new Ul(19),Vi=0;Vi<hi;++Vi)_i[ja[Vi]]=_c(ce,et+3*Vi,7);et+=3*hi;var Li=My(_i),Jr=(1<<Li)-1,Fr=Lu(_i,Li);for(Vi=0;Vi<Ti;){var ri,Sr=Fr[_c(ce,et,Jr)];if(et+=15&Sr,(ri=Sr>>4)<16)Ii[Vi++]=ri;else{var Tr=0,ro=0;for(16==ri?(ro=3+_c(ce,et,3),et+=2,Tr=Ii[Vi-1]):17==ri?(ro=3+_c(ce,et,7),et+=3):18==ri&&(ro=11+_c(ce,et,127),et+=7);ro--;)Ii[Vi++]=Tr}}var Vo=Ii.subarray(0,Dn),Ko=Ii.subarray(Dn);yn=My(Vo),ln=My(Ko),Xt=Lu(Vo,yn),vt=Lu(Ko,ln)}else bc(1);if(et>Kt){Be&&bc(0);break}}De&&it(It+131072);for(var jo=(1<<yn)-1,Lo=(1<<ln)-1,Xo=et;;Xo=et){var as=(Tr=Xt[Ay(ce,et)&jo])>>4;if((et+=15&Tr)>Kt){Be&&bc(0);break}if(Tr||bc(2),as<256)_e[It++]=as;else{if(256==as){Xo=et,Xt=null;break}var Us=as-254;as>264&&(Us=_c(ce,et,(1<<(Ia=Zc[Vi=as-257]))-1)+Hl[Vi],et+=Ia);var dr=vt[Ay(ce,et)&Lo],Qs=dr>>4;if(dr||bc(3),et+=15&dr,Ko=Mm[Qs],Qs>3){var Ia=Im[Qs];Ko+=Ay(ce,et)&(1<<Ia)-1,et+=Ia}if(et>Kt){Be&&bc(0);break}De&&it(It+131072);var yc=It+Us;if(It<Ko){var vc=0-Ko,xc=Math.min(Ko,yc);for(vc+It<0&&bc(3);It<xc;++It)_e[It]=(void 0)[vc+It]}for(;It<yc;++It)_e[It]=_e[It-Ko]}}we.l=Xt,we.p=Xo,we.b=It,we.f=at,Xt&&(at=1,we.m=yn,we.d=vt,we.n=ln)}while(!at);return It!=_e.length&&de?(je=_e,(null==(Xe=It)||Xe>je.length)&&(Xe=je.length),new Ul(je.subarray(0,Xe))):_e.subarray(0,It)}($.subarray(H,-8),{i:2},new Ul(((j=$)[(G=j.length)-4]|j[G-3]<<8|j[G-2]<<16|j[G-1]<<24)>>>0))));var j,G,$,H;const Y=SS[V];if(!Y)throw new Error(`Unhandled codec: ${V}`);const J=new globalThis.DecompressionStream(Y);return new Response(new Blob([L]).stream().pipeThrough(J)).arrayBuffer().then(ce=>new Uint8Array(ce))}(R,I).then(L=>(new ax(L).readFields(rI,D),new yt[T](D.buffer))),M.then(L=>{for(let V=w.length-1;V>=0;V--)switch(w[V]){case"delta_filter":Y2(L,E);break;case"zigzag_filter":f_(L);break;case"bitshuffle_filter":oI(L,T);break;default:throw new ql(`Unhandled filter "${w[V]}"`)}return{layerName:_,blockIndex:P,data:L}}).catch(L=>{throw L})}))},Tn(Ry,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var g_={workerUrl:"",workerClass:null,workerParams:void 0};const ne="mapboxgl_preloaded_worker_pool";class oe{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<oe.workerCount;)this.workers.push(null!=g_.workerClass?new g_.workerClass:new self.Worker(g_.workerUrl,g_.workerParams));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.workers&&0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ne]}numActive(){return Object.keys(this.active).length}}let rn;function Py(){return rn||(rn=new oe),rn}oe.workerCount=2;let ji,Zi,Wo,or,$p,Wp=null;function ky(){return Zu()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Zi||Me.DRACO_URL}function Wt(){if(Zu()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(or)return or;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return or=WebAssembly.validate(u)?Me.MESHOPT_SIMD_URL:Me.MESHOPT_URL,or}const Eh={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Pm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function lx(u,o,l){const p=l.json.bufferViews.length,_=l.buffers.length;o.bufferView=p,l.json.bufferViews[p]={buffer:_,byteLength:u.byteLength},l.buffers[_]=u}const Ly="KHR_draco_mesh_compression";function St(u,o){const l=u.extensions&&u.extensions[Ly];if(!l)return;const p=new Wo.Decoder,_=cx(o,l.bufferView),f=new Wo.Mesh;if(!p.DecodeArrayToMesh(_,_.byteLength,f))throw new Error("Failed to decode Draco mesh");const y=o.json.accessors[u.indices],T=Eh[y.componentType],E=y.count*T.BYTES_PER_ELEMENT,P=Wo._malloc(E);T===Uint16Array?p.GetTrianglesUInt16Array(f,E,P):p.GetTrianglesUInt32Array(f,E,P),lx(Wo.memory.buffer.slice(P,P+E),y,o),Wo._free(P);for(const w of Object.keys(l.attributes)){const I=p.GetAttributeByUniqueId(f,l.attributes[w]),R=o.json.accessors[u.attributes[w]],D=lI[R.componentType],M=R.count*Pm[R.type]*Eh[R.componentType].BYTES_PER_ELEMENT,L=Wo._malloc(M);p.GetAttributeDataArrayForAllPoints(f,I,Wo[D],M,L),lx(Wo.memory.buffer.slice(L,L+M),R,o),Wo._free(L)}p.destroy(),f.destroy(),delete u.extensions[Ly]}const Oy="EXT_meshopt_compression";function Rs(u,o){if(!u.extensions||!u.extensions[Oy])return;const l=u.extensions[Oy],p=new Uint8Array(o.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),_=new Uint8Array(l.count*l.byteStride);$p.decodeGltfBuffer(_,l.count,l.byteStride,p,l.mode,l.filter),u.buffer=o.buffers.length,u.byteOffset=0,o.buffers[u.buffer]=_.buffer,delete u.extensions[Oy]}const Co=1179937895,Ir=new TextDecoder("utf8");function Fy(u,o){return new URL(u,o).href}function CS(u,o,l,p){return fetch(Fy(u.uri,p)).then(_=>_.arrayBuffer()).then(_=>{o.buffers[l]=_})}function cx(u,o){const l=u.json.bufferViews[o];return new Uint8Array(u.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function DS(u,o,l,p){if(u.uri){const _=Fy(u.uri,p);return fetch(_).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{o.images[l]=f})}if(void 0!==u.bufferView){const _=cx(o,u.bufferView),f=new Blob([_],{type:u.mimeType});return createImageBitmap(f).then(y=>{o.images[l]=y})}}function ux(u,o=0,l){const p={json:null,images:[],buffers:[]};if(new Uint32Array(u,o,1)[0]===Co){const w=new Uint32Array(u,o);let I=2;const R=(w[I++]>>2)-3,D=w[I++]>>2;if(I++,p.json=JSON.parse(Ir.decode(w.subarray(I,I+D))),I+=D,I<R){const M=w[I++];I++;const L=o+(I<<2);p.buffers[0]=u.slice(L,L+M)}}else p.json=JSON.parse(Ir.decode(new Uint8Array(u,o)));const{buffers:_,images:f,meshes:y,extensionsUsed:T,bufferViews:E}=p.json;let P=Promise.resolve();if(_){const w=[];for(let I=0;I<_.length;I++){const R=_[I];R.uri?w.push(CS(R,p,I,l)):p.buffers[I]||(p.buffers[I]=null)}P=Promise.all(w)}return P.then(()=>{const w=[],I=T&&T.includes(Ly),R=T&&T.includes(Oy);if(I&&w.push(function(){if(!Wo)return null!=ji?ji:(ji=function(D){let M,L=null;function V(){M=new Uint8Array(L.buffer)}function j(){throw new Error("Unexpected Draco error.")}const G={a:{a:j,d:function($,H,Y){return M.copyWithin($,H,H+Y)},c:function($){const H=M.length,Y=Math.max($>>>0,Math.ceil(1.2*H)),J=Math.ceil((Y-H)/65536);try{return L.grow(J),V(),!0}catch(ce){return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,G):D.then($=>$.arrayBuffer()).then($=>WebAssembly.instantiate($,G))).then($=>{const{Rb:H,Qb:Y,P:J,T:ce,X:we,Ja:_e,La:be,Qa:Z,Va:de,Wa:De,eb:Be,jb:je,f:Xe,e:it,yb:at,zb:et,Ab:It,Bb:Xt,Db:vt,Gb:yn}=$.instance.exports;L=it;const ln=(()=>{let Kt=0,Gt=0,Hn=0,gn=0;return Dn=>{Hn&&(H(gn),H(Kt),Gt+=Hn,Hn=Kt=0),Kt||(Gt+=128,Kt=Y(Gt));const hi=Dn.length+7&-8;let Ti=Kt;hi>=Gt&&(Hn=hi,Ti=gn=Y(hi));for(let Ii=0;Ii<Dn.length;Ii++)M[Ti+Ii]=Dn[Ii];return Ti}})();return V(),Xe(),{memory:it,_free:H,_malloc:Y,Mesh:class{constructor(){this.ptr=J()}destroy(){ce(this.ptr)}},Decoder:class{constructor(){this.ptr=_e()}destroy(){je(this.ptr)}DecodeArrayToMesh(Kt,Gt,Hn){const gn=ln(Kt),Dn=be(this.ptr,gn,Gt,Hn.ptr);return!!we(Dn)}GetAttributeByUniqueId(Kt,Gt){return{ptr:Z(this.ptr,Kt.ptr,Gt)}}GetTrianglesUInt16Array(Kt,Gt,Hn){de(this.ptr,Kt.ptr,Gt,Hn)}GetTrianglesUInt32Array(Kt,Gt,Hn){De(this.ptr,Kt.ptr,Gt,Hn)}GetAttributeDataArrayForAllPoints(Kt,Gt,Hn,gn,Dn){Be(this.ptr,Kt.ptr,Gt.ptr,Hn,gn,Dn)}},DT_INT8:at(),DT_UINT8:et(),DT_INT16:It(),DT_UINT16:Xt(),DT_UINT32:vt(),DT_FLOAT32:yn()}})}(fetch(ky())),ji.then(D=>{Wo=D,ji=void 0}))}()),R&&w.push(function(){if($p)return;const D=function(M){let L;const V=WebAssembly.instantiateStreaming(M,{}).then($=>{L=$.instance,L.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},G={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:V,supported:!0,decodeGltfBuffer($,H,Y,J,ce,we){!function(_e,be,Z,de,De,Be,je){const Xe=_e.exports.sbrk,it=de+3&-4,at=Xe(it*De),et=Xe(Be.length),It=new Uint8Array(_e.exports.memory.buffer);It.set(Be,et);const Xt=be(at,de,De,et,Be.length);if(0===Xt&&je&&je(at,it,De),Z.set(It.subarray(at,at+de*De)),Xe(at-Xe(0)),0!==Xt)throw new Error(`Malformed buffer data: ${Xt}`)}(L,L.exports[G[ce]],$,H,Y,J,L.exports[j[we]])}}}(fetch(Wt()));return D.ready.then(()=>{$p=D})}()),f)for(let D=0;D<f.length;D++)w.push(DS(f[D],p,D,l));return(w.length?Promise.all(w):Promise.resolve()).then(()=>{if(I&&y)for(const{primitives:D}of y)for(const M of D)St(M,p);if(R&&y&&E)for(const D of E)Rs(D,p);return p})})}function Ih(u,o){const l=u.json.bufferViews[o.bufferView],p=Eh[o.componentType];return new p(u.buffers[l.buffer],(o.byteOffset||0)+(l.byteOffset||0),o.count*(l.byteStride&&l.byteStride!==Pm[o.type]*p.BYTES_PER_ELEMENT?l.byteStride/p.BYTES_PER_ELEMENT:Pm[o.type]))}function Ny(u,o,l,p){const _=Eh[o.componentType],f=function(w){switch(w){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(_),y=u.json.bufferViews[o.bufferView],T=y.byteStride?y.byteStride/_.BYTES_PER_ELEMENT:Pm[o.type],E=l.float32,P=E.length/l.capacity;for(let w=0,I=0;w<o.count*T;w+=T,I+=P)for(let R=0;R<P;R++)E[I+R]=p[w+R]*f;l._trim()}function ES(u,o,l){const p=u.indices,_=u.attributes,f={};f.indexArray=new Xr;const y=o.json.accessors[p],T=y.count/3;f.indexArray.reserve(T);const E=Ih(o,y);for(let R=0;R<T;R++)f.indexArray.emplaceBack(E[3*R],E[3*R+1],E[3*R+2]);f.indexArray._trim(),f.vertexArray=new Fl;const P=o.json.accessors[_.POSITION];f.vertexArray.reserve(P.count);const w=Ih(o,P);for(let R=0;R<P.count;R++)f.vertexArray.emplaceBack(w[3*R],w[3*R+1],w[3*R+2]);if(f.vertexArray._trim(),f.aabb=new wr(P.min,P.max),f.centroid=function(R,D){const M=[0,0,0],L=R.length;if(L>0){for(let V=0;V<L;V++){const j=3*R[V];M[0]+=D[j],M[1]+=D[j+1],M[2]+=D[j+2]}M[0]/=L,M[1]/=L,M[2]/=L}return M}(E,w),void 0!==_.COLOR_0){const R=o.json.accessors[_.COLOR_0],D=Pm[R.type],M=Ih(o,R);f.colorArray=3===D?new Fl:new Fc,f.colorArray.resize(R.count),Ny(o,R,f.colorArray,M)}if(void 0!==_.NORMAL){f.normalArray=new Fl;const R=o.json.accessors[_.NORMAL];f.normalArray.resize(R.count);const D=Ih(o,R);Ny(o,R,f.normalArray,D)}if(void 0!==_.TEXCOORD_0&&l.length>0){f.texcoordArray=new em;const R=o.json.accessors[_.TEXCOORD_0];f.texcoordArray.resize(R.count);const D=Ih(o,R);Ny(o,R,f.texcoordArray,D)}if(void 0!==_._FEATURE_ID_RGBA4444){const R=o.json.accessors[_._FEATURE_ID_RGBA4444];o.json.extensionsUsed&&o.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=Ih(o,R))}void 0!==_._FEATURE_RGBA4444&&(f.featureData=new Uint32Array(Ih(o,o.json.accessors[_._FEATURE_RGBA4444]).buffer));const I=u.material;return f.material=function(R,D){const{emissiveFactor:M=[0,0,0],alphaMode:L="OPAQUE",alphaCutoff:V=.5,normalTexture:j,occlusionTexture:G,emissiveTexture:$,doubleSided:H}=R,{baseColorFactor:Y=[1,1,1,1],metallicFactor:J=1,roughnessFactor:ce=1,baseColorTexture:we,metallicRoughnessTexture:_e}=R.pbrMetallicRoughness||{},be=G?D[G.index]:void 0;if(G&&G.extensions&&G.extensions.KHR_texture_transform&&be){const Z=G.extensions.KHR_texture_transform;be.offsetScale=[Z.offset[0],Z.offset[1],Z.scale[0],Z.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Gn(...Y),metallicFactor:J,roughnessFactor:ce,baseColorTexture:we?D[we.index]:void 0,metallicRoughnessTexture:_e?D[_e.index]:void 0},doubleSided:H,emissiveFactor:M,alphaMode:L,alphaCutoff:V,normalTexture:j?D[j.index]:void 0,occlusionTexture:be,emissionTexture:$?D[$.index]:void 0,defined:void 0===R.defined}}(void 0!==I?o.json.materials[I]:{defined:!1},l),f}function dx(u,o,l){const{matrix:p,rotation:_,translation:f,scale:y,mesh:T,extras:E,children:P}=u,w={};if(w.matrix=p||Q.mat4.fromRotationTranslationScale([],_||[0,0,0,1],f||[0,0,0],y||[1,1,1]),void 0!==T){w.meshes=l[T];const I=w.anchor=[0,0];for(const R of w.meshes){const{min:D,max:M}=R.aabb;I[0]+=D[0]+M[0],I[1]+=D[1]+M[1]}I[0]=Math.floor(I[0]/w.meshes.length/2),I[1]=Math.floor(I[1]/w.meshes.length/2)}if(E&&(E.id&&(w.id=E.id),E.lights&&(w.lights=function(I){if(!I.length)return[];const R=function(j){const G=atob(j),$=new Uint8Array(G.length);for(let H=0;H<G.length;H++)$[H]=G.codePointAt(H);return $}(I),D=[],M=R.length/24,L=new Uint16Array(R.buffer),V=new Float32Array(R.buffer);for(let j=0;j<M;j++){const G=L[2*j*6]/30,$=L[2*j*6+1]/30,H=L[2*j*6+10]/100,Y=V[6*j+1],J=V[6*j+2],ce=V[6*j+3],we=V[6*j+4],_e=ce-Y,be=we-J,Z=Math.hypot(_e,be);D.push({pos:[Y+.5*_e,J+.5*be,$],normal:[be/Z,-_e/Z,0],width:Z,height:G,depth:H,points:[Y,J,ce,we]})}return D}(E.lights))),P){const I=[];for(const R of P)I.push(dx(o.json.nodes[R],o,l));w.children=I}return w}function J2(u){if(0===u.vertices.length||0===u.indices.length)return null;const o=new a0(u.vertices,u.indices,8,256),[l,p]=[o.min.clone(),o.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:o,min:l,max:p}}function cI(u){if(!u.extras||!u.extras.ground)return null;const o=u.extras.ground;if(!o||!Array.isArray(o)||0===o.length)return null;const l=o[0];if(!l||!Array.isArray(l)||0===l.length)return null;const p=[];for(const y of l){if(!Array.isArray(y)||2!==y.length)continue;const T=y[0],E=y[1];"number"==typeof T&&"number"==typeof E&&p.push(new Ht(T,E))}if(p.length<3)return null;p.length>1&&p[p.length-1].equals(p[0])&&p.pop();let _=0;for(let y=0;y<p.length;y++){const T=p[y],E=p[(y+1)%p.length],P=p[(y+2)%p.length];_+=(T.x-E.x)*(P.y-E.y)-(P.x-E.x)*(T.y-E.y)}_>0&&p.reverse();const f=Ng(p.flatMap(y=>[y.x,y.y]),[]);return 0===f.length?null:{vertices:p,indices:f}}function uI(u,o){const l=[],p=[];let _=0;const f=[];for(const y of u){_=l.length;const T=y.vertexArray.float32,E=y.indexArray.uint16;for(let P=0;P<y.vertexArray.length;P++)f[0]=T[3*P+0],f[1]=T[3*P+1],f[2]=T[3*P+2],Q.vec3.transformMat4(f,f,o),l.push(new Ht(f[0],f[1]));for(let P=0;P<3*y.indexArray.length;P++)p.push(E[P]+_)}if(p.length%3!=0)return null;for(let y=0;y<p.length;y+=3){const T=l[p[y+0]],E=l[p[y+1]],P=l[p[y+2]];(T.x-E.x)*(P.y-E.y)-(P.x-E.x)*(T.y-E.y)>0&&([p[y+1],p[y+2]]=[p[y+2],p[y+1]])}return{vertices:l,indices:p}}function hx(u){const l=function(E,P){const w=[];for(const I of E.json.meshes){const R=[];for(const D of I.primitives)R.push(ES(D,E,P));w.push(R)}return w}(u,function(E,P){const w=[],I=WebGL2RenderingContext;if(E.json.textures)for(const R of E.json.textures){const D={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};void 0!==R.sampler&&Object.assign(D,E.json.samplers[R.sampler]),w.push({image:P[R.source],sampler:D,uploaded:!1})}return w}(u,u.images)),{scenes:p,scene:_,nodes:f}=u.json,y=p?p[_||0].nodes:f,T=[];for(const E of y)T.push(dx(f[E],u,l));return function(E,P,w){const I={},R=new Set;for(let D=0;D<E.length;D++){const M=w[P[D]];if(!M.extras)continue;const L=M.extras["mapbox:footprint:version"],V=M.extras["mapbox:footprint:id"];(L||V)&&R.add(D),"1.0.0"===L&&V&&(I[V]=D)}for(let D=0;D<E.length;D++){if(R.has(D))continue;const M=E[D],L=w[P[D]];if(!L.extras)continue;let V=null;M.id in I&&(V=uI(E[I[M.id]].meshes,M.matrix)),V||(V=cI(L)),V&&(M.footprint=J2(V))}if(R.size>0){const D=Array.from(R.values()).sort((M,L)=>M-L);for(let M=D.length-1;M>=0;M--)E.splice(D[M],1)}}(T,y,u.json.nodes),T}function dI(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const o=u.vertexArray.float32,l=u.aabb.min[0]-1,p=u.aabb.min[1]-1,_=64/(u.aabb.max[0]-l+2),f=64/(u.aabb.max[1]-p+2);for(let y=0;y<o.length;y+=3){const T=o[y+2],E=(o[y+0]-l)*_|0,P=(o[y+1]-p)*f|0;T>u.heightmap[64*P+E]&&(u.heightmap[64*P+E]=T)}}function Ks(u,o){const l={};l.indexArray=new Xr,l.indexArray.reserve(4*u.length),l.vertexArray=new Fl,l.vertexArray.reserve(10*u.length),l.colorArray=new Fc,l.vertexArray.reserve(10*u.length);let p=0;for(const y of u){const T=Math.min(10,Math.max(4,1.3*y.height))*o,E=[-y.normal[1],y.normal[0],0],P=Math.min(.29,.1*y.width/y.depth),w=y.width-2*y.depth*o*(P+.01),I=Q.vec3.scaleAndAdd([],y.pos,E,w/2),R=Q.vec3.scaleAndAdd([],y.pos,E,-w/2),D=[I[0],I[1],I[2]+y.height],M=[R[0],R[1],R[2]+y.height],L=Q.vec3.scaleAndAdd([],y.normal,E,P);Q.vec3.scale(L,L,T);const V=Q.vec3.scaleAndAdd([],y.normal,E,-P);Q.vec3.scale(V,V,T),Q.vec3.add(L,I,L),Q.vec3.add(V,R,V),I[2]+=.1,R[2]+=.1,l.vertexArray.emplaceBack(L[0],L[1],L[2]),l.vertexArray.emplaceBack(V[0],V[1],V[2]),l.vertexArray.emplaceBack(I[0],I[1],I[2]),l.vertexArray.emplaceBack(R[0],R[1],R[2]),l.vertexArray.emplaceBack(D[0],D[1],D[2]),l.vertexArray.emplaceBack(M[0],M[1],M[2]),l.vertexArray.emplaceBack(I[0],I[1],I[2]),l.vertexArray.emplaceBack(R[0],R[1],R[2]),l.vertexArray.emplaceBack(L[0],L[1],L[2]),l.vertexArray.emplaceBack(V[0],V[1],V[2]);const j=w/T/2;l.colorArray.emplaceBack(-j-P,-1,j,.8),l.colorArray.emplaceBack(j+P,-1,j,.8),l.colorArray.emplaceBack(-j,0,j,1.3),l.colorArray.emplaceBack(j,0,j,1.3),l.colorArray.emplaceBack(j+P,-.8,j,.7),l.colorArray.emplaceBack(j+P,-.8,j,.7),l.colorArray.emplaceBack(0,0,j,1.3),l.colorArray.emplaceBack(0,0,j,1.3),l.colorArray.emplaceBack(j+P,-1.2,j,.8),l.colorArray.emplaceBack(j+P,-1.2,j,.8),l.indexArray.emplaceBack(6+p,4+p,8+p),l.indexArray.emplaceBack(7+p,9+p,5+p),l.indexArray.emplaceBack(0+p,1+p,2+p),l.indexArray.emplaceBack(1+p,3+p,2+p),p+=10}const _={defined:!0,emissiveFactor:[0,0,0]},f={};return f.baseColorFactor=Gn.white,_.pbrMetallicRoughness=f,l.material=_,l.aabb=new wr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}class px{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const p=o[l];this._stringToNumber[p]=l,this._numberToString[l]=p}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}class IS{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new yl(an,16,0),this.featureIndexArray=new Ba,this.promoteId=l,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(o,l,p,_,f,y=0,T=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,f,y);const P=this.grid;for(let w=0;w<l.length;w++){const I=l[w],R=[1/0,1/0,-1/0,-1/0];for(let D=0;D<I.length;D++){const M=I[D];R[0]=Math.min(R[0],M.x),R[1]=Math.min(R[1],M.y),R[2]=Math.max(R[2],M.x),R[3]=Math.max(R[3],M.y)}0!==T&&(R[0]-=T,R[1]-=T,R[2]+=T,R[3]+=T),R[0]<an&&R[1]<an&&R[2]>=0&&R[3]>=0&&P.insert(E,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new um.VectorTile(new Yg(this.rawTileData)).layers,this.sourceLayerCoder=new px(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,p){this.loadVTLayers(),this.serializedLayersCache.clear();const _=ld(o.filter),f=o.tileResult,y=o.transform,T=f.bufferedTilespaceBounds,E=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(R,D,M,L)=>Br(f.bufferedTilespaceGeometry,R,D,M,L));E.sort(AS);let P=null;y.elevation&&E.length>0&&(P=Cd.create(y.elevation,this.tileID));const w={};let I;for(let R=0;R<E.length;R++){const D=E[R];if(D===I)continue;I=D;const M=this.featureIndexArray.get(D);let L=null;if(this.is3DTile){const V=this.bucketLayerIDs[0][0],j=l[V];if("model"!==j.type)continue;const{queryFeature:G,intersectionZ:$}=j.queryIntersectsMatchingFeature(f,M.featureIndex,_,y);G&&this.appendToResult(w,V,M.featureIndex,G,$)}else this.loadMatchingFeature(w,M,_,o.layers,o.availableImages,l,p,(V,j,G,$=0)=>(L||(L=Ke(V,this.tileID.canonical,o.tileTransform)),j.queryIntersectsFeature(f,V,G,L,this.z,o.transform,o.pixelPosMatrix,P,$)))}return w}loadMatchingFeature(o,l,p,_,f,y,T,E){const{featureIndex:P,bucketIndex:w,sourceLayerIndex:I,layoutVertexArrayOffset:R}=l,D=this.bucketLayerIDs[w];if(_.length&&!function(j,G){for(let $=0;$<j.length;$++)if(G.indexOf(j[$])>=0)return!0;return!1}(_,D))return;const M=this.sourceLayerCoder.decode(I),L=this.vtLayers[M].feature(P);if(p.needGeometry){const j=Pt(L,!0);if(!p.filter(new Po(this.tileID.overscaledZ),j,this.tileID.canonical))return}else if(!p.filter(new Po(this.tileID.overscaledZ),L))return;const V=this.getId(L,M);for(let j=0;j<D.length;j++){const G=D[j];if(_.length&&_.indexOf(G)<0)continue;const $=y[G];if(!$)continue;let H={};void 0!==V&&T&&(H=T.getState($.sourceLayer||"_geojsonTileLayer",V));const Y=!E||E(L,$,H,R);if(!Y)continue;const J=new Th(L,this.z,this.x,this.y,V);let ce=this.serializedLayersCache.get(G);ce||(ce=$.serialize(),ce.id=G,this.serializedLayersCache.set(G,ce)),J.layer=yr({},ce),J.tile=this.tileID.canonical,J.layer.paint=MS(ce.paint,$.paint,L,H,f),J.layer.layout=MS(ce.layout,$.layout,L,H,f),this.appendToResult(o,G,P,J,Y)}}appendToResult(o,l,p,_,f){let y=o[l];void 0===y&&(y=o[l]=[]),y.push({featureIndex:p,feature:_,intersectionZ:f})}lookupSymbolFeatures(o,l,p,_,f,y,T){const E={};this.loadVTLayers();const P=ld(_);for(const w of o)this.loadMatchingFeature(E,{bucketIndex:l,sourceLayerIndex:p,featureIndex:w,layoutVertexArrayOffset:0},P,f,y,T);return E}loadFeature(o){const{featureIndex:l,sourceLayerIndex:p}=o;this.loadVTLayers();const _=this.sourceLayerCoder.decode(p),f=this.vtFeatures[_];if(f[l])return f[l];const y=this.vtLayers[_].feature(l);return f[l]=y,y}hasLayer(o){for(const l of this.bucketLayerIDs)for(const p of l)if(o===p)return!0;return!1}getId(o,l){let p=o.id;if(this.promoteId){const _="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=_&&(p=o.properties[_]),"boolean"==typeof p&&(p=Number(p))}return p}}function MS(u,o,l,p,_){return Pa(u,(f,y)=>{const T=o instanceof lc?o.get(y):null;return T&&T.evaluate?T.evaluate(l,p,_):T})}function AS(u,o){return o-u}Tn(IS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const RS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class By{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,p]=new Uint8Array(o,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(1!==_)throw new Error(`Got v${_} data when expected v1.`);const f=RS[15&p];if(!f)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(o,2,1),[T]=new Uint32Array(o,4,1);return new By(T,y,f,o)}constructor(o,l=64,p=Float64Array,_){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=p,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const f=RS.indexOf(this.ArrayType),y=2*o*this.ArrayType.BYTES_PER_ELEMENT,T=o*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-T%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+T+E,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+y+T+E),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+T+E,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=o)}add(o,l){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=o,this.coords[this._pos++]=l,p}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return zy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,l,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:y,nodeSize:T}=this,E=[0,f.length-1,0],P=[];for(;E.length;){const w=E.pop()||0,I=E.pop()||0,R=E.pop()||0;if(I-R<=T){for(let V=R;V<=I;V++){const j=y[2*V],G=y[2*V+1];j>=o&&j<=p&&G>=l&&G<=_&&P.push(f[V])}continue}const D=R+I>>1,M=y[2*D],L=y[2*D+1];M>=o&&M<=p&&L>=l&&L<=_&&P.push(f[D]),(0===w?o<=M:l<=L)&&(E.push(R),E.push(D-1),E.push(1-w)),(0===w?p>=M:_>=L)&&(E.push(D+1),E.push(I),E.push(1-w))}return P}within(o,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:f,nodeSize:y}=this,T=[0,_.length-1,0],E=[],P=p*p;for(;T.length;){const w=T.pop()||0,I=T.pop()||0,R=T.pop()||0;if(I-R<=y){for(let V=R;V<=I;V++)mx(f[2*V],f[2*V+1],o,l)<=P&&E.push(_[V]);continue}const D=R+I>>1,M=f[2*D],L=f[2*D+1];mx(M,L,o,l)<=P&&E.push(_[D]),(0===w?o-p<=M:l-p<=L)&&(T.push(R),T.push(D-1),T.push(1-w)),(0===w?o+p>=M:l+p>=L)&&(T.push(D+1),T.push(I),T.push(1-w))}return E}}function zy(u,o,l,p,_,f){if(_-p<=l)return;const y=p+_>>1;Xp(u,o,y,p,_,f),zy(u,o,l,p,y-1,1-f),zy(u,o,l,y+1,_,1-f)}function Xp(u,o,l,p,_,f){for(;_>p;){if(_-p>600){const P=_-p+1,w=l-p+1,I=Math.log(P),R=.5*Math.exp(2*I/3),D=.5*Math.sqrt(I*R*(P-R)/P)*(w-P/2<0?-1:1);Xp(u,o,l,Math.max(p,Math.floor(l-w*R/P+D)),Math.min(_,Math.floor(l+(P-w)*R/P+D)),f)}const y=o[2*l+f];let T=p,E=_;for(__(u,o,p,l),o[2*_+f]>y&&__(u,o,p,_);T<E;){for(__(u,o,T,E),T++,E--;o[2*T+f]<y;)T++;for(;o[2*E+f]>y;)E--}o[2*p+f]===y?__(u,o,p,E):(E++,__(u,o,E,_)),E<=l&&(p=E+1),l<=E&&(_=E-1)}}function __(u,o,l,p){fx(u,l,p),fx(o,2*l,2*p),fx(o,2*l+1,2*p+1)}function fx(u,o,l){const p=u[o];u[o]=u[l],u[l]=p}function mx(u,o,l,p){const _=u-l,f=o-p;return _*_+f*f}h.$=fp,h.A=class extends s_{},h.B=Ac,h.C=Ec,h.D=Sg,h.E=uu,h.F=Uf,h.G=td,h.H=mg,h.I=ay,h.J=$a,h.K=rh,h.L=id,h.M=mu,h.N=Of,h.O=Kd,h.P=Ht,h.Q=Sa,h.R=cu,h.S=bs,h.T=Sh,h.U=Hd,h.V=s_,h.W=yb,h.X=gg,h.Y=fb,h.Z=function(u){const o=u.value;let l=[];if(!o)return l;const p=Ac(o);return"string"!==p?(l=l.concat([new s_(u.key,o,`string expected, "${p}" found`)]),l):(Q0(o,!0)||(l=l.concat([new s_(u.key,o,`invalid url "${o}"`)])),l)},h._=ot,h.a=function(u){return Me.API_CDN_URL_REGEX.test(u)},h.a$=bu,h.a0=$r,h.a1=Qt,h.a2=class{constructor(u){this.specification=u}possiblyEvaluate(u,o){return Ha(u.expression.evaluate(o))}interpolate(u,o,l){return{x:ni(u.x,o.x,l),y:ni(u.y,o.y,l),z:ni(u.z,o.z,l),azimuthal:ni(u.azimuthal,o.azimuthal,l),polar:ni(u.polar,o.polar,l)}}},h.a3=Po,h.a4=Hf,h.a5=He,h.a6=Q,h.a7=In,h.a8=lc,h.a9=yd,h.aA=zi,h.aB=yy,h.aC=rS,h.aD=W0,h.aE=function(u,o){const l=document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let p=0;p<u.length;p++){const _=document.createElement("source");hl(u[p])||(l.crossOrigin="Anonymous"),_.src=u[p],l.appendChild(_)}return{cancel:()=>{}}},h.aF=Tm,h.aG=function(u){return fetch(u).then(o=>o.arrayBuffer()).then(o=>ux(o,0,u))},h.aH=hx,h.aI=class{constructor(u,o,l,p){this.id=u,this.position=null!=o?new N(o[0],o[1]):new N(0,0),this.orientation=null!=l?l:[0,0,0],this.nodes=p,this.uploaded=!1,this.aabb=new wr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(u,o){if(Q.mat4.multiply(u.matrix,o,u.matrix),u.meshes)for(const l of u.meshes){const p=wr.applyTransformFast(l.aabb,u.matrix);this.aabb.encapsulate(p)}if(u.children)for(const l of u.children)this._applyTransformations(l,u.matrix)}computeBoundsAndApplyParent(){const u=Q.mat4.identity([]);for(const o of this.nodes)this._applyTransformations(o,u)}computeModelMatrix(u,o,l,p,_,f,y=!1){pS(this.matrix,this,u.transform,this.position,o,l,p,_,f,y)}upload(u){if(!this.uploaded){for(const o of this.nodes)c_(o,u);for(const o of this.nodes)Cy(o);this.uploaded=!0}}destroy(){for(const u of this.nodes)ex(u)}},h.aJ=Dc,h.aK=function(u){return u.indexOf("\x1f")>=0},h.aL=wm,h.aM=ge,h.aN=xe,h.aO=hd,h.aP=Xr,h.aQ=Eo,h.aR=wu,h.aS=fy,h.aT=function(){Xa.isLoading()||Xa.isLoaded()||"deferred"!==nh()||bb()},h.aU=ld,h.aV=Pt,h.aW=Th,h.aX=Uh,h.aY=Lp,h.aZ=s0,h.a_=Ke,h.aa=ni,h.ab=an,h.ac=Df,h.ad=class{constructor(u){this.specification=u}possiblyEvaluate(u,o){return function([l,p]){const _=Ha([1,l,p]);return{x:_.x,y:_.y,z:_.z}}(u.expression.evaluate(o))}interpolate(u,o,l){return{x:ni(u.x,o.x,l),y:ni(u.y,o.y,l),z:ni(u.z,o.z,l)}}},h.ae=function(u,o,l=0,p=!0){const _=new Ht(l,l),f=u.sub(_),y=o.add(_),T=[f,new Ht(y.x,f.y),y,new Ht(f.x,y.y)];return p&&T.push(f.clone()),T},h.af=function(u,o){const l=[];for(let p=0;p<u.length;p++){const _=hr(p-1,-1,u.length-1),f=hr(p+1,-1,u.length-1),y=u[p],T=u[f],E=u[_].sub(y).unit(),P=T.sub(y).unit(),w=P.angleWithSep(E.x,E.y),I=E.add(P).unit().mult(-1*o/Math.sin(w/2));l.push(y.add(I))}return l},h.ag=PE,h.ah=Br,h.ai=function(u,o,l=0){return Q.vec3.fromValues(((o.x-l)*u.scale-u.x)*an,(o.y*u.scale-u.y)*an,ve(o.z,o.y))},h.aj=Va,h.ak=vh,h.al=function(u){let o=1/0,l=1/0,p=-1/0,_=-1/0;for(const f of u)o=Math.min(o,f.x),l=Math.min(l,f.y),p=Math.max(p,f.x),_=Math.max(_,f.y);return{min:new Ht(o,l),max:new Ht(p,_)}},h.am=K,h.an=Xi,h.ao=Ne,h.ap=Bt,h.aq=ws,h.ar=function(u,o){const l={};for(let p=0;p<o.length;p++){const _=o[p];_ in u&&(l[_]=u[_])}return l},h.as=U,h.at=re,h.au=class{constructor(u){this.entries={},this.scheduler=u}request(u,o,l,p){const _=this.entries[u]=this.entries[u]||{callbacks:[]};if(_.result){const[f,y]=_.result;return this.scheduler?this.scheduler.add(()=>{p(f,y)},o):p(f,y),()=>{}}return _.callbacks.push(p),_.cancel||(_.cancel=l((f,y)=>{_.result=[f,y];for(const T of _.callbacks)this.scheduler?this.scheduler.add(()=>{T(f,y)},o):T(f,y);setTimeout(()=>delete this.entries[u],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(f=>f!==p),_.callbacks.length||(_.cancel(),delete this.entries[u]))}}},h.av=gp,h.aw=function(u,o,l){const p=JSON.stringify(u.request);return u.data&&(this.deduped.entries[p]={result:[null,u.data]}),this.deduped.request(p,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},_=>{const f=jd(u.request,(y,T,E,P)=>{y?_(y):T&&_(null,{vectorTile:l?void 0:new um.VectorTile(new Yg(T)),rawData:T,cacheControl:E,expires:P})});return()=>{f.cancel(),_()}},o)},h.ax=function(u){Ar++,Ar>di&&(u.getActor().send("enforceCacheSizeLimit",gi),Ar=0)},h.ay=Yt,h.az=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log(u)/Math.LN2))},h.b=function(u){return Me.API_FONTS_REGEX.test(u)},h.b$=Ea,h.b0=Tb,h.b1=zl,h.b2=No,h.b3=Ng,h.b4=G0,h.b5=function(u,o){const l=yd(o.zoom);if(0===l)return fc(u);const p=sm(u),_=Pb(p),f=K(p.getWest())*o.worldSize,y=K(p.getEast())*o.worldSize,T=re(p.getNorth())*o.worldSize,E=re(p.getSouth())*o.worldSize,P=[f,T,0],w=[y,T,0],I=[f,E,0],R=[y,E,0],D=Q.mat4.invert([],o.globeMatrix);return Q.vec3.transformMat4(P,P,D),Q.vec3.transformMat4(w,w,D),Q.vec3.transformMat4(I,I,D),Q.vec3.transformMat4(R,R,D),_[0]=Iu(_[0],I,l),_[1]=Iu(_[1],R,l),_[2]=Iu(_[2],w,l),_[3]=Iu(_[3],P,l),wr.fromPoints(_)},h.b6=kb,h.b7=Lg,h.b8=Iu,h.b9=bp,h.bA=Gn,h.bB=hr,h.bC=pi,h.bD=zd,h.bE=ie,h.bF=function(u,o,l){u[4*o+0]=l[0],u[4*o+1]=l[1],u[4*o+2]=l[2],u[4*o+3]=l[3]},h.bG=gd,h.bH=hc,h.bI=Rg,h.bJ=xs,h.bK=Cu,h.bL=N,h.bM=BE,h.bN=vi,h.bO=xl,h.bP=J0,h.bQ=ss,h.bR=Sp,h.bS=function(u,o,l,p,_,f,y,T,E){if("globe"===E.name)return Sp(u,o,new ss(l,p,_),!1);const P=wm({z:l,x:p,y:_},E);return new wr([(f+P.x/P.scale)*o,o*(P.y/P.scale),y],[(f+P.x2/P.scale)*o,o*(P.y2/P.scale),T])},h.bT=function(u,o,l){let p=0;for(let _=0;_<2;++_)u[_]>0&&(p+=(u[_]-0)*(u[_]-0)),o[_]<0&&(p+=(0-o[_])*(0-o[_]));return p},h.bU=Ee,h.bV=6,h.bW=function(u){const o=Q.mat4.identity(new Float64Array(16));Q.mat4.multiply(o,u.pixelMatrix,u.globeMatrix);const l=[0,v,0],p=[0,S,0];return Q.vec3.transformMat4(l,l,o),Q.vec3.transformMat4(p,p,o),[l[0]>0&&l[0]<=u.width&&l[1]>0&&l[1]<=u.height&&!Ob(u,new N(u.center.lat,90)),p[0]>0&&p[0]<=u.width&&p[1]>0&&p[1]<=u.height&&!Ob(u,new N(u.center.lat,-90))]},h.bX=function(u,o){const{scale:l}=u.tileTransform,p=l*an/(u.tileSize*Math.pow(2,o.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return Q.mat2.scale(new Float32Array(4),o.inverseAdjustmentMatrix,[p,p])},h.bY=wy,h.bZ=Y0,h.b_=function(u){const o=Y0(u,!0);return Q.mat2.invert([],[o[0],o[1],o[4],o[5]])},h.ba=As,h.bb=el,h.bc=Yg,h.bd=jd,h.be=function(u){const o=[];for(const l in u)o.push(u[l]);return o},h.bf=function(u,o){const l=[];for(const p in u)p in o||l.push(p);return l},h.bg=kr,h.bh=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.bi=ao,h.bj=function(u,o){const{x:l,y:p}=u.point,_=iw(l,p,u.worldSize/u._pixelsPerMercatorPixel,0,0);return Q.mat4.multiply(_,_,$v(fc(o)))},h.bk=Op,h.bl=wl,h.bm=v0,h.bn=function(u,o,l,p,_){const f=5*o+2;u.float32[f+0]=l,u.float32[f+1]=p,u.float32[f+2]=_},h.bo=V0,h.bp=Yw,h.bq=Lt,h.br=24,h.bs=vw,h.bt=cS,h.bu=Sw,h.bv=Tw,h.bw=ym,h.bx=R0,h.by=oy,h.bz=By,h.c=Le,h.c$=Yr,h.c0=function(u){const{x:o,y:l}=u.point,{lng:p,lat:_}=u._center;return iw(o,l,u.worldSize,p,_)},h.c1=Oe,h.c2=fr,h.c3=5,h.c4=function(u){const o=Math.round((u+45+360)%360/90)%4;return ae[o]},h.c5=45,h.c6=ee,h.c7=im,h.c8=function(u,o,l){const p=Math.sqrt(u*u+o*o+l*l),_=p>0?Math.acos(l/p)*Ao:0;let f=0!==u||0!==o?Math.atan2(-o,-u)*Ao+90:0;return f<0&&(f+=360),[p,f,_]},h.c9=Fe,h.cA=function(u){const o=Ee-5;u=Bt(u,-o,o)/o*90;const l=Math.pow(Math.abs(Math.sin(pi(u))),3);return Math.round(l*(g.length-1))},h.cB=function(u,o,l,p){const _=o.getNorth(),f=o.getSouth(),y=o.getWest(),T=o.getEast(),E=1<<u.z,P=T-y,w=_-f,I=P/c,R=-w/g[l],D=[0,I,0,R,0,0,_,y,0];if(u.z>0){const M=180/p;Q.mat3.multiply(D,D,[M/P+1,0,0,0,M/w+1,0,-.5*M/I,.5*M/R,1])}return D[2]=E,D[5]=u.x,D[8]=u.y,D},h.cC=fc,h.cD=function(u,o,l){const p=Q.mat4.identity(new Float64Array(16)),_=(o/(1<<u)-.5)*Math.PI*2;return Q.mat4.rotateY(p,l.globeMatrix,_),Float32Array.from(p)},h.cE=class{isDataAvailableAtPoint(u){const o=this._source();if(this.isUsingMockSource()||!o||u.y<0||u.y>1)return!1;const l=o.getSource().maxzoom,p=1<<l,_=Math.floor(u.x),f=Math.floor((u.x-_)*p),y=Math.floor(u.y*p),T=this.findDEMTileFor(new zi(l,_,l,f,y));return!(!T||!T.dem)}getAtPointOrZero(u,o=0){return this.getAtPoint(u,o)||0}getAtPoint(u,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const p=this._source();if(!p||u.y<0||u.y>1)return o;const _=p.getSource().maxzoom,f=1<<_,y=Math.floor(u.x),T=u.x-y,E=new zi(_,y,_,Math.floor(T*f),Math.floor(u.y*f)),P=this.findDEMTileFor(E);if(!P||!P.dem)return o;const w=P.dem,I=1<<P.tileID.canonical.z,R=(T*I-P.tileID.canonical.x)*w.dim,D=(u.y*I-P.tileID.canonical.y)*w.dim,M=Math.floor(R),L=Math.floor(D);return(l?this.exaggeration():1)*ni(ni(w.get(M,L),w.get(M,L+1),D-L),ni(w.get(M+1,L),w.get(M+1,L+1),D-L),R-M)}getAtTileOffset(u,o,l){const p=1<<u.canonical.z;return this.getAtPointOrZero(new He(u.wrap+(u.canonical.x+o/an)/p,(u.canonical.y+l/an)/p))}getAtTileOffsetFunc(u,o,l,p){return _=>{const f=this.getAtTileOffset(u,_.x,_.y),y=p.upVector(u.canonical,_.x,_.y),T=p.upVectorScale(u.canonical,o,l).metersToTile;return Q.vec3.scale(y,y,f*T),y}}getForTilePoints(u,o,l,p){if(this.isUsingMockSource())return!1;const _=Cd.create(this,u,p);return!!_&&(o.forEach(f=>{f[2]=this.exaggeration()*_.getElevationAt(f[0],f[1],l)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(u);if(!o||!o.dem)return null;const l=o.dem.tree,p=o.tileID,_=1<<u.canonical.z-p.canonical.z;let f=u.canonical.x/_-p.canonical.x,y=u.canonical.y/_-p.canonical.y,T=0;for(let E=0;E<u.canonical.z-p.canonical.z&&!l.leaves[T];E++){f*=2,y*=2;const P=2*Math.floor(y)+Math.floor(f);T=l.childOffsets[T]+P,f%=1,y%=1}return{min:this.exaggeration()*l.minimums[T],max:this.exaggeration()*l.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(0===u.length)return null;let o=!1,l=Number.MAX_VALUE,p=Number.MIN_VALUE;for(const _ of u){const f=this.getMinMaxForTile(_.tileID);f&&(l=Math.min(l,f.min),p=Math.max(p,f.max),o=!0)}return o?{min:l,max:p}:null}},h.cF=Bb,h.cG=fh,h.cH=function(u,o){return[Math.pow(u[0],2.2)*o,Math.pow(u[1],2.2)*o,Math.pow(u[2],2.2)*o]},h.cI=nw,h.cJ=fe,h.cK=le,h.cL=256,h.cM=function(u,o){const l=[0,0,0],p=kb(fc(o.canonical));return Q.vec3.transformMat4(l,l,p),Q.vec3.transformMat4(l,l,u),l},h.cN=u=>({u_camera_to_center_distance:new xs(u),u_extrude_scale:new Du(u),u_device_pixel_ratio:new xs(u),u_matrix:new gd(u),u_inv_rot_matrix:new gd(u),u_merc_center:new hc(u),u_tile_id:new Rg(u),u_zoom_transition:new xs(u),u_up_dir:new Rg(u),u_emissive_strength:new xs(u)}),h.cO=u=>({u_matrix:new gd(u),u_pixels_to_tile_units:new Du(u),u_device_pixel_ratio:new xs(u),u_units_to_pixels:new hc(u),u_dash_image:new Cu(u),u_gradient_image:new Cu(u),u_image_height:new xs(u),u_texsize:new hc(u),u_tile_units_to_pixels:new xs(u),u_alpha_discard_threshold:new xs(u),u_trim_offset:new hc(u),u_trim_fade_range:new hc(u),u_trim_color:new im(u),u_emissive_strength:new xs(u),u_zbias_factor:new xs(u),u_tile_to_meter:new xs(u)}),h.cP=u=>({u_matrix:new gd(u),u_texsize:new hc(u),u_pixels_to_tile_units:new Du(u),u_device_pixel_ratio:new xs(u),u_image:new Cu(u),u_units_to_pixels:new hc(u),u_tile_units_to_pixels:new xs(u),u_alpha_discard_threshold:new xs(u),u_trim_offset:new hc(u),u_emissive_strength:new xs(u),u_zbias_factor:new xs(u),u_tile_to_meter:new xs(u)}),h.cQ=fd,h.cR=q2,h.cS=gE,h.cT=Xv,h.cU=(u,o,l,p,_,f)=>{const y=u.transform,T="globe"===y.projection.name;let E;if("map"===f.paint.get("circle-pitch-alignment"))if(T){const w=nw(y.zoom,o.canonical)*y._pixelsPerMercatorPixel;E=Float32Array.from([w,0,0,w])}else E=y.calculatePixelsToTileUnitsMatrix(l);else E=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(y.projection),u_matrix:u.translatePosMatrix(o.projMatrix,l,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:hn.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:rw,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(T){P.u_inv_rot_matrix=p,P.u_merc_center=_,P.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],P.u_zoom_transition=yd(y.zoom);const w=_[0]*an,I=_[1]*an;P.u_up_dir=y.projection.upVector(new ss(0,0,0),w,I)}return P},h.cV=Vw,h.cW=(u,o,l,p,_,f)=>{const y=u.transform,T=y.pitch<15?zw(.07,.7,Bt((14-y.zoom)/5,0,1)):.07;return{u_matrix:ty(u,o,l,p),u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:y.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:ey(o,y),u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:f,u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:T,u_tile_to_meter:Fe(o.tileID.canonical,0)}},h.cX=(u,o,l,p,_,f,y)=>{const T=u.transform,E=T.calculatePixelsToTileUnitsMatrix(o),P=T.pitch<15?zw(.07,.7,Bt((14-T.zoom)/5,0,1)):.07;return{u_matrix:ty(u,o,l,p),u_pixels_to_tile_units:E,u_device_pixel_ratio:f,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:ny(l)&&o.lineAtlasTexture?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ey(o,u.transform),u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toRenderColor(l.lut).toArray01(),u_emissive_strength:l.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:Fe(o.tileID.canonical,0)}},h.cY=Jl,h.cZ=Tp,h.c_=y0,h.ca=wr,h.cb=Ha,h.cc=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},h.cd=function(u){return u({pluginStatus:wo,pluginURL:Is}),xg.on("pluginStateChange",u),u},h.ce=ox,h.cf=Py,h.cg=gm,h.ch=E0,h.ci=Cf,h.cj=Yo,h.ck=ai,h.cl=Cr,h.cm=dl,h.cn=function(u){const o=u.indexOf("\x1f");return o>=0?u.slice(0,o):u},h.co=function(u){const o=u.indexOf("\x1f");return o>=0?u.slice(o+1):""},h.cp=function(u){const o=[],l=u.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===u.render&&o.push({message:`layers.${l}: missing required method "render"`}),u.renderingMode&&"2d"!==u.renderingMode&&"3d"!==u.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},h.cq=function(u,o,l,p){return"custom"===u.type?new oS(u,o):new p_[u.type](u,o,l,p)},h.cr=Xu,h.cs=xg,h.ct=Yu,h.cu=Pg,h.cv=class extends Tu{constructor(u){super(u),this.current=rm}set(u,o,l){if(this.fetchUniformLocation(u,o))for(let p=0;p<9;p++)if(l[p]!==this.current[p]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},h.cw=he,h.cx=function(u,o,l){const p=yd(l.zoom),_=u.style.map._antialias,f=o.options.extStandardDerivativesForceOff||u.terrain&&u.terrain.exaggeration()>0;return 0===p&&!_&&!f},h.cy=function(u){const o=u.pixelsPerMeter,l=o/ie(1,u.center.lat),p=Q.mat4.identity(new Float64Array(16));return Q.mat4.translate(p,p,[u.point.x,u.point.y,0]),Q.mat4.scale(p,p,[l,l,o]),Float32Array.from(p)},h.cz=sm,h.d=function(u){return Me.API_TILEJSON_REGEX.test(u)},h.d$=dt,h.d0=Xb,h.d1=xd,h.d2=450,h.d3=7,h.d4=nS,h.d5=er,h.d6=Eg,h.d7=256,h.d8=$v,h.d9=Fl,h.dA=Lb,h.dB=function(u){const o=[0,0,0],l=Q.mat4.identity(new Float64Array(16));return Q.mat4.multiply(l,u.pixelMatrix,u.globeMatrix),Q.vec3.transformMat4(o,o,l),new Ht(o[0],o[1])},h.dC=function(u,o,l=!1){if(wo===$f||wo===sd||wo===pp)throw new Error("setRTLTextPlugin cannot be called multiple times.");Is=hn.resolveURL(u),wo=$f,Wf=o,gu(),l||bb()},h.dD=nh,h.dE=function(){Py().acquire(ne)},h.dF=function(){const u=rn;u&&(u.isPreloaded()&&1===u.numActive()?(u.release(ne),rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},h.dG=oe,h.dH=function(u){const o=tr();if(!o)return;const l=o.delete(mi);u&&l.catch(u).then(()=>u())},h.dI=g_,h.dJ=ky,h.dK=function(u){Zi=hn.resolveURL(u),Wp||(Wp=new ox(Py(),new uu)),Wp.broadcast("setDracoUrl",Zi)},h.dL=Wt,h.dM=function(u){or=hn.resolveURL(u),Wp||(Wp=new ox(Py(),new uu)),Wp.broadcast("setMeshoptUrl",or)},h.dN=Tn,h.dO=Vc,h.dP=2,h.dQ=px,h.dR=IS,h.dS=kp,h.dT=Pa,h.dU=Qg,h.dV=function(u,o,l,p,_,f,y,T,E,P,w=1,I){u.createArrays(),u.tilePixelRatio=an/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const R=u.layers[0].layout,D=u.layers[0]._unevaluatedLayout._values,M={};if(M.scaleFactor=w,M.textSizeScaleRange=R.get("text-size-scale-range"),M.iconSizeScaleRange=R.get("icon-size-scale-range"),M.textScaleFactor=Bt(M.scaleFactor,M.textSizeScaleRange[0],M.textSizeScaleRange[1]),M.iconScaleFactor=Bt(M.scaleFactor,M.iconSizeScaleRange[0],M.iconSizeScaleRange[1]),"composite"===u.textSizeData.kind){const{minZoom:G,maxZoom:$}=u.textSizeData;M.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Po(G),T),D["text-size"].possiblyEvaluate(new Po($),T)]}if("composite"===u.iconSizeData.kind){const{minZoom:G,maxZoom:$}=u.iconSizeData;M.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Po(G),T),D["icon-size"].possiblyEvaluate(new Po($),T)]}M.layoutTextSize=D["text-size"].possiblyEvaluate(new Po(E+1),T),M.layoutIconSize=D["icon-size"].possiblyEvaluate(new Po(E+1),T),M.textMaxSize=D["text-size"].possiblyEvaluate(new Po(18),T);const L="map"===R.get("text-rotation-alignment")&&"point"!==R.get("symbol-placement"),V=R.get("text-size");let j=!1;for(const G of u.features)if(G.icon&&G.icon.nameSecondary){j=!0;break}for(const G of u.features){const $=R.get("text-font").evaluate(G,{},T).join(","),H=V.evaluate(G,{},T)*M.textScaleFactor,Y=M.layoutTextSize.evaluate(G,{},T)*M.textScaleFactor,J=(M.layoutIconSize.evaluate(G,{},T),{horizontal:{},vertical:void 0}),ce=G.text;let we,_e=[0,0];if(ce){const de=ce.toString(),De=24*R.get("text-letter-spacing").evaluate(G,{},T),Be=24*R.get("text-line-height").evaluate(G,{},T),je=Gf(de)?De:0,Xe=R.get("text-anchor").evaluate(G,{},T),it=R.get("text-variable-anchor");if(!it){const vt=R.get("text-radial-offset").evaluate(G,{},T);_e=vt?R0(Xe,[24*vt,ue]):R.get("text-offset").evaluate(G,{},T).map(yn=>24*yn)}let at=L?"center":R.get("text-justify").evaluate(G,{},T);const et="point"===R.get("symbol-placement"),It=et?24*R.get("text-max-width").evaluate(G,{},T):1/0,Xt=vt=>{u.allowVerticalPlacement&&qf(de)&&(J.vertical=S0(ce,o,l,_,$,It,Be,Xe,vt,je,_e,wl.vertical,!0,Y,H))};if(!L&&it){const vt="auto"===at?it.map(ln=>ym(ln)):[at];let yn=!1;for(let ln=0;ln<vt.length;ln++){const Kt=vt[ln];if(!J.horizontal[Kt])if(yn)J.horizontal[Kt]=J.horizontal[0];else{const Gt=S0(ce,o,l,_,$,It,Be,"center",Kt,je,_e,wl.horizontal,!1,Y,H);Gt&&(J.horizontal[Kt]=Gt,yn=1===Gt.positionedLines.length)}}Xt("left")}else{if("auto"===at&&(at=ym(Xe)),et||R.get("text-writing-mode").indexOf("horizontal")>=0||!qf(de)){const vt=S0(ce,o,l,_,$,It,Be,Xe,at,je,_e,wl.horizontal,!1,Y,H);vt&&(J.horizontal[at]=vt)}Xt(et?"left":at)}}let be=!1;if(G.icon&&G.icon.namePrimary){const de=p[G.icon.namePrimary];de&&(we=TE(_[G.icon.namePrimary],G.icon.nameSecondary?_[G.icon.nameSecondary]:void 0,R.get("icon-offset").evaluate(G,{},T),R.get("icon-anchor").evaluate(G,{},T)),be=de.sdf,void 0===u.sdfIcons?u.sdfIcons=de.sdf:u.sdfIcons!==de.sdf&&Ki("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(de.pixelRatio!==u.pixelRatio||0!==R.get("icon-rotate").constantOr(1))&&(u.iconsNeedLinear=!0))}const Z=Ru(J.horizontal)||J.vertical;u.iconsInText||(u.iconsInText=!!Z&&Z.iconsInText),(Z||we)&&Gc(u,G,J,we,p,M,Y,0,_e,be,y,T,P,I,j)}f&&u.generateCollisionDebugBuffers(E,u.collisionBoxArray,M.textScaleFactor)},h.dW=um,h.dX=Ey,h.dY=st,h.dZ=bw,h.d_=$w,h.da=Nc,h.db=xu,h.dc=function(u,o,l,p,_){return Bt((u-o)/(l-o)*(_-p)+p,p,_)},h.dd=aa,h.de=Ie,h.df=class{constructor(u,o,l,p){this.context=u,this.format=p,this.size=l,this.texture=u.gl.createTexture();const[_,f,y]=this.size,{gl:T}=u;T.bindTexture(T.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),T.texImage3D(T.TEXTURE_3D,0,this.format,_,f,y,0,$0(this.format),Sm(this.format),o.data)}bind(u,o){const{context:l}=this,{gl:p}=l;p.bindTexture(p.TEXTURE_3D,this.texture),u!==this.minFilter&&(p.texParameteri(p.TEXTURE_3D,p.TEXTURE_MAG_FILTER,u),p.texParameteri(p.TEXTURE_3D,p.TEXTURE_MIN_FILTER,u),this.minFilter=u),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_3D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_3D,p.TEXTURE_WRAP_T,o),this.wrapS=o)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},h.dg=o_,h.dh=[1,1,1],h.di=Cd,h.dj=jp,h.dk=gr,h.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ht(1/0,1/0),max:new Ht(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,o=!1){const l=p0(new Ht(0,0),new Ht(an,an),u),p=[];if(o&&!h0(l,this._globalClipBounds))return p;for(const _ of this._activeRegions){if(_.hiddenByOverlap||!h0(l,_))continue;const f=tE(_.min,_.max,u);p.push({min:f.min,max:f.max,sourceId:this._sourceIds[_.priority],footprint:_.footprint,footprintTileId:_.tileId,order:_.order,clipMask:_.clipMask,clipScope:_.clipScope})}return p}setSources(u){this._setSources(u.map(o=>({getSourceId:()=>o.cache.id,getFootprints:()=>{const l=[];for(const p of o.cache.getVisibleCoordinates()){const _=o.cache.getTile(p).buckets[o.layer];_&&_.updateFootprints(p.toUnwrapped(),l)}return l},getOrder:()=>o.order,getClipMask:()=>o.clipMask,getClipScope:()=>o.clipScope})))}_addSource(u){const o=u.getFootprints();if(0===o.length)return;const l=u.getOrder(),p=u.getClipMask(),_=u.getClipScope();for(const f of o){if(!f.footprint)continue;const y=p0(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:l,clipMask:p,clipScope:_})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((o,l)=>o.priority-l.priority||fo(o.min,l.min)||fo(o.max,l.max)||o.order-l.order||o.clipMask-l.clipMask||function(p,_){const f=(y,T)=>y+T;return p.length-_.length||p.reduce(f,"").localeCompare(_.reduce(f,""))}(o.clipScope,l.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let o=0;for(;!u&&o!==this._activeRegions.length;){const l=this._activeRegions[o],p=this._prevRegions[o];u=l.priority!==p.priority||!$b(l,p)||l.order!==p.order||l.clipMask!==p.clipMask||!ao(l.clipScope,p.clipScope),++o}}if(u){++this._updateTime;for(const l of this._activeRegions)l.order!==dm&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,l.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,l.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,l.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,l.max.y));const o=l=>{const p=this._activeRegions;if(l>=p.length)return l;const _=p[l].priority;for(;l<p.length&&p[l].priority===_;)++l;return l};if(this._sourceIds.length>1){let l=0,p=o(l);for(;l!==p;){let _=l;const f=l;for(;_!==p;){const y=this._activeRegions[_];y.hiddenByOverlap=!1;for(let T=0;T<f;T++){const E=this._activeRegions[T];if(!E.hiddenByOverlap&&y.order===dm&&h0(y,E)&&(y.hiddenByOverlap=ww(y.footprint,y.tileId,E.footprint,E.tileId),y.hiddenByOverlap))break}++_}l=p,p=o(l)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let o=u.length-1;o>=0;o--)this._addSource(u[o]);this._computeReplacement()}},h.dm=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,o){const l=new bu,p=new Xr,_=[],f=u+1+2,y=o[0]+1,T=o[0]+1+(1+o.length),E=(P,w,I)=>{let R=P===f-1?P-2:0===P?P:P-1;return R+=I?24575:0,[R,w]};for(let P=0;P<f;++P)l.emplaceBack(...E(P,0,!0));for(let P=0;P<y;++P)for(let w=0;w<f;++w)l.emplaceBack(...E(w,P,(0===w||w===f-1)&&!0));for(let P=0;P<o.length;++P){const w=o[P];for(let I=0;I<f;++I)l.emplaceBack(...E(I,w,!0))}for(let P=0;P<o.length;++P){const w=p.length,I=o[P]+1+2,R=new Xr;for(let L=0;L<I-1;L++){const V=L===I-2,j=V?f*(T-o.length+P-L):f;for(let G=0;G<f-1;G++){const $=L*f+G;0===L||V||0===G||G===f-2?(R.emplaceBack($+1,$,$+j),R.emplaceBack($+j,$+j+1,$+1)):(p.emplaceBack($+1,$,$+j),p.emplaceBack($+j,$+j+1,$+1))}}const D=No.simpleSegment(0,w,l.length,p.length-w);for(let L=0;L<R.uint16.length;L+=3)p.emplaceBack(R.uint16[L],R.uint16[L+1],R.uint16[L+2]);const M=No.simpleSegment(0,w,l.length,p.length-w);_.push({withoutSkirts:D,withSkirts:M})}return{vertices:l,indices:p,segments:_}}_createGrid(u){const o=this._fillGridMeshWithLods(c,g);this._gridSegments=o.segments,this._gridBuffer=u.createVertexBuffer(o.vertices,zl.members),this._gridIndexBuffer=u.createIndexBuffer(o.indices,!0)}_createPoles(u){const o=new Xr;for(let y=0;y<=c;y++)o.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=u.createIndexBuffer(o,!0);const l=new Nc,p=new Nc,_=new Nc,f=new Nc;this._poleSegments=[];for(let y=0,T=0;y<5;y++){const E=360/(1<<y);l.emplaceBack(0,-ws,0,.5,0),p.emplaceBack(0,-ws,0,.5,1),_.emplaceBack(0,-ws,0,.5,.5),f.emplaceBack(0,-ws,0,.5,.5);for(let P=0;P<=c;P++){let w=P/c,I=0;const R=ni(0,E,w),[D,M,L]=C(UD,HD,R,ws);l.emplaceBack(D,M,L,w,I),p.emplaceBack(D,M,L,w,1-I);const V=pi(R);w=.5+.5*Math.sin(V),I=.5+.5*Math.cos(V),_.emplaceBack(D,M,L,w,I),f.emplaceBack(D,M,L,w,1-I)}this._poleSegments.push(No.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(l,io,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(p,io,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(_,io,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(f,io,!1)}getGridBuffers(u,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,o){return[o?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,o?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},h.dn=dm,h.dp=Ze,h.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},h.dr=kt,h.ds=Re,h.dt=k,h.du=function([u,o,l]){const p=Math.hypot(u,o,l),_=Math.atan2(u,l),f=.5*Math.PI-Math.acos(-o/p);return new N(Oe(_),Oe(f))},h.dv=Sy,h.dw=F,h.dx=function(u){const o=u.navigator?u.navigator.userAgent:null;return!!function(l){if(null==Hh){const p=l.navigator?l.navigator.userAgent:null;Hh=!!l.safari||!(!p||!(/\b(iPad|iPhone|iPod)\b/.test(p)||p.match("Safari")&&!p.match("Chrome")))}return Hh}(u)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},h.dy=function(u,o){gi=u,di=o},h.dz=Ob,h.e=Me,h.e0=function(u){let o=0;if(new Uint32Array(u,0,1)[0]!==Co){const l=new Uint32Array(u,0,7),[,,p,_,f,y]=l;o=l.byteLength+_+f+y+f,(p!==u.byteLength||o>=u.byteLength)&&Ki("Invalid b3dm header information.")}return ux(u,o)},h.e1=function(u,o){const l=hx(u);for(const p of l){for(const _ of p.meshes)dI(_);p.lights&&(p.lightMeshIndex=p.meshes.length,p.meshes.push(Ks(p.lights,o)))}return l},h.e2=d_,h.e3=rx,h.e4=Xa,h.e5=function(u){co(),null!=lr&&lr.then(o=>{o.keys().then(l=>{for(let p=0;p<l.length-u;p++)o.delete(l[p])})})},h.f=function(u){return 0===u.indexOf("mapbox:")},h.g=function(u,o){return Yu(yr(u,{method:"GET"}),o)},h.h=Ge,h.i=function(u){return Me.API_STYLE_REGEX.test(u)&&!Le(u)},h.j=function(u){return decodeURIComponent(atob(u).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join(""))},h.k=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(o,l)=>String.fromCharCode(Number("0x"+l))))},h.l=yr,h.m=Qo,h.n=function(u,o){return Yu(yr(u,{type:"json"}),o)},h.o=Ql,h.p=function(u,o){return Yu(yr(u,{method:"POST"}),o)},h.q=hn,h.r=ca,h.s=function(u){try{const o=self[u];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(o){return!1}},h.t=Wh,h.u=function(){return function u(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},h.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},h.w=Ki,h.x=ec,h.y=2,h.z=Fp}),tt(0,function(h){function dt(gt){const le=gt?gt.url.toString():void 0;return le?performance.getEntriesByName(le):[]}function Ct(gt){if("number"==typeof gt||"boolean"==typeof gt||"string"==typeof gt||null==gt)return JSON.stringify(gt);if(Array.isArray(gt)){let fe="[";for(const Me of gt)fe+=`${Ct(Me)},`;return`${fe}]`}let le="{";for(const fe of Object.keys(gt).sort())le+=`${fe}:${Ct(gt[fe])},`;return`${le}}`}function Se(gt){let le="";for(const fe of h.bh)le+=`/${Ct(gt[fe])}`;return le}class Mt{constructor(le){this.keyCache={},this._layers={},this._layerConfigs={},le&&this.replace(le)}replace(le,fe){this._layerConfigs={},this._layers={},this.update(le,[],fe)}update(le,fe,Me){this._options=Me;for(const Le of le)this._layerConfigs[Le.id]=Le,(this._layers[Le.id]=h.cq(Le,this.scope,null,this._options)).compileFilter(Me),this.keyCache[Le.id]&&delete this.keyCache[Le.id];for(const Le of fe)delete this.keyCache[Le],delete this._layerConfigs[Le],delete this._layers[Le];this.familiesBySource={};const Ge=function(Le,Je){const mt={};for(let _t=0;_t<Le.length;_t++){const Dt=Je&&Je[Le[_t].id]||Se(Le[_t]);Je&&(Je[Le[_t].id]=Dt);let Et=mt[Dt];Et||(Et=mt[Dt]=[]),Et.push(Le[_t])}const nt=[];for(const _t in mt)nt.push(mt[_t]);return nt}(h.be(this._layerConfigs),this.keyCache);for(const Le of Ge){const Je=Le.map(Yt=>this._layers[Yt.id]),mt=Je[0];if("none"===mt.visibility)continue;const nt=mt.source||"";let _t=this.familiesBySource[nt];_t||(_t=this.familiesBySource[nt]={});const Dt=mt.sourceLayer||"_geojsonTileLayer";let Et=_t[Dt];Et||(Et=_t[Dt]=[]),Et.push(Je)}}}const $t=1*h.dP;class nn{constructor(le){const fe={},Me=[];for(const mt in le){const nt=le[mt],_t=fe[mt]={};for(const Dt in nt.glyphs){const Et=nt.glyphs[+Dt];if(!Et||0===Et.bitmap.width||0===Et.bitmap.height)continue;const Yt=Et.metrics.localGlyph?$t:1,hn={x:0,y:0,w:Et.bitmap.width+2*Yt,h:Et.bitmap.height+2*Yt};Me.push(hn),_t[Dt]=hn}}const{w:Ge,h:Le}=h.z(Me),Je=new h.dO({width:Ge||1,height:Le||1});for(const mt in le){const nt=le[mt];for(const _t in nt.glyphs){const Dt=nt.glyphs[+_t];if(!Dt||0===Dt.bitmap.width||0===Dt.bitmap.height)continue;const Et=fe[mt][_t],Yt=Dt.metrics.localGlyph?$t:1;h.dO.copy(Dt.bitmap,Je,{x:0,y:0},{x:Et.x+Yt,y:Et.y+Yt},Dt.bitmap)}}this.image=Je,this.positions=fe}}h.dN(nn,"GlyphAtlas");class jt{constructor(le){this.tileID=new h.aA(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.tileZoom=le.tileZoom,this.uid=le.uid,this.zoom=le.zoom,this.lut=le.lut,this.canonical=le.tileID.canonical,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.scope=le.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=le.showCollisionBoxes,this.collectResourceTiming=!!le.request&&le.request.collectResourceTiming,this.promoteId=le.promoteId,this.isSymbolTile=le.isSymbolTile,this.tileTransform=h.aL(le.tileID.canonical,le.projection),this.projection=le.projection,this.worldview=le.worldview,this.localizableLayerIds=le.localizableLayerIds,this.brightness=le.brightness,this.extraShadowCaster=!!le.extraShadowCaster,this.tessellationStep=le.tessellationStep,this.scaleFactor=le.scaleFactor}parse(le,fe,Me,Ge,Le){this.status="parsing",this.data=le,this.collisionBoxArray=new h.aR;const Je=new h.dQ(Object.keys(le.layers).sort()),mt=new h.dR(this.tileID,this.promoteId);mt.bucketLayerIDs=[];const nt={},_t=new h.dS(256,256),Dt={featureIndex:mt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:_t,availableImages:Me,brightness:this.brightness},Et=fe.familiesBySource[this.source];for(const di in Et){const vr=le.layers[di];if(!vr)continue;let lr=!1,Pi=!1,tr=!1;for(const Qo of Et[di])"symbol"===Qo[0].type?lr=!0:Pi=!0,Qo[0].is3D()&&"model"!==Qo[0].type&&(tr=!0);if(this.extraShadowCaster&&!tr||!0===this.isSymbolTile&&!lr||!1===this.isSymbolTile&&!Pi)continue;1===vr.version&&h.w(`Vector tile source "${this.source}" layer "${di}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const co=Je.encode(di),Ar=[];for(let Qo=0,uo=0;Qo<vr.length;Qo++){const Ws=vr.feature(Qo),lu=mt.getId(Ws,di);if(this.localizableLayerIds&&this.localizableLayerIds.has(di)){const Il=Ws.properties?Ws.properties.worldview:null;if(this.worldview&&"string"==typeof Il)if("all"===Il)Ws.properties.$localized=!0;else{if(!Il.split(",").includes(this.worldview))continue;Ws.properties.$localized=!0,Ws.properties.worldview=this.worldview}}Ar.push({feature:Ws,id:lu,index:uo,sourceLayerIndex:co}),uo++}for(const Qo of Et[di]){const uo=Qo[0];(!this.extraShadowCaster||uo.is3D()&&"model"!==uo.type)&&(void 0!==this.isSymbolTile&&"symbol"===uo.type!==this.isSymbolTile||uo.minzoom&&this.zoom<Math.floor(uo.minzoom)||uo.maxzoom&&this.zoom>=uo.maxzoom||"none"!==uo.visibility&&(rt(Qo,this.zoom,Dt.brightness,Me),(nt[uo.id]=uo.createBucket({index:mt.bucketLayerIDs.length,layers:Qo,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:co,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Ar,Dt,this.tileID.canonical,this.tileTransform),mt.bucketLayerIDs.push(Qo.map(Ws=>h.av(Ws.id,Ws.scope)))))}}let Yt,hn,mn,ai;_t.trim();const mi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},gi=()=>{if(Yt)return this.status="done",Le(Yt);if(this.extraShadowCaster)this.status="done",Le(null,{buckets:h.be(nt).filter(di=>!di.isEmpty()),featureIndex:mt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Dt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(hn&&mn&&ai){const di=new nn(hn),vr=new h.dU(mn,ai,this.lut);for(const lr in nt){const Pi=nt[lr];Pi instanceof h.aS?(rt(Pi.layers,this.zoom,Dt.brightness,Me),h.dV(Pi,hn,di.positions,mn,vr.iconPositions,this.showCollisionBoxes,Me,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.brightness)):Pi.hasPattern&&(Pi instanceof h.aY||Pi instanceof h.aZ||Pi instanceof h.d0)&&(rt(Pi.layers,this.zoom,Dt.brightness,Me),Pi.addFeatures(Dt,this.tileID.canonical,vr.patternPositions,Me,this.tileTransform,this.brightness))}this.status="done",Le(null,{buckets:h.be(nt).filter(lr=>!lr.isEmpty()),featureIndex:mt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:di.image,lineAtlas:_t,imageAtlas:vr,brightness:Dt.brightness})}};if(!this.extraShadowCaster){const di=h.dT(Dt.glyphDependencies,Pi=>Object.keys(Pi).map(Number));Object.keys(di).length?Ge.send("getGlyphs",{uid:this.uid,stacks:di,scope:this.scope},(Pi,tr)=>{Yt||(Yt=Pi,hn=tr,gi())},void 0,!1,mi):hn={};const vr=Object.keys(Dt.iconDependencies);vr.length?Ge.send("getImages",{icons:vr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Pi,tr)=>{Yt||(Yt=Pi,mn=tr,gi())},void 0,!1,mi):mn={};const lr=Object.keys(Dt.patternDependencies);lr.length?Ge.send("getImages",{icons:lr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Pi,tr)=>{Yt||(Yt=Pi,ai=tr,gi())},void 0,!1,mi):ai={}}gi()}}function rt(gt,le,fe,Me){const Ge=new h.a3(le,{brightness:fe});for(const Le of gt)Le.recalculate(Ge,Me)}class ft extends h.E{constructor(le,fe,Me,Ge,Le,Je){super(),this.actor=le,this.layerIndex=fe,this.availableImages=Me,this.loadVectorData=Le||h.aw,this.loading={},this.loaded={},this.deduped=new h.au(le.scheduler),this.isSpriteLoaded=Ge,this.scheduler=le.scheduler,this.brightness=Je}loadTile(le,fe){const Me=le.uid,Ge=le&&le.request,Le=Ge&&Ge.collectResourceTiming,Je=this.loading[Me]=new jt(le);Je.abort=this.loadVectorData(le,(mt,nt)=>{const _t=!this.loading[Me];if(delete this.loading[Me],_t||mt||!nt)return Je.status="done",_t||(this.loaded[Me]=Je),fe(mt);const Dt=nt.rawData,Et={};nt.expires&&(Et.expires=nt.expires),nt.cacheControl&&(Et.cacheControl=nt.cacheControl),Je.vectorTile=nt.vectorTile||new h.dW.VectorTile(new h.bc(Dt));const Yt=()=>{Je.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.actor,(hn,mn)=>{if(hn||!mn)return fe(hn);const ai={};if(Le){const mi=dt(Ge);mi.length>0&&(ai.resourceTiming=JSON.parse(JSON.stringify(mi)))}fe(null,h.l({rawTileData:Dt.slice(0)},mn,Et,ai))})};this.isSpriteLoaded?Yt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Yt,{type:"parseTile",isSymbolTile:le.isSymbolTile,zoom:le.tileZoom}):Yt()}),this.loaded=this.loaded||{},this.loaded[Me]=Je})}reloadTile(le,fe){const Me=this.loaded,Ge=le.uid;if(Me&&Me[Ge]){const Le=Me[Ge];Le.scaleFactor=le.scaleFactor,Le.showCollisionBoxes=le.showCollisionBoxes,Le.projection=le.projection,Le.brightness=le.brightness,Le.tileTransform=h.aL(le.tileID.canonical,le.projection),Le.extraShadowCaster=le.extraShadowCaster,Le.lut=le.lut;const Je=(mt,nt)=>{const _t=Le.reloadCallback;_t&&(delete Le.reloadCallback,Le.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.actor,_t)),fe(mt,nt)};"parsing"===Le.status?Le.reloadCallback=Je:"done"===Le.status&&(Le.vectorTile?Le.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.actor,Je):Je())}else fe(null,void 0)}abortTile(le,fe){const Me=le.uid,Ge=this.loading[Me];Ge&&(Ge.abort&&Ge.abort(),delete this.loading[Me]),fe()}removeTile(le,fe){const Me=this.loaded,Ge=le.uid;Me&&Me[Ge]&&delete Me[Ge],fe()}}class Rt{loadTile(le,fe){const{uid:Me,encoding:Ge,rawImageData:Le,padding:Je}=le,mt=ImageBitmap&&Le instanceof ImageBitmap?this.getImageData(Le,Je):Le;fe(null,new h.dX(Me,mt,Ge,Je<1))}getImageData(le,fe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(le.width,le.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=le.width,this.offscreenCanvas.height=le.height,this.offscreenCanvasContext.drawImage(le,0,0,le.width,le.height);const Me=this.offscreenCanvasContext.getImageData(-fe,-fe,le.width+2*fe,le.height+2*fe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Me}}h.bb.setPbf(h.bc);class xn{decodeRasterArray({task:le,buffer:fe},Me){h.bb.performDecoding(fe,le).then(Ge=>{Me(null,Ge)},Ge=>{Me(Ge)})}}const ui=h.dW.VectorTileFeature.prototype.toGeoJSON;class Rn{constructor(le){this._feature=le,this.extent=h.ab,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(1===this._feature.type){const le=[];for(const fe of this._feature.geometry)le.push([new h.P(fe[0],fe[1])]);return le}{const le=[];for(const fe of this._feature.geometry){const Me=[];for(const Ge of fe)Me.push(new h.P(Ge[0],Ge[1]));le.push(Me)}return le}}toGeoJSON(le,fe,Me){return ui.call(this,le,fe,Me)}}class Vt{constructor(le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.ab,this.length=le.length,this._features=le}feature(le){return new Rn(this._features[le])}}const En=64/4096;class We{constructor(){this.features=new Map}clear(){this.features.clear()}load(le=[],fe){for(const Me of le){const Ge=Me.id;if(null==Ge)continue;let Le=this.features.get(Ge);Le&&this.updateCache(Le,fe),Me.geometry?(Le=Te(Me),this.updateCache(Le,fe),this.features.set(Ge,Le)):this.features.delete(Ge),this.updateCache(Le,fe)}}updateCache(le,fe){for(const{canonical:Me,uid:Ge}of Object.values(fe)){const{z:Le,x:Je,y:mt}=Me;Ft(le,Math.pow(2,Le),Je,mt)&&delete fe[Ge]}}getTile(le,fe,Me){const Ge=Math.pow(2,le),Le=[];for(const Je of this.features.values())Ft(Je,Ge,fe,Me)&&Le.push(Nt(Je,Ge,fe,Me));return{features:Le}}getFeatures(){return[...this.features.values()]}}function Ft({minX:gt,minY:le,maxX:fe,maxY:Me},Ge,Le,Je){return gt<(Le+1+En)/Ge&&le<(Je+1+En)/Ge&&fe>(Le-En)/Ge&&Me>(Je-En)/Ge}function Te(gt){const{id:le,geometry:fe,properties:Me}=gt;if(!fe)return;if("GeometryCollection"===fe.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ge,coordinates:Le}=fe,Je={id:le,type:1,geometry:[],tags:Me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},mt=Je.geometry;if("Point"===Ge)lt(Le,mt,Je);else if("MultiPoint"===Ge)for(const nt of Le)lt(nt,mt,Je);else if("LineString"===Ge)Je.type=2,Ve(Le,mt,Je);else if("MultiLineString"===Ge)Je.type=2,qe(Le,mt,Je);else if("Polygon"===Ge)Je.type=3,qe(Le,mt,Je,!0);else{if("MultiPolygon"!==Ge)throw new Error("Input data is not a valid GeoJSON object.");Je.type=3;for(const nt of Le)qe(nt,mt,Je,!0)}return Je}function lt([gt,le],fe,Me){const Ge=h.am(gt);let Le=h.at(le);Le=Le<0?0:Le>1?1:Le,fe.push(Ge,Le),Me.minX=Math.min(Me.minX,Ge),Me.minY=Math.min(Me.minY,Le),Me.maxX=Math.max(Me.maxX,Ge),Me.maxY=Math.max(Me.maxY,Le)}function Ve(gt,le,fe,Me=!1,Ge=!1){const Le=[];for(const Je of gt)lt(Je,Le,fe);le.push(Le),Me&&function(Je,mt){let nt=0;for(let _t=0,Dt=Je.length,Et=Dt-2;_t<Dt;Et=_t,_t+=2)nt+=(Je[_t]-Je[Et])*(Je[_t+1]+Je[Et+1]);if(nt>0===mt)for(let _t=0,Dt=Je.length;_t<Dt/2;_t+=2){const Et=Je[_t],Yt=Je[_t+1];Je[_t]=Je[Dt-2-_t],Je[_t+1]=Je[Dt-1-_t],Je[Dt-2-_t]=Et,Je[Dt-1-_t]=Yt}}(Le,Ge)}function qe(gt,le,fe,Me=!1){for(let Ge=0;Ge<gt.length;Ge++)Ve(gt[Ge],le,fe,Me,0===Ge)}function Nt(gt,le,fe,Me){const{id:Ge,type:Le,geometry:Je,tags:mt}=gt,nt=[];if(1===Le)!function(_t,Dt,Et,Yt,hn){for(let mn=0;mn<_t.length;mn+=2){const ai=Math.round(h.ab*(_t[mn+0]*Dt-Et)),mi=Math.round(h.ab*(_t[mn+1]*Dt-Yt));hn.push([ai,mi])}}(Je,le,fe,Me,nt);else for(const _t of Je)xt(_t,le,fe,Me,nt);return{id:Ge,type:Le,geometry:nt,tags:mt}}function xt(gt,le,fe,Me,Ge){const Le=-128,Je=h.ab+128;let mt;for(let nt=0;nt<gt.length-2;nt+=2){let _t=Math.round(h.ab*(gt[nt+0]*le-fe)),Dt=Math.round(h.ab*(gt[nt+1]*le-Me)),Et=Math.round(h.ab*(gt[nt+2]*le-fe)),Yt=Math.round(h.ab*(gt[nt+3]*le-Me));const hn=Et-_t,mn=Yt-Dt;_t<Le&&Et<Le||(_t<Le?(Dt+=Math.round(mn*((Le-_t)/hn)),_t=Le):Et<Le&&(Yt=Dt+Math.round(mn*((Le-_t)/hn)),Et=Le),Dt<Le&&Yt<Le||(Dt<Le?(_t+=Math.round(hn*((Le-Dt)/mn)),Dt=Le):Yt<Le&&(Et=_t+Math.round(hn*((Le-Dt)/mn)),Yt=Le),_t>=Je&&Et>=Je||(_t>=Je?(Dt+=Math.round(mn*((Je-_t)/hn)),_t=Je):Et>=Je&&(Yt=Dt+Math.round(mn*((Je-_t)/hn)),Et=Je),Dt>=Je&&Yt>=Je||(Dt>=Je?(_t+=Math.round(hn*((Je-Dt)/mn)),Dt=Je):Yt>=Je&&(Et=_t+Math.round(hn*((Je-Dt)/mn)),Yt=Je),mt&&_t===mt[mt.length-1][0]&&Dt===mt[mt.length-1][1]||(mt=[[_t,Dt]],Ge.push(mt)),mt.push([Et,Yt])))))}}var ct,tn,Pn,vn={exports:{}},$n=function(){if(Pn)return vn.exports;Pn=1;var gt=h.d_(),le=function(){if(tn)return ct;tn=1;var Dt=h.dY(),Et=h.dZ().VectorTileFeature;function Yt(mn,ai){this.options=ai||{},this.features=mn,this.length=mn.length}function hn(mn,ai){this.id="number"==typeof mn.id?mn.id:void 0,this.type=mn.type,this.rawGeometry=1===mn.type?[mn.geometry]:mn.geometry,this.properties=mn.tags,this.extent=ai||4096}return ct=Yt,Yt.prototype.feature=function(mn){return new hn(this.features[mn],this.options.extent)},hn.prototype.loadGeometry=function(){var mn=this.rawGeometry;this.geometry=[];for(var ai=0;ai<mn.length;ai++){for(var mi=mn[ai],gi=[],di=0;di<mi.length;di++)gi.push(new Dt(mi[di][0],mi[di][1]));this.geometry.push(gi)}return this.geometry},hn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var mn=this.geometry,ai=1/0,mi=-1/0,gi=1/0,di=-1/0,vr=0;vr<mn.length;vr++)for(var lr=mn[vr],Pi=0;Pi<lr.length;Pi++){var tr=lr[Pi];ai=Math.min(ai,tr.x),mi=Math.max(mi,tr.x),gi=Math.min(gi,tr.y),di=Math.max(di,tr.y)}return[ai,gi,mi,di]},hn.prototype.toGeoJSON=Et.prototype.toGeoJSON,ct}();function fe(Dt){var Et=new gt;return function(Yt,hn){for(var mn in Yt.layers)hn.writeMessage(3,Me,Yt.layers[mn])}(Dt,Et),Et.finish()}function Me(Dt,Et){var Yt;Et.writeVarintField(15,Dt.version||1),Et.writeStringField(1,Dt.name||""),Et.writeVarintField(5,Dt.extent||4096);var hn={keys:[],values:[],keycache:{},valuecache:{}};for(Yt=0;Yt<Dt.length;Yt++)hn.feature=Dt.feature(Yt),Et.writeMessage(2,Ge,hn);var mn=hn.keys;for(Yt=0;Yt<mn.length;Yt++)Et.writeStringField(3,mn[Yt]);var ai=hn.values;for(Yt=0;Yt<ai.length;Yt++)Et.writeMessage(4,_t,ai[Yt])}function Ge(Dt,Et){var Yt=Dt.feature;void 0!==Yt.id&&Et.writeVarintField(1,Yt.id),Et.writeMessage(2,Le,Dt),Et.writeVarintField(3,Yt.type),Et.writeMessage(4,nt,Yt)}function Le(Dt,Et){var Yt=Dt.feature,hn=Dt.keys,mn=Dt.values,ai=Dt.keycache,mi=Dt.valuecache;for(var gi in Yt.properties){var di=Yt.properties[gi],vr=ai[gi];if(null!==di){void 0===vr&&(hn.push(gi),ai[gi]=vr=hn.length-1),Et.writeVarint(vr);var lr=typeof di;"string"!==lr&&"boolean"!==lr&&"number"!==lr&&(di=JSON.stringify(di));var Pi=lr+":"+di,tr=mi[Pi];void 0===tr&&(mn.push(di),mi[Pi]=tr=mn.length-1),Et.writeVarint(tr)}}}function Je(Dt,Et){return(Et<<3)+(7&Dt)}function mt(Dt){return Dt<<1^Dt>>31}function nt(Dt,Et){for(var Yt=Dt.loadGeometry(),hn=Dt.type,mn=0,ai=0,mi=Yt.length,gi=0;gi<mi;gi++){var di=Yt[gi],vr=1;1===hn&&(vr=di.length),Et.writeVarint(Je(1,vr));for(var lr=3===hn?di.length-1:di.length,Pi=0;Pi<lr;Pi++){1===Pi&&1!==hn&&Et.writeVarint(Je(2,lr-1));var tr=di[Pi].x-mn,co=di[Pi].y-ai;Et.writeVarint(mt(tr)),Et.writeVarint(mt(co)),mn+=tr,ai+=co}3===hn&&Et.writeVarint(Je(7,1))}}function _t(Dt,Et){var Yt=typeof Dt;"string"===Yt?Et.writeStringField(1,Dt):"boolean"===Yt?Et.writeBooleanField(7,Dt):"number"===Yt&&(Dt%1!=0?Et.writeDoubleField(3,Dt):Dt<0?Et.writeSVarintField(6,Dt):Et.writeVarintField(5,Dt))}return vn.exports=fe,vn.exports.fromVectorTileJs=fe,vn.exports.fromGeojsonVt=function(Dt,Et){Et=Et||{};var Yt={};for(var hn in Dt)Yt[hn]=new le(Dt[hn].features,Et),Yt[hn].name=hn,Yt[hn].version=Et.version,Yt[hn].extent=Et.extent;return fe({layers:Yt})},vn.exports.GeoJSONWrapper=le,vn.exports}(),Kn=h.d$($n);const yi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:gt=>gt},Wn=Math.fround||(br=new Float32Array(1),gt=>(br[0]=+gt,br[0]));var br;class ks{constructor(le){this.options=Object.assign(Object.create(yi),le),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(le){const{log:fe,minZoom:Me,maxZoom:Ge}=this.options;fe&&console.time("total time");const Le=`prepare ${le.length} points`;fe&&console.time(Le),this.points=le;const Je=[];for(let nt=0;nt<le.length;nt++){const _t=le[nt];if(!_t.geometry)continue;const[Dt,Et]=_t.geometry.coordinates,Yt=Wn(Ce(Dt)),hn=Wn(dn(Et));Je.push(Yt,hn,1/0,nt,-1,1),this.options.reduce&&Je.push(0)}let mt=this.trees[Ge+1]=this._createTree(Je);fe&&console.timeEnd(Le);for(let nt=Ge;nt>=Me;nt--){const _t=+Date.now();mt=this.trees[nt]=this._createTree(this._cluster(mt,nt)),fe&&console.log("z%d: %d clusters in %dms",nt,mt.numItems,+Date.now()-_t)}return fe&&console.timeEnd("total time"),this}getClusters(le,fe){let Me=((le[0]+180)%360+360)%360-180;const Ge=Math.max(-90,Math.min(90,le[1]));let Le=180===le[2]?180:((le[2]+180)%360+360)%360-180;const Je=Math.max(-90,Math.min(90,le[3]));if(le[2]-le[0]>=360)Me=-180,Le=180;else if(Me>Le){const Et=this.getClusters([Me,Ge,180,Je],fe),Yt=this.getClusters([-180,Ge,Le,Je],fe);return Et.concat(Yt)}const mt=this.trees[this._limitZoom(fe)],nt=mt.range(Ce(Me),dn(Je),Ce(Le),dn(Ge)),_t=mt.data,Dt=[];for(const Et of nt){const Yt=this.stride*Et;Dt.push(_t[Yt+5]>1?$s(_t,Yt,this.clusterProps):this.points[_t[Yt+3]])}return Dt}getChildren(le){const fe=this._getOriginId(le),Me=this._getOriginZoom(le),Ge="No cluster with the specified id.",Le=this.trees[Me];if(!Le)throw new Error(Ge);const Je=Le.data;if(fe*this.stride>=Je.length)throw new Error(Ge);const mt=this.options.radius/(this.options.extent*Math.pow(2,Me-1)),nt=Le.within(Je[fe*this.stride],Je[fe*this.stride+1],mt),_t=[];for(const Dt of nt){const Et=Dt*this.stride;Je[Et+4]===le&&_t.push(Je[Et+5]>1?$s(Je,Et,this.clusterProps):this.points[Je[Et+3]])}if(0===_t.length)throw new Error(Ge);return _t}getLeaves(le,fe,Me){const Ge=[];return this._appendLeaves(Ge,le,fe=fe||10,Me=Me||0,0),Ge}getTile(le,fe,Me){const Ge=this.trees[this._limitZoom(le)],Le=Math.pow(2,le),{extent:Je,radius:mt}=this.options,nt=mt/Je,_t=(Me-nt)/Le,Dt=(Me+1+nt)/Le,Et={features:[]};return this._addTileFeatures(Ge.range((fe-nt)/Le,_t,(fe+1+nt)/Le,Dt),Ge.data,fe,Me,Le,Et),0===fe&&this._addTileFeatures(Ge.range(1-nt/Le,_t,1,Dt),Ge.data,Le,Me,Le,Et),fe===Le-1&&this._addTileFeatures(Ge.range(0,_t,nt/Le,Dt),Ge.data,-1,Me,Le,Et),Et.features.length?Et:null}getClusterExpansionZoom(le){let fe=this._getOriginZoom(le)-1;for(;fe<=this.options.maxZoom;){const Me=this.getChildren(le);if(fe++,1!==Me.length)break;le=Me[0].properties.cluster_id}return fe}_appendLeaves(le,fe,Me,Ge,Le){const Je=this.getChildren(fe);for(const mt of Je){const nt=mt.properties;if(nt&&nt.cluster?Le+nt.point_count<=Ge?Le+=nt.point_count:Le=this._appendLeaves(le,nt.cluster_id,Me,Ge,Le):Le<Ge?Le++:le.push(mt),le.length===Me)break}return Le}_createTree(le){const fe=new h.bz(le.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Me=0;Me<le.length;Me+=this.stride)fe.add(le[Me],le[Me+1]);return fe.finish(),fe.data=le,fe}_addTileFeatures(le,fe,Me,Ge,Le,Je){for(const mt of le){const nt=mt*this.stride,_t=fe[nt+5]>1;let Dt,Et,Yt;if(_t)Dt=Q(fe,nt,this.clusterProps),Et=fe[nt],Yt=fe[nt+1];else{const ai=this.points[fe[nt+3]];Dt=ai.properties;const[mi,gi]=ai.geometry.coordinates;Et=Ce(mi),Yt=dn(gi)}const hn={type:1,geometry:[[Math.round(this.options.extent*(Et*Le-Me)),Math.round(this.options.extent*(Yt*Le-Ge))]],tags:Dt};let mn;mn=_t||this.options.generateId?fe[nt+3]:this.points[fe[nt+3]].id,void 0!==mn&&(hn.id=mn),Je.features.push(hn)}}_limitZoom(le){return Math.max(this.options.minZoom,Math.min(Math.floor(+le),this.options.maxZoom+1))}_cluster(le,fe){const{radius:Me,extent:Ge,reduce:Le,minPoints:Je}=this.options,mt=Me/(Ge*Math.pow(2,fe)),nt=le.data,_t=[],Dt=this.stride;for(let Et=0;Et<nt.length;Et+=Dt){if(nt[Et+2]<=fe)continue;nt[Et+2]=fe;const Yt=nt[Et],hn=nt[Et+1],mn=le.within(nt[Et],nt[Et+1],mt),ai=nt[Et+5];let mi=ai;for(const gi of mn){const di=gi*Dt;nt[di+2]>fe&&(mi+=nt[di+5])}if(mi>ai&&mi>=Je){let gi,di=Yt*ai,vr=hn*ai,lr=-1;const Pi=(Et/Dt<<5)+(fe+1)+this.points.length;for(const tr of mn){const co=tr*Dt;if(nt[co+2]<=fe)continue;nt[co+2]=fe;const Ar=nt[co+5];di+=nt[co]*Ar,vr+=nt[co+1]*Ar,nt[co+4]=Pi,Le&&(gi||(gi=this._map(nt,Et,!0),lr=this.clusterProps.length,this.clusterProps.push(gi)),Le(gi,this._map(nt,co)))}nt[Et+4]=Pi,_t.push(di/mi,vr/mi,1/0,Pi,-1,mi),Le&&_t.push(lr)}else{for(let gi=0;gi<Dt;gi++)_t.push(nt[Et+gi]);if(mi>1)for(const gi of mn){const di=gi*Dt;if(!(nt[di+2]<=fe)){nt[di+2]=fe;for(let vr=0;vr<Dt;vr++)_t.push(nt[di+vr])}}}}return _t}_getOriginId(le){return le-this.points.length>>5}_getOriginZoom(le){return(le-this.points.length)%32}_map(le,fe,Me){if(le[fe+5]>1){const Je=this.clusterProps[le[fe+6]];return Me?Object.assign({},Je):Je}const Ge=this.points[le[fe+3]].properties,Le=this.options.map(Ge);return Me&&Le===Ge?Object.assign({},Le):Le}}function $s(gt,le,fe){return{type:"Feature",id:gt[le+3],properties:Q(gt,le,fe),geometry:{type:"Point",coordinates:[(Me=gt[le],360*(Me-.5)),st(gt[le+1])]}};var Me}function Q(gt,le,fe){const Me=gt[le+5],Ge=Me>=1e4?`${Math.round(Me/1e3)}k`:Me>=1e3?Math.round(Me/100)/10+"k":Me,Le=gt[le+6],Je=-1===Le?{}:Object.assign({},fe[Le]);return Object.assign(Je,{cluster:!0,cluster_id:gt[le+3],point_count:Me,point_count_abbreviated:Ge})}function Ce(gt){return gt/360+.5}function dn(gt){const le=Math.sin(gt*Math.PI/180),fe=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return fe<0?0:fe>1?1:fe}function st(gt){const le=(180-360*gt)*Math.PI/180;return 360*Math.atan(Math.exp(le))/Math.PI-90}function Ht(gt,le,fe,Me){let Ge=Me;const Le=le+(fe-le>>1);let Je,mt=fe-le;const nt=gt[le],_t=gt[le+1],Dt=gt[fe],Et=gt[fe+1];for(let Yt=le+3;Yt<fe;Yt+=3){const hn=ao(gt[Yt],gt[Yt+1],nt,_t,Dt,Et);if(hn>Ge)Je=Yt,Ge=hn;else if(hn===Ge){const mn=Math.abs(Yt-Le);mn<mt&&(Je=Yt,mt=mn)}}Ge>Me&&(Je-le>3&&Ht(gt,le,Je,Me),gt[Je+2]=Ge,fe-Je>3&&Ht(gt,Je,fe,Me))}function ao(gt,le,fe,Me,Ge,Le){let Je=Ge-fe,mt=Le-Me;if(0!==Je||0!==mt){const nt=((gt-fe)*Je+(le-Me)*mt)/(Je*Je+mt*mt);nt>1?(fe=Ge,Me=Le):nt>0&&(fe+=Je*nt,Me+=mt*nt)}return Je=gt-fe,mt=le-Me,Je*Je+mt*mt}function Hi(gt,le,fe,Me){const Ge={id:null!=gt?gt:null,type:le,geometry:fe,tags:Me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===le||"MultiPoint"===le||"LineString"===le)Ao(Ge,fe);else if("Polygon"===le)Ao(Ge,fe[0]);else if("MultiLineString"===le)for(const Le of fe)Ao(Ge,Le);else if("MultiPolygon"===le)for(const Le of fe)Ao(Ge,Le[0]);return Ge}function Ao(gt,le){for(let fe=0;fe<le.length;fe+=3)gt.minX=Math.min(gt.minX,le[fe]),gt.minY=Math.min(gt.minY,le[fe+1]),gt.maxX=Math.max(gt.maxX,le[fe]),gt.maxY=Math.max(gt.maxY,le[fe+1])}function pi(gt,le,fe,Me){if(!le.geometry)return;const Ge=le.geometry.coordinates;if(Ge&&0===Ge.length)return;const Le=le.geometry.type,Je=Math.pow(fe.tolerance/((1<<fe.maxZoom)*fe.extent),2);let mt=[],nt=le.id;if(fe.promoteId?nt=le.properties[fe.promoteId]:fe.generateId&&(nt=Me||0),"Point"===Le)Oe(Ge,mt);else if("MultiPoint"===Le)for(const _t of Ge)Oe(_t,mt);else if("LineString"===Le)ae(Ge,mt,Je,!1);else if("MultiLineString"===Le){if(fe.lineMetrics){for(const _t of Ge)mt=[],ae(_t,mt,Je,!1),gt.push(Hi(nt,"LineString",mt,le.properties));return}he(Ge,mt,Je,!1)}else if("Polygon"===Le)he(Ge,mt,Je,!0);else{if("MultiPolygon"!==Le){if("GeometryCollection"===Le){for(const _t of le.geometry.geometries)pi(gt,{id:nt,geometry:_t,properties:le.properties},fe,Me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const _t of Ge){const Dt=[];he(_t,Dt,Je,!0),mt.push(Dt)}}gt.push(Hi(nt,Le,mt,le.properties))}function Oe(gt,le){le.push(Ze(gt[0]),kt(gt[1]),0)}function ae(gt,le,fe,Me){let Ge,Le,Je=0;for(let nt=0;nt<gt.length;nt++){const _t=Ze(gt[nt][0]),Dt=kt(gt[nt][1]);le.push(_t,Dt,0),nt>0&&(Je+=Me?(Ge*Dt-_t*Le)/2:Math.sqrt(Math.pow(_t-Ge,2)+Math.pow(Dt-Le,2))),Ge=_t,Le=Dt}const mt=le.length-3;le[2]=1,Ht(le,0,mt,fe),le[mt+2]=1,le.size=Math.abs(Je),le.start=0,le.end=le.size}function he(gt,le,fe,Me){for(let Ge=0;Ge<gt.length;Ge++){const Le=[];ae(gt[Ge],Le,fe,Me),le.push(Le)}}function Ze(gt){return gt/360+.5}function kt(gt){const le=Math.sin(gt*Math.PI/180),fe=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return fe<0?0:fe>1?1:fe}function Bt(gt,le,fe,Me,Ge,Le,Je,mt){if(Me/=le,Le>=(fe/=le)&&Je<Me)return gt;if(Je<fe||Le>=Me)return null;const nt=[];for(const _t of gt){const Dt=_t.geometry;let Et=_t.type;const Yt=0===Ge?_t.minX:_t.minY,hn=0===Ge?_t.maxX:_t.maxY;if(Yt>=fe&&hn<Me){nt.push(_t);continue}if(hn<fe||Yt>=Me)continue;let mn=[];if("Point"===Et||"MultiPoint"===Et)In(Dt,mn,fe,Me,Ge);else if("LineString"===Et)hr(Dt,mn,fe,Me,Ge,!1,mt.lineMetrics);else if("MultiLineString"===Et)yr(Dt,mn,fe,Me,Ge,!1);else if("Polygon"===Et)yr(Dt,mn,fe,Me,Ge,!0);else if("MultiPolygon"===Et)for(const ai of Dt){const mi=[];yr(ai,mi,fe,Me,Ge,!0),mi.length&&mn.push(mi)}if(mn.length){if(mt.lineMetrics&&"LineString"===Et){for(const ai of mn)nt.push(Hi(_t.id,Et,ai,_t.tags));continue}"LineString"!==Et&&"MultiLineString"!==Et||(1===mn.length?(Et="LineString",mn=mn[0]):Et="MultiLineString"),"Point"!==Et&&"MultiPoint"!==Et||(Et=3===mn.length?"Point":"MultiPoint"),nt.push(Hi(_t.id,Et,mn,_t.tags))}}return nt.length?nt:null}function In(gt,le,fe,Me,Ge){for(let Le=0;Le<gt.length;Le+=3){const Je=gt[Le+Ge];Je>=fe&&Je<=Me&&lo(le,gt[Le],gt[Le+1],gt[Le+2])}}function hr(gt,le,fe,Me,Ge,Le,Je){let mt=kr(gt);const nt=0===Ge?Eo:Jl;let _t,Dt,Et=gt.start;for(let mi=0;mi<gt.length-3;mi+=3){const gi=gt[mi],di=gt[mi+1],vr=gt[mi+2],lr=gt[mi+3],Pi=gt[mi+4],tr=0===Ge?gi:di,co=0===Ge?lr:Pi;let Ar=!1;Je&&(_t=Math.sqrt(Math.pow(gi-lr,2)+Math.pow(di-Pi,2))),tr<fe?co>fe&&(Dt=nt(mt,gi,di,lr,Pi,fe),Je&&(mt.start=Et+_t*Dt)):tr>Me?co<Me&&(Dt=nt(mt,gi,di,lr,Pi,Me),Je&&(mt.start=Et+_t*Dt)):lo(mt,gi,di,vr),co<fe&&tr>=fe&&(Dt=nt(mt,gi,di,lr,Pi,fe),Ar=!0),co>Me&&tr<=Me&&(Dt=nt(mt,gi,di,lr,Pi,Me),Ar=!0),!Le&&Ar&&(Je&&(mt.end=Et+_t*Dt),le.push(mt),mt=kr(gt)),Je&&(Et+=_t)}let Yt=gt.length-3;const hn=gt[Yt],mn=gt[Yt+1],ai=0===Ge?hn:mn;ai>=fe&&ai<=Me&&lo(mt,hn,mn,gt[Yt+2]),Yt=mt.length-3,Le&&Yt>=3&&(mt[Yt]!==mt[0]||mt[Yt+1]!==mt[1])&&lo(mt,mt[0],mt[1],mt[2]),mt.length&&le.push(mt)}function kr(gt){const le=[];return le.size=gt.size,le.start=gt.start,le.end=gt.end,le}function yr(gt,le,fe,Me,Ge,Le){for(const Je of gt)hr(Je,le,fe,Me,Ge,Le,!1)}function lo(gt,le,fe,Me){gt.push(le,fe,Me)}function Eo(gt,le,fe,Me,Ge,Le){const Je=(Le-le)/(Me-le);return lo(gt,Le,fe+(Ge-fe)*Je,1),Je}function Jl(gt,le,fe,Me,Ge,Le){const Je=(Le-fe)/(Ge-fe);return lo(gt,le+(Me-le)*Je,Le,1),Je}function Dc(gt,le){const fe=[];for(let Me=0;Me<gt.length;Me++){const Ge=gt[Me],Le=Ge.type;let Je;if("Point"===Le||"MultiPoint"===Le||"LineString"===Le)Je=ul(Ge.geometry,le);else if("MultiLineString"===Le||"Polygon"===Le){Je=[];for(const mt of Ge.geometry)Je.push(ul(mt,le))}else if("MultiPolygon"===Le){Je=[];for(const mt of Ge.geometry){const nt=[];for(const _t of mt)nt.push(ul(_t,le));Je.push(nt)}}fe.push(Hi(Ge.id,Le,Je,Ge.tags))}return fe}function ul(gt,le){const fe=[];fe.size=gt.size,void 0!==gt.start&&(fe.start=gt.start,fe.end=gt.end);for(let Me=0;Me<gt.length;Me+=3)fe.push(gt[Me]+le,gt[Me+1],gt[Me+2]);return fe}function Pa(gt,le){if(gt.transformed)return gt;const fe=1<<gt.z,Me=gt.x,Ge=gt.y;for(const Le of gt.features){const Je=Le.geometry,mt=Le.type;if(Le.geometry=[],1===mt)for(let nt=0;nt<Je.length;nt+=2)Le.geometry.push(Xu(Je[nt],Je[nt+1],le,fe,Me,Ge));else for(let nt=0;nt<Je.length;nt++){const _t=[];for(let Dt=0;Dt<Je[nt].length;Dt+=2)_t.push(Xu(Je[nt][Dt],Je[nt][Dt+1],le,fe,Me,Ge));Le.geometry.push(_t)}}return gt.transformed=!0,gt}function Xu(gt,le,fe,Me,Ge,Le){return[Math.round(fe*(gt*Me-Ge)),Math.round(fe*(le*Me-Le))]}function dl(gt,le,fe,Me,Ge){const Le=le===Ge.maxZoom?0:Ge.tolerance/((1<<le)*Ge.extent),Je={features:[],numPoints:0,numSimplified:0,numFeatures:gt.length,source:null,x:fe,y:Me,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const mt of gt)Nd(Je,mt,Le,Ge);return Je}function Nd(gt,le,fe,Me){const Ge=le.geometry,Le=le.type,Je=[];if(gt.minX=Math.min(gt.minX,le.minX),gt.minY=Math.min(gt.minY,le.minY),gt.maxX=Math.max(gt.maxX,le.maxX),gt.maxY=Math.max(gt.maxY,le.maxY),"Point"===Le||"MultiPoint"===Le)for(let mt=0;mt<Ge.length;mt+=3)Je.push(Ge[mt],Ge[mt+1]),gt.numPoints++,gt.numSimplified++;else if("LineString"===Le)Ki(Je,Ge,gt,fe,!1,!1);else if("MultiLineString"===Le||"Polygon"===Le)for(let mt=0;mt<Ge.length;mt++)Ki(Je,Ge[mt],gt,fe,"Polygon"===Le,0===mt);else if("MultiPolygon"===Le)for(let mt=0;mt<Ge.length;mt++){const nt=Ge[mt];for(let _t=0;_t<nt.length;_t++)Ki(Je,nt[_t],gt,fe,!0,0===_t)}if(Je.length){let mt=le.tags||null;if("LineString"===Le&&Me.lineMetrics){mt={};for(const _t in le.tags)mt[_t]=le.tags[_t];mt.mapbox_clip_start=Ge.start/Ge.size,mt.mapbox_clip_end=Ge.end/Ge.size}const nt={geometry:Je,type:"Polygon"===Le||"MultiPolygon"===Le?3:"LineString"===Le||"MultiLineString"===Le?2:1,tags:mt};null!==le.id&&(nt.id=le.id),gt.features.push(nt)}}function Ki(gt,le,fe,Me,Ge,Le){const Je=Me*Me;if(Me>0&&le.size<(Ge?Je:Me))return void(fe.numPoints+=le.length/3);const mt=[];for(let nt=0;nt<le.length;nt+=3)(0===Me||le[nt+2]>Je)&&(fe.numSimplified++,mt.push(le[nt],le[nt+1])),fe.numPoints++;Ge&&function(nt,_t){let Dt=0;for(let Et=0,Yt=nt.length,hn=Yt-2;Et<Yt;hn=Et,Et+=2)Dt+=(nt[Et]-nt[hn])*(nt[Et+1]+nt[hn+1]);if(Dt>0===_t)for(let Et=0,Yt=nt.length;Et<Yt/2;Et+=2){const hn=nt[Et],mn=nt[Et+1];nt[Et]=nt[Yt-2-Et],nt[Et+1]=nt[Yt-1-Et],nt[Yt-2-Et]=hn,nt[Yt-1-Et]=mn}}(mt,Le),gt.push(mt)}const Kl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Bd{constructor(le,fe){const Me=(fe=this.options=function(Le,Je){for(const mt in Je)Le[mt]=Je[mt];return Le}(Object.create(Kl),fe)).debug;if(Me&&console.time("preprocess data"),fe.maxZoom<0||fe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(fe.promoteId&&fe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ge=function(Le,Je){const mt=[];if("FeatureCollection"===Le.type)for(let nt=0;nt<Le.features.length;nt++)pi(mt,Le.features[nt],Je,nt);else pi(mt,"Feature"===Le.type?Le:{geometry:Le},Je);return mt}(le,fe);this.tiles={},this.tileCoords=[],Me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",fe.indexMaxZoom,fe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ge=function(Le,Je){const mt=Je.buffer/Je.extent;let nt=Le;const _t=Bt(Le,1,-1-mt,mt,0,-1,2,Je),Dt=Bt(Le,1,1-mt,2+mt,0,-1,2,Je);return(_t||Dt)&&(nt=Bt(Le,1,-mt,1+mt,0,-1,2,Je)||[],_t&&(nt=Dc(_t,1).concat(nt)),Dt&&(nt=nt.concat(Dc(Dt,-1)))),nt}(Ge,fe),Ge.length&&this.splitTile(Ge,0,0,0),Me&&(Ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(le,fe,Me,Ge,Le,Je,mt){const nt=[le,fe,Me,Ge],_t=this.options,Dt=_t.debug;for(;nt.length;){Ge=nt.pop(),Me=nt.pop(),fe=nt.pop(),le=nt.pop();const Et=1<<fe,Yt=Ha(fe,Me,Ge);let hn=this.tiles[Yt];if(!hn&&(Dt>1&&console.time("creation"),hn=this.tiles[Yt]=dl(le,fe,Me,Ge,_t),this.tileCoords.push({z:fe,x:Me,y:Ge}),Dt)){Dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",fe,Me,Ge,hn.numFeatures,hn.numPoints,hn.numSimplified),console.timeEnd("creation"));const Ar=`z${fe}`;this.stats[Ar]=(this.stats[Ar]||0)+1,this.total++}if(hn.source=le,null==Le){if(fe===_t.indexMaxZoom||hn.numPoints<=_t.indexMaxPoints)continue}else{if(fe===_t.maxZoom||fe===Le)continue;if(null!=Le){const Ar=Le-fe;if(Me!==Je>>Ar||Ge!==mt>>Ar)continue}}if(hn.source=null,0===le.length)continue;Dt>1&&console.time("clipping");const mn=.5*_t.buffer/_t.extent,ai=.5-mn,mi=.5+mn,gi=1+mn;let di=null,vr=null,lr=null,Pi=null,tr=Bt(le,Et,Me-mn,Me+mi,0,hn.minX,hn.maxX,_t),co=Bt(le,Et,Me+ai,Me+gi,0,hn.minX,hn.maxX,_t);le=null,tr&&(di=Bt(tr,Et,Ge-mn,Ge+mi,1,hn.minY,hn.maxY,_t),vr=Bt(tr,Et,Ge+ai,Ge+gi,1,hn.minY,hn.maxY,_t),tr=null),co&&(lr=Bt(co,Et,Ge-mn,Ge+mi,1,hn.minY,hn.maxY,_t),Pi=Bt(co,Et,Ge+ai,Ge+gi,1,hn.minY,hn.maxY,_t),co=null),Dt>1&&console.timeEnd("clipping"),nt.push(di||[],fe+1,2*Me,2*Ge),nt.push(vr||[],fe+1,2*Me,2*Ge+1),nt.push(lr||[],fe+1,2*Me+1,2*Ge),nt.push(Pi||[],fe+1,2*Me+1,2*Ge+1)}}getTile(le,fe,Me){le=+le,fe=+fe,Me=+Me;const Ge=this.options,{extent:Le,debug:Je}=Ge;if(le<0||le>24)return null;const mt=1<<le,nt=Ha(le,fe=fe+mt&mt-1,Me);if(this.tiles[nt])return Pa(this.tiles[nt],Le);Je>1&&console.log("drilling down to z%d-%d-%d",le,fe,Me);let _t,Dt=le,Et=fe,Yt=Me;for(;!_t&&Dt>0;)Dt--,Et>>=1,Yt>>=1,_t=this.tiles[Ha(Dt,Et,Yt)];return _t&&_t.source?(Je>1&&(console.log("found parent tile z%d-%d-%d",Dt,Et,Yt),console.time("drilling down")),this.splitTile(_t.source,Dt,Et,Yt,le,fe,Me),Je>1&&console.timeEnd("drilling down"),this.tiles[nt]?Pa(this.tiles[nt],Le):null):null}}function Ha(gt,le,fe){return 32*((1<<gt)*fe+le)+gt}function Zu(gt,le){const fe=gt.tileID.canonical;if(!this._geoJSONIndex)return void le(null,null);const Me=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!Me)return void le(null,null);const Ge=new Vt(Me.features);let Le=Kn(Ge);0===Le.byteOffset&&Le.byteLength===Le.buffer.byteLength||(Le=new Uint8Array(Le)),le(null,{vectorTile:Ge,rawData:Le.buffer})}class Uh extends ft{constructor(le,fe,Me,Ge,Le,Je){super(le,fe,Me,Ge,Zu,Je),Le&&(this.loadGeoJSON=Le),this._dynamicIndex=new We}loadData(le,fe){const Me=le&&le.request,Ge=Me&&Me.collectResourceTiming;this.loadGeoJSON(le,(Le,Je)=>{if(Le||!Je)return fe(Le);if("object"!=typeof Je)return fe(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));{try{if(le.filter){const nt=h.M(le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===nt.result)throw new Error(nt.value.map(_t=>`${_t.key}: ${_t.message}`).join(", "));Je.features=Je.features.filter(_t=>nt.value.evaluate({zoom:0},_t))}le.dynamic?("Feature"===Je.type&&(Je={type:"FeatureCollection",features:[Je]}),le.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Je.features,this.loaded),le.cluster&&(Je.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=le.cluster?new ks(function({superclusterOptions:nt,clusterProperties:_t}){if(!_t||!nt)return nt;const Dt={},Et={},Yt={accumulated:null,zoom:0},hn={properties:null},mn=Object.keys(_t);for(const ai of mn){const[mi,gi]=_t[ai],di=h.M(gi),vr=h.M("string"==typeof mi?[mi,["accumulated"],["get",ai]]:mi);Dt[ai]=di.value,Et[ai]=vr.value}return nt.map=ai=>{hn.properties=ai;const mi={};for(const gi of mn)mi[gi]=Dt[gi].evaluate(Yt,hn);return mi},nt.reduce=(ai,mi)=>{hn.properties=mi;for(const gi of mn)Yt.accumulated=ai[gi],ai[gi]=Et[gi].evaluate(Yt,hn)},nt}(le)).load(Je.features):le.dynamic?this._dynamicIndex:new Bd(nt=Je,le.geojsonVtOptions)}catch(nt){return fe(nt)}const mt={};if(Ge){const nt=dt(Me);nt&&(mt.resourceTiming={},mt.resourceTiming[le.source]=JSON.parse(JSON.stringify(nt)))}fe(null,mt)}var nt})}reloadTile(le,fe){const Me=this.loaded;return Me&&Me[le.uid]?le.partial?fe(null,void 0):super.reloadTile(le,fe):this.loadTile(le,fe)}loadGeoJSON(le,fe){if(le.request)h.n(le.request,fe);else{if("string"!=typeof le.data)return fe(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));try{return fe(null,JSON.parse(le.data))}catch(Me){return fe(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(le,fe){try{fe(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(Me){fe(Me)}}getClusterChildren(le,fe){try{fe(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(Me){fe(Me)}}getClusterLeaves(le,fe){try{fe(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(Me){fe(Me)}}}class Hh{constructor(le,fe){this.tileID=new h.aA(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.tileZoom=le.tileZoom,this.uid=le.uid,this.zoom=le.zoom,this.canonical=le.tileID.canonical,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=le.projection,this.brightness=fe}parse(le,fe,Me,Ge){this.status="parsing";const Le=new h.aA(Me.tileID.overscaledZ,Me.tileID.wrap,Me.tileID.canonical.z,Me.tileID.canonical.x,Me.tileID.canonical.y),Je=[],mt=fe.familiesBySource[Me.source],nt=new h.dR(Le,Me.promoteId);return nt.bucketLayerIDs=[],nt.is3DTile=!0,h.e0(le).then(_t=>{if(!_t)return Ge(new Error("Could not parse tile"));const Dt=h.e1(_t,1/h.c9(Me.tileID.canonical)),Et=_t.json.extensionsUsed&&_t.json.extensionsUsed.includes("MAPBOX_mesh_features")||_t.json.asset.extras&&_t.json.asset.extras.MAPBOX_mesh_features,Yt=_t.json.extensionsUsed&&_t.json.extensionsUsed.includes("EXT_meshopt_compression"),hn=new h.a3(this.zoom,{brightness:this.brightness});for(const mn in mt)for(const ai of mt[mn]){const mi=ai[0];nt.bucketLayerIDs.push(ai.map(di=>h.av(di.id,di.scope))),mi.recalculate(hn,[]);const gi=new h.e2(ai,Dt,Le,Et,Yt,this.brightness,nt);Et||(gi.needsUpload=!0),Je.push(gi),gi.evaluate(mi)}this.status="done",Ge(null,{buckets:Je,featureIndex:nt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(_t=>Ge(new Error(_t.message)))}}class zd{constructor(le,fe,Me,Ge,Le,Je){this.actor=le,this.layerIndex=fe,this.availableImages=Me,this.brightness=Je,this.loading={},this.loaded={}}loadTile(le,fe){const Me=le.uid,Ge=this.loading[Me]=new Hh(le,this.brightness);h.bd(le.request,(Le,Je)=>{const mt=!this.loading[Me];return delete this.loading[Me],mt||Le?(Ge.status="done",mt||(this.loaded[Me]=Ge),fe(Le)):Je&&0!==Je.byteLength?void Ge.parse(Je,this.layerIndex,le,(nt,_t)=>{Ge.status="done",this.loaded=this.loaded||{},this.loaded[Me]=Ge,nt||!_t?fe(nt):fe(null,_t)}):(Ge.status="done",this.loaded[Me]=Ge,fe())})}reloadTile(le,fe){const Me=this.loaded,Ge=le.uid;if(Me&&Me[Ge]){const Le=Me[Ge];Le.projection=le.projection,Le.brightness=le.brightness;const Je=(mt,nt)=>{Le.reloadCallback&&(delete Le.reloadCallback,this.loadTile(le,fe)),fe(mt,nt)};"parsing"===Le.status?Le.reloadCallback=Je:"done"===Le.status&&this.loadTile(le,fe)}}abortTile(le,fe){const Me=le.uid;this.loading[Me]&&delete this.loading[Me],fe()}removeTile(le,fe){const Me=this.loaded,Ge=le.uid;Me&&Me[Ge]&&delete Me[Ge],fe()}}class qh{constructor(le){this.self=le,this.actor=new h.e3(le,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=h.bM({name:"mercator"}),this.workerSourceTypes={vector:ft,geojson:Uh,"batched-model":zd},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(fe,Me)=>{if(this.workerSourceTypes[fe])throw new Error(`Worker source with name "${fe}" already registered.`);this.workerSourceTypes[fe]=Me},this.self.registerRTLTextPlugin=fe=>{if(h.e4.isParsed())throw new Error("RTL text plugin already registered.");h.e4.applyArabicShaping=fe.applyArabicShaping,h.e4.processBidirectionalText=fe.processBidirectionalText,h.e4.processStyledBidirectionalText=fe.processStyledBidirectionalText}}clearCaches(le,fe,Me){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],delete this.demWorkerSources[le],delete this.rasterArrayWorkerSource,Me()}checkIfReady(le,fe,Me){Me()}setReferrer(le,fe){this.referrer=fe}spriteLoaded(le,{scope:fe,isLoaded:Me}){if(this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={}),this.isSpriteLoaded[le][fe]=Me,this.workerSources[le]&&this.workerSources[le][fe])for(const Ge in this.workerSources[le][fe]){const Le=this.workerSources[le][fe][Ge];for(const Je in Le){const mt=Le[Je];mt instanceof ft&&(mt.isSpriteLoaded=Me,mt.fire(new h.x("isSpriteLoaded")))}}}setImages(le,{scope:fe,images:Me},Ge){if(this.availableImages[le]||(this.availableImages[le]={}),this.availableImages[le][fe]=Me,this.workerSources[le]&&this.workerSources[le][fe]){for(const Le in this.workerSources[le][fe]){const Je=this.workerSources[le][fe][Le];for(const mt in Je)Je[mt].availableImages=Me}Ge()}else Ge()}setProjection(le,fe){this.projections[le]=h.bM(fe)}setBrightness(le,fe,Me){this.brightness=fe,Me()}setLayers(le,fe,Me){this.getLayerIndex(le,fe.scope).replace(fe.layers,fe.options),Me()}updateLayers(le,fe,Me){this.getLayerIndex(le,fe.scope).update(fe.layers,fe.removedIds,fe.options),Me()}loadTile(le,fe,Me){fe.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,fe.type,fe.source,fe.scope).loadTile(fe,Me)}loadDEMTile(le,fe,Me){this.getDEMWorkerSource(le,fe.source,fe.scope).loadTile(fe,Me)}decodeRasterArray(le,fe,Me){this.getRasterArrayWorkerSource().decodeRasterArray(fe,Me)}reloadTile(le,fe,Me){fe.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,fe.type,fe.source,fe.scope).reloadTile(fe,Me)}abortTile(le,fe,Me){this.getWorkerSource(le,fe.type,fe.source,fe.scope).abortTile(fe,Me)}removeTile(le,fe,Me){this.getWorkerSource(le,fe.type,fe.source,fe.scope).removeTile(fe,Me)}removeSource(le,fe,Me){if(!(this.workerSources[le]&&this.workerSources[le][fe.scope]&&this.workerSources[le][fe.scope][fe.type]&&this.workerSources[le][fe.scope][fe.type][fe.source]))return;const Ge=this.workerSources[le][fe.scope][fe.type][fe.source];delete this.workerSources[le][fe.scope][fe.type][fe.source],void 0!==Ge.removeSource?Ge.removeSource(fe,Me):Me()}loadWorkerSource(le,fe,Me){try{this.self.importScripts(fe.url),Me()}catch(Ge){Me(Ge.toString())}}syncRTLPluginState(le,fe,Me){try{h.e4.setState(fe);const Ge=h.e4.getPluginURL();if(h.e4.isLoaded()&&!h.e4.isParsed()&&null!=Ge){this.self.importScripts(Ge);const Le=h.e4.isParsed();Me(Le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ge}`),Le)}}catch(Ge){Me(Ge.toString())}}setDracoUrl(le,fe){this.dracoUrl=fe}getAvailableImages(le,fe){this.availableImages[le]||(this.availableImages[le]={});let Me=this.availableImages[le][fe];return Me||(Me=[]),Me}getLayerIndex(le,fe){this.layerIndexes[le]||(this.layerIndexes[le]={});let Me=this.layerIndexes[le][fe];return Me||(Me=this.layerIndexes[le][fe]=new Mt,Me.scope=fe),Me}getWorkerSource(le,fe,Me,Ge){return this.workerSources[le]||(this.workerSources[le]={}),this.workerSources[le][Ge]||(this.workerSources[le][Ge]={}),this.workerSources[le][Ge][fe]||(this.workerSources[le][Ge][fe]={}),this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={}),this.workerSources[le][Ge][fe][Me]||(this.workerSources[le][Ge][fe][Me]=new this.workerSourceTypes[fe]({send:(Le,Je,mt,nt,_t,Dt)=>{this.actor.send(Le,Je,mt,le,_t,Dt)},scheduler:this.actor.scheduler},this.getLayerIndex(le,Ge),this.getAvailableImages(le,Ge),this.isSpriteLoaded[le][Ge],void 0,this.brightness)),this.workerSources[le][Ge][fe][Me]}getDEMWorkerSource(le,fe,Me){return this.demWorkerSources[le]||(this.demWorkerSources[le]={}),this.demWorkerSources[le][Me]||(this.demWorkerSources[le][Me]={}),this.demWorkerSources[le][Me][fe]||(this.demWorkerSources[le][Me][fe]=new Rt),this.demWorkerSources[le][Me][fe]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new xn),this.rasterArrayWorkerSource}enforceCacheSizeLimit(le,fe){h.e5(fe)}getWorkerPerformanceMetrics(le,fe,Me){Me(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new qh(self)),qh}),tt(0,function(h){var dt="3.8.0";const Ct={create:"create",load:"load",fullLoad:"fullLoad"},Se={mark(m){performance.mark(m)},measure(m,s,c){performance.measure(m,s,c)}};function Mt(m){const s=m.name.split("?")[0];return h.a(s)&&s.includes("mapbox-gl.js")?"javascript":h.a(s)&&s.includes("mapbox-gl.css")?"css":h.b(s)?"fontRange":h.c(s)?"sprite":h.i(s)?"style":h.d(s)?"tilejson":"other"}var $t,nn={},jt=function(){if($t)return nn;function m(g){return!s(g)}function s(g){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var S,C,k=new Blob([""],{type:"text/javascript"}),F=URL.createObjectURL(k);try{C=new Worker(F),S=!0}catch(z){S=!1}return C&&C.terminate(),URL.revokeObjectURL(F),S}()?function(){var S=document.createElement("canvas");S.width=S.height=1;var C=S.getContext("2d");if(!C)return!1;var k=C.getImageData(0,0,1,1);return k&&k.width===S.width}()?(void 0===c[v=g&&g.failIfMajorPerformanceCaveat]&&(c[v]=function(S){var C,F,z,N,k=(F=S,z=document.createElement("canvas"),(N=Object.create(m.webGLContextAttributes)).failIfMajorPerformanceCaveat=F,z.getContext("webgl2",N));if(!k)return!1;try{C=k.createShader(k.VERTEX_SHADER)}catch(F){return!1}return!(!C||k.isContextLost())&&(k.shaderSource(C,"void main() {}"),k.compileShader(C),!0===k.getShaderParameter(C,k.COMPILE_STATUS))}(v)),c[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}$t=1,nn.supported=m,nn.notSupportedReason=s;var c={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},nn}();function rt(m,s,c){const g=document.createElement(m);return null!=s&&(g.className=s),c&&c.appendChild(g),g}function ft(m,s,c){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const v of Object.keys(s))g.setAttributeNS(null,v,String(s[v]));return c&&c.appendChild(g),g}const Rt="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,xn=Rt&&void 0!==Rt.userSelect?"userSelect":"WebkitUserSelect";let ui;function Rn(){Rt&&xn&&(ui=Rt[xn],Rt[xn]="none")}function Vt(){Rt&&xn&&(Rt[xn]=ui)}function En(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",En,!0)}function ke(){window.addEventListener("click",En,!0),window.setTimeout(()=>{window.removeEventListener("click",En,!0)},0)}function We(m,s){const c=m.getBoundingClientRect();return lt(m,c,s)}function Ft(m,s){const c=m.getBoundingClientRect(),g=[];for(let v=0;v<s.length;v++)g.push(lt(m,c,s[v]));return g}function Te(m){return void 0!==window.InstallTrigger&&2===m.button&&m.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function lt(m,s,c){const g=m.offsetWidth===s.width?1:m.offsetWidth/s.width;return new h.P((c.clientX-s.left)*g,(c.clientY-s.top)*g)}const Ve="01",qe="NO_ACCESS_TOKEN";class Nt{constructor(s,c,g){this._transformRequestFn=s,this._customAccessToken=c,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const s=function(){let c="";for(let g=0;g<10;g++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ve,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,c){return this._transformRequestFn&&this._transformRequestFn(s,c)||{url:s}}normalizeStyleURL(s,c){if(!h.f(s))return s;const g=ct(s);return g.params.push("sdk=js-3.8.0"),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeGlyphsURL(s,c){if(!h.f(s))return s;const g=ct(s);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeModelURL(s,c){if(!h.f(s))return s;const g=ct(s);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeSourceURL(s,c,g,v){if(!h.f(s))return s;const S=ct(s);return S.path=`/v4/${S.authority}.json`,S.params.push("secure"),g&&S.params.push(`language=${g}`),v&&S.params.push(`worldview=${v}`),this._makeAPIURL(S,this._customAccessToken||c)}normalizeSpriteURL(s,c,g,v){const S=ct(s);return h.f(s)?(S.path=`/styles/v1${S.path}/sprite${c}${g}`,this._makeAPIURL(S,this._customAccessToken||v)):(S.path+=`${c}${g}`,tn(S))}normalizeTileURL(s,c,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!h.f(s))return s;const v=ct(s);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||g&&"raster"!==v.authority&&512===g?"@2x":""}${h.m.supported?".webp":"$1"}`),"raster"===v.authority?v.path=`/${h.e.RASTER_URL_PREFIX}${v.path}`:"rasterarrays"===v.authority?v.path=`/${h.e.RASTERARRAYS_URL_PREFIX}${v.path}`:"3dtiles"===v.authority?v.path=`/${h.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${h.e.TILE_URL_VERSION}${v.path}`);const S=this._customAccessToken||function(C){for(const k of C){const F=k.match(/^access_token=(.*)$/);if(F)return F[1]}return null}(v.params)||h.e.ACCESS_TOKEN;return h.e.REQUIRE_ACCESS_TOKEN&&S&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,S)}canonicalizeTileURL(s,c){const g=ct(s);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return s;let v="mapbox://";g.path.match(/^\/raster\/v1\//)?v+=`raster/${g.path.replace(`/${h.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${g.path.replace(`/${h.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${g.path.replace(`/${h.e.TILE_URL_VERSION}/`,"")}`;let S=g.params;return c&&(S=S.filter(C=>!C.match(/^access_token=/))),S.length&&(v+=`?${S.join("&")}`),v}canonicalizeTileset(s,c){const g=!!c&&h.f(c),v=[];for(const S of s.tiles||[])h.h(S)?v.push(this.canonicalizeTileURL(S,g)):v.push(S);return v}_makeAPIURL(s,c){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=ct(h.e.API_URL);if(s.protocol=v.protocol,s.authority=v.authority,"http"===s.protocol){const S=s.params.indexOf("secure");S>=0&&s.params.splice(S,1)}if("/"!==v.path&&(s.path=`${v.path}${s.path}`),!h.e.REQUIRE_ACCESS_TOKEN)return tn(s);if(c=c||h.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if("s"===c[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return s.params=s.params.filter(S=>-1===S.indexOf("access_token")),s.params.push(`access_token=${c||""}`),tn(s)}}const xt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ct(m){const s=m.match(xt);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function tn(m){const s=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${s}`}const Pn="mapbox.eventData";function vn(m){if(!m)return null;const s=m.split(".");if(!s||3!==s.length)return null;try{return JSON.parse(h.j(s[1]))}catch(c){return null}}class $n{constructor(s){this.type=s,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const c=vn(h.e.ACCESS_TOKEN);let g="";return g=c&&c.u?h.k(c.u):h.e.ACCESS_TOKEN||"",s?`${Pn}.${s}:${g}`:`${Pn}:${g}`}fetchEventData(){const s=h.s("localStorage"),c=this.getStorageKey(),g=this.getStorageKey("uuid");if(s)try{const v=localStorage.getItem(c);v&&(this.eventData=JSON.parse(v));const S=localStorage.getItem(g);S&&(this.anonId=S)}catch(v){h.w("Unable to read from LocalStorage")}}saveEventData(){const s=h.s("localStorage"),c=this.getStorageKey(),g=this.getStorageKey("uuid"),v=this.anonId;if(s&&v)try{localStorage.setItem(g,v),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch(S){h.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,c,g,v){if(!h.e.EVENTS_URL)return;const S=ct(h.e.EVENTS_URL);S.params.push(`access_token=${v||h.e.ACCESS_TOKEN||""}`);const C={event:this.type,created:new Date(s).toISOString()},k=c?h.l(C,c):C,F={url:tn(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=h.p(F,z=>{this.pendingRequest=null,g(z),this.saveEventData(),this.processRequests(v)})}queueRequest(s,c){this.queue.push(s),this.processRequests(c)}}const Kn=new class extends $n{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,s){h.e.EVENTS_URL&&h.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(c=>h.f(c)||h.h(c))&&this.queueRequest(Date.now(),s)}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=vn(h.e.ACCESS_TOKEN),c=s?s.u:h.e.ACCESS_TOKEN;let g=c!==this.eventData.tokenU;h.v(this.anonId)||(this.anonId=h.u(),g=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const S=new Date(this.eventData.lastSuccess),C=new Date(v),k=(v-this.eventData.lastSuccess)/864e5;g=g||k>=1||k<-1||S.getDate()!==C.getDate()}else g=!0;g?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:dt,skuId:Ve,"enabled.telemetry":!1,userId:this.anonId},S=>{S||(this.eventData.lastSuccess=v,this.eventData.tokenU=c)},m):this.processRequests()}},yi=Kn.postTurnstileEvent.bind(Kn),Wn=new class extends $n{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,s,c,g){this.skuToken=s,this.errorCb=g,h.e.EVENTS_URL&&(c||h.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(qe)))}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||(this.anonId||this.fetchEventData(),h.v(this.anonId)||(this.anonId=h.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:dt,skuId:Ve,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):s&&(this.success[s]=!0)},m))}remove(){this.errorCb=null}},br=Wn.postMapLoadEvent.bind(Wn),qr=new class extends $n{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let s=this.mapInstanceIdMap.get(m);return s||(s=h.u(),this.mapInstanceIdMap.set(m,s)),s}getEventId(m){const s=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,s+1),s}postStyleLoadEvent(m,s){const{map:c,style:g,importedStyles:v}=s;if(!h.e.EVENTS_URL||!m&&!h.e.ACCESS_TOKEN)return;const S=this.getMapInstanceId(c),C={mapInstanceId:S,eventId:this.getEventId(S),style:g};v.length&&(C.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:C},m)}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:s,payload:c}=this.queue.shift();this.postEvent(s,c,()=>{},m)}},ds=qr.postStyleLoadEvent.bind(qr),On=new class extends $n{constructor(){super("gljs.performance")}postPerformanceEvent(m,s){h.e.EVENTS_URL&&(m||h.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},m)}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:s,performanceData:c}=this.queue.shift(),g=function(v){const S=performance.getEntriesByType("resource"),C=performance.getEntriesByType("mark"),k=function(W){const ee={};if(W)for(const K in W)if("other"!==K)for(const re of W[K]){const ie=`${K}ResolveRangeMin`,ge=`${K}ResolveRangeMax`,xe=`${K}RequestCount`,ve=`${K}RequestCachedCount`;ee[ie]=Math.min(ee[ie]||1/0,re.startTime),ee[ge]=Math.max(ee[ge]||-1/0,re.responseEnd);const Ee=Ae=>{void 0===ee[Ae]&&(ee[Ae]=0),++ee[Ae]};void 0!==re.transferSize&&0===re.transferSize&&Ee(ve),Ee(xe)}return ee}(function(W,ee){const K={};if(W)for(const re of W){const ie=ee(re);void 0===K[ie]&&(K[ie]=[]),K[ie].push(re)}return K}(S,Mt)),F=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,N=z?z.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},q=(W,ee,K)=>{null!=K&&W.push({name:ee,value:K.toString()})};for(const W in k)q(U.counters,W,k[W]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(q(U.counters,"interactionRangeMin",v.interactionRange[0]),q(U.counters,"interactionRangeMax",v.interactionRange[1])),C)for(const W of Object.keys(Ct)){const ee=Ct[W],K=C.find(re=>re.name===ee);K&&q(U.counters,ee,K.startTime)}return q(U.counters,"visibilityHidden",v.visibilityHidden),q(U.attributes,"style",function(W){if(W)for(const ee of W){const K=ee.name.split("?")[0];if(h.i(K)){const re=K.split("/").slice(-2);if(2===re.length)return`mapbox://styles/${re[0]}/${re[1]}`}}}(S)),q(U.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),q(U.attributes,"fogEnabled",v.fogEnabled?"true":"false"),q(U.attributes,"projection",v.projection),q(U.attributes,"zoom",v.zoom),q(U.metadata,"devicePixelRatio",F),q(U.metadata,"connectionEffectiveType",N),q(U.metadata,"navigatorUserAgent",navigator.userAgent),q(U.metadata,"screenWidth",window.screen.width),q(U.metadata,"screenHeight",window.screen.height),q(U.metadata,"windowWidth",window.innerWidth),q(U.metadata,"windowHeight",window.innerHeight),q(U.metadata,"mapWidth",v.width/F),q(U.metadata,"mapHeight",v.height/F),q(U.metadata,"webglRenderer",v.renderer),q(U.metadata,"webglVendor",v.vendor),q(U.metadata,"sdkVersion",dt),q(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(c);for(const v of g.metadata);for(const v of g.counters);for(const v of g.attributes);this.postEvent(s,g,()=>{},m)}},ks=On.postPerformanceEvent.bind(On),$s=new class extends $n{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,s,c,g){if(!h.e.API_URL||!h.e.SESSION_PATH)return;const v=ct(h.e.API_URL+h.e.SESSION_PATH);v.params.push(`sku=${s||""}`),v.params.push(`access_token=${g||h.e.ACCESS_TOKEN||""}`);const S={url:tn(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=h.g(S,C=>{this.pendingRequest=null,c(C),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,s,c,g){this.skuToken=s,this.errorCb=g,h.e.SESSION_PATH&&h.e.API_URL&&(c||h.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(qe)))}processRequests(m){if(this.pendingRequest||0===this.queue.length)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||this.getSession(c,this.skuToken,g=>{g?this.errorCb(g):s&&(this.success[s]=!0)},m)}remove(){this.errorCb=null}},Q=$s.getSessionAPI.bind($s),Ce=new Set;function dn(m,s){s?Ce.add(m):Ce.delete(m)}class st{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,c){this._updatedSourceCaches[s]=c,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const c=s.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(s.id),this.setDirty()}removeLayer(s){const c=s.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][s.id]=s,this._updatedLayers[c].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const c in this._updatedLayers)s[c]=s[c]||{},s[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)s[c]=s[c]||{},s[c].removedIds=Object.keys(this._removedLayers[c]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(s){this._updatedImages.add(s),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ht(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class ao extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(s){this.images[s]={},this.loaded[s]=!1,this.updatedImages[s]={},this.patterns[s]={},this.callbackDispatchedThisFrame[s]={},this.atlasImage[s]=new h.r({width:1,height:1})}isLoaded(){for(const s in this.loaded)if(!this.loaded[s])return!1;return!0}setLoaded(s,c){if(this.loaded[c]!==s&&(this.loaded[c]=s,s)){for(const{ids:g,callback:v}of this.requestors)this._notify(g,c,v);this.requestors=[]}}hasImage(s,c){return!!this.getImage(s,c)}getImage(s,c){return this.images[c][s]}addImage(s,c,g){this._validate(s,g)&&(this.images[c][s]=g)}_validate(s,c){let g=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new h.t(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new h.t(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(c.content,c)||(this.fire(new h.t(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,c){if(!s)return!0;let g=0;for(const v of s){if(v[0]<g||v[1]<v[0]||c<v[1])return!1;g=v[1]}return!0}_validateContent(s,c){return!(s&&(4!==s.length||s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,c,g){g.version=this.images[c][s].version+1,this.images[c][s]=g,this.updatedImages[c][s]=!0}removeImage(s,c){const g=this.images[c][s];delete this.images[c][s],delete this.patterns[c][s],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(s){return Object.keys(this.images[s])}getImages(s,c,g){let v=!0;const S=!!this.loaded[c];if(!S)for(const C of s)this.images[c][C]||(v=!1);S||v?this._notify(s,c,g):this.requestors.push({ids:s,scope:c,callback:g})}getUpdatedImages(s){return this.updatedImages[s]}_notify(s,c,g){const v={};for(const S of s){this.images[c][S]||this.fire(new h.x("styleimagemissing",{id:S}));const C=this.images[c][S];C?v[S]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:Boolean(C.userImage&&C.userImage.render)}:h.w(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(s){const{width:c,height:g}=this.atlasImage[s];return{width:c,height:g}}getPattern(s,c,g){const v=this.patterns[c][s],S=this.getImage(s,c);if(!S)return null;if(v&&v.position.version===S.version)return v.position;if(v)v.position.version=S.version;else{const C={w:S.data.width+2*h.y,h:S.data.height+2*h.y,x:0,y:0},k=new h.I(C,S,h.y);this.patterns[c][s]={bin:C,position:k}}return this._updatePatternAtlas(c,g),this.patterns[c][s].position}bind(s,c){const g=s.gl;let v=this.atlasTexture[c];v?this.dirty&&(v.update(this.atlasImage[c]),this.dirty=!1):(v=new h.T(s,this.atlasImage[c],g.RGBA8),this.atlasTexture[c]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(s,c){const g=[];for(const k in this.patterns[s])g.push(this.patterns[s][k].bin);const{w:v,h:S}=h.z(g),C=this.atlasImage[s];C.resize({width:v||1,height:S||1});for(const k in this.patterns[s]){const{bin:F,position:z}=this.patterns[s][k];let N=z.padding;const U=F.x+N,q=F.y+N,W=this.images[s][k].data,ee=W.width,K=W.height;N=N>1?N-1:N,h.r.copy(W,C,{x:0,y:0},{x:U,y:q},{width:ee,height:K},c),h.r.copy(W,C,{x:0,y:K-N},{x:U,y:q-N},{width:ee,height:N},c),h.r.copy(W,C,{x:0,y:0},{x:U,y:q+K},{width:ee,height:N},c),h.r.copy(W,C,{x:ee-N,y:0},{x:U-N,y:q},{width:N,height:K},c),h.r.copy(W,C,{x:0,y:0},{x:U+ee,y:q},{width:N,height:K},c),h.r.copy(W,C,{x:ee-N,y:K-N},{x:U-N,y:q-N},{width:N,height:N},c),h.r.copy(W,C,{x:0,y:K-N},{x:U+ee,y:q-N},{width:N,height:N},c),h.r.copy(W,C,{x:0,y:0},{x:U+ee,y:q+K},{width:N,height:N},c),h.r.copy(W,C,{x:ee-N,y:0},{x:U-N,y:q+K},{width:N,height:N},c)}this.dirty=!0}beginFrame(){for(const s in this.images)this.callbackDispatchedThisFrame[s]={}}dispatchRenderCallbacks(s,c){for(const g of s){if(this.callbackDispatchedThisFrame[c][g])continue;this.callbackDispatchedThisFrame[c][g]=!0;const v=this.images[c][g];Ht(v)&&this.updateImage(g,c,v)}}}function Hi(m){const s=m.key,c=m.value,g=m.valueSpec||{},v=m.objectElementValidators||{},S=m.style,C=m.styleSpec;let k=[];const F=h.B(c);if("object"!==F)return[new h.V(s,c,`object expected, ${F} found`)];for(const z in c){const N=z.split(".")[0];let U;v[N]?U=v[N]:g[N]?U=Ki:v["*"]?U=v["*"]:g["*"]&&(U=Ki),U?k=k.concat(U({key:(s&&`${s}.`)+z,value:c[z],valueSpec:g[N]||g["*"],style:S,styleSpec:C,object:c,objectKey:z},c)):k.push(new h.A(s,c[z],`unknown property "${z}"`))}for(const z in g)v[z]||g[z].required&&void 0===g[z].default&&void 0===c[z]&&k.push(new h.V(s,c,`missing required property "${z}"`));return k}function Ao(m){const s=m.value,c=m.valueSpec,g=m.style,v=m.styleSpec,S=m.key,C=m.arrayElementValidator||Ki;if("array"!==h.B(s))return[new h.V(S,s,`array expected, ${h.B(s)} found`)];if(c.length&&s.length!==c.length)return[new h.V(S,s,`array length ${c.length} expected, length ${s.length} found`)];if(c["min-length"]&&s.length<c["min-length"])return[new h.V(S,s,`array length at least ${c["min-length"]} expected, length ${s.length} found`)];let k={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};v.$version<7&&(k.function=c.function),"object"===h.B(c.value)&&(k=c.value);let F=[];for(let z=0;z<s.length;z++)F=F.concat(C({array:s,arrayIndex:z,value:s[z],valueSpec:k,style:g,styleSpec:v,key:`${S}[${z}]`},!0));return F}function pi(m){const s=m.key,c=m.value,g=m.valueSpec;let v=h.B(c);if("number"===v&&c!=c&&(v="NaN"),"number"!==v)return[new h.V(s,c,`number expected, ${v} found`)];if("minimum"in g){let S=g.minimum;if("array"===h.B(g.minimum)&&(S=g.minimum[m.arrayIndex]),c<S)return[new h.V(s,c,`${c} is less than the minimum value ${S}`)]}if("maximum"in g){let S=g.maximum;if("array"===h.B(g.maximum)&&(S=g.maximum[m.arrayIndex]),c>S)return[new h.V(s,c,`${c} is greater than the maximum value ${S}`)]}return[]}function Oe(m){const s=m.valueSpec,c=h.D(m.value.type);let g,v,S,C={};const k="categorical"!==c&&void 0===m.value.property,F=!k,z="array"===h.B(m.value.stops)&&"array"===h.B(m.value.stops[0])&&"object"===h.B(m.value.stops[0][0]),N=Hi({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(W){if("identity"===c)return[new h.V(W.key,W.value,'identity function may not have a "stops" property')];let ee=[];const K=W.value;return ee=ee.concat(Ao({key:W.key,value:K,valueSpec:W.valueSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:U})),"array"===h.B(K)&&0===K.length&&ee.push(new h.V(W.key,K,"array must have at least one stop")),ee},default:function(W){return Ki({key:W.key,value:W.value,valueSpec:s,style:W.style,styleSpec:W.styleSpec})}}});return"identity"===c&&k&&N.push(new h.V(m.key,m.value,'missing required property "property"')),"identity"===c||m.value.stops||N.push(new h.V(m.key,m.value,'missing required property "stops"')),"exponential"===c&&m.valueSpec.expression&&!h.F(m.valueSpec)&&N.push(new h.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(F&&!h.G(m.valueSpec)?N.push(new h.V(m.key,m.value,"property functions not supported")):k&&!h.H(m.valueSpec)&&N.push(new h.V(m.key,m.value,"zoom functions not supported"))),"categorical"!==c&&!z||void 0!==m.value.property||N.push(new h.V(m.key,m.value,'"property" property is required')),N;function U(W){let ee=[];const K=W.value,re=W.key;if("array"!==h.B(K))return[new h.V(re,K,`array expected, ${h.B(K)} found`)];if(2!==K.length)return[new h.V(re,K,`array length 2 expected, length ${K.length} found`)];if(z){if("object"!==h.B(K[0]))return[new h.V(re,K,`object expected, ${h.B(K[0])} found`)];if(void 0===K[0].zoom)return[new h.V(re,K,"object stop key must have zoom")];if(void 0===K[0].value)return[new h.V(re,K,"object stop key must have value")];const ie=h.D(K[0].zoom);if("number"!=typeof ie)return[new h.V(re,K[0].zoom,"stop zoom values must be numbers")];if(S&&S>ie)return[new h.V(re,K[0].zoom,"stop zoom values must appear in ascending order")];ie!==S&&(S=ie,v=void 0,C={}),ee=ee.concat(Hi({key:`${re}[0]`,value:K[0],valueSpec:{zoom:{}},style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:pi,value:q}}))}else ee=ee.concat(q({key:`${re}[0]`,value:K[0],valueSpec:{},style:W.style,styleSpec:W.styleSpec},K));return h.J(h.K(K[1]))?ee.concat([new h.V(`${re}[1]`,K[1],"expressions are not allowed in function stops.")]):ee.concat(Ki({key:`${re}[1]`,value:K[1],valueSpec:s,style:W.style,styleSpec:W.styleSpec}))}function q(W,ee){const K=h.B(W.value),re=h.D(W.value),ie=null!==W.value?W.value:ee;if(g){if(K!==g)return[new h.V(W.key,ie,`${K} stop domain type must match previous stop domain type ${g}`)]}else g=K;if("number"!==K&&"string"!==K&&"boolean"!==K&&"number"!=typeof re&&"string"!=typeof re&&"boolean"!=typeof re)return[new h.V(W.key,ie,"stop domain value must be a number, string, or boolean")];if("number"!==K&&"categorical"!==c){let ge=`number expected, ${K} found`;return h.G(s)&&void 0===c&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new h.V(W.key,ie,ge)]}return"categorical"!==c||"number"!==K||"number"==typeof re&&isFinite(re)&&Math.floor(re)===re?"categorical"!==c&&"number"===K&&"number"==typeof re&&"number"==typeof v&&void 0!==v&&re<v?[new h.V(W.key,ie,"stop domain values must appear in ascending order")]:(v=re,"categorical"===c&&re in C?[new h.V(W.key,ie,"stop domain values must be unique")]:(C[re]=!0,[])):[new h.V(W.key,ie,`integer expected, found ${String(re)}`)]}}function ae(m){const s=("property"===m.expressionContext?h.L:h.M)(h.K(m.value),m.valueSpec);if("error"===s.result)return s.value.map(g=>new h.V(`${m.key}${g.key}`,m.value,g.message));const c=s.value.expression||s.value._styleExpression.expression;if("property"===m.expressionContext&&"text-font"===m.propertyKey&&!c.outputDefined())return[new h.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===m.expressionContext&&"layout"===m.propertyType&&!h.N(c))return[new h.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===m.expressionContext)return he(c,m);if(m.expressionContext&&0===m.expressionContext.indexOf("cluster")){if(!h.O(c,["zoom","feature-state"]))return[new h.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===m.expressionContext&&!h.Q(c))return[new h.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function he(m,s){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const v of s.valueSpec.expression.parameters)c.delete(v);if(0===c.size)return[];const g=[];return m instanceof h.S&&c.has(m.name)?[new h.V(s.key,s.value,`["${m.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(m.eachChild(v=>{g.push(...he(v,s))}),g)}function Ze(m){const s=m.key,c=m.value,g=m.valueSpec,v=[];return Array.isArray(g.values)?-1===g.values.indexOf(h.D(c))&&v.push(new h.V(s,c,`expected one of [${g.values.join(", ")}], ${JSON.stringify(c)} found`)):-1===Object.keys(g.values).indexOf(h.D(c))&&v.push(new h.V(s,c,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(c)} found`)),v}function kt(m){return h.W(h.K(m.value))?ae(h.C({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):Bt(m)}function Bt(m){const s=m.value,c=m.key;if("array"!==h.B(s))return[new h.V(c,s,`array expected, ${h.B(s)} found`)];const g=m.styleSpec;let v,S=[];if(s.length<1)return[new h.V(c,s,"filter array must have at least 1 element")];switch(S=S.concat(Ze({key:`${c}[0]`,value:s[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),h.D(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&"$type"===h.D(s[1])&&S.push(new h.V(c,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":3!==s.length&&S.push(new h.V(c,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=h.B(s[1]),"string"!==v&&S.push(new h.V(`${c}[1]`,s[1],`string expected, ${v} found`)));for(let C=2;C<s.length;C++)v=h.B(s[C]),"$type"===h.D(s[1])?S=S.concat(Ze({key:`${c}[${C}]`,value:s[C],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):"string"!==v&&"number"!==v&&"boolean"!==v&&S.push(new h.V(`${c}[${C}]`,s[C],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let C=1;C<s.length;C++)S=S.concat(Bt({key:`${c}[${C}]`,value:s[C],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":v=h.B(s[1]),2!==s.length?S.push(new h.V(c,s,`filter array for "${s[0]}" operator must have 2 elements`)):"string"!==v&&S.push(new h.V(`${c}[1]`,s[1],`string expected, ${v} found`))}return S}function In(m,s){const c=m.key,g=m.style,v=m.layer,S=m.styleSpec,C=m.value,k=m.objectKey,F=S[`${s}_${m.layerType}`];if(!F)return[];const z=k.match(/^(.*)-transition$/);if("paint"===s&&z&&F[z[1]]&&F[z[1]].transition)return Ki({key:c,value:C,valueSpec:S.transition,style:g,styleSpec:S});const N=m.valueSpec||F[k];if(!N)return[new h.A(c,C,`unknown property "${k}"`)];let U;if("string"===h.B(C)&&h.G(N)&&!N.tokens&&(U=/^{([^}]+)}$/.exec(C))){const W=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new h.V(c,C,`"${k}" does not support interpolation syntax\nUse an identity property function instead: ${W}.`)]}const q=[];if("symbol"===m.layerType)"text-field"!==k||!g||g.glyphs||g.imports||q.push(new h.V(c,C,'use of "text-field" requires a style "glyphs" property')),"text-font"===k&&h.X(h.K(C))&&"identity"===h.D(C.type)&&q.push(new h.V(c,C,'"text-font" does not support identity functions'));else if("model"===m.layerType&&"paint"===s&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&h.G(N)&&(h.Y(N)||h.H(N))){const W=h.L(h.K(C),N),ee=W.value.expression||W.value._styleExpression.expression;ee&&!h.O(ee,["measure-light"])&&("model-emissive-strength"===k&&h.Q(ee)&&h.N(ee)||q.push(new h.V(c,C,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(Ki({key:m.key,value:C,valueSpec:N,style:g,styleSpec:S,expressionContext:"property",propertyType:s,propertyKey:k}))}function hr(m){return In(m,"paint")}function kr(m){return In(m,"layout")}function yr(m){let s=[];const c=m.value,g=m.key,v=m.style,S=m.styleSpec;c.type||c.ref||s.push(new h.V(g,c,'either "type" or "ref" is required'));let C=h.D(c.type);const k=h.D(c.ref);if(c.id){const F=h.D(c.id);for(let z=0;z<m.arrayIndex;z++){const N=v.layers[z];h.D(N.id)===F&&s.push(new h.V(g,c.id,`duplicate layer id "${c.id}", previously used at line ${N.id.__line__}`))}}if("ref"in c){let F;["type","source","source-layer","filter","layout"].forEach(z=>{z in c&&s.push(new h.V(g,c[z],`"${z}" is prohibited for ref layers`))}),v.layers.forEach(z=>{h.D(z.id)===k&&(F=z)}),F?F.ref?s.push(new h.V(g,c.ref,"ref cannot reference another ref layer")):C=h.D(F.type):"string"==typeof k&&s.push(new h.V(g,c.ref,`ref layer "${k}" not found`))}else if("background"!==C&&"sky"!==C&&"slot"!==C)if(c.source){const F=v.sources&&v.sources[c.source],z=F&&h.D(F.type);F?"vector"===z&&"raster"===C?s.push(new h.V(g,c.source,`layer "${c.id}" requires a raster source`)):"raster"===z&&"raster"!==C?s.push(new h.V(g,c.source,`layer "${c.id}" requires a vector source`)):"vector"!==z||c["source-layer"]?"raster-dem"===z&&"hillshade"!==C?s.push(new h.V(g,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==z||["raster","raster-particle"].includes(C)?"line"!==C||!c.paint||!c.paint["line-gradient"]&&!c.paint["line-trim-offset"]||"geojson"===z&&F.lineMetrics?"raster-particle"===C&&"raster-array"!==z&&s.push(new h.V(g,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):s.push(new h.V(g,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new h.V(g,c.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new h.V(g,c,`layer "${c.id}" must specify a "source-layer"`)):s.push(new h.V(g,c.source,`source "${c.source}" not found`))}else s.push(new h.V(g,c,'missing required property "source"'));return s=s.concat(Hi({key:g,value:c,valueSpec:S.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ki({key:`${g}.type`,value:c.type,valueSpec:S.layer.type,style:m.style,styleSpec:m.styleSpec,object:c,objectKey:"type"}),filter:F=>kt(h.C({layerType:C},F)),layout:F=>Hi({layer:c,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":z=>kr(h.C({layerType:C},z))}}),paint:F=>Hi({layer:c,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":z=>hr(h.C({layerType:C,layer:c},z))}})}})),s}function lo(m){const s=m.value,c=m.key,g=h.B(s);return"string"!==g?[new h.V(c,s,`string expected, ${g} found`)]:[]}const Eo={promoteId:function({key:m,value:s}){if("string"===h.B(s))return lo({key:m,value:s});{const c=[];for(const g in s)c.push(...lo({key:`${m}.${g}`,value:s[g]}));return c}}};function Jl(m){const s=m.value,c=m.key,g=m.styleSpec,v=m.style;if(!s.type)return[new h.V(c,s,'"type" is required')];const S=h.D(s.type);let C=[];switch(["vector","raster","raster-dem","raster-array"].includes(S)&&(s.url||s.tiles||C.push(new h.A(c,s,'Either "url" or "tiles" is required.'))),S){case"vector":case"raster":case"raster-dem":case"raster-array":return C=C.concat(Hi({key:c,value:s,valueSpec:g[`source_${S.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:Eo})),C;case"geojson":if(C=Hi({key:c,value:s,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:Eo}),s.cluster)for(const k in s.clusterProperties){const[F,z]=s.clusterProperties[k],N="string"==typeof F?[F,["accumulated"],["get",k]]:F;C.push(...ae({key:`${c}.${k}.map`,value:z,expressionContext:"cluster-map"})),C.push(...ae({key:`${c}.${k}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return C;case"video":return Hi({key:c,value:s,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return Hi({key:c,value:s,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new h.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ze({key:`${c}.type`,value:s.type,valueSpec:{values:Dc(g)},style:v,styleSpec:g})}}function Dc(m){return m.source.reduce((s,c)=>{const g=m[c];return"enum"===g.type.type&&(s=s.concat(Object.keys(g.type.values))),s},[])}function ul(m){const s=m.value,c=m.styleSpec,g=c.light,v=m.style;let S=[];const C=h.B(s);if(void 0===s)return S;if("object"!==C)return S=S.concat([new h.V("light",s,`object expected, ${C} found`)]),S;for(const k in s){const F=k.match(/^(.*)-transition$/);S=S.concat(F&&g[F[1]]&&g[F[1]].transition?Ki({key:k,value:s[k],valueSpec:c.transition,style:v,styleSpec:c}):g[k]?Ki({key:k,value:s[k],valueSpec:g[k],style:v,styleSpec:c}):[new h.V(k,s[k],`unknown property "${k}"`)])}return S}function Pa(m){const s=m.value;let c=[];if(!s)return c;const g=h.B(s);if("object"!==g)return c=c.concat([new h.V("light-3d",s,`object expected, ${g} found`)]),c;const v=m.styleSpec,S=v["light-3d"],C=m.key,k=m.style,F=m.style.lights;for(const U of["type","id"])if(!(U in s))return c=c.concat([new h.V("light-3d",s,`missing property ${U} on light`)]),c;if(s.type&&F)for(let U=0;U<m.arrayIndex;U++){const q=h.D(s.type),W=F[U];h.D(W.type)===q&&c.push(new h.V(C,s.id,`duplicate light type "${s.type}", previously defined at line ${W.id.__line__}`))}const z=`properties_light_${s.type}`;if(!(z in v))return c=c.concat([new h.V("light-3d",s,`Invalid light type ${s.type}`)]),c;const N=v[z];for(const U in s)if("properties"===U){const q=s[U],W=h.B(q);if("object"!==W)return c=c.concat([new h.V("properties",q,`object expected, ${W} found`)]),c;for(const ee in q)c=c.concat(N[ee]?Ki({key:ee,value:q[ee],valueSpec:N[ee],style:k,styleSpec:v}):[new h.A(m.key,q[ee],`unknown property "${ee}"`)])}else{const q=U.match(/^(.*)-transition$/);c=c.concat(q&&S[q[1]]&&S[q[1]].transition?Ki({key:U,value:s[U],valueSpec:v.transition,style:k,styleSpec:v}):S[U]?Ki({key:U,value:s[U],valueSpec:S[U],style:k,styleSpec:v}):[new h.A(U,s[U],`unknown property "${U}"`)])}return c}function Xu(m){const s=m.value,c=m.key,g=m.style,v=m.styleSpec,S=v.terrain;let C=[];const k=h.B(s);if(void 0===s||"null"===k)return C;if("object"!==k)return C=C.concat([new h.V("terrain",s,`object expected, ${k} found`)]),C;for(const F in s){const z=F.match(/^(.*)-transition$/);C=C.concat(z&&S[z[1]]&&S[z[1]].transition?Ki({key:F,value:s[F],valueSpec:v.transition,style:g,styleSpec:v}):S[F]?Ki({key:F,value:s[F],valueSpec:S[F],style:g,styleSpec:v}):[new h.A(F,s[F],`unknown property "${F}"`)])}if(s.source){const F=g.sources&&g.sources[s.source],z=F&&h.D(F.type);F?"raster-dem"!==z&&C.push(new h.V(c,s.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):C.push(new h.V(c,s.source,`source "${s.source}" not found`))}else C.push(new h.V(c,s,'terrain is missing required property "source"'));return C}function dl(m){const s=m.value,c=m.style,g=m.styleSpec,v=g.fog;let S=[];const C=h.B(s);if(void 0===s)return S;if("object"!==C)return S=S.concat([new h.V("fog",s,`object expected, ${C} found`)]),S;for(const k in s){const F=k.match(/^(.*)-transition$/);S=S.concat(F&&v[F[1]]&&v[F[1]].transition?Ki({key:k,value:s[k],valueSpec:g.transition,style:c,styleSpec:g}):v[k]?Ki({key:k,value:s[k],valueSpec:v[k],style:c,styleSpec:g}):[new h.A(k,s[k],`unknown property "${k}"`)])}return S}const Nd={"*":()=>[],array:Ao,boolean:function(m){const s=m.value,c=m.key,g=h.B(s);return"boolean"!==g?[new h.V(c,s,`boolean expected, ${g} found`)]:[]},number:pi,color:function(m){const s=m.key,c=m.value,g=h.B(c);return"string"!==g?[new h.V(s,c,`color expected, ${g} found`)]:null===h.U.parseCSSColor(c)?[new h.V(s,c,`color expected, "${c}" found`)]:[]},enum:Ze,filter:kt,function:Oe,layer:yr,object:Hi,source:Jl,model:h.Z,light:ul,"light-3d":Pa,terrain:Xu,fog:dl,string:lo,formatted:function(m){return 0===lo(m).length?[]:ae(m)},resolvedImage:function(m){return 0===lo(m).length?[]:ae(m)},projection:function(m){const s=m.value,c=m.styleSpec,g=c.projection,v=m.style;let S=[];const C=h.B(s);if("object"===C)for(const k in s)S=S.concat(Ki({key:k,value:s[k],valueSpec:g[k],style:v,styleSpec:c}));else"string"!==C&&(S=S.concat([new h.V("projection",s,`object or string expected, ${C} found`)]));return S},import:function(m){const{value:s,styleSpec:c}=m,{data:g,...v}=s;Object.defineProperty(v,"__line__",{value:s.__line__,enumerable:!1});let S=Hi(h.C({},m,{value:v,valueSpec:c.import}));return""===h.D(v.id)&&S.push(new h.V(`${m.key}.id`,v,"import id can't be an empty string")),g&&(S=S.concat(Bd(g,c,{key:`${m.key}.data`}))),S}};function Ki(m,s=!1){const c=m.value,g=m.valueSpec,v=m.styleSpec;if(g.expression&&h.X(h.D(c)))return Oe(m);if(g.expression&&h.J(h.K(c)))return ae(m);if(g.type&&Nd[g.type]){const S=Nd[g.type](m);return!0===s&&S.length>0&&"array"===h.B(m.value)?ae(m):S}return Hi(h.C({},m,{valueSpec:g.type?v[g.type]:g}))}function Kl(m){const s=m.value,c=m.key,g=lo(m);return g.length||(-1===s.indexOf("{fontstack}")&&g.push(new h.V(c,s,'"glyphs" url must include a "{fontstack}" token')),-1===s.indexOf("{range}")&&g.push(new h.V(c,s,'"glyphs" url must include a "{range}" token'))),g}function Bd(m,s=h._,c={}){return Ki({key:c.key||"",value:m,valueSpec:s.$root,styleSpec:s,style:m,objectElementValidators:{glyphs:Kl,"*":()=>[]}})}function Ha(m,s=h._){return Le(Bd(m,s))}const Zu=m=>Le(Jl(m)),Uh=m=>Le(ul(m)),Hh=m=>Le(Pa(m)),zd=m=>Le(Xu(m)),qh=m=>Le(dl(m)),gt=m=>Le(yr(m)),le=m=>Le(kt(m)),fe=m=>Le(hr(m)),Me=m=>Le(kr(m)),Ge=m=>Le(h.Z(m));function Le(m){return m.slice().sort((s,c)=>s.line&&c.line?s.line-c.line:0)}function Je(m,s){let c=!1;if(s&&s.length)for(const g of s)g instanceof h.A?h.w(g.message):(m.fire(new h.t(new Error(g.message))),c=!0);return c}let mt;class nt extends h.E{constructor(s,c="flat"){super(),this._transitionable=new h.$(mt||(mt=new h.a0({anchor:new h.a1(h._.light.anchor),position:new h.a2(h._.light.position),color:new h.a1(h._.light.color),intensity:new h.a1(h._.light.intensity)}))),this.setLight(s,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c,g={}){this._validate(Uh,s,g)||(this._transitionable.setTransitionOrValue(s),this.id=c)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,g){return(!g||!1!==g.validate)&&Je(this,s.call(Ha,h.l({value:c,style:{glyphs:!0,sprite:!0},styleSpec:h._})))}}let _t=class extends h.E{constructor(m,s,c,g){super(),this.scope=c,this._transitionable=new h.$(new h.a0({source:new h.a1(h._.terrain.source),exaggeration:new h.a1(h._.terrain.exaggeration)}),c,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(m,s){this._transitionable.setTransitionOrValue(m,s)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new h.a3(m)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const s=m.value.expression;if(!s)return null;let c=-1,g=-1,v=1;for(const S of s.zoomStops)v=s.evaluate(new h.a3(S)),v>.01?(c=S,g=-1):g=S;return v<.01&&c>0&&g>c?[c,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return null!=m&&null!=m.value&&null!=m.value.expression&&m.value.expression instanceof h.a4}};const Yt=.05;function hn(m,s,c,g){const v=h.a7(45,65,c),[S,C]=mn(m,g);let k=1-Math.min(1,Math.exp((s-S)/(C-S)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*v*m.alpha}function mn(m,s){const c=.5/Math.tan(.5*s);return[m.range[0]+c,m.range[1]+c]}function ai(m,s,c,g,v){const S=h.a6.vec3.transformMat4([],[s,c,g],v.mercatorFogMatrix);return hn(m,h.a6.vec3.length(S),v.pitch,v._fov)}function mi(m,s,c,g,v,S,C){const k=[[c,g,0],[v,g,0],[v,S,0],[c,S,0]];let F=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const N of k){const U=h.a6.vec3.transformMat4([],N,s),q=h.a6.vec3.length(U);F=Math.min(F,q),z=Math.max(z,q)}return[hn(m,F,C.pitch,C._fov),hn(m,z,C.pitch,C._fov)]}class gi extends h.E{constructor(s,c,g,v){super();const S=new h.a0({range:new h.a1(h._.fog.range),color:new h.a1(h._.fog.color),"high-color":new h.a1(h._.fog["high-color"]),"space-color":new h.a1(h._.fog["space-color"]),"horizon-blend":new h.a1(h._.fog["horizon-blend"]),"star-intensity":new h.a1(h._.fog["star-intensity"]),"vertical-range":new h.a1(h._.fog["vertical-range"])});this._transitionable=new h.$(S,g,new Map(v)),this.set(s,v),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new h.a8(S),this.scope=g}get state(){const s=this._transform,c="globe"===s.projection.name,g=h.a9(s.zoom),v=this.properties.get("range"),S=[.5,3];return{range:c?[h.aa(S[0],v[0],g),h.aa(S[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,c,g={}){if(this._validate(qh,s,g))return;const v=h.l({},s);for(const S of Object.keys(h._.fog))void 0===v[S]&&(v[S]=h._.fog[S].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:h.a7(45,65,s))*c.a}getOpacityAtLatLng(s,c){return this._transform.projection.supportsFog?function(g,v,S){const C=h.a5.fromLngLat(v),k=S.elevation?S.elevation.getAtPointOrZero(C):0;return ai(g,C.x,C.y,k,S)}(this.state,s,c):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(s.toUnwrapped());return mi(this.state,c,0,0,h.ab,h.ab,this._transform)}getOpacityForBounds(s,c,g,v,S){return this._transform.projection.supportsFog?mi(this.state,s,c,g,v,S,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?mn(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const g of c){const v=s.points[g];let S;if(v[2]>=0)S=v;else{const C=s.points[g-4];S=h.ac(C,v,C[2]/(C[2]-v[2]))}if(ai(this.state,S[0],S[1],0,this._transform)>=Yt)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,g){return(!g||!1!==g.validate)&&Je(this,s.call(Ha,h.l({value:c,style:{glyphs:!0,sprite:!0},styleSpec:h._})))}}class di extends h.E{constructor(s,c,g,v){super(),this.scope=g,this._options=s,this.properties=new h.a8(c),this._transitionable=new h.$(c,g,new Map(v)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,c){this._options=s,this._transitionable.setTransitionOrValue(s.properties,c)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}let vr,lr;class Pi{constructor(s,c,g,v){this.screenBounds=s,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,c){let g,v;if(s instanceof h.P||"number"==typeof s[0]){const S=h.P.convert(s);g=[S],v=c.isPointAboveHorizon(S)}else{const S=h.P.convert(s[0]),C=h.P.convert(s[1]);g=[S,C],v=h.ae(S,C).every(k=>c.isPointAboveHorizon(k))}return new Pi(g,c.getCameraPoint(),v,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(s){return h.ae(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const c=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new h.P(1,1)):this.screenBounds[1],v=h.ae(c,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),h.af(v,s)}bufferedCameraGeometryGlobe(s){const c=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new h.P(1,1)):this.screenBounds[1],v=h.ae(c,g,s),S=this.cameraPoint.clone();switch(3*((S.y>c.y)+(S.y>g.y))+((S.x>c.x)+(S.x>g.x))){case 0:v[0]=S,v[4]=S.clone();break;case 1:v.splice(1,0,S);break;case 2:v[1]=S;break;case 3:v.splice(4,0,S);break;case 5:v.splice(2,0,S);break;case 6:v[3]=S;break;case 7:v.splice(3,0,S);break;case 8:v[2]=S}return v}containsTile(s,c,g,v=0){const S=s.queryPadding/c._pixelsPerMercatorPixel+1,C=g?this._bufferedCameraMercator(S,c):this._bufferedScreenMercator(S,c);let k=s.tileID.wrap+(C.unwrapped?v:0);const F=C.polygon.map(re=>h.ag(s.tileTransform,re,k));if(!h.ah(F,0,0,h.ab,h.ab))return;k=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const z=this.screenGeometryMercator.polygon.map(re=>h.ai(s.tileTransform,re,k)),N=z.map(re=>new h.P(re[0],re[1])),U=c.getFreeCameraOptions().position||new h.a5(0,0,0),q=h.ai(s.tileTransform,U,k),W=z.map(re=>{const ie=h.a6.vec3.sub(re,re,q);return h.a6.vec3.normalize(ie,ie),new h.aj(q,ie)}),ee=h.ak(s,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:W,bufferedTilespaceGeometry:F,bufferedTilespaceBounds:(K=h.al(F),K.min.x=h.ap(K.min.x,0,h.ab),K.min.y=h.ap(K.min.y,0,h.ab),K.max.x=h.ap(K.max.x,0,h.ab),K.max.y=h.ap(K.max.y,0,h.ab),K),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:ee};var K}_bufferedScreenMercator(s,c){const g=Ar(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v="globe"===c.projection.name?this._projectAndResample(this.bufferedScreenGeometry(s),c):{polygon:this.bufferedScreenGeometry(s).map(S=>c.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(s,c){const g=Ar(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v="globe"===c.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),c):{polygon:this.bufferedCameraGeometry(s).map(S=>c.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(s,c){const g=function(S,C){const k=h.a6.mat4.multiply([],C.pixelMatrix,C.globeMatrix),F=[0,-h.aq,0,1],z=[0,h.aq,0,1],N=[0,0,0,1];h.a6.vec4.transformMat4(F,F,k),h.a6.vec4.transformMat4(z,z,k),h.a6.vec4.transformMat4(N,N,k);const U=new h.P(F[0]/F[3],F[1]/F[3]),q=new h.P(z[0]/z[3],z[1]/z[3]),W=h.an(S,U)&&F[3]<N[3],ee=h.an(S,q)&&z[3]<N[3];if(!W&&!ee)return null;const K=function(Ie,Re,Fe){for(let He=1;He<Ie.length;He++){const ze=co(Re.pointCoordinate3D(Ie[He-1]).x),Ne=co(Re.pointCoordinate3D(Ie[He]).x);if(Fe<0){if(ze<Ne)return{idx:He,t:-ze/(Ne-1-ze)}}else if(Ne<ze)return{idx:He,t:(1-ze)/(Ne+1-ze)}}return null}(S,C,W?-1:1);if(!K)return null;const{idx:re,t:ie}=K;let ge=re>1?tr(S.slice(0,re),C):[],xe=re<S.length?tr(S.slice(re),C):[];ge=ge.map(Ie=>new h.P(co(Ie.x),Ie.y)),xe=xe.map(Ie=>new h.P(co(Ie.x),Ie.y));const ve=[...ge];0===ve.length&&ve.push(xe[xe.length-1]);const Ee=h.aa(ve[ve.length-1].y,(0===xe.length?ge[0]:xe[0]).y,ie);let Ae;return Ae=W?[new h.P(0,Ee),new h.P(0,0),new h.P(1,0),new h.P(1,Ee)]:[new h.P(1,Ee),new h.P(1,1),new h.P(0,1),new h.P(0,Ee)],ve.push(...Ae),0===xe.length?ve.push(ge[0]):ve.push(...xe),{polygon:ve.map(Ie=>new h.a5(Ie.x,Ie.y)),unwrapped:!1}}(s,c);if(g)return g;const v=function(S,C){let k=!1,F=-1/0,z=0;for(let U=0;U<S.length-1;U++)S[U].x>F&&(F=S[U].x,z=U);for(let U=0;U<S.length-1;U++){const q=(z+U)%(S.length-1),W=S[q],ee=S[q+1];Math.abs(W.x-ee.x)>.5&&(W.x<ee.x?(W.x+=1,0===q&&(S[S.length-1].x+=1)):(ee.x+=1,q+1===S.length-1&&(S[0].x+=1)),k=!0)}const N=h.am(C.center.lng);return k&&N<Math.abs(N-1)&&S.forEach(U=>{U.x-=1}),{polygon:S,unwrapped:k}}(tr(s,c).map(S=>new h.P(co(S.x),S.y)),c);return{polygon:v.polygon.map(S=>new h.a5(S.x,S.y)),unwrapped:v.unwrapped}}}function tr(m,s){return h.ao(m,c=>{const g=s.pointCoordinate3D(c);c.x=g.x,c.y=g.y},1/256)}function co(m){return m<0?1+m%1:m%1}function Ar(m){return 100*m|0}function Qo(m,s,c,g,v){const S=function(k,F){if(k)return v(k);if(F){if(m.url&&F.tiles&&m.tiles&&delete m.tiles,F.variants){if(!Array.isArray(F.variants))return v(new Error("variants must be an array"));for(const N of F.variants){if(null==N||"object"!=typeof N||N.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(N.capabilities))return v(new Error("capabilities must be an array"));if(1===N.capabilities.length&&"meshopt"===N.capabilities[0]){F=h.l(F,N);break}}}const z=h.ar(h.l({},F,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=s.canonicalizeTileset(z,m.url),v(null,z)}},C=function(k,F,z){if(!k)return null;if(!F&&!z)return k;z=z||k.worldview_default;const N=Object.values(k.language||{});if(0===N.length)return null;const U=Object.values(k.worldview||{});if(0===U.length)return null;const q=N.every(ee=>ee===F),W=U.every(ee=>ee===z);return q&&W?k:F in(k.language_options||{})||z in(k.worldview_options||{})?null:k.language_options&&k.worldview_options?k:null}(m.data,c,g);return C?h.q.frame(()=>S(null,C)):m.url?h.n(s.transformRequest(s.normalizeSourceURL(m.url,null,c,g),h.R.Source),S):h.q.frame(()=>{const{data:k,...F}=m;S(null,F)})}class uo{constructor(s,c,g){this.bounds=h.as.convert(this.validateBounds(s)),this.minzoom=c||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const c=Math.pow(2,s.z),g=Math.floor(h.am(this.bounds.getWest())*c),v=Math.floor(h.at(this.bounds.getNorth())*c),S=Math.ceil(h.am(this.bounds.getEast())*c),C=Math.ceil(h.at(this.bounds.getSouth())*c);return s.x>=g&&s.x<S&&s.y>=v&&s.y<C}}class Ws extends h.E{constructor(s,c,g,v){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.l(this,h.ar(c,["url","scheme","tileSize","promoteId"])),this._options=h.l({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new h.au}load(s){this._loaded=!1,this.fire(new h.x("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=Qo(this._options,this.map._requestManager,c,g,(v,S)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new h.t(v));else if(S){if(h.l(this,S),this.hasWorldviews=!!S.worldview_options,S.worldview_default&&(this.worldviewDefault=S.worldview_default),S.vector_layers){this.vectorLayers=S.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const C of S.vector_layers)this.vectorLayerIds.push(C.id),S.worldview&&S.worldview[C.source]&&this.localizableLayerIds.add(C.id)}S.bounds&&(this.tileBounds=new uo(S.bounds,this.minzoom,this.maxzoom)),yi(S.tiles,this.map._requestManager._customAccessToken),this.fire(new h.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.x("data",{dataType:"source",sourceDataType:"content"}))}s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=h.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return h.l({},this._options)}loadTile(s,c){const g=s.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(g),S=this.map._requestManager.transformRequest(v,h.R.Tile),C=this.map.style?this.map.style.getLut(this.scope):null,k=C?{image:C.image.clone()}:null,F={request:S,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:k,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:h.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&h.f(g)&&(F.worldview=this.map.getWorldview()||this.worldviewDefault,F.localizableLayerIds=this.localizableLayerIds),F.request.collectResourceTiming=this._collectResourceTiming,s.actor&&"expired"!==s.state)"loading"===s.state?s.reloadCallback=c:s.request=s.actor.send("reloadTile",F,z.bind(this));else if(s.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",F,z.bind(this),void 0,!0);else{const N=h.aw.call({deduped:this._deduped},F,(U,q)=>{U||!q?z.call(this,U):(F.data={cacheControl:q.cacheControl,expires:q.expires,rawData:q.rawData.slice(0)},s.actor&&s.actor.send("loadTile",F,z.bind(this),void 0,!0))},!0);s.request={cancel:N}}function z(N,U){return delete s.request,s.aborted?c(null):N&&404!==N.status?c(N):(U&&U.resourceTiming&&(s.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&s.setExpiryData(U),s.loadVectorData(U,this.map.painter),h.ax(this.dispatcher),c(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class lu extends h.E{constructor(s,c,g,v){super(),this.id=s,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.l({type:"raster"},c),h.l(this,h.ar(c,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new h.x("dataloading",{dataType:"source"})),this._tileJSONRequest=Qo(this._options,this.map._requestManager,null,null,(c,g)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new h.t(c)):g&&(h.l(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map(v=>v.id)),g.bounds&&(this.tileBounds=new uo(g.bounds,this.minzoom,this.maxzoom)),yi(g.tiles),this.fire(new h.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.x("data",{dataType:"source",sourceDataType:"content"}))),s&&s(c)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=h.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return h.l({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const g=h.q.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=h.o(this.map._requestManager.transformRequest(v,h.R.Tile),(S,C,k,F)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):S?(s.state="errored",c(S)):C?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:k,expires:F}),s.setTexture(C,this.map.painter),s.state="loaded",h.ax(this.dispatcher),void c(null)):c(null)))}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c&&c()}unloadTile(s,c){s.texture&&s.texture instanceof h.T?(s.destroy(!0),s.texture&&s.texture instanceof h.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Il extends lu{constructor(s,c,g,v){super(s,c,g,v),this.type="raster-array",this.maxzoom=22,this._options=h.l({type:"raster-array"},c)}triggerRepaint(s){const c=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);c&&c.enabled&&g&&c._clearRenderCacheForTile(g.id,s.tileID),this.map.triggerRepaint()}loadTile(s,c){const g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,h.R.Tile);s.requestParams=v,s.actor||(s.actor=this.dispatcher.getActor()),s.request=s.fetchHeader(void 0,(S,C,k,F)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):S?20===S.code?void 0:(s.state="errored",c(S)):(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:k,expires:F}),s.state="empty",void c(null))))}unloadTile(s,c){const g=s.texture;g&&g instanceof h.T?(s.destroy(!0),this.map.painter.saveTileTexture(g)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,c,g){s._isHeaderLoaded&&("empty"!==s.state&&(s.state="reloading"),s.fetchBand(c,g,(v,S)=>{if(v)return s.state="errored",this.fire(new h.t(v)),void this.triggerRepaint(s);S&&(s.setTexture(S,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:S})=>S===s),g=c&&c.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(s,c,g){if(!s)return;const v=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let S=null;c instanceof h.aB?S=c.paint.get("raster-array-band"):c instanceof h.aC&&(S=c.paint.get("raster-particle-array-band"));const C=S||this.getInitialBand(v);if(null!=C)if(s.textureDescriptor){if(!s.updateNeeded(v,C)||g)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,v,C)}}const Vd={vector:Ws,raster:lu,"raster-dem":class extends lu{constructor(m,s,c,g){super(m,s,c,g),this.type="raster-dem",this.maxzoom=22,this._options=h.l({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(m,s){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,S){v&&(m.state="errored",s(v)),S&&(m.dem=S,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",s(null))}m.request=h.o(this.map._requestManager.transformRequest(c,h.R.Tile),function(v,S,C,k){if(delete m.request,m.aborted)m.state="unloaded",s(null);else if(v)m.state="errored",s(v);else if(S){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:C,expires:k});const F=ImageBitmap&&S instanceof ImageBitmap&&h.ay(),z=1-(S.width-h.az(S.width))/2;z<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const N=F?S:h.q.getImageData(S,z),U={uid:m.uid,coord:m.tileID,source:this.id,scope:this.scope,rawImageData:N,encoding:this.encoding,padding:z};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",U,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const s=m.canonical,c=Math.pow(2,s.z),g=(s.x-1+c)%c,v=0===s.x?m.wrap-1:m.wrap,S=(s.x+1+c)%c,C=s.x+1===c?m.wrap+1:m.wrap,k={};return k[new h.aA(m.overscaledZ,v,s.z,g,s.y).key]={backfilled:!1},k[new h.aA(m.overscaledZ,C,s.z,S,s.y).key]={backfilled:!1},s.y>0&&(k[new h.aA(m.overscaledZ,v,s.z,g,s.y-1).key]={backfilled:!1},k[new h.aA(m.overscaledZ,m.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},k[new h.aA(m.overscaledZ,C,s.z,S,s.y-1).key]={backfilled:!1}),s.y+1<c&&(k[new h.aA(m.overscaledZ,v,s.z,g,s.y+1).key]={backfilled:!1},k[new h.aA(m.overscaledZ,m.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},k[new h.aA(m.overscaledZ,C,s.z,S,s.y+1).key]={backfilled:!1}),k}},"raster-array":Il,geojson:class extends h.E{constructor(m,s,c,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(g),this._data=s.data,this._options=h.l({},s),this._collectResourceTiming=s.collectResourceTiming,void 0!==s.maxzoom&&(this.maxzoom=s.maxzoom),void 0!==s.minzoom&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const v=h.ab/this.tileSize;this.workerOptions=h.l({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(void 0!==s.buffer?s.buffer:128)*v,tolerance:(void 0!==s.tolerance?s.tolerance:.375)*v,extent:h.ab,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:void 0!==s.clusterMaxZoom?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.ab,radius:(void 0!==s.clusterRadius?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new h.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof m&&("Feature"===m.type&&(m={type:"FeatureCollection",features:[m]}),"FeatureCollection"!==m.type))return this.fire(new h.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof m&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const s=new Map;for(const c of this._data.features)s.set(c.id,c);for(const c of m.features)s.set(c.id,c);this._data.features=[...s.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterChildren(m,s){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterLeaves(m,s,c,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:s,offset:c},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new h.x("dataloading",{dataType:"source"})),this._loaded=!1;const s=h.l({append:m},this.workerOptions);s.scope=this.scope;const c=this._data;"string"==typeof c?(s.request=this.map._requestManager.transformRequest(h.q.resolveURL(c),h.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new h.t(g));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(S.resourceTiming=v.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new h.x("data",S)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,s){const c=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,v=g?{image:g.image.clone()}:null,S=this._partialReload,C={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:h.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:S};m.request=this.actor.send(c,C,(k,F)=>S&&!F?(m.state="loaded",s(null)):(delete m.request,m.destroy(),m.aborted?s(null):k?s(k):(m.loadVectorData(F,this.map.painter,"reloadTile"===c),s(null))),void 0,"loadTile"===c)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,s){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return h.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends h.aD{constructor(m,s,c,g){super(m,s,c,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const s of m.urls)this.urls.push(this.map._requestManager.transformRequest(s,h.R.Source).url);h.aE(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new h.t(s)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const s=this.video.seekable;m<s.start(0)||m>s.end(0)?this.fire(new h.t(new h.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,s=m.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new h.T(m,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:h.aD,model:class extends h.E{constructor(m,s,c,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){const m=[];for(const s in this._options.models){const c=this._options.models[s],g=h.aG(this.map._requestManager.transformRequest(c.uri,h.R.Model).url).then(v=>{if(!v)return;const S=h.aH(v),C=new h.aI(s,c.position,c.orientation,S);C.computeBoundsAndApplyParent(),this.models.push(C)}).catch(v=>{this.fire(new h.t(new Error(`Could not load model ${s} from ${c.uri}: ${v.message}`)))});m.push(g)}return Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new h.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this.fire(new h.t(new Error(`Could not load models: ${s.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,s){}serialize(){return{type:"model"}}},"batched-model":class extends h.E{constructor(m,s,c,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}load(m){this._loaded=!1,this.fire(new h.x("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Qo(this._options,this.map._requestManager,s,c,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),c&&2!==c.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new h.t(g))):v&&(h.l(this,v),v.bounds&&(this.tileBounds=new uo(v.bounds,this.minzoom,this.maxzoom)),yi(v.tiles,this.map._requestManager._customAccessToken),this.fire(new h.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.x("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,s){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(c,h.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(m.actor&&"expired"!==m.state)if("loading"===m.state)m.reloadCallback=s;else{if(m.buckets){const S=Object.values(m.buckets);for(const C of S)C.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,v.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(S,C){return m.aborted?s(null):S&&404!==S.status?s(S):(this.map._refreshExpiredTiles&&C&&m.setExpiryData(C),m.loadModelData(C,this.map.painter),m.state="loaded",void s(null))}}serialize(){return h.l({},this._options)}},canvas:class extends h.aD{constructor(m,s,c,g){super(m,s,c,g),s.coordinates?Array.isArray(s.coordinates)&&4===s.coordinates.length&&!s.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(S=>"number"!=typeof S))||this.fire(new h.t(new h.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.t(new h.V(`sources.${m}`,null,'missing required property "coordinates"'))),s.animate&&"boolean"!=typeof s.animate&&this.fire(new h.t(new h.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),s.canvas?"string"==typeof s.canvas||s.canvas instanceof HTMLCanvasElement||this.fire(new h.t(new h.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.t(new h.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=s,this.animate=void 0===s.animate||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const s=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof h.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends h.E{constructor(m,s,c,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new h.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new h.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new uo(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),h.l(this,h.ar(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return h.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new h.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new h.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:s,y:c,z:g}=m.canonical;return this._implementation.hasTile({x:s,y:c,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,s){const{x:c,y:g,z:v}=m.tileID.canonical,S=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:c,y:g,z:v},{signal:S.signal})).then(function(C){return delete m.request,m.aborted?(m.state="unloaded",s(null)):void 0===C?(m.state="errored",s(null)):null===C?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",s(null)):(k=C)instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement?(this.loadTileData(m,C),m.state="loaded",void s(null)):(m.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var k}.bind(this)).catch(C=>{20!==C.code&&(m.state="errored",s(C))}),m.request.cancel=()=>S.abort()}loadTileData(m,s){m.setTexture(s,this.map.painter)}unloadTile(m,s){if(m.texture&&m.texture instanceof h.T?(m.destroy(!0),m.texture&&m.texture instanceof h.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:c,y:g,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:c,y:g,z:v})}s&&s()}abortTile(m,s){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=h.av(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new h.x("data",{dataType:"source",sourceDataType:"content"}))}}},Gh=function(m,s,c,g){const v=new Vd[s.type](m,s,c,g);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return h.aJ(["load","abort","unload","serialize","prepare"],v),v};function cu(m,s){const c=h.a6.mat4.identity([]);return h.a6.mat4.scale(c,c,[.5*m.width,.5*-m.height,1]),h.a6.mat4.translate(c,c,[1,-1,0]),h.a6.mat4.multiply(c,c,m.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(c)}function ig(m,s,c,g,v,S,C,k,F=!1){const z=m.tilesIn(c,k,F);z.sort(Yu);const N=[];for(const q of z)N.push({wrappedTileID:q.tile.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(s,m._state,q,g,v,S,C,cu(m.transform,q.tile.tileID),F)});const U=function(q){const W={},ee={};for(const K of q){const re=K.queryResults,ie=K.wrappedTileID,ge=ee[ie]=ee[ie]||{};for(const xe in re){const ve=re[xe],Ee=ge[xe]=ge[xe]||{},Ae=W[xe]=W[xe]||[];for(const Ie of ve)Ee[Ie.featureIndex]||(Ee[Ie.featureIndex]=!0,Ae.push(Ie))}}return W}(N);for(const q in U)U[q].forEach(W=>{const ee=W.feature,K=ee.layer;K&&"background"!==K.type&&"sky"!==K.type&&"slot"!==K.type&&(h.aK(q)||(ee.source=K.source,K["source-layer"]&&(ee.sourceLayer=K["source-layer"])),ee.state=void 0!==ee.id?m.getFeatureState(K["source-layer"],ee.id):{})});return U}function Cf(m,s){const c=m.getRenderableIds().map(S=>m.getTileByID(S)),g=[],v={};for(let S=0;S<c.length;S++){const C=c[S],k=C.tileID.canonical.key;v[k]||(v[k]=!0,C.querySourceFeatures(g,s))}return g}function Yu(m,s){const c=m.tileID,g=s.tileID;return c.overscaledZ-g.overscaledZ||c.canonical.y-g.canonical.y||c.wrap-g.wrap||c.canonical.x-g.canonical.x}function jd(m,s){const c={};if(!s)return c;for(const g of m){const v=g.layerIds.map(S=>s.getLayer(S)).filter(Boolean);if(0!==v.length){g.layers=v,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(S=>v.filter(C=>C.id===S)[0]));for(const S of v)c[S.fqid]=g}}return c}const Al=new Uint16Array(8184);for(let m=0;m<2046;m++){let s=m+2,c=0,g=0,v=0,S=0,C=0,k=0;for(1&s?v=S=C=32:c=g=k=32;(s>>=1)>1;){const z=c+v>>1,N=g+S>>1;1&s?(v=c,S=g,c=C,g=k):(c=v,g=S,v=C,S=k),C=z,k=N}const F=4*m;Al[F+0]=c,Al[F+1]=g,Al[F+2]=v,Al[F+3]=S}const ya=new Uint16Array(2178),Ql=new Uint8Array(1089),$h=new Uint16Array(1089);function es(m){return 0===m?-.03125:32===m?.03125:0}const Oo={type:2,extent:h.ab,loadGeometry:()=>[[new h.P(0,0),new h.P(h.ab+1,0),new h.P(h.ab+1,h.ab+1),new h.P(0,h.ab+1),new h.P(0,0)]]};class Rl{constructor(s,c,g,v,S){this.tileID=s,this.uid=h.aQ(),this.uses=0,this.tileSize=c,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=S,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection)}registerFadeDuration(s){const c=s+this.timeAdded;c<h.q.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=h.aL(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,c,g){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=jd(s.buckets,c.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const S=this.buckets[v];if(S instanceof h.aS){if(this.hasSymbolBuckets=!0,!g)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const S=this.buckets[v];if(S instanceof h.aS&&S.hasRTLText){this.hasRTLText=!0,h.aT();break}}this.queryPadding=0;for(const v in this.buckets){const S=this.buckets[v],C=c.style.getOwnLayer(v);if(!C)continue;const k=C.queryRadius(S);this.queryPadding=Math.max(this.queryPadding,k)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new h.aR}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,c,g){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets={...this.buckets,...jd(s.buckets,c.style)},s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s){for(const v in this.buckets){const S=this.buckets[v];S.uploadPending()&&S.upload(s)}const c=s.gl,g=this.imageAtlas;if(g&&!g.uploaded){const v=!!Object.keys(g.patternPositions).length;this.imageAtlasTexture=new h.T(s,g.image,c.RGBA8,{useMipmap:v}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new h.T(s,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new h.T(s,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(s,c,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,g),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=c.style.getBrightness();(this._lastUpdatedBrightness||v)&&(this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this._lastUpdatedBrightness=v,this.updateBuckets(c)))}queryRenderedFeatures(s,c,g,v,S,C,k,F,z){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:g,pixelPosMatrix:F,transform:k,filter:v,layers:S,availableImages:C,tileTransform:this.tileTransform},s,c):{}}querySourceFeatures(s,c){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const v=g.loadVTLayers(),S=c?c.sourceLayer:"",C=v._geojsonTileLayer||v[S];if(!C)return;const k=h.aU(c&&c.filter),{z:F,x:z,y:N}=this.tileID.canonical,U={z:F,x:z,y:N};for(let q=0;q<C.length;q++){const W=C.feature(q);if(k.needGeometry){const re=h.aV(W,!0);if(!k.filter(new h.a3(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!k.filter(new h.a3(this.tileID.overscaledZ),W))continue;const ee=g.getId(W,S),K=new h.aW(W,F,z,N,ee);K.tile=U,s.push(K)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const c=this.expirationTime;if(s.cacheControl){const g=h.aX(s.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const g=Date.now();let v=!1;if(this.expirationTime>g)v=!1;else if(c)if(this.expirationTime<c)v=!0;else{const S=this.expirationTime-c;S?this.expirationTime=g+Math.max(S,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}updateBuckets(s){if(!this.latestFeatureIndex)return;const c=this.latestFeatureIndex.loadVTLayers(),g=s.style.listImages(),v=s.style.getBrightness();for(const S in this.buckets){if(!s.style.hasLayer(S))continue;const C=this.buckets[S],k=C.layers[0],F=k.sourceLayer||"_geojsonTileLayer",z=c[F],N=s.style.getSourceCache(k.source,k.scope);let U={};N&&(U=N._state.getState(F,void 0)),C.update(U,z,g,this.imageAtlas&&this.imageAtlas.patternPositions||{},v),(C instanceof h.aY||C instanceof h.aZ)&&s._terrain&&s._terrain.enabled&&N&&C.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(N.id,this.tileID);const q=s&&s.style&&s.style.getOwnLayer(S);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(C)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<h.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=h.q.now()+s}setTexture(s,c){const g=c.context,v=g.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof h.T?this.texture.update(s):(this.texture=new h.T(g,s,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(s,c){const g={};for(const v of c)g[v]=!0;this.dependencies[s]=g}hasDependency(s,c){for(const g of s){const v=this.dependencies[g];if(v)for(const S of c)if(v[S])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,c){if(!c||"mercator"===c.name||this._tileDebugBuffer)return;const g=h.a_(Oo,this.tileID.canonical,this.tileTransform)[0],v=new h.a$,S=new h.b0;for(let C=0;C<g.length;C++){const{x:k,y:F}=g[C];v.emplaceBack(k,F),S.emplaceBack(C)}S.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(S),this._tileDebugBuffer=s.createVertexBuffer(v,h.b1.members),this._tileDebugSegments=h.b2.simpleSegment(0,0,v.length,S.length)}_makeTileBoundsBuffers(s,c){if(this._tileBoundsBuffer||!c||"mercator"===c.name)return;const g=h.a_(Oo,this.tileID.canonical,this.tileTransform)[0];let v,S;if(this.isRaster){const C=function(k,F){const z=h.aL(k,F),N=Math.pow(2,k.z);for(let re=0;re<33;re++)for(let ie=0;ie<33;ie++){const ge=h.aM((k.x+(ie+es(ie))/32)/N),xe=h.aN((k.y+(re+es(re))/32)/N),ve=F.project(ge,xe),Ee=33*re+ie;ya[2*Ee+0]=Math.round((ve.x*z.scale-z.x)*h.ab),ya[2*Ee+1]=Math.round((ve.y*z.scale-z.y)*h.ab)}Ql.fill(0),$h.fill(0);for(let re=2045;re>=0;re--){const ie=4*re,ge=Al[ie+0],xe=Al[ie+1],ve=Al[ie+2],Ee=Al[ie+3],Ae=ge+ve>>1,Ie=xe+Ee>>1,Re=Ae+Ie-xe,Fe=Ie+ge-Ae,He=33*xe+ge,ze=33*Ee+ve,Ne=33*Ie+Ae,ut=Math.hypot((ya[2*He+0]+ya[2*ze+0])/2-ya[2*Ne+0],(ya[2*He+1]+ya[2*ze+1])/2-ya[2*Ne+1])>=16;Ql[Ne]=Ql[Ne]||(ut?1:0),re<1022&&(Ql[Ne]=Ql[Ne]||Ql[33*(xe+Fe>>1)+(ge+Re>>1)]||Ql[33*(Ee+Fe>>1)+(ve+Re>>1)])}const U=new h.aO,q=new h.aP;let W=0;function ee(re,ie){const ge=33*ie+re;return 0===$h[ge]&&(U.emplaceBack(ya[2*ge+0],ya[2*ge+1],re*h.ab/32,ie*h.ab/32),$h[ge]=++W),$h[ge]-1}function K(re,ie,ge,xe,ve,Ee){const Ae=re+ge>>1,Ie=ie+xe>>1;if(Math.abs(re-ve)+Math.abs(ie-Ee)>1&&Ql[33*Ie+Ae])K(ve,Ee,re,ie,Ae,Ie),K(ge,xe,ve,Ee,Ae,Ie);else{const Re=ee(re,ie),Fe=ee(ge,xe),He=ee(ve,Ee);q.emplaceBack(Re,Fe,He)}}return K(0,0,32,32,32,0),K(32,32,0,0,0,32),{vertices:U,indices:q}}(this.tileID.canonical,c);v=C.vertices,S=C.indices}else{v=new h.aO,S=new h.aP;for(const{x:k,y:F}of g)v.emplaceBack(k,F,0,0);const C=h.b3(v.int16,void 0,4);for(let k=0;k<C.length;k+=3)S.emplaceBack(C[k],C[k+1],C[k+2])}this._tileBoundsBuffer=s.createVertexBuffer(v,h.b4.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(S),this._tileBoundsSegments=h.b2.simpleSegment(0,0,v.length,S.length)}_makeGlobeTileDebugBuffers(s,c){const g=c.projection;if(!g||"globe"!==g.name||c.freezeTileCoverage)return;const v=this.tileID.canonical,S=h.b5(v,c),C=h.b6(S),k=h.a9(c.zoom);let F;k>0&&(F=h.a6.mat4.invert(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,v,c,C,F,k),this._makeGlobeTileDebugTextBuffer(s,v,c,C,F,k)}_globePoint(s,c,g,v,S,C,k){let F=h.b7(s,c,g);if(C){const z=1<<g.z,N=h.am(v.center.lng),U=h.at(v.center.lat),q=(g.x+.5)/z-N;let W=0;q>.5?W=-1:q<-.5&&(W=1);let ee=(s/h.ab+g.x)/z+W,K=(c/h.ab+g.y)/z;ee=(ee-N)*v._pixelsPerMercatorPixel+N,K=(K-U)*v._pixelsPerMercatorPixel+U;const re=[ee*v.worldSize,K*v.worldSize,0];h.a6.vec3.transformMat4(re,re,C),F=h.b8(F,re,k)}return h.a6.vec3.transformMat4(F,F,S)}_makeGlobeTileDebugBorderBuffer(s,c,g,v,S,C){const k=new h.a$,F=new h.b0,z=new h.b9,N=(q,W,ee,K,re)=>{const ie=(ee-q)/(re-1),ge=(K-W)/(re-1),xe=k.length;for(let ve=0;ve<re;ve++){const Ee=q+ve*ie,Ae=W+ve*ge;k.emplaceBack(Ee,Ae);const Ie=this._globePoint(Ee,Ae,c,g,v,S,C);z.emplaceBack(Ie[0],Ie[1],Ie[2]),F.emplaceBack(xe+ve)}},U=h.ab;N(0,0,U,0,16),N(U,0,U,U,16),N(U,U,0,U,16),N(0,U,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(F),this._tileDebugBuffer=s.createVertexBuffer(k,h.b1.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(z,h.ba.members),this._tileDebugSegments=h.b2.simpleSegment(0,0,k.length,F.length)}_makeGlobeTileDebugTextBuffer(s,c,g,v,S,C){const k=h.ab/4,F=new h.a$,z=new h.aP,N=new h.b9,U=25;z.reserve(32),F.reserve(U),N.reserve(U);const q=(W,ee)=>U*W+ee;for(let W=0;W<U;W++){const ee=W*k;for(let K=0;K<U;K++){const re=K*k;F.emplaceBack(re,ee);const ie=this._globePoint(re,ee,c,g,v,S,C);N.emplaceBack(ie[0],ie[1],ie[2])}}for(let W=0;W<4;W++)for(let ee=0;ee<4;ee++){const K=q(W,ee),re=q(W,ee+1),ie=q(W+1,ee),ge=q(W+1,ee+1);z.emplaceBack(K,re,ie),z.emplaceBack(ie,re,ge)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(z),this._tileDebugTextBuffer=s.createVertexBuffer(F,h.b1.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(N,h.ba.members),this._tileDebugTextSegments=h.b2.simpleSegment(0,0,U,32)}destroy(s=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof h.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}h.bb.setPbf(h.bc);class Ud extends Rl{constructor(s,c,g,v,S){super(s,c,g,v,S),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(s,c){const g=c.context,v=g.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof h.T?this.texture.update(s,{premultiply:!1}):this.texture=new h.T(g,s,v.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(s=16384,c){const g=this._mrt=new h.bb(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=h.bd(v,(S,C,k,F)=>{if(S)c(S);else try{const z=g.getHeaderLength(C);if(z>s)return void(this.request=this.fetchHeader(z,c));g.parseHeader(C),this._isHeaderLoaded=!0;let N=0;for(const U of Object.values(g.layers))N=Math.max(N,U.dataIndex[U.dataIndex.length-1].last_byte);C.byteLength>=N&&(this.entireBuffer=C),c(null,this.entireBuffer||C,k,F)}catch(z){c(z)}}),this.request}fetchBand(s,c,g){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void g(new Error("Tile header is not ready"));const S=this.actor;if(!S)return void g(new Error("Can't fetch tile band without an actor"));let C;const k=(U,q)=>{C.complete(U,q),U?g(U):(this.updateTextureDescriptor(s,c),g(null,this.textureDescriptor&&this.textureDescriptor.img))},F=(U,q)=>{if(U)return g(U);const W=S.send("decodeRasterArray",{buffer:q,task:C},k,void 0,!0);this._workQueue.push(()=>{W&&W.cancel(),C.cancel()})},z=v.getLayer(s);if(!z)return void g(new Error(`Unknown sourceLayer "${s}"`));if(z.hasDataForBand(c))return this.updateTextureDescriptor(s,c),void g(null,this.textureDescriptor?this.textureDescriptor.img:null);const N=z.getDataRange([c]);if(C=v.createDecodingTask(N),!C||C.tasks.length)if(this.flushQueues(),this.entireBuffer)F(null,this.entireBuffer.slice(N.firstByte,N.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${N.firstByte}-${N.lastByte}`}}),q=h.bd(U,F);this._fetchQueue.push(()=>{q.cancel(),C.cancel()})}else g(null)}updateNeeded(s,c){return(!this.textureDescriptor||this.textureDescriptor.band!==c||this.textureDescriptor.layer!==s)&&"errored"!==this.state}updateTextureDescriptor(s,c){if(!this._mrt)return;const g=this._mrt.getLayer(s);if(!g||!g.hasBand(c)||!g.hasDataForBand(c))return;const{bytes:v,tileSize:S,buffer:C,offset:k,scale:F}=g.getBandView(c),z=S+2*C,N={data:v,width:z,height:z},U=this.texture;U&&U instanceof h.T&&U.update(N,{premultiply:!1}),this.textureDescriptor={layer:s,band:c,img:N,buffer:C,offset:k,tileSize:S,format:g.pixelFormat,mix:[F,256*F,65536*F,16777216*F]}}}class Ro{constructor(s,c){this.max=s,this.onRemove=c,this.reset()}reset(){for(const s in this.data)for(const c of this.data[s])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(s,c,g){const v=s.wrapped().key;void 0===this.data[v]&&(this.data[v]=[]);const S={value:c,timeout:void 0};if(void 0!==g&&(S.timeout=setTimeout(()=>{this.remove(s,S)},g)),this.data[v].push(S),this.order.push(v),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),0===this.data[s].length&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value}getByKey(s){const c=this.data[s];return c?c[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,c){if(!this.has(s))return this;const g=s.wrapped().key,v=void 0===c?0:this.data[g].indexOf(c),S=this.data[g][v];return this.data[g].splice(v,1),S.timeout&&clearTimeout(S.timeout),0===this.data[g].length&&delete this.data[g],this.onRemove(S.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(s){const c=[];for(const g in this.data)for(const v of this.data[g])s(v.value)||c.push(v);for(const g of c)this.remove(g.value.tileID,g)}}class rg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,c,g){const v=String(c);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][v]=this.stateChanges[s][v]||{},h.l(this.stateChanges[s][v],g),null===this.deletedStates[s]){this.deletedStates[s]={};for(const S in this.state[s])S!==v&&(this.deletedStates[s][S]=null)}else if(this.deletedStates[s]&&null===this.deletedStates[s][v]){this.deletedStates[s][v]={};for(const S in this.state[s][v])g[S]||(this.deletedStates[s][v][S]=null)}else for(const S in g)this.deletedStates[s]&&this.deletedStates[s][v]&&null===this.deletedStates[s][v][S]&&delete this.deletedStates[s][v][S]}removeFeatureState(s,c,g){if(null===this.deletedStates[s])return;const v=String(c);if(this.deletedStates[s]=this.deletedStates[s]||{},g&&void 0!==c)null!==this.deletedStates[s][v]&&(this.deletedStates[s][v]=this.deletedStates[s][v]||{},this.deletedStates[s][v][g]=null);else if(void 0!==c)if(this.stateChanges[s]&&this.stateChanges[s][v])for(g in this.deletedStates[s][v]={},this.stateChanges[s][v])this.deletedStates[s][v][g]=null;else this.deletedStates[s][v]=null;else this.deletedStates[s]=null}getState(s,c){const g=this.state[s]||{},v=this.stateChanges[s]||{},S=this.deletedStates[s];if(null===S)return{};if(void 0!==c){const k=String(c),F=h.l({},g[k],v[k]);if(S){const z=S[c];if(null===z)return{};for(const N in z)delete F[N]}return F}const C=h.l({},g,v);if(S)for(const k in S)delete C[k];return C}initializeTileState(s,c){s.refreshFeatureState(c)}coalesceChanges(s,c){const g={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const S={};for(const C in this.stateChanges[v])this.state[v][C]||(this.state[v][C]={}),h.l(this.state[v][C],this.stateChanges[v][C]),S[C]=this.state[v][C];g[v]=S}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const S={};if(null===this.deletedStates[v])for(const C in this.state[v])S[C]={},this.state[v][C]={};else for(const C in this.deletedStates[v]){if(null===this.deletedStates[v][C])this.state[v][C]={};else if(this.state[v][C])for(const k of Object.keys(this.deletedStates[v][C]))delete this.state[v][C][k];S[C]=this.state[v][C]}g[v]=g[v]||{},h.l(g[v],S)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(g).length)for(const v in s)s[v].refreshFeatureState(c)}}class Cr extends h.E{constructor(s,c,g){super(),this.id=s,this._onlySymbols=g,c.on("data",v=>{"source"===v.dataType&&"metadata"===v.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===v.dataType&&"content"===v.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new Ro(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new rg,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(s){this.map=s,this._minTileCacheSize=void 0===this._minTileCacheSize&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const c=this._tiles[s];if("loaded"!==c.state&&"errored"!==c.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,c){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,c)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const g=this._tiles[c];g.upload(s),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return h.be(this._tiles).map(s=>s.tileID).sort(ec).map(s=>s.key)}getRenderableIds(s,c){const g=[];for(const v in this._tiles)this._isIdRenderable(+v,s,c)&&g.push(this._tiles[v]);return s?g.sort((v,S)=>{const C=v.tileID,k=S.tileID,F=new h.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle),z=new h.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle);return C.overscaledZ-k.overscaledZ||z.y-F.y||z.x-F.x}).map(v=>v.tileID.key):g.map(v=>v.tileID).sort(ec).map(v=>v.key)}hasRenderableParent(s){const c=this.findLoadedParent(s,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(s,c,g){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(c||!this._tiles[s].holdingForFade())&&(g||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)"errored"!==this._tiles[s].state&&this._reloadTile(+s,"reloading")}}_reloadTile(s,c){const g=this._tiles[s];g&&("loading"!==g.state&&(g.state=c),this._loadTile(g,this._tileLoaded.bind(this,g,s,c)))}_tileLoaded(s,c,g,v){if(v)if(s.state="errored",404!==v.status)this._source.fire(new h.t(v,{tile:s}));else{if(this._source.fire(new h.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const S=this.map.painter.terrain;this.update(this.transform,S.getScaledDemTileSize(),!0),S.resetTileLookupCache(this.id)}else this.update(this.transform)}else s.timeAdded=h.q.now(),"expired"===g&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(c,s),"raster-dem"===this._source.type&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new h.x("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id}))}_backfillDEM(s){const c=this.getRenderableIds();for(let v=0;v<c.length;v++){const S=c[v];if(s.neighboringTiles&&s.neighboringTiles[S]){const C=this.getTileByID(S);g(s,C),g(C,s)}}function g(v,S){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let C=S.tileID.canonical.x-v.tileID.canonical.x;const k=S.tileID.canonical.y-v.tileID.canonical.y,F=Math.pow(2,v.tileID.canonical.z),z=S.tileID.key;0===C&&0===k||Math.abs(k)>1||(Math.abs(C)>1&&(1===Math.abs(C+F)?C+=F:1===Math.abs(C-F)&&(C-=F)),S.dem&&v.dem&&(v.dem.backfillBorder(S.dem,C,k),v.neighboringTiles&&v.neighboringTiles[z]&&(v.neighboringTiles[z].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,c,g,v){for(const S in this._tiles){let C=this._tiles[S];if(v[S]||!C.hasData()||C.tileID.overscaledZ<=c||C.tileID.overscaledZ>g)continue;let k=C.tileID;for(;C&&C.tileID.overscaledZ>c+1;){const z=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[z.key],C&&C.hasData()&&(k=z)}let F=k;for(;F.overscaledZ>c;)if(F=F.scaledTo(F.overscaledZ-1),s[F.key]){v[k.key]=k;break}}}findLoadedParent(s,c){if(s.key in this._loadedParentTiles){const g=this._loadedParentTiles[s.key];return g&&g.tileID.overscaledZ>=c?g:null}for(let g=s.overscaledZ-1;g>=c;g--){const v=s.scaledTo(g),S=this._getLoadedTile(v);if(S)return S}}_getLoadedTile(s){const c=this._tiles[s.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,c){c=c||this._source.tileSize;const g=Math.ceil(s.width/c)+1,v=Math.ceil(s.height/c)+1,S=Math.floor(g*v*5),C="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,S):S,k="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(k)}handleWrapJump(s){const c=Math.round((s-(void 0===this._prevLng?s:this._prevLng))/360);if(this._prevLng=s,c){const g={};for(const v in this._tiles){const S=this._tiles[v];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),g[S.tileID.key]=S}this._tiles=g;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(s,c,g,v){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(s,c),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const S="batched-model"===this._source.type;let C,k=this._source.maxzoom;const F=this.map&&this.map.painter?this.map.painter._terrain:null;if(F&&F.sourceCache===this&&F.attenuationRange()){const U=F.attenuationRange()[0],q=Math.floor(U)-Math.log2(F.getDemUpscale());k>q&&(k=q)}if(this.used||this.usedForTerrain){if(this._source.tileID)C=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new h.aA(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y));else if(0!==this.tileCoverLift){const U=s.clone();U.tileCoverLift=this.tileCoverLift,C=U.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.minzoom<=1&&"globe"===s.projection.name&&(C.push(new h.aA(1,0,1,0,0)),C.push(new h.aA(1,0,1,1,0)),C.push(new h.aA(1,0,1,0,1)),C.push(new h.aA(1,0,1,1,1)))}else if(C=s.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.hasTile){const U=this._source.hasTile.bind(this._source);C=C.filter(q=>U(q))}}else C=[];if(C.length>0&&this.castsShadows&&v&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Wh(this._source.type)){const U=s.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),q=Math.min(U,this._source.maxzoom);if(S){const W=s.extendTileCover(C,q);for(const ee of W)C.push(ee)}else{const W=s.extendTileCover(C,q,v);for(const ee of W)this._shadowCasterTiles[ee.key]=!0,C.push(ee)}}const z=this._updateRetainedTiles(C);if(Wh(this._source.type)&&0!==C.length){const U={},q={},W=Object.keys(z);for(const K of W){const re=z[K],ie=this._tiles[K];if(!ie||ie.fadeEndTime&&ie.fadeEndTime<=h.q.now())continue;const ge=this.findLoadedParent(re,Math.max(re.overscaledZ-Cr.maxOverzooming,this._source.minzoom));ge&&(this._addTile(ge.tileID),U[ge.tileID.key]=ge.tileID),q[K]=re}const ee=C[C.length-1].overscaledZ;for(const K in this._tiles){const re=this._tiles[K];if(z[K]||!re.hasData())continue;let ie=re.tileID;for(;ie.overscaledZ>ee;){ie=ie.scaledTo(ie.overscaledZ-1);const ge=this._tiles[ie.key];if(ge&&ge.hasData()&&q[ie.key]){z[K]=re.tileID;break}}}for(const K in U)z[K]||(this._coveredTiles[K]=!0,z[K]=U[K])}for(const U in z)this._tiles[U].clearFadeHold();const N=h.bf(this._tiles,z);for(const U of N){const q=this._tiles[U];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(+U)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const c={};if(0===s.length)return c;const g={},v=s.reduce((z,N)=>Math.min(z,N.overscaledZ),1/0),S=s[0].overscaledZ,C=Math.max(S-Cr.maxOverzooming,this._source.minzoom),k=Math.max(S+Cr.maxUnderzooming,this._source.minzoom),F={};for(const z of s){const N=this._addTile(z);c[z.key]=z,N.hasData()||v<this._source.maxzoom&&(F[z.key]=z)}this._retainLoadedChildren(F,v,k,c);for(const z of s){let N=this._tiles[z.key];if(N.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const q=z.children(this._source.maxzoom)[0],W=this.getTile(q);if(W&&W.hasData()){c[q.key]=q;continue}}else{const q=z.children(this._source.maxzoom);if(c[q[0].key]&&c[q[1].key]&&c[q[2].key]&&c[q[3].key])continue}let U=N.wasRequested();for(let q=z.overscaledZ-1;q>=C;--q){const W=z.scaledTo(q);if(g[W.key]||(g[W.key]=!0,N=this.getTile(W),!N&&U&&(N=this._addTile(W)),N&&(c[W.key]=W,U=N.wasRequested(),N.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const c=[];let g,v=this._tiles[s].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){g=this._loadedParentTiles[v.key];break}c.push(v.key);const S=v.scaledTo(v.overscaledZ-1);if(g=this._getLoadedTile(S),g)break;v=S}for(const S of c)this._loadedParentTiles[S]=g}}_addTile(s){let c=this._tiles[s.key];if(c)return!0!==c.isExtraShadowCaster||!!this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),c;c=this._cache.getAndRemove(s),c&&(this._setTileReloadTimer(s.key,c),c.tileID=s,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,c)));const g=Boolean(c);if(!g){const v=this.map?this.map.painter:null,S=this._source.tileSize*s.overscaleFactor();c="raster-array"===this._source.type?new Ud(s,S,this.transform.tileZoom,v,this._isRaster):new Rl(s,S,this.transform.tileZoom,v,this._isRaster),this._loadTile(c,this._tileLoaded.bind(this,c,s.key,c.state))}return c?(c.uses++,this._tiles[s.key]=c,g||this._source.fire(new h.x("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(s,c){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const g=c.getExpiryTimeout();g&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},g))}_removeTile(s){const c=this._tiles[s];c&&(c.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),c.uses>0||(c.hasData()&&"reloading"!==c.state||"empty"===c.state?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,c,g){const v=[],S=this.transform;if(!S)return v;const C="globe"===S.projection.name,k=h.am(S.center.lng);for(const F in this._tiles){const z=this._tiles[F];if(g&&z.clearQueryDebugViz(),z.holdingForFade())continue;let N;if(C){const U=z.tileID.canonical;if(0===U.z){const q=[Math.abs(h.ap(k,...Dr(U,-1))-k),Math.abs(h.ap(k,...Dr(U,1))-k)];N=[0,2*q.indexOf(Math.min(...q))-1]}else{const q=[Math.abs(h.ap(k,...Dr(U,-1))-k),Math.abs(h.ap(k,...Dr(U,0))-k),Math.abs(h.ap(k,...Dr(U,1))-k)];N=[q.indexOf(Math.min(...q))-1]}}else N=[0];for(const U of N){const q=s.containsTile(z,S,c,U);q&&v.push(q)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,c){const g=this.getRenderableIds(s,c).map(S=>this._tiles[S].tileID),v="globe"===this.transform.projection.name;for(const S of g)S.projMatrix=this.transform.calculateProjMatrix(S.toUnwrapped()),S.expandedProjMatrix=v?this.transform.calculateProjMatrix(S.toUnwrapped(),!1,!0):S.projMatrix;return g}sortCoordinatesByDistance(s){const c=s.slice(),g=this.transform._camera.position,v=this.transform._camera.forward(),S={};for(const C of c){const k=1/(1<<C.canonical.z);S[C.key]=((C.canonical.x+.5)*k+C.wrap-g[0])*v[0]+((C.canonical.y+.5)*k-g[1])*v[1]-g[2]*v[2]}return c.sort((C,k)=>S[C.key]-S[k.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(Wh(this._source.type))for(const s in this._tiles){const c=this._tiles[s];if(void 0!==c.fadeEndTime&&c.fadeEndTime>=h.q.now())return!0}return!1}setFeatureState(s,c,g){this._state.updateState(s=s||"_geojsonTileLayer",c,g)}removeFeatureState(s,c,g){this._state.removeFeatureState(s=s||"_geojsonTileLayer",c,g)}getFeatureState(s,c){return this._state.getState(s=s||"_geojsonTileLayer",c)}setDependencies(s,c,g){const v=this._tiles[s];v&&v.setDependencies(c,g)}reloadTilesForDependencies(s,c){for(const g in this._tiles)this._tiles[g].hasDependency(s,c)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(s,c))}_preloadTiles(s,c){if(!this._sourceLoaded){const F=()=>{this._sourceLoaded&&(this._source.off("data",F),this._preloadTiles(s,c))};return void this._source.on("data",F)}const g=new Map,v=Array.isArray(s)?s:[s],S=this.map.painter.terrain,C=this.usedForTerrain&&S?S.getScaledDemTileSize():this._source.tileSize;for(const F of v){const z=F.coveringTiles({tileSize:C,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const N of z)g.set(N.key,N);this.usedForTerrain&&F.updateElevation(!1)}const k=Array.from(g.values());h.bg(k,(F,z)=>{const N=new Rl(F,this._source.tileSize*F.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(N,U=>{"raster-dem"===this._source.type&&N.dem&&this._backfillDEM(N),z(U,N)})},c)}}function ec(m,s){const c=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||g-c||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function Wh(m){return"raster"===m||"image"===m||"video"===m||"custom"===m}function Dr(m,s){const c=1<<m.z;return[m.x/c+s,(m.x+1)/c+s]}Cr.maxOverzooming=10,Cr.maxUnderzooming=3;class $i{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];for(const g in this.style._mergedLayers){const v=this.style._mergedLayers[g];if("fill-extrusion"===v.type)this.layers.push({layer:v,visible:false,visibilityChanged:false});else if("model"===v.type){const S=this.style.getLayerSource(v);S&&"batched-model"===S.type&&this.layers.push({layer:v,visible:false,visibilityChanged:false})}}}onNewFrame(s){this.layersGotHidden=!1;for(const c of this.layers){const g=c.layer;let v=!1;"fill-extrusion"===g.type?v=!g.isHidden(s)&&g.paint.get("fill-extrusion-opacity")>0:"model"===g.type&&(v=!g.isHidden(s)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&c.visible,c.visible=v}}updateZOffset(s,c){this.currentBuildingBuckets=[];for(const v of this.layers){const S=v.layer,C=this.style.getLayerSourceCache(S);let k=1;"fill-extrusion"===S.type&&(k=v.visible?S.paint.get("fill-extrusion-vertical-scale"):0);let F=C?C.getTile(c):null;if(!F&&C&&c.canonical.z>C.getSource().minzoom){let z=c.scaledTo(Math.min(C.getSource().maxzoom,c.overscaledZ-1));for(;z.overscaledZ>=C.getSource().minzoom&&(F=C.getTile(z),!F&&0!==z.overscaledZ);)z=z.scaledTo(z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:F?F.getBucket(S):null,tileID:F?F.tileID:c,verticalScale:k})}s.hasAnyZOffset=!1;let g=!1;for(let v=0;v<s.symbolInstances.length;v++){const S=s.symbolInstances.get(v),C=S.zOffset,k=this._getHeightAtTileOffset(c,S.tileAnchorX,S.tileAnchorY);S.zOffset=k!==Number.NEGATIVE_INFINITY?k:C,g||C===S.zOffset||(g=!0),s.hasAnyZOffset||0===S.zOffset||(s.hasAnyZOffset=!0)}g&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,c,g,v){let S=c,C=g;if(s.canonical.z!==v.canonical.z){const k=v.canonical,F=1/(1<<s.canonical.z-k.z);S=(c+s.canonical.x*h.ab)*F-k.x*h.ab|0,C=(g+s.canonical.y*h.ab)*F-k.y*h.ab|0}return{tileX:S,tileY:C}}_getHeightAtTileOffset(s,c,g){let v,S;for(let C=0;C<this.layers.length;++C){if("fill-extrusion"!==this.layers[C].layer.type)continue;const{bucket:k,tileID:F,verticalScale:z}=this.currentBuildingBuckets[C];if(!k)continue;const{tileX:N,tileY:U}=this._mapCoordToOverlappingTile(s,c,g,F),q=k.getHeightAtTileCoord(N,U);q&&void 0!==q.height&&(q.hidden?v=q.height:S=Math.max(q.height*z,S||0))}if(void 0!==S)return S;for(let C=0;C<this.layers.length;++C){const k=this.layers[C];if("model"!==k.layer.type||!k.visible)continue;const{bucket:F,tileID:z}=this.currentBuildingBuckets[C];if(!F)continue;const{tileX:N,tileY:U}=this._mapCoordToOverlappingTile(s,c,g,z),q=F.getHeightAtTileCoord(N,U);if(q&&!q.hidden)return void 0===q.height&&void 0!==v?Math.min(q.maxHeight,v)*q.verticalScale:q.height?q.height*q.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function uu(m,s){const c={};for(const g in m)"ref"!==g&&(c[g]=m[g]);return h.bh.forEach(g=>{g in s&&(c[g]=s[g])}),c}function rb(m){m=m.slice();const s=Object.create(null);for(let c=0;c<m.length;c++)s[m[c].id]=m[c];for(let c=0;c<m.length;c++)"ref"in m[c]&&(m[c]=uu(m[c],s[m[c].ref]));return m}const qt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Hd(m,s,c){c.push({command:qt.addSource,args:[m,s[m]]})}function Gn(m,s,c){s.push({command:qt.removeSource,args:[m]}),c[m]=!0}function bo(m,s,c,g){Gn(m,c,g),Hd(m,s,c)}function ni(m,s,c){let g;for(g in m[c])if(m[c].hasOwnProperty(g)&&"data"!==g&&!h.bi(m[c][g],s[c][g]))return!1;for(g in s[c])if(s[c].hasOwnProperty(g)&&"data"!==g&&!h.bi(m[c][g],s[c][g]))return!1;return!0}function Df(m,s,c,g,v,S){let C;for(C in s=s||{},m=m||{})m.hasOwnProperty(C)&&(h.bi(m[C],s[C])||c.push({command:S,args:[g,C,s[C],v]}));for(C in s)s.hasOwnProperty(C)&&!m.hasOwnProperty(C)&&(h.bi(m[C],s[C])||c.push({command:S,args:[g,C,s[C],v]}))}function Ju(m){return m.id}function Ec(m,s){return m[s.id]=s,m}class ts{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(1===this.points.length)return this.points[0];s=h.ap(s,0,1);let c=1,g=this._distances[c];const v=s*this.paddedLength+this.padding;for(;g<v&&c<this._distances.length;)g=this._distances[++c];const S=c-1,C=this._distances[S],k=g-C,F=k>0?(v-C)/k:0;return this.points[S].mult(1-F).add(this.points[c].mult(F))}}class og{constructor(s,c,g){const v=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(c/g);for(let C=0;C<this.xCellCount*this.yCellCount;C++)v.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,g,v,S){this._forEachCell(c,g,v,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(S)}insertCircle(s,c,g,v){this._forEachCell(c-v,g-v,c+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(g),this.circles.push(v)}_insertBoxCell(s,c,g,v,S,C){this.boxCells[S].push(C)}_insertCircleCell(s,c,g,v,S,C){this.circleCells[S].push(C)}_query(s,c,g,v,S,C){if(g<0||s>this.width||v<0||c>this.height)return!S&&[];const k=[];if(s<=0&&c<=0&&this.width<=g&&this.height<=v){if(S)return!0;for(let F=0;F<this.boxKeys.length;F++)k.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const z=this.circles[3*F],N=this.circles[3*F+1],U=this.circles[3*F+2];k.push({key:this.circleKeys[F],x1:z-U,y1:N-U,x2:z+U,y2:N+U})}return C?k.filter(C):k}return this._forEachCell(s,c,g,v,this._queryCell,k,{hitTest:S,seenUids:{box:{},circle:{}}},C),S?k.length>0:k}_queryCircle(s,c,g,v,S){const C=s-g,k=s+g,F=c-g,z=c+g;if(k<0||C>this.width||z<0||F>this.height)return!v&&[];const N=[];return this._forEachCell(C,F,k,z,this._queryCellCircle,N,{hitTest:v,circle:{x:s,y:c,radius:g},seenUids:{box:{},circle:{}}},S),v?N.length>0:N}query(s,c,g,v,S){return this._query(s,c,g,v,!1,S)}hitTest(s,c,g,v,S){return this._query(s,c,g,v,!0,S)}hitTestCircle(s,c,g,v){return this._queryCircle(s,c,g,!0,v)}_queryCell(s,c,g,v,S,C,k,F){const z=k.seenUids,N=this.boxCells[S];if(null!==N){const q=this.bboxes;for(const W of N)if(!z.box[W]){z.box[W]=!0;const ee=4*W;if(s<=q[ee+2]&&c<=q[ee+3]&&g>=q[ee+0]&&v>=q[ee+1]&&(!F||F(this.boxKeys[W]))){if(k.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[W],x1:q[ee],y1:q[ee+1],x2:q[ee+2],y2:q[ee+3]})}}}const U=this.circleCells[S];if(null!==U){const q=this.circles;for(const W of U)if(!z.circle[W]){z.circle[W]=!0;const ee=3*W;if(this._circleAndRectCollide(q[ee],q[ee+1],q[ee+2],s,c,g,v)&&(!F||F(this.circleKeys[W]))){if(k.hitTest)return C.push(!0),!0;{const K=q[ee],re=q[ee+1],ie=q[ee+2];C.push({key:this.circleKeys[W],x1:K-ie,y1:re-ie,x2:K+ie,y2:re+ie})}}}}}_queryCellCircle(s,c,g,v,S,C,k,F){const z=k.circle,N=k.seenUids,U=this.boxCells[S];if(null!==U){const W=this.bboxes;for(const ee of U)if(!N.box[ee]){N.box[ee]=!0;const K=4*ee;if(this._circleAndRectCollide(z.x,z.y,z.radius,W[K+0],W[K+1],W[K+2],W[K+3])&&(!F||F(this.boxKeys[ee])))return C.push(!0),!0}}const q=this.circleCells[S];if(null!==q){const W=this.circles;for(const ee of q)if(!N.circle[ee]){N.circle[ee]=!0;const K=3*ee;if(this._circlesCollide(W[K],W[K+1],W[K+2],z.x,z.y,z.radius)&&(!F||F(this.circleKeys[ee])))return C.push(!0),!0}}}_forEachCell(s,c,g,v,S,C,k,F){const z=this._convertToXCellCoord(s),N=this._convertToYCellCoord(c),U=this._convertToXCellCoord(g),q=this._convertToYCellCoord(v);for(let W=z;W<=U;W++)for(let ee=N;ee<=q;ee++)if(S.call(this,s,c,g,v,this.xCellCount*ee+W,C,k,F))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,g,v,S,C){const k=v-s,F=S-c,z=g+C;return z*z>k*k+F*F}_circleAndRectCollide(s,c,g,v,S,C,k){const F=(C-v)/2,z=Math.abs(s-(v+F));if(z>F+g)return!1;const N=(k-S)/2,U=Math.abs(c-(S+N));if(U>N+g)return!1;if(z<=F||U<=N)return!0;const q=z-F,W=U-N;return q*q+W*W<=g*g}}const Pl_unknown=0,Pl_flipRequired=1,Pl_flipNotRequired=2,An=Math.tan(85*Math.PI/180);function ki(m,s,c,g,v,S,C){const k=h.a6.mat4.create();if(c)if("globe"===S.name){const F=h.bj(v,s);h.a6.mat4.multiply(k,k,F)}else{const F=h.a6.mat2.invert([],C);k[0]=F[0],k[1]=F[1],k[4]=F[2],k[5]=F[3],g||h.a6.mat4.rotateZ(k,k,v.angle)}else h.a6.mat4.multiply(k,v.labelPlaneMatrix,m);return k}function nr(m,s,c,g,v,S,C){const k=ki(m,s,c,g,v,S,C);return"globe"===S.name&&c||(k[2]=k[6]=k[10]=k[14]=0),k}function qa(m,s,c,g,v,S,C){if(c){if("globe"===S.name){const k=ki(m,s,c,g,v,S,C);return h.a6.mat4.invert(k,k),h.a6.mat4.multiply(k,m,k),k}{const k=h.a6.mat4.clone(m),F=h.a6.mat4.identity([]);return F[0]=C[0],F[1]=C[1],F[4]=C[2],F[5]=C[3],h.a6.mat4.multiply(k,k,F),g||h.a6.mat4.rotateZ(k,k,-v.angle),k}}return v.glCoordMatrix}function va(m,s,c,g){const v=[m,s,c,1];c?h.a6.vec4.transformMat4(v,v,g):wn(v,v,g);const S=v[3];return v[0]/=S,v[1]/=S,v[2]/=S,v}function cr(m,s){return Math.min(.5+m/s*.5,1.5)}function Ef(m,s){const c=m[0]/m[3],g=m[1]/m[3];return c>=-s[0]&&c<=s[0]&&g>=-s[1]&&g<=s[1]}function Xh(m,s,c,g,v,S,C,k,F,z){const N=c.transform,U=g?m.textSizeData:m.iconSizeData,q=h.bk(U,c.transform.zoom),W="globe"===N.projection.name,ee=[256/c.width*2+1,256/c.height*2+1],K=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;K.clear();let re=null;W&&(re=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const ie=m.lineVertexArray,ge=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,xe=c.transform.width/c.transform.height;let ve,Ee=!1;for(let Ae=0;Ae<ge.length;Ae++){const Ie=ge.get(Ae),{numGlyphs:Re,writingMode:Fe}=Ie;if(Fe!==h.bl.vertical||Ee||ve===h.bl.horizontal||(Ee=!0),ve=Fe,(Ie.hidden||Fe===h.bl.vertical)&&!Ee){Ic(Re,K);continue}Ee=!1;const He=new h.P(Ie.tileAnchorX,Ie.tileAnchorY);let{x:ze,y:Ne,z:ut}=N.projection.projectTilePoint(He.x,He.y,z.canonical);if(F){const[Lt,un,Ln]=F(He);ze+=Lt,Ne+=un,ut+=Ln}const wt=[ze,Ne,ut,1];if(h.a6.vec4.transformMat4(wt,wt,s),!Ef(wt,ee)){Ic(Re,K);continue}const zt=wt[3],Zt=cr(c.transform.getCameraToCenterDistance(N.projection),zt),sn=h.bm(U,q,Ie),Ke=C?sn/Zt:sn*Zt,Pt=va(ze,Ne,ut,v);if(Pt[3]<=0){Ic(Re,K);continue}let bt={};const Ot=C?null:F,Ut=Lr(Ie,Ke,!1,k,s,v,S,m.glyphOffsetArray,ie,K,re,Pt,He,bt,xe,Ot,N.projection,z,C);Ee=Ut.useVertical,Ot&&Ut.needsFlipping&&(bt={}),(Ut.notEnoughRoom||Ee||Ut.needsFlipping&&Lr(Ie,Ke,!0,k,s,v,S,m.glyphOffsetArray,ie,K,re,Pt,He,bt,xe,Ot,N.projection,z,C).notEnoughRoom)&&Ic(Re,K)}g?(m.text.dynamicLayoutVertexBuffer.updateData(K),re&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(re)):(m.icon.dynamicLayoutVertexBuffer.updateData(K),re&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(re))}function qd(m,s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K){const{lineStartIndex:re,glyphStartIndex:ie,segment:ge}=k,xe=ie+k.numGlyphs,ve=re+k.lineLength,Ee=s.getoffsetX(ie),Ae=s.getoffsetX(xe-1),Ie=Yh(m*Ee,c,g,v,S,C,ge,re,ve,F,z,N,U,q,!0,W,ee,K);if(!Ie)return null;const Re=Yh(m*Ae,c,g,v,S,C,ge,re,ve,F,z,N,U,q,!0,W,ee,K);return Re?{first:Ie,last:Re}:null}function ka(m,s,c,g){return m===h.bl.horizontal&&Math.abs(g)>Math.abs(c)?{useVertical:!0}:m===h.bl.vertical?g>0?{needsFlipping:!0}:null:s!==Pl_unknown&&(0===(v=c)||Math.abs(g/v)>An)?s===Pl_flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null;var v}function Lr(m,s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K,re,ie,ge){const xe=s/24,ve=m.lineOffsetX*xe,Ee=m.lineOffsetY*xe,{lineStartIndex:Ae,glyphStartIndex:Ie,numGlyphs:Re,segment:Fe,writingMode:He,flipState:ze}=m,Ne=Ae+m.lineLength,ut=wt=>{if(N){const[Ke,Pt,bt]=wt.up,Ot=z.length;h.bn(N,Ot+0,Ke,Pt,bt),h.bn(N,Ot+1,Ke,Pt,bt),h.bn(N,Ot+2,Ke,Pt,bt),h.bn(N,Ot+3,Ke,Pt,bt)}const[zt,Zt,sn]=wt.point;h.bo(z,zt,Zt,sn,wt.angle)};if(Re>1){const wt=qd(xe,k,ve,Ee,c,U,q,m,F,S,W,K,!1,re,ie,ge);if(!wt)return{notEnoughRoom:!0};if(g&&!c){let[zt,Zt,sn]=wt.first.point,[Ke,Pt,bt]=wt.last.point;[zt,Zt]=va(zt,Zt,sn,C),[Ke,Pt]=va(Ke,Pt,bt,C);const Ot=ka(He,ze,(Ke-zt)*ee,Pt-Zt);if(m.flipState=Ot&&Ot.needsFlipping?Pl_flipRequired:Pl_flipNotRequired,Ot)return Ot}ut(wt.first);for(let zt=Ie+1;zt<Ie+Re-1;zt++){const Zt=Yh(xe*k.getoffsetX(zt),ve,Ee,c,U,q,Fe,Ae,Ne,F,S,W,K,!1,!1,re,ie,ge);if(!Zt)return z.length-=4*(zt-Ie),{notEnoughRoom:!0};ut(Zt)}ut(wt.last)}else{if(g&&!c){const zt=va(q.x,q.y,0,v),Zt=Ae+Fe+1,sn=new h.P(F.getx(Zt),F.gety(Zt)),Ke=va(sn.x,sn.y,0,v),Pt=Ke[3]>0?Ke:Zh(q,sn,zt,1,v,void 0,re,ie.canonical),bt=ka(He,ze,(Pt[0]-zt[0])*ee,Pt[1]-zt[1]);if(m.flipState=bt&&bt.needsFlipping?Pl_flipRequired:Pl_flipNotRequired,bt)return bt}const wt=Yh(xe*k.getoffsetX(Ie),ve,Ee,c,U,q,Fe,Ae,Ne,F,S,W,K,!1,!1,re,ie,ge);if(!wt)return{notEnoughRoom:!0};ut(wt)}return{}}function yo(m,s,c,g,v){const{x:S,y:C,z:k}=g.projectTilePoint(m.x,m.y,s);if(!v)return va(S,C,k,c);const[F,z,N]=v(m);return va(S+F,C+z,k+N,c)}function Zh(m,s,c,g,v,S,C,k){const F=yo(m.sub(s)._unit()._add(m),k,v,C,S);return h.a6.vec3.sub(F,c,F),h.a6.vec3.normalize(F,F),h.a6.vec3.scaleAndAdd(F,c,F,g)}function Yh(m,s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K,re,ie){const ge=g?m-s:m+s;let xe=ge>0?1:-1,ve=0;g&&(xe*=-1,ve=Math.PI),xe<0&&(ve+=Math.PI);let Ee=k+C+(xe>0?0:1)|0,Ae=v,Ie=v,Re=0,Fe=0;const He=Math.abs(ge),ze=[],Ne=[];let ut=S,wt=ut;const zt=()=>Zh(wt,ut,Ie,He-Re+1,N,q,K,re.canonical);for(;Re+Fe<=He;){if(Ee+=xe,Ee<k||Ee>=F)return null;if(Ie=Ae,wt=ut,ze.push(Ie),W&&Ne.push(wt),ut=new h.P(z.getx(Ee),z.gety(Ee)),Ae=U[Ee],!Ae){const un=yo(ut,re.canonical,N,K,q);Ae=un[3]>0?U[Ee]=un:zt()}Re+=Fe,Fe=h.a6.vec3.distance(Ie,Ae)}ee&&q&&(U[Ee]&&(Ae=zt(),Fe=h.a6.vec3.distance(Ie,Ae)),U[Ee]=Ae);const Zt=(He-Re)/Fe,sn=ut.sub(wt)._mult(Zt)._add(wt),Ke=h.a6.vec3.sub([],Ae,Ie),Pt=h.a6.vec3.scaleAndAdd([],Ie,Ke,Zt);let bt=[0,0,1],Ot=Ke[0],Ut=Ke[1];if(ie&&(bt=K.upVector(re.canonical,sn.x,sn.y),0!==bt[0]||0!==bt[1]||1!==bt[2])){const un=[bt[2],0,-bt[0]],Ln=h.a6.vec3.cross([],bt,un);h.a6.vec3.normalize(un,un),h.a6.vec3.normalize(Ln,Ln),Ot=h.a6.vec3.dot(Ke,un),Ut=h.a6.vec3.dot(Ke,Ln)}if(c){const un=h.a6.vec3.cross([],bt,Ke);h.a6.vec3.normalize(un,un),h.a6.vec3.scaleAndAdd(Pt,Pt,un,c*xe)}const Lt=ve+Math.atan2(Ut,Ot);return ze.push(Pt),W&&Ne.push(sn),{point:Pt,angle:Lt,path:ze,tilePath:Ne,up:bt}}function Ic(m,s){const c=s.length,g=c+4*m;s.resize(g),s.float32.fill(-1/0,4*c,4*g)}function wn(m,s,c){const g=s[0],v=s[1];return m[0]=c[0]*g+c[4]*v+c[12],m[1]=c[1]*g+c[5]*v+c[13],m[3]=c[3]*g+c[7]*v+c[15],m}const pl=100;class Nn{constructor(s,c,g=new og(s.width+200,s.height+200,25),v=new og(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+pl,this.screenBottomBoundary=s.height+pl,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=c}placeCollisionBox(s,c,g,v,S,C,k,F){let z=g.projectedAnchorX,N=g.projectedAnchorY,U=g.projectedAnchorZ;const q=g.elevation,W=g.tileID,ee=s.getProjection();if(q&&W){const[Ae,Ie,Re]=ee.upVector(W.canonical,g.tileAnchorX,g.tileAnchorY),Fe=ee.upVectorScale(W.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=Ae*q*Fe,N+=Ie*q*Fe,U+=Re*q*Fe}const K=this.projectAndGetPerspectiveRatio(k,z,N,U,g.tileID,"globe"===ee.name||!!q||this.transform.pitch>0,ee),re=C*K.perspectiveRatio,ie=(g.x1*c+v.x-g.padding)*re+K.point.x,ge=(g.y1*c+v.y-g.padding)*re+K.point.y,xe=(g.x2*c+v.x+g.padding)*re+K.point.x,ve=(g.y2*c+v.y+g.padding)*re+K.point.y,Ee=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(ie,ge,xe,ve)||!S&&this.grid.hitTest(ie,ge,xe,ve,F)||Ee?{box:[],offscreen:!1,occluded:K.occluded}:{box:[ie,ge,xe,ve],offscreen:this.isOffscreen(ie,ge,xe,ve),occluded:!1}}placeCollisionCircles(s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K){const re=[],ie=this.transform.elevation,ge=s.getProjection(),xe=ie?ie.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,ge):null,ve=new h.P(g.tileAnchorX,g.tileAnchorY);let{x:Ee,y:Ae,z:Ie}=ge.projectTilePoint(ve.x,ve.y,K.canonical);if(xe){const[sn,Ke,Pt]=xe(ve);Ee+=sn,Ae+=Ke,Ie+=Pt}const Re="globe"===ge.name,Fe=this.projectAndGetPerspectiveRatio(k,Ee,Ae,Ie,K,Re||!!ie||this.transform.pitch>0,ge),{perspectiveRatio:He}=Fe,ze=(U?C/He:C*He)/h.br,Ne=va(Ee,Ae,Ie,F),ut=Fe.signedDistanceFromCamera>0?qd(ze,S,g.lineOffsetX*ze,g.lineOffsetY*ze,!1,Ne,ve,g,v,F,{},ie&&!U?xe:null,U&&!!ie,ge,K,U):null;let wt=!1,zt=!1,Zt=!0;if(ut&&!Fe.occluded){const sn=.5*W*He+ee,Ke=new h.P(-100,-100),Pt=new h.P(this.screenRightBoundary,this.screenBottomBoundary),bt=new ts,{first:Ot,last:Ut}=ut,Lt=Ot.path.length;let un=[];for(let Sn=Lt-1;Sn>=1;Sn--)un.push(Ot.path[Sn]);for(let Sn=1;Sn<Ut.path.length;Sn++)un.push(Ut.path[Sn]);const Ln=2.5*sn;z&&(un=un.map(([Sn,jn,pn],Yn)=>(xe&&!Re&&(pn=xe(Yn<Lt-1?Ot.tilePath[Lt-1-Yn]:Ut.tilePath[Yn-Lt+2])[2]),va(Sn,jn,pn,z))),un.some(Sn=>Sn[3]<=0)&&(un=[]));let zn=[];if(un.length>0){let Sn=1/0,jn=-1/0,pn=1/0,Yn=-1/0;for(const Jn of un)Sn=Math.min(Sn,Jn[0]),pn=Math.min(pn,Jn[1]),jn=Math.max(jn,Jn[0]),Yn=Math.max(Yn,Jn[1]);jn>=Ke.x&&Sn<=Pt.x&&Yn>=Ke.y&&pn<=Pt.y&&(zn=[un.map(Jn=>new h.P(Jn[0],Jn[1]))],(Sn<Ke.x||jn>Pt.x||pn<Ke.y||Yn>Pt.y)&&(zn=h.bp(zn,Ke.x,Ke.y,Pt.x,Pt.y)))}for(const Sn of zn){bt.reset(Sn,.25*sn);let jn=0;jn=bt.length<=.5*sn?1:Math.ceil(bt.paddedLength/Ln)+1;for(let pn=0;pn<jn;pn++){const Yn=pn/Math.max(jn-1,1),Jn=bt.lerp(Yn),Xi=Jn.x+pl,Br=Jn.y+pl;re.push(Xi,Br,sn,0);const rr=Xi-sn,Zr=Br-sn,ur=Xi+sn,zr=Br+sn;if(Zt=Zt&&this.isOffscreen(rr,Zr,ur,zr),zt=zt||this.isInsideGrid(rr,Zr,ur,zr),!c&&this.grid.hitTestCircle(Xi,Br,sn,q)&&(wt=!0,!N))return{circles:[],offscreen:!1,collisionDetected:wt,occluded:!1}}}}return{circles:!N&&wt||!zt?[]:re,offscreen:Zt,collisionDetected:wt,occluded:Fe.occluded}}queryRenderedSymbols(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let g=1/0,v=1/0,S=-1/0,C=-1/0;for(const N of s){const U=new h.P(N.x+pl,N.y+pl);g=Math.min(g,U.x),v=Math.min(v,U.y),S=Math.max(S,U.x),C=Math.max(C,U.y),c.push(U)}const k=this.grid.query(g,v,S,C).concat(this.ignoredGrid.query(g,v,S,C)),F={},z={};for(const N of k){const U=N.key;if(void 0===F[U.bucketInstanceId]&&(F[U.bucketInstanceId]={}),F[U.bucketInstanceId][U.featureIndex])continue;const q=[new h.P(N.x1,N.y1),new h.P(N.x2,N.y1),new h.P(N.x2,N.y2),new h.P(N.x1,N.y2)];h.bq(c,q)&&(F[U.bucketInstanceId][U.featureIndex]=!0,void 0===z[U.bucketInstanceId]&&(z[U.bucketInstanceId]=[]),z[U.bucketInstanceId].push(U.featureIndex))}return z}insertCollisionBox(s,c,g,v,S){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:S},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,g,v,S){const C=c?this.ignoredGrid:this.grid,k={bucketInstanceId:g,featureIndex:v,collisionGroupID:S};for(let F=0;F<s.length;F+=4)C.insertCircle(k,s[F],s[F+1],s[F+2])}projectAndGetPerspectiveRatio(s,c,g,v,S,C,k){const F=[c,g,v,1];let z=!1;v||this.transform.pitch>0?(h.a6.vec4.transformMat4(F,F,s),this.fogState&&S&&"globe"!==k.name&&(z=function(q,W,ee,K,re,ie){const ge=ie.calculateFogTileMatrix(re),xe=[W,ee,K];return h.a6.vec3.transformMat4(xe,xe,ge),hn(q,h.a6.vec3.length(xe),ie.pitch,ie._fov)}(this.fogState,c,g,v,S.toUnwrapped(),this.transform)>.9)):wn(F,F,s);const N=F[3];return{point:new h.P((F[0]/N+1)/2*this.transform.width+pl,(-F[1]/N+1)/2*this.transform.height+pl),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/N*.5,1.5),signedDistanceFromCamera:N,occluded:C&&F[2]>N||z}}isOffscreen(s,c,g,v){return g<pl||s>=this.screenRightBoundary||v<pl||c>this.screenBottomBoundary}isInsideGrid(s,c,g,v){return g>=0&&s<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=h.a6.mat4.identity([]);return h.a6.mat4.translate(s,s,[-100,-100,0]),s}}function Ns(m,s,c){const g=s.createTileMatrix(m,m.worldSize,c.toUnwrapped());return h.a6.mat4.multiply(new Float32Array(16),m.projMatrix,g)}function ob(m,s,c){if(s.projection.name===c.projection.name)return m.projMatrix;const g=c.clone();return g.setProjection(s.projection),Ns(g,s.getProjection(),m)}function Mc(m,s,c){return s.name===c.projection.name?m.projMatrix:Ns(c,s,m)}class ns{constructor(s,c,g,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):v&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class xa{constructor(s,c,g,v,S,C=!1){this.text=new ns(s?s.text:null,c,g,S),this.icon=new ns(s?s.icon:null,c,v,S),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fl{constructor(s,c,g,v=!1){this.text=s,this.icon=c,this.skipFade=g,this.clipped=v}}class is{constructor(){this.invProjMatrix=h.a6.mat4.create(),this.viewportMatrix=h.a6.mat4.create(),this.circles=[]}}class Jh{constructor(s,c,g,v,S){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=S}}class ml{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:g=>g.collisionGroupID===c}}return this.collisionGroups[s]}}function Gd(m,s,c,g,v){const{horizontalAlign:S,verticalAlign:C}=h.by(m),k=-(S-.5)*s,F=-(C-.5)*c,z=h.bx(m,g);return new h.P(k+z[0]*v,F+z[1]*v)}function Ei(m,s,c,g,v){const S=new h.P(m,s);return c&&S._rotate(g?v:-v),S}class Ac{constructor(s,c,g,v,S,C){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Nn(this.transform,S),this.buildingIndex=C,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new ml(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,c,g,v,S=1){const C=g.getBucket(c),k=g.latestFeatureIndex;if(!C||!k||c.fqid!==C.layerIds[0])return;const F=C.layers[0].layout,z=C.layers[0].paint,N=g.collisionBoxArray,U=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),q=g.tileSize/h.ab,W=g.tileID.toUnwrapped();this.transform.setProjection(C.projection);const ee=(K=g.tileID,re=C.getProjection(),ie=this.transform,re.name===this.projection?ie.calculateProjMatrix(K.toUnwrapped()):Ns(ie,re,K));var K,re,ie;const ge="map"===F.get("text-pitch-alignment"),xe="map"===F.get("text-rotation-alignment");c.compileFilter(c.options);const ve=c.dynamicFilter(),Ee=c.dynamicFilterNeedsFeature(),Ae=this.transform.calculatePixelsToTileUnitsMatrix(g),Ie=nr(ee,g.tileID.canonical,ge,xe,this.transform,C.getProjection(),Ae);let Re=null;if(ge){const zt=qa(ee,g.tileID.canonical,ge,xe,this.transform,C.getProjection(),Ae);Re=h.a6.mat4.multiply([],this.transform.labelPlaneMatrix,zt)}let Fe=null;ve&&g.latestFeatureIndex&&(Fe={unwrappedTileID:W,dynamicFilter:ve,dynamicFilterNeedsFeature:Ee}),this.retainedQueryData[C.bucketInstanceId]=new Jh(C.bucketInstanceId,k,C.sourceLayerIndex,C.index,g.tileID);const He=C.layers[0].layout.get("text-size-scale-range"),ze=h.ap(S,He[0],He[1]),Ne=C.layers[0].layout.get("icon-size-scale-range"),ut=h.ap(S,Ne[0],Ne[1]),wt={bucket:C,layout:F,paint:z,posMatrix:ee,textLabelPlaneMatrix:Ie,labelToScreenMatrix:Re,clippingData:Fe,scale:U,textPixelRatio:q,holdingForFade:g.holdingForFade(),collisionBoxArray:N,partiallyEvaluatedTextSize:h.bk(C.textSizeData,this.transform.zoom,ze),partiallyEvaluatedIconSize:h.bk(C.iconSizeData,this.transform.zoom,ut),collisionGroup:this.collisionGroups.get(C.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(v)for(const zt of C.sortKeyRanges){const{sortKey:Zt,symbolInstanceStart:sn,symbolInstanceEnd:Ke}=zt;s.push({sortKey:Zt,symbolInstanceStart:sn,symbolInstanceEnd:Ke,parameters:wt})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:wt})}attemptAnchorPlacement(s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K,re,ie,ge){const{textOffset0:xe,textOffset1:ve,crossTileID:Ee}=q,Ae=[xe,ve],Ie=Gd(s,g,v,Ae,S),Re=this.collisionIndex.placeCollisionBox(ee,S,c,Ei(Ie.x,Ie.y,C,k,this.transform.angle),U,F,z,N.predicate);if(re){const Fe=ee.getSymbolInstanceIconSize(ge,this.transform.zoom,q.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ee,Fe,re,Ei(Ie.x,Ie.y,C,k,this.transform.angle),U,F,z,N.predicate).box.length)return}if(Re.box.length>0){let Fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ee]&&this.prevPlacement.placements[Ee]&&this.prevPlacement.placements[Ee].text&&(Fe=this.prevPlacement.variableOffsets[Ee].anchor),this.variableOffsets[Ee]={textOffset:Ae,width:g,height:v,anchor:s,textScale:S,prevAnchor:Fe},this.markUsedJustification(ee,s,q,K),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,K,q),this.placedOrientations[Ee]=K),{shift:Ie,placedGlyphBoxes:Re}}}placeLayerBucketPart(s,c,g,v,S=1){const{bucket:C,layout:k,paint:F,posMatrix:z,textLabelPlaneMatrix:N,labelToScreenMatrix:U,clippingData:q,textPixelRatio:W,holdingForFade:ee,collisionBoxArray:K,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:ie,collisionGroup:ge,latestFeatureIndex:xe}=s.parameters,ve=k.get("text-optional"),Ee=k.get("icon-optional"),Ae=k.get("text-allow-overlap"),Ie=k.get("icon-allow-overlap"),Re="map"===k.get("text-rotation-alignment"),Fe="map"===k.get("text-pitch-alignment"),He=k.get("symbol-z-elevate"),ze=F.get("symbol-z-offset"),Ne="sea"===k.get("symbol-elevation-reference"),ut=k.get("text-size-scale-range"),wt=k.get("icon-size-scale-range"),zt=h.ap(S,ut[0],ut[1]),Zt=h.ap(S,wt[0],wt[1]);this.transform.setProjection(C.projection);let sn=Ae&&(Ie||!C.hasIconData()||Ee),Ke=Ie&&(Ae||!C.hasTextData()||ve);const Pt=!ze.isConstant();!C.collisionArrays&&K&&C.deserializeCollisionBoxes(K),g&&v&&C.updateCollisionDebugBuffers(this.transform.zoom,K,zt,Zt);const bt=(Ot,Ut,Lt)=>{const{crossTileID:un,numVerticalGlyphVertices:Ln}=Ot;let zn=null;if(q&&q.dynamicFilterNeedsFeature||Pt){const vi=this.retainedQueryData[C.bucketInstanceId];zn=xe.loadFeature({featureIndex:Ot.featureIndex,bucketIndex:vi.bucketIndex,sourceLayerIndex:vi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(q&&!(0,q.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},zn,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new h.P(Ot.tileAnchorX,Ot.tileAnchorY),this.transform.calculateDistanceTileData(q.unwrappedTileID)))return this.placements[un]=new fl(!1,!1,!1,!0),void c.add(un);const Sn=ze.evaluate(zn,{});if(c.has(un))return;if(ee)return void(this.placements[un]=new fl(!1,!1,!1));let jn=!1,pn=!1,Yn=!0,Jn=!1,Xi=!1,Br=null,rr={box:null,offscreen:null,occluded:null},Zr={box:null,offscreen:null,occluded:null},ur=null,zr=null,Bi=null,Or=0,Er=0,xr=0;Lt.textFeatureIndex?Or=Lt.textFeatureIndex:Ot.useRuntimeCollisionCircles&&(Or=Ot.featureIndex),Lt.verticalTextFeatureIndex&&(Er=Lt.verticalTextFeatureIndex);const po=vi=>{vi.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const zi=this.transform.elevation;vi.elevation=Ne?Sn:Sn+(zi?zi.getAtTileOffset(vi.tileID,vi.tileAnchorX,vi.tileAnchorY):0),vi.elevation+=Ot.zOffset},Vr=Lt.textBox;if(Vr){po(Vr);const vi=fr=>{let Yr=h.bl.horizontal;if(C.allowVerticalPlacement&&!fr&&this.prevPlacement){const Bo=this.prevPlacement.placedOrientations[un];Bo&&(this.placedOrientations[un]=Bo,Yr=Bo,this.markUsedOrientation(C,Yr,Ot))}return Yr},zi=(fr,Yr)=>{if(C.allowVerticalPlacement&&Ln>0&&Lt.verticalTextBox){for(const Bo of C.writingModes)if(Bo===h.bl.vertical?(rr=Yr(),Zr=rr):rr=fr(),rr&&rr.box&&rr.box.length)break}else rr=fr()};if(k.get("text-variable-anchor")){let fr=k.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[un]){const io=this.prevPlacement.variableOffsets[un];fr.indexOf(io.anchor)>0&&(fr=fr.filter(As=>As!==io.anchor),fr.unshift(io.anchor))}const Yr=(io,As,zl)=>{const Va=C.getSymbolInstanceTextSize(re,Ot,this.transform.zoom,Ut),Ea=(io.x2-io.x1)*Va+2*io.padding,vl=(io.y2-io.y1)*Va+2*io.padding,Vl=Ot.hasIconTextFit&&!Ie?As:null;Vl&&po(Vl);let la={box:[],offscreen:!1,occluded:!1};const jl=Ae?2*fr.length:fr.length;for(let xl=0;xl<jl;++xl){const wr=this.attemptAnchorPlacement(fr[xl%fr.length],io,Ea,vl,Va,Re,Fe,W,z,ge,xl>=fr.length,Ot,Ut,C,zl,Vl,re,ie);if(wr&&(la=wr.placedGlyphBoxes,la&&la.box&&la.box.length)){jn=!0,Br=wr.shift;break}}return la};zi(()=>Yr(Vr,Lt.iconBox,h.bl.horizontal),()=>{const io=Lt.verticalTextBox;return io&&po(io),C.allowVerticalPlacement&&!(rr&&rr.box&&rr.box.length)&&Ln>0&&io?Yr(io,Lt.verticalIconBox,h.bl.vertical):{box:null,offscreen:null,occluded:null}}),rr&&(jn=rr.box,Yn=rr.offscreen,Jn=rr.occluded);const Bo=vi(!(!rr||!rr.box));if(!jn&&this.prevPlacement){const io=this.prevPlacement.variableOffsets[un];io&&(this.variableOffsets[un]=io,this.markUsedJustification(C,io.anchor,Ot,Bo))}}else{const fr=(Yr,Bo)=>{const io=C.getSymbolInstanceTextSize(re,Ot,this.transform.zoom,Ut,S),As=this.collisionIndex.placeCollisionBox(C,io,Yr,new h.P(0,0),Ae,W,z,ge.predicate);return As&&As.box&&As.box.length&&(this.markUsedOrientation(C,Bo,Ot),this.placedOrientations[un]=Bo),As};zi(()=>fr(Vr,h.bl.horizontal),()=>{const Yr=Lt.verticalTextBox;return C.allowVerticalPlacement&&Ln>0&&Yr?(po(Yr),fr(Yr,h.bl.vertical)):{box:null,offscreen:null,occluded:null}}),vi(!!(rr&&rr.box&&rr.box.length))}}if(ur=rr,jn=ur&&ur.box&&ur.box.length>0,Yn=ur&&ur.offscreen,Jn=ur&&ur.occluded,Ot.useRuntimeCollisionCircles){const vi=C.text.placedSymbolArray.get(Ot.centerJustifiedTextSymbolIndex>=0?Ot.centerJustifiedTextSymbolIndex:Ot.verticalPlacedTextSymbolIndex),zi=h.bm(C.textSizeData,re,vi),fr=k.get("text-padding");zr=this.collisionIndex.placeCollisionCircles(C,Ae,vi,C.lineVertexArray,C.glyphOffsetArray,zi,z,N,U,g,Fe,ge.predicate,Ot.collisionCircleDiameter*zi/h.br,fr,this.retainedQueryData[C.bucketInstanceId].tileID),jn=Ae||zr.circles.length>0&&!zr.collisionDetected,Yn=Yn&&zr.offscreen,Jn=zr.occluded}if(Lt.iconFeatureIndex&&(xr=Lt.iconFeatureIndex),Lt.iconBox){const vi=zi=>{po(zi);const fr=Ot.hasIconTextFit&&Br?Ei(Br.x,Br.y,Re,Fe,this.transform.angle):new h.P(0,0),Yr=C.getSymbolInstanceIconSize(ie,this.transform.zoom,Ot.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,Yr,zi,fr,Ie,W,z,ge.predicate)};Zr&&Zr.box&&Zr.box.length&&Lt.verticalIconBox?(Bi=vi(Lt.verticalIconBox),pn=Bi.box.length>0):(Bi=vi(Lt.iconBox),pn=Bi.box.length>0),Yn=Yn&&Bi.offscreen,Xi=Bi.occluded}const Da=ve||0===Ot.numHorizontalGlyphVertices&&0===Ln,Ka=Ee||0===Ot.numIconVertices;if(Da||Ka?Ka?Da||(pn=pn&&jn):jn=pn&&jn:pn=jn=pn&&jn,jn&&ur&&ur.box&&this.collisionIndex.insertCollisionBox(ur.box,k.get("text-ignore-placement"),C.bucketInstanceId,Zr&&Zr.box&&Er?Er:Or,ge.ID),pn&&Bi&&this.collisionIndex.insertCollisionBox(Bi.box,k.get("icon-ignore-placement"),C.bucketInstanceId,xr,ge.ID),zr&&(jn&&this.collisionIndex.insertCollisionCircles(zr.circles,k.get("text-ignore-placement"),C.bucketInstanceId,Or,ge.ID),g)){const vi=C.bucketInstanceId;let zi=this.collisionCircleArrays[vi];void 0===zi&&(zi=this.collisionCircleArrays[vi]=new is);for(let fr=0;fr<zr.circles.length;fr+=4)zi.circles.push(zr.circles[fr+0]),zi.circles.push(zr.circles[fr+1]),zi.circles.push(zr.circles[fr+2]),zi.circles.push(zr.collisionDetected?1:0)}const ss="globe"!==C.projection.name;sn=sn&&(ss||!Jn),Ke=Ke&&(ss||!Xi),this.placements[un]=new fl(jn||sn,pn||Ke,Yn||C.justReloaded),c.add(un)};if(He&&this.buildingIndex&&(this.buildingIndex.updateZOffset(C,this.retainedQueryData[C.bucketInstanceId].tileID),C.updateZOffset()),C.sortFeaturesByY){const Ot=C.getSortedSymbolIndexes(this.transform.angle);for(let Ut=Ot.length-1;Ut>=0;--Ut){const Lt=Ot[Ut];bt(C.symbolInstances.get(Lt),Lt,C.collisionArrays[Lt])}C.hasAnyZOffset&&h.w(`${C.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(C.hasAnyZOffset){const Ot=C.getSortedIndexesByZOffset();for(let Ut=0;Ut<Ot.length;++Ut){const Lt=Ot[Ut];bt(C.symbolInstances.get(Lt),Lt,C.collisionArrays[Lt])}}else for(let Ot=s.symbolInstanceStart;Ot<s.symbolInstanceEnd;Ot++)bt(C.symbolInstances.get(Ot),Ot,C.collisionArrays[Ot]);if(g&&C.bucketInstanceId in this.collisionCircleArrays){const Ot=this.collisionCircleArrays[C.bucketInstanceId];h.a6.mat4.invert(Ot.invProjMatrix,z),Ot.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(s,c,g,v){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:F,crossTileID:z}=g,N=h.bw(c),U=v===h.bl.vertical?F:"left"===N?S:"center"===N?C:"right"===N?k:-1;S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=U>=0&&S!==U?0:z),C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:z),k>=0&&(s.text.placedSymbolArray.get(k).crossTileID=U>=0&&k!==U?0:z),F>=0&&(s.text.placedSymbolArray.get(F).crossTileID=U>=0&&F!==U?0:z)}markUsedOrientation(s,c,g){const v=c===h.bl.horizontal||c===h.bl.horizontalOnly?c:0,S=c===h.bl.vertical?c:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:z}=g,N=s.text.placedSymbolArray;C>=0&&(N.get(C).placedOrientation=v),k>=0&&(N.get(k).placedOrientation=v),F>=0&&(N.get(F).placedOrientation=v),z>=0&&(N.get(z).placedOrientation=S)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let g=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const v=c?c.symbolFadeChange(s):1,S=c?c.opacities:{},C=c?c.variableOffsets:{},k=c?c.placedOrientations:{};for(const F in this.placements){const z=this.placements[F],N=S[F];N?(this.opacities[F]=new xa(N,v,z.text,z.icon,null,z.clipped),g=g||z.text!==N.text.placed||z.icon!==N.icon.placed):(this.opacities[F]=new xa(null,v,z.text,z.icon,z.skipFade,z.clipped),g=g||z.text||z.icon)}for(const F in S){const z=S[F];if(!this.opacities[F]){const N=new xa(z,v,!1,!1);N.isHidden()||(this.opacities[F]=N,g=g||z.text.placed||z.icon.placed)}}for(const F in C)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=C[F]);for(const F in k)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=k[F]);g?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c,g,v){const S=new Set;for(const C of c){const k=C.getBucket(s);k&&C.latestFeatureIndex&&s.fqid===k.layerIds[0]&&(this.updateBucketOpacities(k,S,C,C.collisionBoxArray,g,v,C.tileID,s.scope),k.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(k,C.tileID),k.updateZOffset()))}}updateBucketOpacities(s,c,g,v,S,C,k,F){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const z=s.layers[0].layout,N=s.layers[0].paint,U=!!s.layers[0].dynamicFilter(),q=new xa(null,0,!1,!1,!0),W=z.get("text-allow-overlap"),ee=z.get("icon-allow-overlap"),K=z.get("text-variable-anchor"),re="map"===z.get("text-rotation-alignment"),ie="map"===z.get("text-pitch-alignment"),ge=N.get("symbol-z-offset"),xe="sea"===z.get("symbol-elevation-reference"),ve=!ge.isConstant(),Ee=new xa(null,0,W&&(ee||!s.hasIconData()||z.get("icon-optional")),ee&&(W||!s.hasTextData()||z.get("text-optional")),!0);!s.collisionArrays&&v&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(v);const Ae=(Re,Fe,He)=>{for(let ze=0;ze<Fe/4;ze++)Re.opacityVertexArray.emplaceBack(He)};let Ie=0;C&&s.updateReplacement(k,C);for(let Re=0;Re<s.symbolInstances.length;Re++){const Fe=s.symbolInstances.get(Re),{numHorizontalGlyphVertices:He,numVerticalGlyphVertices:ze,crossTileID:Ne,numIconVertices:ut,tileAnchorX:wt,tileAnchorY:zt}=Fe;let Zt=null;const sn=this.retainedQueryData[s.bucketInstanceId];ve&&Fe&&sn&&(Zt=g.latestFeatureIndex.loadFeature({featureIndex:Fe.featureIndex,bucketIndex:sn.bucketIndex,sourceLayerIndex:sn.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ke=ge.evaluate(Zt,{}),Pt=c.has(Ne);let bt=this.opacities[Ne];Pt?bt=q:bt||(bt=Ee,this.opacities[Ne]=bt),c.add(Ne);const Ot=He>0||ze>0,Ut=ut>0,Lt=this.placedOrientations[Ne],un=Lt===h.bl.vertical,Ln=Lt===h.bl.horizontal||Lt===h.bl.horizontalOnly;!Ot&&!Ut||bt.isHidden()||Ie++;let zn=!1;if((Ot||Ut)&&C)for(const Sn of s.activeReplacements){if(h.bs(Sn,S,h.bt.Symbol,F)||Sn.min.x>wt||wt>Sn.max.x||Sn.min.y>zt||zt>Sn.max.y)continue;const jn=h.bu(wt,zt,k.canonical,Sn.footprintTileId.canonical);if(zn=h.bv(jn,Sn.footprint),zn)break}if(Ot){const Sn=zn?vo:oa(bt.text);Ae(s.text,He,un?vo:Sn),Ae(s.text,ze,Ln?vo:Sn);const jn=bt.text.isHidden(),{leftJustifiedTextSymbolIndex:pn,centerJustifiedTextSymbolIndex:Yn,rightJustifiedTextSymbolIndex:Jn,verticalPlacedTextSymbolIndex:Xi}=Fe,Br=s.text.placedSymbolArray,rr=jn||un?1:0;pn>=0&&(Br.get(pn).hidden=rr),Yn>=0&&(Br.get(Yn).hidden=rr),Jn>=0&&(Br.get(Jn).hidden=rr),Xi>=0&&(Br.get(Xi).hidden=jn||Ln?1:0);const Zr=this.variableOffsets[Ne];Zr&&this.markUsedJustification(s,Zr.anchor,Fe,Lt);const ur=this.placedOrientations[Ne];ur&&(this.markUsedJustification(s,"left",Fe,ur),this.markUsedOrientation(s,ur,Fe))}if(Ut){const Sn=zn?vo:oa(bt.icon),{placedIconSymbolIndex:jn,verticalPlacedIconSymbolIndex:pn}=Fe,Yn=s.icon.placedSymbolArray,Jn=bt.icon.isHidden()?1:0;jn>=0&&(Ae(s.icon,ut,un?vo:Sn),Yn.get(jn).hidden=Jn),pn>=0&&(Ae(s.icon,Fe.numVerticalIconVertices,Ln?vo:Sn),Yn.get(pn).hidden=Jn)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Sn=s.collisionArrays[Re];if(Sn){let jn=new h.P(0,0),pn=!0;if(Sn.textBox||Sn.verticalTextBox){if(K){const Jn=this.variableOffsets[Ne];Jn?(jn=Gd(Jn.anchor,Jn.width,Jn.height,Jn.textOffset,Jn.textScale),re&&jn._rotate(ie?this.transform.angle:-this.transform.angle)):pn=!1}U&&(pn=!bt.clipped),Sn.textBox&&If(s.textCollisionBox.collisionVertexArray,bt.text.placed,!pn||un,Ke,xe,jn.x,jn.y),Sn.verticalTextBox&&If(s.textCollisionBox.collisionVertexArray,bt.text.placed,!pn||Ln,Ke,xe,jn.x,jn.y)}const Yn=pn&&Boolean(!Ln&&Sn.verticalIconBox);Sn.iconBox&&If(s.iconCollisionBox.collisionVertexArray,bt.icon.placed,Yn,Ke,xe,Fe.hasIconTextFit?jn.x:0,Fe.hasIconTextFit?jn.y:0),Sn.verticalIconBox&&If(s.iconCollisionBox.collisionVertexArray,bt.icon.placed,!Yn,Ke,xe,Fe.hasIconTextFit?jn.x:0,Fe.hasIconTextFit?jn.y:0)}}}if(s.fullyClipped=0===Ie,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Re.invProjMatrix,s.placementViewportMatrix=Re.viewportMatrix,s.collisionCircleArray=Re.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const g=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function If(m,s,c,g,v,S,C){m.emplaceBack(s?1:0,c?1:0,S||0,C||0,g,v?1:0),m.emplaceBack(s?1:0,c?1:0,S||0,C||0,g,v?1:0),m.emplaceBack(s?1:0,c?1:0,S||0,C||0,g,v?1:0),m.emplaceBack(s?1:0,c?1:0,S||0,C||0,g,v?1:0)}const Ts=Math.pow(2,25),sb=Math.pow(2,24),Rv=Math.pow(2,17),bs=Math.pow(2,16),kl=Math.pow(2,9),sg=Math.pow(2,8),Pv=Math.pow(2,1);function oa(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const s=m.placed?1:0,c=Math.floor(127*m.opacity);return c*Ts+s*sb+c*Rv+s*bs+c*kl+s*sg+c*Pv+s}const vo=0;class Z1{constructor(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&void 0!==s.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,c,g,v,S,C){const k=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(k,v,s[this._currentTileIndex],this._sortAcrossTiles,C),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,k.sort((F,z)=>F.sortKey-z.sortKey));this._currentPartIndex<k.length;){const F=k[this._currentPartIndex];if(c.placeLayerBucketPart(F,this._seenCrossTileIDs,g,0===F.symbolInstanceStart,C),this._currentPartIndex++,S())return!0}return!1}}class Mf{constructor(s,c,g,v,S,C,k,F,z){this.placement=new Ac(s,S,C,k,F,z),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,c,g,v,S){const C=h.q.now(),k=()=>{const F=h.q.now()-C;return!this._forceFullPlacement&&F>2};for(;this._currentPlacementIndex>=0;){const F=c[s[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if("symbol"===F.type&&(!F.minzoom||F.minzoom<=z)&&(!F.maxzoom||F.maxzoom>z)){const N=F,U=N.layout.get("symbol-z-elevate"),q=void 0!==N.layout.get("symbol-sort-key").constantOr(1),W=N.layout.get("symbol-z-order"),ee="viewport-y"===W||"auto"===W&&!("viewport-y"!==W&&q),K=N.layout.get("text-allow-overlap")||N.layout.get("icon-allow-overlap")||N.layout.get("text-ignore-placement")||N.layout.get("icon-ignore-placement"),re=ee&&K,ie=this._inProgressLayer=this._inProgressLayer||new Z1(N),ge=h.av(F.source,F.scope);if(ie.continuePlacement(U||re?v[ge]:g[ge],this.placement,this._showCollisionBoxes,F,k,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const gl=512/h.ab/2;class xo{constructor(s,c,g){this.tileID=s,this.bucketInstanceId=g,this.index=new h.bz(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=s.canonical.x*h.ab,S=s.canonical.y*h.ab;for(let C=0;C<c.length;C++){const{key:k,crossTileID:F,tileAnchorX:z,tileAnchorY:N}=c.get(C),U=Math.floor((v+z)*gl),q=Math.floor((S+N)*gl);this.index.add(U,q),this.keys.push(k),this.crossTileIDs.push(F)}this.index.finish()}findMatches(s,c,g){const v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),S=gl/Math.pow(2,c.canonical.z-this.tileID.canonical.z),C=c.canonical.x*h.ab,k=c.canonical.y*h.ab;for(let F=0;F<s.length;F++){const z=s.get(F);if(z.crossTileID)continue;const{key:N,tileAnchorX:U,tileAnchorY:q}=z,W=Math.floor((C+U)*S),ee=Math.floor((k+q)*S),K=this.index.range(W-v,ee-v,W+v,ee+v);for(const re of K){const ie=this.crossTileIDs[re];if(this.keys[re]===N&&!g.has(ie)){g.add(ie),z.crossTileID=ie;break}}}}}class Rc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Af{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(0!==c)for(const g in this.indexes){const v=this.indexes[g],S={};for(const C in v){const k=v[C];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+c),S[k.tileID.key]=k}this.indexes[g]=S}this.lng=s}addBucket(s,c,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let S=0;S<c.symbolInstances.length;S++)c.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const v=this.usedCrossTileIDs[s.overscaledZ];for(const S in this.indexes){const C=this.indexes[S];if(Number(S)>s.overscaledZ)for(const k in C){const F=C[k];F.tileID.isChildOf(s)&&F.findMatches(c.symbolInstances,s,v)}else{const k=C[s.scaledTo(Number(S)).key];k&&k.findMatches(c.symbolInstances,s,v)}}for(let S=0;S<c.symbolInstances.length;S++){const C=c.symbolInstances.get(S);C.crossTileID||(C.crossTileID=g.generate(),v.add(C.crossTileID))}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new xo(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const g of c.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let c=!1;for(const g in this.indexes){const v=this.indexes[g];for(const S in v)s[v[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[S]),delete v[S],c=!0)}return c}}class $d{constructor(){this.layerIndexes={},this.crossTileIDs=new Rc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,g,v){let S=this.layerIndexes[s.fqid];void 0===S&&(S=this.layerIndexes[s.fqid]=new Af);let C=!1;const k={};"globe"!==v.name&&S.handleWrapJump(g);for(const F of c){const z=F.getBucket(s);z&&s.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(F.tileID,z,this.crossTileIDs)&&(C=!0),k[z.bucketInstanceId]=!0)}return S.removeStaleBuckets(k)&&(C=!0),C}pruneUnusedLayers(s){const c={};s.forEach(g=>{c[g]=!0});for(const g in this.layerIndexes)c[g]||delete this.layerIndexes[g]}}class Si{constructor(s,c,g,v){this.blendFunction=s,this.blendColor=c,this.mask=g,this.blendEquation=v}}Si.Replace=[1,0,1,0],Si.disabled=new Si(Si.Replace,h.bA.transparent,[!1,!1,!1,!1]),Si.unblended=new Si(Si.Replace,h.bA.transparent,[!0,!0,!0,!0]),Si.alphaBlended=new Si([1,771,1,771],h.bA.transparent,[!0,!0,!0,!0]),Si.alphaBlendedNonPremultiplied=new Si([770,771,770,771],h.bA.transparent,[!0,!0,!0,!0]),Si.multiply=new Si([774,0,774,0],h.bA.transparent,[!0,!0,!0,!0]);class Vn{constructor(s,c,g){this.func=s,this.mask=c,this.range=g}}Vn.ReadOnly=!1,Vn.ReadWrite=!0,Vn.disabled=new Vn(519,Vn.ReadOnly,[0,1]);class Jt{constructor(s,c,g,v,S,C){this.test=s,this.ref=c,this.mask=g,this.fail=v,this.depthFail=S,this.pass=C}}Jt.disabled=new Jt({func:519,mask:0},0,0,7680,7680,7680);class li{constructor(s,c,g){this.enable=s,this.mode=c,this.frontFace=g}}function ii(m,s){const c=h.bD(m,3);h.a6.mat4.fromQuat(m,s),h.bF(m,3,c)}function Rf(m,s){const c=h.a6.quat.identity([]);return h.a6.quat.rotateZ(c,c,-s),h.a6.quat.rotateX(c,c,-m),c}function Pf(m,s){const c=[m[0],m[1],0],g=[s[0],s[1],0];if(h.a6.vec3.length(c)>=1e-15){const C=h.a6.vec3.normalize([],c);h.a6.vec3.scale(g,C,h.a6.vec3.dot(g,C)),s[0]=g[0],s[1]=g[1]}const v=h.a6.vec3.cross([],s,m);if(h.a6.vec3.len(v)<1e-15)return null;const S=Math.atan2(-v[1],v[0]);return Rf(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),S)}li.disabled=new li(!1,1029,2305),li.backCCW=new li(!0,1029,2305),li.backCW=new li(!0,1029,2304),li.frontCW=new li(!0,1028,2304),li.frontCCW=new li(!0,1028,2305);class cn{constructor(s,c){this.position=s,this.orientation=c}get position(){return this._position}set position(s){if(s){const c=s instanceof h.a5?s:new h.a5(s[0],s[1],s[2]);this._renderWorldCopies&&(c.x=h.bB(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(s,c){if(this.orientation=null,!this.position)return;const g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(h.a5.fromLngLat(s)):0,S=h.a5.fromLngLat(s,v),C=[S.x-g.x,S.y-g.y,S.z-g.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Pf(C,c)}setPitchBearing(s,c){this.orientation=Rf(h.bC(s),h.bC(-c))}}class Cs{constructor(s,c){this._transform=h.a6.mat4.identity([]),this.orientation=c,this.position=s}get mercatorPosition(){const s=this.position;return new h.a5(s[0],s[1],s[2])}get position(){const s=h.bD(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var c;s&&h.bF(this._transform,3,[(c=s)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||h.a6.quat.identity([]),s&&ii(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,c){this._orientation=Rf(s,c),ii(this._transform,this._orientation)}forward(){const s=h.bD(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=h.bD(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=h.bD(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,c){const g=new Float64Array(16);return h.a6.mat4.invert(g,this.getWorldToCamera(s,c)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,c,g){const v=this.position;h.a6.vec3.scale(v,v,-s);const S=new Float64Array(16);return h.a6.mat4.fromScaling(S,[g,g,g]),h.a6.mat4.translate(S,S,v),S[10]*=c,S}getWorldToCamera(s,c){const g=new Float64Array(16),v=new Float64Array(4),S=this.position;return h.a6.quat.conjugate(v,this._orientation),h.a6.vec3.scale(S,S,-s),h.a6.mat4.fromQuat(g,v),h.a6.mat4.translate(g,g,S),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=c,g[9]*=c,g[10]*=c,g[11]*=c,g}getCameraToClipPerspective(s,c,g,v){const S=new Float64Array(16);return h.a6.mat4.perspective(S,s,c,g,v),S}getCameraToClipOrthographic(s,c,g,v,S,C){const k=new Float64Array(16);return h.a6.mat4.ortho(k,s,c,g,v,S,C),k}getDistanceToElevation(s,c=!1){const g=0===s?0:h.bE(s,c?h.aN(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new Cs([...this.position],[...this.orientation])}}const ir_BaseColor=5,ir_MetallicRoughness=6,ir_Normal=7,ir_Occlusion=8,ir_Emission=9,ir_LUT=10,ir_ShadowMap0=11;class Bs{constructor(s=0,c=0,g=0,v=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=g,this.right=v}interpolate(s,c,g){return null!=c.top&&null!=s.top&&(this.top=h.aa(s.top,c.top,g)),null!=c.bottom&&null!=s.bottom&&(this.bottom=h.aa(s.bottom,c.bottom,g)),null!=c.left&&null!=s.left&&(this.left=h.aa(s.left,c.left,g)),null!=c.right&&null!=s.right&&(this.right=h.aa(s.right,c.right,g)),this}getCenter(s,c){const g=h.ap((this.left+s-this.right)/2,0,s),v=h.ap((this.top+c-this.bottom)/2,0,c);return new h.P(g,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Bs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ds=(m,s,c)=>(1-c)*m+c*s,Ll=m=>m*m*m*m*m;class sa{constructor(s,c,g,v,S,C,k){this.tileSize=512,this._renderWorldCopies=void 0===S||S,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=null!=g?g:0,this._maxPitch=null!=v?v:60,this.setProjection(C),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new h.bL(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Bs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Cs,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const s=new sa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(s,c=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return h.ar(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=h.bM(this.projectionOptions);const g=this.getProjection(),v=!h.bi(c,g);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=h.bM({name:"mercator"});const c=s!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return h.bE(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return h.bB(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const c=-s*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=h.a6.mat2.create(),h.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=h.ap(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=h.bC(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,S=0;for(let C=0;C<c.length;C++){const k=new h.P(c[C][0]*this.width,g+c[C][1]*(this.height-g)),F=s.pointCoordinate(k);if(!F)continue;const z=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);v+=F[3]*z,S+=z}return 0===S?NaN:v/S}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const s=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(s),S=this._mercatorZfromZoom(this._maxZoom),C=Math.max(v-g,S);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let g;g=s.z<this._camera.position[2]?[c.x,c.y,c.z]:[s.x,s.y,s.z];const v=h.a6.vec3.length(h.a6.vec3.sub([],this._camera.position,g));return h.ap(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let c=!1;if(s.orientation&&!h.a6.quat.exactEquals(s.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(s.orientation)),s.position){const g=[s.position.x,s.position.y,s.position.z];h.a6.vec3.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,c=new cn;return c.position=new h.a5(s[0],s[1],s[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(s){if(!h.a6.quat.length(s))return!1;h.a6.quat.normalize(s,s);const c=h.a6.vec3.transformQuat([],[0,0,-1],s),g=h.a6.vec3.transformQuat([],[0,-1,0],s);if(g[2]<0)return!1;const v=Pf(c,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){const c=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=h.ap(s[2],v/g,v/c),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,g){this._unmodified=!1,this._edgeInsets.interpolate(s,c,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new h.bN(0,s)];if(this.renderWorldCopies){const g=this.pointCoordinate(new h.P(0,0)),v=this.pointCoordinate(new h.P(this.width,0)),S=this.pointCoordinate(new h.P(this.width,this.height)),C=this.pointCoordinate(new h.P(0,this.height)),k=Math.floor(Math.min(g.x,v.x,S.x,C.x)),F=Math.floor(Math.max(g.x,v.x,S.x,C.x)),z=1;for(let N=k-z;N<=F+z;N++)0!==N&&c.push(new h.bN(N,s))}return c}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,c,g){let v=[];const S=void 0!==g,C=!S;if(C&&this.zoom<c||S&&0===g[0]&&0===g[1])return v;const k=new Set,F=(N,U,q,W,ee)=>{const K=h.c2(U,N,q,W,ee);k.has(K)||(v.push(new h.aA(N,U,q,W,ee)),k.add(K))};for(let N=0;N<s.length;N++){const U=s[N];if(C&&U.canonical.z!==c)continue;const q=U.canonical,W=U.overscaledZ,ee=U.wrap,K=1<<q.z,re=q.x+1<K,ie=q.x>0,ge=q.y+1<K,xe=q.y>0,ve=U.wrap-(ie?0:1),Ee=U.wrap+(re?0:1),Ae=ie?q.x-1:K-1,Ie=re?q.x+1:0;if(S)g[0]<0?(F(W,Ee,q.z,Ie,q.y),g[1]<0&&ge&&(F(W,ee,q.z,q.x,q.y+1),F(W,Ee,q.z,Ie,q.y+1)),g[1]>0&&xe&&(F(W,ee,q.z,q.x,q.y-1),F(W,Ee,q.z,Ie,q.y-1))):g[0]>0?(F(W,ve,q.z,Ae,q.y),g[1]<0&&ge&&(F(W,ee,q.z,q.x,q.y+1),F(W,ve,q.z,Ae,q.y+1)),g[1]>0&&xe&&(F(W,ee,q.z,q.x,q.y-1),F(W,ve,q.z,Ae,q.y-1))):g[1]<0&&ge?F(W,ee,q.z,q.x,q.y+1):xe&&F(W,ee,q.z,q.x,q.y-1);else{const Re=U.visibleQuadrants;1&Re&&(F(W,ve,q.z,Ae,q.y),xe&&(F(W,ee,q.z,q.x,q.y-1),F(W,ve,q.z,Ae,q.y-1))),2&Re&&(F(W,Ee,q.z,Ie,q.y),xe&&(F(W,ee,q.z,q.x,q.y-1),F(W,Ee,q.z,Ie,q.y-1))),4&Re&&(F(W,ve,q.z,Ae,q.y),ge&&(F(W,ee,q.z,q.x,q.y+1),F(W,ve,q.z,Ae,q.y+1))),8&Re&&(F(W,Ee,q.z,Ie,q.y),ge&&(F(W,ee,q.z,q.x,q.y+1),F(W,Ee,q.z,Ie,q.y+1)))}}const z=[];for(const N of v)v.some(U=>N.isChildOf(U))||z.push(N);if(v=z.filter(N=>!s.some(U=>!!(N.overscaledZ<c&&U.isChildOf(N))||N.equals(U)||N.isChildOf(U))),C){const N=1<<c,U="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=[N*U.x,N*U.y],W=4,ee=W*W;v=v.filter(K=>{const re=K.canonical.x+.5-q[0],ie=K.canonical.y+.5-q[1];return re*re+ie*ie<ee})}return v}coveringTiles(s){let c=this.coveringZoomLevel(s);const g=c,v=this.elevation&&this.elevation.exaggeration(),S=v&&!s.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==s.minzoom&&c<s.minzoom)return[];void 0!==s.maxzoom&&c>s.maxzoom&&(c=s.maxzoom);const k=this.locationCoordinate(this.center),F=this.center.lat,z=1<<c,N=[z*k.x,z*k.y,0],U="globe"===this.projection.name,q=!U,W=h.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,q),ee=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=z*h.bE(1,this.center.lat),re=this._camera.position[2]/h.bE(1,this.center.lat),ie=[z*ee.x,z*ee.y,re*(q?1:K)],ge=U||v,xe=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ve=this.isLODDisabled(!0)?c:0;let Ee;if(this._elevation&&s.isTerrainDEM)Ee=1e4*this._elevation.exaggeration();else if(this._elevation){const Ke=this._elevation.getMinMaxForVisibleTiles();Ee=Ke?Ke.max:this._centerAltitude}else Ee=this._centerAltitude;const Ae=s.isTerrainDEM?-Ee:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ie=this.projection.isReprojectedInTileSpace?h.bP(this):1,Re=Ke=>{const bt=new h.a5(Ke.x+25e-6,Ke.y,Ke.z),Ot=new h.a5(Ke.x,Ke.y+25e-6,Ke.z),Ut=Ke.toLngLat(),Lt=bt.toLngLat(),un=Ot.toLngLat(),Ln=this.locationCoordinate(Ut),zn=this.locationCoordinate(Lt),Sn=this.locationCoordinate(un),jn=Math.hypot(zn.x-Ln.x,zn.y-Ln.y),pn=Math.hypot(Sn.x-Ln.x,Sn.y-Ln.y);return Math.sqrt(jn*pn)*Ie/25e-6},Fe=Ke=>{const Pt=Ee,bt=Ae;return{aabb:h.bS(this,z,0,0,0,Ke,bt,Pt,this.projection),zoom:0,x:0,y:0,minZ:bt,maxZ:Pt,wrap:Ke,fullyVisible:!1}},He=[];let ze=[];const Ne=c,ut=s.reparseOverscaled?g:c,wt=(re-this._centerAltitude)*K,zt=Ke=>{if(!this._elevation||!Ke.tileID||!C)return;const Pt=this._elevation.getMinMaxForTile(Ke.tileID),bt=Ke.aabb;Pt?(bt.min[2]=Pt.min,bt.max[2]=Pt.max,bt.center[2]=(bt.min[2]+bt.max[2])/2):(Ke.shouldSplit=sn(Ke),Ke.shouldSplit||(bt.min[2]=bt.max[2]=bt.center[2]=this._centerAltitude))},Zt=(Ke,Pt)=>{if(.707*Pt<Ke)return 1;const bt=Pt/Ke;return bt/(1.4144271570014144+(Math.pow(1.1,bt-1.4144271570014144+1)-1)/(1.1-1)-1)},sn=Ke=>{if(Ke.zoom<ve)return!0;if(Ke.zoom===Ne)return!1;if(null!=Ke.shouldSplit)return Ke.shouldSplit;const Pt=Ke.aabb.distanceX(ie),bt=Ke.aabb.distanceY(ie);let Ot=wt,Ut=1;if(U){Ot=Ke.aabb.distanceZ(ie);const pn=Math.pow(2,Ke.zoom),Yn=h.aN((Ke.y+1)/pn),Jn=h.aN(Ke.y/pn),Xi=Math.min(Math.max(F,Yn),Jn),Br=h.c6(Xi)/h.c6(F);if(Ut=Xi===F?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Br/this._mercatorScaleRatio),this.zoom<=h.c3&&Ke.zoom===Ne-1&&Br>=.9)return!0}else if(S&&(Ot=Ke.aabb.distanceZ(ie)*K),this.projection.isReprojectedInTileSpace&&g<=5){const pn=Math.pow(2,Ke.zoom),Yn=Re(new h.a5((Ke.x+.5)/pn,(Ke.y+.5)/pn));Ut=Yn>.85?1:Yn}if(!C){const pn=Math.sqrt(Pt*Pt+bt*bt+Ot*Ot);let Yn=(1<<Ne-Ke.zoom)*xe*Ut;return Yn*=Zt(Math.max(Ot,wt),pn),pn<Yn}let Lt=Number.MAX_VALUE,un=0;const Ln=Ke.aabb.getCorners(),zn=[];for(const pn of Ln){h.a6.vec3.sub(zn,pn,ie),U||(S?zn[2]*=K:zn[2]=wt);const Yn=h.a6.vec3.dot(zn,this._camera.forward());Yn<Lt&&(Lt=Yn,un=Math.abs(zn[2]))}let Sn=(1<<Ne-Ke.zoom)*xe*Ut;if(Sn*=Zt(Math.max(un,wt),Lt),Lt<Sn)return!0;const jn=Ke.aabb.closestPoint(N);return jn[0]===N[0]&&jn[1]===N[1]};if(this.renderWorldCopies)for(let Ke=1;Ke<=3;Ke++)He.push(Fe(-Ke)),He.push(Fe(Ke));for(He.push(Fe(0));He.length>0;){const Ke=He.pop(),Pt=Ke.x,bt=Ke.y;let Ot=Ke.fullyVisible;const Ut=()=>"globe"===this.projection.name&&(0===Ke.y||Ke.y===(1<<Ke.zoom)-1);if(!Ot){let Lt=ge?Ke.aabb.intersects(W):Ke.aabb.intersectsFlat(W);if(0===Lt&&Ut()){const un=new h.bQ(Ke.zoom,Pt,bt);Lt=h.bR(this,z,un,!0).intersects(W)}if(0===Lt)continue;Ot=2===Lt}if(Ke.zoom!==Ne&&sn(Ke))for(let Lt=0;Lt<4;Lt++){const un=(Pt<<1)+Lt%2,Ln=(bt<<1)+(Lt>>1),zn={aabb:C?Ke.aabb.quadrant(Lt):h.bS(this,z,Ke.zoom+1,un,Ln,Ke.wrap,Ke.minZ,Ke.maxZ,this.projection),zoom:Ke.zoom+1,x:un,y:Ln,wrap:Ke.wrap,fullyVisible:Ot,tileID:void 0,shouldSplit:void 0,minZ:Ke.minZ,maxZ:Ke.maxZ};S&&!U&&(zn.tileID=new h.aA(Ke.zoom+1===Ne?ut:Ke.zoom+1,Ke.wrap,Ke.zoom+1,un,Ln),zt(zn)),He.push(zn)}else{const Lt=Ke.zoom===Ne?ut:Ke.zoom;if(s.minzoom&&s.minzoom>Lt)continue;let un=0;if(!Ot){let jn=ge?Ke.aabb.intersectsPrecise(W):Ke.aabb.intersectsPreciseFlat(W);if(0===jn&&Ut()){const pn=new h.bQ(Ke.zoom,Pt,bt);jn=h.bR(this,z,pn,!0).intersectsPrecise(W)}if(0===jn)continue;if(s.calculateQuadrantVisibility)if(W.containsPoint(Ke.aabb.center))un=15;else for(let pn=0;pn<4;pn++)0!==Ke.aabb.quadrant(pn).intersects(W)&&(un|=1<<pn)}const Ln=N[0]-(.5+Pt+(Ke.wrap<<Ke.zoom))*(1<<c-Ke.zoom),zn=N[1]-.5-bt,Sn=Ke.tileID?Ke.tileID:new h.aA(Lt,Ke.wrap,Ke.zoom,Pt,bt);s.calculateQuadrantVisibility&&(Sn.visibleQuadrants=un),ze.push({tileID:Sn,distanceSq:Ln*Ln+zn*zn})}}if(this.fogCullDistSq){const Ke=this.fogCullDistSq,Pt=this.horizonLineFromTop();ze=ze.filter(bt=>{const Ot=[0,0,0,1],Ut=[h.ab,h.ab,0,1],Lt=this.calculateFogTileMatrix(bt.tileID.toUnwrapped());h.a6.vec4.transformMat4(Ot,Ot,Lt),h.a6.vec4.transformMat4(Ut,Ut,Lt);const un=h.a6.vec4.min([],Ot,Ut),Ln=h.a6.vec4.max([],Ot,Ut),zn=h.bT(un,Ln);if(0===zn)return!0;let Sn=!1;const jn=this._elevation;if(jn&&zn>Ke&&0!==Pt){const pn=this.calculateProjMatrix(bt.tileID.toUnwrapped());let Yn;s.isTerrainDEM||(Yn=jn.getMinMaxForTile(bt.tileID)),Yn||(Yn={min:Ae,max:Ee});const Jn=h.c4(this.rotation),Xi=[Jn[0]*h.ab,Jn[1]*h.ab,Yn.max];h.a6.vec3.transformMat4(Xi,Xi,pn),Sn=(1-Xi[1])*this.height*.5<Pt}return zn<Ke||Sn})}return ze.sort((Ke,Pt)=>Ke.distanceSq-Pt.distanceSq).map(Ke=>Ke.tileID)}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const c=h.ap(s.lat,-h.bU,h.bU),g=this.projection.project(s.lng,c);return new h.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/h.bE(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,c){let g,v;const S=this.centerPoint;if("globe"===this.projection.name){const k=this.worldSize;g=(c.x-S.x)/k,v=(c.y-S.y)/k}else{const k=this.pointCoordinate(c),F=this.pointCoordinate(S);g=k.x-F.x,v=k.y-F.y}const C=this.locationCoordinate(s);this.setLocation(new h.a5(C.x-g,C.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,c){const g=c?h.bE(c,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new h.a5(v.x,v.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,c){const g=null!=c?c:this._centerAltitude,v=[s.x,s.y,0,1],S=[s.x,s.y,1,1];h.a6.vec4.transformMat4(v,v,this.pixelMatrixInverse),h.a6.vec4.transformMat4(S,S,this.pixelMatrixInverse);const C=S[3];h.a6.vec4.scale(v,v,1/v[3]),h.a6.vec4.scale(S,S,1/C);const k=v[2],F=S[2];return{p0:v,p1:S,t:k===F?0:(g-k)/(F-k)}}screenPointToMercatorRay(s){const c=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return h.a6.vec4.transformMat4(c,c,this.pixelMatrixInverse),h.a6.vec4.transformMat4(g,g,this.pixelMatrixInverse),h.a6.vec4.scale(c,c,1/c[3]),h.a6.vec4.scale(g,g,1/g[3]),c[2]=h.bE(c[2],this._center.lat)*this.worldSize,g[2]=h.bE(g[2],this._center.lat)*this.worldSize,h.a6.vec4.scale(c,c,1/this.worldSize),h.a6.vec4.scale(g,g,1/this.worldSize),new h.aj([c[0],c[1],c[2]],h.a6.vec3.normalize([],h.a6.vec3.sub([],g,c)))}rayIntersectionCoordinate(s){const{p0:c,p1:g,t:v}=s,S=h.bE(c[2],this._center.lat),C=h.bE(g[2],this._center.lat);return new h.a5(h.aa(c[0],g[0],v)/this.worldSize,h.aa(c[1],g[1],v)/this.worldSize,h.aa(S,C,v))}pointCoordinate(s,c=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,c)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let c=this.projection.pointCoordinate3D(this,s.x,s.y);if(c)return new h.a5(c[0],c[1],c[2]);let g=0,v=this.horizonLineFromTop();if(s.y>v)return this.pointCoordinate(s);const S=.02*v,C=s.clone();for(let k=0;k<10&&v-g>S;k++){C.y=h.aa(g,v,.66);const F=this.projection.pointCoordinate3D(this,C.x,C.y);F?(v=C.y,c=F):g=C.y}return c?new h.a5(c[0],c[1],c[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=h.bV)return!this.isPointAboveHorizon(s);const c=this.pointCoordinate(s);return c.y>=0&&c.y<=1}_coordinatePoint(s,c){const g=c&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return h.a6.vec4.transformMat4(v,v,this.pixelMatrix),v[3]>0?new h.P(v[0]/v[3],v[1]/v[3]):new h.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:c}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,S=this.pointLocation3D(new h.P(c,s)),C=this.pointLocation3D(new h.P(v,s)),k=this.pointLocation3D(new h.P(v,g)),F=this.pointLocation3D(new h.P(c,g));let z=Math.min(S.lng,C.lng,k.lng,F.lng),N=Math.max(S.lng,C.lng,k.lng,F.lng),U=Math.min(S.lat,C.lat,k.lat,F.lat),q=Math.max(S.lat,C.lat,k.lat,F.lat);const W=Math.pow(2,-this.zoom)/16*270,ee="globe"===this.projection.name?1:4,K=(re,ie,ge,xe,ve)=>{const Ee=(re+ge)/2,Ae=(ie+xe)/2,Ie=new h.P(Ee,Ae),{lng:Re,lat:Fe}=this.pointLocation3D(Ie),He=Math.max(0,z-Re,U-Fe,Re-N,Fe-q);z=Math.min(z,Re),N=Math.max(N,Re),U=Math.min(U,Fe),q=Math.max(q,Fe),(ve<ee||He>W)&&(K(re,ie,Ee,Ae,ve+1),K(Ee,Ae,ge,xe,ve+1))};if(K(c,s,v,s,1),K(v,s,v,g,1),K(v,g,c,g,1),K(c,g,c,s,1),"globe"===this.projection.name){const[re,ie]=h.bW(this);re?(q=90,N=180,z=-180):ie&&(U=-90,N=180,z=-180)}return new h.as(new h.bL(z,U),new h.bL(N,q))}_getBoundsRectangular(s,c){const{top:g,left:v}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,k=new h.P(v,g),F=new h.P(C,g),z=new h.P(C,S),N=new h.P(v,S);let U=this.pointCoordinate(k,s),q=this.pointCoordinate(F,s);const W=this.pointCoordinate(z,c),ee=this.pointCoordinate(N,c),K=(re,ie)=>(ie.y-re.y)/(ie.x-re.x);return U.y>1&&q.y>=0?U=new h.a5((1-ee.y)/K(ee,U)+ee.x,1):U.y<0&&q.y<=1&&(U=new h.a5(-ee.y/K(ee,U)+ee.x,0)),q.y>1&&U.y>=0?q=new h.a5((1-W.y)/K(W,q)+W.x,1):q.y<0&&U.y<=1&&(q=new h.a5(-W.y/K(W,q)+W.x,0)),(new h.as).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=s.visibleDemTiles.reduce((g,v)=>{if(v.dem){const S=v.dem.tree;g.min=Math.min(g.min,S.minimums[0]),g.max=Math.max(g.max,S.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*s.exaggeration(),c.max*s.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-c*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-h.bU,this.maxLat=h.bU,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=h.am(this.minLng)*this.tileSize,this.worldMaxX=h.am(this.maxLng)*this.tileSize,this.worldMinY=h.at(this.maxLat)*this.tileSize,this.worldMaxY=h.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,c){return this.projection.createTileMatrix(this,c,s)}calculateDistanceTileData(s){const c=s.key,g=this._distanceTileDataCache;if(g[c])return g[c];const v=s.canonical,S=1/this.height,C=this.cameraWorldSize,k=C/this.zoomScale(v.z),F=(v.x+Math.pow(2,v.z)*s.wrap)*k,z=v.y*k,N=this.point;N.x*=C/this.worldSize,N.y*=C/this.worldSize;const U=this.angle,q=Math.sin(-U),W=-Math.cos(-U);return g[c]={bearing:[q,W],center:[(N.x-F)*S,(N.y-z)*S],scale:k/h.ab*S},g[c]}calculateFogTileMatrix(s){const c=s.key,g=this._fogTileMatrixCache;if(g[c])return g[c];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return h.a6.mat4.multiply(v,this.worldToFogMatrix,v),g[c]=new Float32Array(v),g[c]}calculateProjMatrix(s,c=!1,g=!1){const v=s.key;let S;if(S=g?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,S[v])return S[v];const C=this.calculatePosMatrix(s,this.worldSize);let k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,h.a6.mat4.multiply(C,k,C),S[v]=new Float32Array(C),S[v]}calculatePixelsToTileUnitsMatrix(s){const c=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[c])return g[c];const v=h.bX(s,this);return g[c]=v,g[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const s=1/this.worldSize,c=h.a6.mat4.fromScaling([],[s,s,s]);return h.a6.mat4.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const s=this._elevation;this._updateCameraState();const c=h.bE(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(c),v=this._camera.forward(),S=h.bE(1,this._center.lat);g[2]/=S,v[2]/=S,h.a6.vec3.normalize(v,v);const C=s.raycast(g,v,s.exaggeration());if(C){const k=h.a6.vec3.scaleAndAdd([],g,v,C),F=new h.a5(k[0],k[1],h.bE(k[2],h.aN(k[1]))),z=(F.z+h.a6.vec3.length([F.x-g[0],F.y-g[1],F.z-g[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const c=this._elevation,g=h.bE(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),S=c.getAtPointOrZero(new h.a5(...v)),C=this.pixelsPerMeter/this.worldSize*S,k=this._minimumHeightOverTerrain(),F=v[2]-C;if(F<=k)if(F<0||s){const z=this.locationCoordinate(this._center,this._centerAltitude),N=[v[0],v[1],z.z-v[2]],U=h.a6.vec3.length(N);N[2]-=(k-F)/this._pixelsPerMercatorPixel;const q=h.a6.vec3.length(N);if(0===q)return;h.a6.vec3.scale(N,N,U/q*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],z.z*this._pixelsPerMercatorPixel-N[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const q=this.center;return q.lat=h.ap(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(q.lng=h.ap(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const c=this._unmodified,{x:g,y:v}=this.point;let S=0,C=g,k=v;const F=this.width/2,z=this.height/2,N=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(v-z<N&&(k=N+z),v+z>U&&(k=U-z),U-N<this.height&&(S=Math.max(S,this.height/(U-N)),k=(U+N)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,ee=this.worldSize/2-(q+W)/2;C=(g+ee+this.worldSize)%this.worldSize-ee,C-F<q&&(C=q+F),C+F>W&&(C=W-F),W-q<this.width&&(S=Math.max(S,this.width/(W-q)),C=(W+q)/2)}C===g&&k===v||(this.center=this.unproject(new h.P(C,k))),S&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,c="globe"===this.projection.name,g=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=h.bE(1,this.center.lat)/h.bE(1,h.c5));const v=h.bY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S="meters"===this.projection.zAxisUnit?g:1,C=this._camera.getWorldToCamera(this.worldSize,S);let k;const F=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(F[8]=2*-s.x/this.width,F[9]=2*s.y/this.height,this.isOrthographic){let Fe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),He=Fe*this.aspect,ze=-He,Ne=-Fe;He-=s.x,ze-=s.x,Fe+=s.y,Ne+=s.y,k=this._camera.getCameraToClipOrthographic(ze,He,Ne,Fe,this._nearZ,this._farZ),((ut,wt,zt,Zt)=>{for(let sn=0;sn<16;sn++)ut[sn]=Ds(wt[sn],zt[sn],Zt)})(k,k,F,Ll(this.pitch>=15?1:this.pitch/15))}else k=F;const z=h.a6.mat4.mul([],F,C);let N=h.a6.mat4.mul([],k,C);if(this.projection.isReprojectedInTileSpace){const Fe=this.locationCoordinate(this.center),He=h.a6.mat4.identity([]);h.a6.mat4.translate(He,He,[Fe.x*this.worldSize,Fe.y*this.worldSize,0]),h.a6.mat4.multiply(He,He,h.bZ(this)),h.a6.mat4.translate(He,He,[-Fe.x*this.worldSize,-Fe.y*this.worldSize,0]),h.a6.mat4.multiply(N,N,He),h.a6.mat4.multiply(z,z,He),this.inverseAdjustmentMatrix=h.b_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=h.a6.mat4.scale([],N,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=N,this.invProjMatrix=h.a6.mat4.invert(new Float64Array(16),this.projMatrix),c){const Fe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Fe[8]=2*-s.x/this.width,Fe[9]=2*s.y/this.height,this.expandedFarZProjMatrix=h.a6.mat4.mul([],Fe,C)}else this.expandedFarZProjMatrix=this.projMatrix;const U=h.a6.mat4.invert([],k);this.frustumCorners=h.b$.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=h.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const q=new Float32Array(16);h.a6.mat4.identity(q),h.a6.mat4.scale(q,q,[1,-1,1]),h.a6.mat4.rotateX(q,q,this._pitch),h.a6.mat4.rotateZ(q,q,this.angle);const W=h.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=h.a6.mat4.clone(W);const ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;W[8]=2*-s.x/this.width,W[9]=2*(s.y+ee)/this.height,this.skyboxMatrix=h.a6.mat4.multiply(q,W,q);const K=this.point,re=K.x,ie=K.y,ge=this.width%2/2,xe=this.height%2/2,ve=Math.cos(this.angle),Ee=Math.sin(this.angle),Ae=re-Math.round(re)+ve*ge+Ee*xe,Ie=ie-Math.round(ie)+ve*xe+Ee*ge,Re=new Float64Array(N);if(h.a6.mat4.translate(Re,Re,[Ae>.5?Ae-1:Ae,Ie>.5?Ie-1:Ie,0]),this.alignedProjMatrix=Re,N=h.a6.mat4.create(),h.a6.mat4.scale(N,N,[this.width/2,-this.height/2,1]),h.a6.mat4.translate(N,N,[1,-1,0]),this.labelPlaneMatrix=N,N=h.a6.mat4.create(),h.a6.mat4.scale(N,N,[1,-1,1]),h.a6.mat4.translate(N,N,[-1,-1,0]),h.a6.mat4.scale(N,N,[2/this.width,2/this.height,1]),this.glCoordMatrix=N,this.pixelMatrix=h.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},N=h.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!N)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=N,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=h.c0(this);const Fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=h.a6.vec3.transformMat4(Fe,Fe,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=N;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,S=[s,s,c];h.a6.vec3.scale(S,S,v),h.a6.vec3.scale(g,g,-1),h.a6.vec3.multiply(g,g,S);const C=h.a6.mat4.create();h.a6.mat4.translate(C,C,g),h.a6.mat4.scale(C,C,S),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,c,v)}_computeCameraPosition(s){const c=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*S,v.y/this.worldSize-g[1]*S,s/this.worldSize*this._centerAltitude-g[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=s[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(S=Math.min((c-g)/v,1)),this._camera.position=h.a6.vec3.scaleAndAdd([],this._camera.position,s,S),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,c=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),S=h.bE(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(h.bC(this._maxPitch)),k=Math.max((s[2]-S)/Math.cos(g),C),F=this._zoomFromMercatorZ(k);h.a6.vec3.scaleAndAdd(s,s,c,k),this._pitch=h.ap(g,h.bC(this.minPitch),h.bC(this.maxPitch)),this.angle=h.bB(v,-Math.PI,Math.PI),this._setZoom(h.ap(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new h.a5(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let c=0,g=h.bV,v=0,S=1/0;for(;g-c>1e-6&&g>c;){const C=c+.5*(g-c),k=this.tileSize*Math.pow(2,C),F=this.getCameraToCenterDistance(this.projection,C,k),z=this.scaleZoom(F/(s*this.tileSize)),N=Math.abs(C-z);N<S&&(S=N,v=C),C<z?c=C:g=C}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(h.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,c){const g=Math.min(s.x,c.x),v=Math.max(s.x,c.x),S=Math.min(s.y,c.y),C=Math.max(s.y,c.y);if(S<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const k=[new h.P(g,S),new h.P(v,C),new h.P(g,C),new h.P(v,S)],F=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const N of k){const U=this.pointRayIntersection(N);if(U.t<0)return!0;const q=this.rayIntersectionCoordinate(U);if(q.x<F||q.y<0||q.x>z||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+h.c1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new h.P(0,0),new h.P(this.width,this.height))}zoomDeltaToMovement(s,c){const g=h.a6.vec3.length(h.a6.vec3.sub([],this._camera.position,s)),v=this._zoomFromMercatorZ(g)+c;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if("globe"===this.projection.name){const s=function([c,g,v],S){const C=[c,g,v,1];h.a6.vec4.transformMat4(C,C,S);const k=C[3]=Math.max(C[3],1e-6);return C[0]/=k,C[1]/=k,C[2]/=k,C}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new h.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,s))}}getCameraToCenterDistance(s,c=this.zoom,g=this.worldSize){const v=h.bY(s,c,this.width,this.height,1024),S=s.pixelSpaceConversion(this.center.lat,g,v);let C=.5/Math.tan(.5*this._fov)*this.height*S;return this.isOrthographic&&(C=Ds(1,C,Ll(this.pitch>=15?1:this.pitch/15))),C}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&h.a6.mat4.multiply(s,s,this.globeMatrix),s}getFrustum(s){return h.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,"meters"===this.projection.zAxisUnit)}}const _l=(m,s)=>{if(s>0&&m.terrain&&h.w("Cutoff is currently disabled on terrain"),s<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=m.transform,g=Math.max(Math.abs(c._zoom-(m.minCutoffZoom-1)),1),v=c.isLODDisabled(!1)?h.a7(60,45,c.pitch):h.a7(30,15,c.pitch),S=c._farZ-c._nearZ,C=s*c.height,k=((1-(F=v))*c.cameraToCenterDistance+F*(c._farZ+C))*g;var F;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(k-c._nearZ)/S,(k-C-c._nearZ)/S]}}},Io={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Ku{constructor(s,c){this.aabb=s,this.lastCascade=c}}class an{add(s,c){const g=this.receivers[s.key];void 0!==g?(g.aabb.min[0]=Math.min(g.aabb.min[0],c.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],c.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],c.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],c.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],c.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],c.max[2])):this.receivers[s.key]=new Ku(c,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,c,g){const v=h.ca.fromPoints(s.points);let S=0;for(const C in this.receivers){const k=this.receivers[C];if(!k||!v.intersectsAabb(k.aabb))continue;k.aabb.min=v.closestPoint(k.aabb.min),k.aabb.max=v.closestPoint(k.aabb.max);const F=k.aabb.getCorners();for(let z=0;z<g.length;z++){let N=!0;for(const U of F){const q=[U[0]*c,U[1]*c,U[2]];if(h.a6.vec3.transformMat4(q,q,g[z].matrix),q[0]<-1||q[0]>1||q[1]<-1||q[1]>1){N=!1;break}}if(k.lastCascade=z,S=Math.max(S,z),N)break}}return S+1}}class du{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new an,this._depthMode=new Vn(s.context.gl.LEQUAL,Vn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(Io,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(Io,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),s.tp.registerParameter(Io,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,c){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const v=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((ee,K)=>{const re=g.style._mergedLayers[K];return ee+(re.hasShadowPass()&&!re.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const S=g.context,C=Io.shadowMapResolution,k=Io.shadowMapResolution;if(0===this._cascades.length||Io.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ee=0;ee<Io.cascadeCount;++ee){const K=g._shadowMapDebug,re=S.gl,ie=S.createFramebuffer(C,k,K,"texture"),ge=new h.T(S,{width:C,height:k,data:null},re.DEPTH_COMPONENT16);if(ie.depthAttachment.set(ge.texture),K){const xe=new h.T(S,{width:C,height:k,data:null},re.RGBA8);ie.colorAttachment.set(xe.texture)}this._cascades.push({framebuffer:ie,texture:ge,matrix:[],far:0,boundingSphereRadius:0,frustum:new h.bO,scale:0})}}this.shadowDirection=kf(c);let F=0;if(s.elevation){const ee=s.elevation,K=[1e4,-1e4];ee.visibleDemTiles.filter(re=>re.dem).forEach(re=>{const ie=re.dem.tree;K[0]=Math.min(K[0],ie.minimums[0]),K[1]=Math.max(K[1],ie.maximums[0])}),1e4!==K[0]&&(F=(K[1]-K[0])*ee.exaggeration())}const z=1.5*s.cameraToCenterDistance,N=3*z,U=new Float64Array(16);for(let ee=0;ee<this._cascades.length;++ee){const K=this._cascades[ee];let re=s.height/50,ie=1;1===Io.cascadeCount?ie=N:0===ee?ie=z:(re=z,ie=N);const[ge,xe]=Zn(s,this.shadowDirection,re,ie,Io.shadowMapResolution,F);K.scale=s.scale,K.matrix=ge,K.boundingSphereRadius=xe,h.a6.mat4.invert(U,K.matrix),K.frustum=h.bO.fromInvProjectionMatrix(U,1,0,!0),K.far=ie}const q=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[q].far,this._cascades[q].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Io.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Io.shadowMapResolution,this._uniformValues.u_shadowmap_0=ir_ShadowMap0,this._uniformValues.u_shadowmap_1=ir_ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const W=g.transform.elevation;for(const ee of this._groundShadowTiles){let K={min:0,max:0};if(W){const re=W.getMinMaxForTile(ee);re&&(K=re)}this.addShadowReceiver(ee.toUnwrapped(),K.min,K.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,c){if(!this.enabled)return;const g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,Io.shadowMapResolution,Io.shadowMapResolution]);for(let S=0;S<this._numCascadesToRender;++S){g.currentShadowCascade=S,v.bindFramebuffer.set(this._cascades[S].framebuffer.framebuffer),v.clear({color:h.bA.white,depth:1});for(const C of s.order){const k=s._mergedLayers[C];if(!k.hasShadowPass()||k.isHidden(g.transform.zoom))continue;const F=s.getLayerSourceCache(k),z=F?c[F.id]:void 0;("model"===k.type||z&&z.length)&&g.renderLayer(g,F,k,z)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,c=s.style,g=s.context,v=c.directionalLight,S=c.ambientLight;if(!v||!S)return;const C=[],k=_l(s,s.longestCutoffRange);k.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),C.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&C.push("NORMAL_OFFSET");const F=wa(c,v,S),z=new Vn(g.gl.LEQUAL,Vn.ReadOnly,s.depthRangeFor3D);for(const N of this._groundShadowTiles){const U=N.toUnwrapped(),q=s.isTileAffectedByFog(N),W=s.getOrCreateProgram("groundShadow",{defines:C,overrideFog:q});this.setupShadows(U,W),s.uploadCommonUniforms(g,W,U,null,k);const ee={u_matrix:s.transform.calculateProjMatrix(U),u_ground_shadow_factor:F};W.draw(s,g.gl.TRIANGLES,z,Jt.disabled,Si.multiply,li.disabled,ee,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,{},s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Si.unblended:Si.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const c=this.painter.transform,g=c.calculatePosMatrix(s,c.worldSize);return h.a6.mat4.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(s){return h.a6.mat4.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,c,g,v=0){if(!this.enabled)return;const S=this.painter.transform,C=this.painter.context,k=C.gl,F=this._uniformValues,z=new Float64Array(16),N=S.calculatePosMatrix(s,S.worldSize);for(let U=0;U<this._cascades.length;U++)h.a6.mat4.multiply(z,this._cascades[U].matrix,N),F[0===U?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),C.activeTexture.set(k.TEXTURE0+ir_ShadowMap0+U),this._cascades[U].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){const U=h.c9(s.canonical),q=2/S.tileSize*h.ab/Io.shadowMapResolution,W=q*this._cascades[0].boundingSphereRadius,ee=q*this._cascades[this._cascades.length-1].boundingSphereRadius,K=("vector-tile"===g?1:3)/Math.pow(2,v-s.canonical.z-(1-S.zoom+Math.floor(S.zoom)));F.u_shadow_normal_offset=[U,W*K,ee*K],F.u_shadow_bias=[6e-5,.0012,.012]}else F.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(C,F)}setupShadowsFromMatrix(s,c,g=!1){if(!this.enabled)return;const v=this.painter.context,S=v.gl,C=this._uniformValues,k=new Float64Array(16);for(let F=0;F<Io.cascadeCount;F++)h.a6.mat4.multiply(k,this._cascades[F].matrix,s),C[0===F?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),v.activeTexture.set(S.TEXTURE0+ir_ShadowMap0+F),this._cascades[F].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);if(this.useNormalOffset=g,g){const F=Io.normalOffset;C.u_shadow_normal_offset=[1,F,F],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(v,C)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,c,g,v){if(v[2]>=0)return{};const S=function(F,z,N){const U=N/(1<<F.canonical.z);return new h.ca([F.canonical.x*U+F.wrap*N,F.canonical.y*U+F.wrap*N,0],[(F.canonical.x+1)*U+F.wrap*N,(F.canonical.y+1)*U+F.wrap*N,z])}(s,c,g).getCorners(),C=c/-v[2];v[0]<0?(h.a6.vec3.add(S[0],S[0],[v[0]*C,0,0]),h.a6.vec3.add(S[3],S[3],[v[0]*C,0,0])):v[0]>0&&(h.a6.vec3.add(S[1],S[1],[v[0]*C,0,0]),h.a6.vec3.add(S[2],S[2],[v[0]*C,0,0])),v[1]<0?(h.a6.vec3.add(S[0],S[0],[0,v[1]*C,0]),h.a6.vec3.add(S[1],S[1],[0,v[1]*C,0])):v[1]>0&&(h.a6.vec3.add(S[2],S[2],[0,v[1]*C,0]),h.a6.vec3.add(S[3],S[3],[0,v[1]*C,0]));const k={};return k.vertices=S,k.planes=[ys(S[1],S[0],S[4]),ys(S[2],S[1],S[5]),ys(S[3],S[2],S[6]),ys(S[0],S[3],S[7])],k}addShadowReceiver(s,c,g){this._receivers.add(s,h.ca.fromTileIdAndHeight(s,c,g))}getMaxCascadeForTile(s){const c=this._receivers.get(s);return c&&c.lastCascade?c.lastCascade:0}}function ys(m,s,c){const g=h.a6.vec3.sub([],c,s),v=h.a6.vec3.sub([],m,s),S=h.a6.vec3.cross([],g,v),C=h.a6.vec3.length(S);return 0===C?[0,0,1,0]:(h.a6.vec3.scale(S,S,1/C),[S[0],S[1],S[2],-h.a6.vec3.dot(S,s)])}function kf(m){const s=m.properties.get("direction"),c=h.c8(s.x,s.y,s.z);c[2]=h.ap(c[2],0,75);const g=h.cb([c[0],c[1],c[2]]);return h.a6.vec3.fromValues(g.x,g.y,g.z)}function wa(m,s,c){const g=s.properties.get("color"),v=s.properties.get("intensity"),S=s.properties.get("direction"),C=[S.x,S.y,S.z],k=c.properties.get("color"),F=c.properties.get("intensity"),z=Math.max(h.a6.vec3.dot([0,0,1],C),0),N=[0,0,0];h.a6.vec3.scale(N,k.toRenderColor(m.getLut(s.scope)).toArray01Linear().slice(0,3),F);const U=[0,0,0];return h.a6.vec3.scale(U,g.toRenderColor(m.getLut(c.scope)).toArray01Linear().slice(0,3),z*v),h.cc([N[0]>0?N[0]/(N[0]+U[0]):0,N[1]>0?N[1]/(N[1]+U[1]):0,N[2]>0?N[2]/(N[2]+U[2]):0])}function Zn(m,s,c,g,v,S){const C=m.zoom,k=m.scale,F=m.worldSize,z=1/F,N=m.aspect,U=Math.sqrt(1+N*N)*Math.tan(.5*m.fovX),q=U*U,W=g-c,ee=g+c;let K,re;q>W/ee?(K=g,re=g*U):(K=.5*ee*(1+q),re=.5*Math.sqrt(W*W+2*(g*g+c*c)*q+ee*ee*q*q));const ie=m.projection.pixelsPerMeter(m.center.lat,F),ge=m._camera.getCameraToWorldMercator(),xe=[0,0,-K*z];h.a6.vec3.transformMat4(xe,xe,ge);let ve=re*z;const Ee=m._edgeInsets;if(!(0===Ee.left&&0===Ee.top&&0===Ee.right&&0===Ee.bottom||Ee.left===Ee.right&&Ee.top===Ee.bottom)){const Ot=m._camera.getWorldToCamera(m.worldSize,"meters"===m.projection.zAxisUnit?ie:1),Ut=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,c,g);Ut[8]=2*-m.centerOffset.x/m.width,Ut[9]=2*m.centerOffset.y/m.height;const Lt=new Float64Array(16);h.a6.mat4.mul(Lt,Ut,Ot);const un=new Float64Array(16);h.a6.mat4.invert(un,Lt);const Ln=h.bO.fromInvProjectionMatrix(un,F,C,!0);for(const zn of Ln.points){const Sn=((Ae=zn)[0]/=k,Ae[1]/=k,Ae[2]=h.bE(Ae[2],m._center.lat),Ae);ve=Math.max(ve,h.a6.vec3.len(h.a6.vec3.subtract([],xe,Sn)))}}var Ae;ve*=v/(v-1);const Ie=Math.acos(s[2]),Re=Math.atan2(-s[0],-s[1]),Fe=new Cs;Fe.position=xe,Fe.setPitchBearing(Ie,Re);const He=Fe.getWorldToCamera(F,ie),ze=ve*F,Ne=Math.min(m._mercatorZfromZoom(17)*F*-2,-2*ze),ut=Fe.getCameraToClipOrthographic(-ze,ze,-ze,ze,Ne,(ze+S*ie)/s[2]),wt=new Float64Array(16);h.a6.mat4.multiply(wt,ut,He);const zt=h.a6.vec3.fromValues(Math.floor(1e6*xe[0])/1e6*F,Math.floor(1e6*xe[1])/1e6*F,0),Zt=.5*v,sn=[0,0,0];h.a6.vec3.transformMat4(sn,zt,wt),h.a6.vec3.scale(sn,sn,Zt);const Ke=[Math.floor(sn[0]),Math.floor(sn[1]),Math.floor(sn[2])],Pt=[0,0,0];h.a6.vec3.sub(Pt,sn,Ke),h.a6.vec3.scale(Pt,Pt,-1/Zt);const bt=new Float64Array(16);return h.a6.mat4.identity(bt),h.a6.mat4.translate(bt,bt,Pt),h.a6.mat4.multiply(wt,bt,wt),[wt,ze]}class Wi extends h.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.numModelsLoading={}}loadModel(s,c){return h.aG(this.requestManager.transformRequest(c,h.R.Model).url).then(g=>{if(!g)return;const v=h.aH(g),S=new h.aI(s,void 0,void 0,v);return S.computeBoundsAndApplyParent(),S}).catch(g=>{if(g&&404===g.status)return null;this.fire(new h.t(new Error(`Could not load model ${s} from ${c}: ${g.message}`)))})}load(s,c){this.models[c]||(this.models[c]={});const g=Object.keys(s);this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+g.length;const v=[];for(const S of g)v.push(this.loadModel(S,s[S]));Promise.allSettled(v).then(S=>{for(let C=0;C<S.length;C++){const{status:k,value:F}=S[C];"fulfilled"===k&&F&&(this.models[c][g[C]]={model:F,numReferences:1})}this.numModelsLoading[c]-=g.length,this.fire(new h.x("data",{dataType:"style"}))}).catch(S=>{this.fire(new h.t(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,c){return!!this.getModel(s,c)}getModel(s,c){return this.models[c]||(this.models[c]={}),this.models[c][s]?this.models[c][s].model:void 0}addModel(s,c,g){this.models[g]||(this.models[g]={}),this.hasModel(s,g)&&this.models[g][s].numReferences++,this.load({[s]:this.requestManager.normalizeModelURL(c)},g)}addModels(s,c){this.models[c]||(this.models[c]={});const g={};for(const v in s)this.models[c][v]={},g[v]=this.requestManager.normalizeModelURL(s[v]);this.load(g,c)}addModelsFromBucket(s,c){this.models[c]||(this.models[c]={});const g={};for(const v of s)this.hasModel(v,c)?this.models[c][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,c)}removeModel(s,c){if(this.models[c]&&this.models[c][s]&&(this.models[c][s].numReferences--,0===this.models[c][s].numReferences)){const g=this.models[c][s].model;delete this.models[c][s],g.destroy()}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,c){this.models[c]||(this.models[c]={});for(const g in this.models[c])this.models[c][g].model&&this.models[c][g].model.upload(s.context)}}const Fo=new h.a0({data:new h.a1(h._.colorTheme.data)}),Go=(m,s)=>Je(m,s&&s.filter(c=>"source.canvas"!==c.identifier)),tc=h.ar(qt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),rs=h.ar(qt,["setCenter","setZoom","setBearing","setPitch"]),hu={version:8,layers:[],sources:{}},os={duration:300,delay:0};class Xs extends h.E{constructor(s,c={}){super(),this.map=s,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=h.l({},os),this._buildingIndex=new $i(this),this.crossTileSymbolIndex=new $d,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._mergedLayerSelectors=new Map,this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new st,this.dispatcher=c.dispatcher?c.dispatcher:new h.ce(h.cf(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new ao,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new h.cg(s._requestManager,c.localFontFamily?h.ch.all:c.localIdeographFontFamily?h.ch.ideographs:h.ch.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new Wi(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",h.ci());const g=this;this._rtlTextPluginCallback=Xs.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(S,C)=>{if(h.cj(S),C&&C.every(k=>k))for(const k in g._sourceCaches){const F=g._sourceCaches[k],z=F.getSource().type;"vector"!==z&&"geojson"!==z||F.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const S=this.getOwnSource(v.sourceId);if(S&&S.vectorLayerIds)for(const C in this._layers){const k=this._layers[C];k.source===S.id&&this._validateLayer(k)}})}load(s){return s?("string"==typeof s?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if("string"==typeof s){if(h.f(s))return s;const c=h.ck(s);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch(g){return c}return c}return`json://${h.cl(JSON.stringify(s))}`}_diffStyle(s,c,g){this.globalId=this._getGlobalId(s);const v=(S,C)=>{try{C(null,this.setState(S,g))}catch(k){C(k,!1)}};if("string"==typeof s){const S=this.map._requestManager.normalizeStyleURL(s),C=this.map._requestManager.transformRequest(S,h.R.Style);h.n(C,(k,F)=>{k?this.fire(new h.t(k)):F&&v(F,c)})}else"object"==typeof s&&v(s,c)}loadURL(s,c={}){this.fire(new h.x("dataloading",{dataType:"style"}));const g="boolean"==typeof c.validate?c.validate:!h.f(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,c.accessToken),this.resolvedImports.add(s);const v=this.importsCache.get(s);if(v)return this._load(v,g);const S=this.map._requestManager.transformRequest(s,h.R.Style);this._request=h.n(S,(C,k)=>{if(this._request=null,C)this.fire(new h.t(C));else if(k)return this.importsCache.set(s,k),this._load(k,g)})}loadJSON(s,c={}){this.fire(new h.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=h.q.frame(()=>{this._request=null,this._load(s,!1!==c.validate)})}loadEmpty(){this.fire(new h.x("dataloading",{dataType:"style"})),this._load(hu,!1)}_loadImports(s,c,g){if(this.importDepth>=4)return h.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const S of s){const C=this._createFragmentStyle(S),k=new Promise(N=>{C.once("style.import.load",N),C.once("error",N)}).then(()=>this.mergeAll());if(v.push(k),this.resolvedImports.has(S.url)){C.loadEmpty();continue}const F=S.data||this.importsCache.get(S.url);F?(C.loadJSON(F,{validate:c}),this._isInternalStyle(F)&&(C.globalId=null)):S.url?C.loadURL(S.url,{validate:c}):C.loadEmpty();const z={style:C,id:S.id,config:S.config};if(g){const N=this.fragments.findIndex(({id:U})=>U===g);this.fragments=this.fragments.slice(0,N).concat(z).concat(this.fragments.slice(N))}else this.fragments.push(z)}return Promise.allSettled(v)}getImportGlobalIds(s=this,c=new Set){for(const g of s.fragments)g.style.globalId&&c.add(g.style.globalId),this.getImportGlobalIds(g.style,c);return[...c.values()]}_createFragmentStyle(s){const c=this.scope?h.av(s.id,this.scope):s.id;let g;const v=this._initialConfig&&this._initialConfig[c];(s.config||v)&&(g=h.l({},s.config,v));const S=new Xs(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return S.setEventedParent(this.map,{style:S}),S}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&!1!==s.fragment)}_load(s,c){const g=s.schema;if(this._isInternalStyle(s)){const C=h.l({},hu,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(C,c)}if(this.updateConfig(this._config,g),c&&Go(this,Ha(s)))return;this._loaded=!0,this.stylesheet=h.cm(s);const v=()=>{for(const z in s.sources)this.addSource(z,s.sources[z],{validate:!1,isInitialLoad:!0});s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(s.glyphs,this.scope);const C=rb(this.stylesheet.layers);if(this._order=C.map(z=>z.id),this.stylesheet.light&&h.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const z=this.stylesheet.lights[0];this.light=new nt(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new nt(this.stylesheet.light)),this._layers={};for(const z of C){const N=h.cq(z,this.scope,this._styleColorTheme.lut,this.options);0!==N.configDependencies.size&&this._configDependentLayers.add(N.fqid),N.setEventedParent(this,{layer:{id:N.id}}),this._layers[N.id]=N;const U=this.getOwnLayerSourceCache(N),q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&N.canCastShadows()&&q&&(U.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new h.x("data",{dataType:"style"}));const F=this.isRootStyle();s.imports?this._loadImports(s.imports,c).then(()=>{this._reloadImports(),this.fire(new h.x(F?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new h.x(F?"style.load":"style.import.load")))},S=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=S,S){const C=this._evaluateColorThemeData(S);this._loadColorTheme(C).then(()=>{v()}).catch(k=>{h.w(`Couldn't load color theme from the stylesheet: ${k}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return 0===this.importDepth}mergeAll(){let s,c,g,v,S,C,k,F;const z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(N=>{if(N.stylesheet){if(null!=N.light&&(s=N.light),N.stylesheet.lights)for(const U of N.stylesheet.lights)"ambient"===U.type&&null!=N.ambientLight&&(c=N.ambientLight),"directional"===U.type&&null!=N.directionalLight&&(g=N.directionalLight);v=this._prioritizeTerrain(v,N.terrain,N.stylesheet.terrain),N.stylesheet.fog&&null!=N.fog&&(S=N.fog),null!=N.stylesheet.camera&&(F=N.stylesheet.camera),null!=N.stylesheet.projection&&(C=N.stylesheet.projection),null!=N.stylesheet.transition&&(k=N.stylesheet.transition),z[N.scope]=N._styleColorTheme}}),this.light=s,this.ambientLight=c,this.directionalLight=g,this.fog=S,this._styleColorThemeForScope=z,null===v?delete this.terrain:this.terrain=v,this.camera=F||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=h.l({},os,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){const c=g=>{for(const v of g.fragments)c(v.style);s(g)};c(this)}_prioritizeTerrain(s,c,g){const v=s&&0===s.drapeRenderMode;return null===g?c&&0===c.drapeRenderMode?c:v?s:null:null!=c&&(!s||v||c&&1===c.drapeRenderMode)?c:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{s=this._prioritizeTerrain(s,c.terrain,c.stylesheet.terrain)}),null===s?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(c=>{null!=c.stylesheet.projection&&(s=c.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},c={},g={};this.forEachFragmentStyle(v=>{for(const S in v._sourceCaches){const C=h.av(S,v.scope);s[C]=v._sourceCaches[S]}for(const S in v._otherSourceCaches){const C=h.av(S,v.scope);c[C]=v._otherSourceCaches[S]}for(const S in v._symbolSourceCaches){const C=h.av(S,v.scope);g[C]=v._symbolSourceCaches[S]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=g}mergeLayers(){const s={},c=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._mergedLayerSelectors.clear(),this.forEachFragmentStyle(S=>{for(const k of S._order){const F=S._layers[k];if("slot"===F.type){const z=h.cn(k);if(s[z])continue;s[z]=[]}F.slot&&s[F.slot]?s[F.slot].push(F):c.push(F)}const{featuresets:C}=S.stylesheet||{};if(C)for(const k in C){const{selectors:F}=C[k];for(const z of F){const N=S._layers[z.layer],U=this._mergedLayerSelectors.get(N.fqid)||[];let q;if(z.properties)for(const W in z.properties){const ee=h.M(z.properties[W]);"success"===ee.result&&(q=q||{},q[W]=ee.value)}U.push({featuresetId:k,featureNamespace:z.featureNamespace,properties:q}),this._mergedLayerSelectors.set(N.fqid,U)}}}),this._mergedOrder=[];const v=(S=[])=>{for(const C of S)if("slot"===C.type){const k=h.cn(C.id);s[k]&&v(s[k]),this._mergedSlots.push(k)}else{const k=h.av(C.id,C.scope);this._mergedOrder.push(k),g[k]=C,C.is3D()&&(this._has3DLayers=!0),"circle"===C.type&&(this._hasCircleLayers=!0),"symbol"===C.type&&(this._hasSymbolLayers=!0),"clip"===C.type&&(this._clipLayerPresent=!0)}};v(c),this._mergedOrder.sort((S,C)=>{const k=g[S],F=g[C];return k.hasInitialOcclusionOpacityProperties?F.is3D()?1:0:k.is3D()&&F.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=h.l({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(c,g,v){const S=h.l({},g);for(const k of Object.keys(h._.colorTheme))void 0===S[k]&&(S[k]=h._.colorTheme[k].default);const C=new h.$(Fo,c,new Map(v));return C.setTransitionOrValue(S,v),C.untransitioned().possiblyEvaluate(new h.a3(0))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,v)=>{const S="data:image/png;base64,";if(!s||0===s.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let C=s;C.startsWith(S)||(C=S+C);const k="mapbox-reserved-lut",F=new Image;F.src=C,F.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},F.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void g();this._styleColorTheme.lutLoading=!1;const{width:z,height:N,data:U}=h.q.getImageData(F);if(N>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==N*N)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(k)&&this.removeImage(k),this.addImage(k,{data:new h.r({width:z,height:N},U),pixelRatio:1,sdf:!1,version:0});const q=this.imageManager.getImage(k,this.scope);q?(this._styleColorTheme.lut={image:q.data,data:s},g()):v(new Error("Missing LUT image."))}})}getLut(s){const c=this._styleColorThemeForScope[s];return c?c.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(c,g,v){let S,C,k;const F=h.q.devicePixelRatio>1?"@2x":"";let z=h.n(g.transformRequest(g.normalizeSpriteURL(c,F,".json"),h.R.SpriteJSON),(q,W)=>{z=null,k||(k=q,S=W,U())}),N=h.o(g.transformRequest(g.normalizeSpriteURL(c,F,".png"),h.R.SpriteImage),(q,W)=>{N=null,k||(k=q,C=W,U())});function U(){if(k)v(k);else if(S&&C){const q=h.q.getImageData(C),W={};for(const ee in S){const{width:K,height:re,x:ie,y:ge,sdf:xe,pixelRatio:ve,stretchX:Ee,stretchY:Ae,content:Ie}=S[ee],Re=new h.r({width:K,height:re});h.r.copy(q,Re,{x:ie,y:ge},{x:0,y:0},{width:K,height:re},null),W[ee]={data:Re,pixelRatio:ve,sdf:xe,stretchX:Ee,stretchY:Ae,content:Ie}}v(null,W)}}return{cancel(){z&&(z.cancel(),z=null),N&&(N.cancel(),N=null)}}}(s,this.map._requestManager,(c,g)=>{if(this._spriteRequest=null,c)this.fire(new h.t(c));else if(g)for(const v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new h.x("data",{dataType:"style"}))})}_validateLayer(s){const c=this.getOwnSource(s.source);if(!c)return;const g=s.sourceLayer;g&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(g))&&this.fire(new h.t(new Error(`Source layer "${g}" does not exist on source "${c.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,c)=>{const g=this.fragments[c];return g&&g.style&&(s.data=g.style.serialize()),s})}_serializeSources(){const s={};for(const c in this._sourceCaches){const g=this._sourceCaches[c].getSource();s[g.id]||(s[g.id]=g.serialize())}return s}_serializeLayers(s){const c=[];for(const g of s){const v=this._layers[g];v&&"custom"!==v.type&&c.push(v.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const c=this.getOwnLayer(s);if(c)return c;this.fire(new h.t(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const c=this.getOwnSource(s);if(c)return c;this.fire(new h.t(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,c){const g=this.map.painter;if(g)for(let v=s.minzoom||0;v<(s.maxzoom||25.5);v++){const S=s.getProgramIds();if(S)for(const C of S){const k=s.getDefaultProgramParams(C,c.zoom,this._styleColorTheme.lut);k&&(g.style=this,this.fog&&(g._fogVisible=!0,k.overrideFog=!0,g.getOrCreateProgram(C,k)),g._fogVisible=!1,k.overrideFog=!1,g.getOrCreateProgram(C,k),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(k.overrideRtt=!0,g.getOrCreateProgram(C,k)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const c=this.calculateLightsBrightness();s.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c));const g=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const C=this._changes.getLayerUpdatesByScope();for(const k in C){const{updatedIds:F,removedIds:z}=C[k];(F||z)&&(this._updateWorkerLayers(k,F,z),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._changes.reset()}const S={};for(const C in this._mergedSourceCaches){const k=this._mergedSourceCaches[C];S[C]=k.used,k.used=!1,k.tileCoverLift=0}for(const C of this._mergedOrder){const k=this._mergedLayers[C];if(k.recalculate(s,this._availableImages),!k.isHidden(s.zoom)){const F=this.getLayerSourceCache(k);F&&(F.used=!0,F.tileCoverLift=Math.max(F.tileCoverLift,k.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(k,s)}):this.precompilePrograms(k,s))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(const C in S){const k=this._mergedSourceCaches[C];S[C]!==k.used&&k.getSource().fire(new h.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new h.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=this._changes.getUpdatedImages();if(s.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s);this._changes.resetUpdatedImages()}}_updateWorkerLayers(s,c,g){const v=this.getFragmentStyle(s);v&&this.dispatcher.broadcast("updateLayers",{layers:c?v._serializeLayers(c):[],scope:s,removedIds:g||[],options:v.options})}setState(s,c){if(this._checkLoaded(),Go(this,Ha(s)))return!1;(s=h.cm(s)).layers=rb(s.layers);const g=function(C,k){if(!C)return[{command:qt.setStyle,args:[k]}];let F=[];try{if(!h.bi(C.version,k.version))return[{command:qt.setStyle,args:[k]}];if(h.bi(C.center,k.center)||F.push({command:qt.setCenter,args:[k.center]}),h.bi(C.zoom,k.zoom)||F.push({command:qt.setZoom,args:[k.zoom]}),h.bi(C.bearing,k.bearing)||F.push({command:qt.setBearing,args:[k.bearing]}),h.bi(C.pitch,k.pitch)||F.push({command:qt.setPitch,args:[k.pitch]}),h.bi(C.sprite,k.sprite)||F.push({command:qt.setSprite,args:[k.sprite]}),h.bi(C.glyphs,k.glyphs)||F.push({command:qt.setGlyphs,args:[k.glyphs]}),h.bi(C.imports,k.imports)||function(W=[],ee=[],K){ee=ee||[];const re=(W=W||[]).map(Ju),ie=ee.map(Ju),ge=W.reduce(Ec,{}),xe=ee.reduce(Ec,{}),ve=re.slice();let Ee,Ae,Ie,Re;for(Ee=0,Ae=0;Ee<re.length;Ee++)Ie=re[Ee],xe.hasOwnProperty(Ie)?Ae++:(K.push({command:qt.removeImport,args:[Ie]}),ve.splice(ve.indexOf(Ie,Ae),1));for(Ee=0,Ae=0;Ee<ie.length;Ee++)Ie=ie[ie.length-1-Ee],ve[ve.length-1-Ee]!==Ie&&(ge.hasOwnProperty(Ie)?(K.push({command:qt.removeImport,args:[Ie]}),ve.splice(ve.lastIndexOf(Ie,ve.length-Ae),1)):Ae++,Re=ve[ve.length-Ee],K.push({command:qt.addImport,args:[xe[Ie],Re]}),ve.splice(ve.length-Ee,0,Ie));for(const Fe of ee){const He=ge[Fe.id];He&&!h.bi(He,Fe)&&K.push({command:qt.updateImport,args:[Fe.id,Fe]})}}(C.imports,k.imports,F),h.bi(C.transition,k.transition)||F.push({command:qt.setTransition,args:[k.transition]}),h.bi(C.light,k.light)||F.push({command:qt.setLight,args:[k.light]}),h.bi(C.fog,k.fog)||F.push({command:qt.setFog,args:[k.fog]}),h.bi(C.projection,k.projection)||F.push({command:qt.setProjection,args:[k.projection]}),h.bi(C.lights,k.lights)||F.push({command:qt.setLights,args:[k.lights]}),h.bi(C.camera,k.camera)||F.push({command:qt.setCamera,args:[k.camera]}),!h.bi(C["color-theme"],k["color-theme"]))return[{command:qt.setStyle,args:[k]}];const z={},N=[];!function(W,ee,K,re){let ie;for(ie in ee=ee||{},W=W||{})W.hasOwnProperty(ie)&&(ee.hasOwnProperty(ie)||Gn(ie,K,re));for(ie in ee){if(!ee.hasOwnProperty(ie))continue;const ge=ee[ie];W.hasOwnProperty(ie)?h.bi(W[ie],ge)||("geojson"===W[ie].type&&"geojson"===ge.type&&ni(W,ee,ie)?K.push({command:qt.setGeoJSONSourceData,args:[ie,ge.data]}):bo(ie,ee,K,re)):Hd(ie,ee,K)}}(C.sources,k.sources,N,z);const U=[];C.layers&&C.layers.forEach(W=>{W.source&&z[W.source]?F.push({command:qt.removeLayer,args:[W.id]}):U.push(W)});let q=C.terrain;q&&z[q.source]&&(F.push({command:qt.setTerrain,args:[void 0]}),q=void 0),F=F.concat(N),h.bi(q,k.terrain)||F.push({command:qt.setTerrain,args:[k.terrain]}),function(W,ee,K){ee=ee||[];const re=(W=W||[]).map(Ju),ie=ee.map(Ju),ge=W.reduce(Ec,{}),xe=ee.reduce(Ec,{}),ve=re.slice(),Ee=Object.create(null);let Ae,Ie,Re,Fe,He,ze,Ne;for(Ae=0,Ie=0;Ae<re.length;Ae++)Re=re[Ae],xe.hasOwnProperty(Re)?Ie++:(K.push({command:qt.removeLayer,args:[Re]}),ve.splice(ve.indexOf(Re,Ie),1));for(Ae=0,Ie=0;Ae<ie.length;Ae++)Re=ie[ie.length-1-Ae],ve[ve.length-1-Ae]!==Re&&(ge.hasOwnProperty(Re)?(K.push({command:qt.removeLayer,args:[Re]}),ve.splice(ve.lastIndexOf(Re,ve.length-Ie),1)):Ie++,ze=ve[ve.length-Ae],K.push({command:qt.addLayer,args:[xe[Re],ze]}),ve.splice(ve.length-Ae,0,Re),Ee[Re]=!0);for(Ae=0;Ae<ie.length;Ae++)if(Re=ie[Ae],Fe=ge[Re],He=xe[Re],!Ee[Re]&&!h.bi(Fe,He))if(h.bi(Fe.source,He.source)&&h.bi(Fe["source-layer"],He["source-layer"])&&h.bi(Fe.type,He.type)){for(Ne in Df(Fe.layout,He.layout,K,Re,null,qt.setLayoutProperty),Df(Fe.paint,He.paint,K,Re,null,qt.setPaintProperty),h.bi(Fe.slot,He.slot)||K.push({command:qt.setSlot,args:[Re,He.slot]}),h.bi(Fe.filter,He.filter)||K.push({command:qt.setFilter,args:[Re,He.filter]}),h.bi(Fe.minzoom,He.minzoom)&&h.bi(Fe.maxzoom,He.maxzoom)||K.push({command:qt.setLayerZoomRange,args:[Re,He.minzoom,He.maxzoom]}),Fe)Fe.hasOwnProperty(Ne)&&"layout"!==Ne&&"paint"!==Ne&&"filter"!==Ne&&"metadata"!==Ne&&"minzoom"!==Ne&&"maxzoom"!==Ne&&"slot"!==Ne&&(0===Ne.indexOf("paint.")?Df(Fe[Ne],He[Ne],K,Re,Ne.slice(6),qt.setPaintProperty):h.bi(Fe[Ne],He[Ne])||K.push({command:qt.setLayerProperty,args:[Re,Ne,He[Ne]]}));for(Ne in He)He.hasOwnProperty(Ne)&&!Fe.hasOwnProperty(Ne)&&"layout"!==Ne&&"paint"!==Ne&&"filter"!==Ne&&"metadata"!==Ne&&"minzoom"!==Ne&&"maxzoom"!==Ne&&"slot"!==Ne&&(0===Ne.indexOf("paint.")?Df(Fe[Ne],He[Ne],K,Re,Ne.slice(6),qt.setPaintProperty):h.bi(Fe[Ne],He[Ne])||K.push({command:qt.setLayerProperty,args:[Re,Ne,He[Ne]]}))}else K.push({command:qt.removeLayer,args:[Re]}),ze=ve[ve.lastIndexOf(Re)+1],K.push({command:qt.addLayer,args:[He,ze]})}(U,k.layers,F)}catch(z){console.warn("Unable to compute style diff:",z),F=[{command:qt.setStyle,args:[k]}]}return F}(this.serialize(),s).filter(C=>!(C.command in rs));if(0===g.length)return!1;const v=g.filter(C=>!(C.command in tc));if(v.length>0)throw new Error(`Unimplemented: ${v.map(C=>C.command).join(", ")}.`);const S=[];return g.forEach(C=>{S.push(this[C.command].apply(this,C.args))}),c&&Promise.all(S).then(c),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(s,c){return this.getImage(s)?this.fire(new h.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,this.scope,c),this._afterImageUpdated(s),this)}updateImage(s,c){this.imageManager.updateImage(s,this.scope,c)}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._afterImageUpdated(s),this):this.fire(new h.t(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(s),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new h.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(s,c,g={}){return this._checkLoaded(),this._validate(Ge,`models.${s}`,c,null,g)||(this.modelManager.addModel(s,c,this.scope),this._changes.setDirty()),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this):this.fire(new h.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,c,g={}){if(this._checkLoaded(),void 0!==this.getOwnSource(s))throw new Error(`There is already a source with ID "${s}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Zu,`sources.${s}`,c,null,g))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const v=Gh(s,c,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const S=C=>{const k=(C?"symbol:":"other:")+v.id,F=h.av(k,this.scope),z=this._sourceCaches[k]=new Cr(F,v,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=z,z.onAdd(this.map)};S(!1),"vector"!==c.type&&"geojson"!==c.type||S(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const c=this.getOwnSource(s);if(!c)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===s)return this.fire(new h.t(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new h.t(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const g=this.getOwnSourceCaches(s);for(const v of g){const S=h.cn(v.id);delete this._sourceCaches[S],this._changes.discardSourceCacheUpdate(v.id),v.fire(new h.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,c){this._checkLoaded(),this.getOwnSource(s).setData(c),this._changes.setDirty()}getOwnSource(s){const c=this.getOwnSourceCache(s);return c&&c.getSource()}getOwnSources(){const s=[];for(const c in this._otherSourceCaches){const g=this.getOwnSourceCache(c);g&&s.push(g.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const c in s){const g=s[c]._tiles;for(const v in g){const S=g[v];if("loaded"!==S.state&&"errored"!==S.state)return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const v of s){if(this._validate(Hh,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(v),S.updateTransitions(c)}else this.ambientLight=new di(v,vr||(vr=new h.a0({color:new h.a1(h._.properties_light_ambient.color),intensity:new h.a1(h._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(v),S.updateTransitions(c)}else this.directionalLight=new di(v,lr||(lr=new h.a0({direction:new h.ad(h._.properties_light_directional.direction),color:new h.a1(h._.properties_light_directional.color),intensity:new h.a1(h._.properties_light_directional.intensity),"cast-shadows":new h.a1(h._.properties_light_directional["cast-shadows"]),"shadow-intensity":new h.a1(h._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const g=new h.a3(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,c=this.ambientLight;if(!s||!c)return;const g=q=>.2126*(q[0]<=.03928?q[0]/12.92:Math.pow((q[0]+.055)/1.055,2.4))+.7152*(q[1]<=.03928?q[1]/12.92:Math.pow((q[1]+.055)/1.055,2.4))+.0722*(q[2]<=.03928?q[2]/12.92:Math.pow((q[2]+.055)/1.055,2.4)),v=s.properties.get("color").toRenderColor(null).toArray01(),S=s.properties.get("intensity"),C=s.properties.get("direction"),k=1-h.c8(C.x,C.y,C.z)[2]/90,F=g(v)*S*k,z=c.properties.get("color").toRenderColor(null).toArray01(),N=c.properties.get("intensity"),U=g(z)*N;return Number(((F+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(!s)return this;if(h.aK(s)){const c=h.co(s),g=this.fragments.find(({id:S})=>S===c);if(!g)throw new Error(`Style import '${s}' not found`);const v=h.cn(s);return g.style.getFragmentStyle(v)}{const c=this.fragments.find(({id:g})=>g===s);if(!c)throw new Error(`Style import '${s}' not found`);return c.style}}getFeaturesetDescriptors(s){const c=this.getFragmentStyle(s);if(!c||!c.stylesheet.featuresets)return[];const g=[];for(const v in c.stylesheet.featuresets)g.push({featuresetId:v,importId:c.scope?c.scope:void 0});return g}getFeaturesetLayers(s,c){const g=this.getFragmentStyle(c),v=g.stylesheet.featuresets;if(!v||!v[s])return this.fire(new h.t(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const S=[];for(const C of v[s].selectors){const k=g.getOwnLayer(C.layer);k&&S.push(k)}return S}getConfigProperty(s,c){const g=this.getFragmentStyle(s);if(!g)return null;const v=h.av(c,g.scope),S=g.options.get(v),C=S?S.value||S.default:null;return C?C.serialize():null}setConfigProperty(s,c,g){const v=this.getFragmentStyle(s);if(!v)return;const S=v.stylesheet.schema;if(!S||!S[c])return;const C=h.M(g);if("success"!==C.result)return void Go(this,C.value);const k=C.value.expression,F=h.av(c,v.scope),z=v.options.get(F);if(!z)return;let N;const{minValue:U,maxValue:q,stepValue:W,type:ee,values:K}=S[c],re=h.M(S[c].default);"success"===re.result&&(N=re.value.expression),N?(this.options.set(F,{...z,value:k,default:N,minValue:U,maxValue:q,stepValue:W,type:ee,values:K}),this.updateConfigDependencies(c)):this.fire(new h.t(new Error(`No schema defined for the config option "${c}" in the "${s}" fragment.`)))}getConfig(s){const c=this.getFragmentStyle(s);if(!c)return null;const g=c.stylesheet.schema;if(!g)return null;const v={};for(const S in g){const C=h.av(S,c.scope),k=c.options.get(C),F=k?k.value||k.default:null;v[S]=F?F.serialize():null}return v}setConfig(s,c){const g=this.getFragmentStyle(s);g&&(g.updateConfig(c,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const c=this.getFragmentStyle(s);return c?c.stylesheet.schema:null}setSchema(s,c){const g=this.getFragmentStyle(s);g&&(g.stylesheet.schema=c,g.updateConfig(g._config,c),this.updateConfigDependencies())}updateConfig(s,c){if(this._config=s,s||c)if(c)for(const g in c){let v,S;const C=h.M(c[g].default);if("success"===C.result&&(v=C.value.expression),s&&void 0!==s[g]){const q=h.M(s[g]);"success"===q.result&&(S=q.value.expression)}const{minValue:k,maxValue:F,stepValue:z,type:N,values:U}=c[g];if(v){const q=h.av(g,this.scope);this.options.set(q,{default:v,value:S,minValue:k,maxValue:F,stepValue:z,type:N,values:U})}else this.fire(new h.t(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new h.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(s){for(const c of this._configDependentLayers){const g=this.getLayer(c);if(g){if(s&&!g.configDependencies.has(s))continue;g.possiblyEvaluateVisibility(),this._updateLayer(g)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(c=>{if(c._styleColorTheme.colorTheme){const g=c._evaluateColorThemeData(c._styleColorTheme.colorTheme);(!c._styleColorTheme.lut&&""!==g||c._styleColorTheme.lut&&g!==c._styleColorTheme.lut.data)&&c.setColorTheme(c._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(s,c,g={}){this._checkLoaded();const v=s.id;if(this._layers[v])return void this.fire(new h.t(new Error(`Layer with id "${v}" already exists on this map`)));let S;if("custom"===s.type){if(Go(this,h.cp(s)))return;S=h.cq(s,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof s.source&&(this.addSource(v,s.source),s=h.cm(s),s=h.l(s,{source:v})),this._validate(gt,`layers.${v}`,s,{arrayIndex:-1},g))return;S=h.cq(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(S),S.setEventedParent(this,{layer:{id:v}})}0!==S.configDependencies.size&&this._configDependentLayers.add(S.fqid);let C=this._order.length;if(c){const N=this._order.indexOf(c);if(-1===N)return void this.fire(new h.t(new Error(`Layer with id "${c}" does not exist on this map.`)));S.slot===this._layers[c].slot?C=N:h.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,v),this._layerOrderChanged=!0,this._layers[v]=S;const k=this.getOwnLayerSourceCache(S),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&S.canCastShadows()&&F&&(k.castsShadows=!0);const z=this._changes.getRemovedLayer(S);if(z&&S.source&&k&&"custom"!==S.type){this._changes.discardLayerRemoval(S);const N=h.av(S.source,S.scope);z.type!==S.type?this._changes.updateSourceCache(N,"clear"):(this._changes.updateSourceCache(N,"reload"),k.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),S.scope=this.scope,this.mergeLayers()}moveLayer(s,c){this._checkLoaded();const g=this._checkLayer(s);if(!g||s===c)return;const v=this._order.indexOf(s);this._order.splice(v,1);let S=this._order.length;if(c){const C=this._order.indexOf(c);if(-1===C)return void this.fire(new h.t(new Error(`Layer with id "${c}" does not exist on this map.`)));g.slot===this._layers[c].slot?S=C:h.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const c=this._checkLayer(s);if(!c)return;c.setEventedParent(null);const g=this._order.indexOf(s);this._order.splice(g,1),delete this._layers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const v=this.getOwnLayerSourceCache(c);if(v&&v.castsShadows){let S=!1;for(const C in this._layers)if(this._layers[C].source===c.source&&this._layers[C].canCastShadows()){S=!0;break}v.castsShadows=S}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const c in this._layers)if(this._layers[c].type===s)return!0;return!1}setLayerZoomRange(s,c,g){this._checkLoaded();const v=this._checkLayer(s);v&&(v.minzoom===c&&v.maxzoom===g||(null!=c&&(v.minzoom=c),null!=g&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,c){this._checkLoaded();const g=this._checkLayer(s);g&&g.slot!==c&&(g.slot=c,this._updateLayer(g))}setFilter(s,c,g={}){this._checkLoaded();const v=this._checkLayer(s);if(v&&!h.bi(v.filter,c))return null==c?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(le,`layers.${v.id}.filter`,c,{layerType:v.type},g)||(v.filter=h.cm(c),this._updateLayer(v)))}getFilter(s){const c=this._checkLayer(s);if(c)return h.cm(c.filter)}setLayoutProperty(s,c,g,v={}){this._checkLoaded();const S=this._checkLayer(s);if(S&&!h.bi(S.getLayoutProperty(c),g)){if(null!=g&&(!v||!1!==v.validate)&&Go(S,Me.call(Ha,{key:`layers.${s}.layout.${c}`,layerType:S.type,objectKey:c,value:g,styleSpec:h._,style:{glyphs:!0,sprite:!0}})))return;S.setLayoutProperty(c,g),0!==S.configDependencies.size&&this._configDependentLayers.add(S.fqid),this._updateLayer(S)}}getLayoutProperty(s,c){const g=this._checkLayer(s);if(g)return g.getLayoutProperty(c)}setPaintProperty(s,c,g,v={}){this._checkLoaded();const S=this._checkLayer(s);if(!S||h.bi(S.getPaintProperty(c),g)||null!=g&&(!v||!1!==v.validate)&&Go(S,fe.call(Ha,{key:`layers.${s}.paint.${c}`,layerType:S.type,objectKey:c,value:g,styleSpec:h._})))return;const C=S.setPaintProperty(c,g);0!==S.configDependencies.size&&this._configDependentLayers.add(S.fqid),C&&this._updateLayer(S),this._changes.updatePaintProperties(S)}getPaintProperty(s,c){const g=this._checkLayer(s);if(g)return g.getPaintProperty(c)}setFeatureState(s,c){this._checkLoaded();const g=s.featureset;if(g){if("featuresetId"in g){const z=this.getFragmentStyle(g.importId),N=z.getFeaturesetLayers(g.featuresetId);for(const{source:U,sourceLayer:q}of N)z.setFeatureState({id:s.id,source:U,sourceLayer:q},c)}else if("layerId"in g){const z=this.getLayer(g.layerId);this.setFeatureState({id:s.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const v=s.source,S=s.sourceLayer,C=this._checkSource(v);if(!C)return;const k=C.type;if("geojson"===k&&S)return void this.fire(new h.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===k&&!S)return void this.fire(new h.t(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===s.id&&this.fire(new h.t(new Error("The feature id parameter must be provided.")));const F=this.getOwnSourceCaches(v);for(const z of F)z.setFeatureState(S,s.id,c)}removeFeatureState(s,c){this._checkLoaded();const g=s.featureset;if(g){if("featuresetId"in g){const z=this.getFragmentStyle(g.importId),N=z.getFeaturesetLayers(g.featuresetId);for(const{source:U,sourceLayer:q}of N)z.removeFeatureState({id:s.id,source:U,sourceLayer:q},c)}else if("layerId"in g){const z=this.getLayer(g.layerId);this.removeFeatureState({id:s.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const v=s.source,S=this._checkSource(v);if(!S)return;const C=S.type,k="vector"===C?s.sourceLayer:void 0;if("vector"===C&&!k)return void this.fire(new h.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof s.id&&"number"!=typeof s.id)return void this.fire(new h.t(new Error("A feature id is required to remove its specific state property.")));const F=this.getOwnSourceCaches(v);for(const z of F)z.removeFeatureState(k,s.id,c)}getFeatureState(s){this._checkLoaded();const c=s.featureset;if(c){let C;if("featuresetId"in c){const k=this.getFragmentStyle(c.importId),F=k.getFeaturesetLayers(c.featuresetId);for(const{source:z,sourceLayer:N}of F){const U=k.getFeatureState({id:s.id,source:z,sourceLayer:N});if(U&&!C)C=U;else if(!h.bi(C,U))return void this.fire(new h.t(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s){const k=this.getLayer(c.layerId);C=this.getFeatureState({id:s.id,source:k.source,sourceLayer:k.sourceLayer})}return C}const g=s.source,v=s.sourceLayer,S=this._checkSource(g);if(S){if("vector"!==S.type||v)return void 0===s.id&&this.fire(new h.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(g)[0].getFeatureState(v,s.id);this.fire(new h.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=h.l({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return h.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),c=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return h.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>void 0!==g)}_updateFilteredLayers(s){for(const c of Object.values(this._mergedLayers))s(c)&&this._updateLayer(c)}_updateLayer(s){this._changes.updateLayer(s);const c=this.getLayerSourceCache(s),g=h.av(s.source,s.scope),v=this._changes.getUpdatedSourceCaches();s.source&&!v[g]&&c&&"raster"!==c.getSource().type&&(this._changes.updateSourceCache(g,"reload"),c.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const c=k=>this._mergedLayers[k].is3D(),g=this.order,v={},S=[];for(let k=g.length-1;k>=0;k--){const F=g[k];if(c(F)){v[F]=k;for(const z of s){const N=z[F];if(N)for(const U of N)S.push(U)}}}S.sort((k,F)=>F.intersectionZ-k.intersectionZ);const C=[];for(let k=g.length-1;k>=0;k--){const F=g[k];if(c(F))for(let z=S.length-1;z>=0;z--){const N=S[z].feature;if(N.layer&&v[N.layer.id]<k)break;C.push(N),S.pop()}else for(const z of s){const N=z[F];if(N)for(const U of N)C.push(U.feature)}}return C}queryRenderedFeatures(s,c,g){c&&!Array.isArray(c)&&c.filter&&this._validate(le,"queryRenderedFeatures.filter",c.filter,null,c);let v,S=!1;const C=new Set;if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new h.t(new Error("parameters.layers must be an Array."))),[];v=[];for(const N of c.layers){const U=this._mergedLayers[N];if(!U)return this.fire(new h.t(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];U.is3D()&&(S=!0),C.add(U.source),v.push(N)}}else S=this.has3DLayers();const k=this._queryRenderedFeatures(s,g,{layerIds:v,filter:c.filter,has3DLayers:S,includedSources:C}),F=this._flattenAndSortRenderedFeatures(k),z=[];for(const N of F)h.co(N.layer.id)===this.scope&&z.push(N);return z}queryRenderedFeaturesForInteractions(s,c,g){let v=[];for(const{featureset:F,filter:z,radius:N}of c){let U=!1;const q=[],W=new Set;if("featuresetId"in F){const K=this.getFeaturesetLayers(F.featuresetId,F.importId);if(0===K.length)continue;for(const re of K)re.is3D()&&(U=!0),W.add(re.source),q.push(re.fqid)}else if("layerId"in F){const K=this._mergedLayers[F.layerId];if(!K)return this.fire(new h.t(new Error(`The layer '${F.layerId}' does not exist in the map's style and cannot be queried for features.`))),[];K.is3D()&&(U=!0),W.add(K.source),q.push(F.layerId)}let ee=s;if(N)if(s instanceof h.P||"number"==typeof s[0]){const K=h.P.convert(s);ee=[[K.x-N,K.y-N],[K.x+N,K.y+N]]}else{const K=h.P.convert(s[0]),re=h.P.convert(s[1]);ee=[[K.x-N,K.y-N],[re.x+N,re.y+N]]}v=v.concat(this._queryRenderedFeatures(ee,g,{layerIds:q,filter:z,has3DLayers:U,includedSources:W}))}const S=this._flattenAndSortRenderedFeatures(v),C=(F,z,N)=>{const U=F.clone();if(delete U.layer,U.featureset=z,N&&N.featureNamespace&&(U.namespace=N.featureNamespace),N&&N.properties){const q={},W=this.map.transform.zoom;for(const ee of Object.keys(N.properties)){const K=N.properties[ee].evaluate({zoom:W},F._vectorTileFeature,F.state,F.tile,this._availableImages);null!=K&&(q[ee]=K)}U.properties=q}return U},k=[];for(const F of S){const z=F.layer.id,N=h.cn(z),U=h.co(z);for(const{featureset:q}of c){if("layerId"in q&&q.layerId!==z)continue;if("layerId"in q&&q.layerId===z){const ee=C(F,q);k.push(ee);continue}if("featuresetId"in q&&(q.importId!==U||!this.getFeaturesetLayers(q.featuresetId,q.importId).map(ee=>ee.id).includes(N)))continue;const W=this._mergedLayerSelectors.get(z)||[];for(const ee of W){const K=C(F,q,ee);k.push(K)}}}return k}_queryRenderedFeatures(s,c,g){const{layerIds:v,filter:S,has3DLayers:C,includedSources:k}=g,F=[],z=Pi.createFromScreenPoints(s,c);for(const N in this._mergedSourceCaches){if(!this._mergedSourceCaches[N].getSource())continue;const U=this._mergedSourceCaches[N].getSource().id;v&&!k.has(U)||F.push(ig(this._mergedSourceCaches[N],this._mergedLayers,z,S,v||[],this._availableImages,c,C,!!this.map._showQueryGeometry))}return this.placement&&F.push(function(N,U,q,W,ee,K,re,ie){const ge={},xe=re.queryRenderedSymbols(q),ve=[];for(const Ee of Object.keys(xe).map(Number))ve.push(ie[Ee]);ve.sort(Yu);for(const Ee of ve){const Ae=Ee.featureIndex.lookupSymbolFeatures(xe[Ee.bucketInstanceId],Ee.bucketIndex,Ee.sourceLayerIndex,W,ee,K,N);for(const Ie in Ae){const Re=ge[Ie]=ge[Ie]||[],Fe=Ae[Ie];Fe.sort((He,ze)=>{const Ne=Ee.featureSortOrder;if(Ne){const ut=Ne.indexOf(He.featureIndex);return Ne.indexOf(ze.featureIndex)-ut}return ze.featureIndex-He.featureIndex});for(const He of Fe)Re.push(He)}}for(const Ee in ge)ge[Ee].forEach(Ae=>{const Ie=Ae.feature,Re=N[Ee],Fe=U(Re);if(!Fe)return;const He=Fe.getFeatureState(Ie.layer["source-layer"],Ie.id);Ie.state=He,h.aK(Re.id)||(Ie.source=Ie.layer.source,Ie.layer["source-layer"]&&(Ie.sourceLayer=Ie.layer["source-layer"]))});return ge}(this._mergedLayers,this.getLayerSourceCache.bind(this),z.screenGeometry,S,v||[],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData)),F}querySourceFeatures(s,c){const g=c&&c.filter;g&&this._validate(le,"querySourceFeatures.filter",g,null,c);let v=[];const S=this.getOwnSourceCaches(s);for(const C of S)v=v.concat(Cf(C,c));return v}addSourceType(s,c,g){return Xs.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(Xs.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,c,g={}){this._checkLoaded();const v=this.light.getLight();let S=!1;for(const k in s)if(!h.bi(s[k],v[k])){S=!0;break}if(!S)return;const C=this._getTransitionParameters();this.light.setLight(s,c,g),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=h.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&h.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,c=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===c&&delete this.terrain,null===s?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=s;const v=null==s.source;if(1===c){if(this.disableElevatedTerrain)return;if("object"==typeof g.source){const k="terrain-dem-src";this.addSource(k,g.source),g=h.cm(g),g=h.l(g,{source:k})}const S=h.l({},g),C={};if(this.terrain&&v){S.source=this.terrain.get().source;const k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(C.style=k.serialize())}if(this._validate(zd,"terrain",S,C))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&c!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,c),this.fire(new h.x("data",{dataType:"style"}))}else{const S=this.terrain,C=S.get();for(const k of Object.keys(h._.terrain))!g.hasOwnProperty(k)&&h._.terrain[k].default&&(g[k]=h._.terrain[k].default);for(const k in s)if(!h.bi(s[k],C[k])){S.set(s,this.options),this.stylesheet.terrain=s;const F=this._getTransitionParameters({duration:0});S.updateTransitions(F),this.fire(new h.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const c=this.fog=new gi(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!h.bi(c.get(),s)){c.set(s,this.options),this.stylesheet.fog=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}}else this._createFog(s);this._markersNeedUpdate=!0}setColorTheme(s){this._checkLoaded();const c=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=s,!s)return this._styleColorTheme.lut=null,void c();const g=this._evaluateColorThemeData(s);this._loadColorTheme(g).then(()=>{this.fire(new h.x("colorthemeset")),c()}).catch(v=>{h.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(s){return{now:h.q.now(),transition:h.l(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],c=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?s.push(g):c.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...c)}_createTerrain(s,c){const g=this.terrain=new _t(s,c,this.scope,this.options);1===c&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const s in this._layers){const c=this._layers[s];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const c=this._layers[s];"symbol"===c.type&&this._updateLayer(c)}}_validate(s,c,g,v,S={}){if(S&&!1===S.validate)return!1;const C=h.l({},this.serialize());return Go(this,s.call(Ha,h.l({key:c,style:C,value:g,styleSpec:h._},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(s){const c=this.getSourceCaches(s);for(const g of c)g.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){const c=this.getSourceCaches(s);for(const g of c)g.resume(),g.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}updateSources(s){let c;this.directionalLight&&(c=kf(this.directionalLight));for(const g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(s,void 0,void 0,c)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const c=this._sourceCaches[s];c.resume(),c.reload()}}_updatePlacement(s,c,g,v,S,C,k=!1){let F=!1,z=!1;const N={},U={};for(const q of this._mergedOrder){const W=this._mergedLayers[q];if("symbol"!==W.type)continue;const ee=h.av(W.source,W.scope);let K=N[ee];if(!K){const ie=this.getLayerSourceCache(W);if(!ie)continue;const ge=ie.getRenderableIds(!0).map(xe=>ie.getTileByID(xe));U[ee]=ge.slice(),K=N[ee]=ge.sort((xe,ve)=>ve.tileID.overscaledZ-xe.tileID.overscaledZ||(xe.tileID.isLessThan(ve.tileID)?-1:1))}const re=this.crossTileSymbolIndex.addLayer(W,K,c.center.lng,c.projection);F=F||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),k=k||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new h.x("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.q.now(),c.zoom))&&(this.pauseablePlacement=new Mf(c,this._mergedOrder,k,g,v,S,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,N,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.q.now()),z=!0),F&&this.pauseablePlacement.placement.setStale()),z||F){this._buildingIndex.onNewFrame(c.zoom);for(let q=0;q<this._mergedOrder.length;q++){const W=this._mergedLayers[this._mergedOrder[q]];if("symbol"!==W.type)continue;const ee=this.isLayerClipped(W);this.placement.updateLayerOpacities(W,N[h.av(W.source,W.scope)],q,ee?C:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.q.now())}}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,c){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==g.findIndex(({id:S})=>S===s.id))return void this.fire(new h.t(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!c)return g.push(s),this._loadImports([s],!0);const v=g.findIndex(({id:S})=>S===c);return-1===v&&this.fire(new h.t(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(s).concat(g.slice(v)),this._loadImports([s],!0,c)}updateImport(s,c){this._checkLoaded();const g=this.stylesheet.imports||[],v=this.getImportIndex(s);return-1===v?this:"string"==typeof c?(this.setImportUrl(s,c),this):(c.url&&c.url!==g[v].url&&this.setImportUrl(s,c.url),h.bi(c.config,g[v].config)||this.setImportConfig(s,c.config),h.bi(c.data,g[v].data)||this.setImportData(s,c.data),this)}moveImport(s,c){this._checkLoaded();let g=this.stylesheet.imports||[];const v=this.getImportIndex(s);if(-1===v)return this;const S=this.getImportIndex(c);if(-1===S)return this;const C=g[v],k=this.fragments[v];return g=g.filter(({id:F})=>F!==s),this.fragments=this.fragments.filter(({id:F})=>F!==s),this.stylesheet.imports=g.slice(0,S).concat(C).concat(g.slice(S)),this.fragments=this.fragments.slice(0,S).concat(k).concat(this.fragments.slice(S)),this.mergeLayers(),this}setImportUrl(s,c){this._checkLoaded();const g=this.stylesheet.imports||[],v=this.getImportIndex(s);if(-1===v)return this;g[v].url=c;const S=this.fragments[v];return S.style=this._createFragmentStyle(g[v]),S.style.on("style.import.load",()=>this.mergeAll()),S.style.loadURL(c),this}setImportData(s,c){this._checkLoaded();const g=this.getImportIndex(s),v=this.stylesheet.imports||[];return-1===g?this:c?(this.fragments[g].style.setState(c),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(s,v[g].url))}setImportConfig(s,c){this._checkLoaded();const g=this.getImportIndex(s),v=this.stylesheet.imports||[];if(-1===g)return this;c?v[g].config=c:delete v[g].config;const S=this.fragments[g],C=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=c,S.style.updateConfig(c,C),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const c=this.stylesheet.imports||[],g=this.getImportIndex(s);-1!==g&&(c.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(s){const c=(this.stylesheet.imports||[]).findIndex(g=>g.id===s);return-1===c&&this.fire(new h.t(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),c}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const c in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[c];g&&s.push(g.getSource())}return s}getSource(s,c){const g=this.getSourceCache(s,c);return g&&g.getSource()}getLayerSource(s){const c=this.getLayerSourceCache(s);return c&&c.getSource()}getSourceCache(s,c){const g=h.av(s,c);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(s){const c=h.av(s.source,s.scope);return"symbol"===s.type?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(s){if(null==s)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[s]&&c.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&c.push(this._mergedSymbolSourceCaches[s]),c}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const c in s){const g=s[c];"reload"===g?this.reloadSource(c):"clear"===g&&this.clearSource(c)}}updateLayers(s){const c=this._changes.getUpdatedPaintProperties();for(const g of c){const v=this.getLayer(g);v&&v.updateTransitions(s)}}getImages(s,c,g){this.imageManager.getImages(c.icons,c.scope,g),this._updateTilesForChangedImages();const v=S=>{S&&S.setDependencies(c.tileID.key,c.type,c.icons)};v(this._otherSourceCaches[c.source]),v(this._symbolSourceCaches[c.source])}getGlyphs(s,c,g){this.glyphManager.getGlyphs(c.stacks,c.scope,g)}getResource(s,c,g){return h.ct(c,g)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return"symbol"===s.type?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const c=[];return this._otherSourceCaches[s]&&c.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&c.push(this._symbolSourceCaches[s]),c}_isSourceCacheLoaded(s){const c=this.getOwnSourceCaches(s);return 0===c.length?(this.fire(new h.t(new Error(`There is no source with ID '${s}'`))),!1):c.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,c){if(!this._clipLayerPresent&&"fill-extrusion"!==s.type)return!1;const g="fill-extrusion"===s.type&&"building"===s.sourceLayer;if(s.is3D()){if(g||c&&"batched-model"===c.type||"model"===s.type)return!0}else if("symbol"===s.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Xs.getSourceType=function(m){return Vd[m]},Xs.setSourceType=function(m,s){Vd[m]=s},Xs.registerForPluginStateChange=h.cd;var Xd="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",pr="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",Zd="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Pc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Lf="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",pu="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Zs="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Yd="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",fu="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",bl="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",nc="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Kh=[];ic(Xd,Kh),ic(Zd,Kh),ic(pr,Kh);const To={"_prelude_fog.vertex.glsl":pu,"_prelude_terrain.vertex.glsl":Lf,"_prelude_shadow.vertex.glsl":bl,"_prelude_fog.fragment.glsl":Zs,"_prelude_shadow.fragment.glsl":nc,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Yd,"_prelude_raster_particle.glsl":fu},Jd={};qi("",Lf),qi(Zs,pu),qi(nc,bl),qi(Yd,""),qi(fu,"");const Qh=qi(pr,Zd),Ys=Xd;var zs={background:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:qi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qi('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:qi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:qi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:qi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:qi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:qi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:qi('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:qi("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:qi("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin float a_z_offset;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LINE_JOIN_NONE\nfloat pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin float a_z_offset;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef LINE_JOIN_NONE\nv_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:qi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:qi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:qi('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:qi('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;\n#else\nz+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n}'),terrainRaster:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:qi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:qi('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Pc),skyboxGradient:qi('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Pc),skyboxCapture:qi("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:qi('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:qi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:qi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:qi("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:qi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:qi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),occlusion:qi("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function ic(m,s){const c=m.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let g of c)if(g=g.trim(),"#"===g[0]&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=g.split(" ");for(const S of v)s.includes(S)||s.push(S)}}function qi(m,s){const c=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let v=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(z=>{const N=z.split(" ");return N[N.length-1]}),v=[...new Set(v)]);const S={},C=[],k=[];if(m=m.replace(c,(z,N)=>(k.push(N),"")),(s=s.replace(c,(z,N)=>(C.push(N),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let F=[...Kh];ic(m,F),ic(s,F);for(const z of[...C,...k])To[z]||console.error(`Undefined include: ${z}`),Jd[z]||(Jd[z]=[],ic(To[z],Jd[z])),F=[...F,...Jd[z]];return{fragmentSource:m=m.replace(g,(z,N,U,q,W)=>(S[W]=!0,"define"===N?`\n#ifndef HAS_UNIFORM_u_${W}\nin ${U} ${q} ${W};\n#else\nuniform ${U} ${q} u_${W};\n#endif\n`:"initialize"===N?`\n#ifdef HAS_UNIFORM_u_${W}\n    ${U} ${q} ${W} = u_${W};\n#endif\n`:"define-attribute"===N?`\n#ifdef HAS_ATTRIBUTE_a_${W}\n    in ${U} ${q} ${W};\n#endif\n`:"initialize-attribute"===N?"":void 0)),vertexSource:s=s.replace(g,(z,N,U,q,W)=>{const ee="float"===q?"vec2":q,K=W.match(/color/)?"color":ee;return"define-attribute-vertex-shader-only"===N?`\n#ifdef HAS_ATTRIBUTE_a_${W}\nin ${U} ${q} a_${W};\n#endif\n`:S[W]?"define"===N?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nin ${U} ${ee} a_${W};\nout ${U} ${q} ${W};\n#else\nuniform ${U} ${q} u_${W};\n#endif\n`:"initialize"===N?"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = a_${W};\n#else\n    ${U} ${q} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = unpack_mix_${K}(a_${W}, u_${W}_t);\n#else\n    ${U} ${q} ${W} = u_${W};\n#endif\n`:"define-attribute"===N?`\n#ifdef HAS_ATTRIBUTE_a_${W}\n    in ${U} ${q} a_${W};\n    out ${U} ${q} ${W};\n#endif\n`:"initialize-attribute"===N?`\n#ifdef HAS_ATTRIBUTE_a_${W}\n    ${W} = a_${W};\n#endif\n`:void 0:"define"===N?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nin ${U} ${ee} a_${W};\n#else\nuniform ${U} ${q} u_${W};\n#endif\n`:"define-instanced"===N?"mat4"===K?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${W}0;\nin vec4 a_${W}1;\nin vec4 a_${W}2;\nin vec4 a_${W}3;\n#else\nuniform ${U} ${q} u_${W};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${U} ${ee} a_${W};\n#else\nuniform ${U} ${q} u_${W};\n#endif\n`:"initialize-attribute-custom"===N?`\n#ifdef HAS_ATTRIBUTE_a_${W}\n    ${U} ${q} ${W} = a_${W};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${U} ${q} ${W} = a_${W};\n#else\n    ${U} ${q} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${U} ${q} ${W} = unpack_mix_${K}(a_${W}, u_${W}_t);\n#else\n    ${U} ${q} ${W} = u_${W};\n#endif\n`}),staticAttributes:v,usedDefines:F,vertexIncludes:C,fragmentIncludes:k}}class kc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,c,g,v,S,C,k,F){this.context=s;let z=this.boundPaintVertexBuffers.length!==v.length;for(let U=0;!z&&U<v.length;U++)this.boundPaintVertexBuffers[U]!==v[U]&&(z=!0);let N=this.boundDynamicVertexBuffers.length!==k.length;for(let U=0;!N&&U<k.length;U++)this.boundDynamicVertexBuffers[U]!==k[U]&&(N=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==g||z||N||this.boundIndexBuffer!==S||this.boundVertexOffset!==C)this.freshBind(c,g,v,S,C,k,F);else{s.bindVertexArrayOES.set(this.vao);for(const U of k)U&&(U.bind(),F&&U.instanceCount&&U.setVertexAttribDivisor(s.gl,c,F));S&&S.dynamicDraw&&S.bind()}}freshBind(s,c,g,v,S,C,k){const F=s.numAttributes,z=this.context,N=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=C,c.enableAttributes(N,s),c.bind(),c.setVertexAttribPointers(N,s,S);for(const U of g)U.enableAttributes(N,s),U.bind(),U.setVertexAttribPointers(N,s,S);for(const U of C)U&&(U.enableAttributes(N,s),U.bind(),U.setVertexAttribPointers(N,s,S),k&&U.instanceCount&&U.setVertexAttribDivisor(N,s,k));v&&v.bind(),z.currentNumAttributes=F}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Sa(m,s){const c=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new h.a5(0,g/c).toLngLat().lat,new h.a5(0,(g+1)/c).toLngLat().lat]}function Of(m,s,c,g,v,S,C){const k=m.context,F=k.gl,z=c.hillshadeFBO;if(!z)return;m.prepareDrawTile();const N=m.isTileAffectedByFog(s),U=m.getOrCreateProgram("hillshade",{overrideFog:N});k.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,z.colorAttachment.get());const q=((re,ie,ge,xe)=>{const ve=ge.paint.get("hillshade-shadow-color"),Ee=ge.paint.get("hillshade-highlight-color"),Ae=ge.paint.get("hillshade-accent-color"),Ie=ge.paint.get("hillshade-emissive-strength");let Re=h.bC(ge.paint.get("hillshade-illumination-direction"));if("viewport"===ge.paint.get("hillshade-illumination-anchor"))Re-=re.transform.angle;else if(re.style&&re.style.enable3dLights()&&re.style.directionalLight){const He=re.style.directionalLight.properties.get("direction"),ze=h.c8(He.x,He.y,He.z);Re=h.bC(ze[1])}const Fe=!re.options.moving;return{u_matrix:xe||re.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),Fe),u_image:0,u_latrange:Sa(0,ie.tileID),u_light:[ge.paint.get("hillshade-exaggeration"),Re],u_shadow:ve.toRenderColor(ge.lut),u_highlight:Ee.toRenderColor(ge.lut),u_emissive_strength:Ie,u_accent:Ae.toRenderColor(ge.lut)}})(m,c,g,m.terrain?s.projMatrix:null);m.uploadCommonUniforms(k,U,s.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:ee,tileBoundsSegments:K}=m.getTileBoundsBuffers(c);U.draw(m,F.TRIANGLES,v,S,C,li.disabled,q,g.id,W,ee,K)}function Ff(m,s,c){if(!s.needsDEMTextureUpload)return;const g=m.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(c.stride);const S=c.getPixels();s.demTexture?s.demTexture.update(S,{premultiply:!1}):s.demTexture=new h.T(g,S,v.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Kd(m,s,c){const g=m.context,v=g.gl;if(!s.dem)return;const S=s.dem;if(g.activeTexture.set(v.TEXTURE1),Ff(m,s,S),!s.demTexture)return;s.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const C=S.dim;g.activeTexture.set(v.TEXTURE0);let k=s.hillshadeFBO;if(!k){const q=new h.T(g,{width:C,height:C,data:null},v.RGBA8);q.bind(v.LINEAR,v.CLAMP_TO_EDGE),k=s.hillshadeFBO=g.createFramebuffer(C,C,!0,"renderbuffer"),k.colorAttachment.set(q.texture)}g.bindFramebuffer.set(k.framebuffer),g.viewport.set([0,0,C,C]);const{tileBoundsBuffer:F,tileBoundsIndexBuffer:z,tileBoundsSegments:N}=m.getMercatorTileBoundsBuffers(),U=[];m.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(m,v.TRIANGLES,Vn.disabled,Jt.disabled,Si.unblended,li.disabled,((q,W)=>{const ee=W.stride,K=h.a6.mat4.create();return h.a6.mat4.ortho(K,0,h.ab,-h.ab,0,0,1),h.a6.mat4.translate(K,K,[0,-h.ab,0]),{u_matrix:K,u_image:1,u_dimension:[ee,ee],u_zoom:q.overscaledZ}})(s.tileID,S),c.id,F,z,N),s.needsHillshadePrepare=!1}class Gr{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ab extends Gr{getDefault(){return h.bA.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class kv extends Gr{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class lb extends Gr{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class cg extends Gr{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Nf extends Gr{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Lv extends Gr{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Ov extends Gr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Fv extends Gr{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class ep extends Gr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class Nv extends Gr{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Y1 extends Gr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class J1 extends Gr{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class K1 extends Gr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class cb extends Gr{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Bf extends Gr{getDefault(){return h.bA.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class tp extends Gr{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class ub extends Gr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class Bv extends Gr{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class zv extends Gr{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let Qu=class extends Gr{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class np extends Gr{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class ho extends Gr{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ug extends Gr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Ga extends Gr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class dg extends Gr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class ip extends Gr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class rp extends Gr{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class hg extends Gr{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class op extends Gr{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class zf extends Gr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Oa extends Gr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class ed extends Gr{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class Vf extends ed{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class sp extends ed{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class db extends ed{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class ap extends sp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Es=(m,s,c)=>({u_matrix:m,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:c}),hb=(m,s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:c,u_zoom_transition:v,u_merc_center:S,u_image0:0,u_frustum_tl:C,u_frustum_tr:k,u_frustum_br:F,u_frustum_bl:z,u_globe_pos:N,u_globe_radius:U,u_viewport:q,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9),u_skirt_height:W,u_far_z_cutoff:ee});function Vv(m,s){return null!=m&&null!=s&&!(!m.hasData()||!s.hasData())&&null!=m.demTexture&&null!=s.demTexture&&m.tileID.key!==s.tileID.key}const Lc=new class{constructor(){this.operations={}}newMorphing(m,s,c,g,v){if(m in this.operations){const S=this.operations[m];S.to.tileID.key!==c.tileID.key&&(S.queued=c)}else this.operations[m]={startTime:g,phase:0,duration:v,from:s,to:c,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const s=this.operations[m];return{from:s.from,to:s.to,phase:s.phase}}update(m){for(const s in this.operations){const c=this.operations[s];for(c.phase=(m-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,m)){delete this.operations[s];break}}}_nextOp(m,s){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=s,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Fa={0:null,1:"TERRAIN_VERTEX_MORPHING"};function pb(m,s,c){if(0===s)return 0;const g=s<1&&514===c?.25/s:1;return 6*Math.pow(1.5,22-m)*Math.max(s,1)*g}function lp(m,s){const c=1<<m.z;return!s&&(0===m.x||m.x===c-1)||0===m.y||m.y===c-1}const rc=m=>({u_matrix:m});function aa(m,s,c,g,v){if(v>0){const S=h.q.now(),C=(S-m.timeAdded)/v,k=s?(S-s.timeAdded)/v:-1,F=c.getSource(),z=g.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),N=!s||Math.abs(s.tileID.overscaledZ-z)>Math.abs(m.tileID.overscaledZ-z),U=N&&m.refreshedUponExpiration?1:h.ap(N?C:1-k,0,1);return m.refreshedUponExpiration&&C>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class Qd extends Cr{constructor(s){const c={type:"raster-dem",maxzoom:s.transform.maxZoom},g=new h.ce(h.cf(),null),v=Gh("mock-dem",c,g,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,c){s.state="loaded",c(null)}}class cp extends Cr{constructor(s){const c=Gh("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new h.ce(h.cf(),null),s.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,c,g){if(s.freezeTileCoverage)return;this.transform=s;const v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,C)=>{if(S[C.key]="",!this._tiles[C.key]){const k=new Rl(C,this._source.tileSize*C.overscaleFactor(),s.tileZoom);k.state="loaded",this._tiles[C.key]=k}return S},{});for(const S in this._tiles)S in v||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(s){const c=this.proxyCachedFBO[s];if(void 0!==c){const g=Object.values(c);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class pg extends h.aA{constructor(s,c,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=c,this.projMatrix=g}}class oc extends h.cE{constructor(s,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,S]=function(F){const z=new h.a$,N=new h.aP,U=131;z.reserve(17161),N.reserve(33800);const q=h.ab/128,W=h.ab+q/2,ee=W+q;for(let re=-q;re<ee;re+=q)for(let ie=-q;ie<ee;ie+=q){const ge=ie<0||ie>W||re<0||re>W?24575:0,xe=h.ap(Math.round(ie),0,h.ab),ve=h.ap(Math.round(re),0,h.ab);z.emplaceBack(xe+ge,ve)}const K=(re,ie)=>{const ge=ie*U+re;N.emplaceBack(ge+1,ge,ge+U),N.emplaceBack(ge+U,ge+U+1,ge+1)};for(let re=1;re<129;re++)for(let ie=1;ie<129;ie++)K(ie,re);return[0,129].forEach(re=>{for(let ie=0;ie<130;ie++)K(ie,re),K(re,ie)}),[z,N,32768]}(),C=s.context;this.gridBuffer=C.createVertexBuffer(g,h.b1.members),this.gridIndexBuffer=C.createIndexBuffer(v),this.gridSegments=h.b2.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=h.b2.simpleSegment(0,0,g.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new cp(c.map),this.orthoMatrix=h.a6.mat4.create(),h.a6.mat4.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,h.ab,0,h.ab,0,1);const k=C.gl;this._overlapStencilMode=new Jt({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qd(c.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,c,g){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const v=s.terrain.properties,S=0===s.terrain.drapeRenderMode,C=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=h.q.now();const k=s.terrain&&s.terrain.scope,F=v.get("source"),z=S?this._mockSourceCache:s.getSourceCache(F,k);if(!z)return void h.w(`Couldn't find terrain source "${F}".`);if(this.sourceCache=z,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=C?this.calculateExaggeration(c):v.get("exaggeration"),!c.projection.requiresDraping&&C&&0===this._exaggeration)return void this._disable();this.enabled=!0;const N=()=>{this.sourceCache.used&&h.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(c,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,N(),this._initializing=!0),N(),c.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const c=this._previousCameraAltitude,g=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=g;const v=null!=c?g-c:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const S=s.zoom,C=this._style.terrain;if(!this._previousUpdateTimestamp)return C.getExaggeration(S);let k=S-this._previousZoom;const F=this._previousUpdateTimestamp;let z=S;null!=this._evaluationZoom&&(z=this._evaluationZoom,Math.abs(S-z)>.5&&(k=.5*(S-z+k)),k*v<0&&(z+=k)),this._evaluationZoom=z;const N=C.getExaggeration(z),U=N===C.getExaggeration(Math.max(0,z-.1));if(U&&Math.abs(N-this._exaggeration)<.01)return N;let q=Math.min(.1,.00375*(this._updateTimestamp-F));return(U||N<.1||Math.abs(k)<1e-4)&&(q=Math.min(.2,4*q)),h.aa(this._exaggeration,N,q)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&"source"===s.dataType?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):"style"===s.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(h.a5.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=c.getIds().map(F=>{const z=c.getTileByID(F).tileID;return z.projMatrix=g.calculateProjMatrix(z.toUnwrapped()),z});!function(F,z){const N=z.transform.pointCoordinate(z.transform.getCameraPoint()),U=new h.P(N.x,N.y);F.sort((q,W)=>{if(W.overscaledZ-q.overscaledZ)return W.overscaledZ-q.overscaledZ;const ee=new h.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),K=new h.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),re=U.mult(1<<q.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(ee)-re.distSqr(K)})}(v,this.painter);const S=this.proxyToSource||{};this.proxyToSource={},v.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const C=this._style._mergedSourceCaches;for(const F in C){const z=C[F];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,s[F],S),z.usedForTerrain))continue;const N=s[F];z.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[c.id]=v.map(F=>new pg(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1;const k={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const z=this.terrainTileForTile[F.key];if(!z)continue;const N=z.tileID.key;N in k||(this._visibleDemTiles.push(z),k[N]=N)}}_assignTerrainTiles(s){this._initializing||s.forEach(c=>{if(this.terrainTileForTile[c.key])return;const g=this._findTileCoveringTileID(c,this.sourceCache);g&&(this.terrainTileForTile[c.key]=g)})}_prepareDEMTextures(){const s=this.painter.context,c=s.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],S=v.dem;!S||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(c.TEXTURE1),Ff(this.painter,v,S))}}_prepareDemTileUniforms(s,c,g,v){if(!c||null==c.demTexture)return!1;const S=s.tileID.canonical,C=Math.pow(2,c.tileID.canonical.z-S.z),k=v||"";return g[`u_dem_tl${k}`]=[S.x*C%1,S.y*C%1],g[`u_dem_scale${k}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const c=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const S=v.dem.tree.minimums[0];return S>0&&s++,g+S},0);return s?c/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,c=s.gl;s.activeTexture.set(c.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new h.cF({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(v,{premultiply:!1}):S=this._emptyDEMTexture=new h.T(s,v,c.R32F,{premultiply:!1}),S}setupElevationDraw(s,c,g){const v=this.painter.context,S=v.gl,C={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};C.u_exaggeration=this.exaggeration();let k=null,F=null,z=1;if(g&&g.morphing&&this._useVertexMorphing){const W=g.morphing.srcDemTile,ee=g.morphing.dstDemTile;z=g.morphing.phase,W&&ee&&(this._prepareDemTileUniforms(s,W,C,"_prev")&&(F=W),this._prepareDemTileUniforms(s,ee,C)&&(k=ee))}const N=W=>W&&W.demTexture&&this.painter.linearFloatFilteringSupported()?S.LINEAR:S.NEAREST;let U=null;var q;if(this.enabled?F&&k?(U=k.demTexture,v.activeTexture.set(S.TEXTURE4),F.demTexture.bind(N(F),S.CLAMP_TO_EDGE),C.u_dem_lerp=z):(k=this.terrainTileForTile[s.tileID.key],U=this._prepareDemTileUniforms(s,k,C)?k.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,v.activeTexture.set(S.TEXTURE2),U&&(C.u_dem_size=1===(q=U).size[0]?1:q.size[0]-2,U.bind(N(k),S.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,c,C),g&&g.useMeterToDem&&k){const W=(1<<k.tileID.canonical.z)*h.bE(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=W}if(g&&g.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),c.setTerrainUniformValues(v,C),"globe"===this.painter.transform.projection.name){const W=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);c.setGlobeUniformValues(v,W)}}globeUniformValues(s,c,g){const v=s.projection;return{u_tile_tl_up:v.upVector(c,0,0),u_tile_tr_up:v.upVector(c,h.ab,0),u_tile_br_up:v.upVector(c,h.ab,h.ab),u_tile_bl_up:v.upVector(c,0,h.ab),u_tile_up_scale:g?h.cG(1):v.upVectorScale(c,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const c=this.painter,g=this.painter.context;0!==s.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,S,C,k,F){if("globe"===v.transform.projection.name)!function(z,N,U,q,W){const ee=z.context,K=ee.gl;let re,ie;const ge=z.transform,xe=h.cx(z,ee,ge),ve=(ut,wt)=>{if(ie===wt)return;const zt=[Fa[wt],"PROJECTION_GLOBE_VIEW"];xe&&zt.push("CUSTOM_ANTIALIASING");const Zt=z.isTileAffectedByFog(ut);re=z.getOrCreateProgram("globeRaster",{defines:zt,overrideFog:Zt}),ie=wt},Ee=z.colorModeForRenderPass(),Ae=new Vn(K.LEQUAL,Vn.ReadWrite,z.depthRangeFor3D);Lc.update(W);const Ie=h.cy(ge),Re=[h.am(ge.center.lng),h.at(ge.center.lat)],Fe=z.globeSharedBuffers,He=[ge.width*h.q.devicePixelRatio,ge.height*h.q.devicePixelRatio],ze=Float32Array.from(ge.globeMatrix),Ne={useDenormalizedUpVectorScale:!0};{const ut=z.transform,wt=pb(ut.zoom,N.exaggeration(),N.sourceCache._source.tileSize);ie=-1;const zt=K.TRIANGLES;for(const Zt of q){const sn=U.getTile(Zt),Ke=Jt.disabled,Pt=N.prevTerrainTileForTile[Zt.key],bt=N.terrainTileForTile[Zt.key];Vv(Pt,bt)&&Lc.newMorphing(Zt.key,Pt,bt,W,250),ee.activeTexture.set(K.TEXTURE0),sn.texture&&sn.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const Ot=Lc.getMorphValuesForProxy(Zt.key),Ut=Ot?1:0;Ot&&h.C(Ne,{morphing:{srcDemTile:Ot.from,dstDemTile:Ot.to,phase:h.cw(Ot.phase)}});const Lt=h.cz(Zt.canonical),un=h.cA(Lt.getCenter().lat),Ln=h.cB(Zt.canonical,Lt,un,ut.worldSize/ut._pixelsPerMercatorPixel),zn=h.b6(h.cC(Zt.canonical)),Sn=hb(ut.expandedFarZProjMatrix,ze,Ie,zn,h.a9(ut.zoom),Re,ut.frustumCorners.TL,ut.frustumCorners.TR,ut.frustumCorners.BR,ut.frustumCorners.BL,ut.globeCenterInViewSpace,ut.globeRadius,He,wt,ut._farZ,Ln);if(ve(Zt,Ut),re&&(N.setupElevationDraw(sn,re,Ne),z.uploadCommonUniforms(ee,re,Zt.toUnwrapped()),Fe)){const[jn,pn,Yn]=Fe.getGridBuffers(un,0!==wt);re.draw(z,zt,Ae,Ke,Ee,li.backCCW,Sn,"globe_raster",jn,pn,Yn)}}}if(Fe&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const ut=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];xe&&ut.push("CUSTOM_ANTIALIASING"),re=z.getOrCreateProgram("globeRaster",{defines:ut});for(const wt of q){const{x:zt,y:Zt,z:sn}=wt.canonical,Ke=0===Zt,Pt=Zt===(1<<sn)-1,[bt,Ot,Ut,Lt]=Fe.getPoleBuffers(sn,!1);if(Lt&&(Ke||Pt)){const un=U.getTile(wt);ee.activeTexture.set(K.TEXTURE0),un.texture&&un.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let Ln=h.cD(sn,zt,ge);const zn=h.b6(h.cC(wt.canonical)),Sn=(jn,pn)=>jn.draw(z,K.TRIANGLES,Ae,Jt.disabled,Ee,li.disabled,hb(ge.expandedFarZProjMatrix,Ln,Ln,zn,0,Re,ge.frustumCorners.TL,ge.frustumCorners.TR,ge.frustumCorners.BR,ge.frustumCorners.BL,ge.globeCenterInViewSpace,ge.globeRadius,He,0,ge._farZ),"globe_pole_raster",pn,Ut,Lt);N.setupElevationDraw(un,re,Ne),z.uploadCommonUniforms(ee,re,wt.toUnwrapped()),Ke&&z.renderDefaultNorthPole&&Sn(re,bt),Pt&&z.renderDefaultSouthPole&&(Ln=h.a6.mat4.scale(h.a6.mat4.create(),Ln,[1,-1,1]),Sn(re,Ot))}}}}(v,S,C,k,F);else{const z=v.context,N=z.gl;let U,q;const W=v.shadowRenderer,ee=_l(v,v.longestCutoffRange),K=Ee=>{if(q===Ee)return;const Ae=[];Ae.push(Fa[Ee]),ee.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),W&&(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&Ae.push("NORMAL_OFFSET")),U=v.getOrCreateProgram("terrainRaster",{defines:Ae}),q=Ee},re=v.colorModeForRenderPass(),ie=new Vn(N.LEQUAL,Vn.ReadWrite,v.depthRangeFor3D);Lc.update(F);const ge=v.transform,xe=pb(ge.zoom,S.exaggeration(),S.sourceCache._source.tileSize);let ve=[0,0,0];if(W){const Ee=v.style.directionalLight,Ae=v.style.ambientLight;Ee&&Ae&&(ve=wa(v.style,Ee,Ae))}{q=-1;const Ee=N.TRIANGLES,[Ae,Ie]=[S.gridIndexBuffer,S.gridSegments];for(const Re of k){const Fe=C.getTile(Re),He=Jt.disabled,ze=S.prevTerrainTileForTile[Re.key],Ne=S.terrainTileForTile[Re.key];Vv(ze,Ne)&&Lc.newMorphing(Re.key,ze,Ne,F,250),z.activeTexture.set(N.TEXTURE0),Fe.texture&&Fe.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const ut=Lc.getMorphValuesForProxy(Re.key),wt=ut?1:0;let zt;ut&&(zt={morphing:{srcDemTile:ut.from,dstDemTile:ut.to,phase:h.cw(ut.phase)}});const Zt=Es(Re.projMatrix,lp(Re.canonical,ge.renderWorldCopies)?xe/10:xe,ve);if(K(wt),!U)continue;S.setupElevationDraw(Fe,U,zt);const sn=Re.toUnwrapped();W&&W.setupShadows(sn,U),v.uploadCommonUniforms(z,U,sn,null,ee),U.draw(v,Ee,ie,He,re,li.backCCW,Zt,"terrain_raster",S.gridBuffer,Ae,Ie)}}}}(c,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(0===this._drapedRenderBatches.length)return s+1;this.renderingToTexture=!0;const c=this.painter,g=this.painter.context,v=this.proxySourceCache,S=this.proxiedCoords[v.id],C=this._drapedRenderBatches.shift(),k=c.style.order,F=[];let z=0;for(const N of S){const U=v.getTileByID(N.proxyTileKey),q=v.proxyCachedFBO[N.key]?v.proxyCachedFBO[N.key][s]:void 0,W=void 0!==q?v.renderCache[q]:this.pool[z++],ee=void 0!==q;if(U.texture=W.tex,ee&&!W.dirty){F.push(U.tileID);continue}let K;g.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(g.clear({color:h.bA.transparent,stencil:0}),W.dirty=!1);for(let re=C.start;re<=C.end;++re){const ie=c.style._mergedLayers[k[re]];if(ie.isHidden(c.transform.zoom))continue;const ge=c.style.getLayerSourceCache(ie),xe=ge?this.proxyToSource[N.key][ge.id]:[N];if(!xe)continue;const ve=xe;g.viewport.set([0,0,W.fb.width,W.fb.height]),K!==(ge?ge.id:null)&&(this._setupStencil(W,xe,ie,ge),K=ge?ge.id:null),c.renderLayer(c,ge,ie,ve)}if(0===this._drapedRenderBatches.length)for(const re of this._pendingGroundEffectLayers){const ie=c.style._mergedLayers[k[re]];if(ie.isHidden(c.transform.zoom))continue;const ge=c.style.getLayerSourceCache(ie),xe=ge?this.proxyToSource[N.key][ge.id]:[N];if(!xe)continue;const ve=xe;g.viewport.set([0,0,W.fb.width,W.fb.height]),K!==(ge?ge.id:null)&&(this._setupStencil(W,xe,ie,ge),K=ge?ge.id:null),c.renderLayer(c,ge,ie,ve)}this.renderedToTile?(W.dirty=!0,F.push(U.tileID)):ee||--z,5===z&&(z=0,this.renderToBackBuffer(F))}return this.renderToBackBuffer(F),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),C.end+1}postRender(){}isLayerOrderingCorrect(s){const c=s.order.length;let g=-1,v=c;for(let S=0;S<c;++S)this._style.isLayerDraped(s._mergedLayers[s.order[S]])?g=Math.max(g,S):v=Math.min(v,S);return v>g}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{s=Math.min(s,c.dem.tree.minimums[0])}),0===s?s:(s-30)*this._exaggeration}raycast(s,c,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const C=S.tileID,k=1<<C.overscaledZ,{x:F,y:z}=C.canonical,N=F/k,U=(F+1)/k,q=z/k,W=(z+1)/k;return{minx:N,miny:q,maxx:U,maxy:W,t:S.dem.tree.raycastRoot(N,q,U,W,s,c,g),tile:S}});v.sort((S,C)=>(null!==S.t?S.t:Number.MAX_VALUE)-(null!==C.t?C.t:Number.MAX_VALUE));for(const S of v){if(null==S.t)return null;const C=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,s,c,g);if(null!=C)return C}return null}_createFBO(){const s=this.painter.context,c=s.gl,g=this.drapeBufferSize;s.activeTexture.set(c.TEXTURE0);const v=new h.T(s,{width:g[0],height:g[1],data:null},c.RGBA8);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);const S=s.createFramebuffer(g[0],g[1],!0,null);return S.colorAttachment.set(v.texture),S.depthAttachment=new ap(s,S.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:S,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const c=this._style._mergedLayers[s],g=c.isHidden(this.painter.transform.zoom);return"hillshade"===c.type||"custom"===c.type?!g&&c.shouldRedrape():!g&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const g of this._style.getSources())if(g instanceof Ws){s=!0;break}if(!s)return;const c={};for(let g=0;g<this._style.order.length;++g){const v=this._style._mergedLayers[this._style.order[g]],S=this._style.getLayerSourceCache(v);if(S&&!c[S.id]&&!v.isHidden(this.painter.transform.zoom)&&"line"===v.type&&v.widthExpression()instanceof h.a4){c[S.id]=!0;for(const C of this.proxyCoords){const k=this.proxyToSource[C.key][S.id];if(k)for(const F of k)this._clearRenderCacheForTile(S.id,F)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof lu){s=!0;break}if(!s)return;const c={};for(let g=0;g<this._style.order.length;++g){const v=this._style._mergedLayers[this._style.order[g]],S=this._style.getLayerSourceCache(v);if(!S||c[S.id]||v.isHidden(this.painter.transform.zoom)||"raster"!==v.type)continue;const C=v.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const F=this.proxyToSource[k.key][S.id];if(F)for(const z of F){const N=aa(S.getTile(z),S.findLoadedParent(z,0),S,this.painter.transform,C);(1!==N.opacity||0!==N.mix)&&this._clearRenderCacheForTile(S.id,z)}}}}_setupDrapedRenderBatches(){const s=this._style.order,c=s.length;if(0===c)return;const g=[];this._pendingGroundEffectLayers=[];let v,S=0,C=this._style._mergedLayers[s[S]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++S<c;)C=this._style._mergedLayers[s[S]];for(;S<c;++S){const k=this._style._mergedLayers[s[S]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?void 0===v&&(v=S):("fill-extrusion"===k.type&&this._pendingGroundEffectLayers.push(S),void 0!==v&&(g.push({start:v,end:S-1}),v=void 0)))}if(void 0!==v&&g.push({start:v,end:S-1}),0!==g.length){const k=g[g.length-1];this._pendingGroundEffectLayers.every(F=>F>k.end)||h.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(s){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const C=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let k=0;k<C.length;++k){const F=Object.values(C[k]);c.renderCachePool.push(...F)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let C=g.length-1;C>=0;C--){const k=g[C];if(c.getTileByID(k.key),void 0!==c.proxyCachedFBO[k.key]){const F=s[k.key],z=this.proxyToSource[k.key];let N=0;for(const U in z){const q=z[U],W=F[U];if(!W||W.length!==q.length||q.some((ee,K)=>ee!==W[K]||v[U]&&v[U].hasOwnProperty(ee.key))){N=-1;break}++N}for(const U in c.proxyCachedFBO[k.key])c.renderCache[c.proxyCachedFBO[k.key][U]].dirty=N<0||N!==Object.values(F).length}}const S=[...this._drapedRenderBatches];S.sort((C,k)=>k.end-k.start-(C.end-C.start));for(const C of S)for(const k of g){if(c.proxyCachedFBO[k.key])continue;let F=c.renderCachePool.pop();void 0===F&&c.renderCache.length<50&&(F=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==F&&(c.proxyCachedFBO[k.key]={},c.proxyCachedFBO[k.key][C.start]=F,c.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(s,c,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,C=S.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let k;if(g.isTileClipped())k=c.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):Jt.disabled}_renderTileClippingMasks(s,c){const g=this.painter,v=this.painter.context,S=v.gl;g._tileClippingMaskIDs={},v.setColorMode(Si.disabled),v.setDepthMode(Vn.disabled);const C=g.getOrCreateProgram("clippingMask");for(const k of s){const F=g._tileClippingMaskIDs[k.key]=--c;C.draw(g,S.TRIANGLES,Vn.disabled,new Jt({func:S.ALWAYS,mask:0},F,255,S.KEEP,S.KEEP,S.REPLACE),Si.disabled,li.disabled,rc(k.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){const c=this.painter.transform;if(s.x<0||s.x>c.width||s.y<0||s.y>c.height)return null;const g=[s.x,s.y,1,1];h.a6.vec4.transformMat4(g,g,c.pixelMatrixInverse),h.a6.vec4.scale(g,g,1/g[3]),g[0]/=c.worldSize,g[1]/=c.worldSize;const v=c._camera.position,S=h.bE(1,c.center.lat),C=[v[0],v[1],v[2]/S,0],k=h.a6.vec3.subtract([],g.slice(0,3),C);h.a6.vec3.normalize(k,k);const F=this.raycast(C,k,this._exaggeration);return null!==F&&F?(h.a6.vec3.scaleAndAdd(C,C,k,F),C[3]=C[2],C[2]*=S,C):null}_setupProxiedCoordsForOrtho(s,c,g){if(s.getSource()instanceof h.aD)return this._setupProxiedCoordsForImageSource(s,c,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const v=this.proxiedCoords[s.id]=[],S=this.proxyCoords;for(let F=0;F<S.length;F++){const z=S[F],N=this._findTileCoveringTileID(z,s);if(N){const U=this._createProxiedId(z,N,g[z.key]&&g[z.key][s.id]);v.push(U),this.proxyToSource[z.key][s.id]=[U]}}let C=!1;const k=new Set;for(let F=0;F<c.length;F++){const z=s.getTile(c[F]);if(!z||!z.hasData())continue;const N=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==z.tileID.canonical.z){const U=this.proxyToSource[N.tileID.key][s.id],q=this._createProxiedId(N.tileID,z,g[N.tileID.key]&&g[N.tileID.key][s.id]);U?U.splice(U.length-1,0,q):this.proxyToSource[N.tileID.key][s.id]=[q];const W=this.proxyToSource[N.tileID.key][s.id];k.has(W)||k.add(W),v.push(q),C=!0}}if(this._sourceTilesOverlap[s.id]=C,C&&this._debugParams.sortTilesHiZFirst)for(const F of k)F.sort((z,N)=>N.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(s,c,g){if(!s.getSource().loaded())return;const v=this.proxiedCoords[s.id]=[],S=this.proxyCoords,C=s.getSource(),k=C.tileID;if(!k)return;const F=new h.P(k.x,k.y)._div(1<<k.z),z=C.coordinates.map(h.a5.fromLngLat).reduce((U,q)=>(U.min.x=Math.min(U.min.x,q.x-F.x),U.min.y=Math.min(U.min.y,q.y-F.y),U.max.x=Math.max(U.max.x,q.x-F.x),U.max.y=Math.max(U.max.y,q.y-F.y),U),{min:new h.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new h.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(U,q)=>{const W=U.wrap+U.canonical.x/(1<<U.canonical.z),ee=U.canonical.y/(1<<U.canonical.z),K=h.ab/(1<<U.canonical.z),re=q.wrap+q.canonical.x/(1<<q.canonical.z),ie=q.canonical.y/(1<<q.canonical.z);return W+K<re+z.min.x||W>re+z.max.x||ee+K<ie+z.min.y||ee>ie+z.max.y};for(let U=0;U<S.length;U++){const q=S[U];for(let W=0;W<c.length;W++){const ee=s.getTile(c[W]);if(!ee||!ee.hasData()||N(q,ee.tileID))continue;const K=this._createProxiedId(q,ee,g[q.key]&&g[q.key][s.id]),re=this.proxyToSource[q.key][s.id];re?re.push(K):this.proxyToSource[q.key][s.id]=[K],v.push(K)}}}_createProxiedId(s,c,g){let v=this.orthoMatrix;if(g){const S=g.find(C=>C.key===c.tileID.key);if(S)return S}if(c.tileID.key!==s.key){const S=s.canonical.z-c.tileID.canonical.z;let C,k,F;v=h.a6.mat4.create();const z=c.tileID.wrap-s.wrap<<s.overscaledZ;S>0?(C=h.ab>>S,k=C*((c.tileID.canonical.x<<S)-s.canonical.x+z),F=C*((c.tileID.canonical.y<<S)-s.canonical.y)):(C=h.ab<<-S,k=h.ab*(c.tileID.canonical.x-(s.canonical.x+z<<-S)),F=h.ab*(c.tileID.canonical.y-(s.canonical.y<<-S))),h.a6.mat4.ortho(v,0,C,0,C,0,1),h.a6.mat4.translate(v,v,[k,F,0])}return new pg(c.tileID,s.key,v)}_findTileCoveringTileID(s,c){let g=c.getTile(s);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[c.id],S=v[s.key];if(g=S?c.getTileByID(S):null,g&&g.hasData()||null===S)return g;let C=g?g.tileID:s,k=C.overscaledZ;const F=c.getSource().minzoom,z=[];if(!S){const U=c.getSource().maxzoom;if(s.canonical.z>=U){const q=s.canonical.z-U;c.getSource().reparseOverscaled?(k=Math.max(s.canonical.z+2,c.transform.tileZoom),C=new h.aA(k,s.wrap,U,s.canonical.x>>q,s.canonical.y>>q)):0!==q&&(k=U,C=new h.aA(k,s.wrap,U,s.canonical.x>>q,s.canonical.y>>q))}C.key!==s.key&&(z.push(C.key),g=c.getTile(C))}const N=U=>{z.forEach(q=>{v[q]=U}),z.length=0};for(k-=1;k>=F&&(!g||!g.hasData());k--){g&&N(g.tileID.key);const U=C.calculateScaledKey(k);if(g=c.getTileByID(U),g&&g.hasData())break;const q=v[U];if(null===q)break;void 0===q?z.push(U):g=c.getTileByID(q)}return N(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,c){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[c.key]=!0}}function jf(m,s,c){const g=function(k,F,z){const N=h.a6.vec3.dot(F,k),U=h.a6.vec3.dot(z,[.2126,.7152,.0722]),q=(ee,K,re)=>(1-re)*ee+re*K,W=q(1-.3*Math.min(U,1),1,Math.min(N+1,1));return q(.92,1,Math.asin(h.ap(F[2],-1,1))/Math.PI+.5)*W}(m,[0,0,1],s),v=[0,0,0];h.a6.vec3.scale(v,c.slice(0,3),g);const S=[0,0,0];h.a6.vec3.scale(S,s.slice(0,3),m[2]);const C=[0,0,0];return h.a6.vec3.add(C,v,S),h.cc(C)}const Oc=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Qi=["stars","rain_particle","snow_particle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class sc{static cacheKey(s,c,g,v){let S=`${c}${v?v.cacheKey:""}`;for(const C of g)s.usedDefines.includes(C)&&(S+=`/${C}`);return S}constructor(s,c,g,v,S,C){const k=s.gl;this.program=k.createProgram(),this.configuration=v,this.name=c,this.fixedDefines=[...C];const F=v?v.getBinderAttributes():[],z=(g.staticAttributes||[]).concat(F);let N=v?v.defines():[];N=N.concat(C.map(re=>`#define ${re}`));const U="#version 300 es\n";let q=U+N.concat("precision mediump float;",Ys,Qh.fragmentSource).join("\n");for(const re of g.fragmentIncludes)q+=`\n${To[re]}`;q+=`\n${g.fragmentSource}`;let W=U+N.concat("precision highp float;",Ys,Qh.vertexSource).join("\n");for(const re of g.vertexIncludes)W+=`\n${To[re]}`;W+=`\n${g.vertexSource}`;const ee=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(ee,q),k.compileShader(ee),k.attachShader(this.program,ee);const K=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(K,W),k.compileShader(K),k.attachShader(this.program,K),this.attributes={},this.numAttributes=z.length;for(let re=0;re<this.numAttributes;re++)if(z[re]){const ie=z[re].startsWith("a_")?z[re]:`a_${z[re]}`;k.bindAttribLocation(this.program,re,ie),this.attributes[ie]=re}k.linkProgram(this.program),k.deleteShader(K),k.deleteShader(ee),this.fixedUniforms=S(s),this.binderUniforms=v?v.getUniforms(s):[],(C.includes("TERRAIN")||-1!==c.indexOf("symbol")||-1!==c.indexOf("circle"))&&(this.terrainUniforms={u_dem:new h.bK(re=s),u_dem_prev:new h.bK(re),u_dem_tl:new h.bH(re),u_dem_scale:new h.bJ(re),u_dem_tl_prev:new h.bH(re),u_dem_scale_prev:new h.bJ(re),u_dem_size:new h.bJ(re),u_dem_lerp:new h.bJ(re),u_exaggeration:new h.bJ(re),u_depth:new h.bK(re),u_depth_size_inv:new h.bH(re),u_depth_range_unpack:new h.bH(re),u_occluder_half_size:new h.bJ(re),u_occlusion_depth_offset:new h.bJ(re),u_meter_to_dem:new h.bJ(re),u_label_plane_matrix_inv:new h.bG(re)}),C.includes("GLOBE")&&(this.globeUniforms=(re=>({u_tile_tl_up:new h.bI(re),u_tile_tr_up:new h.bI(re),u_tile_br_up:new h.bI(re),u_tile_bl_up:new h.bI(re),u_tile_up_scale:new h.bJ(re)}))(s)),C.includes("FOG")&&(this.fogUniforms=(re=>({u_fog_matrix:new h.bG(re),u_fog_range:new h.bH(re),u_fog_color:new h.c7(re),u_fog_horizon_blend:new h.bJ(re),u_fog_vertical_limit:new h.bH(re),u_fog_temporal_offset:new h.bJ(re),u_frustum_tl:new h.bI(re),u_frustum_tr:new h.bI(re),u_frustum_br:new h.bI(re),u_frustum_bl:new h.bI(re),u_globe_pos:new h.bI(re),u_globe_radius:new h.bJ(re),u_globe_transition:new h.bJ(re),u_is_globe:new h.bK(re),u_viewport:new h.bH(re)}))(s)),C.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(re=>({u_cutoff_params:new h.c7(re)}))(s)),C.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(re=>({u_lighting_ambient_color:new h.bI(re),u_lighting_directional_dir:new h.bI(re),u_lighting_directional_color:new h.bI(re),u_ground_radiance:new h.bI(re)}))(s)),C.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(re=>({u_light_matrix_0:new h.bG(re),u_light_matrix_1:new h.bG(re),u_fade_range:new h.bH(re),u_shadow_normal_offset:new h.bI(re),u_shadow_intensity:new h.bJ(re),u_shadow_texel_size:new h.bJ(re),u_shadow_map_resolution:new h.bJ(re),u_shadow_direction:new h.bI(re),u_shadow_bias:new h.bI(re),u_shadowmap_0:new h.bK(re),u_shadowmap_1:new h.bK(re)}))(s))}var re}setTerrainUniformValues(s,c){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)g[v]&&g[v].set(this.program,v,c[v])}}setGlobeUniformValues(s,c){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)g[v]&&g[v].set(this.program,v,c[v])}}setFogUniformValues(s,c){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}}setCutoffUniformValues(s,c){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}}setLightsUniformValues(s,c){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}}setShadowUniformValues(s,c){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;s.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}_drawDebugWireframe(s,c,g,v,S,C,k,F,z,N){const U=s.options.wireframe;if(!1===U.terrain&&!1===U.layers2D&&!1===U.layers3D)return;const q=s.context;if(!(()=>!(!U.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!U.layers2D||s._terrain&&s._terrain.renderingToTexture||!Oc.includes(this.name))||!(!U.layers3D||!Qi.includes(this.name)))())return;const W=q.gl,ee=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,S,q);if(!ee)return;const K=[...this.fixedDefines];K.push("DEBUG_WIREFRAME");const re=s.getOrCreateProgram(this.name,{config:this.configuration,defines:K});q.program.set(re.program);const ie=(ve,Ee,Ae)=>{if(Ee[ve]&&Ae[ve])for(const Ie in Ee[ve])Ae[ve][Ie]&&Ae[ve][Ie].set(Ae.program,Ie,Ee[ve][Ie].current)};z&&z.setUniforms(re.program,q,re.binderUniforms,k,{zoom:F}),ie("fixedUniforms",this,re),ie("terrainUniforms",this,re),ie("globeUniforms",this,re),ie("fogUniforms",this,re),ie("lightsUniforms",this,re),ie("shadowUniforms",this,re),ee.bind(),q.setColorMode(new Si([W.ONE,W.ONE_MINUS_SRC_ALPHA,W.ZERO,W.ONE],h.bA.transparent,[!0,!0,!0,!1])),q.setDepthMode(new Vn(c.func===W.LESS?W.LEQUAL:c.func,Vn.ReadOnly,c.range)),q.setStencilMode(Jt.disabled);const ge=3*C.primitiveLength*2,xe=3*C.primitiveOffset*2*2;N&&N>1?W.drawElementsInstanced(W.LINES,ge,W.UNSIGNED_SHORT,xe,N):W.drawElements(W.LINES,ge,W.UNSIGNED_SHORT,xe),S.bind(),q.program.set(this.program),q.setDepthMode(c),q.setStencilMode(g),q.setColorMode(v)}checkUniforms(s,c,g){if(this.fixedDefines.includes(c))for(const v of Object.keys(g))if(!g[v].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${v} not set but required by ${c} being defined`)}draw(s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K,re){const ie=s.context,ge=ie.gl;if(this.failedToCreate)return;ie.program.set(this.program),ie.setDepthMode(g),ie.setStencilMode(v),ie.setColorMode(S),ie.setCullFace(C);for(const Ee of Object.keys(this.fixedUniforms))this.fixedUniforms[Ee].set(this.program,Ee,k[Ee]);ee&&ee.setUniforms(this.program,ie,this.binderUniforms,q,{zoom:W});const xe={[ge.POINTS]:1,[ge.LINES]:2,[ge.TRIANGLES]:3,[ge.LINE_STRIP]:1}[c];this.checkUniforms(F,"RENDER_SHADOWS",this.shadowUniforms);const ve=re&&re>0?1:void 0;for(const Ee of U.get()){const Ae=Ee.vaos||(Ee.vaos={});(Ae[F]||(Ae[F]=new kc)).bind(ie,this,z,ee?ee.getPaintVertexBuffers():[],N,Ee.vertexOffset,K||[],ve),re&&re>1?ge.drawElementsInstanced(c,Ee.primitiveLength*xe,ge.UNSIGNED_SHORT,Ee.primitiveOffset*xe*2,re):N?ge.drawElements(c,Ee.primitiveLength*xe,ge.UNSIGNED_SHORT,Ee.primitiveOffset*xe*2):ge.drawArrays(c,Ee.vertexOffset,Ee.vertexLength),c===ge.TRIANGLES&&N&&this._drawDebugWireframe(s,g,v,S,N,Ee,q,W,ee,re)}}}function fg(m,s){const c=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,m.transform.tileZoom)/c,v=g*(s.tileID.canonical.x+s.tileID.wrap*c),S=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/h.ak(s,1,m.transform.tileZoom),u_pixel_coord_upper:[v>>16,S>>16],u_pixel_coord_lower:[65535&v,65535&S]}}const td={terrain:0,flat:1},fb=h.a6.mat4.create(),mg=(m,s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K,re,ie)=>{const ge=s.style.light,xe=ge.properties.get("position"),ve=[xe.x,xe.y,xe.z],Ee=h.a6.mat3.create();"viewport"===ge.properties.get("anchor")&&(h.a6.mat3.fromRotation(Ee,-s.transform.angle),h.a6.vec3.transformMat3(ve,ve,Ee));const Ae=ge.properties.get("color"),Ie=s.transform,Re={u_matrix:m,u_lightpos:ve,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+c,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fb,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:td[z],u_base_type:td[N],u_ao:v,u_edge_radius:S,u_width_scale:C,u_flood_light_color:ee,u_vertical_scale:K,u_flood_light_intensity:re,u_ground_shadow_factor:ie};return"globe"===Ie.projection.name&&(Re.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],Re.u_zoom_transition=U,Re.u_inv_rot_matrix=W,Re.u_merc_center=q,Re.u_up_dir=Ie.projection.upVector(new h.bQ(0,0,0),q[0]*h.ab,q[1]*h.ab),Re.u_height_lift=F),Re},Uf=(m,s,c,g,v,S)=>({u_matrix:m,u_edge_radius:s,u_width_scale:c,u_vertical_scale:g,u_height_type:td[v],u_base_type:td[S]}),gg=(m,s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K,re)=>{const ie=mg(m,s,c,g,v,S,C,k,z,N,U,q,W,ee,K,re,1,[0,0,0]),ge={u_height_factor:-Math.pow(2,k.overscaledZ)/F.tileSize/8};return h.l(ie,fg(s,F),ge)},mb=(m,s)=>({u_matrix:m,u_emissive_strength:s}),_n=(m,s,c,g)=>h.l(mb(m,s),fg(c,g)),Rr=(m,s,c)=>({u_matrix:m,u_world:c,u_emissive_strength:s}),Qn=(m,s,c,g,v)=>h.l(_n(m,s,c,g),{u_world:v}),ei=(m,s,c,g)=>{const v=h.ab/c.tileSize;return{u_matrix:m,u_camera_to_center_distance:s.getCameraToCenterDistance(g),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},vs=(m,s,c=1)=>({u_matrix:m,u_color:s.toRenderColor(null),u_overlay:0,u_overlay_scale:c}),gb=h.a6.mat4.create(),nd=(m,s,c,g,v,S,C)=>{const k=m.transform,F="globe"===k.projection.name,z=F?h.cI(k.zoom,s.canonical)*k._pixelsPerMercatorPixel:h.ak(c,1,S),N={u_matrix:s.projMatrix,u_extrude_scale:z,u_intensity:C,u_inv_rot_matrix:gb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){N.u_inv_rot_matrix=g,N.u_merc_center=v,N.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],N.u_zoom_transition=h.a9(k.zoom);const U=v[0]*h.ab,q=v[1]*h.ab;N.u_up_dir=k.projection.upVector(new h.bQ(0,0,0),U,q)}return N};function $a(m,[s,c,g,v],[S,C]){if(S===C)return[0,0,0,0];const k=255*(m-1)/(m*(C-S));return[s*k,c*k,g*k,v*k]}function mu(m,s,[c,g]){return c===g?0:.5/m+(s-c)*(m-1)/(m*(g-c))}const eh=(m,s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K,re,ie,ge,xe,ve)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:S,u_scale_parent:z,u_fade_t:N.mix,u_opacity:N.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:h.cJ(U.paint.get("raster-saturation")),u_contrast_factor:h.cK(U.paint.get("raster-contrast")),u_spin_weights:Hf(U.paint.get("raster-hue-rotate")),u_perspective_transform:q,u_raster_elevation:W,u_zoom_transition:C,u_merc_center:k,u_cutoff_params:F,u_colorization_mix:$a(h.cL,K,ie),u_colorization_offset:mu(h.cL,re,ie),u_color_ramp:ee,u_texture_offset:[xe/(ge+2*xe),ge/(ge+2*xe)],u_texture_res:[ge+2*xe,ge+2*xe],u_emissive_strength:ve});function Hf(m){m*=Math.PI/180;const s=Math.sin(m),c=Math.cos(m);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const id=.05,_g=(m,s,c,g,v,S,C,k,F,z,N,U)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:S,u_scale_parent:z,u_fade_t:N.mix,u_opacity:N.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:C,u_merc_center:k,u_cutoff_params:F}),up=(m,s,c,g,v,S,C,k,F,z)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_tile_offset:c,u_velocity:g,u_color_ramp:S,u_velocity_res:v,u_max_speed:C,u_uv_offset:k,u_data_scale:[255*F[0],255*F[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[id,id]}),Js=(m,s,c,g,v,S,C,k,F,z)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_velocity:c,u_velocity_res:g,u_max_speed:v,u_speed_factor:S,u_reset_rate:C,u_rand_seed:Math.random(),u_uv_offset:k,u_data_scale:[255*F[0],255*F[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[id,id]}),Ol=h.a6.mat4.create(),bg=(m,s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K,re,ie,ge,xe,ve,Ee)=>{const Ae=v.transform,Ie={u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Ae.getCameraToCenterDistance(ge),u_rotate_symbol:+c,u_aspect_ratio:Ae.width/Ae.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:C,u_coord_matrix:k,u_is_text:+z,u_elevation_from_sea:F?1:0,u_pitch_with_map:+g,u_texsize:N,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ol,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ol,u_up_vector:[0,-1,0],u_color_adj_mat:xe,u_icon_transition:ve||0,u_gamma_scale:g?v.transform.getCameraToCenterDistance(ge)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:h.q.devicePixelRatio,u_is_halo:+q,u_scale_factor:Ee||1};return"globe"===ge.name&&(Ie.u_tile_id=[W.canonical.x,W.canonical.y,1<<W.canonical.z],Ie.u_zoom_transition=ee,Ie.u_inv_rot_matrix=re,Ie.u_merc_center=K,Ie.u_camera_forward=Ae._camera.forward(),Ie.u_ecef_origin=h.cM(Ae.globeMatrix,W.toUnwrapped()),Ie.u_tile_matrix=Float32Array.from(Ae.globeMatrix),Ie.u_up_vector=ie),Ie},yl=(m,s,c,g)=>({u_matrix:m,u_emissive_strength:s,u_opacity:c,u_color:g}),Wa=(m,s,c,g,v,S,C,k,F)=>h.l(function(z,N,U,q,W,ee){const{width:K,height:re}=q.imageManager.getPixelSize(N),ie=Math.pow(2,ee.tileID.overscaledZ),ge=ee.tileSize*Math.pow(2,q.transform.tileZoom)/ie,xe=ge*(ee.tileID.canonical.x+ee.tileID.wrap*ie),ve=ge*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[K,re],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:W?[q.transform.width,-1*q.transform.height]:[1/h.ak(ee,1,q.transform.tileZoom),1/h.ak(ee,1,q.transform.tileZoom)],u_pixel_coord_upper:[xe>>16,ve>>16],u_pixel_coord_lower:[65535&xe,65535&ve]}}(0,S,C,g,k,F),{u_matrix:m,u_emissive_strength:s,u_opacity:c}),Tn=new Float32Array(h.a6.mat4.identity([])),dp=(m,s,c,g,v,S,C,k,F,z,N,U,q,W=[0,0,0],ee)=>{const K=v.style.light,re=K.properties.get("position"),ie=[-re.x,-re.y,re.z],ge=h.a6.mat3.create();"viewport"===K.properties.get("anchor")&&(h.a6.mat3.fromRotation(ge,-v.transform.angle),h.a6.vec3.transformMat3(ie,ie,ge));const xe="MASK"===N.alphaMode,ve=K.properties.get("color").toRenderColor(null),Ee=q.paint.get("model-ambient-occlusion-intensity"),Ae=q.paint.get("model-color").constantOr(h.bA.white).toRenderColor(null),Ie=q.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:s,u_normal_matrix:c,u_node_matrix:g||Tn,u_lightpos:ie,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[ve.r,ve.g,ve.b],u_camera_pos:W,u_opacity:S,u_baseTextureIsAlpha:0,u_alphaMask:+xe,u_alphaCutoff:N.alphaCutoff,u_baseColorFactor:[C.r,C.g,C.b,C.a],u_emissiveFactor:[k[0],k[1],k[2],1],u_metallicFactor:F,u_roughnessFactor:z,u_baseColorTexture:ir_BaseColor,u_metallicRoughnessTexture:ir_MetallicRoughness,u_normalTexture:ir_Normal,u_occlusionTexture:ir_Occlusion,u_emissionTexture:ir_Emission,u_lutTexture:ir_LUT,u_color_mix:[Ae.r,Ae.g,Ae.b,Ie],u_aoIntensity:Ee,u_emissive_strength:U,u_occlusionTextureTransform:ee||[0,0,0,0]}},yg=(m,s=Tn,c=Tn)=>({u_matrix:m,u_instance:s,u_node_matrix:c}),rd={fillExtrusion:m=>({u_matrix:new h.bG(m),u_lightpos:new h.bI(m),u_lightintensity:new h.bJ(m),u_lightcolor:new h.bI(m),u_vertical_gradient:new h.bJ(m),u_opacity:new h.bJ(m),u_edge_radius:new h.bJ(m),u_width_scale:new h.bJ(m),u_ao:new h.bH(m),u_height_type:new h.bK(m),u_base_type:new h.bK(m),u_tile_id:new h.bI(m),u_zoom_transition:new h.bJ(m),u_inv_rot_matrix:new h.bG(m),u_merc_center:new h.bH(m),u_up_dir:new h.bI(m),u_height_lift:new h.bJ(m),u_flood_light_color:new h.bI(m),u_vertical_scale:new h.bJ(m),u_flood_light_intensity:new h.bJ(m),u_ground_shadow_factor:new h.bI(m)}),fillExtrusionDepth:m=>({u_matrix:new h.bG(m),u_edge_radius:new h.bJ(m),u_width_scale:new h.bJ(m),u_vertical_scale:new h.bJ(m),u_height_type:new h.bK(m),u_base_type:new h.bK(m)}),fillExtrusionPattern:m=>({u_matrix:new h.bG(m),u_lightpos:new h.bI(m),u_lightintensity:new h.bJ(m),u_lightcolor:new h.bI(m),u_vertical_gradient:new h.bJ(m),u_height_factor:new h.bJ(m),u_edge_radius:new h.bJ(m),u_width_scale:new h.bJ(m),u_ao:new h.bH(m),u_height_type:new h.bK(m),u_base_type:new h.bK(m),u_tile_id:new h.bI(m),u_zoom_transition:new h.bJ(m),u_inv_rot_matrix:new h.bG(m),u_merc_center:new h.bH(m),u_up_dir:new h.bI(m),u_height_lift:new h.bJ(m),u_image:new h.bK(m),u_texsize:new h.bH(m),u_pixel_coord_upper:new h.bH(m),u_pixel_coord_lower:new h.bH(m),u_tile_units_to_pixels:new h.bJ(m),u_opacity:new h.bJ(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new h.bG(m),u_opacity:new h.bJ(m),u_ao_pass:new h.bJ(m),u_meter_to_tile:new h.bJ(m),u_ao:new h.bH(m),u_flood_light_intensity:new h.bJ(m),u_flood_light_color:new h.bI(m),u_attenuation:new h.bJ(m),u_edge_radius:new h.bJ(m),u_fb:new h.bK(m),u_fb_size:new h.bJ(m),u_dynamic_offset:new h.bJ(m)}),fill:m=>({u_matrix:new h.bG(m),u_emissive_strength:new h.bJ(m)}),fillPattern:m=>({u_matrix:new h.bG(m),u_emissive_strength:new h.bJ(m),u_image:new h.bK(m),u_texsize:new h.bH(m),u_pixel_coord_upper:new h.bH(m),u_pixel_coord_lower:new h.bH(m),u_tile_units_to_pixels:new h.bJ(m)}),fillOutline:m=>({u_matrix:new h.bG(m),u_emissive_strength:new h.bJ(m),u_world:new h.bH(m)}),fillOutlinePattern:m=>({u_matrix:new h.bG(m),u_emissive_strength:new h.bJ(m),u_world:new h.bH(m),u_image:new h.bK(m),u_texsize:new h.bH(m),u_pixel_coord_upper:new h.bH(m),u_pixel_coord_lower:new h.bH(m),u_tile_units_to_pixels:new h.bJ(m)}),circle:h.cN,collisionBox:m=>({u_matrix:new h.bG(m),u_camera_to_center_distance:new h.bJ(m),u_extrude_scale:new h.bH(m)}),collisionCircle:m=>({u_matrix:new h.bG(m),u_inv_matrix:new h.bG(m),u_camera_to_center_distance:new h.bJ(m),u_viewport_size:new h.bH(m)}),debug:m=>({u_color:new h.cu(m),u_matrix:new h.bG(m),u_overlay:new h.bK(m),u_overlay_scale:new h.bJ(m)}),clippingMask:m=>({u_matrix:new h.bG(m)}),heatmap:m=>({u_extrude_scale:new h.bJ(m),u_intensity:new h.bJ(m),u_matrix:new h.bG(m),u_inv_rot_matrix:new h.bG(m),u_merc_center:new h.bH(m),u_tile_id:new h.bI(m),u_zoom_transition:new h.bJ(m),u_up_dir:new h.bI(m)}),heatmapTexture:m=>({u_image:new h.bK(m),u_color_ramp:new h.bK(m),u_opacity:new h.bJ(m)}),hillshade:m=>({u_matrix:new h.bG(m),u_image:new h.bK(m),u_latrange:new h.bH(m),u_light:new h.bH(m),u_shadow:new h.cu(m),u_highlight:new h.cu(m),u_emissive_strength:new h.bJ(m),u_accent:new h.cu(m)}),hillshadePrepare:m=>({u_matrix:new h.bG(m),u_image:new h.bK(m),u_dimension:new h.bH(m),u_zoom:new h.bJ(m)}),line:h.cO,linePattern:h.cP,raster:m=>({u_matrix:new h.bG(m),u_normalize_matrix:new h.bG(m),u_globe_matrix:new h.bG(m),u_merc_matrix:new h.bG(m),u_grid_matrix:new h.cv(m),u_tl_parent:new h.bH(m),u_scale_parent:new h.bJ(m),u_fade_t:new h.bJ(m),u_opacity:new h.bJ(m),u_image0:new h.bK(m),u_image1:new h.bK(m),u_brightness_low:new h.bJ(m),u_brightness_high:new h.bJ(m),u_saturation_factor:new h.bJ(m),u_contrast_factor:new h.bJ(m),u_spin_weights:new h.bI(m),u_perspective_transform:new h.bH(m),u_raster_elevation:new h.bJ(m),u_zoom_transition:new h.bJ(m),u_merc_center:new h.bH(m),u_cutoff_params:new h.c7(m),u_colorization_mix:new h.c7(m),u_colorization_offset:new h.bJ(m),u_color_ramp:new h.bK(m),u_texture_offset:new h.bH(m),u_texture_res:new h.bH(m),u_emissive_strength:new h.bJ(m)}),rasterParticle:m=>({u_matrix:new h.bG(m),u_normalize_matrix:new h.bG(m),u_globe_matrix:new h.bG(m),u_merc_matrix:new h.bG(m),u_grid_matrix:new h.cv(m),u_tl_parent:new h.bH(m),u_scale_parent:new h.bJ(m),u_fade_t:new h.bJ(m),u_opacity:new h.bJ(m),u_image0:new h.bK(m),u_image1:new h.bK(m),u_raster_elevation:new h.bJ(m),u_zoom_transition:new h.bJ(m),u_merc_center:new h.bH(m),u_cutoff_params:new h.c7(m)}),rasterParticleTexture:m=>({u_texture:new h.bK(m),u_opacity:new h.bJ(m)}),rasterParticleDraw:m=>({u_particle_texture:new h.bK(m),u_particle_texture_side_len:new h.bJ(m),u_tile_offset:new h.bH(m),u_velocity:new h.bK(m),u_color_ramp:new h.bK(m),u_velocity_res:new h.bH(m),u_max_speed:new h.bJ(m),u_uv_offset:new h.bH(m),u_data_scale:new h.bH(m),u_data_offset:new h.bJ(m),u_particle_pos_scale:new h.bJ(m),u_particle_pos_offset:new h.bH(m)}),rasterParticleUpdate:m=>({u_particle_texture:new h.bK(m),u_particle_texture_side_len:new h.bJ(m),u_velocity:new h.bK(m),u_velocity_res:new h.bH(m),u_max_speed:new h.bJ(m),u_speed_factor:new h.bJ(m),u_reset_rate:new h.bJ(m),u_rand_seed:new h.bJ(m),u_uv_offset:new h.bH(m),u_data_scale:new h.bH(m),u_data_offset:new h.bJ(m),u_particle_pos_scale:new h.bJ(m),u_particle_pos_offset:new h.bH(m)}),symbol:m=>({u_is_size_zoom_constant:new h.bK(m),u_is_size_feature_constant:new h.bK(m),u_size_t:new h.bJ(m),u_size:new h.bJ(m),u_camera_to_center_distance:new h.bJ(m),u_rotate_symbol:new h.bK(m),u_aspect_ratio:new h.bJ(m),u_fade_change:new h.bJ(m),u_matrix:new h.bG(m),u_label_plane_matrix:new h.bG(m),u_coord_matrix:new h.bG(m),u_is_text:new h.bK(m),u_elevation_from_sea:new h.bK(m),u_pitch_with_map:new h.bK(m),u_texsize:new h.bH(m),u_texsize_icon:new h.bH(m),u_texture:new h.bK(m),u_texture_icon:new h.bK(m),u_gamma_scale:new h.bJ(m),u_device_pixel_ratio:new h.bJ(m),u_tile_id:new h.bI(m),u_zoom_transition:new h.bJ(m),u_inv_rot_matrix:new h.bG(m),u_merc_center:new h.bH(m),u_camera_forward:new h.bI(m),u_tile_matrix:new h.bG(m),u_up_vector:new h.bI(m),u_ecef_origin:new h.bI(m),u_is_halo:new h.bK(m),u_icon_transition:new h.bJ(m),u_color_adj_mat:new h.bG(m),u_scale_factor:new h.bJ(m)}),background:m=>({u_matrix:new h.bG(m),u_emissive_strength:new h.bJ(m),u_opacity:new h.bJ(m),u_color:new h.cu(m)}),backgroundPattern:m=>({u_matrix:new h.bG(m),u_emissive_strength:new h.bJ(m),u_opacity:new h.bJ(m),u_image:new h.bK(m),u_pattern_tl:new h.bH(m),u_pattern_br:new h.bH(m),u_texsize:new h.bH(m),u_pattern_size:new h.bH(m),u_pixel_coord_upper:new h.bH(m),u_pixel_coord_lower:new h.bH(m),u_pattern_units_to_pixels:new h.bH(m)}),terrainRaster:m=>({u_matrix:new h.bG(m),u_image0:new h.bK(m),u_skirt_height:new h.bJ(m),u_ground_shadow_factor:new h.bI(m)}),skybox:m=>({u_matrix:new h.bG(m),u_sun_direction:new h.bI(m),u_cubemap:new h.bK(m),u_opacity:new h.bJ(m),u_temporal_offset:new h.bJ(m)}),skyboxGradient:m=>({u_matrix:new h.bG(m),u_color_ramp:new h.bK(m),u_center_direction:new h.bI(m),u_radius:new h.bJ(m),u_opacity:new h.bJ(m),u_temporal_offset:new h.bJ(m)}),skyboxCapture:m=>({u_matrix_3f:new h.cv(m),u_sun_direction:new h.bI(m),u_sun_intensity:new h.bJ(m),u_color_tint_r:new h.c7(m),u_color_tint_m:new h.c7(m),u_luminance:new h.bJ(m)}),globeRaster:m=>({u_proj_matrix:new h.bG(m),u_globe_matrix:new h.bG(m),u_normalize_matrix:new h.bG(m),u_merc_matrix:new h.bG(m),u_zoom_transition:new h.bJ(m),u_merc_center:new h.bH(m),u_image0:new h.bK(m),u_grid_matrix:new h.cv(m),u_skirt_height:new h.bJ(m),u_far_z_cutoff:new h.bJ(m),u_frustum_tl:new h.bI(m),u_frustum_tr:new h.bI(m),u_frustum_br:new h.bI(m),u_frustum_bl:new h.bI(m),u_globe_pos:new h.bI(m),u_globe_radius:new h.bJ(m),u_viewport:new h.bH(m)}),globeAtmosphere:m=>({u_frustum_tl:new h.bI(m),u_frustum_tr:new h.bI(m),u_frustum_br:new h.bI(m),u_frustum_bl:new h.bI(m),u_horizon:new h.bJ(m),u_transition:new h.bJ(m),u_fadeout_range:new h.bJ(m),u_color:new h.c7(m),u_high_color:new h.c7(m),u_space_color:new h.c7(m),u_temporal_offset:new h.bJ(m),u_horizon_angle:new h.bJ(m)}),model:m=>({u_matrix:new h.bG(m),u_lighting_matrix:new h.bG(m),u_normal_matrix:new h.bG(m),u_node_matrix:new h.bG(m),u_lightpos:new h.bI(m),u_lightintensity:new h.bJ(m),u_lightcolor:new h.bI(m),u_camera_pos:new h.bI(m),u_opacity:new h.bJ(m),u_baseColorFactor:new h.c7(m),u_emissiveFactor:new h.c7(m),u_metallicFactor:new h.bJ(m),u_roughnessFactor:new h.bJ(m),u_baseTextureIsAlpha:new h.bK(m),u_alphaMask:new h.bK(m),u_alphaCutoff:new h.bJ(m),u_baseColorTexture:new h.bK(m),u_metallicRoughnessTexture:new h.bK(m),u_normalTexture:new h.bK(m),u_occlusionTexture:new h.bK(m),u_emissionTexture:new h.bK(m),u_lutTexture:new h.bK(m),u_color_mix:new h.c7(m),u_aoIntensity:new h.bJ(m),u_emissive_strength:new h.bJ(m),u_occlusionTextureTransform:new h.c7(m)}),modelDepth:m=>({u_matrix:new h.bG(m),u_instance:new h.bG(m),u_node_matrix:new h.bG(m)}),groundShadow:m=>({u_matrix:new h.bG(m),u_ground_shadow_factor:new h.bI(m)}),stars:m=>({u_matrix:new h.bG(m),u_up:new h.bI(m),u_right:new h.bI(m),u_intensity_multiplier:new h.bJ(m)}),snowParticle:m=>({u_modelview:new h.bG(m),u_projection:new h.bG(m),u_time:new h.bJ(m),u_cam_pos:new h.bI(m),u_velocityConeAperture:new h.bJ(m),u_velocity:new h.bJ(m),u_horizontalOscillationRadius:new h.bJ(m),u_horizontalOscillationRate:new h.bJ(m),u_boxSize:new h.bJ(m),u_billboardSize:new h.bJ(m),u_simpleShapeParameters:new h.bH(m),u_screenSize:new h.bH(m),u_thinningCenterPos:new h.bH(m),u_thinningShape:new h.bI(m),u_thinningAffectedRatio:new h.bJ(m),u_thinningParticleOffset:new h.bJ(m),u_particleColor:new h.c7(m),u_direction:new h.bI(m)}),rainParticle:m=>({u_modelview:new h.bG(m),u_projection:new h.bG(m),u_time:new h.bJ(m),u_cam_pos:new h.bI(m),u_texScreen:new h.bK(m),u_velocityConeAperture:new h.bJ(m),u_velocity:new h.bJ(m),u_boxSize:new h.bJ(m),u_rainDropletSize:new h.bH(m),u_distortionStrength:new h.bJ(m),u_rainDirection:new h.bI(m),u_color:new h.c7(m),u_screenSize:new h.bH(m),u_thinningCenterPos:new h.bH(m),u_thinningShape:new h.bI(m),u_thinningAffectedRatio:new h.bJ(m),u_thinningParticleOffset:new h.bJ(m),u_shapeDirectionalPower:new h.bJ(m),u_mode:new h.bJ(m)}),occlusion:m=>({u_matrix:new h.bG(m),u_anchorPos:new h.bI(m),u_screenSizePx:new h.bH(m),u_occluderSizePx:new h.bH(m),u_color:new h.c7(m)})};let ac=(()=>{class m{constructor(c,g,v,S){this.id=m.uniqueIdxCounter,m.uniqueIdxCounter++,this.context=c;const C=c.gl;this.buffer=C.createBuffer(),this.dynamicDraw=Boolean(v),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||S||g.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){this.id=m.uniqueIdxCounter,m.uniqueIdxCounter++;const g=this.context.gl;this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return m.uniqueIdxCounter=0,m})();const Fn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qf{constructor(s,c,g,v,S,C){this.length=c.length,this.attributes=g,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.instanceCount=C,this.context=s;const k=s.gl;this.buffer=k.createBuffer(),s.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||S||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let g=0;g<this.attributes.length;g++){const v=c.attributes[this.attributes[g].name];void 0!==v&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,c,g){for(let v=0;v<this.attributes.length;v++){const S=this.attributes[v],C=c.attributes[S.name];void 0!==C&&s.vertexAttribPointer(C,S.components,s[Fn[S.type]],!1,this.itemSize,S.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(s,c,g){for(let v=0;v<this.attributes.length;v++){const S=c.attributes[this.attributes[v].name];void 0!==S&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(S,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Gf{constructor(s,c,g,v,S){this.context=s,this.width=c,this.height=g;const C=this.framebuffer=s.gl.createFramebuffer();v&&(this.colorAttachment=new Vf(s,C)),S&&(this.depthAttachmentType=S,this.depthAttachment="renderbuffer"===S?new sp(s,C):new db(s,C))}destroy(){const s=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&s.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const c=this.depthAttachment.get();c&&s.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&s.deleteTexture(c)}s.deleteFramebuffer(this.framebuffer)}}class jv{constructor(s,c){this.gl=s,this.clearColor=new ab(this),this.clearDepth=new kv(this),this.clearStencil=new lb(this),this.colorMask=new cg(this),this.depthMask=new Nf(this),this.stencilMask=new Lv(this),this.stencilFunc=new Ov(this),this.stencilOp=new Fv(this),this.stencilTest=new ep(this),this.depthRange=new Nv(this),this.depthTest=new Y1(this),this.depthFunc=new J1(this),this.blend=new K1(this),this.blendFunc=new cb(this),this.blendColor=new Bf(this),this.blendEquation=new tp(this),this.cullFace=new ub(this),this.cullFaceSide=new Bv(this),this.frontFace=new zv(this),this.program=new Qu(this),this.activeTexture=new np(this),this.viewport=new ho(this),this.bindFramebuffer=new ug(this),this.bindRenderbuffer=new Ga(this),this.bindTexture=new dg(this),this.bindVertexBuffer=new ip(this),this.bindElementBuffer=new rp(this),this.bindVertexArrayOES=new hg(this),this.pixelStoreUnpack=new op(this),this.pixelStoreUnpackPremultiplyAlpha=new zf(this),this.pixelStoreUnpackFlipY=new Oa(this),this.options=c?{...c}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c,g){return new ac(this,s,c,g)}createVertexBuffer(s,c,g,v,S){return new qf(this,s,c,g,v,S)}createRenderbuffer(s,c,g){const v=this.gl,S=v.createRenderbuffer();return this.bindRenderbuffer.set(S),v.renderbufferStorage(v.RENDERBUFFER,s,c,g),this.bindRenderbuffer.set(null),S}createFramebuffer(s,c,g,v){return new Gf(this,s,c,g,v)}clear({color:s,depth:c,stencil:g,colorMask:v}){const S=this.gl;let C=0;s&&(C|=S.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set(v||[!0,!0,!0,!0])),void 0!==c&&(C|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==g&&(C|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),S.clear(C)}setCullFace(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){h.bi(s.blendFunction,Si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let od;function hp(m,s,c,g,v,S,C){const k=m.context,F=k.gl,z=m.transform,N=m.getOrCreateProgram("collisionBox"),U=[];let q=0,W=0;for(let ve=0;ve<g.length;ve++){const Ee=g[ve],Ae=s.getTile(Ee),Ie=Ae.getBucket(c);if(!Ie)continue;const Re=ob(Ee,Ie,z);let Fe=Re;0===v[0]&&0===v[1]||(Fe=m.translatePosMatrix(Re,Ae,v,S));const He=C?Ie.textCollisionBox:Ie.iconCollisionBox,ze=Ie.collisionCircleArray;if(ze.length>0){const Ne=h.a6.mat4.create(),ut=Fe;h.a6.mat4.mul(Ne,Ie.placementInvProjMatrix,z.glCoordMatrix),h.a6.mat4.mul(Ne,Ne,Ie.placementViewportMatrix),U.push({circleArray:ze,circleOffset:W,transform:ut,invTransform:Ne,projection:Ie.getProjection()}),q+=ze.length/4,W=q}He&&(m.terrain&&m.terrain.setupElevationDraw(Ae,N),N.draw(m,F.LINES,Vn.disabled,Jt.disabled,m.colorModeForRenderPass(),li.disabled,ei(Fe,z,Ae,Ie.getProjection()),c.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,z.zoom,null,[He.collisionVertexBuffer,He.collisionVertexBufferExt]))}if(!C||!U.length)return;const ee=m.getOrCreateProgram("collisionCircle"),K=new h.cQ;K.resize(4*q),K._trim();let re=0;for(const ve of U)for(let Ee=0;Ee<ve.circleArray.length/4;Ee++){const Ae=4*Ee,Ie=ve.circleArray[Ae+0],Re=ve.circleArray[Ae+1],Fe=ve.circleArray[Ae+2],He=ve.circleArray[Ae+3];K.emplace(re++,Ie,Re,Fe,He,0),K.emplace(re++,Ie,Re,Fe,He,1),K.emplace(re++,Ie,Re,Fe,He,2),K.emplace(re++,Ie,Re,Fe,He,3)}(!od||od.length<2*q)&&(od=function(ve){const Ee=2*ve,Ae=new h.aP;Ae.resize(Ee),Ae._trim();for(let Ie=0;Ie<Ee;Ie++){const Re=6*Ie;Ae.uint16[Re+0]=4*Ie+0,Ae.uint16[Re+1]=4*Ie+1,Ae.uint16[Re+2]=4*Ie+2,Ae.uint16[Re+3]=4*Ie+2,Ae.uint16[Re+4]=4*Ie+3,Ae.uint16[Re+5]=4*Ie+0}return Ae}(q));const ie=k.createIndexBuffer(od,!0),ge=k.createVertexBuffer(K,h.cR.members,!0);for(const ve of U){const Ee={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(xe=z).getCameraToCenterDistance(ve.projection),u_viewport_size:[xe.width,xe.height]};ee.draw(m,F.TRIANGLES,Vn.disabled,Jt.disabled,m.colorModeForRenderPass(),li.disabled,Ee,c.id,ge,ie,h.b2.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,z.zoom)}var xe;ge.destroy(),ie.destroy()}const th=h.a6.mat4.create();function vg(m){const s=m._camera.getWorldToCamera(m.worldSize,1),c=h.a6.mat4.multiply([],s,m.globeMatrix);h.a6.mat4.invert(c,c);const g=[0,0,0],v=[0,1,0,0];return h.a6.vec4.transformMat4(v,v,c),g[0]=v[0],g[1]=v[1],g[2]=v[2],h.a6.vec3.normalize(g,g),g}function _b({width:m,height:s,anchor:c,textOffset:g,textScale:v},S){const{horizontalAlign:C,verticalAlign:k}=h.by(c),F=-(C-.5)*m,z=-(k-.5)*s,N=h.bx(c,g);return new h.P((F/v+N[0])*S,(z/v+N[1])*S)}function $f(m,s,c,g,v,S,C,k,F,z,N){const U=m.text.placedSymbolArray,q=m.text.dynamicLayoutVertexArray,W=m.icon.dynamicLayoutVertexArray,ee={},K=m.getProjection(),re=Mc(k,K,S),ie=S.elevation,ge=K.upVectorScale(k.canonical,S.center.lat,S.worldSize).metersToTile;q.clear();for(let xe=0;xe<U.length;xe++){const ve=U.get(xe),{tileAnchorX:Ee,tileAnchorY:Ae,numGlyphs:Ie}=ve,Re=ve.hidden||!ve.crossTileID||m.allowVerticalPlacement&&!ve.placedOrientation?null:g[ve.crossTileID];if(Re){let Fe=0,He=0,ze=0;if(ie){const bt=ie?ie.getAtTileOffset(k,Ee,Ae):0,[Ot,Ut,Lt]=K.upVector(k.canonical,Ee,Ae);Fe=bt*Ot*ge,He=bt*Ut*ge,ze=bt*Lt*ge}let[Ne,ut,wt,zt]=va(ve.projectedAnchorX+Fe,ve.projectedAnchorY+He,ve.projectedAnchorZ+ze,c?re:C);const Zt=cr(S.getCameraToCenterDistance(K),zt);let sn=v.evaluateSizeForFeature(m.textSizeData,z,ve)*Zt/h.br;c&&(sn*=m.tilePixelRatio/F);const Ke=_b(Re,sn);c?(({x:Ne,y:ut,z:wt}=K.projectTilePoint(Ee+Ke.x,Ae+Ke.y,k.canonical)),[Ne,ut,wt]=va(Ne+Fe,ut+He,wt+ze,C)):(s&&Ke._rotate(-S.angle),Ne+=Ke.x,ut+=Ke.y,wt=0);const Pt=m.allowVerticalPlacement&&ve.placedOrientation===h.bl.vertical?Math.PI/2:0;for(let bt=0;bt<Ie;bt++)h.bo(q,Ne,ut,wt,Pt);N&&ve.associatedIconIndex>=0&&(ee[ve.associatedIconIndex]={x:Ne,y:ut,z:wt,angle:Pt})}else Ic(Ie,q)}if(N){W.clear();const xe=m.icon.placedSymbolArray;for(let ve=0;ve<xe.length;ve++){const Ee=xe.get(ve),{numGlyphs:Ae}=Ee,Ie=ee[ve];if(Ee.hidden||!Ie)Ic(Ae,W);else{const{x:Re,y:Fe,z:He,angle:ze}=Ie;for(let Ne=0;Ne<Ae;Ne++)h.bo(W,Re,Fe,He,ze)}}m.icon.dynamicLayoutVertexBuffer.updateData(W)}m.text.dynamicLayoutVertexBuffer.updateData(q)}function sd(m,s,c,g,v,S,C={}){const k=c.paint.get("icon-translate"),F=c.paint.get("text-translate"),z=c.paint.get("icon-translate-anchor"),N=c.paint.get("text-translate-anchor"),U=c.layout.get("icon-rotation-alignment"),q=c.layout.get("text-rotation-alignment"),W=c.layout.get("icon-pitch-alignment"),ee=c.layout.get("text-pitch-alignment"),K=c.layout.get("icon-keep-upright"),re=c.layout.get("text-keep-upright"),ie=c.paint.get("icon-color-saturation"),ge=c.paint.get("icon-color-contrast"),xe=c.paint.get("icon-color-brightness-min"),ve=c.paint.get("icon-color-brightness-max"),Ee="sea"===c.layout.get("symbol-elevation-reference"),Ae=m.context,Ie=Ae.gl,Re=m.transform,Fe="map"===U,He="map"===q,ze="map"===W,Ne="map"===ee,ut=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let wt=!1;const zt=m.depthModeForSublayer(0,Vn.ReadOnly),Zt=[h.am(Re.center.lng),h.at(Re.center.lat)],sn=c.layout.get("text-variable-anchor"),Ke="globe"===Re.projection.name,Pt=[],bt=[0,-1,0];for(const Ot of g){const Ut=s.getTile(Ot),Lt=Ut.getBucket(c);if(!Lt||"mercator"===Lt.projection.name&&Ke||Lt.fullyClipped)continue;const un="globe"===Lt.projection.name,Ln=un?h.a9(Re.zoom):0,zn=Mc(Ot,Lt.getProjection(),Re),Sn=Re.calculatePixelsToTileUnitsMatrix(Ut),jn=sn&&Lt.hasTextData(),pn=Lt.hasIconTextFit()&&jn&&Lt.hasIconData(),Yn=Lt.getProjection().createInversionMatrix(Re,Ot.canonical),Jn=Er=>{Re.depthOcclusionForSymbolsAndCircles&&(c.hasInitialOcclusionOpacityProperties||m.terrain)&&(Er.push("DEPTH_D24"),Er.push("DEPTH_OCCLUSION"))},Xi=()=>{const Er=Fe&&"point"!==c.layout.get("symbol-placement"),xr=[];Jn(xr);const po=Er||pn,Vr=c.paint.get("icon-image-cross-fade").constantOr(0);m.terrainRenderModeElevated()&&ze&&xr.push("PITCH_WITH_MAP_TERRAIN"),un&&(xr.push("PROJECTION_GLOBE_VIEW"),po&&xr.push("PROJECTED_POS_ON_VIEWPORT")),Vr>0&&xr.push("ICON_TRANSITION"),Lt.icon.zOffsetVertexBuffer&&xr.push("Z_OFFSET"),0===ie&&0===ge&&0===xe&&1===ve||xr.push("COLOR_ADJUSTMENT"),Lt.sdfIcons&&xr.push("RENDER_SDF");const Da=Lt.icon.programConfigurations.get(c.id),Ka=m.getOrCreateProgram("symbol",{config:Da,defines:xr}),ss=Ut.imageAtlasTexture?Ut.imageAtlasTexture.size:[0,0],vi=Lt.iconSizeData,zi=h.bk(vi,Re.zoom),fr=ze||0!==Re.pitch,Yr=ki(zn,Ut.tileID.canonical,ze,Fe,Re,Lt.getProjection(),Sn),Bo=qa(zn,Ut.tileID.canonical,ze,Fe,Re,Lt.getProjection(),Sn),io=m.translatePosMatrix(Bo,Ut,k,z,!0),As=m.translatePosMatrix(zn,Ut,k,z),zl=po?th:Yr,Va=Fe&&!ze&&!Er;let Ea=bt;!Ke&&!Re.mercatorFromTransition||Fe||(Ea=vg(Re));const vl=un?Ea:bt,Vl=c.getColorAdjustmentMatrix(ie,ge,xe,ve),la=bg(vi.kind,zi,Va,ze,m,As,zl,io,Ee,!1,ss,[0,0],!0,Ot,Ln,Zt,Yn,vl,Lt.getProjection(),Vl,Vr),jl=Ut.imageAtlasTexture?Ut.imageAtlasTexture:null,xl=1!==c.layout.get("icon-size").constantOr(0)||Lt.iconsNeedLinear,wr=Lt.sdfIcons||m.options.rotating||m.options.zooming||xl||fr?Ie.LINEAR:Ie.NEAREST,fh=Lt.sdfIcons&&0!==c.paint.get("icon-halo-width").constantOr(1),_d=m.terrain&&ze&&Er?h.a6.mat4.invert(h.a6.mat4.create(),Yr):th;if(Er&&Lt.icon){const mh=Re.elevation,kg=mh?mh.getAtTileOffsetFunc(Ot,Re.center.lat,Re.worldSize,Lt.getProjection()):null,bd=nr(zn,Ut.tileID.canonical,ze,Fe,Re,Lt.getProjection(),Sn);Xh(Lt,zn,m,!1,bd,Bo,ze,K,kg,Ot)}return{program:Ka,buffers:Lt.icon,uniformValues:la,atlasTexture:jl,atlasTextureIcon:null,atlasInterpolation:wr,atlasInterpolationIcon:null,isSDF:Lt.sdfIcons,hasHalo:fh,tile:Ut,labelPlaneMatrixInv:_d}},Br=()=>{const Er=He&&"point"!==c.layout.get("symbol-placement"),xr=[],po=Er||sn||pn;m.terrainRenderModeElevated()&&Ne&&xr.push("PITCH_WITH_MAP_TERRAIN"),un&&(xr.push("PROJECTION_GLOBE_VIEW"),po&&xr.push("PROJECTED_POS_ON_VIEWPORT")),Lt.text.zOffsetVertexBuffer&&xr.push("Z_OFFSET"),Lt.iconsInText&&xr.push("RENDER_TEXT_AND_SYMBOL"),xr.push("RENDER_SDF"),Jn(xr);const Vr=Lt.text.programConfigurations.get(c.id),Da=m.getOrCreateProgram("symbol",{config:Vr,defines:xr});let Ka,ss=[0,0],vi=null;const zi=Lt.textSizeData;Lt.iconsInText&&(ss=Ut.imageAtlasTexture?Ut.imageAtlasTexture.size:[0,0],vi=Ut.imageAtlasTexture?Ut.imageAtlasTexture:null,Ka=Ne||0!==Re.pitch||m.options.rotating||m.options.zooming||"composite"===zi.kind||"camera"===zi.kind?Ie.LINEAR:Ie.NEAREST);const fr=Ut.glyphAtlasTexture?Ut.glyphAtlasTexture.size:[0,0],Yr=c.layout.get("text-size-scale-range"),Bo=h.ap(m.scaleFactor,Yr[0],Yr[1]),io=h.bk(zi,Re.zoom,Bo),As=ki(zn,Ut.tileID.canonical,Ne,He,Re,Lt.getProjection(),Sn),zl=qa(zn,Ut.tileID.canonical,Ne,He,Re,Lt.getProjection(),Sn),Va=m.translatePosMatrix(zl,Ut,F,N,!0),Ea=m.translatePosMatrix(zn,Ut,F,N),vl=po?th:As,Vl=He&&!Ne&&!Er;let la=bt;!Ke&&!Re.mercatorFromTransition||He||(la=vg(Re));const jl=bg(zi.kind,io,Vl,Ne,m,Ea,vl,Va,Ee,!0,fr,ss,!0,Ot,Ln,Zt,Yn,un?la:bt,Lt.getProjection(),null,null,Bo),xl=Ut.glyphAtlasTexture?Ut.glyphAtlasTexture:null,wr=Ie.LINEAR,fh=0!==c.paint.get("text-halo-width").constantOr(1),_d=m.terrain&&Ne&&Er?h.a6.mat4.invert(h.a6.mat4.create(),As):th;if(Er&&Lt.text){const mh=Re.elevation,kg=mh?mh.getAtTileOffsetFunc(Ot,Re.center.lat,Re.worldSize,Lt.getProjection()):null,bd=nr(zn,Ut.tileID.canonical,Ne,He,Re,Lt.getProjection(),Sn);Xh(Lt,zn,m,!0,bd,zl,Ne,re,kg,Ot)}return{program:Da,buffers:Lt.text,uniformValues:jl,atlasTexture:xl,atlasTextureIcon:vi,atlasInterpolation:wr,atlasInterpolationIcon:Ka,isSDF:!0,hasHalo:fh,tile:Ut,labelPlaneMatrixInv:_d}},rr=Lt.icon.segments.get().length,Zr=Lt.text.segments.get().length,ur=rr&&!C.onlyText?Xi():null,zr=Zr&&!C.onlyIcons?Br():null,Bi=c.paint.get("icon-opacity").constantOr(1),Or=c.paint.get("text-opacity").constantOr(1);if(ut&&Lt.canOverlap){wt=!0;const Er=Bi&&!C.onlyText?Lt.icon.segments.get():[],xr=Or&&!C.onlyIcons?Lt.text.segments.get():[];for(const po of Er)Pt.push({segments:new h.b2([po]),sortKey:po.sortKey,state:ur});for(const po of xr)Pt.push({segments:new h.b2([po]),sortKey:po.sortKey,state:zr})}else C.onlyText||Pt.push({segments:Bi?Lt.icon.segments:new h.b2([]),sortKey:0,state:ur}),C.onlyIcons||Pt.push({segments:Or?Lt.text.segments:new h.b2([]),sortKey:0,state:zr})}wt&&Pt.sort((Ot,Ut)=>Ot.sortKey-Ut.sortKey);for(const Ot of Pt){const Ut=Ot.state;if(Ut)if(m.terrain?m.terrain.setupElevationDraw(Ut.tile,Ut.program,{useDepthForOcclusion:Re.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ut.labelPlaneMatrixInv}):m.setupDepthForOcclusion(Re.depthOcclusionForSymbolsAndCircles,Ut.program),Ae.activeTexture.set(Ie.TEXTURE0),Ut.atlasTexture&&Ut.atlasTexture.bind(Ut.atlasInterpolation,Ie.CLAMP_TO_EDGE,!0),Ut.atlasTextureIcon&&(Ae.activeTexture.set(Ie.TEXTURE1),Ut.atlasTextureIcon&&Ut.atlasTextureIcon.bind(Ut.atlasInterpolationIcon,Ie.CLAMP_TO_EDGE,!0)),m.uploadCommonLightUniforms(m.context,Ut.program),Ut.hasHalo){const Lt=Ut.uniformValues;Lt.u_is_halo=1,pp(Ut.buffers,Ot.segments,c,m,Ut.program,zt,v,S,Lt,2),Lt.u_is_halo=0}else{if(Ut.isSDF){const Lt=Ut.uniformValues;Ut.hasHalo&&(Lt.u_is_halo=1,pp(Ut.buffers,Ot.segments,c,m,Ut.program,zt,v,S,Lt,1)),Lt.u_is_halo=0}pp(Ut.buffers,Ot.segments,c,m,Ut.program,zt,v,S,Ut.uniformValues,1)}}}function pp(m,s,c,g,v,S,C,k,F,z){const N=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];v.draw(g,g.context.gl.TRIANGLES,S,C,k,li.disabled,F,c.id,m.layoutVertexBuffer,m.indexBuffer,s,c.paint,g.transform.zoom,m.programConfigurations.get(c.id),N,z)}function Wf(m,s,c,g,v,S,C){const k=m.context.gl,F=c.paint.get("fill-pattern"),z=c.is3D(),N=z?m.stencilModeFor3D():Jt.disabled,U=F&&F.constantOr(1);let q,W,ee,K,re;C?(W=U&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=k.LINES):(W=U?"fillPattern":"fill",q=k.TRIANGLES);for(const ie of g){const ge=s.getTile(ie);if(U&&!ge.patternsLoaded())continue;const xe=ge.getBucket(c);if(!xe)continue;m.prepareDrawTile();const ve=xe.programConfigurations.get(c.id),Ee=m.isTileAffectedByFog(ie),Ae=m.getOrCreateProgram(W,{config:ve,overrideFog:Ee});U&&(m.context.activeTexture.set(k.TEXTURE0),ge.imageAtlasTexture&&ge.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ve.updatePaintBuffers());const Ie=F.constantOr(null);if(Ie&&ge.imageAtlas){const He=ge.imageAtlas.patternPositions[Ie.toString()];He&&ve.setConstantPatternPositions(He)}const Re=m.translatePosMatrix(ie.projMatrix,ge,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Fe=c.paint.get("fill-emissive-strength");if(C){K=xe.indexBuffer2,re=xe.segments2;const He=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];ee="fillOutlinePattern"===W&&U?Qn(Re,Fe,m,ge,He):Rr(Re,Fe,He)}else K=xe.indexBuffer,re=xe.segments,ee=U?_n(Re,Fe,m,ge):mb(Re,Fe);m.uploadCommonUniforms(m.context,Ae,ie.toUnwrapped()),Ae.draw(m,q,v,z?N:m.stencilModeForClipping(ie),S,li.disabled,ee,c.id,xe.layoutVertexBuffer,K,re,c.paint,m.transform.zoom,ve,void 0)}}function wo(m,s,c,g,v,S,C,k){c.resetLayerRenderingStats(m);const F=m.context,z=F.gl,N=m.transform,U=c.paint.get("fill-extrusion-pattern"),q=U.constantOr(1),W=c.paint.get("fill-extrusion-opacity"),ee=m.style.enable3dLights(),K=c.paint.get(ee&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),re=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],ie=c.layout.get("fill-extrusion-edge-radius"),ge=ie>0&&!c.paint.get("fill-extrusion-rounded-roof"),xe=ge?0:ie,ve="globe"===N.projection.name?h.c_():0,Ee="globe"===N.projection.name,Ae=Ee?h.a9(N.zoom):0,Ie=[h.am(N.center.lng),h.at(N.center.lat)],Re=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(c.lut).toArray01().slice(0,3),Fe=c.paint.get("fill-extrusion-flood-light-intensity"),He=c.paint.get("fill-extrusion-vertical-scale"),ze=0!==c.paint.get("fill-extrusion-line-width").constantOr(1),Ne=c.paint.get("fill-extrusion-height-alignment"),ut=c.paint.get("fill-extrusion-base-alignment"),wt=_l(m,c.paint.get("fill-extrusion-cutoff-fade-range")),zt=[];let Zt;Ee&&zt.push("PROJECTION_GLOBE_VIEW"),re[0]>0&&zt.push("FAUX_AO"),ge&&zt.push("ZERO_ROOF_RADIUS"),k&&zt.push("HAS_CENTROID"),Fe>0&&zt.push("FLOOD_LIGHT"),wt.shouldRenderCutoff&&zt.push("RENDER_CUTOFF"),ze&&zt.push("RENDER_WALL_MODE");const sn="shadow"===m.renderPass,Ke=m.shadowRenderer,Pt=sn&&!!Ke;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let bt=[0,0,0];if(Ke){const Lt=m.style.directionalLight,un=m.style.ambientLight;Lt&&un&&(bt=wa(m.style,Lt,un)),sn||(zt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ke.useNormalOffset&&zt.push("NORMAL_OFFSET")),Zt=zt.concat(["SHADOWS_SINGLE_CASCADE"])}const Ot=Pt?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",Ut=c.getLayerRenderingStats();for(const Lt of g){const un=s.getTile(Lt),Ln=un.getBucket(c);if(!Ln||Ln.projection.name!==N.projection.name)continue;let zn=!1;Ke&&(zn=0===Ke.getMaxCascadeForTile(Lt.toUnwrapped()));const Sn=m.isTileAffectedByFog(Lt),jn=Ln.programConfigurations.get(c.id),pn=m.getOrCreateProgram(Ot,{config:jn,defines:zn?Zt:zt,overrideFog:Sn});if(m.terrain&&m.terrain.setupElevationDraw(un,pn,{useMeterToDem:!0}),!Ln.centroidVertexBuffer){const ur=pn.attributes.a_centroid_pos;void 0!==ur&&z.vertexAttrib2f(ur,0,0)}!sn&&Ke&&Ke.setupShadows(un.tileID.toUnwrapped(),pn,"vector-tile",un.tileID.overscaledZ),q&&(m.context.activeTexture.set(z.TEXTURE0),un.imageAtlasTexture&&un.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),jn.updatePaintBuffers());const Yn=U.constantOr(null);if(Yn&&un.imageAtlas){const ur=un.imageAtlas.patternPositions[Yn.toString()];ur&&jn.setConstantPatternPositions(ur)}const Jn=c.paint.get("fill-extrusion-vertical-gradient"),Xi=1/Ln.tileToMeter;let Br;if(sn&&Ke){if(bb(un.tileID,Ln,m))continue;const ur=Ke.calculateShadowPassMatrixFromTile(un.tileID.toUnwrapped());Br=Uf(ur,xe,Xi,He,Ne,ut)}else{const ur=m.translatePosMatrix(Lt.expandedProjMatrix,un,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),zr=N.projection.createInversionMatrix(N,Lt.canonical);Br=q?gg(ur,m,Jn,W,re,xe,Xi,Lt,un,ve,Ne,ut,Ae,Ie,zr,Re,He):mg(ur,m,Jn,W,re,xe,Xi,Lt,ve,Ne,ut,Ae,Ie,zr,Re,He,Fe,bt)}m.uploadCommonUniforms(F,pn,Lt.toUnwrapped(),null,wt);let rr=Ln.segments;if("mercator"===N.projection.name&&!sn&&(rr=Ln.getVisibleSegments(un.tileID,m.terrain,m.transform.getFrustum(0)),!rr.get().length))continue;if(Ut)if(sn)for(const ur of rr.get())Ut.numRenderedVerticesInShadowPass+=ur.primitiveLength;else for(const ur of rr.get())Ut.numRenderedVerticesInTransparentPass+=ur.primitiveLength;const Zr=[];(m.terrain||k)&&Zr.push(Ln.centroidVertexBuffer),Ee&&Zr.push(Ln.layoutVertexExtBuffer),ze&&Zr.push(Ln.wallVertexBuffer),pn.draw(m,F.gl.TRIANGLES,v,S,C,li.backCCW,Br,c.id,Ln.layoutVertexBuffer,Ln.indexBuffer,rr,c.paint,m.transform.zoom,jn,Zr)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function Is(m,s,c,g,v,S,C,k,F,z,N,U,q,W,ee,K,re,ie,ge){const xe=m.context,ve=xe.gl,Ee=m.transform,Ae=m.transform.zoom,Ie=[],Re=_l(m,c.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===z?(Ie.push("CLEAR_SUBPASS"),ge&&(Ie.push("CLEAR_FROM_TEXTURE"),xe.activeTexture.set(ve.TEXTURE0),ge.bind(ve.LINEAR,ve.CLAMP_TO_EDGE))):"sdf"===z&&Ie.push("SDF_SUBPASS"),re&&Ie.push("HAS_CENTROID"),Re.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF");const Fe=c.layout.get("fill-extrusion-edge-radius"),He=(ze,Ne,ut,wt,zt)=>{const Zt=Ne.programConfigurations.get(c.id),sn=m.isTileAffectedByFog(ze),Ke=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:Zt,defines:Ie,overrideFog:sn}),Pt={u_matrix:wt,u_opacity:N,u_ao_pass:F?1:0,u_meter_to_tile:zt,u_ao:[U,q*zt],u_flood_light_intensity:W,u_flood_light_color:ee,u_attenuation:K,u_edge_radius:Ae>=17?0:Fe*zt,u_fb:0,u_fb_size:ge?ge.size[0]:0,u_dynamic_offset:1},bt=[];re&&bt.push(Ne.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(xe,Ke,ze.toUnwrapped(),null,Re),Ke.draw(m,xe.gl.TRIANGLES,v,S,C,k,Pt,c.id,Ne.vertexBuffer,Ne.indexBuffer,ut,c.paint,Ae,Zt,bt)};for(const ze of g){const Ne=s.getTile(ze),ut=Ne.getBucket(c);if(!ut||ut.projection.name!==Ee.projection.name||!ut.groundEffect||ut.groundEffect&&!ut.groundEffect.hasData())continue;const wt=ut.groundEffect,zt=1/ut.tileToMeter;{const Zt=m.translatePosMatrix(ze.projMatrix,Ne,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),sn=wt.getDefaultSegment();He(ze,wt,sn,Zt,zt)}if(ie)for(let Zt=0;Zt<4;Zt++){const sn=h.c$[Zt](ze),Ke=s.getTile(sn);if(!Ke)continue;const Pt=Ke.getBucket(c);if(!Pt||Pt.projection.name!==Ee.projection.name||!Pt.groundEffect||Pt.groundEffect&&!Pt.groundEffect.hasData())continue;const bt=Pt.groundEffect;let Ot,Ut;0===Zt?(Ot=[-h.ab,0,0],Ut=1):1===Zt?(Ot=[h.ab,0,0],Ut=0):2===Zt?(Ot=[0,-h.ab,0],Ut=3):(Ot=[0,h.ab,0],Ut=2);const Lt=bt.regionSegments[Ut];if(!Lt)continue;const un=new Float32Array(16);h.a6.mat4.translate(un,ze.projMatrix,Ot),He(ze,bt,Lt,m.translatePosMatrix(un,Ne,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),zt)}}}function Yo(m,s,c,g,v,S,C){0===g.centroidVertexArray.length&&g.createCentroidsBuffer();const k=S?S.findDEMTileFor(c):null;if(!(k&&k.dem||C))return;const F=ie=>new h.P(Math.ceil((ie+h.d2)*h.d3),0),z=ie=>{const ge=s.getSource().minzoom,xe=Ee=>{const Ae=s.getTileByID(Ee);if(Ae&&Ae.hasData())return Ae.getBucket(v)},ve=[0,-1,1];for(const Ee of ve){if(ie.overscaledZ+Ee<ge)continue;const Ae=xe(ie.calculateScaledKey(ie.overscaledZ+Ee));if(Ae)return Ae}},N=[0,0,0],U=(ie,ge)=>(N[0]=Math.min(ie.min.y,ge.min.y),N[1]=Math.max(ie.max.y,ge.max.y),N[2]=h.ab-ge.min.x>ie.max.x?ge.min.x-h.ab:ie.max.x,N),q=(ie,ge)=>(N[0]=Math.min(ie.min.x,ge.min.x),N[1]=Math.max(ie.max.x,ge.max.x),N[2]=h.ab-ge.min.y>ie.max.y?ge.min.y-h.ab:ie.max.y,N),W=[(ie,ge)=>U(ie,ge),(ie,ge)=>U(ge,ie),(ie,ge)=>q(ie,ge),(ie,ge)=>q(ge,ie)],ee=(ie,ge,xe,ve,Ee,Ae,Ie)=>{if(!S)return 0;const Re=[[Ae?xe:ie,Ae?ie:xe,0],[Ae?xe:ge,Ae?ge:xe,0]],Fe=Ie<0?h.ab+Ie:Ie,He=[Ae?Fe:(ie+ge)/2,Ae?(ie+ge)/2:Fe,0];return 0===xe&&Ie<0||0!==xe&&Ie>0?S.getForTilePoints(Ee,[He],!0,ve):Re.push(He),S.getForTilePoints(c,Re,!0,k),Math.max(Re[0][2],Re[1][2],He[2])/S.exaggeration()};for(let ie=0;ie<4;ie++){const ge=g.borderFeatureIndices[ie];if(0===ge.length)continue;const xe=h.c$[ie](c),ve=z(xe);if(!(ve&&ve instanceof h.d0)||g.borderDoneWithNeighborZ[ie]===ve.canonical.z)continue;0===ve.centroidVertexArray.length&&ve.createCentroidsBuffer();const Ee=S?S.findDEMTileFor(xe):null;if(!(Ee&&Ee.dem||C))continue;const Ae=(ie<2?1:5)-ie,Ie=ve.borderDoneWithNeighborZ[Ae]!==g.canonical.z,Re=ve.borderFeatureIndices[Ae];let Fe=0;if(g.canonical.z!==ve.canonical.z){for(const He of ge)g.showCentroid(g.featuresOnBorder[He]);if(Ie)for(const He of Re)ve.showCentroid(ve.featuresOnBorder[He]);g.borderDoneWithNeighborZ[ie]=ve.canonical.z,ve.borderDoneWithNeighborZ[Ae]=g.canonical.z}for(const He of ge){const ze=g.featuresOnBorder[He],Ne=g.centroidData[ze.centroidDataIndex],ut=ze.borders[ie];let wt;for(;Fe<Re.length;){wt=ve.featuresOnBorder[Re[Fe]];const zt=wt.borders[Ae];if(zt[1]>ut[0]+3||zt[0]>ut[0]-3)break;ve.showCentroid(wt),Fe++}if(wt&&Fe<Re.length){const zt=Fe;let Zt=0;for(;!(wt.borders[Ae][0]>ut[1]-3)&&(Zt++,++Fe!==Re.length);)wt=ve.featuresOnBorder[Re[Fe]];wt=ve.featuresOnBorder[Re[zt]];let sn=!1;if(Zt>=1){const bt=wt.borders[Ae];Math.abs(ut[0]-bt[0])<3&&Math.abs(ut[1]-bt[1])<3&&(Zt=1,sn=!0,Fe=zt+1)}else if(0===Zt){g.showCentroid(ze);continue}const Ke=ve.centroidData[wt.centroidDataIndex];C&&sn&&(((K=Ne).flags|(re=Ke).flags)&h.d1?(K.flags|=h.d1,re.flags|=h.d1):(K.flags&=~h.d1,re.flags&=~h.d1));const Pt=ze.intersectsCount()>1||wt.intersectsCount()>1;if(Zt>1)Fe=zt,Ne.centroidXY=Ke.centroidXY=new h.P(0,0);else if(Ee&&Ee.dem&&!Pt){const bt=W[ie](Ne,Ke),Ot=ie%2?h.ab-1:0,Ut=ee(bt[0],Math.min(h.ab-1,bt[1]),Ot,Ee,xe,ie<2,bt[2]);Ne.centroidXY=Ke.centroidXY=F(Ut)}else Pt?Ne.centroidXY=Ke.centroidXY=new h.P(0,0):(Ne.centroidXY=g.encodeBorderCentroid(ze),Ke.centroidXY=ve.encodeBorderCentroid(wt));g.writeCentroidToBuffer(Ne),ve.writeCentroidToBuffer(Ke)}else g.showCentroid(ze)}g.borderDoneWithNeighborZ[ie]=ve.canonical.z,ve.borderDoneWithNeighborZ[Ae]=g.canonical.z}var K,re;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(m)}const gu=[1,0,0],xg=[0,1,0],nh=[0,0,1];function bb(m,s,c){const g=c.transform,v=c.shadowRenderer;if(!v)return!0;const S=m.toUnwrapped(),C=g.tileSize*v._cascades[c.currentShadowCascade].scale;let k=s.maxHeight;if(g.elevation){const K=g.elevation.getMinMaxForTile(m);K&&(k+=K.max)}const F=[...v.shadowDirection];F[2]=-F[2];const z=v.computeSimplifiedTileShadowVolume(S,k,C,F);if(!z)return!1;const N=[gu,xg,nh,F,[F[0],0,F[2]],[0,F[1],F[2]]],U="globe"===g.projection.name,q=g.scaleZoom(C),W=h.bO.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,q,!U),ee=v.getCurrentCascadeFrustum();return 0===W.intersectsPrecise(z.vertices,z.planes,N)||0===ee.intersectsPrecise(z.vertices,z.planes,N)}function Xa(m){return[m[0]*h.d4,m[1]*h.d4,m[2]*h.d4,0]}function Po(m,s,c,g,v,S,C,k,F){const z=g.getSource(),N=c.globeSharedBuffers;if(!N)return;let U,q,W;if(s&&(U=g.getTile(s)),z instanceof h.aD?(q=z.texture,W=h.cD(0,0,c.transform)):U&&s&&(q=U.texture,W=h.cD(s.canonical.z,s.canonical.x,c.transform)),!q||!W)return;m||(W=h.a6.mat4.scale(h.a6.mat4.create(),W,[1,-1,1]));const ee=c.context,K=ee.gl,re="nearest"===v.paint.get("raster-resampling")?K.NEAREST:K.LINEAR,ie=c.colorModeForDrapableLayerRenderPass(S),ge=C.defines;ge.push("GLOBE_POLES");const xe=new Vn(K.LEQUAL,Vn.ReadWrite,c.depthRangeFor3D),ve=Float32Array.from(c.transform.expandedFarZProjMatrix),Ee=Float32Array.from(h.b6(h.cC(new h.bQ(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),ee.activeTexture.set(K.TEXTURE0),q.bind(re,K.CLAMP_TO_EDGE),ee.activeTexture.set(K.TEXTURE1),q.bind(re,K.CLAMP_TO_EDGE),q.useMipmap&&ee.extTextureFilterAnisotropic&&c.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,ee.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ee.extTextureFilterAnisotropicMax);const[Ae,Ie,Re,Fe]=s?N.getPoleBuffers(s.canonical.z,!1):N.getPoleBuffers(0,!0),He=v.paint.get("raster-elevation");let ze;m?(ze=Ae,c.renderDefaultNorthPole=0!==He):(ze=Ie,c.renderDefaultSouthPole=0!==He);const Ne=Xa(C.mix),ut=(zt=ve,Zt=Ee,sn=W,Ke=h.a9(c.transform.zoom),bt=v,Ut=He,un=Ne,Ln=C.offset,zn=C.range,Sn=S,eh(zt,Zt,sn,new Float32Array(16),new Float32Array(9),[0,0],Ke,[0,0],[0,0,0,0],1,{opacity:1,mix:0},bt,[0,0],Ut,2,un,Ln,zn,1,0,Sn)),wt=c.getOrCreateProgram("raster",{defines:ge});var zt,Zt,sn,Ke,bt,Ut,un,Ln,zn,Sn;c.uploadCommonUniforms(ee,wt,null),wt.draw(c,K.TRIANGLES,xe,F,ie,k,ut,v.id,ze,Re,Fe)}function ad(m){const s=m._nearZ,c=m.projection.farthestPixelDistance(m),g=c-s,v=.2*m.height,S=s+v;return[s,c,(S-v-s)/g,(S-s)/g]}function ih(m,s,c,g){if(m)return s instanceof Il&&m instanceof Ud?s.getTextureDescriptor(m,c,!0):{texture:m.texture,mix:Xa(g.mix),offset:g.offset,buffer:0,tileSize:1}}var fp=h.d5([{name:"a_index",type:"Int16",components:1}]);class Xf{constructor(s,c,g,v){const S={width:g[0],height:g[1],data:null},C=s.gl;this.targetColorTexture=new h.T(s,S,C.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new h.T(s,S,C.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(c,v),this.lastInvalidatedAt=0}updateParticleTexture(s,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,v=c.width*c.height;this.particleTexture0=new h.T(this.context,c,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new h.T(this.context,c,g.RGBA8,{premultiply:!1,useMipmap:!1});const S=new h.d6;S.reserve(v);for(let C=0;C<v;C++)S.emplaceBack(C);this.particleIndexBuffer=this.context.createVertexBuffer(S,fp.members,!0),this.particleSegment=h.b2.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=h.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function wg(m,s,c){if(!m)return null;const g=s.getTextureDescriptor(m,c,!0);if(!g)return null;let{texture:v,mix:S,offset:C,tileSize:k,buffer:F,format:z}=g;if(!v||!z)return null;let N=!1;return"uint32"===z&&(N=!0,S[3]=0,S=$a(h.d7,S,[0,c.paint.get("raster-particle-max-speed")]),C=mu(h.d7,C,[0,c.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[F/(k+2*F),k/(k+2*F)],tileSize:k,scalarData:N,scale:S,offset:C,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function Uv(m){const s=m._nearZ,c=m.projection.farthestPixelDistance(m),g=c-s,v=.2*m.height,S=s+v;return[s,c,(S-v-s)/g,(S-s)/g]}const Za=new h.bA(1,0,0,1),lc=new h.bA(0,1,0,1),Qt=new h.bA(0,0,1,1),Bn=new h.bA(1,0,1,1),cc=new h.bA(0,1,1,1);function $r(m,s,c,g,v,S,C){const k=m.context,F=m.transform,z=k.gl,N="globe"===F.projection.name,U=N?["PROJECTION_GLOBE_VIEW"]:[];let q=h.a6.mat4.clone(c.projMatrix);if(N&&h.a9(F.zoom)>0){const Ne=h.b5(c.canonical,F),ut=h.d8(Ne);q=h.a6.mat4.multiply(new Float32Array(16),F.globeMatrix,ut),h.a6.mat4.multiply(q,F.projMatrix,q)}const W=h.a6.mat4.create();W[12]+=2*v/(h.q.devicePixelRatio*F.width),W[13]+=2*S/(h.q.devicePixelRatio*F.height),h.a6.mat4.multiply(q,W,q);const ee=m.getOrCreateProgram("debug",{defines:U}),K=s.getTileByID(c.key);m.terrain&&m.terrain.setupElevationDraw(K,ee);const re=Vn.disabled,ie=Jt.disabled,ge=m.colorModeForRenderPass();k.activeTexture.set(z.TEXTURE0),m.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),N?K._makeGlobeTileDebugBuffers(m.context,F):K._makeDebugTileBoundsBuffers(m.context,F.projection);const ve=K._tileDebugBuffer||m.debugBuffer,Ee=K._tileDebugIndexBuffer||m.debugIndexBuffer,Ae=K._tileDebugSegments||m.debugSegments;if(ee.draw(m,z.LINE_STRIP,re,ie,ge,li.disabled,vs(q,g),"$debug",ve,Ee,Ae,null,null,null,[K._globeTileDebugBorderBuffer]),C){const Ne=K.latestRawTileData,ut=Math.floor((Ne&&Ne.byteLength||0)/1024);let wt=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(wt+=` => ${c.overscaledZ}`),wt+=` ${K.state}`,wt+=` ${ut}kb`,function(zt,Zt){zt.initDebugOverlayCanvas();const sn=zt.debugOverlayCanvas,Ke=zt.context.gl,Pt=zt.debugOverlayCanvas.getContext("2d");Pt.clearRect(0,0,sn.width,sn.height),Pt.shadowColor="white",Pt.shadowBlur=2,Pt.lineWidth=1.5,Pt.strokeStyle="white",Pt.textBaseline="top",Pt.font="bold 36px Open Sans, sans-serif",Pt.fillText(Zt,5,5),Pt.strokeText(Zt,5,5),zt.debugOverlayTexture.update(sn),zt.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(m,wt)}const Ie=s.getTile(c).tileSize,Re=512/Math.min(Ie,512)*(c.overscaledZ/F.zoom)*.5,Fe=K._tileDebugTextBuffer||m.debugBuffer,He=K._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,ze=K._tileDebugTextSegments||m.debugSegments;ee.draw(m,z.TRIANGLES,re,ie,Si.alphaBlended,li.disabled,vs(q,h.bA.transparent,Re),"$debug",Fe,He,ze,null,null,null,[K._globeTileDebugTextBuffer])}function ot(m,s,c,g){rh(m,0,s+c/2,m.transform.width,c,g)}function Sg(m,s,c,g){rh(m,s-c/2,0,c,m.transform.height,g)}function rh(m,s,c,g,v,S){const C=m.context,k=C.gl;k.enable(k.SCISSOR_TEST),k.scissor(s*h.q.devicePixelRatio,c*h.q.devicePixelRatio,g*h.q.devicePixelRatio,v*h.q.devicePixelRatio),C.clear({color:S}),k.disable(k.SCISSOR_TEST)}const yb=h.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ld}=yb;function uc(m,s,c,g){m.emplaceBack(s,c,g)}class Zf{constructor(s){this.vertexArray=new h.d9,this.indices=new h.aP,uc(this.vertexArray,-1,-1,1),uc(this.vertexArray,1,-1,1),uc(this.vertexArray,-1,1,1),uc(this.vertexArray,1,1,1),uc(this.vertexArray,-1,-1,-1),uc(this.vertexArray,1,-1,-1),uc(this.vertexArray,-1,1,-1),uc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,ld),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=h.b2.simpleSegment(0,0,36,12)}}function Na(m,s,c,g,v,S){const C=m.context.gl,k=s.paint.get("sky-atmosphere-color"),F=s.paint.get("sky-atmosphere-halo-color"),z=s.paint.get("sky-atmosphere-sun-intensity"),N={u_matrix_3f:h.a6.mat3.fromMat4(h.a6.mat3.create(),g),u_sun_direction:v,u_sun_intensity:z,u_color_tint_r:[(ee=k).r,ee.g,ee.b,ee.a],u_color_tint_m:[(K=F).r,K.g,K.b,K.a],u_luminance:5e-5};var ee,K;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+S,s.skyboxTexture,0),c.draw(m,C.TRIANGLES,Vn.disabled,Jt.disabled,Si.unblended,li.frontCW,N,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const vb=h.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class xb{constructor(s){const c=new h.da;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const g=new h.aP;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(c,vb.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=h.b2.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const cd=h.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Yf{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class _u{constructor(s){this.colorModeAlphaBlendedWriteRGB=new Si([1,771,1,771],h.bA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Si([1,0,1,0],h.bA.transparent,[!1,!1,!1,!0]),this.params=new Yf,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){const c=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new xb(c);const g=this.params.sizeRange,v=this.params.intensityRange,S=function(N){const U=h.dd(30),q=[];for(let W=0;W<N;++W){const ee=2*Math.PI*U(),K=Math.acos(1-2*U())-.5*Math.PI;q.push(h.a6.vec3.fromValues(Math.cos(K)*Math.cos(ee),Math.cos(K)*Math.sin(ee),Math.sin(K)))}return q}(this.params.starsCount),C=h.dd(300),k=new h.db,F=new h.aP;let z=0;for(let N=0;N<S.length;++N){const U=h.a6.vec3.scale([],S[N],200),q=Math.max(0,1+.01*g*(1*C()-.5)),W=Math.max(0,1+.01*v*(1*C()-.5));k.emplaceBack(U[0],U[1],U[2],-1,-1,q,W),k.emplaceBack(U[0],U[1],U[2],1,-1,q,W),k.emplaceBack(U[0],U[1],U[2],1,1,q,W),k.emplaceBack(U[0],U[1],U[2],-1,1,q,W),F.emplaceBack(z+0,z+1,z+2),F.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=c.createVertexBuffer(k,cd.members),this.starsIdx=c.createIndexBuffer(F),this.starsSegments=h.b2.simpleSegment(0,0,k.length,F.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,c){const g=s.context,v=g.gl,S=s.transform,C=new Vn(v.LEQUAL,Vn.ReadOnly,[0,1]),k=h.a9(S.zoom),F=s.style.getLut(c.scope),z=c.properties.get("color").toRenderColor(F).toArray01(),N=c.properties.get("high-color").toRenderColor(F).toArray01(),U=c.properties.get("space-color").toRenderColor(F).toArray01PremultipliedAlpha(),q=5e-4,W=h.dc(c.properties.get("horizon-blend"),0,1,q,.25),ee=h.cx(s,g,S)&&W===q?S.worldSize/(2*Math.PI*1.025)-1:S.globeRadius,K=s.frameCounter/1e3%1,re=h.a6.vec3.length(S.globeCenterInViewSpace),ie=Math.sqrt(Math.pow(re,2)-Math.pow(ee,2)),ge=Math.acos(ie/re),xe=ve=>{const Ee="globe"===S.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&Ee.push("ALPHA_PASS");const Ae=s.getOrCreateProgram("globeAtmosphere",{defines:Ee}),Ie={u_frustum_tl:S.frustumCorners.TL,u_frustum_tr:S.frustumCorners.TR,u_frustum_br:S.frustumCorners.BR,u_frustum_bl:S.frustumCorners.BL,u_horizon:S.frustumCorners.horizon,u_transition:k,u_fadeout_range:W,u_color:z,u_high_color:N,u_space_color:U,u_temporal_offset:K,u_horizon_angle:ge};s.uploadCommonUniforms(g,Ae);const Re=this.atmosphereBuffer;Re&&Ae.draw(s,v.TRIANGLES,C,Jt.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,li.backCW,Ie,ve?"atmosphere_glow_alpha":"atmosphere_glow",Re.vertexBuffer,Re.indexBuffer,Re.segments)};xe(!1),xe(!0)}drawStars(s,c){const g=h.ap(c.properties.get("star-intensity"),0,1);if(0===g)return;const v=s.context,S=v.gl,C=s.transform,k=s.getOrCreateProgram("stars"),F=h.a6.quat.identity([]);h.a6.quat.rotateX(F,F,-C._pitch),h.a6.quat.rotateZ(F,F,-C.angle),h.a6.quat.rotateX(F,F,h.bC(C._center.lat)),h.a6.quat.rotateY(F,F,-h.bC(C._center.lng));const z=h.a6.mat4.fromQuat(new Float32Array(16),F),N=h.a6.mat4.multiply([],C.starsProjMatrix,z),U=h.a6.mat3.fromMat4([],z),q=h.a6.mat3.invert([],U),W=[0,1,0];h.a6.vec3.transformMat3(W,W,q),h.a6.vec3.scale(W,W,this.params.sizeMultiplier);const ee=[1,0,0];h.a6.vec3.transformMat3(ee,ee,q),h.a6.vec3.scale(ee,ee,this.params.sizeMultiplier);const K=(re=W,ie=ee,ge=g,{u_matrix:Float32Array.from(N),u_up:re,u_right:ie,u_intensity_multiplier:ge});var re,ie,ge;s.uploadCommonUniforms(v,k),this.starsVx&&this.starsIdx&&k.draw(s,S.TRIANGLES,Vn.disabled,Jt.disabled,this.colorModeAlphaBlendedWriteRGB,li.disabled,K,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function mp(m,s){const c=[...m],g=s.cameraWorldSizeForFog/s.worldSize,v=h.a6.mat4.identity([]);return h.a6.mat4.scale(v,v,[g,g,1]),h.a6.mat4.multiply(c,v,c),h.a6.mat4.multiply(c,s.worldToFogMatrix,c),c}function ud(m,s,c,g,v){const S=c.material,C=g.context,{baseColorTexture:k,metallicRoughnessTexture:F}=S.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:N,emissionTexture:U}=S;function q(ee,K,re){if(ee&&(m.push(K),C.activeTexture.set(C.gl.TEXTURE0+re),ee.gfxTexture)){const{minFilter:ie,magFilter:ge,wrapS:xe,wrapT:ve}=ee.sampler;ee.gfxTexture.bindExtraParam(ie,ge,xe,ve)}}q(k,"HAS_TEXTURE_u_baseColorTexture",ir_BaseColor),q(F,"HAS_TEXTURE_u_metallicRoughnessTexture",ir_MetallicRoughness),q(z,"HAS_TEXTURE_u_normalTexture",ir_Normal),q(N,"HAS_TEXTURE_u_occlusionTexture",ir_Occlusion),q(U,"HAS_TEXTURE_u_emissionTexture",ir_Emission),v&&(v.texture||(v.texture=new h.df(g.context,v.image,[v.image.height,v.image.height,v.image.height],C.gl.RGBA8)),C.activeTexture.set(C.gl.TEXTURE0+ir_LUT),v.texture&&v.texture.bind(C.gl.LINEAR,C.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(c.texcoordBuffer)),c.colorBuffer&&(m.push(12===c.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(c.colorBuffer)),c.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(c.normalBuffer)),c.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(c.pbrBuffer)),"OPAQUE"!==S.alphaMode&&"MASK"!==S.alphaMode||m.push("UNPREMULT_TEXTURE_IN_SHADER"),S.defined||m.push("DIFFUSE_SHADED"),m.push("USE_STANDARD_DERIVATIVES");const W=g.shadowRenderer;W&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&m.push("NORMAL_OFFSET"))}function oh(m,s,c,g,v,S){const C=c.paint.get("model-opacity"),k=s.context,F=new Vn(s.context.gl.LEQUAL,Vn.ReadWrite,s.depthRangeFor3D),z=s.transform,N=m.mesh,U=N.material,q=U.pbrMetallicRoughness,W=s.style.fog;let ee;ee="pixels"===s.transform.projection.zAxisUnit?[...m.nodeModelMatrix]:h.a6.mat4.multiply([],g.zScaleMatrix,m.nodeModelMatrix),h.a6.mat4.multiply(ee,g.negCameraPosMatrix,ee);const K=h.a6.mat4.invert([],ee);h.a6.mat4.transpose(K,K);const re=c.paint.get("model-emissive-strength").constantOr(0),ie=dp(new Float32Array(m.worldViewProjection),new Float32Array(ee),new Float32Array(K),null,s,C,q.baseColorFactor.toRenderColor(null),U.emissiveFactor,q.metallicFactor,q.roughnessFactor,U,re,c),ge={defines:[]},xe=[],ve=s.shadowRenderer;ve&&(ve.useNormalOffset=!1),ud(ge.defines,xe,N,s,c.lut);let Ee=null;if(W){const Re=mp(m.nodeModelMatrix,s.transform);if(Ee=new Float32Array(Re),"globe"!==z.projection.name){const Fe=N.aabb.min,He=N.aabb.max,[ze,Ne]=W.getOpacityForBounds(Re,Fe[0],Fe[1],He[0],He[1]);ge.overrideFog=ze>=Yt||Ne>=Yt}}const Ae=_l(s,c.paint.get("model-cutoff-fade-range"));Ae.shouldRenderCutoff&&ge.defines.push("RENDER_CUTOFF");const Ie=s.getOrCreateProgram("model",ge);s.uploadCommonUniforms(k,Ie,null,Ee,Ae),"shadow"!==s.renderPass&&ve&&ve.setupShadowsFromMatrix(m.nodeModelMatrix,Ie),Ie.draw(s,k.gl.TRIANGLES,F,v,S,N.material.doubleSided?li.disabled:li.backCCW,ie,c.id,N.vertexBuffer,N.indexBuffer,N.segments,c.paint,s.transform.zoom,void 0,xe)}function sh(m,s,c,g,v,S,C){let k;k="globe"===m.projection.name?h.dg(c,m):[...c],h.a6.mat4.multiply(k,k,s.matrix);const F=h.a6.mat4.multiply([],g,k);if(s.meshes)for(const z of s.meshes){if("BLEND"!==z.material.alphaMode){C.push({mesh:z,depth:0,modelIndex:v,worldViewProjection:F,nodeModelMatrix:k});continue}const N=h.a6.vec3.transformMat4([],z.centroid,F);N[2]>0&&S.push({mesh:z,depth:N[2],modelIndex:v,worldViewProjection:F,nodeModelMatrix:k})}if(s.children)for(const z of s.children)sh(m,z,c,g,v,S,C)}function gp(m,s,c,g){const v=c.shadowRenderer;if(!v)return;const S=v.getShadowPassDepthMode(),C=v.getShadowPassColorMode(),k=v.calculateShadowPassMatrixFromMatrix(s),F=yg(k);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,S,Jt.disabled,C,li.backCCW,F,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,c.transform.zoom,void 0,void 0)}function wb(m,s,c){const g=s.updateZoomBasedPaintProperties(),v=function(S,C,k){let F,z,N,U=S.terrain?S.terrain.exaggeration():0;if(S.terrain&&U>0){const q=S.terrain,W=q.findDEMTileFor(k);W&&W.dem?F=h.di.create(q,k,W):U=0}if(0===U&&(C.terrainElevationMin=0,C.terrainElevationMax=0),U===C.validForExaggeration&&(0===U||F&&F._demTile&&F._demTile.tileID===C.validForDEMTile.id&&F._dem._timestamp===C.validForDEMTile.timestamp))return!1;for(const q in C.instancesPerModel){const W=C.instancesPerModel[q];for(let ee=0;ee<W.instancedDataArray.length;++ee){const K=(F?U*F.getElevationAt(0|W.instancedDataArray.float32[16*ee],0|W.instancedDataArray.float32[16*ee+1],!0,!0):0)+W.instancesEvaluatedElevation[ee];W.instancedDataArray.float32[16*ee+6]=K,z=z?Math.min(C.terrainElevationMin,K):K,N=N?Math.max(C.terrainElevationMax,K):K}}return C.terrainElevationMin=z||0,C.terrainElevationMax=N||0,C.validForExaggeration=U,C.validForDEMTile=F&&F._demTile?{id:F._demTile.tileID,timestamp:F._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,s,c);(g||v)&&(s.uploaded=!1,s.upload(m.context))}const Ls={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new h.ca([0,0,0],[h.ab,h.ab,0])};function Ta(m,s){const c=1<<m.canonical.z,g=s.getFreeCameraOptions().position,v=s.elevation,S=m.canonical.x/c,C=(m.canonical.x+1)/c,k=m.canonical.y/c,F=(m.canonical.y+1)/c;let z=s._centerAltitude;if(v){const W=v.getMinMaxForTile(m);W&&W.max>z&&(z=W.max)}const N=h.ap(g.x,S,C)-g.x,U=h.ap(g.y,k,F)-g.y,q=h.bE(z,s.center.lat)-g.z;return s._zoomFromMercatorZ(Math.sqrt(N*N+U*U+q*q))}function ah(m,s,c,g,v,S,C){const k=m.context,F="shadow"===m.renderPass,z=m.shadowRenderer,N=F&&z?z.getShadowPassDepthMode():new Vn(k.gl.LEQUAL,Vn.ReadWrite,m.depthRangeFor3D),U=m.isTileAffectedByFog(S);if(c.meshes)for(const q of c.meshes){const W=["MODEL_POSITION_ON_GPU"],ee=[];let K,re,ie;g.instancedDataArray.length>20&&W.push("INSTANCED_ARRAYS");const ge=_l(m,s.paint.get("model-cutoff-fade-range"));if(ge.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),F&&z)K=m.getOrCreateProgram("modelDepth",{defines:W}),re=yg(C.shadowTileMatrix,C.shadowTileMatrix,Float32Array.from(c.matrix)),ie=z.getShadowPassColorMode();else{ud(W,ee,q,m,s.lut),K=m.getOrCreateProgram("model",{defines:W,overrideFog:U});const ve=q.material,Ee=ve.pbrMetallicRoughness,Ae=s.paint.get("model-opacity"),Ie=s.paint.get("model-emissive-strength").constantOr(0);re=dp(S.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,m,Ae,Ee.baseColorFactor.toRenderColor(null),ve.emissiveFactor,Ee.metallicFactor,Ee.roughnessFactor,ve,Ie,s,v),z&&(C.shadowUniformsInitialized?K.setShadowUniformValues(k,z.getShadowUniformValues()):(z.setupShadows(S.toUnwrapped(),K,"model-tile",S.overscaledZ),C.shadowUniformsInitialized=!0)),ie=ge.shouldRenderCutoff||Ae<1||"OPAQUE"!==ve.alphaMode?Si.alphaBlended:Si.unblended}m.uploadCommonUniforms(k,K,S.toUnwrapped(),null,ge);const xe=q.material.doubleSided?li.disabled:li.backCCW;if(g.instancedDataArray.length>20)ee.push(g.instancedDataBuffer),K.draw(m,k.gl.TRIANGLES,N,Jt.disabled,ie,xe,re,s.id,q.vertexBuffer,q.indexBuffer,q.segments,s.paint,m.transform.zoom,void 0,ee,g.instancedDataArray.length);else{const ve=F?"u_instance":"u_normal_matrix";for(let Ee=0;Ee<g.instancedDataArray.length;++Ee)re[ve]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Ee,16),K.draw(m,k.gl.TRIANGLES,N,Jt.disabled,ie,xe,re,s.id,q.vertexBuffer,q.indexBuffer,q.segments,s.paint,m.transform.zoom,void 0,ee)}}if(c.children)for(const q of c.children)ah(m,s,q,g,v,S,C)}const dd=[1,-1,1];function Wr(m,s,c,g){if(!c.modelManager)return!0;const v=c.modelManager;if(!c.shadowRenderer)return!0;const S=c.shadowRenderer,C=s.aabb;let k=!0,F=m.maxHeight;if(0===F){let N=0;for(const U in m.instancesPerModel){const q=v.getModel(U,g);q?N=Math.max(N,Math.max(Math.max(q.aabb.max[0],q.aabb.max[1]),q.aabb.max[2])):k=!1}F=m.maxScale*N*1.41+m.maxVerticalOffset,k&&(m.maxHeight=F)}C.max[2]=F,C.min[2]+=m.terrainElevationMin,C.max[2]+=m.terrainElevationMax,h.a6.vec3.transformMat4(C.min,C.min,s.tileMatrix),h.a6.vec3.transformMat4(C.max,C.max,s.tileMatrix);const z=C.intersects(S.getCurrentCascadeFrustum());return 0===c.currentShadowCascade&&(m.isInsideFirstShadowMapFrustum=2===z),0===z}function er(m,s){const c=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],v=m.uniformValues.u_cutoff_params[2],S=m.uniformValues.u_cutoff_params[3];return g===c||S===v?1:h.ap(((s-c)/(g-c)-v)/(S-v),0,1)}function _p(m,s,c,g){if(s.pitch<20)return 1;const v=s.getWorldToCameraMatrix();h.a6.mat4.multiply(v,v,m);const S=h.a6.vec4.fromValues(c.min[0],c.min[1],c.min[2],1);let C=h.a6.vec4.transformMat4(h.a6.vec4.create(),S,v),k=C,F=C;S[1]=c.max[1],C=h.a6.vec4.transformMat4(h.a6.vec4.create(),S,v),k=C[1]<k[1]?C:k,F=C[1]>F[1]?C:F,S[0]=c.max[0],C=h.a6.vec4.transformMat4(h.a6.vec4.create(),S,v),k=C[1]<k[1]?C:k,F=C[1]>F[1]?C:F,S[1]=c.min[1],C=h.a6.vec4.transformMat4(h.a6.vec4.create(),S,v),k=C[1]<k[1]?C:k,F=C[1]>F[1]?C:F;const z=h.ap(g[0],0,1),N=100*s.pixelsPerMeter*h.ap(g[1],0,1),U=h.ap(g[2],0,1),q=h.a6.vec4.lerp(h.a6.vec4.create(),k,F,z),W=Math.tan(.5*s.fovX),ee=-q[2]*W;if(0===N)return q[1]<-Math.abs(ee)?U:1;const K=(-Math.abs(ee)-q[1])/N,re=(ge,xe,ve)=>(1-ve)*ge+ve*xe,ie=h.ap(re(1,U,K),U,1);return re(1,ie,h.ap((s.pitch-20)/20,0,1))}class bu{}class bp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,c,g){{const U=this._storage.get(c.id);if(U)return U.lastUsedFrameIdx=s,U.buf}const v=g.gl,S=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),C=new ArrayBuffer(S),k=new Int16Array(C);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(C));const F=new h.dk;for(let U=0;U<S/2;U+=3){const q=k[U],W=k[U+1],ee=k[U+2];F.emplaceBack(q,W),F.emplaceBack(W,ee),F.emplaceBack(ee,q)}const z=g.bindVertexArrayOES.current,N=new bu;return N.buf=new ac(g,F),N.lastUsedFrameIdx=s,this._storage.set(c.id,N),g.bindVertexArrayOES.set(z),N.buf}update(s){for(const[c,g]of this._storage)s-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(c))}destroy(){for(const[s,c]of this._storage)c.buf.destroy(),this._storage.delete(s)}}class hd{constructor(s){this.occluderSize=30,this.depthOffset=-1e-4,s.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}class Jf{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const lh={symbol:function(m,s,c,g,v){if("translucent"!==m.renderPass)return;const S=Jt.disabled,C=m.colorModeForRenderPass(),k=c.layout.get("text-variable-anchor"),F=c.layout.get("text-size-scale-range"),z=h.ap(m.scaleFactor,F[0],F[1]);k&&function(q,W,ee,K,re,ie,ge,xe){const ve=W.transform,Ee="map"===re,Ae="map"===ie;for(const Ie of q){const Re=K.getTile(Ie),Fe=Re.getBucket(ee);if(!Fe||!Fe.text||!Fe.text.segments.get().length)continue;const He=h.bk(Fe.textSizeData,ve.zoom,xe),ze=Mc(Ie,Fe.getProjection(),ve),Ne=ve.calculatePixelsToTileUnitsMatrix(Re),ut=ki(ze,Re.tileID.canonical,Ae,Ee,ve,Fe.getProjection(),Ne),wt=Fe.hasIconTextFit()&&Fe.hasIconData();if(He){const zt=Math.pow(2,ve.zoom-Re.tileID.overscaledZ);$f(Fe,Ee,Ae,ge,h.cS,ve,ut,Ie,zt,He,wt)}}}(g,m,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v,z);const N=0!==c.paint.get("icon-opacity").constantOr(1),U=0!==c.paint.get("text-opacity").constantOr(1);void 0!==c.layout.get("symbol-sort-key").constantOr(1)&&(N||U)?sd(m,s,c,g,S,C):(N&&sd(m,s,c,g,S,C,{onlyIcons:!0}),U&&sd(m,s,c,g,S,C,{onlyText:!0})),s.map.showCollisionBoxes&&(hp(m,s,c,g,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),hp(m,s,c,g,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,c,g){if("translucent"!==m.renderPass)return;const v=c.paint.get("circle-opacity"),S=c.paint.get("circle-stroke-width"),C=c.paint.get("circle-stroke-opacity"),k=void 0!==c.layout.get("circle-sort-key").constantOr(1),F=c.paint.get("circle-emissive-strength");if(0===v.constantOr(1)&&(0===S.constantOr(1)||0===C.constantOr(1)))return;const z=m.context,N=z.gl,U=m.transform,q=m.depthModeForSublayer(0,Vn.ReadOnly),W=Jt.disabled,ee=m.colorModeForDrapableLayerRenderPass(F),K="globe"===U.projection.name,re=[h.am(U.center.lng),h.at(U.center.lat)],ie=[];for(let xe=0;xe<g.length;xe++){const ve=g[xe],Ee=s.getTile(ve),Ae=Ee.getBucket(c);if(!Ae||Ae.projection.name!==U.projection.name)continue;const Ie=Ae.programConfigurations.get(c.id),Re=h.cT(c),Fe=m.isTileAffectedByFog(ve);K&&Re.push("PROJECTION_GLOBE_VIEW"),Re.push("DEPTH_D24"),m.terrain&&U.depthOcclusionForSymbolsAndCircles&&Re.push("DEPTH_OCCLUSION");const He=m.getOrCreateProgram("circle",{config:Ie,defines:Re,overrideFog:Fe}),ze=Ae.layoutVertexBuffer,Ne=Ae.globeExtVertexBuffer,ut=Ae.indexBuffer,wt=U.projection.createInversionMatrix(U,ve.canonical),zt={programConfiguration:Ie,program:He,layoutVertexBuffer:ze,globeExtVertexBuffer:Ne,indexBuffer:ut,uniformValues:h.cU(m,ve,Ee,wt,re,c),tile:Ee};if(k){const Zt=Ae.segments.get();for(const sn of Zt)ie.push({segments:new h.b2([sn]),sortKey:sn.sortKey,state:zt})}else ie.push({segments:Ae.segments,sortKey:0,state:zt})}k&&ie.sort((xe,ve)=>xe.sortKey-ve.sortKey);const ge={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const xe of ie){const{programConfiguration:ve,program:Ee,layoutVertexBuffer:Ae,globeExtVertexBuffer:Ie,indexBuffer:Re,uniformValues:Fe,tile:He}=xe.state,ze=xe.segments;m.terrain&&m.terrain.setupElevationDraw(He,Ee,ge),m.uploadCommonUniforms(z,Ee,He.tileID.toUnwrapped()),Ee.draw(m,N.TRIANGLES,q,W,ee,li.disabled,Fe,c.id,Ae,Re,ze,c.paint,U.zoom,ve,[Ie])}},heatmap:function(m,s,c,g){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const v=m.context,S=v.gl,C=Jt.disabled,k=new Si([S.ONE,S.ONE,S.ONE,S.ONE],h.bA.transparent,[!0,!0,!0,!0]);(function(W,ee,K,re){const ie=W.gl,ge=ee.width*re,xe=ee.height*re;W.activeTexture.set(ie.TEXTURE1),W.viewport.set([0,0,ge,xe]);let ve=K.heatmapFbo;if(!ve||ve&&(ve.width!==ge||ve.height!==xe)){ve&&ve.destroy();const Ee=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,Ee),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),ve=K.heatmapFbo=W.createFramebuffer(ge,xe,!0,null),function(Ae,Ie,Re,Fe,He,ze){const Ne=Ae.gl;Ne.texImage2D(Ne.TEXTURE_2D,0,Ae.extRenderToTextureHalfFloat?Ne.RGBA16F:Ne.RGBA,He,ze,0,Ne.RGBA,Ae.extRenderToTextureHalfFloat?Ne.HALF_FLOAT:Ne.UNSIGNED_BYTE,null),Fe.colorAttachment.set(Re)}(W,0,Ee,ve,ge,xe)}else ie.bindTexture(ie.TEXTURE_2D,ve.colorAttachment.get()),W.bindFramebuffer.set(ve.framebuffer)})(v,m,c,"globe"===m.transform.projection.name?.5:.25),v.clear({color:h.bA.transparent});const F=m.transform,z="globe"===F.projection.name,N=z?["PROJECTION_GLOBE_VIEW"]:[],U=z?li.frontCCW:li.disabled,q=[h.am(F.center.lng),h.at(F.center.lat)];for(let W=0;W<g.length;W++){const ee=g[W];if(s.hasRenderableParent(ee))continue;const K=s.getTile(ee),re=K.getBucket(c);if(!re||re.projection.name!==F.projection.name)continue;const ie=m.isTileAffectedByFog(ee),ge=re.programConfigurations.get(c.id),xe=m.getOrCreateProgram("heatmap",{config:ge,defines:N,overrideFog:ie}),{zoom:ve}=m.transform;m.terrain&&m.terrain.setupElevationDraw(K,xe),m.uploadCommonUniforms(v,xe,ee.toUnwrapped());const Ee=F.projection.createInversionMatrix(F,ee.canonical);xe.draw(m,S.TRIANGLES,Vn.disabled,C,k,U,nd(m,ee,K,Ee,q,ve,c.paint.get("heatmap-intensity")),c.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,c.paint,m.transform.zoom,ge,z?[re.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,S){const C=v.context,k=C.gl,F=S.heatmapFbo;if(!F)return;C.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,F.colorAttachment.get()),C.activeTexture.set(k.TEXTURE1);let z=S.colorRampTexture;z||(z=S.colorRampTexture=new h.T(C,S.colorRamp,k.RGBA8)),z.bind(k.LINEAR,k.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,k.TRIANGLES,Vn.disabled,Jt.disabled,v.colorModeForRenderPass(),li.disabled,{u_image:0,u_color_ramp:1,u_opacity:S.paint.get("heatmap-opacity")},S.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,S.paint,v.transform.zoom)}(m,c))},line:function(m,s,c,g){if("translucent"!==m.renderPass)return;const v=c.paint.get("line-opacity"),S=c.paint.get("line-width");if(0===v.constantOr(1)||0===S.constantOr(1))return;const C=c.paint.get("line-emissive-strength"),k=c.paint.get("line-occlusion-opacity"),F="sea"===c.layout.get("line-elevation-reference"),z=m.context,N=z.gl,U=!c.isDraped();if(U&&"globe"===m.transform.projection.name)return;const q=c.layout.get("line-cross-slope"),W=void 0!==q,ee=q<1,K=U?new Vn(m.depthOcclusion?N.GREATER:N.LEQUAL,Vn.ReadOnly,m.depthRangeFor3D):m.depthModeForSublayer(0,Vn.ReadOnly),re=m.colorModeForDrapableLayerRenderPass(C),ie=m.terrain&&m.terrain.renderingToTexture,ge=ie?1:h.q.devicePixelRatio,xe=c.paint.get("line-dasharray"),ve=xe.constantOr(1),Ee=c.layout.get("line-cap"),Ae=xe.constantOr(null),Ie=Ee.constantOr(null),Re=c.paint.get("line-pattern"),Fe=Re.constantOr(1),He=Re.constantOr(null),ze=c.paint.get("line-opacity").constantOr(1);let Ne=!Fe&&1!==ze||m.depthOcclusion&&k>0&&k<1;const ut=c.paint.get("line-gradient"),wt=Fe?"linePattern":"line",zt=h.cV(c);let Zt;if(ie&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Ne=!1),0!==k&&m.depthOcclusion){const Ke=c.paint._values["line-opacity"];Ke&&Ke.value&&"constant"===Ke.value.kind?Zt=Ke.value:h.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}if(U&&(m.forceTerrainMode=!0),!U&&0!==k&&m.terrain&&!ie)return void h.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`);const sn=Ne&&U?m.stencilModeFor3D():Jt.disabled;U&&(zt.push("ELEVATED"),W&&zt.push(ee?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&zt.push("ELEVATION_REFERENCE_SEA"));for(const Ke of g){const Pt=s.getTile(Ke);if(Fe&&!Pt.patternsLoaded())continue;const bt=Pt.getBucket(c);if(!bt)continue;m.prepareDrawTile();const Ot=bt.programConfigurations.get(c.id),Ut=m.isTileAffectedByFog(Ke),Lt=m.getOrCreateProgram(wt,{config:Ot,defines:zt,overrideFog:Ut,overrideRtt:!U&&void 0});if(He&&Pt.imageAtlas){const pn=Pt.imageAtlas.patternPositions[He.toString()];pn&&Ot.setConstantPatternPositions(pn)}if(!Fe&&Ae&&Ie&&Pt.lineAtlas){const pn=Pt.lineAtlas.getDash(Ae,Ie);pn&&Ot.setConstantPatternPositions(pn)}let[un,Ln]=c.paint.get("line-trim-offset");("round"===Ie||"square"===Ie)&&un!==Ln&&(0===un&&(un-=1),1===Ln&&(Ln+=1));const zn=ie?Ke.projMatrix:null,Sn=Fe?h.cW(m,Pt,c,zn,ge,[un,Ln]):h.cX(m,Pt,c,zn,bt.lineClipsArray.length,ge,[un,Ln]);if(ut){const pn=bt.gradients[c.id];let Yn=pn.texture;if(c.gradientVersion!==pn.version){let Jn=256;if(c.stepInterpolant){const Xi=s.getSource().maxzoom,Br=Ke.canonical.z===Xi?Math.ceil(1<<m.transform.maxZoom-Ke.canonical.z):1;Jn=h.ap(h.cY(bt.maxLineLength/h.ab*1024*Br),256,z.maxTextureSize)}pn.gradient=h.cZ({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Jn,image:pn.gradient||void 0,clips:bt.lineClipsArray}),pn.texture?pn.texture.update(pn.gradient):pn.texture=new h.T(z,pn.gradient,N.RGBA8),pn.version=c.gradientVersion,Yn=pn.texture}z.activeTexture.set(N.TEXTURE1),Yn.bind(c.stepInterpolant?N.NEAREST:N.LINEAR,N.CLAMP_TO_EDGE)}ve&&(z.activeTexture.set(N.TEXTURE0),Pt.lineAtlasTexture&&Pt.lineAtlasTexture.bind(N.LINEAR,N.REPEAT),Ot.updatePaintBuffers()),Fe&&(z.activeTexture.set(N.TEXTURE0),Pt.imageAtlasTexture&&Pt.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Ot.updatePaintBuffers()),U&&!F&&m.terrain.setupElevationDraw(Pt,Lt),m.uploadCommonUniforms(z,Lt,Ke.toUnwrapped());const jn=pn=>{null!=Zt&&(Zt.value=ze*k),Lt.draw(m,N.TRIANGLES,K,pn,re,li.disabled,Sn,c.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,c.paint,m.transform.zoom,Ot,[bt.layoutVertexBuffer2,bt.patternVertexBuffer,bt.zOffsetVertexBuffer]),null!=Zt&&(Zt.value=ze)};if(Ne&&!U){const pn=m.stencilModeForClipping(Ke).ref;0===pn&&ie&&z.clear({stencil:0});const Yn={func:N.EQUAL,mask:255};Sn.u_alpha_discard_threshold=.8,jn(new Jt(Yn,pn,255,N.KEEP,N.KEEP,N.INVERT)),Sn.u_alpha_discard_threshold=0,jn(new Jt(Yn,pn,255,N.KEEP,N.KEEP,N.KEEP))}else Ne&&U&&(Sn.u_alpha_discard_threshold=.001),jn(U?sn:m.stencilModeForClipping(Ke))}U&&(m.forceTerrainMode=!1),Ne&&(m.resetStencilClippingMasks(),ie&&z.clear({stencil:0})),0===k||m.depthOcclusion||ie||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,s,c,g){const v=c.paint.get("fill-color"),S=c.paint.get("fill-opacity"),C=c.is3D(),k=new Vn(m.context.gl.LEQUAL,Vn.ReadWrite,m.depthRangeFor3D);if(0===S.constantOr(1))return;const F=c.paint.get("fill-emissive-strength"),z=m.colorModeForDrapableLayerRenderPass(F),N=c.paint.get("fill-pattern"),U=m.opaquePassEnabledForLayer()&&!N.constantOr(1)&&1===v.constantOr(h.bA.transparent).a&&1===S.constantOr(0)?"opaque":"translucent";if(m.renderPass===U){const q=C?k:m.depthModeForSublayer(1,"opaque"===m.renderPass?Vn.ReadWrite:Vn.ReadOnly);Wf(m,s,c,g,q,z,!1)}if(!C&&"translucent"===m.renderPass&&c.paint.get("fill-antialias")){const q=C?k:m.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,Vn.ReadOnly);Wf(m,s,c,g,q,z,!0)}},"fill-extrusion":function(m,s,c,g){const v=c.paint.get("fill-extrusion-opacity"),S=m.context,C=S.gl,k=m.terrain,F=k&&k.renderingToTexture;if(0===v)return;const z=m.conflationActive&&m.style.isLayerClipped(c,s.getSource()),N=m.style.order.indexOf(c.fqid);if(z&&function(U,q,W,ee,K){for(const re of ee){const ie=q.getTile(re).getBucket(W);ie&&(ie.updateReplacement(re,U.replacementSource,K),ie.uploadCentroid(U.context))}}(m,s,c,g,N),k||z)for(const U of g){const q=s.getTile(U).getBucket(c);q&&Yo(m.context,s,U,q,c,k,z)}if("shadow"===m.renderPass&&m.shadowRenderer){const U=m.shadowRenderer;if(k&&v<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof h.a4)return;const q=U.getShadowPassDepthMode(),W=U.getShadowPassColorMode();wo(m,s,c,g,q,Jt.disabled,W,z)}else if("translucent"===m.renderPass){const U=!c.paint.get("fill-extrusion-pattern").constantOr(1),q=c.paint.get("fill-extrusion-color").constantOr(h.bA.white);if(!F&&0!==q.a){const W=new Vn(m.context.gl.LEQUAL,Vn.ReadWrite,m.depthRangeFor3D);1===v&&U?wo(m,s,c,g,W,Jt.disabled,Si.unblended,z):(wo(m,s,c,g,W,Jt.disabled,Si.disabled,z),wo(m,s,c,g,W,m.stencilModeFor3D(),m.colorModeForRenderPass(),z),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&U&&(!k&&"globe"!==m.transform.projection.name||F)){const W=c.paint.get("fill-extrusion-opacity"),ee=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),K=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),re=c.paint.get("fill-extrusion-flood-light-intensity"),ie=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(c.lut).toArray01().slice(0,3),ge=ee>0&&K>0,xe=re>0,ve=(Ae,Ie,Re)=>(1-Re)*Ae+Re*Ie,Ee=Ae=>{const Ie=m.depthModeForSublayer(1,Vn.ReadOnly,C.LEQUAL,!0),Re=c.paint.get(Ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Fe=ve(.1,3,Re),He=m._showOverdrawInspector;if(!He){const ze=new Jt({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),Ne=new Si([C.ONE,C.ONE,C.ONE,C.ONE],h.bA.transparent,[!1,!1,!1,!0],C.MIN);Is(m,s,c,g,Ie,ze,Ne,li.disabled,Ae,"sdf",W,ee,K,re,ie,Fe,z,!1)}{const ze=He?Jt.disabled:new Jt({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),Ne=He?m.colorModeForRenderPass():new Si([C.ONE_MINUS_DST_ALPHA,C.DST_ALPHA,C.ONE,C.ONE],h.bA.transparent,[!0,!0,!0,!0]);Is(m,s,c,g,Ie,ze,Ne,li.disabled,Ae,"color",W,ee,K,re,ie,Fe,z,!1)}};if(F){const Ae=(Ie,Re,Fe)=>{const He=m.depthModeForSublayer(1,Vn.ReadOnly,C.LEQUAL,!1),ze=c.paint.get(Ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=ve(.1,3,ze);{const ut=new Si([C.ONE,C.ONE,C.ONE,C.ONE],h.bA.transparent,[!1,!1,!1,!0]);Is(m,s,c,g,He,Jt.disabled,ut,li.disabled,Ie,"clear",W,ee,K,re,ie,Ne,z,Re)}{const ut=new Jt({func:C.ALWAYS,mask:255},255,255,C.KEEP,C.KEEP,C.REPLACE),wt=new Si([C.ONE,C.ONE,C.ONE,C.ONE],h.bA.transparent,[!1,!1,!1,!0],C.MIN);Is(m,s,c,g,He,ut,wt,li.disabled,Ie,"sdf",W,ee,K,re,ie,Ne,z,Re)}{const ut=Ie?C.ZERO:C.ONE_MINUS_DST_ALPHA,wt=new Jt({func:C.EQUAL,mask:255},255,255,C.KEEP,C.DECR,C.DECR),zt=new Si([ut,C.DST_ALPHA,C.ONE_MINUS_DST_ALPHA,C.ZERO],h.bA.transparent,[!0,!0,!0,!0]);Is(m,s,c,g,He,wt,zt,li.disabled,Ie,"color",W,ee,K,re,ie,Ne,z,Re)}{const ut=new Si([C.ONE,C.ONE,C.ONE,Ie?C.ZERO:C.ONE],h.bA.transparent,[!1,!1,!1,!0],Ie?C.FUNC_ADD:C.MAX);Is(m,s,c,g,He,Jt.disabled,ut,li.disabled,Ie,"clear",W,ee,K,re,ie,Ne,z,Re,Fe)}};if(ge||xe){let Ie;if(m.prepareDrawTile(),k){const Re=k.drapeBufferSize[0],Fe=k.drapeBufferSize[1];Ie=k.framebufferCopyTexture,Ie&&(!Ie||Ie.size[0]===Re&&Ie.size[1]===Fe)||(Ie&&Ie.destroy(),Ie=k.framebufferCopyTexture=new h.T(S,new h.r({width:Re,height:Fe}),C.RGBA8)),Ie.bind(C.LINEAR,C.CLAMP_TO_EDGE),C.copyTexSubImage2D(C.TEXTURE_2D,0,0,0,0,0,Re,Fe)}ge&&Ae(!0,!1,Ie),xe&&Ae(!1,!0,Ie)}}else ge&&Ee(!0),xe&&Ee(!1),(ge||xe)&&m.resetStencilClippingMasks()}}},hillshade:function(m,s,c,g){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass||m.style.disableElevatedTerrain)return;const v=m.context,S=m.terrain&&m.terrain.renderingToTexture,[C,k]="translucent"!==m.renderPass||S?[{},g]:m.stencilConfigForOverlap(g);for(const F of k){const z=s.getTile(F);if(z.needsHillshadePrepare&&"offscreen"===m.renderPass)Kd(m,z,c);else if("translucent"===m.renderPass){const N=m.depthModeForSublayer(0,Vn.ReadOnly),U=c.paint.get("hillshade-emissive-strength"),q=m.colorModeForDrapableLayerRenderPass(U),W=S&&m.terrain?m.terrain.stencilModeForRTTOverlap(F):C[F.overscaledZ];Of(m,F,z,c,N,W,q)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,s,c,g,v,S){if("translucent"!==m.renderPass||0===c.paint.get("raster-opacity"))return;const C="globe"===m.transform.projection.name,k=0!==c.paint.get("raster-elevation"),F=k&&C;if(m.renderElevatedRasterBackface&&!F)return;const z=m.context,N=z.gl,U=s.getSource(),q=function(Ae,Ie,Re,Fe){const He=Ie.paint.get("raster-color"),ze="raster-array"===Ae.type,Ne=[],ut=Ie.paint.get("raster-resampling"),wt=Ie.paint.get("raster-color-mix");let zt=Ie.paint.get("raster-color-range");const Zt=[wt[0],wt[1],wt[2],0],sn=wt[3];let Ke="nearest"===ut?Fe.NEAREST:Fe.LINEAR;if(ze&&(Ne.push("RASTER_ARRAY"),He||Ne.push("RASTER_COLOR"),"linear"===ut&&Ne.push("RASTER_ARRAY_LINEAR"),Ke=Fe.NEAREST,!zt&&Ae.rasterLayers)){const Pt=Ae.rasterLayers.find(({id:bt})=>bt===Ie.sourceLayer);Pt&&Pt.fields&&Pt.fields.range&&(zt=Pt.fields.range)}if(zt=zt||[0,1],He){Ne.push("RASTER_COLOR"),Re.activeTexture.set(Fe.TEXTURE2),Ie.updateColorRamp(zt);let Pt=Ie.colorRampTexture;Pt||(Pt=Ie.colorRampTexture=new h.T(Re,Ie.colorRamp,Fe.RGBA8)),Pt.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}return{mix:Zt,range:zt,offset:sn,defines:Ne,resampling:Ke}}(U,c,z,N);if(U instanceof h.aD&&!g.length&&!C)return;const W=c.paint.get("raster-emissive-strength"),ee=m.colorModeForDrapableLayerRenderPass(W),K=m.terrain&&m.terrain.renderingToTexture,re=!m.options.moving,ie="nearest"===c.paint.get("raster-resampling")?N.NEAREST:N.LINEAR;if(U instanceof h.aD&&!g.length&&(U.onNorthPole||U.onSouthPole)){const Ae=k?m.stencilModeFor3D():Jt.disabled;return void Po(!!U.onNorthPole,null,m,s,c,W,q,li.disabled,Ae)}if(!g.length)return;const[ge,xe]=U instanceof h.aD||K?[{},g]:m.stencilConfigForOverlap(g),ve=xe[xe.length-1].overscaledZ;F&&q.defines.push("PROJECTION_GLOBE_VIEW"),k&&q.defines.push("RENDER_CUTOFF");const Ee=(Ae,Ie,Re)=>{for(const Fe of Ae){const He=Fe.toUnwrapped(),ze=s.getTile(Fe);if(K&&(!ze||!ze.hasData()))continue;z.activeTexture.set(N.TEXTURE0);const Ne=ih(ze,U,c,q);if(!Ne||!Ne.texture)continue;const{texture:ut,mix:wt,offset:zt,tileSize:Zt,buffer:sn}=Ne;let Ke,Pt;K?(Ke=Vn.disabled,Pt=Fe.projMatrix):k?(Ke=new Vn(N.LEQUAL,Vn.ReadWrite,m.depthRangeFor3D),Pt=C?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(He,re)):(Ke=m.depthModeForSublayer(Fe.overscaledZ-ve,1===c.paint.get("raster-opacity")?Vn.ReadWrite:Vn.ReadOnly,N.LESS),Pt=m.transform.calculateProjMatrix(He,re));const bt=m.terrain&&K?m.terrain.stencilModeForRTTOverlap(Fe):ge[Fe.overscaledZ],Ot=S?0:c.paint.get("raster-fade-duration");ze.registerFadeDuration(Ot);const Ut=s.findLoadedParent(Fe,0),Lt=aa(ze,Ut,s,m.transform,Ot);let un,Ln;m.terrain&&m.terrain.prepareDrawTile(),z.activeTexture.set(N.TEXTURE0),ut.bind(ie,N.CLAMP_TO_EDGE),z.activeTexture.set(N.TEXTURE1),Ut?(Ut.texture&&Ut.texture.bind(ie,N.CLAMP_TO_EDGE),un=Math.pow(2,Ut.tileID.overscaledZ-ze.tileID.overscaledZ),Ln=[ze.tileID.canonical.x*un%1,ze.tileID.canonical.y*un%1]):ut.bind(ie,N.CLAMP_TO_EDGE),ut.useMipmap&&z.extTextureFilterAnisotropic&&m.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const zn=m.transform;let Sn;const jn=k?ad(zn):[0,0,0,0];let pn,Yn,Jn,Xi,Br,rr=0;if(F&&U instanceof h.aD&&U.coordinates.length>3)pn=Float32Array.from(h.b6(h.cC(new h.bQ(0,0,0)))),Yn=Float32Array.from(zn.globeMatrix),Jn=Float32Array.from(h.cy(zn)),Xi=[h.am(zn.center.lng),h.at(zn.center.lat)],Sn=U.elevatedGlobePerspectiveTransform,Br=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(F){const Bi=h.cz(Fe.canonical);rr=h.cA(Bi.getCenter().lat),pn=Float32Array.from(h.b6(h.cC(Fe.canonical))),Yn=Float32Array.from(zn.globeMatrix),Jn=Float32Array.from(h.cy(zn)),Xi=[h.am(zn.center.lng),h.at(zn.center.lat)],Sn=[0,0],Br=Float32Array.from(h.cB(Fe.canonical,Bi,rr,zn.worldSize/zn._pixelsPerMercatorPixel))}else Sn=U instanceof h.aD?U.perspectiveTransform:[0,0],pn=new Float32Array(16),Yn=new Float32Array(9),Jn=new Float32Array(16),Xi=[0,0],Br=new Float32Array(9);const Zr=eh(Pt,pn,Yn,Jn,Br,Ln||[0,0],h.a9(m.transform.zoom),Xi,jn,un||1,Lt,c,Sn,k?c.paint.get("raster-elevation"):0,2,wt,zt,q.range,Zt,sn,W),ur=m.isTileAffectedByFog(Fe),zr=m.getOrCreateProgram("raster",{defines:q.defines,overrideFog:ur});if(m.uploadCommonUniforms(z,zr,He),U instanceof h.aD){const Bi=U.elevatedGlobeVertexBuffer,Or=U.elevatedGlobeIndexBuffer;if(K||!C)U.boundsBuffer&&U.boundsSegments&&zr.draw(m,N.TRIANGLES,Ke,Jt.disabled,ee,li.disabled,Zr,c.id,U.boundsBuffer,m.quadTriangleIndexBuffer,U.boundsSegments);else if(Bi&&Or){const Er=zn.zoom<=h.c3?U.elevatedGlobeSegments:U.getSegmentsForLongitude(zn.center.lng);Er&&zr.draw(m,N.TRIANGLES,Ke,Jt.disabled,ee,Ie,Zr,c.id,Bi,Or,Er)}}else if(F){Ke=new Vn(N.LEQUAL,Vn.ReadOnly,m.depthRangeFor3D);const Bi=m.globeSharedBuffers;if(Bi){const[Or,Er,xr]=Bi.getGridBuffers(rr,!1);zr.draw(m,N.TRIANGLES,Ke,Re||bt,m.colorModeForRenderPass(),Ie,Zr,c.id,Or,Er,xr)}}else{const{tileBoundsBuffer:Bi,tileBoundsIndexBuffer:Or,tileBoundsSegments:Er}=m.getTileBoundsBuffers(ze);zr.draw(m,N.TRIANGLES,Ke,bt,ee,li.disabled,Zr,c.id,Bi,Or,Er)}}if(!(U instanceof h.aD)&&F)for(const Fe of Ae){const He=Fe.canonical.y===(1<<Fe.canonical.z)-1;0===Fe.canonical.y&&Po(!0,Fe,m,s,c,W,q,Ie,Re||Jt.disabled),He&&Po(!1,Fe,m,s,c,W,q,Ie===li.frontCW?li.backCW:li.frontCW,Re||Jt.disabled)}};F?Ee(xe,m.renderElevatedRasterBackface?li.backCW:li.frontCW,m.stencilModeFor3D()):Ee(xe,li.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,s,c,g,v,S){"offscreen"===m.renderPass&&function(C,k,F,z){if(!z.length)return;const N=C.context,U=N.gl,q=k.getSource();if(!(q instanceof Il))return;const W=Math.ceil(Math.sqrt(F.paint.get("raster-particle-count")));let ee=F.particlePositionRGBAImage;if(!ee||ee.width!==W){const xe=function(ve){const Ee=ve*ve,Ae=new Uint8Array(4*Ee),Ie=function(Fe){return Fe|=0,Fe=Math.imul(2747636419^Fe,2654435769),Fe=Math.imul(Fe^Fe>>>16,2654435769),((Fe=Math.imul(Fe^Fe>>>16,2654435769))>>>0)/4294967296},Re=1/1.1;for(let Fe=0;Fe<Ee;Fe++){const He=Re*(Ie(2*Fe+0)+id),ze=Re*(Ie(2*Fe+1)+id),Ne=255*He%1,ut=255*ze%1,wt=Ne,zt=ze-ut/255,Zt=ut;Ae[4*Fe+0]=255*(He-Ne/255),Ae[4*Fe+1]=255*wt,Ae[4*Fe+2]=255*zt,Ae[4*Fe+3]=255*Zt}return Ae}(W);ee=F.particlePositionRGBAImage=new h.r({width:W,height:W},xe)}let K=F.particleFramebuffer;K?K.width!==W&&(K.destroy(),K=F.particleFramebuffer=N.createFramebuffer(W,W,!0,null)):K=F.particleFramebuffer=N.createFramebuffer(W,W,!0,null);const re=[];for(const xe of z){const ve=k.getTile(xe);if(!(ve instanceof Ud))continue;const Ee=wg(ve,q,F);if(!Ee)continue;const Ae=[ve.tileSize,ve.tileSize];let Ie=F.tileFramebuffer;Ie||(Ie=F.tileFramebuffer=N.createFramebuffer(Ae[0],Ae[1],!0,null));let Re=ve.rasterParticleState;Re||(Re=ve.rasterParticleState=new Xf(N,xe,Ae,ee));const Fe=Re.update(F.lastInvalidatedAt);Re.particleTextureDimension!==W&&Re.updateParticleTexture(xe,ee);const He=Re.targetColorTexture;Re.targetColorTexture=Re.backgroundColorTexture,Re.backgroundColorTexture=He;const ze=Re.particleTexture0;Re.particleTexture0=Re.particleTexture1,Re.particleTexture1=ze,re.push([xe,Ee,Re,Fe])}if(0===re.length)return;const ie=h.q.now(),ge=F.previousDrawTimestamp?.001*(ie-F.previousDrawTimestamp):.0167;if(F.previousDrawTimestamp=ie,F.hasColorMap()){N.activeTexture.set(U.TEXTURE0+2);let xe=F.colorRampTexture;xe||(xe=F.colorRampTexture=new h.T(N,F.colorRamp,U.RGBA8)),xe.bind(U.LINEAR,U.CLAMP_TO_EDGE)}N.bindFramebuffer.set(F.tileFramebuffer.framebuffer),function(xe,ve,Ee){const Ae=xe.context,Ie=Ae.gl,Re=ve.tileFramebuffer;Ae.activeTexture.set(Ie.TEXTURE0);const Fe={u_texture:0,u_opacity:1.05*(ze=ve.paint.get("raster-particle-fade-opacity-factor"))/(ze+.05)},He=xe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ze;for(const Ne of Ee){const[,,ut,wt]=Ne;Re.colorAttachment.set(ut.targetColorTexture.texture),Ae.viewport.set([0,0,Re.width,Re.height]),Ae.clear({color:h.bA.transparent}),wt&&(ut.backgroundColorTexture.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE),He.draw(xe,Ie.TRIANGLES,Vn.disabled,Jt.disabled,Si.alphaBlended,li.disabled,Fe,ve.id,xe.viewportBuffer,xe.quadTriangleIndexBuffer,xe.viewportSegments))}}(C,F,re),function(xe,ve,Ee,Ae){const Ie=xe.context,Re=Ie.gl,Fe=Ee.tileFramebuffer,He="globe"===xe.transform.projection.name,ze=Ee.paint.get("raster-particle-max-speed");for(const Ne of Ae){const[ut,wt,zt]=Ne;Ie.activeTexture.set(Re.TEXTURE0+0),wt.texture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),Fe.colorAttachment.set(zt.targetColorTexture.texture);const Zt=xe.getOrCreateProgram("rasterParticleDraw",{defines:wt.defines,overrideFog:!1});Ie.activeTexture.set(Re.TEXTURE0+1);const sn=wt.scalarData?[]:[0,1,2,3].map(bt=>h.c$[bt](ut));sn.push(ut);const Ke=ut.canonical.x,Pt=ut.canonical.y;for(const bt of sn){const Ot=ve.getTile(He?bt.wrapped():bt);if(!Ot)continue;const Ut=Ot.rasterParticleState;if(!Ut)continue;const Lt=bt.canonical.x+(1<<bt.canonical.z)*(bt.wrap-ut.wrap),un=bt.canonical.y;Ut.particleTexture0.bind(Re.NEAREST,Re.CLAMP_TO_EDGE);const Ln=up(1,Ut.particleTexture0.size[0],[Lt-Ke,un-Pt],0,wt.texture.size,2,ze,wt.textureOffset,wt.scale,wt.offset);Zt.draw(xe,Re.POINTS,Vn.disabled,Jt.disabled,Si.alphaBlended,li.disabled,Ln,Ee.id,Ut.particleIndexBuffer,void 0,Ut.particleSegment)}}}(C,k,F,re),N.bindFramebuffer.set(F.particleFramebuffer.framebuffer),function(xe,ve,Ee,Ae){const Ie=xe.context,Re=Ie.gl,Fe=ve.paint.get("raster-particle-max-speed"),He=Ae*ve.paint.get("raster-particle-speed-factor")*.15,ze=(ut=.01+1*ve.paint.get("raster-particle-reset-rate-factor"),Math.pow(ut,6)),Ne=ve.particleFramebuffer;var ut;Ie.viewport.set([0,0,Ne.width,Ne.height]);for(const ut of Ee){const[,wt,zt]=ut;Ie.activeTexture.set(Re.TEXTURE0+0),wt.texture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),Ie.activeTexture.set(Re.TEXTURE0+1);const Zt=zt.particleTexture0;Zt.bind(Re.NEAREST,Re.CLAMP_TO_EDGE);const sn=Js(1,Zt.size[0],0,wt.texture.size,Fe,He,ze,wt.textureOffset,wt.scale,wt.offset);Ne.colorAttachment.set(zt.particleTexture1.texture),Ie.clear({color:h.bA.transparent}),xe.getOrCreateProgram("rasterParticleUpdate",{defines:wt.defines}).draw(xe,Re.TRIANGLES,Vn.disabled,Jt.disabled,Si.unblended,li.disabled,sn,ve.id,xe.viewportBuffer,xe.quadTriangleIndexBuffer,xe.viewportSegments)}}(C,F,re,ge)}(m,s,c,g),"translucent"===m.renderPass&&(function(C,k,F,z,N){const U=C.context,q=U.gl,W=k.getSource().tileSize,ee=5*(1-h.a7(h.bV,h.bV+1,C.transform.zoom))*W+F.paint.get("raster-particle-elevation"),K=!C.options.moving,re="globe"===C.transform.projection.name;if(!z.length)return;const[ie,ge]=C.stencilConfigForOverlap(z),xe=[];re&&xe.push("PROJECTION_GLOBE_VIEW");const ve=C.stencilModeFor3D();for(const Ee of ge){const Ae=Ee.toUnwrapped(),Ie=k.getTile(Ee);if(!Ie.rasterParticleState)continue;const Re=Ie.rasterParticleState,Fe=100;Ie.registerFadeDuration(Fe);const He=k.findLoadedParent(Ee,0),ze=aa(Ie,He,k,C.transform,Fe);let Ne,ut;C.terrain&&C.terrain.prepareDrawTile(),U.activeTexture.set(q.TEXTURE0),Re.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),U.activeTexture.set(q.TEXTURE1),He&&He.rasterParticleState?(He.rasterParticleState.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Ne=Math.pow(2,He.tileID.overscaledZ-Ie.tileID.overscaledZ),ut=[Ie.tileID.canonical.x*Ne%1,Ie.tileID.canonical.y*Ne%1]):Re.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const wt=re?Float32Array.from(C.transform.expandedFarZProjMatrix):C.transform.calculateProjMatrix(Ae,K),zt=C.transform,Zt=Uv(zt),sn=h.cz(Ee.canonical),Ke=h.cA(sn.getCenter().lat);let Pt,bt,Ot,Ut,Lt;re?(Pt=Float32Array.from(h.b6(h.cC(Ee.canonical))),bt=Float32Array.from(zt.globeMatrix),Ot=Float32Array.from(h.cy(zt)),Ut=[h.am(zt.center.lng),h.at(zt.center.lat)],Lt=Float32Array.from(h.cB(Ee.canonical,sn,Ke,zt.worldSize/zt._pixelsPerMercatorPixel))):(Pt=new Float32Array(16),bt=new Float32Array(9),Ot=new Float32Array(16),Ut=[0,0],Lt=new Float32Array(9));const un=_g(wt,Pt,bt,Ot,Lt,ut||[0,0],h.a9(C.transform.zoom),Ut,Zt,Ne||1,ze,ee),Ln=C.isTileAffectedByFog(Ee),zn=C.getOrCreateProgram("rasterParticle",{defines:xe,overrideFog:Ln});if(C.uploadCommonUniforms(U,zn,Ae),re){const Sn=new Vn(q.LEQUAL,Vn.ReadOnly,C.depthRangeFor3D),jn=0,pn=C.globeSharedBuffers;if(pn){const[Yn,Jn,Xi]=pn.getGridBuffers(Ke,0!==jn);zn.draw(C,q.TRIANGLES,Sn,ve,Si.alphaBlended,C.renderElevatedRasterBackface?li.frontCCW:li.backCCW,un,F.id,Yn,Jn,Xi)}}else{const Sn=C.depthModeForSublayer(0,Vn.ReadOnly),jn=ie[Ee.overscaledZ],{tileBoundsBuffer:pn,tileBoundsIndexBuffer:Yn,tileBoundsSegments:Jn}=C.getTileBoundsBuffers(Ie);zn.draw(C,q.TRIANGLES,Sn,jn,Si.alphaBlended,li.disabled,un,F.id,pn,Yn,Jn)}}C.resetStencilClippingMasks()}(m,s,c,g),m.style.map.triggerRepaint())},background:function(m,s,c,g){const v=c.paint.get("background-color"),S=c.paint.get("background-opacity"),C=c.paint.get("background-emissive-strength"),k="viewport"===c.paint.get("background-pitch-alignment");if(0===S)return;const F=m.context,z=F.gl,N=m.transform,U=N.tileSize,q=c.paint.get("background-pattern");let W;if(void 0!==q&&(null===q||(W=m.imageManager.getPattern(q.toString(),c.scope,m.style.getLut(c.scope)),!W)))return;const ee=!q&&1===v.a&&1===S&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==ee)return;const K=Jt.disabled,re=m.depthModeForSublayer(0,"opaque"===ee?Vn.ReadWrite:Vn.ReadOnly),ie=m.colorModeForDrapableLayerRenderPass(C),ge=q?"backgroundPattern":"background";let xe,ve=g;if(ve||(xe=m.getBackgroundTiles(),ve=Object.values(xe).map(Ee=>Ee.tileID)),q&&(F.activeTexture.set(z.TEXTURE0),m.imageManager.bind(m.context,c.scope)),k){const Ee=m.getOrCreateProgram(ge,{overrideFog:!1,overrideRtt:!0}),Ae=new Float32Array(h.a6.mat4.identity([])),Ie=new h.aA(0,0,0,0,0),Re=q?Wa(Ae,C,S,m,0,c.scope,W,k,{tileID:Ie,tileSize:U}):yl(Ae,C,S,v.toRenderColor(c.lut));Ee.draw(m,z.TRIANGLES,re,K,ie,li.disabled,Re,c.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const Ee of ve){const Ae=m.isTileAffectedByFog(Ee),Ie=m.getOrCreateProgram(ge,{overrideFog:Ae}),Re=Ee.toUnwrapped(),Fe=g?Ee.projMatrix:m.transform.calculateProjMatrix(Re);m.prepareDrawTile();const He=s?s.getTile(Ee):xe?xe[Ee.key]:new Rl(Ee,U,N.zoom,m),ze=q?Wa(Fe,C,S,m,0,c.scope,W,k,{tileID:Ee,tileSize:U}):yl(Fe,C,S,v.toRenderColor(c.lut));m.uploadCommonUniforms(F,Ie,Re);const{tileBoundsBuffer:Ne,tileBoundsIndexBuffer:ut,tileBoundsSegments:wt}=m.getTileBoundsBuffers(He);Ie.draw(m,z.TRIANGLES,re,K,ie,li.disabled,ze,c.id,Ne,ut,wt)}},sky:function(m,s,c){const g=m._atmosphere?h.a9(m.transform.zoom):1,v=c.paint.get("sky-opacity")*g;if(0===v)return;const S=m.context,C=c.paint.get("sky-type"),k=new Vn(S.gl.LEQUAL,Vn.ReadOnly,[0,1]),F=m.frameCounter/1e3%1;"atmosphere"===C?"offscreen"===m.renderPass?c.needsSkyboxCapture(m)&&(function(z,N,U,q){const W=z.context,ee=W.gl;let K=N.skyboxFbo;if(!K){K=N.skyboxFbo=W.createFramebuffer(32,32,!0,null),N.skyboxGeometry=new Zf(W),N.skyboxTexture=W.gl.createTexture(),ee.bindTexture(ee.TEXTURE_CUBE_MAP,N.skyboxTexture),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MAG_FILTER,ee.LINEAR);for(let xe=0;xe<6;++xe)ee.texImage2D(ee.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,ee.RGBA,32,32,0,ee.RGBA,ee.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(K.framebuffer),W.viewport.set([0,0,32,32]);const re=N.getCenter(z,!0),ie=z.getOrCreateProgram("skyboxCapture"),ge=new Float64Array(16);h.a6.mat4.identity(ge),h.a6.mat4.rotateY(ge,ge,.5*-Math.PI),Na(z,N,ie,ge,re,0),h.a6.mat4.identity(ge),h.a6.mat4.rotateY(ge,ge,.5*Math.PI),Na(z,N,ie,ge,re,1),h.a6.mat4.identity(ge),h.a6.mat4.rotateX(ge,ge,.5*-Math.PI),Na(z,N,ie,ge,re,2),h.a6.mat4.identity(ge),h.a6.mat4.rotateX(ge,ge,.5*Math.PI),Na(z,N,ie,ge,re,3),h.a6.mat4.identity(ge),Na(z,N,ie,ge,re,4),h.a6.mat4.identity(ge),h.a6.mat4.rotateY(ge,ge,Math.PI),Na(z,N,ie,ge,re,5),W.viewport.set([0,0,z.width,z.height])}(m,c),c.markSkyboxValid(m)):"sky"===m.renderPass&&function(z,N,U,q,W){const ee=z.context,K=ee.gl,re=z.transform,ie=z.getOrCreateProgram("skybox");ee.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,N.skyboxTexture);const ge={u_matrix:re.skyboxMatrix,u_sun_direction:N.getCenter(z,!1),u_cubemap:0,u_opacity:q,u_temporal_offset:W};z.uploadCommonUniforms(ee,ie),ie.draw(z,K.TRIANGLES,U,Jt.disabled,z.colorModeForRenderPass(),li.backCW,ge,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(m,c,k,v,F):"gradient"===C&&"sky"===m.renderPass&&function(z,N,U,q,W){const ee=z.context,K=ee.gl,re=z.transform,ie=z.getOrCreateProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new Zf(ee)),ee.activeTexture.set(K.TEXTURE0);let ge=N.colorRampTexture;ge||(ge=N.colorRampTexture=new h.T(ee,N.colorRamp,K.RGBA8)),ge.bind(K.LINEAR,K.CLAMP_TO_EDGE);const xe=(ve=re.skyboxMatrix,Ee=N.getCenter(z,!1),Ae=N.paint.get("sky-gradient-radius"),Ie=q,Re=W,{u_matrix:ve,u_color_ramp:0,u_center_direction:Ee,u_radius:h.bC(Ae),u_opacity:Ie,u_temporal_offset:Re});var ve,Ee,Ae,Ie,Re;z.uploadCommonUniforms(ee,ie),ie.draw(z,K.TRIANGLES,U,Jt.disabled,z.colorModeForRenderPass(),li.backCW,xe,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(m,c,k,v,F)},debug:function(m,s,c,g,v,S){for(let C=0;C<c.length;C++)if(v){const z=new h.bA(.8*g.r,.8*g.g,.8*g.b,1);$r(m,s,c[C],g,-1,-1,S),$r(m,s,c[C],g,-1,1,S),$r(m,s,c[C],g,1,1,S),$r(m,s,c[C],g,1,-1,S),$r(m,s,c[C],z,0,0,S)}else $r(m,s,c[C],g,0,0,S)},custom:function(m,s,c,g){const v=m.context,S=c.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||"offscreen"===m.renderPass)&&c.isDraped(s)){if("offscreen"===m.renderPass){const C=S.prerender;if(C){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),"globe"===m.transform.projection.name){const k=m.transform.pointMerc;C.call(S,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),h.a9(m.transform.zoom),[k.x,k.y],m.transform.pixelsPerMeterRatio)}else C.call(S,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if("translucent"===m.renderPass){if(m.terrain&&m.terrain.renderingToTexture){const k=S.renderToTile;if(k){const F=g[0].canonical,z=new h.a5(F.x+g[0].wrap*(1<<F.z),F.y,F.z);v.setDepthMode(Vn.disabled),v.setStencilMode(Jt.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),k.call(S,v.gl,z),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(Jt.disabled);const C="3d"===S.renderingMode?new Vn(m.context.gl.LEQUAL,Vn.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Vn.ReadOnly);if(v.setDepthMode(C),"globe"===m.transform.projection.name){const k=m.transform.pointMerc;S.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),h.a9(m.transform.zoom),[k.x,k.y],m.transform.pixelsPerMeterRatio)}else S.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else h.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,s,c,g){if("opaque"===m.renderPass)return;const v=c.paint.get("model-opacity");if(0===v)return;const S=c.paint.get("model-cast-shadows");if("shadow"===m.renderPass&&(!S||m.terrain&&v<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof h.a4))return;const C=m.shadowRenderer,k=c.paint.get("model-receive-shadows");C&&(C.useNormalOffset=!0,k||(C.enabled=!1));const F=()=>{C&&(C.useNormalOffset=!0,k||(C.enabled=!0))},z=s.getSource();if("light-beam"===m.renderPass&&"batched-model"!==z.type)return;if("vector"===z.type||"geojson"===z.type)return function(ie,ge,xe,ve,Ee){const Ae=ie.transform;if("mercator"!==Ae.projection.name)return void h.w(`Drawing 3D models for ${Ae.projection.name} projection is not yet implemented`);const Ie=Ae.getFreeCameraOptions().position;if(!ie.modelManager)return;const Re=ie.modelManager;xe.modelManager=Re;const Fe=ie.shadowRenderer;if(!xe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const He=xe._unevaluatedLayout._values["model-id"],ze={...xe.layout.get("model-id").parameters},Ne=ie.style.order.indexOf(xe.fqid);for(const ut of ve){const wt=ge.getTile(ut).getBucket(xe);if(!wt||wt.projection.name!==Ae.projection.name)continue;const zt=wt.getModelUris();zt&&!wt.modelsRequested&&(Re.addModelsFromBucket(zt,Ee),wt.modelsRequested=!0);const Zt=Ta(ut,Ae);ze.zoom=Zt;const sn=He.possiblyEvaluate(ze);if(wb(ie,wt,ut),Ls.shadowUniformsInitialized=!1,Ls.useSingleShadowCascade=!!Fe&&0===Fe.getMaxCascadeForTile(ut.toUnwrapped()),"shadow"===ie.renderPass&&Fe){if(1===ie.currentShadowCascade&&wt.isInsideFirstShadowMapFrustum)continue;const bt=Ae.calculatePosMatrix(ut.toUnwrapped(),Ae.worldSize);if(Ls.tileMatrix.set(bt),Ls.shadowTileMatrix=Float32Array.from(Fe.calculateShadowPassMatrixFromMatrix(bt)),Ls.aabb.min.fill(0),Ls.aabb.max[0]=Ls.aabb.max[1]=h.ab,Ls.aabb.max[2]=0,Wr(wt,Ls,ie,xe.scope))continue}const Ke=1<<ut.canonical.z,Pt=[((Ie.x-ut.wrap)*Ke-ut.canonical.x)*h.ab,(Ie.y*Ke-ut.canonical.y)*h.ab,Ie.z*Ke*h.ab];ie.conflationActive&&Object.keys(wt.instancesPerModel).length>0&&ie.style.isLayerClipped(xe,ge.getSource())&&wt.updateReplacement(ut,ie.replacementSource,Ne,Ee)&&(wt.uploaded=!1,wt.upload(ie.context));for(let bt in wt.instancesPerModel){const Ot=wt.instancesPerModel[bt];Ot.features.length>0&&(bt=sn.evaluate(Ot.features[0].feature,{}));const Ut=Re.getModel(bt,Ee);if(Ut&&Ut.uploaded)for(const Lt of Ut.nodes)ah(ie,xe,Lt,Ot,Pt,ut,Ls)}}}(m,s,c,g,"vector"===z.type?c.scope:""),void F();if(!z.loaded())return;if("batched-model"===z.type)return function(ie,ge,xe,ve){xe.resetLayerRenderingStats(ie);const Ee=ie.context,Ae=ie.transform,Ie=ie.style.fog,Re=ie.shadowRenderer;if("mercator"!==Ae.projection.name)return void h.w(`Drawing 3D landmark models for ${Ae.projection.name} projection is not yet implemented`);const Fe=ie.transform.getFreeCameraOptions().position,He=h.a6.vec3.scale([],[Fe.x,Fe.y,Fe.z],ie.transform.worldSize),ze=h.a6.vec3.negate([],He),Ne=h.a6.mat4.identity([]),ut=h.de(Ae.center.lat,Ae.zoom),wt=h.a6.mat4.fromScaling([],[1,1,1/ut]);h.a6.mat4.translate(Ne,Ne,ze);const zt=xe.paint.get("model-opacity"),Zt=new Vn(Ee.gl.LEQUAL,Vn.ReadWrite,ie.depthRangeFor3D),sn=new Vn(Ee.gl.LEQUAL,Vn.ReadOnly,ie.depthRangeFor3D),Ke=new h.ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Pt="shadow"===ie.renderPass,bt=Pt&&Re?Re.getCurrentCascadeFrustum():Ae.getFrustum(Ae.scaleZoom(Ae.worldSize)),Ot=xe.paint.get("model-front-cutoff"),Ut=Ot[2]<1,Lt=_l(ie,xe.paint.get("model-cutoff-fade-range")),un=xe.getLayerRenderingStats();(function(Ln,zn,Sn,jn){const pn=Ln.terrain?Ln.terrain.exaggeration():0,Yn=Ln.transform.zoom;for(const Jn of jn){const Xi=zn.getTile(Jn).getBucket(Sn);Xi&&(Ln.conflationActive&&Xi.updateReplacement(Jn,Ln.replacementSource),Xi.evaluateScale(Ln,Sn),Ln.terrain&&pn>0&&Xi.elevationUpdate(Ln.terrain,pn,Jn,Sn.source),Xi.needsReEvaluation(Ln,Yn,Sn)&&Xi.evaluate(Sn))}})(ie,ge,xe,ve),function(){let Ln,zn,Sn;Ut?(Ln=ve.length-1,zn=-1,Sn=-1):(Ln=0,zn=ve.length,Sn=1);const jn=new Float64Array(16),pn=h.a6.vec3.create(),Yn=new h.P(0,0);for(let Jn=Ln;Jn!==zn;Jn+=Sn){const Xi=ve[Jn],Br=ge.getTile(Xi).getBucket(xe);if(!Br||!Br.uploaded)continue;let rr=!1;Re&&(rr=0===Re.getMaxCascadeForTile(Xi.toUnwrapped()));const Zr=Ae.calculatePosMatrix(Xi.toUnwrapped(),Ae.worldSize),ur=Br.modelTraits;!Pt&&Ut&&(h.a6.mat4.invert(jn,Zr),h.a6.vec3.transformMat4(pn,He,jn),Yn.x=pn[0],Yn.y=pn[1]);const zr=[];for(const Bi of Br.getNodesInfo()){if(Bi.hiddenByReplacement||!Bi.node.meshes)continue;const Or=Bi.node;let Er=0;ie.terrain&&Or.elevation&&(Er=Or.elevation*ie.terrain.exaggeration());const xr=(()=>{const Bo=Bi.aabb;return Ke.min=[...Bo.min],Ke.max=[...Bo.max],Ke.min[2]+=Er,Ke.max[2]+=Er,h.a6.vec3.transformMat4(Ke.min,Ke.min,Zr),h.a6.vec3.transformMat4(Ke.max,Ke.max,Zr),Ke})(),po=Bi.evaluatedScale;if(po[0]<=1&&po[1]<=1&&po[2]<=1&&0===xr.intersects(bt))continue;if(!Pt&&Ut){const Bo=.16666666666666666;Bi.cameraCollisionOpacity=He[0]>xr.min[0]&&He[0]<xr.max[0]&&He[1]>xr.min[1]&&He[1]<xr.max[1]&&He[2]*ut<xr.max[2]&&Or.footprint&&h.bv(Yn,Or.footprint)?Math.max(Bi.cameraCollisionOpacity-Bo,0):Math.min(1,Bi.cameraCollisionOpacity+Bo)}const Vr=[...Zr],Da=Or.anchor?Or.anchor[0]:0,Ka=Or.anchor?Or.anchor[1]:0;h.a6.mat4.translate(Vr,Vr,[Da*(po[0]-1),Ka*(po[1]-1),Er]),h.a6.vec3.exactEquals(po,h.dh)||h.a6.mat4.scale(Vr,Vr,po);const ss=h.a6.mat4.multiply([],Vr,Or.matrix),vi=h.a6.mat4.multiply([],Ae.expandedFarZProjMatrix,ss),zi=h.a6.mat4.multiply([],Ae.expandedFarZProjMatrix,Vr),fr=h.a6.vec4.transformMat4([],[Da,Ka,Er,1],vi)[2];Or.hidden=!1;let Yr=zt;Pt||(Ut&&(Yr*=Bi.cameraCollisionOpacity,Yr*=_p(Vr,Ae,Bi.aabb,Ot)),Yr*=er(Lt,fr)),0!==Yr?zr.push({nodeInfo:Bi,depth:fr,opacity:Yr,wvpForNode:vi,wvpForTile:zi,nodeModelMatrix:ss,tileModelMatrix:Vr}):Or.hidden=!0}Pt||zr.sort((Bi,Or)=>!Ut||1===Bi.opacity&&1===Or.opacity?Bi.depth<Or.depth?-1:1:1===Bi.opacity?-1:1===Or.opacity?1:Bi.depth>Or.depth?-1:1);for(const Bi of zr){const Or=Bi.nodeInfo,Er=Or.node;let xr=h.a6.mat4.multiply([],wt,Bi.tileModelMatrix);h.a6.mat4.multiply(xr,Ne,xr);const po=h.a6.mat4.invert([],xr);h.a6.mat4.transpose(po,po),h.a6.mat4.scale(po,po,dd),xr=h.a6.mat4.multiply(xr,xr,Er.matrix);const Vr="light-beam"===ie.renderPass,Da=ur&h.dj.HasMapboxMeshFeatures,Ka=Da?0:Or.evaluatedRMEA[0][2];for(let ss=0;ss<Er.meshes.length;++ss){const vi=Er.meshes[ss],zi=ss===Er.lightMeshIndex;let fr=Bi.wvpForNode;if(zi){if(!Vr&&!ie.terrain&&ie.shadowRenderer){ie.currentLayer<ie.firstLightBeamLayer&&(ie.firstLightBeamLayer=ie.currentLayer);continue}fr=Bi.wvpForTile}else if(Vr)continue;const Yr={defines:[]},Bo=[];if(!Pt&&Re&&(Re.useNormalOffset=!!vi.normalBuffer),ud(Yr.defines,Bo,vi,ie,xe.lut),Da||Yr.defines.push("DIFFUSE_SHADED"),rr&&Yr.defines.push("SHADOWS_SINGLE_CASCADE"),un&&(Pt?un.numRenderedVerticesInShadowPass+=vi.vertexArray.length:un.numRenderedVerticesInTransparentPass+=vi.vertexArray.length),Pt){gp(vi,Bi.nodeModelMatrix,ie,xe);continue}let io=null;if(Ie){const Vl=mp(Bi.nodeModelMatrix,ie.transform);if(io=new Float32Array(Vl),"globe"!==Ae.projection.name){const la=vi.aabb.min,jl=vi.aabb.max,[xl,wr]=Ie.getOpacityForBounds(Vl,la[0],la[1],jl[0],jl[1]);Yr.overrideFog=xl>=Yt||wr>=Yt}}const As=vi.material;let zl;As.occlusionTexture&&As.occlusionTexture.offsetScale&&(zl=As.occlusionTexture.offsetScale,Yr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Va=ie.getOrCreateProgram("model",Yr);!Pt&&Re&&Re.setupShadowsFromMatrix(Bi.tileModelMatrix,Va,Re.useNormalOffset),ie.uploadCommonUniforms(Ee,Va,null,io);const Ea=As.pbrMetallicRoughness;Ea.metallicFactor=.9,Ea.roughnessFactor=.5;const vl=dp(new Float32Array(fr),new Float32Array(xr),new Float32Array(po),new Float32Array(Er.matrix),ie,Bi.opacity,Ea.baseColorFactor.toRenderColor(null),As.emissiveFactor,Ea.metallicFactor,Ea.roughnessFactor,As,Ka,xe,[0,0,0],zl);!zi&&(Or.hasTranslucentParts||Bi.opacity<1)&&Va.draw(ie,Ee.gl.TRIANGLES,Zt,Jt.disabled,Si.disabled,li.backCCW,vl,xe.id,vi.vertexBuffer,vi.indexBuffer,vi.segments,xe.paint,ie.transform.zoom,void 0,Bo),Va.draw(ie,Ee.gl.TRIANGLES,zi?sn:Zt,Jt.disabled,zi||Bi.opacity<1||Or.hasTranslucentParts?Si.alphaBlended:Si.unblended,li.backCCW,vl,xe.id,vi.vertexBuffer,vi.indexBuffer,vi.segments,xe.paint,ie.transform.zoom,void 0,Bo)}}}}()}(m,s,c,g),void F();if("model"!==z.type)return;const N=z.getModels(),U=[],q=m.transform.getFreeCameraOptions().position,W=h.a6.vec3.scale([],[q.x,q.y,q.z],m.transform.worldSize);h.a6.vec3.negate(W,W);const ee=[],K=[];let re=0;for(const ie of N){const ge=c.paint.get("model-rotation").constantOr(null),xe=c.paint.get("model-scale").constantOr(null),ve=c.paint.get("model-translation").constantOr(null);ie.computeModelMatrix(m,ge,xe,ve,!0,!0,!1);const Ee=h.a6.mat4.identity([]),Ae=h.de(ie.position.lat,m.transform.zoom),Ie=h.a6.mat4.fromScaling([],[1,1,1/Ae]);h.a6.mat4.translate(Ee,Ee,W),U.push({zScaleMatrix:Ie,negCameraPosMatrix:Ee});for(const Re of ie.nodes)sh(m.transform,Re,ie.matrix,m.transform.expandedFarZProjMatrix,re,ee,K);re++}if(ee.sort((ie,ge)=>ge.depth-ie.depth),"shadow"!==m.renderPass){if(1===v)for(const ie of K)oh(ie,m,c,U[ie.modelIndex],Jt.disabled,m.colorModeForRenderPass());else{for(const ie of K)oh(ie,m,c,U[ie.modelIndex],Jt.disabled,Si.disabled);for(const ie of K)oh(ie,m,c,U[ie.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const ie of ee)oh(ie,m,c,U[ie.modelIndex],Jt.disabled,m.colorModeForRenderPass());F()}else{for(const ie of K)gp(ie.mesh,ie.nodeModelMatrix,m,c);for(const ie of ee)gp(ie.mesh,ie.nodeModelMatrix,m,c);F()}}},Fc={model:function(m,s,c){const g=s.getSource();if(!g.loaded())return;if("vector"===g.type||"geojson"===g.type)return void(c.modelManager&&c.modelManager.upload(c,"vector"===g.type?m.scope:""));if("batched-model"===g.type||"model"!==g.type)return;const v=g.getModels();for(const S of v)S.upload(c.context)},raster:function(m,s,c){const g=s.getSource();if(!(g instanceof Il&&g.loaded()))return;const v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;const S=m.paint.get("raster-array-band")||g.getInitialBand(v);if(null==S)return;const C=s.getIds().map(k=>s.getTileByID(k));for(const k of C)k.updateNeeded(v,S)&&g.prepareTile(k,v,S)},"raster-particle":function(m,s,c){const g=s.getSource();if(!(g instanceof Il&&g.loaded()))return;const v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;const S=m.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(null==S)return;const C=s.getIds().map(k=>s.getTileByID(k));for(const k of C)k.updateNeeded(v,S)&&g.prepareTile(k,v,S)}};class Fl{constructor(s,c,g,v,S){this.context=new jv(s,c),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=S,this._timeStamp=h.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const C=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const F of C)this._debugParams.enabledLayers[F]=!0;S.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),S.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),S.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),S.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),S.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),S.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const F of C)S.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],F);this.occlusionParams=new hd(S),this.setup(),this.numSublayers=Cr.maxUnderzooming+Cr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new h.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new du(this),this._wireframeDebugCache=new bp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const k=new h.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new h.T(this.context,k,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v}updateTerrain(s,c){const g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new oc(this,s));const v=this._terrain;this.transform.elevation=g?v:null,v.update(s,this.transform,c),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(s){const c=s.fog;if(!c||"globe"===this.transform.projection.name||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=c.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const S=g+.78*(v-g);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new oc(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,c){if(this.width=s*h.q.devicePixelRatio,this.height=c*h.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const s=this.context,c=new h.a$;c.emplaceBack(0,0),c.emplaceBack(h.ab,0),c.emplaceBack(0,h.ab),c.emplaceBack(h.ab,h.ab),this.tileExtentBuffer=s.createVertexBuffer(c,h.b1.members),this.tileExtentSegments=h.b2.simpleSegment(0,0,4,2);const g=new h.a$;g.emplaceBack(0,0),g.emplaceBack(h.ab,0),g.emplaceBack(0,h.ab),g.emplaceBack(h.ab,h.ab),this.debugBuffer=s.createVertexBuffer(g,h.b1.members),this.debugSegments=h.b2.simpleSegment(0,0,4,5);const v=new h.a$;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,h.b1.members),this.viewportSegments=h.b2.simpleSegment(0,0,4,2);const S=new h.aO;S.emplaceBack(0,0,0,0),S.emplaceBack(h.ab,0,h.ab,0),S.emplaceBack(0,h.ab,0,h.ab),S.emplaceBack(h.ab,h.ab,h.ab,h.ab),this.mercatorBoundsBuffer=s.createVertexBuffer(S,h.b4.members),this.mercatorBoundsSegments=h.b2.simpleSegment(0,0,4,2);const C=new h.aP;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(C);const k=new h.b0;for(const z of[0,1,3,2,0])k.emplaceBack(z);this.debugIndexBuffer=s.createIndexBuffer(k),this.emptyTexture=new h.T(s,new h.r({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=h.a6.mat4.create();const F=this.context.gl;this.stencilClearMode=new Jt({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,Vn.disabled,this.stencilClearMode,Si.disabled,li.disabled,rc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,c,g){if(!c||this.currentStencilSource===c.id||!s.isTileClipped()||!g||0===g.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const F of g)if(void 0===this._tileClippingMaskIDs[F.key]){k=!0;break}if(!k)return}this.currentStencilSource=c.id;const v=this.context,S=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(Si.disabled),v.setDepthMode(Vn.disabled);const C=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of g){const F=c.getTile(k),z=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:U,tileBoundsSegments:q}=this.getTileBoundsBuffers(F);C.draw(this,S.TRIANGLES,Vn.disabled,new Jt({func:S.ALWAYS,mask:0},z,255,S.KEEP,S.KEEP,S.REPLACE),Si.disabled,li.disabled,rc(k.projMatrix),"$clipping",N,U,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new Jt({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const c=this.context.gl;return new Jt({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,g=s.sort((C,k)=>k.overscaledZ-C.overscaledZ),v=g[g.length-1].overscaledZ,S=g[0].overscaledZ-v+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const C={};for(let k=0;k<S;k++)C[k+v]=new Jt({func:c.GEQUAL,mask:255},k+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=S,[C,g]}return[{[v]:Jt.disabled},g]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Si([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new h.bA(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Si.unblended:Si.alphaBlended}colorModeForDrapableLayerRenderPass(s){const c=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Si([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new h.bA(0,0,0,void 0===s?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,c,g,v=!1){if(this.depthOcclusion)return new Vn(this.context.gl.GREATER,Vn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return Vn.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Vn(g||this.context.gl.LEQUAL,c,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,c=Math.ceil(this.width),g=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),S=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==c&&0!==g&&(this.depthFBO=new Gf(this.context,c,g,!1,"texture"),this.depthTexture=new h.T(this.context,{width:c,height:g,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),s.bindTexture(s.TEXTURE_2D,S),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,c,g,0,0,c,g,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,c)=>s+c/this._fpsHistory.length,0))}render(s,c){const g=h.q.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=c;const v=this.style._mergedLayers,S=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(ze=>{const Ne=v[ze];return!(Ne.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ne.type]});let C=!1,k=!1;for(const ze of S){const Ne=v[ze];"circle"===Ne.type&&(C=!0),"symbol"===Ne.type&&(Ne.hasInitialOcclusionOpacityProperties?k=!0:C=!0)}const F=S.map(ze=>v[ze]),z=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(h.q.now()),this.imageManager.beginFrame();let N=0,U=!1;for(const ze in z){const Ne=z[ze];Ne.used&&(Ne.prepare(this.context),Ne.getSource().usedInConflation&&++N)}let q=!1;for(const ze of F)ze.isHidden(this.transform.zoom)||("clip"===ze.type&&(q=!0),this.prepareLayer(ze));const W={},ee={},K={},re={},ie={};for(const ze in z){const Ne=z[ze];W[ze]=Ne.getVisibleCoordinates(),ee[ze]=W[ze].slice().reverse(),K[ze]=Ne.getVisibleCoordinates(!0).reverse(),re[ze]=Ne.getShadowCasterCoordinates(),ie[ze]=Ne.sortCoordinatesByDistance(W[ze])}const ge=ze=>{const Ne=this.style.getLayerSourceCache(ze);return Ne&&Ne.used?Ne.getSource():null};if(N||q||this._clippingActiveLastFrame){const ze=[],Ne=[];let ut=0;for(const wt of F)this.isSourceForClippingOrConflation(wt,ge(wt))&&(ze.push(wt),Ne.push(ut)),ut++;if(ze&&(q||ze.length>1)||this._clippingActiveLastFrame){q=!1;const wt=[];for(let zt=0;zt<ze.length;zt++){const Zt=ze[zt],sn=Ne[zt],Ke=this.style.getLayerSourceCache(Zt);if(!Ke||!Ke.used||!Ke.getSource().usedInConflation&&"clip"!==Zt.type)continue;let Pt=h.dn,bt=h.bt.None;const Ot=[];let Ut=!0;if("clip"===Zt.type){Pt=sn;for(const Lt of Zt.layout.get("clip-layer-types"))bt|="model"===Lt?h.bt.Model:"symbol"===Lt?h.bt.Symbol:h.bt.FillExtrusion;for(const Lt of Zt.layout.get("clip-layer-scope"))Ot.push(Lt);Zt.isHidden(this.transform.zoom)?Ut=!1:q=!0}Ut&&wt.push({layer:Zt.fqid,cache:Ke,order:Pt,clipMask:bt,clipScope:Ot})}this.replacementSource.setSources(wt),U=!0}}this._clippingActiveLastFrame=q,U||this.replacementSource.clear(),this.conflationActive=U,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ze=0;ze<F.length;ze++){const Ne=F[ze],ut=Ne.cutoffRange();if(this.longestCutoffRange=Math.max(ut,this.longestCutoffRange),ut>0){const wt=ge(Ne);wt&&(this.minCutoffZoom=Math.max(wt.minzoom,this.minCutoffZoom)),Ne.minzoom&&(this.minCutoffZoom=Math.max(Ne.minzoom,this.minCutoffZoom))}Ne.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ze),this._lastOcclusionLayer=ze)}const xe=this.style&&this.style.fog;xe?(this._fogVisible=0!==xe.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=xe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(K),this.opaquePassCutoff=0);const ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const ze in z)for(const Ne of W[ze]){let ut={min:0,max:0};this.terrain&&(ut=this.terrain.getMinMaxForTile(Ne)||ut),ve.addShadowReceiver(Ne.toUnwrapped(),ut.min,ut.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new h.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new _u(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Ce.has(this.context.gl))return;this.renderPass="offscreen";for(const ze of F){const Ne=s.getLayerSourceCache(ze);if(!ze.hasOffscreenPass()||ze.isHidden(this.transform.zoom))continue;const ut=Ne?ee[Ne.id]:void 0;("custom"===ze.type||"raster"===ze.type||"raster-particle"===ze.type||ze.isSky()||ut&&ut.length)&&this.renderLayer(this,Ne,ze,ut)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,re)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ee="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),Ae=(()=>{if(c.showOverdrawInspector)return h.bA.black;const ze=this.style.fog;if(ze&&this.transform.projection.supportsFog){const Ne=this.style.getLut(ze.scope);if(!Ee){const ut=ze.properties.get("color").toRenderColor(Ne).toArray01();return new h.bA(...ut)}if(Ee){const ut=ze.properties.get("space-color").toRenderColor(Ne).toArray01();return new h.bA(...ut)}}return h.bA.transparent})();if(this.context.clear({color:Ae,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ee&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const ze=F[this.currentLayer],Ne=s.getLayerSourceCache(ze);if(ze.isSky())continue;const ut=Ne?(ze.is3D()?ie:ee)[Ne.id]:void 0;this._renderTileClippingMasks(ze,Ne,ut),this.renderLayer(this,Ne,ze,ut)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ee&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||h.a9(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const ze=F[this.currentLayer],Ne=s.getLayerSourceCache(ze);ze.isSky()&&this.renderLayer(this,Ne,ze,Ne?ee[Ne.id]:void 0)}function Ie(ze,Ne){let ut;return Ne&&(ut=("symbol"===ze.type?K:ze.is3D()?ie:ee)[Ne.id]),ut}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){const ze=F[this.currentLayer];if("raster"===ze.type||"raster-particle"===ze.type){const Ne=s.getLayerSourceCache(ze);this.renderLayer(this,Ne,ze,Ie(ze,Ne))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Re=0;ve&&(Re=ve.getShadowCastingLayerCount());let Fe=!1,He=-1;for(let ze=0;ze<S.length;++ze){const Ne=F[ze];Ne.isHidden(this.transform.zoom)||Ne.is3D()&&(He=ze)}for(k&&-1===He&&(C=!0);this.currentLayer<S.length;){const ze=F[this.currentLayer],Ne=s.getLayerSourceCache(ze);if(ze.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ze)){if(ze.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(C&&!Fe&&this.terrain&&!this.transform.isOrthographic&&(Fe=!0,this.blitDepth()),k&&-1!==He&&this.currentLayer===He+1&&!this.transform.isOrthographic&&this.blitDepth(),ze.is3D()||this.terrain||this._renderTileClippingMasks(ze,Ne,Ne?W[Ne.id]:void 0),this.renderLayer(this,Ne,ze,Ie(ze,Ne)),!this.terrain&&ve&&Re>0&&ze.hasShadowPass()&&0==--Re&&(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ut=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ut;this.currentLayer++){const wt=F[this.currentLayer];if(!wt.hasLightBeamPass())continue;const zt=s.getLayerSourceCache(wt);this.renderLayer(this,zt,wt,zt?ee[zt.id]:void 0)}this.currentLayer=ut,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ut=this.currentLayer;this.depthOcclusion=!0;for(const wt of this.layersWithOcclusionOpacity){this.currentLayer=wt;const zt=F[this.currentLayer],Zt=s.getLayerSourceCache(zt),sn=Zt?ee[Zt.id]:void 0;zt.is3D()||this.terrain||this._renderTileClippingMasks(zt,Zt,Zt?W[Zt.id]:void 0),this.renderLayer(this,Zt,zt,sn)}this.depthOcclusion=!1,this.currentLayer=ut,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ze=null;F.forEach(Ne=>{const ut=s.getLayerSourceCache(Ne);ut&&!Ne.isHidden(this.transform.zoom)&&ut.getVisibleCoordinates().length&&(!ze||ze.getSource().maxzoom<ut.getSource().maxzoom)&&(ze=ut)}),ze&&this.options.showTileBoundaries&&lh.debug(this,ze,ze.getVisibleCoordinates(),h.bA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&lh.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new h.bA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ze){const Ne=ze.transform.padding;ot(ze,ze.transform.height-(Ne.top||0),3,Za),ot(ze,Ne.bottom||0,3,lc),Sg(ze,Ne.left||0,3,Qt),Sg(ze,ze.transform.width-(Ne.right||0),3,Bn);const ut=ze.transform.centerPoint;var wt,zt,Zt,sn;rh(wt=ze,(zt=ut.x)-1,(Zt=ze.transform.height-ut.y)-10,2,20,sn=cc),rh(wt,zt-10,Zt-1,20,2,sn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),U||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:c}=this.transform.projection,g=!c||!c.includes(s.type);if(Fc[s.type]&&(g||this.terrain&&"custom"===s.type)){const v=this.style.getLayerSourceCache(s);Fc[s.type](s,v,this)}this.gpuTimingEnd()}renderLayer(s,c,g,v){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||"model"===g.type||"raster"===g.type||"raster-particle"===g.type||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(g.type)&&(!s.terrain||"custom"!==g.type)||"clip"===g.type||lh[g.type](s,c,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,g=this.context.gl;let v=this.gpuTimers[s.id];v||(v=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(c.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,c=this.context.gl,g=c.createQuery();this.deferredRenderGpuTimeQueries.push(g),c.beginQuery(s.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const c={};for(const g in s){const v=s[g],S=this.context.extTimerQuery,C=S.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;S.deleteQueryEXT(v.query),c[g]=C}return c}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let g=0;for(const v of s)g+=c.getQueryParameter(v,c.QUERY_RESULT)/1e6,c.deleteQuery(v);return g}translatePosMatrix(s,c,g,v,S){if(!g[0]&&!g[1])return s;const C=S?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(C){const z=Math.sin(C),N=Math.cos(C);g=[g[0]*N-g[1]*z,g[0]*z+g[1]*N]}const k=[S?g[0]:h.ak(c,g[0],this.transform.zoom),S?g[1]:h.ak(c,g[1],this.transform.zoom),0],F=new Float32Array(16);return h.a6.mat4.translate(F,s,k),F}saveTileTexture(s){const c=s.size[0],g=this._tileTextures[c];g?g.push(s):this._tileTextures[c]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(s,c,g){const v=void 0===g?this.terrain&&this.terrain.renderingToTexture:g,S=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===s||"terrainRaster"===s?(S.push("LIGHTING_3D_MODE"),S.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||S.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||S.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(S.push("TERRAIN"),this.linearFloatFilteringSupported()&&S.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&S.push("GLOBE"),!this._fogVisible||v||void 0!==c&&!c||S.push("FOG","FOG_DITHERING"),v&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}getOrCreateProgram(s,c){this.cache=this.cache||{};const g=c&&c.defines||[],v=c&&c.config,S=this.currentGlobalDefines(s,c&&c.overrideFog,c&&c.overrideRtt).concat(g),C=sc.cacheKey(zs[s],s,S,v);return this.cache[C]||(this.cache[C]=new sc(this.context,s,zs[s],v,rd[s],S)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,c){if(this.style.enable3dLights()){const g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){const S=((C,k,F)=>{const z=C.properties.get("direction"),N=C.properties.get("color").toRenderColor(F.getLut(C.scope)).toArray01(),U=C.properties.get("intensity"),q=k.properties.get("color").toRenderColor(F.getLut(k.scope)).toArray01(),W=k.properties.get("intensity"),ee=[z.x,z.y,z.z],K=h.cH(q,W),re=h.cH(N,U);return{u_lighting_ambient_color:K,u_lighting_directional_dir:ee,u_lighting_directional_color:re,u_ground_radiance:jf(ee,re,K)}})(g,v,this.style);c.setLightsUniformValues(s,S)}}}uploadCommonUniforms(s,c,g,v,S){if(this.uploadCommonLightUniforms(s,c),this.terrain&&this.terrain.renderingToTexture)return;const C=this.style.fog;if(C){const k=C.getOpacity(this.transform.pitch),F=((z,N,U,q,W,ee,K,re,ie,ge,xe,ve)=>{const Ee=z.transform,Ae=N.properties.get("color").toRenderColor(z.style.getLut(N.scope)).toArray01();Ae[3]=q;const Ie=z.frameCounter/1e3%1,[Re,Fe]=N.properties.get("vertical-range");return{u_fog_matrix:U?Ee.calculateFogTileMatrix(U):ve||z.identityMat,u_fog_range:N.getFovAdjustedRange(Ee._fov),u_fog_color:Ae,u_fog_horizon_blend:N.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Re,Fe),Fe],u_fog_temporal_offset:Ie,u_frustum_tl:W,u_frustum_tr:ee,u_frustum_br:K,u_frustum_bl:re,u_globe_pos:ie,u_globe_radius:ge,u_viewport:xe,u_globe_transition:h.a9(Ee.zoom),u_is_globe:+("globe"===Ee.projection.name)}})(this,C,g,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*h.q.devicePixelRatio,this.transform.height*h.q.devicePixelRatio],v);c.setFogUniformValues(s,F)}S&&c.setCutoffUniformValues(s,S.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,c=s.createTexture();return s.bindTexture(s.TEXTURE_2D,c),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&0!==s.getOpacity(this.transform.pitch)}getBackgroundTiles(){const s=this._backgroundTiles,c=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)c[v.key]=s[v.key]||new Rl(v,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,c){return!(!s.is3D()||"clip"!==s.type&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==s.sourceLayer)&&(!c||"batched-model"!==c.type)))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let c=this._cachedTileFogOpacities[s.key];return c||(this._cachedTileFogOpacities[s.key]=c=this.style.fog.getOpacityForTile(s)),c[0]>=Yt||c[1]>=Yt}setupDepthForOcclusion(s,c,g){const v=this.context,S=v.gl,C=!!g;var k;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(S.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((k=this.depthRangeFor3D)[1]-k[0]),-1-2*k[0]/(k[1]-k[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),v.activeTexture.set(S.TEXTURE0),C||c.setTerrainUniformValues(v,g)}}function Ya(m,s){let c=!1,g=null;const v=()=>{g=null,c&&(m(),g=setTimeout(v,s),c=!1)};return()=>(c=!0,g||v(),g)}class Kf{constructor(s){this._hashName=s&&encodeURIComponent(s),h.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ya(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const c=ch(s);if(this._hashName){const g=this._hashName;let v=!1;const S=location.hash.slice(1).split("&").map(C=>{const k=C.split("=")[0];return k===g?(v=!0,`${k}=${c}`):C}).filter(C=>C);return v||S.push(`${g}=${c}`),`#${S.join("&")}`}return`#${c}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(c=g)}),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(g=>isNaN(g))){const g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(c[3]||0):s.getBearing();return s.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:g,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ch(m,s){const c=m.getCenter(),g=Math.round(100*m.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,v),C=Math.round(c.lng*S)/S,k=Math.round(c.lat*S)/S,F=m.getBearing(),z=m.getPitch();let N=s?`/${C}/${k}/${g}`:`${g}/${k}/${C}`;return(F||z)&&(N+="/"+Math.round(10*F)/10),z&&(N+=`/${Math.round(z)}`),N}const pd={linearity:.3,easing:h.dp(0,0,.3,1)},yu=h.l({deceleration:2500,maxSpeed:1400},pd),Tg=h.l({deceleration:20,maxSpeed:1400},pd),gr=h.l({deceleration:1e3,maxSpeed:360},pd),yp=h.l({deceleration:1e3,maxSpeed:90},pd);class Qf{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.q.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=h.q.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)c.zoom+=S.zoomDelta||0,c.bearing+=S.bearingDelta||0,c.pitch+=S.pitchDelta||0,S.panDelta&&c.pan._add(S.panDelta),S.around&&(c.around=S.around),S.pinchAround&&(c.pinchAround=S.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){const S=hs(c.pan.mag(),g,h.l({},yu,s||{}));v.offset=c.pan.mult(S.amount/c.pan.mag()),v.center=this._map.transform.center,fd(v,S)}if(c.zoom){const S=hs(c.zoom,g,Tg);v.zoom=this._map.transform.zoom+S.amount,fd(v,S)}if(c.bearing){const S=hs(c.bearing,g,gr);v.bearing=this._map.transform.bearing+h.ap(S.amount,-179,179),fd(v,S)}if(c.pitch){const S=hs(c.pitch,g,yp);v.pitch=this._map.transform.pitch+S.amount,fd(v,S)}if(v.zoom||v.bearing){const S=void 0===c.pinchAround?c.around:c.pinchAround;v.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function fd(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function hs(m,s,c){const{maxSpeed:g,linearity:v,deceleration:S}=c,C=h.ap(m*v/(s/1e3),-g,g),k=Math.abs(C)/(S*v);return{easing:c.easing,duration:1e3*k,amount:C*(k/2)}}class Xr extends h.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,g,v={}){const S=We(c.getCanvasContainer(),g),C=c.unproject(S);super(s,h.l({point:S,lngLat:C,originalEvent:g},v)),this._defaultPrevented=!1,this.target=c}}class Nl extends h.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,g){const v="touchend"===s?g.changedTouches:g.touches,S=Ft(c.getCanvasContainer(),v),C=S.map(F=>c.unproject(F)),k=S.reduce((F,z,N,U)=>F.add(z.div(U.length)),new h.P(0,0));super(s,{points:S,point:k,lngLats:C,lngLat:c.unproject(k),originalEvent:g}),this._defaultPrevented=!1}}class vu extends h.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class md{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new vu(this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new Xr(s.type,this._map,s))}mouseup(s){this._map.fire(new Xr(s.type,this._map,s))}preclick(s){const c=h.l({},s);c.type="preclick",this._map.fire(new Xr(c.type,this._map,c))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Xr(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Xr(s.type,this._map,s))}mouseover(s){this._map.fire(new Xr(s.type,this._map,s))}mouseout(s){this._map.fire(new Xr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Nl(s.type,this._map,s))}touchmove(s){this._map.fire(new Nl(s.type,this._map,s))}touchend(s){this._map.fire(new Nl(s.type,this._map,s))}touchcancel(s){this._map.fire(new Nl(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nc{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Xr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Xr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xu{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&0===s.button&&(Rn(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const g=c,v=this._startPos,S=this._lastPos;if(!v||!S||S.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=rt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const C=Math.min(v.x,g.x),k=Math.max(v.x,g.x),F=Math.min(v.y,g.y),z=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${F}px)`,this._box.style.width=k-C+"px",this._box.style.height=z-F+"px")})}mouseupWindow(s,c){if(!this._active)return;const g=this._startPos,v=c;if(g&&0===s.button){if(this.reset(),ke(),g.x!==v.x||g.y!==v.y)return this._map.fire(new h.x("boxzoomend",{originalEvent:s})),{cameraAnimation:S=>S.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Vt(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new h.x(s,{originalEvent:c}))}}function Cg(m,s){const c={};for(let g=0;g<m.length;g++)c[m[g].identifier]=s[g];return c}class Sb{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,c,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const S=new h.P(0,0);for(const C of v)S._add(C);return S.div(v.length)}(c),this.touches=Cg(g,c)))}touchmove(s,c,g){if(this.aborted||!this.centroid)return;const v=Cg(g,c);for(const S in this.touches){const C=v[S];(!C||C.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(s,c,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class en{constructor(s){this.singleTap=new Sb(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,c,g){this.singleTap.touchstart(s,c,g)}touchmove(s,c,g){this.singleTap.touchmove(s,c,g)}touchend(s,c,g){const v=this.singleTap.touchend(s,c,g);if(v){const S=s.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(v)<30;if(S&&C||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Tb{constructor(){this._zoomIn=new en({numTouches:1,numTaps:2}),this._zoomOut=new en({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,g){this._zoomIn.touchstart(s,c,g),this._zoomOut.touchstart(s,c,g)}touchmove(s,c,g){this._zoomIn.touchmove(s,c,g),this._zoomOut.touchmove(s,c,g)}touchend(s,c,g){const v=this._zoomIn.touchend(s,c,g),S=this._zoomOut.touchend(s,c,g);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(v)},{originalEvent:s})}):S?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(S)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const em={0:1,2:2};class tm{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const g=Te(s);this._correctButton(s,g)&&(this._lastPoint=c,this._eventButton=g)}mousemoveWindow(s,c){const g=this._lastPoint;if(g)if(s.preventDefault(),null!=this._eventButton&&function(v,S){const C=em[S];return void 0===v.buttons||(v.buttons&C)!==C}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(g,c)}mouseupWindow(s){this._lastPoint&&Te(s)===this._eventButton&&(this._moved&&ke(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dg extends tm{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return 0===c&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class Eg extends tm{_correctButton(s,c){return 0===c&&s.ctrlKey||2===c}_move(s,c){const g=.8*(c.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){s.preventDefault()}}class Ig extends tm{_correctButton(s,c){return 0===c&&s.ctrlKey||2===c}_move(s,c){const g=-.5*(c.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){s.preventDefault()}}class Hv{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),h.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}touchstart(s,c,g){return this._calculateTransform(s,c,g)}touchmove(s,c,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length&&!h.dq())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,c,g)}}touchend(s,c,g){this._calculateTransform(s,c,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,g){g.length>0&&(this._active=!0);const v=Cg(g,c),S=new h.P(0,0),C=new h.P(0,0);let k=0;for(const z in v){const N=v[z],U=this._touches[z];U&&(S._add(N),C._add(N.sub(U)),k++,v[z]=N)}if(this._touches=v,k<this._minTouches||!C.mag())return;const F=C.div(k);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(k),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=rt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class wu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,c,g){return{}}touchstart(s,c,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,g){const v=this._firstTwoTouches;if(!v)return;s.preventDefault();const[S,C]=v,k=nm(g,c,S),F=nm(g,c,C);if(!k||!F)return;const z=this._aroundCenter?null:k.add(F).div(2);return this._move([k,F],z,s)}touchend(s,c,g){if(!this._firstTwoTouches)return;const[v,S]=this._firstTwoTouches,C=nm(g,c,v),k=nm(g,c,S);C&&k||(this._active&&ke(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function nm(m,s,c){for(let g=0;g<m.length;g++)if(m[g].identifier===c)return s[g]}function Cb(m,s){return Math.log(m/s)/Math.LN2}class Ms extends wu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Cb(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cb(this._distance,g),pinchAround:c}}}function vp(m,s){return 180*m.angleWith(s)/Math.PI}class uh extends wu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:vp(this._vector,g),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const v=vp(s,g);return Math.abs(v)<c}}function Mg(m){return Math.abs(m.y)>Math.abs(m.x)}class Db extends wu{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Mg(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,g){const v=this._lastPoints;if(!v)return;const S=s[0].sub(v[0]),C=s[1].sub(v[1]);return this._map._cooperativeGestures&&!h.dq()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(S,C,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(S.y+C.y)/2*-.5})}gestureBeginsVertically(s,c,g){if(void 0!==this._valid)return this._valid;const v=s.mag()>=2,S=c.mag()>=2;if(!v&&!S)return;if(!v||!S)return null==this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const C=s.y>0==c.y>0;return Mg(s)&&Mg(c)&&C}}const Ba={panStep:100,bearingStep:15,pitchStep:10};class dc{constructor(){const s=Ba;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,g=0,v=0,S=0,C=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),S=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),S=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),C=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:k=>{const F=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Ag,zoom:c?Math.round(F)+c*(s.shiftKey?2:1):F,bearing:k.getBearing()+g*this._bearingStep,pitch:k.getPitch()+v*this._pitchStep,offset:[-S*this._panStep,-C*this._panStep],center:k.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ag(m){return m*(2-m)}const dh=4.000244140625;class Eb{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||h.dq()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const g=h.q.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==c&&c%dh==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=We(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;"wheel"===this._type&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(0!==this._delta){const z="wheel"===this._type&&Math.abs(this._delta)>dh?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&0!==N&&(N=1/N);const U=c(),q=Math.pow(2,U),W="number"==typeof this._targetZoom?s.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(W*N))),"wheel"===this._type&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:c(),v=this._startZoom,S=this._easing;let C,k=!1;if("wheel"===this._type&&v&&S){const z=Math.min((h.q.now()-this._lastWheelEventTime)/200,1),N=S(z);C=h.aa(v,g,N),z<1?this._frameId||(this._frameId=!0):k=!0}else C=g,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let F=C-c();return F*this._lastDelta<0&&(F=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:F,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=h.dr;if(this._prevEase){const g=this._prevEase,v=(h.q.now()-g.start)/g.duration,S=g.easing(v+.01)-g.easing(v),C=.27/Math.sqrt(S*S+1e-4)*.01,k=Math.sqrt(.0729-C*C);c=h.dp(C,k,.25,1)}return this._prevEase={start:h.q.now(),duration:s,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=rt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class No{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ib{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,c){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Q1{constructor(){this._tap=new en({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,c,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=c[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,c,g))}touchmove(s,c,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=c[0],S=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(s,c,g)}touchend(s,c,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(s,c,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ew{constructor(s,c,g){this._el=s,this._mousePan=c,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class hh{constructor(s,c,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class za{constructor(s,c,g,v){this._el=s,this._touchZoom=c,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Su=m=>m.zoom||m.drag||m.pitch||m.rotate;class Bc extends h.x{}class Tu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,c){const g=h.a6.vec3.sub([],c,s);this.radius=h.a6.vec3.length(g[2]<0?h.a6.vec3.div([],g,this.constants):[g[0],g[1],0])}projectRay(s){h.a6.vec3.div(s,s,this.constants),h.a6.vec3.normalize(s,s),h.a6.vec3.mul(s,s,this.constants);const c=h.a6.vec3.scale([],s,this.radius);if(c[2]>0){const g=h.a6.vec3.scale([],[0,0,1],h.a6.vec3.dot(c,[0,0,1])),v=h.a6.vec3.scale([],h.a6.vec3.normalize([],[c[0],c[1],0]),this.radius),S=h.a6.vec3.add([],c,h.a6.vec3.scale([],h.a6.vec3.sub([],h.a6.vec3.add([],v,g),c),2));c[0]=S[0],c[1]=S[1]}return c}}function Cu(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class xs{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qf(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Tu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),h.aJ(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,S,C]of this._listeners){const k=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(S,k,C)}}destroy(){for(const[s,c,g]of this._listeners){const v=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(c,v,g)}}_addDefaultHandlers(s){const c=this._map,g=c.getCanvasContainer();this._add("mapEvent",new md(c,s));const v=c.boxZoom=new xu(c,s);this._add("boxZoom",v);const S=new Tb,C=new Ib;c.doubleClickZoom=new No(C,S),this._add("tapZoom",S),this._add("clickZoom",C);const k=new Q1;this._add("tapDragZoom",k);const F=c.touchPitch=new Db(c);this._add("touchPitch",F);const z=new Eg(s),N=new Ig(s);c.dragRotate=new hh(s,z,N),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const U=new Dg(s),q=new Hv(c,s);c.dragPan=new ew(g,U,q),this._add("mousePan",U),this._add("touchPan",q,["touchZoom","touchRotate"]);const W=new uh,ee=new Ms;c.touchZoomRotate=new za(g,ee,W,k),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Nc(c));const K=c.scrollZoom=new Eb(c,this);this._add("scrollZoom",K,["mousePan"]);const re=c.keyboard=new dc;this._add("keyboard",re);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[ie]&&c[ie].enable(s[ie])}_add(s,c,g){this._handlers.push({handlerName:s,handler:c,allowed:g}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Su(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,c,g){for(const v in s)if(v!==g&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const g of s)this._el.contains(g.target)&&c.push(g);return c}handleEvent(s,c){this._updatingCamera=!0;const g="renderFrame"===s.type,v=g?void 0:s,S={needsRenderFrame:!1},C={},k={},F=s.touches?this._getMapTouches(s.touches):void 0,z=F?Ft(this._el,F):g?void 0:We(this._el,s);for(const{handlerName:q,handler:W,allowed:ee}of this._handlers){if(!W.isEnabled())continue;let K;this._blockedByActive(k,ee,q)?W.reset():W[c||s.type]&&(K=W[c||s.type](s,z,F),this.mergeHandlerResult(S,C,K,q,v),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||W.isActive())&&(k[q]=W)}const N={};for(const q in this._previousActiveHandlers)k[q]||(N[q]=v);this._previousActiveHandlers=k,(Object.keys(N).length||Cu(S))&&(this._changes.push([S,C,N]),this._triggerRenderFrame()),(Object.keys(k).length||Cu(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=S;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(s,c,g,v,S){if(!g)return;h.l(s,g);const C={handlerName:v,originalEvent:g.originalEvent||S};void 0!==g.zoomDelta&&(c.zoom=C),void 0!==g.panDelta&&(c.drag=C),void 0!==g.pitchDelta&&(c.pitch=C),void 0!==g.bearingDelta&&(c.rotate=C)}_applyChanges(){const s={},c={},g={};for(const[v,S,C]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new h.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(s.around=v.around),void 0!==v.aroundCoord&&(s.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),h.l(c,S),h.l(g,C);this._updateMapTransform(s,c,g),this._changes=[]}_updateMapTransform(s,c,g){const v=this._map,S=v.transform,C=ge=>[ge.x,ge.y,ge.z];if((ge=>{const xe=this._eventsInProgress.drag;return xe&&!this._handlersById[xe.handlerName].isActive()})()&&!Cu(s)){const ge=S.zoom;S.cameraElevationReference="sea",null!=this._originalZoom&&S._orthographicProjectionAtLowPitch&&"globe"!==S.projection.name&&0===S.pitch?(S.cameraElevationReference="ground",S.zoom=this._originalZoom):(S.recenterOnTerrain(),S.cameraElevationReference="ground"),ge!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&v._stop(!0),!Cu(s))return void this._fireEvents(c,g,!0);let{panDelta:k,zoomDelta:F,bearingDelta:z,pitchDelta:N,around:U,aroundCoord:q,pinchAround:W}=s;S._isCameraConstrained&&(F>0&&(F=0),S._isCameraConstrained=!1),void 0!==W&&(U=W),(F||(ge=>c.drag&&!this._eventsInProgress.drag)())&&U&&(this._dragOrigin=C(S.pointCoordinate3D(U)),this._originalZoom=S.zoom,this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",v._stop(!0),U=U||v.transform.centerPoint,z&&(S.bearing+=z),N&&(S.pitch+=N),S._updateCameraState();const ee=[0,0,0];if(k)if("mercator"===S.projection.name){const ge=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(U).dir),xe=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(U.sub(k)).dir);ee[0]=xe[0]-ge[0],ee[1]=xe[1]-ge[1]}else{const ge=S.pointCoordinate(U);if("globe"===S.projection.name){k=k.rotate(-S.angle);const xe=S._pixelsPerMercatorPixel/S.worldSize;ee[0]=-k.x*h.ds(h.aN(ge.y))*xe,ee[1]=-k.y*h.ds(S.center.lat)*xe}else{const xe=S.pointCoordinate(U.sub(k));ge&&xe&&(ee[0]=xe.x-ge.x,ee[1]=xe.y-ge.y)}}const K=S.zoom,re=[0,0,0];if(F){const ge=C(q||S.pointCoordinate3D(U)),xe={dir:h.a6.vec3.normalize([],h.a6.vec3.sub([],ge,S._camera.position))};if(xe.dir[2]<0){const ve=S.zoomDeltaToMovement(ge,F);h.a6.vec3.scale(re,xe.dir,ve)}}const ie=h.a6.vec3.add(ee,ee,re);S._translateCameraConstrained(ie),F&&Math.abs(S.zoom-K)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,g,!0)}_fireEvents(s,c,g){const v=Su(this._eventsInProgress),S=Su(s),C={};for(const N in s){const{originalEvent:U}=s[N];this._eventsInProgress[N]||(C[`${N}start`]=U),this._eventsInProgress[N]=s[N]}!v&&S&&this._fireEvent("movestart",S.originalEvent);for(const N in C)this._fireEvent(N,C[N]);S&&this._fireEvent("move",S.originalEvent);for(const N in s){const{originalEvent:U}=s[N];this._fireEvent(N,U)}const k={};let F;for(const N in this._eventsInProgress){const{handlerName:U,originalEvent:q}=this._eventsInProgress[N];this._handlersById[U].isActive()||(delete this._eventsInProgress[N],F=c[U]||q,k[`${N}end`]=F)}for(const N in k)this._fireEvent(N,k[N]);const z=Su(this._eventsInProgress);if(g&&(v||S)&&!z){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=q=>0!==q&&-this._bearingSnap<q&&q<this._bearingSnap;N?(U(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:F})):(this._map.fire(new h.x("moveend",{originalEvent:F})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new h.x(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new Bc("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const hc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Rg extends h.E{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=!1!==c.respectPrefersReducedMotion,h.aJ(["_renderFrameCallback"],this)}getCenter(){return new h.bL(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,g){return s=h.P.convert(s).mult(-1),this.panTo(this.transform.center,h.l({offset:s},c),g)}panTo(s,c,g){return this.easeTo(h.l({center:s},c),g)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,g){return this.easeTo(h.l({zoom:s},c),g)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,g){return this.easeTo(h.l({bearing:s},c),g)}resetNorth(s,c){return this.rotateTo(0,h.l({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(h.l({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=h.as.convert(s);const g=c&&c.bearing||0,v=c&&c.pitch||0,S=s.getNorthWest(),C=s.getSouthEast();return this._cameraForBounds(this.transform,S,C,g,v,c)}_extendPadding(s){const c={top:0,right:0,bottom:0,left:0};return null==s?h.l({},c,this.transform.padding):"number"==typeof s?{top:s,bottom:s,right:s,left:s}:h.l({},c,s)}_extendCameraOptions(s){return(s=h.l({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,c){const g=c.max[0]-c.min[0],v=c.max[1]-c.min[1];return g/v>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,c,g,v,S,C){const k=s.clone(),F=this._extendCameraOptions(C);k.bearing=v,k.pitch=S;const z=h.bL.convert(c),N=h.bL.convert(g),U=.5*(z.lat+N.lat),q=.5*(z.lng+N.lng),W=h.dt(U,q),ee=h.a6.vec3.normalize([],W),K=h.a6.vec3.normalize([],h.a6.vec3.cross([],ee,[0,1,0])),re=h.a6.vec3.cross([],K,ee),ie=[K[0],K[1],K[2],0,re[0],re[1],re[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],ge=[W,h.dt(z.lat,z.lng),h.dt(N.lat,z.lng),h.dt(N.lat,N.lng),h.dt(z.lat,N.lng),h.dt(U,z.lng),h.dt(U,N.lng),h.dt(z.lat,q),h.dt(N.lat,q)];let xe=h.ca.fromPoints(ge.map(bt=>[h.a6.vec3.dot(K,bt),h.a6.vec3.dot(re,bt),h.a6.vec3.dot(ee,bt)]));const ve=h.a6.vec3.transformMat4([],xe.center,ie);0===h.a6.vec3.squaredLength(ve)&&h.a6.vec3.set(ve,0,0,1),h.a6.vec3.normalize(ve,ve),h.a6.vec3.scale(ve,ve,h.aq),k.center=h.du(ve);const Ee=k.getWorldToCameraMatrix(),Ae=h.a6.mat4.invert(new Float64Array(16),Ee);xe=h.ca.applyTransform(xe,h.a6.mat4.multiply([],Ee,ie));const Ie=this._extendAABB(xe,k,F,v);if(!Ie)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");xe=Ie,h.a6.vec3.transformMat4(ve,ve,Ee);const Re=.5*(xe.max[2]-xe.min[2]),Fe=this._minimumAABBFrustumDistance(k,xe),He=h.a6.vec3.scale([],[0,0,1],Re),ze=h.a6.vec3.add(He,ve,He),Ne=Fe+(0===k.pitch?0:h.a6.vec3.distance(ve,ze)),ut=k.globeCenterInViewSpace,wt=h.a6.vec3.sub([],ve,[ut[0],ut[1],ut[2]]);h.a6.vec3.normalize(wt,wt),h.a6.vec3.scale(wt,wt,Ne);const zt=h.a6.vec3.add([],ve,wt);h.a6.vec3.transformMat4(zt,zt,Ae);const Zt=h.dw/h.aq,sn=h.a6.vec3.length(zt),Ke=h.bE(Math.max(sn*Zt-h.dw,Number.EPSILON),0),Pt=Math.min(k.zoomFromMercatorZAdjusted(Ke),F.maxZoom);return Pt>.5*(h.c3+h.bV)?(k.setProjection({name:"mercator"}),k.zoom=Pt,this._cameraForBounds(k,c,g,v,S,C)):{center:k.center,zoom:Pt,bearing:v,pitch:S}}_extendAABB(s,c,g,v){const S=.5*((g.padding.left||0)+(g.padding.right||0)),C=.5*((g.padding.top||0)+(g.padding.bottom||0)),k=C,F=S,z=S,N=C,U=c.width-(F+z),q=c.height-(k+N),W=h.a6.vec3.sub([],s.max,s.min),ee=Math.min(U/W[0],q/W[1]),K=Math.min(c.scaleZoom(c.scale*ee),g.maxZoom);if(isNaN(K))return null;const re=c.scale/c.zoomScale(K),ie=new h.ca([s.min[0]-F*re,s.min[1]-N*re,s.min[2]],[s.max[0]+z*re,s.max[1]+k*re,s.max[2]]),ge=("number"==typeof g.offset.x&&"number"==typeof g.offset.y?new h.P(g.offset.x,g.offset.y):h.P.convert(g.offset)).rotate(-h.bC(v));return ie.center[0]-=ge.x*re,ie.center[1]+=ge.y*re,ie}queryTerrainElevation(s,c){const g=this.transform.elevation;return g?(c=h.l({},{exaggerated:!0},c),g.getAtPoint(h.a5.fromLngLat(s),null,c.exaggerated)):null}_cameraForBounds(s,c,g,v,S,C){if("globe"===s.projection.name)return this._cameraForBoundsOnGlobe(s,c,g,v,S,C);const k=s.clone(),F=this._extendCameraOptions(C);k.bearing=v,k.pitch=S;const z=h.bL.convert(c),N=h.bL.convert(g),U=new h.bL(z.lng,N.lat),q=new h.bL(N.lng,z.lat),W=k.project(z),ee=k.project(N),K=this.queryTerrainElevation(z),re=this.queryTerrainElevation(N),ie=this.queryTerrainElevation(U),ge=this.queryTerrainElevation(q),xe=[[W.x,W.y,Math.min(K||0,re||0,ie||0,ge||0)],[ee.x,ee.y,Math.max(K||0,re||0,ie||0,ge||0)]];let ve=h.ca.fromPoints(xe);const Ee=k.getWorldToCameraMatrix(),Ae=h.a6.mat4.invert(new Float64Array(16),Ee);ve=h.ca.applyTransform(ve,Ee);const Ie=this._extendAABB(ve,k,F,v);if(!Ie)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ve=Ie;const Re=.5*h.a6.vec3.sub([],ve.max,ve.min)[2],Fe=this._minimumAABBFrustumDistance(k,ve),He=[0,0,1,0];h.a6.vec4.transformMat4(He,He,Ee),h.a6.vec4.normalize(He,He);const ze=h.a6.vec3.scale([],He,Fe+Re),Ne=h.a6.vec3.add([],ve.center,ze);h.a6.vec3.transformMat4(ve.center,ve.center,Ae),h.a6.vec3.transformMat4(Ne,Ne,Ae);const ut=k.unproject(new h.P(ve.center[0],ve.center[1])),wt=h.dv(k.projection,ut),zt=Math.pow(2,wt),Zt=Math.min(k._zoomFromMercatorZ(Ne[2]*k.pixelsPerMeter*zt/k.worldSize),F.maxZoom);return k.mercatorFromTransition&&Zt<.5*(h.c3+h.bV)?(k.setProjection({name:"globe"}),k.zoom=Zt,this._cameraForBounds(k,c,g,v,S,C)):{center:ut,zoom:Zt,bearing:v,pitch:S}}fitBounds(s,c,g){const v=this.cameraForBounds(s,c);return this._fitInternal(v,c,g)}fitScreenCoordinates(s,c,g,v,S){const C=h.P.convert(s),k=h.P.convert(c),F=new h.P(Math.min(C.x,k.x),Math.min(C.y,k.y)),z=new h.P(Math.max(C.x,k.x),Math.max(C.y,k.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(C,k))return this;const N=this.transform.pointLocation3D(F),U=this.transform.pointLocation3D(z),q=this.transform.pointLocation3D(new h.P(F.x,z.y)),W=this.transform.pointLocation3D(new h.P(z.x,F.y)),ee=[Math.min(N.lng,U.lng,q.lng,W.lng),Math.min(N.lat,U.lat,q.lat,W.lat)],K=[Math.max(N.lng,U.lng,q.lng,W.lng),Math.max(N.lat,U.lat,q.lat,W.lat)],re=v&&v.pitch?v.pitch:this.getPitch(),ie=this._cameraForBounds(this.transform,ee,K,g,re,v);return this._fitInternal(ie,v,S)}_fitInternal(s,c,g){return s?(c=h.l(s,c)).linear?this.easeTo(c,g):this.flyTo(c,g):this}jumpTo(s,c){this.stop();const g=s.preloadOnly?this.transform.clone():this.transform;let v=!1,S=!1,C=!1;"zoom"in s&&g.zoom!==+s.zoom&&(v=!0,g.zoom=+s.zoom),void 0!==s.center&&(g.center=h.bL.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(S=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(C=!0,g.pitch=+s.pitch);const k="number"==typeof s.padding?this._extendPadding(s.padding):s.padding;if(null!=s.padding&&!g.isPaddingEqual(k))if(!1===s.retainPadding){const F=g.clone();F.padding=k,g.setLocationAtPoint(g.center,F.centerPoint)}else g.padding=k;return s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new h.x("movestart",c)).fire(new h.x("move",c)),v&&this.fire(new h.x("zoomstart",c)).fire(new h.x("zoom",c)).fire(new h.x("zoomend",c)),S&&this.fire(new h.x("rotatestart",c)).fire(new h.x("rotate",c)).fire(new h.x("rotateend",c)),C&&this.fire(new h.x("pitchstart",c)).fire(new h.x("pitch",c)).fire(new h.x("pitchend",c)),this.fire(new h.x("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||h.w(hc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,c){const g=this.transform;if(!g.projection.supportsFreeCamera)return h.w(hc),this;this.stop();const v=g.zoom,S=g.pitch,C=g.bearing;g.setFreeCameraOptions(s);const k=v!==g.zoom,F=S!==g.pitch,z=C!==g.bearing;return this.fire(new h.x("movestart",c)).fire(new h.x("move",c)),k&&this.fire(new h.x("zoomstart",c)).fire(new h.x("zoom",c)).fire(new h.x("zoomend",c)),z&&this.fire(new h.x("rotatestart",c)).fire(new h.x("rotate",c)).fire(new h.x("rotateend",c)),F&&this.fire(new h.x("pitchstart",c)).fire(new h.x("pitch",c)).fire(new h.x("pitchend",c)),this.fire(new h.x("moveend",c)),this}easeTo(s,c){this._stop(!1,s.easeId),(!1===(s=h.l({offset:[0,0],duration:500,easing:h.dr},s)).animate||this._prefersReducedMotion(s))&&(s.duration=0);const g=this.transform,v=this.getZoom(),S=this.getBearing(),C=this.getPitch(),k=this.getPadding(),F="zoom"in s?+s.zoom:v,z="bearing"in s?this._normalizeBearing(s.bearing,S):S,N="pitch"in s?+s.pitch:C,U=this._extendPadding(s.padding),q=h.P.convert(s.offset);let W,ee,K;if("globe"===g.projection.name){const He=h.a5.fromLngLat(g.center),ze=q.rotate(-g.angle);He.x+=ze.x/g.worldSize,He.y+=ze.y/g.worldSize;const Ne=He.toLngLat(),ut=h.bL.convert(s.center||Ne);this._normalizeCenter(ut),W=g.centerPoint.add(ze),ee=new h.P(He.x,He.y).mult(g.worldSize),K=new h.P(h.am(ut.lng),h.at(ut.lat)).mult(g.worldSize).sub(ee)}else{W=g.centerPoint.add(q);const He=g.pointLocation(W),ze=h.bL.convert(s.center||He);this._normalizeCenter(ze),ee=g.project(He),K=g.project(ze).sub(ee)}const re=g.zoomScale(F-v);let ie,ge;s.around&&(ie=h.bL.convert(s.around),ge=g.locationPoint(ie));const xe=this._zooming||F!==v,ve=this._rotating||S!==z,Ee=this._pitching||N!==C,Ae=!g.isPaddingEqual(U),Ie=!1===s.retainPadding?g.clone():g,Re=He=>ze=>{if(xe&&(He.zoom=h.aa(v,F,ze)),ve&&(He.bearing=h.aa(S,z,ze)),Ee&&(He.pitch=h.aa(C,N,ze)),Ae&&(Ie.interpolatePadding(k,U,ze),W=Ie.centerPoint.add(q)),ie)He.setLocationAtPoint(ie,ge);else{const Ne=He.zoomScale(He.zoom-v),ut=F>v?Math.min(2,re):Math.max(.5,re),wt=Math.pow(ut,1-ze),zt=He.unproject(ee.add(K.mult(ze*wt)).mult(Ne));He.setLocationAtPoint(He.renderWorldCopies?zt.wrap():zt,W)}return s.preloadOnly||this._fireMoveEvents(c),He};if(s.preloadOnly){const He=this._emulate(Re,s.duration,g);return this._preloadTiles(He),this}const Fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=xe,this._rotating=ve,this._pitching=Ee,this._padding=Ae,this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,Fe),this._ease(Re(g),He=>{"sea"===g.cameraElevationReference&&g.recenterOnTerrain(),this._afterEase(c,He)},s),this}_prepareEase(s,c,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),c||g.moving||this.fire(new h.x("movestart",s)),this._zooming&&!g.zooming&&this.fire(new h.x("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new h.x("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new h.x("pitchstart",s))}_fireMoveEvents(s){this.fire(new h.x("move",s)),this._zooming&&this.fire(new h.x("zoom",s)),this._rotating&&this.fire(new h.x("rotate",s)),this._pitching&&this.fire(new h.x("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new h.x("zoomend",s)),v&&this.fire(new h.x("rotateend",s)),S&&this.fire(new h.x("pitchend",s)),this.fire(new h.x("moveend",s))}flyTo(s,c){if(this._prefersReducedMotion(s)){const bt=h.ar(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(bt,c)}this.stop(),s=h.l({offset:[0,0],speed:1.2,curve:1.42,easing:h.dr},s);const g=this.transform,v=this.getZoom(),S=this.getBearing(),C=this.getPitch(),k=this.getPadding(),F="zoom"in s?h.ap(+s.zoom,g.minZoom,g.maxZoom):v,z="bearing"in s?this._normalizeBearing(s.bearing,S):S,N="pitch"in s?+s.pitch:C,U=this._extendPadding(s.padding),q=g.zoomScale(F-v),W=h.P.convert(s.offset);let ee=g.centerPoint.add(W);const K=g.pointLocation(ee),re=h.bL.convert(s.center||K);this._normalizeCenter(re);const ie=g.project(K),ge=g.project(re).sub(ie);let xe=s.curve;const ve=Math.max(g.width,g.height),Ee=ve/q,Ae=ge.mag();if("minZoom"in s){const bt=h.ap(Math.min(s.minZoom,v,F),g.minZoom,g.maxZoom),Ot=ve/g.zoomScale(bt-v);xe=Math.sqrt(Ot/Ae*2)}const Ie=xe*xe;function Re(bt){const Ot=(Ee*Ee-ve*ve+(bt?-1:1)*Ie*Ie*Ae*Ae)/(2*(bt?Ee:ve)*Ie*Ae);return Math.log(Math.sqrt(Ot*Ot+1)-Ot)}function Fe(bt){return(Math.exp(bt)-Math.exp(-bt))/2}function He(bt){return(Math.exp(bt)+Math.exp(-bt))/2}const ze=Re(0);let Ne=function(bt){return He(ze)/He(ze+xe*bt)},ut=function(bt){return ve*((He(ze)*(Fe(Ot=ze+xe*bt)/He(Ot))-Fe(ze))/Ie)/Ae;var Ot},wt=(Re(1)-ze)/xe;if(Math.abs(Ae)<1e-6||!isFinite(wt)){if(Math.abs(ve-Ee)<1e-6)return this.easeTo(s,c);const bt=Ee<ve?-1:1;wt=Math.abs(Math.log(Ee/ve))/xe,ut=function(){return 0},Ne=function(Ot){return Math.exp(bt*xe*Ot)}}s.duration="duration"in s?+s.duration:1e3*wt/("screenSpeed"in s?+s.screenSpeed/xe:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const zt=S!==z,Zt=N!==C,sn=!g.isPaddingEqual(U),Ke=!1===s.retainPadding?g.clone():g,Pt=bt=>Ot=>{const Ut=Ot*wt,Lt=1/Ne(Ut);bt.zoom=1===Ot?F:v+bt.scaleZoom(Lt),zt&&(bt.bearing=h.aa(S,z,Ot)),Zt&&(bt.pitch=h.aa(C,N,Ot)),sn&&(Ke.interpolatePadding(k,U,Ot),ee=Ke.centerPoint.add(W));const un=1===Ot?re:bt.unproject(ie.add(ge.mult(ut(Ut))).mult(Lt));return bt.setLocationAtPoint(bt.renderWorldCopies?un.wrap():un,ee),bt._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(c),bt};if(s.preloadOnly){const bt=this._emulate(Pt,s.duration,g);return this._preloadTiles(bt),this}return this._zooming=!0,this._rotating=zt,this._pitching=Zt,this._padding=sn,this._prepareEase(c,!1),this._ease(Pt(g),()=>this._afterEase(c),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,c)}if(!s){const g=this.handlers;g&&g.stop(!1)}return this}_ease(s,c,g){!1===g.animate||0===g.duration?(s(1),c()):(this._easeStart=h.q.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((h.q.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=h.bB(s,-180,180);const g=Math.abs(s-c);return Math.abs(s-360-c)<g&&(s-=360),Math.abs(s+360-c)<g&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(c.maxBounds||"globe"!==c.projection.name&&!c.renderWorldCopies)return;const g=s.lng-c.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&h.q.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,c,g){const v=Math.ceil(15*c/1e3),S=[],C=s(g.clone());for(let k=0;k<=v;k++){const F=C(k/v);S.push(F.clone())}return S}_preloadTiles(s,c){}}class im{constructor(s={}){this.options=s,h.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const c=this.options&&this.options.compact,g=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=rt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=rt("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const v=rt("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",g),this._innerContainer=rt("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||h.e.ACCESS_TOKEN}];if(s){const g=c.reduce((v,S,C)=>(S.value&&(v+=`${S.key}=${S.value}${C<c.length-1?"&":""}`),v),"?");s.href=`${h.e.FEEDBACK_URL}/${g}#${ch(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const c=this._map.style._mergedSourceCaches;for(const v in c){const S=c[v];if(S.used){const C=S.getSource();C.attribution&&s.indexOf(C.attribution)<0&&s.push(C.attribution)}}s.sort((v,S)=>v.length-S.length),s=s.filter((v,S)=>{for(let C=S+1;C<s.length;C++)if(s[C].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Pg{constructor(){h.aJ(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=rt("div","mapboxgl-ctrl");const c=rt("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&"metadata"!==s.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(0===Object.entries(s).length)return!0;for(const c in s){const g=s[c].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Mb{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,g=c?this._queue.concat(c):this._queue;for(const v of g)if(v.id===s)return void(v.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const g of c)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class gd{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const c=h.cw((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,c,g){this._start=this.getValue(c),this._end=s,this._startTime=c,this._endTime=c+g}}const rm={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},qv=["mouseenter","mouseover","mouseleave","mouseout"];class Du extends h.x{constructor(s,c,g,v){const{point:S,lngLat:C,originalEvent:k,target:F}=s;super(s.type,{point:S,lngLat:C,originalEvent:k,target:F}),this.preventDefault=()=>{s.preventDefault()},this.id=c,this.interaction=g,this.feature=v}}class wp{constructor(s){this.map=s,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(s,c){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const{type:g,filter:v}=c;if(v){const C=h.M(v,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===C.result)throw new Error(C.value.map(k=>`${k.key}: ${k.message}`).join(", "));this.filters.set(s,C.value)}const S=this.interactionsByType.get(g)||new Map;0===S.size&&(qv.includes(g)?this.map.on(g,c.featureset,this.handleType):this.map.on(g,this.handleType),this.interactionsByType.set(g,S)),S.set(s,c),this.typeById.set(s,g)}remove(s){const c=this.typeById.get(s);if(!c)return;this.typeById.delete(s),this.filters.delete(s);const g=this.interactionsByType.get(c);g&&(g.delete(s),0===g.size&&this.map.off(c,this.handleType))}handleType(s){const c=this.interactionsByType.get(s.type),g=Array.from(c).reverse(),v=[];for(const[,k]of g)k.featureset&&v.push({featureset:k.featureset,filter:k.filter,radius:k.radius});let S=this.map.style.queryRenderedFeaturesForInteractions(s.point,v,this.map.transform);!S.length&&qv.includes(s.type)&&(S=[null]);let C=!1;for(const k of S){for(const[F,z]of g){const{handler:N,featureset:U}=z;if(U&&(null==k||h.bi(k.featureset,U))&&!1!==N(new Du(s,F,z,k))){C=!0;break}}if(C)break}if(!C)for(const[k,F]of g){const{handler:z,featureset:N}=F;if(!N&&!1!==z(new Du(s,k,F,null)))break}}}function Eu(m,s){if(Array.isArray(m)&&Array.isArray(s)){const c=new Set(m),g=new Set(s);return c.size===g.size&&m.every(v=>g.has(v))}return h.bi(m,s)}const ph={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1},zc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bl{constructor(s,c,g=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Eg({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new Ig({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),h.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),Rn()}move(s,c){const g=this.map,v=this.mouseRotate.mousemoveWindow(s,c),S=v&&v.bearingDelta;if(S&&g.setBearing(g.getBearing()+S),this.mousePitch){const C=this.mousePitch.mousemoveWindow(s,c),k=C&&C.pitchDelta;k&&g.setPitch(g.getPitch()+k)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Vt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(h.l({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),We(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,We(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ft(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){1!==s.targetTouches.length?this.reset():(this._lastPos=Ft(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function pc(m,s,c){if(m=new h.bL(m.lng,m.lat),s){const g=new h.bL(m.lng-360,m.lat),v=new h.bL(m.lng+360,m.lat),S=360*Math.ceil(Math.abs(m.lng-c.center.lng)/360),C=c.locationPoint(m).distSqr(s),k=s.x<0||s.y<0||s.x>c.width||s.y>c.height;c.locationPoint(g).distSqr(s)<C&&(k||Math.abs(g.lng-c.center.lng)<S)?m=g:c.locationPoint(v).distSqr(s)<C&&(k||Math.abs(v.lng-c.center.lng)<S)&&(m=v)}for(;Math.abs(m.lng-c.center.lng)>180;){const g=c.locationPoint(m);if(g.x>=0&&g.y>=0&&g.x<=c.width&&g.y<=c.height)break;m.lng>c.center.lng?m.lng-=360:m.lng+=360}return m}const Ja={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ca extends h.E{constructor(s,c){if(super(),(s instanceof HTMLElement||c)&&(s=h.l({element:s},c)),h.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=h.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=rt("div");const S=41,C=27,k=ft("svg",{display:"block",height:S*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${S}`},this._element),F=ft("radialGradient",{id:"shadowGradient"},ft("defs",{},k));ft("stop",{offset:"10%","stop-opacity":.4},F),ft("stop",{offset:"100%","stop-opacity":.05},F),ft("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),ft("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),ft("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),ft("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=h.P.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",S=>{S.preventDefault()}),this._element.addEventListener("mousedown",S=>{S.preventDefault()});const g=this._element.classList;for(const S in Ja)g.remove(`mapboxgl-marker-anchor-${S}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);const v=s&&s.className?s.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=h.bL.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const c=s.code,g=s.charCode||s.keyCode;"Space"!==c&&"Enter"!==c&&32!==g&&13!==g||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,g=this._element;this._popup&&(c===g||g.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,c=this._pos;if(!s||!c)return!1;const g=s.unproject(c),v=s.getFreeCameraOptions();if(!v.position)return!1;const S=v.position.toLngLat();return S.distanceTo(g)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const c=this._pos;if(!c||c.x<0||c.x>s.transform.width||c.y<0||c.y>s.transform.height)return void this._clearFadeTimer();const g=s.unproject(c);let v;s._showingGlobe()&&h.dz(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${s.x}px,${s.y}px)\n            ${Ja[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${c.x}px,${c.y}px)\n        `}_calculateXYTransform(){const s=this._pos,c=this._map,g=this.getPitchAlignment();if(!c||!s||"map"!==g)return"";if(!c._showingGlobe()){const F=c.getPitch();return F?`rotateX(${F}deg)`:""}const v=h.c1(h.dA(c.transform,this._lngLat)),S=s.sub(h.dB(c.transform)),C=Math.abs(S.x)+Math.abs(S.y);if(0===C)return"";const k=v/C;return`rotateX(${-S.y*k}deg) rotateY(${S.x*k}deg)`}_calculateZTransform(){const s=this._pos,c=this._map;if(!c||!s)return"";let g=0;const v=this.getRotationAlignment();if("map"===v)if(c._showingGlobe()){const S=c.project(new h.bL(this._lngLat.lng,this._lngLat.lat+.001)),C=c.project(new h.bL(this._lngLat.lng,this._lngLat.lat-.001)).sub(S);g=h.c1(Math.atan2(C.y,C.x))-90}else g=-c.getBearing();else if("horizon"===v){const S=h.a7(4,6,c.getZoom()),C=h.dB(c.transform);C.y+=S*c.transform.height;const k=s.sub(C),F=h.c1(Math.atan2(k.y,k.x));g=(F>90?F-270:F+90)*(1-S)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=pc(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),!0===s?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=h.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const c=this._map;if(!c)return;const g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){const S=this._clickTolerance||c._clickTolerance;if(s.point.dist(g)<S)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new h.x("dragstart"))),this.fire(new h.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new h.x("dragend")),this._state="inactive"}_addDragHandler(s){const c=this._map,g=this._pos;c&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const c=this._map;return c&&(s?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Gv={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Tt={maxWidth:100,unit:"metric"},Ab={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},$o={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},om=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ws(m=new h.P(0,0),s="bottom"){if("number"==typeof m){const c=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(s){case"top":return new h.P(0,m);case"top-left":return new h.P(c,c);case"top-right":return new h.P(-c,c);case"bottom":return new h.P(0,-m);case"bottom-left":return new h.P(c,-c);case"bottom-right":return new h.P(-c,-c);case"left":return new h.P(m,0);case"right":return new h.P(-m,0)}return new h.P(0,0)}return m instanceof h.P||Array.isArray(m)?h.P.convert(m):h.P.convert(m[s]||[0,0])}return{version:dt,supported:jt.supported,setRTLTextPlugin:h.dC,getRTLTextPluginStatus:h.dD,Map:class extends Rg{constructor(m){Se.mark(Ct.create);const s=m;if(null!=(m=h.l({},ph,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&h.dx(window)&&(m.antialias=!1,h.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new sa(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Mb,this._domRenderTaskQueue=new Mb,this._controls=[],this._markers=[],this._popups=[],this._mapId=h.aQ(),this._locale=h.l({},rm,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new gd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Nt(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?{...m.contextCreateOptions}:{},"string"==typeof m.container){const c=document.getElementById(m.container);if(!c)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=c}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&h.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),h.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Jf),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new xs(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||h.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new Kf("string"==typeof m.hash&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==s.center&&null==s.zoom||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const c=m.bounds;c&&(this.resize(),this.fitBounds(c,h.l({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new im({customAttribution:m.customAttribution})),this._logoControl=new Pg,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new h.x(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new h.x(`${c.dataType}dataloading`,c))}),this._interactions=new wp(this)}_getMapId(){return this._mapId}addControl(m,s){if(void 0===s&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new h.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[s];return-1!==s.indexOf("bottom")?g.insertBefore(c,g.firstChild):g.appendChild(c),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new h.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new h.x("movestart",m)).fire(new h.x("move",m)),this.fire(new h.x("resize",m)),s&&this.fire(new h.x("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(h.as.convert(m)),this._update()}setMinZoom(m){if((m=null!=m?m:-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new h.x("zoomstart")).fire(new h.x("zoom")).fire(new h.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=null!=m?m:22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new h.x("zoomstart")).fire(new h.x("zoom")).fire(new h.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=null!=m?m:0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new h.x("pitchstart")).fire(new h.x("pitch")).fire(new h.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=null!=m?m:85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new h.x("pitchstart")).fire(new h.x("pitch")).fire(new h.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(s=>"symbol"===s.type),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return"auto"===m?navigator.language:Array.isArray(m)?0===m.length?void 0:m.map(s=>"auto"===s?navigator.language:s):m}setLanguage(m){const s=this._parseLanguage(m);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(m){return this._lazyInitEmptyStyle(),m?"string"==typeof m&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const m=this.transform,s=m.projection.name;let c;"globe"===s&&m.zoom>=h.bV?(m.setMercatorFromTransition(),c=!0):"mercator"===s&&m.zoom<h.bV&&(m.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,s){return this._updateProjection(m||s||{name:"mercator"})}_updateProjection(m){let s;return s="globe"===m.name&&this.transform.zoom>=h.bV?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m){return this.transform.locationPoint3D(h.bL.convert(m))}unproject(m){return this.transform.pointLocation3D(h.P.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,s,c){const g=v=>{let S=[];if(Array.isArray(s)){const C=s.filter(k=>this.getLayer(k));S=C.length?this.queryRenderedFeatures(v,{layers:C}):[]}else S=this.queryRenderedFeatures(v,{featureset:s});return S};if("mouseenter"===m||"mouseover"===m){let v=!1;return{listener:c,targets:s,delegates:{mousemove:C=>{const k=g(C.point);k.length?v||(v=!0,c.call(this,new Xr(m,this,C.originalEvent,{features:k}))):v=!1},mouseout:()=>{v=!1}}}}if("mouseleave"===m||"mouseout"===m){let v=!1;return{listener:c,targets:s,delegates:{mousemove:k=>{g(k.point).length?v=!0:v&&(v=!1,c.call(this,new Xr(m,this,k.originalEvent)))},mouseout:k=>{v&&(v=!1,c.call(this,new Xr(m,this,k.originalEvent)))}}}}{const v=S=>{const C=g(S.point);C.length&&(S.features=C,c.call(this,S),delete S.features)};return{listener:c,targets:s,delegates:{[m]:v}}}}on(m,s,c){if("function"==typeof s||void 0===c)return super.on(m,s);if("string"==typeof s&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._createDelegatedListener(m,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(m,s,c){if("function"==typeof s||void 0===c)return super.once(m,s);if("string"==typeof s&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._createDelegatedListener(m,s,c);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(m,s,c){if("function"==typeof s||void 0===c)return super.off(m,s);if("string"==typeof s&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(v=>{for(let S=0;S<v.length;S++){const C=v[S];if(C.listener===c&&Eu(C.targets,s)){for(const k in C.delegates)this.off(k,C.delegates[k]);return v.splice(S,1),this}}})(g),this}queryRenderedFeatures(m,s){if(!this.style)return[];if(void 0!==s||void 0===m||m instanceof h.P||Array.isArray(m)||(s=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],"featureset"in(s=s||{}))return this._isFeaturesetDescriptorValid(s.featureset)?this.style.queryRenderedFeaturesForInteractions(m,[s],this.transform):[];if(s.layers&&Array.isArray(s.layers))for(const c of s.layers)if(!this._isValidId(c))return[];return this.style.queryRenderedFeatures(m,s,this.transform)}querySourceFeatures(m,s){return!m||"string"==typeof m&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,s)}isPointOnSurface(m){const{name:s}=this.transform.projection;return"globe"!==s&&"mercator"!==s&&h.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(h.P.convert(m))}addInteraction(m,s){return this._interactions.add(m,s),this}removeInteraction(m){return this._interactions.remove(m),this}setStyle(m,s){return s=h.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&m&&!1!==s.diff&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(m,(c,g)=>{c?(h.w(`Unable to perform style diff: ${String(c.message||c.error||c)}. Rebuilding the style from scratch.`),this._updateStyle(m,s)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(m,s))}_getUIString(m){const s=this._locale[m];if(null==s)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const c=h.l({},s);s&&s.config&&(c.initialConfig=s.config,delete c.config),this.style=new Xs(this,c).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(h.w("There is no style added to the map."),!1)}_isValidId(m){return null==m?(this.fire(new h.t(new Error("IDs can't be empty."))),!1):!h.aK(m)||(this.fire(new h.t(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isFeaturesetDescriptorValid(m){return"featuresetId"in m?this._isValidId(m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const s of m)if(!this._isValidId(s))return!1;return!0}return this._isFeaturesetDescriptorValid(m)}addSource(m,s){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,s,c){this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,c)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,s,{pixelRatio:c=1,sdf:g=!1,stretchX:v,stretchY:S,content:C}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:k,height:F,data:z}=h.q.getImageData(s);this.style.addImage(m,{data:new h.r({width:k,height:F},z),pixelRatio:c,stretchX:v,stretchY:S,content:C,sdf:g,version:0})}else if(void 0===s.width||void 0===s.height)this.fire(new h.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:F}=s,z=s;this.style.addImage(m,{data:new h.r({width:k,height:F},new Uint8Array(z.data)),pixelRatio:c,stretchX:v,stretchY:S,content:C,sdf:g,version:0,userImage:z}),z.onAdd&&z.onAdd(this,m)}}updateImage(m,s){this._lazyInitEmptyStyle();const c=this.style.getImage(m);if(!c)return void this.fire(new h.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?h.q.getImageData(s):s,{width:v,height:S,data:C}=g;if(void 0===v||void 0===S)return void this.fire(new h.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==c.data.width||S!==c.data.height)return void this.fire(new h.t(new Error(`The width and height of the updated image (${v}, ${S})\n                must be that same as the previous version of the image\n                (${c.data.width}, ${c.data.height})`)));const k=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);c.data.replace(C,k),this.style.updateImage(m,c)}hasImage(m){return m?!!this.style&&!!this.style.getImage(m):(this.fire(new h.t(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,s){h.o(this._requestManager.transformRequest(m,h.R.Image),(c,g)=>{s(c,g instanceof HTMLImageElement?h.q.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(m,s){this._lazyInitEmptyStyle(),this.style.addModel(m,s)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new h.t(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,s){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)):this}getSlot(m){const s=this.getLayer(m);return s&&s.slot||null}setSlot(m,s){return this.style.setSlot(m,s),this.style.mergeLayers(),this._update(!0)}addImport(m,s){return this.style.addImport(m,s),this}updateImport(m,s){return"string"!=typeof s&&s.id!==m?(this.removeImport(m),this.addImport(s)):(this.style.updateImport(m,s),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,s){return this.style.moveImport(m,s),this._update(!0)}moveLayer(m,s){return this._isValidId(m)?(this.style.moveLayer(m,s),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const s=this.style.getOwnLayer(m);return s?"custom"===s.type?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,s,c){return this._isValidId(m)?(this.style.setLayerZoomRange(m,s,c),this._update(!0)):this}setFilter(m,s,c={}){return this._isValidId(m)?(this.style.setFilter(m,s,c),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,s,c,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,s,c,g),this._update(!0)):this}getPaintProperty(m,s){return this._isValidId(m)?this.style.getPaintProperty(m,s):null}setLayoutProperty(m,s,c,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,s,c,g),this._update(!0)):this}getLayoutProperty(m,s){return this._isValidId(m)?this.style.getLayoutProperty(m,s):null}getSchema(m){return this.style.getSchema(m)}setSchema(m,s){return this.style.setSchema(m,s),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,s){return this.style.setConfig(m,s),this._update(!0)}getConfigProperty(m,s){return this.style.getConfigProperty(m,s)}setConfigProperty(m,s,c){return this.style.setConfigProperty(m,s,c),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&1===m.length&&"flat"===m[0].type){const s=m[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return 0===m.length&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===m["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(h.bL.convert(m),this.transform):0}setFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,s),this._update())}removeFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,s),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let c,g,v,S=this._container;for(;S&&(!g||!v);){const C=window.getComputedStyle(S).transform;C&&"none"!==C&&(c=C.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&"0"!==c[0]&&"1"!==c[0]&&(g=c[0]),c[3]&&"0"!==c[3]&&"1"!==c[3]&&(v=c[3])),S=S.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&h.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=rt("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=rt("div","mapboxgl-canvas-container",m);this._canvas=rt("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=rt("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{g[v]=rt("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s){const c=h.q.devicePixelRatio||1;this._canvas.width=c*Math.ceil(m),this._canvas.height=c*Math.ceil(s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const s=this._markers.indexOf(m);-1!==s&&this._markers.splice(s,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const s=this._popups.indexOf(m);-1!==s&&this._popups.splice(s,1)}_setupPainter(){const m=h.l({},jt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",m);s?(dn(s,!0),this.painter=new Fl(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),h.m.testSupport(s)):this.fire(new h.t(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.x("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new h.x("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let s;this.fire(new h.x("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,g=h.q.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=v.createQuery(),v.beginQuery(c.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,N=this.transform.pitch,U=h.q.now(),q=new h.a3(z,{now:U,fadeDuration:S,pitch:N,transition:this.style.transition});this.style.update(q)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(g);const k=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),k&&(this._placementDirty=k.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new h.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Se.mark(Ct.load),this.fire(new h.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const z=h.q.now()-g;v.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const N=v.getQueryParameter(s,v.QUERY_RESULT)/1e6;v.deleteQuery(s),this.fire(new h.x("gpu-timing-frame",{cpuTime:z,gpuTime:N}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const N=this.painter.queryGpuTimers(z);this.fire(new h.x("gpu-timing-layer",{layerTimes:N}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const N=this.painter.queryGpuTimeDeferredRender(z);this.fire(new h.x("gpu-timing-deferred-render",{gpuTime:N}))},50)}const F=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(F||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(C=this._updateAverageElevation(g,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new h.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const N=this._calculateSpeedIndex();this.fire(new h.x("speedindexcompleted",{speedIndex:N})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||F||(this._fullyLoaded=!0,Se.mark(Ct.fullLoad),this._performanceMetricsCollection&&ks(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const s of this._markers)m&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!m||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(m,s=!1){const c=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(s||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const v=this.transform.averageElevation;let S=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=m;const C=Math.abs(v-S);if(C>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(S),c(S);this._averageElevation.easeTo(S,m,300)}else if(C>1e-4)return this._averageElevation.jumpTo(S),c(S)}return!!this._averageElevation.isEasing(m)&&c(this._averageElevation.getValue(m))}_authenticate(){Q(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===qe||401===m.status)){const s=this.painter.context.gl;dn(s,!1),this._logoControl instanceof Pg&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new h.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),br(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&ds(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const c=this.painter.context.gl,g=c.createFramebuffer();function v(S){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,S,0);const C=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,C),C}return c.bindFramebuffer(c.FRAMEBUFFER,g),this._canvasPixelComparison(v(m),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(m,s,c){let g=c[1]-c[0];const v=m.length/4;for(let S=0;S<s.length;S++){const C=s[S];let k=0;for(let F=0;F<C.length;F+=4)C[F]===m[F]&&C[F+1]===m[F+1]&&C[F+2]===m[F+2]&&C[F+3]===m[F+3]&&(k+=1);g+=(c[S+2]-c[S+1])*(1-k/v)}return g}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ce.delete(this.painter.context.gl),$s.remove(),Wn.remove(),this._removed=!0,this.fire(new h.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=h.q.frame(s=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(s)}))}_preloadTiles(m){const s=this.style?this.style.getSourceCaches():[];return h.bg(s,(c,g)=>c._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,s){h.dy(m,s)}get version(){return dt}},NavigationControl:class{constructor(m={}){this.options=h.l({},zc,m),this._container=rt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(h.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),rt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),rt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(h.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:s}):c.resetNorth({},{originalEvent:s}))}),this._compassIcon=rt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const s=m.getZoom(),c=s===m.getMaxZoom(),g=s===m.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bl(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,s){const c=rt("button",m,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(m,s){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${s}`);m.setAttribute("aria-label",c),m.firstElementChild&&m.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends h.E{constructor(m={}){super();const s=navigator.geolocation;this.options=h.l({geolocation:s},Gv,m),h.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ya(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=rt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const s=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,m(c)};void 0!==this._supportsGeolocation?m(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(c=>s("denied"!==c.state)).catch(()=>s()):s()}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),c=m.coords;return!!s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new h.x("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new h.x("geolocate",m)),this._finish()}}_updateCamera(m){const s=new h.bL(m.coords.longitude,m.coords.latitude),c=m.coords.accuracy,g=this._map.getBearing(),v=h.l({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),v,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new h.bL(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,s=h.bE(1,m._center.lat)*m.worldSize,c=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new h.x("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=rt("button","mapboxgl-ctrl-geolocate",this._container),rt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=rt("div","mapboxgl-user-location"),this._dotElement.appendChild(rt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(rt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ca({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=rt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ca({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||"ACTIVE_LOCK"!==this._watchState||s.originalEvent&&"resize"===s.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new h.x("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(s=>{"granted"===s&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:im,ScaleControl:class{constructor(m={}){this.options=h.l({},Tt,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(s){return!1}}(),h.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,s=this._map,c=s._containerHeight/2,g=s._containerWidth/2-m/2,v=s.unproject([g,c]),S=s.unproject([g+m,c]),C=v.distanceTo(S);if("imperial"===this.options.unit){const k=3.2808*C;k>5280?this._setScale(m,k/5280,"mile"):this._setScale(m,k,"foot")}else"nautical"===this.options.unit?this._setScale(m,C/1852,"nautical-mile"):C>=1e3?this._setScale(m,C/1e3,"kilometer"):this._setScale(m,C,"meter")}_setScale(m,s,c){this._map._requestDomTask(()=>{const g=function(S){const C=Math.pow(10,`${Math.floor(S)}`.length-1);let k=S/C;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(F){const z=Math.pow(10,Math.ceil(-Math.log(F)/Math.LN10));return Math.round(F*z)/z}(k),C*k}(s),v=g/s;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==c?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(g):`${g}&nbsp;${Ab[c]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=rt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:h.w("Full screen control 'container' must be a DOM element.")),h.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=rt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=rt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);rt("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends h.E{constructor(m){super(),this.options=h.l(Object.create($o),m),h.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new h.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new h.x("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=h.bL.convert(m),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),c=document.createElement("body");let g;for(c.innerHTML=m;g=c.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=rt("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(m),this.options.closeButton){const c=this._closeButton=rt("button","mapboxgl-popup-close-button",s);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let s;return this._classList.delete(m)?s=!1:(this._classList.add(m),s=!0),this._updateClassList(),s}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const s=this._map,c=this._container,g=this._pos;if(!s||!c||!g)return"bottom";const v=c.offsetWidth,S=c.offsetHeight,C=g.x<v/2,k=g.x>s.transform.width-v/2;if(g.y+m<S)return C?"top-left":k?"top-right":"top";if(g.y>s.transform.height-S){if(C)return"bottom-left";if(k)return"bottom-right"}return C?"left":k?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),m.className=s.join(" ")}_update(m){const s=this._map,c=this._content;if(!s||!this._lngLat&&!this._trackPointer||!c)return;let g=this._container;if(g||(g=this._container=rt("div","mapboxgl-popup",s.getContainer()),this._tip=rt("div","mapboxgl-popup-tip",g),g.appendChild(c)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pc(this._lngLat,this._pos,s.transform)),!this._trackPointer||m){const v=this._pos=this._trackPointer&&m instanceof h.P?m:s.project(this._lngLat),S=ws(this.options.offset),C=this._anchor=this._getAnchor(S.y),k=ws(this.options.offset,C),F=v.add(k).round();s._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${Ja[C]} translate(${F.x}px,${F.y}px)`)})}if(!this._marker&&s._showingGlobe()){const v=h.dz(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(om);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Ca,Style:Xs,LngLat:h.bL,LngLatBounds:h.as,Point:h.P,MercatorCoordinate:h.a5,FreeCameraOptions:cn,Evented:h.E,config:h.e,prewarm:h.dE,clearPrewarmedResources:h.dF,get accessToken(){return h.e.ACCESS_TOKEN},set accessToken(m){h.e.ACCESS_TOKEN=m},get baseApiUrl(){return h.e.API_URL},set baseApiUrl(m){h.e.API_URL=m},get workerCount(){return h.dG.workerCount},set workerCount(m){h.dG.workerCount=m},get maxParallelImageRequests(){return h.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){h.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){h.dH(m)},get workerUrl(){return h.dI.workerUrl},set workerUrl(m){h.dI.workerUrl=m},get workerClass(){return h.dI.workerClass},set workerClass(m){h.dI.workerClass=m},get workerParams(){return h.dI.workerParams},set workerParams(m){h.dI.workerParams=m},get dracoUrl(){return h.dJ()},set dracoUrl(m){h.dK(m)},get meshoptUrl(){return h.dL()},set meshoptUrl(m){h.dM(m)},setNow:h.q.setNow,restoreNow:h.q.restoreNow}}),Ye}()},3502:(Mn,kn,pt)=>{var Ye=pt(3172),tt=Ye.Buffer;function Ue(dt,Ct){for(var Se in dt)Ct[Se]=dt[Se]}function h(dt,Ct,Se){return tt(dt,Ct,Se)}tt.from&&tt.alloc&&tt.allocUnsafe&&tt.allocUnsafeSlow?Mn.exports=Ye:(Ue(Ye,kn),kn.Buffer=h),h.prototype=Object.create(tt.prototype),Ue(tt,h),h.from=function(dt,Ct,Se){if("number"==typeof dt)throw new TypeError("Argument must not be a number");return tt(dt,Ct,Se)},h.alloc=function(dt,Ct,Se){if("number"!=typeof dt)throw new TypeError("Argument must be a number");var Mt=tt(dt);return void 0!==Ct?"string"==typeof Se?Mt.fill(Ct,Se):Mt.fill(Ct):Mt.fill(0),Mt},h.allocUnsafe=function(dt){if("number"!=typeof dt)throw new TypeError("Argument must be a number");return tt(dt)},h.allocUnsafeSlow=function(dt){if("number"!=typeof dt)throw new TypeError("Argument must be a number");return Ye.SlowBuffer(dt)}},1503:(Mn,kn,pt)=>{!function(Ye){Ye.parser=function(Q,Ce){return new Ue(Q,Ce)},Ye.SAXParser=Ue,Ye.SAXStream=nn,Ye.createStream=function $t(Q,Ce){return new nn(Q,Ce)},Ye.MAX_BUFFER_LENGTH=65536;var Se,tt=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function Ue(Q,Ce){if(!(this instanceof Ue))return new Ue(Q,Ce);var dn=this;(function dt(Q){for(var Ce=0,dn=tt.length;Ce<dn;Ce++)Q[tt[Ce]]=""})(dn),dn.q=dn.c="",dn.bufferCheckPosition=Ye.MAX_BUFFER_LENGTH,dn.opt=Ce||{},dn.opt.lowercase=dn.opt.lowercase||dn.opt.lowercasetags,dn.looseCase=dn.opt.lowercase?"toLowerCase":"toUpperCase",dn.tags=[],dn.closed=dn.closedRoot=dn.sawRoot=!1,dn.tag=dn.error=null,dn.strict=!!Q,dn.noscript=!(!Q&&!dn.opt.noscript),dn.state=Ve.BEGIN,dn.strictEntities=dn.opt.strictEntities,dn.ENTITIES=Object.create(dn.strictEntities?Ye.XML_ENTITIES:Ye.ENTITIES),dn.attribList=[],dn.opt.xmlns&&(dn.ns=Object.create(xn)),dn.trackPosition=!1!==dn.opt.position,dn.trackPosition&&(dn.position=dn.line=dn.column=0),Nt(dn,"onready")}Ye.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(Q){function Ce(){}return Ce.prototype=Q,new Ce}),Object.keys||(Object.keys=function(Q){var Ce=[];for(var dn in Q)Q.hasOwnProperty(dn)&&Ce.push(dn);return Ce}),Ue.prototype={end:function(){vn(this)},write:function $s(Q){var Ce=this;if(this.error)throw this.error;if(Ce.closed)return Pn(Ce,"Cannot write after close. Assign an onready handler.");if(null===Q)return vn(Ce);"object"==typeof Q&&(Q=Q.toString());for(var dn=0,st="";st=ks(Q,dn++),Ce.c=st,st;)switch(Ce.trackPosition&&(Ce.position++,"\n"===st?(Ce.line++,Ce.column=0):Ce.column++),Ce.state){case Ve.BEGIN:if(Ce.state=Ve.BEGIN_WHITESPACE,"\ufeff"===st)continue;On(Ce,st);continue;case Ve.BEGIN_WHITESPACE:On(Ce,st);continue;case Ve.TEXT:if(Ce.sawRoot&&!Ce.closedRoot){for(var Ht=dn-1;st&&"<"!==st&&"&"!==st;)(st=ks(Q,dn++))&&Ce.trackPosition&&(Ce.position++,"\n"===st?(Ce.line++,Ce.column=0):Ce.column++);Ce.textNode+=Q.substring(Ht,dn-1)}"<"!==st||Ce.sawRoot&&Ce.closedRoot&&!Ce.strict?(!ke(st)&&(!Ce.sawRoot||Ce.closedRoot)&&$n(Ce,"Text data outside of root node."),"&"===st?Ce.state=Ve.TEXT_ENTITY:Ce.textNode+=st):(Ce.state=Ve.OPEN_WAKA,Ce.startTagPosition=Ce.position);continue;case Ve.SCRIPT:"<"===st?Ce.state=Ve.SCRIPT_ENDING:Ce.script+=st;continue;case Ve.SCRIPT_ENDING:"/"===st?Ce.state=Ve.CLOSE_TAG:(Ce.script+="<"+st,Ce.state=Ve.SCRIPT);continue;case Ve.OPEN_WAKA:"!"===st?(Ce.state=Ve.SGML_DECL,Ce.sgmlDecl=""):ke(st)||(Te(ui,st)?(Ce.state=Ve.OPEN_TAG,Ce.tagName=st):"/"===st?(Ce.state=Ve.CLOSE_TAG,Ce.tagName=""):"?"===st?(Ce.state=Ve.PROC_INST,Ce.procInstName=Ce.procInstBody=""):($n(Ce,"Unencoded <"),Ce.startTagPosition+1<Ce.position&&(st=new Array(Ce.position-Ce.startTagPosition).join(" ")+st),Ce.textNode+="<"+st,Ce.state=Ve.TEXT));continue;case Ve.SGML_DECL:"[CDATA["===(Ce.sgmlDecl+st).toUpperCase()?(xt(Ce,"onopencdata"),Ce.state=Ve.CDATA,Ce.sgmlDecl="",Ce.cdata=""):Ce.sgmlDecl+st==="--"?(Ce.state=Ve.COMMENT,Ce.comment="",Ce.sgmlDecl=""):"DOCTYPE"===(Ce.sgmlDecl+st).toUpperCase()?(Ce.state=Ve.DOCTYPE,(Ce.doctype||Ce.sawRoot)&&$n(Ce,"Inappropriately located doctype declaration"),Ce.doctype="",Ce.sgmlDecl=""):">"===st?(xt(Ce,"onsgmldeclaration",Ce.sgmlDecl),Ce.sgmlDecl="",Ce.state=Ve.TEXT):(We(st)&&(Ce.state=Ve.SGML_DECL_QUOTED),Ce.sgmlDecl+=st);continue;case Ve.SGML_DECL_QUOTED:st===Ce.q&&(Ce.state=Ve.SGML_DECL,Ce.q=""),Ce.sgmlDecl+=st;continue;case Ve.DOCTYPE:">"===st?(Ce.state=Ve.TEXT,xt(Ce,"ondoctype",Ce.doctype),Ce.doctype=!0):(Ce.doctype+=st,"["===st?Ce.state=Ve.DOCTYPE_DTD:We(st)&&(Ce.state=Ve.DOCTYPE_QUOTED,Ce.q=st));continue;case Ve.DOCTYPE_QUOTED:Ce.doctype+=st,st===Ce.q&&(Ce.q="",Ce.state=Ve.DOCTYPE);continue;case Ve.DOCTYPE_DTD:Ce.doctype+=st,"]"===st?Ce.state=Ve.DOCTYPE:We(st)&&(Ce.state=Ve.DOCTYPE_DTD_QUOTED,Ce.q=st);continue;case Ve.DOCTYPE_DTD_QUOTED:Ce.doctype+=st,st===Ce.q&&(Ce.state=Ve.DOCTYPE_DTD,Ce.q="");continue;case Ve.COMMENT:"-"===st?Ce.state=Ve.COMMENT_ENDING:Ce.comment+=st;continue;case Ve.COMMENT_ENDING:"-"===st?(Ce.state=Ve.COMMENT_ENDED,Ce.comment=tn(Ce.opt,Ce.comment),Ce.comment&&xt(Ce,"oncomment",Ce.comment),Ce.comment=""):(Ce.comment+="-"+st,Ce.state=Ve.COMMENT);continue;case Ve.COMMENT_ENDED:">"!==st?($n(Ce,"Malformed comment"),Ce.comment+="--"+st,Ce.state=Ve.COMMENT):Ce.state=Ve.TEXT;continue;case Ve.CDATA:"]"===st?Ce.state=Ve.CDATA_ENDING:Ce.cdata+=st;continue;case Ve.CDATA_ENDING:"]"===st?Ce.state=Ve.CDATA_ENDING_2:(Ce.cdata+="]"+st,Ce.state=Ve.CDATA);continue;case Ve.CDATA_ENDING_2:">"===st?(Ce.cdata&&xt(Ce,"oncdata",Ce.cdata),xt(Ce,"onclosecdata"),Ce.cdata="",Ce.state=Ve.TEXT):"]"===st?Ce.cdata+="]":(Ce.cdata+="]]"+st,Ce.state=Ve.CDATA);continue;case Ve.PROC_INST:"?"===st?Ce.state=Ve.PROC_INST_ENDING:ke(st)?Ce.state=Ve.PROC_INST_BODY:Ce.procInstName+=st;continue;case Ve.PROC_INST_BODY:if(!Ce.procInstBody&&ke(st))continue;"?"===st?Ce.state=Ve.PROC_INST_ENDING:Ce.procInstBody+=st;continue;case Ve.PROC_INST_ENDING:">"===st?(xt(Ce,"onprocessinginstruction",{name:Ce.procInstName,body:Ce.procInstBody}),Ce.procInstName=Ce.procInstBody="",Ce.state=Ve.TEXT):(Ce.procInstBody+="?"+st,Ce.state=Ve.PROC_INST_BODY);continue;case Ve.OPEN_TAG:Te(Rn,st)?Ce.tagName+=st:(Kn(Ce),">"===st?br(Ce):"/"===st?Ce.state=Ve.OPEN_TAG_SLASH:(ke(st)||$n(Ce,"Invalid character in tag name"),Ce.state=Ve.ATTRIB));continue;case Ve.OPEN_TAG_SLASH:">"===st?(br(Ce,!0),qr(Ce)):($n(Ce,"Forward-slash in opening tag not followed by >"),Ce.state=Ve.ATTRIB);continue;case Ve.ATTRIB:if(ke(st))continue;">"===st?br(Ce):"/"===st?Ce.state=Ve.OPEN_TAG_SLASH:Te(ui,st)?(Ce.attribName=st,Ce.attribValue="",Ce.state=Ve.ATTRIB_NAME):$n(Ce,"Invalid attribute name");continue;case Ve.ATTRIB_NAME:"="===st?Ce.state=Ve.ATTRIB_VALUE:">"===st?($n(Ce,"Attribute without value"),Ce.attribValue=Ce.attribName,Wn(Ce),br(Ce)):ke(st)?Ce.state=Ve.ATTRIB_NAME_SAW_WHITE:Te(Rn,st)?Ce.attribName+=st:$n(Ce,"Invalid attribute name");continue;case Ve.ATTRIB_NAME_SAW_WHITE:if("="===st)Ce.state=Ve.ATTRIB_VALUE;else{if(ke(st))continue;$n(Ce,"Attribute without value"),Ce.tag.attributes[Ce.attribName]="",Ce.attribValue="",xt(Ce,"onattribute",{name:Ce.attribName,value:""}),Ce.attribName="",">"===st?br(Ce):Te(ui,st)?(Ce.attribName=st,Ce.state=Ve.ATTRIB_NAME):($n(Ce,"Invalid attribute name"),Ce.state=Ve.ATTRIB)}continue;case Ve.ATTRIB_VALUE:if(ke(st))continue;We(st)?(Ce.q=st,Ce.state=Ve.ATTRIB_VALUE_QUOTED):($n(Ce,"Unquoted attribute value"),Ce.state=Ve.ATTRIB_VALUE_UNQUOTED,Ce.attribValue=st);continue;case Ve.ATTRIB_VALUE_QUOTED:if(st!==Ce.q){"&"===st?Ce.state=Ve.ATTRIB_VALUE_ENTITY_Q:Ce.attribValue+=st;continue}Wn(Ce),Ce.q="",Ce.state=Ve.ATTRIB_VALUE_CLOSED;continue;case Ve.ATTRIB_VALUE_CLOSED:ke(st)?Ce.state=Ve.ATTRIB:">"===st?br(Ce):"/"===st?Ce.state=Ve.OPEN_TAG_SLASH:Te(ui,st)?($n(Ce,"No whitespace between attributes"),Ce.attribName=st,Ce.attribValue="",Ce.state=Ve.ATTRIB_NAME):$n(Ce,"Invalid attribute name");continue;case Ve.ATTRIB_VALUE_UNQUOTED:if(!Ft(st)){"&"===st?Ce.state=Ve.ATTRIB_VALUE_ENTITY_U:Ce.attribValue+=st;continue}Wn(Ce),">"===st?br(Ce):Ce.state=Ve.ATTRIB;continue;case Ve.CLOSE_TAG:if(Ce.tagName)">"===st?qr(Ce):Te(Rn,st)?Ce.tagName+=st:Ce.script?(Ce.script+="</"+Ce.tagName,Ce.tagName="",Ce.state=Ve.SCRIPT):(ke(st)||$n(Ce,"Invalid tagname in closing tag"),Ce.state=Ve.CLOSE_TAG_SAW_WHITE);else{if(ke(st))continue;lt(ui,st)?Ce.script?(Ce.script+="</"+st,Ce.state=Ve.SCRIPT):$n(Ce,"Invalid tagname in closing tag."):Ce.tagName=st}continue;case Ve.CLOSE_TAG_SAW_WHITE:if(ke(st))continue;">"===st?qr(Ce):$n(Ce,"Invalid characters in closing tag");continue;case Ve.TEXT_ENTITY:case Ve.ATTRIB_VALUE_ENTITY_Q:case Ve.ATTRIB_VALUE_ENTITY_U:var Hi,Ao;switch(Ce.state){case Ve.TEXT_ENTITY:Hi=Ve.TEXT,Ao="textNode";break;case Ve.ATTRIB_VALUE_ENTITY_Q:Hi=Ve.ATTRIB_VALUE_QUOTED,Ao="attribValue";break;case Ve.ATTRIB_VALUE_ENTITY_U:Hi=Ve.ATTRIB_VALUE_UNQUOTED,Ao="attribValue"}if(";"===st)if(Ce.opt.unparsedEntities){var pi=ds(Ce);Ce.entity="",Ce.state=Hi,Ce.write(pi)}else Ce[Ao]+=ds(Ce),Ce.entity="",Ce.state=Hi;else Te(Ce.entity.length?En:Vt,st)?Ce.entity+=st:($n(Ce,"Invalid character in entity name"),Ce[Ao]+="&"+Ce.entity+st,Ce.entity="",Ce.state=Hi);continue;default:throw new Error(Ce,"Unknown state: "+Ce.state)}return Ce.position>=Ce.bufferCheckPosition&&function h(Q){for(var Ce=Math.max(Ye.MAX_BUFFER_LENGTH,10),dn=0,st=0,Ht=tt.length;st<Ht;st++){var ao=Q[tt[st]].length;if(ao>Ce)switch(tt[st]){case"textNode":ct(Q);break;case"cdata":xt(Q,"oncdata",Q.cdata),Q.cdata="";break;case"script":xt(Q,"onscript",Q.script),Q.script="";break;default:Pn(Q,"Max buffer length exceeded: "+tt[st])}dn=Math.max(dn,ao)}Q.bufferCheckPosition=Ye.MAX_BUFFER_LENGTH-dn+Q.position}(Ce),Ce},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){!function Ct(Q){ct(Q),""!==Q.cdata&&(xt(Q,"oncdata",Q.cdata),Q.cdata=""),""!==Q.script&&(xt(Q,"onscript",Q.script),Q.script="")}(this)}};try{Se=pt(5398).Stream}catch(Q){Se=function(){}}Se||(Se=function(){});var Mt=Ye.EVENTS.filter(function(Q){return"error"!==Q&&"end"!==Q});function nn(Q,Ce){if(!(this instanceof nn))return new nn(Q,Ce);Se.apply(this),this._parser=new Ue(Q,Ce),this.writable=!0,this.readable=!0;var dn=this;this._parser.onend=function(){dn.emit("end")},this._parser.onerror=function(st){dn.emit("error",st),dn._parser.error=null},this._decoder=null,Mt.forEach(function(st){Object.defineProperty(dn,"on"+st,{get:function(){return dn._parser["on"+st]},set:function(Ht){if(!Ht)return dn.removeAllListeners(st),dn._parser["on"+st]=Ht,Ht;dn.on(st,Ht)},enumerable:!0,configurable:!1})})}(nn.prototype=Object.create(Se.prototype,{constructor:{value:nn}})).write=function(Q){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(Q)){if(!this._decoder){var Ce=pt(3054).s;this._decoder=new Ce("utf8")}Q=this._decoder.write(Q)}return this._parser.write(Q.toString()),this.emit("data",Q),!0},nn.prototype.end=function(Q){return Q&&Q.length&&this.write(Q),this._parser.end(),!0},nn.prototype.on=function(Q,Ce){var dn=this;return!dn._parser["on"+Q]&&-1!==Mt.indexOf(Q)&&(dn._parser["on"+Q]=function(){var st=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);st.splice(0,0,Q),dn.emit.apply(dn,st)}),Se.prototype.on.call(dn,Q,Ce)};var ft="http://www.w3.org/XML/1998/namespace",Rt="http://www.w3.org/2000/xmlns/",xn={xml:ft,xmlns:Rt},ui=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Rn=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,Vt=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,En=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function ke(Q){return" "===Q||"\n"===Q||"\r"===Q||"\t"===Q}function We(Q){return'"'===Q||"'"===Q}function Ft(Q){return">"===Q||ke(Q)}function Te(Q,Ce){return Q.test(Ce)}function lt(Q,Ce){return!Te(Q,Ce)}var Q,Ce,dn,Ve=0;for(var qe in Ye.STATE={BEGIN:Ve++,BEGIN_WHITESPACE:Ve++,TEXT:Ve++,TEXT_ENTITY:Ve++,OPEN_WAKA:Ve++,SGML_DECL:Ve++,SGML_DECL_QUOTED:Ve++,DOCTYPE:Ve++,DOCTYPE_QUOTED:Ve++,DOCTYPE_DTD:Ve++,DOCTYPE_DTD_QUOTED:Ve++,COMMENT_STARTING:Ve++,COMMENT:Ve++,COMMENT_ENDING:Ve++,COMMENT_ENDED:Ve++,CDATA:Ve++,CDATA_ENDING:Ve++,CDATA_ENDING_2:Ve++,PROC_INST:Ve++,PROC_INST_BODY:Ve++,PROC_INST_ENDING:Ve++,OPEN_TAG:Ve++,OPEN_TAG_SLASH:Ve++,ATTRIB:Ve++,ATTRIB_NAME:Ve++,ATTRIB_NAME_SAW_WHITE:Ve++,ATTRIB_VALUE:Ve++,ATTRIB_VALUE_QUOTED:Ve++,ATTRIB_VALUE_CLOSED:Ve++,ATTRIB_VALUE_UNQUOTED:Ve++,ATTRIB_VALUE_ENTITY_Q:Ve++,ATTRIB_VALUE_ENTITY_U:Ve++,CLOSE_TAG:Ve++,CLOSE_TAG_SAW_WHITE:Ve++,SCRIPT:Ve++,SCRIPT_ENDING:Ve++},Ye.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},Ye.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(Ye.ENTITIES).forEach(function(Q){var Ce=Ye.ENTITIES[Q],dn="number"==typeof Ce?String.fromCharCode(Ce):Ce;Ye.ENTITIES[Q]=dn}),Ye.STATE)Ye.STATE[Ye.STATE[qe]]=qe;function Nt(Q,Ce,dn){Q[Ce]&&Q[Ce](dn)}function xt(Q,Ce,dn){Q.textNode&&ct(Q),Nt(Q,Ce,dn)}function ct(Q){Q.textNode=tn(Q.opt,Q.textNode),Q.textNode&&Nt(Q,"ontext",Q.textNode),Q.textNode=""}function tn(Q,Ce){return Q.trim&&(Ce=Ce.trim()),Q.normalize&&(Ce=Ce.replace(/\s+/g," ")),Ce}function Pn(Q,Ce){return ct(Q),Q.trackPosition&&(Ce+="\nLine: "+Q.line+"\nColumn: "+Q.column+"\nChar: "+Q.c),Ce=new Error(Ce),Q.error=Ce,Nt(Q,"onerror",Ce),Q}function vn(Q){return Q.sawRoot&&!Q.closedRoot&&$n(Q,"Unclosed root tag"),Q.state!==Ve.BEGIN&&Q.state!==Ve.BEGIN_WHITESPACE&&Q.state!==Ve.TEXT&&Pn(Q,"Unexpected end"),ct(Q),Q.c="",Q.closed=!0,Nt(Q,"onend"),Ue.call(Q,Q.strict,Q.opt),Q}function $n(Q,Ce){if("object"!=typeof Q||!(Q instanceof Ue))throw new Error("bad call to strictFail");Q.strict&&Pn(Q,Ce)}function Kn(Q){Q.strict||(Q.tagName=Q.tagName[Q.looseCase]());var Ce=Q.tags[Q.tags.length-1]||Q,dn=Q.tag={name:Q.tagName,attributes:{}};Q.opt.xmlns&&(dn.ns=Ce.ns),Q.attribList.length=0,xt(Q,"onopentagstart",dn)}function yi(Q,Ce){var st=Q.indexOf(":")<0?["",Q]:Q.split(":"),Ht=st[0],ao=st[1];return Ce&&"xmlns"===Q&&(Ht="xmlns",ao=""),{prefix:Ht,local:ao}}function Wn(Q){if(Q.strict||(Q.attribName=Q.attribName[Q.looseCase]()),-1!==Q.attribList.indexOf(Q.attribName)||Q.tag.attributes.hasOwnProperty(Q.attribName))Q.attribName=Q.attribValue="";else{if(Q.opt.xmlns){var Ce=yi(Q.attribName,!0),st=Ce.local;if("xmlns"===Ce.prefix)if("xml"===st&&Q.attribValue!==ft)$n(Q,"xml: prefix must be bound to "+ft+"\nActual: "+Q.attribValue);else if("xmlns"===st&&Q.attribValue!==Rt)$n(Q,"xmlns: prefix must be bound to "+Rt+"\nActual: "+Q.attribValue);else{var Ht=Q.tag,ao=Q.tags[Q.tags.length-1]||Q;Ht.ns===ao.ns&&(Ht.ns=Object.create(ao.ns)),Ht.ns[st]=Q.attribValue}Q.attribList.push([Q.attribName,Q.attribValue])}else Q.tag.attributes[Q.attribName]=Q.attribValue,xt(Q,"onattribute",{name:Q.attribName,value:Q.attribValue});Q.attribName=Q.attribValue=""}}function br(Q,Ce){if(Q.opt.xmlns){var dn=Q.tag,st=yi(Q.tagName);dn.prefix=st.prefix,dn.local=st.local,dn.uri=dn.ns[st.prefix]||"",dn.prefix&&!dn.uri&&($n(Q,"Unbound namespace prefix: "+JSON.stringify(Q.tagName)),dn.uri=st.prefix),dn.ns&&(Q.tags[Q.tags.length-1]||Q).ns!==dn.ns&&Object.keys(dn.ns).forEach(function(In){xt(Q,"onopennamespace",{prefix:In,uri:dn.ns[In]})});for(var ao=0,Hi=Q.attribList.length;ao<Hi;ao++){var Ao=Q.attribList[ao],pi=Ao[0],Oe=Ao[1],ae=yi(pi,!0),he=ae.prefix,kt=""===he?"":dn.ns[he]||"",Bt={name:pi,value:Oe,prefix:he,local:ae.local,uri:kt};he&&"xmlns"!==he&&!kt&&($n(Q,"Unbound namespace prefix: "+JSON.stringify(he)),Bt.uri=he),Q.tag.attributes[pi]=Bt,xt(Q,"onattribute",Bt)}Q.attribList.length=0}Q.tag.isSelfClosing=!!Ce,Q.sawRoot=!0,Q.tags.push(Q.tag),xt(Q,"onopentag",Q.tag),Ce||(Q.state=Q.noscript||"script"!==Q.tagName.toLowerCase()?Ve.TEXT:Ve.SCRIPT,Q.tag=null,Q.tagName=""),Q.attribName=Q.attribValue="",Q.attribList.length=0}function qr(Q){if(!Q.tagName)return $n(Q,"Weird empty close tag."),Q.textNode+="</>",void(Q.state=Ve.TEXT);if(Q.script){if("script"!==Q.tagName)return Q.script+="</"+Q.tagName+">",Q.tagName="",void(Q.state=Ve.SCRIPT);xt(Q,"onscript",Q.script),Q.script=""}var Ce=Q.tags.length,dn=Q.tagName;Q.strict||(dn=dn[Q.looseCase]());for(var st=dn;Ce--&&Q.tags[Ce].name!==st;)$n(Q,"Unexpected close tag");if(Ce<0)return $n(Q,"Unmatched closing tag: "+Q.tagName),Q.textNode+="</"+Q.tagName+">",void(Q.state=Ve.TEXT);Q.tagName=dn;for(var ao=Q.tags.length;ao-- >Ce;){var Hi=Q.tag=Q.tags.pop();Q.tagName=Q.tag.name,xt(Q,"onclosetag",Q.tagName);var Ao={};for(var pi in Hi.ns)Ao[pi]=Hi.ns[pi];Q.opt.xmlns&&Hi.ns!==(Q.tags[Q.tags.length-1]||Q).ns&&Object.keys(Hi.ns).forEach(function(ae){xt(Q,"onclosenamespace",{prefix:ae,uri:Hi.ns[ae]})})}0===Ce&&(Q.closedRoot=!0),Q.tagName=Q.attribValue=Q.attribName="",Q.attribList.length=0,Q.state=Ve.TEXT}function ds(Q){var st,Ce=Q.entity,dn=Ce.toLowerCase(),Ht="";return Q.ENTITIES[Ce]?Q.ENTITIES[Ce]:Q.ENTITIES[dn]?Q.ENTITIES[dn]:("#"===(Ce=dn).charAt(0)&&("x"===Ce.charAt(1)?(Ce=Ce.slice(2),Ht=(st=parseInt(Ce,16)).toString(16)):(Ce=Ce.slice(1),Ht=(st=parseInt(Ce,10)).toString(10))),Ce=Ce.replace(/^0+/,""),isNaN(st)||Ht.toLowerCase()!==Ce?($n(Q,"Invalid character entity"),"&"+Q.entity+";"):String.fromCodePoint(st))}function On(Q,Ce){"<"===Ce?(Q.state=Ve.OPEN_WAKA,Q.startTagPosition=Q.position):ke(Ce)||($n(Q,"Non-whitespace before first tag."),Q.textNode=Ce,Q.state=Ve.TEXT)}function ks(Q,Ce){var dn="";return Ce<Q.length&&(dn=Q.charAt(Ce)),dn}Ve=Ye.STATE,String.fromCodePoint||(Q=String.fromCharCode,Ce=Math.floor,dn=function(){var st=16384,Ht=[],Ao=-1,pi=arguments.length;if(!pi)return"";for(var Oe="";++Ao<pi;){var ae=Number(arguments[Ao]);if(!isFinite(ae)||ae<0||ae>1114111||Ce(ae)!==ae)throw RangeError("Invalid code point: "+ae);ae<=65535?Ht.push(ae):Ht.push(55296+((ae-=65536)>>10),ae%1024+56320),(Ao+1===pi||Ht.length>st)&&(Oe+=Q.apply(null,Ht),Ht.length=0)}return Oe},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:dn,configurable:!0,writable:!0}):String.fromCodePoint=dn)}(kn)},5398:(Mn,kn,pt)=>{var Ye=pt(6570);function tt(){Ye.call(this)}tt.prototype=new Ye,Mn.exports=tt,tt.Stream=tt,tt.prototype.pipe=function(Ue,h){var dt=this;function Ct(ft){Ue.writable&&!1===Ue.write(ft)&&dt.pause&&dt.pause()}function Se(){dt.readable&&dt.resume&&dt.resume()}dt.on("data",Ct),Ue.on("drain",Se),!Ue._isStdio&&(!h||!1!==h.end)&&(dt.on("end",$t),dt.on("close",nn));var Mt=!1;function $t(){Mt||(Mt=!0,Ue.end())}function nn(){Mt||(Mt=!0,"function"==typeof Ue.destroy&&Ue.destroy())}function jt(ft){if(rt(),!this.hasListeners("error"))throw ft}function rt(){dt.off("data",Ct),Ue.off("drain",Se),dt.off("end",$t),dt.off("close",nn),dt.off("error",jt),Ue.off("error",jt),dt.off("end",rt),dt.off("close",rt),Ue.off("end",rt),Ue.off("close",rt)}return dt.on("error",jt),Ue.on("error",jt),dt.on("end",rt),dt.on("close",rt),Ue.on("end",rt),Ue.on("close",rt),Ue.emit("pipe",dt),Ue}},3054:(Mn,kn,pt)=>{"use strict";var Ye=pt(3502).Buffer,tt=Ye.isEncoding||function(Vt){switch((Vt=""+Vt)&&Vt.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function dt(Vt){var En;switch(this.encoding=function h(Vt){var En=function Ue(Vt){if(!Vt)return"utf8";for(var En;;)switch(Vt){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return Vt;default:if(En)return;Vt=(""+Vt).toLowerCase(),En=!0}}(Vt);if("string"!=typeof En&&(Ye.isEncoding===tt||!tt(Vt)))throw new Error("Unknown encoding: "+Vt);return En||Vt}(Vt),this.encoding){case"utf16le":this.text=rt,this.end=ft,En=4;break;case"utf8":this.fillLast=$t,En=4;break;case"base64":this.text=Rt,this.end=xn,En=3;break;default:return this.write=ui,void(this.end=Rn)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Ye.allocUnsafe(En)}function Ct(Vt){return Vt<=127?0:Vt>>5==6?2:Vt>>4==14?3:Vt>>3==30?4:Vt>>6==2?-1:-2}function $t(Vt){var En=this.lastTotal-this.lastNeed,ke=function Mt(Vt,En,ke){if(128!=(192&En[0]))return Vt.lastNeed=0,"\ufffd";if(Vt.lastNeed>1&&En.length>1){if(128!=(192&En[1]))return Vt.lastNeed=1,"\ufffd";if(Vt.lastNeed>2&&En.length>2&&128!=(192&En[2]))return Vt.lastNeed=2,"\ufffd"}}(this,Vt);return void 0!==ke?ke:this.lastNeed<=Vt.length?(Vt.copy(this.lastChar,En,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(Vt.copy(this.lastChar,En,0,Vt.length),void(this.lastNeed-=Vt.length))}function rt(Vt,En){if((Vt.length-En)%2==0){var ke=Vt.toString("utf16le",En);if(ke){var We=ke.charCodeAt(ke.length-1);if(We>=55296&&We<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=Vt[Vt.length-2],this.lastChar[1]=Vt[Vt.length-1],ke.slice(0,-1)}return ke}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=Vt[Vt.length-1],Vt.toString("utf16le",En,Vt.length-1)}function ft(Vt){var En=Vt&&Vt.length?this.write(Vt):"";return this.lastNeed?En+this.lastChar.toString("utf16le",0,this.lastTotal-this.lastNeed):En}function Rt(Vt,En){var ke=(Vt.length-En)%3;return 0===ke?Vt.toString("base64",En):(this.lastNeed=3-ke,this.lastTotal=3,1===ke?this.lastChar[0]=Vt[Vt.length-1]:(this.lastChar[0]=Vt[Vt.length-2],this.lastChar[1]=Vt[Vt.length-1]),Vt.toString("base64",En,Vt.length-ke))}function xn(Vt){var En=Vt&&Vt.length?this.write(Vt):"";return this.lastNeed?En+this.lastChar.toString("base64",0,3-this.lastNeed):En}function ui(Vt){return Vt.toString(this.encoding)}function Rn(Vt){return Vt&&Vt.length?this.write(Vt):""}kn.s=dt,dt.prototype.write=function(Vt){if(0===Vt.length)return"";var En,ke;if(this.lastNeed){if(void 0===(En=this.fillLast(Vt)))return"";ke=this.lastNeed,this.lastNeed=0}else ke=0;return ke<Vt.length?En?En+this.text(Vt,ke):this.text(Vt,ke):En||""},dt.prototype.end=function jt(Vt){var En=Vt&&Vt.length?this.write(Vt):"";return this.lastNeed?En+"\ufffd":En},dt.prototype.text=function nn(Vt,En){var ke=function Se(Vt,En,ke){var We=En.length-1;if(We<ke)return 0;var Ft=Ct(En[We]);return Ft>=0?(Ft>0&&(Vt.lastNeed=Ft-1),Ft):--We<ke||-2===Ft?0:(Ft=Ct(En[We]))>=0?(Ft>0&&(Vt.lastNeed=Ft-2),Ft):--We<ke||-2===Ft?0:(Ft=Ct(En[We]))>=0?(Ft>0&&(2===Ft?Ft=0:Vt.lastNeed=Ft-3),Ft):0}(this,Vt,En);if(!this.lastNeed)return Vt.toString("utf8",En);this.lastTotal=ke;var We=Vt.length-(ke-this.lastNeed);return Vt.copy(this.lastChar,0,We),Vt.toString("utf8",En,We)},dt.prototype.fillLast=function(Vt){if(this.lastNeed<=Vt.length)return Vt.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);Vt.copy(this.lastChar,this.lastTotal-this.lastNeed,0,Vt.length),this.lastNeed-=Vt.length}},599:function(Mn){(function(){Mn.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},2269:function(Mn){(function(){Mn.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},3452:function(Mn){(function(){var kn,pt,Ye,tt,Ue,h,dt,Ct={}.hasOwnProperty;kn=function(Se,...Mt){var $t,nn,jt,rt;if(Ue(Object.assign))Object.assign.apply(null,arguments);else for($t=0,jt=Mt.length;$t<jt;$t++)if(null!=(rt=Mt[$t]))for(nn in rt)!Ct.call(rt,nn)||(Se[nn]=rt[nn]);return Se},Ue=function(Se){return!!Se&&"[object Function]"===Object.prototype.toString.call(Se)},h=function(Se){var Mt;return!!Se&&("function"==(Mt=typeof Se)||"object"===Mt)},Ye=function(Se){return Ue(Array.isArray)?Array.isArray(Se):"[object Array]"===Object.prototype.toString.call(Se)},tt=function(Se){var Mt;if(Ye(Se))return!Se.length;for(Mt in Se)if(Ct.call(Se,Mt))return!1;return!0},dt=function(Se){var Mt,$t;return h(Se)&&($t=Object.getPrototypeOf(Se))&&(Mt=$t.constructor)&&"function"==typeof Mt&&Mt instanceof Mt&&Function.prototype.toString.call(Mt)===Function.prototype.toString.call(Object)},pt=function(Se){return Ue(Se.valueOf)?Se.valueOf():Se},Mn.exports.assign=kn,Mn.exports.isFunction=Ue,Mn.exports.isObject=h,Mn.exports.isArray=Ye,Mn.exports.isEmpty=tt,Mn.exports.isPlainObject=dt,Mn.exports.getValue=pt}).call(this)},6316:function(Mn){(function(){Mn.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},5968:function(Mn,kn,pt){(function(){var Ye;Ye=pt(2269),pt(8563),Mn.exports=function(){class h{constructor(Ct,Se,Mt){if(this.parent=Ct,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==Se)throw new Error("Missing attribute name. "+this.debugInfo(Se));this.name=this.stringify.name(Se),this.value=this.stringify.attValue(Mt),this.type=Ye.Attribute,this.isId=!1,this.schemaTypeInfo=null}clone(){return Object.create(this)}toString(Ct){return this.options.writer.attribute(this,this.options.writer.filterOptions(Ct))}debugInfo(Ct){return null==(Ct=Ct||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+Ct+"}, parent: <"+this.parent.name+">"}isEqualNode(Ct){return!(Ct.namespaceURI!==this.namespaceURI||Ct.prefix!==this.prefix||Ct.localName!==this.localName||Ct.value!==this.value)}}return Object.defineProperty(h.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(h.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(h.prototype,"textContent",{get:function(){return this.value},set:function(dt){return this.value=dt||""}}),Object.defineProperty(h.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(h.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(h.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(h.prototype,"specified",{get:function(){return!0}}),h}.call(this)}).call(this)},1361:function(Mn,kn,pt){(function(){var Ye,Ue;Ye=pt(2269),Ue=pt(2182),Mn.exports=class extends Ue{constructor(dt,Ct){if(super(dt),null==Ct)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=Ye.CData,this.value=this.stringify.cdata(Ct)}clone(){return Object.create(this)}toString(dt){return this.options.writer.cdata(this,this.options.writer.filterOptions(dt))}}}).call(this)},2182:function(Mn,kn,pt){(function(){var tt;tt=pt(8563),Mn.exports=function(){class Ue extends tt{constructor(dt){super(dt),this.value=""}clone(){return Object.create(this)}substringData(dt,Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendData(dt){throw new Error("This DOM method is not implemented."+this.debugInfo())}insertData(dt,Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}deleteData(dt,Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceData(dt,Ct,Se){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(dt){return!(!super.isEqualNode(dt)||dt.data!==this.data)}}return Object.defineProperty(Ue.prototype,"data",{get:function(){return this.value},set:function(h){return this.value=h||""}}),Object.defineProperty(Ue.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(Ue.prototype,"textContent",{get:function(){return this.value},set:function(h){return this.value=h||""}}),Ue}.call(this)}).call(this)},2516:function(Mn,kn,pt){(function(){var Ye,tt;Ye=pt(2269),tt=pt(2182),Mn.exports=class extends tt{constructor(dt,Ct){if(super(dt),null==Ct)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=Ye.Comment,this.value=this.stringify.comment(Ct)}clone(){return Object.create(this)}toString(dt){return this.options.writer.comment(this,this.options.writer.filterOptions(dt))}}}).call(this)},5806:function(Mn,kn,pt){(function(){var tt,Ue;tt=pt(9276),Ue=pt(3735),Mn.exports=function(){class h{constructor(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new tt,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}getParameter(Ct){return this.params.hasOwnProperty(Ct)?this.params[Ct]:null}canSetParameter(Ct,Se){return!0}setParameter(Ct,Se){return null!=Se?this.params[Ct]=Se:delete this.params[Ct]}}return Object.defineProperty(h.prototype,"parameterNames",{get:function(){return new Ue(Object.keys(this.defaultParams))}}),h}.call(this)}).call(this)},9276:function(Mn){(function(){Mn.exports=class{constructor(){}handleError(Ye){throw new Error(Ye)}}}).call(this)},9906:function(Mn){(function(){Mn.exports=class{hasFeature(Ye,tt){return!0}createDocumentType(Ye,tt,Ue){throw new Error("This DOM method is not implemented.")}createDocument(Ye,tt,Ue){throw new Error("This DOM method is not implemented.")}createHTMLDocument(Ye){throw new Error("This DOM method is not implemented.")}getFeature(Ye,tt){throw new Error("This DOM method is not implemented.")}}}).call(this)},3735:function(Mn){(function(){Mn.exports=function(){class pt{constructor(tt){this.arr=tt||[]}item(tt){return this.arr[tt]||null}contains(tt){return-1!==this.arr.indexOf(tt)}}return Object.defineProperty(pt.prototype,"length",{get:function(){return this.arr.length}}),pt}.call(this)}).call(this)},7274:function(Mn,kn,pt){(function(){var Ye,Ue;Ue=pt(8563),Ye=pt(2269),Mn.exports=class extends Ue{constructor(dt,Ct,Se,Mt,$t,nn){if(super(dt),null==Ct)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==Se)throw new Error("Missing DTD attribute name. "+this.debugInfo(Ct));if(!Mt)throw new Error("Missing DTD attribute type. "+this.debugInfo(Ct));if(!$t)throw new Error("Missing DTD attribute default. "+this.debugInfo(Ct));if(0!==$t.indexOf("#")&&($t="#"+$t),!$t.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(Ct));if(nn&&!$t.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(Ct));this.elementName=this.stringify.name(Ct),this.type=Ye.AttributeDeclaration,this.attributeName=this.stringify.name(Se),this.attributeType=this.stringify.dtdAttType(Mt),nn&&(this.defaultValue=this.stringify.dtdAttDefault(nn)),this.defaultValueType=$t}toString(dt){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(dt))}}}).call(this)},2068:function(Mn,kn,pt){(function(){var Ye,Ue;Ue=pt(8563),Ye=pt(2269),Mn.exports=class extends Ue{constructor(dt,Ct,Se){if(super(dt),null==Ct)throw new Error("Missing DTD element name. "+this.debugInfo());Se||(Se="(#PCDATA)"),Array.isArray(Se)&&(Se="("+Se.join(",")+")"),this.name=this.stringify.name(Ct),this.type=Ye.ElementDeclaration,this.value=this.stringify.dtdElementValue(Se)}toString(dt){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(dt))}}}).call(this)},8349:function(Mn,kn,pt){(function(){var Ye,Ue,h;({isObject:h}=pt(3452)),Ue=pt(8563),Ye=pt(2269),Mn.exports=function(){class dt extends Ue{constructor(Se,Mt,$t,nn){if(super(Se),null==$t)throw new Error("Missing DTD entity name. "+this.debugInfo($t));if(null==nn)throw new Error("Missing DTD entity value. "+this.debugInfo($t));if(this.pe=!!Mt,this.name=this.stringify.name($t),this.type=Ye.EntityDeclaration,h(nn)){if(!nn.pubID&&!nn.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo($t));if(nn.pubID&&!nn.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo($t));if(this.internal=!1,null!=nn.pubID&&(this.pubID=this.stringify.dtdPubID(nn.pubID)),null!=nn.sysID&&(this.sysID=this.stringify.dtdSysID(nn.sysID)),null!=nn.nData&&(this.nData=this.stringify.dtdNData(nn.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo($t))}else this.value=this.stringify.dtdEntityValue(nn),this.internal=!0}toString(Se){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(Se))}}return Object.defineProperty(dt.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(dt.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(dt.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(dt.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(dt.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(dt.prototype,"xmlVersion",{get:function(){return null}}),dt}.call(this)}).call(this)},3087:function(Mn,kn,pt){(function(){var Ye,Ue;Ue=pt(8563),Ye=pt(2269),Mn.exports=function(){class h extends Ue{constructor(Ct,Se,Mt){if(super(Ct),null==Se)throw new Error("Missing DTD notation name. "+this.debugInfo(Se));if(!Mt.pubID&&!Mt.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(Se));this.name=this.stringify.name(Se),this.type=Ye.NotationDeclaration,null!=Mt.pubID&&(this.pubID=this.stringify.dtdPubID(Mt.pubID)),null!=Mt.sysID&&(this.sysID=this.stringify.dtdSysID(Mt.sysID))}toString(Ct){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(Ct))}}return Object.defineProperty(h.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(h.prototype,"systemId",{get:function(){return this.sysID}}),h}.call(this)}).call(this)},4789:function(Mn,kn,pt){(function(){var Ye,Ue,h;({isObject:h}=pt(3452)),Ue=pt(8563),Ye=pt(2269),Mn.exports=class extends Ue{constructor(Ct,Se,Mt,$t){super(Ct),h(Se)&&({version:Se,encoding:Mt,standalone:$t}=Se),Se||(Se="1.0"),this.type=Ye.Declaration,this.version=this.stringify.xmlVersion(Se),null!=Mt&&(this.encoding=this.stringify.xmlEncoding(Mt)),null!=$t&&(this.standalone=this.stringify.xmlStandalone($t))}toString(Ct){return this.options.writer.declaration(this,this.options.writer.filterOptions(Ct))}}}).call(this)},9195:function(Mn,kn,pt){(function(){var Ye,tt,Ue,h,dt,Se,Mt,$t;({isObject:$t}=pt(3452)),Mt=pt(8563),Ye=pt(2269),tt=pt(7274),h=pt(8349),Ue=pt(2068),dt=pt(3087),Se=pt(5264),Mn.exports=function(){class nn extends Mt{constructor(rt,ft,Rt){var xn,ui,Rn,Vt;if(super(rt),this.type=Ye.DocType,rt.children)for(ui=0,Rn=(Vt=rt.children).length;ui<Rn;ui++)if((xn=Vt[ui]).type===Ye.Element){this.name=xn.name;break}this.documentObject=rt,$t(ft)&&({pubID:ft,sysID:Rt}=ft),null==Rt&&([Rt,ft]=[ft,Rt]),null!=ft&&(this.pubID=this.stringify.dtdPubID(ft)),null!=Rt&&(this.sysID=this.stringify.dtdSysID(Rt))}element(rt,ft){var Rt;return Rt=new Ue(this,rt,ft),this.children.push(Rt),this}attList(rt,ft,Rt,xn,ui){var Rn;return Rn=new tt(this,rt,ft,Rt,xn,ui),this.children.push(Rn),this}entity(rt,ft){var Rt;return Rt=new h(this,!1,rt,ft),this.children.push(Rt),this}pEntity(rt,ft){var Rt;return Rt=new h(this,!0,rt,ft),this.children.push(Rt),this}notation(rt,ft){var Rt;return Rt=new dt(this,rt,ft),this.children.push(Rt),this}toString(rt){return this.options.writer.docType(this,this.options.writer.filterOptions(rt))}ele(rt,ft){return this.element(rt,ft)}att(rt,ft,Rt,xn,ui){return this.attList(rt,ft,Rt,xn,ui)}ent(rt,ft){return this.entity(rt,ft)}pent(rt,ft){return this.pEntity(rt,ft)}not(rt,ft){return this.notation(rt,ft)}up(){return this.root()||this.documentObject}isEqualNode(rt){return!(!super.isEqualNode(rt)||rt.name!==this.name||rt.publicId!==this.publicId||rt.systemId!==this.systemId)}}return Object.defineProperty(nn.prototype,"entities",{get:function(){var jt,rt,ft,Rt,xn;for(Rt={},rt=0,ft=(xn=this.children).length;rt<ft;rt++)(jt=xn[rt]).type===Ye.EntityDeclaration&&!jt.pe&&(Rt[jt.name]=jt);return new Se(Rt)}}),Object.defineProperty(nn.prototype,"notations",{get:function(){var jt,rt,ft,Rt,xn;for(Rt={},rt=0,ft=(xn=this.children).length;rt<ft;rt++)(jt=xn[rt]).type===Ye.NotationDeclaration&&(Rt[jt.name]=jt);return new Se(Rt)}}),Object.defineProperty(nn.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(nn.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(nn.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),nn}.call(this)}).call(this)},519:function(Mn,kn,pt){(function(){var Ye,tt,Ue,dt,Ct,Se,Mt;({isPlainObject:Mt}=pt(3452)),Ue=pt(9906),tt=pt(5806),dt=pt(8563),Ye=pt(2269),Se=pt(5041),Ct=pt(4354),Mn.exports=function(){class $t extends dt{constructor(jt){super(null),this.name="#document",this.type=Ye.Document,this.documentURI=null,this.domConfig=new tt,jt||(jt={}),jt.writer||(jt.writer=new Ct),this.options=jt,this.stringify=new Se(jt)}end(jt){var rt;return rt={},jt?Mt(jt)&&(rt=jt,jt=this.options.writer):jt=this.options.writer,jt.document(this,jt.filterOptions(rt))}toString(jt){return this.options.writer.document(this,this.options.writer.filterOptions(jt))}createElement(jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createDocumentFragment(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTextNode(jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createComment(jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createCDATASection(jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createProcessingInstruction(jt,rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttribute(jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEntityReference(jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}importNode(jt,rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createElementNS(jt,rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createAttributeNS(jt,rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(jt,rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementById(jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}adoptNode(jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalizeDocument(){throw new Error("This DOM method is not implemented."+this.debugInfo())}renameNode(jt,rt,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createEvent(jt){throw new Error("This DOM method is not implemented."+this.debugInfo())}createRange(){throw new Error("This DOM method is not implemented."+this.debugInfo())}createNodeIterator(jt,rt,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}createTreeWalker(jt,rt,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty($t.prototype,"implementation",{value:new Ue}),Object.defineProperty($t.prototype,"doctype",{get:function(){var nn,jt,rt,ft;for(jt=0,rt=(ft=this.children).length;jt<rt;jt++)if((nn=ft[jt]).type===Ye.DocType)return nn;return null}}),Object.defineProperty($t.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty($t.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty($t.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty($t.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===Ye.Declaration?this.children[0].encoding:null}}),Object.defineProperty($t.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===Ye.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty($t.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===Ye.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty($t.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty($t.prototype,"origin",{get:function(){return null}}),Object.defineProperty($t.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty($t.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty($t.prototype,"contentType",{get:function(){return null}}),$t}.call(this)}).call(this)},1105:function(Mn,kn,pt){(function(){var Ye,tt,Ue,h,dt,Ct,Se,Mt,$t,nn,jt,rt,Rt,xn,ui,Rn,Vt,En,ke,We,Ft,Te,lt={}.hasOwnProperty;({isObject:Ft,isFunction:We,isPlainObject:Te,getValue:ke}=pt(3452)),Ye=pt(2269),rt=pt(519),Rt=pt(3352),h=pt(1361),dt=pt(2516),ui=pt(9942),En=pt(474),xn=pt(4666),nn=pt(4789),jt=pt(9195),Ct=pt(7274),Mt=pt(8349),Se=pt(2068),$t=pt(3087),Ue=pt(5968),Vt=pt(5041),Rn=pt(4354),tt=pt(6316),Mn.exports=class{constructor(qe,Nt,xt){var ct;this.name="?xml",this.type=Ye.Document,qe||(qe={}),ct={},qe.writer?Te(qe.writer)&&(ct=qe.writer,qe.writer=new Rn):qe.writer=new Rn,this.options=qe,this.writer=qe.writer,this.writerOptions=this.writer.filterOptions(ct),this.stringify=new Vt(qe),this.onDataCallback=Nt||function(){},this.onEndCallback=xt||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}createChildNode(qe){var xt,ct,tn,Pn,vn,$n,Kn;switch(qe.type){case Ye.CData:this.cdata(qe.value);break;case Ye.Comment:this.comment(qe.value);break;case Ye.Element:for(xt in ct={},$n=qe.attribs)!lt.call($n,xt)||(ct[xt]=$n[xt].value);this.node(qe.name,ct);break;case Ye.Dummy:this.dummy();break;case Ye.Raw:this.raw(qe.value);break;case Ye.Text:this.text(qe.value);break;case Ye.ProcessingInstruction:this.instruction(qe.target,qe.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+qe.constructor.name)}for(Pn=0,vn=(Kn=qe.children).length;Pn<vn;Pn++)this.createChildNode(tn=Kn[Pn]),tn.type===Ye.Element&&this.up();return this}dummy(){return this}node(qe,Nt,xt){if(null==qe)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(qe));return this.openCurrent(),qe=ke(qe),null==Nt&&(Nt={}),Nt=ke(Nt),Ft(Nt)||([xt,Nt]=[Nt,xt]),this.currentNode=new Rt(this,qe,Nt),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=xt&&this.text(xt),this}element(qe,Nt,xt){var ct,tn,Pn,vn,$n,Kn;if(this.currentNode&&this.currentNode.type===Ye.DocType)this.dtdElement(...arguments);else if(Array.isArray(qe)||Ft(qe)||We(qe))for(vn=this.options.noValidation,this.options.noValidation=!0,(Kn=new rt(this.options).element("TEMP_ROOT")).element(qe),this.options.noValidation=vn,tn=0,Pn=($n=Kn.children).length;tn<Pn;tn++)this.createChildNode(ct=$n[tn]),ct.type===Ye.Element&&this.up();else this.node(qe,Nt,xt);return this}attribute(qe,Nt){var xt;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(qe));if(null!=qe&&(qe=ke(qe)),Ft(qe))for(xt in qe)!lt.call(qe,xt)||this.attribute(xt,qe[xt]);else We(Nt)&&(Nt=Nt.apply()),this.options.keepNullAttributes&&null==Nt?this.currentNode.attribs[qe]=new Ue(this,qe,""):null!=Nt&&(this.currentNode.attribs[qe]=new Ue(this,qe,Nt));return this}text(qe){var Nt;return this.openCurrent(),Nt=new En(this,qe),this.onData(this.writer.text(Nt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}cdata(qe){var Nt;return this.openCurrent(),Nt=new h(this,qe),this.onData(this.writer.cdata(Nt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}comment(qe){var Nt;return this.openCurrent(),Nt=new dt(this,qe),this.onData(this.writer.comment(Nt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}raw(qe){var Nt;return this.openCurrent(),Nt=new ui(this,qe),this.onData(this.writer.raw(Nt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}instruction(qe,Nt){var xt,ct,Pn,vn;if(this.openCurrent(),null!=qe&&(qe=ke(qe)),null!=Nt&&(Nt=ke(Nt)),Array.isArray(qe))for(xt=0,Pn=qe.length;xt<Pn;xt++)this.instruction(ct=qe[xt]);else if(Ft(qe))for(ct in qe)!lt.call(qe,ct)||this.instruction(ct,qe[ct]);else We(Nt)&&(Nt=Nt.apply()),vn=new xn(this,qe,Nt),this.onData(this.writer.processingInstruction(vn,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this}declaration(qe,Nt,xt){var ct;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return ct=new nn(this,qe,Nt,xt),this.onData(this.writer.declaration(ct,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}doctype(qe,Nt,xt){if(this.openCurrent(),null==qe)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new jt(this,Nt,xt),this.currentNode.rootNodeName=qe,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this}dtdElement(qe,Nt){var xt;return this.openCurrent(),xt=new Se(this,qe,Nt),this.onData(this.writer.dtdElement(xt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}attList(qe,Nt,xt,ct,tn){var Pn;return this.openCurrent(),Pn=new Ct(this,qe,Nt,xt,ct,tn),this.onData(this.writer.dtdAttList(Pn,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}entity(qe,Nt){var xt;return this.openCurrent(),xt=new Mt(this,!1,qe,Nt),this.onData(this.writer.dtdEntity(xt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}pEntity(qe,Nt){var xt;return this.openCurrent(),xt=new Mt(this,!0,qe,Nt),this.onData(this.writer.dtdEntity(xt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}notation(qe,Nt){var xt;return this.openCurrent(),xt=new $t(this,qe,Nt),this.onData(this.writer.dtdNotation(xt,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this}up(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this}end(){for(;this.currentLevel>=0;)this.up();return this.onEnd()}openCurrent(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)}openNode(qe){var xt,ct,tn;if(!qe.isOpen){if(!this.root&&0===this.currentLevel&&qe.type===Ye.Element&&(this.root=qe),xt="",qe.type===Ye.Element){for(ct in this.writerOptions.state=tt.OpenTag,xt=this.writer.indent(qe,this.writerOptions,this.currentLevel)+"<"+qe.name,tn=qe.attribs)!lt.call(tn,ct)||(xt+=this.writer.attribute(tn[ct],this.writerOptions,this.currentLevel));xt+=(qe.children?">":"/>")+this.writer.endline(qe,this.writerOptions,this.currentLevel),this.writerOptions.state=tt.InsideTag}else this.writerOptions.state=tt.OpenTag,xt=this.writer.indent(qe,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+qe.rootNodeName,qe.pubID&&qe.sysID?xt+=' PUBLIC "'+qe.pubID+'" "'+qe.sysID+'"':qe.sysID&&(xt+=' SYSTEM "'+qe.sysID+'"'),qe.children?(xt+=" [",this.writerOptions.state=tt.InsideTag):(this.writerOptions.state=tt.CloseTag,xt+=">"),xt+=this.writer.endline(qe,this.writerOptions,this.currentLevel);return this.onData(xt,this.currentLevel),qe.isOpen=!0}}closeNode(qe){var Nt;if(!qe.isClosed)return"",this.writerOptions.state=tt.CloseTag,Nt=qe.type===Ye.Element?this.writer.indent(qe,this.writerOptions,this.currentLevel)+"</"+qe.name+">"+this.writer.endline(qe,this.writerOptions,this.currentLevel):this.writer.indent(qe,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(qe,this.writerOptions,this.currentLevel),this.writerOptions.state=tt.None,this.onData(Nt,this.currentLevel),qe.isClosed=!0}onData(qe,Nt){return this.documentStarted=!0,this.onDataCallback(qe,Nt+1)}onEnd(){return this.documentCompleted=!0,this.onEndCallback()}debugInfo(qe){return null==qe?"":"node: <"+qe+">"}ele(){return this.element(...arguments)}nod(qe,Nt,xt){return this.node(qe,Nt,xt)}txt(qe){return this.text(qe)}dat(qe){return this.cdata(qe)}com(qe){return this.comment(qe)}ins(qe,Nt){return this.instruction(qe,Nt)}dec(qe,Nt,xt){return this.declaration(qe,Nt,xt)}dtd(qe,Nt,xt){return this.doctype(qe,Nt,xt)}e(qe,Nt,xt){return this.element(qe,Nt,xt)}n(qe,Nt,xt){return this.node(qe,Nt,xt)}t(qe){return this.text(qe)}d(qe){return this.cdata(qe)}c(qe){return this.comment(qe)}r(qe){return this.raw(qe)}i(qe,Nt){return this.instruction(qe,Nt)}att(){return this.currentNode&&this.currentNode.type===Ye.DocType?this.attList(...arguments):this.attribute(...arguments)}a(){return this.currentNode&&this.currentNode.type===Ye.DocType?this.attList(...arguments):this.attribute(...arguments)}ent(qe,Nt){return this.entity(qe,Nt)}pent(qe,Nt){return this.pEntity(qe,Nt)}not(qe,Nt){return this.notation(qe,Nt)}}}).call(this)},4173:function(Mn,kn,pt){(function(){var Ye,Ue;Ue=pt(8563),Ye=pt(2269),Mn.exports=class extends Ue{constructor(dt){super(dt),this.type=Ye.Dummy}clone(){return Object.create(this)}toString(dt){return""}}}).call(this)},3352:function(Mn,kn,pt){(function(){var Ye,tt,h,dt,Ct,Se,Mt,$t={}.hasOwnProperty;({isObject:Mt,isFunction:Se,getValue:Ct}=pt(3452)),dt=pt(8563),Ye=pt(2269),tt=pt(5968),h=pt(5264),Mn.exports=function(){class nn extends dt{constructor(rt,ft,Rt){var xn,ui,Rn,Vt;if(super(rt),null==ft)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(ft),this.type=Ye.Element,this.attribs={},this.schemaTypeInfo=null,null!=Rt&&this.attribute(Rt),rt.type===Ye.Document&&(this.isRoot=!0,this.documentObject=rt,rt.rootObject=this,rt.children))for(ui=0,Rn=(Vt=rt.children).length;ui<Rn;ui++)if((xn=Vt[ui]).type===Ye.DocType){xn.name=this.name;break}}clone(){var ft,Rt,xn;for(ft in(Rt=Object.create(this)).isRoot&&(Rt.documentObject=null),Rt.attribs={},xn=this.attribs)!$t.call(xn,ft)||(Rt.attribs[ft]=xn[ft].clone());return Rt.children=[],this.children.forEach(function(ui){var Rn;return(Rn=ui.clone()).parent=Rt,Rt.children.push(Rn)}),Rt}attribute(rt,ft){var Rt;if(null!=rt&&(rt=Ct(rt)),Mt(rt))for(Rt in rt)!$t.call(rt,Rt)||this.attribute(Rt,rt[Rt]);else Se(ft)&&(ft=ft.apply()),this.options.keepNullAttributes&&null==ft?this.attribs[rt]=new tt(this,rt,""):null!=ft&&(this.attribs[rt]=new tt(this,rt,ft));return this}removeAttribute(rt){var Rt,xn;if(null==rt)throw new Error("Missing attribute name. "+this.debugInfo());if(rt=Ct(rt),Array.isArray(rt))for(Rt=0,xn=rt.length;Rt<xn;Rt++)delete this.attribs[rt[Rt]];else delete this.attribs[rt];return this}toString(rt){return this.options.writer.element(this,this.options.writer.filterOptions(rt))}att(rt,ft){return this.attribute(rt,ft)}a(rt,ft){return this.attribute(rt,ft)}getAttribute(rt){return this.attribs.hasOwnProperty(rt)?this.attribs[rt].value:null}setAttribute(rt,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNode(rt){return this.attribs.hasOwnProperty(rt)?this.attribs[rt]:null}setAttributeNode(rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNode(rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNS(rt,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNS(rt,ft,Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeAttributeNS(rt,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}getAttributeNodeNS(rt,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}setAttributeNodeNS(rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(rt,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasAttribute(rt){return this.attribs.hasOwnProperty(rt)}hasAttributeNS(rt,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttribute(rt,ft){return this.attribs.hasOwnProperty(rt)?this.attribs[rt].isId:ft}setIdAttributeNS(rt,ft,Rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setIdAttributeNode(rt,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagName(rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByTagNameNS(rt,ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}getElementsByClassName(rt){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(rt){var ft,Rt,xn;if(!super.isEqualNode(rt)||rt.namespaceURI!==this.namespaceURI||rt.prefix!==this.prefix||rt.localName!==this.localName||rt.attribs.length!==this.attribs.length)return!1;for(ft=Rt=0,xn=this.attribs.length-1;0<=xn?Rt<=xn:Rt>=xn;ft=0<=xn?++Rt:--Rt)if(!this.attribs[ft].isEqualNode(rt.attribs[ft]))return!1;return!0}}return Object.defineProperty(nn.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(nn.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(nn.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(nn.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(nn.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(nn.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(nn.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(nn.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new h(this.attribs)),this.attributeMap}}),nn}.call(this)}).call(this)},5264:function(Mn){(function(){Mn.exports=function(){class pt{constructor(tt){this.nodes=tt}clone(){return this.nodes=null}getNamedItem(tt){return this.nodes[tt]}setNamedItem(tt){var Ue;return Ue=this.nodes[tt.nodeName],this.nodes[tt.nodeName]=tt,Ue||null}removeNamedItem(tt){var Ue;return Ue=this.nodes[tt],delete this.nodes[tt],Ue||null}item(tt){return this.nodes[Object.keys(this.nodes)[tt]]||null}getNamedItemNS(tt,Ue){throw new Error("This DOM method is not implemented.")}setNamedItemNS(tt){throw new Error("This DOM method is not implemented.")}removeNamedItemNS(tt,Ue){throw new Error("This DOM method is not implemented.")}}return Object.defineProperty(pt.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),pt}.call(this)}).call(this)},8563:function(Mn,kn,pt){(function(){var Ye,tt,Ue,h,dt,Ct,Se,Mt,jt,rt,ft,Rt,xn,ui,Rn,Vt,En={}.hasOwnProperty,ke=[].splice;({isObject:Vt,isFunction:Rn,isEmpty:ui,getValue:xn}=pt(3452)),Mt=null,Ue=null,h=null,dt=null,Ct=null,ft=null,Rt=null,rt=null,Se=null,tt=null,jt=null,Ye=null,Mn.exports=function(){class We{constructor(Te){this.parent=Te,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,Mt||(Mt=pt(3352),Ue=pt(1361),h=pt(2516),dt=pt(4789),Ct=pt(9195),ft=pt(9942),Rt=pt(474),rt=pt(4666),Se=pt(4173),tt=pt(2269),jt=pt(5112),pt(5264),Ye=pt(599))}setParent(Te){var Ve,qe,Nt,xt;for(this.parent=Te,Te&&(this.options=Te.options,this.stringify=Te.stringify),xt=[],Ve=0,qe=(Nt=this.children).length;Ve<qe;Ve++)xt.push(Nt[Ve].setParent(this));return xt}element(Te,lt,Ve){var qe,xt,ct,tn,Pn,vn,$n,Kn;if(Pn=null,null===lt&&null==Ve&&([lt,Ve]=[{},null]),null==lt&&(lt={}),lt=xn(lt),Vt(lt)||([Ve,lt]=[lt,Ve]),null!=Te&&(Te=xn(Te)),Array.isArray(Te))for(xt=0,vn=Te.length;xt<vn;xt++)Pn=this.element(Te[xt]);else if(Rn(Te))Pn=this.element(Te.apply());else if(Vt(Te)){for(tn in Te)if(En.call(Te,tn))if(Rn(Kn=Te[tn])&&(Kn=Kn.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===tn.indexOf(this.stringify.convertAttKey))Pn=this.attribute(tn.substr(this.stringify.convertAttKey.length),Kn);else if(!this.options.separateArrayItems&&Array.isArray(Kn)&&ui(Kn))Pn=this.dummy();else if(Vt(Kn)&&ui(Kn))Pn=this.element(tn);else if(this.options.keepNullNodes||null!=Kn)if(!this.options.separateArrayItems&&Array.isArray(Kn))for(ct=0,$n=Kn.length;ct<$n;ct++)(qe={})[tn]=Kn[ct],Pn=this.element(qe);else Vt(Kn)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===tn.indexOf(this.stringify.convertTextKey)?Pn=this.element(Kn):(Pn=this.element(tn)).element(Kn):Pn=this.element(tn,Kn);else Pn=this.dummy()}else Pn=this.options.keepNullNodes||null!==Ve?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===Te.indexOf(this.stringify.convertTextKey)?this.text(Ve):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===Te.indexOf(this.stringify.convertCDataKey)?this.cdata(Ve):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===Te.indexOf(this.stringify.convertCommentKey)?this.comment(Ve):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===Te.indexOf(this.stringify.convertRawKey)?this.raw(Ve):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===Te.indexOf(this.stringify.convertPIKey)?this.instruction(Te.substr(this.stringify.convertPIKey.length),Ve):this.node(Te,lt,Ve):this.dummy();if(null==Pn)throw new Error("Could not create any elements with: "+Te+". "+this.debugInfo());return Pn}insertBefore(Te,lt,Ve){var qe,Nt,xt,ct,tn;if(null!=Te&&Te.type)return ct=lt,(xt=Te).setParent(this),ct?(Nt=children.indexOf(ct),tn=children.splice(Nt),children.push(xt),Array.prototype.push.apply(children,tn)):children.push(xt),xt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(Te));return Nt=this.parent.children.indexOf(this),tn=this.parent.children.splice(Nt),qe=this.parent.element(Te,lt,Ve),Array.prototype.push.apply(this.parent.children,tn),qe}insertAfter(Te,lt,Ve){var qe,Nt,xt;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(Te));return Nt=this.parent.children.indexOf(this),xt=this.parent.children.splice(Nt+1),qe=this.parent.element(Te,lt,Ve),Array.prototype.push.apply(this.parent.children,xt),qe}remove(){var Te;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return Te=this.parent.children.indexOf(this),ke.apply(this.parent.children,[Te,Te-Te+1].concat([])),this.parent}node(Te,lt,Ve){var qe;return null!=Te&&(Te=xn(Te)),lt||(lt={}),lt=xn(lt),Vt(lt)||([Ve,lt]=[lt,Ve]),qe=new Mt(this,Te,lt),null!=Ve&&qe.text(Ve),this.children.push(qe),qe}text(Te){var lt;return Vt(Te)&&this.element(Te),lt=new Rt(this,Te),this.children.push(lt),this}cdata(Te){var lt;return lt=new Ue(this,Te),this.children.push(lt),this}comment(Te){var lt;return lt=new h(this,Te),this.children.push(lt),this}commentBefore(Te){var Ve,qe;return Ve=this.parent.children.indexOf(this),qe=this.parent.children.splice(Ve),this.parent.comment(Te),Array.prototype.push.apply(this.parent.children,qe),this}commentAfter(Te){var Ve,qe;return Ve=this.parent.children.indexOf(this),qe=this.parent.children.splice(Ve+1),this.parent.comment(Te),Array.prototype.push.apply(this.parent.children,qe),this}raw(Te){var lt;return lt=new ft(this,Te),this.children.push(lt),this}dummy(){return new Se(this)}instruction(Te,lt){var Ve,Nt,xt,ct;if(null!=Te&&(Te=xn(Te)),null!=lt&&(lt=xn(lt)),Array.isArray(Te))for(xt=0,ct=Te.length;xt<ct;xt++)this.instruction(Ve=Te[xt]);else if(Vt(Te))for(Ve in Te)!En.call(Te,Ve)||this.instruction(Ve,Te[Ve]);else Rn(lt)&&(lt=lt.apply()),Nt=new rt(this,Te,lt),this.children.push(Nt);return this}instructionBefore(Te,lt){var qe,Nt;return qe=this.parent.children.indexOf(this),Nt=this.parent.children.splice(qe),this.parent.instruction(Te,lt),Array.prototype.push.apply(this.parent.children,Nt),this}instructionAfter(Te,lt){var qe,Nt;return qe=this.parent.children.indexOf(this),Nt=this.parent.children.splice(qe+1),this.parent.instruction(Te,lt),Array.prototype.push.apply(this.parent.children,Nt),this}declaration(Te,lt,Ve){var qe,Nt;return qe=this.document(),Nt=new dt(qe,Te,lt,Ve),0===qe.children.length?qe.children.unshift(Nt):qe.children[0].type===tt.Declaration?qe.children[0]=Nt:qe.children.unshift(Nt),qe.root()||qe}dtd(Te,lt){var qe,Nt,xt,ct,tn,Pn,vn,$n,Kn;for(qe=this.document(),Nt=new Ct(qe,Te,lt),xt=ct=0,Pn=($n=qe.children).length;ct<Pn;xt=++ct)if($n[xt].type===tt.DocType)return qe.children[xt]=Nt,Nt;for(xt=tn=0,vn=(Kn=qe.children).length;tn<vn;xt=++tn)if(Kn[xt].isRoot)return qe.children.splice(xt,0,Nt),Nt;return qe.children.push(Nt),Nt}up(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent}root(){var Te;for(Te=this;Te;){if(Te.type===tt.Document)return Te.rootObject;if(Te.isRoot)return Te;Te=Te.parent}}document(){var Te;for(Te=this;Te;){if(Te.type===tt.Document)return Te;Te=Te.parent}}end(Te){return this.document().end(Te)}prev(){var Te;if((Te=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[Te-1]}next(){var Te;if(-1===(Te=this.parent.children.indexOf(this))||Te===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[Te+1]}importDocument(Te){var lt,Ve,qe,Nt,xt;if((Ve=Te.root().clone()).parent=this,Ve.isRoot=!1,this.children.push(Ve),this.type===tt.Document&&(Ve.isRoot=!0,Ve.documentObject=this,this.rootObject=Ve,this.children))for(qe=0,Nt=(xt=this.children).length;qe<Nt;qe++)if((lt=xt[qe]).type===tt.DocType){lt.name=Ve.name;break}return this}debugInfo(Te){var lt,Ve;return null!=(Te=Te||this.name)||null!=(lt=this.parent)&&lt.name?null==Te?"parent: <"+this.parent.name+">":null!=(Ve=this.parent)&&Ve.name?"node: <"+Te+">, parent: <"+this.parent.name+">":"node: <"+Te+">":""}ele(Te,lt,Ve){return this.element(Te,lt,Ve)}nod(Te,lt,Ve){return this.node(Te,lt,Ve)}txt(Te){return this.text(Te)}dat(Te){return this.cdata(Te)}com(Te){return this.comment(Te)}ins(Te,lt){return this.instruction(Te,lt)}doc(){return this.document()}dec(Te,lt,Ve){return this.declaration(Te,lt,Ve)}e(Te,lt,Ve){return this.element(Te,lt,Ve)}n(Te,lt,Ve){return this.node(Te,lt,Ve)}t(Te){return this.text(Te)}d(Te){return this.cdata(Te)}c(Te){return this.comment(Te)}r(Te){return this.raw(Te)}i(Te,lt){return this.instruction(Te,lt)}u(){return this.up()}importXMLBuilder(Te){return this.importDocument(Te)}attribute(Te,lt){throw new Error("attribute() applies to element nodes only.")}att(Te,lt){return this.attribute(Te,lt)}a(Te,lt){return this.attribute(Te,lt)}removeAttribute(Te){throw new Error("attribute() applies to element nodes only.")}replaceChild(Te,lt){throw new Error("This DOM method is not implemented."+this.debugInfo())}removeChild(Te){throw new Error("This DOM method is not implemented."+this.debugInfo())}appendChild(Te){throw new Error("This DOM method is not implemented."+this.debugInfo())}hasChildNodes(){return 0!==this.children.length}cloneNode(Te){throw new Error("This DOM method is not implemented."+this.debugInfo())}normalize(){throw new Error("This DOM method is not implemented."+this.debugInfo())}isSupported(Te,lt){return!0}hasAttributes(){return 0!==this.attribs.length}compareDocumentPosition(Te){var Ve;return this===Te?0:this.document()!==Te.document()?(Ve=Ye.Disconnected|Ye.ImplementationSpecific,Math.random()<.5?Ve|=Ye.Preceding:Ve|=Ye.Following,Ve):this.isAncestor(Te)?Ye.Contains|Ye.Preceding:this.isDescendant(Te)?Ye.Contains|Ye.Following:this.isPreceding(Te)?Ye.Preceding:Ye.Following}isSameNode(Te){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupPrefix(Te){throw new Error("This DOM method is not implemented."+this.debugInfo())}isDefaultNamespace(Te){throw new Error("This DOM method is not implemented."+this.debugInfo())}lookupNamespaceURI(Te){throw new Error("This DOM method is not implemented."+this.debugInfo())}isEqualNode(Te){var lt,Ve,qe;if(Te.nodeType!==this.nodeType||Te.children.length!==this.children.length)return!1;for(lt=Ve=0,qe=this.children.length-1;0<=qe?Ve<=qe:Ve>=qe;lt=0<=qe?++Ve:--Ve)if(!this.children[lt].isEqualNode(Te.children[lt]))return!1;return!0}getFeature(Te,lt){throw new Error("This DOM method is not implemented."+this.debugInfo())}setUserData(Te,lt,Ve){throw new Error("This DOM method is not implemented."+this.debugInfo())}getUserData(Te){throw new Error("This DOM method is not implemented."+this.debugInfo())}contains(Te){return!!Te&&(Te===this||this.isDescendant(Te))}isDescendant(Te){var lt,qe,Nt,xt;for(qe=0,Nt=(xt=this.children).length;qe<Nt;qe++)if(Te===(lt=xt[qe])||lt.isDescendant(Te))return!0;return!1}isAncestor(Te){return Te.isDescendant(this)}isPreceding(Te){var lt,Ve;return lt=this.treePosition(Te),Ve=this.treePosition(this),-1!==lt&&-1!==Ve&&lt<Ve}isFollowing(Te){var lt,Ve;return lt=this.treePosition(Te),Ve=this.treePosition(this),-1!==lt&&-1!==Ve&&lt>Ve}treePosition(Te){var lt,Ve;return Ve=0,lt=!1,this.foreachTreeNode(this.document(),function(qe){if(Ve++,!lt&&qe===Te)return lt=!0}),lt?Ve:-1}foreachTreeNode(Te,lt){var Ve,qe,Nt,xt,ct;for(Te||(Te=this.document()),qe=0,Nt=(xt=Te.children).length;qe<Nt;qe++){if(ct=lt(Ve=xt[qe]))return ct;if(ct=this.foreachTreeNode(Ve,lt))return ct}}}return Object.defineProperty(We.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(We.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(We.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(We.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(We.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new jt(this.children)),this.childNodeList}}),Object.defineProperty(We.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(We.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(We.prototype,"previousSibling",{get:function(){var Ft;return Ft=this.parent.children.indexOf(this),this.parent.children[Ft-1]||null}}),Object.defineProperty(We.prototype,"nextSibling",{get:function(){var Ft;return Ft=this.parent.children.indexOf(this),this.parent.children[Ft+1]||null}}),Object.defineProperty(We.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(We.prototype,"textContent",{get:function(){var Ft,Te,lt,Ve,qe;if(this.nodeType===tt.Element||this.nodeType===tt.DocumentFragment){for(qe="",Te=0,lt=(Ve=this.children).length;Te<lt;Te++)(Ft=Ve[Te]).textContent&&(qe+=Ft.textContent);return qe}return null},set:function(Ft){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),We}.call(this)}).call(this)},5112:function(Mn){(function(){Mn.exports=function(){class pt{constructor(tt){this.nodes=tt}clone(){return this.nodes=null}item(tt){return this.nodes[tt]||null}}return Object.defineProperty(pt.prototype,"length",{get:function(){return this.nodes.length||0}}),pt}.call(this)}).call(this)},4666:function(Mn,kn,pt){(function(){var Ye,tt;Ye=pt(2269),tt=pt(2182),Mn.exports=class extends tt{constructor(dt,Ct,Se){if(super(dt),null==Ct)throw new Error("Missing instruction target. "+this.debugInfo());this.type=Ye.ProcessingInstruction,this.target=this.stringify.insTarget(Ct),this.name=this.target,Se&&(this.value=this.stringify.insValue(Se))}clone(){return Object.create(this)}toString(dt){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(dt))}isEqualNode(dt){return!(!super.isEqualNode(dt)||dt.target!==this.target)}}}).call(this)},9942:function(Mn,kn,pt){(function(){var Ye,tt;Ye=pt(2269),tt=pt(8563),Mn.exports=class extends tt{constructor(dt,Ct){if(super(dt),null==Ct)throw new Error("Missing raw text. "+this.debugInfo());this.type=Ye.Raw,this.value=this.stringify.raw(Ct)}clone(){return Object.create(this)}toString(dt){return this.options.writer.raw(this,this.options.writer.filterOptions(dt))}}}).call(this)},7647:function(Mn,kn,pt){(function(){var Ye,tt,h,dt={}.hasOwnProperty;Ye=pt(2269),h=pt(3576),tt=pt(6316),Mn.exports=class extends h{constructor(Se,Mt){super(Mt),this.stream=Se}endline(Se,Mt,$t){return Se.isLastRootNode&&Mt.state===tt.CloseTag?"":super.endline(Se,Mt,$t)}document(Se,Mt){var nn,jt,rt,ft,Rt,xn,ui,Rn;for(nn=jt=0,ft=(xn=Se.children).length;jt<ft;nn=++jt)xn[nn].isLastRootNode=nn===Se.children.length-1;for(Mt=this.filterOptions(Mt),Rn=[],rt=0,Rt=(ui=Se.children).length;rt<Rt;rt++)Rn.push(this.writeChildNode(ui[rt],Mt,0));return Rn}cdata(Se,Mt,$t){return this.stream.write(super.cdata(Se,Mt,$t))}comment(Se,Mt,$t){return this.stream.write(super.comment(Se,Mt,$t))}declaration(Se,Mt,$t){return this.stream.write(super.declaration(Se,Mt,$t))}docType(Se,Mt,$t){var jt,rt,ft;if($t||($t=0),this.openNode(Se,Mt,$t),Mt.state=tt.OpenTag,this.stream.write(this.indent(Se,Mt,$t)),this.stream.write("<!DOCTYPE "+Se.root().name),Se.pubID&&Se.sysID?this.stream.write(' PUBLIC "'+Se.pubID+'" "'+Se.sysID+'"'):Se.sysID&&this.stream.write(' SYSTEM "'+Se.sysID+'"'),Se.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(Se,Mt,$t)),Mt.state=tt.InsideTag,jt=0,rt=(ft=Se.children).length;jt<rt;jt++)this.writeChildNode(ft[jt],Mt,$t+1);Mt.state=tt.CloseTag,this.stream.write("]")}return Mt.state=tt.CloseTag,this.stream.write(Mt.spaceBeforeSlash+">"),this.stream.write(this.endline(Se,Mt,$t)),Mt.state=tt.None,this.closeNode(Se,Mt,$t)}element(Se,Mt,$t){var ft,Rt,xn,ui,Rn,Vt,ke,We,Ft,Te,lt,Ve;if($t||($t=0),this.openNode(Se,Mt,$t),Mt.state=tt.OpenTag,ke=this.indent(Se,Mt,$t)+"<"+Se.name,Mt.pretty&&Mt.width>0)for(Vt in ui=ke.length,Ft=Se.attribs)!dt.call(Ft,Vt)||(ui+(We=this.attribute(Ft[Vt],Mt,$t)).length>Mt.width?(Ve=this.indent(Se,Mt,$t+1)+We,ke+=this.endline(Se,Mt,$t)+Ve,ui=Ve.length):(ke+=Ve=" "+We,ui+=Ve.length));else for(Vt in Te=Se.attribs)!dt.call(Te,Vt)||(ke+=this.attribute(Te[Vt],Mt,$t));if(this.stream.write(ke),Rt=0===(ft=Se.children.length)?null:Se.children[0],0===ft||Se.children.every(function(qe){return(qe.type===Ye.Text||qe.type===Ye.Raw||qe.type===Ye.CData)&&""===qe.value}))Mt.allowEmpty?(this.stream.write(">"),Mt.state=tt.CloseTag,this.stream.write("</"+Se.name+">")):(Mt.state=tt.CloseTag,this.stream.write(Mt.spaceBeforeSlash+"/>"));else if(!Mt.pretty||1!==ft||Rt.type!==Ye.Text&&Rt.type!==Ye.Raw&&Rt.type!==Ye.CData||null==Rt.value){for(this.stream.write(">"+this.endline(Se,Mt,$t)),Mt.state=tt.InsideTag,xn=0,Rn=(lt=Se.children).length;xn<Rn;xn++)this.writeChildNode(lt[xn],Mt,$t+1);Mt.state=tt.CloseTag,this.stream.write(this.indent(Se,Mt,$t)+"</"+Se.name+">")}else this.stream.write(">"),Mt.state=tt.InsideTag,Mt.suppressPrettyCount++,this.writeChildNode(Rt,Mt,$t+1),Mt.suppressPrettyCount--,Mt.state=tt.CloseTag,this.stream.write("</"+Se.name+">");return this.stream.write(this.endline(Se,Mt,$t)),Mt.state=tt.None,this.closeNode(Se,Mt,$t)}processingInstruction(Se,Mt,$t){return this.stream.write(super.processingInstruction(Se,Mt,$t))}raw(Se,Mt,$t){return this.stream.write(super.raw(Se,Mt,$t))}text(Se,Mt,$t){return this.stream.write(super.text(Se,Mt,$t))}dtdAttList(Se,Mt,$t){return this.stream.write(super.dtdAttList(Se,Mt,$t))}dtdElement(Se,Mt,$t){return this.stream.write(super.dtdElement(Se,Mt,$t))}dtdEntity(Se,Mt,$t){return this.stream.write(super.dtdEntity(Se,Mt,$t))}dtdNotation(Se,Mt,$t){return this.stream.write(super.dtdNotation(Se,Mt,$t))}}}).call(this)},4354:function(Mn,kn,pt){(function(){var tt;tt=pt(3576),Mn.exports=class extends tt{constructor(h){super(h)}document(h,dt){var Se,Mt,$t,nn;for(dt=this.filterOptions(dt),$t="",Se=0,Mt=(nn=h.children).length;Se<Mt;Se++)$t+=this.writeChildNode(nn[Se],dt,0);return dt.pretty&&$t.slice(-dt.newline.length)===dt.newline&&($t=$t.slice(0,-dt.newline.length)),$t}}}).call(this)},5041:function(Mn){(function(){var pt={}.hasOwnProperty;Mn.exports=function(){class Ye{constructor(Ue){var h,dt;for(h in this.assertLegalChar=this.assertLegalChar.bind(this),this.assertLegalName=this.assertLegalName.bind(this),Ue||(Ue={}),this.options=Ue,this.options.version||(this.options.version="1.0"),dt=Ue.stringify||{})!pt.call(dt,h)||(this[h]=dt[h])}name(Ue){return this.options.noValidation?Ue:this.assertLegalName(""+Ue||"")}text(Ue){return this.options.noValidation?Ue:this.assertLegalChar(this.textEscape(""+Ue||""))}cdata(Ue){return this.options.noValidation?Ue:(Ue=(Ue=""+Ue||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(Ue))}comment(Ue){if(this.options.noValidation)return Ue;if((Ue=""+Ue||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+Ue);return this.assertLegalChar(Ue)}raw(Ue){return this.options.noValidation?Ue:""+Ue||""}attValue(Ue){return this.options.noValidation?Ue:this.assertLegalChar(this.attEscape(Ue=""+Ue||""))}insTarget(Ue){return this.options.noValidation?Ue:this.assertLegalChar(""+Ue||"")}insValue(Ue){if(this.options.noValidation)return Ue;if((Ue=""+Ue||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+Ue);return this.assertLegalChar(Ue)}xmlVersion(Ue){if(this.options.noValidation)return Ue;if(!(Ue=""+Ue||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+Ue);return Ue}xmlEncoding(Ue){if(this.options.noValidation)return Ue;if(!(Ue=""+Ue||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+Ue);return this.assertLegalChar(Ue)}xmlStandalone(Ue){return this.options.noValidation?Ue:Ue?"yes":"no"}dtdPubID(Ue){return this.options.noValidation?Ue:this.assertLegalChar(""+Ue||"")}dtdSysID(Ue){return this.options.noValidation?Ue:this.assertLegalChar(""+Ue||"")}dtdElementValue(Ue){return this.options.noValidation?Ue:this.assertLegalChar(""+Ue||"")}dtdAttType(Ue){return this.options.noValidation?Ue:this.assertLegalChar(""+Ue||"")}dtdAttDefault(Ue){return this.options.noValidation?Ue:this.assertLegalChar(""+Ue||"")}dtdEntityValue(Ue){return this.options.noValidation?Ue:this.assertLegalChar(""+Ue||"")}dtdNData(Ue){return this.options.noValidation?Ue:this.assertLegalChar(""+Ue||"")}assertLegalChar(Ue){var h,dt;if(this.options.noValidation)return Ue;if("1.0"===this.options.version){if(h=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Ue=Ue.replace(h,this.options.invalidCharReplacement);else if(dt=Ue.match(h))throw new Error(`Invalid character in string: ${Ue} at index ${dt.index}`)}else if("1.1"===this.options.version)if(h=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/g,void 0!==this.options.invalidCharReplacement)Ue=Ue.replace(h,this.options.invalidCharReplacement);else if(dt=Ue.match(h))throw new Error(`Invalid character in string: ${Ue} at index ${dt.index}`);return Ue}assertLegalName(Ue){if(this.options.noValidation)return Ue;if(!(Ue=this.assertLegalChar(Ue)).match(/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/))throw new Error(`Invalid character in name: ${Ue}`);return Ue}textEscape(Ue){return this.options.noValidation?Ue:Ue.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")}attEscape(Ue){return this.options.noValidation?Ue:Ue.replace(this.options.noDoubleEncoding?/(?!&(lt|gt|amp|apos|quot);)&/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}}return Ye.prototype.convertAttKey="@",Ye.prototype.convertPIKey="?",Ye.prototype.convertTextKey="#text",Ye.prototype.convertCDataKey="#cdata",Ye.prototype.convertCommentKey="#comment",Ye.prototype.convertRawKey="#raw",Ye}.call(this)}).call(this)},474:function(Mn,kn,pt){(function(){var Ye,tt;Ye=pt(2269),tt=pt(2182),Mn.exports=function(){class h extends tt{constructor(Ct,Se){if(super(Ct),null==Se)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=Ye.Text,this.value=this.stringify.text(Se)}clone(){return Object.create(this)}toString(Ct){return this.options.writer.text(this,this.options.writer.filterOptions(Ct))}splitText(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}replaceWholeText(Ct){throw new Error("This DOM method is not implemented."+this.debugInfo())}}return Object.defineProperty(h.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(h.prototype,"wholeText",{get:function(){var dt,Ct,Se;for(Se="",Ct=this.previousSibling;Ct;)Se=Ct.data+Se,Ct=Ct.previousSibling;for(Se+=this.data,dt=this.nextSibling;dt;)Se+=dt.data,dt=dt.nextSibling;return Se}}),h}.call(this)}).call(this)},3576:function(Mn,kn,pt){(function(){var Ye,tt,Rn,Vt={}.hasOwnProperty;({assign:Rn}=pt(3452)),Ye=pt(2269),pt(4789),pt(9195),pt(1361),pt(2516),pt(3352),pt(9942),pt(474),pt(4666),pt(4173),pt(7274),pt(2068),pt(8349),pt(3087),tt=pt(6316),Mn.exports=class{constructor(ke){var We,Ft,Te;for(We in ke||(ke={}),this.options=ke,Ft=ke.writer||{})!Vt.call(Ft,We)||(Te=Ft[We],this["_"+We]=this[We],this[We]=Te)}filterOptions(ke){var We,Ft,Te,lt,Ve,qe,Nt,xt,ct;return ke||(ke={}),ke=Rn({},this.options,ke),(We={writer:this}).pretty=ke.pretty||!1,We.allowEmpty=ke.allowEmpty||!1,We.indent=null!=(Ft=ke.indent)?Ft:"  ",We.newline=null!=(Te=ke.newline)?Te:"\n",We.offset=null!=(lt=ke.offset)?lt:0,We.width=null!=(Ve=ke.width)?Ve:0,We.dontPrettyTextNodes=null!=(qe=null!=(Nt=ke.dontPrettyTextNodes)?Nt:ke.dontprettytextnodes)?qe:0,We.spaceBeforeSlash=null!=(xt=null!=(ct=ke.spaceBeforeSlash)?ct:ke.spacebeforeslash)?xt:"",!0===We.spaceBeforeSlash&&(We.spaceBeforeSlash=" "),We.suppressPrettyCount=0,We.user={},We.state=tt.None,We}indent(ke,We,Ft){var Te;return!We.pretty||We.suppressPrettyCount?"":We.pretty&&(Te=(Ft||0)+We.offset+1)>0?new Array(Te).join(We.indent):""}endline(ke,We,Ft){return!We.pretty||We.suppressPrettyCount?"":We.newline}attribute(ke,We,Ft){var Te;return this.openAttribute(ke,We,Ft),Te=We.pretty&&We.width>0?ke.name+'="'+ke.value+'"':" "+ke.name+'="'+ke.value+'"',this.closeAttribute(ke,We,Ft),Te}cdata(ke,We,Ft){var Te;return this.openNode(ke,We,Ft),We.state=tt.OpenTag,Te=this.indent(ke,We,Ft)+"<![CDATA[",We.state=tt.InsideTag,Te+=ke.value,We.state=tt.CloseTag,Te+="]]>"+this.endline(ke,We,Ft),We.state=tt.None,this.closeNode(ke,We,Ft),Te}comment(ke,We,Ft){var Te;return this.openNode(ke,We,Ft),We.state=tt.OpenTag,Te=this.indent(ke,We,Ft)+"\x3c!-- ",We.state=tt.InsideTag,Te+=ke.value,We.state=tt.CloseTag,Te+=" --\x3e"+this.endline(ke,We,Ft),We.state=tt.None,this.closeNode(ke,We,Ft),Te}declaration(ke,We,Ft){var Te;return this.openNode(ke,We,Ft),We.state=tt.OpenTag,Te=this.indent(ke,We,Ft)+"<?xml",We.state=tt.InsideTag,Te+=' version="'+ke.version+'"',null!=ke.encoding&&(Te+=' encoding="'+ke.encoding+'"'),null!=ke.standalone&&(Te+=' standalone="'+ke.standalone+'"'),We.state=tt.CloseTag,Te+=We.spaceBeforeSlash+"?>",Te+=this.endline(ke,We,Ft),We.state=tt.None,this.closeNode(ke,We,Ft),Te}docType(ke,We,Ft){var lt,Ve,qe,Nt;if(Ft||(Ft=0),this.openNode(ke,We,Ft),We.state=tt.OpenTag,qe=this.indent(ke,We,Ft),qe+="<!DOCTYPE "+ke.root().name,ke.pubID&&ke.sysID?qe+=' PUBLIC "'+ke.pubID+'" "'+ke.sysID+'"':ke.sysID&&(qe+=' SYSTEM "'+ke.sysID+'"'),ke.children.length>0){for(qe+=" [",qe+=this.endline(ke,We,Ft),We.state=tt.InsideTag,lt=0,Ve=(Nt=ke.children).length;lt<Ve;lt++)qe+=this.writeChildNode(Nt[lt],We,Ft+1);We.state=tt.CloseTag,qe+="]"}return We.state=tt.CloseTag,qe+=We.spaceBeforeSlash+">",qe+=this.endline(ke,We,Ft),We.state=tt.None,this.closeNode(ke,We,Ft),qe}element(ke,We,Ft){var Ve,qe,Nt,xt,ct,tn,Pn,vn,$n,Kn,yi,Wn,br,qr,ds,On,ks;if(Ft||(Ft=0),Kn=!1,this.openNode(ke,We,Ft),We.state=tt.OpenTag,yi=this.indent(ke,We,Ft)+"<"+ke.name,We.pretty&&We.width>0)for($n in tn=yi.length,br=ke.attribs)!Vt.call(br,$n)||(tn+(Wn=this.attribute(br[$n],We,Ft)).length>We.width?(ks=this.indent(ke,We,Ft+1)+Wn,yi+=this.endline(ke,We,Ft)+ks,tn=ks.length):(yi+=ks=" "+Wn,tn+=ks.length));else for($n in qr=ke.attribs)!Vt.call(qr,$n)||(yi+=this.attribute(qr[$n],We,Ft));if(Nt=0===(qe=ke.children.length)?null:ke.children[0],0===qe||ke.children.every(function($s){return($s.type===Ye.Text||$s.type===Ye.Raw||$s.type===Ye.CData)&&""===$s.value}))We.allowEmpty?(yi+=">",We.state=tt.CloseTag,yi+="</"+ke.name+">"+this.endline(ke,We,Ft)):(We.state=tt.CloseTag,yi+=We.spaceBeforeSlash+"/>"+this.endline(ke,We,Ft));else if(!We.pretty||1!==qe||Nt.type!==Ye.Text&&Nt.type!==Ye.Raw&&Nt.type!==Ye.CData||null==Nt.value){if(We.dontPrettyTextNodes)for(xt=0,Pn=(ds=ke.children).length;xt<Pn;xt++)if(((Ve=ds[xt]).type===Ye.Text||Ve.type===Ye.Raw||Ve.type===Ye.CData)&&null!=Ve.value){We.suppressPrettyCount++,Kn=!0;break}for(yi+=">"+this.endline(ke,We,Ft),We.state=tt.InsideTag,ct=0,vn=(On=ke.children).length;ct<vn;ct++)yi+=this.writeChildNode(Ve=On[ct],We,Ft+1);We.state=tt.CloseTag,yi+=this.indent(ke,We,Ft)+"</"+ke.name+">",Kn&&We.suppressPrettyCount--,yi+=this.endline(ke,We,Ft),We.state=tt.None}else yi+=">",We.state=tt.InsideTag,We.suppressPrettyCount++,Kn=!0,yi+=this.writeChildNode(Nt,We,Ft+1),We.suppressPrettyCount--,Kn=!1,We.state=tt.CloseTag,yi+="</"+ke.name+">"+this.endline(ke,We,Ft);return this.closeNode(ke,We,Ft),yi}writeChildNode(ke,We,Ft){switch(ke.type){case Ye.CData:return this.cdata(ke,We,Ft);case Ye.Comment:return this.comment(ke,We,Ft);case Ye.Element:return this.element(ke,We,Ft);case Ye.Raw:return this.raw(ke,We,Ft);case Ye.Text:return this.text(ke,We,Ft);case Ye.ProcessingInstruction:return this.processingInstruction(ke,We,Ft);case Ye.Dummy:return"";case Ye.Declaration:return this.declaration(ke,We,Ft);case Ye.DocType:return this.docType(ke,We,Ft);case Ye.AttributeDeclaration:return this.dtdAttList(ke,We,Ft);case Ye.ElementDeclaration:return this.dtdElement(ke,We,Ft);case Ye.EntityDeclaration:return this.dtdEntity(ke,We,Ft);case Ye.NotationDeclaration:return this.dtdNotation(ke,We,Ft);default:throw new Error("Unknown XML node type: "+ke.constructor.name)}}processingInstruction(ke,We,Ft){var Te;return this.openNode(ke,We,Ft),We.state=tt.OpenTag,Te=this.indent(ke,We,Ft)+"<?",We.state=tt.InsideTag,Te+=ke.target,ke.value&&(Te+=" "+ke.value),We.state=tt.CloseTag,Te+=We.spaceBeforeSlash+"?>",Te+=this.endline(ke,We,Ft),We.state=tt.None,this.closeNode(ke,We,Ft),Te}raw(ke,We,Ft){var Te;return this.openNode(ke,We,Ft),We.state=tt.OpenTag,Te=this.indent(ke,We,Ft),We.state=tt.InsideTag,Te+=ke.value,We.state=tt.CloseTag,Te+=this.endline(ke,We,Ft),We.state=tt.None,this.closeNode(ke,We,Ft),Te}text(ke,We,Ft){var Te;return this.openNode(ke,We,Ft),We.state=tt.OpenTag,Te=this.indent(ke,We,Ft),We.state=tt.InsideTag,Te+=ke.value,We.state=tt.CloseTag,Te+=this.endline(ke,We,Ft),We.state=tt.None,this.closeNode(ke,We,Ft),Te}dtdAttList(ke,We,Ft){var Te;return this.openNode(ke,We,Ft),We.state=tt.OpenTag,Te=this.indent(ke,We,Ft)+"<!ATTLIST",We.state=tt.InsideTag,Te+=" "+ke.elementName+" "+ke.attributeName+" "+ke.attributeType,"#DEFAULT"!==ke.defaultValueType&&(Te+=" "+ke.defaultValueType),ke.defaultValue&&(Te+=' "'+ke.defaultValue+'"'),We.state=tt.CloseTag,Te+=We.spaceBeforeSlash+">"+this.endline(ke,We,Ft),We.state=tt.None,this.closeNode(ke,We,Ft),Te}dtdElement(ke,We,Ft){var Te;return this.openNode(ke,We,Ft),We.state=tt.OpenTag,Te=this.indent(ke,We,Ft)+"<!ELEMENT",We.state=tt.InsideTag,Te+=" "+ke.name+" "+ke.value,We.state=tt.CloseTag,Te+=We.spaceBeforeSlash+">"+this.endline(ke,We,Ft),We.state=tt.None,this.closeNode(ke,We,Ft),Te}dtdEntity(ke,We,Ft){var Te;return this.openNode(ke,We,Ft),We.state=tt.OpenTag,Te=this.indent(ke,We,Ft)+"<!ENTITY",We.state=tt.InsideTag,ke.pe&&(Te+=" %"),Te+=" "+ke.name,ke.value?Te+=' "'+ke.value+'"':(ke.pubID&&ke.sysID?Te+=' PUBLIC "'+ke.pubID+'" "'+ke.sysID+'"':ke.sysID&&(Te+=' SYSTEM "'+ke.sysID+'"'),ke.nData&&(Te+=" NDATA "+ke.nData)),We.state=tt.CloseTag,Te+=We.spaceBeforeSlash+">"+this.endline(ke,We,Ft),We.state=tt.None,this.closeNode(ke,We,Ft),Te}dtdNotation(ke,We,Ft){var Te;return this.openNode(ke,We,Ft),We.state=tt.OpenTag,Te=this.indent(ke,We,Ft)+"<!NOTATION",We.state=tt.InsideTag,Te+=" "+ke.name,ke.pubID&&ke.sysID?Te+=' PUBLIC "'+ke.pubID+'" "'+ke.sysID+'"':ke.pubID?Te+=' PUBLIC "'+ke.pubID+'"':ke.sysID&&(Te+=' SYSTEM "'+ke.sysID+'"'),We.state=tt.CloseTag,Te+=We.spaceBeforeSlash+">"+this.endline(ke,We,Ft),We.state=tt.None,this.closeNode(ke,We,Ft),Te}openNode(ke,We,Ft){}closeNode(ke,We,Ft){}openAttribute(ke,We,Ft){}closeAttribute(ke,We,Ft){}}}).call(this)},7904:function(Mn,kn,pt){(function(){var Ye,tt,Ue,h,dt,Ct,Se,Mt,$t;({assign:Mt,isFunction:$t}=pt(3452)),Ue=pt(9906),h=pt(519),dt=pt(1105),Se=pt(4354),Ct=pt(7647),Ye=pt(2269),tt=pt(6316),Mn.exports.create=function(nn,jt,rt,ft){var Rt,xn;if(null==nn)throw new Error("Root element needs a name.");return ft=Mt({},jt,rt,ft),xn=(Rt=new h(ft)).element(nn),ft.headless||(Rt.declaration(ft),(null!=ft.pubID||null!=ft.sysID)&&Rt.dtd(ft)),xn},Mn.exports.begin=function(nn,jt,rt){return $t(nn)&&([jt,rt]=[nn,jt],nn={}),jt?new dt(nn,jt,rt):new h(nn)},Mn.exports.stringWriter=function(nn){return new Se(nn)},Mn.exports.streamWriter=function(nn,jt){return new Ct(nn,jt)},Mn.exports.implementation=new Ue,Mn.exports.nodeType=Ye,Mn.exports.writerState=tt}).call(this)}},Mn=>{Mn(Mn.s=5985)}]);